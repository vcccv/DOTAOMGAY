
# v2.0

## 环境修改

- [ ] 基于mpqeditor重建mpq重新测试(或仅替换关键文件，例如Units，以实现不重新导入就应用的物编修改)

## 系统

- [ ] UI系统重构
- [x] 玩家模拟发消息
- [x] 通用的GameTimer
- [x] 新的DamageSystem，应用StackTop
    - [x] 应用StackTop
    - [ ] 减伤流程中判断守卫类单位类型的优化
    - [x] 灵魂超度受伤流程

## 新增

### 物品

- [ ] **以太之镜**
    - [x] 提升5%的魔法伤害
    - [x] 重做各类震荡波
        - [x] 对于ShockWaveLib的完整实现
        - [x] 食腐蝠群
        - [x] 震荡波
        - [x] 震荡波的神杖升级
        - [x] 龙破斩
        - [x] 超声冲击波
        - [x] 火焰气息
        - [x] 冰火交加
        - [x] 巨浪的神杖升级
        - [x] 超震声波
        - [x] 吞噬 - 震荡波
        - [x] 酸液
    - [x] 各类穿刺实现(不包括毁灭)
        - [x] 穿刺(恶魔巫师)
        - [x] 穿刺(地穴刺客)
    - [x] 兽王斧子
    - [x] 重构沟壑
    - [x] 重构烈火焚身
    - [x] 重构冰封路径
    - [x] 裂地者
    - [x] 恐怖波动
    - [x] 獠牙冲刺
    - [x] 时间漫游
    - [x] 发射钩爪
    - [x] 波浪形态 实际上根本不需要重做自己就适配了
    - [x] 2个B和跳刀，似乎要特别适配DataA要+一下
    - [x] 肉钩
    - [ ] 启明
    - [x] 雷电牵引

- [x] 花钱吃A
    - [x] 地精的贪婪给予队友神杖时，如果目标队友已有阿哈利姆神杖则会全款退回给目标不可靠金钱(物品退回4200，阿哈利姆福佑退回5800)，并且现在给予队友神杖效果时，不再增加自己的净资产。
    - [x] 神杖强化重构
    - [x] 现在不再会有再装填时无法对召唤飞弹和守护天使(非RC)进行神杖升级的隐藏机制
    - [x] 射手天赋
        - [x] 幻象的逻辑
    - [x] 高射火炮
        - [x] 整个被动图标
    - [x] 多重施法
    - [x] 锯齿飞轮
    - [x] 群星坠落
    - [x] 疯狂生长
    - [x] 海象挥击
    - [x] 推进
    - [x] 长大
    - [x] 物品
        - [x] 卷轴类型
        - [x] 合成后的类型 
        - [x] 退款
- [ ] **永恒之盘**

### 技能
- [x] 暂时禁用**血肉傀儡**
    - [ ] 神杖升级单独实现 
- [x] 现在高射火炮拥有神杖升级效果了
- [x] 绝大部分同类技能不再命令冲突(可以一起选)，包括震荡波类，闪电链、刀阵旋风类
    - [x] 闪电链类 chainlightning 852119
        - [x] 弧形闪电
        - [x] 神灭斩
        - [x] 遥控炸弹
        - [x] 联结
        - [x] 电子涡流
        - [x] 束缚击
        - [x] 追踪导弹
        - [x] 一闪
        - [x] 秘法箭
        - [x] 秘术异蛇
        - [x] 吞噬 - 连环闪电
        - [x] 撕裂伤口
        - [x] 蚀脑
        - [x] 淘汰之刃
        - [x] 无光之盾
        - [x] 麻痹药剂
        - [x] 星体禁锢
        - [x] 燃烧枷锁
        - [x] 灵魂隔断
        - [x] 闪电风暴
        - [x] 崩裂禁锢
        - [x] 死亡一指
        - [x] 命运敕令
    - [x] 刀阵旋风类 fanofknives 852526
        - [x] 战吼
        - [x] 激流
        - [x] 回音击
        - [x] 狂猛
        - [x] 超强力量
        - [x] 热导飞弹
        - [x] 战斗专注
        - [x] 幽魂
        - [x] 奔袭冲撞
        - [x] 不稳定化合物
        - [x] 残影
        - [x] 折光
        - [x] 高射火炮
        - [x] 风行者
        - [x] 海象挥击
        - [x] 刺针扫射
        - [x] 炽热锁链
        - [x] 震荡射击
        - [x] 死亡旋风
        - [x] 焦土
        - [x] 尖刺外壳
        - [x] 痛苦尖叫
        - [x] 等离子场
        - [x] 死亡脉冲
        - [x] 冰晶爆轰 - 激活
        - [x] 黑暗契约
        - [x] 恶魔敕令
        - [x] 召唤佣兽
        - [x] 地狱
    - [ ] 风暴之锤类 thunderbolt 852095
        - [ ] 
    - [x] 蜂群类 carrionswarm 852218
        - [x] 食腐蝠群
        - [x] 震荡波
        - [x] 龙破斩
        - [x] 波浪形态
        - [x] 发芽
        - [x] 时间漫游
        - [x] 冰火交加
    - [x] 酸性炸弹类 acidbomb 852662
        - [x] 巨浪
        - [x] 变体攻击
        - [x] 引燃
        - [x] 液态火
        - [x] 灵魂汲取
        - [x] 火之余烬
    - [x] 震荡波类 shockwave 852125
        - [x] 烈焰焚身
        - [x] 超声冲击波
        - [x] 吞噬 - 震荡波
    - [x] 闪现类 blink 852525
        - [x] 传送
        - [x] 闪烁(敌法师)
        - [x] 闪烁(痛苦女王)
    - [x] 喷火类 breathoffire 852580
        - [x] 火焰气息
        - [x] 冰封路径
    - [x] 镜像类 mirrorimage 852123
        - [x] 混沌之军
        - [x] 镜像
- [x] **刷逼之力**和**召唤巨石**命令冲突修复
- [x] 重写**超震声波**
    - [x] 改变了**超震声波**的作用范围，从始终为200变为初始作用范围175，末端作用范围225。
    - [x] **超震声波**现在在击退结束时不再附带完全控制效果的位移。
    - [x] **超震声波**现在的击中效果为缴械→击退→伤害，而不是击退结束后才施加缴械效果，并且缴械机制更改，避免对于变身单位造成灭顶之灾。
    - [x] **超震声波**的神杖升级现在为指向性技能，以适应以太之镜给予额外施法距离。
- [x] **獠牙冲刺**重写，修复了错误选取目标的问题，现在不再拥有悬崖保护，并且不再强制性的打断施法者接下来的施法动作。
- [ ] **无影拳**施法期间不再强制改变施法者的单位类型为灰烬之灵
    - [x] 移除**无影拳**在非RC模式下对于**长大**的限制
- [x] **阿托斯之棍**增加弹道
- [ ] **勋章**降低施法距离 减少持续时间
- [x] 防偷塔
    - [x] 偷塔保护每秒回血90/s > 180/s
    - [x] 基地也防偷塔 基地回血 20/s > 5/s
- [x] **星体禁锢**和**崩裂禁锢**现在不再直接禁用玩家的控制面板，而是可以继续操作
    - [x] 对于HideEx的完整实现，以及无敌计数器
- [x] **冰火交加**的前进距离从500修改至750
- [x] **肉钩**不再有悬崖5秒无碰撞保护，修正了一个代码内的可疑行为
- [x] 重写**竭心光环**
- [x] **魂之挽歌**
    - [x] 修复了在神杖升级后作用效果始终是1级的错误。
    - [x] 现在在灵魂波击中目标后才会施加减速效果，而不是原来的立即对700码范围内所有单位施加减速。
    - [x] 不再对击中的目标施加50%的攻击速度减少。 
    - [x] 现在神杖升级后，灵魂波在回归时如果击中敌方英雄，回归结束时会治疗施法者造成伤害值的生命。
    - [x] 现在神杖升级后，回归的灵魂波以相反的范围选取开始回归，即一开始就应用最大范围，末端为最小范围。
    - [x] 将灵魂波前进距离从900增加至1000。
    - [x] 将每级的灵魂波初始范围75/100/125增加至125。
    - [x] 将每级的灵魂波最大范围从400/425/450调整至425。
- [x] **两级反转**神杖升级的3个波，应用Shockwave
- [ ] 重写大部分幻象实现，现在部分远程幻象的数值降低。
    - [x] 修正了幻象单位在拥有分裂箭时没有正确应用普通攻击造成80%伤害的错误。
    - [x] 幻象单位现在攻击Roshan时不再会被秒杀，但只能造成20%伤害值。
    - [x] 幻象单位现在攻击建筑时只会造成40%伤害。
    - [x] 修正了协同给予幻象单位额外魔法抗性完全无效的错误，现在正确生效。
    - [x] 镜像的实现
        - [x] 幻影斧
            - 修正技能描述，现在为继承33%(28)%攻击力，承受300%(400%)伤害。现在是友方驱散。
        - [x] 镜像
            - [x] 远程英雄继承30%/35%/40%/45%攻击力→25%/30%/35%/40%，承受伤害600%/500%/400%/300%→650%/550%/450%/350%，冷却时间40秒→50秒。
        - [x] 混沌之军
            - [x] 从镜像改名为混沌之军。
            - [x] 修复了描述上持续时间写着34秒实则是42秒的错误，现在正确应用技能描述的34秒持续时间。
            - [x] 近战英雄继承90%攻击力→100%攻击力，承受伤害200%→225%，冷却时间100秒→80秒。
            - [x] 远程英雄继承90%攻击力→80%攻击力，承受伤害200%→250%，冷却时间100秒。
        - [x] 魔法镜像
            - [x] 修复了技能升级导致持续时间变短的bug，修复前是32/30/25/25的持续时间，现在正确应用技能描述的32秒持续时间。
            - [x] 远程英雄继承30%/40%/50%/60%攻击力→20%/30%/40%/50%，承受伤害300%→350%，冷却时间16秒→冷却时间20秒。
            - [x] 现在敌人可以轻易分辨这种镜像。
        - [x] 灵魂之矛
            - [x] 修正了技能学习描述错误，补全了技能描述，现在正确的显示为创造继承20%攻击力和承受400%伤害的镜像。
        - [ ] 复制之墙
        - [ ] 鬼影重重
        - [ ] 神行百变
        - [ ] 并列
        - [ ] 复制
- [x] **多重施法**现在的魔法消耗限制仅在非BO(关闭平衡)而不是在非RC(限制解除)下生效。
    - [x] 从每下额外施法增加50%魔法消耗降低至每下额外施法增加35%魔法消耗。
- [x] **肉钩**对于**多重施法**的实现更改，现在始终以施法者为准来适应以太之镜。
- [x] **幻影冲锋**的最小距离降低至200，重写实现。
- [x] **时间结界**重写部分实现，现在不再暂停信使。
- [x] **俯冲**部分实现重写，现在更准确判定到目标单位，以施法中心点进行选取。
- [x] **幽鬼之刃**重写
    - [x] 现在不再会出现无限距离移动。
    - [x] 处于幽鬼之径时将正常寻路，无视地形效果现在是基于加速的魔法效果上(粘滞时间变长)。
    - [x] 幽鬼之径创造者效果现在对于英雄级单位生效(原来不计算镜像单位和熊灵)。
    - [x] 最大距离从2100→2000，现在符合技能描述。
- [x] **织网**重写
    - [x] 现在无视地形的移动在受伤后失去3秒→受伤后失去6秒。
    - [x] 无视地形的寻路问题被修复了，并且无视地形的移动效果对于蜘蛛网所有者的其他寄生蜘蛛单位也可以生效。
    - [x] 不再可以多重施法(纯浪费)。
    - [x] 在失去无视地形移动能力后会摧毁周围150范围内的树木。
    - [x] 现在使用变身技能不再会导致在蜘蛛网内失去隐身状态(出去回来才会恢复)
    - [x] 现在粘滞时间为0.15秒。
- [x] 冲刺(鱼人守卫)相位移动效果正常应用，现在和相位鞋不再冲突。
- [x] 最后一次受伤时间捕获
- [ ] **刚毛后背**重写
- [x] 静谧之靴，恐鳌之心，科勒的匕首优化，不再是0.33秒的检查，而是在受到伤害时立即禁用。
    - [x] 科勒的匕首
    - [x] 修正恐鳌之心物品描述的错误，正确的冷却时间为近战4秒远程6秒，原来为近战5秒远程7秒。
    - [x] 现在重置冷却时间效果可以作用于静谧之靴，恐鳌之心，科勒的匕首。
    - [x] 现在科勒的匕首和恐鳌之心即便处于破碎状态也可以丢弃
    - [x] 现在即便在受伤在获得物品之前，如果禁用时间未结束，物品也会在获得时被禁用。
- [x] 修正**终末**文本描述冷却时间不对，现在从60更正为100。
- [ ] 现在拥有被动的冷却技能可以正确应用冷却缩减
    - [ ] 潮汐使者
    - [ ] 反击螺旋
    - [ ] 勇气之霎
    - [ ] 幻影冲锋
    - [ ] 余震
    - [ ] 
- [x] 疾风步类buff立即更新单位移动类型
- [x] 现在熊灵伙伴和熊灵伙伴持有者的物品不可丢弃时间会正确根据物品冷却结束解除不可丢弃状态(但处于冷却时间时依旧不可丢弃)
- [x] 优化item类的GetItemIndex()
- [x] 自定义单位事件

## 修复
- [x] 修正PRD伪随机，使其最小单位为1而不是5(即不再会非5倍数时向下取整)，之前一些技能概率不是5的倍数，其实都向下取整了。
    - [x] 对于原来的实现，例如使用49.5%概率时，向下取5的倍数为45%概率；使用18%概率时，向下取5的倍数为15%概率。
    - [x] 多重施法现在的施法概率正确应用，在非BO(关闭平衡)模式下概率修正，以使用有效的整数概率而不是小数概率。
        - [x] 18%/29.5/39.5x2；0%/13%/14.5%x3；0%/0%/5.5%x4 更改为 18%/30%/40%x2；0%/13%/15%x3；0%/0%/5%x4
    - [x] 在开启BO(关闭平衡)模式下，概率修正为：
        - [x] 0%/0%/12.5%x4 更改为 0%/0%/12%x4
- [x] 重构被动技能系统的实现，修正了变身加重生可能会出现全被动的问题。
    - [x] ,A10U,A11X,A23F,A344,Q003,Q019,Q022,Q035,Q036,Q047,Q067,Q083,Q098,Q099,Q102,Q107,Q119,Q123,Q131,Q133,Q135,Q143,Q147,Q155,Q211,Q231,Q239,Q240,Q250,Q251,Q279,Q283,Q294,Q302,Q303,Q307,Q310,Q319,Q327,Q338,Q347,Q363,Q418,Q431,A3J7
    - [x] 然后还删了个米波的A344,Q003,Q019,Q022,Q035,Q036,Q047,Q067,Q083,Q098,Q099,Q102,Q107,Q119,Q123,Q131,Q133,Q135,Q143,Q147,Q155,Q211,Q231,Q239,Q240,Q250,Q251,Q279,Q283,Q294,Q302,Q303,Q307,Q310,Q319,Q327,Q338,Q347,Q363,Q418,Q431,A3J7
- [x] 修正了**烈火焚身**的神杖升级技能描述错误，应该为1800前进距离而不是900前进距离。
- [x] 修正了**魔龙枪**拆分后，会永久提供射程的bug。
- [x] 修正了在使用分身技能时，携带射程增加的物品时会导致本体射程错误的bug。
- [x] 修正了无法获取幻象单位主属性的bug，连带修正一系列bug。
- [x] 修正***月刃***弹射逻辑错误问题。
- [x] 修复天灾下路远程兵营被拆后 近卫上路也会刷新高级投刃车的bug。
- [ ] **自然之怒**没有树人。
- [ ] **熊猫元素**分离 踩地板没效果 火焰醉拳只有暴击没有闪避而且没特效。
- [ ] **重生**期间买活进cd。
- [ ] 重写**疯狂生长**，修复**疯狂生长**对于森林之眼判定错误的问题。
- [x] 修正了冲击波类的技能对于施法距离和最大距离的混淆。施法距离应该为释放技能时可用的距离，最大距离应该为冲击波最远可以前进的路程。
    - [x] 修复了**食腐蝠群**的前进距离只有700而不810的错误
    - [x] 修复了**龙破斩**的前进距离只有800而不是1075的错误
    - [x] 修复了**超声冲击波**的前进距离只有800而不是900的错误
    - [x] 修复了**火焰气息**的前进距离只有500而不是650的错误
    - [x] 修复了**震荡波**神杖升级后不能点单位施法的错误
    - [x] 修复了**巨浪**的弹道具有碰撞体积和血条的错误
- [x] 现在大多数技能有无敌计数了，在同时起作用的情况下，不再会被前一个所取消效果，并且变身类技能不再取消之前所拥有的无敌效果。
    - [x] 无影拳
    - [x] 无敌斩
    - [x] 相位转移
    - [x] 崩裂禁锢
    - [x] 星体禁锢
    - [x] 时间漫游
    - [x] 波浪形态
    - [x] 球状闪电
- [x] 现在大多数无视地形的效果拥有计数了，在同时起作用的情况下，不再会被前一个所取消效果，并且变身类技能和疾风步类技能不再取消之前所拥有的无视地形效果。
    - [x] 獠牙冲刺
    - [x] 幽鬼之刃
    - [x] 编网
    - [x] 肉钩
    - [x] 雷电牵引
    - [x] 无影拳
    - [x] 无敌斩
    - [x] 时间漫游
    - [x] 波浪形态
    - [x] 球状闪电
- [ ] 重写**嗜血渴望**，现在立即显示隐身单位，而不是在粘滞时间后显示隐身单位
- [x] 重写**暗影之舞**，现在完全的免疫真视效果，而不再是修改目标允许，并且一些技能也可以正常对其生效。
- [x] 重写**奔袭冲撞**
    - [x] 修正在没有神杖升级且技能等级为2时可以享受神杖升级的减伤效果的错误。
    - [x] 取消**再装填**的内置的45秒内不再重复生效的设置。
    - [x] 现在正确的对玩家所有单位生效，之前仅对主英雄生效，但仍然不对**鬼影重重**生成的幻象以及信使，守卫、建筑生效。
    - [ ] 还要实现一个不对鬼影重重的幻想生效。
    - [x] 现在多次施法时可以正确应用效果。
    - [x] 现在在技能描述中描述为无视地形，并且修正了寻路上的问题。
    - [x] 现在践踏正确的应用施法者的主属性，而不是碰撞来源的主属性。
    - [x] 践踏可以作用于肉山。
- [x] 修正**白银之锋**的减伤效果和**活体护甲**的格挡效果作用普通单位时效果不正确的问题。
- [x] 重写**酸液**技能，现在不再是立即对指定区域造成伤害，而是匹配动画的震荡波类技能。
- [x] 修复了**震荡波**神杖升级击中目标减速效果被定义为正面buff的错误，现在是负面buff。
- [x] 冷却缩减系统要修一下
- [x] 修正了多面板内的CD1和CD2显示错误的问题
- [x] 对于被打断物品的修正
- [x] 接管变身技能，不再取消无敌和无视地形状态。
- [x] 现在无视地形状态会直接使用飞行单位的寻路。
- [x] 双击对己施法系统重写了
- [x] 完善射程增加类
- [ ] 单位攻击出手事件
- [ ] 魔龙枪和大推推重构
- [ ] PlayerSettings
- [x] 重写**群星坠落**，现在神杖升级的被动会受到冷却缩减影响。并且修正了神杖升级后描述错误的问题。
- [ ] 修复一些物品购买时和实际价格不符合的情况下
    - [ ] 科勒的匕首(禁用)价格从2150修正为2250
    - [ ] 空瓶价格从650修正为700
    - [ ] 血精石卷轴价格从800修正为900

## 优化
- [ ] 修复第一次按命令按钮时调不起来的错误
    - [ ] 原生命令按钮独立出来
- [x] 现在默认指令为-sdd3s6fnabborcdusculsp
- [x] 现在错误消息统一使用原生的错误提示
- [x] 现在近战变身为远程，如果目标在射程范围并且处于攻击命令时将会直接攻击。
- [x] 重写了**波浪形态**
- [x] 优化突破极限移速的回头情况，重写以下技能
    - [ ] **嗜血渴望**
    - [ ] **幻影冲锋**
    - [ ] **变身**
- [x] 弃用了二进制属性系统，现在例如**决斗**这种技能不再会有增加攻击上限，**编织**不再会有护甲减少/增加上限。
    - [x] 决斗是自己独立的二进制属性系统，要单独改
- [x] 新的单位行为限制，无敌，沉默，无视地形，相位移动。
- [x] 更准确的判定单位隐身、无敌、沉默相关。
- [x] 删除6技能模式马甲
- [x] 暂时取消了神杖特效
- [x] 双击施法系统
- [ ] 真假眼一个格子
- [ ] 独立TP格
- [ ] 真眼假眼一次卖一组
- [ ] 视野外点击要删
- [ ] 注册物品时增加安全性检查，如果物品会有贩卖差价，则抛出错误

## 不确定可修复的
- [ ] 2个b有时候可能失效 不知道原因
- [ ] 小鱼人大招a凤凰蛋双倍，现在改了目标允许，应该不会

## 计划内但不重要的
- [ ] 接管变身
- [ ] 接管BUFF类，禁止移动和缴械类。禁止移动对一些技能也进行禁用，缴械也会对法球技能进行禁用
- [ ] 2个嗜血改一下，缩放类
- [x] 接管所有变身
- [ ] 优化对己为目标时的多重施法实现
- [ ] 猛犸D重做
- [ ] 海民W重做
- [ ] 水刀反补
- [ ] 读书偷技能考虑禁用
- [ ] 模型数据调整，建立模型的数据表
- [ ] 检查地精的贪婪bug
- [ ] 可选设置 - 选中其他人时右键地板控制自己的英雄右键地板
- [ ] 重写施法系统 现在的太屎了
- [x] 奔袭冲撞支持多次施法延续效果而不是覆盖
- [ ] 巫术精研采用新的冷却刷新策略
- [ ] 玲珑心支持充能技能，刷新球支持充能技能。
- [ ] 佣兽固定攻击力
- [ ] 彻底干死所有二进制属性系统
- [ ] 分离HeroSkill(HeroSkill, HeroSkillDefine, HeroPassiveSkill, HeroAghanimScepterUpgrade)和ItemSys(ItemSys, ItemDefine, Item合成)
- [ ] 修改AddAbility和RemoveAbility
- [ ] 锯齿飞轮神杖升级失去时自动收回
- [ ] 做个脚本可以自动输出可用id
- [ ] 工具提示显示可靠金钱和不可靠金钱
- [ ] 适配共享信使的净资产显示
- [ ] 肉山免疫烈焰破击的强制位移
- [ ] 肉山的不可攻击区域修正，以防止蜘蛛网单位卡射程
- [ ] 近战单位在攻击眼时，射程增加100