
#define DETarget DamageEvent.Target[DamageEvent.INDEX]
#define DESource DamageEvent.Source[DamageEvent.INDEX]
#define DEDamage DamageEvent.EventDamage[DamageEvent.INDEX]
#define DEOwner  DamageEvent.Owner[DamageEvent.INDEX]

globals
	location ScourgeMidMeleeSpawnLocatio   = null
	location ScourgeTopMeleeSpawnLocatio   = null
	location ScourgeBotMeleeSpawnLocatio   = null
	location ScourgeBotRangedSpawnLocatio  = null
	location ScourgeMidRangedSpawnLocatio  = null
	location ScourgeTopRangedSpawnLocatio  = null
	location SentinelMidMeleeSpawnLocatio  = null
	location SentinelBotMeleeSpawnLocatio  = null
	location SentinelTopMeleeSpawnLocatio  = null
	location SentinelMidRangedSpawnLocatio = null
	location SentinelBotRangedSpawnLocatio = null
	location SentinelTopRangedSpawnLocatio = null
endglobals

globals
	constant real MAX_UNIT_COLLISION = 197.
	group			TempGroup = CreateGroup()
	boolean			IsReplayMode	= false
	// Japi常量

	player  LocalPlayer = null
	integer LocalPlayerId

	// 模型路径
	constant integer UNIT_STRING_MODEL_PATH = 13
	// 大头像模型路径
	constant integer UNIT_STRING_MODEL_PORTRAIT_PATH = 14
	// 模型缩放
	constant integer UNIT_REAL_MODEL_SCALE = 0x2c

	// abilitys
	constant integer ABILITY_DATA_TARGS             = 100 // integer
	constant integer ABILITY_DATA_CAST              = 101 // real
	constant integer ABILITY_DATA_DUR               = 102 // real
	constant integer ABILITY_DATA_HERODUR           = 103 // real
	constant integer ABILITY_DATA_COST              = 104 // integer
	constant integer ABILITY_DATA_COOL              = 105 // real
	constant integer ABILITY_DATA_AREA              = 106 // real
	constant integer ABILITY_DATA_RNG               = 107 // real
	constant integer ABILITY_DATA_DATA_A            = 108 // real
	constant integer ABILITY_DATA_DATA_B            = 109 // real
	constant integer ABILITY_DATA_DATA_C            = 110 // real
	constant integer ABILITY_DATA_DATA_D            = 111 // real
	constant integer ABILITY_DATA_DATA_E            = 112 // real
	constant integer ABILITY_DATA_DATA_F            = 113 // real
	constant integer ABILITY_DATA_DATA_G            = 114 // real
	constant integer ABILITY_DATA_DATA_H            = 115 // real
	constant integer ABILITY_DATA_DATA_I            = 116 // real
	constant integer ABILITY_DATA_UNITID            = 117 // integer

	constant integer ABILITY_DATA_HOTKEY = 200 // integer
    constant integer ABILITY_DATA_UNHOTKEY = 201 // integer
    constant integer ABILITY_DATA_RESEARCH_HOTKEY = 202 // integer
    constant integer ABILITY_DATA_RESEARCH_TIP      = 214 // string
    constant integer ABILITY_DATA_TIP = 215 // string

	// 单位常量
	constant unitstate UNIT_STATE_TYPE = ConvertUnitState(0x61)	//作为目标类型
	// 全伤害范围
	constant unitstate UNIT_STATE_ATTACK1_RANGE = ConvertUnitState(0x16)
	// 单位护甲
	constant unitstate UNIT_STATE_ARMOR = ConvertUnitState(0x20)
	// 基础伤害
	constant unitstate UNIT_STATE_ATTACK1_DAMAGE_BASE = ConvertUnitState(0x12)
	// 额外伤害
	constant unitstate UNIT_STATE_ATTACK1_DAMAGE_BONUS = ConvertUnitState(0x13)

 	// movetype EXSetUnitMoveType
	constant integer MOVE_TYPE_UNKNOWN               = 0x20 // 未知
	constant integer MOVE_TYPE_FOOT                  = 0x02 // 步行
	constant integer MOVE_TYPE_FLY                   = 0x04 // 飞行
	constant integer MOVE_TYPE_MINES			     = 0x08 // 地雷 
	constant integer MOVE_TYPE_WINDWALK				 = 0x10	// 疾风步

	//constant integer MOVE_TYPE_HORSE                 = ConvertMoveType(4)
	//constant integer MOVE_TYPE_HOVER                 = ConvertMoveType(8)
	constant integer MOVE_TYPE_FLOAT                 = 0x40	// 漂浮(水)
	constant integer MOVE_TYPE_AMPHIBIOUS            = 0x80 // 两栖
	//constant integer MOVE_TYPE_UNBUILDABLE           = ConvertMoveType(64)

	// collisiontype EXSetUnitCollisionType
	constant integer COLLISION_TYPE_UNIT			 = 1
	constant integer COLLISION_TYPE_STRUCTURE		 = 3
	// =======================================================================
	// YDWE的修正BJ
    region yd_NullTempRegion



	// =======================================================================
	// 用来类型转换的哈希表
	hashtable ConvertType = InitHashtable() 

	// =======================================================================
	//
	// UI
	integer array UIFrame__Button           //按钮
	integer array UIFrame__Text // 文本
	// 更新日志
	integer UIFrame__UpdateLog
	integer UIButton__UpdateLogOK
	// 更新内容
	string UpdateLogStr = null
	boolean UpdateLogIsShow = false

	// 当前月份
	integer CurrentMonth = 0
	// 改键
	// 改键主界面框架
	integer HotKeyEditBoxFrame = 0
	// 改键的输入框
	integer array HotKeyEditBoxs
	boolean UseChangeHotKeySystem = false
	// 改键仅限英雄
	boolean ChangeHotkeyHeroOnly = true
	// 本地命令按钮快捷键
	integer array LocalCommandButtonHotkey
	integer array LocalCommandX
	integer array LocalCommandY
	integer ChangeKeyLoopIndex
    integer LocalPlayerSelectHandle = 0

    integer UpdateCallbackCount = 0

	// 禁止刷新的技能Id
	integer array DisableRefreshCoolDownSkillId

	// 冷却
	integer array Temp__ArrayInt
	real array Temp__ArrayReal
	unit array Temp__ArrayUnit
	location Temp__Location = Location(0, 0) // 
	//Temp
	integer Temp__Int
	player Temp__Player = null
	player array Temp__ArrayPlayer

	string bj_AllString = ".................................!.#$%&'()*+,-./0123456789:;<=>.@ABCDEFGHIJKLMNOPQRSTUVWXYZ[.]^_`abcdefghijklmnopqrstuvwxyz{|}~................................................................................................................................"
	trigger yd_DamageEventTrigger = null
	string tip_string = ""
	boolexpr mu_sync_dummy_messenger = null
	boolean mu_has_init_dummy_player = false
	boolean HaveSpellLifesteal = false
	boolean HaveBear = false
	boolean HaveDisableItem = false
	// 有人选了维萨吉
	boolean HaveVisage = false
	// 有人学了回到过去
	boolean HaveBacktrack = false

	unit array Tp_Dummy

	integer array a_fx
	boolean array a_fx_b
	timer PlayerBuyback_Timer

	// 与lua交互的字符串
	string SlkType = null
	string SlkdataType = null

	// 异步哈希表
	hashtable LocalHashTable = InitHashtable()
	integer DoubleClickKey = 0
	real DoubleClickKeyTime = 0.
	// 哈希表的Key值
	constant integer KEY_USE_DOUBLECLICK_SPELL = 1

	boolean IsEnableDoubleClickSystem = false

	// 单位大头像
	integer PortraitFrame
	// 按键是否已按下
	boolean array KeyIsDown
	integer MessageAbilityOrder = 0

	// > 0 代表这个键可以双击施法
	integer array KeyCanDoubleClickSpell
	//

	// 新UI
	boolean bMenuMainPanelIsEnable = false
	boolean bMenuGameplayPanelIsEnable = false
	integer TopMsgTimerC = 1
	trigger array TopMessageTextTrg
	string array TopMessageText //顶部消息栏 用于显示一些重要信息
	boolean DownAlt = false
	integer GlyphFrame = 0
	//integer GlyphFrame_tip = 0
	//integer GlyphFrame_tip_text = 0
	multiboard BJ_Multiboard = null //按Tab键会打开的多面板 哦憋异步handle了吓尿我了啊啊啊啊啊

	integer FirstCommandBarButton
	integer ButtonInterval
	//======================================================================
	// 工具提示
	// 工具提示背景
	integer UIFrame__ToolTip
	integer UIBackDrop__ToolTip
	integer UIText__ToolTip
	// 扩展提示
	integer UIText__ToolUberTip
	
	//======================================================================
	// 任意单位受伤事件 的temp变量
	// 受伤单位的玩家
	integer DamagedEventPlayerId
	// 伤害来源的玩家的Id
	integer DamagedEventSourcePlayerId

	// 减少的伤害值
	real DamagedEventReducedDamage
	//======================================================================

	//======================================================================
	hashtable V = InitHashtable()
	unit array E
	boolean array IsAttackEffectEnabled
	timer array O
	boolean bDodgeAttack = false
	constant integer I = 10
	constant integer A = 11
	constant integer N = 12
	constant integer B = 13
	constant integer C = 14
	constant integer D = 15
	integer F = 0
	boolean G = false
	unit H = null
	boolean WTF__Status = false
	

	integer UIFrame__DebugLog = 0
	string GourpListStr = null
	integer array GroupsId
	integer GroupsDebugCount = 0
	real array Chat_times
	
	integer it_jys
	integer fakeJys
	integer array jys_count
	// 哈希表
	hashtable OtherHashTable 		 = InitHashtable()
	hashtable UnitRGBHashTable       = InitHashtable()
	hashtable SightDataHashTable     = InitHashtable()
	hashtable ObjectHashTable        = InitHashtable()
	hashtable HY 					 = InitHashtable()
	hashtable AbilityDataHashTable 	 = InitHashtable()
	hashtable PrdRandomHashTable 	 = InitHashtable()
	hashtable ItemGoldHashTable      = InitHashtable()
	hashtable PassiveAbilityCooldown = InitHashtable()
	hashtable ItemCooldownHashTable  = InitHashtable()
	hashtable ChatCommandHashTable   = InitHashtable()
	hashtable OtherHashTable2 	     = InitHashtable()
	// 额外哈希表
	hashtable ExtraHT = InitHashtable()

	// 这里的Key一般为子Key 父Key为单位的HandleId

	// 哈希表KEY 单位原生ID
	constant integer HTKEY_UNIT_ORIGIN_TYPEID = 2
	// 哈希表KEY 切换型技能
	constant integer HTKEY_SWITCHING_SKILLS = 3
	// 哈希表KEY 塔攻击范围特效 Tower attack range 
	constant integer HTKEY_TOWER_ATTACK_RANGE_EFFECT = 4
	// 哈希表KEY 拆分物品
	constant integer HTKEY_UNIT_SPLIT_ITEM0_5 = 5 // 6 7 8 9 10
	// 哈希表KEY 单位当前百分比缩放
	constant integer HTKEY_UNIT_CURRENT_PERCENT_SCALE = 11
	// 哈希表KEY 单位当前增加的缩放
	constant integer HTKEY_UNIT_CURRENT_ADDSCALE = 12
	// 哈希表KEY 嗜血术缩放
	constant integer HTKEY_SCALE_BLOODLUST_TRIGGER = 13
	// 哈希表KEY 狂猛缩放
	constant integer HTKEY_SCALE_RABID_TRIGGER = 14
	// 哈希表KEY 黑皇杖缩放 Black King Bar
	constant integer HTKEY_SCALE_BLACK_KING_BAR = 15

	// 哈希表KEY 过载 Overcharge
	constant integer HTKEY_DAMAGE_OVERCHARGE = 16

	// 哈希表KEY 潮汐使者特效 Tidebringer // handle / boolean
	constant integer HTKEY_SKILL_TIDEBRINGER = 17

	// 哈希表KEY 潮汐使者特效 Tidebringer // effect
	constant integer HTKEY_TIDEBRINGER_EFFECT = 18

	// 哈希表KEY 回光返照特效 BorrowedTime // effect
	constant integer HTKEY_HAS_BORROWEDTIME = 19

	// 哈希表KEY 否决 Locked // effect
	constant integer HTKEY_LOCKED_BUFF_TRIGGER = 120

	// 哈希表KEY UI的提示字符
	constant integer HTKEY_UI_TOOLTIP_STR = 100
	// 哈希表KEY UI的扩展提示字符
	constant integer HTKEY_UI_TOOLTIP_UBERSTR = 101

	
	// 物体数据哈希表
	hashtable ObjectData = InitHashtable()

	// 物体数据的Key一般为父Key 子Key为ObjectId

	// 哈希表KEY 技能需求等级
	constant integer OBJ_HTKEY_ABILITY_REQLEVEL = 1

	// 哈希表KEY 单位的原生缩放
	constant integer OBJ_HTKEY_UNIT_ORIGIN_SCALE = 100
	// 哈希表KEY 单位的原生射程N1
	constant integer OBJ_HTKEY_UNIT_ORIGIN_RANGEN1 = 101

	// 哈希表KEY 技能是否是物品技能
	constant integer OBJ_HTKEY_IS_ITEM_ABILITY = 110

	// 英雄重生 (实际上为物体死亡 但用条件判断了是否为重生)
	trigger HeroReincarnationTrigger = CreateTrigger()

	boolean EV = false
	integer array XV
	group OV = CreateGroup()
	group IV = CreateGroup()
	group AV = CreateGroup()
	boolean NV = true
	boolean BV = false
	boolean CV = false
	boolean DV = false
	boolean FV = true
	boolean GV = false
	real HV
	trigger KV = null
	integer GroupsAllocationCount = 0
	trigger MV = null
	boolean PV = false
	boolean QV = false
	unit SV = null
	unit TV = null
	boolean UV = true
	integer WV = 0
	// lod的Debug变量
	constant boolean LOD_DEBUGMODE = false
	rect ZV
	boolean VE = false
	boolean EE = false
	boolean BE = false
	boolean HE = false
	boolean JE = false
	real array KE
	timer TE = null
	boolean UE = false
	integer WE = 0

	sound ZE
	sound VX
	sound EX
	integer array XX
	group OX = CreateGroup()
	integer array RX
	boolean IX = false
	boolean AX = false
	// 任意单位受伤的触发器
	trigger AnyUnitDamagedTrig
	region BX = null
	region CX = null
	integer GX = 0
	region HX
	region JX
	group KX = CreateGroup()
	integer LX = 0
	boolean MX = false
	boolean PX = false
	boolean QX = false
	boolean SX = false
	boolean TX = false
	boolean UX = false
	boolean BHYZR = false

	integer EO
	rect XO
	trigger IO
	integer array AO
	unit array NO
	unit array CO
	integer array DO
	boolean array FO
	boolean array GO
	unit HO
	unit KO
	unit LO
	trigger PO
	trigger QO
	timer TO
	boolean UO = true
	integer array YO
	player ZO
	real ER
	constant integer HotKeyStringHash = StringHash("hotkey")
	unit PreloadeHero
	integer NoLimitMoveCount = 0
	unit IR
	integer array BR
	real array DisplayTextDuration
	integer array DR
	boolean array GR
	unit HR
	unit JR
	unit KR
	unit LR
	boolean PR = false
	constant integer QR = StringHash("tempest")
	integer SR =-1
	trigger TreeDestructableDeathTrig
	boolean array ZR
	integer VI
	boolean EI = false
	boolean array XI
	integer array RI
	timer II
	rect NI
	unit BI
	trigger CI
	integer array DI
	rect FI
	group GI
	integer MaxHeroSkillsNumber = 0
	boolean array JI
	integer KI
	integer LI
	integer PI
	integer QI
	integer array SI
	integer TI
	unit UI
	unit WI
	integer YI
	real ZI
	real VA
	boolean array XA
	boolean array FA
	unit GA
	real HA
	unit JA
	integer KA = 0
	real LA
	unit MA
	real QA
	integer SA
	unit TA
	unit UA
	rect WA
	rect YA
	group ZA = CreateGroup()
	group VN = CreateGroup()
	unit EN = null
	real XN
	real ON
	group RN
	boolean array IN
	sound AN
	real BN
	real CN
	boolean DN = false
	integer GN = 0
	real array HN
	real array JN
	boolean KN
	real LN = 999999
	unit MN = null
	unit QN = null
	integer SN = 0
	integer TN = 0
	unit UN
	boolean WN = false
	real CUSTOM_MOVE_TIME_OUT = .015
	unit array VB
	real Local__TextTagzOffset = .0
	unit XB
	boolean OB = false
	integer array RB
	integer IB = 0
	constant integer CB = 10
	constant integer DB = 11
	constant integer FB = 12
	constant integer GB = 13
	constant integer HB = 14
	constant integer JB = 15
	boolean IsSinglePlayerMode = false
	group LB
	boolean IsNotUpgraded = true
	integer array PB
	constant integer QB = 1325
	unit SB = null
	integer WB
	boolean YB = false
	integer array CreepsLastCreatedIndex
	integer array VC
	integer array EC
	constant integer IC = StringHash("color")
	constant integer CC = StringHash("bounty_lowest")
	constant integer DC = StringHash("bounty_highest")
	constant integer SightHash = StringHash("sight")
	constant integer NightSightHash = StringHash("nsight")
	constant integer HC = StringHash("expirience")
	real MC
	integer PC = 5
	integer TC
	integer TempInt
	timer ZC = CreateTimer()
	boolean array XD
	integer AD = 0
	integer array PassiveSkills_Real
	integer array PassiveSkills_SpellBook
	integer array PassiveSkills_Learned
	integer array PassiveSkills_Buff
	integer array PassiveSkills_Show
	integer array PassiveSkills_illusion
	integer PassiveAbilityMaxCount = 0
	integer array AghanimUpgradeChangeId
	integer array AghanimUpgradeNormalId
	integer array AghanimUpgradeUpgradeId
	integer array AghanimUpgradeUnknownId
	integer AghanimUpgradeMaxIndex = 1
	real PF
	unit QF
	integer array TF
	boolean array UF
	group YF = CreateGroup()
	unit VG = null
	player EG = null
	integer XG
	boolean OG = false
	unit RG
	unit IG
	integer BG
	integer array CG
	unit DG
	trigger FG
	unit GG
	group HG
	unit PG
	unit UG
	unit WG
	unit YG
	unit ZG
	trigger VH
	integer EH
	integer XH
	unit RH
	group NH
	real BH
	real CH
	integer DH
	boolean FH
	integer GH
	real HH
	group KH
	unit LH
	unit MH
	unit PH
	unit QH
	unit TH
	unit UH
	unit WH
	unit YH
	boolean array SPCDB
	group ZH
	integer VJ
	integer XJ
	real OJ
	real NJ
	trigger UnitEventMainTrig = CreateTrigger()

	constant integer MJ = 12
	constant integer PJ = 10
	constant integer QJ = 10
	constant integer SJ = 12


	integer array XK
	boolean OK = false

	group IK = null
	group AK = CreateGroup()
	group BK = CreateGroup()
	integer array CK
	boolean FK = true
	boolean HK = false
	trigger QK
	unit TK = null
	integer UK
	unit ZK = null
	integer VL
	// 玩家的英雄类型
	integer array PlayerHeroTypeId
	boolean array RL
	unit IL
	unit AL
	unit NL
	real CL
	unit DL = null
	group FL = null
	integer GL ='w'
	integer HL = 6
	integer JL = 90
	integer KL = 150
	integer LL = 150
	integer ML = 240
	constant integer QL = StringHash("essenceshift")
	integer TL = 25
	// 显示伤害值
	boolean array EnableMapSetup__ShowDamageTextTag
	integer array ZL
	boolean array RM
	boolean SM = false
	string TM = "		"
	boolean IsPickingHero = true
	// 主要模式名
	string MainModeName = ""
	string EP
	integer array XP
	integer OP = 1000
	integer ExtraSkillsNumber = 0
	integer array IP
	integer BP = 0
	boolean array DP
	boolean array FP
	boolean GP = false
	multiboard JP = null
	unit array KP
	boolean array LP
	integer array MP
	integer array PP
	integer array QP
	string array HeroSkillsIcon
	integer array PlayerSkillIndex
	integer array HeroCommonSkills
	integer array HeroUpgradeSkills
	integer array HeroChangeAbilitySkills
	string array NoBalanceOffTips
	string array NoRearmCombosTips
	string array ZTP
	boolean array IsPassiveSkill
	boolean array IsMultiIconSkill
	boolean array IsNoDeathMatchSkill
	boolean array IsDisabledSkill

	integer array PlayerKillHerosCount
	integer array PlayerHeroDeathCount
	integer array PlayerCreepLastHitCount
	integer array PlayerCreepDenyCount
	integer array PlayerNeutralCreepDenyCount
	integer array PlayerAssistCount
	integer array PlayerConsumablesCount
	integer array PlayerWardCount
	integer array PlayerHeroDeathLossGold
	integer array PlayerMaxSuccessionKillCount
	integer array PlayerDoubleKillCount
	integer array PlayerTripleKillCount
	integer array PlayerDeathTime
	integer array PlayerKillHeroBonus
	integer array SQ
	real array TQ
	timer GameTimer = null
	real PickModeElapsed = 0
	boolean array YQ
	boolean array ZQ
	integer array XS
	integer array IS
	integer array FS
	boolean GS = false
	string array PlayersColoerText
	boolean array KS
	timer array MS
	timer array PS
	integer QS = 0
	integer TS = 0

	// 用于死亡竞赛 队伍用的生命值
	integer array TeamHeroUseLivesCount
	integer array TeamHeroKillsCount
	boolean Mode__DeathMatch = false
	// 死亡竞赛 最大生命数
	integer DeathMatch__MaxLives 

	boolean YS = false
	boolean VT = false
	boolean ET = false
	integer XT = 14
	boolean OT = false
	boolean RT = false
	boolean IT = false
	boolean Mode__AntiHack = false
	multiboard MainMultiboard = null
	unit Roshan = null
	boolean array FT
	integer GT = 150
	boolean Mode__HolyShitLimit = false
	boolean Mode__EasyMode = false
	boolean JT = false
	boolean KT = false
	location AttackToScourgeLocation = null
	location AttackToSentinelLocation = null
	location AttackToMidLocation   = null
	location AttackToTopLocation  = null
	location AttackToBotLocation = null
	boolean IsSentinelTopRangedRaxAlive = true
	boolean IsSentinelMidRangedRaxAlive = true
	boolean IsSentinelBotRangedRaxAlive = true
	boolean IsSentinelTopMeleeRaxAlive = true
	boolean IsSentinelMidMeleeRaxAlive = true
	boolean IsSentinelBotMeleeRaxAlive = true
	boolean IsScourgeTopRangedRaxAlive = true
	boolean IsScourgeMidRangedRaxAlive = true
	boolean IsScourgeBotRangedRaxAlive = true
	boolean IsScourgeTopMeleeRaxAlive = true
	boolean IsScourgeMidMeleeRaxAlive = true
	boolean IsScourgeBotMeleeRaxAlive = true
	integer SpawnMeleeCreepNumber  = 3
	integer SpawnRangedCreepNumber = 1
	location LeftTopRuneLocatio     = null
	location RightBottomRuneLocatio = null
	unit array Player__Hero
	integer IM1 = 0
	integer N1 = 0
	player array SentinelUsers
	player array ScourgeUsers

	unit array OW
	// 用于死亡竞赛 玩家的复活次数
	integer array PlayerHeroReincarnCount
	force SentinelForce = null
	force ScourgeForce  = null
	// 近卫
	player array SentinelPlayers
	// 天灾
	player array ScourgePlayers
	
	player NeutralCreepPlayer = null
	constant player NEUTRAL_PASSIVE_PLAYER = Player(15)
	boolean DW = false
	integer VO = 0
	integer array WO

	// 主机
	player HostPlayer = null
	unit GW = null
	integer HW = 0
	real JW = 0
	location array CreepNextWaypoint
	group LW = null
	boolean IsGameHaveObserver = false
	boolean PW = false
	boolean QW = false
	boolean SW = false
	boolean TW = false
	string UW = ""
	// 相同英雄
	boolean Mode__SameHero = false
	boolean YW = true
	player ZW = null
	integer array VY
	integer EY = 0
	force AllPlayerForce = null
	boolean IsGameEnd = false
	boolean RY = true
	boolean IY = true
	boolean array AY
	string NY = ""
	boolean array G3
	boolean Z3 = false
	string array PlayerOnlineStateString

	rect gg_rct_SentinelRevivalPoint   = null
	rect gg_rct_ScourgeRevivalPoint    = null
	
	rect gg_rct_RightBottomRune = null
	rect gg_rct_ScourgeBuyArea  = null
	rect gg_rct_SentinelBuyArea = null
	rect gg_rct_LeftTopRune = null
	rect gg_rct_ScourgeAncientCenter  = null
	rect gg_rct_SentinelAncientCenter = null
	rect gg_rct_SentinelNeutralCreepCenter3 = null
	rect gg_rct_ScourgeNeutralCreepCenter5 = null
	rect gg_rct_ScourgeNeutralCreepCenter4 = null
	rect gg_rct_SentinelNeutralCreepCenter4 = null
	rect gg_rct_ScourgeNeutralCreepCenter3 = null
	rect gg_rct_SentinelNeutralCreepCenter5 = null
	rect gg_rct_ScourgeNeutralCreepCenter1 = null
	rect gg_rct_SentinelNeutralCreepCenter2 = null
	rect gg_rct_SentinelTavernCamera = null
	rect gg_rct_ScourgeTavernCamera = null
	rect gg_rct_RoshanSpawn 	 = null // gg_rct_RoshanSpawn
	rect gg_rct_ScourgeAncientRange  = null
	rect gg_rct_SentinelAncientRange = null
	rect gg_rct_SentinelNeutralCreepRange3 = null
	rect gg_rct_ScourgeNeutralCreepRange5 = null
	rect gg_rct_ScourgeNeutralCreepRange4 = null
	rect gg_rct_SentinelNeutralCreepRange4 = null
	rect gg_rct_ScourgeNeutralCreepRange3 = null
	rect gg_rct_ScourgeNeutralCreepRange1 = null
	rect gg_rct_SentinelNeutralCreepRange5 = null
	rect gg_rct_SentinelNeutralCreepRange2 = null
	rect gg_rct_SentinelFountainOfLifeRange = null
	rect gg_rct_ScourgeFountainOfLifeRange = null
	rect gg_rct_ScourgeNeutralCreepRange2 = null
	rect gg_rct_ScourgeNeutralCreepCenter2 = null
	rect gg_rct_SentinelNeutralCreepRange1 = null
	rect gg_rct_SentinelNeutralCreepCenter1 = null
	rect gg_rct_DummyBirthPoint = null

	boolean ShouSiJuHuaB = true
	boolean JUHUABIEPAOB = true
	boolean SHUIZAODEZHUAB = true
	boolean WEIGOUCHILEB = true
	sound WEIGOUCHILE = null
	sound SHUIZAODEZHUA = null
	sound JUHUABIEPAO = null
	sound ShouSiJuHua = null
	sound OC = null
	sound AC = null
	sound BC = null
	sound K0 = null
	sound L0 = null
	sound M0 = null
	sound P0 = null
	sound Q0 = null
	sound S0 = null
	sound T0 = null
	sound KC = null
	sound LC = null
	sound U0 = null
	sound NC = null
	sound W0 = null
	sound Y0 = null
	sound Z0 = null
	string XC = "Sound\\Music\\mp3Music\\Human1.mp3"
	string YC = "Sound\\Music\\mp3Music\\Human2.mp3"
	string JC = "Sound\\Music\\mp3Music\\Human3.mp3"
	string QC = "Sound\\Music\\mp3Music\\NightElf1.mp3"
	string UC = "Sound\\Music\\mp3Music\\NightElf2.mp3"
	string V1 = "Sound\\Music\\mp3Music\\NightElf3.mp3"
	string BD = "Sound\\Music\\mp3Music\\Orc1.mp3"
	string DD = "Sound\\Music\\mp3Music\\Orc2.mp3"
	string ED = "Sound\\Music\\mp3Music\\Orc3.mp3"
	string FD = "Sound\\Music\\mp3Music\\BloodElfTheme.mp3"
	string GD = "Sound\\Music\\mp3Music\\DarkAgents.mp3"
	string HD = "Sound\\Music\\mp3Music\\TragicConfrontation.mp3"
	string ZD = "Sound\\Music\\mp3Music\\SadMystery.mp3"
	string VD = "Sound\\Music\\mp3Music\\IllidansTheme.mp3"
	string IE = "Sound\\Music\\mp3Music\\Undead1.mp3"
	string OE = "Sound\\Music\\mp3Music\\Undead2.mp3"
	string AE = "Sound\\Music\\mp3Music\\Undead3.mp3"
	string DF = "Sound\\Music\\mp3Music\\Tension.mp3"
	string EF = "Sound\\Music\\mp3Music\\ArthasTheme.mp3"
	string FF = "Sound\\Music\\mp3Music\\NightElfDefeat.mp3"
	string GF = "Sound\\Music\\mp3Music\\NightElfVictory.mp3"
	sound E1 = null
	sound TD = null
	sound QD = null
	sound X1 = null
	sound O1 = null
	sound CE = null
	sound DE = null
	sound R1 = null
	sound FE = null
	sound GE = null
	sound XE = null
	sound I1 = null
	sound A1 = null
	sound ME = null
	sound NE = null
	sound SE = null
	sound RE = null
	sound PE = null
	sound B1 = null
	sound QE = null
	sound IF = null
	sound OF = null
	sound AF = null
	sound BF = null
	sound ZF = null
	sound VF = null
	sound WF = null
	sound XF = null
	sound KF = null
	sound LF = null
	sound MF = null
	sound SF = null
	trigger C1 = null
	trigger D1 = null
	trigger SpawnAttackCreepTrigger = null
	trigger SentinelSuperCreepCheckTrig = null
	trigger ScourgeSuperCreepCheckTrig  = null
	trigger CreepUpgerTrig = null
	trigger PreloadNeutralCreepsTrig = null
	trigger SpawnAllCreepsTrig = null
	trigger SpawnSuperCreepsTrig = null
	trigger UpdateMainMultiboardPlayerKDATrig = null
	trigger UpdateMainMultiboardTrig = null
	trigger Y1 = null
	unit AttackToScourgeDummyUnit = null
	unit AttackToTopDummyUnit = null
	unit AttackToSentinelDummyUnit = null
	unit AttackToBotDummyUnit = null
	unit AttackToMidDummyUnit = null
	unit I2 = null
	unit A2 = null
	unit N2 = null
	unit B2 = null
	unit C2 = null
	unit F2 = null
	string G2 = ""
	destructable array JY
	destructable array KY
	destructable array LY
	integer MY = 0

	group   array GroupsList
	boolean array GroupsIsAllocated
	integer       FirstGroupHandleId
	integer       GroupsAllocationTop = 0

	trigger array QY
	real array UY
	integer IJ = 0
	boolean array M2
	real array AJ
	integer array BJ
	integer array CJ
	integer DJ = 0
	string HJ
	real ZJ
	integer P2 = 0
	sound WJ
	integer Q2 = 0
	integer Q22 = 0
	real S2
	real T2
	integer T22
	real TJ
	real RJ
	unit U2
	unit MissileHitTargetUnit
	unit Y2
	item Z2 = null
	trigger V3
	group DK
	group EK
	player E3
	boolean X3 = false
	image R3 = null
	unit VK = null
	integer WK
	boolean IsNoHeroLimit = true
	trigger FrozenThroneDeathTrig
	trigger WorldTreeDeathTrig
	region KK
	integer LK = 1
	boolean MK = false
	timer NK
	boolean A3 = false
	integer N3 = 90
	boolean B3 = false
	boolean PK = false
	string GameModeString = "No Mode"
	boolean F3 = false
	boolean J3 = false
	boolean L3 = false
	boolean BL = false
	boolean M3 = false

	integer array SL
	integer array Q3
	boolean array S3
	boolean array T3
	boolean array PlayerShowKDA
	boolean array W3
	unit IM = null
	unit AM = null
	boolean BM = false
	player FM = null
	player GM = null
	boolean array HM
	integer VM
	player WM
	trigger XM = null
	boolean YM = false
	integer JM
	integer KM
	boolean V4 = false
	trigger hChooseHeroTrigger
	boolean IsChooseHeroEnd = false
	boolean X4 = false
	integer array O4
	constant real ZN = 150
	integer array I4
	integer A4 = 0
	integer array N4
	integer array B4
	integer array C4
	integer array H4
	integer J4 = 0
	gamecache DrCache
	gamecache PlayerCache
	gamecache MetaCache
	gamecache MapIdCache
	integer array Q4
	integer array S4
	integer array T4
	trigger PN
	integer array U4
	integer array W4
	integer array Y4
	weathereffect Z4 = null
	weathereffect V5 = null
	weathereffect E5 = null
	weathereffect X5 = null
	//rect CS
	constant real HS =-7232
	constant real ZS =-7136


	
	constant real A7 = 6784
	constant real N7 = 6368
	unit array CirclesUnit
	real array CirclesX
	real array CirclesY
	player ObserverPlayer1
	player ObserverPlayer2
	string array PlayersName
	string array ObserverPlayersName
	integer array VPV
	integer array VQV
	integer array VSV
	integer array VTV
	integer array HeroListTypeId
	integer VWV
	integer VYV
	integer HeroTypeMaxCount
	integer array V_V
	integer V0V
	integer array V1V
	integer V2V
	integer array V3V
	integer V4V
	integer array RangeHeroList
	integer RangeHeroMax = 0
	integer array MeleeHeroList
	integer MeleeHeroMax = 0
	unit EVV
	unit EEV
	unit EXV
	unit EOV
	unit ERV
	unit EIV
	unit EAV
	unit ENV
	unit EBV
	unit ECV
	unit EDV
	unit EFV
	integer array EGV
	integer EHV = 0
	boolean array EJV
	integer EKV = 0
	integer ELV
	player EMV
	trigger AddGoldForIntervalTrig
	trigger EQV
	timer array ESV
	timer array ETV
	// 可靠金钱
	integer array PlayersReliableGold
	real array AssistListTime
	integer array AssistListSourcePlayerId
	integer array AssistListTargetPlayerId
	integer AssistListCurrentMaxNumber = 1
	constant real E0V = 18
	player array E1V
	unit E2V
	unit E3V
	integer E4V
	integer array PlayerExpBonus
	integer array PlayerGoldBonus
	unit E7V = null
	boolean E8V = true
	integer E9V = 1
	trigger XVV
	integer XEV = 0
	integer array XXV
	integer array XOV
	integer array XRV
	integer array XIV
	string array ItemsIconFilePath
	integer array XNV
	integer MaxItemsNumber = 0
	integer XCV
	integer XDV
	integer XFV
	integer XGV
	integer XHV
	integer XJV
	integer XKV
	integer XLV
	integer XMV
	integer it_hyzr
	integer it_fj
	integer it_mlq
	integer it_xj
	integer jz_xj
	integer Recipe_AetherLens
	integer Item_AetherLens
	integer Item_HurricanePike
	integer Recipe_HurricanePike
	integer XPV
	integer XQV
	integer XSV
	integer XTV
	integer XUV
	integer XWV
	integer XYV
	integer XZV
	integer X_V
	integer X0V
	integer X1V
	integer X2V
	integer X3V
	integer X4V
	integer X5V
	integer X6V
	integer X7V
	integer Item_IronwoodBranch
	integer X9V
	integer OVV
	integer OEV
	integer OXV
	integer OOV
	integer ORV
	integer OIV
	integer OAV
	integer ONV
	integer OBV
	integer OCV
	integer ODV
	integer OFV
	integer OGV
	integer OHV
	integer OJV
	integer OKV
	integer OLV
	integer OMV
	integer OPV
	integer OQV
	integer OSV
	integer OTV
	integer OUV
	integer OWV
	integer OYV
	integer OZV
	integer O_V
	integer O0V
	integer O1V
	integer O2V
	integer O3V
	integer O4V
	integer O5V
	integer O6V
	integer O7V
	integer O8V
	integer Item_MagicStick
	integer RVV
	integer REV
	integer RXV
	integer ROV
	integer RRV
	integer RIV
	integer RAV
	integer RNV
	integer RBV
	integer RCV
	integer Item_MoonShard
	integer RFV
	integer RGV
	integer RHV
	integer RJV
	integer RKV
	integer RLV
	integer RMV
	integer RPV
	integer RQV
	integer RSV
	integer RTV
	integer RUV
	integer RWV
	integer RYV
	integer RZV
	integer R_V
	integer R0V
	integer R1V
	integer R2V
	integer R3V
	integer R4V
	integer R5V
	integer R6V
	integer R7V
	integer R8V
	integer R9V
	integer IVV
	integer IEV
	integer IXV
	integer IOV
	integer IRV
	integer IIV
	integer IAV
	integer INV
	integer IBV
	integer ICV
	integer IDV
	integer IFV
	integer IGV
	integer IHV
	integer IJV
	integer IKV
	integer ILV
	integer IMV
	integer IPV
	integer IQV
	integer ISV
	integer ITV
	integer IUV
	integer IWV
	integer IYV
	integer IZV
	integer I_V
	integer I0V
	integer I1V
	integer Item_EulScepterOfDivinity
	integer I3V
	integer I4V
	integer I5V
	unit array I5VV
	integer I6V
	integer I7V
	integer I8V
	integer I9V
	integer AVV
	integer AEV
	integer AXV
	integer AOV
	integer ARV
	integer AIV
	integer AAV
	integer ANV
	integer ABV
	integer ACV
	integer ADV
	integer AFV
	integer AGV
	integer AHV
	integer AJV
	integer AKV
	integer ALV
	integer AMV
	integer APV
	integer AQV
	integer ASV
	integer ATV
	integer AUV
	integer AWV
	integer AYV
	integer AZV
	integer A_V
	integer A0V
	integer A1V
	integer A2V
	integer A3V
	integer A4V
	integer A5V
	integer A6V
	integer A7V
	integer A8V
	integer A9V
	integer NVV
	integer NEV
	integer NXV
	integer NOV
	integer NRV
	integer NIV
	integer NAV
	integer NNV
	integer NBV
	integer NCV
	integer NDV
	integer NFV
	integer NGV
	integer NHV
	integer NJV
	integer NKV
	integer Item_MagicWand
	integer NMV
	integer NPV
	integer NQV
	integer NSV
	integer NTV
	integer NUV
	integer NWV
	integer NYV
	integer NZV
	integer N_V
	integer N0V
	integer N1V
	integer N2V
	integer N3V
	integer N4V
	integer N5V
	integer N6V
	integer N7V
	integer N8V
	integer N9V
	integer BVV
	integer BEV
	integer BXV
	integer BOV
	integer BRV
	integer BIV
	integer BAV
	integer BNV
	integer BBV
	integer BCV
	integer BDV
	integer BFV
	integer BGV
	integer BHV
	integer BJV
	integer BKV
	integer BLV
	integer BMV
	integer BPV
	integer BQV
	integer BSV
	integer BTV
	integer BUV
	integer BWV
	integer BYV
	integer BZV
	integer B_V
	integer B0V
	integer B1V
	integer B2V
	integer B3V
	integer B4V
	integer B5V
	integer B6V
	integer B7V
	integer B8V
	integer B9V
	integer CVV
	trigger RuneRefreshTrigger
	integer CXV = 0
	integer array CombineIndex1
	integer array CombineIndex2
	integer array CombineIndex3
	integer array CombineIndex4
	integer array CombineIndex5
	integer array CombinedIndex
	integer CombineMaxIndex = 0
	integer array CDV
	integer array CFV
	integer array CGV
	integer array CHV
	integer array CJV
	integer array CKV
	integer array CLV
	player CMV
	unit CPV
	group array CPVV
	unit CQV
	boolean array CQVV
	integer CSV
	unit CTV
	integer CTVV
	trigger CUV
	integer CWV = 0
	integer HaveBlinkDaggerCount = 0
	integer CZV = 0
	integer HaveHeartofTarrasqueCount = 0
	integer HaveTranquilBootsCount = 0
	integer array C1V
	integer array C1Z
	boolean C2V = false
	trigger C3V
	unit C4V = null
	real array C5V
	player C5VV
	real array C6V
	integer array C7V
	integer array C8V
	real array C9V
	real array DVV
	player array DEV
	real array DXV
	real array DOV
	real array DRV
	integer DIV =-1
	constant real DAV = 525
	region DNV

	// BKB魔免的魔法书
	integer DBV ='A0FY'
	unit DCV
	unit DDV
	group DFV
	unit DGV
	unit DHV
	player DJV
	boolean DKV = false
	boolean DLV = false
	boolean DMV = false
	boolean array DPV
	player DQV
	boolean DSV = false
	boolean DTV = false
	boolean DUV = false
	boolean DWV = false
	boolean DYV = false
	boolean DZV = false
	boolean D_V = false
	boolean D0V = false
	integer array D1V
	integer array D2V
	integer D3V = 0
	integer SentinelUserCount = 0
	integer ScourgeUserCount = 0
	integer array D7V
	integer array D8V
	player array D9V
	integer FVV = 0
	multiboard FEV
	trigger FXV
	boolean FRV = false
	unit FIV = null
	unit FAV = null
	group FNV
	//integer FBV = 0
	//string array FCV
	integer WinnerIndex
	player FFV
	integer FGV
	integer FHV ='A0HU'
	integer FJV ='A0HX'
	trigger FKV
	region FLV
	boolean IsDisableSpawn = false
	boolean FPV = false
	boolean FQV = false
	unit array FSV
	group FTV
	unit FUV
	integer FWV
	integer FYV = 0
	integer array FZV
	boolean array F_V
	boolean array F0V
	boolean F1V = true
	boolean array F2V
	real F3V = -200
	boolean array F4V
	leaderboard array F5V
	boolean array F6V
	boolean F7V = true
	weathereffect F8V
	boolean array F9V
	boolean array NeedHideHeroNames
	// 配置选项
	boolean array IsPlayersEnableItemInfo
	boolean array IsPlayersEnableSkillInfo
	boolean GOV = true
	boolean array GRV
	string array GIV
	integer GAV = 0
	string GNV = "Sound\\Music\\mp3Music\\PH1.mp3"
	boolean array GBV
	integer GCV
	integer GDV
	integer GFV
	boolean GGV = false
	trigger GHV
	boolean GJV = false
	boolean GKV = false
	boolean GLV = false
	boolean GMV = false
	boolean Mode__OnlyMid = false
	boolean Mode__NotBot = false
	boolean Mode__NoMid = false
	boolean Mode__NotTop = false
	boolean GUV = false
	boolean GWV = false
	boolean GYV = false
	boolean GZV = false
	camerasetup G_V = null
	boolean G0V = false
	boolean G1V = false
	boolean Mode__AntiBackdoor = false
	boolean Mode__FiveSkills = false
	boolean Mode__SixSkills = false
	// 小模式 - 立即刷野
	boolean Mode__FastNeutrals = false
	boolean Mode__Draft20 = false
	boolean Mode__Draft30 = false
	boolean Mode__Draft40 = false
	boolean Mode__Draft50 = false
	boolean HVV = false
	// 小模式 - 关闭平衡
	boolean Mode__BalanceOff = false
	boolean Mode__RearmCombos = false
	boolean HOV = false
	boolean Mode__RandomExtraAbilities = false
	boolean HIV = false
	boolean HAV = false
	// 小模式 - 快速结束
	boolean Mode__FastFinish = false
	// 小模式 - 无野怪
	boolean Mode__NoNeutrals = false
	group HCV
	unit HDV
	integer HFV
	integer HGV = 0
	integer array HHV
	real HJV
	unit HKV
	integer HLV
	unit HMV
	integer HPV
	unit HQV
	real HSV
	unit HTV
	real HUV
	integer HWV
	integer HYV
	unit HZV
	real H_V
	unit array H0V
	integer H1V
	integer H2V
	real H3V
	unit H4V
	unit array H5V
	real H6V
	real H7V
	integer H8V
	integer H9V
	unit JVV
	real JEV
	real JXV
	real JOV
	unit JRV
	unit array MacropyreCasters
	unit JAV
	integer JNV
	unit JBV
	real JCV
	real JDV
	real JFV
	integer JGV = 0
	real JHV
	real JJV
	integer JKV
	real JLV
	unit JMV
	unit JPV
	group JQV
	group JSV
	group JTV
	unit JUV
	unit JWV
	real JYV
	integer array JZV
	unit J_V
	integer J0V
	unit J1V
	unit J2V
	real J3V
	real J4V
	real J5V
	real J6V
	boolean J7V = false
	boolean J8V = false
	unit J9V
	real KVV
	unit KEV
	unit KXV
	real KOV
	integer KRV
	unit KIV
	unit KAV
	group KNV
	integer KBV
	group KCV
	unit KDV
	real KFV
	destructable KGV = null
	unit KHV = null
	real KJV = 0
	constant real KKV = 26
	constant real KLV = 500
	real KMV
	real KPV
	group KQV
	unit KSV
	real KTV
	integer KUV
	integer KWV
	unit KYV
	unit KZV
	integer K_V
	boolean K0V = false
	unit K1V
	integer array K2V
	integer array K3V
	integer array K4V
	integer array K5V
	unit K6V
	integer K7V
	real K8V
	real K9V
	unit LVV
	boolean LEV = false
	integer LXV
	unit LOV
	
	real LIV
	real LAV
	unit LNV
	unit LBV
	unit LCV
	real LDV
	real LFV
	real LGV
	integer LHV
	real LJV
	real LKV
	unit LLV
	unit LMV
	integer LPV
	group LQV
	unit LSV
	integer LTV
	integer LUV
	player LWV
	integer LYV
	unit array LZV
	group L_V
	integer L0V
	real L1V
	unit L2V
	trigger L3V
	trigger L4V
	integer L5V = 0
	unit L6V
	real L7V
	real L8V
	real L9V
	unit MVV
	unit MEV
	unit MXV
	group MOV
	real MRV
	unit MIV
	integer MAV
	unit MNV
	integer MBV
	unit MCV
	group MDV
	integer MFV
	unit MGV
	real MHV
	unit MJV
	real MKV
	integer MLV
	unit array MMV
	unit MPV
	unit MQV
	real MSV
	unit MTV
	unit MUV
	unit MWV
	integer MYV
	unit array MZV
	boolean M_V = false
	unit M0V
	integer M1V
	real array M2V
	real array M3V
	unit array M4V
	integer array M5V
	integer array M6V
	integer M7V
	integer M8V
	unit M9V
	group PVV
	integer PEV
	unit PXV
	unit POV
	integer PRV
	unit PIV
	group PAV
	unit PNV
	real PBV
	real PCV
	real PDV
	real PFV
	constant real PGV = 325
	unit PHV
	unit PJV
	integer PKV
	real PLV
	unit PMV
	boolean PPV = false
	unit PQV
	real PSV
	unit PTV
	integer PUV
	integer PWV
	group PYV
	integer PZV
	region P_V
	region P0V
	unit P1V
	integer P2V
	group P3V
	group P4V
	unit P5V
	unit P6V
	unit P7V
	integer P8V
	real P9V
	real QVV
	unit QEV
	unit QXV
	unit QOV
	group QRV
	real QIV
	integer array QAV
	integer QNV = 0
	integer QBV
	unit QCV
	integer QDV
	integer QFV
	unit QGV
	real QHV
	real QJV
	real QKV
	unit QLV
	integer array QMV
	integer array QPV
	integer QQV
	integer QSV
	integer QTV
	sound QUV = null
	integer QWV
	integer QYV
	group QZV
	unit Q_V
	integer Q0V
	force Q1V = null
	boolean array Q3V
	trigger Q4V
	unit Q5V
	unit Q6V
	group Q7V = CreateGroup()
	boolean IsStoreGameEndChacheData = false
	
endglobals

native UnitAlive takes unit u returns boolean
// 保存值
native DzAPI_Map_SaveServerValue        takes player whichPlayer, string key, string value returns boolean
// 获取值
native DzAPI_Map_GetServerValue         takes player whichPlayer, string key returns string
native DzGetMouseTerrainX takes nothing returns real
native DzGetMouseTerrainY takes nothing returns real
native DzGetMouseTerrainZ takes nothing returns real
native DzIsMouseOverUI takes nothing returns boolean
native DzGetMouseX takes nothing returns integer
native DzGetMouseY takes nothing returns integer
native DzGetMouseXRelative takes nothing returns integer
native DzGetMouseYRelative takes nothing returns integer
native DzSetMousePos takes integer x, integer y returns nothing
native DzTriggerRegisterMouseEvent takes trigger trig, integer btn, integer status, boolean sync, string func returns nothing
native DzTriggerRegisterMouseEventByCode takes trigger trig, integer btn, integer status, boolean sync, code funcHandle returns nothing
native DzTriggerRegisterKeyEvent takes trigger trig, integer key, integer status, boolean sync, string func returns nothing
native DzTriggerRegisterKeyEventByCode takes trigger trig, integer key, integer status, boolean sync, code funcHandle returns nothing
native DzTriggerRegisterMouseWheelEvent takes trigger trig, boolean sync, string func returns nothing
native DzTriggerRegisterMouseWheelEventByCode takes trigger trig, boolean sync, code funcHandle returns nothing
native DzTriggerRegisterMouseMoveEvent takes trigger trig, boolean sync, string func returns nothing
native DzTriggerRegisterMouseMoveEventByCode takes trigger trig, boolean sync, code funcHandle returns nothing
native DzGetTriggerKey takes nothing returns integer
native DzGetWheelDelta takes nothing returns integer
native DzIsKeyDown takes integer iKey returns boolean
native DzGetTriggerKeyPlayer takes nothing returns player
native DzGetWindowWidth takes nothing returns integer
native DzGetWindowHeight takes nothing returns integer
native DzGetWindowX takes nothing returns integer
native DzGetWindowY takes nothing returns integer
native DzTriggerRegisterWindowResizeEvent takes trigger trig, boolean sync, string func returns nothing
native DzTriggerRegisterWindowResizeEventByCode takes trigger trig, boolean sync, code funcHandle returns nothing
native DzIsWindowActive takes nothing returns boolean
native DzDestructablePosition takes destructable d, real x, real y returns nothing
native DzSetUnitPosition takes unit whichUnit, real x, real y returns nothing
native DzExecuteFunc takes string funcName returns nothing
native DzGetUnitUnderMouse takes nothing returns unit
native DzSetUnitTexture takes unit whichUnit, string path, integer texId returns nothing
native DzSetMemory takes integer address, real value returns nothing
native DzSetUnitID takes unit whichUnit, integer id returns nothing
native DzSetUnitModel takes unit whichUnit, string path returns nothing
native DzSetWar3MapMap takes string map returns nothing
native DzGetLocale takes nothing returns string
native DzGetUnitNeededXP takes unit whichUnit, integer level returns integer
native DzTriggerRegisterSyncData takes trigger trig, string prefix, boolean server returns nothing
native DzSyncData takes string prefix, string data returns nothing
native DzGetTriggerSyncData takes nothing returns string
native DzGetTriggerSyncPlayer takes nothing returns player
native DzFrameHideInterface takes nothing returns nothing
native DzFrameEditBlackBorders takes real upperHeight, real bottomHeight returns nothing
native DzFrameGetPortrait takes nothing returns integer
native DzFrameGetMinimap takes nothing returns integer
native DzFrameGetCommandBarButton takes integer row, integer column returns integer
native DzFrameGetHeroBarButton takes integer buttonId returns integer
native DzFrameGetHeroHPBar takes integer buttonId returns integer
native DzFrameGetHeroManaBar takes integer buttonId returns integer
native DzFrameGetItemBarButton takes integer buttonId returns integer
native DzFrameGetMinimapButton takes integer buttonId returns integer
native DzFrameGetUpperButtonBarButton takes integer buttonId returns integer
native DzFrameGetTooltip takes nothing returns integer
native DzFrameGetChatMessage takes nothing returns integer
native DzFrameGetUnitMessage takes nothing returns integer
native DzFrameGetTopMessage takes nothing returns integer
native DzGetColor takes integer r, integer g, integer b, integer a returns integer
native DzFrameSetUpdateCallback takes string func returns nothing
native DzFrameSetUpdateCallbackByCode takes code funcHandle returns nothing
native DzFrameShow takes integer frame, boolean enable returns nothing
native DzCreateFrame takes string frame, integer parent, integer id returns integer
native DzCreateSimpleFrame takes string frame, integer parent, integer id returns integer
native DzDestroyFrame takes integer frame returns nothing
native DzLoadToc takes string fileName returns nothing
native DzFrameSetPoint takes integer frame, integer point, integer relativeFrame, integer relativePoint, real x, real y returns nothing
native DzFrameSetAbsolutePoint takes integer frame, integer point, real x, real y returns nothing
native DzFrameClearAllPoints takes integer frame returns nothing
native DzFrameSetEnable takes integer name, boolean enable returns nothing
native DzFrameSetScript takes integer frame, integer eventId, string func, boolean sync returns nothing
native DzFrameSetScriptByCode takes integer frame, integer eventId, code funcHandle, boolean sync returns nothing
native DzGetTriggerUIEventPlayer takes nothing returns player
native DzGetTriggerUIEventFrame takes nothing returns integer
native DzFrameFindByName takes string name, integer id returns integer
native DzSimpleFrameFindByName takes string name, integer id returns integer
native DzSimpleFontStringFindByName takes string name, integer id returns integer
native DzSimpleTextureFindByName takes string name, integer id returns integer
native DzGetGameUI takes nothing returns integer
native DzClickFrame takes integer frame returns nothing
native DzSetCustomFovFix takes real value returns nothing
native DzEnableWideScreen takes boolean enable returns nothing
native DzFrameSetText takes integer frame, string text returns nothing
native DzFrameGetText takes integer frame returns string
native DzFrameSetTextSizeLimit takes integer frame, integer size returns nothing
native DzFrameGetTextSizeLimit takes integer frame returns integer
native DzFrameSetTextColor takes integer frame, integer color returns nothing
native DzGetMouseFocus takes nothing returns integer
native DzFrameSetAllPoints takes integer frame, integer relativeFrame returns boolean
native DzFrameSetFocus takes integer frame, boolean enable returns boolean
native DzFrameSetModel takes integer frame, string modelFile, integer modelType, integer flag returns nothing
native DzFrameGetEnable takes integer frame returns boolean
native DzFrameSetAlpha takes integer frame, integer alpha returns nothing
native DzFrameGetAlpha takes integer frame returns integer
native DzFrameSetAnimate takes integer frame, integer animId, boolean autocast returns nothing
native DzFrameSetAnimateOffset takes integer frame, real offset returns nothing
native DzFrameSetTexture takes integer frame, string texture, integer flag returns nothing
native DzFrameSetScale takes integer frame, real scale returns nothing
native DzFrameSetTooltip takes integer frame, integer tooltip returns nothing
native DzFrameCageMouse takes integer frame, boolean enable returns nothing
native DzFrameGetValue takes integer frame returns real
native DzFrameSetMinMaxValue takes integer frame, real minValue, real maxValue returns nothing
native DzFrameSetStepValue takes integer frame, real step returns nothing
native DzFrameSetValue takes integer frame, real value returns nothing
native DzFrameSetSize takes integer frame, real w, real h returns nothing
native DzCreateFrameByTagName takes string frameType, string name, integer parent, string template, integer id returns integer
native DzFrameSetVertexColor takes integer frame, integer color returns nothing
native DzOriginalUIAutoResetPoint takes boolean enable returns nothing
native DzFrameSetPriority takes integer frame, integer priority returns nothing
native DzFrameSetParent takes integer frame, integer parent returns nothing
native DzFrameGetHeight takes integer frame returns real
native DzFrameSetFont takes integer frame, string fileName, real height, integer flag returns nothing
native DzFrameGetParent takes integer frame returns integer
native DzFrameSetTextAlignment takes integer frame, integer align returns nothing
native DzFrameGetName takes integer frame returns string

native EXGetUnitReal takes integer unitcode, integer Type returns real
native EXSetUnitReal takes integer unitcode,integer Type,real value returns boolean
native EXGetUnitString takes integer unitcode, integer Type returns string
native EXSetUnitString takes integer unitcode,integer Type,string value returns boolean
native EXGetUnitAbility takes unit u, integer abilcode returns ability
native EXGetUnitAbilityByIndex takes unit u, integer index returns ability
native EXGetAbilityId takes ability abil returns integer
native EXGetAbilityState takes ability abil, integer state_type returns real
native EXSetAbilityState takes ability abil, integer state_type, real value returns boolean
native EXGetAbilityDataReal takes ability abil, integer level, integer data_type returns real
native EXSetAbilityDataReal takes ability abil, integer level, integer data_type, real value returns boolean
native EXGetAbilityDataInteger takes ability abil, integer level, integer data_type returns integer
native EXSetAbilityDataInteger takes ability abil, integer level, integer data_type, integer value returns boolean
native EXGetAbilityDataString takes ability abil, integer level, integer data_type returns string
native EXSetAbilityDataString takes ability abil, integer level, integer data_type, string value returns boolean
native EXSetAbilityAEmeDataA takes ability abil, integer unitid returns boolean
native EXDisplayChat takes player p, integer chat_recipient, string message returns nothing
native EXGetEventDamageData takes integer edd_type returns integer
native EXSetEventDamage takes real amount returns boolean
native EXSetUnitFacing takes unit u, real angle returns nothing
native EXPauseUnit takes unit u, boolean flag returns nothing
native EXSetUnitCollisionType takes boolean enable, unit u, integer t returns nothing
native EXSetUnitMoveType takes unit u, integer t returns nothing
native EXGetItemDataString takes integer itemcode, integer data_type returns string
native EXSetItemDataString takes integer itemcode, integer data_type, string value returns boolean
native EXGetEffectX takes effect e returns real
native EXGetEffectY takes effect e returns real
native EXGetEffectZ takes effect e returns real
native EXSetEffectXY takes effect e, real x, real y returns nothing
native EXSetEffectZ takes effect e, real z returns nothing
native EXGetEffectSize takes effect e returns real
native EXSetEffectSize takes effect e, real size returns nothing
native EXEffectMatRotateX takes effect e, real angle returns nothing
native EXEffectMatRotateY takes effect e, real angle returns nothing
native EXEffectMatRotateZ takes effect e, real angle returns nothing
native EXEffectMatScale takes effect e, real x, real y, real z returns nothing
native EXEffectMatReset takes effect e returns nothing
native EXSetEffectSpeed takes effect e, real speed returns nothing
native EXExecuteScript takes string script returns string
// yd japi ==================================================================
// 技能----------------------------------------------------

#include "memory_hack\\API\\japi_dev.j"
#include "memory_hack\\memory_hack_init.j"
#include "Libraries\\include"
//#include "UI\\include"

///<summary>技能属性 [JAPI]</summary>
function YDWEGetUnitAbilityState takes unit u, integer abilcode, integer state_type returns real
	return EXGetAbilityState(EXGetUnitAbility(u, abilcode), state_type)
endfunction
///<summary>技能数据 (整数) [JAPI]</summary>
function YDWEGetUnitAbilityDataInteger takes unit u, integer abilcode, integer level, integer data_type returns integer
	return EXGetAbilityDataInteger(EXGetUnitAbility(u, abilcode), level, data_type)
endfunction
///<summary>技能数据 (实数) [JAPI]</summary>
function YDWEGetUnitAbilityDataReal takes unit u, integer abilcode, integer level, integer data_type returns real
	return EXGetAbilityDataReal(EXGetUnitAbility(u, abilcode), level, data_type)
endfunction
///<summary>技能数据 (字符串) [JAPI]</summary>
function YDWEGetUnitAbilityDataString takes unit u, integer abilcode, integer level, integer data_type returns string
	return EXGetAbilityDataString(EXGetUnitAbility(u, abilcode), level, data_type)
endfunction
///<summary>设置技能属性 [JAPI]</summary>
function YDWESetUnitAbilityState takes unit u, integer abilcode, integer state_type, real value returns boolean
	return EXSetAbilityState(EXGetUnitAbility(u, abilcode), state_type, value)
endfunction
///<summary>设置技能数据 (整数) [JAPI]</summary>
function YDWESetUnitAbilityDataInteger takes unit u, integer abilcode, integer level, integer data_type, integer value returns boolean
	return EXSetAbilityDataInteger(EXGetUnitAbility(u, abilcode), level, data_type, value)
endfunction
///<summary>设置技能数据 (实数) [JAPI]</summary>
function YDWESetUnitAbilityDataReal takes unit u, integer abilcode, integer level, integer data_type, real value returns boolean
	return EXSetAbilityDataReal(EXGetUnitAbility(u, abilcode), level, data_type, value)
endfunction
///<summary>设置技能数据 (字符串) [JAPI]</summary>
function YDWESetUnitAbilityDataString takes unit u, integer abilcode, integer level, integer data_type, string value returns boolean
	return EXSetAbilityDataString(EXGetUnitAbility(u, abilcode), level, data_type, value)
endfunction

//单位添加眩晕
function YDWEUnitAddStun takes unit u returns nothing
	call EXPauseUnit(u , true)
endfunction

//单位删除眩晕
function YDWEUnitRemoveStun takes unit u returns nothing
	call EXPauseUnit(u , false)
endfunction

//判断是否是物理伤害
function YDWEIsEventPhysicalDamage takes nothing returns boolean
	return 0 != EXGetEventDamageData(1)
endfunction
//判断是否是攻击伤害
function YDWEIsEventAttackDamage takes nothing returns boolean
	return 0 != EXGetEventDamageData(2)
endfunction

//判断是否是范围伤害
function YDWEIsEventRangedDamage takes nothing returns boolean
	return 0 != EXGetEventDamageData(3)
endfunction

//判断伤害类型
function YDWEIsEventDamageType takes damagetype damageType returns boolean
	return damageType == ConvertDamageType(EXGetEventDamageData(4))
endfunction

//判断武器类型
function YDWEIsEventWeaponType takes weapontype weaponType returns boolean
	return weaponType == ConvertWeaponType(EXGetEventDamageData(5))
endfunction

//判断攻击类型
function YDWEIsEventAttackType takes attacktype attackType returns boolean
	return attackType == ConvertAttackType(EXGetEventDamageData(6))
endfunction
//设置伤害
function YDWESetEventDamage takes real amount returns boolean
	return EXSetEventDamage(amount)
endfunction

// 物品----------------------------------------------------

///<summary>设置物品数据 (字符串) [JAPI]</summary>
function YDWESetItemDataString takes integer itemcode, integer data_type, string value returns boolean
	return EXSetItemDataString(itemcode, data_type, value)
endfunction
///<summary>获取物品数据 (字符串) [JAPI]</summary>
function YDWEGetItemDataString takes integer itemcode, integer data_type returns string
	return EXGetItemDataString(itemcode, data_type)
endfunction

function GetPlayerSelectedUnit takes nothing returns unit
	return MHPlayer_GetSelectUnit()
endfunction

// 获取玩家技能栏里的技能
function GetLocalAbilityId takes integer x, integer y returns integer
    return GetStartLocPrioSlot(x, y) // lua hook了此函数 返回的是message.button(x, y)
endfunction

// 与lua交互获得Slk数据
function GetObjectDataBySlk takes integer objectId, string tableName, string dataType returns string
    set SlkType = tableName
    set SlkdataType = dataType
    return AbilityId2String(objectId) // lua hook了此函数 调用slk库
endfunction

// 修正单位的技能 变身会导致单位非法拥有被动技能
function FixUnitSkillsBug takes unit u returns nothing
	local integer i = 1
	local integer lv
	loop
		set lv = GetUnitAbilityLevel(u, PassiveSkills_Learned[i])
		if lv == 0 and(GetUnitAbilityLevel(u, PassiveSkills_Real[i])> 0 or GetUnitAbilityLevel(u, PassiveSkills_SpellBook[i])> 0 or GetUnitAbilityLevel(u, PassiveSkills_Buff[i])> 0) then
			call UnitRemoveAbility(u, PassiveSkills_Real[i])
			call UnitRemoveAbility(u, PassiveSkills_SpellBook[i])
			call UnitRemoveAbility(u, PassiveSkills_Buff[i])
			call UnitRemoveAbility(u, PassiveSkills_Show[i])
		endif
		set i = i + 1
	exitwhen i > PassiveAbilityMaxCount
	endloop
endfunction

// 单位逆变身
function YDWEUnitTransform takes unit whichUnit, integer targetid returns nothing
	if GetUnitTypeId(whichUnit) != targetid then
		call UnitAddAbility(whichUnit, 'M000')
		call YDWESetUnitAbilityDataInteger(whichUnit, 'M000', 1, 117, GetUnitTypeId(whichUnit))
		call EXSetAbilityAEmeDataA(EXGetUnitAbility(whichUnit, 'M000'), GetUnitTypeId(whichUnit))
		call UnitRemoveAbility(whichUnit, 'M000')
		call UnitAddAbility(whichUnit, 'M000')
		call EXSetAbilityAEmeDataA(EXGetUnitAbility(whichUnit, 'M000'), targetid)
		call UnitRemoveAbility(whichUnit, 'M000')
		// 修正单位的 技能
		call FixUnitSkillsBug(whichUnit)
	endif
endfunction

// 修正过后的BJ
function YDWETriggerRegisterEnterRectSimpleNull takes trigger trig, rect r returns event
    local region rectRegion = CreateRegion()
    call RegionAddRect(rectRegion, r)
    set yd_NullTempRegion = rectRegion
    set rectRegion = null
    return TriggerRegisterEnterRegion(trig, yd_NullTempRegion, null)
endfunction

function GetRealSpellUnit takes unit u returns unit
	if GetUnitAbilityLevel(u,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(u), 0) then
		return LoadUnitHandle(HY, GetHandleId(u), 0)
	endif
	return u
endfunction

function GetEnableText takes boolean enable returns string
	if enable then
		return " |cFF00FF00已开启|r"
	else
		return " |cFFF00000已关闭|r"
	endif
	return null
endfunction

function GetSetupText takes string msg, boolean enable returns nothing
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, DisplayTextDuration[LocalPlayerId], "|CFFFF8000[设置]|R |c006699CC" + msg + GetEnableText(enable)) 
endfunction

function STV takes nothing returns nothing
	local integer id = LoadInteger(HY, GetHandleId(GetExpiredTimer()), 0)
	set IsAttackEffectEnabled[id]= false
endfunction

function EnableAttackEffectByTime takes integer i, real time returns nothing
	set IsAttackEffectEnabled[i]= true
	if time == 0 then
		return
	endif
	if O[i]== null then
		set O[i]= CreateTimer()
		call SaveInteger(HY, GetHandleId(O[i]), 0, i)
	endif
	if TimerGetRemaining(O[i])< time then
		call TimerStart(O[i], time, false, function STV)
	endif
endfunction

function SingleDebug takes string s returns nothing
	if JE then
		call BJDebugMsg(s)
	endif
endfunction


function StringPos takes string str, string sub returns integer
	local integer subLen = StringLength(sub)

	local integer start = 0
	local integer end = subLen
	local string tempStr = null
	local integer length = StringLength(str)
	loop
		exitwhen start > length
		set tempStr = SubString(str, start ,subLen)
		if tempStr == sub then
			return start
		endif
		set start = start + 1
		set subLen = subLen + 1
	endloop

	return 0
endfunction


//创建一个一次性计时器，返回值是计时器的整数地址，需要手动销毁。
function TimerStartSingle takes real timeout, code callback returns integer
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call FlushChildHashtable(HY, h)
	call TimerStart(t, timeout, false, callback)
	set t = null
	return h
endfunction

//创建一个计时器事件触发器，返回值是触发器的整数地址，需要手动销毁。注意func为触发器的条件Condition而不是动作Action。
function CreateTimerEventTrigger takes real timeout, boolean periodic, code func returns integer
    local trigger trig = CreateTrigger()
    local integer iHandleId = GetHandleId(trig)

    call TriggerAddCondition(trig, Condition( func))
    call TriggerRegisterTimerEvent(trig, timeout, periodic)

    set trig = null
    return iHandleId
endfunction

function S2V takes unit u, boolean b returns nothing
	call SaveBoolean(HY, GetHandleId(u),'CHNL', b)
endfunction
function S3V takes unit u returns boolean
	return LoadBoolean(HY, GetHandleId(u),'CHNL')
endfunction
function S4V takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call IssueImmediateOrderById(LoadUnitHandle(HY, h, 0), LoadInteger(HY, h, 0))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function S5V takes unit u, integer S6V, real S7V returns nothing
	local timer t = CreateTimer()
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveInteger(HY, GetHandleId(t), 0, S6V)
	call TimerStart(t, S7V, false, function S4V)
	set t = null
endfunction
function S8V takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call RemoveUnit(LoadUnitHandle(HY, h, 0))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function S9V takes unit u, real S7V returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, u)
	call TimerStart(t, S7V, false, function S8V)
	set t = null
endfunction
function TVV takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call UnitRemoveAbility(LoadUnitHandle(HY, h, 0), LoadInteger(HY, h, 0))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function TEV takes unit u, integer i, real S7V returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveInteger(HY, h, 0, i)
	call TimerStart(t, S7V, false, function TVV)
	set t = null
endfunction
function TXV takes string S, real TOV, real TRV, real TIV, real TAV, real TNV, boolean Show returns nothing
	set R3 = CreateImage(S, TOV, TRV, 0, TIV -(TOV / 2), TAV -(TRV / 2), TNV, 0, 0, 0, 2)
	call SetImageRenderAlways(R3, true)
	call ShowImage(R3, true)
endfunction
function RegisterUnitAttackEvent takes string s, integer level returns nothing
	local integer i = 0
	loop
	exitwhen HaveSavedString(AbilityDataHashTable,'DMGE'+ level, i) == false
		if LoadStr(AbilityDataHashTable,'DMGE'+ level, i) == s then
			return
		endif
		set i = i + 1
	endloop
	call SaveStr(AbilityDataHashTable,'DMGE'+ level, i, s)
endfunction
function TDV takes unit u returns nothing
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call UnitAddAbility(d,'A0R9')
	call IssueTargetOrderById(d, 852095, u)
	set d = null
endfunction
function TFV takes nothing returns nothing
	set UE = false
endfunction
function TGV takes real r returns nothing
	if TE == null then
		set TE = CreateTimer()
	endif
	if r > TimerGetRemaining(TE) then
		call TimerStart(TE, r, false, function TFV)
	endif
	set UE = true
endfunction
function THV takes unit d, string S6V, unit t returns boolean
	local boolean b = IssueTargetOrder(d, S6V, t)
	if b == false then
		call UnitShareVision(t, GetOwningPlayer(d), true)
		set b = IssueTargetOrder(d, S6V, t)
		call UnitShareVision(t, GetOwningPlayer(d), false)
	endif
	return b
endfunction
function SetAllPlayerAbilityUnavailable takes integer id returns nothing
	call SetPlayerAbilityAvailable(Player(1), id, false)
	call SetPlayerAbilityAvailable(Player(2), id, false)
	call SetPlayerAbilityAvailable(Player(3), id, false)
	call SetPlayerAbilityAvailable(Player(4), id, false)
	call SetPlayerAbilityAvailable(Player(5), id, false)
	call SetPlayerAbilityAvailable(Player(7), id, false)
	call SetPlayerAbilityAvailable(Player(8), id, false)
	call SetPlayerAbilityAvailable(Player(9), id, false)
	call SetPlayerAbilityAvailable(Player(10), id, false)
	call SetPlayerAbilityAvailable(Player(11), id, false)
endfunction

function TKV takes unit u, integer id, real i returns boolean
	local integer h = GetHandleId(u)
	local real TPV = R2I(i / 5.)* 5.
	local real TQV = LoadReal(PrdRandomHashTable,-1, R2I(TPV / 5.)-1)
	local real TSV = LoadReal(PrdRandomHashTable, h, id)
	if not IsUnitType(u, UNIT_TYPE_HERO) then
		return GetRandomInt(1, 100)< i	//如果不是英雄 则直接返回随机数
	endif
	if GetRandomReal(.0, 1.) < TSV + TQV then
		call SaveReal(PrdRandomHashTable, h, id, .0)
		return true
	else
		call SaveReal(PrdRandomHashTable, h, id, TSV + TQV)
		return false
	endif
endfunction


function TUV takes trigger t, string s, boolean TWV returns nothing
	call TriggerRegisterPlayerChatEvent(t, SentinelPlayers[1], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, SentinelPlayers[2], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, SentinelPlayers[3], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, SentinelPlayers[4], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, SentinelPlayers[5], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, ScourgePlayers[1], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, ScourgePlayers[2], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, ScourgePlayers[3], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, ScourgePlayers[4], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, ScourgePlayers[5], s, TWV)
endfunction

function UnitVisibleToPlayer takes unit u, player p returns boolean
	return IsUnitVisible(u, p) and(GetUnitAbilityLevel(u,'A1HX') == 0 or IsUnitAlly(u, p))
endfunction

function UnitAddPermanentAbilitySetLevel takes unit u, integer id, integer lv returns nothing
	if GetUnitAbilityLevel(u, id) == 0 then
		call UnitAddPermanentAbility(u, id)
	endif
	call SetUnitAbilityLevel(u, id, lv)
endfunction
function GetHeroWeaponAttachPointName takes unit u returns string
	local integer i = GetUnitTypeId(u)
	if i =='EC57' or i =='Hamg' or i =='E01Y' or i =='H00K' or i =='N0HP' or i =='Ucrl' then
		return "hand"
	endif
	return "weapon"
endfunction
function GetHeroFootAttachPointName takes unit u returns string
	local integer i = GetUnitTypeId(u)
	if i =='UC76' or i =='N0HP' or i =='Ulic' or i =='O016' or i =='O017' then
		return "origin"
	endif
	return "foot"
endfunction

function T4V takes unit u returns nothing
	call DestroyEffect(AddSpecialEffectTarget(GetAbilityEffectById('A3E9', EFFECT_TYPE_EFFECT, 0), u, GetAbilityEffectById('A3E9', EFFECT_TYPE_EFFECT, 1)))
endfunction
function GetPlayerChacheKey takes integer i returns string
	if i == 10 then
		return":"
	elseif i == 11 then
		return";"
	endif
	return I2S(i)
endfunction

function StorePlayerCacheData takes string missionKey, string key, integer value returns nothing
	call StoreInteger(PlayerCache, missionKey, key, value)
	call SyncStoredInteger(PlayerCache, missionKey, key)
endfunction
function StoreMetaCacheData takes string missionKey, string key, integer value returns nothing
	call StoreInteger(MetaCache, missionKey, key, value)
	call SyncStoredInteger(MetaCache, missionKey, key)
endfunction
function StoreMapIdCacheData takes string missionKey, string key, integer value returns nothing
	call StoreInteger(MapIdCache, missionKey, key, value)
	call SyncStoredInteger(MapIdCache, missionKey, key)
endfunction

function UXV takes nothing returns boolean
	local integer n = 0
	local integer i = 1
	local player p
	local boolean b = false
	loop
		set p = Player(i)
		if GetPlayerController(p) == MAP_CONTROL_USER and GetPlayerSlotState(p) == PLAYER_SLOT_STATE_PLAYING then
			set n = n + 1
		endif
		set i = i + 1
		if i == 6 then
			if (n == 0) then
				set b = true
			endif
			set i = 7
			set n = 0
		elseif i == 12 then
			if (n == 0) then
				set b = true
			endif
		endif
	exitwhen i > 11 or b
	endloop
	return b
endfunction
function GameEndStoreChacheData takes nothing returns nothing
	local integer i = 0
	local integer n = 1
	if IsStoreGameEndChacheData then
		return
	endif
	set IsStoreGameEndChacheData = true
	loop
		call StorePlayerCacheData("a", GetPlayerChacheKey(i), PlayerKillHerosCount[n])
		call StorePlayerCacheData("b", GetPlayerChacheKey(i), PlayerHeroDeathCount[n])
		call StorePlayerCacheData("c", GetPlayerChacheKey(i), PlayerAssistCount[n])
		call StorePlayerCacheData("d", GetPlayerChacheKey(i), PlayerCreepLastHitCount[n])
		call StorePlayerCacheData("e", GetPlayerChacheKey(i), PlayerCreepDenyCount[n])
		call StorePlayerCacheData("f", GetPlayerChacheKey(i), LoadInteger(HY,(400 + n), 79))
		set n = n + 1
		set i = i + 1
		if n == 6 then
			set n = 7
		endif
	exitwhen i == 10
	endloop
endfunction
function URV takes nothing returns nothing
	set FA[GetPlayerId(GetTriggerPlayer())]= true
	if UXV() then
		call GameEndStoreChacheData()
	endif
endfunction
function UIV takes nothing returns nothing
	local integer i = 1
	local trigger t = CreateTrigger()
	local player p
	loop
		set p = Player(i)
		if GetPlayerController(p) == MAP_CONTROL_USER and GetPlayerSlotState(p) == PLAYER_SLOT_STATE_PLAYING then
			call TriggerRegisterPlayerEventLeave(t, p)
		endif
		set i = i + 1
		if i == 6 then
			set i = 7
		endif
	exitwhen i == 12
	endloop
	call TriggerAddAction(t, function URV)
	set t = null
endfunction
function UAV takes nothing returns nothing
	call DisplayTextToPlayer(GetTriggerPlayer(), 0, 0, "UAV")
endfunction
function UNV takes boolean b returns string
	if b then
		return"true"
	endif
	return"false"
endfunction
function UBV takes string c returns integer
	local integer i = 0
	local string UCV = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"
	local string t
	loop
		set t = SubString(UCV, i, i + 1)
	exitwhen t == null or t == c
		set i = i + 1
	endloop
	if i < 10 then
		return i + 48
	elseif i < 36 then
		return i + 65  -10
	endif
	return i + 97 -36
endfunction
function UDV takes string s returns integer
	return((UBV(SubString(s, 0, 1))* 256 + UBV(SubString(s, 1, 2)))* 256 + UBV(SubString(s, 2, 3)))* 256 + UBV(SubString(s, 3, 4))
endfunction
function UFV takes integer i returns string
	local string UCV = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"
	if i >= 97 then
		return SubString(UCV, i -97 + 36, i -96 + 36)
	elseif i >= 65 then
		return SubString(UCV, i -65 + 10, i -64 + 10)
	endif
	return SubString(UCV, i -48, i -47)
endfunction
function UGV takes integer id returns string
	local integer t = id / 256
	local string r = UFV(id -256 * t)
	set id = t / 256
	set r = UFV(t -256 * id)+ r
	set t = id / 256
	return UFV(t)+ UFV(id -256 * t)+ r
endfunction
function PreloadQueueExpireAction takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer id
	local integer i = LoadInteger(HY, h,-1)
	local integer max = LoadInteger(HY, h, 0)
	if i < max then
		set id = LoadInteger(HY, h, i + 1)
		call UnitAddAbility(PreloadeHero, id)
		call UnitRemoveAbility(PreloadeHero, id)
		call RemoveSavedInteger(HY, h, i + 1)
		call SaveInteger(HY, h,-1, i + 1)
	else
		call PauseTimer(t)
		call SaveBoolean(HY, GetHandleId(PreloadeHero), 0, false)
		call SaveInteger(HY, h, 0, 0)
		call SaveInteger(HY, h,-1, 0)
	endif
	set t = null
endfunction
// 将技能加入预读队列 是有间隔的预读 而不是一下全读了 不然可能导致卡顿
function AddAbilityIDToPreloadQueue takes integer id returns nothing
	local integer hu = GetHandleId(PreloadeHero)
	local timer t = LoadTimerHandle(HY, hu, 0)
	local integer h = GetHandleId(t)
	local integer i
	if LoadBoolean(HY, hu, 0) then
		set i = LoadInteger(HY, h, 0)+ 1
	else
		call TimerStart(t, .1, true, function PreloadQueueExpireAction)
		call SaveBoolean(HY, hu, 0, true)
		set i = 1
	endif
	call SaveInteger(HY, h, i, id)
	call SaveInteger(HY, h, 0, i)
	set t = null
endfunction
// 直接预读技能
function PreloadAbility takes integer id returns nothing
	call UnitAddAbility(PreloadeHero, id)
	call UnitRemoveAbility(PreloadeHero, id)
endfunction
function ThrowLog takes nothing returns nothing
	local string s = ""
	local integer i = 1
	local integer k = 1
	loop
		set k = 1
		set s = s +"
		"+I2S(i)+" :"
		loop
			if HeroCommonSkills[PlayerSkillIndex[i * HL + k]]!= 0 then
				set s = s + UGV(HeroCommonSkills[PlayerSkillIndex[i * HL + k]])+ " "
			endif
			set k = k + 1
		exitwhen k > HL
		endloop
		set i = i + 1
		if i == 6 then
			set i = 7
		endif
	exitwhen i > 11
	endloop
	call PreloadEndEx()
	call PreloadGenClear()
	call PreloadGenStart()
	call Preload(s)
	if GetObjectName('TEST') == "L1ch" then
		call PreloadGenEnd("exec" + R2S(GetRandomReal(0, 5000000))+ ".txt")
	endif
	call PreloadGenClear()
endfunction
function DestroyTimerAndFlushHT_P takes timer t returns nothing
	call PauseTimer(t)
	call FlushChildHashtable(ObjectHashTable, GetHandleId(t))
	call DestroyTimer(t)
endfunction
function UPV takes unit u, string s returns nothing
	call SaveStr(OtherHashTable, GetHandleId(u),'ORDR', s)
endfunction
function UQV takes unit u returns boolean
	return LoadBoolean(OtherHashTable, GetHandleId(u),'ORDR')
endfunction
function USV takes unit u, integer UTV, real x, real y returns boolean
	local boolean b
	call SaveBoolean(OtherHashTable, GetHandleId(u),'ORDR', true)
	set b = IssuePointOrderById(u, UTV, x, y)
	call SaveBoolean(OtherHashTable, GetHandleId(u),'ORDR', false)
	return b
endfunction
function GetItemIndexEx takes item UWV returns integer
	local integer UYV
	local integer i = 1
	if UWV == null then
		return -2
	endif
	set UYV = GetItemTypeId(UWV)
	loop
		if XXV[i]== UYV or XOV[i]== UYV or XIV[i]== UYV then
			return i
		endif
		set i = i + 1
	exitwhen i > MaxItemsNumber
	endloop
	return -1
endfunction
function UZV takes unit u, integer id returns boolean
	local item it
	local boolean U_V = false
	local boolean U0V = true
	set it = CreateItem(id, GetUnitX(u), GetUnitY(u))
	if GetUnitAbilityLevel(u,'AInv') == 0 then
		set U_V = true
		call UnitAddPermanentAbility(u,'AInv')
	endif
	if UnitAddItem(u, it) == false then
		set U0V = false
	elseif GetWidgetLife(it)> 0 then
		set U0V = false
	endif
	call RemoveItem(it)
	if U_V then
		call UnitRemoveAbility(u,'AInv')
	endif
	set it = null
	return U0V
endfunction
function U1V takes unit d, integer S6V, unit u returns boolean
	local boolean b = UnitRemoveAbility(u,'B0BI')
	local boolean U2V = IssueTargetOrderById(d, S6V, u)
	if b and U2V then
		call UZV(u,'I0HM')
	endif
	return U2V
endfunction

function GetHeroMoveSpeed takes unit u returns real
	return GetUnitMoveSpeed(u)
endfunction

function WDV takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer buffId = LoadInteger(HY, WFV, 1)
	local unit u = LoadUnitHandle(HY, WFV, 0)
	call RemoveSavedHandle(HY, GetHandleId(u), buffId)
	call UnitRemoveAbility(u, LoadInteger(HY, WFV, 0))
	call UnitRemoveAbility(u, buffId)
	call FlushChildHashtable(HY, WFV)
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction
function WHV takes unit u, integer buffId returns nothing
	if GetUnitAbilityLevel(u, buffId) == 0 and(IsUnitType(u, UNIT_TYPE_STRUCTURE) and GetUnitAbilityLevel(u, LoadInteger(HY, GetHandleId(LoadTimerHandle(HY, GetHandleId(u), buffId)), 0)) == 0) then
		return
	endif
	call TimerStart(LoadTimerHandle(HY, GetHandleId(u), buffId), .0, false, function WDV)
	call UnitRemoveAbility(u, buffId)
endfunction
function UnitAddAbilityLevel1ToTimed takes unit u, integer abilId, integer buffId, real dur returns nothing
	local timer   t = null
	local integer WFV
	set FK = false
	if GetUnitAbilityLevel(u, buffId) == 0 then
		set t = CreateTimer()
	else
		set t = LoadTimerHandle(HY, GetHandleId(u), buffId)
	endif
	set WFV = GetHandleId(t)
	if HaveSavedInteger(HY, WFV, 0) and LoadInteger(HY, WFV, 0)!= abilId then
		call UnitRemoveAbility(u, LoadInteger(HY, WFV, 0))
	endif
	call SaveTimerHandle(HY, GetHandleId(u), buffId, t)
	call UnitAddPermanentAbility(u, abilId)
	set FK = true
	call SaveUnitHandle(HY, WFV, 0, u)
	call SaveInteger(HY, WFV, 0, abilId)
	call SaveInteger(HY, WFV, 1, buffId)
	if dur > 0 then
		call TimerStart(t, dur, false, function WDV)
	endif
	set t = null
endfunction
function WTB takes unit u returns boolean
	local integer unitTypeId = GetUnitTypeId(u)
	if unitTypeId =='Eevm' or unitTypeId =='E02V' or unitTypeId =='E02W' or unitTypeId =='E02U' then
		return true
	endif
	return false
endfunction

// 单位类型是否是变身单位
function UnitTypeIsMetamorphosis takes unit u returns boolean
	local integer typeId = GetUnitTypeId(u)
	set TC = 0
	if typeId =='N01J' or typeId =='N01T' or typeId =='N0HT' or typeId =='H600' or typeId =='H601' or typeId =='H602' then
		if Mode__BalanceOff then
			set TC ='ANcr'
		else
			set TC ='QB0K'
		endif
	elseif typeId =='N017' or typeId =='N02B' or typeId =='QTW2' or typeId =='QTW3' then
		set TC ='A0BE'
	elseif typeId =='N013' or typeId =='N014' or typeId =='N015' then
		set TC ='A0AG'
	elseif typeId =='H00F' or typeId =='H00E' or typeId =='H00F' then
		set TC ='QM00'
	elseif typeId =='E015' then
		set TC ='QM02'
	elseif typeId =='H06X' or typeId =='H06Y' or typeId =='H06W' then
		set TC ='QM01'
	elseif typeId =='H07I' then
		set TC ='QM03'
	elseif typeId =='O017' then
		set TC ='QM04'
	elseif typeId =='H08D' or typeId =='H08C' or typeId =='H08B' or typeId =='H084' then
		return true
	elseif typeId =='N0MA' or typeId =='N0MB' or typeId =='N0MC' or typeId =='N0MO' then
		return true
	endif
	return TC > 0
endfunction
function IsSpellingMorph takes nothing returns boolean //变身技能
	local integer id = GetSpellAbilityId()
	if id =='QM00' or id =='QM01' or id =='QB0K' or id =='QM02' or id =='QM03' or id =='QM04' or id =='A1RI' or id =='A332' then
		return true
	endif
	return false
endfunction
function WSV takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer WTV = LoadInteger(ObjectHashTable, WFV, 0)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	local integer WUV = GetUnitAbilityLevel(u, LoadInteger(ObjectHashTable, WFV, 2))
	local boolean b = UnitRemoveAbility(u, LoadInteger(ObjectHashTable, WFV, 1)) == false
	local integer WWV = GetPlayerId(GetOwningPlayer(u))
	if WTV =='A065' and HeroCommonSkills[PlayerSkillIndex[WWV * HL + 6]]=='A065' then
		set WUV = IP[GetPlayerId(GetOwningPlayer(u))* 2 + 2]
	endif
	set FK = false
	call UnitAddAbility(u, WTV)
	if GetUnitAbilityLevel(u, WTV) == 0 or b then
		if b then
			call UnitRemoveAbility(u, WTV)
			set WTV = LoadInteger(ObjectHashTable, WFV, 3)
			call UnitAddAbility(u, WTV)
		else
			set WTV = LoadInteger(ObjectHashTable, WFV, 3)
		endif
		call UnitRemoveAbility(u, LoadInteger(ObjectHashTable, WFV, 4))
		set WUV = GetUnitAbilityLevel(u, LoadInteger(ObjectHashTable, WFV, 5))
	endif
	call UnitMakeAbilityPermanent(u, true, WTV)
	call SetUnitAbilityLevel(u, WTV, WUV)
	set FK = true
	if LoadBoolean(ObjectHashTable, WFV, 0) then
		call SaveBoolean(ObjectHashTable, GetHandleId(u), WTV, LoadBoolean(ObjectHashTable, WTV, 1))
	endif
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set u = null
endfunction
function WYV takes unit u, integer WTV, integer WUV returns nothing
	local unit d = CreateUnit(Player( 14),'e00E', 0, 0, 0)
	local timer t = CreateTimer()
	local integer WFV = GetHandleId(t)
	local integer WZV = LoadInteger(ObjectHashTable, WTV, 0)
	local integer dummyUnit = LoadInteger(ObjectHashTable, WTV, 1)
	local integer W0V = GetHandleId(u)
	call SaveUnitHandle(ObjectHashTable, WFV, 0, u)
	call SaveInteger(ObjectHashTable, WFV, 0, WTV)
	call SaveInteger(ObjectHashTable, WFV, 1, WZV)
	call SaveInteger(ObjectHashTable, WFV, 2, dummyUnit)
	call SaveInteger(ObjectHashTable, WFV, 3, LoadInteger(ObjectHashTable, dummyUnit, 2))
	call SaveInteger(ObjectHashTable, WFV, 4, LoadInteger(ObjectHashTable, WTV, 2))
	call SaveInteger(ObjectHashTable, WFV, 5, LoadInteger(ObjectHashTable, WTV, 3))
	set FK = false
	call UnitRemoveAbility(u, WTV)
	call UnitAddAbility(u, WZV)
	call SetUnitAbilityLevel(u, WZV, WUV)
	call UnitMakeAbilityPermanent(u, true, WZV)
	call SaveTimerHandle(ObjectHashTable, W0V, WTV, t)
	if LoadBoolean(ObjectHashTable, WTV, 0) then
		call SaveBoolean(ObjectHashTable, WFV, 0, true)
		call SaveBoolean(ObjectHashTable, W0V, WTV, LoadBoolean(ObjectHashTable, WTV, 1) == false)
	endif
	call UnitAddAbility(u,'A04R')
	call UnitAddAbility(d,'A502')
	call IssueTargetOrderById(d, 852248, u)
	call UnitRemoveAbility(u,'A04R')
	set FK = true
	call TimerStart(t, LoadReal(ObjectHashTable, WTV, WUV), false, function WSV)
	set d = null
	set t = null
endfunction
function W1V takes unit u, integer WTV, integer WUV returns nothing
	local integer W2V = LoadInteger(ObjectHashTable, WTV, 0)
	if WUV == 1 then
		call UnitAddAbility(u, W2V)
		call UnitMakeAbilityPermanent(u, true, W2V)
		return
	endif
	call SetUnitAbilityLevel(u, W2V, WUV)
	call SetUnitAbilityLevel(u, LoadInteger(ObjectHashTable, WTV, 1), WUV)
	call SetUnitAbilityLevel(u, LoadInteger(ObjectHashTable, WTV, 2), WUV)
endfunction
function W3V takes nothing returns nothing
	call SaveBoolean(ObjectHashTable,'A065', 0, false)
	call SaveInteger(ObjectHashTable,'A065', 0,'A528')
	call SaveInteger(ObjectHashTable,'A065', 1,'A527')
	call SaveInteger(ObjectHashTable,'A527', 0,'A065')
	call SaveInteger(ObjectHashTable,'A527', 1,'A528')
	call SaveReal(ObjectHashTable,'A065', 1, 9)
	call SaveReal(ObjectHashTable,'A065', 2, 6)
	call SaveReal(ObjectHashTable,'A065', 3, 3)

endfunction

globals
	constant integer ABILITY_SPELL_EFFECT_KEY = 0
endglobals

function SetAbilitiyCastMethod takes integer abilId, string func returns nothing

endfunction

// 初始化大部分的单位技能
function InitAbilityCastMethodTable takes nothing returns nothing
	call SaveStr(ObjectHashTable,'A2NT', 0, "W5V")
	call SaveStr(ObjectHashTable,'A0ES', 0, "W6V")
	call SaveStr(ObjectHashTable,'A0MT', 0, "W7V")
	call SaveStr(ObjectHashTable,'A09D', 0, "W8V")
	call SaveStr(ObjectHashTable,'A1P8', 0, "W9V")
	call SaveStr(ObjectHashTable,'A01I', 0, "YVV")
	call SaveStr(ObjectHashTable,'A1YY', 0, "YEV")
	call SaveStr(ObjectHashTable,'A0O6', 0, "IcePathOnSpellEffect")
	call SaveStr(ObjectHashTable,'A0IL', 0, "YOV")
	call SaveStr(ObjectHashTable,'A1A8', 0, "YRV")
	call SaveStr(ObjectHashTable,'A21J', 0, "YIV")
	call SaveStr(ObjectHashTable,'A2KZ', 0, "YAV")
	call SaveStr(ObjectHashTable,'A04V', 0, "YNV")
	call SaveStr(ObjectHashTable,'A0LV', 0, "YBV")
	call SaveStr(ObjectHashTable,'A2MC', 0, "YCV")
	call SaveStr(ObjectHashTable,'A0NS', 0, "YDV")
	call SaveStr(ObjectHashTable,'A1DA', 0, "YDV")
	call SaveStr(ObjectHashTable,'A1DP', 0, "YFV")
	call SaveStr(ObjectHashTable,'A2IS', 0, "YGV")
	call SaveStr(ObjectHashTable,'A0RP', 0, "YHV")
	call SaveStr(ObjectHashTable,'A449', 0, "YHV")
	call SaveStr(ObjectHashTable,'A0RT', 0, "YJV")
	call SaveStr(ObjectHashTable,'A0RQ', 0, "YJV")
	call SaveStr(ObjectHashTable,'A2ML', 0, "YKV")
	call SaveStr(ObjectHashTable,'A2M1', 0, "YLV")
	call SaveStr(ObjectHashTable,'A2LM', 0, "YMV")
	call SaveStr(ObjectHashTable,'A2LL', 0, "YPV")
	call SaveStr(ObjectHashTable,'A332', 0, "YQV")
	call SaveStr(ObjectHashTable,'DRKN', 0, "YSV")
	call SaveStr(ObjectHashTable,'DRKU', 0, "YSV")
	call SaveStr(ObjectHashTable,'A2LA', 0, "YTV")
	call SaveStr(ObjectHashTable,'A2M0', 0, "YUV")
	call SaveStr(ObjectHashTable,'A136', 0, "YWV")
	call SaveStr(ObjectHashTable,'A11K', 0, "YYV") 
	call SaveStr(ObjectHashTable,'Z31K', 0, "YYV")
	call SaveStr(ObjectHashTable,'A1NI', 0, "YZV")
	call SaveStr(ObjectHashTable,'A0E3', 0, "Y_V")
	call SaveStr(ObjectHashTable,'AEbl', 0, "BlinkOnSpellEffect")
	call SaveStr(ObjectHashTable,'QB08', 0, "BlinkOnSpellEffect")
	call SaveStr(ObjectHashTable,'A0O1', 0, "WildAxesOnSpellEffect")
	call SaveStr(ObjectHashTable,'A0O2', 0, "Y2V")
	call SaveStr(ObjectHashTable,'A289', 0, "Y2V")
	call SaveStr(ObjectHashTable,'A13Z', 0, "Y3V")
	call SaveStr(ObjectHashTable,'A0B4', 0, "Y4V")
	call SaveStr(ObjectHashTable,'QB0D', 0, "Y4V")
	call SaveStr(ObjectHashTable,'A07A', 0, "Y5V")
	call SaveStr(ObjectHashTable,'QB09', 0, "Y5V")
	call SaveStr(ObjectHashTable,'QB0A', 0, "Y6V")
	call SaveStr(ObjectHashTable,'A0FW', 0, "Y7V")
	call SaveStr(ObjectHashTable,'A3OD', 0, "a_gangbei")
	call SaveStr(ObjectHashTable,'A0GP', 0, "SpellEffect__QuillSpray")
	call SaveStr(ObjectHashTable,'A2O6', 0, "StampedeOnSpellEffect")
	call SaveStr(ObjectHashTable,'A384', 0, "StampedeOnSpellEffect")
	call SaveStr(ObjectHashTable,'A00L', 0, "ZVV")
	call SaveStr(ObjectHashTable,'A00S', 0, "ZEV")
	call SaveStr(ObjectHashTable,'A0KM', 0, "ZXV")
	call SaveStr(ObjectHashTable,'A28T', 0, "ZOV")
	call SaveStr(ObjectHashTable,'A361', 0, "ZOV")
	call SaveStr(ObjectHashTable,'A0LT', 0, "ZRV")
	call SaveStr(ObjectHashTable,'A0DL', 0, "ZIV")
	call SaveStr(ObjectHashTable,'A1CS', 0, "ZRV")
	call SaveStr(ObjectHashTable,'A0Z6', 0, "ZAV")
	call SaveStr(ObjectHashTable,'A0Z5', 0, "ZNV")
	call SaveStr(ObjectHashTable,'A0Z8', 0, "HookshotOnSpellEffect")
	call SaveStr(ObjectHashTable,'A1CV', 0, "HookshotOnSpellEffect")
	call SaveStr(ObjectHashTable,'A0Z4', 0, "ZCV")
	call SaveStr(ObjectHashTable,'A03R', 0, "ZDV")
	call SaveStr(ObjectHashTable,'A0AV', 0, "ZDV")
	call SaveStr(ObjectHashTable,'A1E9', 0, "ZFV")
	call SaveStr(ObjectHashTable,'A14P', 0, "ZGV")
	call SaveStr(ObjectHashTable,'A14R', 0, "ElectricVortex")
	call SaveStr(ObjectHashTable,'A3WT', 0, "ElectricVortex")
	call SaveStr(ObjectHashTable,'A14O', 0, "BallLightningOnSpellEffect")
	call SaveStr(ObjectHashTable,'A3FJ', 0, "BallLightningOnSpellEffect")
	call SaveStr(ObjectHashTable,'A0AR', 0, "ZKV")
	call SaveStr(ObjectHashTable,'QB0G', 0, "ZKV")
	call SaveStr(ObjectHashTable,'A03G', 0, "ZLV")
	call SaveStr(ObjectHashTable,'QM00', 0, "ZLV")
	call SaveStr(ObjectHashTable,'A03F', 0, "BreatheFireOnSpellEffect")
	call SaveStr(ObjectHashTable,'A2QI', 0, "ZPV")
	call SaveStr(ObjectHashTable,'A2TH', 0, "ZQV")
	call SaveStr(ObjectHashTable,'A2QM', 0, "ZSV")
	call SaveStr(ObjectHashTable,'A2QT', 0, "SpellEffect__FortuneEnd")
	call SaveStr(ObjectHashTable,'A2T5', 0, "SpellEffect__FateEdict")
	call SaveStr(ObjectHashTable,'A2SG', 0, "ZWV")
	call SaveStr(ObjectHashTable,'A2TF', 0, "SpellEffect__FalsePromise")
	call SaveStr(ObjectHashTable,'QB11', 0, "SpellEffect__FalsePromise")
	call SaveStr(ObjectHashTable,'A0SK', 0, "FissureOnSpellEffect")
	call SaveStr(ObjectHashTable,'A0DH', 0, "Z_V")
	call SaveStr(ObjectHashTable,'A1OB', 0, "Z_V")
	call SaveStr(ObjectHashTable,'A01B', 0, "Z0V")
	call SaveStr(ObjectHashTable,'A0DX', 0, "Z1V")
	call SaveStr(ObjectHashTable,'A0B1', 0, "Z2V")
	call SaveStr(ObjectHashTable,'A0I7', 0, "Z3V")
	call SaveStr(ObjectHashTable,'A180', 0, "Z4V")
	call SaveStr(ObjectHashTable,'A1BX', 0, "Z5V")
	call SaveStr(ObjectHashTable,'A30L', 0, "Z5V")
	call SaveStr(ObjectHashTable,'A09W', 0, "Z6V")
	call SaveStr(ObjectHashTable,'A0SC', 0, "Z7V")
	call SaveStr(ObjectHashTable,'A1QP', 0, "Z8V")
	call SaveStr(ObjectHashTable,'A0S8', 0, "Z8V")
	call SaveStr(ObjectHashTable,'A0S9', 0, "Z9V")
	call SaveStr(ObjectHashTable,'A0SA', 0, "VVE")
	call SaveStr(ObjectHashTable,'A21E', 0, "VEE")
	call SaveStr(ObjectHashTable,'A1W8', 0, "VRE")
	call SaveStr(ObjectHashTable,'A1W9', 0, "VRE")
	call SaveStr(ObjectHashTable,'A0QR', 0, "VIE")
	call SaveStr(ObjectHashTable,'A1B3', 0, "VIE")
	call SaveStr(ObjectHashTable,'A0QP', 0, "VAE")
	call SaveStr(ObjectHashTable,'A0O5', 0, "MacropyreOnSpellEffect")
	call SaveStr(ObjectHashTable,'A30T', 0, "VCE")
	call SaveStr(ObjectHashTable,'A1B1', 0, "MacropyreOnSpellEffect")
	call SaveStr(ObjectHashTable,'ANLS', 0, "VDE")
	call SaveStr(ObjectHashTable,'A0O7', 0, "DualBreathOnSpellEffect")
	call SaveStr(ObjectHashTable,'A0M1', 0, "OmnislashOnSpellEffect")
	call SaveStr(ObjectHashTable,'A1AX', 0, "OmnislashOnSpellEffect")
	call SaveStr(ObjectHashTable,'A05G', 0, "VLE")
	call SaveStr(ObjectHashTable,'A2S8', 0, "VPE")
	call SaveStr(ObjectHashTable,'A10U', 0, "VSE")
	call SaveStr(ObjectHashTable,'A10X', 0, "SpellEffect__ManaLeak")
	call SaveStr(ObjectHashTable,'A112', 0, "V_E")
	call SaveStr(ObjectHashTable,'QM01', 0, "V0E")
	call SaveStr(ObjectHashTable,'A11X', 0, "V1E")
	call SaveStr(ObjectHashTable,'QB0E', 0, "V2E")
	call SaveStr(ObjectHashTable,'A01F', 0, "DragonSlaveOnSpellEffect")
	call SaveStr(ObjectHashTable,'A09Z', 0, "V5E")
	call SaveStr(ObjectHashTable,'A01P', 0, "V5E")
	call SaveStr(ObjectHashTable,'A054', 0, "V8E")
	call SaveStr(ObjectHashTable,'A00U', 0, "V8E")
	call SaveStr(ObjectHashTable,'A042', 0, "V9E")
	call SaveStr(ObjectHashTable,'A0KV', 0, "EVE")
	call SaveStr(ObjectHashTable,'A3UG', 0, "EVE")
	call SaveStr(ObjectHashTable,'A0KU', 0, "EEE")
	call SaveStr(ObjectHashTable,'A0LN', 0, "EXE")
	call SaveStr(ObjectHashTable,'A0L8', 0, "EOE")
	call SaveStr(ObjectHashTable,'A33U', 0, "ERE")
	call SaveStr(ObjectHashTable,'A0FN', 0, "WaveformOnSpellEffect")
	call SaveStr(ObjectHashTable,'QB02', 0, "WaveformOnSpellEffect")
	call SaveStr(ObjectHashTable,'A0G8', 0, "EAE")
	call SaveStr(ObjectHashTable,'A0GC', 0, "ENE")
	call SaveStr(ObjectHashTable,'A0G6', 0, "EBE")
	call SaveStr(ObjectHashTable,'A07U', 0, "ECE")
	call SaveStr(ObjectHashTable,'A38E', 0, "ECE")
	call SaveStr(ObjectHashTable,'A2KU', 0, "EDE")
	call SaveStr(ObjectHashTable,'A24D', 0, "EFE")
	call SaveStr(ObjectHashTable,'A08N', 0, "EGE")
	call SaveStr(ObjectHashTable,'A10D', 0, "EHE")
	call SaveStr(ObjectHashTable,'A46H', 0, "EJE")
	call SaveStr(ObjectHashTable,'QB0B', 0, "EKE")
	call SaveStr(ObjectHashTable,'A0D7', 0, "EKE")
	call SaveStr(ObjectHashTable,'A26N', 0, "ELE")
	call SaveStr(ObjectHashTable,'A14L', 0, "EME")
	call SaveStr(ObjectHashTable,'A0L3', 0, "EPE")
	call SaveStr(ObjectHashTable,'A2QC', 0, "EPE")
	call SaveStr(ObjectHashTable,'A064', 0, "EQE")
	call SaveStr(ObjectHashTable,'A0RG', 0, "ESE")
	call SaveStr(ObjectHashTable,'A0K9', 0, "ETE")
	call SaveStr(ObjectHashTable,'A063', 0, "Naga_MirrorImage") //小娜迦分身
	call SaveStr(ObjectHashTable,'A0WP', 0, "EUE")
	call SaveStr(ObjectHashTable,'A43D', 0, "EUE")
	call SaveStr(ObjectHashTable,'A190', 0, "EWE")
	call SaveStr(ObjectHashTable,'A1EG', 0, "EYE")
	call SaveStr(ObjectHashTable,'A0A5', 0, "E_E")
	call SaveStr(ObjectHashTable,'A0AG', 0, "E0E")
	call SaveStr(ObjectHashTable,'A1A1', 0, "EarthSplitterOnSpellEffect")
	call SaveStr(ObjectHashTable,'A43J', 0, "EarthSplitterOnSpellEffect")
	call SaveStr(ObjectHashTable,'A0BQ', 0, "E2E")
	call SaveStr(ObjectHashTable,'A049', 0, "E3E")
	call SaveStr(ObjectHashTable,'A33G', 0, "E3E")
	call SaveStr(ObjectHashTable,'A33F', 0, "E4E")
	call SaveStr(ObjectHashTable,'A05E', 0, "E4E")
	call SaveStr(ObjectHashTable,'A0BZ', 0, "E5E")
	call SaveStr(ObjectHashTable,'A0LL', 0, "E6E")
	call SaveStr(ObjectHashTable,'A1EJ', 0, "E7E")
	call SaveStr(ObjectHashTable,'A0BE', 0, "E8E")
	call SaveStr(ObjectHashTable,'A21M', 0, "XVE")
	call SaveStr(ObjectHashTable,'A21N', 0, "XEE")
	call SaveStr(ObjectHashTable,'A1N4', 0, "XOE")
	call SaveStr(ObjectHashTable,'QB0P', 0, "XOE")
	call SaveStr(ObjectHashTable,'A03Y', 0, "XRE")
	call SaveStr(ObjectHashTable,'A0LC', 0, "XIE")
	call SaveStr(ObjectHashTable,'A443', 0, "XIE")
	call SaveStr(ObjectHashTable,'A17O', 0, "WaveOfTerrorOnSpellEffect")
	call SaveStr(ObjectHashTable,'A0IN', 0, "XDE")
	call SaveStr(ObjectHashTable,'A1AW', 0, "XDE")
	call SaveStr(ObjectHashTable,'A1EA', 0, "XFE")
	call SaveStr(ObjectHashTable,'QB03', 0, "XFE")
	call SaveStr(ObjectHashTable,'A0RV', 0, "XGE")
	call SaveStr(ObjectHashTable,'A14I', 0, "XHE")
	call SaveStr(ObjectHashTable,'A12J', 0, "XJE")
	call SaveStr(ObjectHashTable,'A12K', 0, "XKE")
	call SaveStr(ObjectHashTable,'A12P', 0, "XLE")
	call SaveStr(ObjectHashTable,'A1D6', 0, "XLE")
	call SaveStr(ObjectHashTable,'A29G', 0, "XME")
	call SaveStr(ObjectHashTable,'A29H', 0, "XME")
	call SaveStr(ObjectHashTable,'A0JC', 0, "XPE")
	call SaveStr(ObjectHashTable,'A020', 0, "XQE")
	call SaveStr(ObjectHashTable,'A0I3', 0, "XSE")
	call SaveStr(ObjectHashTable,'A0MF', 0, "XTE")
	call SaveStr(ObjectHashTable,'A0S1', 0, "XUE")
	call SaveStr(ObjectHashTable,'A0I6', 0, "XWE")
	call SaveStr(ObjectHashTable,'A0E2', 0, "X_E")
	call SaveStr(ObjectHashTable,'A1MR', 0, "X_E")
	call SaveStr(ObjectHashTable,'A04Y', 0, "X1E")
	call SaveStr(ObjectHashTable,'A02Q', 0, "X2E")
	call SaveStr(ObjectHashTable,'A1D9', 0, "X2E")
	call SaveStr(ObjectHashTable,'A1EL', 0, "X4E")
	call SaveStr(ObjectHashTable,'A19V', 0, "X5E")
	call SaveStr(ObjectHashTable,'QM04', 0, "X7E")
	call SaveStr(ObjectHashTable,'A19O', 0, "X8E")
	call SaveStr(ObjectHashTable,'A1MV', 0, "X8E")
	call SaveStr(ObjectHashTable,'A0LH', 0, "X9E")
	call SaveStr(ObjectHashTable,'A0EC', 0, "OVE")
	call SaveStr(ObjectHashTable,'Z234', 0, "OEE")
	call SaveStr(ObjectHashTable,'A0WQ', 0, "OXE")
	call SaveStr(ObjectHashTable,'A0BH', 0, "OOE")
	call SaveStr(ObjectHashTable,'A0RW', 0, "ORE")
	call SaveStr(ObjectHashTable,'A03O', 0, "OIE")
	call SaveStr(ObjectHashTable,'A04Q', 0, "ONE")
	call SaveStr(ObjectHashTable,'A0OJ', 0, "AstralImprisonmentOnSpellEffect")
	call SaveStr(ObjectHashTable,'A0OK', 0, "OCE")
	call SaveStr(ObjectHashTable,'A1VW', 0, "OCE")
	call SaveStr(ObjectHashTable,'A0QG', 0, "ODE")
	call SaveStr(ObjectHashTable,'A0QE', 0, "OFE")
	call SaveStr(ObjectHashTable,'A0R7', 0, "OGE")
	call SaveStr(ObjectHashTable,'A21Q', 0, "OHE")
	call SaveStr(ObjectHashTable,'A0QK', 0, "OHE")
	call SaveStr(ObjectHashTable,'A15S', 0, "OJE")
	call SaveStr(ObjectHashTable,'A3JX', 0, "OJE")
	call SaveStr(ObjectHashTable,'A0R5', 0, "OKE")
	call SaveStr(ObjectHashTable,'A15V', 0, "OME")
	call SaveStr(ObjectHashTable,'QM03', 0, "OPE")
	call SaveStr(ObjectHashTable,'A0LK', 0, "TimeWalkOnSpellEffect")
	call SaveStr(ObjectHashTable,'A0J1', 0, "OSE")
	call SaveStr(ObjectHashTable,'A1D7', 0, "OSE")
	call SaveStr(ObjectHashTable,'A333', 0, "OTE")
	call SaveStr(ObjectHashTable,'Z610', 0, "DeafeningBlastOnSpellEffect")
	call SaveStr(ObjectHashTable,'A3K5', 0, "DeafeningBlastOnSpellEffect")
	call SaveStr(ObjectHashTable,'Z609', 0, "OWE")
	call SaveStr(ObjectHashTable,'Z608', 0, "OYE")
	call SaveStr(ObjectHashTable,'Z607', 0, "O_E")
	call SaveStr(ObjectHashTable,'Z606', 0, "O0E")
	call SaveStr(ObjectHashTable,'Z605', 0, "O1E")
	call SaveStr(ObjectHashTable,'Z604', 0, "O2E")
	call SaveStr(ObjectHashTable,'Z603', 0, "O4E")
	call SaveStr(ObjectHashTable,'Z602', 0, "O5E")
	call SaveStr(ObjectHashTable,'Z601', 0, "O6E")
	call SaveStr(ObjectHashTable,'A33A', 0, "O7E")
	call SaveStr(ObjectHashTable,'AHtb', 0, "O8E")
	call SaveStr(ObjectHashTable,'QB0H', 0, "O8E")
	call SaveStr(ObjectHashTable,'A2S0', 0, "O9E")
	call SaveStr(ObjectHashTable,'A0N8', 0, "RXE")
	call SaveStr(ObjectHashTable,'A0NB', 0, "RAE")
	call SaveStr(ObjectHashTable,'Z397', 0, "RNE")
	call SaveStr(ObjectHashTable,'QB0F', 0, "RNE")
	call SaveStr(ObjectHashTable,'A06V', 0, "RBE")
	call SaveStr(ObjectHashTable,'A20T', 0, "RCE")
	call SaveStr(ObjectHashTable,'A21G', 0, "RQE")
	call SaveStr(ObjectHashTable,'A21F', 0, "RQE")
	call SaveStr(ObjectHashTable,'A05T', 0, "RTE")
	call SaveStr(ObjectHashTable,'A08H', 0, "RTE")
	call SaveStr(ObjectHashTable,'A0X5', 0, "RUE")
	call SaveStr(ObjectHashTable,'A0MN', 0, "SpellEffect__Voodoo") // 妖术
	
	call SaveStr(ObjectHashTable,'A053', 0, "R_E")
	call SaveStr(ObjectHashTable,'QM02', 0, "R1E")
	call SaveStr(ObjectHashTable,'A03D', 0, "R3E")
	call SaveStr(ObjectHashTable,'A0ZF', 0, "IVE")
	call SaveStr(ObjectHashTable,'A094', 0, "IXE")
	call SaveStr(ObjectHashTable,'A10R', 0, "IOE")
	call SaveStr(ObjectHashTable,'A1OP', 0, "IRE")
	call SaveStr(ObjectHashTable,'A0A2', 0, "IAE")
	call SaveStr(ObjectHashTable,'A0MU', 0, "IBE")
	call SaveStr(ObjectHashTable,'A29L', 0, "ReversePolarityOnSpellEffect")
	call SaveStr(ObjectHashTable,'A447', 0, "ReversePolarityOnSpellEffect")
	call SaveStr(ObjectHashTable,'A037', 0, "IKE")
	call SaveStr(ObjectHashTable,'A1RD', 0, "SkewerOnSpellEffect")
	call SaveStr(ObjectHashTable,'A02S', 0, "MagnusShockWaveOnSpellEffect")
	call SaveStr(ObjectHashTable,'A3Y8', 0, "MagnusShockWaveOnSpellEffect")
	call SaveStr(ObjectHashTable,'A0G2', 0, "IPE")
	call SaveStr(ObjectHashTable,'A1C0', 0, "IQE")	//分裂箭开启
	call SaveStr(ObjectHashTable,'A418', 0, "ISE")	//分裂箭关闭
	call SaveStr(ObjectHashTable,'A1AT', 0, "SpellEffect__StoneGaze")
	call SaveStr(ObjectHashTable,'QB10', 0, "SpellEffect__StoneGaze")
	call SaveStr(ObjectHashTable,'A194', 0, "IUE")
	call SaveStr(ObjectHashTable,'A0SW', 0, "Infest")	//感染
	call SaveStr(ObjectHashTable,'A0T2', 0, "IYE")
	call SaveStr(ObjectHashTable,'A05V', 0, "IZE")
	call SaveStr(ObjectHashTable,'A067', 0, "I_E")
	call SaveStr(ObjectHashTable,'A08P', 0, "I_E")
	call SaveStr(ObjectHashTable,'A0X7', 0, "I0E")
	call SaveStr(ObjectHashTable,'A1H5', 0, "I1E")
	call SaveStr(ObjectHashTable,'A2KO', 0, "I2E")
	
	call SaveStr(ObjectHashTable,'A0FH', 0, "I3E")
	call SaveStr(ObjectHashTable,'A0F0', 0, "I3E")
	call SaveStr(ObjectHashTable,'A0EY', 0, "I3E")
	
	call SaveStr(ObjectHashTable,'A344', 0, "I4E")
	call SaveStr(ObjectHashTable,'A34C', 0, "I4E")
	call SaveStr(ObjectHashTable,'A02H', 0, "I5E")
	call SaveStr(ObjectHashTable,'A0YM', 0, "StiflingDaggerOnSpellEffect")
	call SaveStr(ObjectHashTable,'A0PL', 0, "I7E")
	call SaveStr(ObjectHashTable,'A0RA', 0, "I8E")
	call SaveStr(ObjectHashTable,'A06I', 0, "I9E")
	call SaveStr(ObjectHashTable,'A1CX', 0, "Dismember_Upgraded")
	call SaveStr(ObjectHashTable,'A0FL', 0, "Dismember")
	call SaveStr(ObjectHashTable,'A2TD', 0, "AAE")
	call SaveStr(ObjectHashTable,'A1E7', 0, "ABE")
	call SaveStr(ObjectHashTable,'A1AO', 0, "AME")
	call SaveStr(ObjectHashTable,'A1UV', 0, "AME")
	call SaveStr(ObjectHashTable,'A06O', 0, "APE")
	call SaveStr(ObjectHashTable,'A3NX', 0, "APE")
	call SaveStr(ObjectHashTable,'A0H0', 0, "AQE")
	call SaveStr(ObjectHashTable,'A05C', 0, "ASE")
	call SaveStr(ObjectHashTable,'A29K', 0, "ATE")
	call SaveStr(ObjectHashTable,'QB0I', 0, "ATE")
	call SaveStr(ObjectHashTable,'A0HW', 0, "AUE")
	call SaveStr(ObjectHashTable,'A0H9', 0, "AWE")
	call SaveStr(ObjectHashTable,'A0HA', 0, "AYE")
	call SaveStr(ObjectHashTable,'A0G4', 0, "AZE")
	call SaveStr(ObjectHashTable,'A1D8', 0, "AZE")
	call SaveStr(ObjectHashTable,'A07Q', 0, "ATB")
	call SaveStr(ObjectHashTable,'A0H4', 0, "A1E")
	call SaveStr(ObjectHashTable,'A046', 0, "GushOnSpellEffect")
	call SaveStr(ObjectHashTable,'A3OH', 0, "GushOnSpellEffect")
	
	call SaveStr(ObjectHashTable,'A29I', 0, "NNE")
	call SaveStr(ObjectHashTable,'A226', 0, "NCE")
	call SaveStr(ObjectHashTable,'A0OR', 0, "NFE")
	call SaveStr(ObjectHashTable,'A0NQ', 0, "NGE")
	call SaveStr(ObjectHashTable,'A10Q', 0, "NJE")
	call SaveStr(ObjectHashTable,'A1DB', 0, "NJE")
	call SaveStr(ObjectHashTable,'A10L', 0, "NKE")
	call SaveStr(ObjectHashTable,'A173', 0, "NLE")
	call SaveStr(ObjectHashTable,'A013', 0, "NPE")
	call SaveStr(ObjectHashTable,'A0A6', 0, "NPE")
	call SaveStr(ObjectHashTable,'A1UZ', 0, "NQE")
	call SaveStr(ObjectHashTable,'A080', 0, "NYE")
	call SaveStr(ObjectHashTable,'A08X', 0, "N_E")
	call SaveStr(ObjectHashTable,'A1NE', 0, "N0E")
	call SaveStr(ObjectHashTable,'A2IG', 0, "N0E")
	call SaveStr(ObjectHashTable,'A1NA', 0, "N1E")
	call SaveStr(ObjectHashTable,'A06P', 0, "SpellEffect__Upheaval")
	call SaveStr(ObjectHashTable,'A0J5', 0, "N3E")
	call SaveStr(ObjectHashTable,'A0AS', 0, "N5E")
	call SaveStr(ObjectHashTable,'S00U', 0, "N6E")
	call SaveStr(ObjectHashTable,'A0CT', 0, "N7E")
	call SaveStr(ObjectHashTable,'A3DM', 0, "N7E")
	call SaveStr(ObjectHashTable,'A1QW', 0, "N8E")
	call SaveStr(ObjectHashTable,'A0NM', 0, "N9E")
	call SaveStr(ObjectHashTable,'A0NE', 0, "BEE")
	call SaveStr(ObjectHashTable,'A0NO', 0, "BRE")
	call SaveStr(ObjectHashTable,'A0NT', 0, "BIE")
	call SaveStr(ObjectHashTable,'A0NX', 0, "BIE")
	call SaveStr(ObjectHashTable,'A1HS', 0, "BAE")
	call SaveStr(ObjectHashTable,'A1MG', 0, "BCE")
	call SaveStr(ObjectHashTable,'A1MI', 0, "BDE")
	call SaveStr(ObjectHashTable,'A2QE', 0, "BDE")
	call SaveStr(ObjectHashTable,'A1HQ', 0, "BFE")
	call SaveStr(ObjectHashTable,'A1IM', 0, "BJE")
	call SaveStr(ObjectHashTable,'A1IN', 0, "ShadowDanceOnSpellEffect")
	call SaveStr(ObjectHashTable,'A1J7', 0, "BLE")
	call SaveStr(ObjectHashTable,'A04A', 0, "BPE")
	call SaveStr(ObjectHashTable,'A28R', 0, "SonicWaveOnSpellEffect")
	call SaveStr(ObjectHashTable,'A28S', 0, "SonicWaveOnSpellEffect")
	call SaveStr(ObjectHashTable,'A45W', 0, "B_E")
	call SaveStr(ObjectHashTable,'A45X', 0, "B0E")
	call SaveStr(ObjectHashTable,'A3FA', 0, "B1E")
	call SaveStr(ObjectHashTable,'A00P', 0, "B3E")
	call SaveStr(ObjectHashTable,'A010', 0, "B4E")
	call SaveStr(ObjectHashTable,'A1RJ', 0, "B6E")
	call SaveStr(ObjectHashTable,'A461', 0, "B7E")
	call SaveStr(ObjectHashTable,'A1RK', 0, "CNE")
	call SaveStr(ObjectHashTable,'A43H', 0, "CNE")
	call SaveStr(ObjectHashTable,'A1YX', 0, "CFE")
	call SaveStr(ObjectHashTable,'A1S4', 0, "CGE")
	call SaveStr(ObjectHashTable,'A1S8', 0, "DisruptionOnSpellEffect")
	call SaveStr(ObjectHashTable,'A1SB', 0, "SpellEffect__SoulCatcher")
	call SaveStr(ObjectHashTable,'A343', 0, "CUE")
	call SaveStr(ObjectHashTable,'A34J', 0, "hystr_demonic_purge")
	call SaveStr(ObjectHashTable,'A1SO', 0, "C_E")
	call SaveStr(ObjectHashTable,'A1SQ', 0, "C1E")
	call SaveStr(ObjectHashTable,'A1T5', 0, "C3E")
	call SaveStr(ObjectHashTable,'A235', 0, "C3E")
	call SaveStr(ObjectHashTable,'A229', 0, "C8E")
	call SaveStr(ObjectHashTable,'A1SU', 0, "C9E")
	call SaveStr(ObjectHashTable,'A1SW', 0, "DVE")
	call SaveStr(ObjectHashTable,'A1TV', 0, "DEE")
	call SaveStr(ObjectHashTable,'A1U6', 0, "DXE")
	call SaveStr(ObjectHashTable,'A30N', 0, "DXE")
	call SaveStr(ObjectHashTable,'A2KQ', 0, "DOE")
	call SaveStr(ObjectHashTable,'A1PH', 0, "DRE")
	call SaveStr(ObjectHashTable,'A1T8', 0, "DIE")
	call SaveStr(ObjectHashTable,'A1TA', 0, "DAE")
	call SaveStr(ObjectHashTable,'A1TB', 0, "DNE")
	call SaveStr(ObjectHashTable,'A3FQ', 0, "DNE")
	call SaveStr(ObjectHashTable,'A1YO', 0, "DBE")
	call SaveStr(ObjectHashTable,'A1YQ', 0, "DCE")
	call SaveStr(ObjectHashTable,'A3DF', 0, "DDE")
	call SaveStr(ObjectHashTable,'A3DE', 0, "DCE")
	call SaveStr(ObjectHashTable,'A1S7', 0, "DFE")
	call SaveStr(ObjectHashTable,'A27F', 0, "DGE")
	call SaveStr(ObjectHashTable,'A27G', 0, "DHE")
	call SaveStr(ObjectHashTable,'A27H', 0, "DJE")
	call SaveStr(ObjectHashTable,'A30J', 0, "DJE")
	call SaveStr(ObjectHashTable,'QB06', 0, "CarrionSwarmOnSpellEffect")
	call SaveStr(ObjectHashTable,'A078', 0, "CarrionSwarmOnSpellEffect")
	call SaveStr(ObjectHashTable,'A04N', 0, "DLE")
	call SaveStr(ObjectHashTable,'A2HS', 0, "DME")
	call SaveStr(ObjectHashTable,'A2H0', 0, "SleightOfFistOnSpellEffect")
	call SaveStr(ObjectHashTable,'QB0L', 0, "SleightOfFistOnSpellEffect")
	call SaveStr(ObjectHashTable,'A2H3', 0, "DQE")
	call SaveStr(ObjectHashTable,'A2JO', 0, "DSE")
	call SaveStr(ObjectHashTable,'A2JQ', 0, "DSE")
	call SaveStr(ObjectHashTable,'A2JP', 0, "DSE")
	call SaveStr(ObjectHashTable,'A2JR', 0, "DSE")
	call SaveStr(ObjectHashTable,'A2JL', 0, "DTE")
	call SaveStr(ObjectHashTable,'A2CI', 0, "DUE")
	call SaveStr(ObjectHashTable,'A38C', 0, "DUE")
	call SaveStr(ObjectHashTable,'A2J2', 0, "DWE")
	call SaveStr(ObjectHashTable,'A2JB', 0, "DYE")
	call SaveStr(ObjectHashTable,'A2BG', 0, "DZE")
	call SaveStr(ObjectHashTable,'A30H', 0, "DZE")
	call SaveStr(ObjectHashTable,'A2BE', 0, "D_E")
	call SaveStr(ObjectHashTable,'A2HN', 0, "D0E")
	call SaveStr(ObjectHashTable,'A2IT', 0, "D1E")
	call SaveStr(ObjectHashTable,'A2FK', 0, "D2E")
	call SaveStr(ObjectHashTable,'A2E3', 0, "D3E")
	call SaveStr(ObjectHashTable,'A2E5', 0, "D4E")
	call SaveStr(ObjectHashTable,'A43Q', 0, "D4E")
	call SaveStr(ObjectHashTable,'A43S', 0, "D4E")
	call SaveStr(ObjectHashTable,'A11N', 0, "D5E")
	call SaveStr(ObjectHashTable,'A300', 0, "D6E")
	call SaveStr(ObjectHashTable,'A301', 0, "D7E")
	call SaveStr(ObjectHashTable,'A07F', 0, "D8E")
	call SaveStr(ObjectHashTable,'A0CC', 0, "D9E")
	call SaveStr(ObjectHashTable,'A02Z', 0, "D9E")
	call SaveStr(ObjectHashTable,'A32A', 0, "FVE")
	call SaveStr(ObjectHashTable,'A32C', 0, "FEE")
	call SaveStr(ObjectHashTable,'A32E', 0, "FXE")
	call SaveStr(ObjectHashTable,'A32D', 0, "FOE")
	call SaveStr(ObjectHashTable,'A32G', 0, "FRE")
	call SaveStr(ObjectHashTable,'A004', 0, "FIE")
	call SaveStr(ObjectHashTable,'A0GK', 0, "FAE")
	call SaveStr(ObjectHashTable,'A0R0', 0, "DarkRift")
	call SaveStr(ObjectHashTable,'A04C', 0, "FBE")
	call SaveStr(ObjectHashTable,'A44U', 0, "FCE")
	call SaveStr(ObjectHashTable,'A44X', 0, "FDE")
	call SaveStr(ObjectHashTable,'A44Z', 0, "FFE")
	call SaveStr(ObjectHashTable,'A451', 0, "FGE")
	call SaveStr(ObjectHashTable,'A456', 0, "FHE")
	call SaveStr(ObjectHashTable,'A454', 0, "FJE")
	call SaveStr(ObjectHashTable,'A06B', 0, "FKE")
	call SaveStr(ObjectHashTable,'A471', 0, "FKE")
	call SaveStr(ObjectHashTable,'A2LB', 0, "FLE")
	call SaveStr(ObjectHashTable,'A0Z0', 0, "FME")
	call SaveStr(ObjectHashTable,'A01Z', 0, "FPE")
	call SaveStr(ObjectHashTable,'A0CA', 0, "FQE")
	call SaveStr(ObjectHashTable,'A2N1', 0, "FSE")
	call SaveStr(ObjectHashTable,'A055', 0, "FTE")
	call SaveStr(ObjectHashTable,'A085', 0, "IlluminateOnSpellEffect")
	call SaveStr(ObjectHashTable,'A121', 0, "FWE")
	call SaveStr(ObjectHashTable,'A07Z', 0, "FYE")
	call SaveStr(ObjectHashTable,'A44S', 0, "FYE")
	call SaveStr(ObjectHashTable,'A01V', 0, "FZE")
	call SaveStr(ObjectHashTable,'A1HH', 0, "F_E")
	call SaveStr(ObjectHashTable,'QB00', 0, "FTE")
	call SaveStr(ObjectHashTable,'QB01', 0, "FQE")
	call SaveStr(ObjectHashTable,'QB04', 0, "W5V")
	call SaveStr(ObjectHashTable,'A2O2', 0, "F0E")
	call SaveStr(ObjectHashTable,'A34A', 0, "F1E")
	call SaveStr(ObjectHashTable,'A40K', 0, "F2E")
	call SaveStr(ObjectHashTable,'A40L', 0, "F2E")
	call SaveStr(ObjectHashTable,'A40M', 0, "F2E")
	call SaveStr(ObjectHashTable,'A40N', 0, "F2E")
	call SaveStr(ObjectHashTable,'A2TI', 0, "F3E")
	call SaveStr(ObjectHashTable,'A29J', 0, "RequiemOfSoulsOnSpellEffect")
	call SaveStr(ObjectHashTable,'A3OJ', 0, "RequiemOfSoulsOnSpellEffect")
	call SaveStr(ObjectHashTable,'A02A', 0, "F5E")
	call SaveStr(ObjectHashTable,'A06M', 0, "F6E")
	call SaveStr(ObjectHashTable,'A08V', 0, "F7E")
	call SaveStr(ObjectHashTable,'A1AU', 0, "F8E")
	call SaveStr(ObjectHashTable,'QB0J', 0, "F9E")
	call SaveStr(ObjectHashTable,'A04W', 0, "F9E")
	call SaveStr(ObjectHashTable,'A011', 0, "GVE")
	call SaveStr(ObjectHashTable,'A44V', 0, "GEE")
	call SaveStr(ObjectHashTable,'A46J', 0, "GXE")
	call SaveStr(ObjectHashTable,'A42I', 0, "GOE")
	call SaveStr(ObjectHashTable,'A42W', 0, "GRE")
	call SaveStr(ObjectHashTable,'A38R', 0, "GAE")
	call SaveStr(ObjectHashTable,'A38V', 0, "GNE")
	call SaveStr(ObjectHashTable,'A3BP', 0, "GBE")
	call SaveStr(ObjectHashTable,'A39K', 0, "GCE")
	call SaveStr(ObjectHashTable,'A395', 0, "GDE")
	call SaveStr(ObjectHashTable,'A39C', 0, "GFE")
	call SaveStr(ObjectHashTable,'A2K4', 0, "GGE")

	call SaveStr(ObjectHashTable,'A083', 0, "SpellEffect__Bloodlust")

	
	call SaveStr(ObjectHashTable,'A3W8', 0, "fj_trigger")
	call SaveStr(ObjectHashTable,'A3UH', 0, "jys_trigger")
	
	// 马甲的技能 或者 物品
	call SaveStr(ObjectHashTable,'A0AE', 12, "SpellEffect__Rabid")
	call SaveStr(ObjectHashTable,'A02X', 12, "GHE")
	call SaveStr(ObjectHashTable,'AIsw', 12, "GHE")
	call SaveStr(ObjectHashTable,'A0H6', 12, "GLE")
	call SaveStr(ObjectHashTable,'A0B6', 12, "GME")
	call SaveStr(ObjectHashTable,'A0JT', 12, "GPE")
	call SaveStr(ObjectHashTable,'A0OT', 12, "GQE")
	call SaveStr(ObjectHashTable,'Aeat', 12, "GSE")
	call SaveStr(ObjectHashTable,'ANTG', 12, "GSE")
	call SaveStr(ObjectHashTable,'A231', 12, "town_portal")
	call SaveStr(ObjectHashTable,'A3AG', 12, "town_portal")
	call SaveStr(ObjectHashTable,'A1R5', 12, "town_portal")
	call SaveStr(ObjectHashTable,'A0HB', 12, "GUE")
	call SaveStr(ObjectHashTable,'A0D3', 12, "GUE")
	call SaveStr(ObjectHashTable,'A0DF', 12, "GUE")
	call SaveStr(ObjectHashTable,'ACch', 12, "GWE")
	call SaveStr(ObjectHashTable,'A11F', 12, "GYE")
	call SaveStr(ObjectHashTable,'A11E', 12, "GYE")
	call SaveStr(ObjectHashTable,'A0S3', 12, "GYE")
	call SaveStr(ObjectHashTable,'A11D', 12, "GYE")
	call SaveStr(ObjectHashTable,'A11G', 12, "GYE")
	call SaveStr(ObjectHashTable,'A11H', 12, "GYE")
	call SaveStr(ObjectHashTable,'A0CK', 12, "GZE")
	call SaveStr(ObjectHashTable,'A1FP', 12, "G_E")
	call SaveStr(ObjectHashTable,'A02W', 12, "G0E")
	call SaveStr(ObjectHashTable,'A397', 12, "Item_SpellEffect_MoonShard")
	call SaveStr(ObjectHashTable,'AZSZ', 12, "Item_SpellEffect_IronwoodBranch")
	call SaveStr(ObjectHashTable,'A0FD', 12, "G1E")
	call SaveStr(ObjectHashTable,'A3TP', 12, "G1E")
	call SaveStr(ObjectHashTable,'A0JL', 12, "G2E")
	call SaveStr(ObjectHashTable,'A0T9', 12, "G3E")
	call SaveStr(ObjectHashTable,'A0VR', 12, "G4E")
	call SaveStr(ObjectHashTable,'A0JY', 12, "G5E")
	call SaveStr(ObjectHashTable,'A138', 12, "G6E")
	call SaveStr(ObjectHashTable,'A14C', 12, "G6E")
	call SaveStr(ObjectHashTable,'A14D', 12, "G7E")
	//call SaveStr(ObjectHashTable,'A35F', 12, "GameOptions")
	call SaveStr(ObjectHashTable,'AU02', 12, "MUSpellEffect")
	call SaveStr(ObjectHashTable,'A141', 12, "G8E")
	call SaveStr(ObjectHashTable,'A1WI', 12, "G8E")
	call SaveStr(ObjectHashTable,'A12W', 12, "G9E")
	call SaveStr(ObjectHashTable,'A15W', 12, "HVE")
	call SaveStr(ObjectHashTable,'A19M', 12, "Item_SpellEffect_ForceStaff")
	call SaveStr(ObjectHashTable,'A3U8', 12, "Item_SpellEffect_HurricanePike")
	call SaveStr(ObjectHashTable,'AIpg', 12, "HOE")
	call SaveStr(ObjectHashTable,'A1AC', 12, "HRE")
	call SaveStr(ObjectHashTable,'A1AS', 12, "HIE")
	call SaveStr(ObjectHashTable,'A2KS', 12, "HNE")
	call SaveStr(ObjectHashTable,'A0GD', 12, "HDE")
	call SaveStr(ObjectHashTable,'A1EW', 12, "HFE")
	call SaveStr(ObjectHashTable,'A0B8', 12, "HGE")
	call SaveStr(ObjectHashTable,'A1WE', 12, "HGE")
	call SaveStr(ObjectHashTable,'A1MO', 12, "HHE")
	call SaveStr(ObjectHashTable,'A1Q8', 12, "HJE")
	call SaveStr(ObjectHashTable,'A1QD', 12, "HKE")
	call SaveStr(ObjectHashTable,'A1T7', 12, "HME")
	call SaveStr(ObjectHashTable,'A0K7', 12, "HPE")
	call SaveStr(ObjectHashTable,'A28Y', 12, "HQE")
	call SaveStr(ObjectHashTable,'A1ZI', 12, "HSE")
	call SaveStr(ObjectHashTable,'A1ZW', 12, "HTE")
	call SaveStr(ObjectHashTable,'A206', 12, "HUE")
	call SaveStr(ObjectHashTable,'A28D', 12, "HWE")
	call SaveStr(ObjectHashTable,'A2EA', 12, "ItemRodOfAtosOnSpellEffect")
	call SaveStr(ObjectHashTable,'A2HQ', 12, "H2E")
	call SaveStr(ObjectHashTable,'A02O', 12, "H4E")
	call SaveStr(ObjectHashTable,'A08Y', 12, "H4E")
	call SaveStr(ObjectHashTable,'A08Z', 12, "H4E")
	call SaveStr(ObjectHashTable,'A090', 12, "H4E")
	call SaveStr(ObjectHashTable,'A092', 12, "H4E")
	call SaveStr(ObjectHashTable,'A3K7', 12, "H5E")
	call SaveStr(ObjectHashTable,'A2TK', 12, "H7E") //血精石
	call SaveStr(ObjectHashTable,'AItb', 12, "H8E")
	call SaveStr(ObjectHashTable,'A1FD', 12, "H9E")
	call SaveStr(ObjectHashTable,'A0JZ', 12, "JVE")
	call SaveStr(ObjectHashTable,'A2K7', 12, "AbyssalBlade_Overwhelm") // 深渊之刃
	

	call SaveStr(ObjectHashTable,'Adsm', 0, "JXE")
	call SaveStr(ObjectHashTable,'Acdh', 0, "JOE")
	call SaveStr(ObjectHashTable,'A1P8', 1, "JRE")
	call SaveStr(ObjectHashTable,'A085', 1, "JNE")
	call SaveStr(ObjectHashTable,'A2QT', 1, "JFE")
	call SaveStr(ObjectHashTable,'A1AA', 2, "JGE")	//回音重踏1
	call SaveStr(ObjectHashTable,'A2LK', 2, "JGE")
	call SaveStr(ObjectHashTable,'A065', 2, "JHE")
	call SaveStr(ObjectHashTable,'A0BE', 2, "E8E")
	call SaveStr(ObjectHashTable,'A064', 3, "JPE")
	call SaveStr(ObjectHashTable,'A0AM', 3, "JQE")
	call SaveStr(ObjectHashTable,'A0A3', 3, "JQE")
	call SaveStr(ObjectHashTable,'A0A4', 3, "JQE")
	call SaveStr(ObjectHashTable,'A1FZ', 3, "JQE")
	call SaveStr(ObjectHashTable,'A1WF', 3, "JTE")
	call SaveStr(ObjectHashTable,'A451', 3, "JUE")
	call SaveStr(ObjectHashTable,'A0AS', 3, "JWE")
	call SaveStr(ObjectHashTable,'A0SW', 3, "JYE")
	call SaveStr(ObjectHashTable,'A0EC', 3, "JZE")
	call SaveStr(ObjectHashTable,'A2QM', 3, "J_E")
	call SaveStr(ObjectHashTable,'A04Y', 3, "J4E")
	call SaveStr(ObjectHashTable,'A34A', 3, "J7E")
	call SaveStr(ObjectHashTable,'A34J', 3, "demonic_purge_charges0") //无充能邪恶净化
	call SaveStr(ObjectHashTable,'A1AA', 3, "KVE")	//回音重踏 前摇
	call SaveStr(ObjectHashTable,'A3DM', 3, "KXE")	//时光倒流
	call SaveStr(ObjectHashTable,'A2LK', 3, "KVE")
	call SaveStr(ObjectHashTable,'A11N', 3, "KOE")
	call SaveStr(ObjectHashTable,'AEbl', 3, "BlinkOnSpellCast")
	call SaveStr(ObjectHashTable,'QB08', 3, "BlinkOnSpellCast")
	call SaveStr(ObjectHashTable,'A3DF', 3, "KNE")
	call SaveStr(ObjectHashTable,'A00L', 3, "KBE")
	call SaveStr(ObjectHashTable,'A361', 3, "KCE")
	call SaveStr(ObjectHashTable,'A14O', 3, "KDE")
	call SaveStr(ObjectHashTable,'A3FJ', 3, "KDE")
	call SaveStr(ObjectHashTable,'A2QI', 3, "KHE")
	call SaveStr(ObjectHashTable,'A2QT', 3, "KJE")
	call SaveStr(ObjectHashTable,'A180', 3, "KLE")
	call SaveStr(ObjectHashTable,'A1BX', 3, "KME")
	call SaveStr(ObjectHashTable,'A30L', 3, "KME")
	call SaveStr(ObjectHashTable,'A21E', 3, "KPE")
	call SaveStr(ObjectHashTable,'A0M1', 3, "KQE")
	call SaveStr(ObjectHashTable,'A1AX', 3, "KQE")
	call SaveStr(ObjectHashTable,'A10U', 3, "KSE")
	call SaveStr(ObjectHashTable,'A01P', 3, "KTE")
	call SaveStr(ObjectHashTable,'A24D', 3, "KUE")
	call SaveStr(ObjectHashTable,'A10D', 3, "KWE")
	call SaveStr(ObjectHashTable,'A0K9', 3, "KYE")
	call SaveStr(ObjectHashTable,'A190', 3, "KZE")
	call SaveStr(ObjectHashTable,'A0BZ', 3, "K_E")
	call SaveStr(ObjectHashTable,'A0IN', 3, "K0E")
	call SaveStr(ObjectHashTable,'A1AW', 3, "K0E")
	call SaveStr(ObjectHashTable,'A02A', 3, "K2E")
	call SaveStr(ObjectHashTable,'A0RW', 3, "K3E")
	call SaveStr(ObjectHashTable,'A0OJ', 3, "K4E")
	call SaveStr(ObjectHashTable,'A0QE', 3, "K5E")
	call SaveStr(ObjectHashTable,'AHtb', 3, "K6E")
	call SaveStr(ObjectHashTable,'QB0H', 3, "K6E")
	call SaveStr(ObjectHashTable,'A0R0', 3, "K7E")
	call SaveStr(ObjectHashTable,'A226', 3, "K9E")
	call SaveStr(ObjectHashTable,'A32D', 3, "LEE")
	call SaveStr(ObjectHashTable,'A08Q', 3, "LXE")
	call SaveStr(ObjectHashTable,'A08c', 3, "bsckj")
	call SaveStr(ObjectHashTable,'A2TD', 3, "LOE")
	call SaveStr(ObjectHashTable,'A095', 3, "LRE")
	call SaveStr(ObjectHashTable,'A09W', 3, "LRE")
	call SaveStr(ObjectHashTable,'A12K', 3, "LIE")
	call SaveStr(ObjectHashTable,'A1S8', 3, "LNE")
	call SaveStr(ObjectHashTable,'A1TB', 3, "LBE")
	call SaveStr(ObjectHashTable,'A3FQ', 3, "LBE")
	call SaveStr(ObjectHashTable,'QB0L', 3, "LCE")
	call SaveStr(ObjectHashTable,'A2H0', 3, "LCE")
	call SaveStr(ObjectHashTable,'A0B1', 3, "LFE")
	call SaveStr(ObjectHashTable,'A064', 4, "LHE")
	call SaveStr(ObjectHashTable,'A1P8', 4, "LKE")
	call SaveStr(ObjectHashTable,'A21L', 4, "LLE")
	call SaveStr(ObjectHashTable,'A0I8', 4, "StrygwyrThirstOnLearn")
	call SaveStr(ObjectHashTable,'A0CZ', 4, "LPE")
	call SaveStr(ObjectHashTable,'A0AK', 4, "LQE")
	call SaveStr(ObjectHashTable,'A1FY', 4, "LQE")
	call SaveStr(ObjectHashTable,'A0S1', 4, "LSE")
	call SaveStr(ObjectHashTable,'A0MB', 4, "LTE")
	call SaveStr(ObjectHashTable,'A0MX', 4, "LearnSkill__DrunkenBrawler")
	call SaveStr(ObjectHashTable,'A34J', 4, "LZE")
	call SaveStr(ObjectHashTable,'A32G', 4, "L_E")
	call SaveStr(ObjectHashTable,'AIcd', 4, "L0E")
	call SaveStr(ObjectHashTable,'A0NS', 4, "LearnSkill__BorrowedTime")
	call SaveStr(ObjectHashTable,'A1DA', 4, "LearnSkill__BorrowedTime")
	call SaveStr(ObjectHashTable,'A517', 4, "LearnSkill__BorrowedTime")
	call SaveStr(ObjectHashTable,'A518', 4, "LearnSkill__BorrowedTime")
	call SaveStr(ObjectHashTable,'A0RP', 4, "L2E")
	call SaveStr(ObjectHashTable,'A449', 4, "L2E")
	call SaveStr(ObjectHashTable,'A34A', 4, "L3E")
	call SaveStr(ObjectHashTable,'A2O2', 4, "L4E")
	call SaveStr(ObjectHashTable,'QF88', 4, "L5E")
	call SaveStr(ObjectHashTable,'A0VC', 4, "L5E")
	call SaveStr(ObjectHashTable,'A062', 4, "L6E")
	call SaveStr(ObjectHashTable,'A524', 4, "MEE")
	call SaveStr(ObjectHashTable,'A0M3', 4, "MXE")
	call SaveStr(ObjectHashTable,'A06B', 4, "MOE")
	call SaveStr(ObjectHashTable,'A471', 4, "MOE")
	call SaveStr(ObjectHashTable,'A01N', 4, "MAE")
	call SaveStr(ObjectHashTable,'A0BR', 4, "MNE")
	call SaveStr(ObjectHashTable,'A03P', 4, "MBE")
	call SaveStr(ObjectHashTable,'A06D', 4, "MCE")
	call SaveStr(ObjectHashTable,'A04E', 4, "MDE")
	call SaveStr(ObjectHashTable,'A0MM', 4, "MFE")
	call SaveStr(ObjectHashTable,'A1NA', 4, "LearnLevel1Skill_SoulAssumption")
	call SaveStr(ObjectHashTable,'A0NA', 4, "MME")
	call SaveStr(ObjectHashTable,'A0H9', 4, "MPE")
	call SaveStr(ObjectHashTable,'A1E6', 4, "MWE")
	call SaveStr(ObjectHashTable,'A0QQ', 4, "MYE")
	call SaveStr(ObjectHashTable,'A0QW', 4, "MZE")
	call SaveStr(ObjectHashTable,'A1EA', 4, "M_E")
	call SaveStr(ObjectHashTable,'QB03', 4, "M_E")
	call SaveStr(ObjectHashTable,'A01Y', 4, "SKill_Learn_Reincarnation")
	call SaveStr(ObjectHashTable,'A1AZ', 4, "SKill_Learn_Reincarnation")
	
	call SaveStr(ObjectHashTable,'A0DJ', 4, "Learn_HaveCoolDownSkill") //余震
	call SaveStr(ObjectHashTable,'A0C6', 4, "Learn_HaveCoolDownSkill") //反击螺旋
	call SaveStr(ObjectHashTable,'A2EY', 4, "Learn_HaveCoolDownSkill") //勇气之霎
	//	call SaveStr(ObjectHashTable,'A522', 4, "Learn_HaveCoolDownSkill") //水刀
	//学习
	
	call SaveStr(ObjectHashTable,'A18X', 4, "M4E")
	call SaveStr(ObjectHashTable,'A1CD', 4, "M8E")
	call SaveStr(ObjectHashTable,'A1IN', 4, "M9E")
	call SaveStr(ObjectHashTable,'A28Q', 4, "PVE")
	call SaveStr(ObjectHashTable,'A27V', 4, "PEE")
	call SaveStr(ObjectHashTable,'A064', 1000, "LHE")
	call SaveStr(ObjectHashTable,'A0K9', 1000, "PXE")
	call SaveStr(ObjectHashTable,'A46E', 1000, "POE")
	call SaveStr(ObjectHashTable,'A0CG', 1000, "PIE")
	call SaveStr(ObjectHashTable,'A086', 1000, "PNE")
	call SaveStr(ObjectHashTable,'A43S', 1000, "PBE")
	call SaveStr(ObjectHashTable,'A0BR', 1000, "MNE")
	call SaveStr(ObjectHashTable,'A0EY', 1000, "PDE")
	call SaveStr(ObjectHashTable,'A03E', 1000, "PFE")
	call SaveStr(ObjectHashTable,'A32G', 1000, "L_E")
	call SaveStr(ObjectHashTable,'A0MX', 1000, "LearnSkill__DrunkenBrawler")
	call SaveStr(ObjectHashTable,'A21M', 1000, "LLE")
	call SaveStr(ObjectHashTable,'A34A', 1000, "L3E")
	call SaveStr(ObjectHashTable,'A40B', 1000, "PGE")
	call SaveStr(ObjectHashTable,'A2O2', 1000, "L4E")
	call SaveStr(ObjectHashTable,'A34J', 1000, "LZE")
	call SaveStr(ObjectHashTable,'A0MB', 1000, "LTE")
	call SaveStr(ObjectHashTable,'P019', 1000, "PHE")
	call SaveStr(ObjectHashTable,'A1P8', 1000, "LKE")
	call SaveStr(ObjectHashTable,'A0RP', 1000, "L2E")
	call SaveStr(ObjectHashTable,'A449', 1000, "L2E")
	call SaveStr(ObjectHashTable,'AIcd', 1000, "L0E")
	call SaveStr(ObjectHashTable,'A0VC', 1000, "L5E")
	call SaveStr(ObjectHashTable,'QF88', 1000, "L5E")
	call SaveStr(ObjectHashTable,'A1IN', 1000, "M9E")
	call SaveStr(ObjectHashTable,'A13T', 1000, "LearnSkill__Tidebringer")
	//call SaveStr(ObjectHashTable,'A522', 1000, "LearnSkill__Tidebringer")
	call SaveStr(ObjectHashTable,'A19Q', 1000, "PPE")
	call SaveStr(ObjectHashTable,'A0CY', 1000, "PQE")
	call SaveStr(ObjectHashTable,'A1CD', 1000, "M8E")
	call SaveStr(ObjectHashTable,'A0QQ', 1000, "MYE")
	call SaveStr(ObjectHashTable,'A0M3', 1000, "PSE")
	call SaveStr(ObjectHashTable,'A03U', 1000, "PTE")
	call SaveStr(ObjectHashTable,'A062', 1000, "L6E")
	call SaveStr(ObjectHashTable,'A0KX', 1000, "PUE")
	call SaveStr(ObjectHashTable,'A0A5', 1000, "PYE")
	call SaveStr(ObjectHashTable,'A27V', 1000, "PEE")
	call SaveStr(ObjectHashTable,'A28Q', 1000, "PVE")
	call SaveStr(ObjectHashTable,'A18X', 1000, "M4E")
	call SaveStr(ObjectHashTable,'A11N', 1000, "PZE")
	call SaveStr(ObjectHashTable,'A01Y', 1000, "SKill_Learn_Reincarnation")
	call SaveStr(ObjectHashTable,'A1AZ', 1000, "SKill_Learn_Reincarnation")
	//被动学习技能
	call SaveStr(ObjectHashTable,'A0DJ', 1000, "Learn_HaveCoolDownSkill") //余震
	//	call SaveStr(ObjectHashTable,'A522',1000, "Learn_HaveCoolDownSkill") //水刀
	call SaveStr(ObjectHashTable,'A0C6', 1000, "Learn_HaveCoolDownSkill") //反击
	call SaveStr(ObjectHashTable,'A2EY', 1000, "Learn_HaveCoolDownSkill") //勇气之霎
	
	call SaveStr(ObjectHashTable,'A0RO', 1000, "P_E")
	call SaveStr(ObjectHashTable,'A0QW', 1000, "MZE")
	call SaveStr(ObjectHashTable,'A1E6', 1000, "MWE")
	call SaveStr(ObjectHashTable,'A0NA', 1000, "MME")
	call SaveStr(ObjectHashTable,'A0NS', 1000, "LearnSkill__BorrowedTime")
	call SaveStr(ObjectHashTable,'A0VX', 1000, "P0E")
	call SaveStr(ObjectHashTable,'A1NA', 1000, "LearnLevel1Skill_SoulAssumption")
	call SaveStr(ObjectHashTable,'A04E', 1000, "MDE")
	call SaveStr(ObjectHashTable,'A06D', 1000, "MCE")
	call SaveStr(ObjectHashTable,'A03P', 1000, "MBE")
	call SaveStr(ObjectHashTable,'A01N', 1000, "MAE")
	call SaveStr(ObjectHashTable,'A0I8', 1000, "StrygwyrThirstOnLearn")
	call SaveStr(ObjectHashTable,'A06B', 1000, "MOE")
	call SaveStr(ObjectHashTable,'A1IQ', 1000, "P4E")
	call SaveStr(ObjectHashTable,'A524', 1000, "P4E")
	call SaveStr(ObjectHashTable,'A0IF', 1000, "P5E")
	call SaveStr(ObjectHashTable,'A1EA', 1000, "M_E")
	call SaveStr(ObjectHashTable,'QB03', 1000, "M_E")
	call SaveStr(ObjectHashTable,'A0AK', 1000, "LQE")
	call SaveStr(ObjectHashTable,'A0LV', 1000, "P7E")
	call SaveStr(ObjectHashTable,'A2AI', 1000, "P8E")
	call SaveStr(ObjectHashTable,'A0CZ', 1000, "LPE")
	call SaveStr(ObjectHashTable,'A2S0', 1000, "P9E")
	call SaveStr(ObjectHashTable,'A0MM', 1000, "MFE")
	call SaveStr(ObjectHashTable,'A0CL', 1000, "Q_E")
	call SaveStr(ObjectHashTable,'A0OO', 1000, "Q1E")
	call SaveStr(ObjectHashTable,'A303', 1000, "Q2E")
	call SaveStr(ObjectHashTable,'A0H4', 1000, "Q5E")
	call SaveStr(ObjectHashTable,'Q0BK', 1000, "SXE")
	call SaveStr(ObjectHashTable,'A2JK', 1000, "SAE")
	//call SaveStr(ObjectHashTable,'A1C0', 1000, "SNE")
	call SaveStr(ObjectHashTable,'A440', 1000, "SCE")
	call SaveStr(ObjectHashTable,'A0A8', 1000, "SLE")
	call SaveStr(ObjectHashTable,'A0K9', 5, "PXE")
	call SaveStr(ObjectHashTable,'A46E', 5, "POE")
	call SaveStr(ObjectHashTable,'A43S', 5, "PBE")
	call SaveStr(ObjectHashTable,'A440', 5, "SCE")
	call SaveStr(ObjectHashTable,'A2E5', 5, "PBE")
	call SaveStr(ObjectHashTable,'Q0BK', 5, "SXE")
	call SaveStr(ObjectHashTable,'A2JK', 5, "SAE")
	//call SaveStr(ObjectHashTable,'A1C0', 5, "SNE")
	call SaveStr(ObjectHashTable,'A2S0', 5, "P9E")
	call SaveStr(ObjectHashTable,'A11N', 5, "PZE")
	call SaveStr(ObjectHashTable,'A2AI', 5, "P8E")
	call SaveStr(ObjectHashTable,'A03E', 5, "PFE")
	call SaveStr(ObjectHashTable,'A0VX', 5, "P0E")
	call SaveStr(ObjectHashTable,'A0IF', 5, "P5E")
	
	call SaveStr(ObjectHashTable,'A086', 5, "PNE")
	call SaveStr(ObjectHashTable,'A08E', 5, "SME")
	call SaveStr(ObjectHashTable,'A0A5', 5, "PYE")
	call SaveStr(ObjectHashTable,'A0CY', 5, "PQE")
	call SaveStr(ObjectHashTable,'A19Q', 5, "PPE")
	call SaveStr(ObjectHashTable,'A0EY', 5, "PDE")
	call SaveStr(ObjectHashTable,'A0KX', 5, "PUE")
	call SaveStr(ObjectHashTable,'A0CG', 5, "PIE")
	call SaveStr(ObjectHashTable,'A0OO', 5, "Q1E")
	call SaveStr(ObjectHashTable,'A03U', 5, "PTE")
	call SaveStr(ObjectHashTable,'P019', 5, "PHE")
	call SaveStr(ObjectHashTable,'A0H4', 5, "Q5E")
	call SaveStr(ObjectHashTable,'A0CL', 5, "Q_E")
	call SaveStr(ObjectHashTable,'A0RO', 5, "P_E")
	call SaveStr(ObjectHashTable,'A40B', 5, "PGE")
	call SaveStr(ObjectHashTable,'A13T', 5, "LearnSkill__Tidebringer")
	//call SaveStr(ObjectHashTable,'A522', 5, "LearnSkill__Tidebringer")
	call SaveStr(ObjectHashTable,'A0LV', 5, "P7E")
	call SaveStr(ObjectHashTable,'A32Y', 5, "SQE")
	call SaveStr(ObjectHashTable,'A32Z', 5, "SWE")
	call SaveStr(ObjectHashTable,'A331', 5, "SYE")
	call SaveStr(ObjectHashTable,'A303', 5, "Q2E")
	call SaveStr(ObjectHashTable,'A0A8', 5, "SLE")
	call SaveStr(ObjectHashTable,'A440',1001, "SCE")
	call SaveStr(ObjectHashTable,'A0K9',1001, "PXE")
	call SaveStr(ObjectHashTable,'A46E',1001, "POE")
	call SaveStr(ObjectHashTable,'A0CG',1001, "PIE")
	call SaveStr(ObjectHashTable,'A2E5',1001, "PBE")
	//call SaveStr(ObjectHashTable,'A1C0',1001, "SNE")
	call SaveStr(ObjectHashTable,'A2JK',1001, "SAE")
	call SaveStr(ObjectHashTable,'A11N',1001, "PZE")
	call SaveStr(ObjectHashTable,'A086',1001, "PNE")
	call SaveStr(ObjectHashTable,'A0EY',1001, "PDE")
	call SaveStr(ObjectHashTable,'A331',1001, "SYE")
	call SaveStr(ObjectHashTable,'A40B',1001, "PGE")
	call SaveStr(ObjectHashTable,'A0H4',1001, "Q5E")
	call SaveStr(ObjectHashTable,'A32Z',1001, "SWE")
	call SaveStr(ObjectHashTable,'A0KX',1001, "PUE")
	call SaveStr(ObjectHashTable,'A32Y',1001, "SQE")
	call SaveStr(ObjectHashTable,'Q0BK',1001, "SXE")
	call SaveStr(ObjectHashTable,'A303',1001, "Q2E")
	call SaveStr(ObjectHashTable,'P019',1001, "PHE")
	call SaveStr(ObjectHashTable,'A0OO',1001, "Q1E")
	call SaveStr(ObjectHashTable,'A2S0',1001, "P9E")
	call SaveStr(ObjectHashTable,'A0LV',1001, "P7E")
	call SaveStr(ObjectHashTable,'A0RO',1001, "P_E")
	call SaveStr(ObjectHashTable,'A13T',1001, "LearnSkill__Tidebringer")
	//call SaveStr(ObjectHashTable,'A522',1001, "LearnSkill__Tidebringer")
	call SaveStr(ObjectHashTable,'A19Q',1001, "SZE")
	call SaveStr(ObjectHashTable,'A03U',1001, "PTE")
	call SaveStr(ObjectHashTable,'A0A5',1001, "PYE")
	call SaveStr(ObjectHashTable,'A03E',1001, "PFE")
	call SaveStr(ObjectHashTable,'A0VX',1001, "P0E")
	call SaveStr(ObjectHashTable,'A2AI',1001, "P8E")
	call SaveStr(ObjectHashTable,'A0CY',1001, "PQE")
	call SaveStr(ObjectHashTable,'A0IF',1001, "P5E")
	call SaveStr(ObjectHashTable,'A0CL',1001, "Q_E")
	call SaveStr(ObjectHashTable,'A0A8',1001, "SLE")
	call SaveStr(ObjectHashTable,'A01O', 7, "S_E")
	call SaveStr(ObjectHashTable,'A04P', 7, "S0E")
	call SaveStr(ObjectHashTable,'A1AU', 7, "S0E")
	call SaveStr(ObjectHashTable,'A454', 7, "S1E")
	call SaveStr(ObjectHashTable,'A24K', 9, "S2E")
	call SaveStr(ObjectHashTable, StringHash("-display"), 10, "S3E")
endfunction
function S5E takes nothing returns nothing
	call SaveBoolean(ObjectHashTable, 1,'A1FP', true)
	call SaveInteger(ObjectHashTable, 2,'A1FP','I0AB')
	call SaveInteger(ObjectHashTable, 1,'I0AB','J000')
	call SaveReal(ObjectHashTable, 0,'I0AB', 35)
	call SaveInteger(ObjectHashTable, 0,'J000','I0AB')
	call SaveBoolean(ObjectHashTable, 1,'A0B8', true)
	call SaveInteger(ObjectHashTable, 2,'A0B8','I09F')
	call SaveInteger(ObjectHashTable, 1,'I09F','J001')
	call SaveReal(ObjectHashTable, 0,'I09F', 35)
	call SaveReal(ObjectHashTable, 0,'J001', 35)
	call SaveInteger(ObjectHashTable, 0,'J001','I09F')
	call SaveBoolean(ObjectHashTable, 1,'A1WE', true)
	call SaveInteger(ObjectHashTable, 2,'A1WE','I0MU')
	call SaveInteger(ObjectHashTable, 1,'I0MU','J002')
	call SaveReal(ObjectHashTable, 0,'I09F', 50)
	call SaveReal(ObjectHashTable, 0,'J002', 50)
	call SaveInteger(ObjectHashTable, 0,'J002','I0MU')
	call SaveInteger(ObjectHashTable, 0,'I09F','A0B8')
	call SaveInteger(ObjectHashTable, 0,'I0MU','A1WE')
	call SaveInteger(ObjectHashTable, 0,'I00Z','A0T9')
	call SaveInteger(ObjectHashTable, 0,'I0AL','AChx')
	call SaveInteger(ObjectHashTable, 0,'I012','A0FD')
	call SaveInteger(ObjectHashTable, 0,'I08O','A15W')
	call SaveInteger(ObjectHashTable, 0,'I08Z','A1T7')
	call SaveInteger(ObjectHashTable, 0,'I0HI','A19M')
	call SaveInteger(ObjectHashTable, 0,'I09M','A02O')
	call SaveInteger(ObjectHashTable, 0,'I09P','A08Y')
	call SaveInteger(ObjectHashTable, 0,'I09N','A08Z')
	call SaveInteger(ObjectHashTable, 0,'I09O','A090')
	call SaveInteger(ObjectHashTable, 0,'I09L','A092')
	call SaveInteger(ObjectHashTable, 0,'I0O3','A28D')
	call SaveInteger(ObjectHashTable, 0,'I0OL','A2EA')
	call SaveInteger(ObjectHashTable, 0,'I093','A0CK')
	call SaveInteger(ObjectHashTable, 0,'I066','AIda')
	call SaveInteger(ObjectHashTable, 0,'I0K6','A1EW')
	call SaveInteger(ObjectHashTable, 0,'I0KY','A1MO')
	call SaveInteger(ObjectHashTable, 0,'I0N0','A1ZI')
	call SaveInteger(ObjectHashTable, 0,'I0NE','A1ZW')
	call SaveInteger(ObjectHashTable, 0,'I0OX','A2K7')
	call SaveInteger(ObjectHashTable, 0,'I09H','A017')
	call SaveInteger(ObjectHashTable, 0,'I0JI','A1AC')
	call SaveInteger(ObjectHashTable, 0,'I0LT','A1QD')
	call SaveInteger(ObjectHashTable, 0,'I0BE','A0JL')
	call SaveInteger(ObjectHashTable, 0,'I08Y','AIxk')
	call SaveInteger(ObjectHashTable, 0,'I08R','AIpg')
	call SaveInteger(ObjectHashTable, 0,'I0J9','AIpg')
	call SaveInteger(ObjectHashTable, 0,'I0OV','A2K4')
	call SaveInteger(ObjectHashTable, 0,'I06B','A231')
	call SaveInteger(ObjectHashTable, 0,'I0GJ','A12W')
	call SaveInteger(ObjectHashTable, 0,'I0LL','A1Q8')
	call SaveInteger(ObjectHashTable, 0,'I0GC','A0JY')
	call SaveInteger(ObjectHashTable, 0,'I0HB','A0JY')
endfunction
function S6E takes nothing returns nothing
	local player p
	local integer count = 0
	set CK[0]= 2
	set CK[1]= 2
	call UIV() // 玩家退出
	call InitAbilityCastMethodTable() // 初始化大部分技能
	call S5E()
	call W3V() // 再装填和潮汐使者
	call SetAllPlayerAbilityUnavailable('A509')
	call SetAllPlayerAbilityUnavailable('A515')
	call SetAllPlayerAbilityUnavailable('A521')
	call SetAllPlayerAbilityUnavailable('A147')
	call SetAllPlayerAbilityUnavailable('A228')
	call SetAllPlayerAbilityUnavailable('A0B8')
	call SetAllPlayerAbilityUnavailable('A1WE')
	call ExecuteFunc("InitPassiveAbilitys")
	loop
		set p = Player(count)
		call TriggerRegisterPlayerUnitEvent(UnitEventMainTrig, p, EVENT_PLAYER_UNIT_ATTACKED, null)
		call TriggerRegisterPlayerUnitEvent(UnitEventMainTrig, p, EVENT_PLAYER_UNIT_DEATH   , null)
		set count = count + 1
	exitwhen count == 15
	endloop
	set p = null
endfunction
function SetPlayerAbilityAvailableEx takes player p, integer WTV, boolean b returns nothing
	call SaveBoolean(ObjectHashTable, GetHandleId(p), WTV, b == false)
	call SetPlayerAbilityAvailable(p, WTV, b)
endfunction
function TVE takes integer id returns integer
	local integer i = 0
	loop
		if HeroListTypeId[i]== id then
			return i
		endif
		set i = i + 1
	endloop
	return -1
endfunction
// 按表索引检查技能
function CheckAbilityIdFormIndex takes integer abilIndex, integer TOE, string orderStr, string TNE returns boolean
	local integer i
	local integer k
	local string array s1
	local string array s2
	local integer j
	local integer o
	if TOE >-1 then
		if HaveSavedString(AbilityDataHashTable, abilIndex, 0) == false or HaveSavedString(AbilityDataHashTable, TOE, 0) == false then
			return false
		endif
		set i = 0
		loop
		exitwhen HaveSavedString(AbilityDataHashTable, abilIndex, i) == false
			set s1[i]= LoadStr(AbilityDataHashTable, abilIndex, i)
			set i = i + 1
		endloop
		set k = 0
		loop
		exitwhen HaveSavedString(AbilityDataHashTable, TOE, k) == false
			set s2[k]= LoadStr(AbilityDataHashTable, TOE, k)
			set k = k + 1
		endloop
		if i == 0 or k == 0 then
			return false
		endif
		set j = 0
		loop
			set o = 0
		exitwhen j >= i
			loop
			exitwhen o >= k
				if s1[j]== s2[o]and s1[j]!= TNE then
					return true
				endif
				set o = o + 1
			endloop
			set j = j + 1
		endloop
		return false
	else
		set i = 0
		loop
		exitwhen HaveSavedString(AbilityDataHashTable, abilIndex, i) == false
			if LoadStr(AbilityDataHashTable, abilIndex, i) == orderStr then
				return true
			endif
			set i = i + 1
		endloop
		return false
	endif
	return true
endfunction
function TBE takes integer id returns integer
	local integer i = 1
	loop
		if AghanimUpgradeNormalId[i]== id then
			return i
		endif
		set i = i + 1
	exitwhen i > AghanimUpgradeMaxIndex
	endloop
	return -1
endfunction
// 获取物品的索引
function GetItemIndex takes item it returns integer
	local integer id
	local integer i = 1
	if it == null then
		return -2
	endif
	set id = GetItemTypeId(it)
	loop
		if XXV[i]== id or XOV[i]== id then
			return i
		endif
		set i = i + 1
	exitwhen i > MaxItemsNumber
	endloop
	return -1
endfunction
function TDE takes unit u, integer id, player p, boolean b, integer i returns nothing
	local item it = UnitAddItemById(u, id)
	call SetItemPlayer(it, p, b)
	call SetItemUserData(it, i)
	set it = null
endfunction

// 使得该技能不会受到重置单位所有冷却的影响
function SetSkillDisableRefreshCoolDown takes integer skillId returns nothing
	set DisableRefreshCoolDownSkillId[0] = DisableRefreshCoolDownSkillId[0] + 1
	set DisableRefreshCoolDownSkillId[DisableRefreshCoolDownSkillId[0]] = skillId
endfunction

// 重置单位技能 但有一些技能是不会被重置的
function UnitResetCooldownEx takes unit whichUnit returns nothing
	local integer i = 0
	loop
	exitwhen i > DisableRefreshCoolDownSkillId[0]
		if GetUnitAbilityLevel(whichUnit, DisableRefreshCoolDownSkillId[i]) > 0 then
			set Temp__ArrayReal[i] = YDWEGetUnitAbilityState(whichUnit, DisableRefreshCoolDownSkillId[i], 1)
		endif
		set i = i + 1
	endloop
	call UnitResetCooldown(whichUnit)
	set i = 0
	loop
	exitwhen i > DisableRefreshCoolDownSkillId[0]
		if Temp__ArrayReal[i] > 0 then
			call YDWESetUnitAbilityState(whichUnit, DisableRefreshCoolDownSkillId[i], 1, Temp__ArrayReal[i])
		endif
		set i = i + 1
	endloop
endfunction

function TFE takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	local integer i = 0
	local integer k = 5
	local integer array TGE
	local player array THE
	local integer id
	local item it
	set TGE[0]= 0
	set TGE[1]= 0
	set TGE[2]= 0
	set TGE[3]= 0
	set TGE[4]= 0
	set TGE[5]= 0
	call DisableTrigger(CUV)
	loop
		set it = UnitItemInSlot(u, i)
		set id = GetItemIndex(it)
		if id == I9V or id == AVV or id == AEV or id == AXV or id == AOV or id == ARV or id == I_V or id == AKV or id == ALV or id == AMV or id == IFV or id == A6V or id == NVV or id == NZV then
			set TGE[i]= GetItemTypeId(it)
			set THE[i]= GetItemPlayer(it)
			call RemoveItem(it)
		endif
		set i = i + 1
	exitwhen i > k
	endloop
	call UnitResetCooldownEx(u)
	call TimerStart(ESV[GetPlayerId(p)], 0, false, null)
	call TimerStart(ETV[GetPlayerId(p)], 0, false, null)
	call FlushChildHashtable(PassiveAbilityCooldown, GetHandleId(u))
	set i = 0
	set k = 5
	loop
		if TGE[i]> 0 then
			set it = CreateItem(TGE[i], 0, 0)
			call SetItemPlayer(it, THE[i], false)
			call SetItemUserData(it, 1)
			call UnitAddItem(u, it)
		endif
		set i = i + 1
	exitwhen i > k
	endloop
	call EnableTrigger(CUV)
	set it = null
	set p = null
endfunction
function T2E takes nothing returns nothing
	call DisplayTimedTextToPlayer(Player(1), .0, .0, 20., "Selected unit id: " + UGV(GetUnitTypeId(GetTriggerUnit()))+ " (" + I2S(GetUnitTypeId(GetTriggerUnit()))+ ")")
endfunction
function T3E takes nothing returns nothing
	call DisplayTimedTextToPlayer(GetOwningPlayer(GetTriggerUnit()), .0, .0, 20., "You used skill # " + UGV(GetSpellAbilityId())+ " (" + I2S(GetSpellAbilityId())+ ")")
endfunction
function T4E takes nothing returns nothing
	if IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) then
		if OrderId2StringBJ(GetIssuedOrderId())!= "smart" then
			call DisplayTimedTextToPlayer(GetOwningPlayer(GetTriggerUnit()), .0, .0, 20., "Skill order: " + OrderId2StringBJ(GetIssuedOrderId())+ " (" + I2S(GetIssuedOrderId())+ ")")
		endif
	endif
endfunction

function T6E takes integer WWV returns boolean
	if LOD_DEBUGMODE then
		return true
	endif
	return((GetPlayerController(Player(WWV)) == MAP_CONTROL_USER) and(GetPlayerSlotState(Player(WWV)) == PLAYER_SLOT_STATE_PLAYING))
endfunction
function T7E takes player p, boolean b returns nothing
	local sound s = CreateSoundFromLabel("InterfaceError", false, false, false, 10, 10)
	if b then
		if (LocalPlayer== p) then
			call StartSound(s)
		endif
	endif
	call KillSoundWhenDone(s)
	set s = null
endfunction
function T9E takes player p, boolean b, string s returns nothing
	if not(b) then
		return
	endif
	if (LocalPlayer== p) then
		if (s != "") and(s != null) then
			call ClearTextMessages()
			call DisplayTimedTextToPlayer(p, 0, 0, 5, "|c00FF0000[LoD]|r|c006699CC" + " " + s + "|r")
		endif
	endif
endfunction
function UVE takes player p, boolean UEE, string s returns nothing
	if not(UEE) then
		return
	endif
	if (LocalPlayer== p) then
		if (s != "") and(s != null) then
			call DisplayTimedTextToPlayer(p, 0, 0, 5, "|c00FF0000[LoD]|r|c006699CC" + " " + s + "|r")
		endif
	endif
endfunction
function URE takes player p, boolean UEE, string s returns nothing
	if not(UEE) then
		return
	endif
	call T7E(p, UEE)
	call T9E(p, UEE, s)
endfunction
function UIE takes integer UDE returns integer
	return UDE
endfunction
function UFE takes nothing returns integer
	local integer TTV
	local integer i
	loop
		set TTV = UIE(GetRandomInt(1, GL))
		set i = 0
		if ZQ[TTV]== false then
			return HeroListTypeId[TTV]
		endif
	exitwhen false
	endloop
	return HeroListTypeId[1]
endfunction
function GetUnitMissProbability takes unit whichUnit returns integer
	local real probability = 1
	local integer inventorySize
	local integer i = 0
	local item it
	local integer level
	// 模糊
	if IsAttackEffectEnabled[4] then
		set level = GetUnitAbilityLevel(whichUnit,'A03P')*(1 -GetUnitAbilityLevel(whichUnit,'A36D'))
		if level > 0 then
			set probability = probability *(.9 -0.1 * level)
		endif
	endif
	// 醉拳
	if IsAttackEffectEnabled[1] then
		set level = GetUnitAbilityLevel(whichUnit,'A0MX')*(1 -GetUnitAbilityLevel(whichUnit,'A36D'))
		if level > 0 then
			set probability = probability *(.95 -0.05 * level)
		endif
	endif
	if IsAttackEffectEnabled[2]or IsAttackEffectEnabled[3]or IsAttackEffectEnabled[6] then
		//set UQE = LoadInteger(HY, GetHandleId(u),'BFLY')	//蝴蝶buff 需要修改
		set inventorySize = UnitInventorySize(whichUnit)
		loop
		exitwhen i > inventorySize
			set it = UnitItemInSlot(whichUnit, i)
			if it != null then
				if GetItemIndex(it) == A5V then
					// 蝴蝶 35%
					if GetUnitAbilityLevel(whichUnit,'AIev') > 0 then
						set probability = probability * .65
					endif
				elseif GetItemIndex(it) == RXV or GetItemIndex(it) == N1V then
					// 闪避护符和天堂之戟 25%
					set probability = probability * .75
				endif
			endif
			set i = i + 1
		endloop
		set it = null
	endif
	if IsAttackEffectEnabled[5] then
		if GetUnitAbilityLevel(whichUnit,'A39G') == 1 then
			set probability = probability * .75
		endif
		if GetUnitAbilityLevel(whichUnit,'A39M') == 1 then
			set probability = probability * .75
		endif
	endif
	// debug call SingleDebug(" 闪避几率 "+I2S( 100-R2I(probability *100) ) )
	return  100 -R2I(probability * 100 )
endfunction
function UUE takes integer c, integer c2 returns integer
	if c == 0 then
		return c2
	endif
	return  100 -( 100 -c)*( 100 -c2)/ 100 
endfunction
// 获取单位致盲几率
function GetUnitBlind takes unit u returns integer
	local integer c = 0
	local integer ch
	if IsAttackEffectEnabled[14] then
		if GetUnitAbilityLevel(u,'B02P') == 1 then
			set c = 100 
		endif
	endif
	if c != 100  then
		if IsAttackEffectEnabled[8] then
			if GetUnitAbilityLevel(u,'BNdh') == 1 then
				if GetUnitAbilityLevel(u,'A3PU') == 1 then
					set c = 75
				elseif GetUnitAbilityLevel(u,'A3PR') == 1 then
					set c = 45
				elseif GetUnitAbilityLevel(u,'A3PS') == 1 then
					set c = 55
				elseif GetUnitAbilityLevel(u,'A3PT') == 1 then
					set c = 65
				endif
			endif
		endif
		if IsAttackEffectEnabled[9] then
			if GetUnitAbilityLevel(u,'B01D') == 1 then
				if GetUnitAbilityLevel(u,'A3PY') == 1 then
					set c = UUE(c, 60)
				elseif GetUnitAbilityLevel(u,'A3PV') == 1 then
					set c = UUE(c, 30)
				elseif GetUnitAbilityLevel(u,'A3PW') == 1 then
					set c = UUE(c, 40)
				elseif GetUnitAbilityLevel(u,'A3PX') == 1 then
					set c = UUE(c, 50)
				endif
			endif
		endif
		if IsAttackEffectEnabled[B] then
			// 烟雾
			if GetUnitAbilityLevel(u,'Bhea') == 1 then
				set c = UUE(c, 30 + 10 * F)
			endif
		endif
		if IsAttackEffectEnabled[I] then
			// 致盲之光
			if GetUnitAbilityLevel(u,'B09K') == 1 then
				set c = UUE(c, 80)
			endif
		endif
		if IsAttackEffectEnabled[A] then
			// 伤残恐惧
			if GetUnitAbilityLevel(u,'B02M') == 1 then
				set c = UUE(c, 50)
			endif
		endif
		if IsAttackEffectEnabled[N] then
			// 辉耀
			if GetUnitAbilityLevel(u,'B3DJ') == 1 then
				set c = UUE(c, 17)
			endif
		endif
		if IsAttackEffectEnabled[D] then
			// 日耀
			if GetUnitAbilityLevel(u,'B39I') == 1 then
				set c = UUE(c, 25)
			endif
		endif
		if IsAttackEffectEnabled[16] then
			// 旋风飞斧
			if GetUnitAbilityLevel(u,'B00C') == 1 then
				set c = UUE(c, 60)
			endif
		endif
	endif
	//call BJDebugMsg("致盲"+I2S(c))
	return c
endfunction
function UYE takes integer UZE returns boolean
	return UZE =='I0OV' or UZE =='I0J6' or UZE =='I0AI'
endfunction
function U_E takes integer UZE returns boolean
	return UZE =='A0MX' or UZE =='QP0H' or UZE =='A03P' or UZE =='QP0R'
endfunction
function U4E takes unit whichUnit, integer UZE returns integer
	local integer i = 0
	local integer n = 0
	local integer c = UnitInventorySize(whichUnit)-1
	loop
		if GetItemTypeId(UnitItemInSlot(whichUnit, i)) == UZE then
			if GetTriggerEventId() == EVENT_PLAYER_UNIT_DROP_ITEM or GetTriggerEventId() == EVENT_PLAYER_UNIT_PAWN_ITEM then
				if UnitItemInSlot(whichUnit, i)!= GetManipulatedItem() then
					set n = n + 1
				endif
			else
				set n = n + 1
			endif
		endif
		set i = i + 1
	exitwhen i > c
	endloop
	return n
endfunction
function U7E takes unit u, integer U8E returns nothing
	local integer i = 0
	local integer U9E
	local integer WUV
	local integer WXV
	set U8E = U8E -28
	loop
		call UnitRemoveAbility(u, VC[i])
		set i = i + 1
	exitwhen i > 8
	endloop
	if U8E <= 0 then
		return
	endif
	set WXV = R2I(U8E / 2)+ 1
	set U9E = R2I(WXV / 4)
	set WUV = WXV -(U9E * 4)+ 1
	call UnitAddPermanentAbility(u, VC[U9E])
	call UnitMakeAbilityPermanent(u, true,'EVA0'+ U9E)
endfunction
function WVE takes player p, boolean WXE returns nothing
	set WXE = not WXE
	call SetPlayerAbilityAvailable(p,'EVA1', WXE)
	call SetPlayerAbilityAvailable(p,'EVA2', WXE)
	call SetPlayerAbilityAvailable(p,'EVA3', WXE)
	call SetPlayerAbilityAvailable(p,'EVA4', WXE)
	call SetPlayerAbilityAvailable(p,'EVA5', WXE)
	call SetPlayerAbilityAvailable(p,'EVA6', WXE)
	call SetPlayerAbilityAvailable(p,'EVA7', WXE)
	call SetPlayerAbilityAvailable(p,'EVA8', WXE)
	call SetPlayerAbilityAvailable(p,'P119', WXE)
	call SetPlayerAbilityAvailable(p,'P239', WXE)
	call SetPlayerAbilityAvailable(p,'P239', WXE)
	call SetPlayerAbilityAvailable(p,'A1BZ', WXE)
	call SetPlayerAbilityAvailable(p,'A2K6', WXE)
	call SetPlayerAbilityAvailable(p,'AIev', WXE)
	call SetPlayerAbilityAvailable(p,'ACes', WXE)
endfunction

function GetGameTime takes nothing returns real
	return TimerGetElapsed(GameTimer)
endfunction

function WRE takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local real time = GetGameTime()
	if LoadReal(HY, h, 0)< time then
		call RemoveSavedHandle(HY, GetHandleId(LoadUnitHandle(HY, h, 0)),'EVAS')
		call WVE(GetOwningPlayer(LoadUnitHandle(HY, h, 0)), false)
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	endif
	set t = null
endfunction
function WAE takes unit u returns nothing
	local real ev = 1
	local integer i
	if GetUnitAbilityLevel(u,'A36D') == 0 then
		if (GetUnitAbilityLevel(u,'A0MX'))> 0 then
			set ev = ev *(1 -(((GetUnitAbilityLevel(u,'A0MX'))* 5 + 5)* .01))
		endif
		if (GetUnitAbilityLevel(u,'A03P'))> 0 then
			set ev = ev *(1 -0.1 -(GetUnitAbilityLevel(u,'A03P'))* .1)
		endif
	endif
	if (GetUnitAbilityLevel(u,'A39M')) == 1 then
		set ev = ev * .75
	endif
	if GetUnitAbilityLevel(u,'A2K6')> 0 then
		set i = U4E(u,'I0OV')
		loop
			set ev = ev *(1 -0.25)
			set i = i -1
		exitwhen i == 0
		endloop
	endif
	if GetUnitAbilityLevel(u,'A1BZ')> 0 then
		set i = U4E(u,'I0J6')
		loop
			set ev = ev *(1 -0.25)
			set i = i -1
		exitwhen i == 0
		endloop
	endif
	if GetUnitAbilityLevel(u,'AIev')> 0 then
		set i = U4E(u,'I0AI')
		loop
			set i = i -1
			set ev = ev *(1 -0.35)
		exitwhen i <= 0
		endloop
	endif
	call U7E(u, R2I((1 -ev)* 100 ))
	set u = null
endfunction
function EvasionStacking takes nothing returns nothing
	local eventid WNE = GetTriggerEventId()
	if WNE == EVENT_PLAYER_UNIT_PICKUP_ITEM or WNE == EVENT_PLAYER_UNIT_DROP_ITEM or WNE == EVENT_PLAYER_UNIT_PAWN_ITEM then
		if (UYE(GetItemTypeId(GetManipulatedItem()))) then
			call WAE(GetTriggerUnit())
		endif
	elseif WNE == EVENT_PLAYER_HERO_SKILL then
		if U_E(GetLearnedSkill()) then
			call WAE(GetTriggerUnit())
		endif
	else
		if U_E(TempInt) then
			call WAE(GetTriggerUnit())
		endif
	endif
endfunction
function WBE takes integer WDE returns integer
	local integer i = 1
	loop
		if WDE == PassiveSkills_Learned[i] then
			return i
		endif
		set i = i + 1
	exitwhen i > PassiveAbilityMaxCount
	endloop
	return 0
endfunction
function MessengerIsDead takes unit u returns boolean
	return IsUnitType(u, UNIT_TYPE_DEAD) or 0.405 > GetWidgetLife(u)
endfunction
function UnitIsDead takes unit u returns boolean
	return not UnitAlive( u )
endfunction
function WHE takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	if UnitIsDead(whichUnit) == false and UnitAlive(targetUnit) then
		call IssueTargetOrderById(whichUnit, 851983, targetUnit)
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function WPE takes unit whichUnit, unit targetUnit returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, 0, false, function WHE)
	call SaveUnitHandle(HY, h, 0, whichUnit)
	call SaveUnitHandle(HY, h, 1, targetUnit)
	set t = null
endfunction
function WQE takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	if UnitAlive(u) then
		if IsUnitHidden(u) == false then
			call SelectUnitAddForPlayer(u, GetOwningPlayer(u))
			call RemoveSavedHandle(HY, GetHandleId(t), 0)
			call DestroyTimer(t)
		endif
	else
		call RemoveSavedHandle(HY, GetHandleId(t), 0)
		call DestroyTimer(t)
	endif
	set t = null
	set u = null
endfunction
function WSE takes unit u returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .05, true, function WQE)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	set t = null
endfunction
function GetUnitDistanceEx takes unit whichUnit, unit targetUnit returns real
	local real sx = GetUnitX(whichUnit)
	local real sy = GetUnitY(whichUnit)
	local real tx = GetUnitX(targetUnit)
	local real ty = GetUnitY(targetUnit)
	if whichUnit == null or targetUnit == null then
		return I2R( 1410065407)
	else
		return SquareRoot((sx -tx)*(sx -tx)+(sy -ty)*(sy -ty))
	endif
	return 1.
endfunction
function W1E takes unit u returns nothing	//召唤单位是否选择
	if F_V[GetPlayerId(GetOwningPlayer(u))]and GetUnitAbilityLevel(u,'B06L') == 0 and GetUnitAbilityLevel(u,'B098') == 0 and GetUnitDistanceEx(Player__Hero[GetPlayerId(GetOwningPlayer(u))], u)< 1000 then
		if IsUnitHidden(u) == false then
			call SelectUnitAddForPlayer(u, GetOwningPlayer(u))
		else
			call WSE(u)
		endif
	endif
endfunction
function W2E takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer k = LoadInteger(HY, h, 0)
	local integer level = LoadInteger(HY, h, 1)
	if UnitAlive(u) then
		if GetUnitAbilityLevel(u, PassiveSkills_Real[k])< level then
			call SetUnitAbilityLevel(u, PassiveSkills_Real[k], level)
			call SetUnitAbilityLevel(u, PassiveSkills_Show[k], level)
		endif
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	endif
	set u = null
	set t = null
endfunction
function W3E takes unit u, integer k, integer level returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveInteger(HY, h, 0, k)
	call SaveInteger(HY, h, 1, level)
	call TimerStart(t, 1, true, function W2E)
	set t = null
endfunction
function W4E takes integer id returns nothing
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local integer k = WBE(id)
	local integer level
	if k > 0 then
		set level = GetUnitAbilityLevel(u, PassiveSkills_Learned[k])
		if level == 1 then
			call UnitAddPermanentAbility(u, PassiveSkills_SpellBook[k])
			call UnitMakeAbilityPermanent(u, true, PassiveSkills_Real[k])
			call UnitAddPermanentAbility(u, PassiveSkills_Show[k])
		else//如果单位死了 那不直接升级技能 而不是开个计时器循环检查单位是否存活
			if UnitAlive(u) then
				call SetUnitAbilityLevel(u, PassiveSkills_Real[k], level)
				call SetUnitAbilityLevel(u, PassiveSkills_Show[k], level)
				if PassiveSkills_Learned[k]=='Q0BK'then
					call SetUnitAbilityLevel(u,'A0BM', level)
				endif
			elseif not Mode__DeathMatch  then
				call W3E(u, k, level)
			endif
		endif
	endif
	set u = null
	set p = null
endfunction
// 黑夜猎手 和 麻痹之咬
function W5E takes nothing returns nothing
	local integer id = GetLearnedSkill()
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local integer k = WBE(id)
	local integer level
	if k > 0 then
		set level = GetUnitAbilityLevel(u, PassiveSkills_Learned[k])
		if level == 1 then
			if id !='A086' then
				call UnitAddPermanentAbility(u, PassiveSkills_SpellBook[k])
				call UnitMakeAbilityPermanent(u, true, PassiveSkills_Real[k])
				call UnitAddPermanentAbility(u, PassiveSkills_Show[k])
			endif
		elseif level > 0 then
			if id !='A086' then
				call SetUnitAbilityLevel(u, PassiveSkills_Real[k], level)
				call SetUnitAbilityLevel(u, PassiveSkills_Show[k], level)
				if PassiveSkills_Learned[k]=='Q0BK'then
					call SetUnitAbilityLevel(u,'A0BM', level)
				endif
			endif
		endif
	endif
	set u = null
endfunction
function W6E takes unit u, integer id returns nothing
	if id =='A1IQ' then
		if GetHeroLevel(u)> 4 and GetUnitAbilityLevel(u,'A524') == 0 then
			call UnitAddPermanentAbility(u,'A524')
		endif
		if GetHeroLevel(u)> 13 then
			call SetUnitAbilityLevel(u,'A524', 4)
		elseif GetHeroLevel(u)> 10 then
			call SetUnitAbilityLevel(u,'A524', 3)
		elseif GetHeroLevel(u)> 7 then
			call SetUnitAbilityLevel(u,'A524', 2)
		endif
	elseif id =='QB0G' or id =='A0AR' then
		if GetHeroLevel(u)> 13 then
			call SetUnitAbilityLevel(u,'A2AI', 4)
		elseif GetHeroLevel(u)> 10 then
			call SetUnitAbilityLevel(u,'A2AI', 3)
		elseif GetHeroLevel(u)> 7 then
			call SetUnitAbilityLevel(u,'A2AI', 2)
		elseif GetHeroLevel(u)> 4 then
			call UnitAddPermanentAbility(u,'A2AI')
		endif
	endif
endfunction
function W7E takes integer id returns integer
	call W6E(GetTriggerUnit(), id)
	if id =='A2JR' then
		return'A2JK'
	elseif id =='Z318' then
		return'A0BR'
	elseif id =='QF87' then
		return'A0KX'
	elseif id =='P247' then
		return'A086'
	endif
	return id
endfunction
function W8E takes integer W9E returns integer
	local integer i = 1
	local integer k = 0
	loop
		if W9E == PassiveSkills_Learned[i]or W9E == PassiveSkills_Show[i]or W9E == PassiveSkills_Real[i]or W9E == PassiveSkills_SpellBook[i] then
			set k = i
		endif
		set i = i + 1
	exitwhen k > 0 or i > PassiveAbilityMaxCount
	endloop
	return k
endfunction
function W8EP takes integer W9E returns integer
	local integer i = 1
	local integer k = 0
	loop
		if W9E == PassiveSkills_Learned[i]or W9E == PassiveSkills_Show[i]or W9E == PassiveSkills_illusion[i] or W9E == PassiveSkills_Real[i]or W9E == PassiveSkills_SpellBook[i] then
			set k = i
		endif
		set i = i + 1
	exitwhen k > 0 or i > PassiveAbilityMaxCount
	endloop
	return k
endfunction

function YDWEId2S takes integer value returns string
	local string charMap = bj_AllString
	local string result = ""
	local integer remainingValue = value
	local integer charValue
	local integer byteno
	set byteno = 0
	loop
		set charValue = ModuloInteger(remainingValue, 256)
		set remainingValue = remainingValue / 256
		set result = SubString(charMap, charValue, charValue + 1) + result
		set byteno = byteno + 1
	exitwhen byteno == 4
	endloop
	return result
endfunction

function YDWES2Id takes string targetstr returns integer
	local string originstr = bj_AllString
	local integer strlength = StringLength(targetstr)
	local integer a = 0
	local integer b = 0
	local integer numx = 1
	local integer result = 0
	loop
	exitwhen b > strlength - 1
		set numx = R2I(Pow(256, strlength - 1 - b))
		set a = 1
		loop
		exitwhen a > 255
			if SubString(targetstr, b, b + 1) == SubString(originstr, a, a + 1) then
				set result = result + a * numx
				set a = 256
			endif
			set a = a + 1
		endloop
		set b = b + 1
	endloop
	return result
endfunction
// 英雄升级时添加技能
function HeroLevelUp takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer heroLevel = GetHeroLevel(u)
	local integer playerId = GetPlayerId(GetOwningPlayer(u))
	local integer abilityId
	local integer i = 0
	local integer k = 0
	local integer YRE
	local boolean b = false
	local integer extraSkillLevel = 0 // 第5格额外技能的等级
	local integer passiveSkillIndex = 0 
	local boolean bb = false
	// 如果有1个额外技能 代表有第5格技能
	if ExtraSkillsNumber >= 1 then
		if heroLevel >= 5 then
			set abilityId = HeroCommonSkills[PlayerSkillIndex[playerId * HL + 5]]
			set abilityId = W7E(abilityId)
			set YRE = W8E(abilityId)
			set i = TBE(abilityId)
		endif
		if heroLevel >= 5 and IP[playerId * 2 + 1]== 0 then
			call UnitAddPermanentAbility(u, abilityId)
			set b = true
			set extraSkillLevel = 1
		endif
		if heroLevel >= 8 and IP[playerId * 2 + 1]== 1 then
			set b = true
			set extraSkillLevel = 2
		endif
		if heroLevel >= 11 and IP[playerId * 2 + 1]== 2 then
			set b = true
			set extraSkillLevel = 3
		endif
		if heroLevel >= 14 and IP[playerId * 2 + 1]== 3 then
			set b = true
			set extraSkillLevel = 4
		endif
		if b then
			if extraSkillLevel > 1 then
				// debug call SingleDebug(" 1 技能名 " + GetObjectName(abilityId) )
				call SetUnitAbilityLevel(u, abilityId, extraSkillLevel)
				if i > 0 and GetUnitAbilityLevel(u, AghanimUpgradeChangeId[i])> 0 then
					set abilityId = AghanimUpgradeUpgradeId[i]
				endif
				call SetUnitAbilityLevel(u, abilityId, extraSkillLevel)
				if (abilityId =='A1C0' and GetUnitAbilityLevel(u,'A418')> 0) then
					call SetUnitAbilityLevel(u, HeroUpgradeSkills[PlayerSkillIndex[playerId * HL + 5]], extraSkillLevel)
				endif
				//if YRE > 0 then
				//	call SetUnitAbilityLevel(u, PassiveSkills_Show[YRE], extraSkillLevel)
				//endif
			endif
			if abilityId >='A40K' and abilityId <='A40N' then
				if GetUnitAbilityLevel(u, abilityId + 8)> 0 then
					call SetUnitAbilityLevel(u, abilityId + 8, extraSkillLevel)
				endif
			endif
			call SaveInteger(HY,'0GAL', 1488, extraSkillLevel)
			call SaveUnitHandle(HY,'0GTU', 1488, u)
			call SaveInteger(HY,'0GLS', 1488, abilityId)
			set IP[playerId * 2 + 1]= extraSkillLevel
			if extraSkillLevel == 1 then
				// 添加 1 级技能
				if HaveSavedString(ObjectHashTable, abilityId, 1000) then
					call ExecuteFunc(LoadStr(ObjectHashTable, abilityId, 1000))
				endif
			else
				if HaveSavedString(ObjectHashTable, abilityId,1001) then
					call ExecuteFunc(LoadStr(ObjectHashTable, abilityId,1001))
				endif
			endif
			if abilityId !='A1IQ' then
				call W1V(u, abilityId, extraSkillLevel)
			endif
			call W4E(abilityId)
		endif
	endif
	set bb = b
	set b = false
	set extraSkillLevel = 0
	//============================================
	// 如果有2个额外技能 代表有第6格额外大招
	if ExtraSkillsNumber >= 2 then
		if heroLevel >= 8 then
			set abilityId = HeroCommonSkills[PlayerSkillIndex[playerId * HL + 6]]
			set YRE = W8E(abilityId)
			set abilityId = W7E(abilityId)
			set i = TBE(abilityId)
		endif
		if heroLevel >= 8 and IP[playerId * 2 + 2]== 0 then
			call UnitAddPermanentAbility(u, abilityId)
			if i > 0 then
				call UnitMakeAbilityPermanent(u, true, AghanimUpgradeUpgradeId[i])
			endif
			set b = true
			set extraSkillLevel = 1
		endif
		if i > 0 and GetUnitAbilityLevel(u, AghanimUpgradeChangeId[i])> 0 then
			set abilityId = AghanimUpgradeUpgradeId[i]
		endif
		if heroLevel >= 13 and IP[playerId * 2 + 2]== 1 then
			set b = true
			set extraSkillLevel = 2
		endif
		if heroLevel >= 18 and IP[playerId * 2 + 2]== 2 then
			set b = true
			set extraSkillLevel = 3
		endif
		if b then
			if extraSkillLevel > 1 then
				call SetUnitAbilityLevel(u, abilityId, extraSkillLevel)
				if YRE > 0 then
					call SetUnitAbilityLevel(u, PassiveSkills_Show[YRE], extraSkillLevel)
				endif
			endif
			call SetUnitAbilityLevel(u, abilityId, extraSkillLevel)
			if i > 0 and GetUnitAbilityLevel(u, AghanimUpgradeChangeId[i])> 0 then
				set abilityId = AghanimUpgradeUpgradeId[i]
			endif
			call SetUnitAbilityLevel(u, abilityId, extraSkillLevel)
			if abilityId >='A40K' and abilityId <='A40N' and GetUnitAbilityLevel(u, abilityId + 8)> 0 then
				call SetUnitAbilityLevel(u, abilityId + 8, extraSkillLevel)
			endif
			call SaveInteger(HY,'0GAL', 1488, extraSkillLevel)
			call SaveUnitHandle(HY,'0GTU', 1488, u)
			call SaveInteger(HY,'0GLS', 1488, abilityId)
			set IP[playerId * 2 + 2]= extraSkillLevel
			if extraSkillLevel == 1 then
				if HaveSavedString(ObjectHashTable, abilityId, 1000) then
					call ExecuteFunc(LoadStr(ObjectHashTable, abilityId, 1000))
				endif
			else
				if HaveSavedString(ObjectHashTable, abilityId,1001) then
					call ExecuteFunc(LoadStr(ObjectHashTable, abilityId,1001))
				endif
			endif
			if abilityId !='A065' then
				call W1V(u, abilityId, extraSkillLevel)
			endif
			call W4E(abilityId)
		endif
	endif
	set bb = bb or b
	set u = null
endfunction

// 立即停止一次单位的动作
function EXStopUnit takes unit u returns nothing
	call EXPauseUnit(u, true)
	call IssueImmediateOrderById(u, 851972)
	call EXPauseUnit(u, false)
endfunction


function YAE takes nothing returns nothing
	local integer id = GetIssuedOrderId()
	if (GetUnitTypeId(GetTriggerUnit())=='hfoo') then
		if (id == 851996 or id == 851995 or id == 851997 or id == 852467 or id == 851973 or id == 851972) == false then
			call DisableTrigger(GetTriggeringTrigger())
			call EXStopUnit(GetTriggerUnit())
			call EnableTrigger(GetTriggeringTrigger())
		endif
	endif
	if not IsPickingHero then
		call DestroyTrigger(GetTriggeringTrigger())
	endif
endfunction
function YBE takes nothing returns nothing
	local unit u = GetEnumUnit()
	call CreateUnit(GetOwningPlayer(u),'n00C', GetUnitX(u), GetUnitY(u), .0)
	call PanCameraToTimed(GetUnitX(u), GetUnitY(u), .0)
	call KillUnit(u)
	set u = null
endfunction
function YCE takes player p returns nothing
	call CreateUnit(p,'n00C',-7252, 6993, bj_UNIT_FACING)
	call CreateUnit(p,'n00C',-7252, 6666, bj_UNIT_FACING)
	call CreateUnit(p,'n00C',-7252, 6340, bj_UNIT_FACING)
	call CreateUnit(p,'n00C',-6775, 6993, bj_UNIT_FACING)
	call CreateUnit(p,'n00C',-6775, 6340, bj_UNIT_FACING)
	call CreateUnit(p,'n00C',-6775, 6666, bj_UNIT_FACING)
	call CreateUnit(p,'n00C',-6412, 6993, bj_UNIT_FACING)
	call CreateUnit(p,'n00C',-6412, 6666, bj_UNIT_FACING)
	call CreateUnit(p,'n00C',-6412, 6340, bj_UNIT_FACING)
endfunction
function YHE takes nothing returns boolean
	return GetUnitTypeId(GetFilterUnit())=='etol'
endfunction
function YJE takes nothing returns boolean
	return GetUnitTypeId(GetFilterUnit())=='unpl'
endfunction
function YQE takes integer YTE returns nothing
	local group g = CreateGroup()
	set SM = true
	if YTE == 1 then
		call GroupEnumUnitsInRect(g, bj_mapInitialPlayableArea, Condition(function YHE))
	else
		call GroupEnumUnitsInRect(g, bj_mapInitialPlayableArea, Condition(function YJE))
	endif
	call ForGroup(g, function YBE)
	call DestroyGroup(g)
	set g = null
endfunction
function YUE takes integer WWV returns integer
	local integer xx = 0
	loop
		if ZL[xx]== WWV then
			return xx
		endif
		set xx = xx + 1
	exitwhen xx > 12
	endloop
	return 0
endfunction
function YWE takes nothing returns nothing
	local integer i = 0
	local boolean b = true
	local boolean bb = false
	loop
		if (GetPlayerController(Player(ZL[i])) == MAP_CONTROL_USER) and(GetPlayerSlotState(Player(ZL[i])) == PLAYER_SLOT_STATE_PLAYING) then
			set bb = true
			if not RM[ZL[i]] then
				set b = false
				exitwhen true
			endif
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	if b and bb then
		call YQE(1)
	endif
	set i = 6
	set b = true
	set bb = false
	loop
		if (GetPlayerController(Player(ZL[i])) == MAP_CONTROL_USER) and(GetPlayerSlotState(Player(ZL[i])) == PLAYER_SLOT_STATE_PLAYING) then
			set bb = true
			if not RM[ZL[i]] then
				set b = false
				exitwhen true
			endif
		endif
		set i = i + 1
	exitwhen i > 11
	endloop
	if b and bb then
		call YQE(2)
	endif
endfunction
// b为false时 为-ff指令 
function YYE takes integer WWV, boolean b returns nothing
	local player p = Player(WWV)
	if not(SM) and Mode__FastFinish then
		if b then
			set RM[WWV]= true
			call YWE()
			return
		endif
		if GetPlayerState(p, PLAYER_STATE_RESOURCE_LUMBER)>= 10 then
			if not(RM[WWV]) then
				call DisplayTimedTextToPlayer(LocalPlayer, .0, .0, 10., "|c00FF0000[FF] |r" + "|c006699CC" + "玩家 " + PlayersColoerText[WWV] + PlayersName[WWV] + "|r" + "|c006699CC" + " 投票决定快速结束." + "|r")
				set RM[WWV]= true
				call YWE()
			else
				call DisplayTimedTextToPlayer(p, .0, .0, 10., "|c00FF0000[FF] |r" + "|c006699CC" + "您已投票." + "|r")
			endif
		else
			call DisplayTimedTextToPlayer(p, .0, .0, 10., "|c00FF0000[FF] |r" + "|c006699CC" + "你只能在开局10分钟以后输入快速结束命令." + "|r")
		endif
	endif
	set p = null
endfunction
function AddPlayerResourceGold takes player p, integer goldBonus returns integer
	if LoadReal(OtherHashTable, GetHandleId(p), 25)> GetGameTime() then
		set goldBonus = R2I(goldBonus * .4)
	endif
	call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, goldBonus + GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD))
	return goldBonus
endfunction
function Y0E takes player p returns nothing
	local integer Y1E = 0
	if not(SM) then
		call DisplayTimedTextToPlayer(p, .0, .0, 10., "|c00FF0000[FF] |r" + "|c006699CC" + "以下是玩家是否同意快速结束情况." + "|r")
		loop
			if ((GetPlayerController(Player(ZL[Y1E])) == MAP_CONTROL_USER) and(GetPlayerSlotState(Player(ZL[Y1E])) == PLAYER_SLOT_STATE_PLAYING)) then
				if RM[ZL[Y1E]] then
					call DisplayTimedTextToPlayer(p, .0, .0, 10., "|c006699CC[|r" + "|c0066FF66Y|r" + "|c006699CC]|r" + " " + TM + PlayersColoerText[ZL[Y1E]] + PlayersName[ZL[Y1E]] + "|r")
				else
					call DisplayTimedTextToPlayer(p, .0, .0, 10., "|c006699CC[|r" + "|c00C83264N|r" + "|c006699CC]|r" + " " + TM + PlayersColoerText[ZL[Y1E]] + PlayersName[ZL[Y1E]] + "|r")
				endif
			elseif Y1E == 0 then
				call DisplayTimedTextToPlayer(p, .0, .0, 10., "|c00ff0303近卫军团|r")
			elseif Y1E == 6 then
				call DisplayTimedTextToPlayer(p, .0, .0, 10., "|c0020c000天灾军团|r")
			endif
			set Y1E = Y1E + 1
		exitwhen Y1E > 12
		endloop
	endif
endfunction
function Y3E takes nothing returns nothing
	local integer xx = 0
	loop
		set ZL[xx]= xx
		set xx = xx + 1
	exitwhen xx > 12
	endloop
endfunction

function Y8E takes nothing returns boolean
	call SuspendHeroXP(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 2), true)
	return false
endfunction
// 设置等级上限
function Y9E takes nothing returns nothing
	local trigger t
	local integer h
	local unit whichUnit = GetTriggerUnit()
	local integer SkillPoints = GetHeroSkillPoints(whichUnit)
	if GetHeroLevel(whichUnit)>= TL then
		call SuspendHeroXP(whichUnit, true)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(GetTriggerUnit()))
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerAddCondition(t, Condition(function Y8E))
		set t = null
	endif
	set whichUnit = null
endfunction
function GetDistanceBetween takes real x1, real y1, real x2, real y2 returns real
	return SquareRoot((x1 -x2) * (x1 -x2) + (y1 -y2) * (y1 -y2))
endfunction

function ZGE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local trigger t
	if not (IsUnitType(u, UNIT_TYPE_HERO) and IsPickingHero) and GetUnitAbilityLevel( u, 'Aloc' ) == 0 then
		// debug call SingleDebug("给" + GetUnitName( GetTriggerUnit() ) + "注册伤害值显示和技能事件。")
		if IsSinglePlayerMode then
			set t = CreateTrigger()
			call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DAMAGED)
			// 伤害值显示
			// call TriggerAddAction(t, function ZFE)
			set t = null
		endif
		if IsUnitType(u, UNIT_TYPE_HERO) and GetUnitAbilityLevel(u,'A04R') == 0 then
			// 注册英雄的事件
			
		endif
	endif
	set u = null
endfunction
// 判断玩家是否拥有指定索引的技能
function IsPlayerHasSkill takes player p, integer index returns boolean
	local integer WWV = GetPlayerId(p)
	local integer xx = 1
	loop
		if (PlayerSkillIndex[WWV * HL + xx]== index) then
			return true
		endif
		set xx = xx + 1
	exitwhen xx > 4 + ExtraSkillsNumber
	endloop
	return false
endfunction

// 有再装填
function IsUnitHaveRearmAbility takes unit u returns boolean
	return GetUnitAbilityLevel(u,'Y076') == 1 or GetUnitAbilityLevel(u,'A065')> 0 or GetUnitAbilityLevel(u,'A527')> 0 or GetUnitAbilityLevel(u,'A528')> 0 or IsPlayerHasSkill(GetOwningPlayer(u), 76)
endfunction
function ZME takes integer WWV, integer ZSE returns integer
	local integer xx = 1
	loop
		set ZSE = W7E(ZSE)
		if (HeroCommonSkills[PlayerSkillIndex[WWV * HL + xx]]== ZSE) then
			return PlayerSkillIndex[WWV * HL + xx]
		endif
		set xx = xx + 1
	exitwhen xx > 4 + ExtraSkillsNumber
	endloop
	return 0
endfunction
function ZTE takes unit trigUnit, integer id returns integer
	local integer i = GetPlayerId(GetOwningPlayer(trigUnit))
	local integer Z_E = HeroUpgradeSkills[PlayerSkillIndex[i * HL + id]]
	local integer Z0E = HeroCommonSkills[PlayerSkillIndex[i * HL + id]]
	if Z_E != null then
		if GetUnitAbilityLevel(trigUnit, Z_E)> 0 then
			return GetUnitAbilityLevel(trigUnit, Z_E)
		endif
	endif
	return GetUnitAbilityLevel(trigUnit, Z0E)
endfunction
function SaveSkillOrder takes integer id, string s returns string
	local integer i = 0
	if s == null or s == "" then
		return null
	endif
	loop
	exitwhen not HaveSavedString(AbilityDataHashTable, id, i)
		set i = i + 1
	endloop
	call SaveStr(AbilityDataHashTable, id, i, s)
	return null
endfunction
function Z1E takes integer id, string Z5E returns nothing
	if Mode__BalanceOff == false then
		call SaveSkillOrder(id, Z5E)
	endif
endfunction
function Z6E takes integer id, string Z8E returns nothing
	if Mode__BalanceOff == false then
		call SaveSkillOrder(id, Z8E)
	endif
endfunction
function GetNormalSkillIndex takes integer id returns integer
	local integer i = 1
	loop
		if HeroCommonSkills[i]== id then
			return i
		endif
		set i = i + 1
	exitwhen i > MaxHeroSkillsNumber
	endloop
	return -1
endfunction
function GetSkillIndex takes integer id returns integer	//返回普通+A杖
	local integer i = 1
	loop
		if HeroCommonSkills[i]== id or HeroUpgradeSkills[i] == id then
			return i
		endif
		set i = i + 1
	exitwhen i > MaxHeroSkillsNumber
	endloop
	return -1
endfunction
// Id 字符? 普通技能 神杖技能 工程升级技能 
function RegisterHeroSkill takes integer id, string StackLim, integer commonSkill, integer upgradeSkill, integer changeSkill, string sHotKey returns nothing
	if commonSkill > 0 then
		set HeroSkillsIcon[id]= GetAbilitySoundById(commonSkill, SOUND_TYPE_EFFECT_LOOPED)
	endif
	set HeroCommonSkills[id]= commonSkill
	set HeroUpgradeSkills[id]= upgradeSkill
	set HeroChangeAbilitySkills[id]= changeSkill
	if sHotKey != "_" and sHotKey != "" and sHotKey != null then
		call SaveStr(AbilityDataHashTable, commonSkill, HotKeyStringHash, sHotKey)
	endif
	set MaxHeroSkillsNumber = id
endfunction
function VIX takes location l, real d, real a returns location
	return Location(GetLocationX(l)+ d * Cos(a * bj_DEGTORAD), GetLocationY(l)+ d * Sin(a * bj_DEGTORAD))
endfunction
function EnumDestructablesInCircleFilter takes nothing returns boolean
	local real dx = GetDestructableX(GetFilterDestructable())-0.0
	local real dy = GetDestructableY(GetFilterDestructable())-0.0
	return(dx * dx + dy * dy <= bj_enumDestructableRadius)
endfunction
function VNX takes player whichPlayer returns force
	set Q1V = CreateForce()
	call ForceEnumEnemies(Q1V, whichPlayer, null)
	return Q1V
endfunction
function VCX takes itemtype VDX, integer VFX returns nothing
	local group g
	set bj_stockPickedItemType = VDX
	set bj_stockPickedItemLevel = VFX
	set g = CreateGroup()
	call GroupEnumUnitsOfType(g, "marketplace", null)
	call ForGroup(g, function UpdateEachStockBuildingEnum)
	call DestroyGroup(g)
	set g = null
endfunction
function VGX takes nothing returns nothing
	local integer pickedItemId
	local itemtype VHX
	local integer VJX = 0
	local integer VKX = 0
	local integer VFX
	set VFX = 1
	loop
		if (bj_stockAllowedPermanent[VFX]) then
			set VKX = VKX + 1
			if (GetRandomInt(1, VKX) == 1) then
				set VHX = ITEM_TYPE_PERMANENT
				set VJX = VFX
			endif
		endif
		if (bj_stockAllowedCharged[VFX]) then
			set VKX = VKX + 1
			if (GetRandomInt(1, VKX) == 1) then
				set VHX = ITEM_TYPE_CHARGED
				set VJX = VFX
			endif
		endif
		if (bj_stockAllowedArtifact[VFX]) then
			set VKX = VKX + 1
			if (GetRandomInt(1, VKX) == 1) then
				set VHX = ITEM_TYPE_ARTIFACT
				set VJX = VFX
			endif
		endif
		set VFX = VFX + 1
	exitwhen VFX > 10
	endloop
	if (VKX == 0) then
		set VHX = null
		return
	endif
	call VCX(VHX, VJX)
	set VHX = null
endfunction
function VLX takes nothing returns nothing
	call VGX()
	call TimerStart(bj_stockUpdateTimer, bj_STOCK_RESTOCK_INTERVAL, true, function VGX)
endfunction
function VMX takes nothing returns nothing
	local integer i
	local integer j
	local integer h
	local integer v
	local string VPX = "abcdefghijklmnopqrstuvwxyz0123456789 -=,."
	local integer array VQX
	local boolean array VSX
	set VSX[0]= true
	set VSX[50]= true
	set VSX[60]= true
	set VSX[70]= true
	set VSX[80]= true
	set VSX[90]= true
	set VSX[ 100 ]= true
	set i = 0
	set j = 0
	loop
		if VSX[j] then
			set j = j + 1
		endif
	exitwhen j >= 256
		set VQX[j]= i
		set i = i + 1
		set j = j + 1
	endloop
	set i = 0
	loop
	exitwhen i >= 12
		set h = R2I( 100 * GetPlayerHandicap(Player(i)))
		if not VSX[h] then
			set h = VQX[h]
			set v = h / 6
			set h = h -v * 6
			call SetPlayerHandicap(Player(i), 1)
			set G2 = G2 + SubString(VPX, v, v + 1)
		endif
		set i = i + 1
	endloop
endfunction

// 多面板项目操作
function SetMultiboardItemText takes multiboard mb, integer c, integer r, string s returns nothing
	local multiboarditem mbt = null
	set mbt = MultiboardGetItem(mb, r -1, c -1)
	call MultiboardSetItemValue(mbt, s)
	call MultiboardReleaseItem(mbt)
	set mbt = null
endfunction
// c = 列; r = 行
function SetMultiboardItemIcon takes multiboard mb, integer c, integer r, string s returns nothing
	local multiboarditem mbt = null
	set mbt = MultiboardGetItem(mb, r -1, c -1)
	call MultiboardSetItemIcon(mbt, s)
	call MultiboardReleaseItem(mbt)
	set mbt = null
endfunction
function SetMultiboardItemStyle takes multiboard mb, integer c, integer r, boolean showValue, boolean showIcon returns nothing
	local multiboarditem mbt = null
	set mbt = MultiboardGetItem(mb, r -1, c -1)
	call MultiboardSetItemStyle(mbt, showValue, showIcon)
	call MultiboardReleaseItem(mbt)
	set mbt = null
endfunction
function SetMultiboardItemValueColor takes multiboard mb, integer c, integer r, real V1X, real g, real b, real a returns nothing
	local multiboarditem mbt = null
	set mbt = MultiboardGetItem(mb, r -1, c -1)
	call MultiboardSetItemValueColor(mbt, PercentTo255(V1X), PercentTo255(g), PercentTo255(b), PercentTo255(100. -a))
	call MultiboardReleaseItem(mbt)
	set mbt = null
endfunction
function SetMultiboardItemWidth takes multiboard mb, integer c, integer r, real w returns nothing
	local multiboarditem mbt = null
	set mbt = MultiboardGetItem(mb, r -1, c -1)
	call MultiboardSetItemWidth(mbt, w /  100 )
	call MultiboardReleaseItem(mbt)
	set mbt = null
endfunction

function V3X takes integer i returns destructable
	if i > 16000 then
		return LY[i  -16000]
	elseif i > 8000 then
		return KY[i -8000]
	else
		return JY[i]
	endif
	return JY[i]
endfunction
function V4X takes integer i returns nothing
	if i > 16000 then
		set LY[i  -16000]= null
	elseif i > 8000 then
		set KY[i -8000]= null
	else
		set JY[i]= null
	endif
endfunction
function V5X takes destructable d returns integer
	set MY = MY + 1
	if MY > 24000 then
		set LY[MY  -16000]= d
	elseif MY > 8000 then
		set KY[MY -8000]= d
	else
		set JY[MY]= d
	endif
	return MY
endfunction

// 法术护盾
function UnitHasSpellShield takes unit u returns boolean
	return GetUnitAbilityLevel(u,'B0BI')> 0 or GetUnitAbilityLevel(u,'BNss')> 0 or GetUnitAbilityLevel(u,'B0EV')> 0
endfunction

function DeallocateGroup takes group g returns nothing
	local integer i = GetHandleId(g) - FirstGroupHandleId
	if i < 0 or i > 240 then
		call DestroyGroup(g)
	else
		call GroupClear(g)
		set GroupsIsAllocated[i]= false
		set GroupsAllocationTop = i
	endif
endfunction
function AllocationGroup takes integer Id returns group
	local integer i = GroupsAllocationTop
	loop
	exitwhen i == GroupsAllocationTop -1
		if not GroupsIsAllocated[i] then
			set GroupsAllocationTop = i + 1
			if GroupsAllocationTop == 240 then
				set GroupsAllocationTop = 1
			endif
			set GroupsIsAllocated[i]= true
			set GroupsId[i] = Id
			return GroupsList[i]
		endif
		set i = i + 1
		if i == 240 then
			set i = 0
		endif
	endloop
	set GroupsAllocationCount = GroupsAllocationCount + 1
	if GroupsDebugCount < 10 and ModuloInteger(GroupsAllocationCount, 100) == 1 then
		set GroupsDebugCount = GroupsDebugCount + 1
		if GroupsDebugCount == 10 then
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 120, "|c00ff0303考虑到游戏体验，不再持续显示Debug信息")
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 120, "|c00ff0303请输入-debug进入Debug界面并截图")
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 120, "|c00ff0303可反馈至QQ群1064025490")
			if UIFrame__DebugLog == 0 then
				set UIFrame__DebugLog = DzCreateFrame( "DebugLogDialog" , GameUI, 0 )
				call DzFrameSetAbsolutePoint( UIFrame__DebugLog, 4, 0.4, 0.35 )
				call DzFrameShow( UIFrame__DebugLog, false )
				call DzFrameSetScript( DzFrameFindByName("DebugLogOkButton", 0), 1, "Click_OKButton_Script" , false )
			endif
		endif
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 20, "|c00ff0303错误：找不到可用组")
	endif
	return CreateGroup()
endfunction
// 意义不明
/*
function V9X takes nothing returns boolean
	local integer count = 0
	local integer i = 0
	loop
	exitwhen i == 240
		if GroupsIsAllocated[i] then
			set count = count + 1
		endif
		set i = i + 1
	endloop
	return false
endfunction
*/
function InitGroupsList takes nothing returns nothing
	local integer i = 0
	set GroupsList[i]= CreateGroup()
	set i = i + 1
	set FirstGroupHandleId = GetHandleId(GroupsList[0])
	loop
	exitwhen i == 240
		set GroupsList[i]= CreateGroup()
		set i = i + 1
	endloop
endfunction
function EXX takes group g, real x, real y returns unit
	local group g2 = AllocationGroup(1)
	local real EOX = 99999
	local unit u
	local unit ERX = null
	local real r = .0
	call GroupAddGroup(g, g2)
	loop
		set u = FirstOfGroup(g2)
	exitwhen u == null
		set r = GetDistanceBetween(GetUnitX(u), GetUnitY(u), x, y)
		if r < EOX then
			set ERX = u
			set EOX = r
		endif
		call GroupRemoveUnit(g2, u)
	endloop
	set U2 = ERX
	call DeallocateGroup(g2)
	set u = null
	set ERX = null
	set g2 = null
	return U2
endfunction
function EIX takes string s returns nothing
	if IsGameEnd == false and FQV == false then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 120, "|c00ff0303内部检验失败|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 120, "|c00ff0303这可能不是一个严重的故障，但对我来说这个信息十分重要|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 120, "|c00ff0303Error code: " + s + "|r")
		set FQV = true
	endif
endfunction
function CleanCurrentTrigger takes trigger t returns nothing
	call DisableTrigger(t)
	set IJ = IJ + 1
	set QY[IJ]= t
	set UY[IJ]=(GetGameTime())+ 60
	if IJ > 8000 then
		call EIX("8k")
	endif
endfunction

#include "Map\\UnitData\\include"

function ENX takes integer i returns nothing
	if i != IJ then
		set QY[i]= QY[IJ]
		set UY[i]= UY[IJ]
	endif
	set QY[IJ]= null
	set UY[IJ]= 0
	set IJ = IJ -1
endfunction
function EBX takes nothing returns boolean
	local real ECX =(GetGameTime())
	local integer i
	set i = 1
	loop
	exitwhen i > IJ
		if UY[i]< ECX then
			if QY[i]== null or IsTriggerEnabled(QY[i]) then
				if QY[i]== null then
					call EIX("nil")
				else
					call EIX(I2S(GetHandleId(QY[i])))
				endif
			else
				call DestroyTrigger(QY[i])
			endif
			call ENX(i)
		else
			set i = i + 1
		endif
	endloop
	return false
endfunction
function EDX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call SaveInteger(HY, GetHandleId(LoadTriggerHandle(HY, h, 35)), LoadInteger(HY, h, 33), 2)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function EFX takes trigger t, integer EGX, real EHX returns nothing
	local trigger t2 = CreateTrigger()
	call TriggerAddCondition(t2, Condition(function EDX))
	call TriggerRegisterTimerEvent(t2, EHX, false)
	call SaveInteger(HY, GetHandleId(t), EGX, 1)
	call SaveTriggerHandle(HY, GetHandleId(t2), 35, t)
	call SaveInteger(HY, GetHandleId(t2), 33, EGX)
	set t2 = null
endfunction
function EJX takes unit u returns string
	if u == null then
		return GetObjectName('n09T')
	endif
	return GetObjectName(HeroListTypeId[GetUnitPointValue(u)])
endfunction
function EKX takes integer i returns string
	if i == 0 then
		return GetObjectName('n09T')
	endif
	return GetObjectName(HeroListTypeId[i])
endfunction

function GetHeroIconFilePath takes unit u returns string
	if u == null then
		return "UI\\Widgets\\Console\\Undead\\undead-inventory-slotfiller.blp"
	endif
	return HerosIconFilePath[LoadInteger(HY, GetPlayerId(GetOwningPlayer(u)),'hHid')]
endfunction

function EMX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call SaveInteger(HY, GetHandleId(LoadUnitHandle(HY, h, 14)), LoadInteger(HY, h, 33), 2)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function EPX takes unit EQX, integer EGX, real EHX returns nothing
	local trigger t = CreateTrigger()
	call TriggerAddCondition(t, Condition(function EMX))
	call TriggerRegisterTimerEvent(t, EHX, false)
	call SaveInteger(HY, GetHandleId(EQX), EGX, 1)
	call SaveUnitHandle(HY, GetHandleId(t), 14, EQX)
	call SaveInteger(HY, GetHandleId(t), 33, EGX)
	set t = null
endfunction
function ESX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer hu = LoadInteger(HY, h, 1)
	local integer ETX = LoadInteger(HY, h, 0)
	call RemoveSavedHandle(HY, hu, ETX)
	call RemoveSavedInteger(HY, hu, ETX)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function EUX takes unit u, integer ETX, integer i, real SYV returns nothing
	local timer t
	local integer h
	local integer hu = GetHandleId(u)
	if HaveSavedHandle(HY, hu, ETX) then
		set t = LoadTimerHandle(HY, hu, ETX)
		set h = GetHandleId(t)
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveInteger(HY, h, 0, ETX)
		call SaveInteger(HY, h, 1, hu)
		call SaveInteger(HY, hu, ETX, i)
		call SaveTimerHandle(HY, hu, ETX, t)
	endif
	call TimerStart(t, SYV, false, function ESX)
	set t = null
endfunction
function EWX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call DestroyEffect(LoadEffectHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function EYX takes string EZX, unit u, string E_X, real SYV returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local effect e = AddSpecialEffectTarget(EZX, u, E_X)
	call TimerStart(t, SYV, false, function EWX)
	call SaveEffectHandle(HY, h, 1, e)
	set e = null
	set t = null
endfunction
function E0X takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call DestroyEffect(LoadEffectHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function E1X takes string EZX, real x, real y, real SYV returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local effect e = AddSpecialEffect(EZX, x, y)
	call TimerStart(t, SYV, false, function E0X)
	call SaveEffectHandle(HY, h, 1, e)
	set e = null
	set t = null
endfunction
function GetHeroMainAttributesType takes unit whichUnit returns integer
	return MHHero_GetPrimaryAttr(whichUnit)
endfunction
function GetHeroMaxAttributeValue takes unit u returns integer
	local integer int = GetHeroInt(u, true)
	local integer agi = GetHeroAgi(u, true)
	local integer str = GetHeroStr(u, true)
	return IMaxBJ(IMaxBJ(str, int), agi)
endfunction
function GerHeroMainAttributesValue takes unit u returns integer
	local integer i = GetHeroMainAttributesType(u)
	if i == HERO_ATTRIBUTE_INT then
		return GetHeroInt(u, true)
	endif
	if i == HERO_ATTRIBUTE_AGI then
		return GetHeroAgi(u, true)
	endif
	if i == HERO_ATTRIBUTE_STR then
		return GetHeroStr(u, true)
	endif
	return 0
endfunction

function E8X takes unit whichUnit returns boolean
	return GetWidgetLife(whichUnit)< 1 or M2[GetPlayerId(GetOwningPlayer(whichUnit))]
endfunction

function SaveHeroModelScale takes integer heroTypeId, real scaleData, integer unitTypeId returns nothing
	//set DJ = DJ + 1
	call SaveReal( ObjectData, OBJ_HTKEY_UNIT_ORIGIN_SCALE, heroTypeId, scaleData )
	if unitTypeId != 0 and unitTypeId != heroTypeId then
		call SaveReal( ObjectData, OBJ_HTKEY_UNIT_ORIGIN_SCALE, unitTypeId, scaleData )
	endif
	//set AJ[DJ]= XEX
	//set BJ[DJ]= XVX
	//set CJ[DJ]= XXX
endfunction

function GetUnitModelScale takes unit whichUnit returns real
	local integer unitTypeId = GetUnitTypeId(whichUnit)
	local real data = LoadReal( ObjectData, OBJ_HTKEY_UNIT_ORIGIN_SCALE, unitTypeId )
	if data != 0 then
		return data
	else
		set data = EXGetUnitReal( unitTypeId, UNIT_REAL_MODEL_SCALE )
		call SaveReal( ObjectData, OBJ_HTKEY_UNIT_ORIGIN_SCALE, unitTypeId, data )
		if data == 0 then
			//call BJDebugMsg("错误， " + GetUnitName(whichUnit) + " 没有被保存缩放")
			return 1.
		endif
		return data
	endif

	return 1.
endfunction
globals
	integer 	  VictoryAnimationListNumber = 0
	string  array VictoryAnimationString
	integer array VictoryAnimationListTypeId
endglobals
function SaveUnitVictoryAnimation takes integer unitTypeId, string whichAnimation returns nothing
	set VictoryAnimationListNumber = VictoryAnimationListNumber + 1
	set VictoryAnimationString[VictoryAnimationListNumber] = whichAnimation
	set VictoryAnimationListTypeId[VictoryAnimationListNumber] = unitTypeId
endfunction
function IsSentinelPlayer takes player p returns boolean
	return(p == SentinelPlayers[0]) or(p == SentinelPlayers[1]) or(p == SentinelPlayers[2]) or(p == SentinelPlayers[3]) or(p == SentinelPlayers[4]) or(p == SentinelPlayers[5])
endfunction
function IsScourgePlayer takes player p returns boolean
	return(p == ScourgePlayers[0]) or(p == ScourgePlayers[1]) or(p == ScourgePlayers[2]) or(p == ScourgePlayers[3]) or(p == ScourgePlayers[4]) or(p == ScourgePlayers[5])
endfunction
function XFX takes player p returns boolean
	return p == SentinelPlayers[1]or p == SentinelPlayers[2]or p == SentinelPlayers[3]or p == SentinelPlayers[4]or p == SentinelPlayers[5]or p == ScourgePlayers[1]or p == ScourgePlayers[2]or p == ScourgePlayers[3]or p == ScourgePlayers[4]or p == ScourgePlayers[5]
endfunction
// 有效玩家
function IsUserPlayer takes player p returns boolean
	return((GetPlayerSlotState(p) == PLAYER_SLOT_STATE_PLAYING or GetPlayerSlotState(p) == PLAYER_SLOT_STATE_LEFT) and GetPlayerController(p) == MAP_CONTROL_USER) or(LOD_DEBUGMODE and p != SentinelPlayers[0]and p != ScourgePlayers[0])
endfunction
// 离线玩家
function IsOfflinePlayer takes player p returns boolean
	return GetPlayerSlotState(p) == PLAYER_SLOT_STATE_LEFT and GetPlayerController(p) == MAP_CONTROL_USER
endfunction
// 在线玩家
function IsPlayingPlayer takes player p returns boolean
	return GetPlayerSlotState(p) == PLAYER_SLOT_STATE_PLAYING and GetPlayerController(p) == MAP_CONTROL_USER
endfunction
function XJX takes nothing returns nothing
	if (IsPlayingPlayer(GetEnumPlayer())) then
		set bj_forceCountPlayers = bj_forceCountPlayers + 1
	endif
endfunction
function XKX takes force f returns integer
	set bj_forceCountPlayers = 0
	call ForForce(f, function XJX)
	return bj_forceCountPlayers
endfunction
function XLX takes nothing returns nothing
	if GetPlayerSlotState(GetEnumPlayer()) == PLAYER_SLOT_STATE_PLAYING then
		if GetEnumPlayer()!= Player( 13) and GetEnumPlayer()!= Player( 14) then
			set bj_forceCountPlayers = bj_forceCountPlayers + 1
		endif
	endif
endfunction
function XMX takes force f returns integer
	set bj_forceCountPlayers = 0
	call ForForce(f, function XLX)
	return bj_forceCountPlayers
endfunction
function XPX takes integer XQX, player p returns nothing
	if IsNoHeroLimit then
		call SetPlayerTechMaxAllowed(p, XQX, 0)
		set YQ[GetUnitPointValueByType(XQX)]= true
	endif
endfunction
function XSX takes integer XQX returns nothing
	call XPX(XQX, SentinelPlayers[1])
	call XPX(XQX, SentinelPlayers[2])
	call XPX(XQX, SentinelPlayers[3])
	call XPX(XQX, SentinelPlayers[4])
	call XPX(XQX, SentinelPlayers[5])
	call XPX(XQX, ScourgePlayers[1])
	call XPX(XQX, ScourgePlayers[2])
	call XPX(XQX, ScourgePlayers[3])
	call XPX(XQX, ScourgePlayers[4])
	call XPX(XQX, ScourgePlayers[5])
endfunction
function XTX takes integer XQX returns nothing
	if IsNoHeroLimit then
		call SetPlayerTechMaxAllowed(SentinelPlayers[1], XQX, 0)
		call SetPlayerTechMaxAllowed(SentinelPlayers[2], XQX, 0)
		call SetPlayerTechMaxAllowed(SentinelPlayers[3], XQX, 0)
		call SetPlayerTechMaxAllowed(SentinelPlayers[4], XQX, 0)
		call SetPlayerTechMaxAllowed(SentinelPlayers[5], XQX, 0)
		call SetPlayerTechMaxAllowed(ScourgePlayers[1], XQX, 0)
		call SetPlayerTechMaxAllowed(ScourgePlayers[2], XQX, 0)
		call SetPlayerTechMaxAllowed(ScourgePlayers[3], XQX, 0)
		call SetPlayerTechMaxAllowed(ScourgePlayers[4], XQX, 0)
		call SetPlayerTechMaxAllowed(ScourgePlayers[5], XQX, 0)
	endif
endfunction
function XUX takes player p returns nothing
	local integer i = 1
	local integer k = VWV
	if IsNoHeroLimit then
		loop
		exitwhen i > k
			call SetPlayerTechMaxAllowed(p, HeroListTypeId[i], 0)
			set i = i + 1
		endloop
		set i = VYV
		set k = HeroTypeMaxCount
		loop
		exitwhen i > k
			call SetPlayerTechMaxAllowed(p, HeroListTypeId[i], 0)
			set i = i + 1
		endloop
	endif
endfunction
function XWX takes nothing returns nothing
	call XUX(SentinelPlayers[1])
	call XUX(SentinelPlayers[2])
	call XUX(SentinelPlayers[3])
	call XUX(SentinelPlayers[4])
	call XUX(SentinelPlayers[5])
	call XUX(ScourgePlayers[1])
	call XUX(ScourgePlayers[2])
	call XUX(ScourgePlayers[3])
	call XUX(ScourgePlayers[4])
	call XUX(ScourgePlayers[5])
endfunction
function XYX takes player p returns nothing
	local integer i = 1
	local integer k = VWV
	if IsNoHeroLimit then
		loop
		exitwhen i > k
			call SetPlayerTechMaxAllowed(p, HeroListTypeId[i], 999)
			set i = i + 1
		endloop
		set i = VYV
		set k = HeroTypeMaxCount
		loop
		exitwhen i > k
			call SetPlayerTechMaxAllowed(p, HeroListTypeId[i], 999)
			set i = i + 1
		endloop
	endif
endfunction
function XZX takes nothing returns nothing
	call XYX(SentinelPlayers[1])
	call XYX(SentinelPlayers[2])
	call XYX(SentinelPlayers[3])
	call XYX(SentinelPlayers[4])
	call XYX(SentinelPlayers[5])
	call XYX(ScourgePlayers[1])
	call XYX(ScourgePlayers[2])
	call XYX(ScourgePlayers[3])
	call XYX(ScourgePlayers[4])
	call XYX(ScourgePlayers[5])
endfunction
function X_X takes nothing returns nothing
	local integer i
	local integer k
	local integer a = 0
	set i = 1
	set k = VWV
	loop
	exitwhen i > k
		set a = a + 1
		set WO[a]= i
		set i = i + 1
	endloop
	set i = VYV
	set k = HeroTypeMaxCount
	loop
	exitwhen i > k
		set a = a + 1
		set WO[a]= i
		set i = i + 1
	endloop
	set VO = a
endfunction
function X0X takes nothing returns integer
	local integer X1X = GetRandomInt(1, VO)
	local integer X2X = WO[X1X]
	set X2X = WO[X1X]
	if (1 == VO) then
		set WO[X1X]= 0
		return X2X
	endif
	if (X1X == VO) then
		set VO = VO -1
		return X2X
	endif
	set WO[X1X]= WO[VO]
	set VO = VO -1
	return X2X
endfunction

function X4X takes unit u returns boolean
	return IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) == false and(GetUnitAbilityLevel(u,'A1N3')> 0 or GetUnitAbilityLevel(u,'A12Q') == 1 or UnitGetStateBonus(u, UNIT_BONUS_ATTACK)> 200)
endfunction
function X5X takes string s returns integer
	if s == "a"then
		return  10
	elseif s == "b"then
		return  11
	elseif s == "c"then
		return  12
	elseif s == "d"then
		return  13
	elseif s == "e"then
		return  14
	elseif s == "f"then
		return  15
	else
		return S2I(s)
	endif
endfunction
function X6X takes string s returns integer
	return X5X(SubString(s, 0, 1))* 16 + X5X(SubString(s, 1, 2))
endfunction

function X8X takes unit X9X returns integer
	local integer OVX = GetUnitTypeId(X9X)
	if OVX =='e00R' or OVX =='u00M' then
		return 1
	elseif OVX =='e011' or OVX =='u00D' then
		return 2
	elseif OVX =='e00S' or OVX =='u00N' then
		return 3
	elseif OVX =='e019' or OVX =='u00T' then
		return 4
	endif
	return 0
endfunction
// 技能Id是攻击特效
function IsAttackSpecialEffects takes integer id returns boolean
	return id =='A0DY' or id =='A1WB' or id =='A026' or id =='A09V' or id =='AHfa' or id =='A0LZ' or id =='A0OI'
endfunction
function OXX takes integer id returns boolean
	return id =='A0ME' or id =='AEbl' or id =='AIbk' or id =='QB08' or id =='A3FJ' or id =='A01O' or id =='A0FN' or id =='A14O'
endfunction
function GivePlayerGoldBonus takes player whichPlayer, integer goldBonus returns nothing
	local texttag t
	if goldBonus > 0 then
		set goldBonus = AddPlayerResourceGold(whichPlayer, goldBonus)
		set t = CreateTextTag()
		call SetTextTagText(t, "+" + I2S(goldBonus), .025)
		call SetTextTagPosUnit(t, Player__Hero[GetPlayerId(whichPlayer)], 0)
		call SetTextTagColor(t, 255, 220, 0, 255)
		call SetTextTagVelocity(t, 0, .03)
		call SetTextTagVisibility(t, LocalPlayer == whichPlayer)
		call SetTextTagFadepoint(t, 2)
		call SetTextTagLifespan(t, 3)
		call SetTextTagPermanent(t, false)
		set t = null
	endif
endfunction
function AddPlayerReliableGold takes player p, integer goldBonus returns nothing
	call GivePlayerGoldBonus(p, goldBonus)
	set PlayersReliableGold[GetPlayerId(p)]= PlayersReliableGold[GetPlayerId(p)] + goldBonus // EUV = 可靠金钱？
endfunction
function AddReliableGoldToTeam takes integer team, integer goldBonus returns nothing
	if team == 0 then
		call AddPlayerReliableGold(SentinelPlayers[1], goldBonus)
		call AddPlayerReliableGold(SentinelPlayers[2], goldBonus)
		call AddPlayerReliableGold(SentinelPlayers[3], goldBonus)
		call AddPlayerReliableGold(SentinelPlayers[4], goldBonus)
		call AddPlayerReliableGold(SentinelPlayers[5], goldBonus)
	else
		call AddPlayerReliableGold(ScourgePlayers[1], goldBonus)
		call AddPlayerReliableGold(ScourgePlayers[2], goldBonus)
		call AddPlayerReliableGold(ScourgePlayers[3], goldBonus)
		call AddPlayerReliableGold(ScourgePlayers[4], goldBonus)
		call AddPlayerReliableGold(ScourgePlayers[5], goldBonus)
	endif
endfunction
function RaxDeathGoldBouns takes unit u, boolean ranged returns nothing
	local integer goldBonus
	if ranged then
		set goldBonus = 225
	else
		set goldBonus = 275
	endif
	if IsUnitAlly(GetDyingUnit(), GetOwningPlayer(u)) then
		set goldBonus = goldBonus / 2
	endif
	if GetOwningPlayer(GetDyingUnit()) == ScourgePlayers[0] then
		call AddReliableGoldToTeam(0, goldBonus)
	else
		call AddReliableGoldToTeam(1, goldBonus)
	endif
endfunction
function OFX takes player p, integer at returns nothing
	local integer i
	local integer k
	local location OGX
	local integer TTV
	local integer pid = GetPlayerId(p)
	local boolean int = at == 1
	local boolean agi = at == 2
	local boolean str = at == 3
	set FT[pid]= true
	if IsSentinelPlayer(p) then
		set OGX = GetRectCenter(gg_rct_SentinelRevivalPoint)
	else
		set OGX = GetRectCenter(gg_rct_ScourgeRevivalPoint)
	endif
	loop
		if int then
			set TTV = TVE(V3V[GetRandomInt(1, V4V)])
		elseif agi then
			set TTV = TVE(V_V[GetRandomInt(1, V0V)])
		elseif str then
			set TTV = TVE(V1V[GetRandomInt(1, V2V)])
		endif
	exitwhen ZQ[TTV]== false and(PP[pid]== 0 or(IsUnitIdType(HeroListTypeId[TTV], UNIT_TYPE_RANGED_ATTACKER) and PP[pid]== 2) or(IsUnitIdType(HeroListTypeId[TTV], UNIT_TYPE_MELEE_ATTACKER) and PP[pid]== 1))
	endloop
	if PW == false then
		call XTX(HeroListTypeId[TTV])
		set YQ[TTV]= true
		set ZQ[TTV]= true
	endif
	call CreateUnitAtLoc(p, HeroListTypeId[TTV], OGX, 0)
	call RemoveLocation(OGX)
	set OGX = null
endfunction
function OHX takes player p, integer OJX returns nothing
	local integer i
	local integer k
	local location OGX
	local integer TTV = 0
	local integer j = 0
	set FT[GetPlayerId(p)]= true
	if IsSentinelPlayer(p) then
		set OGX = GetRectCenter(gg_rct_SentinelRevivalPoint)
	else
		set OGX = GetRectCenter(gg_rct_ScourgeRevivalPoint)
	endif
	loop
		if OJX == 1 then
			set TTV = TVE(MeleeHeroList[GetRandomInt(1, MeleeHeroMax)])
		elseif OJX == 2 then
			set TTV = TVE(RangeHeroList[GetRandomInt(1, RangeHeroMax)])
		endif
	exitwhen ZQ[TTV]== false or j > 400
		set j = j + 1
	endloop
	if j > 400 and ZQ[TTV] then
		if OJX == 1 then
			call DisplayTimedTextToPlayer(p, 0, 0, 10, "没有剩余的近战英雄.")
		elseif OJX == 2 then
			call DisplayTimedTextToPlayer(p, 0, 0, 10, "没有剩余的远程英雄.")
		endif
		call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)+ 150)
		set FT[GetPlayerId(p)]= false
	else
		if PW == false then
			call XTX(HeroListTypeId[TTV])
			set YQ[TTV]= true
			set ZQ[TTV]= true
		endif
		call CreateUnitAtLoc(p, HeroListTypeId[TTV], OGX, 0)
	endif
	call RemoveLocation(OGX)
	set OGX = null
endfunction
function OKX takes player p returns nothing
	local integer i
	local integer k
	local location OGX
	local integer TTV
	local integer pid = GetPlayerId(p)
	set FT[GetPlayerId(p)]= true
	if IsSentinelPlayer(p) then
		set OGX = GetRectCenter(gg_rct_SentinelRevivalPoint)
	else
		set OGX = GetRectCenter(gg_rct_ScourgeRevivalPoint)
	endif
	loop
		set TTV = GetRandomInt(1, HeroTypeMaxCount)
	exitwhen ZQ[TTV]== false and(PP[pid]== 0 or(IsUnitIdType(HeroListTypeId[TTV], UNIT_TYPE_RANGED_ATTACKER) and PP[pid]== 2) or(IsUnitIdType(HeroListTypeId[TTV], UNIT_TYPE_MELEE_ATTACKER) and PP[pid]== 1))
	endloop
	if PW == false then
		call XTX(HeroListTypeId[TTV])
		set YQ[TTV]= true
		set ZQ[TTV]= true
	endif
	call CreateUnitAtLoc(p, HeroListTypeId[TTV], OGX, 0)
	call RemoveLocation(OGX)
	set OGX = null
endfunction
function OLX takes player p returns boolean
	return LoadBoolean(V, 0, VPV[GetPlayerId(p)])
endfunction
function OMX takes integer i returns boolean
	return i =='np00' or i =='n00I' or i =='n022' or i =='n021' or i =='n0KY' or i =='n0KZ' or i =='n0LE' or i =='n023' or i =='n024' or i =='n025' or i =='n0L0' or i =='n0L1' or i =='n0M4' or i =='n00M' or i =='n0HV' or i =='n0LS'
endfunction
function OPX takes unit u returns boolean
	return OMX(GetUnitTypeId(u))
endfunction
function OQX takes integer i returns boolean
	return i =='np01' or i =='e01H' or i =='e01Z' or i =='e02R' or i =='e02T' or i =='e02S' or i =='e030'
endfunction
function OSX takes unit u returns boolean
	return OQX(GetUnitTypeId(u))
endfunction
// 是信使单位
function IsUnitMessenger takes unit u returns boolean
	return OPX(u) or OSX(u)
endfunction
function IsTreeDestructable takes destructable d returns boolean
	return GetDestructableTypeId(d)=='CTtr' or GetDestructableTypeId(d)=='NTtc' or GetDestructableTypeId(d)=='NTtw' or GetDestructableTypeId(d)=='ATtr' or GetDestructableTypeId(d)=='B002' or GetDestructableTypeId(d)=='B003' or GetDestructableTypeId(d)=='B005' or GetDestructableTypeId(d)=='ITtw' or GetDestructableTypeId(d)=='CTtr'
endfunction
// 是魔法免疫单位
function IsUnitMagicImmune takes unit u returns boolean
	return IsUnitType(u, UNIT_TYPE_MAGIC_IMMUNE) or LoadInteger(HY, GetHandleId(u), 4252) == 1
endfunction
function OYX takes unit u returns boolean
	return HaveSavedHandle(HY, GetHandleId(u),'FRZH')
endfunction
function OZX takes unit O_X returns boolean
	return GetUnitAbilityLevel(O_X,'A04R')> 0 and XFX(GetOwningPlayer(O_X))
endfunction
function O0X takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return i =='H00F' or i =='H00E' or i =='H00G' or i =='O017' or i =='N0MA' or i =='N0MB' or i =='N0MC' or i =='N0MO'
endfunction
function IsEffectiveDamage takes real d returns boolean
	return 2 < d and d < 3000
endfunction
function GetHostPlayer takes nothing returns nothing
	local integer i = 1
	set HostPlayer = SentinelPlayers[1]
	loop
	exitwhen IsPlayingPlayer(HostPlayer) or i > 5
		set i = i + 1
		set HostPlayer = SentinelPlayers[i]
	endloop
	if IsPlayingPlayer(HostPlayer) == false then
		set HostPlayer = ScourgePlayers[1]
		set i = 1
		loop
		exitwhen IsPlayingPlayer(HostPlayer) or i > 5
			set i = i + 1
			set HostPlayer = ScourgePlayers[i]
		endloop
	endif
endfunction
function O4X takes unit u returns boolean
	return IsUnitType(u, UNIT_TYPE_HERO) and IsUnitIllusion(u) == false and GetUnitTypeId(u)!='H00M' and GetUnitTypeId(u)!='H00Y' and GetUnitTypeId(u)!='H07G' and GetUnitTypeId(u)!='H0B8' and GetUnitTypeId(Player__Hero[GetPlayerId(GetOwningPlayer(u))])!= GetUnitTypeId(u)
endfunction
function O5X takes integer XVX returns integer
	local integer i = 1
	loop
	exitwhen i > HeroTypeMaxCount
		if XVX == HeroListTypeId[i] then
			return i
		endif
		set i = i + 1
	endloop
	return 0
endfunction

function O6X takes nothing returns boolean
	return GetTimeOfDay()> 6. and GetTimeOfDay()< 18.
endfunction

function AddUnitState takes unit whichUnit, unitstate whichUnitState, real addVal returns nothing
	call SetUnitState(whichUnit, whichUnitState, GetUnitState(whichUnit, whichUnitState) + addVal )
endfunction

function Unit_Setrange takes unit u, real r returns nothing
	call SetUnitState(u, UNIT_STATE_ATTACK1_RANGE, r)
endfunction

function Unit_Addrange takes unit u, real r returns nothing
	local real range = (GetUnitState(u, UNIT_STATE_ATTACK1_RANGE) + r) 
	call Unit_Setrange(u, range)
	call SaveReal(HY, GetHandleId(u),'AtkR', LoadReal(HY, GetHandleId(u),'AtkR')+ r)
endfunction

function lua_UnitIdGetRange takes unit u returns real
	local integer typeId = GetUnitTypeId(u)
	local real data = 0
	if not HaveSavedReal( ObjectData, OBJ_HTKEY_UNIT_ORIGIN_RANGEN1, typeId ) then
		set data = S2R( GetObjectDataBySlk( typeId, "unit", "rangeN1" ) )
		call SaveReal( ObjectData, OBJ_HTKEY_UNIT_ORIGIN_RANGEN1, typeId, data )
		// debug call SingleDebug( " 从slk库读取单位射程 " + GetUnitName( u )  + " rangeN1" + R2S(data))
	else
		set data = LoadReal( ObjectData, OBJ_HTKEY_UNIT_ORIGIN_RANGEN1, typeId )
	endif

	return data
endfunction

function mlq_addrange takes unit u returns nothing
	if not IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
		call AddUnitBonusRange(u, 140., true)
		call SaveBoolean(HY, GetHandleId(u),'R00P', true)
	endif
endfunction

function mlq_reducerange takes unit u returns nothing
	if LoadBoolean(HY, GetHandleId(u),'R00P') then
		call AddUnitBonusRange(u,-140., true)
		call SaveBoolean(HY, GetHandleId(u),'R00P', false)
	endif
endfunction

// 设置并保存单位当前缩放值
function SetUnitCurrentScaleEx takes unit whichUnit, real unitScale returns real
	local real modelScale = GetUnitModelScale(whichUnit) * unitScale + LoadReal( ExtraHT, GetHandleId(whichUnit), HTKEY_UNIT_CURRENT_ADDSCALE )
	// debug call SingleDebug( R2S( modelScale )  + " unitScale" + R2S(unitScale))
	call SetUnitScale(whichUnit, modelScale, modelScale, modelScale)
	call SaveReal( ExtraHT, GetHandleId(whichUnit), HTKEY_UNIT_CURRENT_PERCENT_SCALE, unitScale )
	return modelScale
endfunction

// 获取单位当前缩放值
function GetUnitCurrentScale takes unit whichUnit returns real
	local real data = LoadReal( ExtraHT, GetHandleId(whichUnit), HTKEY_UNIT_CURRENT_PERCENT_SCALE )
	if data == 0 then
		return 1.
	endif
	return data
endfunction



// 相位移动
function SetUnitPhaseMove takes unit whichUnit, boolean open returns nothing
	if open then
		if not IsUnitType(whichUnit, UNIT_TYPE_FLYING) then
			call MHUnit_SetCollisionType(whichUnit, UNIT_COLLISION_TYPE_HARVESTER, UNIT_COLLISION_TYPE_BUILDING)
		endif
		// 没相位buff并且冲刺也没了 那再移除
	elseif GetUnitAbilityLevel( whichUnit, 'B09Y' ) == 0 and not HaveSavedHandle(HY, GetHandleId(whichUnit),'A05C') then
		if not IsUnitType(whichUnit, UNIT_TYPE_FLYING) then
			call MHUnit_SetCollisionType(whichUnit, UNIT_COLLISION_TYPE_FOOT, UNIT_COLLISION_TYPE_GROUND)
		endif
	endif
endfunction

function O8X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer i = 1
	local integer iSkillLevel
	if UnitAlive(u) then
		// call BJDebugMsg("删除技能"+R2S(GetGameTime()))
		loop
			set iSkillLevel = GetUnitAbilityLevel(u, PassiveSkills_Learned[i])
			if iSkillLevel == 0 and(GetUnitAbilityLevel(u, PassiveSkills_Real[i])> 0 or GetUnitAbilityLevel(u, PassiveSkills_SpellBook[i])> 0 or GetUnitAbilityLevel(u, PassiveSkills_Buff[i])> 0) then
				call UnitRemoveAbility(u, PassiveSkills_Real[i])
				call UnitRemoveAbility(u, PassiveSkills_SpellBook[i])
				call UnitRemoveAbility(u, PassiveSkills_Buff[i])
				call UnitRemoveAbility(u, PassiveSkills_Show[i])
			endif
			set i = i + 1
		exitwhen i > PassiveAbilityMaxCount
		endloop
	endif

	// 如果单位有冲刺状态
	if HaveSavedHandle(HY, GetHandleId(u),'A05C') then
		// 变身后是地面单位 就重置碰撞类型和移动类型
		call SetUnitPhaseMove( u, true )
	endif

	if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
		if GetUnitAbilityLevel(u,'A1WE')> 0 then
			call UnitRemoveAbility(u,'A3FH')
		endif
		if GetUnitAbilityLevel(u,'A1WE')> 0 then
			call UnitAddPermanentAbility(u,'A3FH')
			call SetAllPlayerAbilityUnavailable('A3FH')
		endif
	else
		if GetUnitAbilityLevel(u,'A0B8')> 0 then
			call UnitRemoveAbility(u,'A3FI')
		endif
		if GetUnitAbilityLevel(u,'A0B8')> 0 then
			call UnitAddPermanentAbility(u,'A3FI')
			call SetAllPlayerAbilityUnavailable('A3FI')
		endif
	endif
	// 修正高度
	call SetUnitFlyHeight(u, GetUnitDefaultFlyHeight(u), 0)
	// 修正射程
	call RefreshUnitRange(u)
	// 修正缩放
	call SetUnitCurrentScaleEx(u, GetUnitCurrentScale(u))
	// 修正颜色
	//call SetUnitVertexColorEx(u, -1, -1, -1, -1)
	call ResetUnitVertexColor(u)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call TriggerEvaluate(IO)
	//endif
	set Q5V = u
	set t = null
	set u = null
	return false
endfunction

// 判断技能Id是否为变身技能
function IsMetamorphosisSkill takes integer id returns boolean
	return id =='A0AG' or id =='QM01' or id =='A0BE' or id =='QM00' or id =='QB0K' or id =='ANcr' or id =='QB0L' or id =='A2H0' or id =='QM02' or id =='QM03' or id =='QM04' or id =='A1RI' or id =='A332' or id =='A2M0' or id =='A2H1'
endfunction

// 单位变身事件
function RVX takes nothing returns nothing
	local integer iTrigHandleId
	local unit hTriggerUnit
	local trigger hTrig
	local integer iNewTrigHandleId
	local real rDur
	local integer id = GetSpellAbilityId()
	if IsMetamorphosisSkill(id) then
		set iTrigHandleId = GetHandleId(GetTriggeringTrigger())
		set hTrig = CreateTrigger()
		set iNewTrigHandleId = GetHandleId(hTrig)
		set hTriggerUnit = LoadUnitHandle(HY, iTrigHandleId, 0)
		call SaveUnitHandle(HY, iNewTrigHandleId, 0, hTriggerUnit)
		call SaveInteger(HY, iNewTrigHandleId, 0, id)
		// 保存单位是否为变身单位布尔
		call SaveBoolean(HY, iNewTrigHandleId, 3, UnitTypeIsMetamorphosis(hTriggerUnit))
		set rDur = YDWEGetUnitAbilityDataReal(hTriggerUnit, id, GetUnitAbilityLevel(hTriggerUnit, id), 102)
		// GetTriggerEventId()!= EVENT_UNIT_SPELL_ENDCAST
		// call BJDebugMsg("触发器运行"+R2S(GetGameTime()))
		// call BJDebugMsg("变身时间"+ R2S( rDur ) )
		// 需要 + 0.001 而不是0.0001 否则还会全光环
		call TriggerRegisterTimerEvent(hTrig, rDur + 0.001, false) // 
		call TriggerAddCondition(hTrig, Condition(function O8X))
		//call SaveBoolean(HY, iNewTrigHandleId, 0, GetTriggerEventId() == EVENT_UNIT_SPELL_ENDCAST)
		set hTrig = null
		set hTriggerUnit = null
	endif
endfunction

function REX takes integer RXX returns integer
	local integer id = O5X(RXX)
	local string ROX = I2S(2 * id -2)
	local integer l = StringLength(ROX)
	if RXX =='N01H' or RXX =='H600' then
		return'M500'
	elseif RXX =='N01T' or RXX =='H601' then
		return'M502'
	elseif RXX =='N01J' or RXX =='H602' then
		return'M504'
	elseif RXX =='H00F' then
		return'M506'
	elseif RXX =='H00E' then
		return'M508'
	elseif RXX =='H00G' then
		return'M510'
	elseif RXX =='O017' then
		return'M512'
	elseif RXX =='H06X' then
		return'M514'
	elseif RXX =='H06Y' then
		return'M516'
	elseif RXX =='H06W' then
		return'M518'
	elseif RXX =='N013' then
		return'M520'
	elseif RXX =='N014' then
		return'M522'
	elseif RXX =='N015' then
		return'M524'
	elseif RXX =='E015' then
		return'M526'
	elseif RXX =='H07I' then
		return'M528'
	elseif RXX =='Eevm' then
		return'M530'
	elseif RXX =='E02V' then
		return'M532'
	elseif RXX =='E02W' then
		return'M534'
	elseif RXX =='E02U' then
		return'M536'
	elseif RXX =='H08D' then
		return'M538'
	elseif RXX =='H08C' then
		return'M540'
	elseif RXX =='H084' then
		return'M542'
	elseif RXX =='H08B' then
		return'M544'
	elseif RXX =='N017' then
		return'M546'
	elseif RXX =='N02B' then
		return'M548'
	elseif RXX =='N0MB' then
		return'M550'
	elseif RXX =='N0MC' then
		return'M552'
	elseif RXX =='N0MO' then
		return'M554'
	elseif RXX =='N0MA' then
		return'M556'
	elseif RXX =='U01X' then
		return'M558'
	elseif RXX =='QTW2' then
		return'M562'
	elseif RXX =='QTW3' then
		return'M564'
	elseif RXX =='KODO' then
		return'M566'
	elseif RXX =='H00U' then
		return'M186'
	elseif RXX =='H500' then
		return'M568'
	elseif RXX =='H501' then
		return'M570'
	elseif RXX =='H502' then
		return'M572'
	elseif RXX =='H503' then
		return'M574'
	elseif RXX =='H504' then
		return'M576'
	elseif RXX =='H505' then
		return'M578'
	elseif RXX =='H506' then
		return'M57A'
	elseif RXX =='H507' then
		return'M57C'
	endif
	if id == 0 then
		return 0
	endif
	if l == 1 then
		set ROX = "M00" + ROX
	elseif l == 2 then
		set ROX = "M0" + ROX
	elseif l == 3 then
		set ROX = "M" + ROX
	else
		return 0
	endif
	return UDV(ROX)
endfunction
function RRX takes unit u returns integer
	local integer RIX = REX(GetUnitTypeId(u))
	if RIX !='M106'then
		call UnitAddAbility(u,'A04R')
		call UnitAddAbility(u, RIX)
		call UnitRemoveAbility(u, RIX)
		call UnitRemoveAbility(u,'A04R')
	endif
	call FixUnitSkillsBug(u)
	return RIX
endfunction
function RAX takes unit u, integer RIX returns nothing
	if RIX !='M107'then
		call UnitAddAbility(u,'A04R')
		call UnitAddAbility(u, RIX)
		call UnitRemoveAbility(u, RIX)
		call UnitRemoveAbility(u,'A04R')
	endif
	call FixUnitSkillsBug(u)
endfunction
function RNX takes unit trigUnit returns integer
	local integer level = GetHeroLevel(trigUnit)
	if level == 1 then
		return  100 
	elseif level == 2 then
		return  120
	elseif level == 3 then
		return  140
	elseif level == 4 then
		return  160
	elseif level == 5 then
		return  180
	else
		return  100 * level -320
	endif
	return 0
endfunction
function IsObserverPlayer takes player p returns boolean
	return IsGameHaveObserver and(ObserverPlayer1 == p or ObserverPlayer2 == p)
endfunction
function RCX takes unit u returns boolean
	return GetUnitAbilityLevel(u,'Bcyc')> 0 or GetUnitAbilityLevel(u,'Bcy2')> 0
endfunction
function RDX takes unit u returns boolean
	return(GetUnitAbilityLevel(u,('B02F'))> 0) or(GetUnitAbilityLevel(u,('BUsp'))> 0) or(GetUnitAbilityLevel(u,('BUst'))> 0)
endfunction
function RFX takes unit u returns boolean
	return GetUnitAbilityLevel(u,'B02J')> 0 or RCX(u) or RDX(u) or GetUnitAbilityLevel(u,'Avul')> 0
endfunction
function RGX takes unit u, integer level returns nothing
	call SetUnitAbilityLevel(u,'A1NB', level)
	call SetUnitAbilityLevel(u,'A1NC', level)
	call SetUnitAbilityLevel(u,'A1ND', level)
	call SetUnitAbilityLevel(u,'A1NL', level)
	call SetUnitAbilityLevel(u,'A1NN', level)
	call SetUnitAbilityLevel(u,'A1NM', level)
	call SetUnitAbilityLevel(u,'A2IZ', level)
	call SetUnitAbilityLevel(u,'A2J0', level)
	call SetUnitAbilityLevel(u,'A2J1', level)
endfunction
function RHX takes integer id returns boolean
	return id =='u014' or id =='u015' or id =='u016' or id =='u01D' or id =='u01E' or id =='u01F' or id =='u01R' or id =='u01S' or id =='u01T' or id =='u017' or id =='u019' or id =='u018' or id =='u01A' or id =='u01B' or id =='u01C' or id =='u01U' or id =='u01V' or id =='u01W'
endfunction
function RJX takes integer id returns boolean
	return id =='n0FJ' or id =='n0FI' or id =='n0F6' or id =='n0FH'
endfunction
function RKX takes unit u returns boolean
	return RJX(GetUnitTypeId(u))
endfunction
function RLX takes unit u returns boolean
	local integer id = GetUnitTypeId(u)
	return id =='o018' or id =='o002' or id =='o00B' or id =='o01B'
endfunction
function RMX takes unit u returns boolean
	local integer id = GetUnitTypeId(u)
	return id =='n00Q' or id =='n00O' or id =='n00P' or id =='n00N'
endfunction
function RPX takes unit u returns boolean
	local integer id = GetUnitTypeId(u)
	return RLX(u) or RMX(u) or id =='otot'
endfunction
function RQX takes integer id returns boolean
	return id =='o00L' or id =='o00M' or id =='o00N' or id =='o00O'
endfunction
function RSX takes unit u returns boolean
	return RQX(GetUnitTypeId(u))
endfunction
function RTX takes integer id returns boolean
	return id =='h0CV' or id =='h0CX' or id =='h0CW'
endfunction
function RUX takes unit u returns boolean
	local integer id = GetUnitTypeId(u)
	return id =='o00V' or id =='o00T' or id =='o00W' or id =='o00U'
endfunction
function RWX takes unit u returns boolean
	local integer id = GetUnitTypeId(u)
	return id =='o000' or id =='o001' or id =='o00A' or id =='o00X' or id =='n12O'
endfunction
function RYX takes unit u returns boolean
	local integer id = GetUnitTypeId(u)
	return id =='o01C' or id =='o01D' or id =='o01E' or id =='osp4' or id =='o008' or id =='o009'
endfunction
function IsFortDefenseTypeUnit takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return i =='umtw' or i =='ebal' or i =='u00R' or i =='e026' or i == 'n003'
endfunction
function R_X takes unit u returns boolean
	return RSX(u) or RUX(u) or RWX(u) or RYX(u) or RPX(u)
endfunction
function R0X takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return i =='O017' or i =='QTW8' or i =='N0MA' or i =='N0MB' or i =='N0MC' or i =='N0MO' or RHX(i) or OSX(u)
endfunction
function R1X takes integer i returns boolean
	return i =='u00S'
endfunction
function IsBeetleUnitTypeId takes integer i returns boolean
	return i =='u01K' or i =='u01H' or i =='u01J' or i =='u01L'
endfunction
function R3X takes integer i returns boolean
	return i =='h0CH' or i =='h0CF' or i =='h0C1' or i =='h0CG'
endfunction
function R4X takes unit u returns boolean
	return IsUnitType(u, UNIT_TYPE_SUMMONED) and IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) == false and IsUnitType(u, UNIT_TYPE_RANGED_ATTACKER) == false
endfunction
function R5X takes unit u returns boolean
	return GetUnitAbilityLevel(u,'BOhx')> 0 or GetUnitAbilityLevel(u,'B00H')> 0
endfunction

function AlarmDamage takes unit s, unit t returns nothing
	call UnitDamageTarget(s, t, 0., false, false, null, null, null)
endfunction

// 1 一般法术伤害(魔法伤害)
// 2 英雄攻击伤害(物理伤害)
// 3 英雄攻击魔法伤害(纯粹伤害)
function UnitDamageTargetEx takes unit u, unit t, integer damageType, real d returns nothing
	if damageType == 0 or d < 0 then
		return
	endif
	set AD = AD + 1
	set GX = damageType
	if damageType == 1 then
		// 普通攻击 法术伤害
		call UnitDamageTarget(u, t, d, true, true, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_FIRE, WEAPON_TYPE_WHOKNOWS)
	elseif damageType == 2 then
		call UnitDamageTarget(u, t, d, true, true, ATTACK_TYPE_HERO, DAMAGE_TYPE_NORMAL, WEAPON_TYPE_WHOKNOWS)
	elseif damageType == 3 then
		if IsFortDefenseTypeUnit(t) then
			set d = d * 2
		endif
		call UnitDamageTarget(u, t, d, true, true, ATTACK_TYPE_HERO, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
	elseif damageType == 4 then
		call UnitDamageTarget(u, t, d, true, true, ATTACK_TYPE_PIERCE, DAMAGE_TYPE_NORMAL, WEAPON_TYPE_WHOKNOWS)
	elseif damageType == 5 then
		call UnitDamageTarget(u, t, d, true, true, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_NORMAL, WEAPON_TYPE_WHOKNOWS)
	elseif damageType == 6 or damageType == 11 then
		// 生命移除
		// 类型6会致死
		call SetWidgetLife(t, RMaxBJ(GetWidgetLife(t)-d, 1))
		if IsUnitType(t, UNIT_TYPE_HERO) then
			call UnitDamageTarget(u, t, 0, true, true, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_FIRE, WEAPON_TYPE_WHOKNOWS)
		endif
		if damageType == 6 or GetUnitAbilityLevel(t,'B07D') == 0 and GetWidgetLife(t)< 2 and RFX(t) == false then
			if IsUnitType(t, UNIT_TYPE_SUMMONED) == false then
				call UnitRemoveBuffs(t, true, true)
			endif
			call UnitRemoveAbility(t,'Aetl')
			call UnitDamageTarget(CreateUnit(GetOwningPlayer(u),'e00E', 0, 0, 0), t, 100000000., true, false, ATTACK_TYPE_MELEE, DAMAGE_TYPE_NORMAL, WEAPON_TYPE_WHOKNOWS)
		endif
	elseif damageType == 7 then
		// 神圣伤害
		if GetUnitAbilityLevel(t,'Aetl')> 0 or GetUnitAbilityLevel(t,'B01N')> 0 then
			// 英雄攻击 魔法伤害
			call UnitDamageTarget(u, t, d, true, true, ATTACK_TYPE_HERO, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
		else
			// 英雄攻击 通用伤害
			call UnitDamageTarget(u, t, d, true, true, ATTACK_TYPE_HERO, DAMAGE_TYPE_UNIVERSAL, WEAPON_TYPE_WHOKNOWS)
		endif
	elseif damageType == 8 then
		call UnitDamageTarget(u, t, d, true, true, ATTACK_TYPE_HERO, DAMAGE_TYPE_ENHANCED, WEAPON_TYPE_WHOKNOWS)
	elseif damageType == 9 then
		call UnitDamageTarget(u, t, d, true, true, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_UNIVERSAL, WEAPON_TYPE_WHOKNOWS)
	elseif damageType == 10 then
		call UnitDamageTarget(u, t, d, true, true, ATTACK_TYPE_HERO, DAMAGE_TYPE_ENHANCED, WEAPON_TYPE_WHOKNOWS)
	endif
	set GX = 0
	set AD = AD -1
endfunction

// 获取技能的需求等级
function GetAbilityreqLevel takes integer id returns integer
	local integer i = 0
	if HaveSavedInteger(ObjectData, OBJ_HTKEY_ABILITY_REQLEVEL, id) then
		return LoadInteger(ObjectData, OBJ_HTKEY_ABILITY_REQLEVEL, id)
	else
		set i = S2I( GetObjectDataBySlk( id, "ability", "reqLevel" ) )
		call SaveInteger(ObjectData, OBJ_HTKEY_ABILITY_REQLEVEL, id, i)
		if i == null or i <= 0 then
			return 0
		endif
		return i
	endif
endfunction

function IsNotItemAbility takes integer abilityId returns boolean
	//local integer i = 1
	//loop
	//exitwhen i > EY
		//if T0V == VY[i] then
		return not LoadBoolean( ObjectData, OBJ_HTKEY_IS_ITEM_ABILITY, abilityId )	
		//	return false
		//endif
	//	set i = i + 1
	//endloop
	//return true
endfunction

// 是终极技能
function IsUltimateSkill takes integer id returns boolean
	if not IsNotItemAbility(id) then
		return false
	endif
	return GetAbilityreqLevel(id) == 6
endfunction

function GetAbilityTimerNumber takes unit u, integer id returns integer
	local integer abbb
	if not IsNotItemAbility(id) then
		return 0
	endif
	set abbb = PlayerSkillIndex[GetPlayerId(GetOwningPlayer(u))* 6 + 4]
	if not Mode__SixSkills then
		return 1
	else
		if id == HeroCommonSkills[abbb] then
			return 1
		elseif id == HeroUpgradeSkills[abbb] then
			return 2
		endif
	endif
	return 0
endfunction

function RefreshUnitAbilityCoolDownTimer takes unit u, integer id, real cd returns nothing
	if GetAbilityTimerNumber(u, id) == 1 then
		call TimerStart(ESV[GetPlayerId(GetOwningPlayer(u))], cd, false, null)
	elseif GetAbilityTimerNumber(u, id) == 2 then
		call TimerStart(ETV[GetPlayerId(GetOwningPlayer(u))], cd, false, null)
	endif
endfunction

//设置技能冷却
function Japi_SetUnitAbilityCoolDown1 takes unit u, integer id, real cd returns nothing
	if GetUnitAbilityLevel(u, id) == 0 or cd == 0.00 then
		return
	endif
	call YDWESetUnitAbilityState(u, id, 1, cd)
endfunction

//刷新技能冷却 直接为0
function Japi_ResetUnitAbilityCoolDownActions takes unit u, integer id returns nothing
	if id > 0 then
		call YDWESetUnitAbilityState(u, id, 1, 0)
		//if IsUltimateSkill(id) then
		//	call RefreshUnitAbilityCoolDownTimer(u, id, 0.00)
		//endif
	endif
endfunction

//刷新技能冷却为0 前置判断
function Japi_ResetUnitAbilityCoolDown takes unit u, integer id returns nothing
	local integer lv = GetUnitAbilityLevel(u, id)
	if lv > 0 then
		call Japi_ResetUnitAbilityCoolDownActions(u, id)
	endif
endfunction


function Japi_ReduceUnitAbilityCoolDownActions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer id = LoadInteger(HY, h, 1)
	local unit u = LoadUnitHandle(HY, h, 10)
	local real cd = YDWEGetUnitAbilityState(u, id, 1)
	local real reduce = LoadReal(HY, h, 2)
	if cd - reduce > 0 then
		call YDWESetUnitAbilityState(u, id, 1, cd - reduce)
		//call RefreshUnitAbilityCoolDownTimer(u, id, cd - reduce)
	else
		call YDWESetUnitAbilityState(u, id, 1, 0.00)
		//call RefreshUnitAbilityCoolDownTimer(u, id, 0.00)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set u = null
	return false
endfunction

//冷却时间减少 用于重生
function Japi_ReduceUnitAbilityCoolDown takes unit u, integer id, real reduce returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveInteger(HY, h, 1, id)
	call SaveReal(HY, h, 2, reduce)
	call SaveUnitHandle(HY, h, 10, u)
	call TriggerRegisterTimerEvent(t, 0.0, false)
	call TriggerAddCondition(t, Condition(function Japi_ReduceUnitAbilityCoolDownActions))
	set t = null
endfunction

//冷却时间缩减	会直接跳图标
function Japi_SetUnitAbilityCoolDown2 takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer id = LoadInteger(HY, h, 1)
	local integer lv = LoadInteger(HY, h, 2)
	local unit u = LoadUnitHandle(HY, h, 10)
	local real cd = LoadReal(PassiveAbilityCooldown, id, lv)
	call YDWESetUnitAbilityDataReal(u, id, lv, 105, cd)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set u = null
	return false
endfunction

function Japi_SetUnitAbilityCoolDownReduceAction takes unit u, integer id, real cd returns nothing
	local trigger t
	local integer h
	local integer lv = GetUnitAbilityLevel(u, id)
	if cd > 0 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		//call RefreshUnitAbilityCoolDownTimer(u, id, cd) //刷新显示计时器cd
		call YDWESetUnitAbilityDataReal(u, id, lv, 105, cd)
		call SaveInteger(HY, h, 1, id)
		call SaveInteger(HY, h, 2, lv)
		call SaveUnitHandle(HY, h, 10, u)
		call TriggerRegisterTimerEvent(t, 0.0, false)
		call TriggerAddCondition(t, Condition(function Japi_SetUnitAbilityCoolDown2))
	endif
	set t = null
endfunction

//转图标正常
function Japi_SetUnitAbilityCoolDownReduce takes unit u, integer id, real reduce returns nothing
	local real cd
	local integer lv = GetUnitAbilityLevel(u, id)
	if HaveSavedReal(PassiveAbilityCooldown, id, lv) then
		set cd = LoadReal(PassiveAbilityCooldown, id, lv)
	else
		set cd = S2R(EXExecuteScript("(require'jass.slk').ability[" + I2S(id) + "].Cool" + I2S(lv) + " or 0"))
		call SaveReal(PassiveAbilityCooldown, id, lv, cd)
	endif
	if cd > 0 then
		call Japi_SetUnitAbilityCoolDownReduceAction(u, id, cd * reduce)
	endif
endfunction


function TWE takes unit u, boolean TYE returns nothing
	local integer TPE
	local integer level
	local integer TZE
	local integer pid
	local integer xx
	local integer i
	set pid = GetPlayerId(GetOwningPlayer(u))
	set xx = 1
	if TYE then
		call TFE(u)
		return
	endif
	loop
		set TZE = PlayerSkillIndex[pid * HL + xx]
		set TPE = HeroCommonSkills[TZE]
		set i = TBE(TPE)
		if i > 0 and GetUnitAbilityLevel(u, AghanimUpgradeChangeId[i])> 0 then
			set TPE = AghanimUpgradeUpgradeId[i]
		endif
		if IsPassiveSkill[TZE]== false and LoadBoolean(ObjectHashTable, 0, TPE) == false and TPE !='A1RK' and TPE !='A43H' and TPE !='A065' then
			call Japi_ResetUnitAbilityCoolDown(u, TPE)
		endif
		if TPE =='A0OO' then
			call Japi_ResetUnitAbilityCoolDown(u,'A300')
			call Japi_ResetUnitAbilityCoolDown(u,'A301')
		elseif TPE =='A0EY'then
			call Japi_ResetUnitAbilityCoolDown(u,'A0F0')
			call Japi_ResetUnitAbilityCoolDown(u,'A0FH')
		elseif TPE =='A21M'then
			call Japi_ResetUnitAbilityCoolDown(u,'A21N')
		elseif TPE =='A088'then
			call Japi_ResetUnitAbilityCoolDown(u,'A2KQ')
		endif
		set xx = xx + 1
	exitwhen xx > HL
	endloop
	if LoadInteger(OtherHashTable, GetHandleId(u),'DEVR')!= 0 then
		set U2 = u
		call ExecuteFunc("T_E")
	endif
	set u = null
endfunction

function IVX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local integer IEX = LoadInteger(HY, h, 36)
	local real IXX = LoadReal(HY, h, 20)
	call UnitDamageTargetEx(whichUnit, targetUnit, IEX, IXX)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function IOX takes unit whichUnit, unit targetUnit, integer DT, real IXX, real S7V returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 30,(targetUnit))
	call SaveInteger(HY, h, 36, DT)
	call SaveReal(HY, h, 20, IXX * 1.)
	call TriggerRegisterTimerEvent(t, S7V, false)
	call TriggerAddCondition(t, Condition(function IVX))
	set t = null
endfunction
function IRX takes player whichPlayer, string EZX returns nothing
	local sound s = CreateSound(EZX, false, false, false, 10, 10, "DefaultEAXON")
	if (LocalPlayer== whichPlayer) then
		call StartSound(s)
	endif
	call KillSoundWhenDone(s)
	set s = null
endfunction

function HideErrorTipText takes nothing returns nothing



endfunction

function InterfaceErrorForPlayer takes player p, string str returns nothing
	if (str != "") and(str != null) then
		if (LocalPlayer== p) then
			call MHUI_SendErrorMessage(str, 10., 0xFFFFCC00)
			//call ClearTextMessages()
			//call DisplayTimedTextToPlayer(p, .5,-1., 2., "|cffffcc00" + str + "|r")
		endif
	endif
	// debug call SingleDebug("ErrorTip" + "|cffffcc00" + str + "|r")
	if (LocalPlayer== p) then
		call MHUI_PlayErrorSound()
	endif
endfunction
function INX takes string f, boolean b returns nothing
	if b and f != "" and f != null then
		call ExecuteFunc(f)
	endif
endfunction
//========================================坐标修正
function CoordinateX50 takes real x returns real
	local real dx = GetRectMinX(bj_mapInitialPlayableArea)+ 50
	if (x < dx) then
		return dx
	endif
	set dx = GetRectMaxX(bj_mapInitialPlayableArea)-50
	if (x > dx) then
		return dx
	endif
	return x
endfunction
function CoordinateX75 takes real x returns real
	local real dx = GetRectMinX(bj_mapInitialPlayableArea)+ 75
	if (x < dx) then
		return dx
	endif
	set dx = GetRectMaxX(bj_mapInitialPlayableArea)-75
	if (x > dx) then
		return dx
	endif
	return x
endfunction
function CoordinateY50 takes real y returns real
	local real dy = GetRectMinY(bj_mapInitialPlayableArea)+ 50
	if (y < dy) then
		return dy
	endif
	set dy = GetRectMaxY(bj_mapInitialPlayableArea)-50
	if (y > dy) then
		return dy
	endif
	return y
endfunction
function CoordinateY75 takes real y returns real
	local real dy = GetRectMinY(bj_mapInitialPlayableArea)+ 75
	if (y < dy) then
		return dy
	endif
	set dy = GetRectMaxY(bj_mapInitialPlayableArea)-75
	if (y > dy) then
		return dy
	endif
	return y
endfunction
function EXRemoveHero takes unit whichUnit returns nothing
	call SaveBoolean(HY,(GetHandleId(whichUnit)), 38,(false))
	call FlushChildHashtable(HY,(GetHandleId(whichUnit)))
	call RemoveUnit(whichUnit)
endfunction
function IHX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(GetExpiredTimer())
	local unit u = LoadUnitHandle(HY, h, 26)
	call SetWidgetLife(u, GetWidgetLife(u)+ LoadReal(HY, h, 20))
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set u = null
	set t = null
endfunction
// 延迟0.秒再减免伤害
function UnitToDelaySetLife takes unit whichUnit, real IXX returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveReal(HY, h, 20, IXX * 1.)
	call SaveUnitHandle(HY, h, 26, whichUnit)
	call TimerStart(t, 0, false, function IHX)
	set t = null
endfunction
function ReduceDamageTextTag takes string s, real SYV, unit u, real ILX, real IMX, integer r, integer g, integer b, integer a returns nothing
	local texttag tt = CreateTextTag()
	call SetTextTagText(tt, s, ILX)
	call SetTextTagPosUnit(tt, u, IMX)
	call SetTextTagColor(tt, r, g, b, a)
	call SetTextTagVelocity(tt, 0, .0355)
	call SetTextTagFadepoint(tt, 2)
	call SetTextTagPermanent(tt, false)
	call SetTextTagLifespan(tt, SYV)
	if IsObserverPlayer(LocalPlayer) then
		call SetTextTagVisibility(tt, true)
	else
		call SetTextTagVisibility(tt, false)
	endif
	set tt = null
endfunction
// 设置单位减免伤害值
function SetUnitToReduceDamage takes unit whichUnit, real reduceValue returns nothing
	local real maxLife = GetUnitState(whichUnit, UNIT_STATE_MAX_LIFE)
	local real currentLife = GetWidgetLife(whichUnit)
	if reduceValue < 0.1 then
		return
	endif
	if (GetWidgetLife(whichUnit)> .5) then
		if reduceValue > (maxLife - currentLife) then
			if reduceValue >= currentLife then
				call SetWidgetLife(whichUnit, maxLife)
				call UnitToDelaySetLife(whichUnit, reduceValue - (maxLife -currentLife) )
			else
				call UnitToDelaySetLife(whichUnit, reduceValue)
			endif
		else
			call SetWidgetLife(whichUnit, GetWidgetLife(whichUnit) + reduceValue)
		endif
	endif
	// call BJDebugMsg( "原伤害" +R2S(GetEventDamage())+" "+ GetUnitName(whichUnit) + "减免伤害:" + R2S(reduceValue))
	if IsGameHaveObserver then
		call ReduceDamageTextTag("+" + I2S(R2I(reduceValue)), 4, whichUnit, .028, 128, 0, 216, 0, 216)
	endif
endfunction
function ITX takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer hu = LoadInteger(HY, h, 0)
	call RemoveSavedHandle(HY, hu,'DmgD')
	call RemoveSavedInteger(HY, h, 0)
	call DestroyTrigger(t)
	set t = null
endfunction
function IUX takes unit u returns unit
	local trigger t = null
	local integer h
	local unit d = null
	set U2 = null
	if not IsUnitType(u, UNIT_TYPE_HERO) then
		if Player__Hero[GetPlayerId(GetOwningPlayer(u))] != null then
			set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
		else
			return CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
		endif
	endif
	if HaveSavedHandle(HY, GetHandleId(u),'DmgD') then
		call SetUnitX(LoadUnitHandle(HY, GetHandleId(u),'DmgD'), GetUnitX(u))
		call SetUnitY(LoadUnitHandle(HY, GetHandleId(u),'DmgD'), GetUnitY(u))
		return LoadUnitHandle(HY, GetHandleId(u),'DmgD')
	else
		set d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
		call UnitPauseTimedLife(d, true)
		call SaveUnitHandle(HY, GetHandleId(u),'DmgD', d)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterUnitEvent(t, d, EVENT_UNIT_DEATH)
		call TriggerAddCondition(t, Condition(function ITX))
		call SaveInteger(HY, h, 0, GetHandleId(u))
		set U2 = d
		set d = null
		set t = null
	endif
	return U2
endfunction
function IWX takes integer i returns unit
	call DisableTrigger(Y1)
	set E[i]= CreateUnit(Player(i),'e00E', 0, 0, 0)
	call EnableTrigger(Y1)
	return E[i]
endfunction
function IYX takes unit damageSource returns unit
	local integer pid = GetPlayerId(GetOwningPlayer(damageSource))
	if GetWidgetLife(E[pid])> 1 then
		return E[pid]
	endif
	return IWX(pid)
endfunction
function I_X takes unit u returns unit
	return IUX(u)
endfunction
function I0X takes unit whichUnit, location targetUnit returns real
	local real sx = GetUnitX(whichUnit)
	local real sy = GetUnitY(whichUnit)
	local real tx = GetLocationX(targetUnit)
	local real ty = GetLocationY(targetUnit)
	if whichUnit == null then
		return I2R( 1410065407)
	else
		return SquareRoot((sx -tx)*(sx -tx)+(sy -ty)*(sy -ty))
	endif
	return 1.
endfunction



function I8X takes unit u returns nothing
	call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MAX_MANA))
endfunction
function I9X takes nothing returns nothing
	call DisplayTimedTextToPlayer(GetEnumPlayer(), 0, 0, ZJ, HJ)
endfunction
function DisplayTimedTextToAllPlayer takes force AEX, real EHX, string AXX returns nothing
	if AEX == AllPlayerForce or AEX == bj_FORCE_ALL_PLAYERS then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, EHX, AXX)
		return
	endif
	set HJ = AXX
	set ZJ = EHX
	call ForForce(AEX, function I9X)
endfunction
function Y68 takes nothing returns nothing
	if S3[GetPlayerId(GetEnumPlayer())] then
		call DisplayTimedTextToPlayer(GetEnumPlayer(), 0, 0, ZJ, HJ)
	endif
endfunction
function AOX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call DestroyEffect((LoadEffectHandle(HY, h, 32)))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger((t))
	set t = null
	return false
endfunction
function ARX takes string AIX, unit whichUnit, string AAX, real EHX returns nothing
	local effect fx = AddSpecialEffectTarget(AIX, whichUnit, AAX)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveEffectHandle(HY, h, 32,(fx))
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerRegisterTimerEvent(t, EHX, false)
	call TriggerAddCondition(t, Condition(function AOX))
	set fx = null
	set t = null
endfunction
function ANX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call DestroyEffect((LoadEffectHandle(HY, h, 32)))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger((t))
	set t = null
	return false
endfunction
function ABX takes string AIX, real x, real y, real EHX returns nothing
	local effect fx = AddSpecialEffect(AIX, x, y)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveEffectHandle(HY, h, 32,(fx))
	call TriggerRegisterTimerEvent(t, EHX, false)
	call TriggerAddCondition(t, Condition(function ANX))
	set fx = null
	set t = null
endfunction
function ACX takes unit whichUnit, integer UYV returns item
	local integer index = 0
	local item AFX
	loop
	exitwhen index == 6
		set AFX = UnitItemInSlot(whichUnit, index)
		if AFX != null and GetItemTypeId(AFX) == UYV then
			return AFX
		endif
		set index = index + 1
	endloop
	set AFX = null
	return null
endfunction
function DestroyTimerAndFlushHT_HY takes timer t returns nothing
	call PauseTimer(t)
	call FlushChildHashtable(HY,(GetHandleId(t)))
	call DestroyTimer(t)
endfunction
function AngleBetweenUnit takes unit a, unit b returns real
	return bj_RADTODEG * Atan2(GetUnitY(b)-GetUnitY(a), GetUnitX(b)-GetUnitX(a))
endfunction
function AngleBetweenXY takes real x1, real y1, real x2, real y2 returns real
	return bj_RADTODEG * Atan2(y2 -y1, x2 -x1)
endfunction
// 弧度
function RadianBetweenXY takes real x1, real y1, real x2, real y2 returns real
	return Atan2(y2 -y1, x2 -x1)
endfunction
function AKX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	call DestroyLightning((LoadLightningHandle(HY, GetHandleId(t), 41)))
	call DestroyTimerAndFlushHT_HY(t)
	set t = null
endfunction
function ALX takes string AMX, real x1, real y1, real x2, real y2, real r, real g, real b, real a, real EHX returns nothing
	local timer t = CreateTimer()
	local lightning APX = AddLightning(AMX, true, x1, y1, x2, y2)
	call SetLightningColor(APX, r, g, b, a)
	call SaveLightningHandle(HY,(GetHandleId(t)), 41,(APX))
	call TimerStart(t, EHX, false, function AKX)
	set t = null
	set APX = null
endfunction
function AQX takes string s, real SYV, unit u, real ILX, real IMX, integer r, integer g, integer b, integer a returns nothing
	local texttag tt = CreateTextTag()
	call SetTextTagText(tt, s, ILX)
	call SetTextTagPosUnit(tt, u, IMX)
	call SetTextTagColor(tt, r, g, b, a)
	call SetTextTagVelocity(tt, 0, .0355)
	call SetTextTagFadepoint(tt, 2)
	call SetTextTagPermanent(tt, false)
	call SetTextTagLifespan(tt, SYV)
	if IsObserverPlayer(LocalPlayer) then
		call SetTextTagVisibility(tt, true)
	else
		call SetTextTagVisibility(tt, false)
	endif
	set tt = null
endfunction
function CommonTextTag takes string ATX, real EHX, unit AUX, real AWX, integer r, integer g, integer b, integer a returns nothing
	local texttag tt = CreateTextTag()
	call SetTextTagText(tt, ATX, AWX)
	call SetTextTagPosUnit(tt, AUX, 64)
	call SetTextTagColor(tt, r, g, b, a)
	call SetTextTagVelocity(tt, 0, .0355)
	call SetTextTagFadepoint(tt, 2)
	call SetTextTagPermanent(tt, false)
	call SetTextTagLifespan(tt, EHX)
	call SetTextTagVisibility(tt, UnitVisibleToPlayer(AUX, LocalPlayer) or IsObserverPlayer(LocalPlayer))
	set tt = null
endfunction
function AYX takes player p, string ATX, real EHX, unit AUX, real AWX, integer r, integer g, integer b, integer a returns nothing
	local texttag tt = CreateTextTag()
	call SetTextTagText(tt, ATX, AWX)
	call SetTextTagPosUnit(tt, AUX, 64)
	call SetTextTagColor(tt, r, g, b, a)
	call SetTextTagVelocity(tt, 0, .0355)
	call SetTextTagFadepoint(tt, 2)
	call SetTextTagPermanent(tt, false)
	call SetTextTagLifespan(tt, EHX)
	call SetTextTagVisibility(tt, IsPlayerAlly(LocalPlayer, p) or IsObserverPlayer(LocalPlayer))
	set tt = null
endfunction
// 似乎是因为在1.24c之前直接写null会导致泄露
function TrueBoolexpr takes nothing returns boolean
	return true
endfunction
function TriggerRegisterPlayerUnitEventBJ takes trigger t, playerunitevent whichEvent returns nothing
	local integer i = 0
	loop
		call TriggerRegisterPlayerUnitEvent(t, Player(i), whichEvent, null)
		set i = i + 1
	exitwhen i == 16
	endloop
endfunction  
function TriggerRegisterUserUnitEvent takes trigger t, playerunitevent whichEvent returns nothing
	local integer i = 1
	loop
	exitwhen i > 5
		call TriggerRegisterPlayerUnitEvent(t, SentinelPlayers[i], whichEvent, null)
		call TriggerRegisterPlayerUnitEvent(t, ScourgePlayers[i], whichEvent, null)
		set i = i + 1
	endloop
endfunction
function A2X takes nothing returns nothing
	if IsTreeDestructable(GetEnumDestructable()) and IsDestructableAliveBJ(GetEnumDestructable()) then
		set P2 = P2 + 1
		call KillDestructable(GetEnumDestructable())
	endif
endfunction
function KillTreeByCircle takes real x, real y, real d returns integer
	local rect r = Rect(x -d, y -d, x + d, y + d)
	set P2 = 0
	call EnumDestructablesInRect(r, null, function A2X)
	call RemoveRect(r)
	set r = null
	return P2
endfunction
function A4X takes real x, real y returns boolean
	return(not(IsTerrainPathable(x, y, PATHING_TYPE_WALKABILITY)))
endfunction
function A5X takes sound A6X, real x, real y returns nothing
	call SetSoundPosition(A6X, x, y, 0)
	call SetSoundVolume(A6X, 127)
	set bj_lastPlayedSound = A6X
	if (A6X != null) then
		call StartSound(A6X)
	endif
endfunction
function A7X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local fogmodifier f =(LoadFogModifierHandle(HY, h, 42))
	call FogModifierStop(f)
	call DestroyFogModifier(f)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set f = null
	return false
endfunction
function A8X takes player p, real EHX, real x, real y, real r returns nothing
	local trigger t = CreateTrigger()
	local fogmodifier fm = CreateFogModifierRadius(p, FOG_OF_WAR_VISIBLE, x, y, r, true, true)
	call FogModifierStart(fm)
	call SaveFogModifierHandle(HY,(GetHandleId(t)), 42,(fm))
	call TriggerRegisterTimerEvent(t, EHX, false)
	call TriggerAddCondition(t, Condition(function A7X))
	set fm = null
	set t = null
endfunction
function A9X takes nothing returns nothing
	call PauseUnit(GetEnumUnit(), true)
endfunction
function NVX takes nothing returns boolean
	local group g = AllocationGroup(2)
	call GroupEnumUnitsInRange(g, 0, 0, 16000, null)
	call ForGroup(g, function A9X)
	call DeallocateGroup(g)
	set g = null
	return false
endfunction
function GameEndPauseAllUnit takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function NVX))
	call TriggerEvaluate(t)
	set t = null
endfunction
function NXX takes nothing returns nothing
	local integer pid = GetPlayerId(GetTriggerPlayer())
	local integer i = 1
	local integer level
	local unit u = Player__Hero[pid]
	if u != null and UnitAlive(u) then
		loop
			set level = GetUnitAbilityLevel(u, PassiveSkills_Learned[i])
			if level == 0 then
				set level = GetUnitAbilityLevel(u, PassiveSkills_Show[i])
			endif
			if level == 0 and(GetUnitAbilityLevel(u, PassiveSkills_Real[i])> 0 or GetUnitAbilityLevel(u, PassiveSkills_SpellBook[i])> 0) then
				call UnitRemoveAbility(u, PassiveSkills_Real[i])
				call UnitRemoveAbility(u, PassiveSkills_SpellBook[i])
				call UnitRemoveAbility(u, PassiveSkills_Buff[i])
				call UnitRemoveAbility(u, PassiveSkills_Show[i])
			endif
			set i = i + 1
		exitwhen i > PassiveAbilityMaxCount
		endloop
	endif
	set u = null
endfunction



function NOX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit
	local unit whichUnit
	local real speed
	local unit missileDummy
	local real x
	local real y
	local real tx
	local real ty
	local real NAX
	local real NNX
	local real targetX
	local real targetY
	local boolean NDX
	local real NFX
	local real NGX
	if GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
		if OXX(GetSpellAbilityId()) then
			call SaveBoolean(HY, h,-1, true)
			call SaveReal(HY, h,-1, GetUnitX(GetTriggerUnit()))
			call SaveReal(HY, h,-2, GetUnitY(GetTriggerUnit()))
		endif
	else
		set targetUnit = LoadUnitHandle(HY, h, 30)
		set whichUnit = LoadUnitHandle(HY, h, 43)
		set speed =(LoadReal(HY, h, 44))
		set missileDummy =(LoadUnitHandle(HY, h, 45))
		set x = GetUnitX(missileDummy)
		set y = GetUnitY(missileDummy)
		set tx = GetUnitX(targetUnit)
		set ty = GetUnitY(targetUnit)
		set NAX = speed * .03
		if (LoadBoolean(HY, h,-1)) then
			set tx = LoadReal(HY, h,-1)
			set ty = LoadReal(HY, h,-2)
		endif
		set NNX = AngleBetweenXY(x, y, tx, ty)
		set targetX = x + NAX * Cos(NNX * bj_DEGTORAD)
		set targetY = y + NAX * Sin(NNX * bj_DEGTORAD)
		call SetUnitX(missileDummy, targetX)
		call SetUnitY(missileDummy, targetY)
		call EXSetUnitFacing(missileDummy, NNX)
		if UnitIsDead(targetUnit) then
			call KillUnit(missileDummy)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		elseif GetDistanceBetween(tx, ty, targetX, targetY)<= NAX then
			call KillUnit(missileDummy)
			set U2 = whichUnit
			set MissileHitTargetUnit = targetUnit
			if LoadBoolean(HY, h,-1) == false then
				if HaveSavedString(HY, h, 46) then
					call ExecuteFunc(LoadStr(HY, h, 46))
				endif
			endif
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set targetUnit = null
	set whichUnit = null
	set missileDummy = null
	return false
endfunction

function LaunchMissileByUnitDummy takes unit whichUnit, unit targetUnit, integer unitTypeId, string callback, real speed, boolean canDodge returns trigger
	local trigger t   = CreateTrigger()
	local integer h   = GetHandleId(t)
	local real    sx  = GetUnitX(whichUnit)
	local real    sy  = GetUnitY(whichUnit)
	local real    facing = GetUnitFacing(whichUnit)
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function NOX))
	call SaveReal(HY, h, 44,((speed)* 1.))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))
	call SaveStr(HY, h, 46,(callback))
	call SaveUnitHandle(HY, h, 43,((whichUnit)))
	call SaveBoolean(HY, h,-1, false)
	if canDodge then
		call SaveReal(HY, h,-1, 0)
		call SaveReal(HY, h,-2, 0)
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_SPELL_EFFECT)
	endif
	if IsUnitOwnedByPlayer(whichUnit, NeutralCreepPlayer) then
		call SaveUnitHandle(HY, h, 45,(CreateUnit(GetOwningPlayer(whichUnit), unitTypeId, sx, sy, facing)))
	else
		call SaveUnitHandle(HY, h, 45,(CreateUnit(GetOwningPlayer(targetUnit), unitTypeId, sx, sy, facing)))
	endif
	set V3 = t
	set t = null
	return V3
endfunction

// 暂不考虑抛物线 仅做平面位移
function EffectMissileMoveCallBack takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId( trig )
	local unit targetUnit = LoadUnitHandle( HY, h, 1 )
	local effect missileEffect = LoadEffectHandle( HY, h, 10 )
	local real targetX = GetUnitX( targetUnit )
	local real targetY = GetUnitY( targetUnit )
	local real missileX = EXGetEffectX( missileEffect )
	local real missileY = EXGetEffectY( missileEffect )
	local real radian = RadianBetweenXY( missileX, missileY, targetX, targetY )
	local real angle = radian
	local real speed = LoadReal( HY, h , 20 )

	if IsUnitInRangeXY( targetUnit, missileX, missileY, speed ) then
		call MHEffect_ResetMatrix( missileEffect )
		call MHEffect_SetYaw( missileEffect, angle )
		call MHEffect_SetPosition( missileEffect, targetX, targetY, LoadReal( HY, h, 22 ) + MHGame_GetAxisZ(missileX, missileY))
		call DestroyEffect( missileEffect )
		if LoadStr( HY, h, 30 ) != null then
			set Temp__ArrayUnit[0] = LoadUnitHandle( HY, h, 0 )
			set Temp__ArrayUnit[1] = targetUnit
			call ExecuteFunc( LoadStr( HY, h, 30 ) )
		endif
		call FlushChildHashtable( HY, h )
		call CleanCurrentTrigger( trig )
	else
		set missileX = CoordinateX75( missileX + speed * Cos( radian ) )
		set missileY = CoordinateY75( missileY + speed * Sin( radian ) )
		// 移动过远重置特效 特效如果超出镜头中心 则不会渲染  > 1000 (实际不止)
		call MHEffect_ResetMatrix( missileEffect )
		call MHEffect_SetYaw( missileEffect, angle )
		call MHEffect_SetPosition( missileEffect, missileX, missileY, LoadReal( HY, h, 22 ) + MHGame_GetAxisZ(missileX, missileY) ) 

	endif

	set missileEffect = null
	set targetUnit = null
	set trig = null
	return false
endfunction

// 发射一个特效
function UnitLaunchesMissileToTarget takes unit whichUnit, unit targetUnit, string modelName, real speed, real arc, real height, string callback returns nothing
	local integer h = CreateTimerEventTrigger( 0.02, true, function EffectMissileMoveCallBack )
	local real startX = GetUnitX( whichUnit )
	local real startY = GetUnitY( whichUnit )
	local effect missileEffect = AddSpecialEffect( modelName, startX, startY )
	local real angle = AngleBetweenXY( startX, startY, GetUnitX( targetUnit ), GetUnitY( targetUnit ) )
	call SaveUnitHandle( HY, h, 0, whichUnit )
	call SaveUnitHandle( HY, h, 1, targetUnit )
	call SaveEffectHandle( HY, h, 10, missileEffect )

	call SaveReal( HY, h, 20, speed * 0.02 )
	call SaveReal( HY, h, 21, arc )
	call SaveReal( HY, h, 22, height )
	call SaveStr( HY, h, 23, modelName )
	call SaveStr( HY, h, 30, callback )

	call SaveReal( HY, h, 40, startX )
	call SaveReal( HY, h, 41, startY )

	call EXEffectMatRotateZ( missileEffect, angle )
	call EXSetEffectZ( missileEffect, height + EXGetEffectZ( missileEffect ) )
	set missileEffect = null
endfunction

// 模型缩放时间到期 删除Buff
function SetUnitModelScaleByDuration__Remove takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local unit whichUnit = LoadUnitHandle(HY, h, 1)
	local real fixScale
	local trigger addTrig = null
	local trigger reduceTrig = null
	local timer tempTimer = null
	// 缩放触发器
	set addTrig = LoadTriggerHandle( HY, h, 30 )
	set reduceTrig = LoadTriggerHandle( HY, h, 31 )
	if addTrig == null and reduceTrig == null then
		// 常规状态, 清空缩放和计时器
		set fixScale = LoadReal( HY, h, 20 )
		call SetUnitCurrentScaleEx( whichUnit, GetUnitCurrentScale(whichUnit) - fixScale )
		set tempTimer = LoadTimerHandle( HY, h, 41 )
		call FlushChildHashtable( HY, GetHandleId( tempTimer ) )
		call DestroyTimer( tempTimer )
	endif
	if addTrig != null then
		// 放大状态
		set fixScale = LoadReal( HY, GetHandleId( addTrig ), 0 )
		call SetUnitCurrentScaleEx( whichUnit, GetUnitCurrentScale(whichUnit) - fixScale )
		// 修正缩放 然后删除放大触发
		set tempTimer = LoadTimerHandle( HY, h, 41 )
		call FlushChildHashtable( HY, GetHandleId( tempTimer ) )
		call DestroyTimer( tempTimer )
		set tempTimer = null
		call FlushChildHashtable( HY, GetHandleId( addTrig ) )
		call CleanCurrentTrigger( addTrig )
		set addTrig = null
	endif
	if reduceTrig != null then
		// 缩小状态
		set fixScale = LoadReal( HY, GetHandleId( reduceTrig ), 0 )
		call SetUnitCurrentScaleEx( whichUnit, GetUnitCurrentScale(whichUnit) - fixScale )
		// 修正缩放 然后删除缩小触发
		call FlushChildHashtable( HY, GetHandleId( reduceTrig ) )
		call CleanCurrentTrigger( reduceTrig )
		set reduceTrig = null
	endif
	call DestroyTimer( LoadTimerHandle( HY, h, 40 ) ) // 持续时间计时器
	// 清除key
	call RemoveSavedHandle( ExtraHT, GetHandleId( whichUnit ), LoadInteger( HY, h, 10 ) )
	// debug call SingleDebug( "移除Buff 当前缩放" + R2S( GetUnitCurrentScale(whichUnit) ) + " key " + I2S( LoadInteger( HY, h, 10 ) ) + GetUnitName( whichUnit ) )
	call FlushChildHashtable( HY, h )
	call CleanCurrentTrigger( trig )

	set trig = null
	set whichUnit = null

	return false
endfunction

// 减少模型大小
function SetUnitModelScaleReduce__CallBack takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer iEvalCount = GetTriggerEvalCount(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 1)
	local real addScale = LoadReal( HY, h, 20 )
	local real currentScale = LoadReal(HY, h, 0 )
	if iEvalCount > 40 then
		call SetUnitCurrentScaleEx( whichUnit, GetUnitCurrentScale(whichUnit) )
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set currentScale = currentScale - addScale
		call SaveReal( HY, h, 0, currentScale )
		call SetUnitCurrentScaleEx(whichUnit, GetUnitCurrentScale(whichUnit) - addScale)
	endif
	set t = null
	set whichUnit = null
	return false
endfunction

function SetUnitModelScaleReduce takes nothing returns nothing
	local timer expiredTimer = GetExpiredTimer()
	local integer h = GetHandleId( expiredTimer )
	local trigger reduceTrig = CreateTrigger()
	local real addScale = LoadReal( HY, h, 20 )
	local integer removeTrigId = LoadInteger( HY, h, 10 )
	local unit whichUnit = LoadUnitHandle( HY, h, 1 )

	call RemoveSavedHandle( HY, removeTrigId, 41 )
	call SaveTriggerHandle( HY, removeTrigId, 31, reduceTrig )
	call FlushChildHashtable( HY, h )
	call DestroyTimer( expiredTimer )
	set expiredTimer = null

	set h = GetHandleId( reduceTrig )
	call TriggerRegisterTimerEvent( reduceTrig, .025, true )
	call TriggerAddCondition( reduceTrig, Condition(function SetUnitModelScaleReduce__CallBack) )
	call SaveReal( HY, h, 20, addScale )
	call SaveReal( HY, h, 0, addScale * 40 )
	call SaveUnitHandle( HY, h, 1, whichUnit )

	set whichUnit = null
	set reduceTrig = null

endfunction

// 增加模型大小
function SetUnitModelScaleAdd__CallBack takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId( trig )
	local integer iEvalCount = GetTriggerEvalCount( trig )
	local unit whichUnit = LoadUnitHandle( HY, h, 1 ) 
	local real addScale = LoadReal( HY, h, 20 )
	local real currentScale = LoadReal( HY, h, 0 )
	local timer durationTimer = null
	// 0.025 * 40   1秒内完成缩放
	if iEvalCount > 40 then
		// 缩放结束
		set durationTimer = CreateTimer()
		call TimerStart( durationTimer, LoadReal( HY, h, 21 ) - 2, false, function SetUnitModelScaleReduce )
		call SaveTimerHandle( HY, LoadInteger( HY, h, 10 ), 41, durationTimer ) // 将计时器存入移除触发器
		call RemoveSavedHandle( HY, LoadInteger( HY, h, 10 ), 30 )
		call SaveReal( HY, GetHandleId( durationTimer ), 20, LoadReal( HY, h, 20 ) ) // 存入变大缩放值
		call SaveInteger( HY, GetHandleId( durationTimer ), 10, LoadInteger( HY, h, 10 ) ) // 存入移除触发器句柄
		call SaveUnitHandle( HY, GetHandleId( durationTimer ), 1, whichUnit ) // 存入单位

		call SetUnitCurrentScaleEx( whichUnit, GetUnitCurrentScale(whichUnit) )
		call FlushChildHashtable( HY, h )
		call CleanCurrentTrigger( trig )
		set durationTimer = null
	else
		set currentScale = currentScale + addScale
		call SaveReal( HY, h, 0, currentScale )
		call SetUnitCurrentScaleEx( whichUnit, GetUnitCurrentScale(whichUnit) + addScale )
	endif
	set trig = null
	set whichUnit = null
	return false
endfunction

// 缩放单位模型
// 添加Buff - 增大缩放 - 结束前1秒减小缩放 - 移除Buff
// 死亡或驱散 - 触发移除Buff触发器 
function AddUnitModelScalePercentByDuration takes unit whichUnit, real duration, real addScale, integer buffId, integer key returns nothing
	local trigger addTrig = null
	local integer h
	local real realScale = addScale * GetUnitModelScale(whichUnit)
	local real targetTime = duration + GetGameTime()
	local timer durationTimer = null
	local trigger removeTrig = null

	local real addValue = addScale * 0.025 // 计时器每次增加的数值
	// 是以基础模型大小的倍数增加
	if not HaveSavedHandle( ExtraHT, GetHandleId(whichUnit), key ) then
		// 没存触发器 添加效果

		set durationTimer = CreateTimer()
		set removeTrig = CreateTrigger()
		if duration > 3 then
			set addTrig = CreateTrigger()
			// 40 * 0.025 为 1秒缩放时间
			call TriggerRegisterTimerEvent( addTrig, .025, true )
			call TriggerAddCondition(addTrig, Condition(function SetUnitModelScaleAdd__CallBack))
			set h = GetHandleId( addTrig )
			call SaveInteger( HY, h, 10, GetHandleId( removeTrig ) ) // 存入移除触发器
			call SaveInteger( HY, h, 11, buffId )
			call SaveUnitHandle( HY, h, 1, whichUnit )
			call SaveReal( HY, h, 20, addValue * 1. ) // 计时器每次增加的缩放大小
			call SaveReal( HY, h, 21, duration ) // 持续时间
		else // 如果时间太短来不及变大变小, 那就直接瞬间改变
			call SetUnitScale(whichUnit, realScale, realScale, realScale)
		endif

		call TimerStart( durationTimer, duration, false, null )
		call TriggerRegisterTimerExpireEvent( removeTrig, durationTimer )
		call TriggerRegisterDeathEvent( removeTrig, whichUnit )
		call TriggerAddCondition( removeTrig, Condition(function SetUnitModelScaleByDuration__Remove) )

		// 传参
		set h = GetHandleId( removeTrig )
		call SaveUnitHandle( HY, h, 1, whichUnit )
		call SaveInteger( HY, h, 10, key )
		call SaveInteger( HY, h, 11, buffId )
		call SaveReal( HY, h, 20, addScale * 1. )
		//call SaveReal( HY, h, 21, targetTime )

		// ========================================
		call SaveTriggerHandle( HY, h, 30, addTrig )
		call SaveTimerHandle( HY, h, 40, durationTimer )

		// 将触发器绑定在单位身上
		call SaveTriggerHandle( ExtraHT, GetHandleId( whichUnit ), key, removeTrig )

		// debug call SingleDebug( "添加Buff 持续时间" + R2S( duration ) )
	else
		// 这个覆盖或者叠加之类的机制对缩放更改来说很尴尬
		// 想了一堆办法 最后决定还是不管缩放只管持续时间 毕竟暴雪原版嗜血也是这个尿性
		// debug call SingleDebug( "覆盖Buff 持续时间" + R2S( duration ) )
		set removeTrig = LoadTriggerHandle( ExtraHT, GetHandleId(whichUnit), key )
		set h = GetHandleId( removeTrig )
		set durationTimer = LoadTimerHandle( HY, h, 40 )
		if TimerGetRemaining( durationTimer ) < duration then
			// 如果buff的剩余时间 小于此次buff持续时间 就重置持续时间
			call TimerStart( durationTimer, duration, false, null )
			if HaveSavedHandle( HY, h, 41 ) then
				call TimerStart( LoadTimerHandle( HY, h, 41 ), duration - 2, false, function SetUnitModelScaleReduce )
			endif
		endif
	endif
	set removeTrig = null
	set durationTimer = null
endfunction

function N_X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 14))
	local integer id =(LoadInteger(HY, h, 52))
	if u != null then
		call UnitRemoveAbility(u, id)
		call UnitRemoveAbility(u, 'B041')
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set u = null
	return false
endfunction
function N1X takes unit u, integer id, real time returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call UnitAddPermanentAbility(u, id)
	call TriggerRegisterTimerEvent(t, time, false)
	call TriggerAddCondition(t, Condition(function N_X))
	call SaveUnitHandle(HY, h, 14,(u))
	call SaveInteger(HY, h, 52,(id))
	set t = null
endfunction
function N2X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local unit whichUnit = LoadUnitHandle(HY, h, 43)
	local real N3X = LoadReal(HY, h, 44)
	local unit N4X = LoadUnitHandle(HY, h, 45)
	local real xp = GetUnitX(N4X)
	local real yp = GetUnitY(N4X)
	local real xt = GetUnitX(targetUnit)
	local real yt = GetUnitY(targetUnit)
	local real N5X = N3X * .03
	local real I3X = AngleBetweenXY(xp, yp, xt, yt)
	local real dx = xp + N5X * Cos(I3X * bj_DEGTORAD)
	local real dy = yp + N5X * Sin(I3X * bj_DEGTORAD)
	call SetUnitX(N4X, dx)
	call SetUnitY(N4X, dy)
	call SetUnitFacing(N4X, I3X)
	if UnitIsDead(targetUnit) then
		call KillUnit(N4X)
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	elseif GetDistanceBetween(xt, yt, dx, dy)<= N5X then
		call KillUnit(N4X)
		set YG = whichUnit
		set ZG = targetUnit
		call ExecuteFunc(LoadStr(HY, h, 46))
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	endif
	set t = null
	set targetUnit = null
	set N4X = null
	set whichUnit = null
	return false
endfunction
function N6X takes unit whichUnit, unit targetUnit, integer N4X, string N7X, real N3X returns trigger
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local real N8X = GetUnitFacing(whichUnit)
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function N2X))
	call SaveReal(HY, h, 44, N3X)
	call SaveUnitHandle(HY, h, 30, targetUnit)
	call SaveStr(HY, h, 46, N7X)
	call SaveUnitHandle(HY, h, 43, whichUnit)
	call SaveUnitHandle(HY, h, 45, CreateUnit(GetOwningPlayer(whichUnit), N4X, x, y, N8X))
	set VH = t
	set t = null
	return VH
endfunction
function N9X takes nothing returns nothing
	set bj_groupCountUnits = bj_groupCountUnits + 1
endfunction
function BVX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local fogmodifier fm =(LoadFogModifierHandle(HY, h, 42))
	call FogModifierStop(fm)
	call DestroyFogModifier(fm)
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
	set fm = null
endfunction
function BEX takes fogmodifier fm, real EHX returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call FogModifierStart(fm)
	call SaveFogModifierHandle(HY, h, 42, fm)
	call TimerStart(t, EHX, false, function BVX)
	set t = null
endfunction
function BXX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer BOX = LoadInteger(HY, h, 55)
	local destructable d = V3X(BOX)
	if d != null then
		call RemoveDestructable(d)
	endif
	call V4X(BOX)
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set d = null
	set t = null
endfunction
function RemoveDestructableToTimed takes destructable d, real S7V returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, S7V, false, function BXX)
	call SaveInteger(HY, h, 55, V5X(d))
	set t = null
endfunction
function BIX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call SetUnitAnimation(LoadUnitHandle(HY, h, 53), "stand")
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
endfunction
function BAX takes unit u, real EHX returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 53, u)
	call TimerStart(t, EHX, false, function BIX)
	set t = null
endfunction
function BNX takes real EHX, boolean BBX, real x, real y, real BCX, real BDX, real BFX, real BGX, real BHX returns nothing
	local real BJX
	local real BKX
	local real BLX
	if (BDX <= 0 or BHX <= 0 or BGX <= 0) then
		return
	endif
	set BKX = 2. * EHX / BGX
	set BJX = 2. * BDX / BHX
	set BLX = BCX / BDX
	call TerrainDeformRipple(x, y, BDX, BFX, R2I(EHX * 1000), 1, BJX, BKX, BLX, BBX)
endfunction
function BMX takes player p, unit u, integer g returns nothing
	local texttag t
	local string s = ""
	local boolean b = LocalPlayer== p
	local boolean bb = IsObserverPlayer(LocalPlayer)
	set g = AddPlayerResourceGold(p, g)
	set t = CreateTextTag()
	if GetHandleId(t)> 0 then
		call SetTextTagText(t, "+" + I2S(g), .025)
		call SetTextTagPosUnit(t, u,-0.4)
		if bb then
			call SetTextTagColorBJ(t, VQV[GetPlayerId(p)], VSV[GetPlayerId(p)], VTV[GetPlayerId(p)], 15)
		else
			call SetTextTagColor(t, 255, 220, 0, 255)
		endif
		call SetTextTagVelocity(t, 0, .03)
		call SetTextTagVisibility(t, b)
		call SetTextTagFadepoint(t, 2)
		call SetTextTagLifespan(t, 3)
		call SetTextTagPermanent(t, false)
	else
		call DestroyTextTag(t)
	endif
	if b or bb then
		set s = "UI\\Feedback\\GoldCredit\\GoldCredit.mdl"
	endif
	call DestroyEffect(AddSpecialEffectTarget(s, u, "overhead"))
	set t = null
endfunction
function BPX takes nothing returns boolean
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call FlushChildHashtable(HY,(GetHandleId((LoadUnitHandle(HY, h, 26)))))
	call ShowUnit(LoadUnitHandle(HY, h, 26), false)
	call RemoveUnit(LoadUnitHandle(HY, h, 26))
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
	return false
endfunction
function RemoveUnitToTimed takes unit u, real d returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, d, false, function BPX)
	call SaveUnitHandle(HY, h, 26, u)
	set t = null
endfunction
function BSX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call RemoveUnit((LoadUnitHandle(HY, h, 26)))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function BTX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call KillUnit((LoadUnitHandle(HY, h, 26)))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function BUX takes unit u, real d returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, d, false)
	call TriggerAddCondition(t, Condition(function BTX))
	call SaveUnitHandle(HY, h, 26,(u))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, d + .01, false)
	call TriggerAddCondition(t, Condition(function BSX))
	call SaveUnitHandle(HY, h, 26,(u))
	set t = null
endfunction
function BWX takes sound A6X returns nothing
	if A6X != null then
		if T3[LocalPlayerId]== false then
			call StartSound(A6X)
		endif
	endif
endfunction
function BYX takes sound A6X, player BZX returns nothing
	if LocalPlayer== BZX and T3[GetPlayerId(BZX)]== false then
		call StartSound(A6X)
	endif
endfunction
function B_X takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) == false))
endfunction
function B0X takes nothing returns nothing
	call BYX(WJ, GetOwningPlayer(GetEnumUnit()))
endfunction
function B1X takes unit whichUnit, sound A6X, real x, real y, real r returns nothing
	local group g = AllocationGroup(3)
	set U2 = whichUnit
	set WJ = A6X
	call GroupEnumUnitsInRange(g, x, y, r, Condition(function B_X))
	call GroupRemoveUnit(g, whichUnit)
	call ForGroup(g, function B0X)
	call DeallocateGroup(g)
	set g = null
endfunction
function B2X takes unit whichUnit, item UWV returns integer
	local integer i = 0
	loop
	exitwhen i > 5
		if UnitItemInSlot(whichUnit, i) == UWV then
			return i
		endif
		set i = i + 1
	endloop
	return -1
endfunction
function B3X takes real n1, real n2 returns integer
	if n1 / n2 -R2I(n1 / n2)>= .5 then
		return R2I(n1 / n2)+ 1
	endif
	return R2I(n1 / n2)
endfunction
function B4X takes player p returns nothing //esc清屏
	if LocalPlayer== p then
		call ClearTextMessages()
		//call DzFrameShow( UIFrame__Text[1], false )
	endif
endfunction
function B5X takes unit u, real d returns nothing
	call SetWidgetLife(u, RMaxBJ(GetWidgetLife(u)-d, 1))
endfunction
function B6X takes integer B7X returns nothing
	call RemoveUnit(CreateUnit(Player(15), B7X, 0, 0, 0))
endfunction
function B8X takes player p, integer goldBonus, unit u returns nothing
	local texttag t = CreateTextTag()
	local string s = "UI\\Feedback\\GoldCredit\\GoldCredit.mdl"
	set goldBonus = AddPlayerResourceGold(p, goldBonus)
	call SetTextTagText(t, "+" + I2S(goldBonus), .025)
	call SetTextTagPosUnit(t, u, 0)
	call SetTextTagColor(t, 255, 220, 0, 255)
	call SetTextTagVelocity(t, 0, .03)
	if LocalPlayer!= p then
		set s = ""
	endif
	call SetTextTagVisibility(t, LocalPlayer== p)
	if GetWidgetLife(u)> .5 then
		call DestroyEffect(AddSpecialEffectTarget(s, u, "overhead"))
	endif
	call SetTextTagFadepoint(t, 2)
	call SetTextTagLifespan(t, 3)
	call SetTextTagPermanent(t, false)
	set t = null
endfunction
function B9X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer CVX =(LoadInteger(HY, h, 59))
	if UnitRemoveAbility(targetUnit, CVX) or GetUnitAbilityLevel(targetUnit, CVX) == 0 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function CEX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer CVX =(LoadInteger(HY, h, 59))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	if UnitRemoveAbility(targetUnit, CVX) == false then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DEATH)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function B9X))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SaveInteger(HY, h, 59,(CVX))
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function CXX takes unit targetUnit, integer CVX, integer level, real EHX returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call UnitAddPermanentAbility(targetUnit, CVX)
	call SetUnitAbilityLevel(targetUnit, CVX, level)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterTimerEvent(t, EHX, false)
	call TriggerAddCondition(t, Condition(function CEX))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 59,(CVX))
	set t = null
endfunction
function COX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer CVX =(LoadInteger(HY, h, 59))
	local integer CRX =(LoadInteger(HY, h, 59))
	call UnitRemoveAbility(targetUnit, CRX)
	if UnitRemoveAbility(targetUnit, CVX) or GetUnitAbilityLevel(targetUnit, CVX) == 0 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function CIX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer T0V =(LoadInteger(HY, h, 59))
	local integer CAX =(LoadInteger(HY, h, 60))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call UnitRemoveAbility(targetUnit, CAX)
	if UnitRemoveAbility(targetUnit, T0V) == false then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DEATH)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function COX))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SaveInteger(HY, h, 59,(T0V))
		call SaveInteger(HY, h, 60,(CAX))
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function CNX takes unit targetUnit, integer T0V, integer level, real SYV, integer CAX returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call UnitAddPermanentAbility(targetUnit, T0V)
	call SetUnitAbilityLevel(targetUnit, T0V, level)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterTimerEvent(t, SYV, false)
	call TriggerAddCondition(t, Condition(function CIX))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 59,(T0V))
	call SaveInteger(HY, h, 60,(CAX))
	set t = null
endfunction
function UnitAddAbilityTimedEx_RemoveFix takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 17)
	local integer CAX = LoadInteger(HY, h, 60)
	local integer T0V = LoadInteger(HY, h, 59)
	call UnitRemoveAbility(u, T0V)
	if UnitRemoveAbility(u, CAX) or GetUnitAbilityLevel(u, CAX) == 0 then
		call RemoveSavedHandle(ObjectHashTable, GetHandleId(u), 0 -T0V)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	return false
endfunction
function CBX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 17)
	local integer T0V = LoadInteger(HY, h, 59)
	local integer CAX = LoadInteger(HY, h, 60)
	local timer tt = LoadTimerHandle(HY, h, 10)
	call SaveBoolean(HY, h, 0, true)
	call UnitRemoveAbility(u, CAX)
	call UnitRemoveAbility(u, T0V)
	if GetUnitAbilityLevel(u, T0V) == 0 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call DestroyTimer(tt)
		call RemoveSavedHandle(ObjectHashTable, GetHandleId(u), 0 -T0V)
	else
		call TimerStart(tt, 1, true, null)
	endif
	set u = null
	set t = null
	return false
endfunction

// 添加技能 多用于龙卷风减速光环 携带buffId在timeout后一起删除
// 龙卷风减速光环设置等级有滞后，因此不应该多用
function UnitAddAbilityToTimed takes unit u, integer abilityId, integer level, real timeout, integer buffId returns nothing
	local trigger t
	local integer h
	local real lastRemaining
	//local real ndur = GetGameTime()+ timeout
	local timer tt
	if not UnitAlive(u) then
		return
	endif
	if HaveSavedHandle(ObjectHashTable, GetHandleId(u), 0 -abilityId) then
		set t = LoadTriggerHandle(ObjectHashTable, GetHandleId(u), 0 -abilityId)
		set h = GetHandleId(t)
		set tt = LoadTimerHandle(HY, h, 10)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		set tt = CreateTimer()
		call FlushChildHashtable(HY, h)
		call SaveUnitHandle(HY, h, 17, u)
		call SaveInteger(HY, h, 59, abilityId)
		call SaveInteger(HY, h, 60, buffId)
		call SaveReal(HY, h, 0, 0)
		call TriggerRegisterDeathEvent(t, u)
		call SaveTimerHandle(HY, h, 10, tt)
		call TriggerRegisterTimerExpireEvent(t, tt)
		call TriggerAddCondition(t, Condition(function CBX))
		call SaveTriggerHandle(ObjectHashTable, GetHandleId(u), 0 -abilityId, t)
	endif
	call RemoveSavedBoolean(HY, h, 0)
	set lastRemaining = TimerGetRemaining(tt)
	if lastRemaining < timeout then
		call TimerStart(tt, timeout, false, null)
	endif
	set t = null
	set tt = null
	call UnitAddPermanentAbilitySetLevel(u, abilityId, level)
endfunction

function PasSkillCoolDownTimer takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local player p = LoadPlayerHandle(HY, h, 1)
	if not SPCDB[GetPlayerId(p)] then
		call SetPlayerAbilityAvailable(p, 'QP1G', true)
		call SetPlayerAbilityAvailable(p, 'A522', true)
		call SetPlayerAbilityAvailable(p, 'QP17', true)
		call SetPlayerAbilityAvailable(p, 'QP1O', true)
		call SetPlayerAbilityAvailable(p, 'A3UF', true)
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set p = null
endfunction

function PasSkillCoolDownActions takes nothing returns boolean
	local trigger tri = GetTriggeringTrigger()
	local timer t = CreateTimer()
	local integer tri_h = GetHandleId(tri)
	local integer h = GetHandleId(t)
	local player p = LoadPlayerHandle(HY, tri_h, 1)
	call SetPlayerAbilityAvailable(p, 'QP1G', false)
	call SetPlayerAbilityAvailable(p, 'A522', false)
	call SetPlayerAbilityAvailable(p, 'QP17', false)
	call SetPlayerAbilityAvailable(p, 'QP1O', false)
	call SetPlayerAbilityAvailable(p, 'A3UF', false)
	
	call SavePlayerHandle(HY, h, 1, p)
	call TimerStart(t, 0.00, false, function PasSkillCoolDownTimer)
	set p = null
	set t = null
	set tri = null
	return false
endfunction

function PasSkillCoolDownTrigger takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	
	call SavePlayerHandle(HY, h, 1, GetOwningPlayer(u))
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function PasSkillCoolDownActions))
	call SaveTriggerHandle(PassiveAbilityCooldown, GetHandleId(u),'PACD', t)
	set t = null
endfunction

function Learn_HaveCoolDownSkill takes nothing returns nothing
	if not HaveSavedHandle(PassiveAbilityCooldown, GetHandleId(GetTriggerUnit()),'PACD') then
		call PasSkillCoolDownTrigger(GetTriggerUnit())
	endif
endfunction

function CFX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if UnitAlive(u) then
		call SetUnitAnimationByIndex(u, LoadInteger(HY, h, 0))
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction
function CGX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u1 = LoadUnitHandle(HY, h, 61)
	local unit u2 = LoadUnitHandle(HY, h, 62)
	local real EHX =(LoadReal(HY, h, 57))
	local lightning APX =(LoadLightningHandle(HY, h, 41))
	if I2R(GetTriggerEvalCount(t))* .025 > EHX then
		call DestroyLightning(APX)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call MoveLightning(APX, true, GetUnitX(u1), GetUnitY(u1), GetUnitX(u2), GetUnitY(u2))
	endif
	set t = null
	set u1 = null
	set u2 = null
	set APX = null
	return false
endfunction
function CHX takes string AMX, unit u1, unit u2, real r, real g, real b, real a, real EHX returns nothing
	local real x1 = GetUnitX(u1)
	local real y1 = GetUnitY(u1)
	local real x2 = GetUnitX(u2)
	local real y2 = GetUnitY(u2)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local lightning APX = AddLightning(AMX, true, x1, y1, x2, y2)
	call SetLightningColor(APX, r, g, b, a)
	call SaveLightningHandle(HY, h, 41,(APX))
	call SaveUnitHandle(HY, h, 61,((u1)))
	call SaveUnitHandle(HY, h, 62,((u2)))
	call SaveReal(HY, h, 57,((EHX)* 1.))
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function CGX))
	set t = null
	set APX = null
endfunction
function CJX takes string CKX returns nothing
	local sound CLX = CreateSound(CKX, false, false, false, 10, 10, "")
	call SetSoundVolume(CLX, 0)
	call StartSound(CLX)
	call KillSoundWhenDone(CLX)
	set CLX = null
endfunction
function CMX takes integer i returns boolean
	return i =='o01J' or i =='o01K' or i =='o01L' or i =='o01M'
endfunction
function IsNecronomiconUnit takes unit u returns boolean
	local integer id = GetUnitTypeId(u)
	return id =='n00J' or id =='n00H' or id =='n00A' or id =='n00G' or id =='n006' or id =='n00K'
endfunction
function IsBearUnit takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return i =='n004' or i =='n018' or i =='n01C' or i =='n01G'
endfunction
function CSX takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return i =='n00U' or i =='n0KU' or i =='n00Y' or i =='n0KV' or i =='n00Z' or i =='n0KW'
endfunction
function CTX takes integer i returns boolean
	return i =='npn3' or i =='npn6' or i =='n010' or i =='n0GZ'
endfunction
function CUX takes integer i returns boolean
	return i =='npn2' or i =='npn5' or i =='n012' or i =='n0H1'
endfunction
function CWX takes integer i returns boolean
	return i =='npn1' or i =='npn4' or i =='n011' or i =='n0H0'
endfunction
function CYX takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return CTX(i) or CUX(i) or CWX(i)
endfunction
function CZX takes integer i returns boolean
	return CWX(i) or CUX(i) or CTX(i)
endfunction
function C_X takes unit u returns boolean
	return IsBearUnit(u) or CSX(u) or CYX(u) or u == Roshan
endfunction
function C0X takes player p returns nothing
	local unit trigUnit = Player__Hero[GetPlayerId(p)]
	local integer i = 0
	local item C1X
	loop
	exitwhen i > 5
		set C1X = UnitItemInSlot(trigUnit, i)
		call SetItemDroppable(C1X, false)
		set i = i + 1
	endloop
	set trigUnit = null
	set C1X = null
endfunction
function C2X takes player p returns nothing
	local unit trigUnit = Player__Hero[GetPlayerId(p)]
	local integer i = 0
	local item C1X
	loop
	exitwhen i > 5
		set C1X = UnitItemInSlot(trigUnit, i)
		call SetItemDroppable(C1X, true)
		set i = i + 1
	endloop
	set trigUnit = null
	set C1X = null
endfunction
function IsUnitBreak takes unit u returns boolean
	return GetUnitAbilityLevel(u, 'A36D') == 1
endfunction
function IsUnitWard takes unit u returns boolean
	return GetUnitAbilityLevel(u, 'A04R') > 0
endfunction
function IsUnitDummy takes unit u returns boolean
	return GetUnitAbilityLevel(u, 'Aloc') > 0
endfunction
function IsUnitInvision takes unit u returns boolean
	return MHUnit_GetInvisionCount(u) > 0
	//return GetUnitAbilityLevel(u,'B068')> 0 or GetUnitAbilityLevel(u,'B07T')> 0 or GetUnitAbilityLevel(u,'B076')> 0 or GetUnitAbilityLevel(u,'BOwk')> 0 or GetUnitAbilityLevel(u,'B04R')> 0 or GetUnitAbilityLevel(u,'B0A5')> 0 or GetUnitAbilityLevel(u,'B01Q')> 0 or GetUnitAbilityLevel(u,'B006')> 0 or GetUnitAbilityLevel(u,'Binv')> 0 or GetUnitAbilityLevel(u,'Apiv')> 0 or GetUnitAbilityLevel(u,'A021')> 0 or GetUnitAbilityLevel(u,'A0K4')> 0 or GetUnitAbilityLevel(u,'A0XB')> 0 or GetUnitAbilityLevel(u,'A0Z2')> 0 or GetUnitAbilityLevel(u,'A1GA')> 0 or GetUnitAbilityLevel(u,'A1HW')> 0 or GetUnitAbilityLevel(u,'A1HX')> 0 or GetUnitAbilityLevel(u,'A00J')> 0 or GetUnitAbilityLevel(u,'B08K')> 0 or GetUnitAbilityLevel(u,'B08X')> 0 or GetUnitAbilityLevel(u,'B039')> 0 or GetUnitAbilityLevel(u,'B00K')> 0 or GetUnitAbilityLevel(u,'BHfs')> 0 or GetUnitAbilityLevel(u,'A140')> 0 or GetUnitAbilityLevel(u,'B021')> 0 or GetUnitAbilityLevel(u,'A0ZD')> 0 or GetUnitAbilityLevel(u,'A0KT')> 0
endfunction
function IsUnitSilence takes unit u returns boolean
	return MHUnit_GetSilenceCount(u) > 0
	//return GetUnitAbilityLevel(u,'B01T')> 0 or GetUnitAbilityLevel(u,'BNsi')> 0 or GetUnitAbilityLevel(u,'B01X')> 0 or GetUnitAbilityLevel(u,'BNdo')> 0 or GetUnitAbilityLevel(u,'B02M')> 0 or GetUnitAbilityLevel(u,'Bhea')> 0 or GetUnitAbilityLevel(u,'B07V')> 0 or GetUnitAbilityLevel(u,'B0BY')> 0 or GetUnitAbilityLevel(u,'B08O')> 0 or GetUnitAbilityLevel(u,'B07U')> 0 or GetUnitAbilityLevel(u,'B0DL')> 0 or GetUnitAbilityLevel(u,'B08V')> 0 or GetUnitAbilityLevel(u,'B031')> 0 or GetUnitAbilityLevel(u,'B0FT')> 0 or GetUnitAbilityLevel(u,'B0FG')> 0 or GetUnitAbilityLevel(u,'B450')> 0 or GetUnitAbilityLevel(u,'B463')> 0
endfunction
function IsUnitEthereal takes unit u returns boolean
	return MHUnit_GetEtherealCount(u) > 0
endfunction
function IsUnitAttackDisable takes unit u returns boolean
	return MHAbility_GetDisableCount(u, 'Aatk') > 0
endfunction
function IsUnitInvulnerable takes unit u returns boolean
	return MHUnit_IsInvulnerable(u)
endfunction
function C4X takes unit u returns boolean
	return GetUnitAbilityLevel(u,'B0C1')> 0 or GetUnitAbilityLevel(u,'BEer')> 0 or GetUnitAbilityLevel(u,'Beng')> 0 or GetUnitAbilityLevel(u,'Bena')> 0 or GetUnitAbilityLevel(u,'B017')> 0 or GetUnitAbilityLevel(u,'B078')> 0 or GetUnitAbilityLevel(u,'B08F')> 0 or GetUnitAbilityLevel(u,'B08E')> 0 or GetUnitAbilityLevel(u,'B0ER')> 0 or GetUnitAbilityLevel(u,'B0FN')> 0
endfunction
function C5X takes unit u returns boolean
	return GetUnitAbilityLevel(u,'B00H')> 0 or GetUnitAbilityLevel(u,'BOhx')> 0 or GetUnitAbilityLevel(u,'BPSE')> 0 or GetUnitAbilityLevel(u,'B099')> 0 or GetUnitAbilityLevel(u,'BSTN')> 0 or GetUnitAbilityLevel(u,'B0CF')> 0 or GetUnitAbilityLevel(u,'B0BM')> 0 or GetUnitAbilityLevel(u,'B07N')> 0 or GetUnitAbilityLevel(u,'B08S')> 0 or GetUnitAbilityLevel(u,'B00Q')> 0 or GetUnitAbilityLevel(u,'B04V')> 0 or GetUnitAbilityLevel(u,'B072')> 0 or GetUnitAbilityLevel(u,'BUan')> 0 or GetUnitAbilityLevel(u,'B095')> 0 or GetUnitAbilityLevel(u,'B03I')> 0 or GetUnitAbilityLevel(u,'B0AD')> 0 or GetUnitAbilityLevel(u,'B0AE')> 0 or GetUnitAbilityLevel(u,'B0BE')> 0 or GetUnitAbilityLevel(u,'B0BF')> 0 or GetUnitAbilityLevel(u,'B008')> 0 or GetUnitAbilityLevel(u,'B04B')> 0 or GetUnitAbilityLevel(u,'B02F')> 0 or GetUnitAbilityLevel(u,'BUsp')> 0 or GetUnitAbilityLevel(u,'BUst')> 0 or GetUnitAbilityLevel(u,'B0DD')> 0 or GetUnitAbilityLevel(u,'B0C2')> 0 or GetUnitAbilityLevel(u,'B06S')> 0 or GetUnitAbilityLevel(u,'B02S')> 0 or GetUnitAbilityLevel(u,'B00Q')> 0 or LoadInteger(HY, GetHandleId(u), 4293) == 1 or LoadInteger(HY, GetHandleId(u), 4303) == 1
endfunction
function C6X takes unit u returns boolean
	return C5X(u) or C4X(u) or IsUnitPaused(u) or RCX(u)
endfunction
function SetResourceBarTime takes integer minute, integer second, boolean extraColor returns nothing
	local integer x = 0
	loop
	exitwhen x > 15
		call SetPlayerState(Player(x), PLAYER_STATE_RESOURCE_LUMBER, minute)
		call SetPlayerState(Player(x), PLAYER_STATE_RESOURCE_FOOD_USED, second)
		set x = x + 1
	endloop
endfunction
function DVX takes unit u returns boolean
	return false
endfunction
function GetTerrainCliffFixLocation takes real x, real y returns location
	local real targetX
	local real targetY
	local integer i = 0
	loop
	exitwhen i > 40
		set targetX = x + i * 20
		set targetY = y + i * 20
		if IsPointInRegion(TerrainCliffRegion, targetX, targetY) == false then
			return Location(targetX, targetY)
		endif
		set targetX = x + i * 20
		set targetY = y -i * 20
		if IsPointInRegion(TerrainCliffRegion, targetX, targetY) == false then
			return Location(targetX, targetY)
		endif
		set targetX = x -i * 20
		set targetY = y + i * 20
		if IsPointInRegion(TerrainCliffRegion, targetX, targetY) == false then
			return Location(targetX, targetY)
		endif
		set targetX = x -i * 20
		set targetY = y -i * 20
		if IsPointInRegion(TerrainCliffRegion, targetX, targetY) == false then
			return Location(targetX, targetY)
		endif
		set i = i + 1
	endloop
	return Location(x, y)
endfunction
function DXX takes unit u returns boolean
	return IsUnitVisible(u, NeutralCreepPlayer) == false
endfunction

function DRX takes unit whichUnit returns boolean
	local integer DIX = GetUnitTypeId(whichUnit)
	return DIX =='n004' or DIX =='n01G' or DIX =='n01C' or DIX =='n018'
endfunction

// IsAliveNotStrucNotWard
// 存活 非建筑 非 守卫
function IsUnitStructure takes unit u returns boolean
	return IsUnitType(u, UNIT_TYPE_STRUCTURE)
endfunction
function IsAliveNotStrucNotWard takes unit u returns boolean
	return UnitAlive(u) and not IsUnitType(u, UNIT_TYPE_STRUCTURE) and GetUnitAbilityLevel(u,'A04R') == 0
endfunction

function DNX takes nothing returns boolean
	return IsAliveNotStrucNotWard(GetFilterUnit())
endfunction
// 不是远古 但可以是熊灵
function IsNotAncientOrBear takes unit u returns boolean
	return not IsUnitType(u, UNIT_TYPE_ANCIENT) or DRX(u)
endfunction
function DCX takes nothing returns boolean
	return(IsUnitMagicImmune(GetFilterUnit()) == false and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and UnitIsDead(GetFilterUnit()) == false) and IsNotAncientOrBear(GetFilterUnit()))!= null
endfunction
function DDX takes nothing returns boolean
	return(IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit()))!= null
endfunction
function DFX takes nothing returns boolean
	return(IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())))!= null
endfunction
function DGX takes nothing returns boolean
	return(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)))!= null
endfunction
function DHX takes nothing returns boolean
	return IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit())
endfunction
function DJX takes nothing returns boolean
	return IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()) and IsUnitMagicImmune(GetFilterUnit()) == false
endfunction
function DKX takes nothing returns boolean
	return DHX() and IsNotAncientOrBear(GetFilterUnit())
endfunction
function DLX takes nothing returns boolean
	return((((IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit())) and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO))))
endfunction
function DMX takes nothing returns boolean
	return((IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit())))!= null
endfunction
function DPX takes nothing returns boolean
	return IsUnitMagicImmune(GetFilterUnit()) == false and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit()))
endfunction
function DQX takes nothing returns boolean
	return DPX() and IsNotAncientOrBear(GetFilterUnit())
endfunction
function DSX takes nothing returns boolean
	return(IsUnitMagicImmune(GetFilterUnit()) == false and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit()))!= null
endfunction

function DUX takes nothing returns boolean
	return(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())))!= null
endfunction
function DWX takes nothing returns boolean
	return(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and UnitIsDead(GetFilterUnit()) == false) and IsNotAncientOrBear(GetFilterUnit()))!= null
endfunction
function DYX takes nothing returns boolean
	return(((IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and UnitIsDead(GetFilterUnit()) == false) and IsNotAncientOrBear(GetFilterUnit())) and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) == false))
endfunction
function DZX takes nothing returns boolean
	return(IsUnitMagicImmune(GetFilterUnit()) == false and(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and UnitIsDead(GetFilterUnit()) == false) and IsNotAncientOrBear(GetFilterUnit())))!= null
endfunction
function D_X takes nothing returns boolean
	return(IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) == false and(IsAliveNotStrucNotWard(GetFilterUnit())))!= null
endfunction
function D0X takes nothing returns boolean
	return(IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) == false and XFX(GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())))!= null
endfunction
function D1X takes nothing returns boolean
	return(IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) == false and(IsAliveNotStrucNotWard(GetFilterUnit())))!= null
endfunction
function D2X takes nothing returns boolean
	return(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) == false and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit()))!= null
endfunction
function D3X takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) == false and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit())))
endfunction
function D4X takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) == false and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit())))
endfunction
function D5X takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit())))
endfunction
function D6X takes nothing returns boolean
	return(((IsUnitInvision(GetFilterUnit()) == false or UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2))) and(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit()))))
endfunction
function D7X takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit())))
endfunction
function D8X takes nothing returns boolean
	return((IsUnitMagicImmune(GetFilterUnit()) == false and(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit()))))
endfunction
function D9X takes nothing returns boolean
	return(((IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit())))!= null
endfunction
function FVX takes nothing returns boolean
	return(IsAliveNotStrucNotWard(GetFilterUnit()))!= null
endfunction
function FEX takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit())))
endfunction
function FXX takes nothing returns boolean
	return DHX() and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and GetUnitTypeId(GetFilterUnit())!='n0F5'
endfunction
function FOX takes nothing returns boolean
	return(IsUnitMagicImmune(GetFilterUnit()) == false and((IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit())) and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)))!= null
endfunction
function FRX takes nothing returns boolean
	return IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(U2)) and X8X(GetFilterUnit())> 0
endfunction
function FIX takes unit u returns nothing
	if LoadReal(HY, GetHandleId(u),'AItb')+12 < GetGameTime() then
		call UnitRemoveAbility(u,'Bdet')
	endif
endfunction
function FAX takes unit whichUnit, unit targetUnit returns nothing
	local unit d = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddAbility(d,'A2VW')
	call IssueImmediateOrderById(d, 852625)
	call KillUnit(d)
	set d = null
endfunction
function FNX takes unit whichUnit, integer level, integer FBX returns nothing
	local integer i
	if K2V[1]== 0 then
		return
	endif
	set i = 1
	loop
	exitwhen i > 10
		call UnitRemoveAbility(whichUnit, K2V[i])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > 10
		call UnitRemoveAbility(whichUnit, K3V[i])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > 10
		call UnitRemoveAbility(whichUnit, K4V[i])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > 10
		call UnitRemoveAbility(whichUnit, K5V[i])
		set i = i + 1
	endloop
	call UnitRemoveAbility(whichUnit,'B0BS')
	if level == 0 and FBX == 0 then
		call SaveInteger(HY, GetHandleId(whichUnit), 281, 0)
	endif
	if level == 1 then
		call UnitAddAbility(whichUnit, K2V[FBX])
	elseif level == 2 then
		call UnitAddAbility(whichUnit, K3V[FBX])
	elseif level == 3 then
		call UnitAddAbility(whichUnit, K4V[FBX])
	elseif level == 4 then
		call UnitAddAbility(whichUnit, K5V[FBX])
	endif
endfunction
function FCX takes integer id returns boolean
	return id =='A0XK' or id =='A3G5' or id =='A13V' or id =='A3G2' or id =='A2TN'
endfunction
function FDX takes integer id returns boolean
	return FCX(id) or id =='AIpg' or id =='A1SA' or id =='A594' or id =='A595' or id =='A02V' or id =='ACpu' or id =='A18D' or id =='A1OU'
endfunction

// 注册一个Buff 
function SetBuffAbilityId takes integer id, integer buffType returns nothing
	call SaveInteger(AbilityDataHashTable, buffType, LoadInteger(AbilityDataHashTable, buffType, 0)+ 1, id)
	call SaveInteger(AbilityDataHashTable, buffType, 0, LoadInteger(AbilityDataHashTable, buffType, 0)+ 1)
endfunction

// 注册物理Buff
function SetStunBuffId takes integer id returns nothing
	set A4 = A4 + 1
	set I4[A4]= id
endfunction

function FHX takes unit u returns nothing
	local integer i = 1
	loop
	exitwhen HaveSavedInteger(AbilityDataHashTable,'PRGN', i) == false
		call UnitRemoveAbility(u, LoadInteger(AbilityDataHashTable,'PRGN', i))
		set i = i + 1
	endloop
endfunction

// 移除缴械类状态
function FJX takes unit u returns nothing
	local integer i = 1
	loop
	exitwhen not HaveSavedInteger(AbilityDataHashTable,'PRGH', i)
		call UnitRemoveAbility(u, LoadInteger(AbilityDataHashTable,'PRGH', i))
		set i = i + 1
	endloop
endfunction

// 驱散Buff
function FKX takes unit u, boolean strongDispel returns nothing
	local integer i = 1
	loop
	exitwhen not HaveSavedInteger(AbilityDataHashTable,'PRGC', i)
		call UnitRemoveAbility(u, LoadInteger(AbilityDataHashTable,'PRGC', i))
		set i = i + 1
	endloop
	// 强驱散
	if strongDispel then
		set i = 1
		loop
		exitwhen not HaveSavedInteger(AbilityDataHashTable,'PRGA', i)
			call UnitRemoveAbility(u, LoadInteger(AbilityDataHashTable,'PRGA', i))
			set i = i + 1
		endloop
		call RemoveSavedInteger(HY, GetHandleId(u),'A2SG')
	else
		set i = 1
		loop
		exitwhen not HaveSavedInteger(AbilityDataHashTable,'PRGE', i)
			call UnitRemoveAbility(u, LoadInteger(AbilityDataHashTable,'PRGE', i))
			set i = i + 1
		endloop
		set i = 1
		loop
		exitwhen not HaveSavedInteger(AbilityDataHashTable,'PRGI', i)
			call UnitRemoveAbility(u, LoadInteger(AbilityDataHashTable,'PRGI', i))
			set i = i + 1
		endloop
		set i = 1
		loop
		exitwhen not HaveSavedInteger(AbilityDataHashTable,'PRGS', i)
			call UnitRemoveAbility(u, LoadInteger(AbilityDataHashTable,'PRGS', i))
			set i = i + 1
		endloop
		set i = 1
		loop
		exitwhen not HaveSavedInteger(AbilityDataHashTable,'PRGN', i)
			call UnitRemoveAbility(u, LoadInteger(AbilityDataHashTable,'PRGN', i))
			set i = i + 1
		endloop
		call FNX(u, 0, 0)
		call RemoveSavedReal(HY, GetHandleId(u),'AItb')
		if LoadInteger(HY, GetHandleId(u), 627)> 0 then
			call SaveInteger(HY, GetHandleId(u), 627, 0)
		endif
	endif
	call UnitRemoveAbility(u, 'Bblo')
	call UnitRemoveAbility(u, 'B016')
	// 嗜血Buff删除
	if HaveSavedHandle( ExtraHT, GetHandleId(u), HTKEY_SCALE_BLOODLUST_TRIGGER ) then
		// debug call SingleDebug( " 强制运行缩放触发器 " )
		call TriggerEvaluate( LoadTriggerHandle( ExtraHT, GetHandleId(u), HTKEY_SCALE_BLOODLUST_TRIGGER ) )
	endif
	// 狂猛Buff删除
	if HaveSavedHandle( ExtraHT, GetHandleId(u), HTKEY_SCALE_RABID_TRIGGER ) then
		// debug call SingleDebug( " 强制运行缩放触发器 " )
		call TriggerEvaluate( LoadTriggerHandle( ExtraHT , GetHandleId(u) , HTKEY_SCALE_RABID_TRIGGER ) )
	endif
endfunction

function GetBashlv takes real s returns integer
	set s = s * 1.
	if s < .5 then
		return R2I(s * 10)
	elseif s < .9 then
		return R2I((s -0.4)* 10)
	elseif s < 1.3 then
		return R2I((s -0.8)* 10)
	elseif s < 1.7 then
		return R2I((s -1.2)* 10)
	elseif s < 2.1 then
		return R2I((s -1.6)* 10)
	elseif s < 2.5 then
		return R2I((s -2.)* 10)
	elseif s < 2.9 then
		return R2I((s -2.4)* 10)
	elseif s < 3.3 then
		return R2I((s -2.8)* 10)
	elseif s < 3.7 then
		return R2I((s -3.2)* 10)
	elseif s < 4.1 then
		return R2I((s -3.6)* 10)
	elseif s < 4.5 then
		return R2I((s -4.)* 10)
	elseif s < 4.9 then
		return R2I((s -4.4)* 10)
	elseif s < 5.3 then
		return R2I((s -4.8)* 10)
	endif
	return 0
endfunction
function FQX takes unit u, real dur returns real
	local integer h
	local real FSX
	local integer c
	local real ratio
	if Mode__BalanceOff or not IsUnitType(u, UNIT_TYPE_HERO) then
		return dur
	endif
	set h = GetHandleId(u)
	set c = LoadInteger(OtherHashTable, h, 32)
	set ratio = 1
	if GetGameTime()-LoadReal(OtherHashTable, h, 32)< 6 and LoadReal(OtherHashTable, h, 32)!= 0 then
		if c == 1 then
			set ratio = .75
		elseif c == 2 then
			set ratio = .5
		else
			set ratio = .25
		endif
		call SaveInteger(OtherHashTable, h, 32, c + 1)
		// debug call SingleDebug(" 晕眩限制 "+ R2S(c) )
	else
		call SaveInteger(OtherHashTable, h, 32, 1)
	endif
	call SaveReal(OtherHashTable, h, 32, GetGameTime())
	set FSX = RMaxBJ(R2I(dur * 1. * ratio * 10)* 1. / 10, .01)
	return FSX
endfunction
// 晕眩单位 单位 持续时间 是否无视魔免
function CommonUnitAddStun takes unit whichUnit, real s, boolean isIgnoresMagicImmunity returns real
	local unit dummyUnit = null
	local real dur = 0
	if not isIgnoresMagicImmunity and IsUnitType(whichUnit, UNIT_TYPE_MAGIC_IMMUNE) then//检查是否魔免
		return 0.
	endif
	set dur = FQX(whichUnit, s)
	if dur > 0 then
		set dummyUnit = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
		call UnitAddAbility(dummyUnit, 'A420')
		call YDWESetUnitAbilityDataReal(dummyUnit,'A420', 1, 102, dur)
		call YDWESetUnitAbilityDataReal(dummyUnit,'A420', 1, 103, dur)
		// call SetUnitAbilityLevel(d, id, lv)
		call IssueTargetOrderById(dummyUnit, 852095, whichUnit)
		set dummyUnit = null
	endif
	// debug call SingleDebug(" 晕眩时间 "+ R2S(dur) )
	return dur
endfunction
// 对魔免单位生效
function FYX takes unit u, real dur returns real	//japi修改锤子持续时间
	local unit d
	if not UnitAlive(u) then
		return .0
	endif
	if dur > 0 then
		set d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
		call UnitAddAbility(d,'A3L0')
		call YDWESetUnitAbilityDataReal(d,'A3L0', 1, 102, dur)
		call YDWESetUnitAbilityDataReal(d,'A3L0', 1, 103, dur)
		call IssueTargetOrderById(d, 852095, u)
		set d = null
	endif
	return dur
endfunction
function impale_fly takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit target = LoadUnitHandle(HY, h, 73)
	local integer c = GetTriggerEvalCount(t)
	if c < 26 then
		if O0X(target) == false then
			call SetUnitFlyHeight(target, 375 - (c -13)*(c -13) , 0)
		endif
	else
		call PauseUnit(target, false)
		if O0X(target) == false then
			call SetUnitFlyHeight(target, GetUnitDefaultFlyHeight(target), 0)
		endif
		call UnitDamageTargetEx((LoadUnitHandle(HY, h, 2)), target, 1,(LoadReal(HY, h, 20)))
		call CommonUnitAddStun(target,(LoadReal(HY, h, 57)), false)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set target = null
	return false
endfunction
function impale_actions takes unit target, unit u, real dur, real d, real r returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call PauseUnit(target, true)
	if O0X(target) == false then
		call UnitAddAbility(target,'Amrf')
		call UnitRemoveAbility(target,'Amrf')
	endif
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\Impale\\ImpaleHitTarget.mdl", GetUnitX(target), GetUnitY(target)))
	call SaveUnitHandle(HY, h, 73,((target)))
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveReal(HY, h, 20,((d)* 1.))
	call SaveReal(HY, h, 57,((dur)* 1.))
	call TriggerRegisterTimerEvent(t, .02 / .52 * r, true)
	call TriggerAddCondition(t, Condition(function impale_fly))
	set t = null
endfunction

function impale_enumunit takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real x1 =(LoadReal(HY, h, 64))
	local real y1 =(LoadReal(HY, h, 65))
	local real x2 =(LoadReal(HY, h, 66))
	local real y2 =(LoadReal(HY, h, 67))
	local real w =(LoadReal(HY, h, 68))
	local real speed =(LoadReal(HY, h, 44))
	local real a = Atan2(y2 -y1, x2 -x1)
	local group g1 = LoadGroupHandle(HY, h, 22)
	local group g2 = AllocationGroup(4)
	local real IMX = speed * .0625
	local real F6X =(LoadReal(HY, h, 71))
	local real F7X =(LoadReal(HY, h, 72))
	local real F8X =(LoadReal(HY, h, 70))
	local unit firstUnit
	if IMX > GetDistanceBetween(x1, y1, x2, y2) then
		set x1 = x2
		set y1 = y2
	else
		set x1 = x1 + IMX * Cos(a)
		set y1 = y1 + IMX * Sin(a)
	endif
	set U2 = LoadUnitHandle(HY, h, 2)
	set S2 = LoadReal(HY, h, 20)
	set TJ = LoadReal(HY, h, 57)
	set RJ = LoadReal(HY, h, 63)
	set DK = g1
	call GroupEnumUnitsInRange(g2, x1, y1, w, null)
	loop
		set firstUnit = FirstOfGroup(g2)
		exitwhen firstUnit == null
		call GroupRemoveUnit(g2, firstUnit)
		// 存活 非建筑 非守卫 敌对
		if not IsUnitMagicImmune(firstUnit) and IsUnitEnemy(U2, GetOwningPlayer(firstUnit)) and IsAliveNotStrucNotWard(firstUnit) then
			if not IsUnitInGroup(firstUnit, DK) and LoadInteger(HY, GetHandleId(firstUnit), 4253)!= 1 then
				call GroupAddUnit(DK, firstUnit)
				call impale_actions(firstUnit, U2, TJ, S2, RJ)
			endif
		endif
	endloop
	set firstUnit = null
	call DeallocateGroup(g2)
	if GetDistanceBetween(x1, y1, F6X, F7X)>= F8X then
		call SaveReal(HY, h, 71,((x1)* 1.))
		call SaveReal(HY, h, 72,((y1)* 1.))
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\Impale\\ImpaleMissTarget.mdl", x1, y1))
	endif
	call SaveReal(HY, h, 64,((x1)* 1.))
	call SaveReal(HY, h, 65,((y1)* 1.))
	if x1 == x2 and y1 == y2 then
		if (LoadBoolean(HY, h, 69)) then
			call DeallocateGroup(g1)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set g1 = null
	set g2 = null
	set t = null
	return false
endfunction
//穿刺效果，所有穿刺都会调用此函数。
//u == 技能施法者
//target == 技能施法目标，可能为空值
//d == 技能造成伤害(damage)
//dur == 眩晕持续时间(此函数调用的穿刺效果眩晕均计算魔免)
//gx == 未知参数，会在后面函数进行一个计算(.02 / .52 *gx) = 0.02 所有穿刺效果此值均填0.52，用意未知
//x1,y1 == 技能施法者(u)的坐标
//x2,y2 == 技能施法目标(target)的坐标 Or 技能施法点的坐标(因为target可能是空值)
//w == 穿刺效果的选取范围
//g1 == 事先申请的一个单位组，不过如果填null的话会在此函数内申请单位组，并且b的值需要填true(‘毁灭’此项不为null)
//b == 用于判断是否要清空单位组，如果此项填false，则需要g1不为null，否则将会占用单位组(‘毁灭’此项为false)
//speed == 弹道速率，即穿刺的前进速度
function UnitSpellEffectImpale takes unit u, unit target, real d, real dur, real gx, real x1, real y1, real x2, real y2, real w, group g1, boolean b, real speed returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real distance = GetDistanceBetween(x1, y1, x2, y2)
	local real r = distance / B3X(distance, ZN)
	local group g2 = null
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveReal(HY, h, 20,((d)* 1.))
	call SaveReal(HY, h, 57,((dur) * 1.))
	call SaveReal(HY, h, 63,((gx)* 1.))
	call SaveReal(HY, h, 64,((x1)* 1.))
	call SaveReal(HY, h, 65,((y1)* 1.))
	call SaveReal(HY, h, 66,((x2)* 1.))
	call SaveReal(HY, h, 67,((y2)* 1.))
	call SaveReal(HY, h, 68,((w)* 1.))
	call SaveReal(HY, h, 44,((speed)* 1.))
	if g1 == null then
		set g2 = AllocationGroup(5)
		if target != null and not IsUnitIllusion(target) then
			call GroupAddUnit(g2, target)
		endif
		call SaveGroupHandle(HY, h, 22,(g2))
		call SaveBoolean(HY, h, 69,(b))
		set g2 = null
	else
		call SaveGroupHandle(HY, h, 22,(g1))
		call SaveBoolean(HY, h, 69,(b))
	endif
	call SaveReal(HY, h, 70,((r)* 1.))
	call SaveReal(HY, h, 71,((x1)* 1.))
	call SaveReal(HY, h, 72,((y1)* 1.))
	call TriggerRegisterTimerEvent(t, .0625, true)
	call TriggerAddCondition(t, Condition(function impale_enumunit))
	set t = null
	set g2 = null
endfunction

function GBX takes unit u returns nothing
	local integer i = 1
	loop
	exitwhen i > A4
		call UnitRemoveAbility(u, I4[i])
		set i = i + 1
	endloop
	call FKX(u, false)
endfunction
function GCX takes unit u returns nothing
	call FKX(u, true)
endfunction
function GDX takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer GFX = LoadInteger(HY, h, 0)
	local player p = LoadPlayerHandle(HY, h, 1)
	local boolean GGX = LoadBoolean(HY, h,'0NEW')
	local player np = LoadPlayerHandle(HY, h,'0NEW')
	local unit dummyUnit = LoadUnitHandle(HY, h,'DUMM')
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		call RemoveUnit(dummyUnit)
		call UnitShareVision(u, p, false)
		call FlushChildHashtable(HY, h)
		call RemoveSavedHandle(ObjectHashTable, GetHandleId(u), GFX)
		call CleanCurrentTrigger(t)
	else
		if GetUnitAbilityLevel(u, GFX)> 0 then
			if GGX then
				call UnitShareVision(u, p, false)
				call SetUnitOwner(dummyUnit, np, false)
				set p = np
				call SavePlayerHandle(HY, h, 0, p)
				call SaveBoolean(HY, h,'0NEW', false)
			endif
			if GetUnitAbilityLevel(u,'A1HX') == 0 then
				call UnitShareVision(u, p, true)
				call SetUnitPosition(dummyUnit, GetUnitX(u), GetUnitY(u))
			else
				call UnitShareVision(u, p, false)
			endif
		else
			call RemoveUnit(dummyUnit)
			call UnitShareVision(u, p, false)
			call FlushChildHashtable(HY, h)
			call RemoveSavedHandle(ObjectHashTable, GetHandleId(u), GFX)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set u = null
	set dummyUnit = null
endfunction
function GHX takes unit u, unit GJX, integer GKX returns nothing
	local trigger t = LoadTriggerHandle(ObjectHashTable, GetHandleId(u), GKX)
	local integer hu = GetHandleId(u)
	local integer h
	local unit dummyUnit
	if t == null then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .02, true)
		call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
		call TriggerAddCondition(t, Condition(function GDX))
		call SaveUnitHandle(HY, h, 0, u)
		call SavePlayerHandle(HY, h, 1, GetOwningPlayer(GJX))
		call SaveInteger(HY, h, 0, GKX)
		call SaveTriggerHandle(ObjectHashTable, hu, GKX, t)
		set dummyUnit = CreateUnit(GetOwningPlayer(GJX),'hFFD', GetUnitX(u), GetUnitY(u), 0)
		call SaveUnitHandle(HY, h,'DUMM', dummyUnit)
		call UnitAddAbility(dummyUnit,'A30X')
		set dummyUnit = null
	else
		set h = GetHandleId(t)
		if IsPlayerEnemy(GetOwningPlayer(GJX), LoadPlayerHandle(HY, h, 1)) then
			call SaveBoolean(HY, h,'0NEW', true)
			call SavePlayerHandle(HY, h,'0NEW', GetOwningPlayer(GJX))
		endif
	endif
	set t = null
endfunction
function GLX takes integer id returns boolean
	return id =='A1WE' or id =='A0B8' or id =='A063' or id =='A03O' or id =='A0T2' or id =='QB0Q' or id =='A0MQ' or id =='A1B6' or id =='A11F' or id =='A11E' or id =='A0S3' or id =='A11D' or id =='A11G' or id =='A11H' or id =='A2LI' or id =='A0NS' or id =='A1DA'
endfunction
function GMX takes integer id returns boolean
	return id =='A08V' or id =='QB05' or id =='A2TF' or id =='QB11' or id =='A0MF' or id =='Aprg' or id =='ACpu' or id =='AIpg' or id =='A02E' or id =='A02V' or id =='A0QH' or id =='A0QX' or id =='A18D' or id =='A1OU' or id =='A1SA' or id =='A594' or id =='A595' or id =='A2TN' or id =='Acyc' or id =='ACcy' or id =='AIcy' or id =='A0XK' or id =='A12L' or id =='A13V' or id =='A1RL'
endfunction
function GPX takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer id = LoadInteger(HY, h, 0)
	local integer GFX = LoadInteger(HY, h, 1)
	local integer TPE
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		call UnitRemoveAbility(u, id)
		call UnitRemoveAbility(u, GFX)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_PLAYER_UNIT_SPELL_EFFECT then
		if GetUnitAbilityLevel(u, id) == 0 then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			set TPE = GetSpellAbilityId()
			if GetTriggerUnit() == u then
				if GLX(TPE) then
					call UnitRemoveAbility(u, id)
					call UnitRemoveAbility(u, GFX)
					call FlushChildHashtable(HY, h)
					call CleanCurrentTrigger(t)
				endif
			else
				if GetSpellTargetUnit() == u and(IsPlayerAlly(GetOwningPlayer(GetTriggerUnit()), GetOwningPlayer(u)) or UnitHasSpellShield(u) == false) and GMX(TPE) then
					call UnitRemoveAbility(u, id)
					call UnitRemoveAbility(u, GFX)
					call FlushChildHashtable(HY, h)
					call CleanCurrentTrigger(t)
				endif
			endif
		endif
	endif
	set t = null
	set u = null
endfunction
function GQX takes unit u, integer id, integer GFX returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function GPX))
	call SaveUnitHandle(HY, h, 0, u)
	call SaveInteger(HY, h, 0, id)
	call SaveInteger(HY, h, 1, GFX)
	set t = null
endfunction
function GSX takes integer GTX returns integer
	if XNV[GTX]== 0 then
		return GTX
	else
		return XNV[GTX]
	endif
endfunction
function GUX takes integer id returns boolean
	return id == O7V or id == O5V or id == O4V or id == O6V or id == O3V or id == O8V
endfunction
function GWX takes integer id returns integer
	if id == O7V then
		return'I007'
	elseif id == O5V then
		return'I006'
	elseif id == O4V then
		return'I00K'
	elseif id == O6V then
		return'I008'
	elseif id == O3V then
		return'I00J'
	elseif id == O8V then
		return'I0QA'
	endif
	return -1
endfunction
function GYX takes unit u, integer id returns boolean
	local integer i
	local item it
	set i = 0
	loop
	exitwhen i > 5
		set it = UnitItemInSlot(u, i)
		if it != null and GetItemTypeId(it) == id then
			set it = null
			return true
		endif
		set i = i + 1
	endloop
	set it = null
	return false
endfunction
function GZX takes unit u, integer id, item it returns item
	local integer i
	local item G_X
	set i = 0
	loop
	exitwhen i > 5
		set G_X = UnitItemInSlot(u, i)
		if G_X != null and G_X != it and GetItemTypeId(G_X) == id then
			set G_X = null
			return UnitItemInSlot(u, i)
		endif
		set i = i + 1
	endloop
	set G_X = null
	return null
endfunction
// 按类型 从单位身上获取物品
function GetItemOfTypeFromUnit takes unit u, integer id returns item
	local integer i
	local item it
	set i = 0
	loop
	exitwhen i > 5
		set it = UnitItemInSlot(u, i)
		if it != null and GetItemTypeId(it) == id then
			set it = null
			return UnitItemInSlot(u, i)
		endif
		set i = i + 1
	endloop
	set it = null
	return null
endfunction
function G1X takes player p, unit u, integer GTX, item G_X returns item
	local integer i
	local item it
	set i = 0
	loop
	exitwhen i > 5
		set it = UnitItemInSlot(u, i)
		if it != null and it != G_X and GetItemIndexEx(it) == GTX and(GetItemPlayer(it) == p or GTX == R2V or GTX == R3V) then
			set it = null
			return UnitItemInSlot(u, i)
		endif
		set i = i + 1
	endloop
	set it = null
	return null
endfunction
function G2X takes player p, unit u, integer GTX returns item
	local integer i
	local item it
	set i = 0
	loop
	exitwhen i > 5
		set it = UnitItemInSlot(u, i)
		if (it != null) and GetItemIndexEx(it) == GTX and(GetItemPlayer(it) == p or GTX == R2V or GTX == R3V) then
			set it = null
			return UnitItemInSlot(u, i)
		endif
		set i = i + 1
	endloop
	set it = null
	return null
endfunction
function G3X takes unit u returns boolean
	local item it
	local integer i = 0
	local integer id
	if GetUnitAbilityLevel(u,'A3E7') == 1 then
		set it = null
		return true
	endif
	loop
		set it = UnitItemInSlot(u, i)
		if it != null then
			set id = GetItemIndex(it)
			if (id == XFV or id == XCV or id == XDV) and GetItemUserData(it)!=-2 then
				set it = null
				return true
			endif
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	set it = null
	return false
endfunction
function G4X takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local player p = LoadPlayerHandle(HY, h, 0)
	local integer goldBonus = LoadInteger(HY, h, 0)
	if GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)-goldBonus >= 2100 then
		call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD) -2100)
	endif
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
endfunction
function G5X takes integer id, unit u, boolean G6X returns nothing
	local item it
	if G6X == false then
		if id =='A0CY' then
			// 分裂和拆建筑加成
			call UnitAddPermanentAbility(u,'A2KK')
			call UnitMakeAbilityPermanent(u, true,'A1W0')
			call UnitMakeAbilityPermanent(u, true,'A1W4')
			call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A2KK', false)
		elseif id =='A0DY' then
		endif
	else
		if G3X(u) == false then
		endif
	endif
	if id =='A0CY' and GetUnitTypeId(u)=='Ucrl' then
		//		set PlayerHeroTypeId[GetPlayerId(GetOwningPlayer(u))]='U01X'
		call AddUnitAnimationProperties(u, "upgrade", not G6X)
	endif
endfunction

// k = abilIndex
function OnUnitAddAbilityAghanimUpgrade takes integer k, unit u, integer G8X returns boolean
	local player p = GetOwningPlayer(u)
	if Mode__RearmCombos == false then
		if (AghanimUpgradeChangeId[k]=='A2S7' or AghanimUpgradeChangeId[k]=='A236') then
			if IsUnitHaveRearmAbility(u) then
				return false
			endif
		endif
	else
		if AghanimUpgradeChangeId[k]=='A236' then
			if IsUnitHaveRearmAbility(u) then
				return false
			endif
		endif
	endif

	//call BJDebugMsg("NMML:" + MHString_FromId(AghanimUpgradeNormalId[k]))
	
	if AghanimUpgradeNormalId[k]=='A343'then
		set U2 = u
		call ExecuteFunc("G9X")
	elseif AghanimUpgradeNormalId[k]=='A088' then
		set U2 = u
		call ExecuteFunc("HVX")
	elseif AghanimUpgradeNormalId[k]=='A2E5' then
		set U2 = u
		call ExecuteFunc("HEX")
	elseif AghanimUpgradeNormalId[k]=='A0KV' then
		set U2 = u
		call ExecuteFunc("addXL")
	elseif AghanimUpgradeNormalId[k]=='A07Z' then
		set U2 = u
		call ExecuteFunc("HXX")
	elseif AghanimUpgradeNormalId[k]=='A1YQ' then
		set U2 = u
		call ExecuteFunc("HOX")
	elseif AghanimUpgradeNormalId[k]=='A01Y' then
		set U2 = u
		call ExecuteFunc("HRX")
	elseif AghanimUpgradeNormalId[k]=='A0DY' then
		if LoadBoolean(HY, GetHandleId(GetOwningPlayer(u)),'R00J') == false then
			call AddUnitBonusRange(u, 190., true)
			call SaveBoolean(HY, GetHandleId(GetOwningPlayer(u)),'R00J', true)
		endif
	elseif AghanimUpgradeNormalId[k]=='A0CY' then
		if LoadBoolean(HY, GetHandleId(GetOwningPlayer(u)),'R0L3') == false then
			call AddUnitBonusRange(u, 107., false)
			call SaveBoolean(HY, GetHandleId(GetOwningPlayer(u)),'R0L3', true)
			call UnitAddPermanentAbility(u,'A2KK')
			call UnitMakeAbilityPermanent(u, true,'A1W0')
			call UnitMakeAbilityPermanent(u, true,'A1W4')
			call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A2KK', false)
		endif
	endif
	if AghanimUpgradeChangeId[k]> 0 then
		call UnitAddPermanentAbility(u, AghanimUpgradeChangeId[k])
		call UnitMakeAbilityPermanent(u, true, AghanimUpgradeUpgradeId[k])
	endif
	call SaveInteger(OtherHashTable, GetHandleId(u),'AGH0'+ G8X, AghanimUpgradeNormalId[k])
	return true
endfunction
function OnUnitRemoveAbilityAghanimUpgrade takes integer k, unit u, integer G8X returns nothing
	local player p = GetOwningPlayer(u)
	if G3X(u) then
		return
	endif
	if AghanimUpgradeNormalId[k]=='A088' then
		set U2 = u
		call ExecuteFunc("HAX")
	elseif AghanimUpgradeNormalId[k]=='A2E5' then
		set U2 = u
		call ExecuteFunc("HNX")
	elseif AghanimUpgradeNormalId[k]=='A0KV' then
		set U2 = u
		call ExecuteFunc("delXL")
	elseif AghanimUpgradeNormalId[k]=='A07Z' then
		set U2 = u
		call ExecuteFunc("HBX")
	elseif AghanimUpgradeNormalId[k]=='A1YQ' then
		set U2 = u
		call ExecuteFunc("HCX")
	elseif AghanimUpgradeNormalId[k]=='A0DY' then
		if LoadBoolean(HY, GetHandleId(GetOwningPlayer(u)),'R00J') then
			call AddUnitBonusRange(u, -190., true)
			call SaveBoolean(HY, GetHandleId(GetOwningPlayer(u)),'R00J', false)
		endif
	elseif AghanimUpgradeNormalId[k]=='A0CY' then
		if LoadBoolean(HY, GetHandleId(GetOwningPlayer(u)),'R0L3') then
			call AddUnitBonusRange(u, -107., false)
			call SaveBoolean(HY, GetHandleId(GetOwningPlayer(u)),'R0L3', false)
			call UnitRemoveAbility(u,'A2KK')
		endif
	endif
	call UnitRemoveAbility(u, AghanimUpgradeChangeId[k])
	if AghanimUpgradeUpgradeId[k]!= AghanimUpgradeNormalId[k] then
		call UnitRemoveAbility(u, AghanimUpgradeUpgradeId[k])
	endif
	call SaveInteger(OtherHashTable, GetHandleId(u),'AGH0'+ G8X, 0)
endfunction


function get_a_fx takes integer skill returns integer //移植A杖特效
	if skill == 0 then
		return 0
	elseif skill =='A0NS' then
		return 'A3I4' //死骑
	elseif skill =='A095' then
		return 'A0PA' //莱恩
	elseif skill =='A03R' then
		return 'A0Q8'	//冰女
	elseif skill =='A05T' then
		return 'A0PE' //巫妖
	elseif skill =='A28R' then
		return 'A0P7' //女王
	elseif skill =='A00H' then
		return 'A0P8' //小Y
	elseif skill =='A088' then
		return 'A0P9' //蓝胖
	elseif skill =='A0CC' then
		return 'A0PB' //骨法
	elseif skill =='A01P' then
		return 'A0PC' //火女
	elseif skill =='QM01' then
		return 'A0PD'	//光法
	elseif skill =='A29G' then
		return 'A0PF'	//宙斯
	elseif skill =='A054' then
		return 'A1NQ'	//露娜
	elseif skill =='A0IN' then
		return 'A1V3' //VS
	elseif skill =='A0QR' then
		return 'A1NS' //神灵
	elseif skill =='A21F' then
		return 'A1NW' //老鹿
	elseif skill =='A06R' then
		return 'A1VD' //沙王
	elseif skill =='A0DH' then
		return 'A1VC' //神牛
	elseif skill =='A0M1' then
		return 'A1QL' //剑圣
	elseif skill =='A0J1' then
		return 'A1R3' //虚空
	elseif skill =='A1AO' then
		return 'A1UX' //电棍
	elseif skill =='S008' then
		return 'A1UY' //术士
	elseif skill =='A0NT' then
		return 'A1V5' //巫医
	elseif skill =='A0OK' then
		return 'A1VZ' //黑鸟
	elseif skill =='A0DY' then
		return 'A1X2' //小鹿
	elseif skill =='A0LT' then
		return 'A208' //陈
	elseif skill =='A0QK' then
		return 'A21Z' //兔子
	elseif skill =='A1CV' then
		return 'A220' //发条
	elseif skill =='A1T5' then
		return 'A23E' //飞机
	elseif skill =='A0E2' then
		return 'A1V9' //斧王
	elseif skill =='A0FL' then
		return 'A1VB' //屠夫
	elseif skill =='A0G4' then
		return 'A1VE' //白牛
	elseif skill =='A0O5' then
		return 'A1VF' //双头龙
	elseif skill =='A1W8' then
		return 'A20M' //先知
	elseif skill =='A0O2' then
		return 'A29E' //兽王
	endif
	return 0
endfunction
function get_a_c takes unit u returns integer
	local integer id = GetPlayerId(GetOwningPlayer(u))
	local integer ret = 0
	set ret = get_a_fx(HeroCommonSkills[PlayerSkillIndex[id * 6 + 4]])
	if ret == 0 then
		set ret = get_a_fx(HeroCommonSkills[PlayerSkillIndex[id * 6 + 6]])
	endif
	return ret
endfunction

function HDX takes unit u, boolean G6X returns boolean
	local integer pid = GetPlayerId(GetOwningPlayer(u))
	local integer k
	local integer z
	local boolean b = false
	local integer i = 1
	if IsUnitType(u, UNIT_TYPE_HERO) == false or(G6X and G3X(u)) then
		return false
	endif
	// 给单位添加A杖效果技能
	if a_fx[pid] == 0 then
		set k = get_a_c(u)
		set a_fx[pid]= k
	// 如果死亡竞赛或者全部随机 会重新检测A杖技能
	elseif Mode__DeathMatch or MainModeName =="ar" then
		set k = get_a_c(u)
	else
		set k = a_fx[pid]
	endif
	set a_fx_b[pid] = not G6X
	if k != 0 then
		if G6X then
			call UnitRemoveAbility(u, k)
		else
			call UnitAddPermanentAbility(u, k)
		endif
	endif
	loop
		if HeroCommonSkills[PlayerSkillIndex[pid * HL + i]] == 'QF88' then
			if G6X then
				set U2 = u
				call UnitRemoveAbility(u,'S3UR')	//小黑A杖
			else
				call UnitAddPermanentAbility(u,'S3UR')
			endif
		endif
		if HeroCommonSkills[PlayerSkillIndex[pid * HL + i]] == 'A229' then
			if G6X then
				set U2 = u
				call ExecuteFunc("FlakCannonOnRemoveAghanimUpgrade")
			else
				set U2 = u
				call ExecuteFunc("FlakCannonOnAddAghanimUpgrade")
			endif
		endif
	
		set k = TBE(HeroCommonSkills[PlayerSkillIndex[pid * HL + i]])
		if k > 0 then
			if G6X then
				call OnUnitRemoveAbilityAghanimUpgrade(k, u, 1)
			else
				set b = OnUnitAddAbilityAghanimUpgrade(k, u, 1) or b
			endif
			call G5X(HeroCommonSkills[PlayerSkillIndex[pid * HL + i]], u, G6X)
		endif
		set i = i + 1
	exitwhen i > 4 + ExtraSkillsNumber
	endloop
	return b
endfunction
function HFX takes item it returns boolean
	local integer i = GetItemIndexEx(it)
	local integer id = GetItemTypeId(it)
	if id == XOV[XCV]or id == XOV[XFV]or id == XOV[XDV] then
		return true
	endif
	return false
endfunction
function HGX takes integer GTX returns boolean
	return GTX == NXV or GTX == R6V or GTX == R8V or GTX == RYV or GTX == R_V or GTX == R0V or GTX == R2V or GTX == R3V or GTX == R4V or GTX == RZV or GTX == R9V or GTX == IVV or GTX == it_jys
endfunction
function HHX takes integer GTX returns boolean
	return(GTX) == NUV or GTX == RRV or(GTX) == IUV or(GTX) == IWV or GTX == NIV or GTX == AIV or(GTX) == Item_MagicStick or(GTX) == Item_MagicWand or GTX == RAV
endfunction
function HJX takes player p returns unit
	local unit u
	local group g = AllocationGroup(6)
	local unit HKX = null
	local boolean HLX = false
	call GroupAddGroup(KX, g)
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if OPX(u) and UnitAlive(u) then
			if GetOwningPlayer(u) == p then
				set HKX = u
			exitwhen true
			elseif GetPlayerAlliance(GetOwningPlayer(u), p, ALLIANCE_SHARED_CONTROL) then
				if HKX == null or HLX then
					set HKX = u
				endif
			elseif IsUnitAlly(u, p) then
				if HKX == null then
					set HKX = u
					set HLX = true
				endif
			endif
		endif
		call GroupRemoveUnit(g, u)
	endloop
	set u = null
	call DeallocateGroup(g)
	set U2 = HKX
	set HKX = null
	return U2
endfunction
function HMX takes item it, player p returns nothing
	local unit u = HJX(p)
	if u == null then
		return
	endif
	if UnitItemInSlot(u, 0) == null or UnitItemInSlot(u, 1) == null or UnitItemInSlot(u, 2) == null or UnitItemInSlot(u, 3) == null or UnitItemInSlot(u, 4) == null or UnitItemInSlot(u, 5) == null then
		call UnitAddItem(u, it)
	else
		set U2 = u
		call RemoveItem(it)
		call ExecuteFunc("HPX")
	endif
	set u = null
endfunction
function HQX takes item UWV returns boolean
	return GetItemIndexEx(UWV) == ASV or GetItemIndexEx(UWV) == ATV or GetItemIndexEx(UWV) == X4V or GetItemIndexEx(UWV) == X5V
endfunction
function HSX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer UYV =(LoadInteger(HY, h, 74))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local player p =(LoadPlayerHandle(HY, h, 54))
	local boolean HTX =(LoadBoolean(HY, h, 75))
	local integer HUX =(LoadInteger(HY, h, 76))
	local item HWX = CreateItem(UYV, x, y)
	call SetItemPlayer(HWX, p, true)
	call SetItemUserData(HWX, 0)
	if HQX(HWX) then
		call SetItemInvulnerable(HWX, true)
	endif
	if HTX then
		call SetItemCharges(HWX, HUX)
	endif
	if UYV == XXV[BUV] then
		call HMX(HWX, p)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set p = null
	set HWX = null
	return false
endfunction
function HYX takes integer UYV, real x, real y, player p, boolean HTX, integer HUX returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveInteger(HY, h, 74,(UYV))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call SavePlayerHandle(HY, h, 54,(p))
	call SaveBoolean(HY, h, 75,(HTX))
	call SaveInteger(HY, h, 76,(HUX))
	call TriggerAddCondition(t, Condition(function HSX))
	call TriggerRegisterTimerEvent(t, 0, false)
	set t = null
endfunction
function HZX takes item UWV returns nothing
	call DisableTrigger(CUV)
	call RemoveItem(UWV)
	call EnableTrigger(CUV)
endfunction
function H_X takes unit whichUnit returns integer
	local integer i = 0
	local integer n = 0
	local integer H0X = UnitInventorySize(whichUnit)-1
	loop
	exitwhen i > H0X
		if UnitItemInSlot(whichUnit, i) == null then
			set n = n + 1
		endif
		set i = i + 1
	endloop
	return n
endfunction
function H1X takes item UWV returns integer
	local integer UYV
	local integer i = 1
	if UWV == null then
		return -2
	endif
	set UYV = GetItemTypeId(UWV)
	loop
	exitwhen i > MaxItemsNumber
		if XIV[i]== UYV then
			return i
		endif
		set i = i + 1
	endloop
	return -1
endfunction
function H2X takes item UWV returns integer
	local integer UYV
	local integer i = 1
	if UWV == null then
		return -2
	endif
	set UYV = GetItemTypeId(UWV)
	loop
	exitwhen i > MaxItemsNumber
		if XIV[i]== UYV then
			return XOV[i]
		endif
		set i = i + 1
	endloop
	return -1
endfunction
function H3X takes unit whichUnit returns integer
	local integer H4X
	local integer i = 0
	if whichUnit == null then
		return -2
	endif
	set H4X = GetUnitTypeId(whichUnit)
	loop
	exitwhen i > MaxItemsNumber
		if XRV[i]== H4X then
			return i
		endif
		set i = i + 1
	endloop
	return -1
endfunction
function GetItemIcon takes item it returns string
	if it == null then
		return "UI\\Widgets\\Console\\Undead\\undead-inventory-slotfiller.blp"
	endif
	return ItemsIconFilePath[GetItemIndexEx(it)]
endfunction
function H7X takes integer GTX returns integer
	if R0V == GTX then
		return 4
	endif
	if R3V == GTX or R8V == GTX then
		return 2
	endif
	return 1
endfunction
function H8X takes item UWV returns boolean
	return GetItemType(UWV) == ITEM_TYPE_POWERUP or GetItemType(UWV) == ITEM_TYPE_PURCHASABLE or GetItemType(UWV) == ITEM_TYPE_MISCELLANEOUS
endfunction
function H9X takes unit trigUnit returns real
	local real JVX
	if IsSentinelPlayer(GetOwningPlayer(trigUnit)) then
		set JVX = GetRectCenterX(gg_rct_SentinelRevivalPoint)
	else
		set JVX = GetRectCenterX(gg_rct_ScourgeRevivalPoint)
	endif
	return JVX
endfunction
function JEX takes unit trigUnit returns real
	local real JVX
	if IsSentinelPlayer(GetOwningPlayer(trigUnit)) then
		set JVX = GetRectCenterY(gg_rct_SentinelRevivalPoint)
	else
		set JVX = GetRectCenterY(gg_rct_ScourgeRevivalPoint)
	endif
	return JVX
endfunction
function JXX takes unit trigUnit, item C1X, integer JOX returns nothing
	local real x = H9X(trigUnit)
	local real y = JEX(trigUnit)
	local integer i = 0
	local boolean array b
	local item JRX
	call DisableTrigger(CUV)
	loop
	exitwhen i >(UnitInventorySize(trigUnit)-1)
		if UnitItemInSlot(trigUnit, i) == null and i != JOX then
			set JRX = CreateItem('I02M', x, y)
			call UnitAddItem(trigUnit, JRX)
			set b[i]= true
		else
			set b[i]= false
		endif
		if i == JOX then
			call EnableTrigger(CUV)
			call UnitAddItem(trigUnit, C1X)
			call DisableTrigger(CUV)
		endif
		set i = i + 1
	endloop
	set i = 0
	loop
	exitwhen i > 5
		if b[i] then
			call RemoveItem(UnitItemInSlot(trigUnit, i))
		endif
		set i = i + 1
	endloop
	call EnableTrigger(CUV)
	set Z2 = C1X
	set C1X = null
	set JRX = null
endfunction
function JIX takes unit trigUnit, integer JAX, integer JNX returns item
	local real x = H9X(trigUnit)
	local real y = JEX(trigUnit)
	local item C1X = CreateItem(JAX, x, y)
	local integer i = 0
	local boolean array JBX
	local item JCX
	call DisableTrigger(CUV)
	if JAX > 0 then
		loop
		exitwhen i >(UnitInventorySize(trigUnit)-1)
			if UnitItemInSlot(trigUnit, i) == null and i != JNX then
				set JCX = CreateItem('I02M', x, y)
				call UnitAddItem(trigUnit, JCX)
				set JBX[i]= true
			else
				set JBX[i]= false
			endif
			if i == JNX then
				call EnableTrigger(CUV)
				call UnitAddItem(trigUnit, C1X)
				call DisableTrigger(CUV)
			endif
			set i = i + 1
		endloop
		set i = 0
		loop
		exitwhen i > 5
			if JBX[i] then
				call RemoveItem(UnitItemInSlot(trigUnit, i))
			endif
			set i = i + 1
		endloop
	endif
	call EnableTrigger(CUV)
	set Z2 = C1X
	set C1X = null
	set JCX = null
	return Z2
endfunction
// 储存单位的RGB
function JDX takes integer unitTypeId, integer r, integer g, integer b returns nothing
	set J4 = J4 + 1
	set N4[J4]= r
	set B4[J4]= g
	set C4[J4]= b
	set H4[J4]= unitTypeId
endfunction
function SaveColorToUnitType takes integer whichTypeId, integer r, integer g, integer b returns nothing
	if r >-1 and r < 256 then
		call SaveInteger(UnitRGBHashTable, whichTypeId, 0, r)
	endif
	if g >-1 and g < 256 then
		call SaveInteger(UnitRGBHashTable, whichTypeId, 1, g)
	endif
	if b >-1 and b < 256 then
		call SaveInteger(UnitRGBHashTable, whichTypeId, 2, b)
	endif
endfunction
function JKX takes unit u returns nothing
	local integer id = GetUnitTypeId(u)
	local integer i = 1
	local integer a = 255
	local boolean b = false
	if id =='Ewar' then
		set a = R2I(2.55 *( 100 -18 + 20 * GetUnitAbilityLevel(u,'P239')))
	endif
	loop
	exitwhen i > J4 or b
		if H4[i]== id then
			set b = true
			call SetUnitVertexColor(u, N4[i], B4[i], C4[i], a)
		endif
		set i = i + 1
	endloop
	if b == false then
		call SetUnitVertexColor(u, 255, 255, 255, 255)
	endif
endfunction

function StoreDrCacheDataToPlayer takes player p, string key, integer value returns nothing
	local string id = I2S(GetPlayerId(p))
	call StoreInteger(DrCache, id, key, value)
	if IsPlayingPlayer(HostPlayer) == false then
		call GetHostPlayer()
	endif
	if LocalPlayer == HostPlayer then
		call SyncStoredInteger(DrCache, id, key)
	endif
endfunction
function StoreDrCacheData takes string key, integer value returns nothing
	call StoreInteger(DrCache, "Data", key, value)
	if IsPlayingPlayer(HostPlayer) == false then
		call GetHostPlayer()
	endif
	if LocalPlayer == HostPlayer then
		call SyncStoredInteger(DrCache, "Data", key)
	endif
endfunction
function StringReplace takes string str, string old_str, string new_str returns string
	local string  tempS     = ""
	local integer i         = 0
	local string  sub
	local integer strLength = StringLength(str)
	local integer oldStrLen = StringLength(old_str)
	local boolean b 		= false
	loop
	exitwhen i + 1 > strLength
		set sub = SubString(str, i, i + oldStrLen)
		if sub != old_str or b then
			set tempS = tempS + SubString(str, i, i + 1)
			set i = i + 1
		else
			set tempS = tempS + new_str
			set i = i + oldStrLen
			set b = true
		endif
	endloop
	return tempS
endfunction
function GetKillHeroDisplayText takes player deadPlayer, player killerPlayer returns string
	local string s = GetObjectName('n0C8')
	set s = StringReplace(s, "$dead", PlayersColoerText[GetPlayerId(deadPlayer)] +(PlayersName[GetPlayerId((deadPlayer))])+ "|r")
	set s = StringReplace(s, "$killer", PlayersColoerText[GetPlayerId(killerPlayer)] +(PlayersName[GetPlayerId((killerPlayer))])+ "|r")
	return s
endfunction
function J5X takes unit u, integer d returns nothing
	local integer array b
	local integer a = d
	local integer c = 1
	local integer i = 0
	local integer k
	if d < 1 then
		call UnitRemoveAbility(u, EC[0])
		call UnitRemoveAbility(u, EC[1])
		call UnitRemoveAbility(u, EC[2])
		call UnitRemoveAbility(u, EC[3])
		call UnitRemoveAbility(u, EC[4])
		call UnitRemoveAbility(u, EC[5])
		call UnitRemoveAbility(u, EC[6])
		call UnitRemoveAbility(u, EC[7])
		call UnitRemoveAbility(u, EC[8])
		call UnitRemoveAbility(u, EC[9])
		return
	endif
	loop
	exitwhen c == 0
		set c = a / 2
		set b[i]= a -c * 2
		set a = c
		set i = i + 1
	endloop
	set k = 9
	set i = 0
	loop
	exitwhen i > k
		if b[i]== 1 then
			call UnitAddPermanentAbility(u, EC[i])
		else
			call UnitRemoveAbility(u, EC[i])
		endif
		set i = i + 1
	endloop
endfunction
function J6X takes unit u, integer d returns nothing
	local integer h = GetHandleId(u)
	local integer J7X = LoadInteger(ObjectHashTable, h,'MSPC')
	if IsUnitType(u, UNIT_TYPE_HERO) then
		call J5X(u, d + J7X)
		call SaveInteger(ObjectHashTable, h,'MSPC', d + J7X)
	endif
endfunction
function J8X takes unit u, integer d returns nothing
	local integer h = GetHandleId(u)
	local integer J7X = LoadInteger(ObjectHashTable, h,'MSPC')
	if IsUnitType(u, UNIT_TYPE_HERO) then
		call J5X(u, J7X -d)
		call SaveInteger(ObjectHashTable, h,'MSPC', J7X -d)
	endif
endfunction
function J9X takes unit u, integer d returns nothing
	local integer array b
	local integer a = d
	local integer c = 1
	local integer i = 0
	local integer k
	if d < 1 then
		call UnitRemoveAbility(u, Q4[0])
		call UnitRemoveAbility(u, Q4[1])
		call UnitRemoveAbility(u, Q4[2])
		call UnitRemoveAbility(u, Q4[3])
		call UnitRemoveAbility(u, Q4[4])
		call UnitRemoveAbility(u, Q4[5])
		call UnitRemoveAbility(u, Q4[6])
		call UnitRemoveAbility(u, Q4[7])
		call UnitRemoveAbility(u, Q4[8])
		call UnitRemoveAbility(u, Q4[9])
		call UnitRemoveAbility(u, Q4[10])
		call UnitRemoveAbility(u, Q4[11])
		return
	endif
	loop
	exitwhen c == 0
		set c = a / 2
		set b[i]= a -c * 2
		set a = c
		set i = i + 1
	endloop
	set k = 11
	set i = 0
	loop
	exitwhen i > k
		if b[i]== 1 then
			call UnitAddPermanentAbility(u, Q4[i])
		else
			call UnitRemoveAbility(u, Q4[i])
		endif
		set i = i + 1
	endloop
endfunction
function KVX takes unit u returns nothing
	local integer h = GetHandleId(u)
	local integer i = 0
	set i = i + LoadInteger(HY, h,'a068')
	set i = i + LoadInteger(HY, h,'a272')
	set i = i + LoadInteger(HY, h,'a430')
	set i = i + LoadInteger(HY, h,'axxx')
	set i = i + LoadInteger(OtherHashTable, GetHandleId(GetOwningPlayer(u)),'DDUE')
	call J9X(u, i)
endfunction

function KEX takes unit u, integer d returns nothing
	local integer array b
	local integer a = d
	local integer c = 1
	local integer i = 0
	local integer H0X

	if d < 1 then
		call UnitRemoveAbility(u, S4[0])
		call UnitRemoveAbility(u, S4[1])
		call UnitRemoveAbility(u, S4[2])
		call UnitRemoveAbility(u, S4[3])
		call UnitRemoveAbility(u, S4[4])
		call UnitRemoveAbility(u, S4[5])
		call UnitRemoveAbility(u, S4[6])
		call UnitRemoveAbility(u, S4[7])
		call UnitRemoveAbility(u, S4[8])
		call UnitRemoveAbility(u, S4[9])
		call UnitRemoveAbility(u, S4[10])
		return
	endif
	loop
	exitwhen c == 0
		set c = a / 2
		set b[i]= a -c * 2
		set a = c
		set i = i + 1
	endloop
	set H0X = 10
	set i = 0
	loop
	exitwhen i > H0X
		if b[i]== 1 then
			call UnitAddPermanentAbility(u, S4[i])
		else
			call UnitRemoveAbility(u, S4[i])
		endif
		set i = i + 1
	endloop
endfunction

// 二进制属性系统增加生命值
// 优化为 设置单位最大生命值 会按当前比例改变
function UnitAddMaxLife takes unit whichUnit, real value returns nothing
    local real currenMaxlife = GetUnitState( whichUnit, UNIT_STATE_MAX_LIFE )
	local real currentLife   = GetWidgetLife( whichUnit )
	local real addMaxLife
	set addMaxLife = currenMaxlife + value
	call SetUnitState(whichUnit, UNIT_STATE_MAX_LIFE, addMaxLife)
	// debug call SingleDebug( GetUnitName(whichUnit) + " 增加生命值 " + R2S(value) + " 当前生命值" + R2S( GetWidgetLife(whichUnit) ) )
	// 存活 才会改变生命值 并且如果 减少生命值时 如果满血不会再减
	if UnitAlive(whichUnit) and ( currentLife != addMaxLife ) then
		// debug call SingleDebug( GetUnitName(whichUnit) + " 设置生命值 " + R2S(currentLife * (addMaxLife / currenMaxlife) ) )
		call SetWidgetLife(whichUnit, currentLife * (addMaxLife / currenMaxlife) )
	endif
	call UnitAddAbility(whichUnit, 'AIml')
	call UnitRemoveAbility(whichUnit, 'AIml')
endfunction

function KRX takes unit u, integer d returns nothing
	local integer array b
	local integer a = d
	local integer c = 1
	local integer i = 0
	local integer H0X
	if d < 1 then
		call UnitRemoveAbility(u, T4[0])
		call UnitRemoveAbility(u, T4[1])
		call UnitRemoveAbility(u, T4[2])
		call UnitRemoveAbility(u, T4[3])
		call UnitRemoveAbility(u, T4[4])
		call UnitRemoveAbility(u, T4[5])
		return
	endif
	loop
	exitwhen c == 0
		set c = a / 2
		set b[i]= a -c * 2
		set a = c
		set i = i + 1
	endloop
	set H0X = i
	set i = 0
	loop
	exitwhen i > H0X
		if b[i]== 1 then
			call UnitAddPermanentAbility(u, T4[i])
		else
			call UnitRemoveAbility(u, T4[i])
		endif
		set i = i + 1
	endloop
endfunction
function KIX takes unit whichUnit returns integer
	local integer OVX = GetUnitTypeId(whichUnit)
	local integer KAX ='o01P'
	if OVX =='Udre' or OVX =='H071' then
		set KAX ='o01N'
	endif
	return KAX
endfunction
function KNX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		call KillUnit(dummyCaster)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SetUnitX(dummyCaster, GetUnitX(whichUnit))
		call SetUnitY(dummyCaster, GetUnitY(whichUnit))
	endif
	set t = null
	set whichUnit = null
	set dummyCaster = null
	return false
endfunction
function KCX takes unit whichUnit returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit), KIX(whichUnit), GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function KNX))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	set t = null
	set dummyCaster = null
endfunction
function KDX takes integer H4X returns boolean
	local integer i = 0
	loop
	exitwhen i > 59
		if H4X == U4[i] then
			return true
		endif
		set i = i + 1
	endloop
	return false
endfunction
function KFX takes integer level returns integer
	local real KGX = GetGameTime()-PickModeElapsed
	local real minute =(R2I(KGX)/ 60)-(1 / 2)
	local real KHX = 100 + level * level * 1.5 + minute * 15
	local integer index
	set index = R2I(KHX / 50)
	set index = IMinBJ(index, 59)
	set index = IMaxBJ(index, 0)
	return index
endfunction
function KJX takes unit KKX returns integer
	local integer unitTypeId = GetUnitTypeId(KKX)
	local integer KLX ='o01P'
	if unitTypeId =='Udre' or unitTypeId =='H071' then
		set KLX ='o01N'
	endif
	return KLX
endfunction
function KMX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit KKX =(LoadUnitHandle(HY, h, 2))
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	if GetTriggerEventId() == EVENT_UNIT_DEATH or KKX == null then
		call KillUnit(dummyUnit)
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	else
		call SetUnitX(dummyUnit, GetUnitX(KKX))
		call SetUnitY(dummyUnit, GetUnitY(KKX))
	endif
	set t = null
	set KKX = null
	set dummyUnit = null
	return false
endfunction
// 创建死亡时的视野马甲
function KPX takes unit u returns nothing
	local trigger t
	local integer h
	local unit d = null
	if UnitAlive(LoadUnitHandle(HY, GetHandleId(u),'VisD')) then
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	set d = CreateUnit(GetOwningPlayer(u), KJX(u), GetUnitX(u), GetUnitY(u), 0)
	call TriggerRegisterTimerEvent(t, .1, true)
	call SaveUnitHandle(HY, GetHandleId(u),'VisD', d)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function KMX))
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveUnitHandle(HY, h, 19,(d))
	set t = null
	set d = null
endfunction
function KQX takes player p returns nothing
	local integer id = GetPlayerId(p)
	local unit KSX = CirclesUnit[id]
	local unit trigUnit = Player__Hero[id]
	local integer level = GetHeroLevel(trigUnit)
	local integer i = 0
	call KPX(trigUnit)
	loop
	exitwhen i > 59
		call RemoveUnitFromStock(KSX, U4[i])
		set i = i + 1
	endloop
	if Mode__DeathMatch then
		return
	endif
	if FRV == false then
		set KSX = null
		set trigUnit = null
		return
	endif
	call AddUnitToStock(KSX, U4[KFX(level)], 1, 1)
	set W4[id]= U4[KFX(level)]
	set trigUnit = null
	set KSX = null
endfunction
function KTX takes player p returns nothing
	local integer id = GetPlayerId(p)
	local unit c = CirclesUnit[id]
	local unit trigUnit = Player__Hero[id]
	local integer level = GetHeroLevel(trigUnit)
	local integer i = 0
	if Mode__DeathMatch then
		set c = null
		set trigUnit = null
		return
	endif
	if FRV == false then
		set c = null
		set trigUnit = null
		return
	endif
	if W4[id]=='h0D4' then
		set c = null
		set trigUnit = null
		return
	endif
	if W4[id]!= 0 then
		call RemoveUnitFromStock(c, W4[id])
	endif
	call AddUnitToStock(c, U4[KFX(level)], 1, 1)
	set W4[id]= U4[KFX(level)]
	set trigUnit = null
	set c = null
endfunction
// 死亡竞赛就没有
function KUX takes nothing returns boolean
	if Mode__DeathMatch then
		return false
	endif
	// 刷新买活？
	call KTX(SentinelPlayers[1])
	call KTX(SentinelPlayers[2])
	call KTX(SentinelPlayers[3])
	call KTX(SentinelPlayers[4])
	call KTX(SentinelPlayers[5])
	call KTX(ScourgePlayers[1])
	call KTX(ScourgePlayers[2])
	call KTX(ScourgePlayers[3])
	call KTX(ScourgePlayers[4])
	call KTX(ScourgePlayers[5])
	return false
endfunction
function KWX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer id =(LoadInteger(HY, h, 34))
	local unit KSX = CirclesUnit[id]
	local unit trigUnit = Player__Hero[id]
	local integer level = GetHeroLevel(trigUnit)
	local integer i = 0
	call RemoveUnitFromStock(KSX, 'h0D4')
	//call UnitRemoveAbility(KSX,'A20U')
	call AddUnitToStock(KSX, U4[KFX(level)], 1, 1)
	set W4[id]= U4[KFX(level)]
	call DestroyTimerAndFlushHT_HY(t) 
	set t = null
	set KSX = null
	set trigUnit = null
endfunction
//function KYX takes player p returns nothing
//	local integer id = GetPlayerId(p)
//	local unit KSX = CirclesUnit[id]
//	local unit trigUnit = Player__Hero[id]
//	local integer level = GetHeroLevel(trigUnit)
//	local integer i = 0
//	local trigger t = CreateTrigger()
//	local integer h = GetHandleId(t)
//	call KCX(trigUnit)
//	loop
//	exitwhen i > 59
//		call RemoveUnitFromStock(KSX, U4[i])
//		set i = i + 1
//	endloop
//	call TriggerAddCondition(t, Condition(function KWX))
//	call TriggerRegisterTimerEvent(t, 420, false)
//	call SaveInteger(HY, h, 34,(id))
//	set W4[id]='h0D4'
//	call RemoveUnitFromStock(KSX, 'h0D4')
//	call AddUnitToStock(KSX, 'h0D4', 0, 1)
//	//call UnitAddAbility(KSX,'A20U')
//	//call IssueImmediateOrderById(KSX,852526)
//	set trigUnit = null
//	set KSX = null
//	set t = null
//endfunction
//改成timer 可以得知还需要多久买活冷却结束
function KYX takes player p returns nothing
	local integer id = GetPlayerId(p)
	local unit KSX = CirclesUnit[id]
	local unit trigUnit = Player__Hero[id]
	local integer level = GetHeroLevel(trigUnit)
	local integer i = 0
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call KCX(trigUnit)
	loop
	exitwhen i > 59
		call RemoveUnitFromStock(KSX, U4[i])
		set i = i + 1
	endloop
	if LocalPlayer == GetOwningPlayer(trigUnit) then
		set PlayerBuyback_Timer = t
	endif
	call TimerStart(t, 420., false, function KWX)
	call SaveInteger(HY, h, 34,(id))
	set W4[id]='h0D4'
	call RemoveUnitFromStock(KSX, 'h0D4')
	call AddUnitToStock(KSX, 'h0D4', 0, 1)
	//call UnitAddAbility(KSX,'A20U')
	//call IssueImmediateOrderById(KSX,852526)
	set trigUnit = null
	set KSX = null
	set t = null
endfunction
function KZX takes nothing returns nothing
	set VQV[GetPlayerId(SentinelPlayers[1])]= 0
	set VSV[GetPlayerId(SentinelPlayers[1])]= 66
	set VTV[GetPlayerId(SentinelPlayers[1])]= 255
	set VQV[GetPlayerId(SentinelPlayers[2])]= 48
	set VSV[GetPlayerId(SentinelPlayers[2])]= 230
	set VTV[GetPlayerId(SentinelPlayers[2])]= 185
	set VQV[GetPlayerId(SentinelPlayers[3])]= 50
	set VSV[GetPlayerId(SentinelPlayers[3])]= 0
	set VTV[GetPlayerId(SentinelPlayers[3])]= 129
	set VQV[GetPlayerId(SentinelPlayers[4])]= 255
	set VSV[GetPlayerId(SentinelPlayers[4])]= 252
	set VTV[GetPlayerId(SentinelPlayers[4])]= 1
	set VQV[GetPlayerId(SentinelPlayers[5])]= 255
	set VSV[GetPlayerId(SentinelPlayers[5])]= 50
	set VTV[GetPlayerId(SentinelPlayers[5])]= 0
	set VQV[GetPlayerId(ScourgePlayers[1])]= 220
	set VSV[GetPlayerId(ScourgePlayers[1])]= 50
	set VTV[GetPlayerId(ScourgePlayers[1])]= 50
	set VQV[GetPlayerId(ScourgePlayers[2])]= 50
	set VSV[GetPlayerId(ScourgePlayers[2])]= 50
	set VTV[GetPlayerId(ScourgePlayers[2])]= 50
	set VQV[GetPlayerId(ScourgePlayers[3])]= 75
	set VSV[GetPlayerId(ScourgePlayers[3])]= 150
	set VTV[GetPlayerId(ScourgePlayers[3])]= 190
	set VQV[GetPlayerId(ScourgePlayers[4])]= 16
	set VSV[GetPlayerId(ScourgePlayers[4])]= 60
	set VTV[GetPlayerId(ScourgePlayers[4])]= 18
	set VQV[GetPlayerId(ScourgePlayers[5])]= 68
	set VSV[GetPlayerId(ScourgePlayers[5])]= 42
	set VTV[GetPlayerId(ScourgePlayers[5])]= 4
endfunction
function K_X takes nothing returns nothing
	local integer loop_i
	local integer loop_max
	local integer i
	set PlayersColoerText[GetPlayerId(SentinelPlayers[0])]= "|c00ff0303"
	set PlayersColoerText[GetPlayerId(SentinelPlayers[1])]= "|c000042ff"
	set PlayersColoerText[GetPlayerId(SentinelPlayers[2])]= "|c001ce6b9"
	set PlayersColoerText[GetPlayerId(SentinelPlayers[3])]= "|c00540081"
	set PlayersColoerText[GetPlayerId(SentinelPlayers[4])]= "|c00fffc01"
	set PlayersColoerText[GetPlayerId(SentinelPlayers[5])]= "|c00ff8000"
	set PlayersColoerText[GetPlayerId(ScourgePlayers[0])]= "|c0020c000"
	set PlayersColoerText[GetPlayerId(ScourgePlayers[1])]= "|c00e55bb0"
	set PlayersColoerText[GetPlayerId(ScourgePlayers[2])]= "|c00959697"
	set PlayersColoerText[GetPlayerId(ScourgePlayers[3])]= "|c007ebff1"
	set PlayersColoerText[GetPlayerId(ScourgePlayers[4])]= "|c00106246"
	set PlayersColoerText[GetPlayerId(ScourgePlayers[5])]= "|c004e2a04"
	call SetPlayerColor(SentinelPlayers[0], PLAYER_COLOR_RED)
	call SetPlayerColor(SentinelPlayers[1], PLAYER_COLOR_BLUE)
	call SetPlayerColor(SentinelPlayers[2], PLAYER_COLOR_CYAN)
	call SetPlayerColor(SentinelPlayers[3], PLAYER_COLOR_PURPLE)
	call SetPlayerColor(SentinelPlayers[4], PLAYER_COLOR_YELLOW)
	call SetPlayerColor(SentinelPlayers[5], PLAYER_COLOR_ORANGE)
	call SetPlayerColor(ScourgePlayers[0], PLAYER_COLOR_GREEN)
	call SetPlayerColor(ScourgePlayers[1], PLAYER_COLOR_PINK)
	call SetPlayerColor(ScourgePlayers[2], PLAYER_COLOR_LIGHT_GRAY)
	call SetPlayerColor(ScourgePlayers[3], PLAYER_COLOR_LIGHT_BLUE)
	call SetPlayerColor(ScourgePlayers[4], PLAYER_COLOR_AQUA)
	call SetPlayerColor(ScourgePlayers[5], PLAYER_COLOR_BROWN)
	set loop_i = 1
	set loop_max = 5
	loop
		if GetPlayerSlotState(SentinelPlayers[loop_i]) == PLAYER_SLOT_STATE_EMPTY then
			call SetPlayerName(SentinelPlayers[loop_i], GetObjectName('n0DH')+ " " + I2S(loop_i))
		endif
		if GetPlayerSlotState(ScourgePlayers[loop_i]) == PLAYER_SLOT_STATE_EMPTY then
			call SetPlayerName(ScourgePlayers[loop_i], GetObjectName('n0DH')+ " " + I2S(5 + loop_i))
		endif
		set loop_i = loop_i + 1
	exitwhen loop_i > loop_max
	endloop
endfunction
function K1X takes nothing returns nothing
	local integer i
	local integer k
	local integer K2X = 125
	call SetUnitOwner(SentinelCircle1, SentinelPlayers[1], false)
	call SetUnitOwner(SentinelCircle2, SentinelPlayers[2], false)
	call SetUnitOwner(SentinelCircle3, SentinelPlayers[3], false)
	call SetUnitOwner(SentinelCircle4, SentinelPlayers[4], false)
	call SetUnitOwner(SentinelCircle5, SentinelPlayers[5], false)
	call SetUnitOwner(ScourgeCircle1, ScourgePlayers[1], false)
	call SetUnitOwner(ScourgeCircle2, ScourgePlayers[2], false)
	call SetUnitOwner(ScourgeCircle3, ScourgePlayers[3], false)
	call SetUnitOwner(ScourgeCircle4, ScourgePlayers[4], false)
	call SetUnitOwner(ScourgeCircle5, ScourgePlayers[5], false)
	set CirclesUnit[GetPlayerId(SentinelPlayers[1])]= SentinelCircle1
	set CirclesUnit[GetPlayerId(SentinelPlayers[2])]= SentinelCircle2
	set CirclesUnit[GetPlayerId(SentinelPlayers[3])]= SentinelCircle3
	set CirclesUnit[GetPlayerId(SentinelPlayers[4])]= SentinelCircle4
	set CirclesUnit[GetPlayerId(SentinelPlayers[5])]= SentinelCircle5
	set CirclesUnit[GetPlayerId(ScourgePlayers[1])]= ScourgeCircle1
	set CirclesUnit[GetPlayerId(ScourgePlayers[2])]= ScourgeCircle2
	set CirclesUnit[GetPlayerId(ScourgePlayers[3])]= ScourgeCircle3
	set CirclesUnit[GetPlayerId(ScourgePlayers[4])]= ScourgeCircle4
	set CirclesUnit[GetPlayerId(ScourgePlayers[5])]= ScourgeCircle5
	set i = 1
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 2
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 3
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 4
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 5
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 7
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 8
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 9
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 10
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 11
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(CirclesUnit[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 1
	loop
		set k = GetPlayerId(SentinelPlayers[i])
		set CirclesX[k]= GetUnitX(CirclesUnit[k])
		set CirclesY[k]= GetUnitY(CirclesUnit[k])
		set k = GetPlayerId(ScourgePlayers[i])
		set CirclesX[k]= GetUnitX(CirclesUnit[k])
		set CirclesY[k]= GetUnitY(CirclesUnit[k])
		set i = i + 1
	exitwhen i > 5
	endloop
endfunction
function K3X takes unit K4X returns boolean
	local integer ID = GetUnitTypeId(K4X)
	if ID =='n00V' or ID =='n00W' or ID =='n002' or ID =='n00X' or ID =='nC38' or ID =='n01K' or ID =='n009' then
		return true
	endif
	return false
endfunction
function K5X takes nothing returns nothing
	if (GetOwningPlayer(GetEnumUnit()) == Player(0)) then
		call SetUnitOwner(GetEnumUnit(), SentinelPlayers[0], false)
		if K3X(GetEnumUnit()) == false then
			call SetUnitColor(GetEnumUnit(), ConvertPlayerColor(0))
		endif
	else
		call SetUnitOwner(GetEnumUnit(), ScourgePlayers[0], false)
		if K3X(GetEnumUnit()) == false then
			call SetUnitColor(GetEnumUnit(), ConvertPlayerColor(6))
		endif
	endif
endfunction
function K6X takes nothing returns nothing
	local group g = AllocationGroup(7)
	call GroupEnumUnitsOfPlayer(g, Player(0), null)
	call ForGroup(g, function K5X)
	call GroupClear(g)
	call GroupEnumUnitsOfPlayer(g, Player(6), null)
	call ForGroup(g, function K5X)
	call DeallocateGroup(g)
	set g = null
endfunction
function K7X takes player p returns nothing
	local integer i = 0
	local string K8X = GetPlayerName(p)
	local integer J_X = StringLength(K8X)
	local integer K9X = J_X
	loop
	exitwhen i == J_X
		if SubString(K8X, i, i + 1) == "("and SubString(K8X, i -1, i) == " "then
			set K9X = i -1
			call SetPlayerName(p, SubString(K8X, 0, K9X))
			set i = J_X
		else
			set i = i + 1
		endif
	endloop
endfunction
function LVX takes string s returns string
	local integer i = 0
	local integer LEX = StringLength(s)
	local string ss = ""
	local string p
	loop
	exitwhen i == LEX
		set p = SubString(s, i, i + 1)
		if i + 1 == LEX and p == "|" then
			set ss = ss + "||"
		else
			set ss = ss + p
		endif
		set i = i + 1
	endloop
	return ss
endfunction

// 初始化OB
function InitObserverPlayer takes nothing returns nothing	//OB是否存在 MW来判断
	local integer LOX
	local integer LRX
	local integer loop_i
	local integer loop_max
	local integer x = 0
	local integer y = 0
	local integer i
	local trigger t = null
	local location LIX = GetRectCenter(gg_rct_SentinelTavernCamera)
	local location LAX = GetRectCenter(gg_rct_ScourgeTavernCamera)
	if GetPlayerState(SentinelPlayers[0], PLAYER_STATE_OBSERVER)!= 0 or GetPlayerState(ScourgePlayers[0], PLAYER_STATE_OBSERVER)!= 0 then
		set IsGameHaveObserver = true
		set SentinelPlayers[0] = Player( 13 )
		set ScourgePlayers[0]  = Player( 14 )
		set ObserverPlayer1 = Player( 0 )
		set ObserverPlayer2 = Player( 6 )
		set GV = GetPlayerName(ObserverPlayer1) == "ohsystem.net"
		call SetAllyColorFilterState( 0 )
		loop
		exitwhen x > 5
			call SetPlayerAlliance(Player(0), SentinelPlayers[x], ALLIANCE_PASSIVE, true)
			call SetPlayerAlliance(Player(0), SentinelPlayers[x], ALLIANCE_SHARED_SPELLS, true)
			call SetPlayerAlliance(Player(0), ScourgePlayers[x], ALLIANCE_PASSIVE, false)
			call SetPlayerAlliance(Player(0), ScourgePlayers[x], ALLIANCE_SHARED_SPELLS, false)
			set x = x + 1
		endloop
	endif
	call ForceAddPlayer(SentinelForce, SentinelPlayers[0])
	call ForceAddPlayer(SentinelForce, SentinelPlayers[1])
	call ForceAddPlayer(SentinelForce, SentinelPlayers[2])
	call ForceAddPlayer(SentinelForce, SentinelPlayers[3])
	call ForceAddPlayer(SentinelForce, SentinelPlayers[4])
	call ForceAddPlayer(SentinelForce, SentinelPlayers[5])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[0])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[1])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[2])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[3])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[4])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[5])
	call ForceAddPlayer(AllPlayerForce, SentinelPlayers[1])
	call ForceAddPlayer(AllPlayerForce, SentinelPlayers[2])
	call ForceAddPlayer(AllPlayerForce, SentinelPlayers[3])
	call ForceAddPlayer(AllPlayerForce, SentinelPlayers[4])
	call ForceAddPlayer(AllPlayerForce, SentinelPlayers[5])
	call ForceAddPlayer(AllPlayerForce, ScourgePlayers[1])
	call ForceAddPlayer(AllPlayerForce, ScourgePlayers[2])
	call ForceAddPlayer(AllPlayerForce, ScourgePlayers[3])
	call ForceAddPlayer(AllPlayerForce, ScourgePlayers[4])
	call ForceAddPlayer(AllPlayerForce, ScourgePlayers[5])
	if IsGameHaveObserver then
		call ForceAddPlayer(AllPlayerForce, Player(0))
		call ForceAddPlayer(AllPlayerForce, Player(6))
	endif
	set x = 0
	set y = 0
	loop
	exitwhen x > 5
		loop
		exitwhen y > 5
			if (x != y) then
				call SetPlayerAlliance(SentinelPlayers[x], SentinelPlayers[y], ALLIANCE_PASSIVE, true)
				call SetPlayerAlliance(SentinelPlayers[x], SentinelPlayers[y], ALLIANCE_HELP_REQUEST, true)
				call SetPlayerAlliance(SentinelPlayers[x], SentinelPlayers[y], ALLIANCE_HELP_RESPONSE, true)
				call SetPlayerAlliance(SentinelPlayers[x], SentinelPlayers[y], ALLIANCE_SHARED_XP, true)
				call SetPlayerAlliance(SentinelPlayers[x], SentinelPlayers[y], ALLIANCE_SHARED_SPELLS, true)
				call SetPlayerAlliance(SentinelPlayers[x], SentinelPlayers[y], ALLIANCE_SHARED_VISION, true)
				call SetPlayerAlliance(SentinelPlayers[x], SentinelPlayers[y], ALLIANCE_SHARED_CONTROL, false)
				call SetPlayerAlliance(SentinelPlayers[x], SentinelPlayers[y], ALLIANCE_SHARED_ADVANCED_CONTROL, false)
				call SetPlayerAlliance(ScourgePlayers[x], ScourgePlayers[y], ALLIANCE_PASSIVE, true)
				call SetPlayerAlliance(ScourgePlayers[x], ScourgePlayers[y], ALLIANCE_HELP_REQUEST, true)
				call SetPlayerAlliance(ScourgePlayers[x], ScourgePlayers[y], ALLIANCE_HELP_RESPONSE, true)
				call SetPlayerAlliance(ScourgePlayers[x], ScourgePlayers[y], ALLIANCE_SHARED_XP, true)
				call SetPlayerAlliance(ScourgePlayers[x], ScourgePlayers[y], ALLIANCE_SHARED_SPELLS, true)
				call SetPlayerAlliance(ScourgePlayers[x], ScourgePlayers[y], ALLIANCE_SHARED_VISION, true)
				call SetPlayerAlliance(ScourgePlayers[x], ScourgePlayers[y], ALLIANCE_SHARED_CONTROL, false)
				call SetPlayerAlliance(ScourgePlayers[x], ScourgePlayers[y], ALLIANCE_SHARED_ADVANCED_CONTROL, false)
				call SetPlayerAlliance(SentinelPlayers[x], ScourgePlayers[y], ALLIANCE_PASSIVE, false)
				call SetPlayerAlliance(SentinelPlayers[x], ScourgePlayers[y], ALLIANCE_HELP_REQUEST, false)
				call SetPlayerAlliance(SentinelPlayers[x], ScourgePlayers[y], ALLIANCE_HELP_RESPONSE, false)
				call SetPlayerAlliance(SentinelPlayers[x], ScourgePlayers[y], ALLIANCE_SHARED_XP, false)
				call SetPlayerAlliance(SentinelPlayers[x], ScourgePlayers[y], ALLIANCE_SHARED_SPELLS, false)
				call SetPlayerAlliance(SentinelPlayers[x], ScourgePlayers[y], ALLIANCE_SHARED_VISION, false)
				call SetPlayerAlliance(SentinelPlayers[x], ScourgePlayers[y], ALLIANCE_SHARED_CONTROL, false)
				call SetPlayerAlliance(SentinelPlayers[x], ScourgePlayers[y], ALLIANCE_SHARED_ADVANCED_CONTROL, false)
				call SetPlayerAlliance(ScourgePlayers[x], SentinelPlayers[y], ALLIANCE_PASSIVE, false)
				call SetPlayerAlliance(ScourgePlayers[x], SentinelPlayers[y], ALLIANCE_HELP_REQUEST, false)
				call SetPlayerAlliance(ScourgePlayers[x], SentinelPlayers[y], ALLIANCE_HELP_RESPONSE, false)
				call SetPlayerAlliance(ScourgePlayers[x], SentinelPlayers[y], ALLIANCE_SHARED_XP, false)
				call SetPlayerAlliance(ScourgePlayers[x], SentinelPlayers[y], ALLIANCE_SHARED_SPELLS, false)
				call SetPlayerAlliance(ScourgePlayers[x], SentinelPlayers[y], ALLIANCE_SHARED_VISION, false)
				call SetPlayerAlliance(ScourgePlayers[x], SentinelPlayers[y], ALLIANCE_SHARED_CONTROL, false)
				call SetPlayerAlliance(ScourgePlayers[x], SentinelPlayers[y], ALLIANCE_SHARED_ADVANCED_CONTROL, false)
			endif
			set y = y + 1
		endloop
		set y = 0
		set x = x + 1
	endloop
	call SetPlayerTeam(SentinelPlayers[0], 0)
	call SetPlayerTeam(SentinelPlayers[1], 0)
	call SetPlayerTeam(SentinelPlayers[2], 0)
	call SetPlayerTeam(SentinelPlayers[3], 0)
	call SetPlayerTeam(SentinelPlayers[4], 0)
	call SetPlayerTeam(SentinelPlayers[5], 0)
	call SetPlayerTeam(ScourgePlayers[0], 1)
	call SetPlayerTeam(ScourgePlayers[1], 1)
	call SetPlayerTeam(ScourgePlayers[2], 1)
	call SetPlayerTeam(ScourgePlayers[3], 1)
	call SetPlayerTeam(ScourgePlayers[4], 1)
	call SetPlayerTeam(ScourgePlayers[5], 1)
	call SetPlayerName(SentinelPlayers[0], GetObjectName('n03N'))
	call SetPlayerName(ScourgePlayers[0], GetObjectName('n03O'))
	call SetPlayerName(NeutralCreepPlayer, GetObjectName('n0E8'))
	call K1X()
	if (SentinelPlayers[0]!= Player(0) or ScourgePlayers[0]!= Player(6)) then
		call K6X()
	endif
	call K_X()
	set LRX = XMX(SentinelForce)
	set LOX = XMX(ScourgeForce)
	set loop_i = 1
	set loop_max = 5
	loop
	exitwhen loop_i > loop_max
		if (IsPlayingPlayer(SentinelPlayers[loop_i])) then
			call SetPlayerState(SentinelPlayers[loop_i], PLAYER_STATE_RESOURCE_GOLD,(4375 / LRX))
			call SetPlayerState(SentinelPlayers[loop_i], PLAYER_STATE_RESOURCE_LUMBER, 0)
		endif
		if (IsPlayingPlayer(ScourgePlayers[loop_i])) then
			call SetPlayerState(ScourgePlayers[loop_i], PLAYER_STATE_RESOURCE_GOLD,(4375 / LOX))
			call SetPlayerState(ScourgePlayers[loop_i], PLAYER_STATE_RESOURCE_LUMBER, 0)
		endif
		set loop_i = loop_i + 1
	endloop
	call SetPlayerHandicapXP(SentinelPlayers[1], 1)
	call SetPlayerHandicapXP(SentinelPlayers[2], 1)
	call SetPlayerHandicapXP(SentinelPlayers[3], 1)
	call SetPlayerHandicapXP(SentinelPlayers[4], 1)
	call SetPlayerHandicapXP(SentinelPlayers[5], 1)
	call SetPlayerHandicapXP(ScourgePlayers[1], 1)
	call SetPlayerHandicapXP(ScourgePlayers[2], 1)
	call SetPlayerHandicapXP(ScourgePlayers[3], 1)
	call SetPlayerHandicapXP(ScourgePlayers[4], 1)
	call SetPlayerHandicapXP(ScourgePlayers[5], 1)
	call SetPlayerState(SentinelPlayers[0], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(SentinelPlayers[1], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(SentinelPlayers[2], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(SentinelPlayers[3], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(SentinelPlayers[4], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(SentinelPlayers[5], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(ScourgePlayers[0], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(ScourgePlayers[1], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(ScourgePlayers[2], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(ScourgePlayers[3], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(ScourgePlayers[4], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(ScourgePlayers[5], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(NeutralCreepPlayer, PLAYER_STATE_GIVES_BOUNTY, 0)
	call GetHostPlayer()
	call KZX()
	call K7X(SentinelPlayers[1])
	call K7X(SentinelPlayers[2])
	call K7X(SentinelPlayers[3])
	call K7X(SentinelPlayers[4])
	call K7X(SentinelPlayers[5])
	call K7X(ScourgePlayers[1])
	call K7X(ScourgePlayers[2])
	call K7X(ScourgePlayers[3])
	call K7X(ScourgePlayers[4])
	call K7X(ScourgePlayers[5])
	set x = 1
	loop
	exitwhen x > 5
		if IsPlayingPlayer(SentinelPlayers[x]) then
			call YCE(SentinelPlayers[x])
		endif
		if IsPlayingPlayer(ScourgePlayers[x]) then
			call YCE(ScourgePlayers[x])
		endif
		set x = x + 1
	endloop
	call RemoveLocation(LIX)
	call RemoveLocation(LAX)
	set i = 0
	loop
		set PlayersName[i]= LVX(GetPlayerName(Player(i)))
		set VPV[i]= StringHash(PlayersName[i])
		set i = i + 1
	exitwhen i == 16
	endloop
	set t = null
	set LIX = null
	set LAX = null
endfunction
function LNX takes integer id returns boolean
	return id =='A0ES' or id =='A43P' or id =='A0QN' or id =='A2TH' or id =='A21F' or id =='A21G' or id =='A21H' or id =='A1S9' or id =='A24A' or id =='A24B' or id =='A1S9' or id =='A06K' or id =='A1VG' or id =='A28Q' or id =='A1WF' or id =='A0T8' or id =='A0T7' or id =='A20N' or id =='A1Z2' or id =='A1Z3' or id =='A205' or id =='A14A' or id =='A269' or id =='A2KG' or id =='A21J' or id =='A27X' or id =='A28Y' or id =='A24E' or id =='A1ZH' or id =='A1WO' or id =='A1FQ' or id =='A0TE' or id =='A2JO' or id =='A2FX' or id =='A0MP' or id =='A2KE' or id =='A2KH' or id =='A2K9' or id =='A2JL' or id =='A2O2' or id =='A2MB' or id =='A21J' or id =='A2MC' or id =='A1NH' or id =='A2LI' or id =='A2TK' or id =='A1MO' or id =='A527' or id =='A528'
endfunction
function LBX takes nothing returns nothing
	call CreateQuestBJ(0, "TRIGSTR_50004", "TRIGSTR_50005", "ReplaceableTextures\\CommandButtons\\BTNSpy.blp")
	call CreateQuestBJ(0, "TRIGSTR_50006", "TRIGSTR_50007", "ReplaceableTextures\\CommandButtons\\BTNTome.blp")
	call CreateQuestBJ(0, "TRIGSTR_50008", "TRIGSTR_50009", "ReplaceableTextures\\CommandButtons\\BTNAmbush.blp")
endfunction

function LLX takes nothing returns boolean
	local string s
	if not IsUnitIllusion(GetTriggerUnit()) and GetUnitTypeId(GetTriggerUnit())!='H00J' then
		set s = GetUnitName(GetTriggerUnit())+ " " + GetObjectName('n0HB')+ " " + GetObjectName(GetLearnedSkill())+ " (" + GetObjectName('n0HC')+ " " + I2S(GetLearnedSkillLevel())+ ")"
		call DisplayTimedTextToPlayer(ObserverPlayer1, 0, 0, 3, s)
		call DisplayTimedTextToPlayer(ObserverPlayer2, 0, 0, 3, s)
	endif
	return false
endfunction
function LMX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_HERO_SKILL)
	call TriggerAddCondition(t, Condition(function LLX))
	set t = null
endfunction
// 裁判离开游戏
function LUX takes nothing returns nothing
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 25.,(ObserverPlayersName[GetPlayerId((GetTriggerPlayer()))])+ "|c00ff0303 " + GetObjectName('n02D')+ "|r")
endfunction
function LWX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player LYX =(LoadPlayerHandle(HY, h, 78))
	local integer loop_i = 1
	local integer LZX
	local integer L_X = GetPlayerState(LYX, PLAYER_STATE_RESOURCE_GOLD)
	if F0V[GetPlayerId(LYX)]== false and YS then
		if GetTriggerEvalCount(t) == 1 then
			if IsPlayerAlly(LocalPlayer, LYX) then
				call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 6, GetObjectName('n0J3'))
				call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 6, GetObjectName('n0JG'))
			endif
		endif
		return false
	endif
	if L_X > 20 then
		call SetPlayerState(LYX, PLAYER_STATE_RESOURCE_GOLD, 0)
		set PlayersReliableGold[GetPlayerId(LYX)]= 0
		if IsSentinelPlayer(LYX) then
			set LZX = XKX(SentinelForce)
		else
			set LZX = XKX(ScourgeForce)
		endif
		if IsSentinelPlayer(LYX) then
			loop
			exitwhen loop_i > 5
				if IsPlayingPlayer(SentinelPlayers[loop_i]) then
					call SetPlayerState(SentinelPlayers[loop_i], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(SentinelPlayers[loop_i], PLAYER_STATE_RESOURCE_GOLD)+ L_X / LZX)
				endif
				set loop_i = loop_i + 1
			endloop
		else
			loop
			exitwhen loop_i > 5
				if IsPlayingPlayer(ScourgePlayers[loop_i]) then
					call SetPlayerState(ScourgePlayers[loop_i], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(ScourgePlayers[loop_i], PLAYER_STATE_RESOURCE_GOLD)+ L_X / LZX)
				endif
				set loop_i = loop_i + 1
			endloop
		endif
	endif
	set t = null
	return false
endfunction
function L0X takes player LYX returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SavePlayerHandle(HY, h, 78,(LYX))
	call TriggerRegisterTimerEvent(t, 2, true)
	call TriggerAddCondition(t, Condition(function LWX))
	set t = null
endfunction
function L1X takes player p returns nothing
	local multiboarditem mbt = MultiboardGetItem(MainMultiboard, D2V[GetPlayerId(p)], D1V[GetPlayerId(p)])
	call MultiboardSetItemValue(mbt, "|c00333333" +(PlayersName[GetPlayerId((p))])+ "|r")
	call MultiboardReleaseItem(mbt)
	set mbt = null
endfunction

// 退出游戏
function L2X takes nothing returns nothing
	local integer LRX = XKX(SentinelForce)
	local integer LOX = XKX(ScourgeForce)
	local integer loop_i
	local integer loop_max
	local string KGX
	local string L3X
	local unit hPlayerHeroUnit = Player__Hero[GetPlayerId(GetTriggerPlayer())]
	if hPlayerHeroUnit == null then
		set L3X = GetObjectName('n0EW')
	else
		set L3X = GetUnitName(hPlayerHeroUnit)
	endif
	if (TS < 10) then
		set KGX = I2S(QS)+ ":0" + I2S(TS)
	else
		set KGX = I2S(QS)+ ":" + I2S(TS)
	endif
	if not IsGameEnd then
		set PlayerOnlineStateString[GetPlayerId(GetTriggerPlayer())]= "|c00555555" + KGX + "|r"
		call YYE(GetPlayerId(GetTriggerPlayer()), true)
		call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 25., PlayersColoerText[GetPlayerId(GetTriggerPlayer())] +(PlayersName[GetPlayerId((GetTriggerPlayer()))])+ " (" + L3X + ")|r|c00ff0303 " + GetObjectName('n02D')+ "|r")
		if (IsSentinelPlayer(GetTriggerPlayer())) then
			set loop_i = 1
			set loop_max = 5
			loop
			exitwhen loop_i > loop_max
				if (SentinelPlayers[loop_i]!= GetTriggerPlayer()) then
					if (IsPlayingPlayer(SentinelPlayers[loop_i])) then
						call SetPlayerAllianceStateBJ(GetTriggerPlayer(), SentinelPlayers[loop_i], 4)
					endif
				endif
				set loop_i = loop_i + 1
			endloop
		else
			set loop_i = 1
			set loop_max = 5
			loop
			exitwhen loop_i > loop_max
				if (ScourgePlayers[loop_i]!= GetTriggerPlayer()) then
					if (IsPlayingPlayer(ScourgePlayers[loop_i])) then
						call SetPlayerAllianceStateBJ(GetTriggerPlayer(), ScourgePlayers[loop_i], 4)
					endif
				endif
				set loop_i = loop_i + 1
			endloop
		endif
		if IsSentinelPlayer(GetTriggerPlayer()) or IsScourgePlayer(GetTriggerPlayer()) then
			set EKV = EKV + 1
		endif
		call StoreDrCacheData("C" + "K" + I2S(PlayerCreepLastHitCount[GetPlayerId(GetTriggerPlayer())])+ "D" + I2S(PlayerCreepDenyCount[GetPlayerId(GetTriggerPlayer())])+ "N" + I2S((LoadInteger(HY,(400 + GetPlayerId(GetTriggerPlayer())), 79))), GetPlayerId(GetTriggerPlayer()))
		set FFV = GetTriggerPlayer()
		call ExecuteFunc("L4X")
		if YS then
			call C0X(GetTriggerPlayer())
		endif
		set EJV[GetPlayerId(GetTriggerPlayer())]= true
		call L1X(GetTriggerPlayer())
		call L0X(GetTriggerPlayer())
		if EKV == 2 and IsGameHaveObserver == false and BL then
			call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 60, " ")
			call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 60, " ")
			call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 60, "|c006699CC" + GetObjectName('n0FW')+ "|r")
		endif
	else
		set PlayerOnlineStateString[GetPlayerId(GetTriggerPlayer())]= "|c00555555End|r"
		call ExecuteFunc("L5X")
	endif
	set hPlayerHeroUnit = null
endfunction
function L6X takes unit u returns nothing
	if GetUnitAbilityLevel(u,'A40E') == 1 then
		call UnitRemoveAbility(u,'A40E')
	endif
	//if GetUnitAbilityLevel(u,'B09Y') == 1 then
	//	call UnitRemoveAbility(u,'B09Y')
	//endif
	//if GetUnitAbilityLevel(u,'B3JQ') == 1 then
	//	call UnitRemoveAbility(u,'B3JQ')
	//endif
endfunction
function L7X takes unit u returns nothing
	local integer i
	if IsSentinelPlayer(GetOwningPlayer(u)) then
		call IssueTargetOrderById(u, 851986, SentinelFountainOfLifeUnit)
	else
		call IssueTargetOrderById(u, 851986, ScourgeFountainOfLifeUnit)
	endif
	call IssueImmediateOrderById(u, 851972)
	if GetUnitCurrentOrder(u)== 851986 then
		call TriggerExecute(KV)
		call RemoveUnit(u)
	endif
endfunction
// 复活英雄单位
function L8X takes unit u returns nothing
	local integer h = GetHandleId(u)
	call L7X(u)
	call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A11X', false)
	call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A10U', false)
	call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A344', false)
	if GetOwningPlayer(u) == LocalPlayer then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 1, " ")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 1, "|c006699CC" + GetObjectName('n0GR'))
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 1, " ")
	endif
	if LoadBoolean(HY, h,'suic') then
		call RemoveSavedBoolean(HY, h,'suic')
	endif
	call BYX(XE, GetOwningPlayer(u))
	call SetUnitState(u, UNIT_STATE_MANA, 999999)
	if G3X(u) then
		call HDX(u, false)
	endif
	call SetUnitInvulnerable(u, false)
	call SetUnitPathing(u, true)
	call PauseUnit(u, false)
	call SetUnitFlyHeight(u, GetUnitDefaultFlyHeight(u), 0)
	//call SetUnitScale(u, GetUnitModelScale(u), GetUnitModelScale(u), GetUnitModelScale(u))
	// 修正模型缩放
	call SetUnitCurrentScaleEx(u, GetUnitCurrentScale(u))
	call GBX(u)
	call FKX(u, true)
	if LoadInteger(ObjectHashTable, GetHandleId(u),'A32D')> 0 then
		call SaveInteger(ObjectHashTable, GetHandleId(u),'A32D', 0)
		call SaveBoolean(ObjectHashTable, GetHandleId(u),'A32D', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A32D', false)
	endif
	// 死亡驱散的一些Buff和技能
	call UnitRemoveAbility(u,'A3B2')
	call UnitRemoveAbility(u,'B3B2')
	call UnitRemoveAbility(u,'A40F')
	call UnitRemoveAbility(u,'A43N')
	call UnitRemoveAbility(u,'A43O')
	call UnitRemoveAbility(u,'A40E')
	call UnitRemoveAbility(u,'A349')
	call UnitRemoveAbility(u,'A348')
	call UnitRemoveAbility(u,'A347')
	call UnitRemoveAbility(u,'A32H')
	call UnitRemoveAbility(u,'A32I')
	call UnitRemoveAbility(u,'A32J')
	call UnitRemoveAbility(u,'A32K')
	call UnitRemoveAbility(u,'A32L')
	call UnitRemoveAbility(u,'A32M')
	call UnitRemoveAbility(u,'A32N')
	call UnitRemoveAbility(u,'A32O')
	call UnitRemoveAbility(u,'A32P')
	call UnitRemoveAbility(u,'A32Q')
	call UnitRemoveAbility(u,'A32R')
	call UnitRemoveAbility(u,'A32S')
	call UnitRemoveAbility(u,'A021')
	call UnitRemoveAbility(u,'QINV')
	call UnitRemoveAbility(u,'A313')
	call UnitRemoveAbility(u,'A314')
	call UnitRemoveAbility(u,'A315')
	call UnitRemoveAbility(u,'A0AZ')
	call UnitRemoveAbility(u,'A23F')
	call UnitRemoveAbility(u,'A21I')
	call UnitRemoveAbility(u,'A0PV')
	call UnitRemoveAbility(u,'A0RF')
	call UnitRemoveAbility(u, DBV)
	call UnitRemoveAbility(u,'A0I5')
	call UnitRemoveAbility(u,'A0IH')
	call UnitRemoveAbility(u,'B08L')
	call UnitRemoveAbility(u,'A0SR')
	call UnitRemoveAbility(u,'A0WO')
	call UnitRemoveAbility(u,'A0WR')
	call UnitRemoveAbility(u,'A1CN')
	call UnitRemoveAbility(u,'A147')
	call UnitRemoveAbility(u,'A121')
	call UnitRemoveAbility(u,'A12D')
	call UnitRemoveAbility(u,'A179')
	call UnitRemoveAbility(u,'Aetl')
	call UnitRemoveAbility(u, O4[0])
	call UnitRemoveAbility(u, O4[1])
	call UnitRemoveAbility(u, O4[2])
	call UnitRemoveAbility(u, O4[3])
	call UnitRemoveAbility(u, O4[4])
	call UnitRemoveAbility(u, O4[5])
	call SaveBoolean(HY,(GetHandleId(u)), 80,(false))
	call UnitRemoveAbility(u,'A1CA')
	call UnitRemoveAbility(u,'A1C9')
	call UnitRemoveAbility(u,'A1CB')
	call UnitRemoveAbility(u,'A1CC')
	call UnitRemoveAbility(u,'A1GA')
	call UnitRemoveAbility(u,'A1UH')
	call UnitRemoveAbility(u,'A23O')
	call UnitRemoveAbility(u,'B0E9')
	call KRX(u, 0)
	if GetUnitTypeId(u) == 'N0MH' then
		call YDWEUnitTransform( u, LoadInteger(ExtraHT, GetHandleId(u), HTKEY_UNIT_ORIGIN_TYPEID ) )
	endif
	set U2 = u
	call ExecuteFunc("L9X")
	if LoadBoolean(ObjectHashTable, GetHandleId(u), StringHash("morphedburn")) then
		call RAX(u, LoadInteger(ObjectHashTable, GetHandleId(u), StringHash("second")))
		call RAX(u, LoadInteger(ObjectHashTable, GetHandleId(u), StringHash("first")))
		call SaveBoolean(ObjectHashTable, GetHandleId(u), StringHash("morphedburn"), false)
	endif
endfunction
function MVX takes nothing returns boolean
	if GetPlayerAlliance(GetOwningPlayer(GetFilterUnit()), EMV, ALLIANCE_SHARED_CONTROL) and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false then
		set ELV = ELV + 1
	endif
	return false
endfunction
function MEX takes unit u, player p, real x, real y, boolean MXX returns nothing
	local group g = AllocationGroup(8)
	set ELV = 0
	set EMV = p
	call GroupEnumUnitsSelected(g, p, Condition(function MVX))
	if ELV == 0 and LocalPlayer== p then
		if MXX == false then
			call ClearSelection()
			call SelectUnit(u, true)
		endif
		call PanCameraToTimed(x, y, 0)
	endif
	set ELV = 0
	call DeallocateGroup(g)
	set g = null
endfunction
function MOX takes integer i returns boolean
	return i =='H00J' or i =='N0MM'
endfunction
function HeroIsDummyUnit takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return MOX(i) or i =='H07G' or i =='H00M' or i =='H0B8' or i =='H0DL' or i =='H00Y'
endfunction
function IsNotDummyHero takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return i!='H00M' and i!='H07G' and i!='H00Y' and i!='H00J' and i!='H0B8'
endfunction
function MIX takes unit whichUnit returns nothing
	local integer charges
	if GetItemOfTypeFromUnit(whichUnit, XOV[NIV])!= null and GetUnitTypeId(whichUnit)!='H00J' then
		set charges = R2I(GetItemCharges(GetItemOfTypeFromUnit(whichUnit, XOV[NIV]))* .67)
		if GetItemCharges(GetItemOfTypeFromUnit(whichUnit, XOV[NIV])) == 1 then
			set charges = 0
		endif
	endif
endfunction
function MBX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		call TriggerRegisterTimerEvent(t, 0, false)
	else
		if GetWidgetLife(u)!= GetUnitState(u, UNIT_STATE_MAX_LIFE) then
		else
			call RemoveUnit(u)
		endif
	endif
	set u = null
	set t = null
	return false
endfunction

// 英雄单位完成复活
function MCX takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local real x
	local real y
	local integer c
	local integer level
	set UF[GetPlayerId(GetOwningPlayer(u))]= false
	set M2[GetPlayerId(GetOwningPlayer(u))]= false
	if IsSentinelPlayer(GetOwningPlayer(u)) then
		set x = GetRectCenterX(gg_rct_SentinelRevivalPoint)
		set y = GetRectCenterY(gg_rct_SentinelRevivalPoint)
	else
		set x = GetRectCenterX(gg_rct_ScourgeRevivalPoint)
		set y = GetRectCenterY(gg_rct_ScourgeRevivalPoint)
	endif
	if GV then
		if TimerGetRemaining(PS[GetPlayerId(p)])> 2 then
			call StoreDrCacheData("LoD_HeroResp_" + I2S(GetPlayerId(p)), 1)
		else
			call StoreDrCacheData("LoD_HeroResp_" + I2S(GetPlayerId(p)), 0)
		endif
	endif
	call TimerStart(PS[GetPlayerId(p)], .0, false, null)
	call MEX(u, p, x, y, false)
	call SetUnitX(u, x)
	call SetUnitY(u, y)
	call L8X(u)
	if GetItemOfTypeFromUnit(u, XOV[NIV])!= null and GetUnitTypeId(u)!='H00J' then
		set c = R2I(GetItemCharges(GetItemOfTypeFromUnit(u, XOV[NIV]))* .67 * 1.)
		if GetItemCharges(GetItemOfTypeFromUnit(u, XOV[NIV])) == 1 then
			set c = 0
		endif
		call SetItemCharges(GetItemOfTypeFromUnit(u, XOV[NIV]), c)
	endif
	if GetUnitAbilityLevel(u,'A2AI')> 0 then
		call UnitRemoveAbility(u,'QF0O')
		call SetUnitAbilityLevel(u,'QB0G', GetUnitAbilityLevel(u,'A2AI'))
	endif
	call UnitSetStateBonus(u, 0, UNIT_BONUS_ARMOR)
	call FixUnitSkillsBug(u)
	call RefreshUnitRange(u)
	set u = null
endfunction

//字体淡出 持续一秒
function SetTopMessageText_FadeOut takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer c = GetTriggerEvalCount(t)
	local integer frame = LoadInteger(HY, h, 0)
	if c > 40 then
		call TriggerEvaluate(LoadTriggerHandle(HY, h, 0)) //结束后运行一次父级触发器
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call DzFrameSetAlpha(frame, 255 - R2I(6.375 * c)) //淡出
	endif
	set t = null
	return false
endfunction

function SetTopMessageText_CallBack takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer frame = LoadInteger(HY, h, 0)
	local trigger newtrg
	if not HaveSavedHandle(HY, h, 0) then 
	    set newtrg = CreateTrigger() //淡出触发器
    	call SaveTriggerHandle(HY, h, 0, newtrg) //存入父级触发器淡出结束后会运行本触发
    	set h = GetHandleId(newtrg)
    	call SaveInteger(HY, h, 0, frame) //frame
    	call SaveTriggerHandle(HY, h, 0, t) //存入触发器
    	call TriggerRegisterTimerEvent(newtrg, 0.025, true) //一秒回调40次
		call TriggerAddCondition(newtrg, Condition( function SetTopMessageText_FadeOut))
		set newtrg = null
	else
	 	//清除数据并隐藏Frame
    	call DzFrameSetText(frame, "" )
    	call DzFrameShow(frame, false)
    	call DzFrameSetAlpha(frame, 255)
		set TopMessageTextTrg[LoadInteger(HY, h, 1)] = null
    	call FlushChildHashtable(HY, h)
    	call CleanCurrentTrigger(t)
	endif
	set t = null
	return false
endfunction

function SetTopMessageTextById takes string s, real time, integer i returns nothing
	local integer h
	set TopMessageTextTrg[i] = CreateTrigger()
	set h = GetHandleId(TopMessageTextTrg[i])
	call SaveInteger(HY, h, 0, UIFrame__Text[i])
	call SaveInteger(HY, h, 1, i)
	call DzFrameShow(UIFrame__Text[i], true)
	call DzFrameSetAlpha(UIFrame__Text[i], 255)
	call DzFrameSetText(UIFrame__Text[i], s )
	call TriggerRegisterTimerEvent(TopMessageTextTrg[i], time - 1, false) //-1 后的时间是淡化开始
	call TriggerAddCondition(TopMessageTextTrg[i], Condition( function SetTopMessageText_CallBack))
endfunction

function RemoveTopMsgTriggerByIndex takes integer i returns nothing
	local trigger t = TopMessageTextTrg[i]
	local integer h = GetHandleId(t)
	local integer frame = UIFrame__Text[i]
	local trigger newtrg
	if HaveSavedHandle(HY, h, 0) then
		set newtrg = LoadTriggerHandle(HY, h, 0)
		call FlushChildHashtable(HY, GetHandleId(newtrg))
		call CleanCurrentTrigger(newtrg)
		set newtrg = null
	endif
	call DzFrameSetText(frame, "" )
	call DzFrameShow(frame, false)
	call DzFrameSetAlpha(frame, 255)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set TopMessageTextTrg[i] = null
	set t = null
endfunction

//将其从队列中移除
function QueuedTopMsgRemoveByIndex takes integer i returns nothing
	local integer h 
	local integer frame
	local trigger newtrg
	local integer k = i + 1
	call RemoveTopMsgTriggerByIndex(i)
	loop
		set TopMessageTextTrg[i] = TopMessageTextTrg[k]
		//call BJDebugMsg(I2S(k)+"移动至"+I2S(i))
		if TopMessageTextTrg[i] != null then
			set h = GetHandleId(TopMessageTextTrg[i])
			call SaveInteger(HY, h, 0, UIFrame__Text[k])
			call SaveInteger(HY, h, 1, i)
			if HaveSavedHandle(HY, h, 0) then
				set newtrg = LoadTriggerHandle(HY, h, 0)
				call SaveInteger(HY, GetHandleId(newtrg), 0, UIFrame__Text[k])
			endif
		endif
		if TopMessageTextTrg[k] == null then
			call DzFrameSetText(UIFrame__Text[i], "" )
			call DzFrameSetAlpha(UIFrame__Text[i], 255)
			//call DzFrameShow(UIFrame__Text[i], false)
		else
			call DzFrameSetText(UIFrame__Text[i], DzFrameGetText(UIFrame__Text[k]) )
			call DzFrameSetAlpha(UIFrame__Text[i], DzFrameGetAlpha(UIFrame__Text[k]))
		endif
		set TopMessageTextTrg[k] = null
		exitwhen i == 5
		set i = i + 1
		set k = i + 1
	endloop
	set TopMessageTextTrg[k] = null
	set newtrg = null
endfunction

//设置顶部消息
function SetTopMessageText takes string s, real time returns nothing
	local integer i = 5
	if TopMessageTextTrg[6] != null then
		call QueuedTopMsgRemoveByIndex(1)
		call SetTopMessageTextById(s, time, 6)
		//call BJDebugMsg("将一移除队列并设置第六个")
		return
	endif
	loop
		if TopMessageTextTrg[i] != null and i != 6 then
			call SetTopMessageTextById(s, time, i + 1)
			return
		endif
		set i = i - 1
	exitwhen i == 0
	endloop
	call SetTopMessageTextById(s, time, 1)
	//call BJDebugMsg("设置第一个")
endfunction

function MDX takes integer i, integer k returns nothing
	if (i == 34) then
		call B6X('h06K')
	elseif i =='u' then
		call SetAllPlayerAbilityUnavailable('A40O')
		call SetAllPlayerAbilityUnavailable('A40P')
		call SetAllPlayerAbilityUnavailable('A40Q')
		call SetAllPlayerAbilityUnavailable('A40R')
	elseif i == 16 then
		call SetAllPlayerAbilityUnavailable('A10U')
		call SetAllPlayerAbilityUnavailable('A11X')
	elseif i == 62 then
		call ExecuteFunc("MFX")
	elseif i == 83 then
		set IX = true
	elseif i =='o' then
		call ExecuteFunc("MGX")
	elseif (i == 38) then
		call ExecuteFunc("MHX")
	elseif (i == 31) then
		call ExecuteFunc("MJX")
	elseif (i == 8) then
		call ExecuteFunc("MKX")
		call ExecuteFunc("MLX")
	elseif (i == 3) then
		call ExecuteFunc("MMX")
	elseif (i == 95) then
		call ExecuteFunc("MPX")
	elseif (i == FB) then
		call ExecuteFunc("MQX")
	elseif i == 52 then
		call SetAllPlayerAbilityUnavailable('A30P')
	elseif i == 61 then
		call SetAllPlayerAbilityUnavailable('A419')
	elseif (i == 4) then
		// 变体精灵的变颜色
		// call ExecuteFunc("MSX")
		call ExecuteFunc("MTX")
	elseif (i == 18) then
		call ExecuteFunc("MUX")
		call ExecuteFunc("MWX")
	elseif i == 73 then
		call SetAllPlayerAbilityUnavailable('A30D')
		call SetAllPlayerAbilityUnavailable('A30E')
	elseif (i == 21) then
		// 神出鬼没
		call ExecuteFunc("MYX")
		// 预读技能
		call ExecuteFunc("MZX")
		call ExecuteFunc("RegisterPhantomLancerTrigger")
	elseif (i == 26) then
		call ExecuteFunc("M0X")
	elseif (i == CB) then
		call ExecuteFunc("M1X")
	elseif (i == 23) then
		// 地精工程师
		call ExecuteFunc("M2X")
		call ExecuteFunc("M3X")
	elseif (i == 75) then
		call ExecuteFunc("M4X")
	elseif (i == 59) then
		call ExecuteFunc("M5X")
		// 蜘蛛网
		call ExecuteFunc("M6X")
	elseif (i == 77) then
		call ExecuteFunc("M7X")
	elseif (i == 81) then
		call ExecuteFunc("M8X")
	elseif (i =='i') then
		call ExecuteFunc("M9X")
	elseif (i =='k') then
		call RegisterUnitAttackEvent("PVX", 0)
		call ExecuteFunc("PEX")
		// 灵魂超度
		set HaveVisage = true
		// call ExecuteFunc("PXX")
		call ExecuteFunc("POX")
	elseif (i == 79) then
		call ExecuteFunc("PRX")
	elseif (i == 85) then
		call ExecuteFunc("PIX")
		call ExecuteFunc("PAX")
	elseif (i == 86) then
		call ExecuteFunc("PNX")
	elseif (i == 33) then
		call ExecuteFunc("PBX")
	elseif (i == 88) then
		// 术士
		call ExecuteFunc("PCX")
		call ExecuteFunc("PDX")
		// 地狱火
		call ExecuteFunc("PFX")
	elseif i == 90 then
		call ExecuteFunc("PGX")
	elseif i == 71 then
		call ExecuteFunc("PHX")
	elseif i == 91 then
		call ExecuteFunc("PJX")
	elseif i == 44 then
		call ExecuteFunc("PhaseShiftOnInit")
	elseif i == 121 then
		set AX = true
		//elseif i == 98 then
		//	call ExecuteFunc("PLX")
	elseif i == 78 then
		call ExecuteFunc("PMX")
	elseif i == 72 then
		call ExecuteFunc("PPX")
	elseif i == 46 then
		call ExecuteFunc("PQX")
	elseif i == 47 then
		call ExecuteFunc("PSX")
	elseif i == 96 then
		call ExecuteFunc("PTX")
	elseif i == 97 then
		call ExecuteFunc("PUX")
	elseif i == 51 then
		call ExecuteFunc("PWX")
	elseif i == 49 then
		call ExecuteFunc("PYX")
	elseif i == 29 then
		call ExecuteFunc("PZX")
	elseif i == 50 then
		call ExecuteFunc("P_X")
	elseif i == 30 then
		call ExecuteFunc("CreatePrimalSplitTrigger")
	elseif i == 53 then
		call ExecuteFunc("P1X")
		call ExecuteFunc("P2X")
	elseif i == 54 then
		//	call ExecuteFunc("P3X")
		call ExecuteFunc("P4X")
	elseif i == 55 then
	elseif i == 56 then
		call ExecuteFunc("P5X")
	elseif i == 57 then
		call ExecuteFunc("P6X")
	endif
endfunction
function P7X takes player whichPlayer, string AXX returns nothing
	if IsPlayerInForce(LocalPlayer, VNX(whichPlayer)) then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 40, PlayersColoerText[GetPlayerId(whichPlayer)] +(PlayersName[GetPlayerId((whichPlayer))])+ "|r " + AXX)
	endif
endfunction
function P8X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	set IsChooseHeroEnd = true
	call CleanCurrentTrigger(t)
	call DestroyFogModifier(CreateFogModifierRadius(SentinelPlayers[0], FOG_OF_WAR_MASKED,-6950, 6750, 700, false, false))
	call DestroyFogModifier(CreateFogModifierRadius(ScourgePlayers[0], FOG_OF_WAR_MASKED,-6950, 6750, 700, false, false))
	set t = null
	return false
endfunction


function QEX takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='n00C' then
		call KillUnit(GetFilterUnit())
	endif
	return false
endfunction
function KillPlayerAllZoneIndicator takes player p returns nothing
	local group g = AllocationGroup(9)
	call GroupEnumUnitsOfPlayer(g, p, Condition(function QEX))
	call DeallocateGroup(g)
	set g = null
endfunction
function QOX takes nothing returns boolean
	return GetUnitTypeId(GetFilterUnit())=='ncop'
endfunction
function QRX takes nothing returns nothing
	if GKV then
		call UnitRemoveAbility(CirclesUnit[GetPlayerId(GetOwningPlayer(GetEnumUnit()))],'A14F')
		call UnitRemoveAbility(CirclesUnit[GetPlayerId(GetOwningPlayer(GetEnumUnit()))],'A14E')
		//call UnitRemoveAbility(CirclesUnit[GetPlayerId(GetOwningPlayer(GetEnumUnit()))],'A14H')
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A0I4') == 0 then
		call UnitAddAbility(GetEnumUnit(),'A0I4')
	endif
endfunction
function EnableCircle takes player p returns nothing
	local group g = AllocationGroup(10)
	call GroupEnumUnitsOfPlayer(g, p, Condition(function QOX))
	call ForGroup(g, function QRX)
	call DeallocateGroup(g)
	set g = null
endfunction
function QAX takes nothing returns nothing
	local integer i = 0
	local integer d = 0
	local multiboarditem mi
	local integer TQV = 0
	local string s = ""
	local real QNX = .12
	if SentinelUserCount != 0 then
		set i = 4 + ExtraSkillsNumber
		set d = 1
		loop
			set mi = MultiboardGetItem(JP, d, i)
			call MultiboardSetItemValue(mi, TM + PlayersColoerText[GetPlayerId(SentinelUsers[d])] + PlayersName[GetPlayerId(SentinelUsers[d])] + "|r")
			call MultiboardReleaseItem(mi)
			set d = d + 1
		exitwhen d == SentinelUserCount + 1
		endloop
	endif
	if ScourgeUserCount != 0 then
		set i = 4 + ExtraSkillsNumber
		set d = 2 + SentinelUserCount
		loop
			set mi = MultiboardGetItem(JP, d, i)
			call MultiboardSetItemValue(mi, TM + PlayersColoerText[GetPlayerId(ScourgeUsers[d -1 -SentinelUserCount])] + PlayersName[GetPlayerId(ScourgeUsers[d -1 -SentinelUserCount])] + "|r")
			set d = d + 1
			call MultiboardReleaseItem(mi)
		exitwhen d == SentinelUserCount + ScourgeUserCount + 2
		endloop
	endif
	set mi = null
endfunction
function QBX takes nothing returns nothing
	local integer i = 0
	local integer d = 0
	local multiboarditem mi
	local integer TQV = 0
	local string s = ""
	local real QNX = .12
	set JP = CreateMultiboard()
	set BJ_Multiboard = JP
	if LOD_DEBUGMODE then
		set SentinelUserCount = 5
		set ScourgeUserCount = 5
	endif
	call MultiboardSetRowCount(JP, 2 + SentinelUserCount + ScourgeUserCount)
	call MultiboardSetColumnCount(JP, 5 + ExtraSkillsNumber)
	call MultiboardSetItemsWidth(JP, .015)
	call MultiboardSetTitleText(JP, "-" + StringCase(EP, true))
	call MultiboardSetItemsStyle(JP, false, true)
	loop
		set mi = MultiboardGetItem(JP, 0, i)
		call MultiboardSetItemStyle(mi, true, false)
		if i == 0 then
			call MultiboardSetItemWidth(mi, QNX)
			call MultiboardSetItemValue(mi, "|c00ff0303近卫军团|r")
		endif
		call MultiboardReleaseItem(mi)
		set i = i + 1
	exitwhen i == MultiboardGetColumnCount(JP)
	endloop
	set i = 0
	loop
		set mi = MultiboardGetItem(JP, 1 + SentinelUserCount, i)
		call MultiboardSetItemStyle(mi, true, false)
		if i == 0 then
			call MultiboardSetItemWidth(mi, QNX)
			call MultiboardSetItemValue(mi, "|c0020c000天灾军团|r")
		endif
		call MultiboardReleaseItem(mi)
		set i = i + 1
	exitwhen i == MultiboardGetColumnCount(JP)
	endloop
	if SentinelUserCount != 0 then
		set i = 0
		set d = 1
		loop
			set mi = MultiboardGetItem(JP, d, i)
			if i ==(4 + ExtraSkillsNumber) then
				call MultiboardSetItemStyle(mi, true, false)
				call MultiboardSetItemWidth(mi, QNX)
				call MultiboardSetItemValue(mi, TM + PlayersColoerText[GetPlayerId((SentinelUsers[d]))] + PlayersName[GetPlayerId((SentinelUsers[d]))] + "|r")
			else
				call MultiboardSetItemStyle(mi, false, true)
				call MultiboardSetItemIcon(mi, HeroSkillsIcon[0])
			endif
			set i = i + 1
			if i >(5 + ExtraSkillsNumber) then
				set d = d + 1
				set i = 0
			endif
			call MultiboardReleaseItem(mi)
		exitwhen d == SentinelUserCount + 1
		endloop
	endif
	if ScourgeUserCount != 0 then
		set i = 0
		set d = 2 + SentinelUserCount
		loop
			set mi = MultiboardGetItem(JP, d, i)
			if i == 4 + ExtraSkillsNumber then
				call MultiboardSetItemStyle(mi, true, false)
				call MultiboardSetItemWidth(mi, QNX)
				call MultiboardSetItemValue(mi, TM + PlayersColoerText[GetPlayerId((ScourgeUsers[d -1 -SentinelUserCount]))] + PlayersName[GetPlayerId((ScourgeUsers[d -1 -SentinelUserCount]))] + "|r")
			else
				call MultiboardSetItemStyle(mi, false, true)
				call MultiboardSetItemIcon(mi, HeroSkillsIcon[0])
			endif
			set i = i + 1
			if i >(5 + ExtraSkillsNumber) then
				set d = d + 1
				set i = 0
			endif
			call MultiboardReleaseItem(mi)
		exitwhen d == SentinelUserCount + ScourgeUserCount + 2
		endloop
	endif
	call MultiboardMinimize(JP, false)
	call MultiboardDisplay(JP, true)
	set mi = null
endfunction
function AddHeroSkills takes unit u, player p returns nothing
	local integer WWV = GetPlayerId(p)
	local integer xx = 0
	local integer QDX
	local integer QFX
	local integer id
	set xx = 1
	loop
		if PlayerSkillIndex[WWV * HL + xx]!= 0 then
			set QFX = PlayerSkillIndex[WWV * HL + xx]
			set id = HeroCommonSkills[QFX]
			set QDX = HeroChangeAbilitySkills[QFX]
			call UnitAddPermanentAbility(u, QDX)
			call SetPlayerAbilityAvailable(p, QDX, false)
		endif
		set xx = xx + 1
	exitwhen xx > 4
	endloop
endfunction
function QGX takes integer id returns integer
	local integer k
	if id =='A343' then
		call PreloadAbility('A0Z6')
	endif
	if id =='A40B' then
		return'A083'
	endif
	if id =='A0FU' then
		return'QF00'
	endif
	if id =='A0KX' then
		return'QF87'
	endif
	if id =='A0OO' then
		return'A302'
	endif
	if id =='A0LV' then
		return'A46A'
	endif
	if id =='Q0BK' then
		return'QP29'
	endif
	if id =='QF88'then
		return'A0VC'
	endif
	if id =='A46E' then
		return'A46D'
	endif
	set k = WBE(id)
	if k > 0 and PassiveSkills_Show[k]> 0 then
		return PassiveSkills_Show[k]
	endif
	return id
endfunction
function QHX takes integer i returns string
	if i == 1 then
		return"|c000042FFblue"
	elseif i == 2 then
		return"|c001ce6b9teal"
	elseif i == 3 then
		return"|c00540081purple"
	elseif i == 4 then
		return"|c00fffc01yellow"
	elseif i == 5 then
		return"|c00ff8000orange"
	elseif i == 7 then
		return"|c00e55bb0pink"
	elseif i == 8 then
		return"|c00959697gray"
	elseif i == 9 then
		return"|c007ebff1lightblue"
	elseif i == 10 then
		return"|c00106246darkgreen"
	elseif i == 11 then
		return"|c004e2a04brown"
	endif
	return""
endfunction

function SetAbilityStringByMode takes unit u, integer id returns nothing
	if id == 'QP24' then
		if Mode__BalanceOff and Mode__RearmCombos then
			call YDWESetUnitAbilityDataString(u, id, 1, 218, "有25%的概率连续施展两次法术|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call YDWESetUnitAbilityDataString(u, id, 2, 218, "有40%的概率连续施展两次法术；有20%的概率连续施展三次法术|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call YDWESetUnitAbilityDataString(u, id, 3, 218, "有50%的概率连续施展两次法术；有25%的概率连续施展三次法术；有12.5%的概率连续施展四次法术|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			set id = 'A088'
			call UnitAddAbility(u, id)
			call YDWESetUnitAbilityDataString(u, id, 1, 217, "狗运让菊花能更快更有效地使用技能。|n|n|cffffcc00等级 1|r - 25%概率x2|n|cffffcc00等级 2|r - 40%概率x2，20%概率x3|n|cffffcc00等级 3|r - 50%概率x2，25%概率x3，12.5%概率x4|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call UnitRemoveAbility(u, id)
		elseif Mode__BalanceOff and not Mode__RearmCombos then
			call YDWESetUnitAbilityDataString(u, id, 1, 218, "有25%的概率连续施展两次法术|n|n成功狗运时，魔法会额外消耗|cffff0303 50% |r|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call YDWESetUnitAbilityDataString(u, id, 2, 218, "有40%的概率连续施展两次法术；有20%的概率连续施展三次法术|n|n成功狗运时，魔法会额外消耗|cffff0303 75% |r|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call YDWESetUnitAbilityDataString(u, id, 3, 218, "有50%的概率连续施展两次法术；有25%的概率连续施展三次法术；有12.5%的概率连续施展四次法术|n|n成功狗运时，魔法会额外消耗|cffff0303 100% |r|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			set id = 'A088'
			call UnitAddAbility(u, id)
			call YDWESetUnitAbilityDataString(u, id, 1, 217, "狗运让菊花能更快更有效地使用技能。|n|n成功狗运时，魔法会额外消耗|cffff0303 50%/75%/100%|r|n|n|cffffcc00等级 1|r - 25%概率x2|n|cffffcc00等级 2|r - 40%概率x2，20%概率x3|n|cffffcc00等级 3|r - 50%概率x2，25%概率x3，12.5%概率x4|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call UnitRemoveAbility(u, id)
		elseif not Mode__BalanceOff and Mode__RearmCombos then
			call YDWESetUnitAbilityDataString(u, id, 1, 218, "有18%的概率连续施展两次法术|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call YDWESetUnitAbilityDataString(u, id, 2, 218, "有29.5%的概率连续施展两次法术；有13%的概率连续施展三次法术|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call YDWESetUnitAbilityDataString(u, id, 3, 218, "有39.5%的概率连续施展两次法术；有14.5%的概率连续施展三次法术；有5.5%的概率连续施展四次法术|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			set id = 'A088'
			call UnitAddAbility(u, id)
			call YDWESetUnitAbilityDataString(u, id, 1, 217, "狗运让菊花能更快更有效地使用技能。|n|n|cffffcc00等级 1|r - 18%概率x2|n|cffffcc00等级 2|r - 29.5%概率x2，13%概率x3|n|cffffcc00等级 3|r - 39.5%概率x2，14.5%概率x3，5.5%概率x4|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call UnitRemoveAbility(u, id)
		endif
	endif
endfunction

function PlayerPickHero takes unit u, integer playerId, unit QKX returns nothing//酒馆英雄添加技能时
	local integer heroIndex =(GetUnitPointValue(u)* 4)-4
	local integer xx = 0
	local integer teamId
	local integer TXE = heroIndex + 1
	local integer TOE = heroIndex + 2
	local integer QMX = heroIndex + 3
	local integer QPX = heroIndex + 4
	local integer tempAbilityId = 0
	local integer array QSX
	local boolean QTX = true
	local integer unitTypeId = GetUnitTypeId(u)
	local player whichPlayer = Player(playerId)
	set QSX[1]= heroIndex + 1
	set QSX[2]= heroIndex + 2
	set QSX[3]= heroIndex + 3
	set QSX[4]= heroIndex + 4
	set MP[playerId]= GetUnitPointValue(u)
	call RemoveUnit(u)
	call SetPlayerState( whichPlayer , PLAYER_STATE_RESOURCE_GOLD, GetPlayerState( whichPlayer , PLAYER_STATE_RESOURCE_GOLD)+ 250 )
	if GKV or HOV then
		set QTX = LoadBoolean(HY, GetHandleId( whichPlayer ), unitTypeId)
		if not QTX then
			call UVE( whichPlayer , true, "这些是你友军的技能，你无法选择他们。你的技能在 " + QHX(playerId)+ "|c006699CC 酒馆|r")
		endif
	endif
	call FlushChildHashtable(HY, GetHandleId(KP[playerId]))
	call RemoveUnit(KP[playerId])
	set KP[playerId]= CreateUnit( whichPlayer ,'hfoo', GetRectMaxX(bj_mapInitialPlayableArea), GetRectMinY(bj_mapInitialPlayableArea), .0)
	call SaveUnitHandle(HY, GetHandleId(KP[playerId]), 0, QKX)
	if LOD_DEBUGMODE then
		call DisplayTimedTextToPlayer(LocalPlayer, .0, .0, 20., "Hero Number: " + I2S(GetUnitPointValue(u)))
		call DisplayTimedTextToPlayer(LocalPlayer, .0, .0, 20., "Skill #1 number: " + I2S(TXE))
		call DisplayTimedTextToPlayer(LocalPlayer, .0, .0, 20., "Skill #2 number: " + I2S(TOE))
		call DisplayTimedTextToPlayer(LocalPlayer, .0, .0, 20., "Skill #3 number: " + I2S(QMX))
		call DisplayTimedTextToPlayer(LocalPlayer, .0, .0, 20., "Skill #4 number: " + I2S(QPX))
	endif
	if IsSentinelPlayer( whichPlayer ) then
		set teamId = 1
	else
		set teamId = 2
	endif
	set xx = 1
	loop
		if IsDisabledSkill[heroIndex + xx]== false then
			set tempAbilityId = HeroCommonSkills[heroIndex + xx]
			set tempAbilityId = QGX(tempAbilityId)
			call UnitAddAbility(KP[playerId], tempAbilityId)
			if not IsPassiveSkill[heroIndex + xx] and HeroUpgradeSkills[heroIndex + xx] != 0 then
				// 预读神杖技能
				call UnitAddAbility(KP[playerId], HeroUpgradeSkills[heroIndex + xx])
				call UnitRemoveAbility(KP[playerId], HeroUpgradeSkills[heroIndex + xx])
				//call SingleDebug( "预读 " + I2S(xx) + " 号神杖升级技能 " + GetObjectName( HeroUpgradeSkills[heroIndex + xx] ) )
			endif
			//if not Mode__RearmCombos then
			call SetAbilityStringByMode(KP[playerId], tempAbilityId) 	//根据模式更改技能文本
			//endif
			call SetUnitAbilityLevel(KP[playerId], tempAbilityId, 4)
			if CheckAbilityIdFormIndex(heroIndex + xx,-1, "melee only", null) then
				call UnitAddAbility(KP[playerId],'Z020'+ xx -1)
			elseif CheckAbilityIdFormIndex(heroIndex + xx,-1, "range only", null) then
				call UnitAddAbility(KP[playerId],'Z024'+ xx -1)
			elseif CheckAbilityIdFormIndex(heroIndex + xx,-1, "melee morph", null) then
				call UnitAddAbility(KP[playerId],'Z030'+ xx -1)
			elseif CheckAbilityIdFormIndex(heroIndex + xx,-1, "range morph", null) then
				call UnitAddAbility(KP[playerId],'Z034'+ xx -1)
			endif
			if QTX then
				if ( not IsPlayerHasSkill( whichPlayer , QSX[xx]) ) then
					if HVV then
						if XP[teamId * OP + QSX[xx]]== 0 then
							call UnitAddAbility(KP[playerId],'Z000'+ xx -1)
						else
							call UnitAddAbility(KP[playerId],'Z010'+ xx -1)
						endif
					else
						call UnitAddAbility(KP[playerId],'Z000'+ xx -1)
					endif
				else
					call UnitAddAbility(KP[playerId],'Z004'+ xx -1)
				endif
			else
				call UnitAddAbility(KP[playerId],'Z01A'+ xx -1)
			endif
		else
			if QTX then
				call UnitRemoveAbility(KP[playerId],'Z000'-1 + xx)
				call UnitAddAbility(KP[playerId],'Z014'-1 + xx)
			endif
		endif
		set xx = xx + 1
	exitwhen xx > 4
	endloop
	call ClearSelectionForPlayer( whichPlayer )
	call SelectUnitAddForPlayer(KP[playerId],  whichPlayer )
endfunction
function QUX takes nothing returns nothing
	call MultiboardDisplay(MainMultiboard, false)
	call QBX()
	call SuspendTimeOfDay(true)
	call DisableTrigger(hChooseHeroTrigger)
endfunction

// 封装的添加经验
function AddHeroXPSimple takes unit whichHero, integer xpToAdd, boolean showEyeCandy returns nothing
	if Mode__EasyMode then
		set xpToAdd = R2I(xpToAdd * 1.5)
	endif
	call AddHeroXP(whichHero, xpToAdd, showEyeCandy )
endfunction

function QWX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	local integer level = LoadInteger(HY, GetHandleId(t), 0)
	if level > 0 then
		call SetHeroLevel(u, GetHeroLevel(u)+ 1, LoadBoolean(HY, GetHandleId(t), 0))
		call SaveInteger(HY, GetHandleId(t), 0, level -1)
	else
		call AddHeroXP(u, IMaxBJ(LoadInteger(HY, GetHandleId(t), 1)-GetHeroXP(u), 0), LoadBoolean(HY, GetHandleId(t), 0))
		call DestroyTimerAndFlushHT_HY(t)
	endif
	set u = null
	set t = null
endfunction

// 设置到某个等级后还再设置一次经验值
function SetHeroLevelAndXP takes unit u, integer level, boolean QZX, integer xp returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .01, true, function QWX)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveInteger(HY, GetHandleId(t), 0, level)
	call SaveInteger(HY, GetHandleId(t), 1, xp)
	call SaveBoolean(HY, GetHandleId(t), 0, QZX)
	set t = null
endfunction

function Click_CheckBox_Nothing takes player p, integer i returns nothing
	if LocalPlayer == p then
		set IsMenuOptionCheckBoxEnabled[i] = not IsMenuOptionCheckBoxEnabled[i]
		call DzFrameShow(OptionCheckBoxsHighLight[i], IsMenuOptionCheckBoxEnabled[i])
	endif
endfunction

function Set_CheckBox_Nothing takes player p, integer i , boolean b returns nothing
	if LocalPlayer == p then
		set IsMenuOptionCheckBoxEnabled[i] = b
		call DzFrameShow(OptionCheckBoxsHighLight[i], IsMenuOptionCheckBoxEnabled[i])
	endif
endfunction


function ShowAbilityCd_Actions takes player p, boolean isOrder returns nothing
	local integer i = GetPlayerId(p)
	local boolean b
	if not isOrder then
		set b = SPCDB[i]
		set SPCDB[i] = not b
	else
		set b = not SPCDB[i]
	endif
	if not isOrder then
		if p == LocalPlayer then
			call GetSetupText("隐藏有冷却被动技能", not b)
		endif
	endif
	if IsPickingHero then
		return
	endif
	call SetPlayerAbilityAvailable(p,'QP17', b)	//反击螺旋
	
	call SetPlayerAbilityAvailable(p,'A522', b) //水刀
	
	call SetPlayerAbilityAvailable(p,'QP1G', b) //余震
	
	call SetPlayerAbilityAvailable(p,'QP1O', b) //勇气之霎
	
	call SetPlayerAbilityAvailable(p,'A3UF', b) //天幕坠落
endfunction

function Q_X takes player p, boolean isOrder returns nothing
	local integer i = 1
	local integer k
	local boolean b
	if not isOrder then
		set b = XD[GetPlayerId(p)]
		set XD[GetPlayerId(p)] = not b
	else
		set b = not XD[GetPlayerId(p)]
	endif
	if not isOrder then
		if p == LocalPlayer then
			call GetSetupText("隐藏被动技能", not b)
		endif
	endif
	if IsPickingHero then
		return
	endif
	loop
		call SetPlayerAbilityAvailable(p, PassiveSkills_Show[i], b)
		set i = i + 1
	exitwhen i > PassiveAbilityMaxCount
	endloop
	if SPCDB[GetPlayerId(p)] then
		call SetPlayerAbilityAvailable(p,'QP1O', false)
		call SetPlayerAbilityAvailable(p,'QP17', false)
		call SetPlayerAbilityAvailable(p,'QP1G', false)
	else
		call SetPlayerAbilityAvailable(p,'QP1O', true)
		call SetPlayerAbilityAvailable(p,'QP17', true)
		call SetPlayerAbilityAvailable(p,'QP1G', true)
	endif
	
	//	call SetPlayerAbilityAvailable(p,'A10S', b)
	
	call SetPlayerAbilityAvailable(p,'A0CQ', b)
	call SetPlayerAbilityAvailable(p,'A1IQ', b)
	call SetPlayerAbilityAvailable(p,'A0BM', b)
	call SetPlayerAbilityAvailable(p,'A46D', b)
	call SetPlayerAbilityAvailable(p,'A1O8', b)
	call SetPlayerAbilityAvailable(p,'A1O7', b)
	call SetPlayerAbilityAvailable(p,'A1O6', b)
	call SetPlayerAbilityAvailable(p,'A1O3', b)
	call SetPlayerAbilityAvailable(p,'A1O2', b)
	call SetPlayerAbilityAvailable(p,'A1O1', b)
	call SetPlayerAbilityAvailable(p,'A1O0', b)
	call SetPlayerAbilityAvailable(p,'A1NZ', b)
	call SetPlayerAbilityAvailable(p,'A1NY', b)
	call SetPlayerAbilityAvailable(p,'A1N9', b)
endfunction
function Q1X takes nothing returns nothing
	if GetUnitTypeId(GetFilterUnit())=='ntav' then
		if IsSentinelPlayer(GetOwningPlayer(GetFilterUnit())) then
			call A8X(ScourgePlayers[0], 1, GetUnitX(GetFilterUnit()), GetUnitY(GetFilterUnit()), 400)
		else
			call A8X(SentinelPlayers[0], 1, GetUnitX(GetFilterUnit()), GetUnitY(GetFilterUnit()), 400)
		endif
		call UnitRemoveAbility(GetFilterUnit(),'A1HX')
		call ShowUnit(GetFilterUnit(), false)
	elseif GetUnitTypeId(GetFilterUnit())=='n12C' then
		if LocalPlayer== GetOwningPlayer(GetFilterUnit()) then
			call SetUnitVertexColor(GetFilterUnit(), 255, 255, 255, 0)
		endif
	endif
endfunction
function HidePlayerTavern takes player p returns nothing
	local group g = AllocationGroup(11)
	call GroupEnumUnitsOfPlayer(g, p, Condition(function Q1X))
	call DeallocateGroup(g)
	set g = null
endfunction
function SyncHeroItems takes unit source, unit to returns nothing
	call UnitAddItem(to, UnitItemInSlot(source, 0))
	call UnitAddItem(to, UnitItemInSlot(source, 1))
	call UnitAddItem(to, UnitItemInSlot(source, 2))
	call UnitAddItem(to, UnitItemInSlot(source, 3))
	call UnitAddItem(to, UnitItemInSlot(source, 4))
	call UnitAddItem(to, UnitItemInSlot(source, 5))
endfunction
// 选择了一个英雄
function PlayerChooseHeroUnit takes unit whichUnit returns boolean
	local player whichPlayer = GetOwningPlayer(whichUnit)
	local real x
	local real y
	local region r = null
	local trigger t
	local integer loop_i
	local integer playerId = GetPlayerId(whichPlayer)
	local integer id
	local string message = ""
	set r = CreateRegion()
	if LOD_DEBUGMODE then // 如果是debug模式 就满级满钱
		call SetHeroLevel(whichUnit, 25, false)
		call SetPlayerState(whichPlayer, PLAYER_STATE_RESOURCE_GOLD, 100000)
	endif
	// debug call SingleDebug( GetUnitName( whichUnit ) + " 已入场" )
	// 禁用两个光法的技能和战争咆哮
	call SetPlayerAbilityAvailable(whichPlayer,'A11X', false)
	call SetPlayerAbilityAvailable(whichPlayer,'A10U', false)
	call SetPlayerAbilityAvailable(whichPlayer,'A34C', false)
	call SetPlayerAbilityAvailable(whichPlayer,'A344', false)
	//========================================================================
	// 似乎是添加工程升级技能 让其可以学习?
	if MainModeName =="ap" then
		call AddHeroSkills(whichUnit, whichPlayer)
	elseif MainModeName =="sd" then
		call AddHeroSkills(whichUnit, whichPlayer)
	elseif MainModeName =="md" then
		call AddHeroSkills(whichUnit, whichPlayer)
	elseif MainModeName =="ar" then // 全部随机 特殊处理
		call SaveUnitHandle(HY,'hRUT', 1, whichUnit)
		call ExecuteFunc("Q7X")
		call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 15, "|cff99ccff你的技能:|r")
		set loop_i = 1
		set message = GetPlayerName(whichPlayer)+ ": "
		loop
			set id = PlayerSkillIndex[playerId * HL + loop_i]
			if id > 600 then
				call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 15, "	" + GetObjectName(HeroCommonSkills[id])+ "|cffffcc00 (Invoker)|r")
			else
				if loop_i == 4 or loop_i == 6 then
					call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 15, "	" + "|c00ff0303" + GetObjectName(HeroCommonSkills[id])+ "|r" + "|cffffcc00" + " (" + GetObjectName(HeroListTypeId[(id + 3)/ 4])+ ")" + "|r")
					set message = message + GetObjectName(HeroCommonSkills[id])+ ", "
				else
					call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 15, "	" + GetObjectName(HeroCommonSkills[id])+ "|cffffcc00" + " (" + GetObjectName(HeroListTypeId[(id + 3)/ 4])+ ")" + "|r")
					set message = message + GetObjectName(HeroCommonSkills[id])+ ", "
				endif
			endif
			set loop_i = loop_i + 1
		exitwhen loop_i > 4 + ExtraSkillsNumber
		endloop
	elseif MainModeName =="rd"then // 随机征召 rd ? 憨批模式罢了 不好维护
		call AddHeroSkills(whichUnit, whichPlayer)
		call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 15, "|cff99ccff你的技能:|r")
		set loop_i = 1
		loop
			set id = PlayerSkillIndex[playerId * HL + loop_i]
			if loop_i == 4 or loop_i == 6 then
				call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 15, "	" + "|c00ff0303" + GetObjectName(HeroCommonSkills[id])+ "|r" + "|cffffcc00" + " (" + GetObjectName(HeroListTypeId[(id + 3)/ 4])+ ")" + "|r")
			else
				call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 15, "	" + GetObjectName(HeroCommonSkills[id])+ "|cffffcc00" + " (" + GetObjectName(HeroListTypeId[(id + 3)/ 4])+ ")" + "|r")
			endif
			set loop_i = loop_i + 1
		exitwhen loop_i > 4 + ExtraSkillsNumber
		endloop
	endif
	//========================================================================

	if not Mode__DeathMatch then
		call KTX(whichPlayer)
	endif
	// 如果所有人都选择了英雄 7秒后移除酒馆视野
	if not IsChooseHeroEnd and(Player__Hero[GetPlayerId(SentinelPlayers[1])]!= null and Player__Hero[GetPlayerId(SentinelPlayers[2])]!= null and Player__Hero[GetPlayerId(SentinelPlayers[3])]!= null and Player__Hero[GetPlayerId(SentinelPlayers[4])]!= null and Player__Hero[GetPlayerId(SentinelPlayers[5])]!= null and Player__Hero[GetPlayerId(ScourgePlayers[1])]!= null and Player__Hero[GetPlayerId(ScourgePlayers[2])]!= null and Player__Hero[GetPlayerId(ScourgePlayers[3])]!= null and Player__Hero[GetPlayerId(ScourgePlayers[4])]!= null and Player__Hero[GetPlayerId(ScourgePlayers[5])]!= null) then
		set t = CreateTrigger()
		call TriggerRegisterTimerEvent(t, 7, false)
		call TriggerAddCondition(t, Condition(function P8X))
		set t = null
	endif
	set M2[GetPlayerId(GetOwningPlayer((whichUnit)))]= false

	call RegionAddRect(r, Rect(-7584., 6176.,-6304., 7552.))
	// 如果是在泉水? 设置下随机位置
	if IsSentinelPlayer(whichPlayer) then
		if IsUnitInRegion(r, whichUnit) then
			set x = GetRandomReal(GetRectMinX(gg_rct_SentinelRevivalPoint), GetRectMaxX(gg_rct_SentinelRevivalPoint))
			set y = GetRandomReal(GetRectMinY(gg_rct_SentinelRevivalPoint), GetRectMaxY(gg_rct_SentinelRevivalPoint))
		else
			set x = GetUnitX(whichUnit)
			set y = GetUnitY(whichUnit)
		endif
	else
		if IsUnitInRegion(r, whichUnit) then
			set x = GetRandomReal(GetRectMinX(gg_rct_ScourgeRevivalPoint), GetRectMaxX(gg_rct_ScourgeRevivalPoint))
			set y = GetRandomReal(GetRectMinY(gg_rct_ScourgeRevivalPoint), GetRectMaxY(gg_rct_ScourgeRevivalPoint))
		else
			set x = GetUnitX(whichUnit)
			set y = GetUnitY(whichUnit)
		endif
	endif

	set AY[playerId]= true
	// GVJ = rd   v4不知道什么东西
	if not GJV and not V4 then
		call PanCameraToTimedForPlayer(whichPlayer, x, y, 0)
	endif
	call ClearSelectionForPlayer(whichPlayer)
	call SelectUnitAddForPlayer(whichUnit, whichPlayer)
	call SetUnitX(whichUnit, x)
	call SetUnitY(whichUnit, y)
	set Player__Hero[playerId]= whichUnit
	set PlayerHeroTypeId[playerId]= GetUnitTypeId(whichUnit)
	call SaveInteger(HY, playerId,'hHid', GetUnitPointValue(whichUnit))
	call StoreDrCacheDataToPlayer(whichPlayer, "9", PlayerHeroTypeId[playerId])
	call XUX(whichPlayer) // 设置科技 意味不明
	call SaveBoolean(HY,(GetHandleId(whichUnit)), 85,(true))
	
	if not PW and not IsPickingHero and not X3 then
		set YQ[GetUnitPointValue(whichUnit)]= true
		set ZQ[GetUnitPointValue(whichUnit)]= true
		call XSX(GetUnitTypeId(whichUnit))
	endif

	// 死亡竞赛的特殊操作
	if Mode__DeathMatch then
		call L8X(whichUnit) // 刷新一下单位?
		// 分开判断两个队伍稳妥点
		if IsSentinelPlayer(whichPlayer) then // 如果单位复活 那就增加生命值
			set TeamHeroUseLivesCount[0]= TeamHeroUseLivesCount[0] + 1
		endif
		if IsScourgePlayer(whichPlayer) then
			set TeamHeroUseLivesCount[1]= TeamHeroUseLivesCount[1] + 1
		endif
		set PlayerHeroReincarnCount[playerId]= PlayerHeroReincarnCount[playerId] + 1
		if PlayerHeroReincarnCount[playerId]> 1 and whichUnit != OW[playerId] then
			// 似乎是为了同步血精石充能 但没写完
			call MIX(OW[playerId])
			// 同步单位等级
			call SetHeroLevelAndXP(whichUnit, GetHeroLevel(OW[playerId])-1, false, GetHeroXP(OW[playerId]))
			// 同步英雄物品
			call SyncHeroItems(OW[playerId], whichUnit)
			set ZQ[GetUnitPointValue(OW[playerId])]= false

			// 分开判断两个队伍稳妥点
			if IsSentinelPlayer(whichPlayer) then
				call FlushChildHashtable(ObjectHashTable,'SPL0'+ playerId)
			endif
			if IsScourgePlayer(whichPlayer) then
				call FlushChildHashtable(ObjectHashTable,'SPLH'+ playerId)
			endif
			// 移除上一个英雄
			call EXRemoveHero(OW[playerId])
		endif
	endif

	if not Mode__SameHero or whichPlayer == HostPlayer then
		if (KS[playerId]and not Mode__SameHero) then
			call P7X(whichPlayer, GetObjectName('n0D5')+ " " + GetUnitName(whichUnit)+ ".")
		elseif ((FT[playerId]and not Mode__DeathMatch ) or VT or OT) then
			call P7X(whichPlayer, GetObjectName('n0D3')+ " " + GetUnitName(whichUnit)+ ".")
		else
			call P7X(whichPlayer, GetObjectName('n0D2')+ " " + GetUnitName(whichUnit)+ ".")
		endif
	endif
	
	if IsNoHeroLimit then // 移除区域指示器 推测是英雄购买者
		call KillPlayerAllZoneIndicator(whichPlayer)
	endif
	if (GJV or V4) and IsNoHeroLimit then
		call KillPlayerAllZoneIndicator(whichPlayer)
	endif
	// 让能量圈可用
	call EnableCircle(whichPlayer)

	set IN[playerId]= true // 吞噬技能提示
	if GetUnitAbilityLevel(whichUnit,'Y253')> 0 then
		call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 15, "|c00ff0000通过吞噬技能获得的被动将会自动隐藏。|r")
	endif

	// 被动晕眩技能提示
	if IsPlayerHasSkill(whichPlayer, 311) or IsPlayerHasSkill(whichPlayer, 263) or IsPlayerHasSkill(whichPlayer, 275) then
		call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 10., " ")
		call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 10., "|c00ff0303" + GetObjectName('n0G3')+ "|r")
	endif
	if not HaveSavedBoolean(HY, 600 + GetUnitPointValue(whichUnit), 87) then
		call SaveBoolean(HY,(600 + GetUnitPointValue(whichUnit)), 87,(true))
	endif
	// 设置英雄名称
	if not NeedHideHeroNames[LocalPlayerId] then
		call SetPlayerName(whichPlayer,(PlayersName[playerId])+ " (" + EJX(Player__Hero[playerId])+ ")")
	endif
	if HOV or GKV then
		call HidePlayerTavern(whichPlayer)
	endif
	call KVX(whichUnit) // 同步决斗的额外攻击力
	call RemoveRegion(r)
	set r = null
	//set whichUnit = null
	set whichPlayer = null
	set t = null
	return false
endfunction

function Q8X takes nothing returns boolean
	return((IsUnitType(GetSoldUnit(), UNIT_TYPE_HERO)))
endfunction

function Q9X takes nothing returns nothing
	local unit trigUnit = GetSoldUnit()
	local unit QKX = GetSellingUnit()
	local player p = GetOwningPlayer(trigUnit)
	if IsPickingHero then
		call PlayerPickHero(trigUnit, GetPlayerId(p), QKX)
		return
	endif
	call XUX(p)
	set trigUnit = null
	set QKX = null
endfunction
function AddGoldForIntervalActions takes nothing returns boolean
	local integer gold = 1
	if Mode__EasyMode then
		set gold = 2
	endif
	call SetPlayerState(SentinelPlayers[1], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(SentinelPlayers[1], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	call SetPlayerState(SentinelPlayers[2], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(SentinelPlayers[2], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	call SetPlayerState(SentinelPlayers[3], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(SentinelPlayers[3], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	call SetPlayerState(SentinelPlayers[4], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(SentinelPlayers[4], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	call SetPlayerState(SentinelPlayers[5], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(SentinelPlayers[5], PLAYER_STATE_RESOURCE_GOLD)+ gold)

	call SetPlayerState(ScourgePlayers[1], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(ScourgePlayers[1], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	call SetPlayerState(ScourgePlayers[2], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(ScourgePlayers[2], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	call SetPlayerState(ScourgePlayers[3], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(ScourgePlayers[3], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	call SetPlayerState(ScourgePlayers[4], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(ScourgePlayers[4], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	call SetPlayerState(ScourgePlayers[5], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(ScourgePlayers[5], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	return false
endfunction
function SEX takes nothing returns nothing
	local integer IMX = R2I(GetGameTime()-PickModeElapsed)
	local integer minute = IMX / 60 -1 / 2
	local integer second = ModuloInteger(IMX, 60)
	if B3 then
		call SetResourceBarTime(minute, second, false)
	elseif A3 == false then
		set IMX = R2I(16 -GetGameTime())
		set minute = IMX / 60 -1 / 2
		set second = ModuloInteger(IMX, 60)
		call SetResourceBarTime(minute, second, true)
	endif
	set QS = minute
	set TS = second
endfunction

function HideMianbanCoolDownTimer takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 1)
	local integer id = LoadInteger(HY, h, 2)
	local integer pid = GetPlayerId(GetOwningPlayer(u))
	local integer TPE = PlayerSkillIndex[pid * HL + 4]
	local real cd = YDWEGetUnitAbilityState(u, id, 1)
	if id == HeroCommonSkills[TPE]or(HeroUpgradeSkills[TPE]!= null and id == HeroUpgradeSkills[TPE]) then
		call TimerStart(ESV[pid], cd, false, null)
	elseif Mode__SixSkills then
		call TimerStart(ETV[pid], cd, false, null)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set u = null
	set t = null
endfunction

function HideMianbanCoolDown takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 1, GetTriggerUnit())
	call SaveInteger(HY, h, 2, GetSpellAbilityId())
	call TriggerRegisterTimerEvent(t, 0.0, false)
	call TriggerAddCondition(t, Condition(function HideMianbanCoolDownTimer))
	set t = null
endfunction
function SXX takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local integer id = GetSpellAbilityId()
	local integer pid = GetPlayerId(GetOwningPlayer(whichUnit))
	local integer TPE = PlayerSkillIndex[pid * HL + 4]
	local real cd = 0.00
	if id =='A02W' then
		call TimerStart(ESV[pid], 0, false, null)
		call TimerStart(ETV[pid], 0, false, null)
	elseif IsUnitType(whichUnit, UNIT_TYPE_HERO) and IsUltimateSkill(id) then
		set cd = YDWEGetUnitAbilityDataReal(whichUnit, id, GetUnitAbilityLevel(whichUnit, id), 105)
		if cd > 0 then
			call HideMianbanCoolDown()
		endif
	endif
	set whichUnit = null
endfunction
function SOX takes nothing returns nothing
	local integer i = 0
	loop
	exitwhen(i > 13)
		set ESV[i]= CreateTimer()
		set ETV[i]= CreateTimer()
		set E[i]= CreateUnit(Player(i),'e00E', 0, 0, 0)
		set i = i + 1
	endloop
endfunction
function SRX takes nothing returns boolean
	local player p
	local integer i
	local integer id
	local integer g
	set i = 1
	loop
	exitwhen i > 5
		set p = SentinelPlayers[i]
		set id = GetPlayerId(p)
		set g = GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)
		if g < PlayersReliableGold[id] then
			set PlayersReliableGold[id]= g
		endif
		set p = ScourgePlayers[i]
		set id = GetPlayerId(p)
		set g = GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)
		if g < PlayersReliableGold[id] then
			set PlayersReliableGold[id]= g
		endif
		set i = i + 1
	endloop
	return false
endfunction
function SIX takes integer whichUnit, integer targetUnit returns boolean
	local integer i = AssistListCurrentMaxNumber -1
	local real SAX = 0
	local real ECX =(GetGameTime())
	local integer count = 0
	loop
	exitwhen i == AssistListCurrentMaxNumber or SAX > E0V or count > 200
		if i == 0 then
			set i = 8000 -1
		endif
		set count = count + 1
		set SAX = ECX -AssistListTime[i]
		if AssistListSourcePlayerId[i]== whichUnit and AssistListTargetPlayerId[i]== targetUnit and SAX < E0V then
			set AssistListSourcePlayerId[i]= 0
			set AssistListTargetPlayerId[i]= 0
			return true
		endif
		set i = i -1
	endloop
	return false
endfunction
function SNX takes integer whichUnit, integer targetUnit returns boolean
	local integer i = AssistListCurrentMaxNumber -1
	local real SAX = 0
	local real ECX =(GetGameTime())
	local integer count = 0
	loop
	exitwhen i == AssistListCurrentMaxNumber or SAX > E0V or count > 200
		if i == 0 then
			set i = 8000 -1
		endif
		set count = count + 1
		set SAX = ECX -AssistListTime[i]
		if AssistListSourcePlayerId[i]== whichUnit and AssistListTargetPlayerId[i]== targetUnit and SAX < E0V then
			return true
		endif
		set i = i -1
	endloop
	return false
endfunction

function SCX takes unit SDX, unit SFX returns string
	local integer i = 1
	local integer SGX = GetPlayerId(GetOwningPlayer(SDX))
	local integer SHX = GetPlayerId(GetOwningPlayer(SFX))
	local integer BOX
	local string SJX = " " + GetObjectName('n0JY')+ " "
	local boolean SKX = false
	loop
	exitwhen i > 5
		if IsSentinelPlayer(GetOwningPlayer(SFX)) then
			set BOX = GetPlayerId(SentinelPlayers[i])
		else
			set BOX = GetPlayerId(ScourgePlayers[i])
		endif
		if SHX != BOX and SIX(BOX, SGX) then
			set PlayerAssistCount[BOX]= PlayerAssistCount[BOX] + 1
			call StoreDrCacheData("Assist" + I2S(BOX), SGX)
			if SKX then
				set SJX = SJX + "/" + PlayersColoerText[BOX] +(PlayersName[GetPlayerId((Player(BOX)))])+ "|r"
			else
				set SJX = SJX + PlayersColoerText[BOX] +(PlayersName[GetPlayerId((Player(BOX)))])+ "|r"
			endif
			set SKX = true
		endif
		set i = i + 1
	endloop
	if SKX then
		return SJX
	endif
	return" "
endfunction
function SLX takes unit SDX, unit SFX returns string
	local integer i = 1
	local integer SGX = GetPlayerId(GetOwningPlayer(SDX))
	local integer SHX = GetPlayerId(GetOwningPlayer(SFX))
	local integer BOX
	local string SJX = ""
	local boolean SKX = false
	loop
	exitwhen i > 5
		if IsSentinelPlayer(GetOwningPlayer(SFX)) then
			set BOX = GetPlayerId(SentinelPlayers[i])
		else
			set BOX = GetPlayerId(ScourgePlayers[i])
		endif
		if SHX != BOX and SNX(BOX, SGX) then
			if SKX then
				set SJX = SJX + "/" + PlayersColoerText[BOX] +(PlayersName[GetPlayerId((Player(BOX)))])+ "|r"
			else
				set SJX = SJX + PlayersColoerText[BOX] +(PlayersName[GetPlayerId((Player(BOX)))])+ "|r"
			endif
			set SKX = true
		endif
		set i = i + 1
	endloop
	if SKX then
		return SJX
	endif
	return" "
endfunction
function SMX takes unit SDX, unit SFX returns integer
	local integer i = 1
	local integer SGX = GetPlayerId(GetOwningPlayer(SDX))
	local integer SHX = GetPlayerId(GetOwningPlayer(SFX))
	local integer BOX
	local integer count = 0
	loop
	exitwhen i > 5
		if IsSentinelPlayer(GetOwningPlayer(SFX)) then
			set BOX = GetPlayerId(SentinelPlayers[i])
		else
			set BOX = GetPlayerId(ScourgePlayers[i])
		endif
		if SHX != BOX and SNX(BOX, SGX) then
			set count = count + 1
		endif
		set i = i + 1
	endloop
	return count
endfunction
function SPX takes unit SDX, unit SFX returns boolean
	local integer i = 1
	local integer SGX = GetPlayerId(GetOwningPlayer(SDX))
	local integer SHX = GetPlayerId(GetOwningPlayer(SFX))
	local integer BOX
	local string SJX = " Assists: "
	local boolean SKX = false
	local integer x = 1
	set E1V[1]= null
	set E1V[2]= null
	set E1V[3]= null
	set E1V[4]= null
	set E1V[5]= null
	loop
	exitwhen i > 5
		if IsSentinelPlayer(GetOwningPlayer(SFX)) then
			set BOX = GetPlayerId(SentinelPlayers[i])
		else
			set BOX = GetPlayerId(ScourgePlayers[i])
		endif
		if SHX != BOX and SNX(BOX, SGX) then
			set E1V[x]= Player(BOX)
			set x = x + 1
			set SKX = true
		endif
		set i = i + 1
	endloop
	return SKX
endfunction
function SQX takes unit u returns unit
	if GetUnitAbilityLevel(u,'A1EL')> 0 then
		return CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	endif
	return u
endfunction
function SSX takes unit SDX, unit SFX, real L_X returns nothing
	local integer i = 1
	local integer count = 0
	call SPX(SDX, SFX)
	loop
	exitwhen i > 5
		if E1V[i]!= null then
			set count = count + 1
		endif
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > 5
		if E1V[i]!= null then
			set PlayersReliableGold[GetPlayerId(E1V[i])]= PlayersReliableGold[GetPlayerId(E1V[i])] + R2I(L_X / count)
			call B8X(E1V[i], R2I(L_X / count), Player__Hero[GetPlayerId(E1V[i])])
		endif
		set i = i + 1
	endloop
endfunction
function IsSoldierTypeId takes integer id returns boolean
	return id =='ugho' or id =='unec' or id =='esen' or id =='edry' or id =='u001' or id =='u002' or id =='e00V' or id =='e00W' or id =='ebal' or id =='e026' or id =='umtw' or id =='u00R'
endfunction
function SUX takes unit u, integer pid returns nothing
	local texttag t = CreateTextTag()
	call SetTextTagText(t, "!", .03)
	call SetTextTagPosUnit(t, u, 0)
	call SetTextTagColorBJ(t, VQV[pid], VSV[pid], VTV[pid], 15)
	call SetTextTagVelocity(t, 0, .035)
	call SetTextTagFadepoint(t, 3)
	call SetTextTagLifespan(t, 1.5)
	call SetTextTagPermanent(t, false)
	call SetTextTagVisibility(t, F6V[LocalPlayerId]or(IsGameHaveObserver and(LocalPlayer== ObserverPlayer1 or LocalPlayer== ObserverPlayer2)))
	set t = null
endfunction
function SWX takes unit killingUnit, unit triggerUnit returns nothing
	local integer id = GetUnitTypeId(triggerUnit)
	local integer pid = GetPlayerId(GetOwningPlayer(killingUnit))
	if GetOwningPlayer(triggerUnit) == NeutralCreepPlayer then
		set PlayerNeutralCreepDenyCount[pid]= PlayerNeutralCreepDenyCount[pid] + 1
		//set PlayerCreepLastHitCount[pid]= PlayerCreepLastHitCount[pid] + 1
		call SaveInteger(HY, 400 + pid, 79, LoadInteger(HY, 400 + pid, 79)+ 1)
	else
		if IsSoldierTypeId(id) and(GetOwningPlayer(triggerUnit) == SentinelPlayers[0]or GetOwningPlayer(triggerUnit) == ScourgePlayers[0]) then
			if IsUnitAlly(triggerUnit, GetOwningPlayer(killingUnit)) then
				set PlayerCreepDenyCount[pid]= PlayerCreepDenyCount[pid] + 1
				call SUX(triggerUnit, pid)
			else
				set PlayerCreepLastHitCount[pid]= PlayerCreepLastHitCount[pid] + 1
			endif
		endif
	endif
endfunction
function S_X takes unit SDX returns boolean
	return GetUnitTypeId(SDX)=='H00I' or GetUnitTypeId(SDX)=='H00J'
endfunction
function S0X takes unit SDX, location S1X returns nothing
	local integer h = GetHandleId(GetOwningPlayer(SDX))
	local unit S2X =(LoadUnitHandle(HY, h, 699))
	local unit S3X =(LoadUnitHandle(HY, h, 700))
	local unit S4X =(LoadUnitHandle(HY, h, 701))
	local unit S5X =(LoadUnitHandle(HY, h, 702))
	local unit S6X =(LoadUnitHandle(HY, h, 703))
	if S2X != null then
		call ReviveHeroLoc(S2X, S1X, true)
		call L8X(S2X)
	endif
	if S3X != null then
		call ReviveHeroLoc(S3X, S1X, true)
		call L8X(S3X)
	endif
	if S4X != null then
		call ReviveHeroLoc(S4X, S1X, true)
		call L8X(S4X)
	endif
	if S5X != null then
		call ReviveHeroLoc(S5X, S1X, true)
		call L8X(S5X)
	endif
	if S6X != null then
		call ReviveHeroLoc(S6X, S1X, true)
		call L8X(S6X)
	endif
	set S2X = null
	set S3X = null
	set S4X = null
	set S5X = null
	set S6X = null
endfunction
function HeroReviveTimerExpiredAction takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local player p
	local real x
	local real y
	if GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		set p = GetOwningPlayer(u)
		if IsScourgePlayer(p) then
			set x = GetRectCenterX(gg_rct_ScourgeRevivalPoint)
			set y = GetRectCenterY(gg_rct_ScourgeRevivalPoint)
		else
			set x = GetRectCenterX(gg_rct_SentinelRevivalPoint)
			set y = GetRectCenterY(gg_rct_SentinelRevivalPoint)
		endif
		if not IsGameEnd and UnitIsDead(u) then
			call MEX(u, p, x, y, true)
			call ReviveHero(u, x, y, true)
			call SetUnitState(u, UNIT_STATE_MANA, 99999)
		endif
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTrigger(t)
	set u = null
	set t = null
endfunction
function CreateHeroReviveTimer takes unit u, real timeout returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, u)
	call TriggerRegisterTimerEvent(t, timeout, false)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_HERO_REVIVE_FINISH)
	call TriggerAddCondition(t, Condition(function HeroReviveTimerExpiredAction))
	set t = null
endfunction
function S9X takes nothing returns boolean
	if GetItemPlayer(GetFilterItem()) == Player(15) then
		call RemoveItem(GetFilterItem())
	endif
	return false
endfunction
function TVX takes nothing returns nothing
	call EnumItemsInRect(NI, Filter(function S9X), null)
endfunction
function TEX takes integer id returns integer
	local integer goldBonus
	local integer TXX
	if HaveSavedInteger(ItemGoldHashTable, id,'GOLD') == false then
		set goldBonus = GetPlayerState(Player(15), PLAYER_STATE_RESOURCE_GOLD)
		set TXX = 50000
		call SetPlayerState(Player(15), PLAYER_STATE_RESOURCE_GOLD, TXX)
		call AddItemToStock(BI, id, 1, 1)
		call IssueImmediateOrderById(BI, id)
		set TXX = TXX -GetPlayerState(Player(15), PLAYER_STATE_RESOURCE_GOLD)
		call SetPlayerState(Player(15), PLAYER_STATE_RESOURCE_GOLD, goldBonus)
		call SaveInteger(ItemGoldHashTable, id,'GOLD', TXX)
		call TVX()
	else
		set TXX = LoadInteger(ItemGoldHashTable, id,'GOLD')
	endif
	return TXX
endfunction
function TOX takes unit u returns integer
	local integer i = 0
	local integer TRX = 0
	local item it
	loop
		set it = UnitItemInSlot(u, i)
		if it != null then
			set TRX = TRX + TEX(GetItemTypeId(it))
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	set it = null
	return TRX
endfunction
function TIX takes integer nw, unit TAX returns nothing
	local texttag tt
	local integer h
	local integer hu = GetHandleId(TAX)
	local integer id = GetPlayerId(GetOwningPlayer(TAX))
	if HaveSavedHandle(HY, hu,'netw') then
		set tt = LoadTextTagHandle(HY, hu,'netw')
	else
		set tt = CreateTextTag()
		call SetTextTagPosUnit(tt, TAX, 0)
		call SetTextTagVelocity(tt, 0, 0)
		call SetTextTagPermanent(tt, true)
		call SaveTextTagHandle(HY, hu,'netw', tt)
	endif
	call SetTextTagText(tt, I2S(nw), .025)
	call SetTextTagVisibility(tt, IsUnitAlly(TAX, LocalPlayer) or IsObserverPlayer(LocalPlayer))
	if KFX(GetHeroLevel(Player__Hero[id]))* 50 + 50 > GetPlayerState(GetOwningPlayer(TAX), PLAYER_STATE_RESOURCE_GOLD) or UF[id]or W4[id]=='h0D4' then
		call SetTextTagColor(tt, 255, 75, 0, 255)
	else
		call SetTextTagColor(tt, 255, 220, 0, 255)
	endif
	set tt = null
endfunction
function TNX takes nothing returns nothing
	local integer i = 1
	local integer pid
	local player p
	local integer TBX
	loop
		set TBX = 0
		set p = SentinelPlayers[i]
		if IsUserPlayer(p) then
			set pid = GetPlayerId(p)
			if GR[pid] then
				if Player__Hero[pid]!= null then
					set TBX = TBX + TOX(Player__Hero[pid])
					set TBX = TBX + TOX(CirclesUnit[pid])
				endif
				if HaveSavedHandle(HY, GetHandleId(p), 333) then
					set TBX = TBX + TOX(LoadUnitHandle(HY, GetHandleId(p), 333))
				endif
				set TBX = TBX + XX[pid]
				set GR[pid]= false
				set DR[pid]= TBX
			else
				set TBX = DR[pid]
			endif
			set RI[pid]= TBX + GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)
			call TIX(RI[pid], CirclesUnit[pid])
		endif
		set TBX = 0
		set p = ScourgePlayers[i]
		if IsUserPlayer(p) then
			set pid = GetPlayerId(p)
			if GR[pid] then
				if Player__Hero[pid]!= null then
					set TBX = TBX + TOX(Player__Hero[pid])
					set TBX = TBX + TOX(CirclesUnit[pid])
				endif
				if HaveSavedHandle(HY, GetHandleId(p), 333) then
					set TBX = TBX + TOX(LoadUnitHandle(HY, GetHandleId(p), 333))
				endif
				set TBX = TBX + XX[pid]
				set GR[pid]= false
				set DR[pid]= TBX
			else
				set TBX = DR[pid]
			endif
			set RI[pid]= TBX + GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)
			call TIX(RI[pid], CirclesUnit[pid])
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
endfunction
function TCX takes nothing returns nothing
	set NI = Rect(6592,-7872, 7392,-7264)
	set BI = CreateUnit(Player(15),'nshe', GetRectCenterX(NI), GetRectCenterY(NI), 0)
	call UnitAddAbility(BI,'Asid')
	call UnitRemoveAbility(BI,'Amov')
	call UnitAddAbility(BI,'Aloc')
	call SetUnitX(BI, GetRectCenterX(NI))
	call SetUnitY(BI, GetRectCenterY(NI))
	call ShowUnit(BI, false)
	set II = CreateTimer()
	call TimerStart(II, 1, true, function TNX)
endfunction
function TDX takes nothing returns boolean
	if (IsAliveNotStrucNotWard(GetFilterUnit())) and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitIllusion(GetFilterUnit()) == false then
		if IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(E2V)) and GetItemOfTypeFromUnit(GetFilterUnit(), XOV[NIV])!= null then
			call SetItemCharges(GetItemOfTypeFromUnit(GetFilterUnit(), XOV[NIV]), GetItemCharges(GetItemOfTypeFromUnit(GetFilterUnit(), XOV[NIV]))+ 1)
		endif
	endif
	return false
endfunction
function TFX takes nothing returns boolean
	local item i
	local integer HUX
	if E4V == 0 and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitIllusion(GetFilterUnit()) == false and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(E3V)) then
		set i = GetItemOfTypeFromUnit(GetFilterUnit(), XOV[NUV])
		if i != null then
			set E4V = E4V + 1
			set HUX = GetItemCharges(i)
			if HUX == 0 then
				set HUX = 2
			else
				set HUX = HUX + 1
			endif
			call SetItemCharges(i, HUX)
		endif
		set i = null
	endif
	set i = null
	return false
endfunction
function TGX takes unit u returns nothing
	local group g = AllocationGroup(12)
	set E2V = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 1625, Condition(function TDX))
	call DeallocateGroup(g)
	set g = null
endfunction
function THX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit TJX =(LoadUnitHandle(HY, h, 335))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real x
	local real y
	local real a
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if GetTriggerUnit()!= TJX then
			call KillUnit(TJX)
		endif
	else
		set a = GetUnitFacing(targetUnit)* bj_RADTODEG
		set x = GetUnitX(targetUnit)+ 75
		set y = GetUnitY(targetUnit)+ 75
		call SetUnitX(TJX, x)
		call SetUnitY(TJX, y)
		call IssueTargetOrderById(TJX, 851983, targetUnit)
	endif
	set t = null
	set TJX = null
	set targetUnit = null
	return false
endfunction
function TKX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	local unit TJX
	if GetSummoningUnit() == dummyCaster then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set TJX = GetSummonedUnit()
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterDeathEvent(t, TJX)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerRegisterTimerEvent(t, .05, true)
		call TriggerAddCondition(t, Condition(function THX))
		call SaveUnitHandle(HY, h, 335,(TJX))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call UnitAddAbility(TJX,'Aloc')
		call SetUnitPosition(TJX, GetUnitX(targetUnit)+ 100 , GetUnitY(targetUnit)+ 100 )
		call IssueTargetOrderById(TJX, 851983, targetUnit)
		call SetUnitMoveSpeed(TJX, 522)
	endif
	set t = null
	set targetUnit = null
	set whichUnit = null
	set dummyCaster = null
	set TJX = null
	return false
endfunction
function TLX takes unit whichUnit, unit TMX returns nothing
	local unit targetUnit = TMX
	local unit dummyCaster
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	if OZX(targetUnit) then
		set targetUnit =(Player__Hero[GetPlayerId(GetOwningPlayer((targetUnit)))])
	endif
	set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function TKX))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	call UnitAddPermanentAbility(dummyCaster,'A2E7')
	call IssueTargetOrderById(dummyCaster, 852274, targetUnit)
	set t = null
	set targetUnit = null
	set dummyCaster = null
endfunction
function TPX takes nothing returns boolean
	if (IsAliveNotStrucNotWard(GetFilterUnit())) and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitIllusion(GetFilterUnit()) == false then
		if IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(E2V)) == false and GetItemOfTypeFromUnit(GetFilterUnit(), XOV[RAV])!= null then
		endif
	endif
	return false
endfunction
function TQX takes unit u returns nothing
	local group g = AllocationGroup(13)
	set E2V = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 1625, Condition(function TPX))
	call DeallocateGroup(g)
	set g = null
endfunction
function TSX takes unit u returns nothing
	local group g = AllocationGroup(14)
	set E4V = 0
	set E3V = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 1425, Condition(function TFX))
	call DeallocateGroup(g)
	set E4V = 0
	set g = null
endfunction
function TTX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer TUX =(LoadInteger(HY, h, 88))
	local integer i = 1
	local player p
	local string TWX
	loop
	exitwhen i > 5
		if TUX == 0 then
			set p = SentinelPlayers[i]
			set TWX = PlayersColoerText[GetPlayerId(SentinelPlayers[0])] + GetObjectName('n03N')+ "|r " + GetObjectName('n03P')+ " " + PlayersColoerText[GetPlayerId(SentinelPlayers[0])] + GetObjectName('n03Q')+ "|r"
		else
			set p = ScourgePlayers[i]
			set TWX = PlayersColoerText[GetPlayerId(ScourgePlayers[0])] + GetObjectName('n03O')+ "|r " + GetObjectName('n03P')+ " " + PlayersColoerText[GetPlayerId(ScourgePlayers[0])] + GetObjectName('n03Q')+ "|r"
		endif
		call DisplayTimedTextToPlayer(p, 0, 0, 10, TWX)
		call BYX(E1, p)
		set i = i + 1
	endloop
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set p = null
	return false
endfunction
function TYX takes integer TUX returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1.5, false)
	call TriggerAddCondition(t, Condition(function TTX))
	call SaveInteger(HY, h, 88,(TUX))
	set t = null
endfunction
function TZX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer T_X =(LoadInteger(HY, h, 89))
	local string TWX =(LoadStr(HY, h, 90))
	local integer WWV = LoadInteger(HY,'0SND','0PID')
	if T_X == 1 then
		call BWX(M0)
	elseif T_X == 2 then
		call BWX(X1)
	elseif T_X == 3 then
		call BWX(I1)
	elseif T_X == 4 then
		call BWX(A1)
	endif
	call SetTopMessageText(TWX, 8.)
	//call DisplayTimedTextToAllPlayer(AllPlayerForce, DisplayTextDuration[LocalPlayerId], TWX)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function T0X takes string TWX, integer T_X returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1.5, false)
	call TriggerAddCondition(t, Condition(function TZX))
	call SaveStr(HY, h, 90,(TWX))
	call SaveInteger(HY, h, 89,(T_X))
	set t = null
endfunction
function T1X takes player T2X, integer T3X returns nothing
	local integer loop_i = 1
	local integer LZX
	if IsSentinelPlayer(T2X) then
		set LZX = XKX(SentinelForce)
	else
		set LZX = XKX(ScourgeForce)
	endif
	if IsSentinelPlayer(T2X) then
		loop
		exitwhen loop_i > 5
			if IsPlayingPlayer(SentinelPlayers[loop_i]) then
				set PlayersReliableGold[GetPlayerId(SentinelPlayers[loop_i])]= PlayersReliableGold[GetPlayerId(SentinelPlayers[loop_i])] + T3X / LZX
				call B8X(SentinelPlayers[loop_i], T3X / LZX, Player__Hero[GetPlayerId(SentinelPlayers[loop_i])])
			endif
			set loop_i = loop_i + 1
		endloop
	else
		loop
		exitwhen loop_i > 5
			if IsPlayingPlayer(ScourgePlayers[loop_i]) then
				set PlayersReliableGold[GetPlayerId(ScourgePlayers[loop_i])]= PlayersReliableGold[GetPlayerId(ScourgePlayers[loop_i])] + T3X / LZX
				call B8X(ScourgePlayers[loop_i], T3X / LZX, Player__Hero[GetPlayerId(ScourgePlayers[loop_i])])
			endif
			set loop_i = loop_i + 1
		endloop
	endif
endfunction
function T4X takes unit SDX, integer T5X returns nothing
	local player T6X = GetOwningPlayer(SDX)
	call SetPlayerState(T6X, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(T6X, PLAYER_STATE_RESOURCE_GOLD)-T5X)
	set T6X = null
endfunction
function T7X takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='o003' then
		call KillUnit(GetFilterUnit())
		return true
	endif
	return false
endfunction
function T8X takes nothing returns nothing
	local group g = AllocationGroup(15)
	call GroupEnumUnitsInRect(g, bj_mapInitialPlayableArea, Condition(function T7X))
	call DeallocateGroup(g)
	set g = null
endfunction
function T9X takes unit SFX, player T6X, player T2X returns boolean
	return SFX == null or(IsSentinelPlayer(T6X) and IsSentinelPlayer(T2X)) or(IsScourgePlayer(T6X) and IsScourgePlayer(T2X))
endfunction
function UVX takes integer id returns integer
	local integer i = 1
	local integer xp = 0
	if id == 0 then
		loop
			if Player__Hero[GetPlayerId(SentinelPlayers[i])]!= null then
				set xp = xp + GetHeroXP(Player__Hero[GetPlayerId(SentinelPlayers[i])])
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
	else
		loop
			if Player__Hero[GetPlayerId(ScourgePlayers[i])]!= null then
				set xp = xp + GetHeroXP(Player__Hero[GetPlayerId(ScourgePlayers[i])])
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
	endif
	return xp
endfunction
function UEX takes integer id returns integer
	local integer i = 1
	local integer value = 0
	if id == 0 then
		loop
			set value = value + RI[GetPlayerId(SentinelPlayers[i])]
			set i = i + 1
		exitwhen i > 5
		endloop
	else
		loop
			set value = value + RI[GetPlayerId(ScourgePlayers[i])]
			set i = i + 1
		exitwhen i > 5
		endloop
	endif
	return value
endfunction
function UXX takes player p returns integer
	local integer i = 1
	local integer UOX = 1
	local integer pid = GetPlayerId(p)
	local integer nw = RI[pid]
	if IsSentinelPlayer(p) then
		loop
			if GetPlayerId(SentinelPlayers[i])!= pid then
				if RI[GetPlayerId(SentinelPlayers[i])]> nw then
					set UOX = UOX + 1
				endif
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
	else
		loop
			if GetPlayerId(ScourgePlayers[i])!= pid then
				if RI[GetPlayerId(ScourgePlayers[i])]> nw then
					set UOX = UOX + 1
				endif
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
	endif
	return UOX
endfunction
function URX takes nothing returns nothing
	local integer i = 1
	local integer WXV = LoadInteger(OtherHashTable2,'Assi', 0)
	local real array r
	local player array p
	local integer k = 0
	if WXV == 2 then
		set r[0]= .75
		set r[1]= 1.25
	elseif WXV == 3 then
		set r[0]= .75
		set r[1]= 1.
		set r[2]= 1.25
	elseif WXV == 4 then
		set r[0]= .75
		set r[1]= .75
		set r[2]= 1.25
		set r[3]= 1.25
	elseif WXV >= 5 then
		set r[0]= .75
		set r[1]= .75
		set r[2]= 1.
		set r[3]= 1.25
		set r[4]= 1.25
	endif
	loop
		if HaveSavedHandle(OtherHashTable2,'Assi', i) then
			set p[k]= LoadPlayerHandle(OtherHashTable2,'Assi', i)
			set k = k + 1
		endif
		set i = i + 1
	exitwhen i > 5 or k > WXV -1
	endloop
	set i = 0
	loop
		call SaveReal(OtherHashTable2,'Assi', GetPlayerId(p[i]), r[i])
		set i = i + 1
	exitwhen i > k
	endloop
endfunction
function UIX takes nothing returns nothing
	local group g = LoadGroupHandle(OtherHashTable2,'assi', 0)
	local group gg = AllocationGroup(16)
	local integer UOX
	local unit u2
	local integer i = 0
	call FlushChildHashtable(OtherHashTable2,'Assi')
	call GroupAddGroup(g, gg)
	loop
		set u2 = FirstOfGroup(gg)
	exitwhen u2 == null
		set i = i + 1
		set UOX = UXX(GetOwningPlayer(u2))
		if HaveSavedHandle(OtherHashTable2,'Assi', UOX) then
			loop
				set UOX = UOX + 1
			exitwhen HaveSavedHandle(OtherHashTable2,'Assi', UOX) == false
			endloop
		endif
		call SavePlayerHandle(OtherHashTable2,'Assi', UOX, GetOwningPlayer(u2))
		call SaveInteger(OtherHashTable2,'Assi', i, GetPlayerId(GetOwningPlayer(u2)))
		call SaveInteger(OtherHashTable2,'Assi', 0, LoadInteger(OtherHashTable2,'Assi', 0)+ 1)
		call GroupRemoveUnit(gg, u2)
	endloop
	if i == 1 then
		call SaveReal(OtherHashTable2,'Assi', LoadInteger(OtherHashTable2,'Assi', 1), 1)
	else
		call URX()
	endif
	call DeallocateGroup(gg)
	call RemoveSavedHandle(OtherHashTable2,'assi', 0)
endfunction
function UAX takes unit u1, unit u2 returns real
	local real x1 = GetUnitX(u1)
	local real y1 = GetUnitY(u1)
	local real x2 = GetUnitX(u2)
	local real y2 = GetUnitY(u2)
	if u1 == null or u2 == null then
		return I2R( 1410065407)
	else
		return(x1 -x2)*(x1 -x2)+(y1 -y2)*(y1 -y2)
	endif
	return 1.
endfunction
function UNX takes nothing returns nothing
	if GetUnitAbilityLevel(GetEnumUnit(),'Aloc') == 0 and UnitAlive(GetEnumUnit()) and IsUnitEnemy(GetEnumUnit(), GetOwningPlayer(SB)) and UAX(GetTriggerUnit(), GetEnumUnit())<= QB * QB then
		call GroupAddUnit(IV, GetEnumUnit())
	endif
endfunction
function UBX takes nothing returns nothing
	if GetUnitAbilityLevel(GetEnumUnit(),'Aloc') == 0 and UnitAlive(GetEnumUnit()) and IsUnitAlly(GetEnumUnit(), GetOwningPlayer(SB)) and UAX(GetTriggerUnit(), GetEnumUnit())<= QB * QB then
		call GroupAddUnit(IV, GetEnumUnit())
	endif
endfunction
function UCX takes nothing returns nothing
	if GetUnitAbilityLevel(GetEnumUnit(),'Aloc') == 0 and UnitAlive(GetEnumUnit()) and UAX(GetTriggerUnit(), GetEnumUnit())<= QB * QB then
		call GroupAddUnit(IV, GetEnumUnit())
	endif
endfunction
function UDX takes nothing returns nothing
	local unit u = GetTriggerUnit()
	call GroupClear(IV)
	// 中立
	if GetOwningPlayer(u) == NeutralCreepPlayer then
		if not IsUnitType(u, UNIT_TYPE_ANCIENT) then
			call ForGroup(OV, function UCX)
		else
			call ForGroup(OV, function UBX)
		endif
	else
		if IsUnitAlly(u, GetOwningPlayer(GetKillingUnit())) and YB == false then
			call ForGroup(OV, function UNX)
		else
			call ForGroup(OV, function UBX)
		endif
	endif
	set u = null
endfunction
function UFX takes nothing returns nothing
	call GroupClear(IV)
	call ForGroup(OV, function UBX)
endfunction
function UGX takes unit killingUnit returns boolean
	local integer level
	local integer UHX = 0
	local integer UJX = 0
	local group g
	local integer UKX
	local integer ULX
	local real UMX
	local real UPX
	local integer xp
	local unit u = GetTriggerUnit()
	local integer UQX
	local integer USX
	local integer UTX
	local real UUX
	local real a
	local real UWX
	local integer UYX
	local integer UZX
	local integer heroPos
	local integer U_X
	local real U0X
	local real U1X
	local integer U2X
	local integer U3X
	local integer pid
	local real U4X
	local real U5X
	if IsUnitType(u, UNIT_TYPE_HERO) and not MOX(GetUnitTypeId(u)) then
		set level = GetHeroLevel(u)
		set xp = GetHeroXP(u)
		set SB = killingUnit
		call UFX()
		if IsUnitType(killingUnit, UNIT_TYPE_HERO) and not LoadBoolean(HY, GetHandleId(killingUnit), QR) then
			if HeroIsDummyUnit(killingUnit) then
				if UnitAlive(Player__Hero[GetPlayerId(GetOwningPlayer(killingUnit))]) then
					call GroupAddUnit(IV, Player__Hero[GetPlayerId(GetOwningPlayer(killingUnit))])
				endif
			else
				if UnitAlive(killingUnit) or LoadInteger(HY, GetHandleId(killingUnit),'A06B') == 1 then
					call GroupAddUnit(IV, killingUnit)
				endif
			endif
		else
			// 存在英雄 并且凶手单位存活 而且主人单位还是自爆的
			if Player__Hero[GetPlayerId(GetOwningPlayer(killingUnit))]!= null and ( UnitAlive(Player__Hero[GetPlayerId(GetOwningPlayer(killingUnit))]) or LoadInteger(HY, GetHandleId(Player__Hero[GetPlayerId(GetOwningPlayer(killingUnit))]),'A06B') == 1 ) then
				call GroupAddUnit(IV, Player__Hero[GetPlayerId(GetOwningPlayer(killingUnit))])
			endif
		endif
		set UYX = CountUnitsInGroup(IV)
		if UYX == 0 then
			set u = null
			set g = null
			return false
		endif
		if IsScourgePlayer(GetOwningPlayer(u)) then
			set UKX = UVX(0)
			set ULX = UVX(1)
			set UTX = UEX(0)
			set USX = UEX(1)
		else
			set UKX = UVX(1)
			set ULX = UVX(0)
			set UTX = UEX(1)
			set USX = UEX(0)
		endif
		set U4X = IMaxBJ(USX -UTX, 0)* 1.
		set UMX = RMaxBJ((ULX -UKX)* 1. /(1. * IMaxBJ(ULX + UKX, 1)), 0)
		set UPX = UMX * xp
		if UYX == 1 then
			set UHX = 20 * level + R2I(UPX * .23 * .6)
		elseif UYX == 2 then
			set UHX = 15* level + R2I(UPX * .23 * .6)
		elseif UYX == 3 then
			set UHX = 10* level + R2I(UPX * .2 * .6)
		elseif UYX == 4 then
			set UHX = 7 * level + R2I(UPX * .15 * .6)
		elseif UYX >= 5 then
			set UHX = 5 * level + R2I(UPX * .12 * .6)
		endif
		set UZX = UXX(GetOwningPlayer(u))
		set UQX = RI[GetPlayerId(GetOwningPlayer(u))]
		set a =(1. * USX)/((UTX + 1)* 1.)-1.
		set UUX = RMinBJ(RMaxBJ(a, 0), 1)
		set UWX = UUX
		if UYX == 1 then
			set U_X = 150
			set U0X = 8.
			set U1X = .0375
			set U2X = 100 
			set U5X = 100.
		elseif UYX == 2 then
			set U_X = 100 
			set U0X = 7.
			set U1X = .0375
			set U2X = 75
			set U5X = 75.
		elseif UYX == 3 then
			set U_X = 40
			set U0X = 6.
			set U1X = .0375
			set U2X = 40
			set U5X = 50.
		elseif UYX == 4 then
			set U_X = 25
			set U0X = 4.
			set U1X = .03
			set U2X = 25
			set U5X = 35.
		elseif UYX >= 5 then
			set U_X = 20
			set U0X = 4.
			set U1X = .0225
			set U2X = 20
			set U5X = 25.
		endif
		set U3X = R2I((U_X + U0X * level + U1X * UQX * UWX + U5X * RMinBJ(U4X / 4000., 1))*(1.2 -0.1 *(UZX -1)))
		call SaveGroupHandle(OtherHashTable2,'assi', 0, IV)
		call UIX()
		set level = R2I(RNX(u)/ UYX)
		loop
			set u = FirstOfGroup(IV)
		exitwhen u == null
			set pid = GetPlayerId(GetOwningPlayer(u))
			set UJX = R2I(U3X * LoadReal(OtherHashTable2,'Assi', pid))
			call SaveInteger(OtherHashTable2,'Assi', pid, UJX)
			if u != killingUnit or UnitAlive(u) or LoadInteger(HY, GetHandleId(killingUnit),'A06B') == 1 then
				call AddHeroXPSimple(u, UHX, true)
			endif
			if u == killingUnit and not IsUnitInRange(killingUnit, GetTriggerUnit(), QB) then //GetUnitDistanceEx(killingUnit, GetTriggerUnit())> QB then
				if UnitAlive(u) or LoadInteger(HY, GetHandleId(killingUnit),'A06B') == 1 then
					call AddHeroXPSimple(u, level * UYX, true)
				endif
			else
				if UnitAlive(u) or LoadInteger(HY, GetHandleId(killingUnit),'A06B') == 1 then
					call AddHeroXPSimple(u, level, true)
				endif
			endif
			set PlayerExpBonus[pid]= PlayerExpBonus[pid] + UHX
			set PlayerGoldBonus[pid]= PlayerGoldBonus[pid] + UJX
			set PlayersReliableGold[pid]= PlayersReliableGold[pid] + UJX
			call B8X(GetOwningPlayer(u), UJX, u)
			call GroupRemoveUnit(IV, u)
		endloop
	endif
	set u = null
	set g = null
	return false
endfunction
function U6X takes nothing returns nothing
	set IS[LoadInteger(HY, GetHandleId(GetExpiredTimer()), 0)]= 0
endfunction
// 英雄阵亡
function U7X takes nothing returns nothing
	local boolean U8X = false
	local unit U9X = GetDyingUnit()
	local unit WVX = GetKillingUnit()
	local player WEX = GetOwningPlayer(WVX)
	local player WXX = GetOwningPlayer(U9X)
	local integer WOX
	local integer WRX
	local integer WIX = 0
	local integer WAX = 0
	local boolean WNX = false
	local string WBX = ""
	local string WCX = ""
	local string WDX = ""
	local integer WFX
	local string WGX
	local string WHX
	local string WJX
	local string WKX
	local boolean WLX = false
	local real WMX = 1
	local real WPX = 1
	local real WQX = 0
	local integer WSX = 0
	local trigger t
	local real WTX
	local integer WUX
	local integer unittypeId
	local integer WWX = GetPlayerState(WXX, PLAYER_STATE_RESOURCE_GOLD)
	local integer WYX = WWX -PlayersReliableGold[GetPlayerId(WXX)]
	local unit WZX
	local unit W_X
	local string W0X
	local boolean W1X = LoadInteger(HY, GetHandleId(U9X), 4418) == 1 or(LoadInteger(HY, GetHandleId(U9X), 4419) == 1)
	local item it
	if W1X then
		set UF[GetPlayerId(WXX)]= true
	endif
	if LoadInteger(HY, GetHandleId(U9X), 4333) == 1 or LoadInteger(HY, GetHandleId(U9X), 4334) == 1 then
		set WVX = Player__Hero[GetPlayerId(LoadPlayerHandle(HY, GetHandleId(U9X), 4333))]
		set WEX = GetOwningPlayer(WVX)
		set WSX = 30
	endif
	if WVX == null and LoadInteger(HY, GetHandleId(U9X), 4500) == 1 then
		set WVX = QEV
		set WEX = GetOwningPlayer(WVX)
	endif
	set WUX = SMX(U9X, WVX)
	if IsPlayerAlly(WEX, WXX) and((LoadInteger(HY, GetHandleId(WVX), 4328)) == 1) and PG != null then
		set WVX = PG
		set WEX = GetOwningPlayer(WVX)
	endif
	if T9X(WVX, WXX, WEX) == false and WUX == 1 and XFX(WEX) == false and WEX != NeutralCreepPlayer then
		call SPX(U9X, WVX)
		set WEX = E1V[1]
		set WVX = Player__Hero[GetPlayerId(WEX)]
	endif
	set M2[GetPlayerId(GetOwningPlayer(U9X))]= true
	if WEX == null then
		set WEX = WXX
	endif
	if GetUnitAbilityLevel(WVX,'Aloc')> 0 then
		set WVX = Player__Hero[GetPlayerId(WEX)]
	endif
	if IsPlayerEnemy(WEX, WXX) and WEX != Player(12) then
		call UGX(WVX)
	endif
	if IT and GetUnitTypeId(U9X)!='H00J' then
		set it = UnitRemoveItemFromSlot(U9X, GetRandomInt(0, 5))
		if GetItemTypeId(it)=='I00K' then
			call CreateItem('I00G', GetItemX(it), GetItemY(it))
			call RemoveItem(it)
		endif
		set it = null
	endif
	set WOX = GetPlayerId(WEX)
	set WRX = GetPlayerId(WXX)
	if IsSentinelPlayer(WXX) then
		if IsSentinelPlayer(WEX) then
			set U8X = true
			if (WEX == WXX) then
				call DisplayTimedTextToAllPlayer(AllPlayerForce, DisplayTextDuration[LocalPlayerId], PlayersColoerText[WRX] + PlayersName[WRX] + "|r " + GetObjectName('n03R'))
			else
				call DisplayTimedTextToAllPlayer(AllPlayerForce, DisplayTextDuration[LocalPlayerId], GetKillHeroDisplayText(WXX, WEX))
			endif
		elseif IsScourgePlayer(WEX) then
			set WNX = true
			set PlayerHeroDeathCount[GetPlayerId(SentinelPlayers[0])]= PlayerHeroDeathCount[GetPlayerId(SentinelPlayers[0])] + 1
			set PlayerKillHerosCount[GetPlayerId(ScourgePlayers[0])]= PlayerKillHerosCount[GetPlayerId(ScourgePlayers[0])] + 1
			set FS[2]= FS[2] + 1
			set FS[1]= 0
			if WEX != ScourgePlayers[0] then
				set PlayerKillHerosCount[WOX]= PlayerKillHerosCount[WOX] + 1
				set XS[WOX]= XS[WOX] + 1
			endif
		endif
	elseif IsScourgePlayer(WXX) then
		if IsScourgePlayer(WEX) then
			set U8X = true
			if (WEX == WXX) then
				call DisplayTimedTextToAllPlayer(AllPlayerForce, DisplayTextDuration[LocalPlayerId], PlayersColoerText[WRX] +(PlayersName[WRX])+ "|r " + GetObjectName('n03R'))
			else
				call DisplayTimedTextToAllPlayer(AllPlayerForce, DisplayTextDuration[LocalPlayerId], GetKillHeroDisplayText(WXX, WEX))
			endif
		elseif IsSentinelPlayer(WEX) then
			set WNX = true
			set PlayerHeroDeathCount[GetPlayerId(ScourgePlayers[0])]= PlayerHeroDeathCount[GetPlayerId(ScourgePlayers[0])] + 1
			set PlayerKillHerosCount[GetPlayerId(SentinelPlayers[0])]= PlayerKillHerosCount[GetPlayerId(SentinelPlayers[0])] + 1
			set FS[1]= FS[1] + 1
			set FS[2]= 0
			if WEX != SentinelPlayers[0] then
				set PlayerKillHerosCount[WOX]= PlayerKillHerosCount[WOX] + 1
				set XS[WOX]= XS[WOX] + 1
			endif
		endif
	endif
	if WEX == NeutralCreepPlayer then
		set WNX = false
		if GetUnitTypeId(WVX)=='n00L' then
			call DisplayTimedTextToAllPlayer(AllPlayerForce, DisplayTextDuration[LocalPlayerId], PlayersColoerText[WRX] + PlayersName[WRX] + "|r " + GetObjectName('n03T'))
		else
			call DisplayTimedTextToAllPlayer(AllPlayerForce, DisplayTextDuration[LocalPlayerId], PlayersColoerText[WRX] + PlayersName[WRX] + "|r " + GetObjectName('n03U'))
		endif
		set U8X = true
	endif
	if X4 then
		call A5X(Q0, GetUnitX(U9X), GetUnitY(U9X))
	endif
	call StoreDrCacheData("Hero" + I2S(WRX), WOX)
	if XS[WOX]> PlayerMaxSuccessionKillCount[WOX] then
		set PlayerMaxSuccessionKillCount[WOX]= XS[WOX]
	endif
	set WFX = XS[WRX]
	if WFX > 2 and U8X == false then
		if WFX == 3 then
			set WBX = "|c0000ff40" + GetObjectName('n04L')+ "|r"
		elseif WFX == 4 then
			set WBX = "|c00400080" + GetObjectName('n04N')+ "|r"
		elseif WFX == 5 then
			set WBX = "|c00ff0080" + GetObjectName('n04M')+ "|r"
		elseif WFX == 6 then
			set WBX = "|c00ff8000" + GetObjectName('n04J')+ "|r"
		elseif WFX == 7 then
			set WBX = "|c00808000" + GetObjectName('n04I')+ "|r"
		elseif WFX == 8 then
			set WBX = "|c00ff80ff" + GetObjectName('n03V')+ "|r"
		elseif WFX == 9 then
			set WBX = "|c00ff0000" + GetObjectName('n03W')+ "|r"
		elseif WFX >= 10 then
			set WBX = "|c00ff8000" + GetObjectName('n03X')+ "|r"
		endif
		set WIX =(IMinBJ(WFX, 10)-2)* 60
	endif
	set WFX = XS[WOX]
	set WZX = WVX
	if IsUnitType(WZX, UNIT_TYPE_HERO) == false then
		set WZX = Player__Hero[GetPlayerId(GetOwningPlayer(WZX))]
	endif
	set W_X = U9X
	if IsUnitType(W_X, UNIT_TYPE_HERO) == false then
		set W_X = Player__Hero[GetPlayerId(GetOwningPlayer(W_X))]
	endif
	if U8X == false and WNX then
	endif
	if WFX > 2 and U8X == false then
		if WFX == 3 then
			call BWX(U0)
			set WCX = " " + GetObjectName('n04K')+ " |c0000ff40" + GetObjectName('n04L')+ "|r" + GetObjectName('n049')
		elseif WFX == 4 then
			call BWX(L0)
			set WCX = " " + GetObjectName('n04H')+ " |c00400080" + GetObjectName('n04N')+ "|r" + GetObjectName('n049')
		elseif WFX == 5 then
			call BWX(W0)
			set WCX = " " + GetObjectName('n04G')+ " |c00ff0080" + GetObjectName('n04M')+ "|r" + GetObjectName('n049')
		elseif WFX == 6 then
			call BWX(O1)
			set WCX = " " + GetObjectName('n04H')+ " |c00ff8000" + GetObjectName('n04J')+ "|r" + GetObjectName('n04A')
		elseif WFX == 7 then
			call BWX(R1)
			set WCX = " " + GetObjectName('n04H')+ " |c00808000" + GetObjectName('n04I')+ "|r" + GetObjectName('n04A')
		elseif WFX == 8 then
			call BWX(Z0)
			set WCX = " " + GetObjectName('n04G')+ " |c00ff80ff" + GetObjectName('n03V')+ "|r" + GetObjectName('n04A')
		elseif WFX == 9 then
			call BWX(S0)
			set WCX = " " + GetObjectName('n04H')+ " |c00ff0000" + GetObjectName('n03W')+ "|r" + GetObjectName('n04B')
		elseif WFX >= 10 then
			call BWX(T0)
			set WCX = " " + GetObjectName('n04H')+ " |c00ff8000" + GetObjectName('n03X')+ "|r. " + GetObjectName('n04F')+ GetObjectName('n04B')
		endif
	endif
	if U8X == false then
		set WIX = WIX + 100 + GetHeroLevel(U9X)* 9
		set WGX = PlayersColoerText[WRX] +(PlayersName[GetPlayerId((WXX))])+ "|r"
		set WHX = PlayersColoerText[WOX] +(PlayersName[GetPlayerId((WEX))])+ "|r"
		set WKX = "|c00FFDC00" + I2S(WIX)
		if LoadInteger(OtherHashTable2,'Assi', GetPlayerId(WEX))> 0 then
			set WKX = WKX + "(+" + I2S(LoadInteger(OtherHashTable2,'Assi', GetPlayerId(WEX)))+ ")"
		endif
		set WKX = WKX + "|r"
		if WEX == SentinelPlayers[0]or WEX == ScourgePlayers[0] then
			if WUX == 0 then
				if WEX == SentinelPlayers[0] then
					set WJX = WHX + " " + GetObjectName('n042')+ " " + WGX + GetObjectName('n043')+ GetObjectName('n049')+ " " + WKX + " " + GetObjectName('n044')+ "."
					call T1X(WEX, WIX)
				elseif WEX == ScourgePlayers[0] then
					set WJX = WHX + " " + GetObjectName('n042')+ " " + WGX + GetObjectName('n043')+ GetObjectName('n049')+ " " + WKX + " " + GetObjectName('n044')+ "."
					call T1X(WEX, WIX)
				endif
			elseif WUX > 1 then
				set WJX = WHX + " " + GetObjectName('n042')+ " " + WGX + GetObjectName('n043')+ GetObjectName('n049')+ " " + WKX + " " + GetObjectName('n044')+ "."
				call SSX(U9X, WVX, WIX)
			endif
		elseif WBX == ""and WCX == ""then
			set WJX = WHX + " " + GetObjectName('n042')+ " " + WGX + GetObjectName('n043')+ " " + GetObjectName('n04C')+ " " + WKX + " " + GetObjectName('n045')+ GetObjectName('n049')
		elseif WBX == ""and WCX != ""then
			set WJX = WHX + " " + GetObjectName('n042')+ " " + WGX + GetObjectName('n043')+ " " + GetObjectName('n04C')+ " " + WKX + " " + GetObjectName('n045')+ GetObjectName('n049')
		elseif WBX != ""and WCX == ""then
			set WJX = WHX + " " + GetObjectName('n048')+ " " + WGX + GetObjectName('n047')+ " " + WBX + " " + GetObjectName('n046')+ " " + WKX + " " + GetObjectName('n045')+ GetObjectName('n049')
		elseif WBX != ""and WCX != ""then
			set WJX = WHX + " " + GetObjectName('n048')+ " " + WGX + GetObjectName('n047')+ " " + WBX + " " + GetObjectName('n046')+ " " + WKX + " " + GetObjectName('n045')+ GetObjectName('n049')
		endif
		if WNX then
			set WDX = SCX(U9X, WVX)
		endif
		call DisplayTimedTextToAllPlayer(AllPlayerForce, DisplayTextDuration[LocalPlayerId], WJX + WDX)
		if WCX != ""then
			//call SetTopMessageText(WHX + WCX, 8.)
			call DisplayTimedTextToAllPlayer(AllPlayerForce, DisplayTextDuration[LocalPlayerId], WHX + WCX)
		endif
		set PlayersReliableGold[WOX]= PlayersReliableGold[WOX] + WIX
		call B8X(WEX, WIX, U9X)
		set PlayerKillHeroBonus[WOX]= PlayerKillHeroBonus[WOX] + WIX
		if FS[1]> 4 then
			call TYX(0)
		endif
		if FS[2]> 4 then
			call TYX(1)
		endif
	endif
	set WAX = GetHeroLevel(U9X)* 30
	if GetItemOfTypeFromUnit(U9X, XOV[NIV])!= null then
		if GetItemCharges(GetItemOfTypeFromUnit(U9X, XOV[NIV]))> 0 then
			set WQX =-1 *(3 * GetItemCharges(GetItemOfTypeFromUnit(U9X, XOV[NIV])))
		endif
	endif
	if WAX > WYX then
		set WAX = WYX
	endif
	call TGX(U9X)
	if GetItemOfTypeFromUnit(WVX, XOV[NIV])!= null and GetUnitDistanceEx(WVX, U9X)> 1600 then
		call SetItemCharges(GetItemOfTypeFromUnit(WVX, XOV[NIV]), GetItemCharges(GetItemOfTypeFromUnit(WVX, XOV[NIV]))+ 1)
	endif
	call TSX(U9X)
	call TQX(U9X)
	set U2 = U9X
	set MissileHitTargetUnit = WVX
	call ExecuteFunc("W2X")
	if WLX == false then
		set PlayerHeroDeathLossGold[WRX]= PlayerHeroDeathLossGold[WRX] + WAX
		call T4X(U9X, WAX)
	endif
	call SaveInteger(HY,(400 + WOX),(450 + WRX),((LoadInteger(HY,(400 + WOX),(450 + WRX)))+ 1))
	call SaveInteger(HY,(400 + WRX),(500 + WOX),((LoadInteger(HY,(400 + WRX),(500 + WOX)))+ 1))
	call TimerStart(MS[WOX], 18, false, function U6X)
	if U8X == false and WEX != SentinelPlayers[0]and WEX != ScourgePlayers[0]and WEX != NeutralCreepPlayer then
		set IS[WOX]= IS[WOX] + 1
		if IS[WOX]== 2 then
			set PlayerDoubleKillCount[WOX]= PlayerDoubleKillCount[WOX] + 1
			call SaveInteger(HY,'0SND','0PID', WOX)
			set W0X = GetObjectName('n04S')
			call T0X(PlayersColoerText[WOX] +(PlayersName[GetPlayerId((WEX))])+ "|r " + GetObjectName('n04D')+ " |c000000ff" + W0X + "|r" + GetObjectName('n049'), 1)
		endif
		if IS[WOX]== 3 then
			set PlayerTripleKillCount[WOX]= PlayerTripleKillCount[WOX] + 1
			call SaveInteger(HY,'0SND','0PID', WOX)
			set W0X = GetObjectName('n04E')
			call T0X(PlayersColoerText[WOX] +(PlayersName[GetPlayerId((WEX))])+ "|r " + GetObjectName('n04D')+ " |c0000ff40" + W0X + "|r" + GetObjectName('n04B'), 2)
		endif
		if IS[WOX]== 4 then
			set PlayerTripleKillCount[WOX]= PlayerTripleKillCount[WOX] + 1
			call SaveInteger(HY,'0SND','0PID', WOX)
			set W0X = GetObjectName('n0HJ')
			call T0X(PlayersColoerText[WOX] +(PlayersName[GetPlayerId((WEX))])+ "|r " + GetObjectName('n04D')+ " |c0000FFFF" + W0X + "|r" + GetObjectName('n04B'), 3)
		endif
		if IS[WOX]> 4 then
			set PlayerTripleKillCount[WOX]= PlayerTripleKillCount[WOX] + 1
			call SaveInteger(HY,'0SND','0PID', WOX)
			set W0X = GetObjectName('n0HK')
			call T0X(PlayersColoerText[WOX] +(PlayersName[GetPlayerId((WEX))])+ "|r " + GetObjectName('n04K')+ " |c0000AAFF" + W0X + "|r" + GetObjectName('n04B'), 4)
		endif
	endif
	if (U8X == false) then
		set XS[WRX]= 0
	endif
	set XS[0]= 0
	set XS[6]= 0
	set PlayerHeroDeathCount[WRX]= PlayerHeroDeathCount[WRX] + 1
	if WLX then
		set WMX = .4
	endif
	if U8X and(GetUnitAbilityLevel(U9X,'A06B')+ GetUnitAbilityLevel(U9X,'A471')> 0) then
		if GetUnitAbilityLevel(U9X,'A06B')> 0 then
			set WPX = .5
		else
			set WPX = .3
		endif
	else
		if GetUnitAbilityLevel(U9X,'A471')> 0 then
			set WPX = .8
			set U2 = U9X
			call ExecuteFunc("W3X")
		endif
	endif
	set WTX =((GetHeroLevel(U9X)* 3.8 + 5 + R2I(LoadReal(OtherHashTable, GetHandleId(U9X), 26)))* WPX + WSX)+ R2I(WQX)
	if GYV then
		set WTX = WTX * .5
	endif
	if M3 then
		set PlayerDeathTime[WRX]= 0
		call TimerStart(PS[WRX], 1., false, null)
	else
		set PlayerDeathTime[WRX]= PlayerDeathTime[WRX] + R2I(WTX)
		if GV then
			call StoreDrCacheData("LoD_DeadFor_" + R2S(WTX), GetPlayerId(WXX))
		endif
		call TimerStart(PS[WRX], WTX, false, null)
	endif
	call TriggerExecute(UpdateMainMultiboardPlayerKDATrig)
	if not Mode__DeathMatch then
		call CreateHeroReviveTimer(U9X, WTX)
	else
		if IsSentinelPlayer(WXX) then
			set TeamHeroKillsCount[0]= TeamHeroKillsCount[0] + 1
		endif
		if IsScourgePlayer(WXX) then
			set TeamHeroKillsCount[1]= TeamHeroKillsCount[1] + 1
		endif
		// debug call SingleDebug( "记录单位 索引" + I2S( WRX ) + GetUnitName(U9X))
		set OW[WRX]= U9X
		if GetUnitTypeId(U9X)=='H00J' then
			set OW[WRX]=(LoadUnitHandle(HY,(GetHandleId(GetOwningPlayer(U9X))), 699))
		endif
		if Mode__HolyShitLimit and WFX >= 10 then
			call SaveBoolean(HY, GetHandleId(U9X),'suic', true)
	
			if IsSentinelPlayer(WEX) then
				set TeamHeroKillsCount[1]= TeamHeroKillsCount[1] - 5
				set TeamHeroUseLivesCount[0] = TeamHeroUseLivesCount[0] - 5
			endif
			if IsScourgePlayer(WEX) then
				set TeamHeroKillsCount[0]= TeamHeroKillsCount[0] - 5
				set TeamHeroUseLivesCount[1] = TeamHeroUseLivesCount[1] - 5
			endif
			set XS[WOX] = 0
			if UnitAlive(WVX) then
				call KillUnit(WVX)
				call DisplayTimedTextToAllPlayer(AllPlayerForce, DisplayTextDuration[LocalPlayerId], PlayersColoerText[WOX] +(PlayersName[GetPlayerId((WEX))])+ "|r 已经 |c00ff8000" + GetObjectName('n03X')+ "|r 并自动死亡，其队伍额外增加5条生命值。")
			else
				call DisplayTimedTextToAllPlayer(AllPlayerForce, DisplayTextDuration[LocalPlayerId], PlayersColoerText[WOX] +(PlayersName[GetPlayerId((WEX))])+ "|r 已经 |c00ff8000" + GetObjectName('n03X')+ "|r ，其队伍额外增加5条生命值。")
			endif
		endif
		if TeamHeroKillsCount[0]== DeathMatch__MaxLives then
			call TriggerExecute(WorldTreeDeathTrig)
		endif
		if TeamHeroKillsCount[1]== DeathMatch__MaxLives then
			call TriggerExecute(FrozenThroneDeathTrig)
		endif
		if (GetUnitAbilityLevel(U9X,'Z234')> 0) then
			call ExecuteFunc("T8X")
		elseif GetUnitAbilityLevel(U9X,'Q231')> 0 then
			set VK = U9X
			call ExecuteFunc("W4X")
		elseif GetUnitAbilityLevel(U9X,'A0CY')> 0 then
			set VK = U9X
			call ExecuteFunc("W5X")
		endif
	endif
	set U9X = null
	set WVX = null
	set WEX = null
	set WXX = null
	set t = null
	set WZX = null
	set W_X = null
endfunction
function W6X takes unit killingUnit, unit triggerUnit returns nothing
	local player p = GetOwningPlayer(killingUnit)
	local string s
	local integer W7X = SMX(triggerUnit, killingUnit)
	local integer i = 1
	local integer pid
	local integer goldBonus = 150
	if p == SentinelPlayers[0]or p == ScourgePlayers[0] then
		call SSX(triggerUnit, killingUnit, goldBonus)
		set s = SLX(triggerUnit, killingUnit)+ " " + GetObjectName('n04W')+ " |c00ff0303" + GetObjectName('n04Y')+ GetObjectName('n049')+ "|r "
		call SetTopMessageText(s, 8.)
		if W7X > 1 then
			set s = s + "(+" + I2S(goldBonus)+ " " + GetObjectName('n044')+ ")"
		else
			set s = s + "(+" + I2S(goldBonus)+ " " + GetObjectName('n045')+ ")"
		endif
		loop
		exitwhen i > 5
			if IsSentinelPlayer(GetOwningPlayer(killingUnit)) then
				set pid = GetPlayerId(SentinelPlayers[i])
			else
				set pid = GetPlayerId(ScourgePlayers[i])
			endif
			set i = i + 1
		endloop
	else
		set pid = GetPlayerId(p)
		set s = PlayersColoerText[pid] +(PlayersName[pid])+ "|r " + GetObjectName('n04W')+ " |c00ff0303" + GetObjectName('n04Y')+ GetObjectName('n049')+ "|r "
		call SetTopMessageText(s, 8.)
		set s = s + "(+" + I2S(goldBonus)+ " " + GetObjectName('n045')+ ")"
		call B8X(p, goldBonus, Player__Hero[pid])
		set PlayersReliableGold[pid]= PlayersReliableGold[pid] + goldBonus
	endif
	call DisplayTimedTextToAllPlayer(AllPlayerForce, DisplayTextDuration[LocalPlayerId], s)
	call BWX(P0)
	set PR = true
	set p = null
endfunction
function W8X takes nothing returns nothing
	local unit killingUnit = GetKillingUnit()
	local unit triggerUnit = GetTriggerUnit()
	local player pk = GetOwningPlayer(killingUnit)
	if PR == false then
		if pk != NeutralCreepPlayer and killingUnit != null and IsPlayerEnemy(GetOwningPlayer(triggerUnit), pk) then
			if pk == SentinelPlayers[0]or pk == ScourgePlayers[0] then
				if SMX(triggerUnit, killingUnit)> 0 then
					call W6X(killingUnit, triggerUnit)
				endif
			else
				call W6X(killingUnit, triggerUnit)
			endif
		endif
	endif
	set killingUnit = null
	set triggerUnit = null
endfunction
function W9X takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player p
	local real YVX
	local unit u =(LoadUnitHandle(HY, h, 0))
	local integer c =(LoadInteger(HY, h, 34))
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED then
		set c = c + 1
		call SaveInteger(HY, h, 34,(c))
	endif
	if c > 5 / .05 or(GetTriggerEventId() == EVENT_UNIT_DAMAGED and GetEventDamage()> 20) or GetUnitAbilityLevel(u,'A3KL') == 0 then
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	else
		call SetUnitState(u, UNIT_STATE_LIFE, GetUnitState(u, UNIT_STATE_LIFE)+ .2 * GetUnitState(u, UNIT_STATE_MAX_LIFE)* .05)
		call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ .2 * GetUnitState(u, UNIT_STATE_MAX_MANA)* .05)
	endif
	set t = null
	set u = null
endfunction
function YEX takes unit u returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function W9X))
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call UnitAddAbilityToTimed(u,'A3KL', 1, 5,'B3KL')
	call SaveReal(HY, GetHandleId(t), 0, GetGameTime()+ 5)
	set t = null
endfunction
function YXX takes nothing returns nothing
	local integer i = 1
	local unit u
	set E7V = null
	loop
	exitwhen i > 5
		set u = Player__Hero[GetPlayerId(SentinelPlayers[i])]
		if u != null and GetItemOfTypeFromUnit(u, XOV[AIV])!= null then
			call DisableTrigger(CUV)
			call StoreDrCacheData("AegisOff", GetPlayerId(GetOwningPlayer(u)))
			call RemoveItem(GetItemOfTypeFromUnit(u, XOV[AIV]))
			call EnableTrigger(CUV)
			call YEX(u)
		endif
		set u = Player__Hero[GetPlayerId(ScourgePlayers[i])]
		if u != null and GetItemOfTypeFromUnit(u, XOV[AIV])!= null then
			call DisableTrigger(CUV)
			call StoreDrCacheData("AegisOff", GetPlayerId(GetOwningPlayer(u)))
			call RemoveItem(GetItemOfTypeFromUnit(u, XOV[AIV]))
			call EnableTrigger(CUV)
			call YEX(u)
		endif
		set i = i + 1
	endloop
	set u = null
endfunction
function YOX takes string YRX, string YIX returns string
	local string s = GetObjectName('n0CA')
	set s = StringReplace(s, "$team", YRX)
	set s = StringReplace(s, "$team", YIX)
	return s
endfunction

function YBX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local group g = AllocationGroup(17)
	local real rDamage = 70 + R2I(GetGameTime()/240)* 20
	local unit firstUnit = null
	call GroupEnumUnitsInRange(g, GetUnitX(Roshan), GetUnitY(Roshan), 375, null)
	call GroupRemoveUnit( g, Roshan )
	loop
		set firstUnit = FirstOfGroup( g )
		exitwhen firstUnit == null
		call GroupRemoveUnit( g, firstUnit )
		if UnitAlive(firstUnit) and GetUnitAbilityLevel(firstUnit,'BCtc')> 0 then
			call UnitDamageTargetEx(Roshan, firstUnit, 1, rDamage)
		endif
	endloop
	call DeallocateGroup(g)
	call DestroyTimer(t)
	set g = null
	set t = null
endfunction
function YCX takes nothing returns nothing
	call TimerStart(CreateTimer(), 0, false, function YBX)
endfunction

function IsHero takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO)))
endfunction

function YGX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local real time = GetGameTime()-PickModeElapsed
	local integer WUV = R2I(time / 600)
	if WUV > 4 then
		set WUV = 4
	endif
	if UnitIsDead(Roshan) == false and WUV > 0 and PickModeElapsed > 0 then
		call UnitAddPermanentAbility(Roshan,'A43T')
		call UnitAddPermanentAbility(Roshan,'A43U')
		call SetUnitAbilityLevel(Roshan,'A43T', WUV)
		call SetUnitAbilityLevel(Roshan,'A43U', WUV)
	endif
	set t = null
endfunction
function YHX takes nothing returns nothing
	local integer hp = E9V * 500
	local integer YJX = LoadInteger(HY, GetHandleId(Roshan),'MXHP')
	if hp != YJX then
		call UnitAddMaxLife(Roshan, IMaxBJ(hp -YJX, 0))
		call SaveInteger(HY, GetHandleId(Roshan),'MXHP', hp)
	endif
endfunction
function YKX takes nothing returns nothing
	local integer YLX ='A3BA'
	local integer level = 0
	local integer IMX = 0
	local integer YMX = IMinBJ(E9V, 20)
	if E9V == 0 then
		return
	endif
	set IMX = R2I((YMX -1)/ 4)
	set level = YMX -IMX * 4
	call UnitAddPermanentAbilitySetLevel(Roshan, YLX + IMX, level)
endfunction
function YPX takes nothing returns boolean
	set E9V = GetTriggerEvalCount(GetTriggeringTrigger())
	if Roshan != null and GetUnitState(Roshan, UNIT_STATE_LIFE)> 1 then
		call YHX()
		call SetPlayerTechResearched(GetOwningPlayer(Roshan),'R00F', E9V)
		call YKX()
	endif
	return false
endfunction
function YQX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = null
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		call ExecuteFunc("YSX")
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
		call YCX()
	else
		if GetUnitAbilityLevel(Roshan,'B0BI') == 0 then
			call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 1)
		endif
		if LoadInteger(HY, h, 0) == 15 or GetTriggerEvalCount(t) == 1 then
			call SaveInteger(HY, h, 0, 0)
			set u = CreateUnit(NeutralCreepPlayer,'e00E', GetUnitX(Roshan), GetUnitY(Roshan), 0)
			call UnitAddAbility(u,'A3KM')
			call IssueTargetOrderById(u, 852572, Roshan)
			set u = null
		endif
		if GetOwningPlayer(Roshan) == NeutralCreepPlayer and ModuloInteger(GetTriggerEvalCount(t), 10) == 0 then
			if not RectContainsUnit(FI, Roshan) then
				if (LoadBoolean(HY,(h), 91)) then
					call SaveBoolean(HY,(h), 91,(false))
				else
					call SetUnitPosition(Roshan, GetRectCenterX(gg_rct_RoshanSpawn), GetRectCenterY(gg_rct_RoshanSpawn))
					call SaveBoolean(HY,(h), 91,(true))
				endif
			endif
		endif
	endif
	set t = null
	return false
endfunction
function YTX takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterUnitEvent(t, Roshan, EVENT_UNIT_DEATH)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function YQX))
	call SaveBoolean(HY,(h), 91,(true))
	
	call TriggerRegisterUnitEvent(t, Roshan, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterUnitEvent(t, Roshan, EVENT_UNIT_SPELL_CAST)

	set t = null
endfunction
function YUX takes nothing returns nothing
	set Roshan = CreateUnit(Player(12),'n00L', GetRectCenterX(gg_rct_RoshanSpawn), GetRectCenterY(gg_rct_RoshanSpawn), 180.)
	call SetUnitAcquireRange(Roshan, 150)
	call YTX()
	if XEV > 1 then
		call UnitRemoveAbility(Roshan,'A0K2')
		call UnitAddAbility(Roshan,'A0Q6')
		call UnitAddItem(Roshan, CreateItem(XOV[R7V], 0, 0))
	endif
	call UnitAddItem(Roshan, CreateItem(XOV[AAV], 0, 0))
	call YKX()
endfunction
function YWX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local real XEX
	local integer WTX = LoadInteger(HY, GetHandleId(t), 0)
	if GetTriggerEvalCount(t) == WTX or FPV then
		set FPV = false
		call YXX()
		set XEV = XEV + 1
		call YUX()
		call YHX()
		call SetPlayerTechResearched(GetOwningPlayer(Roshan),'R00F', E9V)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEvalCount(t) == 300 then
		call YXX()
	endif
	set t = null
	return false
endfunction
function YSX takes nothing returns nothing
	local trigger t = CreateTrigger()
	local item it
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function YWX))
	if JE then
		call SaveInteger(HY, GetHandleId(t), 0, GetRandomInt(4, 6))
	else
		call SaveInteger(HY, GetHandleId(t), 0, GetRandomInt(480, 660))
	endif
	set FPV = false
	set E8V = false
	set it = CreateItem(XXV[AIV], GetUnitX(Roshan), GetUnitY(Roshan))
	call SetItemCharges(it, 1)
	if GetUnitAbilityLevel(Roshan,'A0Q6') == 1 then
		set it = CreateItem(XXV[R6V], GetUnitX(Roshan), GetUnitY(Roshan))
		call SetItemCharges(it, 1)
	endif
	call RemoveItem(UnitRemoveItemFromSlot(Roshan, 0))
	call RemoveItem(UnitRemoveItemFromSlot(Roshan, 1))
	call CreateUnitAtLoc(Player(12),'e01V', GetRectCenter(gg_rct_RoshanSpawn), 0)
	if (IsSentinelPlayer(GetOwningPlayer(GetKillingUnit()))) then
		call StoreDrCacheData("Roshan", 0)
		call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, DisplayTextDuration[LocalPlayerId], YOX("|c00ff0000" + GetObjectName('n065')+ "|r", GetObjectName('n065')))
		set GN = 0
		call AddPlayerResourceGold(SentinelPlayers[1], 200)
		call AddPlayerResourceGold(SentinelPlayers[2], 200)
		call AddPlayerResourceGold(SentinelPlayers[3], 200)
		call AddPlayerResourceGold(SentinelPlayers[4], 200)
		call AddPlayerResourceGold(SentinelPlayers[5], 200)
	endif
	if (IsScourgePlayer(GetOwningPlayer(GetKillingUnit()))) then
		call StoreDrCacheData("Roshan", 1)
		call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, DisplayTextDuration[LocalPlayerId], YOX("|c00004000" + GetObjectName('n06C')+ "|r", GetObjectName('n06C')))
		set GN = 1
		call AddPlayerResourceGold(ScourgePlayers[1], 200)
		call AddPlayerResourceGold(ScourgePlayers[2], 200)
		call AddPlayerResourceGold(ScourgePlayers[3], 200)
		call AddPlayerResourceGold(ScourgePlayers[4], 200)
		call AddPlayerResourceGold(ScourgePlayers[5], 200)
	endif
	set it = null
	set t = null
endfunction
function YYX takes integer id, player triggerUnit, player killingUnit returns string
	local string s
	if id == 'np00' then
		set s = GetObjectName('n0ZJ')
	elseif id == 'n00I' then
		set s = GetObjectName('n0ZC')
	else
		set s = GetObjectName('n0AP')
	endif
	set s = StringReplace(s, "$dead", PlayersName[GetPlayerId(triggerUnit)])
	return s
endfunction
function YZX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	call SetTerrainPathable(x, y, PATHING_TYPE_WALKABILITY, false)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function Y_X takes unit whichUnit returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	call SetTerrainPathable(x, y, PATHING_TYPE_WALKABILITY, true)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function YZX))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	set whichUnit = null
	set t = null
endfunction
function Y0X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit Y1X =(LoadUnitHandle(HY, h, 2))
	local integer count = GetTriggerEvalCount(t)
	local integer Y2X = LoadInteger(HY, h, 0)-count
	local integer i = 1
	local integer id
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	loop
	exitwhen i > 5
		if IsPlayerAlly(GetOwningPlayer(Y1X), SentinelPlayers[0]) then
			set id = GetPlayerId(SentinelPlayers[i])
		else
			set id = GetPlayerId(ScourgePlayers[i])
		endif
		set i = i + 1
		if Y2X == 0 then
			if IsPlayerAlly(SentinelPlayers[0], Player(id)) then
				set RL[GetPlayerId(SentinelPlayers[0])]= false
			endif
			if IsPlayerAlly(ScourgePlayers[0], Player(id)) then
				set RL[GetPlayerId(ScourgePlayers[0])]= false
			endif
		endif
	endloop
	if Y2X == 2 then
		call SetUnitPosition(Y1X, x, y)
	endif
	if Y2X == 0 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set Y1X = null
	return false
endfunction
function Y3X takes nothing returns nothing
	if ((GetUnitLevel(GetEnumUnit())< 25 or G0V) and GetUnitAbilityLevel(GetEnumUnit(),'Aloc') == 0) then
		call AddHeroXPSimple(GetEnumUnit(), WB, true)
	endif
endfunction
function Y4X takes integer xp, player p, unit killingUnit returns nothing
	if (xp > 0 and p != NeutralCreepPlayer and p != null) then
		if IsUnitType(GetTriggerUnit(), UNIT_TYPE_SUMMONED) then
			set xp = R2I(xp * .5)
		endif
		set SB = killingUnit
		call UDX()
		if (FirstOfGroup(IV)!= null) then
			set WB = R2I(xp / CountUnitsInGroup(IV))
			call ForGroup(IV, function Y3X)
		endif
		set SB = null
	endif
endfunction
function Y5X takes nothing returns boolean
	local real x
	local real y
	local unit Y1X = GetTriggerUnit()
	local integer i = 1
	local integer Y6X = 175
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	if OPX(Y1X) then
		set Y6X = 150
		call SaveInteger(HY, h, 0, 140)
		call SaveReal(HY, GetHandleId(Y1X),'DEAD', GetGameTime()+ 140)
	else
		call SaveInteger(HY, h, 0, 180)
		call SaveReal(HY, GetHandleId(Y1X),'DEAD', GetGameTime()+ 180)
	endif
	call StoreDrCacheData("Courier" + I2S(GetPlayerId(GetOwningPlayer(Y1X))), GetPlayerId(GetOwningPlayer(GetKillingUnit())))
	
	call DisplayTimedTextToAllPlayer(AllPlayerForce, 10., YYX(GetUnitTypeId(Y1X), GetOwningPlayer(Y1X), GetOwningPlayer(GetKillingUnit())))
	if IsUnitEnemy(LoadUnitHandle(HY, GetHandleId(Y1X),'lstd'), GetOwningPlayer(Y1X)) then
		call Y4X(349, GetOwningPlayer(LoadUnitHandle(HY, GetHandleId(Y1X),'lstd')), LoadUnitHandle(HY, GetHandleId(Y1X),'lstd'))
	endif
	call PingMinimapEx(GetUnitX(Y1X), GetUnitY(Y1X), 6, 255, 0, 0, false)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function Y0X))
	call SaveUnitHandle(HY, h, 2,(Y1X))
	if IsPlayerAlly(GetOwningPlayer(Y1X), SentinelPlayers[0]) and RL[GetPlayerId(SentinelPlayers[0])]== false then
		set RL[GetPlayerId(SentinelPlayers[0])]= true
		loop
		exitwhen i > 5
			call GivePlayerGoldBonus(ScourgePlayers[i], Y6X)
			set i = i + 1
		endloop
	endif
	set i = 1
	if IsPlayerAlly(GetOwningPlayer(Y1X), ScourgePlayers[0]) and RL[GetPlayerId(ScourgePlayers[0])]== false then
		set RL[GetPlayerId(ScourgePlayers[0])]= true
		loop
		exitwhen i > 5
			call GivePlayerGoldBonus(SentinelPlayers[i], Y6X)
			set i = i + 1
		endloop
	endif
	if GetPlayerTeam(GetOwningPlayer(Y1X)) == 0 then
		set x = GetRectCenterX(gg_rct_SentinelRevivalPoint)
		set y = GetRectCenterY(gg_rct_SentinelRevivalPoint)
	else
		set x = GetRectCenterX(gg_rct_ScourgeRevivalPoint)
		set y = GetRectCenterY(gg_rct_ScourgeRevivalPoint)
	endif
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	if IsTerrainPathable(GetUnitX(Y1X), GetUnitY(Y1X), PATHING_TYPE_WALKABILITY) then
		call Y_X(Y1X)
	endif
	set t = null
	set Y1X = null
	return false
endfunction
function Y7X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local real x = HS
	local real y = ZS
	if IsScourgePlayer(GetOwningPlayer(whichUnit)) then
		set x = A7
		set y = N7
	endif
	if MessengerIsDead(whichUnit) == false then
		if GetDistanceBetween(GetUnitX(whichUnit), GetUnitY(whichUnit), x, y)< 800 then
			call UPV(whichUnit, "在家")
			//	call UnitAddPermanentAbility(whichUnit,'Avul')
			//	else
			//	call UnitRemoveAbility(whichUnit,'Avul')
		endif
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function Y8X takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	if HaveSavedHandle(OtherHashTable, GetHandleId(p),'COUR') == false then
		call SaveUnitHandle(OtherHashTable, GetHandleId(p),'COUR', u)
	endif
endfunction
function Y9X takes player p returns nothing
	if HaveSavedHandle(OtherHashTable, GetHandleId(p),'COUR') then
		if GetPlayerAlliance(GetOwningPlayer(LoadUnitHandle(OtherHashTable, GetHandleId(p),'COUR')), p, ALLIANCE_SHARED_CONTROL) then
			return
		endif
	endif
	call SaveUnitHandle(OtherHashTable, GetHandleId(p),'COUR', HJX(p))
endfunction
function ZVX takes unit c returns nothing
	if UnitAlive(c) == false then
		call UnitRemoveAbility(c,'A00D')
		call UnitRemoveAbility(c,'A2HR')
		call UnitRemoveAbility(c,'A1VR')
		call UnitRemoveAbility(c,'A38Z')
		call UnitRemoveAbility(c,'A12V')
		call UnitRemoveAbility(c,'A05U')
		call UnitRemoveAbility(c,'AIms')
		call UnitRemoveAbility(c,'A2I9')
		call UnitRemoveAbility(c,'EUL1')
		call UnitRemoveAbility(c,'EUL2')
		call SetUnitState(c, UNIT_STATE_MANA, 0)
		call UnitRemoveAbility(c,'AImb')
	endif
endfunction
function ZEX takes nothing returns nothing
	local integer id
	local unit u
	local integer h = GetHandleId(GetTriggeringTrigger())
	local integer c
	local real x
	local real y
	if GetTriggerEventId()!= EVENT_GAME_TIMER_EXPIRED then
		set id = GetIssuedOrderId()
		if id >=852008 and id <= 852013 then
			set id = GetItemIndexEx(UnitItemInSlot(GetTriggerUnit(), id -852008))
			// and not( id == I9V or id == AVV or id == AEV or id == AXV or id == AOV or id == ARV ) 让信使能用BKB
			if id != R_V and id != RYV and id != RPV and id != IVV then
				call EXStopUnit(GetTriggerUnit())
			endif
		elseif id !='h085' and id != 852663 and id != 851973 and id !='h0DE' and id !='h0BV' and id != 852252 and id != 852247 and id != 852246 and id != 852100 and(GetIssuedOrderId()< 852002 or GetIssuedOrderId()>852013) then
			if UQV(GetTriggerUnit()) == false then
				call UPV(GetTriggerUnit(), "控制中")
			endif
		endif
	else
		set u = LoadUnitHandle(HY, h, 0)
		if MessengerIsDead(u) then
			set u = null
			return
		endif
		set id = GetUnitCurrentOrder(u)
		set x = HS
		set y = ZS
		//	if IsScourgePlayer(GetOwningPlayer(u)) then//测试
		if GetPlayerTeam(GetOwningPlayer(u)) == 0 then
			set x = A7
			set y = N7
		endif
		if GetDistanceBetween(GetUnitX(u), GetUnitY(u), x, y)< 800 then
			call UPV(GetTriggerUnit(), "在家")
		elseif id == 852001 then
			call UPV(GetTriggerUnit(), "控制中")
		elseif LoadReal(HY, h, 0) == GetUnitX(u) and LoadReal(HY, h, 1) == GetUnitY(u) then
			call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 1)
			if LoadInteger(HY, h, 0)>= 5 then
				call UPV(u, "待命")
			endif
		else
			if LoadInteger(HY, h, 0)> 0 then
				call SaveInteger(HY, h, 0, 0)
				call UPV(u, "移动中")
			endif
			call SaveReal(HY, h, 0, GetUnitX(u))
			call SaveReal(HY, h, 1, GetUnitY(u))
		endif
		if ModuloInteger(GetTriggerEvalCount(GetTriggeringTrigger()), 10) == 1 then
			call ZVX(u)
		endif
	endif
	set u = null
endfunction
function ZXX takes nothing returns nothing
	local unit targetUnit = GetTriggerUnit()
	local unit R8X = GetEventDamageSource()
	if GetEventDamage()> 0 then
		call SaveUnitHandle(HY, GetHandleId(targetUnit),'lstd', R8X)
		if AD < 1 and IsUnitType(R8X, UNIT_TYPE_MELEE_ATTACKER) and IsUnitIdType(GetUnitTypeId(R8X), UNIT_TYPE_HERO) then
			call IOX(R8X, targetUnit, 10, GetEventDamage()* .5, .0)
		endif
	endif
	set targetUnit = null
	set R8X = null
endfunction
function ZOX takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function Y5X))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function Y7X))
	call SaveUnitHandle(HY, h, 2,(u))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_ORDER)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function ZEX))
	call SaveUnitHandle(HY, h, 0, u)
	call Y8X(u)
	set t = null
	if MV == null then
		set MV = CreateTrigger()
		call TriggerAddCondition(MV, Condition(function ZXX))
	endif
	call TriggerRegisterUnitEvent(MV, u, EVENT_UNIT_DAMAGED)
endfunction
function ZRX takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	local integer pid = GetPlayerId(p)
	if IsUnitMessenger(u) and IsUnitIllusion(u) == false then
		call DisplayTimedTextToAllPlayer(AllPlayerForce, 10., PlayersColoerText[pid] + PlayersName[pid] + "|r的信使被 |c00ff0000永久地|r 杀死了.它不会再复活.")
		call PingMinimapEx(GetUnitX(u), GetUnitY(u), 6, 255, 0, 0, false)
	endif
endfunction
function ZIX takes integer id returns integer
	if id =='I006' then
		return'I0QB'
	elseif id =='I007' then
		return'I0QC'
	elseif id =='I00K' then
		return'I0QD'
	elseif id =='I008' then
		return'I0QE'
	elseif id =='I00J' then
		return'I0QF'
	elseif id =='I0QA' then
		return'I0QG'
	endif
	return 0
endfunction
function ZAX takes integer id returns integer
	if id =='I0QB' then
		return'I006'
	elseif id =='I0QC' then
		return'I007'
	elseif id =='I0QD' then
		return'I00K'
	elseif id =='I0QE' then
		return'I008'
	elseif id =='I0QF' then
		return'I00J'
	elseif id =='I0QG' then
		return'I0QA'
	endif
	return 0
endfunction
function ZNX takes integer i returns boolean	//各种神符
	return i =='I0QB' or i =='I0QC' or i =='I0QD' or i =='I0QE' or i =='I0QF' or i =='I0QG'
endfunction
function ZBX takes integer i returns boolean
	return i =='I006' or i =='I008' or i =='I00J' or i =='I00K' or i =='I007' or i =='I0QA'
endfunction
function ZCX takes nothing returns nothing
	if GetWidgetLife(GetEnumItem())> 0 and ZNX(GetItemTypeId(GetEnumItem())) then
		set Z2 = GetEnumItem()
	endif
endfunction
function ZDX takes nothing returns integer
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != CXV
		set i = GetRandomInt(1, 5)
	endloop
	set CXV = i
	return i
endfunction
function ZFX takes nothing returns nothing
	set NV = false
endfunction
function RuneRefresh__CallBack takes nothing returns boolean
	local boolean ZHX = false
	local boolean ZJX = false
	local real x
	local real y
	local real dx
	local real dy
	local real x1
	local real y1
	local real x2
	local real y2
	local integer ZKX
	set x1 = GetLocationX(LeftTopRuneLocatio)
	set y1 = GetLocationY(LeftTopRuneLocatio)
	set x2 = GetLocationX(RightBottomRuneLocatio)
	set y2 = GetLocationY(RightBottomRuneLocatio)
	set Z2 = null
	call EnumItemsInRect(gg_rct_LeftTopRune, null, function ZCX)
	set ZHX = true
	if Z2 != null then
		call RemoveItem(Z2)
	endif
	set Z2 = null
	call EnumItemsInRect(gg_rct_RightBottomRune, null, function ZCX)
	set ZJX = true
	if Z2 != null then
		call RemoveItem(Z2)
	endif
	set ZKX = ZDX()
	if GetRandomInt(1, 2) == 1 then
		set x = x1
		set y = y1
		set dx = x2
		set dy = y2
	else
		set x = x2
		set y = y2
		set dx = x1
		set dy = y1
	endif
	if FV then
		set FV = false
		call CreateItem(ZIX('I0QA'), dx, dy)
		call CreateItem(ZIX('I0QA'), x, y)
		call TimerStart(CreateTimer(), 120, false, function ZFX)
	else
		if ZKX == 1 then
			call CreateItem(ZIX('I007'), x, y)
		elseif ZKX == 2 then
			call CreateItem(ZIX('I006'), x, y)
		elseif ZKX == 3 then
			call CreateItem(ZIX('I00K'), x, y)
		elseif ZKX == 4 then
			call CreateItem(ZIX('I008'), x, y)
		elseif ZKX == 5 then
			call CreateItem(ZIX('I00J'), x, y)
		endif
		call CreateItem(ZIX('I0QA'), dx, dy)
	endif
	return false
endfunction
function ZLX takes unit u returns nothing
	local real x
	local real y
	if GetPlayerTeam(GetOwningPlayer(u)) == 0 then
		set x = GetRectCenterX(gg_rct_SentinelRevivalPoint)
		set y = GetRectCenterY(gg_rct_SentinelRevivalPoint)
	else
		set x = GetRectCenterX(gg_rct_ScourgeRevivalPoint)
		set y = GetRectCenterY(gg_rct_ScourgeRevivalPoint)
	endif
	call USV(u, 851986, x, y)
	call UPV(u, "回家")
endfunction
function ZMX takes nothing returns nothing
	local item C1X = GetEnumItem()
	if GetWidgetLife(C1X)> 0 and GetItemPlayer(C1X) == CMV and CSV == 0 then
		set CSV = CSV + 1
		call UnitAddItem(CPV, C1X)
	endif
	set C1X = null
endfunction
function ZPX takes nothing returns nothing
	local item C1X = GetEnumItem()
	if GetWidgetLife(C1X)> 0 and GetItemPlayer(C1X) == CMV then
		call UnitAddItem(CQV, C1X)
	endif
	set C1X = null
endfunction
function ZQX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 2))
	local unit ZSX =(LoadUnitHandle(HY, h, 92))
	local player p =(LoadPlayerHandle(HY, h, 54))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local rect r = Rect(x -300, y -300, x + 300, y + 300)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set CMV = p
		set CPV = trigUnit
		set CQV = ZSX
		call EnumItemsInRect(r, null, function ZPX)
	else
		if GetTriggerEvalCount(t)> 9 then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			set CMV = p
			set CPV = trigUnit
			set CQV = ZSX
			call EnumItemsInRect(r, null, function ZPX)
		else
			set CMV = p
			set CPV = trigUnit
			set CSV = 0
			call EnumItemsInRect(r, null, function ZMX)
		endif
	endif
	call RemoveRect(r)
	set t = null
	set trigUnit = null
	set ZSX = null
	set r = null
	return false
endfunction
function ZTX takes unit ZSX, unit trigUnit returns nothing
	local player p = GetOwningPlayer(trigUnit)
	local integer i
	local item C1X
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x = GetUnitX(ZSX)
	local real y = GetUnitY(ZSX)
	local integer GTX
	if IsTerrainPathable(x, y, PATHING_TYPE_WALKABILITY) then
		set x = GetUnitX(trigUnit)
		set y = GetUnitY(trigUnit)
	endif
	call TriggerRegisterDeathEvent(t, trigUnit)
	call TriggerRegisterTimerEvent(t, .01, true)
	call TriggerAddCondition(t, Condition(function ZQX))
	call SaveUnitHandle(HY, h, 2,(trigUnit))
	call SaveUnitHandle(HY, h, 92,(ZSX))
	call SavePlayerHandle(HY, h, 54,(p))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	set i = 0
	loop
	exitwhen i > 5
		set C1X = UnitItemInSlot(ZSX, i)
		set GTX = GetItemIndexEx(C1X)
		if C1X != null and GetItemPlayer(C1X) == p and(GTX != O3V and GTX != O4V and GTX != O5V and GTX != O6V and GTX != O7V) then
			call UnitRemoveItem(ZSX, C1X)
			call SetItemPosition(C1X, x, y)
		endif
		set i = i + 1
	endloop
	set t = null
	set C1X = null
endfunction
function ZUX takes unit ZWX returns boolean
	local integer i = GetUnitCurrentOrder(ZWX)
	return(i == 0) or(i == 851975) or(i == 851987) or(i == 851993)
endfunction
function ZYX takes integer h returns nothing
	local unit Y1X = LoadUnitHandle(HY, h, 92)
	local unit targetUnit = LoadUnitHandle(HY, h, 2)
	local real x
	local real y
	local real EOX
	local real ms
	local real I3X
	local real ZZX
	local real Z_X
	local real Z0X
	local real Z1X
	local real hx = GetUnitX(targetUnit)
	local real hy = GetUnitY(targetUnit)
	if (ZUX(targetUnit) == false) then
		set x = GetUnitX(targetUnit)
		set y = GetUnitY(targetUnit)
		set ZZX = LoadReal(HY, h, 677)
		set Z_X = LoadReal(HY, h, 678)
		call SaveReal(HY, h, 677, x * 1.)
		call SaveReal(HY, h, 678, y * 1.)
		set I3X = Atan2(y -Z_X, x -ZZX)
		set EOX = SquareRoot((x -ZZX)*(x -ZZX)+(y -Z_X)*(y -Z_X))/ .2
		set ms = GetHeroMoveSpeed(Y1X)
		set Z0X = GetDistanceBetween(GetUnitX(targetUnit), GetUnitY(targetUnit), GetUnitX(Y1X), GetUnitY(Y1X))
		set Z1X = RAbsBJ(I3X * bj_RADTODEG -GetUnitFacing(Y1X))
		if (Z0X < ms -EOX and ms > EOX) or(Z0X < RMaxBJ(ms, EOX) and Z1X >= 90) then
		else
			set hx = x + EOX * Cos(I3X)
			set hy = y + EOX * Sin(I3X)
		endif
	endif
	call SaveInteger(HY, h, 679, 1)
	call USV(Y1X, 851986, hx, hy)
	set Y1X = null
	set targetUnit = null
endfunction
function Z2X takes hashtable h, integer pk, integer ck returns boolean
	call RemoveSavedInteger(h, pk, ck)
	return true
endfunction
function Z3X takes unit Y1X, unit KKX, boolean Z4X, integer Z5X returns nothing
	local integer i = 0
	local item it
	local integer k = 0
	local integer Z6X = 0
	local integer j
	local player p = GetOwningPlayer(KKX)
	local integer Z7X
	local integer Z8X
	local string s
	call FlushChildHashtable(HY,'ITEM')
	loop
		set it = UnitItemInSlot(Y1X, i)
		if it != null and(GetItemPlayer(it) == p or GetPlayerSlotState(GetItemPlayer(it)) == PLAYER_SLOT_STATE_LEFT) then
			call SaveItemHandle(HY,'ITEM', k, it)
			call SaveInteger(HY,'ITEM', k, GetItemIndexEx(it))
			set k = k + 1
		endif
		set it = UnitItemInSlot(KKX, i)
		if it != null and(GetItemPlayer(it) == p or GetPlayerSlotState(GetItemPlayer(it)) == PLAYER_SLOT_STATE_LEFT) then
			call SaveItemHandle(HY,'ITEM', k, it)
			call SaveInteger(HY,'ITEM', k, GetItemIndexEx(it))
			set k = k + 1
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	set it = null
	if Z4X == false and k <= 6 then
		return
	endif
	set Z6X = k
	set k = 1
	if Z4X then
		set k = Z5X
	endif
	loop
		call SaveInteger(HY,'ITEM', 51, CombineIndex1[k])
		call SaveInteger(HY,'ITEM', 52, CombineIndex2[k])
		call SaveInteger(HY,'ITEM', 53, CombineIndex3[k])
		call SaveInteger(HY,'ITEM', 54, CombineIndex4[k])
		call SaveInteger(HY,'ITEM', 55, CombineIndex5[k])
		set Z8X = 0
		set Z7X = 0
		set i = 0
		if CombineIndex1[k]!= 0 then
			set Z7X = Z7X + 1
		endif
		if CombineIndex2[k]!= 0 then
			set Z7X = Z7X + 1
		endif
		if CombineIndex3[k]!= 0 then
			set Z7X = Z7X + 1
		endif
		if CombineIndex4[k]!= 0 then
			set Z7X = Z7X + 1
		endif
		if CombineIndex5[k]!= 0 then
			set Z7X = Z7X + 1
		endif
		loop
			set j = LoadInteger(HY,'ITEM', i)
			if j > 0 and LoadBoolean(HY,'ITEM', i)!= true then
				if (j == LoadInteger(HY,'ITEM', 51) and Z2X(HY,'ITEM', 51)) or(j == LoadInteger(HY,'ITEM', 52) and Z2X(HY,'ITEM', 52)) or(j == LoadInteger(HY,'ITEM', 53) and Z2X(HY,'ITEM', 53)) or(j == LoadInteger(HY,'ITEM', 54) and Z2X(HY,'ITEM', 54)) or(j == LoadInteger(HY,'ITEM', 55) and Z2X(HY,'ITEM', 55)) then
					call SaveItemHandle(HY,'ITEM', 100 + Z8X, LoadItemHandle(HY,'ITEM', i))
					call SaveBoolean(HY,'ITEM', i, true)
					call SaveInteger(HY,'ITEM', 200+ Z8X, i)
					set Z8X = Z8X + 1
				endif
			endif
			set i = i + 1
		exitwhen i >= Z6X
		endloop
		if Z8X > 0 then
			set i = 100 
			loop
				if Z8X == Z7X then
					set it = LoadItemHandle(HY,'ITEM', i)
					if CombinedIndex[k]== NIV then
						call SaveInteger(HY,'ITEM', 300, 8)
					elseif CombinedIndex[k]== IUV then
						call SaveInteger(HY,'ITEM', 300, 12)
					elseif CombinedIndex[k]== IWV then
						call SaveInteger(HY,'ITEM', 300, 12)
					elseif CombinedIndex[k]== Item_MagicWand then
						if GetItemIndexEx(it) == Item_MagicStick then
							call SaveInteger(HY,'ITEM', 300, GetItemCharges(it))
						endif
					endif
					call RemoveItem(it)
				else
					call RemoveSavedBoolean(HY,'ITEM', LoadInteger(HY,'ITEM', 100 + i))
				endif
				call RemoveSavedHandle(HY,'ITEM', i)
				set i = i + 1
			exitwhen HaveSavedHandle(HY,'ITEM', i) == false
			endloop
		endif
		if Z8X == Z7X then
			if Z4X == false then
				set it = UnitAddItemById(KKX, XOV[CombinedIndex[k]])
				if CombinedIndex[k]== NIV or CombinedIndex[k]== Item_MagicWand or CombinedIndex[k]== IUV or CombinedIndex[k]== IWV then
					if HaveSavedInteger(HY,'ITEM', 300) then
						call SetItemCharges(it, LoadInteger(HY,'ITEM', 300))
						call RemoveSavedInteger(HY,'ITEM', 300)
					endif
				endif
				call SetItemPlayer(it, p, true)
				call SetItemUserData(it, 0)
				call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIem\\AIemTarget.mdl", KKX, "origin"))
				set it = null
			else
				set it = CreateItem(XXV[CombinedIndex[k]], GetUnitX(KKX), GetUnitY(KKX))
				if CombinedIndex[k]== NIV or CombinedIndex[k]== Item_MagicWand or CombinedIndex[k]== IUV or CombinedIndex[k]== IWV then
					if HaveSavedInteger(HY,'ITEM', 300) then
						call SetItemCharges(it, LoadInteger(HY,'ITEM', 300))
						call RemoveSavedInteger(HY,'ITEM', 300)
					endif
				endif
				call SetItemPlayer(it, p, true)
				call SetItemUserData(it, 0)
				call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIem\\AIemTarget.mdl", KKX, "origin"))
				call UnitAddItem(KKX, it)
				set it = null
			endif
		endif
	exitwhen k >= CombineMaxIndex
		set k = k + 1
	endloop
endfunction
function Z9X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit ZSX =(LoadUnitHandle(HY, h, 92))
	local unit trigUnit =(LoadUnitHandle(HY, h, 2))
	local real x
	local real y
	local integer i
	local player p = GetOwningPlayer(trigUnit)
	local item C1X
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		if GetTriggerUnit() == trigUnit or UnitIsDead(trigUnit) then
			call ZLX(ZSX)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_UNIT_ISSUED_ORDER or GetTriggerEventId() == EVENT_UNIT_ISSUED_TARGET_ORDER or GetTriggerEventId() == EVENT_UNIT_ISSUED_POINT_ORDER then
		set i = GetIssuedOrderId()
		if (LoadInteger(HY, h, 679)) == 1 then
			call SaveInteger(HY, h, 679, 0)
		elseif i != 852100 and i != 852090 and i != 851973 and i != 851986 and not(i >= 852002 and i <= 852013) then
			call FlushChildHashtable(HY, h)	//不确定新增
			call CleanCurrentTrigger(t)
			call UPV(ZSX, "被中断")
		endif
	else
		if GetUnitDistanceEx(ZSX, trigUnit)< 350 then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			if UnitIsDead(trigUnit) == false then
				call Z3X(ZSX, trigUnit, false, 0)
				call ZTX(ZSX, trigUnit)
			endif
			call ZLX(ZSX)
			call UPV(ZSX, "回家")
		else
			call ZYX(GetHandleId(t))
			call UPV(ZSX, "运送给 " + PlayersColoerText[GetPlayerId(GetOwningPlayer(trigUnit))] + PlayersName[GetPlayerId(GetOwningPlayer(trigUnit))] + "|r")
		endif
	endif
	set t = null
	set ZSX = null
	set trigUnit = null
	set C1X = null
	return false
endfunction
function VVO takes unit u, boolean b returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit mns = GetSellingUnit()
	local integer id =(LoadInteger(HY,(GetHandleId(mns)), 8000))
	if u != null then
		if u !=(LoadUnitHandle(HY,(GetHandleId(mns)),(8002 + id))) and b then
			set id = id + 1
			call SaveInteger(HY,(GetHandleId(mns)), 8000,(id))
			call SaveUnitHandle(HY,(GetHandleId(mns)),(8002 + id),(u))
		endif
		call SaveReal(HY, h, 677,((GetUnitX(u))* 1.))
		call SaveReal(HY, h, 678,((GetUnitY(u))* 1.))
		call IssueTargetOrderById(mns, 851986, u)
		call TriggerRegisterDeathEvent(t, mns)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerRegisterUnitEvent(t, mns, EVENT_UNIT_ISSUED_ORDER)
		call TriggerRegisterUnitEvent(t, mns, EVENT_UNIT_ISSUED_TARGET_ORDER)
		call TriggerRegisterUnitEvent(t, mns, EVENT_UNIT_ISSUED_POINT_ORDER)
		call TriggerRegisterTimerEvent(t, .2, true)
		call TriggerAddCondition(t, Condition(function Z9X))
		call SaveUnitHandle(HY, h, 2,(u))
		call SaveUnitHandle(HY, h, 92,(mns))
	endif
	set t = null
	set mns = null
endfunction
function VOO takes nothing returns nothing
	local item C1X = GetEnumItem()
	local player p = ZO
	local integer id = GetPlayerId(p)
	if GetWidgetLife(C1X)> 0 and GetItemPlayer(C1X) == p and IsItemVisible(C1X) then
		call SetItemPosition(C1X, CirclesX[id], CirclesY[id])
		call UnitAddItem(CTV, C1X)
	endif
	set C1X = null
	set p = null
endfunction
function VRO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 53))
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local player p = LoadPlayerHandle(HY, h, 50)
	set ZO = p
	set CTV = whichUnit
	if IsSentinelPlayer(p) then
		call EnumItemsInRect(gg_rct_SentinelFountainOfLifeRange, null, function VOO)
	else
		call EnumItemsInRect(gg_rct_ScourgeFountainOfLifeRange, null, function VOO)
	endif
	if GetTriggerEvalCount(t) == 3 then
		call KillUnit(u)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	set whichUnit = null
	return false
endfunction
function VIO takes unit trigUnit returns nothing
	local unit u = GetSoldUnit()
	local integer i = 0
	local item C1X
	local integer id = GetPlayerId(GetOwningPlayer(u))
	local region r = CreateRegion()
	local trigger t
	local integer h
	local unit whichUnit = GetSellingUnit()
	local player p = GetOwningPlayer(u)
	if IsSentinelPlayer(GetOwningPlayer(u)) then
		call RegionAddRect(r, gg_rct_SentinelFountainOfLifeRange)
	else
		call RegionAddRect(r, gg_rct_ScourgeFountainOfLifeRange)
	endif
	if IsUnitInRegion(r, whichUnit) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .05, true)
		call TriggerAddCondition(t, Condition(function VRO))
		call SaveUnitHandle(HY, h, 53,(u))
		call SavePlayerHandle(HY, h, 50, p)
		call SaveUnitHandle(HY, h, 2,(whichUnit))
		loop
		exitwhen i > 5
			set C1X = UnitItemInSlot(whichUnit, i)
			if GUX(GetItemIndexEx(C1X)) == false and GetItemIndexEx(C1X)!= AIV then
				call UnitRemoveItemFromSlot(whichUnit, i)
				if IsUnitInRegion(r, whichUnit) and IsPlayerAlly(GetItemPlayer(C1X), GetOwningPlayer(whichUnit)) then
					set id = GetPlayerId(GetItemPlayer(C1X))
					call SetItemPosition(C1X, CirclesX[id], CirclesY[id])
				endif
			endif
			set i = i + 1
		endloop
	endif
	call RemoveRegion(r)
	set u = null
	set r = null
	set t = null
	set C1X = null
	set whichUnit = null
endfunction
function VAO takes unit u returns string
	local string s = GetObjectName('n0FO')
	set s = StringReplace(s, "$hero", PlayersColoerText[GetPlayerId(GetOwningPlayer(u))] + GetUnitName(u)+ "|r")
	return s
endfunction
function VNO takes unit whichUnit returns boolean
	if GetOwningPlayer(whichUnit)!= LocalPlayer or JE then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, " ")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, VAO(Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))]))
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, " ")
	endif
	return false
endfunction
function VBO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call UnitRemoveAbility(LoadUnitHandle(HY, h, 0),'A336')
	call UnitRemoveAbility(LoadUnitHandle(HY, h, 0),'B0GU')
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
endfunction
function VCO takes unit u, real r returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, r, false, function VBO)
	call UnitAddPermanentAbility(u,'A336')
	call SaveUnitHandle(HY, h, 0, u)
	set t = null
endfunction
function VDO takes nothing returns nothing
	local unit u = GetSoldUnit()
	local player p = GetOwningPlayer(u)
	local integer pid = GetPlayerId(p)
	local real r = 0
	if GetUnitTypeId(u)=='h085' then
		if Player__Hero[pid]!= null and UnitIsDead(Player__Hero[pid]) == false then
			call VVO(Player__Hero[pid], true)
		endif
		call KillUnit(u)
	elseif GetUnitTypeId(u)=='h0BV' then
		if Player__Hero[pid]!= null then
			call VIO(Player__Hero[pid])
		endif
		call KillUnit(u)
	elseif GetUnitTypeId(u)=='h0DE' then
		if Player__Hero[pid]!= null then
			call VVO(LoadUnitHandle(HY, GetHandleId(GetSellingUnit()), 8002 + LoadInteger(HY, GetHandleId(GetSellingUnit()), 8000)-1), false)
		endif
		call KillUnit(u)
	elseif KDX(GetUnitTypeId(u)) then
		if Player__Hero[pid]!= null then
			if UnitIsDead(Player__Hero[pid]) and p == GetOwningPlayer(GetSellingUnit()) and LoadInteger(HY, GetHandleId(Player__Hero[pid]), 4304)!= 1 and UF[pid]== false then
				set r = TimerGetRemaining(PS[pid])
				call SaveReal(OtherHashTable, GetHandleId(p), 25, r + GetGameTime())
				call SaveReal(OtherHashTable, GetHandleId(p), 26, r * .25)
				call VNO(Player__Hero[pid])
				call ReviveHero(Player__Hero[pid], GetUnitX(u), GetUnitY(u), true)
				call VCO(Player__Hero[pid], r)
				call SetUnitState(Player__Hero[pid], UNIT_STATE_MANA, 10000)
				set PlayersReliableGold[pid]= IMaxBJ(0, PlayersReliableGold[pid]-Y4[KFX(GetHeroLevel(Player__Hero[GetPlayerId(GetOwningPlayer(GetSellingUnit()))]))])
				call KYX(p)
			else
				call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)+ Y4[KFX(GetHeroLevel(Player__Hero[GetPlayerId(GetOwningPlayer(GetSellingUnit()))]))])
				if UF[pid] then
					call InterfaceErrorForPlayer(p, "因死神镰刀的诅咒无法买活")
				endif
			endif
		endif
		call KillUnit(u)
	endif
	set u = null
endfunction
function VFO takes player whichPlayer, unit whichUnit, integer VGO, integer i0, integer i1, integer i2, integer i3, integer i4, integer i5 returns nothing
	local item C1X
	call DisableTrigger(C3V)
	if i0 > 0 then
		set C1X = UnitItemInSlot(whichUnit, 0)
		call HZX(C1X)
	endif
	if i1 > 0 then
		set C1X = UnitItemInSlot(whichUnit, 1)
		call HZX(C1X)
	endif
	if i2 > 0 then
		set C1X = UnitItemInSlot(whichUnit, 2)
		call HZX(C1X)
	endif
	if i3 > 0 then
		set C1X = UnitItemInSlot(whichUnit, 3)
		call HZX(C1X)
	endif
	if i4 > 0 then
		set C1X = UnitItemInSlot(whichUnit, 4)
		call HZX(C1X)
	endif
	if i5 > 0 then
		set C1X = UnitItemInSlot(whichUnit, 5)
		call HZX(C1X)
	endif
	set C1X = UnitAddItemById(whichUnit, XOV[VGO])
	call SetItemPlayer(C1X, whichPlayer, true)
	call SetItemUserData(C1X, 0)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIem\\AIemTarget.mdl", whichUnit, "origin"))
	if GetItemIndexEx(C1X) == NIV then
		call SetItemCharges(C1X, 8)
	endif
	call EnableTrigger(C3V)
	if IsPlayerAlly(LocalPlayer, whichPlayer) then
		if VGO == I4V then
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 4, PlayersColoerText[GetPlayerId(whichPlayer)] +(PlayersName[GetPlayerId((whichPlayer))])+ "|r |c00ffff00" + GetObjectName('n0LX')+ "|r")
		elseif VGO == ASV then
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 4, PlayersColoerText[GetPlayerId(whichPlayer)] +(PlayersName[GetPlayerId((whichPlayer))])+ "|r |c00ffff00" + GetObjectName('n0LY')+ "|r")
		endif
	endif
	set C1X = null
endfunction
function VHO takes player p, unit whichUnit, integer GTX returns boolean
	local integer i
	local integer x
	local integer y
	local integer array VJO
	local boolean array VKO
	local integer array VLO
	local boolean array VMO
	local boolean array b
	local integer array JVX
	local player whichPlayer
	local integer VPO = 1
	local integer k
	local player array VQO
	local integer m
	local item VSO
	local item VTO
	local item VUO
	local item VWO
	local item VYO
	local item VZO
	local player V_O
	local player V0O
	local player V1O
	local player V2O
	local player V3O
	local player V4O
	local integer V5O
	local integer V6O
	local integer V7O
	local integer V8O
	local integer V9O
	local integer EVO
	local integer EEO
	local integer EXO
	local integer EOO
	local integer ERO
	local integer EIO
	local integer EAO
	local boolean ENO = false
	local boolean EBO = true
	set VSO = UnitItemInSlot(whichUnit, 0)
	set VTO = UnitItemInSlot(whichUnit, 1)
	set VUO = UnitItemInSlot(whichUnit, 2)
	set VWO = UnitItemInSlot(whichUnit, 3)
	set VYO = UnitItemInSlot(whichUnit, 4)
	set VZO = UnitItemInSlot(whichUnit, 5)
	set V_O = GetItemPlayer(VSO)
	set V0O = GetItemPlayer(VTO)
	set V1O = GetItemPlayer(VUO)
	set V2O = GetItemPlayer(VWO)
	set V3O = GetItemPlayer(VYO)
	set V4O = GetItemPlayer(VZO)
	set V5O = GetItemUserData(VSO)
	set V6O = GetItemUserData(VTO)
	set V7O = GetItemUserData(VUO)
	set V8O = GetItemUserData(VWO)
	set V9O = GetItemUserData(VYO)
	set EVO = GetItemUserData(VZO)
	set EEO = GetItemIndexEx(VSO)
	set EXO = GetItemIndexEx(VTO)
	set EOO = GetItemIndexEx(VUO)
	set ERO = GetItemIndexEx(VWO)
	set EIO = GetItemIndexEx(VYO)
	set EAO = GetItemIndexEx(VZO)
	if (GetPlayerSlotState((p)) == PLAYER_SLOT_STATE_LEFT) then
		set VPO = 5
		set ENO = true
	endif
	set VQO[1]= p
	if ENO then
		set k = 2
		set m = 1
		loop
		exitwhen k > VPO
			if IsSentinelPlayer(p) then
				if p != SentinelPlayers[m] then
					set VQO[k]= SentinelPlayers[m]
					set k = k + 1
				endif
			else
				if p != ScourgePlayers[m] then
					set VQO[k]= ScourgePlayers[m]
					set k = k + 1
				endif
			endif
			set m = m + 1
		endloop
	endif
	set k = 1
	loop
	exitwhen k > VPO
		set whichPlayer = VQO[k]
		set i = 0
		if VSO != null and V5O == 1 and(V_O == whichPlayer or L3 or(GetPlayerSlotState((V_O)) == PLAYER_SLOT_STATE_LEFT)) then
			set VJO[i + 1]= EEO
		else
			set VJO[i + 1]= 0
		endif
		set i = 1
		if VTO != null and V6O == 1 and(V0O == whichPlayer or L3 or(GetPlayerSlotState((V0O)) == PLAYER_SLOT_STATE_LEFT)) then
			set VJO[i + 1]= EXO
		else
			set VJO[i + 1]= 0
		endif
		set i = 2
		if VUO != null and V7O == 1 and(V1O == whichPlayer or L3 or(GetPlayerSlotState((V1O)) == PLAYER_SLOT_STATE_LEFT)) then
			set VJO[i + 1]= EOO
		else
			set VJO[i + 1]= 0
		endif
		set i = 3
		if VWO != null and V8O == 1 and(V2O == whichPlayer or L3 or(GetPlayerSlotState((V2O)) == PLAYER_SLOT_STATE_LEFT)) then
			set VJO[i + 1]= ERO
		else
			set VJO[i + 1]= 0
		endif
		set i = 4
		if VYO != null and V9O == 1 and(V3O == whichPlayer or L3 or(GetPlayerSlotState((V3O)) == PLAYER_SLOT_STATE_LEFT)) then
			set VJO[i + 1]= EIO
		else
			set VJO[i + 1]= 0
		endif
		set i = 5
		if VZO != null and EVO == 1 and(V4O == whichPlayer or L3 or(GetPlayerSlotState((V4O)) == PLAYER_SLOT_STATE_LEFT)) then
			set VJO[i + 1]= EAO
		else
			set VJO[i + 1]= 0
		endif
		set VJO[0]= GTX
		set i = 1
		loop
		exitwhen i >(CombineMaxIndex)
			set VLO[0]= CombineIndex1[i]
			set VLO[1]= CombineIndex2[i]
			set VLO[2]= CombineIndex3[i]
			set VLO[3]= CombineIndex4[i]
			set VLO[4]= CombineIndex5[i]
			if EBO then
				set VMO[0]= true
				set VMO[1]= true
				set VMO[2]= true
				set VMO[3]= true
				set VMO[4]= true
				set VMO[5]= true
				set VMO[6]= true
				set VKO[0]= true
				set VKO[1]= true
				set VKO[2]= true
				set VKO[3]= true
				set VKO[4]= true
				set VKO[5]= true
				set VKO[6]= true
				set JVX[0]= 0
				set JVX[1]= 0
				set JVX[2]= 0
				set JVX[3]= 0
				set JVX[4]= 0
				set JVX[5]= 0
				set JVX[6]= 0
				set EBO = false
			endif
			set b[0]= false
			set b[1]= false
			set b[2]= false
			set b[3]= false
			set b[4]= false
			set x = 0
			loop
			exitwhen x == 5
				if VLO[x]== 0 then
					set b[x]= true
				else
					set y = 0
					loop
						if VJO[y]== VLO[x]and VKO[y]and VMO[x] then
							set VKO[y]= false
							set VMO[x]= false
							set b[x]= true
							set JVX[y]= 1
							set y = 7
							set EBO = true
						else
							set y = y + 1
						endif
					exitwhen y == 7
					endloop
				endif
				if b[x] then
					set x = x + 1
				else
					set x = 5
				endif
			endloop
			if b[0]and b[1]and b[2]and b[3]and b[4] then
				call VFO(whichPlayer, whichUnit, CombinedIndex[i], JVX[1], JVX[2], JVX[3], JVX[4], JVX[5], JVX[6])
				set i = CombineMaxIndex + 2
			else
				set i = i + 1
			endif
		endloop
		set X3 = JVX[0]== 1
		if i ==(CombineMaxIndex + 2) then
			set VSO = null
			set VTO = null
			set VUO = null
			set VWO = null
			set VYO = null
			set VZO = null
			return true
		endif
		set k = k + 1
	endloop
	set VSO = null
	set VTO = null
	set VUO = null
	set VWO = null
	set VYO = null
	set VZO = null
	set V_O = null
	set V0O = null
	set V1O = null
	set V2O = null
	set V3O = null
	set V4O = null
	set whichPlayer = null
	return false
endfunction
function ECO takes player whichPlayer, unit whichUnit, integer GTX returns boolean
	local integer i = 1
	local boolean JVX
	set X3 = false
	set JVX = VHO(whichPlayer, whichUnit, GTX)
	return JVX
endfunction
function EDO takes nothing returns boolean
	if IsUnitAlly(GetFilterUnit(), GetOwningPlayer(U2)) and GetUnitAbilityLevel(GetFilterUnit(),'Aloc') == 0 and UnitInventorySize(GetFilterUnit())> 1 and GetUnitTypeId(GetFilterUnit())!='ncop' and GetPlayerAlliance(GetOwningPlayer(GetFilterUnit()), GetOwningPlayer(U2), ALLIANCE_SHARED_CONTROL) and GetOwningPlayer(U2)!= GetOwningPlayer(GetFilterUnit()) and IsUnitIllusion(GetFilterUnit()) == false and UnitIsDead(GetFilterUnit()) == false then
		if IsUnitMessenger(GetFilterUnit()) then
			set Q2 = Q2 + 1
			set MissileHitTargetUnit = GetFilterUnit()
		endif
	endif
	return false
endfunction
function EFO takes nothing returns boolean
	if IsUnitAlly(GetFilterUnit(), GetOwningPlayer(U2)) and GetUnitAbilityLevel(GetFilterUnit(),'Aloc') == 0 and UnitInventorySize(GetFilterUnit())> 1 and GetUnitTypeId(GetFilterUnit())!='ncop' and IsUnitIllusion(GetFilterUnit()) == false and UnitIsDead(GetFilterUnit()) == false then
		if GetOwningPlayer(U2) == GetOwningPlayer(GetFilterUnit()) then
			if IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) then
				if GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 then
					set MissileHitTargetUnit = GetFilterUnit()
				endif
			elseif IsUnitType(MissileHitTargetUnit, UNIT_TYPE_HERO) == false then
				set MissileHitTargetUnit = GetFilterUnit()
			endif
		endif
	endif
	return false
endfunction
function EGO takes unit whichUnit, integer EHO returns unit
	local group g = AllocationGroup(18)
	set U2 = whichUnit
	set MissileHitTargetUnit = null
	call GroupEnumUnitsInRange(g, GetUnitX(Y2), GetUnitY(Y2), 1300+ EHO, Condition(function EFO))
	if MissileHitTargetUnit == null then
		set Q2 = 0
		call DeallocateGroup(g)
		set g = AllocationGroup(19)
		call GroupEnumUnitsInRange(g, GetUnitX(Y2), GetUnitY(Y2), 1100+ EHO, Condition(function EDO))
		if Q2 > 1 then
			set MissileHitTargetUnit = null
		endif
	endif
	call DeallocateGroup(g)
	set g = null
	return MissileHitTargetUnit
endfunction
function EJO takes player whichPlayer, unit whichUnit, unit EKO, integer GTX, real x, real y, integer HUX, integer ELO returns nothing
	local unit EMO = null
	local item HWX = null
	set Y2 = EKO
	if GTX < 0 then
		return
	endif
	if GetUnitPointValue(whichUnit)== 200 then
		set EMO = EGO(whichUnit, 0)
		if EMO == null then
			set EMO = EGO(whichUnit, 300)
		endif
	else
		set EMO = whichUnit
	endif
	if EMO == null or ECO(whichPlayer, EMO, GSX(GTX)) == false or X3 == false then
		if HHX(GSX(GTX)) then
			if H_X(EMO) == 0 or EMO == null then
				if EMO == null then
					call HYX(XXV[GTX], x, y, whichPlayer, true, HUX)
				else
					if GetDistanceBetween(GetUnitX(EMO), GetUnitY(EMO), x, y)> 2000 then
						set x = GetUnitX(EMO)
						set y = GetUnitY(EMO)
						call InterfaceErrorForPlayer(whichPlayer, "Inventory is full!")
					endif
					call HYX(XXV[GTX], x, y, whichPlayer, true, HUX)
				endif
			else
				set HWX = UnitAddItemById(EMO, XOV[GTX])
				call SetItemCharges(HWX, HUX)
				call SetItemPlayer(HWX, whichPlayer, true)
				call SetItemUserData(HWX, ELO)
			endif
		elseif HGX(GSX(GTX)) then
			if EMO == null or(H_X(EMO) == 0 and GetItemOfTypeFromUnit(EMO, XOV[GTX]) == null) then
				call HYX(XXV[GTX], x, y, whichPlayer, true, H7X(GTX))
			else
				set HWX = CreateItem(XXV[GTX], x, y)
				call SetItemPlayer(HWX, whichPlayer, true)
				call SetItemUserData(HWX, ELO)
				call SetItemCharges(HWX, H7X(GTX))
				call UnitAddItem(EMO, HWX)
			endif
		else
			if H_X(EMO) == 0 or EMO == null then
				if EMO == null then
					call HYX(XXV[GTX], x, y, whichPlayer, true, 0)
				else
					if GetDistanceBetween(GetUnitX(EMO), GetUnitY(EMO), x, y)> 2000 then
						set x = GetUnitX(EMO)
						set y = GetUnitY(EMO)
						call InterfaceErrorForPlayer(whichPlayer, "Inventory is full!")
					endif
					call HYX(XXV[GTX], x, y, whichPlayer, true, 0)
				endif
			else
				if GTX != NXV then
					set HWX = UnitAddItemById(EMO, XOV[GTX])
					call SetItemPlayer(HWX, whichPlayer, true)
					call SetItemUserData(HWX, 0)
				else
					call HMX(HWX, whichPlayer)
				endif
			endif
		endif
	else
		if IsUnitType(EMO, UNIT_TYPE_HERO) then
			if ELO == 0 then
				call StoreDrCacheData("PUI_" + I2S(GetPlayerId(GetOwningPlayer(EMO))), XOV[GSX(GTX)])
			endif
		endif
	endif
	set EMO = null
	set HWX = null
endfunction
// 消耗品计数判定
function EPO takes player p, integer GTX returns nothing
	local integer i = GetPlayerId(p)
	if GTX == RYV then
		set PlayerConsumablesCount[i]= PlayerConsumablesCount[i] + 1
	elseif GTX == R_V then
		set PlayerConsumablesCount[i]= PlayerConsumablesCount[i] + 1
	elseif GTX == R0V then
		set PlayerConsumablesCount[i]= PlayerConsumablesCount[i] + 4
	elseif GTX == R2V then
		set PlayerConsumablesCount[i]= PlayerConsumablesCount[i] + 1
		set PlayerWardCount[i]= PlayerWardCount[i] + 1
	elseif GTX == R3V then
		set PlayerConsumablesCount[i]= PlayerConsumablesCount[i] + 2
		set PlayerWardCount[i]= PlayerWardCount[i] + 2
	elseif GTX == R4V then
		set PlayerConsumablesCount[i]= PlayerConsumablesCount[i] + 1
	elseif GTX == R8V then
		set PlayerConsumablesCount[i]= PlayerConsumablesCount[i] + 2
	elseif GTX == RZV then
		set PlayerConsumablesCount[i]= PlayerConsumablesCount[i] + 2
	elseif GTX == R9V then
		set PlayerConsumablesCount[i]= PlayerConsumablesCount[i] + 2
	endif
endfunction
function EQO takes unit ESO, unit ETO returns boolean
	local integer GTX
	if (ESO == ScourgeTombOfRelics or ESO == ScourgeDemonicArtifacts or ESO == ScourgePigKing) and IsUnitAlly(ETO, ScourgePlayers[0]) then
		return false
	elseif (ESO == SentinelAncientOfWonders or ESO == SentinelCacheOfTheQuelThelan or ESO == SentinelPigKing) and IsUnitAlly(ETO, SentinelPlayers[0]) then
		return false
	endif
	set GTX = H3X(ETO)
	if GTX == R2V or GTX == X4V or GTX == IVV or GTX == it_jys then
		return true
	endif
	return false
endfunction
function IsSentinelMerchantUnit takes unit u returns boolean
	return u == SentinelCacheOfTheQuelThelan or u == SentinelWeaponsDealer or u == SentinelGrylaTheAccessorizer or u == SentinelAncientOfWonders or u == SentinelArcaneSanctum or u == SentinelAncientWeaponry or u == SentinelSupportiveVestments or u == SentinelEnchantedArtifacts or u == SentinelGatewayRelics or u == SentinelProtectorate or u == SentinelBlackMarket1 or u == SentinelBlackMarket2 or u == SentinelPigKing
endfunction
function IsScourgeMerchantUnit takes unit u returns boolean
	return u == ScourgeDemonicArtifacts or u == ScourgeWeaponsDealer or u == ScourgeGrylaTheAccessorizer or u == ScourgeTombOfRelics or u == ScourgeArcaneSanctum or u == ScourgeAncientWeaponry or u == ScourgeSupportiveVestments or u == ScourgeEnchantedArtifacts or u == ScourgeGatewayRelics or u == ScourgeProtectorate or u == ScourgeBlackMarket1 or u == ScourgeBlackMarket2 or u == ScourgePigKing
endfunction
function EYO takes unit u returns boolean
	return u == A2 or u == I2 or u == B2
endfunction
function EZO takes unit u returns boolean
	return u == N2 or u == F2 or u == C2
endfunction
function E_O takes unit EKO, unit E0O returns real
	if IsSentinelMerchantUnit(EKO) or IsScourgeMerchantUnit(EKO) then
		return CirclesX[GetPlayerId(GetOwningPlayer(E0O))]
	elseif EYO(EKO) then
		return -7133.
	elseif EZO(EKO) then
		return 7207.
	endif
	return GetUnitX(E0O)
endfunction
function E1O takes unit EKO, unit E0O returns real
	if IsSentinelMerchantUnit(EKO) or IsScourgeMerchantUnit(EKO) then
		return CirclesY[GetPlayerId(GetOwningPlayer(E0O))]
	elseif EYO(EKO) then
		return 4317.
	elseif EZO(EKO) then
		return -4243.
	endif
	return GetUnitY(E0O)
endfunction
function E2O takes unit EKO, unit E0O returns real
	if IsSentinelMerchantUnit(EKO) then
		return GetRectCenterX(gg_rct_SentinelRevivalPoint)
	elseif IsScourgeMerchantUnit(EKO) then
		return GetRectCenterX(gg_rct_ScourgeRevivalPoint)
	endif
	return GetUnitX(E0O)
endfunction
function E3O takes unit EKO, unit E0O returns real
	if IsSentinelMerchantUnit(EKO) then
		return GetRectCenterY(gg_rct_SentinelRevivalPoint)
	elseif IsScourgeMerchantUnit(EKO) then
		return GetRectCenterY(gg_rct_ScourgeRevivalPoint)
	endif
	return GetUnitY(E0O)
endfunction
function E4O takes unit u returns nothing
	local integer i = 0
	local item it
	local integer pid = GetPlayerId(GetOwningPlayer(u))
	local region r = CreateRegion()
	local boolean b = IsUnitMessenger(u) or GetUnitTypeId(u)=='ncop'
	if IsSentinelPlayer(GetOwningPlayer(u)) then
		call RegionAddRect(r, gg_rct_SentinelFountainOfLifeRange)
	else
		call RegionAddRect(r, gg_rct_ScourgeFountainOfLifeRange)
	endif
	loop
	exitwhen i > 5
		set it = UnitItemInSlot(u, i)
		if it != null and GetItemIndexEx(it)!= AIV then
			set it = UnitRemoveItemFromSlot(u, i)
			if b == false then
				call DisplayTimedTextToPlayer(GetOwningPlayer(u), 0, 0, 8, "|c00ffff00" + GetItemName(it)+ "|r 已被放置在你的能量圈中")
			endif
			if (GetUnitTypeId(u)=='ncop' or IsUnitInRegion(r, u)) and IsPlayerAlly(GetItemPlayer(it), GetOwningPlayer(u)) then
				set pid = GetPlayerId(GetItemPlayer(it))
				call SetItemPosition(it, CirclesX[pid], CirclesY[pid])
			endif
		endif
		set i = i + 1
	endloop
	call RemoveRegion(r)
	set it = null
	set r = null
endfunction
function E5O takes unit u, integer id returns nothing
	local player p = GetOwningPlayer(u)
	local real x
	local real y
	set x = GetUnitX(u)
	set y = GetUnitY(u)
	call EJO(p, u, GetSellingUnit(), GSX(id), x, y, 0, 0)
	set u = null
	set p = null
endfunction
function E6O takes unit u returns unit
	local unit d = null
	local player p = GetOwningPlayer(u)
	if HaveSavedHandle(OtherHashTable, GetHandleId(p),'COUR'+ 1) == false or UnitIsDead(LoadUnitHandle(OtherHashTable, GetHandleId(p),'COUR'+ 1)) then
		set d = CreateUnit(p,'e00E', GetUnitX(CirclesUnit[GetPlayerId(p)]), GetUnitY(CirclesUnit[GetPlayerId(p)]), 0)
		call UnitAddPermanentAbility(d,'AInv')
		call SaveUnitHandle(OtherHashTable, GetHandleId(p),'COUR'+ 1, d)
		call UnitPauseTimedLife(d, true)
		set d = null
	elseif HaveSavedHandle(OtherHashTable, GetHandleId(p),'COUR'+ 1) then
		set d = LoadUnitHandle(OtherHashTable, GetHandleId(p),'COUR'+ 1)
		if p != GetOwningPlayer(d) then
			call SetUnitOwner(d, p, true)
			call SetUnitPosition(d, GetUnitX(CirclesUnit[GetPlayerId(p)]), GetUnitY(CirclesUnit[GetPlayerId(p)]))
		endif
		set d = null
	endif
	return LoadUnitHandle(OtherHashTable, GetHandleId(p),'COUR'+ 1)
endfunction
function E7O takes integer id returns boolean
	return id == NZV or id == I3V or id == X0V or id == X1V or id == OOV or id == OKV or id == X7V or id == OBV or id == RXV or id == OIV or id == X2V or id == OCV or id == OUV or id == OTV
endfunction
function E8O takes unit u, integer id returns boolean
	local unit d = E6O(u)
	local integer TBX = TEX(XOV[id])
	local player p = GetOwningPlayer(u)
	local boolean b = false
	if E7O(id) then
		call DisplayTimedTextToPlayer(p, 0, 0, 10, StringReplace(GetObjectName('TX1A'), "$item", "|c00ffff00" + GetObjectName(XOV[id])+ "|r"))
		set d = null
		return false
	endif
	if GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)>= TBX then
		set b = true
		call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)-TBX)
		call E5O(d, id)
	else
		call DisplayTimedTextToPlayer(p, 0, 0, 10, StringReplace(GetObjectName('TX1B'), "$item", "|c00ffff00" + GetObjectName(XOV[id])+ "|r"))
	endif
	set d = null
	return b
endfunction
function E9O takes nothing returns boolean
	if Q2 < 6 and GetItemPlayer(GetFilterItem()) == E3 and GetItemUserData(GetFilterItem())>= 0 and GetWidgetLife(GetFilterItem())> 1 then
		set Q2 = Q2 + 1
		return true
	endif
	return false
endfunction
function XVO takes nothing returns nothing
	call SaveItemHandle(OtherHashTable2,'ITEM', Q2, GetEnumItem())
endfunction
function XEO takes unit u returns boolean
	return IsUnitInRange(u, B2, 800) or IsUnitInRange(u, C2, 800)
endfunction
function XXO takes item it returns boolean
	local integer id = GetItemIndexEx(it)
	return id == OQV or id == OTV or id == XPV or id == XQV or id == XTV or id == XWV or id == X6V or id == X9V or id == OXV or id == ODV or id == OFV or id == OHV or id == OJV or id == OLV or id == OMV or id == Item_MagicStick or id == RVV or id == RXV or id == OWV or id == R4V or id == X2V or id == XMV or id == XKV or id == XZV or id == XYV or id == ONV
endfunction
function XOO takes unit KKX, integer XRO, player p returns nothing
	local integer i = 0
	local item it
	local integer k = 0
	local integer Z6X = 0
	local integer j
	local integer Z7X
	local integer Z8X
	local string s
	local unit Y1X = LoadUnitHandle(OtherHashTable, GetHandleId(p),'COUR')
	local integer id
	local unit d
	local real x
	local real y
	if XRO ==-1 or GetPlayerSlotState(p) == PLAYER_SLOT_STATE_LEFT then
		set it = null
		set Y1X = null
		set d = null
		return
	endif
	if Y1X == null then
		set Y1X = HJX(p)
	endif
	call FlushChildHashtable(HY,'ITEM')
	loop
		if Y1X != null then
			set it = UnitItemInSlot(Y1X, i)
			if it != null and GetItemPlayer(it) == p then
				call SaveItemHandle(HY,'ITEM', k, it)
				call SaveInteger(HY,'ITEM', k, GetItemIndexEx(it))
				set k = k + 1
			endif
		endif
		set it = UnitItemInSlot(KKX, i)
		if it != null and GetItemPlayer(it) == p then
			call SaveItemHandle(HY,'ITEM', k, it)
			call SaveInteger(HY,'ITEM', k, GetItemIndexEx(it))
			set k = k + 1
		endif
		if KKX != Player__Hero[GetPlayerId(p)] then
			set it = UnitItemInSlot(Player__Hero[GetPlayerId(p)], i)
			if it != null and GetItemPlayer(it) == p then
				call SaveItemHandle(HY,'ITEM', k, it)
				call SaveInteger(HY,'ITEM', k, GetItemIndexEx(it))
				set k = k + 1
			endif
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	set E3 = p
	set Q2 = 0
	if IsSentinelPlayer(p) then
		call EnumItemsInRect(WA, Condition(function E9O), function XVO)
	else
		call EnumItemsInRect(YA, Condition(function E9O), function XVO)
	endif
	set i = Q2
	loop
	exitwhen i < 0
		if HaveSavedHandle(OtherHashTable2,'ITEM', i) then
			call SaveItemHandle(HY,'ITEM', k, LoadItemHandle(OtherHashTable2,'ITEM', i))
			call SaveInteger(HY,'ITEM', k, GetItemIndexEx(LoadItemHandle(OtherHashTable2,'ITEM', i)))
			call RemoveSavedHandle(OtherHashTable2,'ITEM', i)
			set k = k + 1
		endif
		set i = i -1
	endloop
	set it = null
	set Z6X = k
	set k = XRO
	call SaveInteger(HY,'ITEM', 51, CombineIndex1[k])
	call SaveInteger(HY,'ITEM', 52, CombineIndex2[k])
	call SaveInteger(HY,'ITEM', 53, CombineIndex3[k])
	call SaveInteger(HY,'ITEM', 54, CombineIndex4[k])
	call SaveInteger(HY,'ITEM', 55, CombineIndex5[k])
	set Z8X = 0
	set Z7X = 0
	set i = 0
	if CombineIndex1[k]!= 0 then
		set Z7X = Z7X + 1
	endif
	if CombineIndex2[k]!= 0 then
		set Z7X = Z7X + 1
	endif
	if CombineIndex3[k]!= 0 then
		set Z7X = Z7X + 1
	endif
	if CombineIndex4[k]!= 0 then
		set Z7X = Z7X + 1
	endif
	if CombineIndex5[k]!= 0 then
		set Z7X = Z7X + 1
	endif
	loop
		set j = LoadInteger(HY,'ITEM', i)
		if j > 0 and LoadBoolean(HY,'ITEM', i) == false then
			if (j == LoadInteger(HY,'ITEM', 51) and Z2X(HY,'ITEM', 51)) or(j == LoadInteger(HY,'ITEM', 52) and Z2X(HY,'ITEM', 52)) or(j == LoadInteger(HY,'ITEM', 53) and Z2X(HY,'ITEM', 53)) or(j == LoadInteger(HY,'ITEM', 54) and Z2X(HY,'ITEM', 54)) or(j == LoadInteger(HY,'ITEM', 55) and Z2X(HY,'ITEM', 55)) then
				call SaveItemHandle(HY,'ITEM', 100 + Z8X, LoadItemHandle(HY,'ITEM', i))
				call SaveBoolean(HY,'ITEM', i, true)
				call SaveInteger(HY,'ITEM', 200+ Z8X, i)
				set Z8X = Z8X + 1
			endif
		endif
		set i = i + 1
	exitwhen i >= Z6X
	endloop
	if Z8X != Z7X then
		set id = LoadInteger(HY,'ITEM', 51)
		if id != 0 then
			if E8O(KKX, id) then
				set Z7X = Z7X + 1
			endif
		endif
		set id = LoadInteger(HY,'ITEM', 52)
		if id != 0 then
			if E8O(KKX, id) then
				set Z7X = Z7X + 1
			endif
		endif
		set id = LoadInteger(HY,'ITEM', 53)
		if id != 0 then
			if E8O(KKX, id) then
				set Z7X = Z7X + 1
			endif
		endif
		set id = LoadInteger(HY,'ITEM', 54)
		if id != 0 then
			if E8O(KKX, id) then
				set Z7X = Z7X + 1
			endif
		endif
		set id = LoadInteger(HY,'ITEM', 55)
		if id != 0 then
			if E8O(KKX, id) then
				set Z7X = Z7X + 1
			endif
		endif
		if Z8X == Z7X then
			set i = 100 
			loop
				call UnitAddItem(LoadUnitHandle(OtherHashTable, GetHandleId(GetOwningPlayer(KKX)),'COUR'+ 1), LoadItemHandle(HY,'ITEM', i))
				call RemoveSavedHandle(HY,'ITEM', i)
				set i = i + 1
			exitwhen HaveSavedHandle(HY,'ITEM', i) == false
			endloop
		endif
		set d = LoadUnitHandle(OtherHashTable, GetHandleId(GetOwningPlayer(KKX)),'COUR'+ 1)
		if true then
			set x = GetUnitX(d)
			set y = GetUnitY(d)
			call SetUnitX(d, GetUnitX(KKX))
			call SetUnitY(d, GetUnitY(KKX))
			if UnitIsDead(KKX) == false and IsUnitInRange(KKX, SentinelFountainOfLifeUnit, 1600) or IsUnitInRange(KKX, ScourgeFountainOfLifeUnit, 1600) then
				call Z3X(d, KKX, true, k)
				if H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 0), KKX)
				endif
				if H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 1), KKX)
				endif
				if H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 2), KKX)
				endif
				if H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 3), KKX)
				endif
				if H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 4), KKX)
				endif
				if H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 5), KKX)
				endif
			elseif UnitIsDead(KKX) == false and XEO(KKX) then
				if XXO(UnitItemInSlot(d, 0)) and H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 0), KKX)
				endif
				if XXO(UnitItemInSlot(d, 1)) and H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 1), KKX)
				endif
				if XXO(UnitItemInSlot(d, 2)) and H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 2), KKX)
				endif
				if XXO(UnitItemInSlot(d, 3)) and H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 3), KKX)
				endif
				if XXO(UnitItemInSlot(d, 4)) and H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 4), KKX)
				endif
				if XXO(UnitItemInSlot(d, 5)) and H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 5), KKX)
				endif
			elseif Y1X != null and UnitIsDead(Y1X) == false and(IsUnitInRangeXY(Y1X, GetRectCenterX(WA), GetRectCenterY(WA), 1600) or IsUnitInRangeXY(Y1X, GetRectCenterX(YA), GetRectCenterY(YA), 1600)) then
				call SetUnitX(d, GetUnitX(Y1X))
				call SetUnitY(d, GetUnitY(Y1X))
				call Z3X(d, Y1X, true, k)
				if H_X(Y1X)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 0), Y1X)
				endif
				if H_X(Y1X)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 1), Y1X)
				endif
				if H_X(Y1X)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 2), Y1X)
				endif
				if H_X(Y1X)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 3), Y1X)
				endif
				if H_X(Y1X)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 4), Y1X)
				endif
				if H_X(Y1X)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 5), Y1X)
				endif
			endif
			call SetUnitX(d, x)
			call SetUnitY(d, y)
		endif
		call E4O(d)
		set d = null
	endif
	call UnitRemoveAbility(LoadUnitHandle(OtherHashTable, GetHandleId(GetOwningPlayer(KKX)),'COUR'+ 1),'AInv')
	call UnitAddAbility(LoadUnitHandle(OtherHashTable, GetHandleId(GetOwningPlayer(KKX)),'COUR'+ 1),'AInv')
	set Y1X = null
	set it = null
	set d = null
endfunction
function XIO takes integer id, boolean XAO returns integer
	local integer i = 0
	loop
		if (XAO == false and CombinedIndex[i]== LoadInteger(HY,'ITDB', id)) or(XAO and(CombineIndex1[i]== id or CombineIndex2[i]== id or CombineIndex3[i]== id or CombineIndex4[i]== id or CombineIndex5[i]== id)) then
			return i
		endif
		set i = i + 1
	exitwhen i > CombineMaxIndex
	endloop
	return -1
endfunction
function XNO takes nothing returns nothing
	local unit u = GetSoldUnit()
	local player p = GetOwningPlayer(u)
	local integer GTX = H3X(u)
	local real x
	local real y
	local integer i
	call UnitAddAbility(u,'Aloc')
	call ShowUnit(u, false)
	call UnitApplyTimedLife(u,'BTLF', 2)
	if GetUnitTypeId(u)=='h03Q' and not WN then
		call InterfaceErrorForPlayer(p, "开局3分钟内无法购买小鸟.")
		call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)+ 150)
		set u = null
		return
	endif
	if HGX(GTX) == false and XOV[GTX]!= 0 then
		call SaveInteger(ObjectHashTable,'ITEM', GetPlayerId(p), XOV[GTX])
		call SaveReal(ObjectHashTable,'ITEM', GetPlayerId(p), GetGameTime())
	endif
	if EQO(GetSellingUnit(), u) then
		call InterfaceErrorForPlayer(p, GetObjectName('n02G'))
		if IsUnitAlly(u, SentinelPlayers[0]) then
			set p = ScourgePlayers[0]
		else
			set p = SentinelPlayers[0]
		endif
		set x = E2O(GetSellingUnit(), u)
		set y = E3O(GetSellingUnit(), u)
		call HYX(XXV[H3X(u)], x, y, p, true, H7X(H3X(u)))
	else
		call EPO(p, GSX(GTX))
		if XOV[GTX]== 0 then
			set i = XIO(GTX, false)
			if i ==-1 then
				call InterfaceErrorForPlayer(p, GetObjectName('n02H'))
			else
				call XOO(Player__Hero[GetPlayerId(p)], i, p)
			endif
		else
			set x = E_O(GetSellingUnit(), u)
			set y = E1O(GetSellingUnit(), u)
			if GTX == R8V then
				call EJO(p, u, GetSellingUnit(), GSX(GTX), x, y, 2, 0)
			else
				call EJO(p, u, GetSellingUnit(), GSX(GTX), x, y, 0, 0)
			endif
		endif
	endif
	set u = null
	set p = null
endfunction
function B1E takes nothing returns nothing
	set VE = true
endfunction
function XBO takes nothing returns nothing
	if IsPickingHero and TimerGetRemaining(NK)> 0 and((IsSentinelPlayer(GetTriggerPlayer()) and CK[0]> 0) or(IsScourgePlayer(GetTriggerPlayer()) and CK[1]> 0)) then
		if IsSentinelPlayer(GetTriggerPlayer()) then
			set CK[0]= CK[0]-1
			if UnitIsDead(HR) then
				call KillUnit(JR)
			else
				call KillUnit(HR)
			endif
		else
			set CK[1]= CK[1]-1
			if UnitIsDead(KR) then
				call KillUnit(LR)
			else
				call KillUnit(KR)
			endif
		endif
		call ExecuteFunc("XCO")
		call DisplayTimedTextToPlayer(LocalPlayer, .0, .0, DisplayTextDuration[LocalPlayerId], PlayersColoerText[GetPlayerId(GetTriggerPlayer())] + GetPlayerName(GetTriggerPlayer())+ "|r" + " 增加了45秒的选择时间.")
	endif
endfunction
function XDO takes player p returns nothing
	if IsPickingHero and TimerGetRemaining(NK)> 0 and((IsSentinelPlayer(p) and CK[0]> 0) or(IsScourgePlayer(p) and CK[1]> 0)) then
		if IsSentinelPlayer(p) then
			set CK[0]= CK[0]-1
		else
			set CK[1]= CK[1]-1
		endif
		call ExecuteFunc("XCO")
		call DisplayTimedTextToPlayer(LocalPlayer, .0, .0, DisplayTextDuration[LocalPlayerId], PlayersColoerText[GetPlayerId(p)] + GetPlayerName(p)+ "|r增加了45秒的选择时间.")
	endif
endfunction
function XFO takes nothing returns boolean
	local unit u = GetSoldUnit()
	local player p = LocalPlayer
	local player ETO = GetOwningPlayer(u)
	local integer pid = GetPlayerId(ETO)
	local integer unitTypeId = H3X(u)
	if GetUnitTypeId(u)=='h304' or GetUnitTypeId(u)=='h305' then
		if (IsSentinelPlayer(ETO) and GetUnitTypeId(u)=='h304') or(IsScourgePlayer(ETO) and GetUnitTypeId(u)=='h305') then
			call KillUnit(GetSellingUnit())
			call XDO(GetOwningPlayer(u))
		else
			call InterfaceErrorForPlayer(ETO, "这是对方的加时器，请用你自己的.")
		endif
		call RemoveUnit(u)
	elseif GetUnitTypeId(u)=='h307' then
		set E3 = GetOwningPlayer(u)
		call ExecuteFunc("XGO")
		call RemoveUnit(u)
	endif
	if GetUnitPointValue(u)>= 200 then
		call XNO()
		if IsPlayerAlly(p, ETO) or(IsGameHaveObserver and(p == ObserverPlayer1 or p == ObserverPlayer2)) then
			if unitTypeId == R5V then
				call PingMinimapEx(GetUnitX(u), GetUnitY(u), 3, 255, 255, 255, false)
				call DisplayTimedTextToPlayer(p, 0, 0, 20, PlayersColoerText[pid] +(PlayersName[pid])+ "|r |c00ffff00" + GetObjectName('n0HU')+ "|r")
			elseif unitTypeId == BUV and WN then
				call PingMinimapEx(GetUnitX(u), GetUnitY(u), 3, 255, 255, 255, false)
				call DisplayTimedTextToPlayer(p, 0, 0, DisplayTextDuration[LocalPlayerId], PlayersColoerText[pid] +(PlayersName[pid])+ "|r |c00ffff00" + GetObjectName('n0KG')+ "|r")
			elseif unitTypeId == R8V then
				call DisplayTimedTextToPlayer(p, 0, 0, 4, PlayersColoerText[pid] +(PlayersName[pid])+ "|r |c00ffff00" + GetObjectName('n0KO')+ "|r")
			elseif unitTypeId == R2V then
				call PingMinimapEx(GetUnitX(u), GetUnitY(u), 3, 255, 255, 255, false)
				call DisplayTimedTextToPlayer(p, 0, 0, 4, PlayersColoerText[pid] +(PlayersName[pid])+ "|r |c00ffff00" + GetObjectName('n0KP')+ "|r")
			elseif unitTypeId == R3V then
				call PingMinimapEx(GetUnitX(u), GetUnitY(u), 3, 255, 255, 255, false)
				call DisplayTimedTextToPlayer(p, 0, 0, 4, PlayersColoerText[pid] +(PlayersName[pid])+ "|r |c00ffff00" + GetObjectName('n0KQ')+ "|r")
			elseif unitTypeId == B4V then
				call PingMinimapEx(GetUnitX(u), GetUnitY(u), 3, 255, 255, 255, false)
				call DisplayTimedTextToPlayer(p, 0, 0, 4, PlayersColoerText[pid] +(PlayersName[pid])+ "|r |c00ffff00" + GetObjectName('n0KT')+ "|r")
			elseif unitTypeId == X4V then
				call PingMinimapEx(GetUnitX(u), GetUnitY(u), 3, 255, 255, 255, false)
				call DisplayTimedTextToPlayer(p, 0, 0, 4, PlayersColoerText[pid] +(PlayersName[pid])+ "|r |c00ffff00" + GetObjectName('n0LB')+ "|r")
			elseif unitTypeId == IVV then
				call PingMinimapEx(GetUnitX(u), GetUnitY(u), 3, 255, 255, 255, false)
				call DisplayTimedTextToPlayer(p, 0, 0, 4, PlayersColoerText[pid] +(PlayersName[pid])+ "|r |c00ffff00" + GetObjectName('n0LP')+ "|r")
			elseif unitTypeId == it_jys then
				call PingMinimapEx(GetUnitX(u), GetUnitY(u), 3, 255, 255, 255, false)
				call DisplayTimedTextToPlayer(p, 0, 0, 4, PlayersColoerText[pid] +(PlayersName[pid])+ "|r |c00ffff00购买了知识之书|r")
			endif
		endif
		if unitTypeId == OZV then
			if XI[pid]== false then
				call DisplayTimedTextToPlayer(ETO, 0, 0, DisplayTextDuration[LocalPlayerId], "|c00FF0000注意|r: 你可以输入 -orp 指令来恢复旧版魔瓶模式.")
			endif
		endif
	else
		call VDO()
	endif
	set u = null
	return false
endfunction
function XHO takes integer XJO returns boolean
	return XJO == A4V or XJO == A3V or XJO == REV or XJO == RVV or XJO == OSV or XJO == OQV or XJO == NSV or XJO == NQV or XJO == A9V or XJO == A8V or XJO == XLV or XJO == XKV or XJO == ABV or XJO == ANV
endfunction
function XKO takes unit u, item it returns nothing
	local integer unitTypeId = GetUnitTypeId(u)
	local integer TZE = GetItemIndex(it)
	local player p
	if XHO(TZE) == false then
		return
	endif
	if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) or IsUnitType(u, UNIT_TYPE_HERO) == false then
		if TZE == A4V then
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, XOV[A3V], p, false, 1)
		elseif TZE == OSV then
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, XOV[OQV], p, false, 1)
		elseif TZE == NSV then
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, XOV[NQV], p, false, 1)
		elseif TZE == A9V then
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, XOV[A8V], p, false, 1)
		elseif TZE == XLV then
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, XOV[XKV], p, false, 1)
		endif
	else
		if TZE == A3V then
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, XOV[A4V], p, false, 1)
		elseif TZE == OQV then
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, XOV[OSV], p, false, 1)
		elseif TZE == NQV then
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, XOV[NSV], p, false, 1)
		elseif TZE == A8V then
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, XOV[A9V], p, false, 1)
		elseif TZE == XKV then
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, XOV[XLV], p, false, 1)
		endif
	endif
endfunction
function XLO takes unit trigUnit, item C1X returns boolean
	local unit u = trigUnit
	local integer H4X = GetUnitTypeId(u)
	local integer GTX = GetItemIndexEx(C1X)
	local real x
	local real y
	local integer i
	local boolean XMO = true
	set x = GetUnitX(u)
	set y = GetUnitY(u)
	if GTX == OZV then
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl", u, "overhead"))
		call IRX(GetOwningPlayer(u), "Abilities\\Spells\\Human\\Heal\\HealTarget.wav")
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		call TDE(trigUnit, XOV[O2V], E3, false, 1)
		call UnitRemoveAbility(u,'B0GI')
	endif
	if (GTX) == IUV and GetItemCharges(C1X) == 0 then
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		call TDE(trigUnit, XOV[IYV], E3, false, 1)
	endif
	if GTX == RRV and GetItemCharges(C1X) == 0 then
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		call TDE(trigUnit, XOV[RIV], E3, false, 1)
	endif
	call DisableTrigger(CUV)
	if (GTX == ICV or GTX == IBV or GTX == IDV) and(GZX(u, XOV[ICV], C1X)!= null or GZX(u, XOV[IBV], C1X)!= null or GZX(u, XOV[IDV], C1X)!= null) then
		call InterfaceErrorForPlayer(GetOwningPlayer(u), GetObjectName('n02L'))
		set E3 = GetItemPlayer(C1X)
		call RemoveItem(C1X)
		set Z2 = CreateItem(XXV[GTX], x, y)
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
	endif
	if (GTX == NCV or GTX == NBV or GTX == NFV or GTX == NDV) and(GZX(u, XOV[NCV], C1X)!= null or GZX(u, XOV[NBV], C1X)!= null or GZX(u, XOV[NFV], C1X)!= null or GZX(u, XOV[NDV], C1X)!= null) then
		call InterfaceErrorForPlayer(GetOwningPlayer(u), GetObjectName('n02C'))
		set E3 = GetItemPlayer(C1X)
		call RemoveItem(C1X)
		set Z2 = CreateItem(XXV[GTX], x, y)
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
	endif
	if (GTX == I9V or GTX == AVV or GTX == AEV or GTX == AXV or GTX == AOV or GTX == ARV) then
		set i = LoadInteger(OtherHashTable, GetHandleId(GetOwningPlayer(u)),'0BKB')
		if i == 0 and GTX != I9V then
			set E3 = GetItemPlayer(C1X)
			call HZX(C1X)
			call TDE(trigUnit, XOV[I9V], E3, false, 1)
		elseif i == 9 and GTX != AVV then
			set E3 = GetItemPlayer(C1X)
			call HZX(C1X)
			call TDE(trigUnit, XOV[AVV], E3, false, 1)
		elseif i == 8 and GTX != AEV then
			set E3 = GetItemPlayer(C1X)
			call HZX(C1X)
			call TDE(trigUnit, XOV[AEV], E3, false, 1)
		elseif i == 7 and GTX != AXV then
			set E3 = GetItemPlayer(C1X)
			call HZX(C1X)
			call TDE(trigUnit, XOV[AXV], E3, false, 1)
		elseif i == 6 and GTX != AOV then
			set E3 = GetItemPlayer(C1X)
			call HZX(C1X)
			call TDE(trigUnit, XOV[AOV], E3, false, 1)
		elseif i == 5 and GTX != ARV then
			set E3 = GetItemPlayer(C1X)
			call HZX(C1X)
			call TDE(trigUnit, XOV[ARV], E3, false, 1)
		endif
	endif
	if (GTX == ASV and IsPlayerEnemy(GetItemPlayer(C1X), GetOwningPlayer(u))) then
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		set Z2 = UnitAddItemById(u, XOV[ATV])
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
	endif
	if (GTX == AIV) and(IsUnitMessenger(u) or IsBearUnit(u)) then
		if IsUnitMessenger(u) then
			call InterfaceErrorForPlayer(GetOwningPlayer(u), GetObjectName('n02K'))
		endif
		set E3 = GetItemPlayer(C1X)
		set Q2 = GetItemCharges(C1X)
		call RemoveItem(C1X)
		if GTX == AIV then
			set Z2 = CreateItem(XXV[GTX], GetRectCenterX(gg_rct_RoshanSpawn), GetRectCenterY(gg_rct_RoshanSpawn))
			call SetItemCharges(Z2, Q2)
		endif
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
	endif
	call EnableTrigger(CUV)
	if XMO then
		call XKO(trigUnit, C1X)
	endif
	set u = null
	set C1X = null
	return false
endfunction
function XPO takes integer GTX returns boolean
	return GTX == I0V or GTX == NDV or GTX == NFV or GTX == NHV or GTX == I_V or GTX == NBV or GTX == NCV or GTX == NGV or GTX == X4V or GTX == X5V or GTX == IFV or GTX == IGV
endfunction
function XQO takes integer GTX returns boolean
	return GTX == X4V or GTX == X5V
endfunction
function XSO takes unit trigUnit, item C1X returns boolean
	local integer JAX = 0
	local item UWV = C1X
	local integer GTX = GetItemIndex(UWV)
	local integer XTO = 0
	local boolean JVX = false
	local integer XUO = H1X(UWV)
	local boolean XWO = false
	if IsUnitType(trigUnit, UNIT_TYPE_HERO) then
		if GTX == I0V then
			set XTO = I_V
		elseif GTX == IGV then
			set XTO = IFV
		elseif GTX == NDV then
			set XTO = NBV
		elseif GTX == NFV then
			set XTO = NCV
		elseif GTX == NHV then
			set XTO = NGV
		elseif GTX == X5V then
			set XTO = X4V
		endif
		if XUO == X5V then
			set XTO = X4V
			set XWO = true
		endif
		if XTO != 0 then
			set E3 = GetItemPlayer(UWV)
			call HZX(UWV)
			if XWO then
				set Z2 = UnitAddItemById(trigUnit, XIV[XTO])
			else
				set Z2 = UnitAddItemById(trigUnit, XOV[XTO])
			endif
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			set JVX = true
		endif
	else
		if GTX == X4V then
			set XTO = X5V
		endif
		if XUO == X4V then
			set XTO = X5V
			set XWO = true
		endif
		if XTO != 0 then
			set E3 = GetItemPlayer(UWV)
			call HZX(UWV)
			if XWO then
				set Z2 = UnitAddItemById(trigUnit, XIV[XTO])
			else
				set Z2 = UnitAddItemById(trigUnit, XOV[XTO])
			endif
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			set JVX = true
		endif
	endif
	set UWV = null
	return JVX
endfunction
function XYO takes unit trigUnit, item C1X returns boolean
	if XPO(GetItemIndex(C1X)) or XQO(H1X(C1X)) then
		return XSO(trigUnit, C1X)
	endif
	return false
endfunction
function XZO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit ZWX =(LoadUnitHandle(HY, h, 26))
	local integer X_O =(LoadInteger(HY, h, 97))
	local integer GTX =(LoadInteger(HY, h, 93))
	local boolean X0O =(LoadBoolean(HY, h, 95))
	local item C1X
	local player p = GetOwningPlayer(ZWX)
	local player X1O
	local integer HUX
	local boolean HTX = false
	local item HWX
	//local integer scepter_indexid
	//local integer scepter_abilityid
	//local integer scepter_hiddenabilityid
	local integer newCharges
	local item X2O
	local integer targetCount
	local item X3O
	local boolean X4O = false
	local integer i
	local integer k
	local real tt
	local boolean scepterWorks
	call DisableTrigger(C3V)
	if X0O then
		set X3O = null
		set X1O =(LoadPlayerHandle(HY, h, 54))
		set HUX =(LoadInteger(HY, h, 76))
	else
		set C1X =(LoadItemHandle(HY, h, 96))
		set X3O = C1X
		set X1O = GetItemPlayer(C1X)
		set HUX = GetItemCharges(C1X)
	endif
	if X0O == false and C1X == null then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call EnableTrigger(C3V)
		set t = null
		set ZWX = null
		set p = null
		return false
	endif
	if X_O == 1 then
		if p != X1O and GetUnitTypeId(ZWX)=='ncop' then
			if HGX(GSX(GTX)) or HHX(GSX(GTX)) then
				set HTX = true
			endif
			if IsPlayerEnemy(p, X1O) then
				call HYX(XXV[GTX], CirclesX[GetPlayerId(p)], CirclesY[GetPlayerId(p)], X1O, HTX, HUX)
			else
				call HYX(XXV[GTX], CirclesX[GetPlayerId(X1O)], CirclesY[GetPlayerId(X1O)], X1O, HTX, HUX)
			endif
			call InterfaceErrorForPlayer(p, GetObjectName('n0DR'))
			if X0O == false then
				set X4O = true
				call HZX(C1X)
			endif
		elseif L3 == false and X0O == false and GetItemType(C1X) == ITEM_TYPE_CAMPAIGN and H2X(C1X)!= 0 and(p == X1O or(GetPlayerSlotState(X1O) == PLAYER_SLOT_STATE_LEFT)) then
			if HHX(GTX) then
				set HTX = true
			else
				set HTX = false
			endif
			if not(GetPlayerSlotState(X1O) == PLAYER_SLOT_STATE_LEFT and GUX(GTX)) then
				call HZX(C1X)
				set X4O = true
				set HWX = UnitAddItemById(ZWX, XOV[GTX])
				set X3O = HWX
				call SetItemPlayer(HWX, X1O, false)
				call SetItemUserData(HWX, 0)
				if HTX or GTX == R0V or GTX == R_V or GTX == RYV then
					call SetItemCharges(HWX, HUX)
				endif
			endif
		elseif L3 == false and X0O == false and GetItemType(C1X) == ITEM_TYPE_PERMANENT and p != X1O and XIV[GetItemIndexEx(C1X)]!= 0 and(GetPlayerSlotState(X1O) == PLAYER_SLOT_STATE_LEFT) == false then
			if HHX(GTX) then
				set HTX = true
			else
				set HTX = false
			endif
			call HZX(C1X)
			set X4O = true
			set HWX = UnitAddItemById(ZWX, XIV[GTX])
			set X3O = HWX
			call SetItemPlayer(HWX, X1O, false)
			call SetItemUserData(HWX, 0)
			if HTX then
				call SetItemCharges(HWX, HUX)
			endif
		elseif X0O == false and GetItemType(C1X) == ITEM_TYPE_PERMANENT and HFX(C1X) and IsUnitType(ZWX, UNIT_TYPE_HERO) then
			if HDX(ZWX, false) then
				if GTX == XFV or(IsPlayerHasSkill(X1O,(39 -1)* 4 + 3) and GTX != XDV) then
					call HZX(C1X)
					if IsPlayerHasSkill(X1O,(39 -1)* 4 + 3) then
						set HWX = UnitAddItemById(ZWX, XOV[XDV])
					else
						set HWX = UnitAddItemById(ZWX, XOV[XCV])
					endif
					set X3O = HWX
					call SetItemPlayer(HWX, X1O, false)
					call SetItemUserData(HWX, 1)
				endif
			else
				if GTX != XFV then
					call HZX(C1X)
					set HWX = UnitAddItemById(ZWX, XOV[XFV])
					set X3O = HWX
					call SetItemPlayer(HWX, X1O, false)
					call SetItemUserData(HWX, 1)
				endif
			endif
		elseif X0O == false and GetItemType(C1X) == ITEM_TYPE_ARTIFACT then
			if (p != X1O and IsOfflinePlayer(X1O) == false and(GTX == R0V or GTX == R_V or GTX == RYV)) then
				call DisableTrigger(CUV)
				call HZX(C1X)
				set HWX = UnitAddItemById(ZWX, XIV[GTX])
				set X3O = HWX
				call SetItemPlayer(HWX, X1O, false)
				call SetItemUserData(HWX, 1)
				call SetItemCharges(HWX, HUX)
				call EnableTrigger(CUV)
			else
				call DisableTrigger(CUV)
				set X2O = G1X(X1O, ZWX, GTX, C1X)
				if X2O == null then
				else
					call SetItemCharges(X2O, HUX + GetItemCharges(X2O))
					call HZX(C1X)
					set X3O = null
				endif
				call EnableTrigger(CUV)
			endif
		elseif X0O and HGX(GSX(GTX)) then
			if (p == X1O) then
				call DisableTrigger(CUV)
				if H_X(ZWX) == 0 and G2X(X1O, ZWX, GTX) == null then
					call InterfaceErrorForPlayer(p, GetObjectName('n02O'))
					call HYX(XXV[(GTX)],(((LoadReal(HY, h, 6)))* 1.),(((LoadReal(HY, h, 7)))* 1.),(X1O),(true),(HUX))
				else
					set X2O = G2X(X1O, ZWX, GTX)
					if X2O == null then
						call DisableTrigger(CUV)
						set HWX = UnitAddItemById(ZWX, XOV[GTX])
						set X3O = HWX
						call SetItemPlayer(HWX, X1O, false)
						call SetItemUserData(HWX, 1)
						call SetItemCharges(HWX, HUX)
					else
						call SetItemCharges(X2O, HUX + GetItemCharges(X2O))
					endif
				endif
				call EnableTrigger(CUV)
			else
				if XIV[GTX]> 0 then
					set Q2 = XIV[GTX]
				else
					set Q2 = XOV[GTX]
				endif
				call DisableTrigger(CUV)
				set X2O = G2X(X1O, ZWX, GTX)
				if X2O == null and H_X(ZWX)!= 0 then
					set HWX = UnitAddItemById(ZWX, Q2)
					set X3O = HWX
					call SetItemPlayer(HWX, X1O, false)
					call SetItemUserData(HWX, 1)
					call SetItemCharges(HWX, HUX)
				elseif X2O == null and H_X(ZWX) == 0 then
					call InterfaceErrorForPlayer(p, GetObjectName('n02O'))
					call HYX(XXV[(GTX)],(((LoadReal(HY, h, 6)))* 1.),(((LoadReal(HY, h, 7)))* 1.),(X1O),(true),(HUX))
				else
					call SetItemCharges(X2O, HUX + GetItemCharges(X2O))
				endif
				call EnableTrigger(CUV)
			endif
		elseif X0O then
			call EJO(X1O, ZWX, null, GTX, LoadReal(HY, h, 6), LoadReal(HY, h, 7), HUX, 1)
		elseif X0O == false and(GetItemType(C1X) == ITEM_TYPE_PERMANENT or GetItemType(C1X) == ITEM_TYPE_CAMPAIGN) then
			call SetItemUserData(C1X, 1)
			set X4O = ECO(X1O, ZWX, 0)
		endif
		if X4O == false and X3O != null and H8X(X3O) == false then
			set X4O = XYO(ZWX, X3O)
		endif
		if X4O == false and X3O != null and H8X(X3O) == false then
			call XLO(ZWX, X3O)
		endif
	else
		if GetWidgetLife(C1X)> 0 then
			set Z2 = C1X
			if HFX(C1X) then
				call HDX(ZWX, true)
			endif
			if GetItemUserData(C1X)==-500 then
				call RemoveItem(C1X)
			elseif IsItemOwned(C1X) == false then
				if GetItemType(C1X) == ITEM_TYPE_ARTIFACT or HHX(GTX) or GTX == R_V or GTX == RYV or GTX == R0V or GTX == it_jys then
					set HTX = true
				endif
				call HYX(XXV[GTX], GetItemX(C1X), GetItemY(C1X), X1O, HTX, HUX)
				call HZX(C1X)
			endif
		endif
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call EnableTrigger(C3V)
	set t = null
	set C1X = null
	set ZWX = null
	set p = null
	set X1O = null
	set HWX = null
	set X2O = null
	set X3O = null
	return false
endfunction 

function XHYZR takes nothing returns nothing
	if BHYZR == false then
		call RegisterUnitAttackEvent("Hyzr", 1)	//回音战刃攻击
		set BHYZR = true
	endif
endfunction

function X5O takes nothing returns nothing
	if UX == false then
		call RegisterUnitAttackEvent("X6O", 0)	//静谧之鞋
		set UX = true
	endif
endfunction

function X7O takes nothing returns nothing
	if BV == false then
		call RegisterUnitAttackEvent("X8O", 1)	//雷神之锤and漩涡
		set BV = true
	endif
endfunction
function X9O takes nothing returns nothing
	if QX == false then
		call RegisterUnitAttackEvent("OVO", 0)	//压制之刃
		set QX = true
	endif
endfunction
function OEO takes nothing returns nothing
	if PX == false then
		call RegisterUnitAttackEvent("OXO", 0)	//净魂之刃
		set PX = true
	endif
endfunction
function OOO takes nothing returns nothing
	if MX == false then
		call RegisterUnitAttackEvent("ORO", 1)	//黯灭
		set MX = true
	endif
endfunction
function OOZ takes nothing returns nothing
	call RegisterUnitAttackEvent("OPL", 0)	//所有物品吸血 模拟
endfunction
function OIO takes nothing returns nothing
	if TX == false then
		call RegisterUnitAttackEvent("OAO", 3)	//淬毒之珠
		set TX = true
	endif
endfunction
function ONO takes nothing returns nothing
	if SX == false then
		call RegisterUnitAttackEvent("OBO", 2)	//斯嘉蒂之眼
		set SX = true
	endif
endfunction
function OCO takes nothing returns nothing
	if BE == false then
		call RegisterUnitAttackEvent("ODO", 2)	//白银之锋
		set BE = true
	endif
endfunction
function OFO takes nothing returns nothing
	if EV == false then
		call RegisterUnitAttackEvent("OGO", 0)	//祭品
		set EV = true
	endif
endfunction
function OHO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local player p = LoadPlayerHandle(HY, h, 0)
	local integer pid = GetPlayerId(p)
	local integer goldold = LoadInteger(HY, h, 0)
	local integer goldBonus = GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)
	local integer OJO = TEX(LoadInteger(HY, h, 1))/ 2
	if OJO > 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 5, "出售刚刚购入的物品,额外返还  |cfffffa00" + I2S(OJO)+ "|r 金钱.")
		call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)+ OJO)
		call SaveInteger(ObjectHashTable,'ITEM', pid, 0)
		call SaveReal(ObjectHashTable,'ITEM', pid, .0)
	endif
	call PauseTimer(t)
	call DestroyTimer(t)
	call RemoveSavedHandle(OtherHashTable2,'ITEM', GetPlayerId(p))
	set t = null
endfunction
function OKO takes item it returns boolean
	return XOV[GetItemIndexEx(it)]== XOV[OFV]
endfunction
function OLO takes player p, item it returns nothing
	local timer t
	local integer goldBonus
	local integer pid = GetPlayerId(p)
	if XOV[GetItemIndexEx(it)]== LoadInteger(ObjectHashTable,'ITEM', pid) and GetGameTime()-LoadReal(ObjectHashTable,'ITEM', pid)< 10. and OKO(it) == false and HaveSavedHandle(OtherHashTable2,'ITEM', GetPlayerId(p)) == false then
		set t = CreateTimer()
		set goldBonus = GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)
		call TimerStart(t, 0, false, function OHO)
		call SavePlayerHandle(HY, GetHandleId(t), 0, p)
		call SaveInteger(HY, GetHandleId(t), 0, goldBonus)
		call SaveTimerHandle(OtherHashTable2,'ITEM', GetPlayerId(p), t)
		call SaveInteger(HY, GetHandleId(t), 1, GetItemTypeId(it))
		set t = null
	endif
endfunction

function MCBZZ takes player p, integer st , unit u returns nothing
	if st == 0 then
		if LoadBoolean(HY, GetHandleId(p),'R00O') then
			//	("丢弃时减射程")
			call RemoveSavedBoolean(HY, GetHandleId(p),'R00O')
			call mlq_reducerange(u)
		endif
	else
		if not LoadBoolean(HY, GetHandleId(p),'R00O') then
			//	("拾取时加射程")
			call SaveBoolean(HY, GetHandleId(p),'R00O', true)
			call mlq_addrange(u)
		endif
	endif
endfunction

function Item_dragonlance takes boolean MCBCZ returns nothing
	if MCBCZ then
		if GZX(GetTriggerUnit(), XOV[it_mlq], GetManipulatedItem()) == null and GZX(GetTriggerUnit(), XOV[Item_HurricanePike], GetManipulatedItem()) == null then
			//("丢弃")
			call MCBZZ(GetTriggerPlayer(), 0, GetTriggerUnit())
		endif
	else
		//("拾取")
		call MCBZZ(GetTriggerPlayer(), 1, GetTriggerUnit())
	endif
endfunction

#define AETHER_LENS_CAST_RANGE_BONUS 150.

function GetUnitCastRangeBonus takes unit whichUnit returns real
	return MHUnit_GetSpellRange(whichUnit)
endfunction
function AetherLensOnPick takes unit whichUnit returns nothing
	local player p = GetOwningPlayer(whichUnit)
	if not LoadBoolean(HY, GetHandleId(p),'A3O3') then
		call SaveBoolean(HY, GetHandleId(p),'A3O3', true)
		call MHUnit_AddSpellRange(whichUnit, GetUnitCastRangeBonus(whichUnit) + AETHER_LENS_CAST_RANGE_BONUS)	
		call BJDebugMsg("我说我加了施法射程你耳聋吗？现在是：" + R2S(GetUnitCastRangeBonus(whichUnit)))
	endif
endfunction
function AetherLensOnDrop takes unit whichUnit returns nothing
	local player p = GetOwningPlayer(whichUnit)
	if LoadBoolean(HY, GetHandleId(p),'A3O3') then
		call RemoveSavedBoolean(HY, GetHandleId(p),'A3O3')
		call MHUnit_AddSpellRange(whichUnit, GetUnitCastRangeBonus(whichUnit) - AETHER_LENS_CAST_RANGE_BONUS)
		call BJDebugMsg("一点施法射程不要也罢，现在是：" + R2S(GetUnitCastRangeBonus(whichUnit)))
	endif
endfunction

function QTUWW takes unit u, boolean WEWQQ returns nothing
	local real r = GetUnitState(u, UNIT_STATE_ATTACK1_RANGE) 
	if not IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
		if WEWQQ then
			if r < 90000 then
				call Unit_Setrange(u, r + 90000)
			endif
		else
			if r > 90000 then
				call Unit_Setrange(u, r -90000)
			endif
		endif
	endif
endfunction

function UYYEQ1 takes unit src, unit dst returns nothing
	local integer h = GetHandleId(src)
	if LoadReal(HY, h,'A3UC')< GetGameTime() or LoadReal(HY, h,'A3UC') == 0 then
		call QTUWW(src, false)
		call RemoveSavedReal(HY, h,'A3UC')
		call UnitRemoveAbility(src,'A3UC')
		call UnitRemoveAbility(src,'a3UC')
	else
		if GetUnitAbilityLevel(src,'A3UC')> 0 and dst != LoadUnitHandle(HY, h,'A3UC') then
			call UnitRemoveAbility(src,'A3UC')
			call UnitRemoveAbility(src,'a3UC')
			call QTUWW(src, false)
		elseif LoadInteger(HY, h,'A3UC')> 0 and dst == LoadUnitHandle(HY, h,'A3UC') then
			call UnitAddAbility(src,'A3UC')
			call QTUWW(src, true)
		endif
	endif
endfunction

function UYYEQ takes nothing returns nothing
	call UYYEQ1(DESource, DETarget)
endfunction
function QTUYW takes nothing returns nothing
	local integer h = GetHandleId(GetExpiredTimer())
	call UYYEQ1(LoadUnitHandle(HY, h, 0), null)
	call FlushChildHashtable(HY, GetHandleId(GetExpiredTimer()))
	call DestroyTimer(GetExpiredTimer())
endfunction
function QTUUW takes nothing returns nothing
	local integer h = TimerStartSingle(0, function QTUYW)
	call SaveUnitHandle(HY, h, 0, DESource)
endfunction
function UYYRQ takes nothing returns nothing
	local integer h = GetHandleId(DESource)
	local integer i = LoadInteger(HY, h,'A3UC')
	//	if i > 0 and LoadUnitHandle(HY, h,'A3UC') == T4 then
	if i > 0 then
		if i == 1 then
			call RemoveSavedInteger(HY, h,'A3UC')
			call RemoveSavedReal(HY, h,'A3UC')
			call QTUUW()
		else
			call SaveInteger(HY, h,'A3UC', i -1)
		endif
	elseif i > 0 then
	endif
endfunction

// 获取装备和丢弃装备
function OMO takes nothing returns boolean
	local item C1X
	local integer X_O
	local unit u = GetTriggerUnit()
	local trigger t
	local integer h
	//local integer scepter_indexid
	//local integer scepter_abilityid
	local integer id
	local integer k
	local item it
	local integer i = GetItemTypeId(GetManipulatedItem())
	set GR[GetPlayerId(GetOwningPlayer(u))]= true
	set id = GetPlayerId(GetOwningPlayer(u))
	// 非镜像 英雄或者熊灵
	if (IsUnitType(u, UNIT_TYPE_HERO) or IsBearUnit(u)) and not IsUnitIllusion(u) then
		if GetTriggerEventId() == EVENT_PLAYER_UNIT_PICKUP_ITEM then
			if i == XOV[A5V]or i == XOV[RXV]or i == XOV[AWV]or i == XOV[N1V]or i == XOV[RJV] or i == XOV[ASV] then
				if i == XOV[A5V] then
					call EnableAttackEffectByTime(2, 0)
				elseif i == XOV[RXV] then
					call EnableAttackEffectByTime(6, 0)
				elseif i == XOV[N1V] then
					call EnableAttackEffectByTime(3, 0)
				elseif i == XOV[RJV] then
					call EnableAttackEffectByTime(5, 0)
				elseif i == XOV[AWV] or i == XOV[ASV] then
					call EnableAttackEffectByTime(17, 0)
				endif
			endif
			if i == XOV[OXV] or i == XOV[I1V] or i == XOV[I_V] or i == XOV[A2V]  then
				call OOZ()
			endif
			if i == XOV[OYV] then
				set CDV[id]= CDV[id] + 1
			elseif i == XOV[X9V] then
				set HaveBlinkDaggerCount = HaveBlinkDaggerCount + 1
				set CFV[id]= CFV[id] + 1
			elseif i == XOV[AWV]or i == XOV[AYV] then
				call ExecuteFunc("OPO")
			elseif i == XOV[NIV] then
				set CZV = CZV + 1
				set CGV[id]= CGV[id] + 1
			elseif i == XOV[IQV]or(i) == XOV[N2V] then
				set CHV[id]= CHV[id] + 1
				call ExecuteFunc("OPO")
			elseif i == XOV[I6V] or i == XOV[it_fj] then
				call OOO()
			elseif i == XOV[A0V] then
				set HaveHeartofTarrasqueCount = HaveHeartofTarrasqueCount + 1
				set C7V[id]= C7V[id] + 1
			elseif i == XOV[APV] then
				set CWV = CWV + 1
				set CJV[id]= CJV[id] + 1
				call DisableTrigger(CUV)
				set it = CreateItem('I0HM', GetUnitX(u), GetUnitY(u))
				call UnitAddItem(u, it)
				if GetWidgetLife(it)> 0 then
					call RemoveItem(it)
				endif
				set it = null
				call EnableTrigger(CUV)
			elseif i == XOV[I5V] then
				set CKV[id]= CKV[id] + 1
			elseif i == XOV[IPV] then
				set CLV[id]= CLV[id] + 1
			elseif i == XOV[N1V] then
				set C1V[id]= C1V[id] + 1
			elseif i == XOV[RLV] then
				set C1Z[id]= C1Z[id] + 1
				call OCO()
			elseif i == XOV[RNV] then
				set HaveTranquilBootsCount = HaveTranquilBootsCount + 1
				call X5O()
				set C8V[id]= C8V[id] + 1
			elseif i == XOV[RFV] then //玲珑心
				if HaveSpellLifesteal == false then
					set HaveSpellLifesteal = true
				endif
			elseif i == XOV[it_hyzr] then
				call XHYZR()
			elseif i == XOV[RVV]or i == XOV[REV] then
				call X9O()
			elseif i == XOV[IUV]or i == XOV[IWV]or id == XOV[IYV] then
				call OEO()
			elseif i == XOV[A3V]or i == XOV[A4V] then
				call ONO()
			elseif i == XOV[XKV]or i == XOV[XLV] then
				call OIO()
			elseif i == XOV[NEV]or i == XOV[ITV] then	//漩涡and雷神之锤
				call X7O()
			elseif i == XOV[A5V] then
				if HaveSavedHandle(HY, GetHandleId(u),'AIev') == false then
					call UnitAddPermanentAbility(u,'A431')
					call UnitMakeAbilityPermanent(u, true,'AIev')
				endif
			elseif i == XOV[NOV] then
				call OFO()
			elseif i == XOV[it_mlq] or i == XOV[Item_HurricanePike] then //拾取魔龙枪
				if not IsBearUnit(u) then
					call Item_dragonlance(false)
					if i == XOV[Item_HurricanePike] then
						call RegisterUnitAttackEvent("UYYEQ",-1)
						call RegisterUnitAttackEvent("UYYRQ", 2)
					endif
				endif
			elseif i == XOV[Item_AetherLens] then
				call AetherLensOnPick(u)
			endif
		elseif GetTriggerEventId() == EVENT_PLAYER_UNIT_DROP_ITEM then
			if i == XOV[OYV] then
				set CDV[id]= CDV[id]-1
			elseif i == XOV[X9V] then
				set CFV[id]= CFV[id]-1
				set HaveBlinkDaggerCount = HaveBlinkDaggerCount -1
			elseif i == XOV[RNV] then
				set C8V[id]= C8V[id]-1
				set HaveTranquilBootsCount = HaveTranquilBootsCount -1
			elseif i == XOV[NIV] then
				set CGV[id]= CGV[id]-1
				set CZV = CZV -1
			elseif i == XOV[IQV]or(i) == XOV[N2V] then
				set CHV[id]= CHV[id]-1
				if CHV[id]< 1 or GZX(u, XOV[IQV], GetManipulatedItem()) == null or GZX(u, XOV[N2V], GetManipulatedItem()) == null then
					call UnitRemoveAbility(u,'A174')
				endif
			elseif i == XOV[A0V] then
				set C7V[id]= C7V[id]-1
				set HaveHeartofTarrasqueCount = HaveHeartofTarrasqueCount -1
			elseif i == XOV[APV]or i == XIV[APV] then
				set CWV = IMaxBJ(CWV -1, 0)
				set CJV[id]= IMaxBJ(CJV[id]-1, 0)
				call UnitRemoveAbility(u,'B0BI')
			elseif i == XOV[A5V] then
				if GZX(u, XOV[A5V], GetManipulatedItem()) == null then
					call UnitRemoveAbility(u,'A431')
				endif
				//魔龙枪和飓风长戟
			elseif i == XOV[it_mlq] or i == XOV[Item_HurricanePike]  then 
				if not IsBearUnit(u) then
					call Item_dragonlance(true)
				endif
			elseif i == XOV[Item_AetherLens] then
				call AetherLensOnDrop(u)
			endif
		endif
	endif
	if GetTriggerEventId() == EVENT_PLAYER_UNIT_PAWN_ITEM then
		set C1X = GetSoldItem()
		call SetItemUserData(C1X,-2)
		call OLO(GetOwningPlayer(u), C1X)
		set Z2 = C1X
		if HFX(C1X) then
			call HDX(u, true)
		endif
	elseif GetItemTypeId(GetManipulatedItem())!='I02M' then
		set C1X = GetManipulatedItem()
		if IsUnitIllusion(u) or GetItemUserData(C1X)==-2 then
			set C1X = null
			set u = null
			set t = null
			return false
		endif
		if GetTriggerEventId() == EVENT_PLAYER_UNIT_PICKUP_ITEM then
			set X_O = 1
		else
			set X_O = 2
		endif
		if ((X_O == 1) or(X_O == 2 and H8X(C1X) == false and GetWidgetLife(C1X)> 0)) and GetUnitTypeId(u)!='H00J' then
			if ZBX(GetItemTypeId(C1X)) or ZNX(GetItemTypeId(C1X)) or GetItemTypeId(C1X)=='I0HM' then
				set C1X = null
				set u = null
				set t = null
				return false
			endif
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call TriggerRegisterTimerEvent(t, 0, false)
			call TriggerAddCondition(t, Condition(function XZO))
			call SaveUnitHandle(HY, h, 26,(u))
			call SaveInteger(HY, h, 97,(X_O))
			call SaveInteger(HY, h, 93,(GetItemIndexEx(C1X)))
			call SaveItemHandle(HY, h, 0, C1X)
			if H8X(C1X) then
				call SaveBoolean(HY, h, 95,(true))
				call SavePlayerHandle(HY, h, 54,(GetItemPlayer(C1X)))
				call SaveInteger(HY, h, 76,(GetItemCharges(C1X)))
				call SaveReal(HY, h, 6,((GetItemX(C1X))* 1.))
				call SaveReal(HY, h, 7,((GetItemY(C1X))* 1.))
				call HZX(C1X)
			else
				call SaveBoolean(HY, h, 95,(false))
				call SaveItemHandle(HY, h, 96,(C1X))
				call SetItemUserData(C1X, 0)
			endif
		endif
	endif
	set C1X = null
	set u = null
	set t = null
	return false
endfunction
function OQO takes unit trigUnit, integer OSO, boolean OTO returns nothing
	local string OUO
	local string s
	local player p = GetOwningPlayer(trigUnit)
	local real d = 2
	local string OWO = "Use"
	if OTO then
		set OWO = "Store"
	endif
	if OSO =='I006'or OSO == ZIX('I006') then
		set OUO = "|c00ff0000" + GetObjectName('n0JQ')+ "|r"
		call StoreDrCacheData("Rune" + OWO + "1", GetPlayerId(p))
	elseif OSO =='I008'or OSO == ZIX('I008') then
		set OUO = "|c0000ff00" + GetObjectName('n0JN')+ "|r"
		call StoreDrCacheData("Rune" + OWO + "2", GetPlayerId(p))
	elseif OSO =='I00K'or OSO == ZIX('I00K') then
		set OUO = "|c000000ff" + GetObjectName('n0K3')+ "|r"
		call StoreDrCacheData("Rune" + OWO + "3", GetPlayerId(p))
	elseif OSO =='I007'or OSO == ZIX('I007') then
		set OUO = "|c00afaf00" + GetObjectName('n0K2')+ "|r"
		call StoreDrCacheData("Rune" + OWO + "4", GetPlayerId(p))
	elseif OSO =='I00J'or OSO == ZIX('I00J') then
		set OUO = "|c00652DC1" + GetObjectName('n0K4')+ "|r"
		call StoreDrCacheData("Rune" + OWO + "5", GetPlayerId(p))
	elseif OSO =='I0QA'or OSO == ZIX('I0QA') then
		set OUO = "|c00ffff01" + "赏金神符" + "|r"
		call StoreDrCacheData("Rune" + OWO + "6", GetPlayerId(p))
	endif
	if OTO then
		set s = PlayersColoerText[GetPlayerId(p)] + GetUnitName(trigUnit)+ "|r " + GetObjectName('n0GU')+ "|r " + OUO + " " + GetObjectName('n0GW')
		set d = 1
	else
		if C2V then
			set s = PlayersColoerText[GetPlayerId(p)] + GetUnitName(trigUnit)+ "|r " + GetObjectName('n0GV')+ "|r " + OUO + " " + GetObjectName('n0GW')
		else
			set s = PlayersColoerText[GetPlayerId(p)] + GetUnitName(trigUnit)+ "|r " + GetObjectName('n0GT')+ "|r " + OUO + " " + GetObjectName('n0GW')
		endif
	endif
	if (IsPlayerAlly(LocalPlayer, p) and LocalPlayer!= p) or IsObserverPlayer(LocalPlayer) or JE then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, d, s)
	endif
	set p = null
endfunction
function OYO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 0)
	local integer GFX = LoadInteger(HY, h, 0)
	local real OZO = LoadReal(HY, h, 0)
	local real O_O = LoadReal(HY, h, 1)
	local real WLV = LoadReal(HY, h, 2)
	if UnitAlive(targetUnit) and GetUnitAbilityLevel(targetUnit, GFX)> 0 then
		if O_O > 0 then
			call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)+ O_O / WLV * .1)
		endif
		if OZO > 0 and OYX(targetUnit) == false then
			call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+ OZO / WLV * .1)
		endif
	else
		call SaveBoolean(ObjectHashTable, GetHandleId(targetUnit), GFX, false)
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	endif
	set t = null
	set targetUnit = null
endfunction
function O0O takes real hp, real mp, real SYV, integer GFX, unit targetUnit returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .1, true, function OYO)
	call SaveUnitHandle(HY, h, 0, targetUnit)
	call SaveBoolean(ObjectHashTable, GetHandleId(targetUnit), GFX, true)
	call SaveInteger(HY, h, 0, GFX)
	call SaveReal(HY, h, 0, hp)
	call SaveReal(HY, h, 1, mp)
	call SaveReal(HY, h, 2, SYV)
	set t = null
endfunction
function O1O takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 0)
	local integer O2O = LoadInteger(HY, h, 1)
	local integer GFX = LoadInteger(HY, h, 0)
	local real O3O = LoadReal(HY, h, 0)
	local real WLV = LoadReal(HY, h, 1)
	if UnitAlive(targetUnit) and GetUnitAbilityLevel(targetUnit, GFX)> 0 then
		if O2O =='00MP' then
			call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)+ O3O / WLV * .1)
		elseif O2O =='00HP' then
			if OYX(targetUnit) == false then
				call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+ O3O / WLV * .1)
			endif
		endif
	else
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	endif
	set t = null
	set targetUnit = null
endfunction
function SmoothHealingSystem takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local unit targetUnit = GetSpellTargetUnit()
	call TimerStart(t, .1, true, function O1O)
	call SaveUnitHandle(HY, h, 0, targetUnit)
	if GetSpellAbilityId()=='AIpl' or GetSpellAbilityId()=='A1WA' then
		call SaveInteger(HY, h, 0,'BIrm')
		call SaveInteger(HY, h, 1,'00MP')
		call SaveReal(HY, h, 0, 170)
		call SaveReal(HY, h, 1, 45)
	else
		call SaveInteger(HY, h, 0,'B02Z')
		call SaveInteger(HY, h, 1,'00HP')
		call SaveReal(HY, h, 0, 400)
		call SaveReal(HY, h, 1, 10)
	endif
	set t = null
	set targetUnit = null
endfunction
function O4O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	if GetUnitAbilityLevel(trigUnit,'B01S') == 0 or(GetWidgetLife(trigUnit) == GetUnitState(trigUnit, UNIT_STATE_MAX_LIFE) and GetUnitState(trigUnit, UNIT_STATE_MANA) == GetUnitState(trigUnit, UNIT_STATE_MAX_MANA)) then
		call UnitRemoveAbility(trigUnit,'B01S')
		call UnitRemoveAbility(trigUnit,'B04A')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set trigUnit = null
	return false
endfunction
function O5O takes unit trigUnit, item C1X returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function O4O))
	call SaveUnitHandle(HY, h, 14, trigUnit)
	set t = null
	if LoadBoolean(ObjectHashTable, GetHandleId(trigUnit),'B01S') == false then
		call O0O( 3000, 2000, 30,'B01S', trigUnit)
	endif
endfunction
function O6O takes unit trigUnit, item C1X returns nothing
	local unit u = trigUnit
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(u),'e00E', x, y, 0)
	call UnitAddAbility(dummyCaster,'A0GR')
	call IssueTargetOrderById(dummyCaster, 852274, u)
	call IssueTargetOrderById(dummyCaster, 852274, u)
	set u = null
	set dummyCaster = null
endfunction
function O7O takes nothing returns nothing
	local unit O8O = LoadUnitHandle(HY, 690, 1)
	local integer O9O = 0
	local timer t = GetExpiredTimer()
	loop
	exitwhen O9O > 6
		if GetItemTypeId(UnitItemInSlot(O8O, O9O)) == 0 then
			call UnitRemoveItemFromSlot(O8O, O9O)
		endif
		set O9O = O9O + 1
	endloop
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set O8O = null
endfunction
function RVO takes unit u returns nothing
	local integer m = IMaxBJ(0, R2I((GetGameTime()-PickModeElapsed)/ 60))
	local integer g
	local integer xp
	if NV then
		set g = 100 
		set xp = 100 
	else
		set g = m * 2 + 50
		set xp = m * 5 + 50
	endif
	if GetUnitAbilityLevel(u,'B00X')!= 0 then
		set g = R2I(g *(GetUnitAbilityLevel(u,'A0O3')* .5 + 2.5))
	endif
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\ResourceItems\\ResourceEffectTarget.mdl", u, "origin"))
	call BMX(GetOwningPlayer(u), u, g)
	if IsUnitType(u, UNIT_TYPE_HERO) then
		call AddHeroXPSimple(u, xp, true)
	endif
endfunction
function REO takes unit u, integer id returns nothing
	local item it = CreateItem(ZAX(id), GetUnitX(u), GetUnitY(u))
	if UnitAddItem(u, it) and GetWidgetLife(it)<= 0 then
	else
		call RemoveItem(it)
	endif
	set it = null
endfunction
function RXO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 26))
	local integer ROO =(LoadInteger(HY, h, 98))
	local item C1X = UnitItemInSlot(u, ROO)
	local integer RRO =(LoadInteger(HY, h,'i'))
	local item RIO
	local integer JNX
	local integer id
	local integer TZE = GetItemIndexEx(C1X)
	if C1X != null and GUX(TZE) and GetHandleId(C1X) == RRO and UnitAlive(u) and UnitAlive(u) then
		set id = GWX(TZE)
		set JNX = B2X(u, C1X)
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		set Z2 = JIX(u, XOV[O2V], JNX)
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UZV(u, id)
	endif
	set t = null
	set u = null
	set C1X = null
	set RIO = null
	return false
endfunction
function RAO takes unit u, item RIO returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer ROO = B2X(u, RIO)
	call SaveInteger(HY, h, 98,(ROO))
	call SaveInteger(HY, h,'i',(GetHandleId(RIO)))
	call SaveUnitHandle(HY, h, 26,(u))
	call TriggerRegisterTimerEvent(t, 120, true)
	call TriggerAddCondition(t, Condition(function RXO))
	set t = null
endfunction
function RNO takes integer JAX returns integer
	if JAX =='I006' then
		return O5V
	elseif JAX =='I008' then
		return O6V
	elseif JAX =='I00J' then
		return O3V
	elseif JAX =='I00K' then
		return O4V
	elseif JAX =='I007' then
		return O7V
	elseif JAX =='I0QA' then
		return O8V
	endif
	return -1
endfunction
function RBO takes unit u returns nothing
	call UnitAddAbilityToTimed(u,'A3FL', 1, 45,'B01P')
	call UnitMakeAbilityPermanent(u, true,'A3FK')
	call SetAllPlayerAbilityUnavailable('A3FL')
endfunction
function RCO takes unit trigUnit, item C1X returns nothing
	local item it
	local integer i
	local integer k
	local boolean borrowed = false
	if ZNX(GetItemTypeId(C1X)) then
		set it = GetItemOfTypeFromUnit(trigUnit, XOV[O_V])
		if it == null then
			set it = GetItemOfTypeFromUnit(trigUnit, XOV[O0V])
		endif
		if it == null then
			set it = GetItemOfTypeFromUnit(trigUnit, XOV[O1V])
		endif
		if it == null then
			set it = GetItemOfTypeFromUnit(trigUnit, XOV[O2V])
		endif
		if it == null then
			set it = GetItemOfTypeFromUnit(trigUnit, XIV[O_V])
		endif
		if it == null then
			set it = GetItemOfTypeFromUnit(trigUnit, XIV[O0V])
		endif
		if it == null then
			set it = GetItemOfTypeFromUnit(trigUnit, XIV[O1V])
		endif
		if it == null then
			set it = GetItemOfTypeFromUnit(trigUnit, XIV[O2V])
		endif
		if it != null then
			if XI[GetPlayerId(GetOwningPlayer(trigUnit))]== false then
				set i = B2X(trigUnit, it)
				set k = RNO(ZAX(GetItemTypeId(C1X)))
				call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl", trigUnit, "overhead"))
				set E3 = GetItemPlayer(it)
				call HZX(it)
				call DisableTrigger(CUV)
				if GetOwningPlayer(trigUnit) == E3 then
					set Z2 = JIX(trigUnit, XOV[k], i)
				else
					set Z2 = JIX(trigUnit, XIV[k], i)
				endif
				call EnableTrigger(CUV)
				call SetItemPlayer(Z2, E3, false)
				call SetItemUserData(Z2, 1)
				set it = UnitItemInSlot(trigUnit, i)
				call RAO(trigUnit, it)
				call OQO(trigUnit, GetItemTypeId(C1X), true)
			else
				set i = B2X(trigUnit, it)
				set k = O2V
				call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl", trigUnit, "overhead"))
				set E3 = GetItemPlayer(it)
				call HZX(it)
				call DisableTrigger(CUV)
				if GetOwningPlayer(trigUnit) == E3 then
					set Z2 = JIX(trigUnit, XOV[k], i)
				else
					set Z2 = JIX(trigUnit, XIV[k], i)
				endif
				call EnableTrigger(CUV)
				call SetItemPlayer(Z2, E3, false)
				call SetItemUserData(Z2, 1)
				call REO(trigUnit, GetItemTypeId(C1X))
			endif
		else
			call REO(trigUnit, GetItemTypeId(C1X))
		endif
	elseif ZBX(GetItemTypeId(C1X)) then
		call OQO(trigUnit, GetItemTypeId(C1X), false)
	endif
	if GetItemTypeId(C1X)=='I007' then
		call O6O(trigUnit, C1X)
	elseif GetItemTypeId(C1X)=='I0QA' then
		call RVO(trigUnit)
	elseif GetItemTypeId(C1X)=='I00J' then
		if GetUnitAbilityLevel(trigUnit,'B09Y')> 0 then
			call UnitRemoveAbility(trigUnit,'B09Y')
			call UnitRemoveAbility(trigUnit,'B01Q')
			call DisableTrigger(GetTriggeringTrigger())
			call UnitAddItemById(trigUnit,'I00J')
			call EnableTrigger(GetTriggeringTrigger())
		endif
	elseif GetItemTypeId(C1X)=='I008' then
		call O5O(trigUnit, C1X)
	elseif GetItemTypeId(C1X)=='I00K' then
		call RBO(trigUnit)
	endif
	set it = null
endfunction
function RDO takes item C1X, unit whichUnit, boolean RFO returns nothing
	local integer GTX = GetItemIndexEx(C1X)
	local integer h = GetHandleId(whichUnit)
	local string s = ""
	// 宝石
	if (GTX == X4V and GZX(whichUnit, X4V, C1X) == null) or(GTX == X5V and GZX(whichUnit, X5V, C1X) == null) then
		if IsPlayerAlly(LocalPlayer, GetOwningPlayer(whichUnit)) or IsObserverPlayer(LocalPlayer) then
			set s = "Abilities\\Spells\\Human\\MagicSentry\\MagicSentryCaster.mdl"
		endif
		if RFO then
			if H_X(whichUnit)> 0 or GetItemType(C1X) == ITEM_TYPE_PERMANENT or GetItemType(C1X) == ITEM_TYPE_CAMPAIGN then
				if GetUnitAbilityLevel(whichUnit,'A26A') == 0 and GetUnitAbilityLevel(whichUnit,'A26B') == 0 then
					if s == "Abilities\\Spells\\Human\\MagicSentry\\MagicSentryCaster.mdl" then
						call UnitAddPermanentAbility(whichUnit,'A26A')
					else
						call UnitAddPermanentAbility(whichUnit,'A26B')
					endif
				endif
			endif
		else
			if not(GetUnitAbilityLevel(whichUnit,'A26A') == 0 and GetUnitAbilityLevel(whichUnit,'A26B') == 0) then
				call UnitRemoveAbility(whichUnit,'A26B')
				call UnitRemoveAbility(whichUnit,'A26A')
				call RemoveSavedHandle(HY, h, 670)
			endif
		endif
	endif
endfunction
function RGO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer i = 0
	local integer k = UnitInventorySize(u)
	local item it
	local integer pid = GetPlayerId(GetOwningPlayer(u))
	call RemoveSavedHandle(HY, GetHandleId(u),'INVR')
	call DestroyTimer(t)
	loop
		set it = UnitItemInSlot(u, i)
		if it != null then
			call StoreDrCacheData("LoD_INV_" + I2S(pid), GetItemTypeId(it))
		endif
		set i = i + 1
	exitwhen i > k
	endloop
	set it = null
	set t = null
	set u = null
endfunction
function RHO takes unit u returns nothing
	local timer t
	local integer h
	local integer hu = GetHandleId(u)
	if GV == false then
		return
	endif
	if not HaveSavedHandle(HY, hu,'INVR') then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveTimerHandle(HY, hu,'INVR', t)
		call TimerStart(t, .1, false, function RGO)
		call SaveUnitHandle(HY, h, 0, u)
		set t = null
	else
		call TimerStart(LoadTimerHandle(HY, hu,'INVR'), .1, false, function RGO)
	endif
endfunction

function RJO takes nothing returns boolean
	local unit whichUnit = GetTriggerUnit()
	local item whichItem = GetManipulatedItem()
	local integer id = GetItemTypeId(whichItem)
	if whichItem == null or IsUnitIllusion(whichUnit) or not IsUnitType(whichUnit, UNIT_TYPE_HERO) or GetItemTypeId(whichItem)=='I02M' then
		set whichUnit = null
		set whichItem = null
		return false
	endif
	if GetItemIndexEx(whichItem)> 0 then
		if (GetTriggerEventId() == EVENT_PLAYER_UNIT_DROP_ITEM and GetItemType(whichItem)!= ITEM_TYPE_PURCHASABLE) or GetTriggerEventId() == EVENT_PLAYER_UNIT_PAWN_ITEM then
			call RDO(whichItem, whichUnit, false)
			call StoreDrCacheData("DRI_" + I2S(GetPlayerId(GetOwningPlayer(whichUnit))), XOV[GSX(GetItemIndexEx(whichItem))])
			call RHO(whichUnit)
		elseif GetTriggerEventId() == EVENT_PLAYER_UNIT_PICKUP_ITEM then
			call RDO(whichItem, whichUnit, true)
			call StoreDrCacheData("PUI_" + I2S(GetPlayerId(GetOwningPlayer(whichUnit))), XOV[GSX(GetItemIndexEx(whichItem))])
			call RHO(whichUnit)
		endif
	endif
	set whichUnit = null
	set whichItem = null
	return false
endfunction

function RKO takes player p, integer RLO, integer id, real x, real y returns nothing
	local item it = CreateItem(XXV[id], x, y)
	call SetItemPlayer(it, p, false)
	call SetItemUserData(it, RLO)
	set it = null
endfunction
function DisassembleItems takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local item it
	local integer i = 0
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local integer TZE
	local player p
	call DisableTrigger(CUV)
	loop
	exitwhen i > 5
		set it = UnitItemInSlot(u, i)
		set TZE = GetItemIndexEx(it)
		set p = GetItemPlayer(it)
		if TZE == IEV then
			call RemoveItem(it)
			call RKO(p, 1, OFV, x, y)
			call RKO(p, 1, OWV, x, y)
		elseif TZE == IRV or TZE == IIV then
			call RemoveItem(it)
			call RKO(p, 1, OGV, x, y)
			call RKO(p, 1, OMV, x, y)
		elseif TZE == NGV or TZE == NHV then
			call RemoveItem(it)
			call RKO(p, 1, OBV, x, y)
			call RKO(p, 1, OIV, x, y)
			call RKO(p, 1, B_V, x, y)
		elseif (TZE) == NEV then
			call RemoveItem(it)
			call RKO(p, 1, X7V, x, y)
			call RKO(p, 1, ITV, x, y)
			call RKO(p, 1, B3V, x, y)
		elseif TZE == NZV then
			call RemoveItem(it)
			call RKO(p, 1, XMV, x, y)
			call RKO(p, 1, X2V, x, y)
		elseif TZE == I_V or TZE == I0V then
			call RemoveItem(it)
			call RKO(p, 1, X6V, x, y)
			call RKO(p, 1, OXV, x, y)
		elseif TZE == ANV or TZE == ABV then
			call RemoveItem(it)
			call RKO(p, 1, IMV, x, y)
			call RKO(p, 1, OTV, x, y)
			call RKO(p, 1, BGV, x, y)
		elseif TZE == ROV then
			call RemoveItem(it)
			call RKO(p, 1, X1V, x, y)
			call RKO(p, 1, NTV, x, y)
		elseif TZE == I5V then
			call RemoveItem(it)
			call RKO(p, 1, IPV, x, y)
			call RKO(p, 1, IMV, x, y)
		elseif TZE == RUV or TZE == RWV then
			call RemoveItem(it)
			call RKO(p, 1, IKV, x, y)
			call RKO(p, 1, IRV, x, y)
		elseif TZE == N2V then
			call RemoveItem(it)
			call RKO(p, 1, IQV, x, y)
			call RKO(p, 1, OKV, x, y)
		elseif TZE == RJV then
			call RemoveItem(it)
			call RKO(p, 1, N_V, x, y)
			call RKO(p, 1, RXV, x, y)
		elseif TZE == RQV then
			call RemoveItem(it)
			call RKO(p, 1, ONV, x, y)
			call RKO(p, 1, XGV, x, y)
		elseif TZE == RGV then
			call RemoveItem(it)
			call RKO(p, 1, RHV, x, y)
			call RKO(p, 1, XZV, x, y)
			call RKO(p, 1, XZV, x, y)
			call RKO(p, 1, IEV, x, y)
		elseif TZE == N1V then
			call RemoveItem(it)
			call RKO(p, 1, IPV, x, y)
			call RKO(p, 1, RXV, x, y)
		elseif TZE == Item_MoonShard then
			call RemoveItem(it)
			call RKO(p, 1, X7V, x, y)
			call RKO(p, 1, X7V, x, y)
		elseif TZE == IBV or TZE == IDV or TZE == ICV then
			call RemoveItem(it)
			call RKO(p, 1, XMV, x, y)
			call RKO(p, 1, XPV, x, y)
			if TZE == IBV then
				call RKO(p, 1, XQV, x, y)
			elseif TZE == ICV then
				call RKO(p, 1, XTV, x, y)
			else
				call RKO(p, 1, OJV, x, y)
			endif
		endif
		set i = i + 1
	endloop
	call EnableTrigger(CUV)
	set u = null
	set it = null
endfunction
function RPO takes nothing returns boolean
	if GetSpellAbilityId()=='A0K5' or GetSpellAbilityId()=='A1RF' then
		call DisassembleItems()
	endif
	return false
endfunction
function RQO takes integer GTX returns boolean
	return GTX != ASV and GTX != NIV and GTX != X4V and GTX != AIV
endfunction
function RSO takes nothing returns nothing
	if GetTriggerEventId() == EVENT_PLAYER_UNIT_PICKUP_ITEM then
		call SetItemPawnable(GetManipulatedItem(), false)
	else
		call SetItemPawnable(GetManipulatedItem(), true)
	endif
endfunction
function RTO takes nothing returns boolean
	if GetItemType(GetManipulatedItem()) == ITEM_TYPE_PERMANENT and RQO(GetItemIndex(GetManipulatedItem())) and IsUnitMessenger(GetTriggerUnit()) then
		call RSO()
	endif
	return false
endfunction
function RWO takes nothing returns boolean
	return(IsUnitAlly(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()))!= null
endfunction
function RYO takes unit u returns nothing
	local group g = AllocationGroup(20)
	local unit u2
	local real r = 500 + 30 * GetItemCharges(GetItemOfTypeFromUnit(u, XOV[NIV]))
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 1700, Condition(function RWO))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call SetWidgetLife(u2, GetWidgetLife(u2)+ r)
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\BloodstoneHealTarget.mdx", u2, "origin"))
		call GroupRemoveUnit(g, u2)
	endloop
	call DeallocateGroup(g)
	set g = null
	set u2 = null
endfunction
function RZO takes unit trigUnit returns nothing
	call RYO(trigUnit)
endfunction
function R_O takes nothing returns nothing
	if GetItemOfTypeFromUnit(GetTriggerUnit(), XOV[NIV])!= null then
		call RZO(GetTriggerUnit())
	endif
endfunction
function R0O takes unit u returns nothing
	local integer c = GetItemCharges(GetItemOfTypeFromUnit(u, XOV[NIV]))
	if c > 0 then
		call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ c)
	endif
endfunction
function R1O takes nothing returns boolean
	local integer i = 1
	local unit trigUnit
	local integer id
	if CZV > 0 then
		loop
		exitwhen i > 5
			set id = GetPlayerId(SentinelPlayers[i])
			set trigUnit = Player__Hero[id]
			if CGV[id]> 0 and trigUnit != null and UnitIsDead(trigUnit) == false then
				call R0O(trigUnit)
			endif
			set id = GetPlayerId(ScourgePlayers[i])
			set trigUnit = Player__Hero[id]
			if CGV[id]> 0 and trigUnit != null and UnitIsDead(trigUnit) == false then
				call R0O(trigUnit)
			endif
			set i = i + 1
		endloop
	endif
	set trigUnit = null
	return false
endfunction
function ObsWardAttacked takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer c = LoadInteger(HY, h, 0)
	if GetTriggerEventId() == EVENT_PLAYER_UNIT_ATTACKED then
		if GetUnitTypeId(GetTriggerUnit())=='oeye' or GetUnitTypeId(GetTriggerUnit())=='o004' then
			call UnitAddPermanentAbility(GetAttacker(),'A3AW')
			call UnitMakeAbilityPermanent(GetAttacker(), true,'A3AV')
		elseif GetUnitAbilityLevel(GetAttacker(),'A3AV')> 0 then
			call UnitRemoveAbility(GetAttacker(),'A3AW')
		endif
	else
		call SaveInteger(HY, h, 0, IMaxBJ(c -1, 0))
		if LoadInteger(HY, h, 0)< 1 then
			call DisableTrigger(t)
		endif
	endif
	set t = null
	return false
endfunction
function R2O takes unit R3O, unit R4O returns nothing
	local string s = ""
	local string s2 = "items\\wards\\"
	local string s3 = "war3mapImported\\"
	if GetUnitTypeId(R3O)=='oeye'then
		set s2 = s2 + "SentryWard.mdx"
		set s3 = s3 + "EnemySentryWardMark.mdx"
	else
		set s2 = s2 + "ObserverWard.mdx"
		set s3 = s3 + "EnemyObserverWardMark.mdx"
	endif
	if IsPlayerEnemy(LocalPlayer, GetOwningPlayer(R4O)) and IsObserverPlayer(LocalPlayer) == false then
		set s = s3
		set s2 = ""
	endif
	call AddSpecialEffectTarget(s, R3O, "origin")
	call AddSpecialEffectTarget(s2, R3O, "origin")
endfunction
function R5O takes nothing returns nothing
	local unit u = GetSummonedUnit()
	local unit whichUnit = GetSummoningUnit()
	local integer unitTypeId = GetUnitTypeId(u)
	local integer i
	if unitTypeId =='osp4' or unitTypeId =='o008' or unitTypeId =='o009' or unitTypeId =='o01C' or unitTypeId =='o01D' or unitTypeId =='o01E' then
		call W1E(u)
	elseif unitTypeId =='o000' or unitTypeId =='o001' or unitTypeId =='o00A' or unitTypeId =='o00X' then
		call W1E(u)
	endif
	set u = null
	set whichUnit = null
endfunction
function R6O takes nothing returns nothing
	local unit u = GetEnumUnit()
	local integer i = 0
	local player p = GetOwningPlayer(GetTriggerUnit())
	local item C1X
	local integer id = GetPlayerId(p)
	loop
	exitwhen i > 5
		set C1X = UnitItemInSlot(u, i)
		if C1X != null and GetItemPlayer(C1X) == p then
			call UnitRemoveItem(u, C1X)
			call SetItemPosition(C1X, CirclesX[id], CirclesY[id])
		endif
		set i = i + 1
	endloop
	set u = null
	set p = null
	set C1X = null
endfunction
function R7O takes nothing returns nothing
	local item C1X = GetEnumItem()
	local unit u = C4V
	local player p = GetOwningPlayer(u)
	local integer id = GetPlayerId(p)
	if GetWidgetLife(C1X)> 0 and GetItemPlayer(C1X) == p then
		call SetItemPosition(C1X, CirclesX[id], CirclesY[id])
		call UnitAddItem(CirclesUnit[id], C1X)
	endif
	set C1X = null
	set u = null
	set p = null
endfunction
function R8O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 53))
	set C4V = u
	if IsSentinelPlayer(GetOwningPlayer(C4V)) then
		call EnumItemsInRect(gg_rct_SentinelFountainOfLifeRange, null, function R7O)
	else
		call EnumItemsInRect(gg_rct_ScourgeFountainOfLifeRange, null, function R7O)
	endif
	if GetTriggerEvalCount(t) == 2 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	return false
endfunction
function R9O takes nothing returns boolean
	return IsUnitMessenger(GetFilterUnit())
endfunction

function G7E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer i = 0
	local group g = AllocationGroup(21)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 1300, Condition(function R9O))
	call ForGroup(g, function R6O)
	call DeallocateGroup(g)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function R8O))
	call SaveUnitHandle(HY, h, 53,(u))
	set u = null
	set g = null
	set t = null
endfunction
function G6E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer i = 0
	local item C1X
	local integer id = GetPlayerId(GetOwningPlayer(u))
	local region r = CreateRegion()
	if IsSentinelPlayer(GetOwningPlayer(u)) then
		call RegionAddRect(r, gg_rct_SentinelFountainOfLifeRange)
	else
		call RegionAddRect(r, gg_rct_ScourgeFountainOfLifeRange)
	endif
	loop
	exitwhen i > 5
		set C1X = UnitItemInSlot(u, i)
		if GUX(GetItemIndexEx(C1X)) == false and GetItemIndexEx(C1X)!= AIV then
			call UnitRemoveItemFromSlot(u, i)
			if (GetUnitTypeId(u)=='ncop' or IsUnitInRegion(r, u)) and IsPlayerAlly(GetItemPlayer(C1X), GetOwningPlayer(u)) then
				set id = GetPlayerId(GetItemPlayer(C1X))
				call SetItemPosition(C1X, CirclesX[id], CirclesY[id])
			endif
		endif
		set i = i + 1
	endloop
	call RemoveRegion(r)
	set u = null
	set C1X = null
	set r = null
endfunction


function IOO takes unit trigUnit returns nothing
	local integer i = 0
	local item IRO
	local integer GTX
	local boolean IIO = false
	if (LoadReal(HY, GetHandleId(trigUnit), 730) + 13) > (GetGameTime() ) then
		set IIO = true
	endif
	loop
	exitwhen i > 5
		set IRO = UnitItemInSlot(trigUnit, i)
		set GTX = GetItemIndex(IRO)
		if GTX == RNV and IIO then
			call DisableTrigger(CUV)
			set E3 = GetItemPlayer(IRO)
			call RemoveItem(IRO)
			set Z2 = JIX(trigUnit, XOV[RBV], i)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			call EnableTrigger(CUV)
		endif
		if GTX == RBV and IIO == false then
			call DisableTrigger(CUV)
			set E3 = GetItemPlayer(IRO)
			call RemoveItem(IRO)
			set Z2 = JIX(trigUnit, XOV[RNV], i)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			call EnableTrigger(CUV)
		endif
		set i = i + 1
	endloop
	set trigUnit = null
	set IRO = null
endfunction

function IAO takes unit trigUnit returns nothing
	local integer i = 0
	local item INO
	local integer GTX
	local boolean IBO = false
	local real cd = 4
	if IsUnitType(trigUnit, UNIT_TYPE_MELEE_ATTACKER) == false then
		set cd = 6
	endif
	if (LoadReal(HY, GetHandleId(trigUnit), 785) ) + cd > GetGameTime() then
		set IBO = true
	endif
	loop
	exitwhen i > 5
		set INO = UnitItemInSlot(trigUnit, i)
		set GTX = GetItemIndex(INO)
		if GTX == A0V and IBO then
			call DisableTrigger(CUV)
			set E3 = GetItemPlayer(INO)
			call RemoveItem(INO)
			set Z2 = JIX(trigUnit, XOV[A1V], i)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			call EnableTrigger(CUV)
		endif
		if GTX == A1V and IBO == false then
			call DisableTrigger(CUV)
			set E3 = GetItemPlayer(INO)
			call RemoveItem(INO)
			set Z2 = JIX(trigUnit, XOV[A0V], i)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			call EnableTrigger(CUV)
		endif
		set i = i + 1
	endloop
	set trigUnit = null
	set INO = null
endfunction



function IFO takes unit u, item it, integer JOX returns nothing
	local integer i
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	set E3 = GetItemPlayer(it)
	call RemoveItem(it)
	call UnitAddAbility(d,'AInv')
	set it = UnitAddItemById(d, XOV[OVV])
	call UnitUseItem(d, it)
	call JXX(u, it, JOX)
	call SetItemPlayer(it, E3, false)
	call SetItemUserData(it, 1)
	set d = null
endfunction

// 跳刀
function IGO takes unit u returns nothing
	local integer i = 0
	local item it
	local integer GTX
	local boolean b = false
	local real time = (LoadReal(HY, GetHandleId(u), 785) + 3) - GetGameTime() 
	if ( (LoadReal(HY, GetHandleId(u), 785) ) + 3) > GetGameTime() then
		set b = true
	endif
	loop
		set it = UnitItemInSlot(u, i)
		set GTX = GetItemIndex(it)
		if (GTX == X9V and b) or(GTX == OVV and time >= 2.9) then
			call DisableTrigger(CUV)
			//call IFO(u, it, i)
			set E3 = GetItemPlayer(it)
			call RemoveItem(it)
			set Z2 = JIX(u, XOV[OVV], i)
			call YDWESetUnitAbilityState(u,'A445', 1, 3.)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			call EnableTrigger(CUV)
		endif
		if GTX == OVV and b == false then
			call DisableTrigger(CUV)
			set E3 = GetItemPlayer(it)
			call RemoveItem(it)
			set Z2 = JIX(u, XOV[X9V], i)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			call EnableTrigger(CUV)
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	set u = null
	set it = null
endfunction

function DHNO takes unit u, integer id returns nothing
	//if GetUnitAbilityLevel(u,'A0RN') == 0 then
	if CFV[id]> 0 then
		call IGO(u)
	endif
	if C8V[id]> 0 then
		call IOO(u)
	endif
	if C7V[id]> 0 then
		call IAO(u)
	endif
	//endif
endfunction

// 龙心 绿鞋 跳刀等会被打断的物品 中心计时器
function IHO takes nothing returns boolean
	local integer i = 1
	local unit u
	local integer id
	if HaveBlinkDaggerCount > 0 or HaveTranquilBootsCount > 0 or HaveHeartofTarrasqueCount > 0 then
		//绿鞋
		loop
		exitwhen i > 5
			set id = GetPlayerId(SentinelPlayers[i])
			set u = Player__Hero[id]
			if u != null and UnitAlive(u) then
				call DHNO(u, id)
				if HaveBear then
					set u = LoadUnitHandle(HY, GetHandleId(Player(id)), 333)
					if u != null and UnitAlive(u) then
						call DHNO(u, id)
					endif
				endif
			endif
			set id = GetPlayerId(ScourgePlayers[i])
			set u = Player__Hero[id]
			if u != null and UnitAlive(u) then
				call DHNO(u, id)
				if HaveBear then
					set u = LoadUnitHandle(HY, GetHandleId(Player(id)), 333)
					if u != null and UnitAlive(u) then
						call DHNO(u, id)
					endif
				endif
			endif
			set i = i + 1
		endloop
	endif
	set u = null
	return false
endfunction
function ILO takes unit DKD returns boolean
	return false
endfunction
function IMO takes nothing returns nothing
	local unit IPO = GetAttacker()
	local integer IQO = UnitInventorySize(IPO)
	local integer x = 0
	local item i
	loop
	exitwhen x > IQO
		set i = UnitItemInSlot(IPO, x)
		if GetItemIndex(i) == OYV and TKV(IPO,'JAVL', 20) and IsUnitInvision(IPO) == false then
			if IsBearUnit(IPO) then
				if ILO(IPO) == false then
					if GetUnitAbilityLevel(GetTriggerUnit(),'A04R') == 0 then
						call UnitDamageTargetEx(IPO, GetTriggerUnit(), 2, 40)
					endif
				endif
			else
				if GetUnitAbilityLevel(GetTriggerUnit(),'A04R') == 0 then
					call UnitDamageTargetEx(IPO, GetTriggerUnit(), 2, 40)
				endif
			endif
		endif
		set x = x + 1
	endloop
	set i = null
	set IPO = null
endfunction
function ISO takes unit u returns nothing
	call UnitAddAbilityToTimed(u,'A263', 1, 5,'B08N')
endfunction
function ITO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if GetEventDamageSource() == whichUnit and GetEventDamage()> 0 then
			if FK then
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
				call ISO(targetUnit)
			endif
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function IUO takes nothing returns nothing
	local unit whichUnit = GetAttacker()
	local unit targetUnit = GetTriggerUnit()
	local trigger t
	local integer h
	if ((LoadInteger(HY,(GetHandleId((whichUnit))),(4309)))!= 1) then
		call EPX(whichUnit, 4309, .2)
		if TKV(whichUnit,'MAIM'+ 1, 16) then
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
			call TriggerRegisterTimerEvent(t, 2.5, false)
			call TriggerAddCondition(t, Condition(function ITO))
			call SaveUnitHandle(HY, h, 2,(whichUnit))
			call SaveUnitHandle(HY, h, 17,(targetUnit))
		endif
	endif
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function DVD takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local real IWO =(LoadReal(HY,(GetHandleId(whichUnit)), 693))
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or IWO <(GetGameTime()) then
		call UnitRemoveAbility(whichUnit,'A264')
		call UnitRemoveAbility(whichUnit,'B02I')
		call SaveReal(HY,(GetHandleId(whichUnit)), 693,(0 * 1.))
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction
function IYO takes unit u returns nothing
	call UnitAddAbilityToTimed(u,'A264', 1, 4,'B02I')
endfunction
function IZO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if GetEventDamageSource() == whichUnit and GetEventDamage()> 0 and(EXGetEventDamageData(1) != 0) then
			if FK then
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
				call IYO(targetUnit)
			endif
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function I_O takes nothing returns nothing
	local unit whichUnit = GetAttacker()
	local unit targetUnit = GetTriggerUnit()
	local trigger t
	local integer h
	if ((LoadInteger(HY,(GetHandleId((whichUnit))),(4309))) == 1) == false then
		call EPX(whichUnit, 4309, .2)
		if TKV(whichUnit,'MAIM', 15) then
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
			call TriggerRegisterTimerEvent(t, 2.5, false)
			call TriggerAddCondition(t, Condition(function IZO))
			call SaveUnitHandle(HY, h, 2,(whichUnit))
			call SaveUnitHandle(HY, h, 17,(targetUnit))
		endif
	endif
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function CraniumBasherWrapper takes nothing returns nothing
	local unit u = GetAttacker()
	local integer probability = 25
	local integer id = GetPlayerId(GetOwningPlayer(GetAttacker()))
	local integer h = GetHandleId(u)
	local real time =(GetGameTime())
	local real I0O =(LoadReal(HY, h,'e'))
	local boolean I1O =(LoadBoolean(HY, h, 99))
	local boolean I2O =(LoadBoolean(HY, h, 100))
	local boolean I3O = time < I0O
	local boolean I4O = false
	if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) == false then
		set probability = 10
	endif
	if TKV(u,'BASH', probability) then
		set I4O = true
	endif
	if GetUnitAbilityLevel(u,'A340')> 0 or GetUnitAbilityLevel(u,'A0JJ')> 0 or GetUnitAbilityLevel(u,'A081')> 0 or GetUnitAbilityLevel(u,'A0G5')> 0 or GetUnitAbilityLevel(u,'A09E')> 0 then
		call UnitRemoveAbility(u,'A174')
		set u = null
		return
	endif
	if I1O and I3O == false and I2O == false then
		call SaveReal(HY, h,'e',((time + 2.3)* 1.))
		if I4O == false then
			call SaveBoolean(HY, h, 100,(true))
		endif
	elseif I3O or I2O then
		call UnitRemoveAbility(u,'A174')
		call SaveBoolean(HY, h, 99,(false))
		call SaveBoolean(HY, h, 100,(false))
	endif
	if I4O then
		call UnitAddPermanentAbility(u,'A174')
		call UnitMakeAbilityPermanent(u, true,'A175')
		call SaveBoolean(HY, h, 99,(true))
	endif
	set u = null
endfunction
function I5O takes unit u returns unit
	if IsUnitType(u, UNIT_TYPE_HERO) or GetUnitAbilityLevel(u,'A04R') == 0 then
		return u
	else
		return Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
endfunction
function I6O takes unit killingUnit, unit triggerUnit returns nothing
	local integer id = GetUnitTypeId(triggerUnit)
	local integer i
	local real damageValue = 0
	local group g
	local unit u
	if (id =='n00J' or id =='n00A' or id =='n006') then
		set i = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(triggerUnit))],'A0A8')
		if i > 0 or(IsUnitType(killingUnit, UNIT_TYPE_STRUCTURE) == false and IsUnitEnemy(triggerUnit, GetOwningPlayer(killingUnit))) then
			if id =='n00J' then
				set damageValue = 400
			elseif id =='n00A' then
				set damageValue = 500
			elseif id =='n006' then
				set damageValue = 600
			endif
			if i > 0 then
				set g = AllocationGroup(22)
				set U2 = triggerUnit
				call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), 300, Condition(function DHX))
				if IsUnitType(killingUnit, UNIT_TYPE_STRUCTURE) == false and IsUnitEnemy(triggerUnit, GetOwningPlayer(killingUnit)) then
					call GroupAddUnit(g, killingUnit)
				endif
				loop
					set u = FirstOfGroup(g)
				exitwhen u == null
					call UnitDamageTargetEx(triggerUnit, u, 3, damageValue)
					call CHX("CLPB", triggerUnit, u, 1, 1, 1, 1, .5)
					call GroupRemoveUnit(g, u)
				endloop
				call DeallocateGroup(g)
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl", GetUnitX(triggerUnit), GetUnitY(triggerUnit)))
			else
				call UnitDamageTargetEx(triggerUnit, I5O(killingUnit), 3, damageValue)
				call CHX("CLPB", triggerUnit, I5O(killingUnit), 1, 1, 1, 1, .5)
			endif
		endif
	endif
endfunction
function I7O takes nothing returns boolean
	local unit whichUnit = GetTriggerUnit()
	local integer level = 1
	local integer id ='EUL1'
	if GetItemOfTypeFromUnit(whichUnit, XOV[RBV])!= null then
		set level = 4
	endif
	if GZX(whichUnit, XOV[XMV], GetManipulatedItem())!= null then
		set level = 2
	endif
	if GZX(whichUnit, XOV[NKV], GetManipulatedItem())!= null then
		set level = 2
	endif
	if GZX(whichUnit, XOV[IBV], GetManipulatedItem())!= null or GZX(whichUnit, XOV[ICV], GetManipulatedItem())!= null or GZX(whichUnit, XOV[IDV], GetManipulatedItem())!= null then
		set level = 2
	endif
	if GZX(whichUnit, XOV[NZV], GetManipulatedItem())!= null then
		set level = 3
	endif
	if GZX(whichUnit, XOV[RNV], GetManipulatedItem())!= null then
		set id ='EUL2'
		set level = 1
	endif
	if GZX(whichUnit, XOV[IAV], GetManipulatedItem())!= null then
		set id ='EUL2'
		set level = 2
	endif
	if GZX(whichUnit, XOV[Item_EulScepterOfDivinity], GetManipulatedItem())!= null then
		call UnitAddPermanentAbility(whichUnit, id)
		call SetUnitAbilityLevel(whichUnit, id, level)
	else
		call UnitRemoveAbility(whichUnit,'EUL1')
		call UnitRemoveAbility(whichUnit,'EUL2')
	endif
	set whichUnit = null
	return false
endfunction
function I9O takes nothing returns boolean
	local unit whichUnit = GetTriggerUnit()
	local integer level = 1
	local integer id ='EUL1'
	if GetItemOfTypeFromUnit(whichUnit, XOV[RBV])!= null then
		set level = 4
	endif
	if GetItemOfTypeFromUnit(whichUnit, XOV[XMV])!= null then
		set level = 2
	endif
	if GetItemOfTypeFromUnit(whichUnit, XOV[NKV])!= null then
		set level = 2
	endif
	if GetItemOfTypeFromUnit(whichUnit, XOV[IBV])!= null or GetItemOfTypeFromUnit(whichUnit, XOV[ICV])!= null or GetItemOfTypeFromUnit(whichUnit, XOV[IDV])!= null then
		set level = 2
	endif
	if GetItemOfTypeFromUnit(whichUnit, XOV[NZV])!= null then
		set level = 3
	endif
	if GetItemOfTypeFromUnit(whichUnit, XOV[RNV])!= null then
		set level = 1
		set id ='EUL2'
	endif
	if GetItemOfTypeFromUnit(whichUnit, XOV[IAV])!= null then
		set level = 2
		set id ='EUL2'
	endif
	if GetItemOfTypeFromUnit(whichUnit, XOV[Item_EulScepterOfDivinity])!= null then
		call UnitAddPermanentAbility(whichUnit, id)
		call SetUnitAbilityLevel(whichUnit, id, level)
	endif
	set whichUnit = null
	return false
endfunction
function AVO takes unit u, integer d returns nothing
	local integer array b
	local integer a = d
	local integer c = 1
	local integer i = 0
	local integer z
	local real hp
	if d == 0 then
		set hp = GetUnitState(u, UNIT_STATE_MAX_LIFE)-GetWidgetLife(u)
	endif
	if d < 1 then
		call UnitRemoveAbility(u, PB[0])
		call UnitRemoveAbility(u, PB[1])
		call UnitRemoveAbility(u, PB[2])
		call UnitRemoveAbility(u, PB[3])
		call UnitRemoveAbility(u, PB[4])
		call SetWidgetLife(u, RMaxBJ(GetUnitState(u, UNIT_STATE_MAX_LIFE)-hp, 1))
		return
	endif
	loop
	exitwhen c == 0
		set c = a / 2
		set b[i]= a -c * 2
		set a = c
		set i = i + 1
	endloop
	set z = 4
	set i = 0
	loop
	exitwhen i > z
		if b[i]== 1 then
			call UnitAddPermanentAbility(u, PB[i])
		else
			call UnitRemoveAbility(u, PB[i])
		endif
		set i = i + 1
	endloop
endfunction
function AEO takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(ObjectHashTable, h, 0)
	local real AXO = LoadReal(ObjectHashTable, h, 0)
	if GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		if GetItemOfTypeFromUnit(u, XOV[NBV]) == null then
			call SetHeroStr(u, IMaxBJ(GetHeroStr(u, false)-LoadInteger(OtherHashTable, GetHandleId(u),'ARML'), 1), true)
			call SaveInteger(OtherHashTable, GetHandleId(u),'ARML', 0)
			if IsTriggerEnabled(t) then
				call FlushChildHashtable(ObjectHashTable, h)
				call CleanCurrentTrigger(t)
			endif
			set t = null
			set u = null
			return
		endif
		if GetTriggerEvalCount(t)<= 25 then
			call SetHeroStr(u, GetHeroStr(u, false)+ 1, true)
			call SaveInteger(OtherHashTable, GetHandleId(u),'ARML', GetTriggerEvalCount(t))
			if UnitAlive(u) then
			endif
		endif
	else
		call SetHeroStr(u, IMaxBJ(GetHeroStr(u, false)-LoadInteger(OtherHashTable, GetHandleId(u),'ARML'), 1), true)
		call SaveInteger(OtherHashTable, GetHandleId(u),'ARML', 0)
		if IsTriggerEnabled(t) then
			call FlushChildHashtable(ObjectHashTable, h)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set u = null
endfunction
function AOO takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local trigger t
	local real AXO
	if GetTriggerEventId() == EVENT_PLAYER_UNIT_DROP_ITEM then
		if GetItemIndex(GetManipulatedItem()) == NCV or GetItemIndex(GetManipulatedItem()) == NFV then
			call UnitRemoveAbility(u,'A44Q')
			if GetItemIndex(GetManipulatedItem()) == NCV then
				call AVO(u, 0)
			endif
		endif
		if GetItemIndex(GetManipulatedItem()) == A2V then
			call UnitRemoveAbility(u,'A1BW')
		endif
		if GetItemIndex(GetManipulatedItem()) == NBV or GetItemIndex(GetManipulatedItem()) == NDV then
			call UnitRemoveAbility(u,'A44Q')
			call UnitRemoveAbility(u,'A0UK')
			if HaveSavedHandle(HY, GetHandleId(u),'ARML') then
				call TriggerEvaluate(LoadTriggerHandle(HY, GetHandleId(u),'ARML'))
			endif
			if GetItemIndex(GetManipulatedItem()) == NBV then
			endif
		endif
	endif
	if GetTriggerEventId() == EVENT_PLAYER_UNIT_PICKUP_ITEM then
		if GetItemIndex(GetManipulatedItem()) == NCV or GetItemIndex(GetManipulatedItem()) == NFV then
			call UnitAddPermanentAbility(u,'A44Q')
			if GetItemIndex(GetManipulatedItem()) == NCV then
				call AVO(u, 0)
			endif
		endif
		if GetItemIndex(GetManipulatedItem()) == A2V then
			call UnitAddPermanentAbility(u,'A1BW')
		endif
		if GetItemIndex(GetManipulatedItem()) == NBV or GetItemIndex(GetManipulatedItem()) == NDV then
			call UnitAddPermanentAbility(u,'A44Q')
			call UnitAddPermanentAbility(u,'A0UK')
			if GetItemIndex(GetManipulatedItem()) == NBV then
				set t = CreateTrigger()
				call TriggerRegisterTimerEvent(t, .6 / 25, true)
				set AXO = GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE)-GetWidgetLife(GetTriggerUnit())
				call SaveUnitHandle(ObjectHashTable, GetHandleId(t), 0, u)
				call SaveBoolean(OtherHashTable, GetHandleId(u), 20, true)
				call SaveReal(ObjectHashTable, GetHandleId(t), 0, AXO)
				call TriggerAddCondition(t, Condition(function AEO))
				if HaveSavedHandle(HY, GetHandleId(u),'ARML') then
					call TriggerEvaluate(LoadTriggerHandle(HY, GetHandleId(u),'ARML'))
				endif
				call SaveTriggerHandle(HY, GetHandleId(u),'ARML', t)
				set t = null
				call EPX(u, 4298, .6)
			endif
		endif
	endif
	set u = null
endfunction
function ARO takes nothing returns boolean
	if GetItemType(GetManipulatedItem()) == ITEM_TYPE_PERMANENT and(GetItemIndex(GetManipulatedItem()) == NBV or GetItemIndex(GetManipulatedItem()) == NCV or GetItemIndex(GetManipulatedItem()) == A2V or GetItemIndex(GetManipulatedItem()) == NIV) then
		call AOO()
	endif
	return false
endfunction
function AIO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local item C1X =(LoadItemHandle(HY, h, 96))
	if GetTriggerEventId() == EVENT_UNIT_DROP_ITEM and GetManipulatedItem() == C1X then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()!= EVENT_UNIT_DROP_ITEM then
		if LoadInteger(HY, GetHandleId(trigUnit), 4310)!= 1 and IsUnitMessenger(trigUnit) == false and RFX(trigUnit) == false then
			call SetWidgetLife(trigUnit, RMaxBJ(GetWidgetLife(trigUnit)-40., 1))
		endif
	endif
	set t = null
	set trigUnit = null
	set C1X = null
	return false
endfunction
function AAO takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterUnitEvent(t, trigUnit, EVENT_UNIT_DROP_ITEM)
	call TriggerAddCondition(t, Condition(function AIO))
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call SaveItemHandle(HY, h, 96,(GetManipulatedItem()))
	set t = null
	set trigUnit = null
endfunction
function ANO takes nothing returns boolean
	if GetItemType(GetManipulatedItem()) == ITEM_TYPE_PERMANENT and(GetItemIndex(GetManipulatedItem()) == NBV or(GetItemIndex(GetManipulatedItem()) == NDV and DRX(GetTriggerUnit()))) then
		call AAO()
	endif
	return false
endfunction
function ABO takes unit u returns boolean
	local item ACO = CreateItem('I0KK', GetUnitX(u), GetUnitY(u))
	local boolean JVX = UnitAddItem(u, ACO)
	if JVX == false then
		call RemoveItem(ACO)
	endif
	set ACO = null
	return JVX
endfunction
function ADO takes unit trigUnit, item C1X, integer JNX returns item
	local real x = H9X(trigUnit)
	local real y = JEX(trigUnit)
	local integer i = 0
	local boolean array JBX
	local item JCX
	loop
	exitwhen i >(UnitInventorySize(trigUnit)-1)
		if UnitItemInSlot(trigUnit, i) == null and i != JNX then
			set JCX = CreateItem('I02M', x, y)
			call UnitAddItem(trigUnit, JCX)
			set JBX[i]= true
		else
			set JBX[i]= false
		endif
		if i == JNX then
			call UnitAddItem(trigUnit, C1X)
		endif
		set i = i + 1
	endloop
	set i = 0
	loop
	exitwhen i > 5
		if JBX[i] then
			call RemoveItem(UnitItemInSlot(trigUnit, i))
		endif
		set i = i + 1
	endloop
	set Z2 = C1X
	set JCX = null
	return Z2
endfunction
function AFO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 14))
	local integer i = 0
	local item WNE
	local integer GTX
	local unit dummyCaster
	local item RIO
	local item it = null
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call SaveBoolean(HY,(GetHandleId(u)),'f',(false))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif ABO(u) == false then
		call TriggerRegisterTimerEvent(t, 5.5, false)
	else
		call SaveBoolean(HY,(GetHandleId(u)),'f',(false))
		call DisableTrigger(CUV)
		if CJV[GetPlayerId(GetOwningPlayer(u))]> 0 then
			set it = UnitAddItemById(u,'I0HM')
			if GetWidgetLife(it)> 0 then
				call RemoveItem(it)
			endif
			set it = null
		endif
		loop
		exitwhen i > 5
			set WNE = UnitItemInSlot(u, i)
			set GTX = GetItemIndex(WNE)
			if GTX == AQV then
				set E3 = GetItemPlayer(WNE)
				call RemoveItem(WNE)
				set dummyCaster = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
				call UnitAddAbility(dummyCaster,'AInv')
				set RIO = UnitAddItemById(dummyCaster, XOV[APV])
				call UnitUseItem(dummyCaster, RIO)
				set Z2 = ADO(u, RIO, i)
				call SetItemPlayer(RIO, E3, false)
				call SetItemUserData(RIO, 1)
				call UnitRemoveAbility(dummyCaster,'AInv')
				set dummyCaster = null
				set RIO = null
			endif
			set WNE = null
			set i = i + 1
		endloop
		call EnableTrigger(CUV)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	set WNE = null
	set dummyCaster = null
	set RIO = null
	return false
endfunction
function AGO takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer i = 0
	local item WNE = null
	local integer GTX
	local unit dummyCaster = null
	local item RIO = null
	call DisableTrigger(CUV)
	call SaveBoolean(HY,(GetHandleId(u)),'f',(true))
	call TriggerRegisterTimerEvent(t, 17, false)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function AFO))
	call SaveUnitHandle(HY, h, 14,(u))
	loop
	exitwhen i > 5
		set WNE = UnitItemInSlot(u, i)
		set GTX = GetItemIndex(WNE)
		if GTX == APV or GTX == AQV then
			set E3 = GetItemPlayer(WNE)
			call RemoveItem(WNE)
			set dummyCaster = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
			call UnitAddAbility(dummyCaster,'AInv')
			set RIO = UnitAddItemById(dummyCaster, XOV[AQV])
			call UnitUseItem(dummyCaster, RIO)
			set Z2 = ADO(u, RIO, i)
			call SetItemPlayer(RIO, E3, false)
			call SetItemUserData(RIO, 1)
			call UnitRemoveAbility(dummyCaster,'AInv')
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\DispelMagic\\DispelMagicTarget.mdl", u, "origin"))
			set dummyCaster = null
			set RIO = null
		endif
		set WNE = null
		set i = i + 1
	endloop
	call EnableTrigger(CUV)
	set t = null
endfunction
function AHO takes nothing returns boolean
	local integer i = 1
	local unit u = null
	local integer id
	if IsGameEnd then
		return false
	endif
	if CWV > 0 then
		loop
		exitwhen i > 5
			set id = GetPlayerId(SentinelPlayers[i])
			set u = Player__Hero[id]
			if CJV[id]> 0 and u != null and UnitAlive(u) and LoadBoolean(HY, GetHandleId(u),'f') == false and UnitHasSpellShield(u) == false and LoadBoolean(HY, GetHandleId(u), 129) == false then
				call AGO(u)
			endif
			set id = GetPlayerId(ScourgePlayers[i])
			set u = Player__Hero[id]
			if CJV[id]> 0 and u != null and UnitAlive(u) and LoadBoolean(HY, GetHandleId(u),'f') == false and UnitHasSpellShield(u) == false and LoadBoolean(HY, GetHandleId(u), 129) == false then
				call AGO(u)
			endif
			set i = i + 1
		endloop
	endif
	set u = null
	return false
endfunction
function UnitRemoveSpellShield takes unit u returns nothing
	call AGO(u)
	call UnitRemoveAbility(u,'B0BI')
endfunction
function GLE takes nothing returns boolean
	local integer id
	local unit u
	local integer h
	if GetSpellAbilityId()=='A0H6' then
		set u = GetTriggerUnit()
		set h = GetHandleId(u)
		call SaveUnitHandle(HY, h,'g', null)
		call SaveInteger(HY, h,'h', 0)
		if (GetItemOfTypeFromUnit(GetTriggerUnit(), XOV[O_V])!= null or GetItemOfTypeFromUnit(GetTriggerUnit(), XIV[O_V])!= null) and(GetUnitTypeId(GetSpellTargetUnit())=='nfoh' or GetUnitTypeId(GetSpellTargetUnit())=='ndfl') then
			call SaveUnitHandle(HY, h,'g', GetSpellTargetUnit())
		elseif ZNX(GetItemTypeId(GetSpellTargetItem())) then
			set id = ZAX(GetItemTypeId(GetSpellTargetItem()))
			call OQO(GetTriggerUnit(), id, true)
			call SaveInteger(HY, h,'h', id)
			call HZX(GetSpellTargetItem())
		endif
	endif
	set u = null
	return false
endfunction
function AKO takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local item C1X = GetManipulatedItem()
	local integer GTX = GetItemIndexEx(C1X)
	local unit ALO
	local integer AMO
	local integer JNX
	local item RIO = null
	local integer APO
	local integer id
	if GTX == O_V then
		set JNX = B2X(u, C1X)
		set ALO =(LoadUnitHandle(HY,(GetHandleId(u)),'g'))
		set AMO =(LoadInteger(HY,(GetHandleId(u)),'h'))
		if GetUnitTypeId(ALO)=='nfoh' or GetUnitTypeId(ALO)=='ndfl' then
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl", u, "overhead"))
			call IRX(GetOwningPlayer(u), "Abilities\\Spells\\Human\\Heal\\HealTarget.wav")
			set E3 = GetItemPlayer(C1X)
			call HZX(C1X)
			set Z2 = JIX(u, XOV[O2V], JNX)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
		elseif ZBX(AMO) then
			set APO = RNO(AMO)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl", u, "overhead"))
			set E3 = GetItemPlayer(C1X)
			call HZX(C1X)
			call DisableTrigger(CUV)
			if GetOwningPlayer(u) == E3 then
				set Z2 = JIX(u, XOV[APO], JNX)
			else
				set Z2 = JIX(u, XIV[APO], JNX)
			endif
			call EnableTrigger(CUV)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			set RIO = UnitItemInSlot(u, JNX)
			call RAO(u, RIO)
		endif
	elseif GTX == O2V then
		set JNX = B2X(u, C1X)
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		set Z2 = JIX(u, XOV[O1V], JNX)
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
	elseif GTX == O1V then
		set JNX = B2X(u, C1X)
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		set Z2 = JIX(u, XOV[O0V], JNX)
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
	elseif GTX == O0V then
		set JNX = B2X(u, C1X)
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		set Z2 = JIX(u, XOV[O_V], JNX)
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 0)
	elseif GUX(GTX) then
		set C2V = true
		set JNX = B2X(u, C1X)
		set id = GWX(GTX)
		if id > 0 then
			set RIO = CreateItem(id, GetUnitX(u), GetUnitY(u))
		else
			set RIO = null
		endif
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		set Z2 = JIX(u, XOV[O2V], JNX)
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
		call UnitAddItem(u, RIO)
		set C2V = false
	endif
	set u = null
	set C1X = null
	set ALO = null
	set RIO = null
endfunction
function AQO takes nothing returns boolean
	if GetIssuedOrderId()==851971 then
		if GetOrderTargetItem()!= null then
			if ZNX(GetItemTypeId(GetOrderTargetItem())) then
				call EXStopUnit(GetTriggerUnit())
				call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n0LU'))
			elseif GetItemIndexEx(GetOrderTargetItem()) == ASV or GetItemIndexEx(GetOrderTargetItem()) == ATV then
				call EXStopUnit(GetTriggerUnit())
				call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "信使不能拾取圣剑")
			endif
		endif
	endif
	return false
endfunction
function ASO takes unit ATO returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, ATO, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerAddCondition(t, Condition(function AQO))
	set t = null
endfunction
function AUO takes player p returns integer
	local integer r = GetRandomInt(1, 7)
	if OLX(p) then
		return'np00'
	endif
	if IsSentinelPlayer(p) then
		if r == 1 then
			return'n00I'
		elseif r == 2 then
			return'n022'
		elseif r == 3 then
			return'n021'
		elseif r == 4 then
			return'n0KY'
		elseif r == 5 then
			return'n0KZ'
		elseif r == 7 then//彩蛋信使
			return'np00'
		else//
			return'n0LE'
		endif
	else
		if r == 1 then
			return'n023'
		elseif r == 2 then
			return'n024'
		elseif r == 3 then
			return'n025'
		elseif r == 4 then
			return'n0L0'
		elseif r == 5 then
			return'n0L1'
		elseif r == 7 then//
			return'np00'
		else//
			return'n0M4'
		endif
	endif
	return 0
endfunction
function AWO takes player p returns integer
	if OLX(p) then
		return'np01'
	endif
	if GetRandomInt(1, 3) == 1 then
		return'e02R'
	elseif IsSentinelPlayer(p) then
		return'e01H'
	else
		return'e01Z'
	endif
	return 0
endfunction


function MUGetMessengerOwner takes unit messenger returns player
	return LoadPlayerHandle(HY, GetHandleId(messenger), StringHash("信使所有者"))
endfunction

function MUIsMessenger takes unit messenger returns boolean
	return MUGetMessengerOwner(messenger) != null
endfunction

function MUIsMessengerShared takes unit messenger returns boolean
	return GetOwningPlayer(messenger) != MUGetMessengerOwner(messenger)
endfunction

function MUIsPlayerMessengerShared takes player target returns boolean
	return LoadBoolean(HY, GetHandleId(target), StringHash("信使共享"))
endfunction

function MUSetMessengerNotShare takes unit messenger returns nothing
	local player owner = MUGetMessengerOwner(messenger)
	local integer i
	if owner == null then
		return
	endif
	call SetUnitOwner(messenger, owner, false)
	if GetPlayerTeam(owner) == 0 then
		set i = 1
		loop
			if SentinelPlayers[i] != owner then
				call DisplayTimedTextToPlayer(SentinelPlayers[i], 0, 0, 10, "|cffffff11你不再能控制" + PlayersColoerText[GetPlayerId(owner)] + GetPlayerName(owner) + "|cffffff11的信使了|r")
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
	else
		set i = 1
		loop
			if ScourgePlayers[i] != owner then
				call DisplayTimedTextToPlayer(ScourgePlayers[i], 0, 0, 10, "|cffffff11你不再能控制" + PlayersColoerText[GetPlayerId(owner)] + GetPlayerName(owner) + "|cffffff11的信使了|r")
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
	endif
	set owner = null
endfunction
//共享信使
function MUInitDummyPlayer takes integer id1, integer id2 returns nothing
	local integer i
	if mu_has_init_dummy_player then
		return
	endif
	set mu_has_init_dummy_player = true
	// 颜色
	set PlayersColoerText[id1] = PlayersColoerText[0]
	set PlayersColoerText[id2] = PlayersColoerText[6]
	call SetPlayerColor(Player(id1), GetPlayerColor(SentinelPlayers[0]))
	call SetPlayerColor(Player(id2), GetPlayerColor(ScourgePlayers[0]))
	// 名字
	call SetPlayerName(Player(id1), GetPlayerName(SentinelPlayers[0]))
	call SetPlayerName(Player(id2), GetPlayerName(ScourgePlayers[0]))
	set PlayersName[id1] = GetPlayerName(Player(id1))
	set PlayersName[id2] = GetPlayerName(Player(id2))
	// 队伍
	call SetPlayerTeam(Player(id1), 0)
	call SetPlayerTeam(Player(id2), 1)
	// 结盟
	set i = 0
	loop
		call SetPlayerAlliance(Player(id1), SentinelPlayers[i], ALLIANCE_PASSIVE, true)
		call SetPlayerAlliance(Player(id1), SentinelPlayers[i], ALLIANCE_HELP_REQUEST, true)
		call SetPlayerAlliance(Player(id1), SentinelPlayers[i], ALLIANCE_HELP_RESPONSE, true)
		call SetPlayerAlliance(Player(id1), SentinelPlayers[i], ALLIANCE_SHARED_XP, true)
		call SetPlayerAlliance(Player(id1), SentinelPlayers[i], ALLIANCE_SHARED_SPELLS, true)
		call SetPlayerAlliance(SentinelPlayers[i], Player(id1), ALLIANCE_PASSIVE, true)
		call SetPlayerAlliance(SentinelPlayers[i], Player(id1), ALLIANCE_HELP_REQUEST, true)
		call SetPlayerAlliance(SentinelPlayers[i], Player(id1), ALLIANCE_HELP_RESPONSE, true)
		call SetPlayerAlliance(SentinelPlayers[i], Player(id1), ALLIANCE_SHARED_XP, true)
		call SetPlayerAlliance(SentinelPlayers[i], Player(id1), ALLIANCE_SHARED_SPELLS, true)
		call SetPlayerAlliance(Player(id1), ScourgePlayers[i], ALLIANCE_PASSIVE, false)
		call SetPlayerAlliance(Player(id1), ScourgePlayers[i], ALLIANCE_HELP_REQUEST, false)
		call SetPlayerAlliance(Player(id1), ScourgePlayers[i], ALLIANCE_HELP_RESPONSE, false)
		call SetPlayerAlliance(Player(id1), ScourgePlayers[i], ALLIANCE_SHARED_XP, false)
		call SetPlayerAlliance(Player(id1), ScourgePlayers[i], ALLIANCE_SHARED_SPELLS, false)
		call SetPlayerAlliance(ScourgePlayers[i], Player(id1), ALLIANCE_PASSIVE, false)
		call SetPlayerAlliance(ScourgePlayers[i], Player(id1), ALLIANCE_HELP_REQUEST, false)
		call SetPlayerAlliance(ScourgePlayers[i], Player(id1), ALLIANCE_HELP_RESPONSE, false)
		call SetPlayerAlliance(ScourgePlayers[i], Player(id1), ALLIANCE_SHARED_XP, false)
		call SetPlayerAlliance(ScourgePlayers[i], Player(id1), ALLIANCE_SHARED_SPELLS, false)
		set i = i + 1
	exitwhen i > 5
	endloop
	set i = 0
	loop
		call SetPlayerAlliance(Player(id2), ScourgePlayers[i], ALLIANCE_PASSIVE, true)
		call SetPlayerAlliance(Player(id2), ScourgePlayers[i], ALLIANCE_HELP_REQUEST, true)
		call SetPlayerAlliance(Player(id2), ScourgePlayers[i], ALLIANCE_HELP_RESPONSE, true)
		call SetPlayerAlliance(Player(id2), ScourgePlayers[i], ALLIANCE_SHARED_XP, true)
		call SetPlayerAlliance(Player(id2), ScourgePlayers[i], ALLIANCE_SHARED_SPELLS, true)
		call SetPlayerAlliance(ScourgePlayers[i], Player(id2), ALLIANCE_PASSIVE, true)
		call SetPlayerAlliance(ScourgePlayers[i], Player(id2), ALLIANCE_HELP_REQUEST, true)
		call SetPlayerAlliance(ScourgePlayers[i], Player(id2), ALLIANCE_HELP_RESPONSE, true)
		call SetPlayerAlliance(ScourgePlayers[i], Player(id2), ALLIANCE_SHARED_XP, true)
		call SetPlayerAlliance(ScourgePlayers[i], Player(id2), ALLIANCE_SHARED_SPELLS, true)
		call SetPlayerAlliance(Player(id2), SentinelPlayers[i], ALLIANCE_PASSIVE, false)
		call SetPlayerAlliance(Player(id2), SentinelPlayers[i], ALLIANCE_HELP_REQUEST, false)
		call SetPlayerAlliance(Player(id2), SentinelPlayers[i], ALLIANCE_HELP_RESPONSE, false)
		call SetPlayerAlliance(Player(id2), SentinelPlayers[i], ALLIANCE_SHARED_XP, false)
		call SetPlayerAlliance(Player(id2), SentinelPlayers[i], ALLIANCE_SHARED_SPELLS, false)
		call SetPlayerAlliance(SentinelPlayers[i], Player(id2), ALLIANCE_PASSIVE, false)
		call SetPlayerAlliance(SentinelPlayers[i], Player(id2), ALLIANCE_HELP_REQUEST, false)
		call SetPlayerAlliance(SentinelPlayers[i], Player(id2), ALLIANCE_HELP_RESPONSE, false)
		call SetPlayerAlliance(SentinelPlayers[i], Player(id2), ALLIANCE_SHARED_XP, false)
		call SetPlayerAlliance(SentinelPlayers[i], Player(id2), ALLIANCE_SHARED_SPELLS, false)
		set i = i + 1
	exitwhen i > 5
	endloop
	set i = 0
	loop
		call SetPlayerAlliance(Player(id1), Player(15), ConvertAllianceType(i), true)
		call SetPlayerAlliance(Player(15), Player(id1), ConvertAllianceType(i), true)
		call SetPlayerAlliance(Player(id2), Player(15), ConvertAllianceType(i), true)
		call SetPlayerAlliance(Player(15), Player(id2), ConvertAllianceType(i), true)
		set i = i + 1
	exitwhen i > 5
	endloop
endfunction

function MUCreateDummyMessenger takes unit messenger, player owner, player origin_owner returns nothing
	local unit dummy = CreateUnit(owner, 'e00E', GetUnitX(messenger), GetUnitY(messenger), 0)
	local trigger trg = CreateTrigger()
	if owner != origin_owner then
		call UnitSetUsesAltIcon(dummy, true)
	endif
	call SetUnitFlyHeight(dummy, 10000, 0)
	call UnitAddAbility(dummy, 'Avul')
	call UnitAddAbility(dummy, 'AInv')
	call SaveUnitHandle(HY, GetHandleId(trg), 1, dummy)
	call SaveUnitHandle(HY, GetHandleId(trg), 2, messenger)
	call SavePlayerHandle(HY, GetHandleId(trg), 3, owner)
	call SavePlayerHandle(HY, GetHandleId(trg), 4, origin_owner)
	call SaveBoolean(HY, GetHandleId(trg), 5, true)
	call TriggerRegisterTimerEvent(trg, 0.1, true)
	call TriggerRegisterUnitEvent(trg, messenger, EVENT_UNIT_PICKUP_ITEM)
	call TriggerRegisterUnitEvent(trg, messenger, EVENT_UNIT_DROP_ITEM)
	call TriggerRegisterUnitEvent(trg, messenger, EVENT_UNIT_CHANGE_OWNER)
	call TriggerAddCondition(trg, mu_sync_dummy_messenger)
	set dummy = null
	set trg = null
endfunction

function MUSetMessengerShare takes unit messenger returns nothing
	local player owner = MUGetMessengerOwner(messenger)
	local integer team = GetPlayerTeam(owner)
	local player target_player = null
	local string name
	local integer i
	if team == 0 then
		if SentinelPlayers[0] == Player(0) then
			set target_player = Player(13)
			call MUInitDummyPlayer(13, 14)
		elseif SentinelPlayers[0] == Player(13) then
			set target_player = Player(0)
			call MUInitDummyPlayer(0, 6)
		endif
	elseif team == 1 then
		if ScourgePlayers[0] == Player(6) then
			set target_player = Player(14)
			call MUInitDummyPlayer(13, 14)
		elseif ScourgePlayers[0] == Player(14) then
			set target_player = Player(6)
			call MUInitDummyPlayer(0, 6)
		endif
	endif
	if target_player == null then
		
		return
	endif
	call SavePlayerHandle(HY, GetHandleId(owner), StringHash("信使共享玩家"), target_player)
	call UnitSetUsesAltIcon(messenger, true)
	call SetUnitOwner(messenger, target_player, false)
	set name = GetPlayerName(target_player)
	call SetPlayerName(target_player, PlayersColoerText[GetPlayerId(target_player)] + "动物信使|r")
	if team == 0 then
		set i = 1
		loop
			call SetPlayerAlliance(target_player, SentinelPlayers[i], ALLIANCE_SHARED_CONTROL, true)
			call UnitShareVision(messenger, SentinelPlayers[i], true)
			call MUCreateDummyMessenger(messenger, SentinelPlayers[i], owner)
			if SentinelPlayers[i] != owner then
				call DisplayTimedTextToPlayer(SentinelPlayers[i], 0, 0, 10, "|cffffff11你可以控制" + PlayersColoerText[GetPlayerId(owner)] + GetPlayerName(owner) + "|cffffff11的信使了|r")
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
	elseif team == 1 then
		set i = 1
		loop
			call SetPlayerAlliance(target_player, ScourgePlayers[i], ALLIANCE_SHARED_CONTROL, true)
			call UnitShareVision(messenger, ScourgePlayers[i], true)
			call MUCreateDummyMessenger(messenger, ScourgePlayers[i], owner)
			if ScourgePlayers[i] != owner then
				call DisplayTimedTextToPlayer(ScourgePlayers[i], 0, 0, 10, "|cffffff11你可以控制" + PlayersColoerText[GetPlayerId(owner)] + GetPlayerName(owner) + "|cffffff11的信使了|r")
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
	endif
	call SetPlayerName(target_player, name)
	set target_player = null
	set owner = null
endfunction

function MUSyncDummyMessenger takes nothing returns nothing
	local trigger trg = GetTriggeringTrigger()
	local unit dummy = LoadUnitHandle(HY, GetHandleId(trg), 1)
	local unit messenger = LoadUnitHandle(HY, GetHandleId(trg), 2)
	local boolean need_sync_items = LoadBoolean(HY, GetHandleId(trg), 5)
	local integer i
	local item it
	if GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		call UnitPauseTimedLife(dummy, true)
		if IsUnitType(messenger, UNIT_TYPE_DEAD) then
			call ShowUnit(dummy, false)
		else
			call ShowUnit(dummy, true)
			call SetUnitX(dummy, GetUnitX(messenger))
			call SetUnitY(dummy, GetUnitY(messenger))
		endif
		if IsUnitType(dummy, UNIT_TYPE_DEAD) then
			call MUCreateDummyMessenger(messenger, LoadPlayerHandle(HY, GetHandleId(trg), 3), LoadPlayerHandle(HY, GetHandleId(trg), 4))
			call DestroyTrigger(trg)
			call FlushChildHashtable(HY, GetHandleId(trg))
		endif
	elseif GetTriggerEventId() == EVENT_UNIT_CHANGE_OWNER then
		// 删除马甲身上的物品
		call DisableTrigger(CUV)
		set i = 0
		loop
			set it = UnitItemInSlot(dummy, i)
			if it != null then
				call RemoveItem(it)
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
		set it = null
		call EnableTrigger(CUV)
		// 删除马甲并清空
		call RemoveUnit(dummy)
		call DestroyTrigger(trg)
		call FlushChildHashtable(HY, GetHandleId(trg))
	else
		call SaveBoolean(HY, GetHandleId(trg), 5, true)
	endif
	if need_sync_items and GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		call SaveBoolean(HY, GetHandleId(trg), 5, false)
		// 同步马甲身上的物品
		call DisableTrigger(CUV)
		// 先删掉马甲身上的物品
		set i = 0
		loop
			set it = UnitItemInSlot(dummy, i)
			if it != null then
				call RemoveItem(it)
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
		// 然后同步物品
		set i = 0
		loop
			set it = UnitItemInSlot(messenger, i)
			if it == null or(GetTriggerEventId() == EVENT_UNIT_DROP_ITEM and it == GetManipulatedItem()) then
				// 创建占位物品
				set it = CreateItem('I02M', 0, 0)
			else
				set it = CreateItem(GetItemTypeId(it), 0, 0)
			endif
			if not UnitAddItem(dummy, it) then
				call RemoveItem(it)
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
		// 最后删掉占位物品
		set i = 0
		loop
			set it = UnitItemInSlot(dummy, i)
			if GetItemTypeId(it) == 'I02M' then
				call RemoveItem(it)
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
		set it = null
		call EnableTrigger(CUV)
	endif
	set trg = null
	set dummy = null
	set messenger = null
endfunction
function MUChangeMessengerShare takes player target returns nothing
	local boolean flag = not MUIsPlayerMessengerShared(target)
	local group temp_group = CreateGroup()
	local unit enum_unit
	if flag then
		call GroupEnumUnitsOfPlayer(temp_group, target, null)
	else
		call GroupEnumUnitsOfPlayer(temp_group, LoadPlayerHandle(HY, GetHandleId(target), StringHash("信使共享玩家")), null)
	endif
	if target == LocalPlayer then
		call GetSetupText("信使共享", flag)
	endif
	call SaveBoolean(HY, GetHandleId(target), StringHash("信使共享"), flag)
	
	loop
		set enum_unit = FirstOfGroup(temp_group)
	exitwhen enum_unit == null
		call GroupRemoveUnit(temp_group, enum_unit)
		if MUIsMessenger(enum_unit) then
			if flag then
				if not MUIsMessengerShared(enum_unit) then
					call MUSetMessengerShare(enum_unit)
				endif
			else
				if MUIsMessengerShared(enum_unit) then
					call MUSetMessengerNotShare(enum_unit)
				endif
			endif
		endif
	endloop
	call DestroyGroup(temp_group)
	set temp_group = null
endfunction

function MUInitMessenger takes unit messenger returns nothing
	call SavePlayerHandle(HY, GetHandleId(messenger), StringHash("信使所有者"), GetOwningPlayer(messenger))
	if MUIsPlayerMessengerShared(GetOwningPlayer(messenger)) then
		call MUSetMessengerShare(messenger)
	endif
	if (LocalPlayer== GetOwningPlayer(messenger)) then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, "你可以在能量圈单独共享你的信使")
	endif
endfunction

function MUSpellEffect takes nothing returns nothing
	call MUChangeMessengerShare(GetTriggerPlayer())
	call Click_CheckBox_Nothing( GetTriggerPlayer(), 10)
endfunction


function GME takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local real a = GetUnitFacing(u)
	local unit c = CreateUnit(GetOwningPlayer(u), AUO(GetOwningPlayer(u)), x, y, a)
	call ZOX(c)
	call GroupAddUnit(KX, c)
	call SaveUnitHandle(OtherHashTable, GetHandleId(GetOwningPlayer(u)),'COUR', HJX(GetOwningPlayer(u)))
	call SetUnitPosition(c, x + 25 * Cos(a * bj_DEGTORAD), y + 25 * Sin(a * bj_DEGTORAD))
	call MUInitMessenger(c)
	if W3[GetPlayerId(GetOwningPlayer(c))]== false then
		call UnitRemoveType(c, UNIT_TYPE_PEON)
	else
		call UnitAddType(c, UNIT_TYPE_PEON)
	endif
	set c = null
	set u = null
endfunction
// 召唤信使
function GPE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit Y1X = CreateUnit(GetOwningPlayer(u), AWO(GetOwningPlayer(u)), GetUnitX(u), GetUnitY(u), GetUnitFacing(u))
	call MUInitMessenger(Y1X)
	call ZOX(Y1X)
	call GroupAddUnit(KX, Y1X)
	call SaveUnitHandle(OtherHashTable, GetHandleId(GetOwningPlayer(u)),'COUR', HJX(GetOwningPlayer(u)))
	if W3[GetPlayerId(GetOwningPlayer(Y1X))]== false then
		call UnitRemoveType(Y1X, UNIT_TYPE_PEON)
	else
		call UnitAddType(Y1X, UNIT_TYPE_PEON)
	endif
	call ASO(Y1X)
	set Y1X = null
	set u = null
endfunction
function AYO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h,'|')
	local integer i = 1
	local integer array AZO
	local integer array HUX
	local integer A_O = LoadInteger(HY, h, 125)
	set AZO[1]= LoadInteger(HY, h,'j')
	set AZO[2]= LoadInteger(HY, h,'k')
	set AZO[3]= LoadInteger(HY, h,'l')
	set AZO[4]= LoadInteger(HY, h,'m')
	set AZO[5]= LoadInteger(HY, h, 110)
	set AZO[6]= LoadInteger(HY, h,'o')
	set HUX[1]= LoadInteger(HY, h,'p')
	set HUX[2]= LoadInteger(HY, h,'q')
	set HUX[3]= LoadInteger(HY, h, 114)
	set HUX[4]= LoadInteger(HY, h, 115)
	set HUX[5]= LoadInteger(HY, h, 116)
	set HUX[6]= LoadInteger(HY, h,'u')
	call DisableTrigger(CUV)
	if GetTriggerEvalCount(t) == 1 then
		call UnitAddAbility(u, A_O)
		if W3[GetPlayerId(GetOwningPlayer(u))]== false then
			call UnitRemoveType(u, UNIT_TYPE_PEON)
		else
			call UnitAddType(u, UNIT_TYPE_PEON)
		endif
	else
		loop
			if AZO[i]> 0 then
				set Z2 = CreateItem(AZO[i], GetUnitX(u), GetUnitY(u))
				call UnitAddItem(u, Z2)
				call SetItemPlayer(Z2, LoadPlayerHandle(HY, h,'u'+ i), false)
				call SetItemUserData(Z2, 1)
				if HUX[i]> 0 then
					call SetItemCharges(Z2, HUX[i])
				endif
			endif
			set i = i + 1
		exitwhen i > 6
		endloop
		if W3[GetPlayerId(GetOwningPlayer(u))]== false then
			call UnitRemoveType(u, UNIT_TYPE_PEON)
		else
			call UnitAddType(u, UNIT_TYPE_PEON)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	call EnableTrigger(CUV)
	call UnitMakeAbilityPermanent(u, true,'A29M')
	call UnitMakeAbilityPermanent(u, true,'A413')
	set t = null
	set u = null
	return false
endfunction
function A0O takes integer id returns boolean
	return id == R0V or id == R_V or id == RYV
endfunction
function A1O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit A2O =(LoadUnitHandle(HY, h, 2))
	local integer A3O = GetUnitTypeId(A2O)
	local real x = GetUnitX(A2O)
	local real y = GetUnitY(A2O)
	local item A4O
	local item A5O
	local item A6O
	local item A7O
	local item A8O
	local item A9O
	local player p0
	local player p1
	local player p2
	local player p3
	local player p4
	local player p5
	local integer NVO
	local integer NEO
	local integer NXO
	local integer NOO
	local integer NRO
	local integer NIO
	local integer NAO =-1
	local integer NNO =-1
	local integer NBO =-1
	local integer NCO =-1
	local integer NDO =-1
	local integer NFO =-1
	local integer A_O
	local item C1X
	local integer i
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	if A2O == null or UnitIsDead(A2O) then
		set t = null
		set A2O = null
		return false
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	set A4O = UnitItemInSlot(A2O, 0)
	set A5O = UnitItemInSlot(A2O, 1)
	set A6O = UnitItemInSlot(A2O, 2)
	set A7O = UnitItemInSlot(A2O, 3)
	set A8O = UnitItemInSlot(A2O, 4)
	set A9O = UnitItemInSlot(A2O, 5)
	set NVO = GetItemTypeId(A4O)
	set NEO = GetItemTypeId(A5O)
	set NXO = GetItemTypeId(A6O)
	set NOO = GetItemTypeId(A7O)
	set NRO = GetItemTypeId(A8O)
	set NIO = GetItemTypeId(A9O)
	set p0 = GetItemPlayer(A4O)
	set p1 = GetItemPlayer(A5O)
	set p2 = GetItemPlayer(A6O)
	set p3 = GetItemPlayer(A7O)
	set p4 = GetItemPlayer(A8O)
	set p5 = GetItemPlayer(A9O)
	set C1X = A4O
	set i = GetItemIndexEx(C1X)
	if GetItemType(C1X) == ITEM_TYPE_ARTIFACT or HHX(i) or(GetItemType(C1X) == ITEM_TYPE_CAMPAIGN and A0O(i)) then
		set NAO = GetItemCharges(C1X)
	endif
	set C1X = A5O
	set i = GetItemIndexEx(C1X)
	if GetItemType(C1X) == ITEM_TYPE_ARTIFACT or HHX(i) or(GetItemType(C1X) == ITEM_TYPE_CAMPAIGN and A0O(i)) then
		set NNO = GetItemCharges(C1X)
	endif
	set C1X = A6O
	set i = GetItemIndexEx(C1X)
	if GetItemType(C1X) == ITEM_TYPE_ARTIFACT or HHX(i) or(GetItemType(C1X) == ITEM_TYPE_CAMPAIGN and A0O(i)) then
		set NBO = GetItemCharges(C1X)
	endif
	set C1X = A7O
	set i = GetItemIndexEx(C1X)
	if GetItemType(C1X) == ITEM_TYPE_ARTIFACT or HHX(i) or(GetItemType(C1X) == ITEM_TYPE_CAMPAIGN and A0O(i)) then
		set NCO = GetItemCharges(C1X)
	endif
	set C1X = A8O
	set i = GetItemIndexEx(C1X)
	if GetItemType(C1X) == ITEM_TYPE_ARTIFACT or HHX(i) or(GetItemType(C1X) == ITEM_TYPE_CAMPAIGN and A0O(i)) then
		set NDO = GetItemCharges(C1X)
	endif
	set C1X = A9O
	set i = GetItemIndexEx(C1X)
	if GetItemType(C1X) == ITEM_TYPE_ARTIFACT or HHX(i) or(GetItemType(C1X) == ITEM_TYPE_CAMPAIGN and A0O(i)) then
		set NFO = GetItemCharges(C1X)
	endif
	call HZX(A4O)
	call HZX(A5O)
	call HZX(A6O)
	call HZX(A7O)
	call HZX(A8O)
	call HZX(A9O)
	//	if A3O =='np00'then
	//		set A_O ='S020'
	if A3O =='n00I' then
		set A_O ='S009'
	elseif A3O =='n022' then
		set A_O ='S00V'
	elseif A3O =='n021' then
		set A_O ='S00C'
	elseif A3O =='n023' then
		set A_O ='S00E'
	elseif A3O =='n024' then
		set A_O ='S00B'
	elseif A3O =='n025' then
		set A_O ='S00F'
	elseif A3O =='n0KY' then
		set A_O ='S00W'
	elseif A3O =='n0KZ' then
		set A_O ='S00Y'
	elseif A3O =='n0L0' then
		set A_O ='S00X'
	elseif A3O =='n0L1' then
		set A_O ='S00D'
	elseif A3O =='n0LE' then
		set A_O ='S01F'
	elseif A3O =='n0M4' then
		set A_O ='S015'
	elseif A3O =='np00' then
		set A_O ='S015'
	endif
	if GetRandomInt(1, 10) == 1 then
		set A_O ='S00G'
	endif
	if GetRandomInt(1, 10)< 3 then
		set A_O ='S016'
	endif
	if GetRandomInt(0, 50)< 3 then
		set A_O ='S0JH'
	endif
	if A3O =='n00M' then
		set A_O ='S00L'
	elseif A3O =='n0LS' then
		set A_O ='S00L'
	elseif A3O =='n0HV' then
		set A_O ='S00F'
	endif
	if A3O =='e01H' then
		set A_O ='S012'
	elseif A3O =='e01Z' then
		set A_O ='S010'
	elseif A3O =='e02R' then
		set A_O ='S014'
	elseif A3O =='e02T' then
		set A_O ='S011'
	elseif A3O =='e02S' then
		set A_O ='S017'
	elseif A3O =='e030' then
		set A_O ='S0SV'
	elseif A3O =='np01' then
		set A_O ='S013'
	endif
	call SavePlayerHandle(HY, h,'v',(p0))
	call SavePlayerHandle(HY, h,'w',(p1))
	call SavePlayerHandle(HY, h, 120,(p2))
	call SavePlayerHandle(HY, h, 121,(p3))
	call SavePlayerHandle(HY, h,'z',(p4))
	call SavePlayerHandle(HY, h,'{',(p5))
	call SaveInteger(HY, h,'j',(NVO))
	call SaveInteger(HY, h,'k',(NEO))
	call SaveInteger(HY, h,'l',(NXO))
	call SaveInteger(HY, h,'m',(NOO))
	call SaveInteger(HY, h, 110,(NRO))
	call SaveInteger(HY, h,'o',(NIO))
	call SaveInteger(HY, h,'p',(NAO))
	call SaveInteger(HY, h,'q',(NNO))
	call SaveInteger(HY, h, 114,(NBO))
	call SaveInteger(HY, h, 115,(NCO))
	call SaveInteger(HY, h, 116,(NDO))
	call SaveInteger(HY, h,'u',(NFO))
	call SaveUnitHandle(HY, h,'|',(A2O))
	call SaveInteger(HY, h, 125,(A_O))
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function AYO))
	set t = null
	set A2O = null
	set A4O = null
	set A5O = null
	set A6O = null
	set A7O = null
	set A8O = null
	set A9O = null
	set p0 = null
	set p1 = null
	set p2 = null
	set p3 = null
	set p4 = null
	set p5 = null
	set C1X = null
	return false
endfunction
function GQE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .05, false)
	call TriggerAddCondition(t, Condition(function A1O))
	call SaveUnitHandle(HY, h, 2,(GetTriggerUnit()))
	set t = null
endfunction
function NGO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit NHO =(LoadUnitHandle(HY, h,'|'))
	local integer A_O =(LoadInteger(HY, h, 125))
	local integer NVO =(LoadInteger(HY, h,'j'))
	local integer NEO =(LoadInteger(HY, h,'k'))
	local integer NXO =(LoadInteger(HY, h,'l'))
	local integer NOO =(LoadInteger(HY, h,'m'))
	local integer NRO =(LoadInteger(HY, h, 110))
	local integer NIO =(LoadInteger(HY, h,'o'))
	local player p0 =(LoadPlayerHandle(HY, h,'v'))
	local player p1 =(LoadPlayerHandle(HY, h,'w'))
	local player p2 =(LoadPlayerHandle(HY, h, 120))
	local player p3 =(LoadPlayerHandle(HY, h, 121))
	local player p4 =(LoadPlayerHandle(HY, h,'z'))
	local player p5 =(LoadPlayerHandle(HY, h,'{'))
	local integer NAO =(LoadInteger(HY, h,'p'))
	local integer NNO =(LoadInteger(HY, h,'q'))
	local integer NBO =(LoadInteger(HY, h, 114))
	local integer NCO =(LoadInteger(HY, h, 115))
	local integer NDO =(LoadInteger(HY, h, 116))
	local integer NFO =(LoadInteger(HY, h,'u'))
	call DisableTrigger(CUV)
	if GetTriggerEvalCount(t) == 1 then
		call UnitAddAbility(NHO, A_O)
		if W3[GetPlayerId(GetOwningPlayer(NHO))]== false then
			call UnitRemoveType(NHO, UNIT_TYPE_PEON)
		else
			call UnitAddType(NHO, UNIT_TYPE_PEON)
		endif
	else
		if NVO > 0 then
			set Z2 = CreateItem(NVO, GetUnitX(NHO), GetUnitY(NHO))
			call UnitAddItem(NHO, Z2)
			call SetItemPlayer(Z2, p0, false)
			call SetItemUserData(Z2, 1)
		endif
		if NAO > 0 then
			call SetItemCharges(Z2, NAO)
		endif
		if NEO > 0 then
			set Z2 = CreateItem(NEO, GetUnitX(NHO), GetUnitY(NHO))
			call UnitAddItem(NHO, Z2)
			call SetItemPlayer(Z2, p1, false)
			call SetItemUserData(Z2, 1)
		endif
		if NNO > 0 then
			call SetItemCharges(Z2, NNO)
		endif
		if NXO > 0 then
			set Z2 = CreateItem(NXO, GetUnitX(NHO), GetUnitY(NHO))
			call UnitAddItem(NHO, Z2)
			call SetItemPlayer(Z2, p2, false)
			call SetItemUserData(Z2, 1)
		endif
		if NBO > 0 then
			call SetItemCharges(Z2, NBO)
		endif
		if NOO > 0 then
			set Z2 = CreateItem(NOO, GetUnitX(NHO), GetUnitY(NHO))
			call UnitAddItem(NHO, Z2)
			call SetItemPlayer(Z2, p3, false)
			call SetItemUserData(Z2, 1)
		endif
		if NCO > 0 then
			call SetItemCharges(Z2, NCO)
		endif
		if NRO > 0 then
			set Z2 = CreateItem(NRO, GetUnitX(NHO), GetUnitY(NHO))
			call UnitAddItem(NHO, Z2)
			call SetItemPlayer(Z2, p4, false)
			call SetItemUserData(Z2, 1)
		endif
		if NDO > 0 then
			call SetItemCharges(Z2, NDO)
		endif
		if NIO > 0 then
			set Z2 = CreateItem(NIO, GetUnitX(NHO), GetUnitY(NHO))
			call UnitAddItem(NHO, Z2)
			call SetItemPlayer(Z2, p5, false)
			call SetItemUserData(Z2, 1)
		endif
		if NFO > 0 then
			call SetItemCharges(Z2, NFO)
		endif
		if W3[GetPlayerId(GetOwningPlayer(NHO))]== false then
			call UnitRemoveType(NHO, UNIT_TYPE_PEON)
		else
			call UnitAddType(NHO, UNIT_TYPE_PEON)
		endif
		call SetUnitFlyHeight(NHO, 240, 0)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	call EnableTrigger(CUV)
	set t = null
	set NHO = null
	set p0 = null
	set p1 = null
	set p2 = null
	set p3 = null
	set p4 = null
	set p5 = null
	return false
endfunction
function NJO takes unit A2O returns nothing
	local integer A3O = GetUnitTypeId(A2O)
	local real x = GetUnitX(A2O)
	local real y = GetUnitY(A2O)
	local item A4O
	local item A5O
	local item A6O
	local item A7O
	local item A8O
	local item A9O
	local player p0
	local player p1
	local player p2
	local player p3
	local player p4
	local player p5
	local integer NVO
	local integer NEO
	local integer NXO
	local integer NOO
	local integer NRO
	local integer NIO
	local integer NAO =-1
	local integer NNO =-1
	local integer NBO =-1
	local integer NCO =-1
	local integer NDO =-1
	local integer NFO =-1
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer A_O
	local item C1X
	local integer i
	local item NKO
	set i = 0
	loop
	exitwhen i > 5
		set NKO = UnitItemInSlot(A2O, i)
		if GetItemIndexEx(NKO) == X4V then
			call UnitRemoveItem(A2O, NKO)
		endif
		set i = i + 1
	endloop
	set A4O = UnitItemInSlot(A2O, 0)
	set A5O = UnitItemInSlot(A2O, 1)
	set A6O = UnitItemInSlot(A2O, 2)
	set A7O = UnitItemInSlot(A2O, 3)
	set A8O = UnitItemInSlot(A2O, 4)
	set A9O = UnitItemInSlot(A2O, 5)
	set NVO = GetItemTypeId(A4O)
	set NEO = GetItemTypeId(A5O)
	set NXO = GetItemTypeId(A6O)
	set NOO = GetItemTypeId(A7O)
	set NRO = GetItemTypeId(A8O)
	set NIO = GetItemTypeId(A9O)
	set p0 = GetItemPlayer(A4O)
	set p1 = GetItemPlayer(A5O)
	set p2 = GetItemPlayer(A6O)
	set p3 = GetItemPlayer(A7O)
	set p4 = GetItemPlayer(A8O)
	set p5 = GetItemPlayer(A9O)
	set C1X = A4O
	if GetItemType(C1X) == ITEM_TYPE_ARTIFACT or HHX(GetItemIndexEx(C1X)) or(GetItemType(C1X) == ITEM_TYPE_CAMPAIGN and A0O(GetItemIndexEx(C1X))) then
		set NAO = GetItemCharges(C1X)
	endif
	set C1X = A5O
	if GetItemType(C1X) == ITEM_TYPE_ARTIFACT or HHX(GetItemIndexEx(C1X)) or(GetItemType(C1X) == ITEM_TYPE_CAMPAIGN and A0O(GetItemIndexEx(C1X))) then
		set NNO = GetItemCharges(C1X)
	endif
	set C1X = A6O
	if GetItemType(C1X) == ITEM_TYPE_ARTIFACT or HHX(GetItemIndexEx(C1X)) or(GetItemType(C1X) == ITEM_TYPE_CAMPAIGN and A0O(GetItemIndexEx(C1X))) then
		set NBO = GetItemCharges(C1X)
	endif
	set C1X = A7O
	if GetItemType(C1X) == ITEM_TYPE_ARTIFACT or HHX(GetItemIndexEx(C1X)) or(GetItemType(C1X) == ITEM_TYPE_CAMPAIGN and A0O(GetItemIndexEx(C1X))) then
		set NCO = GetItemCharges(C1X)
	endif
	set C1X = A8O
	if GetItemType(C1X) == ITEM_TYPE_ARTIFACT or HHX(GetItemIndexEx(C1X)) or(GetItemType(C1X) == ITEM_TYPE_CAMPAIGN and A0O(GetItemIndexEx(C1X))) then
		set NDO = GetItemCharges(C1X)
	endif
	set C1X = A9O
	if GetItemType(C1X) == ITEM_TYPE_ARTIFACT or HHX(GetItemIndexEx(C1X)) or(GetItemType(C1X) == ITEM_TYPE_CAMPAIGN and A0O(GetItemIndexEx(C1X))) then
		set NFO = GetItemCharges(C1X)
	endif
	call HZX(A4O)
	call HZX(A5O)
	call HZX(A6O)
	call HZX(A7O)
	call HZX(A8O)
	call HZX(A9O)
	if GetUnitTypeId(A2O)=='np00'then
		set A_O ='S020'
	else
		//	if IsSentinelPlayer(GetOwningPlayer(A2O)) then
		if GetPlayerTeam(GetOwningPlayer(A2O)) == 0 then
			set A_O ='S00I'
		else
			set A_O ='S00J'
		endif
		if GetRandomInt(1, 3) == 1 then
			set A_O ='S00Z'
		endif
	endif
	call SavePlayerHandle(HY, h,'v',(p0))
	call SavePlayerHandle(HY, h,'w',(p1))
	call SavePlayerHandle(HY, h, 120,(p2))
	call SavePlayerHandle(HY, h, 121,(p3))
	call SavePlayerHandle(HY, h,'z',(p4))
	call SavePlayerHandle(HY, h,'{',(p5))
	call SaveInteger(HY, h,'j',(NVO))
	call SaveInteger(HY, h,'k',(NEO))
	call SaveInteger(HY, h,'l',(NXO))
	call SaveInteger(HY, h,'m',(NOO))
	call SaveInteger(HY, h, 110,(NRO))
	call SaveInteger(HY, h,'o',(NIO))
	call SaveInteger(HY, h,'p',(NAO))
	call SaveInteger(HY, h,'q',(NNO))
	call SaveInteger(HY, h, 114,(NBO))
	call SaveInteger(HY, h, 115,(NCO))
	call SaveInteger(HY, h, 116,(NDO))
	call SaveInteger(HY, h,'u',(NFO))
	call SaveUnitHandle(HY, h,'|',(A2O))
	call SaveInteger(HY, h, 125,(A_O))
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function NGO))
	set t = null
	set A2O = null
	set A4O = null
	set A5O = null
	set A6O = null
	set A7O = null
	set A8O = null
	set A9O = null
	set p0 = null
	set p1 = null
	set p2 = null
	set p3 = null
	set p4 = null
	set p5 = null
	set C1X = null
	set NKO = null
endfunction
function NLO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local item NMO = ACX(whichUnit, XOV[BUV])
	local boolean Q0X = LoadBoolean(HY, h, 0)
	if Q0X == false then
		if NMO == null then
			set NMO = ACX(whichUnit, XIV[BUV])
		endif
	endif
	if NMO != null or Q0X then
		if Q0X == false then
			call RemoveItem(NMO)
		endif
		call NJO(whichUnit)
	else
		call InterfaceErrorForPlayer(GetOwningPlayer(whichUnit), GetObjectName('n02Q'))
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	set NMO = null
	return false
endfunction
function NPO takes unit whichUnit, boolean Q0X returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call ASO(whichUnit)
	call TriggerRegisterTimerEvent(t, .05, false)
	call TriggerAddCondition(t, Condition(function NLO))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveBoolean(HY, h, 0, Q0X)
	set t = null
endfunction
function HPX takes nothing returns nothing
	call NPO(U2, true)
endfunction
function HDE takes nothing returns boolean
	if GetSpellAbilityId()=='A0GD' then
		call NPO(GetTriggerUnit(), false)
	endif
	return false
endfunction
function NQO takes nothing returns boolean
	local unit trigUnit = GetTriggerUnit()
	local item C1X = GetManipulatedItem()
	local integer id = GetItemTypeId(C1X)
	local integer i
	if (id == XOV[R4V]or id == XOV[IAV]or id == XOV[INV]) and IsUnitType(trigUnit, UNIT_TYPE_HERO) then
		set C9V[GetPlayerId(GetOwningPlayer(trigUnit))]= GetItemX(C1X)
		set DVV[GetPlayerId(GetOwningPlayer(trigUnit))]= GetItemY(C1X)
	endif
	call RCO(trigUnit, C1X)
	if (GetItemTypeId(C1X) == XOV[NBV]or GetItemTypeId(C1X) == XOV[NCV]) and IsUnitMessenger(trigUnit) then
		call UnitRemoveItem(trigUnit, C1X)
	elseif (GetItemTypeId(C1X)) == XOV[Item_MagicWand]and IsUnitType(trigUnit, UNIT_TYPE_HERO) then
		// 如果拿了魔杖 还是英雄 设置
		set i = LoadInteger(HY, GetHandleId(trigUnit), 750)
		if i > 0 then
			if (LoadBoolean(HY, GetHandleId(trigUnit), 751)) == false then
				call SaveBoolean(HY, GetHandleId(trigUnit), 751, true)
				call SetItemCharges(C1X, i)
			endif
		endif
	elseif GetItemTypeId(C1X) == XOV[AIV]and GetUnitTypeId(trigUnit)!='n00L' and E8V == false then
		set E7V = trigUnit
		set E8V = true
		call StoreDrCacheData("AegisOn", GetPlayerId(GetOwningPlayer(trigUnit)))
		if (IsSentinelPlayer(GetOwningPlayer(trigUnit)) and GN == 0) or(IsScourgePlayer(GetOwningPlayer(trigUnit)) and GN == 1) then
			call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, DisplayTextDuration[LocalPlayerId], PlayersColoerText[GetPlayerId(GetOwningPlayer(trigUnit))] + GetUnitName(trigUnit)+ "|r " + GetObjectName('n0EQ'))
		else
			call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, DisplayTextDuration[LocalPlayerId], PlayersColoerText[GetPlayerId(GetOwningPlayer(trigUnit))] + GetUnitName(trigUnit)+ "|r " + "获得了不朽的守护!")
		endif
	elseif GetItemTypeId(C1X) == XOV[BUV]and OPX(trigUnit) then
		call NPO(trigUnit, false)
	endif
	set trigUnit = null
	set C1X = null
	return false
endfunction
function NSO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real YVX = LoadReal(HY, h, 0)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer c = LoadInteger(HY, h, 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call UnitRemoveAbility(u,'A0PV')
		call UnitRemoveAbility(u,'B07L')
		call RemoveSavedHandle(HY, GetHandleId(u),'TNGO')
		call DestroyTrigger(t)
		call FlushChildHashtable(HY, h)
	else
		if c > 0 then
			call SaveInteger(HY, h, 0, c -1)
			call SetWidgetLife(u, GetWidgetLife(u)+ YVX)
		else
			call UnitRemoveAbility(u,'A0PV')
			call UnitRemoveAbility(u,'B07L')
			call RemoveSavedHandle(HY, GetHandleId(u),'TNGO')
			call DestroyTrigger(t)
			call FlushChildHashtable(HY, h)
		endif
	endif
	set t = null
	set u = null
	return false
endfunction
function NTO takes real YVX returns nothing
	local trigger t
	local integer h
	local unit u = GetTriggerUnit()
	if HaveSavedHandle(HY, GetHandleId(u),'TNGO') then
		set t = LoadTriggerHandle(HY, GetHandleId(u),'TNGO')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, GetHandleId(u),'TNGO', t)
		call SaveUnitHandle(HY, h, 0, u)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerRegisterTimerEvent(t, 0, false)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerAddCondition(t, Condition(function NSO))
		call UnitAddPermanentAbility(u,'A0PV')
	endif
	call SaveReal(HY, h, 0, YVX * 1. / 16.)
	call SaveInteger(HY, h, 0, 16)
	set t = null
	set u = null
endfunction
function GSE takes nothing returns nothing
	if GetSpellTargetDestructable()!= null then
		if GetDestructableTypeId(GetSpellTargetDestructable()) == 'B005' then
			call NTO(230)
		else
			call NTO(115)
		endif
	elseif GetSpellTargetUnit()!= null then
		if IsUnitAlly(GetTriggerUnit(), GetOwningPlayer(GetSpellTargetUnit())) and(IsUnitType(GetSpellTargetUnit(), UNIT_TYPE_HERO) or IsBearUnit(GetSpellTargetUnit())) then
			call UnitAddItemById(GetSpellTargetUnit(), XXV[R1V])
		elseif IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetSpellTargetUnit())) and(GetUnitTypeId(GetSpellTargetUnit())=='oeye' or GetUnitTypeId(GetSpellTargetUnit())=='o004') then
			call NTO(230)
			call IOX(GetTriggerUnit(), GetSpellTargetUnit(), 2, 500, .0)
		else
			call CreateItem(XXV[R1V], GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit()))
		endif
	endif
endfunction
function NUO takes integer id, real x, real y returns nothing
	if IsPointInRegion(DNV, x, y) == false then
		set DIV = DIV + 1
		set DEV[DIV]= Player(id)
		set DXV[DIV]= x
		set DOV[DIV]= y
		set DRV[DIV]=(GetGameTime())
	endif
endfunction
function NWO takes integer id, real x, real y returns integer
	local real KGX =(GetGameTime())
	local integer i = 0
	local integer count = 0
	if IsPointInRegion(DNV, x, y) then
		return count
	endif
	loop
	exitwhen i > DIV
		if (KGX < DRV[i] + 25) and(GetDistanceBetween(x, y, DXV[i], DOV[i])< DAV * 2 + 50) and IsPlayerAlly(Player(id), DEV[i]) then
			set count = count + 1
		endif
		set i = i + 1
	endloop
	return count
endfunction
function NYO takes integer index returns integer
	if index == GetPlayerId(SentinelPlayers[1]) then
		return'h0BI'
	elseif index == GetPlayerId(SentinelPlayers[2]) then
		return'h0BK'
	elseif index == GetPlayerId(SentinelPlayers[3]) then
		return'h0BG'
	elseif index == GetPlayerId(SentinelPlayers[4]) then
		return'h0BF'
	elseif index == GetPlayerId(SentinelPlayers[5]) then
		return'h0BL'
	elseif index == GetPlayerId(ScourgePlayers[1]) then
		return'h0BH'
	elseif index == GetPlayerId(ScourgePlayers[2]) then
		return'h0BJ'
	elseif index == GetPlayerId(ScourgePlayers[3]) then
		return'h0BM'
	elseif index == GetPlayerId(ScourgePlayers[4]) then
		return'h0A5'
	elseif index == GetPlayerId(ScourgePlayers[5]) then
		return'h0BN'
	endif
	return'h0BN'
endfunction
function NZO takes integer index returns string
	if index == GetPlayerId(SentinelPlayers[1]) then
		return"war3mapImported\\TeleportTarget_Blue.mdx"
	elseif index == GetPlayerId(SentinelPlayers[2]) then
		return"war3mapImported\\TeleportTarget_Teal.mdx"
	elseif index == GetPlayerId(SentinelPlayers[3]) then
		return"war3mapImported\\TeleportTarget_Purple.mdx"
	elseif index == GetPlayerId(SentinelPlayers[4]) then
		return"war3mapImported\\TeleportTarget_Yellow.mdx"
	elseif index == GetPlayerId(SentinelPlayers[5]) then
		return"war3mapImported\\TeleportTarget_Orange.mdx"
	elseif index == GetPlayerId(ScourgePlayers[1]) then
		return"war3mapImported\\TeleportTarget_Pink.mdx"
	elseif index == GetPlayerId(ScourgePlayers[2]) then
		return"war3mapImported\\TeleportTarget_Gray.mdx"
	elseif index == GetPlayerId(ScourgePlayers[3]) then
		return"war3mapImported\\TeleportTarget_LightBlue.mdx"
	elseif index == GetPlayerId(ScourgePlayers[4]) then
		return"war3mapImported\\TeleportTarget_DarkGreen.mdx"
	elseif index == GetPlayerId(ScourgePlayers[5]) then
		return"war3mapImported\\TeleportTarget_Brown.mdx"
	endif
	return"Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl"
endfunction
function N_O takes nothing returns boolean
	local real d
	local unit u = GetFilterUnit()
	local integer id = GetUnitTypeId(u)
	if IsUnitType(u, UNIT_TYPE_STRUCTURE) and GetWidgetLife(u)> 0 and GetUnitAbilityLevel(u,'Asud') == 0 and IsUnitAlly(u, GetOwningPlayer(MissileHitTargetUnit)) and id !='ntav' and id!='u00S' and id!='ncop' and id!='emow' and id!='uzig' and IsUnitType(u, UNIT_TYPE_ANCIENT) == false then
		set d = GetDistanceBetween(TJ, RJ, GetUnitX(u), GetUnitY(u))
		if d < S2 then
			set S2 = d
			set U2 = u
		endif
	endif
	set u = null
	return false
endfunction
function N0O takes unit whichUnit, real x, real y returns unit
	local group g = AllocationGroup(23)
	set U2 = null
	set MissileHitTargetUnit = whichUnit
	set S2 = 99999
	set TJ = x
	set RJ = y
	call GroupEnumUnitsInRange(g, x, y, 99999, Condition(function N_O))
	call DeallocateGroup(g)
	set g = null
	return U2
endfunction

function GetUZ takes unit u returns real
	local integer lv = GetUnitAbilityLevel(u,'A0CY')
	local real r = 200
	if lv > 0 then
		set r = r * (1 + lv * 0.3)
	elseif GetUnitAbilityLevel(u,'Bblo') > 0 or GetUnitAbilityLevel(u,'B016') > 0 then
		set r = r * 1.3
	endif
	return r
endfunction

function GetpEffect takes unit u , real r returns effect
	set bj_lastCreatedEffect = AddSpecialEffect("Progressbar.mdx", GetUnitX(u), GetUnitY(u))
	call EXSetEffectSpeed(bj_lastCreatedEffect, 1 / r)
	call EXSetEffectSize(bj_lastCreatedEffect, 1.5)
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(u)) or IsObserverPlayer(LocalPlayer) then
		call EXSetEffectZ(bj_lastCreatedEffect, EXGetEffectZ(bj_lastCreatedEffect)+ GetUZ(u)+ GetUnitDefaultFlyHeight(u))
	else
		call EXSetEffectZ(bj_lastCreatedEffect,-9999)
	endif
	return bj_lastCreatedEffect
endfunction

function tp_scroll_cast takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local unit N2O =(LoadUnitHandle(HY, h, 448))
	local unit N3O =(LoadUnitHandle(HY, h, 447))
	local ubersplat tp_ube =(LoadUbersplatHandle(HY, h, 131))
	local integer count =(LoadInteger(HY, h, 34))
	local real N5O =(LoadReal(HY, h, 57))
	local real KGX =(LoadReal(HY, h, 442))
	local integer id = GetPlayerId(GetOwningPlayer(trigUnit))
	local integer miao
	local real jd
	local unit u
	if (GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED) then
		set jd = LoadReal(HY, h, 'jiao') + 10.00
		call SaveReal(HY, h, 'jiao', jd)
		call SetUnitFacing(LoadUnitHandle(HY, h, 'Uutx'), jd)
		set miao = LoadInteger(HY, h, 'miao')
		call SaveInteger(HY, h, 'miao', miao - 1)
		if (miao == 0) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetUnitX(trigUnit), GetUnitY(trigUnit)))
			call DestroyEffect(AddSpecialEffect(NZO(id), x, y))
			call DestroyEffect((LoadEffectHandle(HY, h, 176)))
			call EXSetEffectZ(LoadEffectHandle(HY, h, 'effe'),-9999)
			call DestroyEffect((LoadEffectHandle(HY, h, 'effe')))
			call SetUnitX(trigUnit, x)
			call SetUnitY(trigUnit, y)
			call PauseUnit(trigUnit, true)
			call PauseUnit(trigUnit, false)
			call KillTreeByCircle(x, y, 240)
		endif
	elseif GetTriggerEventId() == EVENT_UNIT_DEATH or GetSpellAbilityId() == 'A1R5'  then
		call SaveInteger(HY,(GetHandleId((trigUnit))),(4256), 2)
		call EXSetEffectZ(LoadEffectHandle(HY, h, 'effe'),-9999)
		call DestroyEffect((LoadEffectHandle(HY, h, 'effe')))
		set u = LoadUnitHandle(HY, h,'Uutx')
		if IsBearUnit(u) == false then
			call ShowUnit(u, false)
			call SetUnitX(u,-7488)
			call SetUnitY(u, 7296)
		else
			call RemoveUnit(u)
		endif
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetUnitX(trigUnit), GetUnitY(trigUnit)))
		call DestroyEffect(AddSpecialEffect(NZO(id), x, y))
		call DestroyEffect((LoadEffectHandle(HY, h, 176)))
		if GetTriggerEventId() == EVENT_UNIT_DEATH then
			call IssueImmediateOrderById(trigUnit, 851972)
		endif
		if LocalPlayer== GetOwningPlayer(trigUnit) then
			call SelectUnit(CirclesUnit[GetPlayerId(GetOwningPlayer(trigUnit))], false)
		endif
		call KillUnit(N2O)
		call KillUnit(N3O)
		call DestroyUbersplat(tp_ube)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set u = null
	set t = null
	set trigUnit = null
	set N2O = null
	set N3O = null
	set tp_ube = null
	return false
endfunction
function tp_boots_cast takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local unit stg_u =(LoadUnitHandle(HY, h, 17))
	local real x = GetUnitX(stg_u)
	local real y = GetUnitY(stg_u)
	local ubersplat tp_ube =(LoadUbersplatHandle(HY, h, 131))
	local integer id = GetPlayerId(GetOwningPlayer(trigUnit))
	local unit utx
	local real jd
	local integer miao
	local unit u
	if (GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED) then
		set utx = LoadUnitHandle(HY, h, 'Uutx')
		set jd = LoadReal(HY, h, 'jiao') + 10.00
		call SaveReal(HY, h, 'jiao', jd)
		call SetUnitFacing(utx, jd)
		set miao = LoadInteger(HY, h, 'miao')
		call SaveInteger(HY, h, 'miao', miao - 1)
		call SetUnitX(utx, x)
		call SetUnitY(utx, y)
		if (miao == 0) then
			call DestroyEffect((LoadEffectHandle(HY, h, 175)))
			call DestroyEffect((LoadEffectHandle(HY, h, 176)))
			call DestroyEffect((LoadEffectHandle(HY, h, 177)))
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl", GetUnitX(trigUnit), GetUnitY(trigUnit)))
			call EXSetEffectZ(LoadEffectHandle(HY, h, 'effe'),-9999)
			call DestroyEffect((LoadEffectHandle(HY, h, 'effe')))
			call SaveInteger(HY,(GetHandleId((trigUnit))),(4256), 2)
			set u = LoadUnitHandle(HY, h,'Uutx')
			if IsBearUnit(u) == false then
				call ShowUnit(u, false)
				call SetUnitX(u,-7488)
				call SetUnitY(u, 7296)
			else
				call RemoveUnit(u)
			endif
			call DestroyUbersplat(tp_ube)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call UnitRemoveType(stg_u, UNIT_TYPE_PEON)
			call SetUnitX(trigUnit, GetUnitX(stg_u)-1)
			call SetUnitY(trigUnit, GetUnitY(stg_u)-1)
			call PauseUnit(trigUnit, true)
			call PauseUnit(trigUnit, false)
			call KillTreeByCircle(x, y, 240)
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl", GetUnitX(trigUnit), GetUnitY(trigUnit)))
			if LocalPlayer== GetOwningPlayer(trigUnit) then
				call SelectUnit(CirclesUnit[GetPlayerId(GetOwningPlayer(trigUnit))], false)
			endif
		endif
	elseif GetTriggerEventId() == EVENT_WIDGET_DEATH or GetSpellAbilityId() == 'A231' or GetSpellAbilityId() == 'A3AG'  then
		call DestroyEffect((LoadEffectHandle(HY, h, 175)))
		call DestroyEffect((LoadEffectHandle(HY, h, 176)))
		call DestroyEffect((LoadEffectHandle(HY, h, 177)))
		call UnitRemoveType(stg_u, UNIT_TYPE_PEON)
		call SaveInteger(HY,(GetHandleId((trigUnit))),(4256), 2)
		call EXSetEffectZ(LoadEffectHandle(HY, h, 'effe'),-9999)
		call DestroyEffect((LoadEffectHandle(HY, h, 'effe')))
		set u = LoadUnitHandle(HY, h,'Uutx')
		if IsBearUnit(u) == false then
			call ShowUnit(u, false)
		else
			call RemoveUnit(u)
		endif
		call IssueImmediateOrderById(trigUnit, 851972)
		call DestroyUbersplat(tp_ube)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if LocalPlayer== GetOwningPlayer(trigUnit) then
			call SelectUnit(CirclesUnit[GetPlayerId(GetOwningPlayer(trigUnit))], false)
		endif
	endif
	set t = null
	set trigUnit = null
	set tp_ube = null
	set stg_u = null
	set utx = null
	set u = null
	return false
endfunction
function tp_texttag takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = LoadUnitHandle(HY, h, 0)
	local real tp_second = LoadReal(HY, h, 0)
	local real tri_ec = GetTriggerEvalCount(t)* .5 -0.5
	local texttag tt
	if GetTriggerEventId() == EVENT_UNIT_SPELL_ENDCAST or tri_ec >= tp_second then
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	else
		set tt = CreateTextTag()
		call SetTextTagText(tt, R2SW(tp_second -tri_ec, 1, 1), .03)
		call SetTextTagPosUnit(tt, trigUnit, 0)
		call SetTextTagColorBJ(tt, 150, 75, 255, 15)
		call SetTextTagVelocity(tt, 0, .035)
		call SetTextTagFadepoint(tt, 3)
		call SetTextTagLifespan(tt, .5)
		call SetTextTagPermanent(tt, false)
		call SetTextTagVisibility(tt, IsUnitAlly(trigUnit, LocalPlayer) or IsObserverPlayer(LocalPlayer))
	endif
	set tt = null
	set t = null
	set trigUnit = null
endfunction
function scroll_of_town_portal takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local unit stg_u = GetSpellTargetUnit()
	local real x
	local real y
	local real a
	local trigger t
	local integer h
	local unit N2O
	local unit N3O
	local ubersplat tp_ube
	local integer id = GetPlayerId(GetOwningPlayer(trigUnit))
	local integer count
	local real tp_second
	local trigger tt
	local real jd
	local unit utx
	local real flyheight
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SaveInteger(HY,(GetHandleId((trigUnit))),(4256), 1)
	if LocalPlayer== GetOwningPlayer(trigUnit) then
		call SelectUnit(CirclesUnit[id], true)
	endif
	if stg_u == null then
		set x = GetSpellTargetX()
		set y = GetSpellTargetY()
		if x == C9V[id]and y == DVV[id] then
			if IsSentinelPlayer(GetOwningPlayer(trigUnit)) then
				set x = GetUnitX(SentinelFountainOfLifeUnit)
				set y = GetUnitY(SentinelFountainOfLifeUnit)
				set stg_u = SentinelFountainOfLifeUnit
			else
				set x = GetUnitX(ScourgeFountainOfLifeUnit)
				set y = GetUnitY(ScourgeFountainOfLifeUnit)
				set stg_u = ScourgeFountainOfLifeUnit
			endif
		endif
		set stg_u = N0O(trigUnit, x, y)
	else
		set x = GetUnitX(stg_u)
		set y = GetUnitY(stg_u)
	endif
	set jd = bj_RADTODEG * Atan2(y - GetUnitY(trigUnit), x - GetUnitX(trigUnit))
	if GetDistanceBetween(x, y, GetUnitX(stg_u), GetUnitY(stg_u))> DAV then
		set a = Atan2(y -GetUnitY(stg_u), x -GetUnitX(stg_u))
		set x = GetUnitX(stg_u)+ DAV * Cos(a)
		set y = GetUnitY(stg_u)+ DAV * Sin(a)
	elseif GetDistanceBetween(x, y, GetUnitX(stg_u), GetUnitY(stg_u))< 50 then
		set a = Atan2(y -GetUnitY(stg_u), x -GetUnitX(stg_u))
		set x = GetUnitX(stg_u)+ 120* Cos(a)
		set y = GetUnitY(stg_u)+ 120* Sin(a)
	endif
	if IsPointInRegion(TerrainCliffRegion, x, y) then
		set a = Atan2(y -GetUnitY(stg_u), x -GetUnitX(stg_u))
		set x = GetUnitX(stg_u)+ 200* Cos(a)
		set y = GetUnitY(stg_u)+ 200* Sin(a)
	endif
	set x = CoordinateX50(x)
	set y = CoordinateY50(y)
	if (IsUnitAlly(trigUnit, LocalPlayer) and LocalPlayer!= GetOwningPlayer(trigUnit)) or(IsGameHaveObserver and(LocalPlayer== ObserverPlayer1 or LocalPlayer== ObserverPlayer2)) then
		call PingMinimapEx(x, y, 3, 255, 255, 255, false)
	endif
	set N3O = CreateUnit(GetOwningPlayer(trigUnit), NYO(id), x, y, 0)
	set N2O = CreateUnit(GetOwningPlayer(trigUnit),'h0AX', GetUnitX(trigUnit), GetUnitY(trigUnit), 0)
	set tp_ube = CreateUbersplat(GetUnitX(trigUnit)+ 25 * Cos(225 * bj_DEGTORAD), GetUnitY(trigUnit)+ 20 * Sin(225 * bj_DEGTORAD), "SCTP", 255, 255, 255, 255, false, false)
	call SetUbersplatRenderAlways(tp_ube, UnitVisibleToPlayer(trigUnit, LocalPlayer))
	if Tp_Dummy[id]	== null or IsBearUnit(trigUnit) then
		set utx = CreateUnit(Player(PLAYER_NEUTRAL_PASSIVE), GetUnitTypeId(trigUnit), x, y, jd)
		if IsBearUnit(trigUnit) == false then
			set Tp_Dummy[id] = utx
			call SuspendHeroXP(utx, true)	
		endif
		call SetUnitX(utx, x)
		call SetUnitY(utx, y)
	else
		set utx = Tp_Dummy[id]
		call ShowUnit(utx, true)
		call SetUnitX(utx, x)
		call SetUnitY(utx, y)
	endif
	if GetUnitTypeId(utx) != GetUnitTypeId(trigUnit) then
		call DzSetUnitID(utx, GetUnitTypeId(trigUnit))
	endif
	call UnitAddAbility(utx, 'Arav')
	call UnitRemoveAbility(utx, 'Arav')
	call PauseUnit(utx, true)
	call EXSetUnitFacing(utx, jd)
	call UnitRemoveAbility(utx, 'Aloc')
	call UnitAddAbility(utx, 'Aloc')
	set flyheight = GetUnitDefaultFlyHeight(trigUnit)
	if flyheight == 0.00 then
		set flyheight = flyheight + 150
	endif
	call SetUnitFlyHeight(utx, flyheight, 0.00)
	call SetUnitPathing(utx, false)
	call SetUnitVertexColor(utx, 128, 128, 128, 128)
	call SetUnitColor(utx, GetPlayerColor(GetOwningPlayer(trigUnit)))
	//set count = NWO(GetPlayerId(GetOwningPlayer(trigUnit)), x, y)
	set tp_second = 3
	//if count > 0 then
	//	set tp_second = 4.5 + .5 * count
	//endif
	call NUO(GetPlayerId(GetOwningPlayer(trigUnit)), x, y)
	//if count > 0 then
	//	call SetUnitAnimationByIndex(N2O, 2)
	//	call SetUnitAnimationByIndex(N3O, 2)
	//endif
	//tp 漂浮文字
	call TriggerRegisterTimerEvent(t, tp_second -3, false)
	call TriggerRegisterTimerEvent(t, tp_second, false)
	set tt = CreateTrigger()
	call TriggerRegisterTimerEvent(tt, .5, true)
	call TriggerRegisterTimerEvent(tt, 0, false)
	call SaveUnitHandle(HY, GetHandleId(tt), 0, trigUnit)
	call SaveReal(HY, GetHandleId(tt), 0, tp_second)
	
	//	endif
	call TriggerAddCondition(tt, Condition(function tp_texttag))
	call TriggerRegisterUnitEvent(tt, trigUnit, EVENT_UNIT_SPELL_ENDCAST)
	set tt = null
	//tp 持续施法
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterUnitEvent(t, trigUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterUnitEvent(t, stg_u, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function tp_scroll_cast))
	call A8X(GetOwningPlayer(trigUnit), tp_second, x, y, 200)
	call SaveReal(HY, h, 'jiao', jd)
	call SaveInteger(HY, h, 'miao', R2I(tp_second * 10))
	call SaveEffectHandle(HY, h,'effe', GetpEffect(trigUnit, tp_second))
	call SaveEffectHandle(HY, h, 176,(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetUnitX(trigUnit)+ 25 * Cos(225 * bj_DEGTORAD), GetUnitY(trigUnit)+ 20 * Sin(225 * bj_DEGTORAD))))
	call SaveUnitHandle(HY, h, 447,(N3O))
	call SaveUnitHandle(HY, h, 448,(N2O))
	call SaveUnitHandle(HY, h, 'Uutx', (utx))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call SaveReal(HY, h, 442,(((GetGameTime()))* 1.))
	call SaveReal(HY, h, 57,((tp_second)* 1.))
	call SaveUbersplatHandle(HY, h, 131,(tp_ube))
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call SaveInteger(HY, h, 34, 0)
	call B1X(trigUnit, ZF, x, y, 2400)
	set trigUnit = null
	set stg_u = null
	set N2O = null
	set N3O = null
	set t = null
	set tp_ube = null
	set utx = null
endfunction
function BXO takes nothing returns boolean
	local real d
	local unit u = GetFilterUnit()
	if GetWidgetLife(u)> 0 and IsUnitIdType(GetUnitTypeId(u), UNIT_TYPE_HERO) == false and GetUnitAbilityLevel(u,'Asud') == 0 and(GetUnitAbilityLevel(u,'A04R') == 0 or GetUnitTypeId(u)=='nfoh' or GetUnitTypeId(u)=='ndfl') and IsUnitAlly(u, GetOwningPlayer(MissileHitTargetUnit)) and GetOwningPlayer(u)!= NEUTRAL_PASSIVE_PLAYER and IsUnitIllusion(u) == false then
		set d = GetDistanceBetween(TJ, RJ, GetUnitX(u), GetUnitY(u))
		if d < S2 then
			set S2 = d
			set U2 = u
		endif
	endif
	set u = null
	return false
endfunction
function BOO takes nothing returns boolean
	local real d
	if UnitIsDead(GetFilterUnit()) == false and GetFilterUnit()!= GetTriggerUnit() and GetUnitAbilityLevel(GetFilterUnit(),'Asud') == 0 and(GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 or GetUnitTypeId(GetFilterUnit())=='nfoh' or GetUnitTypeId(GetFilterUnit())=='ndfl') and IsUnitAlly(GetFilterUnit(), GetOwningPlayer(MissileHitTargetUnit)) and GetOwningPlayer(GetFilterUnit())!= NEUTRAL_PASSIVE_PLAYER then
		set d = GetDistanceBetween(TJ, RJ, GetUnitX(GetFilterUnit()), GetUnitY(GetFilterUnit()))
		if d < S2 then
			set S2 = d
			set U2 = GetFilterUnit()
		endif
	endif
	return false
endfunction
function BRO takes unit whichUnit, real x, real y, boolean b returns unit
	local group g = AllocationGroup(24)
	set U2 = null
	set MissileHitTargetUnit = whichUnit
	set S2 = 99999
	set TJ = x
	set RJ = y
	if b then
		call GroupEnumUnitsInRange(g, x, y, 99999, Condition(function BOO))
	else
		call GroupEnumUnitsInRange(g, x, y, 99999, Condition(function BXO))
	endif
	call DeallocateGroup(g)
	return U2
endfunction
function boots_of_travel_recipe takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local unit stg_u = GetSpellTargetUnit()
	local real x
	local real y
	local real a
	local trigger t
	local integer h
	local ubersplat tp_ube
	local integer id = GetPlayerId(GetOwningPlayer(trigUnit))
	local integer count
	local real tp_second
	local trigger tt
	local unit utx
	local real jd
	local real flyheight
	// tp 飞鞋 漂浮文字 三秒
	set tt = CreateTrigger()
	if LocalPlayer== GetOwningPlayer(trigUnit) then
		call SelectUnit(CirclesUnit[id], true)
	endif
	call TriggerRegisterTimerEvent(tt, .5, true)
	call TriggerRegisterTimerEvent(tt, 0, false)
	call SaveUnitHandle(HY, GetHandleId(tt), 0, trigUnit)
	call SaveReal(HY, GetHandleId(tt), 0, 3)
	
	call TriggerAddCondition(tt, Condition(function tp_texttag))
	call TriggerRegisterUnitEvent(tt, trigUnit, EVENT_UNIT_SPELL_ENDCAST)
	set tt = null
	set t = CreateTrigger()
	set h = GetHandleId(t)
	if stg_u == null then
		set x = GetSpellTargetX()
		set y = GetSpellTargetY()
		if x == C9V[id]and y == DVV[id] then
			if IsSentinelPlayer(GetOwningPlayer(trigUnit)) then
				set x = GetUnitX(SentinelFountainOfLifeUnit)
				set y = GetUnitY(SentinelFountainOfLifeUnit)
				set stg_u = SentinelFountainOfLifeUnit
			else
				set x = GetUnitX(ScourgeFountainOfLifeUnit)
				set y = GetUnitY(ScourgeFountainOfLifeUnit)
				set stg_u = ScourgeFountainOfLifeUnit
			endif
		endif
		if GetSpellAbilityId()=='A3AG' then
			set stg_u = BRO(trigUnit, x, y, true)
		else
			set stg_u = BRO(trigUnit, x, y, false)
		endif
	endif
	set jd = bj_RADTODEG * Atan2(y - GetUnitY(trigUnit), x - GetUnitX(trigUnit))
	set x = GetUnitX(stg_u)
	set y = GetUnitY(stg_u)
	if (IsUnitAlly(trigUnit, LocalPlayer) and LocalPlayer!= GetOwningPlayer(trigUnit)) or(IsGameHaveObserver and(LocalPlayer== ObserverPlayer1 or LocalPlayer== ObserverPlayer2)) then
		call PingMinimapEx(x, y, 3, 255, 255, 255, false)
	endif
	set tp_ube = CreateUbersplat(GetUnitX(trigUnit)+ 25 * Cos(225 * bj_DEGTORAD), GetUnitY(trigUnit)+ 20 * Sin(225 * bj_DEGTORAD), "SCTP", 255, 255, 255, 255, false, false)
	call SetUbersplatRenderAlways(tp_ube, UnitVisibleToPlayer(trigUnit, LocalPlayer))
	if Tp_Dummy[id]	== null or IsBearUnit(trigUnit) then
		set utx = CreateUnit(Player(PLAYER_NEUTRAL_PASSIVE), GetUnitTypeId(trigUnit), x, y, jd)
		if IsBearUnit(trigUnit) == false then
			set Tp_Dummy[id] = utx
			call SuspendHeroXP(utx, true)	
		endif
		call SetUnitX(utx, x)
		call SetUnitY(utx, y)
	else
		set utx = Tp_Dummy[id]
		call ShowUnit(utx, true)
		call SetUnitX(utx, x)
		call SetUnitY(utx, y)
	endif
	if GetUnitTypeId(utx) != GetUnitTypeId(trigUnit) then
		call DzSetUnitID(utx, GetUnitTypeId(trigUnit))
	endif
	call PauseUnit(utx, true)
	call UnitRemoveAbility(utx, 'Aloc')
	call UnitAddAbility(utx, 'Aloc')
	call EXSetUnitFacing(utx, jd)
	call UnitAddAbility(utx, 'Arav')
	call UnitRemoveAbility(utx, 'Arav')
	set flyheight = GetUnitDefaultFlyHeight(trigUnit)
	if flyheight == 0 then
		set flyheight = flyheight + 150
	endif
	if IsUnitType(stg_u, UNIT_TYPE_STRUCTURE) then
		call SetUnitFlyHeight(utx, flyheight + 200, 0.00)
	else
		call SetUnitFlyHeight(utx, flyheight, 0.00)
	endif
	call SetUnitPathing(utx, false)
	call SetUnitVertexColor(utx, 128, 128, 128, 128)
	call SetUnitColor(utx, GetPlayerColor(GetOwningPlayer(trigUnit)))
	set tp_second = 3
	call UnitAddType(stg_u, UNIT_TYPE_PEON)
	// 飞鞋tp 持续施法 恒定三秒
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterUnitEvent(t, trigUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterDeathEvent(t, stg_u)
	call TriggerAddCondition(t, Condition(function tp_boots_cast))
	call SaveEffectHandle(HY, h,'effe', GetpEffect(trigUnit, tp_second))
	call A8X(GetOwningPlayer(trigUnit), tp_second, x, y, 200)
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call SaveUbersplatHandle(HY, h, 131,(tp_ube))
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call SaveUnitHandle(HY, h, 17,(stg_u))
	call SaveUnitHandle(HY, h, 'Uutx', (utx))
	call SaveInteger(HY, h, 'miao', 30)
	call SaveEffectHandle(HY, h, 175,(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTo.mdl", trigUnit, "origin")))
	call SaveEffectHandle(HY, h, 176,(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", trigUnit, "origin")))
	call SaveEffectHandle(HY, h, 177,(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTo.mdl", stg_u, "origin")))
	call B1X(trigUnit, ZF, x, y, 2400)
	set trigUnit = null
	set stg_u = null
	set t = null
	set tp_ube = null
	set utx = null
endfunction
function town_portal takes nothing returns nothing
	if GetSpellAbilityId()=='A1R5' and IsUnitMessenger(GetTriggerUnit()) == false then
		call scroll_of_town_portal()
	endif
	if GetSpellAbilityId()=='A231' or GetSpellAbilityId()=='A3AG' then
		call boots_of_travel_recipe()
	endif
endfunction
function BAO takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return i =='n00H' or i =='n00G' or i =='n00K' or i =='n00J' or i =='n00A' or i =='n006'
endfunction
function BNO takes nothing returns boolean
	if BAO(GetFilterUnit()) then
		if LoadInteger(OtherHashTable2, 0, 0) == LoadInteger(HY, GetHandleId(GetFilterUnit()), 784) then
			call KillUnit(GetFilterUnit())
		endif
	endif
	return false
endfunction
function GUE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit BBO
	local unit BCO
	local integer BDO
	local integer BFO
	local group g = AllocationGroup(25)
	local real a = GetUnitFacing(whichUnit)* bj_DEGTORAD
	local real x1 = GetUnitX(whichUnit)+ 50 * Cos(a)
	local real y1 = GetUnitY(whichUnit)+ 50 * Sin(a)
	local real x2 = GetUnitX(whichUnit)+ 50 * Cos(a)
	local real y2 = GetUnitY(whichUnit)+ 50 * Sin(a)
	local integer i = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetTriggerPlayer())],'A0A8')
	if GetSpellAbilityId()=='A0HB' then
		set BDO ='n00H'
		set BFO ='n00J'
	elseif GetSpellAbilityId()=='A0D3' then
		set BDO ='n00G'
		set BFO ='n00A'
	elseif GetSpellAbilityId()=='A0DF' then
		set BDO ='n00K'
		set BFO ='n006'
	endif
	call SaveInteger(OtherHashTable2, 0, 0, GetHandleId(whichUnit))
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(GetTriggerUnit()), Condition(function BNO))
	call DeallocateGroup(g)
	set BBO = CreateUnit(GetOwningPlayer(whichUnit), BDO, x1, y1, GetUnitFacing(whichUnit))
	call SaveInteger(HY, GetHandleId(BBO), 784, GetHandleId(whichUnit))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", BBO, "origin"))
	call UnitApplyTimedLife(BBO,'BTLF', 40)
	set BCO = CreateUnit(GetOwningPlayer(whichUnit), BFO, x2, y2, GetUnitFacing(whichUnit))
	call SaveInteger(HY, GetHandleId(BCO), 784, GetHandleId(whichUnit))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", BCO, "origin"))
	call UnitApplyTimedLife(BCO,'BTLF', 40)
	if i > 0 then
		call UnitAddPermanentAbility(BBO,'A43C')
		call UnitAddStateBonus(BBO, 20 + 10* i, UNIT_BONUS_ATTACK)
		call UnitAddStateBonus(BCO, 20 + 10* i, UNIT_BONUS_ATTACK)
	endif
	set g = null
	set BBO = null
	set BCO = null
	set whichUnit = null
endfunction
function G_E takes nothing returns nothing
	call UnitAddAbilityToTimed(GetTriggerUnit(),'A1CN', 1, 4, 0)
endfunction
function GWE takes nothing returns nothing
	local unit u = GetSpellTargetUnit()
	local integer WFV
	local integer pid = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))
	if IsSentinelPlayer(Player(pid)) then
		call UnitShareVision(u, ScourgePlayers[0], false)
		call UnitShareVision(u, ScourgePlayers[1], false)
		call UnitShareVision(u, ScourgePlayers[2], false)
		call UnitShareVision(u, ScourgePlayers[3], false)
		call UnitShareVision(u, ScourgePlayers[4], false)
		call UnitShareVision(u, ScourgePlayers[5], false)
	else
		call UnitShareVision(u, SentinelPlayers[0], false)
		call UnitShareVision(u, SentinelPlayers[1], false)
		call UnitShareVision(u, SentinelPlayers[2], false)
		call UnitShareVision(u, SentinelPlayers[3], false)
		call UnitShareVision(u, SentinelPlayers[4], false)
		call UnitShareVision(u, SentinelPlayers[5], false)
	endif
	call UnitAddAbility(u,'ACrk')
	call I8X(u)
	call SetWidgetLife(u, 99999)
	set WFV = GetHandleId(GetTriggerUnit())
	call KillUnit(LoadUnitHandle(ObjectHashTable, WFV,'ACch'))
	call SaveUnitHandle(ObjectHashTable, WFV,'ACch', u)
	if GetUnitState(u, UNIT_STATE_MAX_LIFE)< 1400 then
		call UnitAddMaxLife(u, R2I( 1400-GetUnitState(u, UNIT_STATE_MAX_LIFE)))
	endif
	set u = null
endfunction
function BGO takes integer i returns integer
	local integer level = LoadInteger(OtherHashTable, GetHandleId(GetOwningPlayer(GetTriggerUnit())),'0BKB')
	if (i =='A11F' or i =='A11E' or i =='A0S3' or i =='A11D' or i =='A11G' or i =='A11H') == false then
		return 0
	endif
	if level == 0 then
		return'A11B'
	elseif level == 9 then
		return'A11A'
	elseif level == 8 then
		return'A0S2'
	elseif level == 7 then
		return'A119'
	elseif level == 6 then
		return'A11C'
	elseif level == 5 then
		return'A118'
	endif
	return 0
endfunction
function BHO takes integer i returns integer
	local integer lv = LoadInteger(OtherHashTable, GetHandleId(GetOwningPlayer(GetTriggerUnit())),'0BKB')
	if lv == 0 then
		return 10
	else
		return lv
	endif
	return 0
endfunction

function BKO takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	//local unit dummy = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)

	local real duration = BHO(GetSpellAbilityId())


	call N1X(whichUnit, DBV, duration)
	call UnitMakeAbilityPermanent(whichUnit, true, DBV)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit), DBV, false)
	call UnitMakeAbilityPermanent(whichUnit, true,'A0S6')
	call UnitMakeAbilityPermanent(whichUnit, true,'A0S2')

	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl", whichUnit, "origin"))
	// 马甲放反魔法护盾
	//call UnitAddAbility(dummy, BGO(GetSpellAbilityId()))
	//call IssueTargetOrderById(dummy, 852186, whichUnit)
	// 驱散负面Buff
	call FKX(whichUnit, false)
	// 驱散缴械
	call FJX(whichUnit)
	// 小鸡BKB 3倍缩放
	if IsUnitMessenger(whichUnit) then
		call AddUnitModelScalePercentByDuration(whichUnit, duration, 2, 'A0S2', HTKEY_SCALE_BLACK_KING_BAR)
	else
		call AddUnitModelScalePercentByDuration(whichUnit, duration, 0.4, 'A0S2', HTKEY_SCALE_BLACK_KING_BAR)
	endif

	set whichUnit = null
	//set dummy = null
endfunction
function GYE takes nothing returns nothing
	if BGO(GetSpellAbilityId())> 0 then
		call BKO()
	endif
endfunction
function BLO takes nothing returns nothing
	if ((LoadInteger(HY,(GetHandleId((GetEnumUnit()))),(4258))) == 1) then
		call InterfaceErrorForPlayer(GetOwningPlayer(GetEnumUnit()), GetObjectName('n02M')+ " " + GetUnitName(GetEnumUnit())+ " " + GetObjectName('n02S'))
	else
		if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
			call EPX(GetEnumUnit(), 4258, 25)
		endif
		call SetWidgetLife(GetEnumUnit(), GetWidgetLife(GetEnumUnit())+ 250)
	endif
endfunction
function GZE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local group g = AllocationGroup(26)
	call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 925, Condition(function D1X))
	call ForGroup(g, function BLO)
	call DeallocateGroup(g)
	set whichUnit = null
	set g = null
endfunction
function BMO takes nothing returns nothing
	if ((LoadInteger(HY,(GetHandleId((GetEnumUnit()))),(4278))) == 1) then
		call InterfaceErrorForPlayer(GetOwningPlayer(GetEnumUnit()), GetObjectName('n02M'))
	else
		if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
			call EPX(GetEnumUnit(), 4278, 50)
		endif
		if GetUnitAbilityLevel(GetEnumUnit(),'B0BT') == 0 and GetUnitAbilityLevel(GetEnumUnit(),'B0BU') == 0 then
			call IssueTargetOrderById(DCV, 852186, GetEnumUnit())
		endif
	endif
endfunction
function BPO takes nothing returns boolean
	return IsUnitAlly(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit())
endfunction
function HFE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local group g = AllocationGroup(27)
	set DCV = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	call UnitAddAbility(DCV,'A1EV')
	call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 525, Condition(function BPO))
	call ForGroup(g, function BMO)
	call DeallocateGroup(g)
	set whichUnit = null
	set g = null
endfunction
function G0E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	if GetSpellAbilityId()=='A02W' then
		call FlushChildHashtable(PassiveAbilityCooldown, GetHandleId(u))
		//	call UnitResetCooldownEx(u)
		call UnitResetCooldownEx(u)
		call FixUnitSkillsBug(u)
	endif
endfunction
function BQO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local real IXX =(LoadReal(HY, h, 20))
	local integer id = LoadInteger(HY, h, 10)
	local integer bid
	local real damage
	if id == 'A3TP' then
		set bid = 'A4TP'
	else
		set bid = 'B031'
	endif
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED or GetUnitAbilityLevel(GetTriggerUnit(), bid) == 0 then
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, IXX)
		if IXX > 0 then
			call CommonTextTag("+" + I2S(R2I(IXX)), 1, targetUnit, .023, 255, 0, 0, 216)
		endif
	elseif GetEventDamage() > 1 then
		if GetUnitAbilityLevel(GetTriggerUnit(), 'A4TP') > 0 and EXGetEventDamageData(1) != 0 and EXGetEventDamageData(4) == 4 then
			set damage = GetEventDamage()
			set damage = damage * 0.45
			call UnitDamageTargetEx(whichUnit, targetUnit, 2, damage)
			call CommonTextTag(I2S(R2I(damage))+ "!", 1, targetUnit, .025, 100, 200, 255, 255)
		endif
		if FK then
			call SaveReal(HY, h, 20, IXX + GetEventDamage()* .3)
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function BTO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer id = LoadInteger(HY, h, 10)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 30,(targetUnit))
	call SaveInteger(HY, h, 10, id)
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Silence\\SilenceTarget.mdl", targetUnit, "overhead")))
	call SaveReal(HY, h, 20, 0)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerRegisterTimerEvent(t, 5, false)
	call TriggerAddCondition(t, Condition(function BQO))
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function BUO takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function BTO))
	call SaveInteger(HY, h, 10, GetSpellAbilityId())
	call SaveUnitHandle(HY, h, 17,(GetSpellTargetUnit()))
	call SaveUnitHandle(HY, h, 2,(GetTriggerUnit()))
	set t = null
endfunction
function G1E takes nothing returns nothing
	if (GetSpellAbilityId()=='A0FD' or GetSpellAbilityId()=='A3TP') and not UnitHasSpellShield(GetSpellTargetUnit()) then
		call BUO()
	endif
endfunction
function BWO takes unit u, real d returns boolean
	if IsUnitType(u, UNIT_TYPE_HERO) or GetUnitAbilityLevel(u,'A04R')> 0 then
		return d > 5
	endif
	return true
endfunction
function BYO takes unit u returns unit
	local group g
	if GetUnitAbilityLevel(u,'A04R') == 0 then
		return u
	endif
	set U2 = GetTriggerUnit()
	set g = AllocationGroup(28)
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 900, Condition(function DKX))
	set DDV = FirstOfGroup(g)
	call DeallocateGroup(g)
	set g = null
	return DDV
endfunction
function BZO takes nothing returns nothing
	local unit u
	if SA > 0 then
		set SA = SA -1
		set u = CreateUnit(GetOwningPlayer(TA),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0)
		call UnitAddAbility(u,'A0K6')
		call IssueTargetOrderById(u, 852587, GetEnumUnit())
		set u = null
	endif
endfunction
function B_O takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit dummyCaster
	local unit u = LoadUnitHandle(HY, h, 0)
	local group g
	if GetUnitAbilityLevel(u,'A3KI') == 0 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		set g = AllocationGroup(29)
		set u =(LoadUnitHandle(HY, h, 2))
		set dummyCaster = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0)
		call EPX(GetTriggerUnit(), 4257, 1)
		call UnitAddAbility(dummyCaster,'A0K6')
		set TA = u
		set SA = 6
		call GroupEnumUnitsInRange(g, GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 925, Condition(function DQX))
		if GetUnitDistanceEx(GetTriggerUnit(), GetEventDamageSource())< 900 then
			if IssueTargetOrderById(dummyCaster, 852587, BYO(GetEventDamageSource())) then
				set SA = 5
			endif
		endif
		call ForGroup(g, function BZO)
		call DeallocateGroup(g)
		set g = null
	endif
	set t = null
	set dummyCaster = null
	set u = null
endfunction
function B0O takes nothing returns boolean
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED or(BWO(GetEventDamageSource(), GetEventDamage()) and IsUnitEnemy(GetEventDamageSource(), GetOwningPlayer(GetTriggerUnit())) and GetRandomInt(1, 100)< 21 and LoadInteger(HY, GetHandleId(GetTriggerUnit()), 4257)!= 1) then
		call B_O()
	endif
	return false
endfunction
function G2E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	if targetUnit == null then
		set targetUnit = whichUnit
	endif
	call UnitAddAbilityToTimed(targetUnit,'A3KI', 1, 15,'B3KI')
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function B0O))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 0, targetUnit)
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function B1O takes unit R8X, unit targetUnit returns nothing
	local integer id = 0
	local integer probability = 0
	local unit dummyUnit
	if GetUnitAbilityLevel(R8X,'A0JH')> 0 then
		set id ='A0JK'
		set probability = 25
	else
		set id ='A0FK'
		set probability = 25
	endif
	if TKV(R8X, id, probability) then
		set dummyUnit = CreateUnit(GetOwningPlayer(R8X),'e00E', GetUnitX(R8X), GetUnitY(R8X), 0)
		call UnitAddAbility(dummyUnit, id)
		call IssueTargetOrderById(dummyUnit, 852119, targetUnit)
		set dummyUnit = null
	endif
endfunction
function B2O takes unit R8X, unit targetUnit, real B3O returns nothing
	local real mp = GetUnitState(targetUnit, UNIT_STATE_MANA)
	set B3O = RMinBJ(mp, B3O)
	if mp > 0 and IsUnitMagicImmune(targetUnit) == false then
		call UnitDamageTargetEx(R8X, targetUnit, 2, B3O)
		call SetUnitState(targetUnit, UNIT_STATE_MANA, mp -B3O)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Feedback\\ArcaneTowerAttack.mdl", targetUnit, "origin"))
	endif
endfunction
function B4O takes unit R8X, unit targetUnit returns nothing	//净魂之刃
	if IsUnitIllusion(R8X) and IsUnitType(R8X, UNIT_TYPE_MELEE_ATTACKER) == false then	//必须为远程、幻象
		call B2O(R8X, targetUnit, 12)	//远程12点
	else
		call B2O(R8X, targetUnit, 25)	//近战25点
	endif
endfunction
function G4E takes nothing returns nothing
	local unit B5O = GetTriggerUnit()
	local item NMO = ACX(B5O, XOV[BUV])
	if NMO == null then
		set NMO = ACX(B5O, XIV[BUV])
	endif
	if NMO != null then
		call HZX(NMO)
		call UnitRemoveAbility(B5O,'A0VR')
		call UnitAddAbility(B5O,'A0VU')
		call SetUnitState(B5O, UNIT_STATE_MANA, 400)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIem\\AIemTarget.mdl", B5O, "origin"))
	else
		call InterfaceErrorForPlayer(GetOwningPlayer(B5O), GetObjectName('n02Q'))
	endif
	set B5O = null
	set NMO = null
endfunction
function B6O takes nothing returns nothing
	call UnitRemoveAbility(GetEnumUnit(),'BVA1')
	call UnitRemoveAbility(GetEnumUnit(),'BVA2')
	call UnitRemoveAbility(GetEnumUnit(),'BVA3')
	call UnitRemoveAbility(GetEnumUnit(),'BVA4')
endfunction
function B7O takes nothing returns boolean
	return IsUnitAlly(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit())
endfunction
function B8O takes nothing returns boolean
	return (B7O() and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO))
endfunction
function B9O takes unit u, player p, boolean b returns nothing
	local group g
	call SetPlayerAbilityAvailable(p,'A1J2', b)
	call SetPlayerAbilityAvailable(p,'A1IT', b)
	call SetPlayerAbilityAvailable(p,'A1J1', b)
	call SetPlayerAbilityAvailable(p,'A1J0', b)
	call SetPlayerAbilityAvailable(p,'A1IS', b)
	call SetPlayerAbilityAvailable(p,'A34E', b)
	call SetPlayerAbilityAvailable(p,'A34F', b)
	call SetPlayerAbilityAvailable(p,'A0AH', b)
	call SetPlayerAbilityAvailable(p,'A09E', b)
	if b == false then
		call UnitRemoveAbility(u,'B03X')
	endif
	if b == false then
		call UnitRemoveAbility(u,'BOac')
	endif
	if b == false then
		call UnitRemoveAbility(u,'B01W')
	endif
	if GetUnitAbilityLevel(u,'P279')> 0 or GetUnitAbilityLevel(u,'A3BF')> 0 and IsUnitIllusion(u) == false then
		if b then
			call UnitRemoveAbility(u,'A3BF')
		else
			call UnitAddPermanentAbility(u,'A3BF')
			call SetAllPlayerAbilityUnavailable('A3BF')
		endif
	endif
	if b == false then
		call UnitRemoveAbility(u,'B00E')
	endif
	if GetUnitAbilityLevel(u,'P135')> 0 or GetUnitAbilityLevel(u,'A373')> 0 and IsUnitIllusion(u) == false then
		if b then
			call UnitRemoveAbility(u,'A374')
		else
			call UnitAddPermanentAbility(u,'A374')
			call SetAllPlayerAbilityUnavailable('A374')
		endif
	endif
	if b == false then
		call UnitRemoveAbility(u,'B07M')
	endif
	call SetPlayerAbilityAvailable(p,'P131', b)
	if GetUnitAbilityLevel(u,'P131')> 0 and IsUnitIllusion(u) == false then
		if b then
			call UnitRemoveAbility(u,'A375')
		else
			call UnitAddPermanentAbility(u,'A375')
			call SetUnitAbilityLevel(u,'A375', GetUnitAbilityLevel(u,'P131'))
		endif
	endif
	call SetPlayerAbilityAvailable(p,'A03B', b)
	call SetPlayerAbilityAvailable(p,'A0ZJ', b)
	call SetPlayerAbilityAvailable(p,'A0ZI', b)
	call SetPlayerAbilityAvailable(p,'A0ZH', b)
	call SetPlayerAbilityAvailable(p,'A0ZG', b)
	if b == false then
		call UnitRemoveAbility(u,'B09B')
		call UnitRemoveAbility(u,'B09A')
		call UnitRemoveAbility(u,'B097')
		call UnitRemoveAbility(u,'B09D')
	endif
	if b == false then
		call UnitRemoveAbility(u,'BVA1')
		call UnitRemoveAbility(u,'BVA2')
		call UnitRemoveAbility(u,'BVA3')
		call UnitRemoveAbility(u,'BVA4')
	endif
	if b == false then
		set g = AllocationGroup(30)
		set U2 = u
		call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 900, Condition(function B7O))
		call ForGroup(g, function B6O)
		call DeallocateGroup(g)
	endif
	call SetPlayerAbilityAvailable(p,'A1JT', b)
	call SetPlayerAbilityAvailable(p,'A1K6', b)
	call SetPlayerAbilityAvailable(p,'A1JU', b)
	call SetPlayerAbilityAvailable(p,'A1K7', b)
	call SetPlayerAbilityAvailable(p,'A1JV', b)
	call SetPlayerAbilityAvailable(p,'A1K8', b)
	call SetPlayerAbilityAvailable(p,'A1JC', b)
	call SetPlayerAbilityAvailable(p,'A1K9', b)
	call SetPlayerAbilityAvailable(p,'A1JF', b)
	call SetPlayerAbilityAvailable(p,'A1KB', b)
	call SetPlayerAbilityAvailable(p,'A1JG', b)
	call SetPlayerAbilityAvailable(p,'A1KC', b)
	call SetPlayerAbilityAvailable(p,'A1JH', b)
	call SetPlayerAbilityAvailable(p,'A1KD', b)
	call SetPlayerAbilityAvailable(p,'A1JI', b)
	call SetPlayerAbilityAvailable(p,'A1K5', b)
	call SetPlayerAbilityAvailable(p,'A1JJ', b)
	call SetPlayerAbilityAvailable(p,'A1KH', b)
	call SetPlayerAbilityAvailable(p,'A1JL', b)
	call SetPlayerAbilityAvailable(p,'A1K4', b)
	call SetPlayerAbilityAvailable(p,'A1JM', b)
	call SetPlayerAbilityAvailable(p,'A1KI', b)
	call SetPlayerAbilityAvailable(p,'A1JN', b)
	call SetPlayerAbilityAvailable(p,'A1KJ', b)
	call SetPlayerAbilityAvailable(p,'A1JQ', b)
	call SetPlayerAbilityAvailable(p,'A1KM', b)
	call SetPlayerAbilityAvailable(p,'A1JR', b)
	call SetPlayerAbilityAvailable(p,'A1KN', b)
	call SetPlayerAbilityAvailable(p,'A1JX', b)
	call SetPlayerAbilityAvailable(p,'A1K0', b)
	call SetPlayerAbilityAvailable(p,'A1JY', b)
	call SetPlayerAbilityAvailable(p,'A1K3', b)
endfunction
function HidePlayerBreak takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	call KillUnit(LoadUnitHandle(HY, GetHandleId(p),'brek'))
	call SaveUnitHandle(HY, GetHandleId(p),'brek', CreateUnit(p,'e00L', 0, 0, 0))
	call ShowUnit(LoadUnitHandle(HY, GetHandleId(p),'brek'), false)
	call PauseUnit(LoadUnitHandle(HY, GetHandleId(p),'brek'), true)
endfunction
function ShowPlayerBreak takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	call KillUnit(LoadUnitHandle(HY, GetHandleId(p),'brek'))
endfunction
function DisablePlayerBreak takes unit u returns nothing
	call B9O(u, GetOwningPlayer(u), true)
	call UnitRemoveAbility(u,'A36D')
	call UnitRemoveAbility(u,'B36D')
	if IsUnitType(u, UNIT_TYPE_HERO) then
		call HidePlayerBreak(u)
	endif
endfunction
function EnablePlayerBreak takes unit u returns nothing
	call B9O(u, GetOwningPlayer(u), false)
	if IsUnitType(u, UNIT_TYPE_HERO) then
		call ShowPlayerBreak(u)
	endif
endfunction
function CRO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer c = LoadInteger(HY, h, 0)
	if GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		if c <= 1 then
			call RemoveSavedHandle(HY, GetHandleId(u),'BREK')
			call FlushChildHashtable(HY, h)
			call DisableTrigger(t)
			call DestroyTrigger(t)
			call DisablePlayerBreak(u)
		else
			call SaveInteger(HY, h, 0, c -1)
		endif
	else
		call RemoveSavedHandle(HY, GetHandleId(u),'BREK')
		call FlushChildHashtable(HY, h)
		call DisableTrigger(t)
		call DestroyTrigger(t)
		call DisablePlayerBreak(u)
	endif
	set t = null
	return false
endfunction
function CIO takes unit u, real time returns nothing
	local trigger t
	local integer h
	local integer hu = GetHandleId(u)
	if HaveSavedHandle(HY, hu,'BREK') then
		set t = LoadTriggerHandle(HY, hu,'BREK')
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, time, false)
		call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 1)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, hu,'BREK', t)
		call TriggerRegisterTimerEvent(t, time, false)
		call TriggerRegisterDeathEvent(t, u)
		call SaveInteger(HY, h, 0, 1)
		call SaveUnitHandle(HY, h, 0, u)
		call UnitAddPermanentAbility(u,'A36D')
		call TriggerAddCondition(t, Condition(function CRO))
		call EnablePlayerBreak(u)
	endif
	set t = null
endfunction
function CAO takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local group CNO = DFV
	local unit whichUnit = DGV
	if IsUnitInGroup(targetUnit, CNO) == false then
		call GroupAddUnit(CNO, targetUnit)
		call IssueTargetOrderById(DHV, 852075, targetUnit)
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 200)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl", targetUnit, "origin"))
	endif
	set targetUnit = null
	set CNO = null
	set whichUnit = null
endfunction
function CBO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	local group CNO =(LoadGroupHandle(HY, h, 133))
	local real d
	local real x
	local real x0 = GetUnitX(whichUnit)
	local real y
	local real y0 = GetUnitY(whichUnit)
	local group g = AllocationGroup(31)
	local integer count = GetTriggerEvalCount(t)
	local integer i
	call SetUnitX(dummyCaster, GetUnitX(whichUnit))
	call SetUnitY(dummyCaster, GetUnitY(whichUnit))
	set DFV = CNO
	set DGV = whichUnit
	set DHV =(LoadUnitHandle(HY, h, 132))
	if GetTriggerEvalCount(t)> 33 then
		call KillUnit(dummyCaster)
		call DeallocateGroup(CNO)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set d = count * 21
		set i = 0
		loop
		exitwhen i > 36
			set x = x0 + d * Cos(360 * i / 36 * bj_DEGTORAD)
			set y = y0 + d * Sin(360 * i / 36 * bj_DEGTORAD)
			set U2 = whichUnit
			call GroupEnumUnitsInRange(g, x, y, 150, Condition(function DGX))
			call ForGroup(g, function CAO)
			set i = i + 1
		endloop
	endif
	call DeallocateGroup(g)
	set t = null
	set dummyCaster = null
	set CNO = null
	set whichUnit = null
	set g = null
	return false
endfunction
function CCO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(t), 0),'BEim')
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTimer(t)
	set t = null
endfunction
function CDO takes unit u returns nothing
	local timer t = CreateTimer()
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call TimerStart(t, 0, false, function CCO)
	set t = null
endfunction
function G3E takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local real x = GetUnitX(trigUnit)
	local real y = GetUnitY(trigUnit)
	local group CNO = AllocationGroup(32)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'h091', x, y, 0)
	local unit CFO = CreateUnit(GetOwningPlayer(trigUnit),'e00E', GetUnitX(trigUnit), GetUnitY(trigUnit), 0)
	call UnitAddAbility(CFO,'A0T0')
	call SaveGroupHandle(HY, h, 133,(CNO))
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	call SaveUnitHandle(HY, h, 132,(CFO))
	call SaveUnitHandle(HY, h, 2,(trigUnit))
	call TriggerRegisterTimerEvent(t, .06, true)
	call TriggerAddCondition(t, Condition(function CBO))
	call CDO(trigUnit)
	set t = null
	set CNO = null
	set dummyCaster = null
	set CFO = null
	set trigUnit = null
endfunction
function SetMagicCharges takes unit whichUnit, integer charges returns nothing
	local integer h = GetHandleId(whichUnit)
	call SaveInteger(HY, h, 750, charges )
endfunction
// 获取魔棒的充能
function GetMagicCharges takes unit whichUnit returns integer
	local integer h = GetHandleId(whichUnit)
	return LoadInteger( HY, h, 750 )
endfunction

function G5E takes nothing returns nothing
	// 通过当前命令Id来得知按了哪个物品 之前那个遍历所有物品太坑爹
	local unit spellUnit = GetTriggerUnit()
	local item it = null
	local integer index = 0
	local integer charges = 0
	local integer iOrder = GetUnitCurrentOrder( spellUnit )
	local integer i = iOrder - 852008 
	set it = UnitItemInSlot(spellUnit, i)
	set index = GetItemIndex(it)
	if index == Item_MagicStick or index == Item_MagicWand then
		set charges = GetItemCharges(it)
		if charges > 0 then
			call SetItemCharges(it, 0)
			call SetMagicCharges(spellUnit, 0)
			//if not CJO then
			//	set CJO = true
			call SetUnitState(spellUnit, UNIT_STATE_MANA, GetUnitState(spellUnit, UNIT_STATE_MANA)+ 15 * charges)
			call SetWidgetLife(spellUnit, GetWidgetLife(spellUnit)+ 15 * charges)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIre\\AIreTarget.mdl", spellUnit, "origin"))
			//endif
		endif
	endif
	set it = null
	set spellUnit = null

endfunction
function CKO takes integer id returns boolean
	local integer i = 1
	loop
	exitwhen i > EHV
		if id == EGV[i] then
			return false
		endif
		set i = i + 1
	endloop
	return true
endfunction
// 给单位的魔棒充能 按顺序优先 78 45 12
// MagicStick Magic Wand
function MagicStickCharges takes unit whichUnit returns nothing
	local integer i = 0
	local integer c
	local integer id
	local integer maxCharges
	local item it
	loop
		set it = UnitItemInSlot(whichUnit, i)
		set id = GetItemIndex(it)
		if id == Item_MagicStick or id == Item_MagicWand then
			if id == Item_MagicStick then
				set maxCharges = 10
			else
				set maxCharges = 17
			endif
			set c = GetItemCharges(it)
			call SetMagicCharges(whichUnit, IMinBJ(c + 1, maxCharges))
			call SetItemCharges(it, IMinBJ(c + 1, maxCharges))
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl", whichUnit, "chest"))
			set i = 5
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	set it = null
endfunction
function CMO takes nothing returns nothing
	local group g = AllocationGroup(33)
	local unit spellUnit = GetTriggerUnit()
	local unit firstUnit = null
	local real x = GetUnitX(spellUnit)
	local real y = GetUnitY(spellUnit)
	call GroupEnumUnitsInRange( g, x, y, 1225, null )
	loop
		set firstUnit = FirstOfGroup(g)
	exitwhen firstUnit == null
		call GroupRemoveUnit( g, firstUnit )
		// 英雄单位 敌人 存活 非建筑 非守卫 不是远古 但可以是熊灵 施法者对单位来是说可见的
		if UnitVisibleToPlayer( spellUnit, GetOwningPlayer(firstUnit)) and IsUnitType(firstUnit, UNIT_TYPE_HERO) and IsUnitEnemy(spellUnit, GetOwningPlayer(firstUnit)) and IsAliveNotStrucNotWard(firstUnit) and IsNotAncientOrBear(firstUnit) then
			call MagicStickCharges( firstUnit )
		endif
	endloop
	set firstUnit = null
	//call ForGroup(g, function CLO)
	call DeallocateGroup(g)
	set g = null
	set spellUnit = null
endfunction
function CPO takes nothing returns nothing
	local integer id = GetSpellAbilityId()
	// 魔棒充能
	if id != 0 and IsNotItemAbility(id) and CKO(id) and GetUnitAbilityLevel(GetTriggerUnit(),'A04R') == 0 and not LNX(id) then
		call CMO()
	endif
endfunction
function CQO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit CSO =(LoadUnitHandle(HY, h, 134))
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call UnitRemoveAbility(CSO,'A17R')
		call UnitRemoveAbility(CSO,'A24F')
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set CSO = null
	return false
endfunction
function CTO takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) and GetWidgetLife(GetFilterUnit())> .5 and IsUnitAlly(GetFilterUnit(), DJV) and GetOwningPlayer(GetFilterUnit())!= NEUTRAL_PASSIVE_PLAYER and GetUnitTypeId(GetFilterUnit())!='ncop' and GetUnitTypeId(GetFilterUnit())!='n0FJ' and GetUnitTypeId(GetFilterUnit())!='n0FI' and GetUnitTypeId(GetFilterUnit())!='n0F6' and GetUnitTypeId(GetFilterUnit())!='n0FH'))
endfunction
function CUO takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit CSO = GetEnumUnit()
	local string s
	call UnitAddAbility(CSO,'A17R')
	call UnitAddAbility(CSO,'A24F')
	if IsSentinelPlayer(DJV) then
		set s = "effects\\GlyphSent.mdx"
	else
		set s = "effects\\GlyphScourge.mdx"
	endif
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget(s, CSO, "origin")))
	call SaveUnitHandle(HY, h, 134,(CSO))
	call TriggerRegisterUnitEvent(t, CSO, EVENT_UNIT_DEATH)
	call TriggerRegisterTimerEvent(t, 4, false)
	call TriggerAddCondition(t, Condition(function CQO))
	set t = null
	set CSO = null
endfunction
function CWO takes unit u, player p returns nothing
	local integer i
	local integer x = 1
	if IsSentinelPlayer(p) then
		loop
		exitwhen x > 5
			set i = GetPlayerId(SentinelPlayers[x])
			if u != CirclesUnit[i] then
				call YDWESetUnitAbilityState(CirclesUnit[i],'A141', 1, 300)
			endif
			set x = x + 1
		endloop
	else
		loop
		exitwhen x > 5
			set i = GetPlayerId(ScourgePlayers[x])
			if u != CirclesUnit[i] then
				call YDWESetUnitAbilityState(CirclesUnit[i],'A141', 1, 300)
			endif
			set x = x + 1
		endloop
	endif
endfunction
function GlyphCoolDown_Actions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 1)
	local real cd
	set cd = YDWEGetUnitAbilityState(u, 'A141', 1)
	if IsPlayerAlly(GetOwningPlayer(u), LocalPlayer) then
		if cd > 10 then
			call DzFrameSetText(GlyphFrame, I2S(R2I(cd)))
		elseif cd == 0 then
			call DzFrameSetText(GlyphFrame, " ")
		else
			call DzFrameSetText(GlyphFrame, R2SW(cd, 1, 1))
		endif
	endif
	if cd == 0 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	return false
endfunction
function GlyphCoolDown takes unit u returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 0.2, true)
	call TriggerRegisterTimerEvent(t, 0., false)
	call TriggerAddCondition(t, Condition(function GlyphCoolDown_Actions))
	call SaveUnitHandle(HY, GetHandleId(t), 1, u)
	set t = null
endfunction
function G8E takes nothing returns nothing
	local group g
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	if (IsSentinelPlayer(p) and DKV == false) or(IsSentinelPlayer(p) == false and DLV == false) then
		set g = AllocationGroup(34)
		set DJV = p
		call GroupEnumUnitsInRange(g, 0, 0, 12000, Condition(function CTO))
		call ForGroup(g, function CUO)
		call DeallocateGroup(g)
		if IsSentinelPlayer(p) then
			set DKV = true
			call CWO(u, p)
			call GlyphCoolDown(u)
			set DKV = false
		else
			set DLV = true
			call CWO(u, p)
			call GlyphCoolDown(u)
			set DLV = false
		endif
		if (IsPlayerAlly(p, LocalPlayer) or(IsGameHaveObserver and IsObserverPlayer(LocalPlayer))) and p != LocalPlayer then
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 5, PlayersColoerText[GetPlayerId(p)] + PlayersName[GetPlayerId((p))] + "|r 开启了防御符文")
		endif
	endif
	set g = null
	set u = null
	set p = null
endfunction
function CYO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetTriggerEventId() == EVENT_UNIT_SPELL_CAST then
		call UnitRemoveAbility(GetTriggerUnit(),'A3CQ')
		call UnitRemoveAbility(GetTriggerUnit(),'A3K1')
		call UnitRemoveAbility(GetTriggerUnit(),'B09Y')
	endif
	call SetUnitPhaseMove( u, false )
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set u = null
	set t = null
	return false
endfunction
function CZO takes unit u returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_CAST)
	call TriggerRegisterTimerEvent(t, 2.5, false)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function CYO))
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SetUnitPhaseMove( u, true )
	if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
		call UnitAddAbilityToTimed(u,'A3K1', 1, 2.5,'B09Y')
	else
		call UnitAddAbilityToTimed(u,'A3CQ', 1, 2.5,'B09Y')
	endif
	set t = null
endfunction
function C_O takes unit u returns nothing
	if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
		call UZV(u,'I0T8')
	else
		call UZV(u,'I0TA')
	endif
endfunction
function G9E takes nothing returns nothing
	call CDO(GetTriggerUnit())
	if GetUnitAbilityLevel(GetTriggerUnit(),'Bpsh')> 0 then
		call UnitRemoveAbility(GetTriggerUnit(),'Bpsh')
	endif
	//if IsUnitType(GetTriggerUnit(), UNIT_TYPE_FLYING) then
	call CZO(GetTriggerUnit())
	//else
	//	call C_O(GetTriggerUnit())
	//endif
endfunction
function C0O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer c = LoadInteger(HY, GetHandleId(u),'BMON')-1
	if c == 0 then
		call RemoveSavedBoolean(HY, GetHandleId(u),'BMON')
		call RemoveSavedInteger(HY, GetHandleId(u),'BMON')
		call UnitRemoveAbility(u,'A43C')
	else
		call SaveInteger(HY, GetHandleId(u),'BMON', c)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set u = null
	set t = null
	return false
endfunction
function HVE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	call TriggerRegisterTimerEvent(t, 3.0, false)
	call TriggerAddCondition(t, Condition(function C0O))
	call UnitAddPermanentAbility(whichUnit,'A43C')
	call SaveBoolean(HY, GetHandleId(whichUnit),'BMON', true)
	call SaveInteger(HY, GetHandleId(whichUnit),'BMON', LoadInteger(HY, GetHandleId(whichUnit),'BMON')+ 1)
	call SaveUnitHandle(HY, h, 0, whichUnit)
	set t = null
	set whichUnit = null
endfunction
function C1O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit stg_u =(LoadUnitHandle(HY, h, 17))
	local real a =(LoadReal(HY, h, 137))
	local real d =(LoadReal(HY, h, 138))
	local real x = CoordinateX50(GetUnitX(stg_u)+ d / 10 * Cos(a * bj_DEGTORAD))
	local real y = CoordinateY50(GetUnitY(stg_u)+ d / 10 * Sin(a * bj_DEGTORAD))
	if GetTriggerEvalCount(t) == 11 or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl", x, y))
		if ((LoadInteger(HY,(GetHandleId((stg_u))),(4306)))!= 1) and GetUnitAbilityLevel(stg_u,'B08V') == 0 then
			call KillTreeByCircle(x, y, 150)
			if IsUnitType(stg_u, UNIT_TYPE_HERO) then
				call SaveBoolean(OtherHashTable, GetHandleId(stg_u), 99, true)
			endif
			call SetUnitX(stg_u, x)
			call SetUnitY(stg_u, y)
		endif
	endif
	set stg_u = null
	set t = null
	return false
endfunction
function C2O takes unit stg_u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x
	local real y
	local real d
	local real a
	local integer i =-1
	local boolean C3O = false
	call EPX(stg_u, 4414, 3)
	set a = GetUnitFacing(stg_u)
	loop
	exitwhen C3O or i == 23
		set x = CoordinateX50(GetUnitX(stg_u)+(600 -i * 25)* Cos(a * bj_DEGTORAD))
		set y = CoordinateY50(GetUnitY(stg_u)+(600 -i * 25)* Sin(a * bj_DEGTORAD))
		if (IsPointInRegion(TerrainCliffRegion,((x)* 1.),((y)* 1.))) == false then
			set C3O = true
		endif
		set i = i + 1
	endloop
	set d = GetDistanceBetween(x, y, GetUnitX(stg_u), GetUnitY(stg_u))
	call TriggerRegisterTimerEvent(t, .04, true)
	call TriggerRegisterDeathEvent(t, stg_u)
	call TriggerAddCondition(t, Condition(function C1O))
	call SaveUnitHandle(HY, h, 17,(stg_u))
	call SaveReal(HY, h, 137,((a)* 1.))
	call SaveReal(HY, h, 138,((d)* 1.))
	set t = null
endfunction
function C4O takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO))!= null
endfunction
function C5O takes unit u returns nothing
	local group g = AllocationGroup(35)
	set U2 = GetTriggerUnit()
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u)+ 70, 76, Condition(function C4O))
	if FirstOfGroup(g)!= null then
		call C2O(FirstOfGroup(g))
	endif
	call DeallocateGroup(g)
endfunction

function QTYUW takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit WEEUQ = LoadUnitHandle(HY, h, 0)
	local unit WWUTQ = LoadUnitHandle(HY, h, 1)
	if UnitAlive(WEEUQ) and UnitAlive(WWUTQ) then
		call IssueTargetOrderById(WEEUQ, 851983, WWUTQ)
	endif
	call PauseTimer(t)
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTimer(t)
	set WEEUQ = null
	set WWUTQ = null
	set t = null
endfunction

function QTUQW takes unit WEEUQ, unit WWUTQ returns nothing
	local integer h = TimerStartSingle(0.02, function QTYUW)
	call SaveUnitHandle(HY, h, 0, WEEUQ)
	call SaveUnitHandle(HY, h, 1, WWUTQ)
endfunction

function QTUEW takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit target = LoadUnitHandle(HY, h, 1)
	local integer hu = GetHandleId(u) 
	local integer int = LoadInteger(HY, h, 10)
	local integer id
	if LoadReal(HY, hu,'A3UC')> 0 then
		if GetTriggerEventId() == EVENT_UNIT_ACQUIRED_TARGET then
			call QTUWW(u, GetEventTargetUnit() == target)
		else
			set id = GetIssuedOrderId()
			if id == 851983 or (id == 851971 and GetOrderTargetUnit() == target)  then 
				call QTUWW(u, GetOrderTargetUnit() == target)
				set int = int + 1
				call SaveInteger(HY, h, 10, int)
			endif
		endif
	endif
	if int == 4 or GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call QTUWW(u, false)
		if GetUnitAbilityLevel(u,'A3UC')> 0 then
			call UnitRemoveAbility(u,'A3UC')
			call UnitRemoveAbility(u,'a3UC')
		endif
	endif
	set target = null
	set u = null
	set t = null
endfunction
function QTURW takes unit u, unit target returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call QTUWW(u, true)
	call SaveInteger(HY, h, 10, 0)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveUnitHandle(HY, h, 1, target)
	call TriggerRegisterTimerEvent(t, 5., false)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ACQUIRED_TARGET)
	call TriggerAddCondition(t, Condition(function QTUEW))
	set t = null
endfunction
function YRQEQ takes player p, player t returns nothing
	call SaveReal(HY, GetHandleId(t), GetPlayerId(p)+'buff', GetGameTime())
endfunction
function QTRUW takes unit u returns boolean
	return LoadBoolean(HY, GetHandleId(u), 4306) or LoadBoolean(HY, GetHandleId(u), 4307)
endfunction
function QTTQW takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WWUTQ =(LoadUnitHandle(HY, h, 17))
	local real TWQUQ =(LoadReal(HY, h, 137))
	local real RTRWQ =(LoadReal(HY, h, 138))
	local real dx
	local real dy
	local integer c = GetTriggerEvalCount(t)
	local integer hu = GetHandleId(WWUTQ)
	if c == 11 or GetTriggerEventId() == EVENT_WIDGET_DEATH or LoadInteger(HY, hu, 4260) == 1 or LoadInteger(HY, hu,'ublo') == 1 then
		call CleanCurrentTrigger(t)
	else
		if (not QTRUW(WWUTQ)) and(LoadInteger(HY, hu, 4324)!= 1) then
			//call CreateSentinelCreeps4(WWUTQ,4414,0.1)
			set dx = CoordinateX50(GetUnitX(WWUTQ)+ RTRWQ / 10. * Cos(TWQUQ * bj_DEGTORAD))
			set dy = CoordinateY50(GetUnitY(WWUTQ)+ RTRWQ / 10. * Sin(TWQUQ * bj_DEGTORAD))
			call DestroyEffect(AddSpecialEffect(LoadStr(HY, h, 12), dx, dy))
			call SetUnitX(WWUTQ, dx)
			call SetUnitY(WWUTQ, dy)
			if c == 10 then
				//call K2X(WWUTQ)
			endif
		endif
	endif
	set WWUTQ = null
	set t = null
	return false
endfunction
function QTTWW takes unit WEEUQ, unit WWUTQ, real TWRRQ, real QEEQQ, unit QTTEW returns nothing
	local trigger t
	local integer h
	local real x
	local real y
	local real RTRWQ
	local real TWQUQ
	local integer i =-1
	local boolean b = false
	local real QTTRW
	local real QTTTW
	local real dx
	local real dy
	if GetUnitAbilityLevel(WWUTQ,'A32U')!= 0 then
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	if WWUTQ == null and GetSpellTargetItem()!= null then
		set WWUTQ = WEEUQ
	endif
	if QTTEW != null then
		set TWQUQ = AngleBetweenUnit(WEEUQ, WWUTQ)
		if WEEUQ == WWUTQ then
			set TWQUQ = AngleBetweenUnit(QTTEW, WEEUQ)
		endif
	else
		set TWQUQ = GetUnitFacing(WWUTQ)
	endif
	set QTTRW = Cos(TWQUQ * bj_DEGTORAD)
	set QTTTW = Sin(TWQUQ * bj_DEGTORAD)
	set dx = GetUnitX(WWUTQ)
	set dy = GetUnitY(WWUTQ)
	set x = CoordinateX50(dx +(TWRRQ -i * 25)* QTTRW)
	set y = CoordinateY50(dy +(TWRRQ -i * 25)* QTTTW)
	if IsUnitAlly(WWUTQ, GetOwningPlayer(GetTriggerUnit())) then
		if IsUnitType(WWUTQ, UNIT_TYPE_HERO) then
			call YRQEQ(GetOwningPlayer(GetTriggerUnit()), GetOwningPlayer(WWUTQ))
		endif
	endif
	set RTRWQ = SquareRoot((x -GetUnitX(WWUTQ))*(x -GetUnitX(WWUTQ))+(y -GetUnitY(WWUTQ))*(y -GetUnitY(WWUTQ)))
	call TriggerRegisterTimerEvent(t, QEEQQ / 10., true)
	call TriggerRegisterDeathEvent(t, WWUTQ)
	call TriggerAddCondition(t, Condition(function QTTQW))
	call SaveUnitHandle(HY, h, 17,(WWUTQ))
	call SaveReal(HY, h, 137,((TWQUQ)* 1.0))
	call SaveReal(HY, h, 138,((RTRWQ)* 1.0))
	call SaveStr(HY, h, 12, "Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl")
	set WWUTQ = null
	set t = null
endfunction

//大推推 目标敌人
function QTUTW takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit WWUTQ = GetSpellTargetUnit()
	local integer h
	if GetUnitTypeId(u)!='e00E'then
		if GetUnitAbilityLevel(WWUTQ,'A32U') == 0 then
			call QTTWW(u, WWUTQ, 450., 0.2, WWUTQ)
			call QTTWW(u, u, 450., 0.2, WWUTQ)
		endif
	else
		set u = LoadUnitHandle(HY, GetHandleId(u), 0)
	endif
	set h = GetHandleId(u)
	if u != null then
		call UnitAddAbilityToTimed(u,'A3UC', 1, 5.,'a3UC')
		call SaveReal(HY, h,'A3UC', GetGameTime()+ 5.)
		if not IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
			call QTUQW(u, WWUTQ)
			call QTURW(u, WWUTQ)
		endif
		call SaveInteger(HY, h,'A3UC', 4)
		call SaveUnitHandle(HY, h,'A3UC', WWUTQ)
	endif
	set u = null
	set WWUTQ = null
endfunction

function Item_SpellEffect_ForceStaff takes nothing returns nothing
	local unit u = GetSpellTargetUnit()
	local unit whichUnit = GetTriggerUnit()
	local boolean C6O
	if GetSpellTargetItem()!= null then
		set u = whichUnit
	endif
	set C6O = R3X(GetUnitTypeId(u))
	if GetUnitTypeId(u)!='n00L' and GetUnitAbilityLevel(u,'B0FG') == 0 and LoadBoolean(HY, GetHandleId(u), 4306) == false then
		if C6O then
			call C2O(u)
		elseif GetUnitAbilityLevel(u,'A04R')> 0 and GetUnitMoveSpeed(u) == 0 then
			call C5O(u)
		elseif IsUnitEnemy(u, GetOwningPlayer(whichUnit)) then
			if UnitHasSpellShield(u) == false then
				call C2O(u)
			endif
		elseif IsUnitAlly(u, GetOwningPlayer(whichUnit)) and(LoadBoolean(HY, GetHandleId(GetOwningPlayer(u)), 139) == false or GetOwningPlayer(u) == GetOwningPlayer(whichUnit)) then
			call C2O(u)
		endif
	endif
	set u = null
	set whichUnit = null
endfunction
//大推推
function Item_SpellEffect_HurricanePike takes nothing returns nothing
	if IsUnitAlly(GetSpellTargetUnit(), GetTriggerPlayer()) or GetSpellTargetItem()!= null or GetUnitTypeId(GetSpellTargetUnit())=='n00L' then
		call Item_SpellEffect_ForceStaff() //推推棒
	elseif GetUnitAbilityLevel(GetSpellTargetUnit(),'B0BI') == 0 then
		call QTUTW()
	endif
endfunction
function HOE takes nothing returns nothing
	local unit d
	if GetSpellTargetItem()!= null then
		set d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0)
		call UnitAddAbility(d,'AIpg')
		call IssueTargetOrderById(d, 852111, GetTriggerUnit())
		call FKX(d, false)
		set d = null
	endif
endfunction
function C7O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	if (GetTriggerEvalCount(t)> 30) or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call UnitRemoveAbility(whichUnit,'A1QC')
		call UnitRemoveAbility(whichUnit,'B0CY')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set whichUnit = null
	set t = null
	return false
endfunction
function C8O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	if (GetTriggerEvalCount(t)> LoadInteger(HY, h, 2)) then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set whichUnit = null
	set t = null
	return false
endfunction
function C9O takes unit u, boolean DVO returns nothing
	local unit whichUnit = u
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer c = 40
	if DVO then
		set c = 30
	endif
	call UnitAddAbilityToTimed(whichUnit,'Aetl', 1, R2I(c / 10), 0)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'Aetl', false)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function C8O))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveInteger(HY, h, 2, c)
	set whichUnit = null
	set t = null
endfunction
function DEO takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit whichUnit = U2
	local unit targetUnit = MissileHitTargetUnit
	local real IXX =(LoadReal(HY, h, 20))
	local trigger t
	if whichUnit != targetUnit then
		call C9O(targetUnit, LoadBoolean(HY, h, 0))
		if LoadBoolean(HY, h, 0) then
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call UnitAddAbilityToTimed(targetUnit,'A1QB', 1, 4,'B0CY')
			call TriggerRegisterTimerEvent(t, .1, true)
			call TriggerRegisterDeathEvent(t, targetUnit)
			call TriggerAddCondition(t, Condition(function C7O))
			call SaveUnitHandle(HY, h, 2,(targetUnit))
			call CommonTextTag("+" + I2S(R2I(IXX)), 2, targetUnit, .027, 3, 216, 120, 216)
			call UnitDamageTargetEx(whichUnit, targetUnit, 1, IXX)
		endif
	endif
	call C9O(whichUnit, LoadBoolean(HY, h, 0))
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function DXO takes boolean b, unit targetUnit returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t2
	local integer DOO
	local integer DRO
	local real O3O
	set t2 = LaunchMissileByUnitDummy(whichUnit, targetUnit,'h0BS', "DEO", 1200, false)
	set DOO = GetHandleId(t2)
	set DRO = GetHeroMainAttributesType(whichUnit)
	if b then
		if DRO == HERO_ATTRIBUTE_INT then
			set O3O = GetHeroInt(whichUnit, true)* 2. + 75
		elseif DRO == HERO_ATTRIBUTE_AGI then
			set O3O = GetHeroAgi(whichUnit, true)* 2. + 75
		elseif DRO == HERO_ATTRIBUTE_STR then
			set O3O = GetHeroStr(whichUnit, true)* 2. + 75
		endif
		call SaveReal(HY,(DOO), 20, O3O)
	endif
	call SaveBoolean(HY, DOO, 0, b)
	set whichUnit = null
	set t2 = null
endfunction
function HKE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit t = GetSpellTargetUnit()
	local item it = GetSpellTargetItem()
	local boolean b
	if it != null then
		set t = u
	endif
	set it = null
	if GetSpellAbilityId()=='A1QD' and(UnitHasSpellShield(t) == false or IsUnitAlly(u, GetOwningPlayer(t))) and IsUnitMagicImmune(t) == false then
		call DXO(IsUnitEnemy(u, GetOwningPlayer(t)), t)
	endif
	set u = null
	set t = null
endfunction
function DIO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	if GetTriggerEvalCount(t)> 40 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif (IsUnitMagicImmune(whichUnit) and IsUnitType(whichUnit, UNIT_TYPE_HERO)) then
		call UnitRemoveAbility(whichUnit,'Aetl')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set whichUnit = null
	set t = null
	return false
endfunction
function DAO takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t
	local integer h
	if IsUnitMessenger(whichUnit) == false then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call UnitAddAbilityToTimed(whichUnit,'Aetl', 1, 4, 0)
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'Aetl', false)
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerAddCondition(t, Condition(function DIO))
		call SaveUnitHandle(HY, h, 2,(whichUnit))
	endif
	set whichUnit = null
	set t = null
endfunction
function HRE takes nothing returns nothing
	if GetSpellAbilityId()=='A1AC' and(IsUnitMagicImmune(GetTriggerUnit()) == false or IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) == false) then
		call DAO()
	endif
endfunction
function DNO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local real DBO =(LoadReal(HY, h, 529))
	local real DCO =(LoadReal(HY, h, 530))
	local real DDO = GetUnitState(whichUnit, UNIT_STATE_MANA)
	local real DFO = GetUnitState(whichUnit, UNIT_STATE_MAX_MANA)
	local real DGO =(LoadReal(HY, h, 668))
	local real DHO = GetUnitStatePercent(whichUnit, UNIT_STATE_MANA, UNIT_STATE_MAX_MANA)
	local real DJO =(DGO -DHO)/  100 
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEvalCount(t) == 20 * 10 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if DBO < 150 then
			call SetUnitState(whichUnit, UNIT_STATE_MANA, DDO -( 150-DBO -DCO))
		endif
	else
		if DJO > 0 then
			set DBO = DBO + DJO * DFO
			if DCO > 0 then
				if DJO * DFO > DCO then
					call SetUnitState(whichUnit, UNIT_STATE_MANA, DDO + DCO)
					set DCO = 0
				else
					if DCO >(DFO -DDO) then
						set DCO = DCO -(DFO -DDO)
						call SetUnitState(whichUnit, UNIT_STATE_MANA, DFO)
					else
						set DCO = DCO -DJO * DFO
						call SetUnitState(whichUnit, UNIT_STATE_MANA, DDO + DJO * DFO)
					endif
				endif
			endif
		endif
		set DGO = DHO
		call SaveReal(HY, h, 668,((DGO)* 1.))
		call SaveReal(HY, h, 529,((DBO)* 1.))
		call SaveReal(HY, h, 530,((DCO)* 1.))
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function HJE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real DKO = GetWidgetLife(whichUnit)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real DDO = GetUnitState(whichUnit, UNIT_STATE_MANA)
	if DKO > 151 then
		call SetWidgetLife(whichUnit, DKO  -150)
	else
		call SetWidgetLife(whichUnit, 1)
	endif
	call ARX("Abilities\\Spells\\Orc\\SpiritLink\\SpiritLinkZapTarget.mdl", whichUnit, "origin", 2)
	call SetUnitState(whichUnit, UNIT_STATE_MANA, DDO + 150)
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerAddCondition(t, Condition(function DNO))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveReal(HY, h, 242,((GetUnitState(whichUnit, UNIT_STATE_MANA))* 1.))
	call SaveReal(HY, h, 529,(0 * 1.))
	call SaveReal(HY, h, 668,((GetUnitStatePercent(whichUnit, UNIT_STATE_MANA, UNIT_STATE_MAX_MANA))* 1.))
	if (DDO + 150)> GetUnitState(whichUnit, UNIT_STATE_MAX_MANA) then
		call SaveReal(HY, h, 530,(((DDO + 150)-GetUnitState(whichUnit, UNIT_STATE_MAX_MANA))* 1.))
	endif
	set whichUnit = null
	set t = null
endfunction
function HIE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real x
	local real y
	if GetPlayerTeam(GetOwningPlayer(whichUnit)) == 0 then
		set x = GetRectCenterX(gg_rct_SentinelRevivalPoint)
		set y = GetRectCenterY(gg_rct_SentinelRevivalPoint)
	else
		set x = GetRectCenterX(gg_rct_ScourgeRevivalPoint)
		set y = GetRectCenterY(gg_rct_ScourgeRevivalPoint)
	endif
	call USV(whichUnit, 851986, x, y)
	call UPV(whichUnit, "回家")
	set whichUnit = null
endfunction
function HNE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real x
	local real y
	if GetPlayerTeam(GetOwningPlayer(whichUnit)) == 0 then
		set x =-4533
		set y = 1158
	else
		set x = 3190
		set y =-35
	endif
	call USV(whichUnit, 851986, x, y)
	call UPV(whichUnit, "前往神秘商店")
	set whichUnit = null
endfunction
function DLO takes nothing returns nothing//分身斧分身技能
	local unit u = GetTriggerUnit()
	call SaveBoolean(HY,(GetHandleId(u)), 129,(true))
	set u = null
endfunction
function HGE takes nothing returns nothing
	if (GetSpellAbilityId()=='A0B8' or GetSpellAbilityId()=='A1WE') and UnitHasSpellShield(GetTriggerUnit()) then
		call DLO()
	endif
endfunction
function DMO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or(GetTriggerEventId() == EVENT_UNIT_DAMAGED and(IsSoldierTypeId(GetUnitTypeId(GetEventDamageSource())) == false and(GetOwningPlayer(GetEventDamageSource())!= NeutralCreepPlayer) and GetEventDamage()> 0) or DMV) then
		call UnitRemoveAbility(targetUnit,'B0CG')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function DPO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	local integer c = LoadInteger(HY, h, 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or c == 0 then
		call UnitRemoveAbility(targetUnit,'A3B2')
		call UnitRemoveAbility(targetUnit,'B3B2')
		call RemoveSavedHandle(HY, GetHandleId(targetUnit),'EURN')
		call DestroyTrigger(t)
		call FlushChildHashtable(HY, h)
	else
		call SaveInteger(HY, h, 0, c -1)
		call UnitDamageTargetEx(SQX(whichUnit), targetUnit, 3, 150. / 8.)
	endif
	set whichUnit = null
	set targetUnit = null
	set t = null
	return false
endfunction
function DQO takes unit Q4X, unit to returns nothing
	local trigger t
	local integer h
	if HaveSavedHandle(HY, GetHandleId(to),'EURN') then
		set t = LoadTriggerHandle(HY, GetHandleId(to),'EURN')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, GetHandleId(to),'EURN', t)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerRegisterDeathEvent(t, to)
		call TriggerAddCondition(t, Condition(function DPO))
		call SaveUnitHandle(HY, h, 1, to)
	endif
	call SaveUnitHandle(HY, h, 0, Q4X)
	call SaveInteger(HY, h, 0, 8)
	call UnitAddPermanentAbility(to,'A3B2')
	set t = null
endfunction
function HHE takes nothing returns nothing
	local trigger t
	local integer h
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local unit dummyCaster
	local integer i = 0
	local boolean b = false
	local boolean C3O = false
	local integer HUX
	if targetUnit == null then
		set targetUnit = GetTriggerUnit()
	endif
	set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	loop
	exitwhen i > 5 or C3O
		if GetItemIndex(UnitItemInSlot(whichUnit, i)) == NUV then
			set HUX = GetItemCharges(UnitItemInSlot(whichUnit, i))
			if HUX > 0 then
				set b = true
				set HUX = HUX -1
			else
				set C3O = true
				set b = false
			endif
		endif
		set i = i + 1
	endloop
	if b then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		if IsUnitAlly(targetUnit, GetOwningPlayer(whichUnit)) then
			if GetUnitAbilityLevel(targetUnit,'B0CG') == 0 then
				call UnitAddAbility(dummyCaster,'A1MM')
				call IssueTargetOrderById(dummyCaster, 852609, targetUnit)
				call O0O(400, 0, 8,'B0CG', targetUnit)
			endif
			call SaveUnitHandle(HY, h, 17, targetUnit)
			call TriggerRegisterTimerEvent(t, 8, false)
			call TriggerRegisterDeathEvent(t, targetUnit)
			call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
			call TriggerAddCondition(t, Condition(function DMO))
		else
			call DQO(whichUnit, targetUnit)
		endif
	endif
	set whichUnit = null
	set dummyCaster = null
	set targetUnit = null
	set t = null
endfunction
function H5E takes nothing returns nothing
	local unit u = GetSpellTargetUnit()
	local integer i
	set bj_playerIsCrippled[0]= false
	if IsUnitType(u, UNIT_TYPE_HERO) and HeroIsDummyUnit(u) == false and GetUnitAbilityLevel(u,'A3E7') == 0 then
		call UnitAddPermanentAbility(u,'A3E7')
		call HDX(u, false)
		set i = 0
		loop
		exitwhen i > 5
			if HFX(UnitItemInSlot(u, i)) and IsItemPawnable(UnitItemInSlot(u, i)) == false then
				call SetItemDroppable(UnitItemInSlot(u, i), true)
			endif
			set i = i + 1
		endloop
		set XX[GetPlayerId(GetOwningPlayer(u))]= XX[GetPlayerId(GetOwningPlayer(u))] + TEX(XOV[XFV])
		if GetOwningPlayer(u)!= GetOwningPlayer(GetTriggerUnit()) then
			set XX[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]= XX[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))] + TEX(XOV[XFV])
		endif
		set GR[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]= true
		set GR[GetPlayerId(GetOwningPlayer(u))]= true
		call SetHeroStr(u, GetHeroStr(u, false)+ 10, true)
		call SetHeroInt(u, GetHeroInt(u, false)+ 10, true)
		call SetHeroAgi(u, GetHeroAgi(u, false)+ 10, true)
		call UnitAddPermanentAbility(u,'A3I2')
		call UnitAddPermanentAbility(u,'A3I3')
		set bj_playerIsCrippled[0]= true
	endif
	set u = null
endfunction
function DSO takes nothing returns nothing
	call CNX(GetEnumUnit(),'A1ZY', 1, 6,'B0DX')
endfunction
function HTE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local integer i = 0
	local boolean b = false
	local boolean C3O = false
	local integer HUX
	local group g = AllocationGroup(36)
	call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 925, Condition(function D0X))
	call ForGroup(g, function DSO)
	call DeallocateGroup(g)
	set g = null
	set whichUnit = null
endfunction
function DTO takes unit u returns boolean
	local integer unitTypeId = GetUnitTypeId(u)
	return unitTypeId =='H0B8'
endfunction
function DUO takes nothing returns boolean
	return((IsUnitEnemy(GetFilterUnit(), DQV) and CZX(GetUnitTypeId(GetFilterUnit())) == false and UnitIsDead(GetFilterUnit()) == false and(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO)) and DTO(GetFilterUnit()) == false))
endfunction
function DWO takes unit whichUnit returns boolean
	local group g = AllocationGroup(37)
	local boolean b
	set DQV = GetOwningPlayer(whichUnit)
	call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 1050, Condition(function DUO))
	set b = FirstOfGroup(g)!= null
	call DeallocateGroup(g)
	set g = null
	return b
endfunction
function DYO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local group g
	local integer count
	local boolean DZO
	if GetTriggerEventId() == EVENT_PLAYER_UNIT_ATTACKED then
		if GetAttacker() == whichUnit then
			call UnitRemoveAbility(whichUnit,'A20L')
			call UnitRemoveAbility(whichUnit,'A20S')
			call UnitRemoveAbility(whichUnit,'B0E2')
			call UnitRemoveAbility(whichUnit,'B09Y')
			if ((LoadInteger(HY,(GetHandleId((whichUnit))),(4302))) == 1) == false then
				call UnitSetUsesAltIcon(whichUnit, false)
			endif
			call DestroyEffect((LoadEffectHandle(HY, h, 32)))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	else
		set DZO =(LoadBoolean(HY, h, 671))
		set count =(LoadInteger(HY, h, 34))
		set count = count + 1
		call SaveInteger(HY, h, 34,(count))
		set g = AllocationGroup(38)
		set DQV = GetOwningPlayer(whichUnit)
		call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 1050, Condition(function DUO))
		if GetUnitAbilityLevel(whichUnit,'B09Y')> 0 then
			call SaveBoolean(HY, h, 671,(true))
		elseif DZO then
			call SaveBoolean(HY, h, 671,(false))
			call UnitRemoveAbility(whichUnit,'A20L')
			call UnitAddPermanentAbility(whichUnit,'A20L')
		endif
		if count > 350 or FirstOfGroup(g)!= null then
			call UnitRemoveAbility(whichUnit,'A20L')
			call UnitRemoveAbility(whichUnit,'A20S')
			call UnitRemoveAbility(whichUnit,'B0E2')
			call UnitRemoveAbility(whichUnit,'B09Y')
			if ((LoadInteger(HY, GetHandleId(whichUnit), 4302))!= 1) then
				call UnitSetUsesAltIcon(whichUnit, false)
			endif
			call DestroyEffect(LoadEffectHandle(HY, h, 32))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
		call DeallocateGroup(g)
	endif
	set t = null
	set whichUnit = null
	set g = null
	return false
endfunction
function D_O takes nothing returns nothing
	local unit whichUnit = GetEnumUnit()
	local trigger t = null
	local integer h
	if XFX(GetOwningPlayer(whichUnit)) and DWO(whichUnit) == false then
		if IsPlayerAlly(LocalPlayer, GetOwningPlayer(whichUnit)) == false and IsObserverPlayer(LocalPlayer) == false then
			call UnitSetUsesAltIcon(whichUnit, true)
		endif
		call L6X(whichUnit)
		call UnitAddPermanentAbility(whichUnit,'A20L')
		call UnitMakeAbilityPermanent(whichUnit, true,'A20L')
		if DVX(whichUnit) == false then
			call UnitAddPermanentAbility(whichUnit,'A20S')
			call UnitMakeAbilityPermanent(whichUnit, true,'A20S')
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A20S', false)
		endif
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveInteger(HY, h, 34, 0)
		call SaveUnitHandle(HY, h, 2,(whichUnit))
		call SaveBoolean(HY, h, 671,(false))
		call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\SmokeOfDeceit.mdx", whichUnit, "chest")))
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerAddCondition(t, Condition(function DYO))
		set t = null
	endif
	set whichUnit = null
endfunction
function HUE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local group g = AllocationGroup(39)
	call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 1225, Condition(function D_X))
	call ForGroup(g, function D_O)
	call DeallocateGroup(g)
	set whichUnit = null
	set g = null
endfunction
function D0O takes nothing returns nothing
	call CNX(GetEnumUnit(),'A28E', 1, 20, 0)
	call CNX(GetEnumUnit(),'A28G', 1, 20,'B0EQ')
endfunction
function HWE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local group g = AllocationGroup(40)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	call SetAllPlayerAbilityUnavailable('A28E')
	call GroupEnumUnitsInRange(g, x, y, 625, Condition(function DDX))
	call ForGroup(g, function D0O)
	call DeallocateGroup(g)
	call DestroyEffect(AddSpecialEffect("war3mapImported\\DarkLightningNova.mdx", x, y))
	set whichUnit = null
	set g = null
endfunction
function D1O takes nothing returns nothing
	if IsUnitEnemy(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) then
		call UnitDamageTargetEx(GetTriggerUnit(), GetSpellTargetUnit(), 2, 500)
	endif
endfunction
function H9E takes nothing returns nothing
	if (GetUnitTypeId(GetSpellTargetUnit())=='o004' or GetUnitTypeId(GetSpellTargetUnit())=='oeye' or RMX(GetSpellTargetUnit())) then
		call D1O()
	endif
endfunction


function ItemRodOfAtosOnMissileHit takes nothing returns nothing
	local unit whichUnit  = U2
	local unit targetUnit  = MissileHitTargetUnit
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	
	if UnitAlive(targetUnit) then
		call UnitAddAbility(dummyCaster,'A2K3')
		call IssueTargetOrderById(dummyCaster, 852171, targetUnit)
	endif

	set whichUnit  = null
	set targetUnit  = null
	set dummyCaster = null
endfunction

function ItemRodOfAtosOnMissileLaunch takes nothing returns nothing
	local unit whichUnit  = GetTriggerUnit()
	local unit targetUnit  = GetSpellTargetUnit()
	local integer h
	set h = GetHandleId(LaunchMissileByUnitDummy(whichUnit, targetUnit, 'h999', "ItemRodOfAtosOnMissileHit", 1900, true))
	if h > 0 then
		set whichUnit = LoadUnitHandle(HY, h, 45)
		call MHUnit_SetModel(whichUnit, "Abilities\\Spells\\Undead\\DevourMagic\\DevourMagicBirthMissile.mdl", false)
		call SetUnitScale(whichUnit, 3., 3., 3.)
	endif
	//call EnableAttackEffectByTime(18, 8)
	set whichUnit = null
	set targetUnit = null
endfunction
function GFE takes nothing returns nothing
	call EnableAttackEffectByTime(19, 20)
endfunction
function ItemRodOfAtosOnSpellEffect takes nothing returns nothing
	if GetSpellAbilityId()=='A2EA' and not UnitHasSpellShield(GetSpellTargetUnit()) then
		call ItemRodOfAtosOnMissileLaunch()
	endif
endfunction
function D3O takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit()))!= null
endfunction
function D4O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	if GetUnitAbilityLevel(u,'Bdet') == 0 or LoadReal(HY, GetHandleId(u),'AItb')+ 12 < GetGameTime() then
		call UnitRemoveAbility(u,'A2SJ')
		call UnitRemoveAbility(u,'B0GR')
		call UnitRemoveAbility(u,'Bdet')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if IsUnitInvision(u) then
			if GetUnitAbilityLevel(u,'B0GR') == 0 then
				call UnitAddPermanentAbility(u,'A2SJ')
			endif
		else
			if GetUnitAbilityLevel(u,'B0GR')> 0 then
				call UnitRemoveAbility(u,'A2SJ')
				call UnitRemoveAbility(u,'B0GR')
			endif
		endif
	endif
	set u = null
	set t = null
	return false
endfunction
function D5O takes nothing returns nothing
	local unit u = GetEnumUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function D4O))
	call SaveReal(HY, GetHandleId(u),'AItb', GetGameTime())
	call SaveUnitHandle(HY, h, 2,(u))
	set t = null
	set u = null
endfunction
function H8E takes nothing returns nothing // 撒粉
	local group g = AllocationGroup(41)
	local unit u = GetTriggerUnit()
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 1075, Condition(function D3O))
	call ForGroup(g, function D5O)
	call DeallocateGroup(g)
	set g = null
	set u = null
endfunction
function D6O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	call SetItemCharges(GetItemOfTypeFromUnit(u, XOV[NIV]), GetItemCharges(GetItemOfTypeFromUnit(u, XOV[NIV]))+ 1)
	call FlushChildHashtable(HY, h)
	call SaveBoolean(HY, GetHandleId(u),'suic', true)
	call CleanCurrentTrigger(t)
	call KillUnit(u)
	set u = null
	set t = null
	return false
endfunction
function H7E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2,(u))
	call TriggerAddCondition(t, Condition(function D6O))
	call TriggerRegisterTimerEvent(t, .01, false)
	set t = null
	set u = null
endfunction
function GGE takes nothing returns nothing
	local unit u = GetSpellTargetUnit()
	if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
		call UnitAddAbilityToTimed(u,'C033', 1, 3,'D033')
		call UnitAddAbilityToTimed(u,'A3KC', 1, 3, 0)
	else
		call UnitAddAbilityToTimed(u,'C033', 1, 4.5,'D033')
		call UnitAddAbilityToTimed(u,'A3KC', 1, 4.5, 0)
	endif
	set u = null
endfunction

function SpellEffect__Bloodlust takes nothing returns nothing
	local unit spellUnit = GetSpellAbilityUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(spellUnit, GetSpellAbilityId())
	local real dur = 30
	local real scale = 0.05 + 0.05 * level

	call AddUnitModelScalePercentByDuration(targetUnit, dur, scale, 'Bblo', HTKEY_SCALE_BLOODLUST_TRIGGER)
	
	set spellUnit = null
	set targetUnit = null
endfunction

function SpellEffect__Rabid takes nothing returns nothing
	local unit spellUnit = GetSpellAbilityUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(spellUnit, GetSpellAbilityId())
	local real dur = 50
	local real scale = 0.2 + 0.1 * level

	call AddUnitModelScalePercentByDuration(targetUnit, dur, scale, 'B016', HTKEY_SCALE_RABID_TRIGGER)
	
	set spellUnit = null
	set targetUnit = null
endfunction

function H4E takes nothing returns nothing
	local integer D7O = 0
	if GetSpellAbilityId()=='A02O' then
		set D7O = 1
	elseif GetSpellAbilityId()=='A08Y' then
		set D7O = 2
	elseif GetSpellAbilityId()=='A08Z' then
		set D7O = 3
	elseif GetSpellAbilityId()=='A090' then
		set D7O = 4
	elseif GetSpellAbilityId()=='A092' then
		set D7O = 5
	endif
	if D7O > 0 then
		if not UnitHasSpellShield(GetSpellTargetUnit()) then
			call UnitDamageTargetEx(GetTriggerUnit(), GetSpellTargetUnit(), 1, 300 + 100 * D7O)
		else
			call UnitRemoveSpellShield(GetSpellTargetUnit())
		endif
	endif
endfunction
function H2E takes nothing returns nothing
	if GetSpellAbilityId()=='A2HQ' then
		call TLX(GetTriggerUnit(), GetSpellTargetUnit())
	endif
endfunction
function D8O takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local item it
	local unit u = LoadUnitHandle(HY, h, 0)
	call DisableTrigger(CUV)
	set it = CreateItem('I0HM', GetUnitX(u), GetUnitY(u))
	call UnitAddItem(u, it)
	if GetWidgetLife(it)> 0 then
		call RemoveItem(it)
	endif
	set it = null
	call EnableTrigger(CUV)
	call PauseTimer(t)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction
function D9O takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetUnitAbilityLevel(u,'B0BI') == 0 or GetTriggerEvalCount(t)> 160 or GetTriggerEventId() == EVENT_UNIT_DEATH then
		call UnitRemoveAbility(u,'B0BI')
		call DestroyEffect(LoadEffectHandle(HY, h, 1))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
endfunction
function FVO takes unit u, boolean b returns nothing
	local trigger t
	local item it
	if IsUnitIllusion(u) == false then
		if b then
			call AGO(GetTriggerUnit())
			call UnitRemoveAbility(GetTriggerUnit(),'B0BI')
		endif
		call DisableTrigger(CUV)
		set it = CreateItem('I0HM', GetUnitX(u), GetUnitY(u))
		if UnitAddItem(u, it) and GetWidgetLife(it)<= 0 then
			set t = CreateTrigger()
			call TriggerRegisterTimerEvent(t, .1, true)
			call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
			call TriggerAddCondition(t, Condition(function D9O))
			call SaveEffectHandle(HY, GetHandleId(t), 1, AddSpecialEffectTarget("war3mapImported\\Linkens_Main.mdx", u, "chest"))
			call SaveUnitHandle(HY, GetHandleId(t), 0, u)
		else
			call RemoveItem(it)
		endif
		call EnableTrigger(CUV)
	endif
	set it = null
	set t = null
endfunction
function VDE takes nothing returns nothing
	call FVO(GetSpellTargetUnit(), true)
endfunction
function FXO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	call UnitRemoveAbility(whichUnit,'A1ZJ')
	call UnitRemoveAbility(targetUnit, LoadInteger(HY, h, 0))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function HSE takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	call TimerStart(t, 7, false, function FXO)
	call SaveUnitHandle(HY, h, 2, u)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call UnitAddPermanentAbility(u,'A1ZJ')
	if IsUnitEnemy(u, GetOwningPlayer(targetUnit)) then
		call UnitAddPermanentAbility(targetUnit,'A1ZJ')
		call SaveInteger(HY, h, 0,'A1ZJ')
		if targetUnit == Roshan then
			call SetUnitAbilityLevel(targetUnit,'A1ZJ', 2)
		endif
	else
		call UnitAddPermanentAbility(targetUnit,'A44N')
		call SaveInteger(HY, h, 0,'A44N')
	endif
	set t = null
	set u = null
	set targetUnit = null
endfunction
function FOO takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	if GetSpellAbilityId()=='AIpl' then
		call UnitAddAbility(dummyCaster,'A1WA')
	elseif GetSpellAbilityId()=='AIpr' then
		call UnitAddAbility(dummyCaster,'AIpr')
	endif
	call IssueTargetOrderById(dummyCaster, 852609, whichUnit)
	set whichUnit = null
	set dummyCaster = null
endfunction
function FRO takes nothing returns nothing
	if GetSpellAbilityId()=='AIpl' or GetSpellAbilityId()=='AIpr' or GetSpellAbilityId()=='A1WA' then
		if GetSpellTargetItem()!= null then
			call FOO()
		else
			if (GetUnitAbilityLevel(GetSpellTargetUnit(),'BIrm') == 0 and GetSpellAbilityId()!='AIpr') then
				call O0O(0, 150, 30,'BIrm', GetSpellTargetUnit())
			elseif (GetUnitAbilityLevel(GetSpellTargetUnit(),'B02Z') == 0 and GetSpellAbilityId()=='AIpr') then
				call O0O(400, 0, 8,'B02Z', GetSpellTargetUnit())
			endif
		endif
	elseif GetSpellAbilityId()=='A0FO' and GetUnitAbilityLevel(GetTriggerUnit(),'B04A') == 0 then
		call O0O(110, 70, 3,'B04A', GetTriggerUnit())
	endif
endfunction
function FIO takes unit trigUnit, integer FAO returns nothing
	local integer FNO
	local item it
	if FAO =='o004' then
		set FNO = XOV[R2V]
	else
		set FNO = XOV[R3V]
	endif
	call DisableTrigger(CUV)
	set it = GetItemOfTypeFromUnit(trigUnit, FNO)
	if it == null then
		set E3 = GetOwningPlayer(trigUnit)
		set Z2 = CreateItem(FNO, 0, 0)
		call UnitAddItem(trigUnit, Z2)
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
	else
		call SetItemCharges(it, GetItemCharges(it)+ 1)
	endif
	call EnableTrigger(CUV)
	set it = null
endfunction
function GHE takes nothing returns nothing
	local integer id = GetSpellAbilityId()
	local unit d
	local unit whichUnit
	local real x
	local real y
	local item it
	local integer FBO
	local integer FCO
	local integer SQV
	local real SYV = 0
	if id =='A02X' or id =='AIsw' then
		if id =='A02X' then
			set FBO ='o004'
			set FCO ='A33D'
			set SYV = 420
			set SQV = R2V
		else
			set FBO ='oeye'
			set FCO ='A33E'
			set SYV = 240
			set SQV = R3V
		endif
		set whichUnit = GetTriggerUnit()
		set x = GetSpellTargetX()
		set y = GetSpellTargetY()
		if GetSpellTargetUnit() == null then
			if IsPointInRegion(FLV, x, y) then
				call FIO(whichUnit, FBO)
			else
				set d = CreateUnit(GetOwningPlayer(whichUnit), FBO, x, y, 0)
				call SetUnitPathing(d, false)
				call SetUnitPosition(d, x, y)
				call UnitAddAbility(d,'A0XB')
				call UnitApplyTimedLife(d,'BTFL', SYV)
				set d = null
			endif
		else
			set d = GetSpellTargetUnit()
			set it = GetItemOfTypeFromUnit(d, SQV)
			if it != null then
				call SetItemCharges(it, GetItemCharges(it)+ 1)
			elseif H_X(d)> 0 then
				set it = CreateItem(XOV[SQV], 0, 0)
				call SetItemCharges(it, 1)
				call UnitAddItem(d, it)
			else
				call DisplayTimedTextToPlayer(GetOwningPlayer(whichUnit), 0, 0, 5, "目标背包已满")
				call FIO(whichUnit, FBO)
			endif
			set it = null
		endif
	endif
	set whichUnit = null
	set d = null
endfunction
function FDO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 34))
	if (GetTriggerEventId() == EVENT_UNIT_DEATH and GetKillingUnit() == whichUnit) or(GetTriggerEventId() == EVENT_UNIT_DAMAGED and GetUnitAbilityLevel(targetUnit,'B0ES')> 0) then
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl", GetUnitX(targetUnit), GetUnitY(targetUnit)))
		if (IsUnitType(whichUnit, UNIT_TYPE_HERO)) then
			call AddHeroXPSimple(whichUnit, R2I(LoadInteger(SightDataHashTable, GetUnitTypeId(targetUnit), HC)* 2.5), true)
		else
			call AddHeroXPSimple(Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))], R2I(LoadInteger(SightDataHashTable, GetUnitTypeId(targetUnit), HC)* 2.5), true)
		endif
		call BMX(GetOwningPlayer(whichUnit), targetUnit, 190)
		set PlayersReliableGold[GetPlayerId(GetOwningPlayer(whichUnit))]= PlayersReliableGold[GetPlayerId(GetOwningPlayer(whichUnit))] + 190
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(targetUnit)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function HQE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitLevel(targetUnit)
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 34,(level))
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function FDO))
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function FFO takes nothing returns nothing
	call SetUnitState(GetEnumUnit(), UNIT_STATE_MANA, GetUnitState(GetEnumUnit(), UNIT_STATE_MANA)+ 135)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", GetEnumUnit(), "origin"))
endfunction
function FGO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local group g = AllocationGroup(42)
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 25 + 900, Condition(function D2X))
	call ForGroup(g, function FFO)
	call DeallocateGroup(g)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set g = null
	set whichUnit = null
	set t = null
	return false
endfunction
function HPE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t
	if GetSpellAbilityId()=='A0K7' then
		if GetUnitTypeId(whichUnit)!='H00J' then
			set t = CreateTrigger()
			call TriggerRegisterTimerEvent(t, 0, false)
			call TriggerAddCondition(t, Condition(function FGO))
			call SaveUnitHandle(HY,(GetHandleId(t)), 2,(whichUnit))
			set t = null
		elseif GetUnitTypeId(whichUnit)=='H00J' then
			call SetUnitState(whichUnit, UNIT_STATE_MANA, GetUnitState(whichUnit, UNIT_STATE_MANA)+ 25)
		endif
	endif
	set whichUnit = null
endfunction
function FHO takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		call UnitDamageTargetEx(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1), 1, 50)
	endif
	call DestroyTrigger(t)
	call FlushChildHashtable(HY, h)
	set t = null
endfunction
function FJO takes unit targetUnit, unit dummyUnit returns boolean
	if IssueTargetOrderById(dummyUnit, 852144, targetUnit) then
		// debug call SingleDebug("cyclone")
		return true
	elseif IssueTargetOrderById(dummyUnit, 852227, targetUnit) then
		// debug call SingleDebug("sleep")
		return true
	else
		call UnitShareVision(targetUnit, GetOwningPlayer(dummyUnit), true)
		if IssueTargetOrderById(dummyUnit, 852144, targetUnit) then
			// debug call SingleDebug("cyclone")
			call UnitShareVision(targetUnit, GetOwningPlayer(dummyUnit), false)
			return true
		elseif IssueTargetOrderById(dummyUnit, 852227, targetUnit) then
			// debug call SingleDebug("sleep")
			call UnitShareVision(targetUnit, GetOwningPlayer(dummyUnit), false)
			return true
		endif
		call UnitShareVision(targetUnit, GetOwningPlayer(dummyUnit), false)
	endif
	// debug call SingleDebug("none")
	return false
endfunction
function HME takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local unit dummyCaster
	local trigger t
	if GetSpellTargetItem()!= null then
		set targetUnit = GetTriggerUnit()
	endif
	if not UnitHasSpellShield(GetSpellTargetUnit()) or IsPlayerAlly(GetOwningPlayer(whichUnit), GetOwningPlayer(targetUnit)) then
		set dummyCaster = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitAddAbility(dummyCaster,'A13V')
		call UnitAddAbility(dummyCaster,'A3G5')
		call SaveUnitHandle(HY, GetHandleId(dummyCaster), 0, whichUnit)
		if FJO(targetUnit, dummyCaster) and IsPlayerEnemy(GetOwningPlayer(whichUnit), GetOwningPlayer(targetUnit)) then
			set t = CreateTrigger()
			call TriggerRegisterTimerEvent(t, 2.51, false)
			call TriggerRegisterDeathEvent(t, targetUnit)
			call TriggerAddCondition(t, Condition(function FHO))
			call SaveUnitHandle(HY, GetHandleId(t), 0, dummyCaster)
			call SaveUnitHandle(HY, GetHandleId(t), 1, targetUnit)
			set t = null
		endif
	endif
	set whichUnit = null
	set targetUnit = null
	set dummyCaster = null
endfunction
function FKO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call SetUnitNoLimitMoveSpeed(LoadUnitHandle(HY, h, 0), 0)
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
endfunction
function FLO takes unit u returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, u)
	call SetUnitNoLimitMoveSpeed(u, 800)
	call TimerStart(t, 4., false, function FKO)
	set t = null
endfunction
function JVE takes nothing returns nothing
	call FLO(GetTriggerUnit())
endfunction
function AbyssalBlade_Overwhelm takes nothing returns nothing
	// 大晕锤
	if GetSpellAbilityId()=='A2K7' and not UnitHasSpellShield(GetSpellTargetUnit()) then
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\LevelerStunFX.mdx", GetSpellTargetUnit(), "head"))
	endif
endfunction
function FMO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	local integer i = GetUnitTypeId(u)
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTimer(t)
	if i !='ncop' then
		call UnitResetCooldownEx(u)
		call SetUnitState(u, UNIT_STATE_MANA, 999999)
	endif
	set u = null
	set t = null
endfunction
function FPO takes nothing returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, 0, false, function FMO)
	call SaveUnitHandle(HY, GetHandleId(t), 0, GetTriggerUnit())
	set t = null
endfunction
function UnitDodgeMissile takes unit u returns nothing
	local boolean array b
	local player p
	local integer i = 1
	loop
		if IsUnitSelected(u, Player(i)) then
			set b[i]= true
		else
			set b[i]= false
		endif
		set i = i + 1
	exitwhen i > 12
	endloop
	call ShowUnit(u, false)
	call ShowUnit(u, true)
	set i = 1
	loop
		if b[i] then
			call SelectUnitAddForPlayer(u, Player(i))
		endif
		set i = i + 1
	exitwhen i > 12
	endloop
endfunction
function FSO takes nothing returns boolean
	local integer id = GetSpellAbilityId()
	// 如果是变身技能就返回
	if IsSpellingMorph() then
		return false
	endif
	if WTF__Status then
		call FPO()
	endif
	call FRO()

	// 12 = OnSpellEffect
	if HaveSavedString(ObjectHashTable, id, 12) then
		call ExecuteFunc(LoadStr(ObjectHashTable, id, 12))
	endif

	if GetUnitTypeId(GetTriggerUnit())=='e00E' then
		return false
	endif
	// 魔棒
	call CPO()

	return false
endfunction
function FTO takes unit u returns nothing
	call SetWidgetLife(u, GetUnitState(u, UNIT_STATE_MAX_LIFE))
	call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MAX_MANA))
endfunction
function FUO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 14))
	call FTO(u)
	call L8X(u)
	call ClearSelectionForPlayer(GetOwningPlayer(u))
	call SelectUnitAddForPlayer(u, GetOwningPlayer(u))
	call KPX(u)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set u = null
	return false
endfunction
function FWO takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x
	local real y
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call StoreDrCacheData("AegisOff", GetPlayerId(GetOwningPlayer(u)))
	call UnitApplyTimedLife(CreateUnit(GetOwningPlayer(u),'o01P', GetUnitX(u), GetUnitY(u), 0),'BTLF', 5)
	set E7V = null
	call TriggerRegisterTimerEvent(t, 5, false)
	call TriggerAddCondition(t, Condition(function FUO))
	call SaveUnitHandle(HY, h, 14,(u))
	call EPX(u, 4304, 5)
	set t = null
	set u = null
endfunction
function FYO takes nothing returns nothing
	if GetItemIndex(GetManipulatedItem()) == AIV then
		call FWO()
	endif
endfunction
function FZO takes unit u, integer id, integer RLO, item F_O returns nothing
	local item it
	local integer JOX = B2X(u, F_O)
	local player p = GetItemPlayer(F_O)
	call DisableTrigger(CUV)
	call RemoveItem(F_O)
	set it = JIX(u, XOV[id], JOX)
	call SetItemPlayer(it, p, false)
	call SetItemUserData(it, RLO)
	call EnableTrigger(CUV)
	set it = null
endfunction
function F0O takes integer GTX returns nothing
	local unit u = GetTriggerUnit()
	local item it = GetManipulatedItem()
	local integer JOX
	local player p
	if GTX == IRV then
		call FZO(u, IIV, 1, it)
	elseif GTX == IIV then
		call FZO(u, IRV, 1, it)
	elseif GTX == RUV then
		call FZO(u, RWV, 1, it)
	elseif GTX == RWV then
		call FZO(u, RUV, 1, it)
	elseif GTX == AWV then
		call FZO(u, AYV, 1, it)
	elseif GTX == AYV then
		call FZO(u, AWV, 1, it)
	endif
	if GTX == AZV then
		call FZO(u, A_V, 1, it)
	elseif GTX == A_V then
		call FZO(u, AZV, 1, it)
	endif
	if GTX == IBV then
		call FZO(u, ICV, 1, it)
	elseif GTX == ICV then
		call FZO(u, IDV, 1, it)
	elseif GTX == IDV then
		call FZO(u, IBV, 1, it)
	endif
	if GTX == IUV and GetItemCharges(it) == 0 then
		call FZO(u, IYV, 1, it)
	elseif GTX == IWV and GetItemCharges(it) == 0 then
		call FZO(u, IZV, 1, it)
	elseif GTX == RRV and GetItemCharges(it) == 0 then
		call FZO(u, RIV, 1, it)
	endif
	set u = null
	set it = null
endfunction
function F1O takes integer GTX returns nothing
	local unit u = GetTriggerUnit()
	local item it = GetManipulatedItem()
	local player p = GetItemPlayer(it)
	local integer i = LoadInteger(OtherHashTable, GetHandleId(p),'0BKB')
	local integer F2O = 0
	if i == 0 then
		set F2O = AVV
	elseif i == 9 then
		set F2O = AEV
	elseif i == 8 then
		set F2O = AXV
	elseif i == 7 then
		set F2O = AOV
	elseif i == 6 then
		set F2O = ARV
	endif
	if GTX == ARV then
		call SetItemCharges(it, 5)
	endif
	if GTX == I9V or GTX == AVV or GTX == AEV or GTX == AXV or GTX == AOV then
		call FZO(u, F2O, 1, it)
		if i == 0 then
			call SaveInteger(OtherHashTable, GetHandleId(p),'0BKB', 9)
		else
			call SaveInteger(OtherHashTable, GetHandleId(p),'0BKB', IMaxBJ(i -1, 5))
		endif
	endif
	set u = null
	set it = null
endfunction
function F3O takes integer id returns boolean
	local real AXO
	local trigger t
	local real hp
	local unit u = GetTriggerUnit()
	local item it = GetManipulatedItem()
	if id == NCV then
		set AXO = GetUnitState(u, UNIT_STATE_MAX_LIFE)-GetWidgetLife(u)
		set hp = GetWidgetLife(u)
		call FZO(u, NBV, 1, it)
		call CDO(u)
		call EPX(u, 4298, .6)
	elseif id == NBV then
		set AXO = GetUnitState(u, UNIT_STATE_MAX_LIFE)-GetWidgetLife(u)
		call FZO(u, NCV, 1, it)
		call SaveBoolean(OtherHashTable, GetHandleId(u), 20, false)
		call SetHeroStr(u, IMaxBJ(GetHeroStr(u, false)-LoadInteger(OtherHashTable, GetHandleId(u),'ARML'), 1), true)
		call SaveInteger(OtherHashTable, GetHandleId(u),'ARML', 0)
		call CDO(u)
	endif
	set u = null
	set it = null
	return false
endfunction
function F4O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local item it
	if ABO(whichUnit) then
		call DisableTrigger(CUV)
		set it = CreateItem('I0HM', GetUnitX(whichUnit), GetUnitY(whichUnit))
		call UnitAddItem(whichUnit, it)
		if GetWidgetLife(it)> 0 then
			call RemoveItem(it)
		endif
		set it = null
		call EnableTrigger(CUV)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call SaveBoolean(HY,(GetHandleId(whichUnit)), 129,(false))
	set t = null
	set whichUnit = null
	return false
endfunction
function F5O takes integer GTX returns nothing
	local unit whichUnit = GetTriggerUnit()
	local item UWV = GetManipulatedItem()
	local trigger t
	if (GTX == ANV or GTX == ABV) and(LoadBoolean(HY,(GetHandleId(whichUnit)), 129)) then
		set t = CreateTrigger()
		call TriggerRegisterTimerEvent(t, .41, false)
		call TriggerAddCondition(t, Condition(function F4O))
		call SaveUnitHandle(HY,(GetHandleId(t)), 2,(whichUnit))
		set t = null
	endif
	set whichUnit = null
	set UWV = null
endfunction

function F6O takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call SetItemDroppable(LoadItemHandle(HY, h, 0), true)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction

function F7O takes nothing returns boolean
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, LoadInteger(ItemCooldownHashTable, GetItemTypeId(GetManipulatedItem()),'00CD'), false, function F6O)
	call SetItemDroppable(GetManipulatedItem(), false)
	call SaveItemHandle(HY, h, 0, GetManipulatedItem())
	set t = null
	return false
endfunction

function IronwoodBranchExpire takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local destructable d = LoadDestructableHandle(HY, h, 0)
	call FlushChildHashtable(HY, GetHandleId(d))
	call RemoveDestructable(d)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set d = null
endfunction

function Item_SpellEffect_IronwoodBranch takes nothing returns nothing
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local destructable d = CreateDestructable('B005', x, y, 360.00, 1, 0)
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local unit spellUnit = GetTriggerUnit()
	//local integer iOrder = GetUnitCurrentOrder( spellUnit )
	//local integer i = iOrder - 852008 
	call SaveDestructableHandle(HY, h, 0, d)
	call TimerStart(t, 20.00, false, function IronwoodBranchExpire)

	//call RemoveItem( UnitItemInSlot(spellUnit, i) )
	// debug call SingleDebug("Remove")
	set spellUnit = null
	set d = null
	set t = null
endfunction
function Item_SpellEffect_MoonShard takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()

	call UnitAddPermanentAbility(targetUnit,'A398')
	call DestroyEffect(AddSpecialEffectTarget("effects\\Eclipse.mdx", targetUnit, "origin"))
	
	set spellUnit = null
	set targetUnit = null
endfunction


function F9O takes nothing returns boolean
	local real x
	local real y
	local real a
	local integer id = GetItemIndex(GetManipulatedItem())
	local integer TZE = GetItemTypeId(GetManipulatedItem())
	if GetUnitTypeId(GetTriggerUnit())!='e00E' and(LoadInteger(ItemCooldownHashTable, TZE,'00CD'))> 0 and(GetUnitAbilityLevel(GetTriggerUnit(),'A0A5')> 0 or IsBearUnit(GetTriggerUnit())) then
		call F7O()
	endif
	if id == ADV or id == AFV or id == AGV or id == AHV or id == AJV then
		call SetItemCharges(GetManipulatedItem(), GetItemCharges(GetManipulatedItem()) + 1)
	elseif TZE == XOV[RPV] or TZE == XOV[Item_IronwoodBranch] or TZE == XOV[Item_MoonShard] then
		// 使用芒果 树枝 银月 那就删了
		call RemoveItem(GetManipulatedItem())
	elseif TZE == XOV[XDV] then
		if bj_playerIsCrippled[0] then
			call RemoveItem(GetManipulatedItem())
			call HDX(GetTriggerUnit(), true)
		endif
		set bj_playerIsCrippled[0]= false
	endif
	if VE then
		call XOO(GetTriggerUnit(), XIO(GetItemIndexEx(GetManipulatedItem()), true), GetItemPlayer(GetManipulatedItem()))
		set VE = false
	endif
	call F0O(id)
	call AKO()
	call FYO()
	call F3O(id)
	call F1O(id)
	call F5O(id)
	return false
endfunction
function CreepAttackToBase takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit()) == SentinelPlayers[0] then
		call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983, AttackToScourgeLocation)
	elseif GetOwningPlayer(GetTriggerUnit()) == ScourgePlayers[0] then
		call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983, AttackToSentinelLocation)
	endif
	return false
endfunction
function GEO takes nothing returns nothing
	set SpawnRangedCreepNumber = SpawnRangedCreepNumber + 1
endfunction
function GXO takes nothing returns nothing
	set SpawnMeleeCreepNumber = SpawnMeleeCreepNumber + 1
endfunction
function SentinelAttackToMid takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit()) == SentinelPlayers[0] then
		call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983, AttackToMidLocation)
	endif
	return false
endfunction
function ScourgeAttackToMid takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit()) == ScourgePlayers[0] then
		call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983, AttackToMidLocation)
	endif
	return false
endfunction
function SentinelAttackToTop takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit()) == SentinelPlayers[0] then
		call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983, AttackToTopLocation)
	endif
	return false
endfunction
function ScourgeAttackToTop takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit()) == ScourgePlayers[0] then
		call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983, AttackToTopLocation)
	endif
	return false
endfunction
function SentinelAttackToBot takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit()) == SentinelPlayers[0] then
		call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983, AttackToBotLocation)
	endif
	return false
endfunction
function ScourgeAttackToBot takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit()) == ScourgePlayers[0] then
		call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983, AttackToBotLocation)
	endif
	return false
endfunction
function GCO takes nothing returns nothing
	local integer i = 1
	local integer id
	loop
	exitwhen i > 5
		set id = GetPlayerId(SentinelPlayers[i])
		call StoreDrCacheData("CSK" + I2S(id), PlayerCreepLastHitCount[id])
		call StoreDrCacheData("ConvertSkillData" + I2S(id), PlayerCreepDenyCount[id])
		call StoreDrCacheData("NK" + I2S(id),(LoadInteger(HY,(400 + id), 79)))
		set id = GetPlayerId(ScourgePlayers[i])
		call StoreDrCacheData("CSK" + I2S(id), PlayerCreepLastHitCount[id])
		call StoreDrCacheData("ConvertSkillData" + I2S(id), PlayerCreepDenyCount[id])
		call StoreDrCacheData("NK" + I2S(id),(LoadInteger(HY,(400 + id), 79)))
		set i = i + 1
	endloop
endfunction
function GDO takes boolean GFO returns nothing
	local unit u
	local string s1
	local string s2
	if GFO then
		set s1 = "stand work alternate"
		set s2 = "stand work"
	else
		set s1 = "stand alternate"
		set s2 = "stand"
	endif
	if UnitIsDead(SentinelTopMeleeRaxUnit) == false then
		call SetUnitAnimation(SentinelTopMeleeRaxUnit, s1)
	endif
	if UnitIsDead(SentinelMidMeleeRaxUnit) == false then
		call SetUnitAnimation(SentinelMidMeleeRaxUnit, s1)
	endif
	if UnitIsDead(SentinelBotMeleeRaxUnit) == false then
		call SetUnitAnimation(SentinelBotMeleeRaxUnit, s1)
	endif
	if UnitIsDead(SentinelTopRangedRaxUnit) == false then
		call SetUnitAnimation(SentinelTopRangedRaxUnit, s1)
	endif
	if UnitIsDead(SentinelMidRangedRaxUnit) == false then
		call SetUnitAnimation(SentinelMidRangedRaxUnit, s1)
	endif
	if UnitIsDead(SentinelBotRangedRaxUnit) == false then
		call SetUnitAnimation(SentinelBotRangedRaxUnit, s1)
	endif
	if UnitIsDead(ScourgeTopMeleeRaxUnit) == false then
		call SetUnitAnimation(ScourgeTopMeleeRaxUnit, s2)
	endif
	if UnitIsDead(ScourgeMidMeleeRaxUnit) == false then
		call SetUnitAnimation(ScourgeMidMeleeRaxUnit, s2)
	endif
	if UnitIsDead(ScourgeBotMeleeRaxUnit) == false then
		call SetUnitAnimation(ScourgeBotMeleeRaxUnit, s2)
	endif
	if UnitIsDead(ScourgeTopRangedRaxUnit) == false then
		call SetUnitAnimation(ScourgeTopRangedRaxUnit, s2)
	endif
	if UnitIsDead(ScourgeMidRangedRaxUnit) == false then
		call SetUnitAnimation(ScourgeMidRangedRaxUnit, s2)
	endif
	if UnitIsDead(ScourgeBotRangedRaxUnit) == false then
		call SetUnitAnimation(ScourgeBotRangedRaxUnit, s2)
	endif
	set u = null
endfunction
function GGO takes nothing returns boolean
	call GDO(true)
	return false
endfunction

function GKO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	call SetUnitMoveSpeed(u, LoadReal(HY, h, 25))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction
function SetGroupUnitsNotupgradedSpeed takes unit u, integer addSpeedType returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local real m
	local real d = 10.
	if addSpeedType == 1 then
		set m = 1.25
	else
		set m = .75
	endif
	call SaveReal(HY, h, 25, GetUnitMoveSpeed(u))
	call SetUnitMoveSpeed(u, GetUnitMoveSpeed(u)* m)
	call TimerStart(t, d, false, function GKO)
	call SaveUnitHandle(HY, h, 0, u)
	set t = null
endfunction
function SetGroupUnitsNextWaypoint takes group g, integer nextWaypointIndex, integer addSpeedType returns nothing
	local unit firstUnit
	loop
		set firstUnit = FirstOfGroup(g)
	exitwhen( firstUnit == null)
		call GroupRemoveUnit(g, firstUnit)
		if IsNotUpgraded and addSpeedType != SPAWN_SPEED_TYPE_NONE then
			call SetGroupUnitsNotupgradedSpeed(firstUnit, addSpeedType)
		endif
		call SetUnitAbilityLevel(firstUnit, 'A06G', nextWaypointIndex)
		call IssuePointOrderByIdLoc(firstUnit, 851983, CreepNextWaypoint[nextWaypointIndex])
	endloop
	set firstUnit = null
endfunction
globals
	constant integer SPAWN_SPEED_TYPE_NONE   = 0
	constant integer SPAWN_SPEED_TYPE_ADD    = 1
	constant integer SPAWN_SPEED_TYPE_REDUCE = 2
endglobals

function SpawnTopCreep takes boolean spawnDemolisher returns nothing
	// 天灾
	if (IsSentinelTopMeleeRaxAlive) then
		call CreateNUnitsAtLoc(SpawnMeleeCreepNumber,'ugho', ScourgePlayers[0], ScourgeTopMeleeSpawnLocatio, bj_UNIT_FACING)
	else
		call CreateNUnitsAtLoc(SpawnMeleeCreepNumber,'u001', ScourgePlayers[0], ScourgeTopMeleeSpawnLocatio, bj_UNIT_FACING)
	endif
	call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 2, SPAWN_SPEED_TYPE_ADD)
	if (IsSentinelTopRangedRaxAlive) then
		call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'unec', ScourgePlayers[0], ScourgeTopRangedSpawnLocatio, bj_UNIT_FACING)
	else
		call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'u002', ScourgePlayers[0], ScourgeTopRangedSpawnLocatio, bj_UNIT_FACING)
	endif
	call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 2, SPAWN_SPEED_TYPE_ADD)

	// 近卫
	if (IsScourgeTopMeleeRaxAlive) then
		call CreateNUnitsAtLoc(SpawnMeleeCreepNumber,'esen', SentinelPlayers[0], SentinelTopMeleeSpawnLocatio, bj_UNIT_FACING)
	else
		call CreateNUnitsAtLoc(SpawnMeleeCreepNumber,'e00V', SentinelPlayers[0], SentinelTopMeleeSpawnLocatio, bj_UNIT_FACING)
	endif
	call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 2, SPAWN_SPEED_TYPE_REDUCE)
	if (IsScourgeTopRangedRaxAlive) then
		call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'edry', SentinelPlayers[0], SentinelTopRangedSpawnLocatio, bj_UNIT_FACING)
	else
		call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'e00W', SentinelPlayers[0], SentinelTopRangedSpawnLocatio, bj_UNIT_FACING)
	endif
	call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 2, SPAWN_SPEED_TYPE_REDUCE)

	// 车
	if spawnDemolisher then
		if (IsSentinelTopRangedRaxAlive) then
			call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'umtw', ScourgePlayers[0], ScourgeTopRangedSpawnLocatio, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'u00R', ScourgePlayers[0], ScourgeTopRangedSpawnLocatio, bj_UNIT_FACING)
		endif
		call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 2, SPAWN_SPEED_TYPE_ADD)
		if (IsScourgeTopRangedRaxAlive) then
			call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'ebal', SentinelPlayers[0], SentinelTopRangedSpawnLocatio, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'e026', SentinelPlayers[0], SentinelTopRangedSpawnLocatio, bj_UNIT_FACING)
		endif
		call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 2, SPAWN_SPEED_TYPE_REDUCE)
	endif
endfunction

function SpawnMidCreep takes boolean spawnDemolisher returns nothing
	// 天灾
	if (IsSentinelMidMeleeRaxAlive) then
		call CreateNUnitsAtLoc(SpawnMeleeCreepNumber,'ugho', ScourgePlayers[0], ScourgeMidMeleeSpawnLocatio, bj_UNIT_FACING)
	else
		call CreateNUnitsAtLoc(SpawnMeleeCreepNumber,'u001', ScourgePlayers[0], ScourgeMidMeleeSpawnLocatio, bj_UNIT_FACING)
	endif
	call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 3, SPAWN_SPEED_TYPE_NONE)
	if (IsSentinelMidRangedRaxAlive) then
		call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'unec', ScourgePlayers[0], ScourgeMidRangedSpawnLocatio, bj_UNIT_FACING)
	else
		call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'u002', ScourgePlayers[0], ScourgeMidRangedSpawnLocatio, bj_UNIT_FACING)
	endif
	call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 3, SPAWN_SPEED_TYPE_NONE)

	// 近卫
	if (IsScourgeMidMeleeRaxAlive) then
		call CreateNUnitsAtLoc(SpawnMeleeCreepNumber,'esen', SentinelPlayers[0], SentinelMidMeleeSpawnLocatio, bj_UNIT_FACING)
	else
		call CreateNUnitsAtLoc(SpawnMeleeCreepNumber,'e00V', SentinelPlayers[0], SentinelMidMeleeSpawnLocatio, bj_UNIT_FACING)
	endif
	call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 3, SPAWN_SPEED_TYPE_NONE)
	if (IsScourgeMidRangedRaxAlive) then
		call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'edry', SentinelPlayers[0], SentinelMidRangedSpawnLocatio, bj_UNIT_FACING)
	else
		call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'e00W', SentinelPlayers[0], SentinelMidRangedSpawnLocatio, bj_UNIT_FACING)
	endif
	call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 3, SPAWN_SPEED_TYPE_NONE)

	// 车
	if spawnDemolisher then
		if (IsSentinelMidRangedRaxAlive) then
			call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'umtw', ScourgePlayers[0], ScourgeMidRangedSpawnLocatio, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'u00R', ScourgePlayers[0], ScourgeMidRangedSpawnLocatio, bj_UNIT_FACING)
		endif
		call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 3, SPAWN_SPEED_TYPE_NONE)
		if (IsScourgeMidRangedRaxAlive) then
			call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'ebal', SentinelPlayers[0], SentinelMidRangedSpawnLocatio, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'e026', SentinelPlayers[0], SentinelMidRangedSpawnLocatio, bj_UNIT_FACING)
		endif
		call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 3, SPAWN_SPEED_TYPE_NONE)
	endif
endfunction
function SpawnBotCreep takes boolean spawnDemolisher returns nothing
	// 天灾
	if (IsSentinelBotMeleeRaxAlive) then
		call CreateNUnitsAtLoc(SpawnMeleeCreepNumber,'ugho', ScourgePlayers[0], ScourgeBotMeleeSpawnLocatio, bj_UNIT_FACING)
	else
		call CreateNUnitsAtLoc(SpawnMeleeCreepNumber,'u001', ScourgePlayers[0], ScourgeBotMeleeSpawnLocatio, bj_UNIT_FACING)
	endif
	call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 4, SPAWN_SPEED_TYPE_REDUCE)
	if (IsSentinelBotRangedRaxAlive) then
		call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'unec', ScourgePlayers[0], ScourgeBotRangedSpawnLocatio, bj_UNIT_FACING)
	else
		call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'u002', ScourgePlayers[0], ScourgeBotRangedSpawnLocatio, bj_UNIT_FACING)
	endif
	call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 4, SPAWN_SPEED_TYPE_REDUCE)

	// 近卫
	if (IsScourgeBotMeleeRaxAlive) then
		call CreateNUnitsAtLoc(SpawnMeleeCreepNumber,'esen', SentinelPlayers[0], SentinelBotMeleeSpawnLocatio, bj_UNIT_FACING)
	else
		call CreateNUnitsAtLoc(SpawnMeleeCreepNumber,'e00V', SentinelPlayers[0], SentinelBotMeleeSpawnLocatio, bj_UNIT_FACING)
	endif
	call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 4, SPAWN_SPEED_TYPE_ADD)
	if (IsScourgeBotRangedRaxAlive) then
		call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'edry', SentinelPlayers[0], SentinelBotRangedSpawnLocatio, bj_UNIT_FACING)
	else
		call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'e00W', SentinelPlayers[0], SentinelBotRangedSpawnLocatio, bj_UNIT_FACING)
	endif
	call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 4, SPAWN_SPEED_TYPE_ADD)

	// 车
	if spawnDemolisher then
		if (IsSentinelBotRangedRaxAlive) then
			call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'umtw', ScourgePlayers[0], ScourgeBotRangedSpawnLocatio, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'u00R', ScourgePlayers[0], ScourgeBotRangedSpawnLocatio, bj_UNIT_FACING)
		endif
		call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 4, SPAWN_SPEED_TYPE_REDUCE)
		if (IsScourgeBotRangedRaxAlive) then
			call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'ebal', SentinelPlayers[0], SentinelBotRangedSpawnLocatio, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(SpawnRangedCreepNumber,'e026', SentinelPlayers[0], SentinelBotRangedSpawnLocatio, bj_UNIT_FACING)
		endif
		call SetGroupUnitsNextWaypoint(bj_lastCreatedGroup, 4, SPAWN_SPEED_TYPE_ADD)
	endif
endfunction
function SpawnAttackCreepAction takes nothing returns nothing
	local boolean spawnDemolisher = ModuloInteger(GetTriggerExecCount(SpawnAttackCreepTrigger), 7) == 0
	if IsDisableSpawn then
		return
	endif
	call GDO(false)
	if spawnDemolisher then
		call GCO()
	endif
	if GetTriggerExecCount(SpawnAttackCreepTrigger) == 1 and Mode__OnlyMid == false then
		call UnitResetCooldownEx(CirclesUnit[1])
		call UnitResetCooldownEx(CirclesUnit[2])
		call UnitResetCooldownEx(CirclesUnit[3])
		call UnitResetCooldownEx(CirclesUnit[4])
		call UnitResetCooldownEx(CirclesUnit[5])
		call UnitResetCooldownEx(CirclesUnit[7])
		call UnitResetCooldownEx(CirclesUnit[8])
		call UnitResetCooldownEx(CirclesUnit[9])
		call UnitResetCooldownEx(CirclesUnit[10])
		call UnitResetCooldownEx(CirclesUnit[11])
		call UnitRemoveAbility(SentinleTopTowerLevel1,'Avul')
		call UnitRemoveAbility(SentinleMidTowerLevel1,'Avul')
		call UnitRemoveAbility(SentinleBotTowerLevel1,'Avul')
		call UnitRemoveAbility(ScourgeTopTowerLevel1,'Avul')
		call UnitRemoveAbility(ScourgeMidTowerLevel1,'Avul')
		call UnitRemoveAbility(ScourgeBotTowerLevel1,'Avul')
	elseif GetTriggerExecCount(SpawnAttackCreepTrigger) == 1 and Mode__OnlyMid then
		call UnitRemoveAbility(SentinleMidTowerLevel1,'Avul')
		call UnitRemoveAbility(ScourgeMidTowerLevel1,'Avul')
	endif
	if GetTriggerExecCount(SpawnAttackCreepTrigger) == 1 then
		call EnableTrigger(AddGoldForIntervalTrig)
	endif
	// 上路出兵
	if Mode__OnlyMid == false and Mode__NotTop == false then
		call SpawnTopCreep(spawnDemolisher)
	endif
	// 中路出兵
	if Mode__NoMid == false then
		call SpawnMidCreep(spawnDemolisher)
	endif
	// 下路出兵
	if Mode__OnlyMid == false and Mode__NotBot == false then
		call SpawnBotCreep(spawnDemolisher)
	endif
endfunction
function WorldTreeStoreLifeCache takes nothing returns boolean
	local real percent = GetWidgetLife(GetTriggerUnit())/ GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE)
	if percent < .75 and D0V == false then
		set D0V = true
		call StoreDrCacheData("Tree", 75)
	endif
	if percent < .5 and D_V == false then
		set D_V = true
		call StoreDrCacheData("Tree", 50)
	endif
	if percent < .25 and DZV == false then
		set DZV = true
		call StoreDrCacheData("Tree", 25)
	endif
	if percent < .1 and DYV == false then
		set DYV = true
		call StoreDrCacheData("Tree", 10)
	endif
	return false
endfunction
function FrozenThroneStoreLifeCache takes nothing returns boolean
	local real percent = GetWidgetLife(GetTriggerUnit())/ GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE)
	if percent < .75 and DWV == false then
		set DWV = true
		call StoreDrCacheData("Throne", 75)
	endif
	if percent < .5 and DUV == false then
		set DUV = true
		call StoreDrCacheData("Throne", 50)
	endif
	if percent < .25 and DTV == false then
		set DTV = true
		call StoreDrCacheData("Throne", 25)
	endif
	if percent < .1 and DSV == false then
		set DSV = true
		call StoreDrCacheData("Throne", 10)
	endif
	return false
endfunction
function SentinelSuperCreepCheckAction takes nothing returns boolean
	if (not(IsScourgeTopMeleeRaxAlive or IsScourgeMidMeleeRaxAlive or IsScourgeBotMeleeRaxAlive or IsScourgeTopRangedRaxAlive or IsScourgeMidRangedRaxAlive or IsScourgeBotRangedRaxAlive)) then
		call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, DisplayTextDuration[LocalPlayerId]* 2, GetObjectName('n04O')+ " " + GetObjectName('n0C7'))
		call SetPlayerTechResearchedSwap('R00D',(GetPlayerTechCountSimple('R00D', SentinelPlayers[0])+ 30), SentinelPlayers[0])
		call SetPlayerTechResearchedSwap('R00C',(GetPlayerTechCountSimple('R00C', SentinelPlayers[0])+ 30), SentinelPlayers[0])
		call DisableTrigger(SentinelSuperCreepCheckTrig)
	endif
	return false
endfunction
function ScourgeSuperCreepCheckAction takes nothing returns boolean
	if (not(IsSentinelTopMeleeRaxAlive or IsSentinelMidMeleeRaxAlive or IsSentinelBotMeleeRaxAlive or IsSentinelTopRangedRaxAlive or IsSentinelMidRangedRaxAlive or IsSentinelBotRangedRaxAlive)) then
		call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, DisplayTextDuration[LocalPlayerId]* 2, GetObjectName('n04X')+ " " + GetObjectName('n0C9'))
		call SetPlayerTechResearchedSwap('R009',(GetPlayerTechCountSimple('R009', ScourgePlayers[0])+ 30), ScourgePlayers[0])
		call SetPlayerTechResearchedSwap('R00B',(GetPlayerTechCountSimple('R00B', ScourgePlayers[0])+ 30), ScourgePlayers[0])
		call DisableTrigger(ScourgeSuperCreepCheckTrig)
	endif
	return false
endfunction
function CreepUpgerAction takes nothing returns nothing
	call SetPlayerTechResearchedSwap('R007',(GetPlayerTechCountSimple('R007', SentinelPlayers[0])+ 1), SentinelPlayers[0])
	call SetPlayerTechResearchedSwap('R00C',(GetPlayerTechCountSimple('R00C', SentinelPlayers[0])+ 1), SentinelPlayers[0])
	call SetPlayerTechResearchedSwap('R008',(GetPlayerTechCountSimple('R008', SentinelPlayers[0])+ 1), SentinelPlayers[0])
	call SetPlayerTechResearchedSwap('R00D',(GetPlayerTechCountSimple('R00D', SentinelPlayers[0])+ 1), SentinelPlayers[0])
	call SetPlayerTechResearchedSwap('R009',(GetPlayerTechCountSimple('R009', ScourgePlayers[0] )+ 1), ScourgePlayers[0] )
	call SetPlayerTechResearchedSwap('R003',(GetPlayerTechCountSimple('R003', ScourgePlayers[0] )+ 1), ScourgePlayers[0] )
	call SetPlayerTechResearchedSwap('R00A',(GetPlayerTechCountSimple('R00A', ScourgePlayers[0] )+ 1), ScourgePlayers[0] )
	call SetPlayerTechResearchedSwap('R00B',(GetPlayerTechCountSimple('R00B', ScourgePlayers[0] )+ 1), ScourgePlayers[0] )
	set IsNotUpgraded = false
endfunction
function PreloadNeutralCreepsAction takes nothing returns nothing
	local location loc = GetRectCenter(gg_rct_DummyBirthPoint)
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nbdo', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nbds', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'ngst', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'n026', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nggr', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nbdk', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nbwm', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nogm', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nomg', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nfpc', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nfpu', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nsth', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nstl', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nsat', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nwlg', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nkol', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nkob', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nkot', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'ncnk', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'ncen', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'ngns', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nftb', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nfsh', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'ngh1', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'npfl', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nowe', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nowb', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nmrm', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nmrr', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'nmrl', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'ndtr', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'ndtw', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'n0LC', loc, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(NeutralCreepPlayer,'n0LD', loc, bj_UNIT_FACING))
	call RemoveLocation(loc)
	set loc = null
endfunction
function CreateCreeps_Harpy takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'n0HW', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'n0HX', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'n0HW', x, y, 0), x, y)
endfunction
function CreateAncientCreeps_JungleBeast takes real x, real y returns nothing
	local unit u
	set u = CreateUnit(NeutralCreepPlayer,'njg1', x, y, 0)
	call SetUnitPosition(u, x, y)
	set u = CreateUnit(NeutralCreepPlayer,'njg1', x, y, 0)
	call SetUnitPosition(u, x, y)
	set u = CreateUnit(NeutralCreepPlayer,'njga', x, y, 0)
	call SetUnitPosition(u, x, y)
	set u = null
endfunction
function CreateAncientCreeps_BlueDragon takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nbdo', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nbdo', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nbds', x, y, 0), x, y)
endfunction
function CreateAncientCreeps_BlackDragon takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nbdk', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nbdk', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nbwm', x, y, 0), x, y)
endfunction
function CreateAncientCreeps_RockGolem takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'ngst', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'ngst', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nggr', x, y, 0), x, y)
endfunction
function CreateAncientCreeps_ThunderLizard takes real x, real y returns nothing
	local unit u
	set u = CreateUnit(NeutralCreepPlayer,'n0LC', x, y, 0)
	call SetUnitPosition(u, x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'n0LD', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'n0LD', x, y, 0), x, y)
	set u = null
endfunction
function CreateCreeps_Ogre takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nogm', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nogm', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nomg', x, y, 0), x, y)
endfunction
function CreateCreeps_PolarFurbolg takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nfpc', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nfpu', x, y, 0), x, y)
endfunction
function CreateCreeps_Satyr_Tough takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nsth', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nstl', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nsat', x, y, 0), x, y)
endfunction
function CreateCreeps_Satyr_Easy takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nstl', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nstl', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nsat', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nsat', x, y, 0), x, y)
endfunction
function CreateCreeps_TimberWolf takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nwlg', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nwlg', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'n00S', x, y, 0), x, y)
endfunction
function CreateCreeps_MudGolem takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'n026', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'n026', x, y, 0), x, y)
endfunction
function CreateCreeps_Kobold takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nkol', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nkob', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nkob', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nkob', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nkot', x, y, 0), x, y)
endfunction
function CreateCreeps_ForestTroll takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nftb', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nftb', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nfsh', x, y, 0), x, y)
endfunction
function CreateCreeps_Centaur takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'ncen', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'ncnk', x, y, 0), x, y)
endfunction
function CreateCreeps_GnollAssassin takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'ngns', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'ngns', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'ngns', x, y, 0), x, y)
endfunction
function CreateCreeps_KoboldAndTroll takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nftb', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nftb', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nkol', x, y, 0), x, y)
endfunction
function CreateCreeps_Ghost takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'ngh1', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'npfl', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'npfl', x, y, 0), x, y)
endfunction
function CreateCreeps_OwlBear takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nowe', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nowb', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'nowb', x, y, 0), x, y)
endfunction
function CreateCreeps_DarkTroll takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'ndtr', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'ndtr', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(NeutralCreepPlayer,'ndtw', x, y, 0), x, y)
endfunction
function CreateSentinelCreeps3 takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != CreepsLastCreatedIndex[0]
		set i = GetRandomInt(1, 5)
	endloop
	set CreepsLastCreatedIndex[0]= i
	if i == 1 then
		call CreateCreeps_PolarFurbolg(x, y)
	elseif i == 2 then
		call CreateCreeps_Satyr_Tough(x, y)
	elseif i == 3 then
		call CreateCreeps_OwlBear(x, y)
	elseif i == 4 then
		call CreateCreeps_DarkTroll(x, y)
	elseif i == 5 then
		call CreateCreeps_Centaur(x, y)
	endif
endfunction
function CreateSentinelCreeps1 takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != CreepsLastCreatedIndex[1]
		set i = GetRandomInt(1, 5)
	endloop
	set CreepsLastCreatedIndex[1]= i
	if i == 1 then
		call CreateCreeps_PolarFurbolg(x, y)
	elseif i == 2 then
		call CreateCreeps_Satyr_Tough(x, y)
	elseif i == 3 then
		call CreateCreeps_OwlBear(x, y)
	elseif i == 4 then
		call CreateCreeps_DarkTroll(x, y)
	elseif i == 5 then
		call CreateCreeps_Centaur(x, y)
	endif
endfunction
function CreateScourgeCreeps5 takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != CreepsLastCreatedIndex[2]
		set i = GetRandomInt(1, 5)
	endloop
	set CreepsLastCreatedIndex[2]= i
	if i == 1 then
		call CreateCreeps_PolarFurbolg(x, y)
	elseif i == 2 then
		call CreateCreeps_Satyr_Tough(x, y)
	elseif i == 3 then
		call CreateCreeps_OwlBear(x, y)
	elseif i == 4 then
		call CreateCreeps_DarkTroll(x, y)
	elseif i == 5 then
		call CreateCreeps_Centaur(x, y)
	endif
endfunction
function CreateScourgeCreeps1 takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != CreepsLastCreatedIndex[3]
		set i = GetRandomInt(1, 5)
	endloop
	set CreepsLastCreatedIndex[3]= i
	if i == 1 then
		call CreateCreeps_PolarFurbolg(x, y)
	elseif i == 2 then
		call CreateCreeps_Satyr_Tough(x, y)
	elseif i == 3 then
		call CreateCreeps_OwlBear(x, y)
	elseif i == 4 then
		call CreateCreeps_DarkTroll(x, y)
	elseif i == 5 then
		call CreateCreeps_Centaur(x, y)
	endif
endfunction
function CreateSentinelCreeps2 takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != CreepsLastCreatedIndex[4]
		set i = GetRandomInt(1, 5)
	endloop
	set CreepsLastCreatedIndex[4]= i
	if i == 1 then
		call CreateCreeps_MudGolem(x, y)
	elseif i == 2 then
		call CreateCreeps_Ogre(x, y)
	elseif i == 3 then
		call CreateCreeps_Satyr_Easy(x, y)
	elseif i == 4 then
		call CreateCreeps_TimberWolf(x, y)
	elseif i == 5 then
		call CreateCreeps_Centaur(x, y)
	endif
endfunction
function CreateScourgeCreeps2 takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != CreepsLastCreatedIndex[5]
		set i = GetRandomInt(1, 5)
	endloop
	set CreepsLastCreatedIndex[5]= i
	if i == 1 then
		call CreateCreeps_MudGolem(x, y)
	elseif i == 2 then
		call CreateCreeps_Ogre(x, y)
	elseif i == 3 then
		call CreateCreeps_Satyr_Easy(x, y)
	elseif i == 4 then
		call CreateCreeps_TimberWolf(x, y)
	elseif i == 5 then
		call CreateCreeps_Centaur(x, y)
	endif
endfunction
function CreateScourgeCreeps3 takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != CreepsLastCreatedIndex[6]
		set i = GetRandomInt(1, 5)
	endloop
	set CreepsLastCreatedIndex[6]= i
	if i == 1 then
		call CreateCreeps_MudGolem(x, y)
	elseif i == 2 then
		call CreateCreeps_Ogre(x, y)
	elseif i == 3 then
		call CreateCreeps_Satyr_Easy(x, y)
	elseif i == 4 then
		call CreateCreeps_TimberWolf(x, y)
	elseif i == 5 then
		call CreateCreeps_Centaur(x, y)
	endif
endfunction
function CreateSentinelCreeps5 takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != CreepsLastCreatedIndex[7]
		set i = GetRandomInt(1, 5)
	endloop
	set CreepsLastCreatedIndex[7]= i
	if i == 1 then
		call CreateCreeps_MudGolem(x, y)
	elseif i == 2 then
		call CreateCreeps_Ogre(x, y)
	elseif i == 3 then
		call CreateCreeps_Satyr_Easy(x, y)
	elseif i == 4 then
		call CreateCreeps_TimberWolf(x, y)
	elseif i == 5 then
		call CreateCreeps_Centaur(x, y)
	endif
endfunction
function CreateSentinelCreeps4 takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 6)
	loop
	exitwhen i != CreepsLastCreatedIndex[8]
		set i = GetRandomInt(1, 6)
	endloop
	set CreepsLastCreatedIndex[8]= i
	if i == 1 then
		call CreateCreeps_Ghost(x, y)
	elseif i == 2 then
		call CreateCreeps_KoboldAndTroll(x, y)
	elseif i == 3 then
		call CreateCreeps_GnollAssassin(x, y)
	elseif i == 4 then
		call CreateCreeps_Kobold(x, y)
	elseif i == 5 then
		call CreateCreeps_ForestTroll(x, y)
	elseif i == 6 then
		call CreateCreeps_Harpy(x, y)
	endif
endfunction
function CreateScourgeCreeps4 takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 6)
	loop
	exitwhen i != CreepsLastCreatedIndex[9]
		set i = GetRandomInt(1, 6)
	endloop
	set CreepsLastCreatedIndex[9]= i
	if i == 1 then
		call CreateCreeps_Ghost(x, y)
	elseif i == 2 then
		call CreateCreeps_KoboldAndTroll(x, y)
	elseif i == 3 then
		call CreateCreeps_GnollAssassin(x, y)
	elseif i == 4 then
		call CreateCreeps_Kobold(x, y)
	elseif i == 5 then
		call CreateCreeps_ForestTroll(x, y)
	elseif i == 6 then
		call CreateCreeps_Harpy(x, y)
	endif
endfunction
function CreateScourgeAncientCreeps takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != CreepsLastCreatedIndex[10]
		set i = GetRandomInt(3, 5)
	endloop
	set CreepsLastCreatedIndex[10]= i
	if i == 1 then
		call CreateAncientCreeps_JungleBeast(x, y)
	elseif i == 2 then
		call CreateAncientCreeps_BlueDragon(x, y)
	elseif i == 3 then
		call CreateAncientCreeps_BlackDragon(x, y)
	elseif i == 4 then
		call CreateAncientCreeps_RockGolem(x, y)
	elseif i == 5 then
		call CreateAncientCreeps_ThunderLizard(x, y)
	endif
endfunction
function CreateSentinelAncientCreeps takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != CreepsLastCreatedIndex[11]
		set i = GetRandomInt(3, 5)
	endloop
	set CreepsLastCreatedIndex[11]= i
	if i == 1 then
		call CreateAncientCreeps_JungleBeast(x, y)
	elseif i == 2 then
		call CreateAncientCreeps_BlueDragon(x, y)
	elseif i == 3 then
		call CreateAncientCreeps_BlackDragon(x, y)
	elseif i == 4 then
		call CreateAncientCreeps_RockGolem(x, y)
	elseif i == 5 then
		call CreateAncientCreeps_ThunderLizard(x, y)
	endif
endfunction
function H9O takes nothing returns nothing
	if GetUnitAbilityLevel(GetEnumUnit(),'A0P4')!= 0 or GetUnitTypeId(GetEnumUnit())=='o003' or GetUnitTypeId(GetEnumUnit())=='o01X' or UnitIsDead(GetEnumUnit()) or IsUnitMessenger(GetEnumUnit()) then
		call GroupRemoveUnit(LW, GetEnumUnit())
	endif
endfunction
function JVO takes nothing returns boolean
	return(not(GetUnitAbilityLevel(GetFilterUnit(),'A0P4')!= 0 or GetUnitTypeId(GetFilterUnit())=='o003' or GetUnitTypeId(GetFilterUnit())=='o01X' or UnitIsDead(GetFilterUnit()) or IsUnitMessenger(GetFilterUnit())))
endfunction
function GetTempGroup takes nothing returns group
	return TempGroup
endfunction
function CheckRectCanRefreshCreeps takes rect r returns boolean
	local unit firstUnit = null

	call GroupEnumUnitsInRect(GetTempGroup(), r, null)
	loop
		set firstUnit = FirstOfGroup(GetTempGroup())
		exitwhen firstUnit == null
		call GroupRemoveUnit(GetTempGroup(), firstUnit)
		if not (GetUnitAbilityLevel(firstUnit,'A0P4')!= 0 or GetUnitTypeId(firstUnit) == 'o003' or GetUnitTypeId(firstUnit) == 'o01X' or UnitIsDead(firstUnit) or IsUnitMessenger(firstUnit)) then
			set firstUnit = null
			return false
		endif
	endloop

	set firstUnit = null
	return true
endfunction
function SpawnAllNeutralCreepsAction takes nothing returns boolean
	if Mode__NoNeutrals then
		return false
	endif

	//if Z3 then 
	if CheckRectCanRefreshCreeps(gg_rct_ScourgeAncientRange) then
		call CreateScourgeAncientCreeps(GetRectCenterX(gg_rct_ScourgeAncientCenter), GetRectCenterY(gg_rct_ScourgeAncientCenter))
	endif
	if CheckRectCanRefreshCreeps(gg_rct_SentinelAncientRange) then
		call CreateSentinelAncientCreeps(GetRectCenterX(gg_rct_SentinelAncientCenter), GetRectCenterY(gg_rct_SentinelAncientCenter))
	endif
	//endif
	if CheckRectCanRefreshCreeps(gg_rct_SentinelNeutralCreepRange1) then
		call CreateSentinelCreeps1(GetRectCenterX(gg_rct_SentinelNeutralCreepCenter1), GetRectCenterY(gg_rct_SentinelNeutralCreepCenter1))
	endif
	if CheckRectCanRefreshCreeps(gg_rct_SentinelNeutralCreepRange2) then
		call CreateSentinelCreeps2(GetRectCenterX(gg_rct_SentinelNeutralCreepCenter2), GetRectCenterY(gg_rct_SentinelNeutralCreepCenter2))
	endif
	if CheckRectCanRefreshCreeps(gg_rct_SentinelNeutralCreepRange3) then
		call CreateSentinelCreeps3(GetRectCenterX(gg_rct_SentinelNeutralCreepCenter3), GetRectCenterY(gg_rct_SentinelNeutralCreepCenter3))
	endif
	if CheckRectCanRefreshCreeps(gg_rct_SentinelNeutralCreepRange4) then
		call CreateSentinelCreeps4(GetRectCenterX(gg_rct_SentinelNeutralCreepCenter4), GetRectCenterY(gg_rct_SentinelNeutralCreepCenter4))
	endif
	if CheckRectCanRefreshCreeps(gg_rct_SentinelNeutralCreepRange5) then
		call CreateSentinelCreeps5(GetRectCenterX(gg_rct_SentinelNeutralCreepCenter5), GetRectCenterY(gg_rct_SentinelNeutralCreepCenter5))
	endif
	
	if CheckRectCanRefreshCreeps(gg_rct_ScourgeNeutralCreepRange1) then
		call CreateScourgeCreeps1(GetRectCenterX(gg_rct_ScourgeNeutralCreepCenter1), GetRectCenterY(gg_rct_ScourgeNeutralCreepCenter1))
	endif
	if CheckRectCanRefreshCreeps(gg_rct_ScourgeNeutralCreepRange2) then
		call CreateScourgeCreeps2(GetRectCenterX(gg_rct_ScourgeNeutralCreepCenter2), GetRectCenterY(gg_rct_ScourgeNeutralCreepCenter2))
	endif
	if CheckRectCanRefreshCreeps(gg_rct_ScourgeNeutralCreepRange3) then
		call CreateScourgeCreeps3(GetRectCenterX(gg_rct_ScourgeNeutralCreepCenter3), GetRectCenterY(gg_rct_ScourgeNeutralCreepCenter3))
	endif
	if CheckRectCanRefreshCreeps(gg_rct_ScourgeNeutralCreepRange4) then
		call CreateScourgeCreeps4(GetRectCenterX(gg_rct_ScourgeNeutralCreepCenter4), GetRectCenterY(gg_rct_ScourgeNeutralCreepCenter4))
	endif
	if CheckRectCanRefreshCreeps(gg_rct_ScourgeNeutralCreepRange5) then
		call CreateScourgeCreeps5(GetRectCenterX(gg_rct_ScourgeNeutralCreepCenter5), GetRectCenterY(gg_rct_ScourgeNeutralCreepCenter5))
	endif

	return false
endfunction
function SpawnSuperCreepsAction takes nothing returns nothing
	local integer i = 0
	local group g
	local unit u = null
	local real x1
	local real y1
	local real x2
	local real y2
	local integer array JOO
	local integer JRO = GetRandomInt(0, 2)
	local integer F2O = 0
	local string s = ""
	local unit u2
	if Mode__NoMid and Mode__NotTop and Mode__NotBot then
		return
	endif
	set JOO[0]='n003'
	set JOO[1]='n00E'
	set JOO[2]='n00D'
	set F2O = JOO[JRO]
	set JRO = GetRandomInt(0, 2)
	if Mode__OnlyMid then
		set JRO = 0
	endif
	if (Mode__NoMid and JRO == 0) or(Mode__NotTop and JRO == 2) or(Mode__NotBot and JRO == 1) then
		loop
			set JRO = GetRandomInt(0, 2)
		exitwhen(Mode__NoMid and JRO != 0) or(Mode__NotTop and JRO != 2) or(Mode__NotBot and JRO != 1)
		endloop
	endif
	if JRO == 0 then
		set x1 = GetRectCenterX(gg_rct_SentinelMidSuperCreepsSpawn)
		set y1 = GetRectCenterY(gg_rct_SentinelMidSuperCreepsSpawn)
		set x2 = GetRectCenterX(gg_rct_ScourgeMidSuperCreepsSpawn)
		set y2 = GetRectCenterY(gg_rct_ScourgeMidSuperCreepsSpawn)
		set i = 2
		set s = "中路"
	elseif JRO == 1 then
		set x1 = GetRectCenterX(gg_rct_SentinelBotSuperCreepsSpawn)
		set y1 = GetRectCenterY(gg_rct_SentinelBotSuperCreepsSpawn)
		set x2 = GetRectCenterX(gg_rct_ScourgeBotSuperCreepsSpawn)
		set y2 = GetRectCenterY(gg_rct_ScourgeBotSuperCreepsSpawn)
		set i = 3
		set s = "下路"
	else
		set x1 = GetRectCenterX(gg_rct_SentinelTopSuperCreepsSpawn)
		set y1 = GetRectCenterY(gg_rct_SentinelTopSuperCreepsSpawn)
		set x2 = GetRectCenterX(gg_rct_ScourgeTopSuperCreepsSpawn)
		set y2 = GetRectCenterY(gg_rct_ScourgeTopSuperCreepsSpawn)
		set i = 4
		set s = "上路"
	endif
	if F2O > 0 then
		set g = AllocationGroup(44)
		set u = CreateUnit(SentinelPlayers[0], F2O, x1, y1, 90)
		call GroupAddUnit(g, u)
		set u2 = CreateUnit(ScourgePlayers[0], F2O, x2, y2, 90)
		call GroupAddUnit(g, u2)
		call SetGroupUnitsNextWaypoint(g, i, JRO)
		/*
		if IsNotUpgraded and JRO != 0 then
			call GroupClear(g)
			if JRO == 1 then
				set TempInt = 1
				call GroupAddUnit(g, u)
				call ForGroup(g, function SetGroupUnitsNotupgradedSpeed)
				call GroupClear(g)
				set TempInt = 2
				call GroupAddUnit(g, u2)
				call ForGroup(g, function SetGroupUnitsNotupgradedSpeed)
			else
				set TempInt = 1
				call GroupAddUnit(g, u2)
				call ForGroup(g, function SetGroupUnitsNotupgradedSpeed)
				call GroupClear(g)
				set TempInt = 2
				call GroupAddUnit(g, u)
				call ForGroup(g, function SetGroupUnitsNotupgradedSpeed)
			endif
		endif
		*/
		call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, DisplayTextDuration[LocalPlayerId], "|c000000ff" + GetObjectName(F2O)+ "|r 已向双方阵营的 " + s + " 路出发")
		call DeallocateGroup(g)
	endif
	set g = null
	set u = null
	set u2 = null
endfunction
function JIO takes nothing returns nothing
	local integer k
	local integer j
	local integer n
	local integer m
	local integer i
	local player p
	local integer pid
	local string JAO
	local string JNO
	local string JBO
	set D3V = D3V + 1
	set SentinelUserCount = 0
	set ScourgeUserCount = 0
	set i = 0
	loop
	exitwhen i > 5
		set p = SentinelPlayers[i]
		if IsUserPlayer(p) then
			set SentinelUserCount = SentinelUserCount + 1
		endif
		set p = ScourgePlayers[i]
		if IsUserPlayer(p) then
			set ScourgeUserCount = ScourgeUserCount + 1
		endif
		set i = i + 1
	endloop
	if YM == false then
		set IM1 = SentinelUserCount
		set N1 = ScourgeUserCount
	endif
	set k = 1
	set j = 5
	set n = 1
	loop
	exitwhen k > j
		set p = SentinelPlayers[k]
		if IsUserPlayer(p) then
			set SentinelUsers[n]= p
			set n = n + 1
		endif
		set k = k + 1
	endloop
	set k = 1
	set j = 5
	set n = 1
	loop
	exitwhen k > j
		set p = ScourgePlayers[k]
		if IsUserPlayer(p) then
			set ScourgeUsers[n]= p
			set n = n + 1
		endif
		set k = k + 1
	endloop
	if D3V == 1 then
		set MainMultiboard = CreateMultiboardBJ(8 + 6, 3 + ScourgeUserCount + SentinelUserCount, " ")
		call MultiboardMinimize(MainMultiboard, true)
	endif
	if ExtraSkillsNumber >= 2 then
		call SetMultiboardItemText(MainMultiboard, 2, 1, "CD1")
		call SetMultiboardItemText(MainMultiboard, 3, 1, "CD2")
	else
		call SetMultiboardItemText(MainMultiboard, 2, 1, "CD")
		call SetMultiboardItemText(MainMultiboard, 3, 1, " ")
	endif
	call SetMultiboardItemText(MainMultiboard, 4, 1, "|c00838B8BL|r")
	call SetMultiboardItemText(MainMultiboard, 5, 1, "|c00ff0303" + "K|r")
	call SetMultiboardItemText(MainMultiboard, 6, 1, "|c000042ff" + "D|r")
	call SetMultiboardItemText(MainMultiboard, 7, 1, "|c00646464" + "A|r")
	call SetMultiboardItemText(MainMultiboard, 1, 2, GetObjectName('n0DK'))
	call SetMultiboardItemText(MainMultiboard, 5, 2, "|c00ff0303" + "0|r")
	call SetMultiboardItemText(MainMultiboard, 6, 2, "|c000042ff" + "0|r")
	call SetMultiboardItemText(MainMultiboard, 1, 3 + SentinelUserCount, GetObjectName('n0DO'))
	call SetMultiboardItemText(MainMultiboard, 5, 3 + SentinelUserCount, "|c00ff0303" + "0|r")
	call SetMultiboardItemText(MainMultiboard, 6, 3 + SentinelUserCount, "|c000042ff" + "0|r")
	set pid = GetPlayerId(SentinelPlayers[0])
	call SetMultiboardItemValueColor(MainMultiboard, 1, 2, X6X(SubString(PlayersColoerText[pid], 4, 6))/ 255. * 100 , X6X(SubString(PlayersColoerText[pid], 6, 8))/ 255. * 100 , X6X(SubString(PlayersColoerText[pid], 8, 10))/ 255. * 100 , 0)
	set pid = GetPlayerId(ScourgePlayers[0])
	call SetMultiboardItemValueColor(MainMultiboard, 1, 3 + SentinelUserCount, X6X(SubString(PlayersColoerText[pid], 4, 6))/ 255. * 100 , X6X(SubString(PlayersColoerText[pid], 6, 8))/ 255. * 100 , X6X(SubString(PlayersColoerText[pid], 8, 10))/ 255. * 100 , 0)
	set k = 1
	set j = 3 + ScourgeUserCount + SentinelUserCount
	loop
	exitwhen k > j
		call SetMultiboardItemWidth(MainMultiboard, 1, k, 10.8)
		call SetMultiboardItemWidth(MainMultiboard, 2, k, 2)
		if ExtraSkillsNumber >= 2 then
			call SetMultiboardItemWidth(MainMultiboard, 3, k, 2)
		else
			call SetMultiboardItemWidth(MainMultiboard, 3, k, .01)
		endif
		call SetMultiboardItemWidth(MainMultiboard, 4, k, 2)
		call SetMultiboardItemWidth(MainMultiboard, 5, k, 1.3)
		call SetMultiboardItemWidth(MainMultiboard, 6, k, 1.3)
		call SetMultiboardItemWidth(MainMultiboard, 7, k, 1.3)
		call SetMultiboardItemWidth(MainMultiboard, 8, k, 2.5)
		call SetMultiboardItemWidth(MainMultiboard, 9, k, .01)
		call SetMultiboardItemWidth(MainMultiboard, 10, k, .01)
		call SetMultiboardItemWidth(MainMultiboard, 11, k, .01)
		call SetMultiboardItemWidth(MainMultiboard, 12, k, .01)
		call SetMultiboardItemWidth(MainMultiboard, 13, k, .01)
		call SetMultiboardItemWidth(MainMultiboard, 14, k, .01)
		set k = k + 1
	endloop
	set k = 1
	set j = 8 + 6
	loop
	exitwhen k > j
		set n = 1
		set m = 3 + ScourgeUserCount + SentinelUserCount
		loop
		exitwhen n > m
			call SetMultiboardItemStyle(MainMultiboard, k, n, true, false)
			set n = n + 1
		endloop
		set k = k + 1
	endloop
	set k = 1
	set j = SentinelUserCount
	loop
	exitwhen k > j
		call SetMultiboardItemStyle(MainMultiboard, 1, k + 2, true, true)
		call SetMultiboardItemValueColor(MainMultiboard, 8, k + 2, 255, 204, 0, 0)
		set pid = GetPlayerId(SentinelUsers[k])
		set D1V[pid]= 1 -1
		set D2V[pid]= k + 2 -1
		call SetMultiboardItemText(MainMultiboard, 1, k + 2,(PlayersName[pid]))
		if IsPlayingPlayer(SentinelUsers[k]) then
			set JAO = SubString(PlayersColoerText[pid], 4, 6)
			set JNO = SubString(PlayersColoerText[pid], 6, 8)
			set JBO = SubString(PlayersColoerText[pid], 8, 10)
			call SetMultiboardItemValueColor(MainMultiboard, 1, k + 2, X6X(JAO)/ 255. * 100 , X6X(JNO)/ 255. * 100 , X6X(JBO)/ 255. * 100 , 0)
			call SetMultiboardItemValueColor(MainMultiboard, 2, k + 2, X6X(JAO)/ 255. * 100 , X6X(JNO)/ 255. * 100 , X6X(JBO)/ 255. * 100 , 0)
			call SetMultiboardItemValueColor(MainMultiboard, 3, k + 2, X6X(JAO)/ 255. * 100 , X6X(JNO)/ 255. * 100 , X6X(JBO)/ 255. * 100 , 0)
		else
			call SetMultiboardItemText(MainMultiboard, 1, k + 2, "|c00333333" +(PlayersName[pid])+ "|r")
		endif
		call SetMultiboardItemText(MainMultiboard, 5, k + 2, "|c00ff0303" + "0|r")
		call SetMultiboardItemText(MainMultiboard, 6, k + 2, "|c000042ff" + "0|r")
		call SetMultiboardItemText(MainMultiboard, 7, k + 2, "|c00646464" + "0|r")
		set k = k + 1
	endloop
	set k = 1
	set j = ScourgeUserCount
	loop
	exitwhen k > j
		call SetMultiboardItemStyle(MainMultiboard, 1, k + 3 + SentinelUserCount, true, true)
		call SetMultiboardItemValueColor(MainMultiboard, 8, k + 3 + SentinelUserCount, 255, 204, 0, 0)
		set pid = GetPlayerId(ScourgeUsers[k])
		set D1V[pid]= 1 -1
		set D2V[pid]= k + 3 + SentinelUserCount -1
		call SetMultiboardItemText(MainMultiboard, 1, k + 3 + SentinelUserCount,(PlayersName[pid]))
		if IsPlayingPlayer(ScourgeUsers[k]) then
			set JAO = SubString(PlayersColoerText[pid], 4, 6)
			set JNO = SubString(PlayersColoerText[pid], 6, 8)
			set JBO = SubString(PlayersColoerText[pid], 8, 10)
			call SetMultiboardItemValueColor(MainMultiboard, 1, k + 3 + SentinelUserCount, X6X(JAO)/ 255. * 100 , X6X(JNO)/ 255. * 100 , X6X(JBO)/ 255. * 100 , 0)
			call SetMultiboardItemValueColor(MainMultiboard, 2, k + 3 + SentinelUserCount, X6X(JAO)/ 255. * 100 , X6X(JNO)/ 255. * 100 , X6X(JBO)/ 255. * 100 , 0)
			call SetMultiboardItemValueColor(MainMultiboard, 3, k + 3 + SentinelUserCount, X6X(JAO)/ 255. * 100 , X6X(JNO)/ 255. * 100 , X6X(JBO)/ 255. * 100 , 0)
		else
			call SetMultiboardItemText(MainMultiboard, 1, k + 3 + SentinelUserCount, "|c00333333" +(PlayersName[pid])+ "|r")
		endif
		call SetMultiboardItemText(MainMultiboard, 5, k + 3 + SentinelUserCount, "|c00ff0303" + "0|r")
		call SetMultiboardItemText(MainMultiboard, 6, k + 3 + SentinelUserCount, "|c000042ff" + "0|r")
		call SetMultiboardItemText(MainMultiboard, 7, k + 3 + SentinelUserCount, "|c00646464" + "0|r")
		set k = k + 1
	endloop
	if IsGameHaveObserver and(LocalPlayer== ObserverPlayer1 or LocalPlayer== ObserverPlayer2) and D3V == 1 then
		call MultiboardDisplay(MainMultiboard, false)
	endif
	call SetMultiboardItemStyle(MainMultiboard, 8, 1, false, true)
	call SetMultiboardItemIcon(MainMultiboard, 8, 1, "UI\\Feedback\\Resources\\ResourceGold.blp")
	if D3V > 1 then
		call TriggerExecute(UpdateMainMultiboardPlayerKDATrig)
	endif
	set p = null
endfunction
function UpdateMainMultiboardPlayerKDAAction takes nothing returns nothing
	local integer i
	local integer k
	call SetMultiboardItemText(MainMultiboard, 5, 2, "|c00ff0303" + I2S(PlayerKillHerosCount[GetPlayerId(SentinelPlayers[0])])+ "|r")
	call SetMultiboardItemText(MainMultiboard, 6, 2, "|c000042ff" + I2S(PlayerHeroDeathCount[GetPlayerId(SentinelPlayers[0])])+ "|r")
	call SetMultiboardItemText(MainMultiboard, 5, 3 + SentinelUserCount, "|c00ff0303" + I2S(PlayerKillHerosCount[GetPlayerId(ScourgePlayers[0])])+ "|r")
	call SetMultiboardItemText(MainMultiboard, 6, 3 + SentinelUserCount, "|c000042ff" + I2S(PlayerHeroDeathCount[GetPlayerId(ScourgePlayers[0])])+ "|r")
	set i = 1
	set k = SentinelUserCount
	loop
	exitwhen i > k
		call SetMultiboardItemText(MainMultiboard, 5,(i + 2), "|c00ff0303" + I2S(PlayerKillHerosCount[GetPlayerId(SentinelUsers[i])])+ "|r")
		call SetMultiboardItemText(MainMultiboard, 6,(i + 2), "|c000042ff" + I2S(PlayerHeroDeathCount[GetPlayerId(SentinelUsers[i])])+ "|r")
		call SetMultiboardItemText(MainMultiboard, 7,(i + 2), "|c00646464" + I2S(PlayerAssistCount[GetPlayerId(SentinelUsers[i])])+ "|r")
		set i = i + 1
	endloop
	set i = 1
	set k = ScourgeUserCount
	loop
	exitwhen i > k
		call SetMultiboardItemText(MainMultiboard, 5,(i + 3 + SentinelUserCount), "|c00ff0303" + I2S(PlayerKillHerosCount[GetPlayerId(ScourgeUsers[i])])+ "|r")
		call SetMultiboardItemText(MainMultiboard, 6,(i + 3 + SentinelUserCount), "|c000042ff" + I2S(PlayerHeroDeathCount[GetPlayerId(ScourgeUsers[i])])+ "|r")
		call SetMultiboardItemText(MainMultiboard, 7,(i + 3 + SentinelUserCount), "|c00646464" + I2S(PlayerAssistCount[GetPlayerId(ScourgeUsers[i])])+ "|r")
		set i = i + 1
	endloop
endfunction
function JDO takes integer a returns integer
	local integer i = 0
	local integer x = 0
	local string s = I2S(a)
	loop
	exitwhen i > StringLength(s)
		if SubString(s, i, i + 1) == "1"then
			set x = x + 1
		endif
		set i = i + 1
	endloop
	return x
endfunction
function GetPlayerInfoIconBySlot takes player p, integer k returns string
	if IsPlayerAlly(LocalPlayer, p) then
		if IsPlayersEnableSkillInfo[LocalPlayerId] then
			if k <= 4 + ExtraSkillsNumber then
				return HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(p)* HL + k]]
			else
				return "UI\\Widgets\\Console\\Undead\\undead-inventory-slotfiller.blp"
			endif
		endif
		return GetItemIcon(UnitItemInSlot(Player__Hero[GetPlayerId(p)], k -1))
	else
		return "UI\\Widgets\\Console\\Undead\\undead-inventory-slotfiller.blp"
	endif
endfunction
function GetLocalChargesText takes nothing returns string
	local integer pid = LocalPlayerId
	local string str = ""
	if LoadBoolean(OtherHashTable, GetHandleId(LocalPlayer),'OptC') then
		return""
	endif
	if GetUnitAbilityLevel(Player__Hero[pid],'A0K9')> 0 then
		set str = str + "|c0064a8e5"
		set str = str + I2S(LoadInteger(HY, GetHandleId(Player__Hero[pid]),'A0K9'))
		set str = str + " (" + I2S(R2I(LoadReal(HY, GetHandleId(LoadTriggerHandle(HY, GetHandleId(Player__Hero[pid]),'A0K9')), 0)))+ ")"
		set str = str + "|r;"
	endif
	if GetUnitAbilityLevel(Player__Hero[pid],'A34J')> 0 then
		if str != "" then
			set str = str + " "
		endif
		set str = str + "|c009621c4"
		set str = str + I2S(LoadInteger(HY, GetHandleId(Player__Hero[pid]),'A34J'))
		set str = str + " (" + I2S(R2I(LoadReal(HY, GetHandleId(LoadTriggerHandle(HY, GetHandleId(Player__Hero[pid]),'A34J')), 0)))+ ")"
		set str = str + "|r;"
	endif
	if GetUnitAbilityLevel(Player__Hero[pid],'A064')> 0 then
		if str != "" then
			set str = str + " "
		endif
		set str = str + "|c00dcf1f7"
		set str = str + I2S(LoadInteger(HY, GetHandleId(Player__Hero[pid]),'A064'))
		set str = str + " (" + I2S(R2I(LoadReal(HY, GetHandleId(LoadTriggerHandle(HY, GetHandleId(Player__Hero[pid]),'A064')), 0)))+ ")"
		set str = str + "|r;"
	endif
	if str != "" then
		set str = "充能点数: " + str
	endif
	return str
endfunction
function UpdateMainMultiboardLoopAction takes nothing returns nothing
	local integer loop_i
	local integer loop_max
	local string KGX
	local real time
	local string s1 = " "
	local integer r
	local integer i
	/*
	local integer array time_1a
	local string array color_1a
	local integer index_1a = 0
	local integer array time_1b
	local string array color_1b
	local integer index_1b = 0
	*/
	local integer x = 0
	local integer id

	local string killText
	local string deathText
	local string assistText
	local string lastHitText
	local string denyText

	local string s2 = " "
	local string s
	local string cooldown2Text
	local real cooldown1Value
	local real cooldown2Value
	local string spacer
	//local integer JWO = 0
	local string sentinelsReviveText = ""
	local string scourgesReviveText = ""
	local integer sentinelsReviveCount = 0
	local integer scourgesReviveCount = 0
	local string J1O = ""
	local integer pid
	local string chargesString = ""
	if MainMultiboard == null then
		return
	endif
	set chargesString = GetLocalChargesText()
	set i = 1
	loop
	exitwhen i > 5
		set pid = GetPlayerId(SentinelPlayers[i])
		set r = R2I(TimerGetRemaining(PS[pid]))
		if r > 0 then // 剩余复活时间？ 标题上显示的复活剩余复活时间 根据英雄颜色
			//set JWO = JWO + JDO(r)
			if sentinelsReviveCount == 0 then
				if r < 10 then
					set sentinelsReviveText = PlayersColoerText[pid] + "0" + I2S(r)+ " |r"
				else
					set sentinelsReviveText = PlayersColoerText[pid] + I2S(r)+ " |r"
				endif
			else
				if r < 10 then
					set sentinelsReviveText = sentinelsReviveText + "|c00ffffff" + "| |r" + PlayersColoerText[pid] + "0" + I2S(r)+ " |r"
				else
					set sentinelsReviveText = sentinelsReviveText + "|c00ffffff" + "| |r" + PlayersColoerText[pid] + I2S(r)+ " |r"
				endif
			endif
			set sentinelsReviveCount = sentinelsReviveCount + 1
		endif
		set i = i + 1
	endloop
	if sentinelsReviveCount > 0 then
		if IsPlayerAlly(LocalPlayer, SentinelPlayers[0]) then
			set sentinelsReviveText = "|c00ffffff" + "[" + GetObjectName('n0JS')+ " |r" + sentinelsReviveText + "|c00ffffff" + "]|r"
		else
			set sentinelsReviveText = "|c00ff0303" + "[" + GetObjectName('n0JR')+ " |r" + sentinelsReviveText + "|c00ff0303" + "]|r"
		endif
	endif
	set i = 1
	loop
	exitwhen i > 5
		set pid = GetPlayerId(ScourgePlayers[i])
		set r = R2I(TimerGetRemaining(PS[pid]))
		if r > 0 then
			//set JWO = JWO + JDO(r)
			if scourgesReviveCount == 0 then
				if r < 10 then
					set scourgesReviveText = PlayersColoerText[pid] + "0" + I2S(r)+ " |r"
				else
					set scourgesReviveText = PlayersColoerText[pid] + I2S(r)+ " |r"
				endif
			else
				if r < 10 then
					set scourgesReviveText = scourgesReviveText + "|c00ffffff" + "| |r" + PlayersColoerText[pid] + "0" + I2S(r)+ " |r"
				else
					set scourgesReviveText = scourgesReviveText + "|c00ffffff" + "| |r" + PlayersColoerText[pid] + I2S(r)+ " |r"
				endif
			endif
			set scourgesReviveCount = scourgesReviveCount + 1
		endif
		set i = i + 1
	endloop
	if scourgesReviveCount > 0 then
		if IsPlayerAlly(LocalPlayer, ScourgePlayers[0]) then
			set scourgesReviveText = "|c00ffffff" + "[" + GetObjectName('n0JS')+ " |r" + scourgesReviveText + "|c00ffffff" + "]|r"
		else
			set scourgesReviveText = "|c00ff0303" + "[" + GetObjectName('n0JR')+ " |r" + scourgesReviveText + "|c00ff0303" + "]|r"
		endif
	endif
	if MainMultiboard != null then
		// 本地战绩
		set id = LocalPlayerId
		if id >= 0 and id < 16 then
			if PlayerShowKDA[id] then
				set killText    = I2S(PlayerKillHerosCount[id])     // kill
				set deathText   = I2S(PlayerHeroDeathCount[id])     // death
				set assistText  = I2S(PlayerAssistCount[id]) 	    // assist
				set lastHitText = I2S(PlayerCreepLastHitCount[id]) // 正补last hit
				set denyText    = I2S(PlayerCreepDenyCount[id])    // 反补deny
				set s2 = " |c00838B8B(" + killText + "/" + deathText + "/" + assistText + " - " + lastHitText + "/" + denyText + " - |r|c00FFDC00" + I2S(PlayersReliableGold[id])+ "|r |c00838B8B)|r"
			endif
		endif
	endif
	if scourgesReviveCount == 0 and sentinelsReviveCount == 0 then
		call MultiboardSetTitleText(MainMultiboard, chargesString + s2)
	else
		if IsPlayerAlly(LocalPlayer, SentinelPlayers[0]) then
			call MultiboardSetTitleText(MainMultiboard, chargesString + scourgesReviveText + " " + sentinelsReviveText + " " + s2)
		else
			call MultiboardSetTitleText(MainMultiboard, chargesString + sentinelsReviveText + " " + scourgesReviveText + " " + s2)
		endif
	endif
	if not IsPickingHero then
		if (IsGameHaveObserver and(LocalPlayer== ObserverPlayer1 or LocalPlayer== ObserverPlayer2)) == false then
			call MultiboardDisplay(MainMultiboard, true)
		endif
	endif
	// 什么天才 在多面板刷新动作中刷新水的颜色？
	if GBV[LocalPlayerId]== false then
		call SetWaterBaseColor(0, 0, 255, 255)
	endif
	set loop_i = 1
	set loop_max = SentinelUserCount
	// 近卫的循环
	loop
	exitwhen loop_i > loop_max
		set pid = GetPlayerId(SentinelUsers[loop_i])
		call SetMultiboardItemIcon(MainMultiboard, 1, loop_i + 2, GetHeroIconFilePath(Player__Hero[pid])) // 刷新头像？
		call SetMultiboardItemText(MainMultiboard, 4, loop_i + 2, "|c00838B8B" + I2S(GetHeroLevel(Player__Hero[pid]))+ "|r") // 英雄等级
		if IsPlayersEnableItemInfo[LocalPlayerId] then // -ii? loop_i + 2 = 自己
			call SetMultiboardItemWidth(MainMultiboard, 8, 1, 3)
			call SetMultiboardItemWidth(MainMultiboard, 9, 1, 2.8)
			call SetMultiboardItemWidth(MainMultiboard, 10, 1, .8)
			call SetMultiboardItemWidth(MainMultiboard, 11, 1, .8)
			call SetMultiboardItemWidth(MainMultiboard, 12, 1, .8)
			call SetMultiboardItemWidth(MainMultiboard, 13, 1, .8)
			call SetMultiboardItemWidth(MainMultiboard, 14, 1, .1)
			call SetMultiboardItemWidth(MainMultiboard, 8, loop_i + 2, 3)
			call SetMultiboardItemWidth(MainMultiboard, 9, loop_i + 2, 1.1)
			call SetMultiboardItemWidth(MainMultiboard, 10, loop_i + 2, 1.1)
			call SetMultiboardItemWidth(MainMultiboard, 11, loop_i + 2, 1.1)
			call SetMultiboardItemWidth(MainMultiboard, 12, loop_i + 2, 1.1)
			call SetMultiboardItemWidth(MainMultiboard, 13, loop_i + 2, 1.1)
			call SetMultiboardItemWidth(MainMultiboard, 14, loop_i + 2, .1)
			call SetMultiboardItemStyle(MainMultiboard, 9, loop_i + 2, false, true)
			call SetMultiboardItemStyle(MainMultiboard, 10, loop_i + 2, false, true)
			call SetMultiboardItemStyle(MainMultiboard, 11, loop_i + 2, false, true)
			call SetMultiboardItemStyle(MainMultiboard, 12, loop_i + 2, false, true)
			call SetMultiboardItemStyle(MainMultiboard, 13, loop_i + 2, false, true)
			call SetMultiboardItemStyle(MainMultiboard, 14, loop_i + 2, false, true)
			call SetMultiboardItemText(MainMultiboard, 9, 1, "物品")
		elseif IsPlayersEnableSkillInfo[LocalPlayerId] then // -si
			call SetMultiboardItemWidth(MainMultiboard, 8, 1, 3)
			call SetMultiboardItemWidth(MainMultiboard, 9, 1, 2.8)
			call SetMultiboardItemWidth(MainMultiboard, 10, 1, .8)
			call SetMultiboardItemWidth(MainMultiboard, 11, 1, .8)
			call SetMultiboardItemWidth(MainMultiboard, 12, 1, .8)
			call SetMultiboardItemWidth(MainMultiboard, 13, 1, .8)
			call SetMultiboardItemWidth(MainMultiboard, 14, 1, .1)
			call SetMultiboardItemWidth(MainMultiboard, 8, loop_i + 2, 3)
			call SetMultiboardItemWidth(MainMultiboard, 9, loop_i + 2, 1.1)
			call SetMultiboardItemWidth(MainMultiboard, 10, loop_i + 2, 1.1)
			call SetMultiboardItemWidth(MainMultiboard, 11, loop_i + 2, 1.1)
			if ExtraSkillsNumber >= 1 then
				call SetMultiboardItemWidth(MainMultiboard, 12, loop_i + 2, 1.1)
			else
				call SetMultiboardItemWidth(MainMultiboard, 12, loop_i + 2, .1)
			endif
			if ExtraSkillsNumber >= 2 then
				call SetMultiboardItemWidth(MainMultiboard, 13, loop_i + 2, 1.1)
			else
				call SetMultiboardItemWidth(MainMultiboard, 13, loop_i + 2, .1)
			endif
			call SetMultiboardItemWidth(MainMultiboard, 14, loop_i + 2, .1)
			call SetMultiboardItemStyle(MainMultiboard, 9, loop_i + 2, false, true)
			call SetMultiboardItemStyle(MainMultiboard, 10, loop_i + 2, false, true)
			call SetMultiboardItemStyle(MainMultiboard, 11, loop_i + 2, false, true)
			call SetMultiboardItemStyle(MainMultiboard, 12, loop_i + 2, false, true)
			if ExtraSkillsNumber >= 1 then
				call SetMultiboardItemStyle(MainMultiboard, 13, loop_i + 2, false, true)
			else
				call SetMultiboardItemStyle(MainMultiboard, 13, loop_i + 2, false, false)
			endif
			if ExtraSkillsNumber >= 2 then
				call SetMultiboardItemStyle(MainMultiboard, 14, loop_i + 2, false, true)
			else
				call SetMultiboardItemStyle(MainMultiboard, 14, loop_i + 2, false, false)
			endif
			call SetMultiboardItemText(MainMultiboard, 9, 1, "技能")
		else
			call SetMultiboardItemWidth(MainMultiboard, 8, 1, 2)
			call SetMultiboardItemWidth(MainMultiboard, 9, 1, .1)
			call SetMultiboardItemWidth(MainMultiboard, 10, 1, .1)
			call SetMultiboardItemWidth(MainMultiboard, 11, 1, .1)
			call SetMultiboardItemWidth(MainMultiboard, 12, 1, .1)
			call SetMultiboardItemWidth(MainMultiboard, 13, 1, .1)
			call SetMultiboardItemWidth(MainMultiboard, 14, 1, .1)
			call SetMultiboardItemWidth(MainMultiboard, 8, loop_i + 2, 2.5)
			call SetMultiboardItemWidth(MainMultiboard, 9, loop_i + 2, .1)
			call SetMultiboardItemWidth(MainMultiboard, 10, loop_i + 2, .1)
			call SetMultiboardItemWidth(MainMultiboard, 11, loop_i + 2, .1)
			call SetMultiboardItemWidth(MainMultiboard, 12, loop_i + 2, .1)
			call SetMultiboardItemWidth(MainMultiboard, 13, loop_i + 2, .1)
			call SetMultiboardItemWidth(MainMultiboard, 14, loop_i + 2, .1)
			call SetMultiboardItemStyle(MainMultiboard, 9, loop_i + 2, false, false)
			call SetMultiboardItemStyle(MainMultiboard, 10, loop_i + 2, false, false)
			call SetMultiboardItemStyle(MainMultiboard, 11, loop_i + 2, false, false)
			call SetMultiboardItemStyle(MainMultiboard, 12, loop_i + 2, false, false)
			call SetMultiboardItemStyle(MainMultiboard, 13, loop_i + 2, false, false)
			call SetMultiboardItemStyle(MainMultiboard, 14, loop_i + 2, false, false)
			call SetMultiboardItemText(MainMultiboard, 9, 1, " ")
		endif
		call SetMultiboardItemIcon(MainMultiboard, 9,  loop_i + 2, GetPlayerInfoIconBySlot(SentinelUsers[loop_i], 1))
		call SetMultiboardItemIcon(MainMultiboard, 10, loop_i + 2, GetPlayerInfoIconBySlot(SentinelUsers[loop_i], 2))
		call SetMultiboardItemIcon(MainMultiboard, 11, loop_i + 2, GetPlayerInfoIconBySlot(SentinelUsers[loop_i], 3))
		call SetMultiboardItemIcon(MainMultiboard, 12, loop_i + 2, GetPlayerInfoIconBySlot(SentinelUsers[loop_i], 4))
		call SetMultiboardItemIcon(MainMultiboard, 13, loop_i + 2, GetPlayerInfoIconBySlot(SentinelUsers[loop_i], 5))
		call SetMultiboardItemIcon(MainMultiboard, 14, loop_i + 2, GetPlayerInfoIconBySlot(SentinelUsers[loop_i], 6))
		set pid = GetPlayerId(SentinelUsers[loop_i])
		if (E8X(Player__Hero[pid]) and Player__Hero[pid]!= null and TimerGetRemaining(PS[pid])> 0) then
			if IsPlayerAlly(LocalPlayer, SentinelUsers[loop_i]) then
				set J1O = "|c00ffffff" + " (" + I2S(R2I(TimerGetRemaining(PS[pid])))+ ")|r"
			else
				set J1O = "|c00ff0303" + " (" + I2S(R2I(TimerGetRemaining(PS[pid])))+ ")|r"
			endif
		else
			set J1O = "  "
		endif
		if EJV[pid] then
			call SetMultiboardItemText(MainMultiboard, 1, loop_i + 2, TM + "|c00333333" +(PlayersName[pid])+ "|r" + J1O)
		else
			call SetMultiboardItemText(MainMultiboard, 1, loop_i + 2, TM +(PlayersName[pid])+ J1O)
		endif
		set cooldown1Value =(TimerGetRemaining(ESV[pid]))
		if cooldown1Value > 0 then
			set s = I2S(R2I(cooldown1Value))
		else
			set s = " "
		endif
		set cooldown2Value =(TimerGetRemaining(ETV[pid]))
		if cooldown2Value > 0 then
			set cooldown2Text = I2S(R2I(cooldown2Value))
		else
			set cooldown2Text = " "
		endif
		// 追踪术可以看到他的钱和大招冷却？
		if IsPlayerEnemy(LocalPlayer, SentinelUsers[loop_i]) and GetUnitAbilityLevel(Player__Hero[GetPlayerId(SentinelUsers[loop_i])],'B00L') == 0 then
			call SetMultiboardItemText(MainMultiboard, 8, loop_i + 2, " ")
			set s = " "
			set cooldown2Text = " "
		else
			call SetMultiboardItemText(MainMultiboard, 8, loop_i + 2, "|cffffcc00" + I2S(R2I(GetPlayerState(SentinelUsers[loop_i], PLAYER_STATE_RESOURCE_GOLD)))+ "|r")
		endif
		call SetMultiboardItemText(MainMultiboard, 2, loop_i + 2, s)
		call SetMultiboardItemText(MainMultiboard, 3, loop_i + 2, cooldown2Text)
		set loop_i = loop_i + 1
	endloop
	// 天灾的循环
	set loop_i = 1
	set loop_max = ScourgeUserCount
	loop
	exitwhen loop_i > loop_max
		set pid = GetPlayerId(ScourgeUsers[loop_i])
		call SetMultiboardItemIcon(MainMultiboard, 1, loop_i + 3 + SentinelUserCount, GetHeroIconFilePath(Player__Hero[pid]))
		call SetMultiboardItemText(MainMultiboard, 4, loop_i + 3 + SentinelUserCount, "|c00838B8B" + I2S(GetHeroLevel(Player__Hero[pid]))+ "|r")
		if IsPlayersEnableItemInfo[LocalPlayerId] then
			call SetMultiboardItemWidth(MainMultiboard, 8,  1, 3)
			call SetMultiboardItemWidth(MainMultiboard, 9,  1, 2.8)
			call SetMultiboardItemWidth(MainMultiboard, 10, 1, .8)
			call SetMultiboardItemWidth(MainMultiboard, 11, 1, .8)
			call SetMultiboardItemWidth(MainMultiboard, 12, 1, .8)
			call SetMultiboardItemWidth(MainMultiboard, 13, 1, .8)
			call SetMultiboardItemWidth(MainMultiboard, 14, 1, .1)
			call SetMultiboardItemWidth(MainMultiboard, 8,  loop_i + 3 + SentinelUserCount, 3)
			call SetMultiboardItemWidth(MainMultiboard, 9,  loop_i + 3 + SentinelUserCount, 1.1)
			call SetMultiboardItemWidth(MainMultiboard, 10, loop_i + 3 + SentinelUserCount, 1.1)
			call SetMultiboardItemWidth(MainMultiboard, 11, loop_i + 3 + SentinelUserCount, 1.1)
			call SetMultiboardItemWidth(MainMultiboard, 12, loop_i + 3 + SentinelUserCount, 1.1)
			call SetMultiboardItemWidth(MainMultiboard, 13, loop_i + 3 + SentinelUserCount, 1.1)
			call SetMultiboardItemWidth(MainMultiboard, 14, loop_i + 3 + SentinelUserCount, .1)
			call SetMultiboardItemStyle(MainMultiboard, 9,  loop_i + 3 + SentinelUserCount, false, true)
			call SetMultiboardItemStyle(MainMultiboard, 10, loop_i + 3 + SentinelUserCount, false, true)
			call SetMultiboardItemStyle(MainMultiboard, 11, loop_i + 3 + SentinelUserCount, false, true)
			call SetMultiboardItemStyle(MainMultiboard, 12, loop_i + 3 + SentinelUserCount, false, true)
			call SetMultiboardItemStyle(MainMultiboard, 13, loop_i + 3 + SentinelUserCount, false, true)
			call SetMultiboardItemStyle(MainMultiboard, 14, loop_i + 3 + SentinelUserCount, false, true)
			call SetMultiboardItemText(MainMultiboard, 9, 1, "物品")
		elseif IsPlayersEnableSkillInfo[LocalPlayerId] then
			call SetMultiboardItemWidth(MainMultiboard, 8,  1, 3)
			call SetMultiboardItemWidth(MainMultiboard, 9,  1, 2.8)
			call SetMultiboardItemWidth(MainMultiboard, 10, 1, .8)
			call SetMultiboardItemWidth(MainMultiboard, 11, 1, .8)
			call SetMultiboardItemWidth(MainMultiboard, 12, 1, .8)
			call SetMultiboardItemWidth(MainMultiboard, 13, 1, .8)
			call SetMultiboardItemWidth(MainMultiboard, 14, 1, .1)
			call SetMultiboardItemWidth(MainMultiboard, 8,  loop_i + 3 + SentinelUserCount, 3)
			call SetMultiboardItemWidth(MainMultiboard, 9,  loop_i + 3 + SentinelUserCount, 1.1)
			call SetMultiboardItemWidth(MainMultiboard, 10, loop_i + 3 + SentinelUserCount, 1.1)
			call SetMultiboardItemWidth(MainMultiboard, 11, loop_i + 3 + SentinelUserCount, 1.1)
			if ExtraSkillsNumber >= 1 then
				call SetMultiboardItemWidth(MainMultiboard, 12, loop_i + 3 + SentinelUserCount, 1.1)
			else
				call SetMultiboardItemWidth(MainMultiboard, 12, loop_i + 3 + SentinelUserCount, .1)
			endif
			if ExtraSkillsNumber >= 2 then
				call SetMultiboardItemWidth(MainMultiboard, 13, loop_i + 3 + SentinelUserCount, 1.1)
			else
				call SetMultiboardItemWidth(MainMultiboard, 13, loop_i + 3 + SentinelUserCount, .1)
			endif
			call SetMultiboardItemWidth(MainMultiboard, 14, loop_i + 3 + SentinelUserCount, .1)
			call SetMultiboardItemStyle(MainMultiboard, 9,  loop_i + 3 + SentinelUserCount, false, true)
			call SetMultiboardItemStyle(MainMultiboard, 10, loop_i + 3 + SentinelUserCount, false, true)
			call SetMultiboardItemStyle(MainMultiboard, 11, loop_i + 3 + SentinelUserCount, false, true)
			call SetMultiboardItemStyle(MainMultiboard, 12, loop_i + 3 + SentinelUserCount, false, true)
			if ExtraSkillsNumber >= 1 then
				call SetMultiboardItemStyle(MainMultiboard, 13, loop_i + 3 + SentinelUserCount, false, true)
			else
				call SetMultiboardItemStyle(MainMultiboard, 13, loop_i + 3 + SentinelUserCount, false, false)
			endif
			if ExtraSkillsNumber >= 2 then
				call SetMultiboardItemStyle(MainMultiboard, 14, loop_i + 3 + SentinelUserCount, false, true)
			else
				call SetMultiboardItemStyle(MainMultiboard, 14, loop_i + 3 + SentinelUserCount, false, false)
			endif
			call SetMultiboardItemText(MainMultiboard, 9, 1, "技能")
		else
			call SetMultiboardItemWidth(MainMultiboard, 8,  1, 2)
			call SetMultiboardItemWidth(MainMultiboard, 9,  1, .1)
			call SetMultiboardItemWidth(MainMultiboard, 10, 1, .1)
			call SetMultiboardItemWidth(MainMultiboard, 11, 1, .1)
			call SetMultiboardItemWidth(MainMultiboard, 12, 1, .1)
			call SetMultiboardItemWidth(MainMultiboard, 13, 1, .1)
			call SetMultiboardItemWidth(MainMultiboard, 14, 1, .1)
			call SetMultiboardItemWidth(MainMultiboard, 8,  loop_i + 3 + SentinelUserCount, 2.5)
			call SetMultiboardItemWidth(MainMultiboard, 9,  loop_i + 3 + SentinelUserCount, .1)
			call SetMultiboardItemWidth(MainMultiboard, 10, loop_i + 3 + SentinelUserCount, .1)
			call SetMultiboardItemWidth(MainMultiboard, 11, loop_i + 3 + SentinelUserCount, .1)
			call SetMultiboardItemWidth(MainMultiboard, 12, loop_i + 3 + SentinelUserCount, .1)
			call SetMultiboardItemWidth(MainMultiboard, 13, loop_i + 3 + SentinelUserCount, .1)
			call SetMultiboardItemWidth(MainMultiboard, 14, loop_i + 3 + SentinelUserCount, .1)
			call SetMultiboardItemStyle(MainMultiboard, 9,  loop_i + 3 + SentinelUserCount, false, false)
			call SetMultiboardItemStyle(MainMultiboard, 10, loop_i + 3 + SentinelUserCount, false, false)
			call SetMultiboardItemStyle(MainMultiboard, 11, loop_i + 3 + SentinelUserCount, false, false)
			call SetMultiboardItemStyle(MainMultiboard, 12, loop_i + 3 + SentinelUserCount, false, false)
			call SetMultiboardItemStyle(MainMultiboard, 13, loop_i + 3 + SentinelUserCount, false, false)
			call SetMultiboardItemStyle(MainMultiboard, 14, loop_i + 3 + SentinelUserCount, false, false)
			call SetMultiboardItemText(MainMultiboard, 9, 1, " ")
		endif
		call SetMultiboardItemIcon(MainMultiboard, 9,  loop_i + 3 + SentinelUserCount, GetPlayerInfoIconBySlot(ScourgeUsers[loop_i], 1))
		call SetMultiboardItemIcon(MainMultiboard, 10, loop_i + 3 + SentinelUserCount, GetPlayerInfoIconBySlot(ScourgeUsers[loop_i], 2))
		call SetMultiboardItemIcon(MainMultiboard, 11, loop_i + 3 + SentinelUserCount, GetPlayerInfoIconBySlot(ScourgeUsers[loop_i], 3))
		call SetMultiboardItemIcon(MainMultiboard, 12, loop_i + 3 + SentinelUserCount, GetPlayerInfoIconBySlot(ScourgeUsers[loop_i], 4))
		call SetMultiboardItemIcon(MainMultiboard, 13, loop_i + 3 + SentinelUserCount, GetPlayerInfoIconBySlot(ScourgeUsers[loop_i], 5))
		call SetMultiboardItemIcon(MainMultiboard, 14, loop_i + 3 + SentinelUserCount, GetPlayerInfoIconBySlot(ScourgeUsers[loop_i], 6))
		set pid = GetPlayerId(ScourgeUsers[loop_i])
		if (E8X(Player__Hero[pid]) and Player__Hero[pid]!= null and TimerGetRemaining(PS[pid])> 0) then
			if IsPlayerAlly(LocalPlayer, ScourgeUsers[loop_i]) then
				set J1O = "|c00ffffff" + " (" + I2S(R2I(TimerGetRemaining(PS[pid])))+ ")|r"
			else
				set J1O = "|c00ff0303" + " (" + I2S(R2I(TimerGetRemaining(PS[pid])))+ ")|r"
			endif
		else
			set J1O = "  "
		endif
		if EJV[pid] then
			call SetMultiboardItemText(MainMultiboard, 1, loop_i + 3 + SentinelUserCount, TM + "|c00333333" +(PlayersName[pid])+ "|r" + J1O)
		else
			call SetMultiboardItemText(MainMultiboard, 1, loop_i + 3 + SentinelUserCount, TM +(PlayersName[pid])+ J1O)
		endif
		set cooldown1Value = TimerGetRemaining(ESV[pid])
		if cooldown1Value > 0 then
			set s = I2S(R2I(cooldown1Value))
		else
			set s = " "
		endif
		set cooldown2Value = TimerGetRemaining(ETV[pid])
		if cooldown2Value > 0 then
			set cooldown2Text = I2S(R2I(cooldown2Value))
		else
			set cooldown2Text = " "
		endif
		if IsPlayerEnemy(LocalPlayer, ScourgeUsers[loop_i]) and GetUnitAbilityLevel(Player__Hero[GetPlayerId(ScourgeUsers[loop_i])],'B00L') == 0 then
			call SetMultiboardItemText(MainMultiboard, 8, loop_i + 3 + SentinelUserCount, " ")
			set s = " "
			set cooldown2Text = " "
		else
			call SetMultiboardItemText(MainMultiboard, 8, loop_i + 3 + SentinelUserCount, "|cffffcc00" + I2S(R2I(GetPlayerState(ScourgeUsers[loop_i], PLAYER_STATE_RESOURCE_GOLD)))+ "|r")
		endif
		call SetMultiboardItemText(MainMultiboard, 2, loop_i + 3 + SentinelUserCount, s)
		call SetMultiboardItemText(MainMultiboard, 3, loop_i + 3 + SentinelUserCount, cooldown2Text)
		set loop_i = loop_i + 1
	endloop
endfunction
function K8O takes player p returns string
	return PlayersColoerText[GetPlayerId(p)] +(PlayersName[GetPlayerId((p))])+ "|r"
endfunction
function K9O takes player p returns string
	local integer k = PlayerLastHitTowerCount[GetPlayerId(p)]
	local integer d = PlayerDenyTowerCount[GetPlayerId(p)]
	if k < 1 then
		set k = 0
	endif
	if d < 1 then
		set d = 0
	endif
	return I2S(k)+ "/" + I2S(d)
endfunction
function LVO takes player p returns string
	local integer KLO = PlayerDeathTime[GetPlayerId(p)]
	local string KGX
	local integer minute
	local integer second
	set minute =(KLO / 60)-(1 / 2)
	set second = ModuloInteger(KLO, 60)
	if (second < 10) then
		set KGX = I2S(minute)+ ":0" + I2S(second)
	else
		set KGX = I2S(minute)+ ":" + I2S(second)
	endif
	return KGX
endfunction
function LEO takes player whichUnit, player targetUnit returns string
	local integer k =(LoadInteger(HY,(400 + GetPlayerId(whichUnit)),(450 + GetPlayerId(targetUnit))))
	local integer d =(LoadInteger(HY,(400 + GetPlayerId(whichUnit)),(500 + GetPlayerId(targetUnit))))
	if k < 1 then
		set k = 0
	endif
	if d < 1 then
		set d = 0
	endif
	return I2S(k)+ "/" + I2S(d)
endfunction
function LXO takes player whichUnit returns string
	local string LOO
	if UnitIsDead(Player__Hero[GetPlayerId(whichUnit)]) then
		set LOO = I2S(R2I(TimerGetRemaining(PS[GetPlayerId(whichUnit)])))
	else
		set LOO = " "
	endif
	return LOO
endfunction
function LRO takes player whichUnit returns string
	local real r =(TimerGetRemaining(ESV[GetPlayerId((whichUnit))]))
	local string LOO
	if r > 0 then
		set LOO = I2S(R2I(r))
	else
		set LOO = " "
	endif
	return LOO
endfunction
function ob_tab0 takes nothing returns nothing
	call MultiboardMinimize(FEV, true)
endfunction
function ob_tab1 takes nothing returns nothing
	call MultiboardMinimize(FEV, false)
endfunction
function LIO takes integer LAO, integer LNO returns nothing		//Ob的Tab切换多面板
	set FEV = CreateMultiboard()
	call MultiboardSetItemsWidth(FEV, 0)
	call MultiboardSetRowCount(FEV, LAO)
	call MultiboardSetColumnCount(FEV, LNO)
	call MultiboardSetTitleText(FEV, GetObjectName('n0E3')+ " " + " - " +(GameModeString))
	call MultiboardMinimize(FEV, true)
	call MultiboardSetItemsStyle(FEV, false, false)
	if (LocalPlayer== ObserverPlayer1 or LocalPlayer== ObserverPlayer2) then
		call MultiboardDisplay(FEV, true)
		call DzTriggerRegisterKeyEventByCode(null, 9, 0, false, function ob_tab0)
		call DzTriggerRegisterKeyEventByCode(null, 9, 1, false, function ob_tab1)
	endif
endfunction
function LBO takes nothing returns nothing
	local integer LCO = IM1
	local integer LDO = N1
	local player array K0O
	local player array K1O
	local integer K2O
	local integer K3O
	local integer K4O = 1 + 21 + IMaxBJ(LCO, LDO)
	local integer K5O = 1 +(LCO + LDO)* 2
	local multiboarditem mbt
	local integer i
	local integer x
	local string e = "|r"
	local string c0 = "|cff99ccff"
	local integer K6O
	local integer K7O
	local integer LFO = 131
	local integer LGO = 139
	local integer LHO = 139
	local integer LJO = 255
	local integer JWO = 0
	local string sentinelsReviveText = ""
	local string scourgesReviveText = ""
	local integer sentinelsReviveCount = 0
	local integer scourgesReviveCount = 0
	local integer r
	if LCO > 0 and LDO > 0 then
		set K4O = K4O + 2
	endif
	if GetTriggerExecCount(GetTriggeringTrigger()) == 1 then
		call LIO(K4O, K5O)
	endif
	if IsGameHaveObserver and(LocalPlayer== ObserverPlayer1 or LocalPlayer== ObserverPlayer2) then
		call MultiboardDisplay(FEV, true)
	endif
	set i = 1
	loop
	exitwhen i > 5
		set r = R2I(TimerGetRemaining(PS[GetPlayerId(SentinelPlayers[i])]))
		if r > 0 then
			set JWO = JWO + JDO(r)
			if sentinelsReviveCount == 0 then
				if r < 10 then
					set sentinelsReviveText = PlayersColoerText[GetPlayerId(SentinelPlayers[i])] + "0" + I2S(r)+ " |r"
				else
					set sentinelsReviveText = PlayersColoerText[GetPlayerId(SentinelPlayers[i])] + I2S(r)+ " |r"
				endif
			else
				if r < 10 then
					set sentinelsReviveText = sentinelsReviveText + "|c00ffffff" + "| |r" + PlayersColoerText[GetPlayerId(SentinelPlayers[i])] + "0" + I2S(r)+ " |r"
				else
					set sentinelsReviveText = sentinelsReviveText + "|c00ffffff" + "| |r" + PlayersColoerText[GetPlayerId(SentinelPlayers[i])] + I2S(r)+ " |r"
				endif
			endif
			set sentinelsReviveCount = sentinelsReviveCount + 1
		endif
		set i = i + 1
	endloop
	if sentinelsReviveCount > 0 then
		set sentinelsReviveText = "|c00ffffff" + "[AW: |r" + sentinelsReviveText + "|c00ffffff" + "]|r"
	endif
	set i = 1
	loop
	exitwhen i > 5
		set r = R2I(TimerGetRemaining(PS[GetPlayerId(ScourgePlayers[i])]))
		if r > 0 then
			set JWO = JWO + JDO(r)
			if scourgesReviveCount == 0 then
				if r < 10 then
					set scourgesReviveText = PlayersColoerText[GetPlayerId(ScourgePlayers[i])] + "0" + I2S(r)+ " |r"
				else
					set scourgesReviveText = PlayersColoerText[GetPlayerId(ScourgePlayers[i])] + I2S(r)+ " |r"
				endif
			else
				if r < 10 then
					set scourgesReviveText = scourgesReviveText + "|c00ffffff" + "| |r" + PlayersColoerText[GetPlayerId(ScourgePlayers[i])] + "0" + I2S(r)+ " |r"
				else
					set scourgesReviveText = scourgesReviveText + "|c00ffffff" + "| |r" + PlayersColoerText[GetPlayerId(ScourgePlayers[i])] + I2S(r)+ " |r"
				endif
			endif
			set scourgesReviveCount = scourgesReviveCount + 1
		endif
		set i = i + 1
	endloop
	if scourgesReviveCount > 0 then
		set scourgesReviveText = "|c00ffffff" + "[天灾: |r" + scourgesReviveText + "|c00ffffff" + "]|r"
	endif
	call MultiboardSetTitleText(FEV, sentinelsReviveText + " " + scourgesReviveText + " " + GetObjectName('n0E3')+ "  - " + GameModeString + " - " +("|c00ff0303" + I2S(PlayerKillHerosCount[GetPlayerId(SentinelPlayers[0])])+ "|r/|c0020c000" + I2S(PlayerHeroDeathCount[GetPlayerId(SentinelPlayers[0])])+ "|r"))
	set x = 1
	set i = 1
	loop
	exitwhen i > 5
		if IsPlayingPlayer(SentinelPlayers[i]) or GetPlayerSlotState(SentinelPlayers[i]) == PLAYER_SLOT_STATE_LEFT then
			set K0O[x]= SentinelPlayers[i]
			set x = x + 1
		endif
		set i = i + 1
	endloop
	set x = 1
	set i = 1
	loop
	exitwhen i > 5
		if IsPlayingPlayer(ScourgePlayers[i]) or GetPlayerSlotState(ScourgePlayers[i]) == PLAYER_SLOT_STATE_LEFT then
			set K1O[x]= ScourgePlayers[i]
			set x = x + 1
		endif
		set i = i + 1
	endloop
	set i = 0
	set K3O = 0
	loop
	exitwhen i > K4O
		set mbt = MultiboardGetItem(FEV, i, K3O)
		call MultiboardSetItemWidth(mbt, .075)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K2O = 0
	set K3O = 0
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, " ")
	call MultiboardReleaseItem(mbt)
	set K3O = 0
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, false, false)
	call MultiboardReleaseItem(mbt)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, K8O(K0O[i]))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, K8O(K1O[i]))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, false, false)
	call MultiboardReleaseItem(mbt)
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, true)
		call MultiboardSetItemValue(mbt, "(" +(I2S(GetUnitLevel(Player__Hero[GetPlayerId((K0O[i]))])))+ ")")
		call MultiboardSetItemIcon(mbt,(GetHeroIconFilePath(Player__Hero[GetPlayerId((K0O[i]))])))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, true)
		call MultiboardSetItemValue(mbt, "(" + I2S(GetUnitLevel(Player__Hero[GetPlayerId(K1O[i])]))+ ")")
		call MultiboardSetItemIcon(mbt,(GetHeroIconFilePath(Player__Hero[GetPlayerId(K1O[i])])))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set K2O = K2O + 1
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + GetObjectName('n0EB')+ e)
	call MultiboardReleaseItem(mbt)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, GetItemIcon(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 1 -1)))
		call MultiboardSetItemWidth(mbt, .015)
		call MultiboardReleaseItem(mbt)
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, GetItemIcon(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 2 -1)))
		call MultiboardSetItemWidth(mbt, .054)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, GetItemIcon(UnitItemInSlot(Player__Hero[GetPlayerId(K1O[i])], 1 -1)))
		call MultiboardSetItemWidth(mbt, .015)
		call MultiboardReleaseItem(mbt)
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, GetItemIcon(UnitItemInSlot(Player__Hero[GetPlayerId(K1O[i])], 2 -1)))
		call MultiboardSetItemWidth(mbt, .054)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + " " + e)
	call MultiboardReleaseItem(mbt)
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, GetItemIcon(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 3 -1)))
		call MultiboardSetItemWidth(mbt, .015)
		call MultiboardReleaseItem(mbt)
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, GetItemIcon(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 4 -1)))
		call MultiboardSetItemWidth(mbt, .054)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, GetItemIcon(UnitItemInSlot(Player__Hero[GetPlayerId(K1O[i])], 3 -1)))
		call MultiboardSetItemWidth(mbt, .015)
		call MultiboardReleaseItem(mbt)
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, GetItemIcon(UnitItemInSlot(Player__Hero[GetPlayerId(K1O[i])], 4 -1)))
		call MultiboardSetItemWidth(mbt, .054)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + " " + e)
	call MultiboardReleaseItem(mbt)
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, GetItemIcon(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 5 -1)))
		call MultiboardSetItemWidth(mbt, .015)
		call MultiboardReleaseItem(mbt)
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, GetItemIcon(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 6 -1)))
		call MultiboardSetItemWidth(mbt, .054)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, GetItemIcon(UnitItemInSlot(Player__Hero[GetPlayerId(K1O[i])], 5 -1)))
		call MultiboardSetItemWidth(mbt, .015)
		call MultiboardReleaseItem(mbt)
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, GetItemIcon(UnitItemInSlot(Player__Hero[GetPlayerId(K1O[i])], 6 -1)))
		call MultiboardSetItemWidth(mbt, .054)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + GetObjectName('n0E2')+ e)
	call MultiboardReleaseItem(mbt)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, I2S(GetPlayerState(K0O[i], PLAYER_STATE_RESOURCE_GOLD)))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt,(I2S(GetPlayerState(K1O[i], PLAYER_STATE_RESOURCE_GOLD))))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + GetObjectName('n0LT')+ e)
	call MultiboardReleaseItem(mbt)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(mbt, LFO, LGO, LHO, LJO)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt,(I2S(Y4[KFX(GetHeroLevel(Player__Hero[GetPlayerId((K0O[i]))]))])))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(mbt, LFO, LGO, LHO, LJO)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt,(I2S(Y4[KFX(GetHeroLevel(Player__Hero[GetPlayerId(K1O[i])]))])))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + GetObjectName('n0DZ')+ e)
	call MultiboardReleaseItem(mbt)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt,(I2S(PlayerCreepLastHitCount[GetPlayerId((K0O[i]))]))+ "/" +(I2S(PlayerCreepDenyCount[GetPlayerId((K0O[i]))]))+ "/" +(I2S((LoadInteger(HY,(400 + GetPlayerId((K0O[i]))), 79)))))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt,(I2S(PlayerCreepLastHitCount[GetPlayerId(K1O[i])]))+ "/" +(I2S(PlayerCreepDenyCount[GetPlayerId(K1O[i])]))+ "/" +(I2S((LoadInteger(HY,(400 + GetPlayerId(K1O[i])), 79)))))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + GetObjectName('n0E1')+ e)
	call MultiboardReleaseItem(mbt)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(mbt, LFO, LGO, LHO, LJO)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt,(I2S(PlayerKillHerosCount[GetPlayerId((K0O[i]))]))+ "/" +(I2S(PlayerHeroDeathCount[GetPlayerId((K0O[i]))]))+ "/" +(I2S(PlayerAssistCount[GetPlayerId((K0O[i]))])))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(mbt, LFO, LGO, LHO, LJO)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt,(I2S(PlayerKillHerosCount[GetPlayerId(K1O[i])]))+ "/" +(I2S(PlayerHeroDeathCount[GetPlayerId(K1O[i])]))+ "/" +(I2S(PlayerAssistCount[GetPlayerId(K1O[i])])))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + GetObjectName('n0E0')+ e)
	call MultiboardReleaseItem(mbt)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt,(I2S(PlayerWardCount[GetPlayerId((K0O[i]))])))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt,(I2S(PlayerWardCount[GetPlayerId(K1O[i])])))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + GetObjectName('n0DT')+ e)
	call MultiboardReleaseItem(mbt)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(mbt, LFO, LGO, LHO, LJO)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, K9O(K0O[i]))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(mbt, LFO, LGO, LHO, LJO)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, K9O(K1O[i]))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + GetObjectName('n0DU')+ e)
	call MultiboardReleaseItem(mbt)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt,(I2S(PlayerKillHeroBonus[GetPlayerId((K0O[i]))])))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt,(I2S(PlayerKillHeroBonus[GetPlayerId(K1O[i])])))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set K2O = K2O + 1
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + "技能" + e)
	call MultiboardReleaseItem(mbt)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K0O[i])* HL + 1]])
		call MultiboardSetItemWidth(mbt, .015)
		call MultiboardReleaseItem(mbt)
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, I2S(ZTE(Player__Hero[GetPlayerId((K0O[i]))], 1)))
		call MultiboardSetItemWidth(mbt, .054)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K1O[i])* HL + 1]])
		call MultiboardSetItemWidth(mbt, .015)
		call MultiboardReleaseItem(mbt)
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, I2S(ZTE(Player__Hero[GetPlayerId(K1O[i])], 1)))
		call MultiboardSetItemWidth(mbt, .054)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + " " + e)
	call MultiboardReleaseItem(mbt)
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K0O[i])* HL + 2]])
		call MultiboardSetItemWidth(mbt, .015)
		call MultiboardReleaseItem(mbt)
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, I2S(ZTE(Player__Hero[GetPlayerId((K0O[i]))], 2)))
		call MultiboardSetItemWidth(mbt, .054)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K1O[i])* HL + 2]])
		call MultiboardSetItemWidth(mbt, .015)
		call MultiboardReleaseItem(mbt)
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, I2S(ZTE(Player__Hero[GetPlayerId(K1O[i])], 2)))
		call MultiboardSetItemWidth(mbt, .054)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + " " + e)
	call MultiboardReleaseItem(mbt)
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K0O[i])* HL + 3]])
		call MultiboardSetItemWidth(mbt, .015)
		call MultiboardReleaseItem(mbt)
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, I2S(ZTE(Player__Hero[GetPlayerId((K0O[i]))], 3)))
		call MultiboardSetItemWidth(mbt, .054)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K1O[i])* HL + 3]])
		call MultiboardSetItemWidth(mbt, .015)
		call MultiboardReleaseItem(mbt)
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, I2S(ZTE(Player__Hero[GetPlayerId(K1O[i])], 3)))
		call MultiboardSetItemWidth(mbt, .054)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + " " + e)
	call MultiboardReleaseItem(mbt)
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K0O[i])* HL + 4]])
		call MultiboardSetItemWidth(mbt, .015)
		call MultiboardReleaseItem(mbt)
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, I2S(ZTE(Player__Hero[GetPlayerId((K0O[i]))], 4)))
		call MultiboardSetItemWidth(mbt, .054)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, false, true)
		call MultiboardSetItemIcon(mbt, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K1O[i])* HL + 4]])
		call MultiboardSetItemWidth(mbt, .015)
		call MultiboardReleaseItem(mbt)
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, I2S(ZTE(Player__Hero[GetPlayerId(K1O[i])], 4)))
		call MultiboardSetItemWidth(mbt, .054)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	if ExtraSkillsNumber >= 1 then
		set K2O = K2O + 1
		set K3O = 0
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, c0 + " " + e)
		call MultiboardReleaseItem(mbt)
		set i = 1
		loop
		exitwhen i > LCO
			set K3O = K3O + 1
			set mbt = MultiboardGetItem(FEV, K2O, K3O)
			call MultiboardSetItemStyle(mbt, false, true)
			call MultiboardSetItemIcon(mbt, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K0O[i])* HL + 5]])
			call MultiboardSetItemWidth(mbt, .015)
			call MultiboardReleaseItem(mbt)
			set K3O = K3O + 1
			set mbt = MultiboardGetItem(FEV, K2O, K3O)
			call MultiboardSetItemStyle(mbt, true, false)
			call MultiboardSetItemValue(mbt, I2S(ZTE(Player__Hero[GetPlayerId((K0O[i]))], 5)))
			call MultiboardSetItemWidth(mbt, .054)
			call MultiboardReleaseItem(mbt)
			set i = i + 1
		endloop
		set i = 1
		loop
		exitwhen i > LDO
			set K3O = K3O + 1
			set mbt = MultiboardGetItem(FEV, K2O, K3O)
			call MultiboardSetItemStyle(mbt, false, true)
			call MultiboardSetItemIcon(mbt, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K1O[i])* HL + 5]])
			call MultiboardSetItemWidth(mbt, .015)
			call MultiboardReleaseItem(mbt)
			set K3O = K3O + 1
			set mbt = MultiboardGetItem(FEV, K2O, K3O)
			call MultiboardSetItemStyle(mbt, true, false)
			call MultiboardSetItemValue(mbt, I2S(ZTE(Player__Hero[GetPlayerId(K1O[i])], 5)))
			call MultiboardSetItemWidth(mbt, .054)
			call MultiboardReleaseItem(mbt)
			set i = i + 1
		endloop
	endif
	if ExtraSkillsNumber >= 2 then
		set K2O = K2O + 1
		set K3O = 0
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, c0 + " " + e)
		call MultiboardReleaseItem(mbt)
		set i = 1
		loop
		exitwhen i > LCO
			set K3O = K3O + 1
			set mbt = MultiboardGetItem(FEV, K2O, K3O)
			call MultiboardSetItemStyle(mbt, false, true)
			call MultiboardSetItemIcon(mbt, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K0O[i])* HL + 6]])
			call MultiboardSetItemWidth(mbt, .015)
			call MultiboardReleaseItem(mbt)
			set K3O = K3O + 1
			set mbt = MultiboardGetItem(FEV, K2O, K3O)
			call MultiboardSetItemStyle(mbt, true, false)
			call MultiboardSetItemValue(mbt, I2S(ZTE(Player__Hero[GetPlayerId((K0O[i]))], 6)))
			call MultiboardSetItemWidth(mbt, .054)
			call MultiboardReleaseItem(mbt)
			set i = i + 1
		endloop
		set i = 1
		loop
		exitwhen i > LDO
			set K3O = K3O + 1
			set mbt = MultiboardGetItem(FEV, K2O, K3O)
			call MultiboardSetItemStyle(mbt, false, true)
			call MultiboardSetItemIcon(mbt, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K1O[i])* HL + 6]])
			call MultiboardSetItemWidth(mbt, .015)
			call MultiboardReleaseItem(mbt)
			set K3O = K3O + 1
			set mbt = MultiboardGetItem(FEV, K2O, K3O)
			call MultiboardSetItemStyle(mbt, true, false)
			call MultiboardSetItemValue(mbt, I2S(ZTE(Player__Hero[GetPlayerId(K1O[i])], 6)))
			call MultiboardSetItemWidth(mbt, .054)
			call MultiboardReleaseItem(mbt)
			set i = i + 1
		endloop
	endif
	set K3O = 0
	set K2O = K2O + 1
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + GetObjectName('n0DV')+ e)
	call MultiboardReleaseItem(mbt)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, LVO(K0O[i]))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, LVO(K1O[i]))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + GetObjectName('n0DW')+ e)
	call MultiboardReleaseItem(mbt)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(mbt, LFO, LGO, LHO, LJO)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt,(I2S(PlayerHeroDeathLossGold[GetPlayerId((K0O[i]))])))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(mbt, LFO, LGO, LHO, LJO)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt,(I2S(PlayerHeroDeathLossGold[GetPlayerId(K1O[i])])))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + GetObjectName('n0DN')+ e)
	call MultiboardReleaseItem(mbt)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt,(I2S(PlayerConsumablesCount[GetPlayerId((K0O[i]))])))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt,(I2S(PlayerConsumablesCount[GetPlayerId(K1O[i])])))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	if LCO > 0 and LDO > 0 then
		set K3O = 0
		set K6O = K2O
		set K7O = K3O
		set K2O = K2O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(mbt, true, false)
		call MultiboardSetItemValue(mbt, c0 + GetObjectName('n0DL')+ e)
		call MultiboardReleaseItem(mbt)
		set K2O = K6O
		set x = 1
		loop
		exitwhen x > LCO
			set K3O = 0
			set K2O = K6O
			set i = 1
			loop
			exitwhen i > LDO
				set K3O = x +(x -1)
				set K2O = K2O + 1
				set mbt = MultiboardGetItem(FEV, K2O, K3O)
				call MultiboardSetItemStyle(mbt, false, true)
				call MultiboardSetItemIcon(mbt,(GetHeroIconFilePath(Player__Hero[GetPlayerId((K0O[x]))])))
				call MultiboardSetItemWidth(mbt, .01)
				call MultiboardReleaseItem(mbt)
				set K3O = K3O + 1
				set mbt = MultiboardGetItem(FEV, K2O, K3O)
				call MultiboardSetItemStyle(mbt, true, true)
				call MultiboardSetItemIcon(mbt,(GetHeroIconFilePath(Player__Hero[GetPlayerId(K1O[i])])))
				call MultiboardSetItemValue(mbt, " " + LEO(K0O[x], K1O[i]))
				call MultiboardSetItemWidth(mbt, .059)
				call MultiboardReleaseItem(mbt)
				set i = i + 1
			endloop
			set x = x + 1
		endloop
		set x = LCO + 1
		loop
		exitwhen x >(LDO + LCO)
			set K3O = 0
			set K2O = K6O
			set i = 1
			loop
			exitwhen i > LCO
				set K3O = x +(x -1)
				set K2O = K2O + 1
				set mbt = MultiboardGetItem(FEV, K2O, K3O)
				call MultiboardSetItemStyle(mbt, false, true)
				call MultiboardSetItemIcon(mbt,(GetHeroIconFilePath(Player__Hero[GetPlayerId((K1O[x -LCO]))])))
				call MultiboardSetItemWidth(mbt, .01)
				call MultiboardReleaseItem(mbt)
				set K3O = K3O + 1
				set mbt = MultiboardGetItem(FEV, K2O, K3O)
				call MultiboardSetItemStyle(mbt, true, true)
				call MultiboardSetItemIcon(mbt,(GetHeroIconFilePath(Player__Hero[GetPlayerId((K0O[i]))])))
				call MultiboardSetItemValue(mbt, " " + LEO(K1O[x -LCO], K0O[i]))
				call MultiboardSetItemWidth(mbt, .059)
				call MultiboardReleaseItem(mbt)
				set i = i + 1
			endloop
			set x = x + 1
		endloop
	endif
	set K2O = K2O + 1
	set K3O = 0
	set K2O = K2O + 1
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + GetObjectName('n0HS')+ e)
	call MultiboardReleaseItem(mbt)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(mbt, LFO, LGO, LHO, LJO)
		if LXO(K0O[i]) == " "then
			call MultiboardSetItemStyle(mbt, true, false)
		else
			call MultiboardSetItemStyle(mbt, true, false)
			call MultiboardSetItemIcon(mbt,(GetHeroIconFilePath(Player__Hero[GetPlayerId((K0O[i]))])))
		endif
		call MultiboardSetItemValue(mbt, LRO(K0O[i]))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(mbt, LFO, LGO, LHO, LJO)
		if LXO(K1O[i]) == " "then
			call MultiboardSetItemStyle(mbt, true, false)
		else
			call MultiboardSetItemStyle(mbt, true, false)
			call MultiboardSetItemIcon(mbt,(GetHeroIconFilePath(Player__Hero[GetPlayerId(K1O[i])])))
		endif
		call MultiboardSetItemValue(mbt, LRO(K1O[i]))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set mbt = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(mbt, true, false)
	call MultiboardSetItemValue(mbt, c0 + GetObjectName('n0E4')+ e)
	call MultiboardReleaseItem(mbt)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		if LXO(K0O[i]) == " "then
			call MultiboardSetItemStyle(mbt, true, false)
		else
			call MultiboardSetItemStyle(mbt, true, true)
			call MultiboardSetItemIcon(mbt,(GetHeroIconFilePath(Player__Hero[GetPlayerId((K0O[i]))])))
		endif
		call MultiboardSetItemValue(mbt, LXO(K0O[i]))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set mbt = MultiboardGetItem(FEV, K2O, K3O)
		if LXO(K1O[i]) == " "then
			call MultiboardSetItemStyle(mbt, true, false)
		else
			call MultiboardSetItemStyle(mbt, true, true)
			call MultiboardSetItemIcon(mbt,(GetHeroIconFilePath(Player__Hero[GetPlayerId(K1O[i])])))
		endif
		call MultiboardSetItemValue(mbt, LXO(K1O[i]))
		call MultiboardSetItemWidth(mbt, .07)
		call MultiboardReleaseItem(mbt)
		set i = i + 1
	endloop
	set mbt = null
endfunction
function LKO takes nothing returns nothing
	local trigger t
	if IsGameHaveObserver then
		set t = CreateTrigger()
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddAction(t, function LBO)
		set FXV = t
	endif
	set t = null
endfunction
function SaveFogClicksData takes string p, real time, string targetUnit returns nothing
	local integer i = LoadInteger(AbilityDataHashTable,-1, 0)
	local integer LPO = R2I(time / 60 -1 / 2)
	local integer LQO = R2I(time -LPO * 60)
	call SaveStr(AbilityDataHashTable,-1, i, p + " selected " + targetUnit + " at " + I2S(LPO)+ ":" + I2S(LQO))
	call SaveInteger(AbilityDataHashTable,-1, 0, i + 1)
endfunction
function CheckFogClicks takes unit u returns nothing
	if GetUnitTypeId(u)!='hfoo' and UnitVisibleToPlayer(u, GetTriggerPlayer()) == false then
		call SaveFogClicksData(PlayersName[GetPlayerId(GetTriggerPlayer())], GetGameTime(), GetUnitName(u))
	endif
endfunction

function LWO takes unit u returns boolean
	return(GetOwningPlayer(u) == SentinelPlayers[0]or GetOwningPlayer(u) == ScourgePlayers[0]) and GetUnitTypeId(u)!='hFFD'
endfunction

function L5O takes nothing returns nothing
	if HaveSavedReal(OtherHashTable, GetHandleId(LocalPlayer),'CAMD') and GetCameraField(CAMERA_FIELD_TARGET_DISTANCE)!= LoadReal(OtherHashTable, GetHandleId(LocalPlayer),'CAMD') and LoadReal(OtherHashTable, GetHandleId(LocalPlayer),'CAMD')!= 1650 then
		call SetCameraFieldForPlayer(LocalPlayer, CAMERA_FIELD_TARGET_DISTANCE, LoadReal(OtherHashTable, GetHandleId(LocalPlayer),'CAMD'), 0)
		call SetCameraFieldForPlayer(LocalPlayer, CAMERA_FIELD_FARZ, 100000, 0)
		call SetCameraFieldForPlayer(LocalPlayer, CAMERA_FIELD_ZOFFSET, 0, 0)
		call SetCameraFieldForPlayer(LocalPlayer, CAMERA_FIELD_ROTATION, 90, 0)
		call SetCameraFieldForPlayer(LocalPlayer, CAMERA_FIELD_ANGLE_OF_ATTACK, 304, 0)
		call SetCameraFieldForPlayer(LocalPlayer, CAMERA_FIELD_ROLL, 0, 0)
		call SetCameraFieldForPlayer(LocalPlayer, CAMERA_FIELD_FIELD_OF_VIEW, 70, 0)
	endif
endfunction
function L6O takes nothing returns boolean
	return IsSoldierTypeId(GetUnitTypeId(GetFilterUnit())) and GetUnitCurrentOrder(GetFilterUnit()) == 0
endfunction
function L7O takes nothing returns nothing
	call IssuePointOrderByIdLoc(GetEnumUnit(), 851983, CreepNextWaypoint[GetUnitAbilityLevel(GetEnumUnit(),'A06G')])
endfunction
// 命令 = 0时继续攻击
function ResumeCreepAttackOrder takes nothing returns nothing
	local group g 		  = AllocationGroup(47)
	local unit  firstUnit = null
	
	call GroupEnumUnitsOfPlayer(g, SentinelPlayers[0], null)
	loop
		set firstUnit = FirstOfGroup(g)
		exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)
		
		if IsSoldierTypeId(GetUnitTypeId(firstUnit)) and GetUnitCurrentOrder(firstUnit) == 0 then
			call IssuePointOrderByIdLoc(firstUnit, 851983, CreepNextWaypoint[GetUnitAbilityLevel(firstUnit,'A06G')])
		endif

	endloop

	call GroupEnumUnitsOfPlayer(g, ScourgePlayers[0], null)
	loop
		set firstUnit = FirstOfGroup(g)
		exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)
		
		if IsSoldierTypeId(GetUnitTypeId(firstUnit)) and GetUnitCurrentOrder(firstUnit) == 0 then
			call IssuePointOrderByIdLoc(firstUnit, 851983, CreepNextWaypoint[GetUnitAbilityLevel(firstUnit,'A06G')])
		endif

	endloop

	call DeallocateGroup(g)
	set firstUnit = null
	set g 	      = null
endfunction

function MVO takes nothing returns boolean
	call CleanCurrentTrigger(GetTriggeringTrigger())
	call TriggerEvaluate(SpawnAllCreepsTrig)
	return false
endfunction
function MEO takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='ntav' then
		if Player__Hero[GetPlayerId(GetOwningPlayer(GetFilterUnit()))]!= null or IsPlayingPlayer(GetOwningPlayer(GetFilterUnit())) == false then
			call KillUnit(GetFilterUnit())
		else
			set Q2 = Q2 + 1
		endif
	endif
	return false
endfunction
function MXO takes nothing returns nothing
	local group g = AllocationGroup(48)
	set Q2 = 0
	call GroupEnumUnitsOfPlayer(g, SentinelPlayers[1], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, SentinelPlayers[2], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, SentinelPlayers[3], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, SentinelPlayers[4], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, SentinelPlayers[5], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, ScourgePlayers[1], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, ScourgePlayers[2], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, ScourgePlayers[3], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, ScourgePlayers[4], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, ScourgePlayers[5], Condition(function MEO))
	if Q2 == 0 then
		call DestroyTimer(GetExpiredTimer())
		call A8X(SentinelPlayers[0], 10,-7000, 6800, 1000)
		call A8X(ScourgePlayers[0], 10,-7000, 6800, 1000)
	endif
	call DeallocateGroup(g)
	set g = null
endfunction
function MOO takes nothing returns nothing
	if GKV or HOV then
		call TimerStart(CreateTimer(), 5, true, function MXO)
	endif
endfunction
function MRO takes nothing returns boolean
	local real r = TimerGetRemaining(NK)
	local real Y2X = r
	local integer time = R2I(Y2X)
	local integer minute = time / 60 -1 / 2
	local integer second = ModuloInteger(time, 60)
	local trigger t
	local integer i
	local integer pid
	if r == 0 then
		if IsPickingHero then
			set IsPickingHero = false
			call RemoveUnit(HR)
			call RemoveUnit(JR)
			call RemoveUnit(KR)
			call RemoveUnit(LR)
			call RemoveUnit(IR)
			call ExecuteFunc("MIO")
			return false
		endif
		set FRV = true
		call FlushGameCache(InitGameCache("start"))
		call StoreMapIdCacheData("i", "d", 3)
		call A8X(SentinelPlayers[0], 2,-6990., 6840, 800)
		call A8X(ScourgePlayers[0], 2,-6990., 6840, 800)
		call MOO()
		set i = 1
		loop
			if IsPlayingPlayer(Player(i)) then
				set pid = GetPlayerId(Player(i))
				call StoreDrCacheData("SP1_" + I2S(i), HeroCommonSkills[PlayerSkillIndex[pid * HL + 1]])
				call StoreDrCacheData("SP2_" + I2S(i), HeroCommonSkills[PlayerSkillIndex[pid * HL + 2]])
				call StoreDrCacheData("SP3_" + I2S(i), HeroCommonSkills[PlayerSkillIndex[pid * HL + 3]])
				call StoreDrCacheData("SP4_" + I2S(i), HeroCommonSkills[PlayerSkillIndex[pid * HL + 4]])
				if ExtraSkillsNumber >= 1 then
					call StoreDrCacheData("SP5_" + I2S(i), HeroCommonSkills[PlayerSkillIndex[pid * HL + 5]])
				endif
				if ExtraSkillsNumber >= 2 then
					call StoreDrCacheData("SP6_" + I2S(i), HeroCommonSkills[PlayerSkillIndex[pid * HL + 6]])
				endif
			endif
			set i = i + 1
			if i == 6 then
				set i = 7
			endif
		exitwhen i > 11
		endloop
		call SetResourceBarTime(minute, second, true)
		set B3 = true
		set PickModeElapsed = GetGameTime()
		call CleanCurrentTrigger(GetTriggeringTrigger())
		call SetFloatGameState(GAME_STATE_TIME_OF_DAY, 6.)
		call SuspendTimeOfDay(false)
		if JT == false then
			call TriggerRegisterTimerEvent(RuneRefreshTrigger, 120, true)
			call TriggerEvaluate(RuneRefreshTrigger)
		endif
		call TriggerRegisterTimerEvent(SpawnAllCreepsTrig, 60, true)
		if not Mode__FastNeutrals then
			set t = CreateTrigger()
			call TriggerRegisterTimerEvent(t, 30, false)
			call TriggerAddCondition(t, Condition(function MVO))
			set t = null
		endif
		call TriggerRegisterTimerEvent(SpawnAttackCreepTrigger, 30, true)
		call TriggerExecute(SpawnAttackCreepTrigger)
		call TriggerRegisterTimerEvent(CreepUpgerTrig, 450, true)
		call TriggerRegisterTimerEvent(C1, 2699-30, false)
		call TriggerRegisterTimerEvent(D1, 999  -150, false)
		call TriggerRegisterTimerEvent(D1, 1999- 240, false)
		call TriggerRegisterTimerEvent(D1, 2999-330, false)
		call TriggerRegisterTimerEvent(XVV, 240, true)
		call TriggerRegisterTimerEvent(FKV, 300, true)
		call TriggerRegisterTimerEvent(PN, 30, true)
		call TriggerEvaluate(PN)
		if KT then
			call TriggerRegisterTimerEvent(SpawnSuperCreepsTrig, 600, true)
		endif
	elseif r == 7 and not IsPickingHero then
		set t = CreateTrigger()
		call TriggerRegisterTimerEvent(t, 30, true)
		call TriggerAddCondition(t, Condition(function GGO))
	elseif Y2X < 12 and PK == false and not IsPickingHero then
		set PK = true
		call PlaySoundBJ(QD)
		call SetResourceBarTime(minute, second, true)
	elseif Y2X == 20 then
	elseif Y2X == 15 and IsPickingHero and(CK[0]> 0 or CK[1]> 0) then
		if not FP[LocalPlayerId] then
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, DisplayTextDuration[LocalPlayerId], "|c006699CC" + "如果你需要更多时间来挑选技能，请输入 -addtime" + "|r")
		endif
	else
		call SetResourceBarTime(minute, second, true)
	endif
	return false
endfunction
function MAO takes nothing returns boolean
	if IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GetAttacker())) and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(GetAttacker())) and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and GetWidgetLife(GetFilterUnit())> 1 and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) == false and GetOwningPlayer(GetFilterUnit())!= NeutralCreepPlayer then
		if IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) then
			set FIV = GetFilterUnit()
		else
			set FAV = GetFilterUnit()
		endif
	endif
	return false
endfunction
function MNO takes nothing returns nothing
	local unit GPO = GetAttacker()
	local unit targetUnit = GetTriggerUnit()
	local group g = AllocationGroup(49)
	call GroupEnumUnitsInRange(g, GetUnitX(GPO), GetUnitY(GPO), 900, Condition(function MAO))
	call DeallocateGroup(g)
	call DisableTrigger(GetTriggeringTrigger())
	if FIV != null then
		call IssueTargetOrderById(GPO, 851983, FIV)
		call GroupAddUnit(FNV, GPO)
	elseif IsUnitType(targetUnit, UNIT_TYPE_HERO) and FAV != null then
		call IssueTargetOrderById(GPO, 851983, FAV)
		call GroupAddUnit(FNV, GPO)
	endif
	call EnableTrigger(GetTriggeringTrigger())
	set FIV = null
	set FAV = null
	set GPO = null
	set targetUnit = null
	set g = null
endfunction
function MBO takes nothing returns nothing
	if GetWidgetLife(GetEnumUnit())< 1 then
		call GroupRemoveUnit(FNV, GetEnumUnit())
	endif
	if GetUnitCurrentOrder(GetEnumUnit())!= 851983then
		call GroupRemoveUnit(FNV, GetEnumUnit())
		call IssuePointOrderByIdLoc(GetEnumUnit(), 851983, CreepNextWaypoint[GetUnitAbilityLevel(GetEnumUnit(),'A06G')])
	endif
endfunction
function MCO takes nothing returns boolean
	call ForGroup(FNV, function MBO)
	return false
endfunction
//function MDO takes string s returns nothing
//	set FBV = FBV + 1
//	set FCV[FBV]= s
//endfunction

function MJO takes nothing returns nothing
	if IsUnitMessenger(GetEnumUnit()) and IsUnitAlly(GetEnumUnit(), SentinelPlayers[0]) == false and GetWidgetLife(GetEnumUnit())> .5 then
		call UnitRemoveAbility(GetEnumUnit(),'B08H')
		call UnitDamageTargetEx(SentinelFountainOfLifeUnit, GetEnumUnit(), 2, 500)
	endif
endfunction
function MKO takes nothing returns nothing
	if IsUnitMessenger(GetEnumUnit()) and IsUnitAlly(GetEnumUnit(), ScourgePlayers[0]) == false and GetWidgetLife(GetEnumUnit())> .5 then
		call UnitRemoveAbility(GetEnumUnit(),'B08H')
		call UnitDamageTargetEx(ScourgeFountainOfLifeUnit, GetEnumUnit(), 2, 500)
	endif
endfunction
function CourierFountainCheck takes nothing returns boolean
	local group g = AllocationGroup(50)
	call GroupEnumUnitsInRect(g, gg_rct_SentinelFountainOfLifeRange, null)
	call ForGroup(g, function MJO)
	call GroupClear(g)
	call GroupEnumUnitsInRect(g, gg_rct_ScourgeFountainOfLifeRange, null)
	call ForGroup(g, function MKO)
	call DeallocateGroup(g)
	set g = null
	return false
endfunction
function PreloadFogClicks takes nothing returns nothing
	local integer i = LoadInteger(AbilityDataHashTable,-1, 0)
	local integer k = 0
	call PreloadEndEx()
	call PreloadGenClear()
	call PreloadGenStart()
	loop
		if HaveSavedString(AbilityDataHashTable,-1, k) then
			call Preload(LoadStr(AbilityDataHashTable,-1, k))
		endif
		set k = k + 1
	exitwhen k > i
	endloop
	call PreloadGenEnd("FogClicks.txt")
	call PreloadGenClear()
endfunction
function L4X takes nothing returns nothing
	local player p = FFV
	local integer pid = GetPlayerId(p)
	local string id = I2S(pid)
	call StoreInteger(DrCache, id, "8_0", GetItemTypeId(UnitItemInSlot(Player__Hero[pid], 0)))
	call StoreInteger(DrCache, id, "8_1", GetItemTypeId(UnitItemInSlot(Player__Hero[pid], 1)))
	call StoreInteger(DrCache, id, "8_2", GetItemTypeId(UnitItemInSlot(Player__Hero[pid], 2)))
	call StoreInteger(DrCache, id, "8_3", GetItemTypeId(UnitItemInSlot(Player__Hero[pid], 3)))
	call StoreInteger(DrCache, id, "8_4", GetItemTypeId(UnitItemInSlot(Player__Hero[pid], 4)))
	call StoreInteger(DrCache, id, "8_5", GetItemTypeId(UnitItemInSlot(Player__Hero[pid], 5)))
	if LocalPlayer== HostPlayer then
		call SyncStoredInteger(DrCache, id, "8_0")
		call SyncStoredInteger(DrCache, id, "8_1")
		call SyncStoredInteger(DrCache, id, "8_2")
		call SyncStoredInteger(DrCache, id, "8_3")
		call SyncStoredInteger(DrCache, id, "8_4")
		call SyncStoredInteger(DrCache, id, "8_5")
	endif
	set p = null
endfunction

function M_O takes real value returns boolean
	return( 100 * GetWidgetLife(GetTriggerUnit())/ GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE))< value
endfunction
function M0O takes unit u returns boolean
	return GetUnitAbilityLevel(u,'A464')> 0 or GetUnitAbilityLevel(u,'BNdo')> 0 or GetUnitAbilityLevel(u,'BEsh')> 0 or GetUnitAbilityLevel(u,'B001')> 0 or GetUnitAbilityLevel(u,'B0AQ')> 0 or GetUnitAbilityLevel(u,'B0AP')> 0
endfunction
function M1O takes nothing returns nothing
	if not((M_O(10) and IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE) and GetUnitTypeId(GetTriggerUnit())!='etol' and GetUnitTypeId(GetTriggerUnit())!='unpl') or(M_O(25) and M0O(GetTriggerUnit())) or(M_O(50) and IsUnitIdType(GetUnitTypeId(GetTriggerUnit()), UNIT_TYPE_HERO) == false and(IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE) == false)) or(GetUnitTypeId(GetTriggerUnit())=='u00S') or(LoadInteger(HY, GetHandleId(GetAttacker()), 4328) == 1)) then
		call IssueImmediateOrderById(GetAttacker(), 851972)
	endif
endfunction
function M2O takes nothing returns boolean
	local boolean b
	if IsUnitAlly(GetTriggerUnit(), GetOwningPlayer(GetAttacker())) then
		call M1O()
	elseif IsUnitType(GetAttacker(), UNIT_TYPE_HERO) or IsBearUnit(GetAttacker()) then
		set b = IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE) == false and IsUnitIllusion(GetAttacker()) == false
		set FGV = GetPlayerId(GetOwningPlayer(GetAttacker()))
		if CDV[FGV]> 0 and b and GetUnitTypeId(GetTriggerUnit())!='n00L'and GYX(GetAttacker(), XOV[OYV]) then
			call IMO()
		endif
		if CKV[FGV]> 0 and b and GYX(GetAttacker(), XOV[I5V]) then
			call IUO()
		elseif (CLV[FGV]> 0 or C1V[FGV]> 0 or C1Z[FGV]> 0) and b and(GYX(GetAttacker(), XOV[IPV]) or GYX(GetAttacker(), XOV[RLV]) or GYX(GetAttacker(), XOV[N1V])) then
			call I_O()
		endif
	elseif GetUnitAbilityLevel(GetAttacker(),'A17S')> 0 and IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE) == false then
		call MNO()
	endif
	return false
endfunction
function M3O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	if GetTriggerEventId() == EVENT_PLAYER_UNIT_SPELL_EFFECT or LoadBoolean(HY, GetHandleId(trigUnit), 140) then
		if LoadBoolean(HY, GetHandleId(trigUnit), 140) then
			call SaveBoolean(HY, GetHandleId(trigUnit), 140, false)
			call SaveInteger(HY, GetHandleId(trigUnit), 4259, 2)
			call UnitRemoveAbility(trigUnit,'A04R')
			call UnitRemoveAbility(trigUnit,'Avul')
			call PauseUnit(trigUnit, false)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		elseif GetSpellTargetUnit() == trigUnit and GetSpellAbilityId() == FJV and(GetPlayerSlotState(GetOwningPlayer(trigUnit)) == PLAYER_SLOT_STATE_LEFT) and LoadInteger(HY, GetHandleId(trigUnit), 4259) == 1 then
			call SaveInteger(HY, GetHandleId(trigUnit), 4259, 2)
			call UnitRemoveAbility(trigUnit,'A04R')
			call UnitRemoveAbility(trigUnit,'Avul')
			call PauseUnit(trigUnit, false)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	elseif UnitIsDead(trigUnit) == false then
		call SetUnitX(trigUnit, x)
		call SetUnitY(trigUnit, y)
		call SaveInteger(HY, GetHandleId(trigUnit), 4259, 1)
		call UnitAddAbility(trigUnit,'A04R')
		call UnitAddPermanentAbility(trigUnit,'Avul')
		call PauseUnit(trigUnit, true)
	endif
	set trigUnit = null
	set t = null
	return false
endfunction
function M4O takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = GetSpellTargetUnit()
	call SaveBoolean(HY, GetHandleId(trigUnit), 140, false)
	call SaveInteger(HY, GetHandleId(trigUnit), 4259, 1)
	call UnitAddAbility(trigUnit,'A04R')
	call UnitAddPermanentAbility(trigUnit,'Avul')
	call PauseUnit(trigUnit, true)
	call SaveUnitHandle(HY, h, 14, trigUnit)
	call SaveReal(HY, h, 6, GetUnitX(trigUnit)* 1.)
	call SaveReal(HY, h, 7, GetUnitY(trigUnit)* 1.)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function M3O))
	set t = null
	set trigUnit = null
endfunction
function M5O takes nothing returns nothing
	local integer i = GetSpellAbilityId()
	if i =='A1WE' or i =='A0B8' or i =='A063' or i =='A03O' or i =='A1AY' or i =='A0MQ' or i =='A1B6' then
		call FKX(GetTriggerUnit(), false)
	endif
endfunction
function M6O takes nothing returns boolean
	if GetSpellAbilityId() == FHV and GetPlayerSlotState(GetOwningPlayer(GetSpellTargetUnit())) == PLAYER_SLOT_STATE_LEFT and LoadInteger(HY, GetHandleId(GetSpellTargetUnit()), 4259)!= 1 then
		call M4O()
	elseif (GetSpellAbilityId() == FJV or GetSpellAbilityId() == FHV) and GetPlayerSlotState(GetOwningPlayer(GetSpellTargetUnit()))!= PLAYER_SLOT_STATE_LEFT then
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n02N'))
	endif
	if FDX(GetSpellAbilityId()) then
		if FCX(GetSpellAbilityId()) == false then
			call FKX(GetSpellTargetUnit(), IsUnitEnemy(GetSpellTargetUnit(), GetTriggerPlayer()))
		else
			call FKX(GetSpellTargetUnit(), IsUnitEnemy(GetSpellTargetUnit(), GetOwningPlayer(LoadUnitHandle(HY, GetHandleId(GetTriggerUnit()), 0))))
		endif
	else
		call M5O()
	endif
	return false
endfunction
function M7O takes destructable d returns boolean
	local real x = GetDestructableX(d)
	local real y = GetDestructableY(d)
	local group g = AllocationGroup(52)
	local boolean M8O
	call GroupEnumUnitsInRange(g, x, y, 250, Condition(function FEX))
	set M8O = FirstOfGroup(g)!= null
	call DeallocateGroup(g)
	set g = null
	return M8O
endfunction
function M9O takes nothing returns nothing
	if IsTreeDestructable(GetEnumDestructable()) and GetDestructableLife(GetEnumDestructable())< 1 and GetDestructableTypeId(GetEnumDestructable())!='B002' and GetDestructableTypeId(GetEnumDestructable())!='B003' then
		if M7O(GetEnumDestructable()) == false then
			call DestructableRestoreLife(GetEnumDestructable(), GetDestructableMaxLife(GetEnumDestructable()), false)
			call SetDestructableAnimation(GetEnumDestructable(), "birth")
			if SL[LocalPlayerId]== 1 and GetDestructableTypeId(GetEnumDestructable())=='ATtr' then
				call SetDestructableAnimation(GetEnumDestructable(), "stand alternate")
			endif
		endif
	endif
endfunction
function PVO takes nothing returns nothing
	call EnumDestructablesInRectAll(bj_mapInitialPlayableArea, function M9O)
endfunction
function PEO takes nothing returns boolean
	if GetUnitTypeId(GetTriggerUnit())=='n00L' then
		if IsUnitIllusion(GetAttacker()) then
			call KillUnit(GetAttacker())
		elseif IsUnitInRegion(FLV, GetAttacker()) == false or RectContainsUnit(ZV, GetAttacker()) then
			call InterfaceErrorForPlayer(GetOwningPlayer(GetAttacker()), GetObjectName('n035'))
			call IssueImmediateOrderById(GetAttacker(), 851972)
		endif
	endif
	return false
endfunction
// 马甲单位进入地图
function PXO takes nothing returns boolean
	local unit u = GetEnteringUnit()
	if GetUnitTypeId(u)=='e00E' or GetUnitTypeId(u)=='e022' then
		call ShowUnit(u, false)
		call SetUnitPathing(u, false)
		call SetUnitInvulnerable(u, true)
		call UnitApplyTimedLife(u,'BTLF', 20.)
	endif
	set u = null
	return false
endfunction

function ResetGlyphCooldownToTeam takes integer team returns nothing
	if team == 0 then
		call UnitResetCooldownEx(SentinelCircle1)
		call UnitResetCooldownEx(SentinelCircle2)
		call UnitResetCooldownEx(SentinelCircle3)
		call UnitResetCooldownEx(SentinelCircle4)
		call UnitResetCooldownEx(SentinelCircle5)
	else
		call UnitResetCooldownEx(ScourgeCircle1)
		call UnitResetCooldownEx(ScourgeCircle2)
		call UnitResetCooldownEx(ScourgeCircle3)
		call UnitResetCooldownEx(ScourgeCircle4)
		call UnitResetCooldownEx(ScourgeCircle5)
	endif
endfunction
function PGO takes nothing returns boolean
	local integer x = 0
	if GetPlayerSlotState(SentinelPlayers[1]) == PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(SentinelPlayers[2]) == PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(SentinelPlayers[3]) == PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(SentinelPlayers[4]) == PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(SentinelPlayers[5]) == PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(ScourgePlayers[1]) == PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(ScourgePlayers[2]) == PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(ScourgePlayers[3]) == PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(ScourgePlayers[4]) == PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(ScourgePlayers[5]) == PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	return x == 9
endfunction
function TestChat_SpawnOnAction takes nothing returns nothing
	set IsDisableSpawn = false
endfunction
function PJO takes nothing returns nothing
	set FPV = true
endfunction
function TestCaht_SpawnOffAction takes nothing returns nothing
	set IsDisableSpawn = true
endfunction
function PLO takes nothing returns nothing
	set IsNoHeroLimit = false
endfunction
function PMO takes nothing returns boolean
	if IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false then
		call KillUnit(GetFilterUnit())
	endif
	return false
endfunction
function PPO takes nothing returns nothing
	local group g = AllocationGroup(53)
	call GroupEnumUnitsOfPlayer(g, ScourgePlayers[0], Condition(function PMO))
	call DeallocateGroup(g)
	set g = null
endfunction
function PQO takes nothing returns nothing
	local group g = AllocationGroup(54)
	call GroupEnumUnitsOfPlayer(g, SentinelPlayers[0], Condition(function PMO))
	call DeallocateGroup(g)
	set g = null
endfunction
function PSO takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='o004' or GetUnitTypeId(GetFilterUnit())=='oeye' then
		call KillUnit(GetFilterUnit())
	endif
	return false
endfunction
function PTO takes nothing returns nothing
	local group g = AllocationGroup(55)
	call GroupEnumUnitsInRange(g, 0, 0, 9999, Condition(function PSO))
	call DeallocateGroup(g)
	set g = null
endfunction
function PUO takes nothing returns nothing
	call PQO()
	call PPO()
endfunction
function PWO takes nothing returns boolean
	if IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and GetUnitAbilityLevel(GetFilterUnit(),'Aloc') == 0 then
		call SetHeroLevelAndXP(GetFilterUnit(), IMaxBJ(Q2, 1), true, 0)
	endif
	return false
endfunction
function PYO takes nothing returns nothing
	local string s = SubString(GetEventPlayerChatString(), 2, StringLength(GetEventPlayerChatString()))
	local integer level = S2I(s)
	local group g = AllocationGroup(56)
	if GetEventPlayerChatString() == "-l" then
		set Q2 = 25
		call GroupEnumUnitsOfPlayer(g, GetTriggerPlayer(), Condition(function PWO))
		call DeallocateGroup(g)
		set g = null
		return
	endif
	if level == 0 then
		set level = S2I(SubString(GetEventPlayerChatString(), 6, StringLength(GetEventPlayerChatString())))
	endif
	if level < 1 then
		set level = 1
	endif
	set Q2 = level
	call GroupEnumUnitsOfPlayer(g, GetTriggerPlayer(), Condition(function PWO))
	call DeallocateGroup(g)
	set g = null
endfunction
function PZO takes nothing returns nothing
	call TriggerExecute(SpawnAttackCreepTrigger)
endfunction
function P_O takes nothing returns boolean
	local unit u = GetFilterUnit()
	if IsUnitType(u, UNIT_TYPE_HERO) then
		call UnitResetCooldownEx(u)
		call TimerStart(ESV[GetPlayerId((GetOwningPlayer(u)))], 0, false, null)
		call TimerStart(ETV[GetPlayerId((GetOwningPlayer(u)))], 0, false, null)
		call SetWidgetLife(u, GetUnitState(u, UNIT_STATE_MAX_LIFE))
		call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MAX_MANA))
	endif
	set u = null
	return false
endfunction
function P0O takes nothing returns nothing
	local group g = AllocationGroup(57)
	call GroupEnumUnitsOfPlayer(g, GetTriggerPlayer(), Condition(function P_O))
	call DeallocateGroup(g)
	set g = null
endfunction
function P1O takes nothing returns nothing
	call KillUnit(Player__Hero[GetPlayerId(GetTriggerPlayer())])
endfunction
function P2O takes nothing returns nothing
	local string P3O = SubString(GetEventPlayerChatString(), 5, StringLength(GetEventPlayerChatString()))
	local integer KGX = S2I(P3O)
	if KGX < 0 or KGX > 24 then
		set KGX = 0
	endif
	call SetFloatGameState(GAME_STATE_TIME_OF_DAY, KGX)
endfunction
function P4O takes nothing returns nothing
	local string s = SubString(GetEventPlayerChatString(), 2, StringLength(GetEventPlayerChatString()))
	local integer g = S2I(s)
	if GetEventPlayerChatString() == "-g" then
		call SetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD, 999999)
		return
	endif
	if g == 0 then
		set g = S2I(SubString(GetEventPlayerChatString(), 5, StringLength(GetEventPlayerChatString())))
	endif
	call SetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD)+ g)
endfunction
function P5O takes nothing returns nothing
	local unit SDX = Player__Hero[GetPlayerId(GetTriggerPlayer())]
	local player T6X = GetTriggerPlayer()
	local location S1X
	if IsScourgePlayer(T6X) then
		set S1X = GetRectCenter(gg_rct_ScourgeRevivalPoint)
	else
		set S1X = GetRectCenter(gg_rct_SentinelRevivalPoint)
	endif
	if IsGameEnd == false and UnitIsDead(SDX) then
		call MEX(SDX, T6X, GetLocationX(S1X), GetLocationY(S1X), true)
		if S_X(SDX) == false or GetUnitAbilityLevel(SDX,'A0MW') == 0 then
			call ReviveHeroLoc(SDX, S1X, true)
		else
			call S0X(SDX, S1X)
		endif
	endif
	call RemoveLocation(S1X)
	set SDX = null
	set T6X = null
	set S1X = null
endfunction
function P6O takes nothing returns nothing
	local unit whichUnit = Player__Hero[GetPlayerId(GetTriggerPlayer())]
	local player p
	local unit u
	local string s = SubString(GetEventPlayerChatString(), 2, StringLength(GetEventPlayerChatString()))
	local integer i = 1
	if (S2I(s)> 0) then
		set i = S2I(s)
	endif
	if IsScourgePlayer(GetOwningPlayer(whichUnit)) then
		set p = SentinelPlayers[1]
	else
		set p = ScourgePlayers[1]
	endif
	loop
		set u = CreateUnit(ScourgePlayers[1],'H000',-400,-400, 0)
		call SetHeroLevel(u, 10, false)
		set Player__Hero[GetPlayerId(ScourgePlayers[1])]= u
		set i = i -1
	exitwhen i == 0
	endloop
	call UnitAddAbility(u,'A00S')
	call UnitAddAbility(u,'A00L')
	set whichUnit = null
	set u = null
	set p = null
endfunction
function GetCurrentMaxHandleId takes nothing returns nothing
	local timer t = CreateTimer()
	local integer i = GetHandleId(t)

	call BJDebugMsg("当前游戏中最大HandleId为 " + I2S(i))

	call DestroyTimer(t)
	set t = null
endfunction

function ydweleak takes nothing returns nothing
	call GetLocalizedHotkey("yd_leak_monitor::create_report")
endfunction

function P7O takes nothing returns nothing
	call TriggerEvaluate(RuneRefreshTrigger)
endfunction
function P8O takes nothing returns nothing
	call TriggerEvaluate(SpawnAllCreepsTrig)
endfunction
function P9O takes nothing returns nothing
	call EnumDestructablesInRectAll(bj_mapInitialPlayableArea, function M9O)
endfunction
function QVO takes nothing returns boolean
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 60, "**** 注意 ****")
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 60, "系统检测到你正在使用单机模式，所以你可以使用如下命令 -lvlup xx, -refresh, -spawncreeps, -powerup, -neutrals, -kill, -gold xxxx, -time xx, -killsent, -killscourge, -killall, -noherolimit, -trees, -killwards, -spawnoff, -spawnon, -roshan, -respawn, -dummy")
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 60, "**** 注意 ****")
	return false
endfunction
function QEO takes nothing returns nothing
	set WTF__Status = not WTF__Status
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, "WTF status: " + UNV(WTF__Status))
endfunction
function QXO takes nothing returns nothing
	local player QOO = HostPlayer 
	local trigger t
	set IsSinglePlayerMode = true

	// 单机也能看到伤害减免
	//set IsGameHaveObserver = true
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 60, "系统检测到你正在使用单机模式，所以你可以使用如下命令 -lvlup xx, -refresh, -spawncreeps, -powerup, -neutrals, -kill, -gold xxxx, -time xx, -killsent, -killscourge, -killall, -noherolimit, -trees, -killwards, -spawnoff, -spawnon, -roshan, -respawn, -dummy")
	set t = CreateTrigger()
	call TriggerAddCondition(t, Condition(function QVO))
	call TriggerRegisterTimerEvent(t, GetRandomReal(60, 100), false)
	set t = CreateTrigger()
	call TUV(t, "-lvlup", false)
	call TUV(t, "-l ", false)
	call TUV(t, "-l", true)
	call TriggerAddAction(t, function PYO)
	set t = CreateTrigger()
	call TUV(t, "-spawncreeps", true)
	call TUV(t, "-sc", true)
	call TriggerAddAction(t, function PZO)
	set t = CreateTrigger()
	call TUV(t, "-refresh", true)
	call TriggerAddAction(t, function P0O)
	set t = CreateTrigger()
	call TUV(t, "-kill", true)
	call TriggerAddAction(t, function P1O)
	set t = CreateTrigger()
	call TUV(t, "-wtf", true)
	call TriggerAddAction(t, function QEO)
	set t = CreateTrigger()
	call TUV(t, "-gold", false)
	call TUV(t, "-g ", false)
	call TUV(t, "-g", true)
	call TriggerAddAction(t, function P4O)
	set t = CreateTrigger()
	call TUV(t, "-time", false)
	call TriggerAddAction(t, function P2O)
	set t = CreateTrigger()
	call TUV(t, "-powerup", true)
	call TriggerAddAction(t, function P7O)
	set t = CreateTrigger()
	call TUV(t, "-killall", true)
	call TUV(t, "-ka", true)
	call TriggerAddAction(t, function PUO)
	set t = CreateTrigger()
	call TUV(t, "-killsent", true)
	call TriggerAddAction(t, function PQO)
	set t = CreateTrigger()
	call TUV(t, "-killscourge", true)
	call TriggerAddAction(t, function PPO)
	set t = CreateTrigger()
	call TUV(t, "-neutrals", true)
	call TUV(t, "-n", true)
	call TriggerAddAction(t, function P8O)
	set t = CreateTrigger()
	call TUV(t, "-noherolimit", true)
	call TUV(t, "-nhl", true)
	call TriggerAddAction(t, function PLO)
	set t = CreateTrigger()
	call TUV(t, "-trees", true)
	call TriggerAddAction(t, function P9O)
	set t = CreateTrigger()
	call TUV(t, "-killwards", true)
	call TriggerAddAction(t, function PTO)
	set t = CreateTrigger()
	call TUV(t, "-spawnoff", true)
	call TriggerAddAction(t, function TestCaht_SpawnOffAction)
	set t = CreateTrigger()
	call TUV(t, "-spawnon", true)
	call TriggerAddAction(t, function TestChat_SpawnOnAction)
	set t = CreateTrigger()
	call TUV(t, "-roshan", true)
	call TriggerAddAction(t, function PJO)
	set t = CreateTrigger()
	call TUV(t, "-respawn", true)
	call TriggerAddAction(t, function P5O)
	set t = CreateTrigger()
	call TUV(t, "-dummy", true)
	call TUV(t, "-d", true)
	call TUV(t, "-d ", false)
	call TriggerAddAction(t, function P6O)
	set t = CreateTrigger()
	call TUV(t, "-h ", false)
	call TriggerAddAction(t, function GetCurrentMaxHandleId)
	set t = CreateTrigger()
	call TUV(t, "-ydweleak ", true)
	call TriggerAddAction(t, function ydweleak)
	set QOO = null
	set t = null
endfunction
function QRO takes nothing returns boolean
	return not GS
endfunction
function QIO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit ZWX =(LoadUnitHandle(HY, h, 26))
	if GetUnitTypeId(ZWX)!='ncop' then
		call UnitResetCooldownEx(ZWX)
		call SetUnitManaPercentBJ(ZWX, 100)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set ZWX = null
	return false
endfunction
function QAO takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function QIO))
	call SaveUnitHandle(HY, h, 26,(GetTriggerUnit()))
	set t = null
endfunction
function QNO takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer QBO = XKX(SentinelForce)+ XKX(ScourgeForce)
	local integer NumRequired = IMinBJ(QBO, QBO / 2 + 1)
	local integer h = GetHandleId(t)
	if GGV == false then
		set FQV = true
		call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 60., " ")
		call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 90., GetObjectName('n077'))
		call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 90., GetObjectName('n078'))
		set t = CreateTrigger()
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
		call TriggerAddAction(t, function QAO)
	endif
	set t = null
endfunction
// 英雄升级
function HeroLevelUpCondition takes nothing returns boolean
	if IsNotDummyHero(GetTriggerUnit()) and IsUnitIllusion(GetTriggerUnit()) == false then
		call KTX(GetOwningPlayer(GetTriggerUnit()))
		call StoreDrCacheData("Level" + I2S(GetHeroLevel(GetTriggerUnit())), GetPlayerId(GetOwningPlayer(GetTriggerUnit())))
	endif
	return false
endfunction
function QDO takes nothing returns nothing
	if GGV == false then
		call QXO()
		call CleanCurrentTrigger(GetTriggeringTrigger())
	endif
endfunction
function QFO takes nothing returns boolean
	if GS == false and(bj_isSinglePlayer and PGO()) == false then
		call QDO()
	endif
	return false
endfunction
function QGO takes nothing returns nothing
	call SetUnitUserData(GetEnumUnit(), 0)
	call IssuePointOrderByIdLoc(GetEnumUnit(), 851983,(CreepNextWaypoint[GetUnitAbilityLevel((GetEnumUnit()),'A06G')]))
endfunction
function QHO takes nothing returns nothing
	call IssueTargetOrderById(GetEnumUnit(), 851983, FUV)
	call GroupAddUnit(FTV, GetEnumUnit())
	call SetUnitUserData(GetEnumUnit(), FWV)
endfunction
function QJO takes nothing returns boolean
	local integer id = GetUnitTypeId(GetFilterUnit())
	if id =='ebal' or id =='e026' or id =='umtw' or id =='u00R' then
		return false
	endif
	if IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(FUV)) and(GetOwningPlayer(GetFilterUnit()) == SentinelPlayers[0]or GetOwningPlayer(GetFilterUnit()) == ScourgePlayers[0]) and GetUnitUserData(GetFilterUnit()) == 0 then
		return true
	endif
	return false
endfunction
function QKO takes nothing returns nothing
	if GetUnitCurrentOrder(GetEnumUnit()) == 0 and IsUnitInRange(GetEnumUnit(), FUV, GetUnitAcquireRange(GetEnumUnit())) == false then
		call GroupRemoveUnit(FTV, GetEnumUnit())
		call SetUnitUserData(GetEnumUnit(), 0)
		call IssuePointOrderByIdLoc(GetEnumUnit(), 851983,(CreepNextWaypoint[GetUnitAbilityLevel((GetEnumUnit()),'A06G')]))
	endif
endfunction
function QLO takes nothing returns nothing
	local integer h = GetHandleId((LoadUnitHandle(HY,(GetHandleId(GetExpiredTimer())), 2)))
	local integer id =(LoadInteger(HY, h, 143))
	local group QMO =(LoadGroupHandle(HY, h, 144))
	set FSV[id]= null
	call ForGroup(QMO, function QGO)
	call GroupClear(QMO)
	set QMO = null
endfunction
function QPO takes unit triggerUnit, unit QQO returns nothing
	local integer h = GetHandleId(triggerUnit)
	local group QMO = LoadGroupHandle(HY, h, 144)
	local integer id = LoadInteger(HY, h, 143)
	local unit QSO = FSV[id]
	local group g
	if QSO != null and QSO != QQO then
		call ForGroup(QMO, function QGO)
		call GroupClear(QMO)
	endif
	set FSV[id]= QQO
	set FTV = QMO
	set FUV = QQO
	set FWV = id
	call ForGroup(QMO, function QKO)
	set g = AllocationGroup(58)
	call GroupEnumUnitsInRange(g, GetUnitX(QQO), GetUnitY(QQO), 500, Condition(function QJO))
	call ForGroup(g, function QHO)
	call DeallocateGroup(g)
	call TimerStart(LoadTimerHandle(HY, h, 141), 2, false, function QLO)
	set QMO = null
	set QSO = null
	set g = null
endfunction
function QTO takes nothing returns boolean
	local unit trigUnit = GetTriggerUnit()
	local unit targetUnit = GetOrderTargetUnit()
	local integer S6V = GetIssuedOrderId()
	local integer id
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) and IsUnitIllusion(targetUnit) == false and(S6V == 851983 or S6V ==851971) and IsUnitEnemy(targetUnit, GetOwningPlayer(trigUnit)) and UnitVisibleToPlayer(trigUnit, GetOwningPlayer(targetUnit)) and EI == false then
		set id =(LoadInteger(HY,(GetHandleId(targetUnit)), 143))
		if FSV[id]== null or FSV[id]== targetUnit or UnitIsDead(FSV[id]) then
			call QPO(targetUnit, trigUnit)
		endif
	endif
	set trigUnit = null
	set targetUnit = null
	return false
endfunction
function QUO takes nothing returns boolean
	local unit u = GetAttacker()
	local unit trigUnit = GetTriggerUnit()
	local integer id
	if LWO(u) == false and EI == false then
		set id =(LoadInteger(HY,(GetHandleId(trigUnit)), 143))
		if FSV[id]== null or FSV[id]== trigUnit or UnitIsDead(FSV[id]) then
			call QPO(trigUnit, u)
		endif
	endif
	set u = null
	set trigUnit = null
	return false
endfunction
function QWO takes unit trigUnit returns nothing
	local group g
	local trigger t
	local timer tm
	local integer h = GetHandleId(trigUnit)
	set FYV = FYV + 1
	call SaveBoolean(HY, h, 142,(true))
	call SaveInteger(HY, h, 143,(FYV))
	set g = AllocationGroup(59)
	call SaveGroupHandle(HY, h, 144,(g))
	set t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, trigUnit, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerAddCondition(t, Condition(function QTO))
	set t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, trigUnit, EVENT_UNIT_ATTACKED)
	call TriggerAddCondition(t, Condition(function QUO))
	set tm = CreateTimer()
	call SaveTimerHandle(HY,(GetHandleId(trigUnit)), 141,(tm))
	call SaveUnitHandle(HY,(GetHandleId(tm)), 2,(trigUnit))
	set g = null
	set t = null
	set tm = null
endfunction
function QYO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer id
	local unit u
	if GetTriggerEventId() == EVENT_UNIT_CHANGE_OWNER then
		set u = GetTriggerUnit()
		set id = GetUnitTypeId(u)
		if id =='n026' or id =='n127' then
			call UnitAddPermanentAbility(u,'A36I')
		elseif id =='ndtw' then
			call UnitAddPermanentAbility(u,'ACen')
		elseif id =='nomg' then
			call UnitAddPermanentAbility(u,'ACf2')
		elseif id =='n0HX' then
			call UnitAddPermanentAbility(u,'ACcl')
		elseif id =='nsat' then
			call UnitAddPermanentAbility(u,'ACpu')
		elseif id =='nstl' then
			call UnitAddPermanentAbility(u,'Ambd')
		endif
		set u = null
		call DestroyTrigger(t)
	else
		call DestroyTrigger(t)
	endif
	return false
endfunction
function QZO takes unit u returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_CHANGE_OWNER)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function QYO))
	set t = null
endfunction
function Q_O takes unit u returns nothing
	local integer id = GetUnitTypeId(u)
	if id =='n127' or id =='n128' then
		call UnitApplyTimedLife(u,'BTLF', 60)
		if GetOwningPlayer(u)!= NeutralCreepPlayer then
			call UnitAddPermanentAbility(u,'A36I')
		endif
	endif
	if GetOwningPlayer(u) == NeutralCreepPlayer then
		if id =='n127' or id =='n026' or id =='ndtw' or id =='nomg' or id =='n0HX' or id =='nsat' or id =='nstl' then
			call QZO(u)
		endif
		if id =='ndtw' or id =='ndtr' or id =='nftb' or id =='nfsh' or id =='ngns' or id =='n0HX' then
			call SetUnitAcquireRange(u, 300)
		endif
	endif
endfunction
function Q0O takes nothing returns boolean
	if O4X(GetTriggerUnit()) and(LoadBoolean(HY,(GetHandleId(GetTriggerUnit())), 142)) == false and(not IsPickingHero) then
		call QWO(GetTriggerUnit())
	endif
	if HaveSavedInteger(SightDataHashTable, GetUnitTypeId(GetTriggerUnit()), HC) then
		call Q_O(GetTriggerUnit())
	endif
	return false
endfunction
function Q1O takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit()) == SentinelPlayers[0] then
		call SetUnitAbilityLevel(GetTriggerUnit(),'A06G', 5)
		if FSV[GetUnitUserData(GetTriggerUnit())]== null then
			call SetUnitUserData(GetTriggerUnit(), 0)
			call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983,(CreepNextWaypoint[GetUnitAbilityLevel((GetTriggerUnit()),'A06G')]))
		endif
	elseif GetOwningPlayer(GetTriggerUnit()) == ScourgePlayers[0] then
		call SetUnitAbilityLevel(GetTriggerUnit(),'A06G', 1)
		if FSV[GetUnitUserData(GetTriggerUnit())]== null then
			call SetUnitUserData(GetTriggerUnit(), 0)
			call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983,(CreepNextWaypoint[GetUnitAbilityLevel((GetTriggerUnit()),'A06G')]))
		endif
	endif
	return false
endfunction
function Q2O takes nothing returns nothing
	local unit CSO = GetTriggerUnit()
	local unit Q3O =(LoadUnitHandle(HY,(GetHandleId(CSO)), 145))
	call RemoveUnit(Q3O)
	set CSO = null
	set Q3O = null
endfunction
function Q4O takes nothing returns nothing
	local group g
	local unit CSO
	local unit Q3O
	local trigger t
	local integer i
	set t = CreateTrigger()
	call TriggerAddAction(t, function Q2O)
	set g = AllocationGroup(60)
	call GroupEnumUnitsOfPlayer(g, SentinelPlayers[0], null)
	loop
		set CSO = FirstOfGroup(g)
	exitwhen CSO == null
		call GroupRemoveUnit(g, CSO)
		if GetUnitAbilityLevel(CSO,'Adts')> 0 or GetUnitAbilityLevel(CSO,'Atru')> 0 then
			call TriggerRegisterUnitEvent(t, CSO, EVENT_UNIT_DEATH)
			// 近卫ob真视
			set Q3O = CreateUnit(SentinelPlayers[1],('u00B'),-5000,-5100, 0)
			call SetUnitScale(Q3O, 0, 0, 0)
			call SetUnitPathing(Q3O, false)
			call SetUnitInvulnerable(Q3O, true)
			call SetUnitX(Q3O, GetUnitX(CSO))
			call SetUnitY(Q3O, GetUnitY(CSO))
			call SaveUnitHandle(HY,(GetHandleId(CSO)), 145,(Q3O))
		endif
	endloop
	call DeallocateGroup(g)
	set g = AllocationGroup(61)
	call GroupEnumUnitsOfPlayer(g, ScourgePlayers[0], null)
	loop
		set CSO = FirstOfGroup(g)
	exitwhen CSO == null
		call GroupRemoveUnit(g, CSO)
		if GetUnitAbilityLevel(CSO,'Adts')> 0 or GetUnitAbilityLevel(CSO,'Atru')> 0 then
			call TriggerRegisterUnitEvent(t, CSO, EVENT_UNIT_DEATH)
			// 天灾ob真视
			set Q3O = CreateUnit(ScourgePlayers[1],('u00B'), 3400, 4400, 0)
			call SetUnitScale(Q3O, 0, 0, 0)
			call SetUnitPathing(Q3O, false)
			call SetUnitInvulnerable(Q3O, true)
			call SetUnitX(Q3O, GetUnitX(CSO))
			call SetUnitY(Q3O, GetUnitY(CSO))
			call SaveUnitHandle(HY,(GetHandleId(CSO)), 145,(Q3O))
		endif
	endloop
	call DeallocateGroup(g)
	set g = null
	set t = null
	set Q3O = null
	set CSO = null
endfunction
function Q5O takes nothing returns nothing
	local unit Q6O = GetTriggerUnit()
	local unit targetUnit = FSV[GetUnitUserData(Q6O)]
	call SetUnitPosition(Q6O, GetUnitX(Q6O), GetUnitY(Q6O))
	if targetUnit != null and UnitIsDead(targetUnit) == false and UnitVisibleToPlayer(targetUnit, GetOwningPlayer(targetUnit)) then
		call IssueTargetOrderById(Q6O, 851983, targetUnit)
	else
		call DisableTrigger(GetTriggeringTrigger())
		call IssuePointOrderByIdLoc(Q6O, 851983,(CreepNextWaypoint[GetUnitAbilityLevel((Q6O),'A06G')]))
		call EnableTrigger(GetTriggeringTrigger())
	endif
	set Q6O = null
	set targetUnit = null
endfunction
function Q7O takes nothing returns boolean
	if LWO(GetTriggerUnit()) then
		call Q5O()
	endif
	return false
endfunction
function Q8O takes nothing returns nothing
	local unit Q6O = GetTriggerUnit()
	local unit targetUnit = FSV[GetUnitUserData(Q6O)]
	call SetUnitPosition(Q6O, GetUnitX(Q6O), GetUnitY(Q6O))
	if targetUnit != null and UnitIsDead(targetUnit) == false and UnitVisibleToPlayer(targetUnit, GetOwningPlayer(targetUnit)) then
		call IssueTargetOrderById(Q6O, 851983, targetUnit)
	else
		call DisableTrigger(GetTriggeringTrigger())
		call IssuePointOrderByIdLoc(Q6O, 851983,(CreepNextWaypoint[GetUnitAbilityLevel((Q6O),'A06G')]))
		call EnableTrigger(GetTriggeringTrigger())
	endif
	set Q6O = null
	set targetUnit = null
endfunction
function Q9O takes nothing returns boolean
	if GetIssuedOrderId()== 851986 then
		call Q8O()
	endif
	return false
endfunction
function SVO takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit()) == SentinelPlayers[0] then
		if IsUnitFogged(GetAttacker(), SentinelPlayers[1]) or IsUnitFogged(GetAttacker(), ScourgePlayers[1]) then
			call BEX(CreateFogModifierRadius(SentinelPlayers[1], FOG_OF_WAR_VISIBLE, GetUnitX(GetAttacker()), GetUnitY(GetAttacker()), 128, true, false), 1)
		endif
	elseif GetOwningPlayer(GetTriggerUnit()) == ScourgePlayers[0] then
		if IsUnitFogged(GetAttacker(), SentinelPlayers[1]) or IsUnitFogged(GetAttacker(), ScourgePlayers[1]) then
			call BEX(CreateFogModifierRadius(ScourgePlayers[1], FOG_OF_WAR_VISIBLE, GetUnitX(GetAttacker()), GetUnitY(GetAttacker()), 128, true, false), 1)
		endif
	endif
	return false
endfunction
function SEO takes nothing returns boolean
	local trigger t
	local group g
	local unit u
	call ExecuteFunc("PreloadNeutralCreeps")
	if IsGameHaveObserver then
		set t = CreateTrigger()
		call TriggerRegisterPlayerUnitEvent(t, SentinelPlayers[0], EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER, null)
		call TriggerRegisterPlayerUnitEvent(t, ScourgePlayers[0], EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER, null)
		call TriggerAddCondition(t, Condition(function Q9O))
		set t = CreateTrigger()
		set g = AllocationGroup(62)
		call GroupEnumUnitsOfPlayer(g, SentinelPlayers[0], null)
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			call GroupRemoveUnit(g, u)
			if GetUnitAcquireRange(u)!= 0 then
				call TriggerRegisterUnitInRange(t, u, 600, null)
			endif
		endloop
		call DeallocateGroup(g)
		set g = AllocationGroup(63)
		call GroupEnumUnitsOfPlayer(g, ScourgePlayers[0], null)
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			call GroupRemoveUnit(g, u)
			if GetUnitAcquireRange(u)!= 0 and IsUnitType(u, UNIT_TYPE_STRUCTURE) then
				call TriggerRegisterUnitInRange(t, u, 600, null)
			endif
		endloop
		call DeallocateGroup(g)
		call TriggerAddCondition(t, Condition(function Q7O))
		set t = CreateTrigger()
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
		call TriggerAddCondition(t, Condition(function SVO))
	endif
	call CleanCurrentTrigger(GetTriggeringTrigger())
	set t = null
	set g = null
	set u = null
	return false
endfunction
// 修正视野 向友军玩家开放视野
function SOO takes unit whichUnit returns nothing
	local integer i = 0
	loop
	exitwhen(i == 16)
		if IsUnitAlly(whichUnit, Player(i)) then
			call UnitShareVision(whichUnit, Player(i), true)
		endif
		set i = i + 1
	endloop
endfunction
function SRO takes nothing returns nothing
	call SOO(GetEnumUnit())
endfunction
function SIO takes nothing returns nothing
	local integer x
	local group g
	set x = 1
	loop
	exitwhen x > 5
		call SetPlayerAlliance(SentinelPlayers[0], SentinelPlayers[x], ALLIANCE_SHARED_VISION, false)
		call SetPlayerAlliance(ScourgePlayers[0], ScourgePlayers[x], ALLIANCE_SHARED_VISION, false)
		set x = x + 1
	endloop
	set g = AllocationGroup(64)
	call GroupEnumUnitsOfPlayer(g, SentinelPlayers[0], null)
	call ForGroup(g, function SRO)
	call DeallocateGroup(g)
	set g = AllocationGroup(65)
	call GroupEnumUnitsOfPlayer(g, ScourgePlayers[0], null)
	call ForGroup(g, function SRO)
	call DeallocateGroup(g)
	set g = null
endfunction
function SAO takes nothing returns nothing
	local integer x
	set x = 0
	loop
	exitwhen x > 5
		call SetPlayerAlliance(SentinelPlayers[x], NeutralCreepPlayer, ALLIANCE_PASSIVE, false)
		call SetPlayerAlliance(SentinelPlayers[x], NeutralCreepPlayer, ALLIANCE_HELP_REQUEST, false)
		call SetPlayerAlliance(SentinelPlayers[x], NeutralCreepPlayer, ALLIANCE_HELP_RESPONSE, false)
		call SetPlayerAlliance(SentinelPlayers[x], NeutralCreepPlayer, ALLIANCE_SHARED_XP, false)
		call SetPlayerAlliance(SentinelPlayers[x], NeutralCreepPlayer, ALLIANCE_SHARED_SPELLS, false)
		call SetPlayerAlliance(SentinelPlayers[x], NeutralCreepPlayer, ALLIANCE_SHARED_VISION, false)
		call SetPlayerAlliance(SentinelPlayers[x], NeutralCreepPlayer, ALLIANCE_SHARED_CONTROL, false)
		call SetPlayerAlliance(SentinelPlayers[x], NeutralCreepPlayer, ALLIANCE_SHARED_ADVANCED_CONTROL, false)
		call SetPlayerAlliance(ScourgePlayers[x], NeutralCreepPlayer, ALLIANCE_PASSIVE, false)
		call SetPlayerAlliance(ScourgePlayers[x], NeutralCreepPlayer, ALLIANCE_HELP_REQUEST, false)
		call SetPlayerAlliance(ScourgePlayers[x], NeutralCreepPlayer, ALLIANCE_HELP_RESPONSE, false)
		call SetPlayerAlliance(ScourgePlayers[x], NeutralCreepPlayer, ALLIANCE_SHARED_XP, false)
		call SetPlayerAlliance(ScourgePlayers[x], NeutralCreepPlayer, ALLIANCE_SHARED_SPELLS, false)
		call SetPlayerAlliance(ScourgePlayers[x], NeutralCreepPlayer, ALLIANCE_SHARED_VISION, false)
		call SetPlayerAlliance(ScourgePlayers[x], NeutralCreepPlayer, ALLIANCE_SHARED_CONTROL, false)
		call SetPlayerAlliance(ScourgePlayers[x], NeutralCreepPlayer, ALLIANCE_SHARED_ADVANCED_CONTROL, false)
		call SetPlayerAlliance(NeutralCreepPlayer, SentinelPlayers[x], ALLIANCE_PASSIVE, false)
		call SetPlayerAlliance(NeutralCreepPlayer, SentinelPlayers[x], ALLIANCE_HELP_REQUEST, false)
		call SetPlayerAlliance(NeutralCreepPlayer, SentinelPlayers[x], ALLIANCE_HELP_RESPONSE, false)
		call SetPlayerAlliance(NeutralCreepPlayer, SentinelPlayers[x], ALLIANCE_SHARED_XP, false)
		call SetPlayerAlliance(NeutralCreepPlayer, SentinelPlayers[x], ALLIANCE_SHARED_SPELLS, false)
		call SetPlayerAlliance(NeutralCreepPlayer, SentinelPlayers[x], ALLIANCE_SHARED_VISION, false)
		call SetPlayerAlliance(NeutralCreepPlayer, SentinelPlayers[x], ALLIANCE_SHARED_CONTROL, false)
		call SetPlayerAlliance(NeutralCreepPlayer, SentinelPlayers[x], ALLIANCE_SHARED_ADVANCED_CONTROL, false)
		call SetPlayerAlliance(NeutralCreepPlayer, ScourgePlayers[x], ALLIANCE_PASSIVE, false)
		call SetPlayerAlliance(NeutralCreepPlayer, ScourgePlayers[x], ALLIANCE_HELP_REQUEST, false)
		call SetPlayerAlliance(NeutralCreepPlayer, ScourgePlayers[x], ALLIANCE_HELP_RESPONSE, false)
		call SetPlayerAlliance(NeutralCreepPlayer, ScourgePlayers[x], ALLIANCE_SHARED_XP, false)
		call SetPlayerAlliance(NeutralCreepPlayer, ScourgePlayers[x], ALLIANCE_SHARED_SPELLS, false)
		call SetPlayerAlliance(NeutralCreepPlayer, ScourgePlayers[x], ALLIANCE_SHARED_VISION, false)
		call SetPlayerAlliance(NeutralCreepPlayer, ScourgePlayers[x], ALLIANCE_SHARED_CONTROL, false)
		call SetPlayerAlliance(NeutralCreepPlayer, ScourgePlayers[x], ALLIANCE_SHARED_ADVANCED_CONTROL, false)
		set x = x + 1
	endloop
endfunction
function SNO takes nothing returns boolean
	return LWO(GetTriggerUnit())
endfunction
function SBO takes nothing returns nothing
	call SOO(GetTriggerUnit())
endfunction
// 如果有ob 则会注册一些触发器
function SCO takes nothing returns nothing
	local trigger t = null
	if not IsGameHaveObserver then
		return
	endif
	call SIO()
	call SAO()
	set t = CreateTrigger()
	call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	call TriggerAddCondition(t, Condition(function SNO))
	call TriggerAddAction(t, function SBO)
	set t = null
endfunction
function SDO takes nothing returns boolean
	local integer WWV = 1
	local integer i
	local unit trigUnit
	local integer SFO
	local integer SGO
	loop
	exitwhen WWV > 11
		set trigUnit = Player__Hero[WWV]
		if trigUnit != null and UnitIsDead(trigUnit) == false and GetUnitTypeId(trigUnit) == PlayerHeroTypeId[WWV]and R5X(trigUnit) == false then
			loop
				set i = GetRandomInt(1,'l')
			exitwhen(IsUnitIdType(HeroListTypeId[i], UNIT_TYPE_MELEE_ATTACKER) and IsUnitIdType(PlayerHeroTypeId[WWV], UNIT_TYPE_MELEE_ATTACKER)) or(IsUnitIdType(HeroListTypeId[i], UNIT_TYPE_RANGED_ATTACKER) and IsUnitIdType(PlayerHeroTypeId[WWV], UNIT_TYPE_RANGED_ATTACKER))
			endloop
			call SaveInteger(HY, GetHandleId(LoadTriggerHandle(HY, GetHandleId(trigUnit),'0PAS')), 100, 1)
			call TriggerEvaluate(LoadTriggerHandle(HY, GetHandleId(trigUnit),'0PAS'))
			set SFO = REX(PlayerHeroTypeId[WWV])
			set SGO = REX(HeroListTypeId[i])
			call UnitAddAbility(trigUnit, SFO)
			call UnitRemoveAbility(trigUnit, SFO)
			call UnitAddAbility(trigUnit, SGO + 1)
			call UnitRemoveAbility(trigUnit, SGO + 1)
			set PlayerHeroTypeId[WWV]= HeroListTypeId[i]
		endif
		set WWV = WWV + 1
	endloop
	set trigUnit = null
	return false
endfunction
function SHO takes nothing returns nothing
	call UnitRemoveAbility(GetEnumUnit(),'A44F')
endfunction
function SJO takes nothing returns nothing
	local group g = AllocationGroup(66)
	call GroupEnumUnitsInRange(g, 0, 0, 18000, null)
	call ForGroup(g, function SHO)
	call DeallocateGroup(g)
	set g = null
endfunction
function SKO takes nothing returns nothing
	if bj_isSinglePlayer then
		call SetPlayerAlliance(Player(0), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(1), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(2), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(3), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(4), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(5), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(6), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(7), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(8), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(9), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(10), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(11), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(12), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player( 13), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player( 14), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(15), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SJO()
		call ClearTextMessages()
	endif
endfunction
function ShowSkillsOnSelecting takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local player t = GetOwningPlayer(GetTriggerUnit())
	local integer i
	if p != t and JI[GetPlayerId(p)]and GetTriggerUnit() == Player__Hero[GetPlayerId(t)]and IsPlayerAlly(p, t) then
		set i = PlayerSkillIndex[GetPlayerId(t)* HL]
		call DisplayTimedTextToPlayer(p, 0, 0, 10, "|c00a0a0f8" + GetObjectName(HeroCommonSkills[i + 1])+ "|r level: |c00f8a0a0" + I2S(ZTE(GetTriggerUnit(), 1))+ "|r")
		call DisplayTimedTextToPlayer(p, 0, 0, 10, "|c00a0a0f8" + GetObjectName(HeroCommonSkills[i + 2])+ "|r level: |c00f8a0a0" + I2S(ZTE(GetTriggerUnit(), 2))+ "|r")
		call DisplayTimedTextToPlayer(p, 0, 0, 10, "|c00a0a0f8" + GetObjectName(HeroCommonSkills[i + 3])+ "|r level: |c00f8a0a0" + I2S(ZTE(GetTriggerUnit(), 3))+ "|r")
		call DisplayTimedTextToPlayer(p, 0, 0, 10, "|c00ff54f2" + GetObjectName(HeroCommonSkills[i + 4])+ "|r level: |c00f8a0a0" + I2S(ZTE(GetTriggerUnit(), 4))+ "|r")
		if ExtraSkillsNumber > 0 then
			call DisplayTimedTextToPlayer(p, 0, 0, 10, "|c00a0a0f8" + GetObjectName(HeroCommonSkills[i + 5])+ "|r level: |c00f8a0a0" + I2S(ZTE(GetTriggerUnit(), 5))+ "|r")
			if (HeroCommonSkills[PlayerSkillIndex[GetPlayerId(p)* HL + 6]]> 0) then
				call DisplayTimedTextToPlayer(p, 0, 0, 10, "|c00ff54f2" + GetObjectName(HeroCommonSkills[i + 6])+ "|r level: |c00f8a0a0" + I2S(ZTE(GetTriggerUnit(), 6))+ "|r")
			endif
		endif
	endif
	if GetUnitTypeId(GetTriggerUnit())!='hfoo' and IsUnitEnemy(GetTriggerUnit(), p) and UnitVisibleToPlayer(GetTriggerUnit(), p) == false then
		if GetObjectName('TEST') == "L1ch" then
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, "|c00ff0303可能的开图点击|r " + PlayersColoerText[GetPlayerId(p)] + PlayersName[GetPlayerId(p)] + "|r on " + GetUnitName(GetTriggerUnit()))
		endif
	endif
endfunction
function SLO takes nothing returns nothing
	call UnitRemoveAbility(GetChangingUnit(),'A44F')
endfunction
function SMO takes nothing returns nothing
	local integer i
	local integer T0V
	local integer TTV
	local player p
	local integer k = 1
	local integer te = 0
	loop
		set p = Player(k)
		set i = k
		if FP[i]== false and GetPlayerController(p) == MAP_CONTROL_USER and GetPlayerSlotState(p) == PLAYER_SLOT_STATE_PLAYING then
			loop
			exitwhen FP[i]
				if MainModeName =="sd" or MainModeName =="md" then
					loop
						set TTV = UIE(GetRandomInt(1, GL))
					exitwhen(DP[i * GL + TTV]and ZQ[TTV]== false)
					endloop
					set T0V =(TTV * 4)-4
					set T0V = T0V + GetRandomInt(1, 4)
					call SaveInteger(HY,'0REA','0PID', i)
					call SaveInteger(HY,'0REA','0SID', T0V)
					call SaveBoolean(HY,'0REA','000B', false)
					call ExecuteFunc("SPO")
				else
					loop
						set T0V =(GetRandomInt(1, GL * 4))
						set te = UIE((T0V + 3)/ 4)
					exitwhen ZQ[te]== false
					endloop
					call SaveInteger(HY,'0REA','0PID', i)
					call SaveInteger(HY,'0REA','0SID', T0V)
					call SaveBoolean(HY,'0REA','000B', false)
					call ExecuteFunc("SPO")
				endif
			endloop
		endif
		set k = k + 1
		if k == 6 then
			set k = 7
		endif
	exitwhen k > 11
	endloop
	call ExecuteFunc("SQO")
endfunction
function SSO takes nothing returns nothing
	call UnitAddPermanentAbility(GetEnumUnit(), TempInt)
	if MC == 1. then
		call SetPlayerAbilityAvailable(GetOwningPlayer(GetEnumUnit()), TempInt, false)
		set MC = .0
	endif
	if GetUnitAbilityLevel(GetEnumUnit(), TempInt) == 0 then
		call AddUnitToStock(GetEnumUnit(), TempInt, 1, 1)
		// debug call SingleDebug(UGV(TempInt)+ " (" + GetObjectName(TempInt)+ ") added")
	endif
endfunction
function STO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 99999)
	local group g
	if bj_isSinglePlayer then
		set TempInt = UDV(SUO)
		set MC = .0
		call XSX(TempInt)
		if SubString(SUO, 0, 2) == "QU" then
			set MC = 1.
		endif
		set g = AllocationGroup(67)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function SSO)
		call DeallocateGroup(g)
	endif
	set g = null
endfunction
function SWO takes nothing returns nothing
	call UnitRemoveAbility(GetEnumUnit(), TempInt)
endfunction
function SYO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 99999)
	local group g
	if bj_isSinglePlayer then
		set TempInt = UDV(SUO)
		set g = AllocationGroup(68)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		if FirstOfGroup(g) == null then
			call GroupAddUnit(g, Player__Hero[GetPlayerId(GetTriggerPlayer())])
		endif
		call ForGroup(g, function SWO)
		call DeallocateGroup(g)
	endif
	set g = null
endfunction
function SZO takes nothing returns nothing
	call BJDebugMsg(GetObjectName(GetUnitTypeId(GetEnumUnit()))+ "'s lvl of " + UGV(TempInt)+ " is " + I2S(GetUnitAbilityLevel(GetEnumUnit(), TempInt)))
endfunction
function S_O takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 99999)
	local group g
	if bj_isSinglePlayer then
		set TempInt = UDV(SUO)
		set g = AllocationGroup(69)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function SZO)
		call DeallocateGroup(g)
	endif
	set g = null
endfunction
function S0O takes nothing returns nothing
	call SetPlayerAbilityAvailable(GetOwningPlayer(GetEnumUnit()), TempInt, false)
endfunction
function S1O takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 99999)
	local group g
	if bj_isSinglePlayer then
		set TempInt = UDV(SUO)
		set g = AllocationGroup(70)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function S0O)
		call DeallocateGroup(g)
	endif
	set g = null
endfunction
function S2O takes nothing returns nothing
	local item it = UnitAddItemById(GetEnumUnit(), TempInt)
	call SetItemPlayer(it, GetOwningPlayer(GetEnumUnit()), false)
	set it = null
endfunction
function S3O takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 99999)
	local group g
	if bj_isSinglePlayer then
		set TempInt = UDV(SUO)
		set g = AllocationGroup(71)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function S2O)
		call DeallocateGroup(g)
	endif
	set g = null
endfunction
function S4O takes nothing returns nothing
	call SetUnitOwner(GetEnumUnit(), Player(TempInt), true)
	if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
		set Player__Hero[TempInt]= GetEnumUnit()
	endif
endfunction
function S5O takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 3, 5)
	local group g
	if bj_isSinglePlayer then
		set TempInt = S2I(SUO)
		if TempInt < 0 or TempInt > 15 then
			return
		endif
		set g = AllocationGroup(72)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function S4O)
		call DeallocateGroup(g)
	endif
	set g = null
endfunction
function S6OCD takes nothing returns nothing
	local player p = GetTriggerPlayer()
	call ShowAbilityCd_Actions(p, false)
	call Click_CheckBox_Nothing(p, 2)
endfunction
function S6O takes nothing returns nothing
	local player p = GetTriggerPlayer()
	call Q_X(p, false)
	call Click_CheckBox_Nothing(p, 1)
endfunction
function LZSB takes nothing returns nothing
	local player p = GetTriggerPlayer()
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, GetPlayerName(p)+ " 已开启了隐藏作弊码")
endfunction
function JUHUABUniubi takes nothing returns nothing
	set ShouSiJuHuaB = true
	call DestroyTimer(GetExpiredTimer())
endfunction
function JUHUANIUBI takes nothing returns nothing
	local timer t
	if ShouSiJuHuaB then
		set ShouSiJuHuaB = false
		call PlaySoundBJ(ShouSiJuHua)
		set t = CreateTimer()
		call TimerStart(t, 80.00, false, function JUHUABUniubi)
	endif
	set t = null
endfunction
function WOJIUPAO takes nothing returns nothing
	set JUHUABIEPAOB = true
	call DestroyTimer(GetExpiredTimer())
endfunction
function JUHUAZHANZU takes nothing returns nothing
	local timer t
	if JUHUABIEPAOB then
		set JUHUABIEPAOB = false
		call PlaySoundBJ(JUHUABIEPAO)
		set t = CreateTimer()
		call TimerStart(t, 80.00, false, function WOJIUPAO)
	endif
	set t = null
endfunction
function WOZAODEZHU takes nothing returns nothing
	set SHUIZAODEZHUAB = true
	call DestroyTimer(GetExpiredTimer())
endfunction
function ZHESHUIZAODEZHUA takes nothing returns nothing
	local timer t
	if SHUIZAODEZHUAB then
		set SHUIZAODEZHUAB = false
		call PlaySoundBJ(SHUIZAODEZHUA)
		set t = CreateTimer()
		call TimerStart(t, 80.00, false, function WOZAODEZHU)
	endif
	set t = null
endfunction
function BEJUHUACHILE takes nothing returns nothing
	set WEIGOUCHILEB = true
	call DestroyTimer(GetExpiredTimer())
endfunction
function GENGXINGRIZHI takes nothing returns nothing
	local timer t
	if WEIGOUCHILEB then
		set WEIGOUCHILEB = false
		call PlaySoundBJ(WEIGOUCHILE)
		set t = CreateTimer()
		call TimerStart(t, 80.00, false, function BEJUHUACHILE)
	endif
	set t = null
	if GetTriggerPlayer() == LocalPlayer and not IsReplayMode then
		set UpdateLogIsShow = true
		call DzFrameShow(UIFrame__UpdateLog, true)
	endif
endfunction

function BUJIN takes nothing returns nothing
	local player p = GetTriggerPlayer()
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, "不禁，再问自杀")
endfunction
function S7O takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 18, 19)
	local integer i = S2I(SUO)
	if i > 0 and i < 7 then
		if UnitItemInSlot(Player__Hero[GetPlayerId(GetTriggerPlayer())], i -1)!= null and GetItemIndexEx(UnitItemInSlot(Player__Hero[GetPlayerId(GetTriggerPlayer())], i -1))< 0 or GetItemTypeId(UnitItemInSlot(Player__Hero[GetPlayerId(GetTriggerPlayer())], i -1)) == 0 then
			call UnitRemoveItemFromSlot(Player__Hero[GetPlayerId(GetTriggerPlayer())], i -1)
		else
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "该物品不属于Bug")
		endif
	endif
endfunction
function S8O takes nothing returns nothing
	call SetUnitMoveSpeed(GetEnumUnit(),(MC))
endfunction
function S9O takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 7, 999)
	local group g
	if bj_isSinglePlayer then
		set MC = S2R(SUO)
		set g = AllocationGroup(73)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function S8O)
		call DeallocateGroup(g)
	endif
	set g = null
endfunction
function TVO takes nothing returns nothing
	if IsItemPawnable(UnitItemInSlot(GetEnumUnit(), TempInt)) then
		call BJDebugMsg("pawn")
	else
		call BJDebugMsg("unpawn")
	endif
endfunction
function TEO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 999)
	local group g
	if bj_isSinglePlayer then
		set TempInt = S2I(SUO)
		set g = AllocationGroup(74)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function TVO)
		call DeallocateGroup(g)
	endif
	set g = null
endfunction
function TXO takes nothing returns nothing
	call UnitAddType(GetEnumUnit(), ConvertUnitType(TempInt))
	if IsUnitType(GetEnumUnit(), ConvertUnitType(TempInt)) then
		call BJDebugMsg("added")
	endif
endfunction
function TOO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 999)
	local group g
	if bj_isSinglePlayer then
		set TempInt = S2I(SUO)
		set g = AllocationGroup(75)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function TXO)
		call DeallocateGroup(g)
	endif
	set g = null
endfunction
function TRO takes nothing returns nothing
	local string s = SubString(GetEventPlayerChatString(), 6, 999)
	local group g
	local integer i = S2I(s)
	local boolean b = false
	local unit u
	if I2S(i)!= s then
		set b = true
	endif
	set g = AllocationGroup(76)
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if b then
			call SetUnitAnimation(u, s)
		else
			call SetUnitAnimationByIndex(u, i)
		endif
		call GroupRemoveUnit(g, u)
	endloop
	call DeallocateGroup(g)
	set g = null
endfunction
function TIO takes nothing returns nothing
	call SetWidgetLife(GetEnumUnit(), TempInt)
endfunction
function TAO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 999)
	local group g
	local integer i = S2I(SUO)
	if bj_isSinglePlayer then
		set TempInt = S2I(SUO)
		set g = AllocationGroup(77)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function TIO)
		call DeallocateGroup(g)
	endif
	set g = null
endfunction
function TNO takes nothing returns nothing
	// debug call SingleDebug(R2S(GetWidgetLife(GetEnumUnit())))
endfunction
function TBO takes nothing returns nothing
	local group g
	if bj_isSinglePlayer then
		set g = AllocationGroup(78)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function TNO)
		call DeallocateGroup(g)
	endif
	set g = null
endfunction
function TCO takes nothing returns nothing
	call KillUnit(GetEnumUnit())
endfunction
function TDO takes nothing returns nothing
	local group g
	if bj_isSinglePlayer then
		set g = AllocationGroup(79)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function TCO)
		call DeallocateGroup(g)
	endif
	set g = null
endfunction
function TFO takes nothing returns nothing
	call SetUnitState(GetEnumUnit(), UNIT_STATE_MANA, TempInt)
endfunction
function TGO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 999)
	local group g
	local integer i = S2I(SUO)
	if bj_isSinglePlayer then
		set TempInt = S2I(SUO)
		set g = AllocationGroup(80)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function TFO)
		call DeallocateGroup(g)
	endif
	set g = null
endfunction
function THO takes nothing returns nothing
	call CreateItem(TempInt, GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()))
endfunction
function TJO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 9)
	local group g
	local integer i = S2I(SUO)
	if bj_isSinglePlayer then
		set TempInt = UDV(SUO)
		set g = AllocationGroup(81)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function THO)
		call DeallocateGroup(g)
	endif
	set g = null
endfunction
function TKO takes nothing returns nothing
	call BJDebugMsg(R2S(GetUnitX(GetEnumUnit()))+ " " + R2S(GetUnitY(GetEnumUnit())))
endfunction
function TLO takes nothing returns nothing
	local group g
	if bj_isSinglePlayer then
		set g = AllocationGroup(82)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function TKO)
		call DeallocateGroup(g)
	endif
	set g = null
endfunction
function TMO takes nothing returns nothing
	local real r = S2R(SubString(GetEventPlayerChatString(), 5, 15))
	call SetCameraFieldForPlayer(GetTriggerPlayer(), CAMERA_FIELD_FARZ, 100000000, 0)
	if r <= 0 then
		call SetCameraFieldForPlayer(GetTriggerPlayer(), CAMERA_FIELD_TARGET_DISTANCE, 1650, 0)
		call SaveReal(OtherHashTable, GetHandleId(GetTriggerPlayer()),'CAMD', 1650)
		call InterfaceErrorForPlayer(GetTriggerPlayer(), "不正确的参数，镜头调整至默认值。")
	elseif r > 0 and r < 3 then
		call SetCameraFieldForPlayer(GetTriggerPlayer(), CAMERA_FIELD_TARGET_DISTANCE, 1650* r, 0)
		call SaveReal(OtherHashTable, GetHandleId(GetTriggerPlayer()),'CAMD', 1650* r)
	elseif r >= 600 and r <= 4500 then
		call SetCameraFieldForPlayer(GetTriggerPlayer(), CAMERA_FIELD_TARGET_DISTANCE, r, 0)
		call SaveReal(OtherHashTable, GetHandleId(GetTriggerPlayer()),'CAMD', r)
	else
		call InterfaceErrorForPlayer(GetTriggerPlayer(), "参数不能低于600或高于4500。")
	endif
endfunction
function TPO takes nothing returns nothing
	call RemoveUnit(GetEnumUnit())
endfunction
function TQO takes nothing returns nothing
	local group g
	if bj_isSinglePlayer then
		set g = AllocationGroup(83)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function TPO)
		call DeallocateGroup(g)
	endif
	set g = null
endfunction

// 投降
function TSO takes nothing returns nothing
	local integer i = 1
	local integer k = 5
	local integer TTO = 0
	local integer pid = GetPlayerId(GetTriggerPlayer())
	if FA[pid]== false then
		if pid > 6 then
			set k = 11
			set i = 7
		endif
		loop
			if FA[i] then
				set TTO = TTO + 1
			endif
			set i = i + 1
		exitwhen i > k
		endloop
		if TTO == 4 then
			call GameEndStoreChacheData()
			if pid < 7 then
				call KillUnit(WorldTree)
			else
				call KillUnit(FrozenThrone)
			endif
		endif
		set FA[pid]= true
	endif
endfunction
function TUO takes nothing returns nothing
	local integer pid = GetPlayerId(GetTriggerPlayer())
	local unit u = Player__Hero[pid]
	if (u != null and UnitAlive(u)) then
		if GetUnitAbilityLevel(u,'A0KW')> 0 then
			call SetPlayerAbilityAvailable(Player(pid),'A0KW', XA[pid])
			call SetPlayerAbilityAvailable(Player(pid),'A0KX', XA[pid])
			set XA[pid]= not XA[pid]
		else
			call InterfaceErrorForPlayer(GetTriggerPlayer(), "你没有属性转换")
		endif
	else
		call InterfaceErrorForPlayer(GetTriggerPlayer(), "你没有英雄")
	endif
	set u = null
endfunction
function TWO takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer i = 1
	if IsScourgePlayer(p) then
		set i = 7
	endif
	call SetPlayerAlliance(Player(i + 0), p, ALLIANCE_SHARED_ADVANCED_CONTROL, not GetPlayerAlliance(Player(i + 0), p, ALLIANCE_SHARED_ADVANCED_CONTROL))
	call SetPlayerAlliance(Player(i + 1), p, ALLIANCE_SHARED_ADVANCED_CONTROL, not GetPlayerAlliance(Player(i + 1), p, ALLIANCE_SHARED_ADVANCED_CONTROL))
	call SetPlayerAlliance(Player(i + 2), p, ALLIANCE_SHARED_ADVANCED_CONTROL, not GetPlayerAlliance(Player(i + 2), p, ALLIANCE_SHARED_ADVANCED_CONTROL))
	call SetPlayerAlliance(Player(i + 3), p, ALLIANCE_SHARED_ADVANCED_CONTROL, not GetPlayerAlliance(Player(i + 3), p, ALLIANCE_SHARED_ADVANCED_CONTROL))
	call SetPlayerAlliance(Player(i + 4), p, ALLIANCE_SHARED_ADVANCED_CONTROL, not GetPlayerAlliance(Player(i + 4), p, ALLIANCE_SHARED_ADVANCED_CONTROL))
endfunction
function TYO takes nothing returns nothing
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "你的资产为 " + I2S(RI[GetPlayerId(GetTriggerPlayer())]))
endfunction
function TZO takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local boolean b = LoadBoolean(OtherHashTable, GetHandleId(p),'UIds')
	call Click_CheckBox_Nothing(p, 18)
	if LocalPlayer == p then
		call GetSetupText("信使复活窗口", b)
	endif
	call SaveBoolean(OtherHashTable, GetHandleId(p),'UIds', not b)
endfunction
function T_O takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer pid = GetPlayerId(p)
	call Click_CheckBox_Nothing(p, 17)
	if LocalPlayer == p then
		call GetSetupText("快速清理", DisplayTextDuration[pid]== 10.)
	endif
	if DisplayTextDuration[pid]== 1. then
		//call DisplayTimedTextToPlayer(p, 0, 0, 3, "|c00aeae00 快速清理关闭|r - 所有死亡信息持续显示10秒.")
		set DisplayTextDuration[pid]= 10.
	else
		//call DisplayTimedTextToPlayer(p, 0, 0, 3, "|c00fcfa00 快速清理开启|r - 所有死亡信息持续显示1秒.")
		set DisplayTextDuration[pid]= 1.
	endif
endfunction
function T0O takes nothing returns nothing
	call SaveBoolean(OtherHashTable, GetHandleId(GetTriggerPlayer()),'NSHK', true)
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "|c00aeae00 无相同热键|r 模式关闭 - 你可以选择任意热键冲突的技能")
endfunction
function T1O takes nothing returns nothing
	local group g = AllocationGroup(84)
	local unit u
	local integer i = 0
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		// debug call SingleDebug(UGV(GetUnitTypeId(u)))
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call DeallocateGroup(g)
	set g = null
endfunction
function SetCharges takes player p returns nothing
	local boolean b = LoadBoolean(OtherHashTable, GetHandleId(p),'OptC')
	call SaveBoolean(OtherHashTable, GetHandleId(p),'OptC', not b)
	if LocalPlayer == p then
		call GetSetupText("充能显示", b)
	endif
endfunction
function T2O takes nothing returns nothing
	local player p = GetTriggerPlayer()
	call SetCharges(p)
	call Click_CheckBox_Nothing(p, 3)
endfunction

function SetupDoubleClickSpell takes nothing returns nothing
	local player p = GetTriggerPlayer()
	if LocalPlayer == p then
		set IsEnableDoubleClickSystem = not IsEnableDoubleClickSystem
		call GetSetupText("双击对己施法", IsEnableDoubleClickSystem)
	endif
	call Click_CheckBox_Nothing(p, 16)
endfunction

function SetupDoubleClickSpellByCheckBox takes boolean enable returns nothing
	set IsEnableDoubleClickSystem = enable
	call GetSetupText("双击对己施法", IsEnableDoubleClickSystem)
endfunction

function T3O takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer pid = GetPlayerId(p)
	set ZR[pid]= not ZR[pid]
	call Click_CheckBox_Nothing(p, 14)
	if LocalPlayer == p then
		call GetSetupText("震动视角", ZR[pid])
	endif
endfunction
function T4O takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer pid = GetPlayerId(p)
	if LocalPlayer == p then
		call GetSetupText("自动装置神符", XI[pid])
	endif
	set XI[pid]= not XI[pid]
	call Click_CheckBox_Nothing(p, 8)
	//if XI[pid] then
	//	call DisplayTimedTextToPlayer(p, 0, 0, 5, "右键点击|cffff0000神符|r时|c0000FF00不会|r把神符装入瓶中")
	//else
	//	call DisplayTimedTextToPlayer(p, 0, 0, 5, "右键点击|cffff0000神符|r时|c0000FF00将会|r把神符装入瓶中")
	//endif

endfunction
function T5O takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer pid = GetPlayerId(p)
	set JI[pid]= not JI[pid]
	if LocalPlayer == p then
		call GetSetupText("技能可见", JI[pid])
	endif
endfunction
function T6O takes nothing returns nothing
	local player p = GetTriggerPlayer()
	if GetEventPlayerChatString() == "-sddon" then
		//call DisplayTimedTextToPlayer(p, .0, .0, 10., "|cffff0000[SDD] |r" + "|c006699CC" + "显示伤害值已 |c0000FF00开启|r" + "|c006699CC" + "." + "|r")
		set EnableMapSetup__ShowDamageTextTag[GetPlayerId(p)]= true
		call Set_CheckBox_Nothing(p, 15, true)
	else
		//call DisplayTimedTextToPlayer(p, .0, .0, 10., "|cffff0000[SDD] |r" + "|c006699CC" + "显示伤害值已 |c0000FF00关闭|r" + "|c006699CC" + "." + "|r")
		set EnableMapSetup__ShowDamageTextTag[GetPlayerId(p)] = false
		call Set_CheckBox_Nothing(p, 15, false)
	endif
	if LocalPlayer == p then
		call GetSetupText("显示伤害值", EnableMapSetup__ShowDamageTextTag[GetPlayerId(p)])
	endif
endfunction
function T7O takes nothing returns nothing
	local integer pid = GetPlayerId(GetTriggerPlayer())
	if GetUnitAbilityLevel(Player__Hero[pid],'A0AK')> 0 or GetUnitAbilityLevel(Player__Hero[pid],'A1FY')> 0 then
		if GetUnitAbilityLevel(Player__Hero[pid],'A1WF') == 0 then
			call UnitAddPermanentAbility(Player__Hero[pid],'A1WF')
		else
			call UnitRemoveAbility(Player__Hero[pid],'A1WF')
		endif
	endif
endfunction
function T8O takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local boolean CD = LoadBoolean(ObjectHashTable, GetHandleId(p), 4)
	if CD then
		call DisplayTimedTextToPlayer(p, .0, .0, 10., "被动技能内置冷却时间显示已 |c00FF0000关闭|r")
		call SaveBoolean(ObjectHashTable, GetHandleId(p), 4, false)
	else
		call DisplayTimedTextToPlayer(p, .0, .0, 10., "被动技能内置冷却时间显示已 |c00FF0000开启|r")
		call SaveBoolean(ObjectHashTable, GetHandleId(p), 4, true)
	endif

endfunction
function T9O takes nothing returns nothing
	if Mode__FastFinish then
		call YYE(GetPlayerId(GetTriggerPlayer()), false)
	endif
endfunction
function UVO takes nothing returns nothing
	if Mode__FastFinish then
		call Y0E(GetTriggerPlayer())
	endif
endfunction
function XCO takes nothing returns nothing
	local integer i = R2I(TimerGetRemaining(NK))
	call TimerStart(NK, i + 45, false, function SMO)
endfunction
function UEO takes player p returns nothing
	local integer UXO
	local integer ZKE
	local integer i
	local integer te
	if IsPickingHero then
		if GetGameTime()> JN[GetPlayerId(p)] then
			if GS == false then
				call DisplayTimedTextToPlayer(p, .0, .0, 10., "|cff99ccff" + "你现在还不能使用这个命令." + "|r")
			else
				if FP[GetPlayerId(p)] then
					call DisplayTimedTextToPlayer(p, .0, .0, 10., "|cff99ccff" + "你已经将你的所有技能选择完毕." + "|r")
				else
					set JN[GetPlayerId(p)]= GetGameTime()+ 4
					set i = GetPlayerId(p)
					loop
					exitwhen FP[i]
						if MainModeName =="sd" or MainModeName =="md" then
							loop
								set UXO = UIE(GetRandomInt(1, GL))
							exitwhen(DP[i * GL + UXO]and ZQ[UXO]== false)
							endloop
							set ZKE =(UXO * 4)-4
							set ZKE = ZKE + GetRandomInt(1, 4)
							call SaveInteger(HY,'0REA','0PID', i)
							call SaveInteger(HY,'0REA','0SID', ZKE)
							call SaveBoolean(HY,'0REA','000B', false)
							call ExecuteFunc("SPO")
						else
							loop
								set ZKE =(GetRandomInt(1, GL * 4))
								set te = UIE((ZKE + 3)/ 4)
							exitwhen(ZQ[te]== false and GetPlayerTechMaxAllowed(p, HeroListTypeId[te])> 0)
							endloop
							call SaveInteger(HY,'0REA','0PID', i)
							call SaveInteger(HY,'0REA','0SID', ZKE)
							call SaveBoolean(HY,'0REA','000B', false)
							call ExecuteFunc("SPO")
						endif
					endloop
					call DisplayTimedTextToPlayer(p, .0, .0, 10., "|cff99ccff" + "你现在准备好了，你剩下的技能将随机选择." + "|r")
					call ExecuteFunc("SQO")
				endif
			endif
		else
			call DisplayTimedTextToPlayer(p, .0, .0, 10., "|cff99ccff这条命令你使用得太频繁了，请稍后。|r")
		endif
	endif
endfunction
function UOO takes nothing returns nothing
	call UEO(GetTriggerPlayer())
endfunction
function XGO takes nothing returns nothing
	call UEO(E3)
endfunction
function URO takes nothing returns nothing
	if false then
		if HK == false then
			set HK = true
			set QK = CreateTrigger()
			call TriggerRegisterTimerEvent(QK, 2, true)
			call TriggerAddCondition(QK, Condition(function SDO))
		else
			call CleanCurrentTrigger(QK)
		endif
	endif
endfunction
function UIO takes nothing returns nothing
	if not IsPickingHero and MainModeName != "md" then
		call ExecuteFunc("UAO")
	endif
endfunction
function UNO takes nothing returns nothing
	if not IsPickingHero then
		call ExecuteFunc("UBO")
	endif
endfunction
function UCO takes nothing returns nothing
	if B3 and CV then
		call ExecuteFunc("TSO")
	endif
endfunction
function UDO takes nothing returns nothing
	call SetUnitAbilityLevel(GetEnumUnit(), TempInt, Q2)
endfunction
function UFO takes nothing returns nothing
	local string id = SubString(GetEventPlayerChatString(), 4, 8)
	local integer level = S2I(SubString(GetEventPlayerChatString(), 9, 11))
	local group g
	set TempInt = UDV(id)
	set Q2 = level
	set g = AllocationGroup(85)
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	call ForGroup(g, function UDO)
	call DeallocateGroup(g)
	set g = null
endfunction
function UGO takes nothing returns nothing
	local integer id = UDV(SubString(GetEventPlayerChatString(), 4, 8))
	if id > 0 then
		set X3 = true
		call CreateUnit(NeutralCreepPlayer, id,-510,-512, 0)
		set X3 = false
	endif
endfunction
function UHO takes nothing returns nothing
	call CommonUnitAddStun(GetEnumUnit(), 1, false)
endfunction
function UJO takes nothing returns nothing
	local group g
	set g = AllocationGroup(86)
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	call ForGroup(g, function UHO)
	call DeallocateGroup(g)
	set g = null
endfunction
function UKO takes nothing returns nothing
	call SetHeroAgi(GetEnumUnit(),'{', false)
endfunction
function ULO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 7, 10)
	local integer i = S2I(SUO)
	local string UMO = SubString(GetEventPlayerChatString(), 11, 15)
	local integer i2 = S2I(UMO)
	local group g
	set TempInt = i
	set Q2 = i2
	set g = AllocationGroup(87)
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	call ForGroup(g, function UKO)
	call DeallocateGroup(g)
	set g = null
endfunction
function UPO takes nothing returns nothing
	call UnitResetCooldownEx(GetEnumUnit())
	call SetWidgetLife(GetEnumUnit(), 99999999)
	call SetUnitState(GetEnumUnit(), UNIT_STATE_MANA, 99999999)
	call TimerStart(ESV[GetPlayerId(GetOwningPlayer(GetEnumUnit()))], 0, false, null)
	call TimerStart(ETV[GetPlayerId(GetOwningPlayer(GetEnumUnit()))], 0, false, null)
endfunction
function UQO takes nothing returns nothing
	local group g
	set g = AllocationGroup(88)
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	call ForGroup(g, function UPO)
	call DeallocateGroup(g)
	set g = null
endfunction
function USO takes nothing returns nothing
	if IssueTargetOrderById(GetEnumUnit(), TempInt, GetEnumUnit()) then
		// debug call SingleDebug(I2S(TempInt)+ " is target skill")
	elseif IssueImmediateOrderById(GetEnumUnit(), TempInt) then
		// debug call SingleDebug(I2S(TempInt)+ " is immediate skill")
	elseif IssuePointOrderById(GetEnumUnit(), TempInt, 0, 0) then
		// debug call SingleDebug(I2S(TempInt)+ " is point skill")
	endif
endfunction
function UTO takes nothing returns nothing
	local group g
	set TempInt = S2I(SubString(GetEventPlayerChatString(), 4, 19))
	// debug call SingleDebug("Started " + I2S(TempInt))
	set g = AllocationGroup(89)
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	call ForGroup(g, function USO)
	call DeallocateGroup(g)
	set g = null
endfunction
function UUO takes nothing returns nothing
	call SelectUnit(Player__Hero[1], false)
endfunction
function TestTimer takes nothing returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .005, true, function UUO)
endfunction
function UWO takes nothing returns nothing
	local group g = AllocationGroup(90)
	local unit u
	local integer i = 0
	local integer k
	local real x
	local real y
	local boolean array b
	call GroupEnumUnitsOfPlayer(g, GetTriggerPlayer(), null)
	// debug call SingleDebug(I2S(StringHash("df")))
	call CreateUnit(Player(10),'e00E', 1388.5,-5038.25, 0)
	set i = 0
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call DeallocateGroup(g)
	set g = null
endfunction
function UYO takes nothing returns nothing
	local group g = AllocationGroup(91)
	local unit u
	local integer i = 0
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		call UnitAddPermanentAbility(u,'A44P')
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call DeallocateGroup(g)
endfunction
function UZO takes string s returns nothing
	local string sr = ""
	local string sg = ""
	local string sb = ""
	local string sa = ""
	local integer i = 0
	local integer k = StringLength(s)
	local integer U_O = 1
	loop
		if SubString(s, i, i + 1) == " "then
			set U_O = U_O + 1
		else
			if U_O == 1 then
				set sr = sr + SubString(s, i, i + 1)
			elseif U_O == 2 then
				set sg = sg + SubString(s, i, i + 1)
			elseif U_O == 3 then
				set sb = sb + SubString(s, i, i + 1)
			else
				set sa = sa + SubString(s, i, i + 1)
			endif
		endif
		set i = i + 1
	exitwhen i > k
	endloop
	set XK[0]= S2I(sr)
	set XK[1]= S2I(sg)
	set XK[2]= S2I(sb)
	set Q2 = S2I(sa)
endfunction
function U0O takes nothing returns nothing
	local integer r
	local integer g
	local integer b
	local integer a
	local string s = SubString(GetEventPlayerChatString(), 7, StringLength(GetEventPlayerChatString()))
	local unit u
	local group gg = AllocationGroup(92)
	call UZO(s)
	set r = XK[0]
	set g = XK[1]
	set b = XK[2]
	set a = Q2
	call GroupEnumUnitsSelected(gg, GetTriggerPlayer(), null)
	loop
		set u = FirstOfGroup(gg)
	exitwhen u == null
		call SetUnitVertexColor(u, r, g, b, a)
		call GroupRemoveUnit(gg, u)
	endloop
	call DeallocateGroup(gg)
endfunction
function U1O takes string s returns string
	local integer i = 0
	local integer k = StringLength(s)
	local string ss = ""
	local string s3
	loop
		set s3 = SubString(s, i, i + 1)
		if s3 != " " then
			set ss = ss + s3
		else
			return ss
		endif
		set i = i + 1
	exitwhen i + 1 > k
	endloop
	return ss
endfunction
function U2O takes nothing returns nothing
	local string EZX = SubString(GetEventPlayerChatString(), 4, 99)
	local group g = AllocationGroup(93)
	local unit u
	// debug call SingleDebug("PATH: [" + EZX + "]")
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		call AddSpecialEffect(EZX, GetUnitX(u), GetUnitY(u))
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call DeallocateGroup(g)
endfunction
function U3O takes nothing returns nothing
	local string s = SubString(GetEventPlayerChatString(), 4, 99)
	local string U4O = U1O(s)
	local string EZX = SubString(s, StringLength(U4O)+ 1, 99)
	local group g = AllocationGroup(94)
	local unit u
	// debug call SingleDebug("ATTACH: [" + U4O + "]; PATH: [" + EZX + "]")
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		call AddSpecialEffectTarget(EZX, u, U4O)
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call DeallocateGroup(g)
endfunction
function U5O takes string s returns nothing
	local string U6O = ""
	local string U7O = ""
	local integer i = 0
	local integer U8O = StringLength(s)
	local integer k = 1
	loop
	exitwhen i > U8O
		if SubString(s, i, i + 1) == " "then
			set k = k + 1
		else
			if k == 1 then
				set U6O = U6O + SubString(s, i, i + 1)
			else
				set U7O = U7O + SubString(s, i, i + 1)
			endif
		endif
		set i = i + 1
	endloop
	set MC = S2R(U6O)
	set ER = S2R(U7O)
endfunction
function U9O takes nothing returns nothing
	local group g = AllocationGroup(95)
	local unit u
	local string s = GetEventPlayerChatString()
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	call U5O(SubString(s, 5, 999))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if IsUnitType(u, UNIT_TYPE_STRUCTURE) == false then
			call SetUnitX(u, MC)
			call SetUnitY(u, ER)
		else
			call SetUnitPosition(u, MC, ER)
		endif
		call GroupRemoveUnit(g, u)
	endloop
	call DeallocateGroup(g)
endfunction
function WVO takes nothing returns nothing
	local group g = AllocationGroup(96)
	local unit u
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call SetUnitPathing(u, false)
		call GroupRemoveUnit(g, u)
	endloop
	call DeallocateGroup(g)
endfunction
function WEO takes nothing returns nothing
	local group g = AllocationGroup(97)
	local unit u
	local integer i = 0
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		call CIO(u, 9)
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call DeallocateGroup(g)
endfunction
function WXO takes nothing returns nothing
	local group g = AllocationGroup(98)
	local unit u
	local integer i = 0
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		call SetUnitPathing(u, true)
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call DeallocateGroup(g)
endfunction
function WOO takes nothing returns nothing
	local group g = AllocationGroup(99)
	local unit u
	local integer i = 0
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		call SetUnitPathing(u, false)
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call DeallocateGroup(g)
endfunction
function WRO takes nothing returns nothing
	local group g = AllocationGroup(100)
	local unit u
	local integer i = 0
	local integer k = 0
	local string s = SubString(GetEventPlayerChatString(), 7, StringLength(GetEventPlayerChatString()))
	set i = IMinBJ(S2I(s), 36)
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	if i > 0 then
		loop
		exitwhen u == null
			set k = 0
			loop
			exitwhen k == i
				set k = k + 1
				call LaunchMissileByUnitDummy(CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u)+ GetRandomReal(50, 300)* Cos(GetRandomReal(0, 6.14)), GetUnitY(u)+ GetRandomReal(50, 300)* Sin(GetRandomReal(0, 6.14)), 0), u,'h0CR', "WIO", 3000, false)
			endloop
			call GroupRemoveUnit(g, u)
			set u = FirstOfGroup(g)
		endloop
	endif
	call DeallocateGroup(g)
endfunction
function WAO takes nothing returns nothing
	local group g = AllocationGroup(101)
	local unit u
	local integer i = 0
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		// debug call SingleDebug(UNV(IsTerrainPathable(GetUnitX(u), GetUnitY(u), PATHING_TYPE_WALKABILITY) == false))
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call DeallocateGroup(g)
	set g = null
endfunction
function WNO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 7, 99999)
	local real WBO = S2R(SUO)
	local group g = AllocationGroup(102)
	local unit u
	if WBO <= 0 then
		set WBO = 1
	endif
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		call SetUnitScale(u, WBO, 0, 0)
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
endfunction

// 获取当前选择的单位的所有技能
function EXGetUnitAllAbilityId takes nothing returns nothing
	local unit whichUnit = GetPlayerSelectedUnit()
	local integer abilityId   = 0
	local integer loop__Index = 0

	call BJDebugMsg("|cffff6600" + GetUnitName(whichUnit) + " - Abilitys Start|r")
	loop
		set abilityId = EXGetAbilityId( EXGetUnitAbilityByIndex( whichUnit, loop__Index ) )
		exitwhen abilityId == 0
		call BJDebugMsg("|cffffff00 技能[" + I2S(loop__Index) + "] " + Id2String(abilityId) + " " + GetObjectName(abilityId))
		set loop__Index = loop__Index + 1
	endloop
	call BJDebugMsg("|cffff6600" + GetUnitName(whichUnit) + " - Abilitys End|r")

	set whichUnit = null
endfunction


// 驱散Buff
// EXGetAbilityId( EXGetUnitAbilityByIndex( whichUnit, Index ) )
// 可以通过这个来遍历单位所有技能查询Buff 而不必遍历Buff表
// 效率是按单位的技能数量来比 不过即使是60个技能也比正常的遍历Buff表快2倍
// 写法可再优化 减少If
function RemoveUnitBuff takes unit u, boolean FLX returns nothing
	local integer abilityId = 0
	local integer loop__Index = 0
	loop
		set abilityId = EXGetAbilityId( EXGetUnitAbilityByIndex( u, loop__Index ) )
		exitwhen abilityId == 0

		// debug call SingleDebug( I2S( loop__Index ) + " 号技能为 " + GetObjectName(abilityId) + " " + YDWEId2S( abilityId ) )
		if LoadInteger(AbilityDataHashTable,'PRGC', abilityId) != 0 then
			call UnitRemoveAbility(u, abilityId)
		endif
		if FLX then
			if LoadInteger(AbilityDataHashTable,'PRGA', abilityId) != 0 then
				call UnitRemoveAbility(u, abilityId)
			endif
		else
			if LoadInteger(AbilityDataHashTable,'PRGE', abilityId) != 0 then
				call UnitRemoveAbility(u, abilityId)
			endif
			if LoadInteger(AbilityDataHashTable,'PRGI', abilityId) != 0 then
				call UnitRemoveAbility(u, abilityId)
			endif
			if LoadInteger(AbilityDataHashTable,'PRGS', abilityId) != 0 then
				call UnitRemoveAbility(u, abilityId)
			endif
			if LoadInteger(AbilityDataHashTable,'PRGN', abilityId) != 0 then
				call UnitRemoveAbility(u, abilityId)
			endif
		endif

		set loop__Index = loop__Index + 1
	endloop

	call FNX(u, 0, 0)
	call RemoveSavedReal(HY, GetHandleId(u),'AItb')
	if LoadInteger(HY, GetHandleId(u), 627)> 0 then
		call SaveInteger(HY, GetHandleId(u), 627, 0)
	endif
	
	call UnitRemoveAbility(u, 'Bblo')
	call UnitRemoveAbility(u, 'B016')
	// 嗜血Buff删除
	if HaveSavedHandle( ExtraHT, GetHandleId(u), HTKEY_SCALE_BLOODLUST_TRIGGER ) then
		// debug call SingleDebug( " 强制运行缩放触发器 " )
		call TriggerEvaluate( LoadTriggerHandle( ExtraHT, GetHandleId(u), HTKEY_SCALE_BLOODLUST_TRIGGER ) )
	endif
	// 狂猛Buff删除
	if HaveSavedHandle( ExtraHT, GetHandleId(u), HTKEY_SCALE_RABID_TRIGGER ) then
		// debug call SingleDebug( " 强制运行缩放触发器 " )
		call TriggerEvaluate( LoadTriggerHandle( ExtraHT , GetHandleId(u) , HTKEY_SCALE_RABID_TRIGGER ) )
	endif
endfunction

// 10000 loop
function TestEfficiencyActions takes nothing returns nothing
	local integer i = 0
	loop
	exitwhen i == 100
		call RemoveUnitBuff(GetPlayerSelectedUnit(), false)
		set i = i + 1
	endloop

endfunction

function TestEfficiency takes nothing returns nothing
    local integer i = 0

	set Temp__ArrayReal[10] = S2R(EXExecuteScript( "os.clock()" ))
    loop
        exitwhen i == 100
        call ExecuteFunc("TestEfficiencyActions")
        set i = i + 1
    endloop
    call DisplayTextToPlayer(GetLocalPlayer(),0,0, "用时"+ R2S( S2R(EXExecuteScript( "os.clock()" )) - Temp__ArrayReal[10]  ) )

endfunction

function DebugUnitCollisionType takes nothing returns nothing
	local unit u = GetPlayerSelectedUnit()
	local integer from_other = MHUnit_GetDefDataInt(GetUnitTypeId(u), UNIT_DEF_DATA_COLLISION_TYPE_FROM_OTHER)
	local integer to_other   = MHUnit_GetDefDataInt(GetUnitTypeId(u), UNIT_DEF_DATA_COLLISION_TYPE_TO_OTHER)

	call BJDebugMsg("from_other:" + I2S(from_other))
	call BJDebugMsg("to_other  :" + I2S(to_other))

	set u = null
endfunction

function WCO takes string s returns nothing
	local boolean WDO = SubString(s, 0, 4) == "-aa "
	local boolean WFO = SubString(s, 0, 4) == "-au "
	local boolean WGO = SubString(s, 0, 4) == "-sa "
	local boolean WHO = SubString(s, 0, 4) == "-at "
	local boolean WJO = SubString(s, 0, 4) == "-ra "
	local boolean WKO = s == "-r"
	local boolean WLO = SubString(s, 0, 4) == "-ga "
	local boolean WMO = SubString(s, 0, 4) == "-ha "
	local boolean WPO = SubString(s, 0, 4) == "-ai "
	local boolean WQO = SubString(s, 0, 3) == "-o "
	local boolean WSO = SubString(s, 0, 4) == "-et "
	local boolean WTO = SubString(s, 0, 4) == "-ep "
	local boolean WUO = SubString(s, 0, 7) == "-setms "
	local boolean WWO = SubString(s, 0, 6) == "-anim "
	local boolean WYO = SubString(s, 0, 4) == "-hp "
	local boolean WZO = s == "-hp"
	local boolean W_O = SubString(s, 0, 4) == "-mp "
	local boolean W0O = SubString(s, 0, 4) == "-ar "
	local boolean W1O = SubString(s, 0, 4) == "-ip "
	local boolean W2O = s == "-nerf"
	local boolean W3O = SubString(s, 0, 4) == "-or "
	local boolean W4O = SubString(s, 0, 7) == "-mytry "
	local boolean W5O = s == "-cc"
	local boolean W6O = s == "-b"
	local boolean W7O = s == "-control" or s == "-c"
	local boolean W8O = s == "-xy"
	local boolean gi = s == "-gi"
	local boolean W9O = SubString(s, 0, 5) == "-sxy "
	local boolean YVO = SubString(s, 0, 6) == "-tint "
	local boolean YEO = s == "-ms "
	local boolean YXO = s == "-path"
	local boolean YOO = s == "-k"
	local boolean YRO = s == "-br"
	local boolean YIO = s == "-path on"
	local boolean YAO = s == "-path off"
	local boolean YNO = s == "-path"
	local boolean YBO = SubString(s, 0, 7) == "-souls "
	local boolean YCO = SubString(s, 0, 7) == "-scale "
	local boolean YDO = s == "-fog"
	local boolean getId = s == "-all"
	local boolean testEfficiency = s == "-效率"
	local boolean gct = s == "-gct"
	if YDO then
		call Cheat("iseedeadpeople")
	endif
	
	call INX("DebugUnitCollisionType", gct)
	call INX("EXGetUnitAllAbilityId", getId)
	call INX("TestEfficiency", testEfficiency)

	call INX("WNO", YCO)
	call INX("WNO", YCO)
	call INX("WRO", YBO)
	call INX("WAO", YNO)
	call INX("WXO", YIO)
	call INX("WOO", YAO)
	call INX("UYO", W6O)
	call INX("WEO", YRO)
	call INX("WEO", YRO)
	call INX("WVO", YXO)
	call INX("YFO", YEO)
	call INX("U9O", W9O)
	call INX("U2O", WTO)
	call INX("U3O", WSO)
	call INX("SKO", W7O)
	call INX("TLO", W8O)
	call INX("T1O", gi)
	call INX("UYO", W6O)
	call INX("U0O", YVO)
	call INX("UWO", W5O)
	call INX("UTO", W3O)
	call INX("ULO", W4O)
	call INX("UQO", WKO)
	call INX("UJO", W2O)
	call INX("UGO", WFO)
	call INX("UFO", WGO)
	call INX("TAO", WYO)
	call INX("TBO", WZO)
	call INX("TDO", YOO)
	call INX("TJO", W0O)
	call INX("TGO", W_O)
	call INX("TRO", WWO)
	call INX("TOO", WHO)
	call INX("S9O", WUO)
	call INX("TEO", W1O)
	call INX("STO", WDO)
	call INX("SYO", WJO)
	call INX("S_O", WLO)
	call INX("S1O", WMO)
	call INX("S5O", WQO)
	call INX("S3O", WPO)
endfunction
function YGO takes unit u, integer s1, integer s2 returns nothing
	local item YHO = null
	local item YJO = null
	call DisableTrigger(CUV)
	if UnitItemInSlot(u, s2 -1)!= null and GUX(GetItemIndexEx(UnitItemInSlot(u, s2 -1))) == false and GetItemIndex(UnitItemInSlot(u, s2 -1)) == XCV then
		set YJO = UnitRemoveItemFromSlot(u, s2 -1)
	endif
	if UnitItemInSlot(u, s1 -1)!= null and GUX(GetItemIndexEx(UnitItemInSlot(u, s1 -1))) == false and GetItemIndex(UnitItemInSlot(u, s1 -1)) == XCV then
		set YHO = UnitRemoveItemFromSlot(u, s1 -1)
	endif
	call EnableTrigger(CUV)
	if YHO != null then
		call JXX(u, YHO, s2 -1)
	endif
	if YJO != null then
		call JXX(u, YJO, s1 -1)
	endif
	set YHO = null
	set YJO = null
endfunction
function YKO takes nothing returns nothing
	local string s = SubString(GetEventPlayerChatString(), 9, 14)
	local integer s1
	local integer s2
	local integer IMX = 0
	if SubString(s, 0, 1) == " " then
		set IMX = 1
	endif
	set s1 = S2I(SubString(s, IMX, IMX + 1))
	set s = SubString(s, IMX + 1, 5)
	set IMX = 0
	if SubString(s, 0, 1) == " " then
		set IMX = 1
	endif
	set s2 = S2I(SubString(s, IMX, IMX + 1))
	if s1 > 0 and s1 < 7 and s2 > 0 and s2 < 7 then
		call YGO(Player__Hero[GetPlayerId(GetTriggerPlayer())], s1, s2)
	else
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 5, "不正确的数值.请在1-6之间输入.")
	endif
endfunction
// 获得技能的阿哈利姆神杖升级索引 没有神杖升级就是返回 0 
function GetSkillAghanimUpgradeIndex takes integer id returns integer
	local integer i = 1
	loop
	exitwhen i > AghanimUpgradeMaxIndex
		if id == AghanimUpgradeUpgradeId[i]or id == AghanimUpgradeNormalId[i] then
			return i
		endif
		set i = i + 1
	endloop
	return 0
endfunction

// 有等级区分
function GetHeroSkillTip takes integer id, string s, integer level returns string
	return GetObjectName(id) + "[|cffffcc00" + s + "|r] - [|cffffcc00等级 " + I2S(level) + "|r]"
endfunction
function GetHeroSkillResearchTip takes integer id, string s returns string
    return "学习" + GetObjectName(id) + "[|cffffcc00" + s + "|r] - [|cffffcc00等级 %d|r]"
endfunction
// 没有等级
function GetUnitAbilityTip takes integer id, string s returns string
	return GetObjectName(id) + "[|cffffcc00" + s + "|r]"
endfunction

//快捷键整数转字符串
function Key2Str takes integer key returns string
    local string s = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    local integer i = key - 65
    if key > 64 and key < 91 then
        return SubString(s, i , i + 1)
 	endif
  	return null
endfunction

//快捷键字符串转整数
function Str2Key takes string key returns integer
    local string s = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    local integer i = 65
	local integer b = 0
	set key = StringCase(key , true)
	loop
	exitwhen i > 90
		if key == SubString(s, b , b + 1) then
			return i
		endif
		set i = i + 1
		set b = b + 1
	endloop
  	return 0
endfunction

function SetAbilityHotKey takes unit u, integer id, integer hotkey, player p returns nothing
	local integer a = 1
	local integer i
	call SetUnitAbilityLevel(u, id, 4)
	if (LocalPlayer == p) then
		if LoadBoolean(LocalHashTable, id, KEY_USE_DOUBLECLICK_SPELL) then
			set i = YDWEGetUnitAbilityDataInteger(u, id, 1, 200)
			set KeyCanDoubleClickSpell[i] = KeyCanDoubleClickSpell[i] - 1
			set KeyCanDoubleClickSpell[hotkey] = KeyCanDoubleClickSpell[hotkey] + 1
			call SaveInteger(LocalHashTable, id, HotKeyStringHash, hotkey)
		endif
		set i = GetUnitAbilityLevel(u, id)
		call DisplayTextToPlayer(LocalPlayer, 0, 0, "修改技能" + GetObjectName(id)+ "快捷键为" + "[|cffffcc00" + SubString(YDWEId2S(hotkey), 3, 4)+ "|r]")
		call YDWESetUnitAbilityDataInteger(u, id, 1, 200, hotkey)
		call YDWESetUnitAbilityDataInteger(u, id, 1, 201, hotkey)
		call YDWESetUnitAbilityDataInteger(u, id, 1, 202, hotkey)
		call YDWESetUnitAbilityDataString(u, id, 1, 214, "学习" + GetObjectName(id) + "[|cffffcc00" + SubString(YDWEId2S(hotkey), 3, 4) + "|r] - [|cffffcc00等级 %d|r]")
		loop
		exitwhen a > i
			call YDWESetUnitAbilityDataString(u, id, a, 215, GetHeroSkillTip(id, Key2Str(hotkey), a))
			set a = a + 1
		endloop
	endif
endfunction
function SetExtraAbilityHotKey takes unit u, integer id, integer hotkey, player p returns nothing
	if (LocalPlayer == p) then
		call DisplayTextToPlayer(LocalPlayer, 0, 0, "修改 额外技能 " + GetObjectName(id)+ "快捷键为" + "[|cffffcc00" + SubString(YDWEId2S(hotkey), 3, 4)+ "|r]")
		call YDWESetUnitAbilityDataInteger(u, id, 1, 200, hotkey)
		call YDWESetUnitAbilityDataString(u, id, 1, 215, GetUnitAbilityTip(id, YDWEId2S(hotkey) ) )
	endif
endfunction
function SetPasAbilityHotKey takes unit u, integer id, integer hotkey, player p returns nothing
	if (p == LocalPlayer) then
		call DisplayTextToPlayer(LocalPlayer, 0, 0, "修改被动技能" + GetObjectName(id)+ "学习快捷键为" + "[|cffffcc00" + SubString(YDWEId2S(hotkey), 3, 4)+ "|r]")
		call YDWESetUnitAbilityDataInteger(u, id, 1, 202, hotkey)
		call YDWESetUnitAbilityDataString(u, id, 1, 214, "学习" + GetObjectName(id) + "[|cffffcc00" + SubString(YDWEId2S(hotkey), 3, 4) + "|r] - [|cffffcc00等级 %d|r]")
	endif
endfunction
function lua_GetButtonAbility takes integer i returns integer
	if i == 1 then
		return GetLocalAbilityId( 0, 2 )
	elseif i == 2 then
		return GetLocalAbilityId( 1, 2 )
	elseif i == 3 then
		return GetLocalAbilityId( 2, 2 )
	elseif i == 4 then
		return GetLocalAbilityId( 3, 2 )
	elseif i == 5 then
		return GetLocalAbilityId( 0, 1 )
	elseif i == 6 then
		return GetLocalAbilityId( 1, 1 )
	elseif i == 7 then
		return GetLocalAbilityId( 2, 1 )
	elseif i == 8 then
		return GetLocalAbilityId( 3, 1 )
	elseif i == 9 then
		return GetLocalAbilityId( 0, 0 )
	endif
	return 0
endfunction

function Loacl_SetUnitAbilityHotkey takes unit u, integer id, integer hotkey returns nothing
	local integer i = 200
	local boolean b = false
	loop
	exitwhen i > 202
		if YDWEGetUnitAbilityDataInteger(u, id, 1, i) != 0 then
			if YDWESetUnitAbilityDataInteger(u, id, 1, i, hotkey) then
				set b = true
			endif
		endif
		set i = i + 1
	endloop
	if YDWEGetUnitAbilityDataString(u, id, 2, 215) == "" then
		call YDWESetUnitAbilityDataString(u, id, 1, 215, GetUnitAbilityTip(id, Key2Str(hotkey) ) )
	else
		set i = 1
		loop
		exitwhen YDWEGetUnitAbilityDataString(u, id, i, 215) == ""
			call YDWESetUnitAbilityDataString(u, id, i, 215, GetHeroSkillTip(id, Key2Str(hotkey),i ) )
			set i = i + 1
		endloop
		call YDWESetUnitAbilityDataString(u, id, 1, 214, "学习" + GetObjectName(id) + "[|cffffcc00" + SubString(YDWEId2S(hotkey), 3, 4) + "|r] - [|cffffcc00等级 %d|r]")
	endif	
	if b then
		call DisplayTextToPlayer(LocalPlayer, 0, 0, "修改技能" + GetObjectName(id)+ "快捷键为" + "[|cffffcc00" + SubString(YDWEId2S(hotkey), 3, 4)+ "|r]")
		if LoadBoolean(LocalHashTable, id, KEY_USE_DOUBLECLICK_SPELL) then
			set i = YDWEGetUnitAbilityDataInteger(u, id, 1, 200)
			set KeyCanDoubleClickSpell[i] = KeyCanDoubleClickSpell[i] - 1
			set KeyCanDoubleClickSpell[hotkey] = KeyCanDoubleClickSpell[hotkey] + 1
			call SaveInteger(LocalHashTable, id, HotKeyStringHash, hotkey)
		endif
	else
		call DisplayTextToPlayer(LocalPlayer, 0, 0, "该技能没有快捷键。")
	endif
endfunction

function HKY_C takes player p returns nothing 
	local unit u = null
	local integer i = S2I(SubString(GetEventPlayerChatString(), 6, 8))
	local integer hotkey 
	if i < 1 or i > 9 then
		call DisplayTimedTextToPlayer(p, .5,-1., 10., "|cffffcc00错误的参数，技能按钮取值必须为1至11。|r")
		return
	endif
	if i > 9 then
		set hotkey = YDWES2Id(StringCase(SubString(GetEventPlayerChatString(), 9, 10), true))
	else
		set hotkey = YDWES2Id(StringCase(SubString(GetEventPlayerChatString(), 8, 9), true))
	endif
	if hotkey < 65 or hotkey > 90 then
		call DisplayTimedTextToPlayer(p, .5,-1., 10., "|cffffcc00错误的参数，快捷键的取值必须为26英文字母。|r")
		return
	endif
	set u = GetPlayerSelectedUnit()
	set i = lua_GetButtonAbility(i)
	if i == 0 or i == 'AHer' or i == 'Asel' or i == 'Asud' then
		call DisplayTimedTextToPlayer(p, .5,-1., 10., "|cffffcc00没有该技能，技能按钮的位置为\n9\n5 6 7 8\n1 2 3 4\n|r")
	else
		call Loacl_SetUnitAbilityHotkey(u, i, hotkey)
	endif
	set u = null
endfunction

function HKY takes nothing returns nothing
	if LocalPlayer == GetTriggerPlayer() then
		call HKY_C(LocalPlayer)
	endif
endfunction
function FireRemnat_Hk takes unit u, integer id, integer hotkey, player p returns boolean
	local integer e
	if id == 'A2JR' then
		set e = 0
		loop
			if e == 0 then
				set id = 'A2JK'
			elseif e == 1 then
				set id = 'A2JQ'
			elseif e == 2 then
				set id = 'A2JP'
			elseif e == 3 then
				set id = 'A2JR'
			elseif e == 4 then
				set id = 'A2JO'
			endif
		exitwhen e > 4
			call UnitAddAbility(u, id)
			call SetAbilityHotKey(u, id, hotkey, p)
			call UnitRemoveAbility(u, id)
			set e = e + 1
		endloop
		return true
	endif
	return false
endfunction
function Ike_Sht takes player p, integer i, integer hotkey returns nothing
	local integer id = 0
	local integer a = 1
	local integer e = 1
	local integer pid = GetPlayerId(p)
	local integer AghanimID
	local boolean b1 = false
	local boolean b2 = false
	local integer IkeyID
	local integer f
	local unit u = CirclesUnit[GetPlayerId(p)]
	if IsPassiveSkill[PlayerSkillIndex[pid * HL + i]] then
		set id = HeroCommonSkills[PlayerSkillIndex[pid * HL + i]]
		if id != 0 then
			call UnitAddAbility(u, id)
			call SetPasAbilityHotKey(u, id, hotkey, p)
			call UnitRemoveAbility(u, id)
			if id == 'A088' then
				set id = 'A2KQ'
				call UnitAddAbility(u, id)
				call SetExtraAbilityHotKey(u, id, hotkey, p)
				call UnitRemoveAbility(u, id)
			endif
		endif
	else
		set id = HeroCommonSkills[PlayerSkillIndex[pid * HL + i]]
		if FireRemnat_Hk(u, id, hotkey, p) then
			set u = null
			return
		endif
		if id == 'A08Q' then
			set id = 'A08c'
			call UnitAddAbility(u, id)
			call SetAbilityHotKey(u, id, hotkey, p)
			call UnitRemoveAbility(u, id)
			set id = 'A08E'
			call UnitAddAbility(u, id)
			call SetAbilityHotKey(u, id, hotkey, p)
			call UnitRemoveAbility(u, id)
			set id = 'A08Q'
		endif
		set IkeyID = LoadInteger(ExtraHT, HTKEY_SWITCHING_SKILLS, id)
		set AghanimID = HeroUpgradeSkills[PlayerSkillIndex[pid * HL + i]]
		if AghanimID != 0 then
			set b1 = true
		endif
		if IkeyID != 0 then
			set b2 = true
		endif
		if b1 or b2 then
			set f = 2
			if b1 and b2 then
				if LoadBoolean(ExtraHT, HTKEY_SWITCHING_SKILLS, id) then
					set f = 4
				endif
			endif
			if id == 'A2E5' then
				set f = 3
			endif
			loop
			exitwhen e > f
				if e == 1 then
					set id = HeroCommonSkills[PlayerSkillIndex[pid * HL + i]]
				elseif b2 then
					set id = IkeyID
				elseif b1 then
					set id = AghanimID 
				endif
				if e == 3 then
					set id = AghanimID 
				elseif e == 4 then
					set id = LoadInteger(ExtraHT, HTKEY_SWITCHING_SKILLS, AghanimID)	
				endif
				if id != 0 then
					call UnitAddAbility(u, id)
					call SetAbilityHotKey(u, id, hotkey, p)
					call UnitRemoveAbility(u, id)
				endif
				set e = e + 1
			endloop
		else
			if id != 0 then
				call UnitAddAbility(u, id)
				call SetAbilityHotKey(u, id, hotkey, p)
				call UnitRemoveAbility(u, id)
			endif
		endif
	endif
	set u = null
endfunction

function IKY takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer hotkey = YDWES2Id(StringCase(SubString(GetEventPlayerChatString(), 8, 9), true))
	local integer i = S2I(SubString(GetEventPlayerChatString(), 6, 7))
	if hotkey < 64 or hotkey > 91 then
		call InterfaceErrorForPlayer(p, "错误的参数，快捷键的取值必须为26英文字母。")
		return
	endif
	if i < 0 or i > (4 + ExtraSkillsNumber) then
		call InterfaceErrorForPlayer(p, "错误的参数，技能编号的取值必须以-si面板中为准。")
		return
	endif
	call Ike_Sht(p, i, hotkey)
endfunction

function YLO takes string s returns nothing
	local string s5 = SubString(s, 0, 5)
	local boolean YMO = SubString(s, 0, 5) == "-swap"
	local boolean YPO = SubString(s, 0, 5) == "-roll"
	local boolean YQO = SubString(s, 0, 8) == "-kickafk"
	local boolean YSO = SubString(s, 0, 6) == "-music"
	local boolean YTO = SubString(s, 0, 6) == "-water"
	local boolean YUO = SubString(s, 0, 9) == "-rickroll"
	local boolean YWO = SubString(s, 0, 7) == "-switch"
	local boolean YYO = SubString(s, 0, 18) == "-removeiteminslot "
	local boolean YZO = SubString(s, 0, 2) == "-r" and(SubString(s, 2, 3) == " " or S2I(SubString(s, 2, 3))> 0)
	local boolean Y_O = SubString(s, 0, 4) == "-cam"
	local boolean Y0O = SubString(s, 0, 9) == "-itemswap"
	if s5 == "-ikey" then
		call ExecuteFunc("IKY")
	elseif s5 == "-hkey" then
		call ExecuteFunc("HKY")
	endif
	call INX("TMO", Y_O)
	call INX("Y1O", YMO)
	call INX("Y2O", YPO)
	call INX("Y3O", YQO)
	call INX("Y4O", YZO)
	call INX("S7O", YYO)
	call INX("Y5O", YSO)
	call INX("Y6O", YTO)
	call INX("Y7O", YUO)
	call INX("Y8O", YWO)
	call INX("YKO", Y0O)
	if (bj_isSinglePlayer) then
		call WCO(s)
	endif
endfunction
function Y9O takes nothing returns nothing
	local string s = StringCase(GetEventPlayerChatString(), false)
	local integer h = StringHash(s)
	if HaveSavedString(ChatCommandHashTable, h, 0) then
		call ExecuteFunc(LoadStr(ChatCommandHashTable, h, 0))
		if (s != "-c") then
			return
		endif
	endif
	if (SubString(s, 0, 1) == "-") then
		call YLO(s)
	endif
endfunction
function Y7O takes nothing returns nothing
	local integer a = S2I(SubString(GetEventPlayerChatString(), 10, StringLength(GetEventPlayerChatString())))
	local integer pid = GetPlayerId(GetTriggerPlayer())
	set FZV[pid]= FZV[pid] + 1
	if FZV[pid]> 10 then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, DisplayTextDuration[LocalPlayerId], GetObjectName('n0DQ'))
		return
	endif
	if a < 1 or a > 8 then
		set a = GetRandomInt(1, 8)
	endif
	if a == 1 then
		call DisplayTimedTextToAllPlayer(AllPlayerForce, 5, PlayersColoerText[GetPlayerId(GetTriggerPlayer())] +(PlayersName[GetPlayerId((GetTriggerPlayer()))])+ "|r's never gonna give you up")
	elseif a == 2 then
		call DisplayTimedTextToAllPlayer(AllPlayerForce, 5, PlayersColoerText[GetPlayerId(GetTriggerPlayer())] +(PlayersName[GetPlayerId((GetTriggerPlayer()))])+ "|r's never gonna let you down")
	elseif a == 3 then
		call DisplayTimedTextToAllPlayer(AllPlayerForce, 5, PlayersColoerText[GetPlayerId(GetTriggerPlayer())] +(PlayersName[GetPlayerId((GetTriggerPlayer()))])+ "|r's never gonna run around")
	elseif a == 4 then
		call DisplayTimedTextToAllPlayer(AllPlayerForce, 5, PlayersColoerText[GetPlayerId(GetTriggerPlayer())] +(PlayersName[GetPlayerId((GetTriggerPlayer()))])+ "|r's never gonna desert you")
	elseif a == 5 then
		call DisplayTimedTextToAllPlayer(AllPlayerForce, 5, PlayersColoerText[GetPlayerId(GetTriggerPlayer())] +(PlayersName[GetPlayerId((GetTriggerPlayer()))])+ "|r's never gonna make you cry")
	elseif a == 6 then
		call DisplayTimedTextToAllPlayer(AllPlayerForce, 5, PlayersColoerText[GetPlayerId(GetTriggerPlayer())] +(PlayersName[GetPlayerId((GetTriggerPlayer()))])+ "|r's never gonna say goodbye")
	elseif a == 7 then
		call DisplayTimedTextToAllPlayer(AllPlayerForce, 5, PlayersColoerText[GetPlayerId(GetTriggerPlayer())] +(PlayersName[GetPlayerId((GetTriggerPlayer()))])+ "|r's never gonna tell a lie")
	elseif a == 8 then
		call DisplayTimedTextToAllPlayer(AllPlayerForce, 5, PlayersColoerText[GetPlayerId(GetTriggerPlayer())] +(PlayersName[GetPlayerId((GetTriggerPlayer()))])+ "|r's never gonna hurt you")
	endif
endfunction
function ZVO takes nothing returns boolean
	return RY and FT[GetPlayerId(ZW)]== false and GS and Player__Hero[GetPlayerId(ZW)]== null and KS[GetPlayerId(ZW)]== false and AY[GetPlayerId(ZW)]== false
endfunction
function ZEO takes player p, integer ZXO returns nothing
	local integer k = 0
	local location l
	local integer TTV = 0
	local integer i = 0
	local boolean ZOO = ZXO == 1
	local boolean ZRO = ZXO == 2
	local boolean ZIO = ZXO == 0
	set FT[GetPlayerId(p)]= true
	if IsSentinelPlayer(p) then
		set l = GetRectCenter(gg_rct_SentinelRevivalPoint)
	else
		set l = GetRectCenter(gg_rct_ScourgeRevivalPoint)
	endif
	loop
		if ZIO then
			set TTV = GetRandomInt(1, HeroTypeMaxCount)
		elseif ZOO then
			set TTV = TVE(MeleeHeroList[GetRandomInt(1, MeleeHeroMax)])
		elseif ZRO then
			set TTV = TVE(RangeHeroList[GetRandomInt(1, RangeHeroMax)])
		endif
	exitwhen GetPlayerTechMaxAllowed(p, HeroListTypeId[TTV])> 0 and ZQ[TTV]== false
		set i = i + 1
	endloop
	if PW == false then
		call XTX(HeroListTypeId[TTV])
		set YQ[TTV]= true
		set ZQ[TTV]= true
	endif
	call CreateUnitAtLoc(p, HeroListTypeId[TTV], l, 0)
	call RemoveLocation(l)
	set l = null
endfunction
function ZAO takes player p, integer ZXO returns integer
	local boolean ZOO = ZXO == 1
	local boolean ZRO = ZXO == 2
	local boolean ZIO = ZXO == 0
	local integer i = 0
	local integer WOV = GL
	local integer k = 0
	loop
	exitwhen i > WOV
		if GetPlayerTechMaxAllowed(p, HeroListTypeId[i])> 0 then
			if ZOO and IsUnitIdType(HeroListTypeId[i], UNIT_TYPE_MELEE_ATTACKER) then
				set k = k + 1
			elseif ZRO and IsUnitIdType(HeroListTypeId[i], UNIT_TYPE_MELEE_ATTACKER) == false then
				set k = k + 1
			elseif ZIO then
				set k = k + 1
			endif
		endif
		set i = i + 1
	endloop
	return k
endfunction
function ZNO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player p =(LoadPlayerHandle(HY, h, 54))
	local string ZBO =(LoadStr(HY, h, 146))
	set ZW = p
	if ZVO() then
		set FT[GetPlayerId(p)]= true
		if ZBO == "-random int"then
			call OFX(p, 1)
			call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD) -150)
		elseif ZBO == "-random str"then
			call OFX(p, 3)
			call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD) -150)
		elseif ZBO == "-random agi"then
			call OFX(p, 2)
			call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD) -150)
		elseif ZBO == "-random melee"then
			call OHX(p, 1)
			call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD) -150)
		elseif ZBO == "-random range"then
			call OHX(p, 2)
			call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD) -150)
		else
			call OKX(p)
			call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)-50)
		endif
	else
		call DisplayTimedTextToPlayer(p, 0, 0, DisplayTextDuration[LocalPlayerId], GetObjectName('n079'))
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set p = null
	return false
endfunction
function UAO takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local trigger t = null
	local string s = StringCase(GetEventPlayerChatString(), false)
	set ZW = p
	if ZVO() and G3[GetPlayerId(p)]== false then
		if PP[GetPlayerId(p)]== 2 and s == "-random melee" then
			call DisplayTimedTextToPlayer(p, 0, 0, 10, "你选择了至少一个|c00ff0000远程限定|r技能。你不能使用近战英雄模型.")
		elseif PP[GetPlayerId(p)]== 1 and s == "-random range" then
			call DisplayTimedTextToPlayer(p, 0, 0, 10, "你选择了至少一个|c00ff0000近战限定|r技能。你不能使用远程英雄模型.")
		elseif MainModeName =="sd" then
			if s == "-random melee"then
				if ZAO(p, 1)> 0 then
					set G3[GetPlayerId(p)]= true
					call ZEO(p, 1)
					call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)- 100 )
					return
				else
					call DisplayTimedTextToPlayer(p, 0, 0, 10, "你没有近战英雄可以选择了.")
				endif
			elseif s == "-random range"then
				if ZAO(p, 2)> 0 then
					set G3[GetPlayerId(p)]= true
					call ZEO(p, 2)
					call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)- 100 )
					return
				else
					call DisplayTimedTextToPlayer(p, 0, 0, 10, "你没有远程英雄可以选择了.")
				endif
			elseif s == "-random"then
				set G3[GetPlayerId(p)]= true
				call ZEO(p, 0)
				return
			endif
		else
			set G3[GetPlayerId(p)]= true
			call XUX(p)
			if s == "-random melee" then
				call DisplayTimedTextToPlayer(p, 0, 0, 10, "你随机选择了一个近战英雄.")
			elseif s == "-random range" then
				call DisplayTimedTextToPlayer(p, 0, 0, 10, "你随机选择了一个远程英雄.")
			else
				call DisplayTimedTextToPlayer(p, 0, 0, 10, GetObjectName('n07A'))
			endif
			set t = CreateTrigger()
			call TriggerRegisterTimerEvent(t, .1, false)
			call TriggerAddCondition(t, Condition(function ZNO))
			call SavePlayerHandle(HY, GetHandleId(t), 54, p)
			call SaveStr(HY, GetHandleId(t), 146, StringCase(GetEventPlayerChatString(), false))
		endif
	endif
	set t = null
	set p = null
endfunction
function ZCO takes nothing returns boolean
	local unit trigUnit
	if GUV then
		call InterfaceErrorForPlayer(GetTriggerPlayer(), GetObjectName('n030'))
		return false
	endif
	if IY == false then
		if GKV == false and GJV == false and V4 == false then
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "-repick " + GetObjectName('n05B'))
		endif
		return false
	endif
	if (KS[GetPlayerId(GetTriggerPlayer())]) or(Player__Hero[GetPlayerId(GetTriggerPlayer())]== null) then
		return false
	endif
	if Mode__DeathMatch then
		return false
	endif
	if (Z3) then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n050'))
		return false
	endif
	if (GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD)< GT) or(GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD)< 400 and(RT or GKV) and FT[GetPlayerId(GetTriggerPlayer())]) then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n059'))
		return false
	endif
	if GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD)< 250 and RT then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n05U'))
		return false
	endif
	set trigUnit = Player__Hero[GetPlayerId(GetTriggerPlayer())]
	if GetUnitState(trigUnit, UNIT_STATE_MANA)!= GetUnitState(trigUnit, UNIT_STATE_MAX_MANA) or GetWidgetLife(trigUnit)!= GetUnitState(trigUnit, UNIT_STATE_MAX_LIFE) then
		set trigUnit = null
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n05J'))
		return false
	endif
	set trigUnit = null
	return true
endfunction
function ZDO takes nothing returns nothing
	local unit u = GetEnumUnit()
	local integer i = GetUnitTypeId(u)
	if (IsUnitType(u, UNIT_TYPE_HERO)) then
		if (GetUnitAbilityLevel(u,'Z234')> 0) then
			call ExecuteFunc("T8X")
		elseif GetUnitAbilityLevel(u,'Q231')> 0 then
			set VK = u
			call ExecuteFunc("W4X")
		elseif GetUnitAbilityLevel(u,'A0CY')> 0 then
			set VK = u
			call ExecuteFunc("W5X")
		endif
		call DisplayTimedTextToAllPlayer(VNX(GetTriggerPlayer()), 10., GetObjectName('n05L')+ " " + EJX(u)+ ".")
	endif
	if IsBearUnit(u) or GetUnitTypeId(u)=='o01X' then
		call RemoveUnit(u)
	endif
	set u = null
endfunction
function ZFO takes player p, integer i returns nothing
	local integer k = 1
	local integer h = GetHandleId(p)
	local integer WWV = GetPlayerId(p)
	if GKV or HOV then
		set k = 1
		loop
			if LoadBoolean(HY, h, HeroListTypeId[k]) and DP[WWV * GL + k]and ZQ[k]== false and YQ[k]== false then
				call SetPlayerTechMaxAllowed(p, HeroListTypeId[k], 999)
			else
				call SetPlayerTechMaxAllowed(p, HeroListTypeId[k], 0)
			endif
			set k = k + 1
		exitwhen k > GL
		endloop
	endif
	if i == 0 then
		return
	endif
	set k = 1
	if i == 1 then
		loop
			call SetPlayerTechMaxAllowed(p, RangeHeroList[k], 0)
			set k = k + 1
		exitwhen k > RangeHeroMax
		endloop
	elseif i == 2 then
		loop
			call SetPlayerTechMaxAllowed(p, MeleeHeroList[k], 0)
			set k = k + 1
		exitwhen k > MeleeHeroMax
		endloop
	endif
endfunction
function ZGO takes nothing returns nothing
	if GetUnitTypeId(GetFilterUnit())=='ntav' then
		call UnitAddAbility(GetFilterUnit(),'A1HX')
		call ShowUnit(GetFilterUnit(), true)
	elseif GetUnitTypeId(GetFilterUnit())=='n12C' then
		if LocalPlayer== GetOwningPlayer(GetFilterUnit()) then
			call SetUnitVertexColor(GetFilterUnit(), 255, 255, 255, 255)
		endif
	endif
endfunction
function ZHO takes player p returns nothing
	local group g = AllocationGroup(103)
	call GroupEnumUnitsOfPlayer(g, p, Condition(function ZGO))
	call DeallocateGroup(g)
	set g = null
endfunction
function ZJO takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local group g = AllocationGroup(104)
	local integer ZKO
	local integer ZLO
	local location ZMO
	local integer X1X
	local integer loop_i
	local integer loop_max
	local unit ZPO
	local integer WWV = GetPlayerId(p)
	local location LIX = GetRectCenter(gg_rct_SentinelTavernCamera)
	local location LAX = GetRectCenter(gg_rct_ScourgeTavernCamera)
	local integer i = 0
	set Q2 = WWV
	set bj_groupEnumOwningPlayer = p
	call GroupEnumUnitsInRect(g, GetWorldBounds(), filterGetUnitsInRectOfPlayer)
	if (IsSentinelPlayer(p)) then
		set ZKO = 1
		set ZLO = VWV
		set ZMO = GetRectCenter(gg_rct_SentinelBuyArea)
	else
		set ZKO = VYV
		set ZLO = HeroTypeMaxCount
		set ZMO = GetRectCenter(gg_rct_ScourgeBuyArea)
	endif
	if VT then
		if (GetRandomInt(1, 2) == 1) then
			set ZKO = 1
			set ZLO = VWV
		else
			set ZKO = VYV
			set ZLO = HeroTypeMaxCount
		endif
	endif
	if RT or GKV then
		set GT = 0
	endif
	set ZPO =(LoadUnitHandle(HY,(GetHandleId(GetTriggerPlayer())), 147))
	if ZPO != null and GetUnitTypeId(ZPO)=='e00C' then
		call RemoveUnit(ZPO)
	endif
	call AdjustPlayerStateBJ(-1 * GT, p, PLAYER_STATE_RESOURCE_GOLD)
	if (RT or GKV) and FT[GetPlayerId(GetTriggerPlayer())] then
		call AdjustPlayerStateBJ( -150, p, PLAYER_STATE_RESOURCE_GOLD)
	endif
	set KS[WWV]= true
	set IN[WWV]= false
	call ForGroup(g, function ZDO)
	set i = GetUnitPointValueByType(GetUnitTypeId(Player__Hero[WWV]))
	set YQ[i]= false
	set ZQ[i]= false
	set DP[WWV * GL + i]= false
	call EXRemoveHero(Player__Hero[WWV])
	set PlayerHeroTypeId[WWV]= 0
	set Player__Hero[GetPlayerId(GetTriggerPlayer())]= null
	if RT or GKV or HOV then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 60, GetObjectName('n05Y'))
		if RT or GKV or HOV then
			set loop_i = 1
			set loop_max = HeroTypeMaxCount
		endif
		call YCE(p)
		if IsSentinelPlayer(p) then
			call PanCameraToTimedLocForPlayer(p, LIX, 0)
		else
			call PanCameraToTimedLocForPlayer(p, LAX, 0)
		endif
		if GKV or HOV then
			call ZHO(p)
		endif
		loop
		exitwhen loop_i > loop_max
			if RT then
				if ZQ[loop_i]== false then
					call SetPlayerTechMaxAllowed(p, HeroListTypeId[loop_i], 999)
				else
					call SetPlayerTechMaxAllowed(p, HeroListTypeId[loop_i], 0)
				endif
			elseif GKV or HOV then
				if DP[WWV * GL + loop_i]and ZQ[loop_i]== false and YQ[loop_i]== false then
					call SetPlayerTechMaxAllowed(p, HeroListTypeId[loop_i], 999)
				else
					call SetPlayerTechMaxAllowed(p, HeroListTypeId[loop_i], 0)
				endif
			endif
			set loop_i = loop_i + 1
		endloop
		call ZFO(Player(WWV), PP[WWV])
		call RemoveLocation(LIX)
		call RemoveLocation(LAX)
		return
	endif
	loop
		set X1X = GetRandomInt(ZKO, ZLO)
		if (ZQ[X1X]== false) then
			set YQ[X1X]= true
			set ZQ[X1X]= true
			set Player__Hero[WWV]= CreateUnitAtLoc(p, HeroListTypeId[X1X], ZMO, bj_UNIT_FACING)
			set PlayerHeroTypeId[WWV]= HeroListTypeId[X1X]
			call XSX(HeroListTypeId[X1X])
		endif
	exitwhen Player__Hero[WWV]!= null
	endloop
	call DeallocateGroup(g)
	call RemoveLocation(ZMO)
	call RemoveLocation(LIX)
	call RemoveLocation(LAX)
	set ZPO = null
	set ZMO = null
	set LIX = null
	set LAX = null
endfunction
function UBO takes nothing returns nothing
	if ZCO() then
		call ZJO()
	endif
endfunction
function ZQO takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local string ZSO = "|c006699CC"
	if Mode__DeathMatch then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Death Match" + "|r:		" + GetObjectName('n06Z'))
		call DisplayTimedTextToPlayer(p, 0, 0, 20, "							  " + GetObjectName('n06Y')+ " " + I2S(IMinBJ(VWV, HeroTypeMaxCount -VYV + 1))+ " " + GetObjectName('n07C'))
	endif
	if ET then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Random Draft|r:				 你将在24个随机分配了技能的英雄中选取一个英雄")
	endif
	if HOV then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Mirror Draft|r:				 对楼双方获得同样的英雄 (玩家 1 对 6, 2 对 7……)")
	endif
	if RT then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "All Pick" + "|r:				 " + GetObjectName('n06V'))
	endif
	if YS then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Switch On" + "|r:				 " + "允许玩家通过 -switch 指令变更队伍。使用 - unlock 指令解锁遗留的装备.")
	endif
	if GJV then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Random Draft" + "|r:				 " + GetObjectName('n072'))
	endif
	if GKV then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Single Draft" + "|r:				 每位玩家随机分配相应数量的英雄")
	endif
	if Mode__RearmCombos then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Rearm combos" + "|r:				 解除部分技能的冲突限制")
	endif
	if VT then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "All Random" + "|r:		  " + GetObjectName('n071'))
	endif
	if DW then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Shuffle Players" + "|r:	 " + GetObjectName('n07H'))
	endif
	if QW then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "All Agility" + "|r:			 " + GetObjectName('n07L'))
	endif
	if TW then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "All Strength" + "|r:		 " + GetObjectName('n07K'))
	endif
	if SW then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "All Intelligence" + "|r:	" + GetObjectName('n07J'))
	endif
	if GMV then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Range Only" + "|r:	" + GetObjectName('n0G4'))
	endif
	if GLV then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Melee Only" + "|r:	" + GetObjectName('n0G5'))
	endif
	if PW then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Duplicate Mode" + "|r:   " + GetObjectName('n07I'))
	endif
	if IT then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Item Drop" + "|r:			 " + GetObjectName('n07F'))
	endif
	if JT then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "No Powerups" + "|r:		" + GetObjectName('n07M'))
	endif
	if KT then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Super Creeps" + "|r:		" + GetObjectName('n07N'))
		call DisplayTimedTextToPlayer(p, 0, 0, 20, "							 " + GetObjectName('n07O'))
	endif
	if Mode__EasyMode then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Easy Mode" + "|r:		   " + GetObjectName('n07T'))
	endif
	if Mode__SameHero then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Same Hero" + "|r:		   " + GetObjectName('n07U')+ " " +(PlayersName[GetPlayerId((HostPlayer))])+ "|r" + " " + GetObjectName('n07W'))
	endif
	if Mode__OnlyMid then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Only Mid" + "|r:		   " + GetObjectName('n080'))
	endif
	if Mode__NotBot then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "No Bot" + "|r:		   " + GetObjectName('n07V'))
	endif
	if Mode__NoMid then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "No Mid" + "|r:		   " + GetObjectName('n07S'))
	endif
	if Mode__NotTop then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "No Top" + "|r:		   " + GetObjectName('n07R'))
	endif
	if J3 then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "No Swap" + "|r:		   " + GetObjectName('n07X'))
	endif
	if F3 then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "No Repick" + "|r:		   " + GetObjectName('n07Q'))
	endif
	if L3 then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Pool Mode" + "|r:		   " + GetObjectName('n07Y'))
	endif
	if GWV then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Observer Info" + "|r:		   " + GetObjectName('n07Z'))
	endif
	if GYV then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Fast Respawn" + "|r:		   " + GetObjectName('n0DP'))
	endif
	if GZV then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Zoom mode" + "|r:		   " + GetObjectName('n0KI'))
	endif
	if G0V then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Unlimited Level" + "|r:		   英雄的等级上限提升至 ∞")
	endif
	if G1V then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "See skills" + "|r:		   你能看见敌方选择的技能")
	endif
	if Mode__AntiBackdoor then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Antibackdoor" + "|r:		   当攻击塔时若被系统判定为偷塔则塔受到的伤害变为极小")
	endif
	if Mode__FiveSkills then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Five skills" + "|r:		   你可以选择第五个技能")
	endif
	if Mode__SixSkills then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Six skills" + "|r:		   你可以选择六个技能：四个普通技能、两个终极奥义")
	endif
	if Mode__FastNeutrals then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Fast neutrals" + "|r:		   游戏一开始即刷新野怪")
	endif
	if Mode__Draft20 then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Draft 20" + "|r:		   在所有酒馆中征召20名英雄用于技能及模型选择")
	endif
	if Mode__Draft30 then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Draft 30" + "|r:		   在所有酒馆中征召30名英雄用于技能及模型选择")
	endif
	if Mode__Draft40 then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Draft 40" + "|r:		   在所有酒馆中征召40名英雄用于技能及模型选择")
	endif
	if Mode__Draft50 then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Draft 50" + "|r:				在所有酒馆中征召50名英雄用于技能及模型选择")
	endif
	if HVV then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "One skill" + "|r:		   一个技能在同一队伍中只能选择一次")
	endif
	if Mode__BalanceOff then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Balance off" + "|r:		   关闭内置平衡模式")
	endif
	if Mode__RandomExtraAbilities then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Random extra abilities" + "|r:		   你的第五个和第六个技能是随机得到的")
	endif
	if HIV then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Limit skills 3" + "|r:		   你最多能选择同一个英雄的3个技能")
	endif
	if HAV then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Limit skills" + "|r:		   你最多能选择同一个英雄的2个技能")
	endif
	if Mode__FastFinish then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Fast Finish" + "|r:		   你可以使用 -ff 命令来投票游戏快速结束（其实是投降）也可以使用 -wff 命令来查看已投票情况")
	endif
	if Mode__AntiHack then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "Anti Hack|r:				 反开图作弊")
	endif
	if Mode__NoNeutrals then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, ZSO + "No Neutrals|r:				 不会刷新野怪")
	endif
endfunction
function ZTO takes nothing returns nothing
	if GetUnitTypeId(GetEnumUnit())=='n004' then
		call RemoveUnit(GetEnumUnit())
	endif
	if GetUnitTypeId(GetEnumUnit())=='o003' then
		call RemoveUnit(GetEnumUnit())
	endif
endfunction

function ZTJ takes nothing returns nothing
	local integer h = GetHandleId(GetExpiredTimer())
	set E3 = LoadPlayerHandle(HY, h, 0)
	call ExecuteFunc("Reset_Ability")
	set E3 = LoadPlayerHandle(HY, h, 1)
	call ExecuteFunc("Reset_Ability")
	call DestroyTimerAndFlushHT_HY(GetExpiredTimer())
endfunction

function ZTQ takes player p1, player p2 returns nothing
	local integer h = TimerStartSingle(0.5, function ZTJ)
	call SavePlayerHandle(HY, h, 0, p1)
	call SavePlayerHandle(HY, h, 1, p2)
endfunction

function PlayerSwap takes player p1, player p2 returns nothing
	local integer h1 = GetHandleId(p1)
	local integer h2 = GetHandleId(p2)
	local integer id1 = GetPlayerId(p1)
	local integer id2 = GetPlayerId(p2)
	local integer pidd = id1 -id2
	local unit u1
	local unit u2
	local unit u3
	local integer i = 0
	local integer h
	local integer k
	local integer j
	set E3 = p1
	call ExecuteFunc("Reset_Ability")
	set E3 = p2
	call ExecuteFunc("Reset_Ability")
	call ZTQ(p1, p2)
	loop
	exitwhen not HaveSavedHandle(OtherHashTable, h1, 32 + i)
		set u1 = LoadUnitHandle(OtherHashTable, h1, 32 + i)
		set u2 = LoadUnitHandle(OtherHashTable, h2, 32 + i)
		call SetUnitOwner(u1, p2, true)
		call SetUnitOwner(u2, p1, true)
		if LocalPlayer== p2 then
			call SetUnitScale(u1, 0.5, 0.5, 0.5)
			call SetUnitScale(u2, 0.3, 0.3, 0.3)
		elseif LocalPlayer== p1 then
			call SetUnitScale(u2, 0.5, 0.5, 0.5)
			call SetUnitScale(u1, 0.3, 0.3, 0.3)
		endif
		set u1 = LoadUnitHandle(OtherHashTable, h1, 32 + i)
		call SaveUnitHandle(OtherHashTable, h1, 32 + i, LoadUnitHandle(OtherHashTable, h2, 32 + i))
		call SaveUnitHandle(OtherHashTable, h2, 32 + i, u1)
		set u2 = u1
		set u1 = LoadUnitHandle(OtherHashTable, h1, 32 + i)
		set h = GetHandleId(u2)
		set u3 = LoadUnitHandle(HY, h, 32 + i)
		call SetUnitPosition(u3, GetUnitX(u1), GetUnitY(u1))
		set h = GetHandleId(u1)
		set u3 = LoadUnitHandle(HY, h, 32 + i)
		call SetUnitPosition(u3, GetUnitX(u2), GetUnitY(u2))
		call SaveUnitHandle(HY, GetHandleId(u1), 32 + i, LoadUnitHandle(HY, GetHandleId(u2), 32 + i))
		call SaveUnitHandle(HY, GetHandleId(u2), 32 + i, u3)
		set i = i + 1
	endloop
	call SelectUnitForPlayerSingle(LoadUnitHandle(OtherHashTable, h1, 32), p1)
	call SelectUnitForPlayerSingle(LoadUnitHandle(OtherHashTable, h2, 32), p2)
	set i = LoadInteger(OtherHashTable, h1, 32)
	loop
		set k = LoadInteger(HY, h1,'hrpl'+ i)
		set j = LoadInteger(HY, h2,'hrpl'+ i)
		call RemoveSavedBoolean(HY, h1, k)
		call RemoveSavedBoolean(HY, h2, j)
		set DP[LoadInteger(HY, h1,'bapl'+ i)+ GetPlayerId(p1)* GL]= false
		set DP[LoadInteger(HY, h2,'bapl'+ i)+ GetPlayerId(p2)* GL]= false
		set i = i -1
	exitwhen i < 0
	endloop
	set i = LoadInteger(OtherHashTable, h1, 32)
	loop
		set k = LoadInteger(HY, h1,'hrpl'+ i)
		set j = LoadInteger(HY, h2,'hrpl'+ i)
		call SaveBoolean(HY, h2, k, true)
		call SaveBoolean(HY, h1, j, true)
		set id1 = LoadInteger(HY, h1,'bapl'+ i)
		set id2 = LoadInteger(HY, h2,'bapl'+ i)
		set DP[id1 + GetPlayerId(p2)* GL]= true
		set DP[id2 + GetPlayerId(p1)* GL]= true
		call SaveInteger(HY, h1,'hrpl'+ i, j)
		call SaveInteger(HY, h2,'hrpl'+ i, k)
		call SaveInteger(HY, h1,'bapl'+ i, id2)
		call SaveInteger(HY, h2,'bapl'+ i, id1)
		set i = i -1
	exitwhen i < 0
	endloop
	set u3 = null
	set u2 = null
	set u1 = null
endfunction
function ZUO takes unit u1, unit u2, player p1, player p2 returns nothing
	local unit d= null
	local group g = null
	local item NKO = null
	local integer ZZO
	local integer i = 1
	local integer array Z_O
	if u1 == null and u2 == null then
		set d = null
		call PlayerSwap(p1, p2)
		call FlushChildHashtable(HY, 800 + GetPlayerId(p2))
		call FlushChildHashtable(HY, 800 + GetPlayerId(p1))
		return
	endif
	set d = CreateUnit(p1,'e01F', 0, 0, 0)
	if FT[GetPlayerId(p1)] then
		if GetPlayerState(p1, PLAYER_STATE_RESOURCE_GOLD)< 100 then
			return
		endif
	endif
	if FT[GetPlayerId(p2)] then
		if GetPlayerState(p2, PLAYER_STATE_RESOURCE_GOLD)< 100 then
			return
		endif
	endif
	if FT[GetPlayerId(p1)]and KS[GetPlayerId(p1)]== false and TF[GetPlayerId(p1)]== 0 then
		set TF[GetPlayerId(p1)]= 1
		call SetPlayerState(p1, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p1, PLAYER_STATE_RESOURCE_GOLD)- 100 )
	endif
	if FT[GetPlayerId(p2)]and KS[GetPlayerId(p2)]== false and TF[GetPlayerId(p2)]== 0 then
		set TF[GetPlayerId(p2)]= 1
		call SetPlayerState(p2, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p2, PLAYER_STATE_RESOURCE_GOLD)- 100 )
	endif
	set ZZO = PlayersReliableGold[GetPlayerId(p1)]
	set PlayersReliableGold[GetPlayerId(p1)]= PlayersReliableGold[GetPlayerId(p2)]
	set PlayersReliableGold[GetPlayerId(p2)]= ZZO
	call DisableTrigger(CUV)
	if GetUnitAbilityLevel(u1,'A03E')> 0 then
		set IM = u1
		set AM = u2
		call ExecuteFunc("Z0O")
	elseif GetUnitAbilityLevel(u2,'A03E')> 0 then
		set IM = u2
		set AM = u1
		call ExecuteFunc("Z0O")
	endif
	if GetUnitAbilityLevel(u1,'A0CY')> 0 then
		set IM = u1
		set AM = u2
		call ExecuteFunc("Z1O")
	endif
	if GetUnitAbilityLevel(u2,'A0CY')> 0 then
		set IM = u2
		set AM = u1
		call ExecuteFunc("Z1O")
	endif
	call FlushChildHashtable(HY,(800 + GetPlayerId(GetOwningPlayer(u1))))
	call FlushChildHashtable(HY,(800 + GetPlayerId(GetOwningPlayer(u2))))
	set g = AllocationGroup(105)
	set bj_groupEnumOwningPlayer = p1
	call GroupEnumUnitsInRect(g, GetWorldBounds(), filterGetUnitsInRectOfPlayer)
	call ForGroup(g, function ZTO)
	call DeallocateGroup(g)
	set g = AllocationGroup(106)
	set bj_groupEnumOwningPlayer = p2
	call GroupEnumUnitsInRect(g, GetWorldBounds(), filterGetUnitsInRectOfPlayer)
	call ForGroup(g, function ZTO)
	call DeallocateGroup(g)
	call SetUnitOwner(u2, p1, true)
	call SetUnitOwner(u1, p2, true)
	set Player__Hero[GetPlayerId(p1)]= u2
	set PlayerHeroTypeId[GetPlayerId(p1)]= GetUnitTypeId(u2)
	call SaveInteger(HY, GetPlayerId(p1),'hHid', GetUnitPointValue(u2))
	set Player__Hero[GetPlayerId(p2)]= u1
	call SaveInteger(HY, GetPlayerId(p2),'hHid', GetUnitPointValue(u1))
	set PlayerHeroTypeId[GetPlayerId(p2)]= GetUnitTypeId(u1)
	call SetPlayerName(p1,(PlayersName[GetPlayerId((p1))])+ " (" + EJX(Player__Hero[GetPlayerId(p1)])+ ")")
	call SetPlayerName(p2,(PlayersName[GetPlayerId((p2))])+ " (" + EJX(Player__Hero[GetPlayerId(p2)])+ ")")
	call UnitAddItem(d, UnitItemInSlot(u2, 0))
	call UnitAddItem(d, UnitItemInSlot(u2, 1))
	call UnitAddItem(d, UnitItemInSlot(u2, 2))
	call UnitAddItem(d, UnitItemInSlot(u2, 3))
	call UnitAddItem(d, UnitItemInSlot(u2, 4))
	call UnitAddItem(d, UnitItemInSlot(u2, 5))
	set NKO = UnitItemInSlot(u1, 0)
	if NKO != null then
		call SetItemPlayer(NKO, p1, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u2, NKO)
	endif
	set NKO = UnitItemInSlot(u1, 1)
	if NKO != null then
		call SetItemPlayer(NKO, p1, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u2, NKO)
	endif
	set NKO = UnitItemInSlot(u1, 2)
	if NKO != null then
		call SetItemPlayer(NKO, p1, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u2, NKO)
	endif
	set NKO = UnitItemInSlot(u1, 3)
	if NKO != null then
		call SetItemPlayer(NKO, p1, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u2, NKO)
	endif
	set NKO = UnitItemInSlot(u1, 4)
	if NKO != null then
		call SetItemPlayer(NKO, p1, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u2, NKO)
	endif
	set NKO = UnitItemInSlot(u1, 5)
	if NKO != null then
		call SetItemPlayer(NKO, p1, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u2, NKO)
	endif
	set NKO = UnitItemInSlot(d, 0)
	if NKO != null then
		call SetItemPlayer(NKO, p2, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u1, NKO)
	endif
	set NKO = UnitItemInSlot(d, 1)
	if NKO != null then
		call SetItemPlayer(NKO, p2, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u1, NKO)
	endif
	set NKO = UnitItemInSlot(d, 2)
	if NKO != null then
		call SetItemPlayer(NKO, p2, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u1, NKO)
	endif
	set NKO = UnitItemInSlot(d, 3)
	if NKO != null then
		call SetItemPlayer(NKO, p2, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u1, NKO)
	endif
	set NKO = UnitItemInSlot(d, 4)
	if NKO != null then
		call SetItemPlayer(NKO, p2, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u1, NKO)
	endif
	set NKO = UnitItemInSlot(d, 5)
	if NKO != null then
		call SetItemPlayer(NKO, p2, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u1, NKO)
	endif
	call RemoveUnit(d)
	call EnableTrigger(CUV)
	call SetPlayerAbilityAvailableEx(p1, HeroChangeAbilitySkills[PlayerSkillIndex[GetPlayerId(p2)* HL + 1]], false)
	call SetPlayerAbilityAvailableEx(p1, HeroChangeAbilitySkills[PlayerSkillIndex[GetPlayerId(p2)* HL + 2]], false)
	call SetPlayerAbilityAvailableEx(p1, HeroChangeAbilitySkills[PlayerSkillIndex[GetPlayerId(p2)* HL + 3]], false)
	call SetPlayerAbilityAvailableEx(p1, HeroChangeAbilitySkills[PlayerSkillIndex[GetPlayerId(p2)* HL + 4]], false)
	call SetPlayerAbilityAvailableEx(p2, HeroChangeAbilitySkills[PlayerSkillIndex[GetPlayerId(p1)* HL + 1]], false)
	call SetPlayerAbilityAvailableEx(p2, HeroChangeAbilitySkills[PlayerSkillIndex[GetPlayerId(p1)* HL + 2]], false)
	call SetPlayerAbilityAvailableEx(p2, HeroChangeAbilitySkills[PlayerSkillIndex[GetPlayerId(p1)* HL + 3]], false)
	call SetPlayerAbilityAvailableEx(p2, HeroChangeAbilitySkills[PlayerSkillIndex[GetPlayerId(p1)* HL + 4]], false)
	loop
	exitwhen i > 4 + ExtraSkillsNumber
		set Z_O[i]= PlayerSkillIndex[GetPlayerId(p1)* HL + i]
		set PlayerSkillIndex[GetPlayerId(p1)* HL + i]= PlayerSkillIndex[GetPlayerId(p2)* HL + i]
		set PlayerSkillIndex[GetPlayerId(p2)* HL + i]= Z_O[i]
		set i = i + 1
	endloop
	call ClearSelectionForPlayer(p1)
	call SelectUnitAddForPlayer(u2, p1)
	call ClearSelectionForPlayer(p2)
	call SelectUnitAddForPlayer(u1, p2)
	call FlushChildHashtable(HY,(800 + GetPlayerId(p1)))
	call FlushChildHashtable(HY,(800 + GetPlayerId(p2)))
	call StoreDrCacheDataToPlayer(GetOwningPlayer(u1), "9", GetUnitTypeId(u1))
	call StoreDrCacheDataToPlayer(GetOwningPlayer(u2), "9", GetUnitTypeId(u2))
	call StoreDrCacheData("SWAP_" + I2S(GetPlayerId(GetOwningPlayer(u1)))+ "_" + I2S(GetPlayerId(GetOwningPlayer(u2))), GetUnitTypeId(u1))
	call StoreDrCacheData("SWAP_" + I2S(GetPlayerId(GetOwningPlayer(u2)))+ "_" + I2S(GetPlayerId(GetOwningPlayer(u1))), GetUnitTypeId(u2))
	call KTX(p1)
	call KTX(p2)
	if GKV or HOV then
		set KS[GetPlayerId(p1)]= true
		set KS[GetPlayerId(p2)]= true
	endif
	set p1 = null
	set p2 = null
	set g = null
	set d = null
	set NKO = null
endfunction
function Z2O takes unit u1, unit u2, player p1, player p2 returns boolean
	if u1 != null and u2 != null then
		return(LoadBoolean(HY,(800 + GetPlayerId(GetOwningPlayer(u2))),(GetUnitTypeId(u1)+ GetUnitTypeId(u2))))
	endif
	return(LoadBoolean(HY,(800 + GetPlayerId(p2)), GetPlayerId(p1)))
endfunction
function Z3O takes player p returns integer
	local integer i = 1
	loop
	exitwhen i > 5
		if SentinelPlayers[i]== p or ScourgePlayers[i]== p then
			return i
		endif
		set i = i + 1
	endloop
	return -1
endfunction
function Z4O takes unit u1, unit u2, boolean Z5O, player p1, player p2 returns boolean
	if u1 != null and u2 != null then
		call SaveBoolean(HY,(800 + GetPlayerId(GetOwningPlayer(u1))),(GetUnitTypeId(u1)+ GetUnitTypeId(u2)),(true))
		if Z2O(u1, u2, p1, p2) then
			call ZUO(u1, u2, p1, p2)
			return true
		else
			call DisplayTimedTextToPlayer(GetOwningPlayer(u2), 0, 0, 30, "  ")
			call DisplayTimedTextToPlayer(GetOwningPlayer(u2), 0, 0, 30, "						 " + PlayersColoerText[GetPlayerId(GetOwningPlayer(u1))] + GetUnitName(u1)+ "|r |cff99ccff" + GetObjectName('n082')+ " " + GetObjectName('n083')+ "|r |c00ff0303-swap " + I2S(Z3O(GetOwningPlayer(u1)))+ "|r |cff99ccff" + GetObjectName('n081')+ "|r")
			call DisplayTimedTextToPlayer(GetOwningPlayer(u2), 0, 0, 30, "  ")
			if GKV or HOV then
				call DisplayTimedTextToPlayer(GetOwningPlayer(u2), 0, 0, 30, "|c00ff0000WARNING:|r 所选模式禁止repick之后交换英雄.")
			endif
			if Z5O then
				call DisplayTimedTextToPlayer(GetOwningPlayer(u1), 0, 0, 30, "  ")
				call DisplayTimedTextToPlayer(GetOwningPlayer(u1), 0, 0, 30, "|cff99ccff" + GetObjectName('n08C')+ " |r" + PlayersColoerText[GetPlayerId(GetOwningPlayer(u2))] + GetUnitName(u2)+ "|r")
				call DisplayTimedTextToPlayer(GetOwningPlayer(u1), 0, 0, 30, "  ")
				if GKV or HOV then
					call DisplayTimedTextToPlayer(GetOwningPlayer(u1), 0, 0, 30, "|c00ff0000WARNING:|r 所选模式禁止repick之后交换英雄.")
				endif
			endif
		endif
	else
		call SaveBoolean(HY,(800 + GetPlayerId(p1)), GetPlayerId(p2),(true))
		if Z2O(u1, u2, p1, p2) then
			call ZUO(u1, u2, p1, p2)
			return true
		else
			call DisplayTimedTextToPlayer(p2, 0, 0, 30, "  ")
			call DisplayTimedTextToPlayer(p2, 0, 0, 30, "						 " + PlayersColoerText[GetPlayerId(p1)] + PlayersName[GetPlayerId(p1)] + "|r |cff99ccff" + GetObjectName('n082')+ " " + GetObjectName('n083')+ "|r |c00ff0303-swap " + I2S(Z3O(p1))+ "|r |cff99ccff" + GetObjectName('n081')+ "|r")
			call DisplayTimedTextToPlayer(p2, 0, 0, 30, "  ")
			if Z5O then
				call DisplayTimedTextToPlayer(p1, 0, 0, 30, "  ")
				call DisplayTimedTextToPlayer(p1, 0, 0, 30, "|cff99ccff" + GetObjectName('n08C')+ " |r" + PlayersColoerText[GetPlayerId(p2)] + PlayersName[GetPlayerId(p2)] + "|r")
				call DisplayTimedTextToPlayer(p1, 0, 0, 30, "  ")
			endif
		endif
	endif
	return false
endfunction
function Z6O takes nothing returns nothing
	local integer i = S2I(SubString(GetEventPlayerChatString(), 6, StringLength(GetEventPlayerChatString())))
	local player p = GetTriggerPlayer()
	if GetEventPlayerChatString() == "-swapall"then
		set i = 1
		set MissileHitTargetUnit = Player__Hero[GetPlayerId(p)]
		loop
		exitwhen i > 5
			if IsSentinelPlayer(p) then
				set E3 = SentinelPlayers[i]
			else
				set E3 = ScourgePlayers[i]
			endif
			set U2 = Player__Hero[GetPlayerId(E3)]
			if not(MissileHitTargetUnit == null or GetOwningPlayer(MissileHitTargetUnit)!= p or U2 == null or GetOwningPlayer(U2)!= E3 or E3 == p) then
				if Z4O(MissileHitTargetUnit, U2, false, p, E3) then
					return
				endif
			endif
			set i = i + 1
		endloop
		return
	elseif i < 1 or i > 5 then
		call InterfaceErrorForPlayer(p, GetObjectName('n02Z'))
		return
	elseif IsPickingHero then
		if IsSentinelPlayer(p) then
			set E3 = SentinelPlayers[i]
		else
			set E3 = ScourgePlayers[i]
		endif
		if not IsPlayingPlayer(E3) or E3 == p then
			call InterfaceErrorForPlayer(p, GetObjectName('n02Z'))
			return
		endif
	endif
	set MissileHitTargetUnit = Player__Hero[GetPlayerId(p)]
	if IsSentinelPlayer(p) then
		set E3 = SentinelPlayers[i]
	else
		set E3 = ScourgePlayers[i]
	endif
	set U2 = Player__Hero[GetPlayerId(E3)]
	if IsPickingHero then
		if not((GKV or HOV) and IsPlayingPlayer(E3) and E3 != p) then
			call InterfaceErrorForPlayer(p, GetObjectName('n02Z'))
			return
		endif
	elseif MissileHitTargetUnit == null or GetOwningPlayer(MissileHitTargetUnit)!= p or U2 == null or GetOwningPlayer(U2)!= E3 or E3 == p then
		call InterfaceErrorForPlayer(p, GetObjectName('n02Z'))
		return
	endif
	call Z4O(MissileHitTargetUnit, U2, true, p, E3)
endfunction
function Z7O takes nothing returns nothing
	local integer i
	local player p
	local unit u
	local string s
	if LocalPlayer== GetTriggerPlayer() then
		call ClearTextMessages()
	endif
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 45, "|cff99ccff" + GetObjectName('n08B')+ "|r")
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 45, " ")
	set i = 1
	loop
	exitwhen i > 5
		set p = SentinelPlayers[i]
		set u = Player__Hero[GetPlayerId(p)]
		if IsPlayerAlly(GetTriggerPlayer(), p) and GetTriggerPlayer()!= p and u != null and GetOwningPlayer(u) == p then
			set s = " "
			if Z2O(Player__Hero[GetPlayerId(GetTriggerPlayer())], u, GetTriggerPlayer(), p) then
				set s = " |c00ff0303(" + GetObjectName('n085')+ ")|r"
			endif
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 45, PlayersColoerText[GetPlayerId(p)] + I2S(i)+ "|r" + " - " + "|cff99ccff" + GetUnitName(u)+ "|r" + s)
		endif
		set p = ScourgePlayers[i]
		set u = Player__Hero[GetPlayerId(p)]
		if IsPlayerAlly(GetTriggerPlayer(), p) and GetTriggerPlayer()!= p and u != null and GetOwningPlayer(u) == p then
			set s = " "
			if Z2O(Player__Hero[GetPlayerId(GetTriggerPlayer())], u, GetTriggerPlayer(), p) then
				set s = " |c00ff0303(" + GetObjectName('n085')+ ")|r"
			endif
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 45, PlayersColoerText[GetPlayerId(p)] + I2S(i)+ "|r" + " - " + "|cff99ccff" + GetUnitName(u)+ "|r" + s)
		endif
		set i = i + 1
	endloop
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 45, " ")
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 45, "|cff99ccff" + GetObjectName('n083')+ "|r |c00ff0303-swap #|r |cff99ccff" + GetObjectName('n086')+ " -swapcancel " + GetObjectName('n087')+ "|r")
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 45, " ")
	set u = null
	set p = null
endfunction
function Z8O takes player whichPlayer returns boolean
	local integer loop_i = 1
	local integer Z9O = 0
	loop
	exitwhen loop_i > 5
		if IsSentinelPlayer(whichPlayer) then
			if Player__Hero[GetPlayerId(SentinelPlayers[loop_i])]!= null and SentinelPlayers[loop_i]!= whichPlayer and GetHeroLevel(Player__Hero[GetPlayerId(SentinelPlayers[loop_i])]) == 1 then
				set Z9O = Z9O + 1
			endif
		else
			if Player__Hero[GetPlayerId(ScourgePlayers[loop_i])]!= null and ScourgePlayers[loop_i]!= whichPlayer and GetHeroLevel(Player__Hero[GetPlayerId(ScourgePlayers[loop_i])]) == 1 then
				set Z9O = Z9O + 1
			endif
		endif
		set loop_i = loop_i + 1
	endloop
	if Z9O > 0 then
		return true
	else
		return false
	endif
endfunction
function VVR takes nothing returns boolean
	if F3 or J3 then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "-swaphero " + GetObjectName('n088'))
		return false
	endif
	if FT[GetPlayerId(GetTriggerPlayer())] then
		if GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD)< 100  then
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "在random之后需要至少100大洋才可以swap.")
			return false
		endif
	endif
	// if GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetTriggerPlayer())],'A0CL')> 0 then
	// 	 call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "由于你选择了某些技能，所以不能swap。")
	// 	 return false
	// endif
	if GetWidgetLife(Player__Hero[GetPlayerId(GetTriggerPlayer())])< 1 and(not IsPickingHero or not(GKV or HOV)) then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n08F'))
		return false
	endif
	if B3 then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n08G')+ " -swaphero.")
		return false
	endif
	if Z8O(GetTriggerPlayer()) == false and(not IsPickingHero or not(GKV or HOV)) then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n08H'))
		return false
	endif
	return true
endfunction
function Y1O takes nothing returns nothing
	if VVR() then
		if GetEventPlayerChatString() == "-swap"or GetEventPlayerChatString() == "-swaphero"then
			call Z7O()
		elseif GetEventPlayerChatString() == "-swapcancel"then
			call FlushChildHashtable(HY,(800 + GetPlayerId(GetTriggerPlayer())))
		else
			call Z6O()
		endif
	endif
endfunction
function VER takes nothing returns boolean
	local integer VXR = GetUnitTypeId(Player__Hero[GetPlayerId(GetTriggerPlayer())])
	return(VXR =='U008' or VXR =='U007' or VXR =='Hlgr' or VXR =='Eevi' or VXR =='Ekee') and(RectContainsUnit(gg_rct_SentinelFountainOfLifeRange, Player__Hero[GetPlayerId(GetTriggerPlayer())]) or RectContainsUnit(gg_rct_ScourgeFountainOfLifeRange, Player__Hero[GetPlayerId(GetTriggerPlayer())]))
endfunction
function VOR takes nothing returns nothing
	local unit trigUnit = Player__Hero[GetPlayerId(GetTriggerPlayer())]
	call UnitAddAbility(trigUnit,'A0FI')
	call IssueImmediateOrderById(trigUnit, 852663)
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 120., "|c00ff0303" + GetObjectName('n08I')+ " " + EJX(GetEnumUnit())+ ". " + GetObjectName('n08J')+ "|r")
	set trigUnit = null
endfunction
function VRR takes nothing returns nothing
	if VER() then
		call VOR()
	endif
endfunction
function VIR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local integer count = GetTriggerEvalCount(t)
	local real x
	local real y
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or count > 60 then
		if ((LoadInteger(HY,(GetHandleId((trigUnit))),(4259))) == 1) == false then
			if IsSentinelPlayer(GetOwningPlayer(trigUnit)) then
				set x = GetRectCenterX(gg_rct_SentinelRevivalPoint)
				set y = GetRectCenterY(gg_rct_SentinelRevivalPoint)
			else
				set x = GetRectCenterX(gg_rct_ScourgeRevivalPoint)
				set y = GetRectCenterY(gg_rct_ScourgeRevivalPoint)
			endif
			call SetUnitPosition(trigUnit, x, y)
			call PauseUnit(trigUnit, false)
			call ShowUnit(trigUnit, true)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call PauseUnit(trigUnit, true)
	endif
	set t = null
	set trigUnit = null
	return false
endfunction
function VAR takes player p returns nothing
	local unit trigUnit = Player__Hero[GetPlayerId(p)]
	local trigger t
	if UnitIsDead(trigUnit) == false then
		set t = CreateTrigger()
		call DisplayTimedTextToPlayer(p, 0, 0, 30., GetObjectName('n08K'))
		call UnitRemoveBuffs(trigUnit, true, false)
		call UnitRemoveAbility(trigUnit,'Bcyc')
		call UnitRemoveAbility(trigUnit,'Bcy2')
		call UnitRemoveAbility(trigUnit,'B02J')
		call UnitRemoveAbility(trigUnit,'BUsp')
		call UnitRemoveAbility(trigUnit,'Bust')
		call UnitRemoveAbility(trigUnit,'B02F')
		call PauseUnit(trigUnit, true)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerRegisterDeathEvent(t, trigUnit)
		call TriggerAddCondition(t, Condition(function VIR))
		call SaveUnitHandle(HY,(GetHandleId(t)), 14,(trigUnit))
	endif
	set p = null
	set trigUnit = null
	set t = null
endfunction
function VNR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player p =(LoadPlayerHandle(HY, h, 54))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED then
		call VAR(p)
	endif
	set t = null
	set p = null
	return false
endfunction
function VBR takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local unit trigUnit = Player__Hero[GetPlayerId(p)]
	local trigger t
	if UnitIsDead(trigUnit) == false then
		set t = CreateTrigger()
		call TriggerRegisterTimerEvent(t, 3.5, false)
		call TriggerRegisterUnitEvent(t, trigUnit, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(t, Condition(function VNR))
		call SavePlayerHandle(HY,(GetHandleId(t)), 54,(p))
	endif
	set p = null
	set trigUnit = null
	set t = null
endfunction
function VCR takes player p returns string
	local string s = PlayerOnlineStateString[GetPlayerId(p)]
	if PlayerOnlineStateString[GetPlayerId(p)]!= "Here"then
		return" |c00ff0303(" + GetObjectName('n089')+ " at " + SubString(s, 10, StringLength(s))+ "|c00ff0303)|r"
	endif
	return" "
endfunction
function VDR takes nothing returns nothing
	local integer loop_i = 1
	local integer loop_max = 5
	local integer index
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 20, " ")
	if (IsScourgePlayer(GetTriggerPlayer())) then
		loop
		exitwhen loop_i > loop_max
			set index = GetPlayerId(SentinelPlayers[loop_i])
			if (Player__Hero[index]!= null) then
				call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 20, PlayersColoerText[index] +(PlayersName[GetPlayerId((SentinelPlayers[loop_i]))])+ "|r " + GetObjectName('n08M')+ " " + GetUnitName(Player__Hero[index])+ " (" + GetObjectName('n08L')+ " " + I2S(GetUnitLevel(Player__Hero[index]))+ ")" + VCR(SentinelPlayers[loop_i]))
			endif
			set loop_i = loop_i + 1
		endloop
	else
		loop
		exitwhen loop_i > loop_max
			set index = GetPlayerId(ScourgePlayers[loop_i])
			if (Player__Hero[index]!= null) then
				call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 20, PlayersColoerText[index] +(PlayersName[GetPlayerId((ScourgePlayers[loop_i]))])+ "|r " + GetObjectName('n08M')+ " " + GetUnitName(Player__Hero[index])+ " (" + GetObjectName('n08L')+ " " + I2S(GetUnitLevel(Player__Hero[index]))+ ")" + VCR(ScourgePlayers[loop_i]))
			endif
			set loop_i = loop_i + 1
		endloop
	endif
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 20, " ")
endfunction
function VFR takes unit u returns boolean
	return GetUnitTypeId(u)=='N01O' or GetUnitTypeId(u)=='N013' or GetUnitTypeId(u)=='N014' or GetUnitTypeId(u)=='N015'
endfunction
function VGR takes unit u returns unit
	local integer h = GetHandleId(GetOwningPlayer(u))
	return(LoadUnitHandle(HY, h, 333))
endfunction
function VHR takes nothing returns nothing
	local unit u
	local integer i = 0
	if (Player__Hero[GetPlayerId(GetTriggerPlayer())]== null) then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., GetObjectName('n08A'))
	else
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., GetUnitName(Player__Hero[GetPlayerId(GetTriggerPlayer())])+ " " + GetObjectName('n08N')+ " " + I2S(R2I(.5 + GetHeroMoveSpeed(Player__Hero[GetPlayerId(GetTriggerPlayer())]))))
		if VFR(Player__Hero[GetPlayerId(GetTriggerPlayer())]) then
			set u = VGR(Player__Hero[GetPlayerId(GetTriggerPlayer())])
			if u != null then
				call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., GetUnitName(u)+ " " + GetObjectName('n08N')+ " " + I2S(R2I(.5 + GetHeroMoveSpeed(u))))
			endif
		endif
	endif
	set u = null
endfunction
function YFO takes nothing returns nothing
	local unit u
	local integer i = 0
	local group g = AllocationGroup(107)
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		// debug call SingleDebug(GetUnitName(u)+ " ms = " + R2S(GetHeroMoveSpeed(u)))
		call GroupRemoveUnit(g, u)
	endloop
	call DeallocateGroup(g)
endfunction
function VJR takes nothing returns nothing
	local unit u
	local integer i = 0
	if (Player__Hero[GetPlayerId(GetTriggerPlayer())]== null) then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., GetObjectName('n08A'))
	else
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., GetUnitName(Player__Hero[GetPlayerId(GetTriggerPlayer())])+ " " + GetObjectName('n08N')+ " " + I2S(R2I(.5 + GetHeroMoveSpeed(Player__Hero[GetPlayerId(GetTriggerPlayer())]))))
		if VFR(Player__Hero[GetPlayerId(GetTriggerPlayer())]) then
			set u = VGR(Player__Hero[GetPlayerId(GetTriggerPlayer())])
			if u != null then
				call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., GetUnitName(u)+ " " + GetObjectName('n08N')+ " " + I2S(R2I(.5 + GetHeroMoveSpeed(u))))
			endif
		endif
		loop
		exitwhen i > 16
			set u = Player__Hero[i]
			if u != null and u != Player__Hero[GetPlayerId(GetTriggerPlayer())]and IsUnitAlly(u, GetTriggerPlayer()) then
				call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., GetUnitName(u)+ " " + GetObjectName('n08N')+ " " + I2S(R2I(.5 + GetHeroMoveSpeed(u))))
			endif
			set i = i + 1
		endloop
	endif
	set u = null
endfunction
function VKR takes nothing returns nothing
	call SaveBoolean(HY, GetHandleId(GetTriggerPlayer()), 139, true)
	call GetSetupText(GetObjectName('n08R'), true)
	//call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n08R'))
endfunction
function VLR takes nothing returns nothing
	call SaveBoolean(HY, GetHandleId(GetTriggerPlayer()), 139, false)
	call GetSetupText(GetObjectName('n08R'), false)
	//call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n08O'))
endfunction
function VMR takes nothing returns nothing
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., "   " + GetObjectName('n08P')+ " " + I2S(PlayerCreepLastHitCount[GetPlayerId(GetTriggerPlayer())])+ " " + GetObjectName('n08Q')+ " " + I2S(PlayerCreepDenyCount[GetPlayerId(GetTriggerPlayer())])+ " " + GetObjectName('n08S')+ " " + I2S(PlayerNeutralCreepDenyCount[GetPlayerId(GetTriggerPlayer())]))
endfunction
function VPR takes nothing returns nothing
	local integer x = GetPlayerId(GetTriggerPlayer())
	if (GetEventPlayerChatString() == "-cson") then
		set PlayerShowKDA[x]= true
		set F6V[x]= true
	else
		set PlayerShowKDA[x]= false
		set F6V[x]= false
	endif
endfunction
function Set_Disableselection takes player p returns nothing
	call Set_CheckBox_Nothing(p, 7, false)
	set F_V[GetPlayerId(p)]= false
	call DisplayTimedTextToPlayer(p, 0, 0, 5, GetObjectName('n0JZ'))
endfunction
function VQR takes nothing returns nothing
	call Set_Disableselection(GetTriggerPlayer())
endfunction
function Set_Enableselection takes player p returns nothing
	call Set_CheckBox_Nothing(p, 7, true)
	set F_V[GetPlayerId(p)]= true
	call DisplayTimedTextToPlayer(p, 0, 0, 5, GetObjectName('n0K0'))
endfunction
function VSR takes nothing returns nothing
	call Set_Enableselection(GetTriggerPlayer())
endfunction
function VTR takes nothing returns nothing
	local integer i = 0
	local integer id = GetPlayerId(GetTriggerPlayer())
	local integer count = 0
	local integer VUR = 0
	local player p
	if F1V == false or YS == false then
		return
	endif
	if F3V + 90 <(GetGameTime()) then
		loop
		exitwhen i > 15
			set F2V[i]= false
			set i = i + 1
		endloop
	endif
	set F3V =(GetGameTime())+ 90
	set F2V[id]= true
	set i = 0
	loop
	exitwhen i > 15
		if IsSentinelPlayer(GetTriggerPlayer()) then
			if IsSentinelPlayer(Player(i)) and IsPlayingPlayer(Player(i)) then
				set VUR = VUR + 1
				if F2V[i] then
					set count = count + 1
				endif
			endif
		else
			if IsScourgePlayer(Player(i)) and IsPlayingPlayer(Player(i)) then
				set VUR = VUR + 1
				if F2V[i] then
					set count = count + 1
				endif
			endif
		endif
		set i = i + 1
	endloop
	if count * 2 > VUR then
		if IsSentinelPlayer(GetTriggerPlayer()) then
			set i = 0
			loop
			exitwhen i > 5
				set p = SentinelPlayers[i]
				if EJV[GetPlayerId(p)]and F0V[GetPlayerId(p)]== false then
					call DisplayTimedTextToAllPlayer(SentinelForce, 10, GetObjectName('n0KD')+ " " +(PlayersName[GetPlayerId((p))]))
					call C2X(p)
					set F0V[GetPlayerId(p)]= true
				endif
				set i = i + 1
			endloop
		else
			set i = 0
			loop
			exitwhen i > 5
				set p = ScourgePlayers[i]
				if EJV[GetPlayerId(p)]and F0V[GetPlayerId(p)]== false then
					call DisplayTimedTextToAllPlayer(ScourgeForce, 10, GetObjectName('n0KD')+ " " +(PlayersName[GetPlayerId((p))]))
					call C2X(p)
					set F0V[GetPlayerId(p)]= true
				endif
				set i = i + 1
			endloop
		endif
	else
		if IsSentinelPlayer(GetTriggerPlayer()) then
			call DisplayTimedTextToAllPlayer(SentinelForce, 10, GetObjectName('n0KB')+ " " + I2S(count)+ "/" + I2S(VUR)+ " (" +(PlayersName[GetPlayerId((GetTriggerPlayer()))])+ ")")
		else
			call DisplayTimedTextToAllPlayer(ScourgeForce, 10, GetObjectName('n0KB')+ " " + I2S(count)+ "/" + I2S(VUR)+ " (" +(PlayersName[GetPlayerId((GetTriggerPlayer()))])+ ")")
		endif
	endif
	set p = null
endfunction
function VWR takes nothing returns nothing
	local integer i = 1
	local integer pid
	local boolean VYR
	local boolean Y1X
	local boolean U5V
	local player p
	local boolean VZR = not(M3 or IsGameEnd)
	local string s = ""
	local integer time
	local integer V_R
	local real N3X
	local unit u
	local integer V0R
	local integer k = 1
	local integer c = LoadInteger(HY, GetHandleId(GetExpiredTimer()), 0)+ 1
	call SaveInteger(HY, GetHandleId(GetExpiredTimer()), 0, c)
	loop
		set i = 1
		loop
			set V_R = 0
			set s = "	"
			if k == 1 then
				set p = SentinelPlayers[i]
			else
				set p = ScourgePlayers[i]
			endif
			if IsPlayingPlayer(p) then
				set pid = GetPlayerId(p)
				set time = R2I(TimerGetRemaining(PS[pid]))
				set VYR = time > 0 and F4V[pid]and VZR
				if VYR then
					set s = s + "即将复活: " + I2S(time)+ "|n"
					set V_R = 1
				endif
				if ModuloInteger(c, 2) == 1 then
					call Y9X(p)
				endif
				if HaveSavedHandle(OtherHashTable, GetHandleId(p),'COUR') and(LoadBoolean(OtherHashTable, GetHandleId(p),'UIds') or UnitIsDead(LoadUnitHandle(OtherHashTable, GetHandleId(p),'COUR'))) then
					set V_R = 1
					set u = LoadUnitHandle(OtherHashTable, GetHandleId(p),'COUR')
					set V0R = GetPlayerId(GetOwningPlayer(u))
					set s = s + PlayersColoerText[V0R] + "信使|r: "
					if UnitIsDead(u) then
						set s = s + "|c00ff0000死亡|r (" + I2S(R2I(GetGameTime()-LoadReal(HY, GetHandleId(u),'DEAD'))*-1)+ "s)"
					else
						set s = s + LoadStr(OtherHashTable, GetHandleId(u),'ORDR')
					endif
				endif
				if V_R > 0 then
					call LeaderboardDisplay(F5V[pid], true)
					call LeaderboardSetLabel(F5V[pid], s)
					call PlayerSetLeaderboard(p, F5V[pid])
				elseif IsLeaderboardDisplayed(F5V[pid]) then
					call LeaderboardDisplay(F5V[pid], false)
				endif
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
		set k = k + 1
	exitwhen k > 2
	endloop
	set u = null
endfunction
function CreateLeaderboards takes nothing returns nothing
	local integer i = 1
	local integer pid
	local timer t = CreateTimer()
	call TimerStart(t, 1, true, function VWR)
	set t = null
	loop
		set pid = GetPlayerId(SentinelPlayers[i])
		set F5V[pid]= CreateLeaderboard()
		call PlayerSetLeaderboard(SentinelPlayers[i], F5V[pid])
		call LeaderboardDisplay(F5V[pid], false)
		call LeaderboardSetLabel(F5V[pid], "Default string")
		set pid = GetPlayerId(ScourgePlayers[i])
		set F5V[pid]= CreateLeaderboard()
		call PlayerSetLeaderboard(ScourgePlayers[i], F5V[pid])
		call LeaderboardDisplay(F5V[pid], false)
		call LeaderboardSetLabel(F5V[pid], "Default string")
		set i = i + 1
	exitwhen i > 5
	endloop
endfunction
function V2R takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer x = GetPlayerId(p)
	if GetEventPlayerChatString() == "-don"or GetEventPlayerChatString() == "-deathon"then
		call Set_CheckBox_Nothing(p, 18, true)
		set F4V[x]= true
		call GetSetupText("复活计时器窗口", true)
		//call DisplayTimedTextToPlayer(p, 0, 0, 10, GetObjectName('n08W'))
	else
		call Set_CheckBox_Nothing(p, 18, false)
		set F4V[x]= false
		call GetSetupText("复活计时器窗口", false)
		//call DisplayTimedTextToPlayer(p, 0, 0, 10, GetObjectName('n08X'))
	endif
endfunction
function V3R takes nothing returns nothing
	if (GetEventPlayerChatString() == "-showdeny") then
		set F6V[GetPlayerId(GetTriggerPlayer())]= true
	else
		set F6V[GetPlayerId(GetTriggerPlayer())]= false
	endif
endfunction
function V4R takes nothing returns nothing
	call InterfaceErrorForPlayer(GetTriggerPlayer(), GetObjectName('n0HG'))
endfunction
function V5R takes nothing returns nothing
	local player p = GetTriggerPlayer()
	call ForceRemovePlayer(AllPlayerForce, p)
	call GetSetupText(GetObjectName('n08U'), true)
	call Set_CheckBox_Nothing(p, 12, true)
endfunction
function V6R takes nothing returns nothing
	local player p = GetTriggerPlayer()
	call ForceAddPlayer(AllPlayerForce, p)
	call GetSetupText(GetObjectName('n08U'), false)
	call Set_CheckBox_Nothing(p, 12, false)
endfunction
function V7R takes nothing returns boolean
	local integer x = GetRandomInt(1, 4)
	if x == 1 then
		set F8V = E5
	elseif x == 2 then
		set F8V = X5
	elseif x == 3 then
		set F8V = Z4
	elseif x == 4 then
		set F8V = V5
	endif
	if F9V[LocalPlayerId] then
		call EnableWeatherEffect(E5, false)
		call EnableWeatherEffect(X5, false)
		call EnableWeatherEffect(Z4, false)
		call EnableWeatherEffect(V5, false)
		call EnableWeatherEffect(F8V, true)
	endif
	return false
endfunction
function V8R takes nothing returns nothing
	local integer x = GetRandomInt(1, 4)
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 300, true)
	call TriggerAddCondition(t, Condition(function V7R))
	set F9V[GetPlayerId(SentinelPlayers[1])]= false
	set F9V[GetPlayerId(SentinelPlayers[2])]= false
	set F9V[GetPlayerId(SentinelPlayers[3])]= false
	set F9V[GetPlayerId(SentinelPlayers[4])]= false
	set F9V[GetPlayerId(SentinelPlayers[5])]= false
	set F9V[GetPlayerId(ScourgePlayers[1])]= false
	set F9V[GetPlayerId(ScourgePlayers[2])]= false
	set F9V[GetPlayerId(ScourgePlayers[3])]= false
	set F9V[GetPlayerId(ScourgePlayers[4])]= false
	set F9V[GetPlayerId(ScourgePlayers[5])]= false
	if IsGameHaveObserver then
		set F9V[GetPlayerId(ObserverPlayer1)]= false
		set F9V[GetPlayerId(ObserverPlayer2)]= false
	endif
	if x == 1 then
		set F8V = E5
	elseif x == 2 then
		set F8V = X5
	elseif x == 3 then
		set F8V = Z4
	elseif x == 4 then
		set F8V = V5
	endif
	set t = null
endfunction
function V9R takes nothing returns nothing
	local string EVR = StringCase(GetEventPlayerChatString(), false)
	if F7V then
		set F7V = false
		call V8R()
	endif
	if EVR != "-weather random" then
		set F9V[GetPlayerId(GetTriggerPlayer())]= false
	else
		set F9V[GetPlayerId(GetTriggerPlayer())]= true
	endif
	if LocalPlayer== GetTriggerPlayer() then
		call EnableWeatherEffect(E5, false)
		call EnableWeatherEffect(X5, false)
		call EnableWeatherEffect(Z4, false)
		call EnableWeatherEffect(V5, false)
		if EVR == "-weather snow" then
			call EnableWeatherEffect(E5, true)
		elseif EVR == "-weather rain" then
			call EnableWeatherEffect(X5, true)
		elseif EVR == "-weather moonlight" then
			call EnableWeatherEffect(Z4, true)
		elseif EVR == "-weather wind" then
			call EnableWeatherEffect(V5, true)
		elseif EVR == "-weather random" then
			call EnableWeatherEffect(F8V, true)
		endif
	endif
endfunction
function Y2O takes nothing returns nothing
	local integer a = S2I(SubString(GetEventPlayerChatString(), 6, StringLength(GetEventPlayerChatString())))
	local integer index = GetPlayerId(GetTriggerPlayer())
	local integer TTV
	if GetEventPlayerChatString() == "-rollon"or GetEventPlayerChatString() == "-rolloff"then
		return
	endif
	set Q3[index]= Q3[index] + 1
	if Q3[index]> 20 then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n0DQ'))
		return
	endif
	if a == 0 then
		set a = 100 
	endif
	if a > 0 and a < 2001 then
		set TTV = GetRandomInt(1, a)
		if S3[LocalPlayerId] then
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 5, PlayersColoerText[index] + PlayersName[index] + "|r " + GetObjectName('n05I')+ " " + I2S(TTV)+ " " + GetObjectName('n05M')+ " " + I2S(a))
		endif
	else
		call InterfaceErrorForPlayer(GetTriggerPlayer(), GetObjectName('n02Y'))
	endif
endfunction
function EER takes nothing returns nothing
	local integer a
	if GetRandomInt(1, 2) == 1 then
		set a = GetRandomInt(VYV, HeroTypeMaxCount)
	else
		set a = GetRandomInt(1, VWV)
	endif
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n0GS')+ " " + EKX(a))
endfunction
function EXR takes nothing returns nothing
	set S3[GetPlayerId(GetTriggerPlayer())]= false
endfunction
function EOR takes nothing returns nothing
	set S3[GetPlayerId(GetTriggerPlayer())]= true
endfunction
function ERR takes nothing returns nothing
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n090'))
	set NeedHideHeroNames[GetPlayerId(GetTriggerPlayer())]= true
	if LocalPlayer== GetTriggerPlayer() then
		call SetPlayerName(SentinelPlayers[1], PlayersName[GetPlayerId(SentinelPlayers[1])])
		call SetPlayerName(SentinelPlayers[2], PlayersName[GetPlayerId(SentinelPlayers[2])])
		call SetPlayerName(SentinelPlayers[3], PlayersName[GetPlayerId(SentinelPlayers[3])])
		call SetPlayerName(SentinelPlayers[4], PlayersName[GetPlayerId(SentinelPlayers[4])])
		call SetPlayerName(SentinelPlayers[5], PlayersName[GetPlayerId(SentinelPlayers[5])])
		call SetPlayerName(ScourgePlayers[1], PlayersName[GetPlayerId(ScourgePlayers[1])])
		call SetPlayerName(ScourgePlayers[2], PlayersName[GetPlayerId(ScourgePlayers[2])])
		call SetPlayerName(ScourgePlayers[3], PlayersName[GetPlayerId(ScourgePlayers[3])])
		call SetPlayerName(ScourgePlayers[4], PlayersName[GetPlayerId(ScourgePlayers[4])])
		call SetPlayerName(ScourgePlayers[5], PlayersName[GetPlayerId(ScourgePlayers[5])])
	endif
endfunction
function EIR takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer id = GetPlayerId(p)
	call Click_CheckBox_Nothing(p, 11)
	if T3[id] then
		set T3[id]= false
		call DisplayTimedTextToPlayer(p, 0, 0, 10, GetObjectName('n08T'))
	else
		set T3[id]= true
		call DisplayTimedTextToPlayer(p, 0, 0, 10, GetObjectName('n091'))
	endif
endfunction
//-si
function EAR takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer id = GetPlayerId(p)
	set IsPlayersEnableItemInfo[id] = ( IsPlayersEnableSkillInfo[id] and Setup_ItemInfo[id] ) //-ii
	set IsPlayersEnableSkillInfo[id] = not IsPlayersEnableSkillInfo[id] // -si
	set Setup_SkillInfo[id] = IsPlayersEnableSkillInfo[id]
	if LocalPlayer == p then
		call DzFrameSetEnable(OptionCheckBoxs[5], not IsPlayersEnableSkillInfo[id])
		if not IsPlayersEnableSkillInfo[id] and Setup_ItemInfo[id] then
			call DzFrameSetEnable(OptionCheckBoxs[4], false)
		elseif IsPlayersEnableSkillInfo[id] then
			call DzFrameSetEnable(OptionCheckBoxs[4], true)
		endif
		call DzFrameShow( OptionCheckBoxsHighLight[4], IsPlayersEnableSkillInfo[id] )
		set IsMenuOptionCheckBoxEnabled[4] = IsPlayersEnableSkillInfo[id]
	endif
endfunction
//-ii
function ENR takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer id = GetPlayerId(p)
	set IsPlayersEnableSkillInfo[id] = ( IsPlayersEnableItemInfo[id] and Setup_SkillInfo[id] ) //-si
	set IsPlayersEnableItemInfo[id] = not IsPlayersEnableItemInfo[id] //-ii
	set Setup_ItemInfo[id] = IsPlayersEnableItemInfo[id]
	if LocalPlayer == p then
		call DzFrameSetEnable(OptionCheckBoxs[4], not IsPlayersEnableItemInfo[id])
		if not IsPlayersEnableItemInfo[id] and Setup_SkillInfo[id] then
			call DzFrameSetEnable(OptionCheckBoxs[5], false)
		elseif IsPlayersEnableItemInfo[id] then
			call DzFrameSetEnable(OptionCheckBoxs[5], true)
		endif
		call DzFrameShow( OptionCheckBoxsHighLight[5], IsPlayersEnableItemInfo[id] )
		set IsMenuOptionCheckBoxEnabled[5] = IsPlayersEnableItemInfo[id]
	endif
endfunction
function EBR takes nothing returns nothing
	local integer i = 1
	local player p
	local real ECR
	loop
	exitwhen i > 5
		set p = SentinelPlayers[i]
		if IsPlayingPlayer(p) then
			set ECR = SQ[GetPlayerId(p)]/(GetGameTime())* 60
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., PlayersColoerText[GetPlayerId(p)] +(PlayersName[GetPlayerId((p))])+ "|r" + " " + GetObjectName('n084')+ " " + R2S(ECR))
		endif
		set p = ScourgePlayers[i]
		if IsPlayingPlayer(p) then
			set ECR = SQ[GetPlayerId(p)]/(GetGameTime())* 60
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., PlayersColoerText[GetPlayerId(p)] +(PlayersName[GetPlayerId((p))])+ "|r" + " " + GetObjectName('n084')+ " " + R2S(ECR))
		endif
		set i = i + 1
	endloop
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., " ")
	set p = null
endfunction
function EDR takes nothing returns nothing
	call B4X(GetTriggerPlayer())
	if GetTriggerEventId() == EVENT_PLAYER_END_CINEMATIC then
		return
	endif
	set BR[GetPlayerId(GetTriggerPlayer())]= BR[GetPlayerId(GetTriggerPlayer())] + 1
	if (BR[GetPlayerId(GetTriggerPlayer())]== 1) then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "Use command |c00ff0505-fc|r to reduce the duration of kill messages")
	endif
endfunction
function EFR takes player whichPlayer returns nothing
	local integer EGR
	local player EHR
	set EGR = 0
	loop
		set EHR = Player(EGR)
		if (PlayersAreCoAllied(whichPlayer, EHR) and whichPlayer != EHR) then
			call SetPlayerAlliance(whichPlayer, EHR, ALLIANCE_SHARED_VISION, true)
			call SetPlayerAlliance(whichPlayer, EHR, ALLIANCE_SHARED_CONTROL, true)
			call SetPlayerAlliance(EHR, whichPlayer, ALLIANCE_SHARED_CONTROL, true)
		endif
		set EGR = EGR + 1
	exitwhen EGR == 12
	endloop
	set EHR = null
endfunction
function Y3O takes nothing returns nothing
	local integer index = S2I(SubString(GetEventPlayerChatString(), 9, StringLength(GetEventPlayerChatString())))
	local integer i = 1
	local player p
	local string KGX
	if GOV then
		if (TS < 10) then
			set KGX = I2S(QS)+ ":0" + I2S(TS)
		else
			set KGX = I2S(QS)+ ":" + I2S(TS)
		endif
		if index < 1 or GRV[index]== false then
			loop
			exitwhen i > 5
				set p = SentinelPlayers[i]
				if IsPlayingPlayer(p) and((GetGameTime())-TQ[GetPlayerId(p)])> 300. and GRV[GetPlayerId(p)]== false and not IsPickingHero then
					set GRV[GetPlayerId(p)]= true
					call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., PlayersColoerText[GetPlayerId(p)] +(PlayersName[GetPlayerId((p))])+ "|r" + " " + GetObjectName('n05G')+ " " + R2S(((GetGameTime())-TQ[GetPlayerId(p)])/ 60)+ " " + GetObjectName('N05F'))
					call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., GetObjectName('n05O')+ " |cff99ccff-kickafk " + I2S(GetPlayerId(p))+ " |r " + GetObjectName('n05P'))
					call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., " ")
				endif
				set p = ScourgePlayers[i]
				if IsPlayingPlayer(p) and((GetGameTime())-TQ[GetPlayerId(p)])> 300. and GRV[GetPlayerId(p)]== false and not IsPickingHero then
					set GRV[GetPlayerId(p)]= true
					call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., PlayersColoerText[GetPlayerId(p)] +(PlayersName[GetPlayerId((p))])+ "|r" + " " + GetObjectName('n05G')+ " " + R2S(((GetGameTime())-TQ[GetPlayerId(p)])/ 60)+ " " + GetObjectName('N05F'))
					call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., GetObjectName('n05O')+ " |cff99ccff-kickafk " + I2S(GetPlayerId(p))+ " |r " + GetObjectName('n05P'))
					call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., " ")
				endif
				set i = i + 1
			endloop
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., " ")
		elseif IsPlayingPlayer(Player(index)) and IsPlayerAlly(GetTriggerPlayer(), Player(index)) then
			call DisplayTimedTextToPlayer(Player(index), 0, 0, 3600, "|c00ff0303" + GetObjectName('n05E')+ "|r")
			call L1X(Player(index))
			set PlayerOnlineStateString[GetPlayerId(Player(index))]= "|c00555555" + KGX + "|r"
			call RemovePlayer(Player(index), PLAYER_GAME_RESULT_DEFEAT)
			call EFR(Player(index))
			if YS then
				call C0X(Player(index))
			endif
			set EJV[GetPlayerId(Player(index))]= true
			call L0X(Player(index))
			call DisplayTimedTextToAllPlayer(AllPlayerForce, 30., "|c00ff0303" +(PlayersName[GetPlayerId((Player(index)))])+ " " + GetObjectName('n05E')+ "|r")
		endif
	endif
	set p = null
endfunction
function EJR takes nothing returns nothing
	local integer i = 1
	local player p
	local integer x = 0
	if GOV then
		loop
		exitwhen i > 5
			set p = SentinelPlayers[i]
			if IsPlayingPlayer(p) and((GetGameTime())-TQ[GetPlayerId(p)])/ 60 > .2 then
				set x = x + 1
				call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., PlayersColoerText[GetPlayerId(p)] +(PlayersName[GetPlayerId((p))])+ "|r" + " " + GetObjectName('n05D')+ " " + R2S(((GetGameTime())-TQ[GetPlayerId(p)])/ 60)+ " " + GetObjectName('N05F'))
			endif
			set p = ScourgePlayers[i]
			if IsPlayingPlayer(p) and((GetGameTime())-TQ[GetPlayerId(p)])/ 60 > .2 then
				set x = x + 1
				call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., PlayersColoerText[GetPlayerId(p)] +(PlayersName[GetPlayerId((p))])+ "|r" + " " + GetObjectName('n05D')+ " " + R2S(((GetGameTime())-TQ[GetPlayerId(p)])/ 60)+ " " + GetObjectName('N05F'))
			endif
			set i = i + 1
		endloop
		if x < 1 then
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., GetObjectName('N05Q'))
		else
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., " ")
		endif
	endif
	set p = null
endfunction
function HeroGPS takes nothing returns nothing
	local integer i = 1
	local player p
	local integer pid
	local integer k = 0
	loop
		set k = 0
		set p = SentinelPlayers[i]
		if IsPlayingPlayer(p) then
			set pid = GetPlayerId(p)
			call StoreDrCacheData("LoD_HeroX_" + I2S(R2I(GetUnitX(Player__Hero[pid]))), pid)
			call StoreDrCacheData("LoD_HeroY_" + I2S(R2I(GetUnitY(Player__Hero[pid]))), pid)
		endif
		set p = ScourgePlayers[i]
		if IsPlayingPlayer(p) then
			set pid = GetPlayerId(p)
			call StoreDrCacheData("LoD_HeroX_" + I2S(R2I(GetUnitX(Player__Hero[pid]))), pid)
			call StoreDrCacheData("LoD_HeroY_" + I2S(R2I(GetUnitY(Player__Hero[pid]))), pid)
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
endfunction
function EKR takes nothing returns boolean
	local integer i = 1
	local player p
	local real KGX =(GetGameTime())
	if GOV then
		loop
		exitwhen i > 5
			set p = SentinelPlayers[i]
			if IsPlayingPlayer(p) and(KGX -TQ[GetPlayerId(p)])> 300. and GRV[GetPlayerId(p)]== false then
				set GRV[GetPlayerId(p)]= true
				call DisplayTimedTextToAllPlayer(SentinelForce, 15, PlayersColoerText[GetPlayerId(p)] +(PlayersName[GetPlayerId((p))])+ "|r" + " " + GetObjectName('n05G')+ " " + R2S((KGX -TQ[GetPlayerId(p)])/ 60)+ " " + GetObjectName('N05F'))
				call DisplayTimedTextToAllPlayer(SentinelForce, 15, GetObjectName('n05O')+ " |cff99ccff-kickafk " + I2S(GetPlayerId(p))+ " |r " + GetObjectName('n05P'))
				call DisplayTimedTextToAllPlayer(SentinelForce, 15, " ")
			endif
			set p = ScourgePlayers[i]
			if IsPlayingPlayer(p) and(KGX -TQ[GetPlayerId(p)])> 300. and GRV[GetPlayerId(p)]== false then
				set GRV[GetPlayerId(p)]= true
				call DisplayTimedTextToAllPlayer(ScourgeForce, 15, PlayersColoerText[GetPlayerId(p)] +(PlayersName[GetPlayerId((p))])+ "|r" + " " + GetObjectName('n05G')+ " " + R2S((KGX -TQ[GetPlayerId(p)])/ 60)+ " " + GetObjectName('N05F'))
				call DisplayTimedTextToAllPlayer(ScourgeForce, 15, GetObjectName('n05O')+ " |cff99ccff-kickafk " + I2S(GetPlayerId(p))+ " |r " + GetObjectName('n05P'))
				call DisplayTimedTextToAllPlayer(ScourgeForce, 15, " ")
			endif
			set i = i + 1
		endloop
	endif
	set p = null
	return false
endfunction
function ELR takes nothing returns boolean
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local integer id = GetIssuedOrderId()
	local player p2
	if p != SentinelPlayers[0]and p != ScourgePlayers[0] then
		set SQ[GetPlayerId(p)]= SQ[GetPlayerId(p)] + 1
		if id != 851983 then
			set TQ[GetPlayerId(p)]= GetGameTime()
			set GRV[GetPlayerId(p)]= false
		endif
		if (id == 851983 or id ==851971) and GetOrderTargetItem()!= null then
			if id == 851983 or(id ==851971 and LoadBoolean(HY, GetHandleId(GetItemPlayer(GetOrderTargetItem())), 139)) then
				set p2 = GetItemPlayer(GetOrderTargetItem())
				if p2 != p and IsPlayerEnemy(p2, p) == false and IsOfflinePlayer(p2) == false and IsPointInRegion(KK, GetItemX(GetOrderTargetItem()), GetItemY(GetOrderTargetItem())) then
					call DisableTrigger(GetTriggeringTrigger())
					call EXStopUnit(u)
					call InterfaceErrorForPlayer(p, GetObjectName('n0G7'))
					call EnableTrigger(GetTriggeringTrigger())
				endif
			endif
		endif
	endif
	set u = null
	return false
endfunction
function EMR takes nothing returns boolean
	return IsUnitMessenger(GetFilterUnit()) and GetOwningPlayer(GetFilterUnit()) == GetTriggerPlayer()
endfunction
function EPR takes nothing returns nothing
	local group g = AllocationGroup(108)
	call GroupEnumUnitsInRange(g, 0, 0, 12000, Condition(function EMR))
	call DeallocateGroup(g)
	set g = null
endfunction
function EQR takes string s returns nothing
	call StopMusic(true)
	call PlayMusic(s)
endfunction
function Y5O takes nothing returns nothing
	local string s = GetEventPlayerChatString()
	local integer X1X = GetRandomInt(1, GAV)
	if LocalPlayer== GetTriggerPlayer() then
		if s == "-music off"then
			call StopMusic(false)
		elseif s == "-music random"then
			call EQR(GIV[X1X])
		elseif s == "-music nightelf1"then
			call EQR(QC)
		elseif s == "-music nightelf2"then
			call EQR(UC)
		elseif s == "-music nightelf3"then
			call EQR(V1)
		elseif s == "-music human1"then
			call EQR(XC)
		elseif s == "-music human2"then
			call EQR(YC)
		elseif s == "-music human3"then
			call EQR(JC)
		elseif s == "-music orc1"then
			call EQR(BD)
		elseif s == "-music orc2"then
			call EQR(DD)
		elseif s == "-music orc3"then
			call EQR(ED)
		elseif s == "-music undead1"then
			call EQR(IE)
		elseif s == "-music undead2"then
			call EQR(OE)
		elseif s == "-music undead3"then
			call EQR(AE)
		elseif s == "-music other1"then
			call EQR(FD)
		elseif s == "-music other2"then
			call EQR(GD)
		elseif s == "-music other3"then
			call EQR(HD)
		elseif s == "-music other4"then
			call EQR(ZD)
		elseif s == "-music other5"then
			call EQR(VD)
		elseif s == "-music other6"then
			call EQR(DF)
		elseif s == "-music other7"then
			call EQR(EF)
		elseif s == "-music other8"then
			call EQR(FF)
		elseif s == "-music other9"then
			call EQR(GF)
		elseif s == "-music special"then
			call EQR(GNV)
		else
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n0CW')+ " ")
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "off, random, nightelf1, nightelf2, nightelf3, human1, human2, human3, orc1, orc2, orc3, undead1, undead2, undead3, other1, other2, other3, other4, other5, other6, other7, other8, other9, special")
		endif
	endif
endfunction
function ESR takes nothing returns boolean
	set GAV = GAV + 1
	set GIV[GAV]= QC
	set GAV = GAV + 1
	set GIV[GAV]= UC
	set GAV = GAV + 1
	set GIV[GAV]= V1
	set GAV = GAV + 1
	set GIV[GAV]= XC
	set GAV = GAV + 1
	set GIV[GAV]= YC
	set GAV = GAV + 1
	set GIV[GAV]= JC
	set GAV = GAV + 1
	set GIV[GAV]= BD
	set GAV = GAV + 1
	set GIV[GAV]= DD
	set GAV = GAV + 1
	set GIV[GAV]= ED
	set GAV = GAV + 1
	set GIV[GAV]= IE
	set GAV = GAV + 1
	set GIV[GAV]= OE
	set GAV = GAV + 1
	set GIV[GAV]= AE
	set GAV = GAV + 1
	set GIV[GAV]= FD
	set GAV = GAV + 1
	set GIV[GAV]= GD
	set GAV = GAV + 1
	set GIV[GAV]= HD
	set GAV = GAV + 1
	set GIV[GAV]= ZD
	set GAV = GAV + 1
	set GIV[GAV]= VD
	set GAV = GAV + 1
	set GIV[GAV]= DF
	set GAV = GAV + 1
	set GIV[GAV]= EF
	set GAV = GAV + 1
	set GIV[GAV]= FF
	set GAV = GAV + 1
	set GIV[GAV]= GF
	set GAV = GAV + 1
	set GIV[GAV]= GNV
	return false
endfunction
function ETR takes player p, integer r, integer g, integer b, integer a returns nothing
	if LocalPlayer== p then
		call SetWaterBaseColor(r, g, b, a)
	endif
endfunction
function EUR takes string s returns nothing
	local string EWR = ""
	local string EYR = ""
	local string EZR = ""
	local integer i = 0
	local integer H0X = StringLength(s)
	local integer E_R = 1
	loop
	exitwhen i > H0X
		if SubString(s, i, i + 1) == " "then
			set E_R = E_R + 1
		else
			if E_R == 1 then
				set EWR = EWR + SubString(s, i, i + 1)
			elseif E_R == 2 then
				set EYR = EYR + SubString(s, i, i + 1)
			else
				set EZR = EZR + SubString(s, i, i + 1)
			endif
		endif
		set i = i + 1
	endloop
	set GCV = S2I(EWR)
	set GDV = S2I(EYR)
	set GFV = S2I(EZR)
endfunction
function Y6O takes nothing returns nothing
	local string E0R = SubString(GetEventPlayerChatString(), 7, StringLength(GetEventPlayerChatString()))
	local player p = GetTriggerPlayer()
	local integer r
	local integer g
	local integer b
	set GBV[GetPlayerId(p)]= true
	if E0R == "red"then
		call ETR(p, 255, 0, 0, 255)
	elseif E0R == "blue"then
		call ETR(p, 0, 0, 255, 255)
	elseif E0R == "green"then
		call ETR(p, 0, 255, 0, 255)
	elseif E0R == "default"then
		call ETR(p, 0, 0, 255, 255)
	elseif E0R == "random"then
		set r = GetRandomInt(0, 255)
		set g = GetRandomInt(0, 255)
		set b = GetRandomInt(0, 255)
		call ETR(p, r, g, b, 255)
		call DisplayTimedTextToPlayer(p, 0, 0, 5, GetObjectName('n0HD')+ " r=" + I2S(r)+ " g=" + I2S(g)+ " b=" + I2S(b))
	else
		call EUR(E0R)
		set r = GCV
		set g = GDV
		set b = GFV
		if r == 0 and g == 0 and b == 0 and E0R != "0 0 0"then
			return
		endif
		if r >= 0 and r <= 255 and g >= 0 and g <= 255 and b >= 0 and b <= 255 then
			call ETR(p, r, g, b, 255)
		endif
	endif
	set p = null
endfunction
function E1R takes nothing returns boolean
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., "额外经验/金钱加成总计：" + I2S(PlayerExpBonus[GetPlayerId(GetTriggerPlayer())])+ "/" + I2S(PlayerGoldBonus[GetPlayerId(GetTriggerPlayer())]))
	return false
endfunction
function E2R takes player p returns nothing
	local unit trigUnit = Player__Hero[GetPlayerId(p)]
	local integer i = GetUnitAbilityLevel(trigUnit,'A0CQ')-1
	local integer E3R = 0
	local integer level = GetUnitAbilityLevel(trigUnit,'A0BR')
	if level == 1 then
		set E3R = 12
	elseif level == 2 then
		set E3R = 20
	elseif level == 3 then
		set E3R = 28
	elseif level == 4 then
		set E3R = 36
	endif
	set i = IMaxBJ(IMinBJ(i, E3R), 0)
	if IsPlayerHasSkill(p, 318) and i > 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0KE')+ " " + I2S(i)+ "/" + I2S(E3R))
	endif
	set trigUnit = null
endfunction
function E4R takes nothing returns boolean
	local player p = GetTriggerPlayer()
	local integer pid = GetPlayerId(p)
	local integer h = GetHandleId(p)
	local integer i
	local integer k
	if HGV > 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0LO')+ ": " + I2S(HGV))
	endif
	if LoadInteger(OtherHashTable, h,'DUEL')> 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., "决斗: " + I2S(LoadInteger(OtherHashTable, h,'DUEL'))+ " 次胜利, " + I2S(LoadInteger(OtherHashTable, h,'DDUE'))+ " 点攻击力")
	endif
	if LoadInteger(ObjectHashTable, h,'A0O3')> 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0GQ')+ " " + I2S(LoadInteger(ObjectHashTable, h,'A0O3')))
	endif
	set i = LoadInteger(OtherHashTable, h,'ARRH')
	set k = LoadInteger(OtherHashTable, h,'ARRS')
	if k > 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0GM')+ " " + R2S(I2R(i)/ I2R(k)* 100 )+ "% (" + I2S(i)+ "/" + I2S(k)+ ")")
	endif
	if LoadInteger(OtherHashTable, pid,'MC_T')> 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0JH')+ " " + I2S(LoadInteger(OtherHashTable, pid,'MC_T')))
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0JM')+ " " + I2S(LoadInteger(OtherHashTable, pid,'MC_2')+ LoadInteger(OtherHashTable, pid,'MC_3')+ LoadInteger(OtherHashTable, pid,'MC_4'))+ " (" + I2S((LoadInteger(OtherHashTable, pid,'MC_2')+ LoadInteger(OtherHashTable, pid,'MC_3')+ LoadInteger(OtherHashTable, pid,'MC_4'))* 100 / LoadInteger(OtherHashTable, pid,'MC_T'))+ "%)")
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0JL')+ " " + I2S(LoadInteger(OtherHashTable, pid,'MC_2'))+ " (" + I2S( 100 * LoadInteger(OtherHashTable, pid,'MC_2')/ LoadInteger(OtherHashTable, pid,'MC_T'))+ "%)")
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0JK')+ " " + I2S(LoadInteger(OtherHashTable, pid,'MC_3'))+ " (" + I2S( 100 * LoadInteger(OtherHashTable, pid,'MC_3')/ LoadInteger(OtherHashTable, pid,'MC_T'))+ "%)")
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0JJ')+ " " + I2S(LoadInteger(OtherHashTable, pid,'MC_4'))+ " (" + I2S( 100 * LoadInteger(OtherHashTable, pid,'MC_4')/ LoadInteger(OtherHashTable, pid,'MC_T'))+ "%)")
	endif
	if JZV[pid]> 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0HM')+ " " + I2S(JZV[pid]))
	endif
	call E2R(p)
	if LoadInteger(ObjectHashTable, GetHandleId(Player__Hero[pid]),'A06D')> 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., "腐肉堆积祭品数: " + I2S(SI[pid]))
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n09R')+ " " + I2S(LoadInteger(ObjectHashTable, GetHandleId(Player__Hero[pid]),'A06D'))+ " " + GetObjectName('n09S'))
	endif
	set i = LoadInteger(OtherHashTable, h,'HK_H')
	set k = LoadInteger(OtherHashTable, h,'HK_T')
	if k > 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0EL')+ " " + R2S(I2R(i)/ I2R(k)* 100 )+ "% (" + I2S(i)+ "/" + I2S(k)+ ")")
	endif
	if HHV[pid]> 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10, "通过追踪术获得的额外金钱: " + I2S(HHV[pid]))
	endif
	return false
endfunction
function E5R takes player p1 returns string
	local string s = GetObjectName('n0GB')
	set s = StringReplace(s, "$c1", "|c00ff0303")
	set s = StringReplace(s, "$p1", PlayersColoerText[GetPlayerId(p1)] +(PlayersName[GetPlayerId((p1))])+ "|r")
	return s
endfunction
function E6R takes nothing returns string
	local string s = GetObjectName('n0GA')
	set s = StringReplace(s, "$c1", "|c006699CC")
	set s = StringReplace(s, "$c2", "|c00ff0303")
	return s
endfunction
function E7R takes nothing returns nothing
	local integer i = 1
	local unit trigUnit
	if MK then
		loop
		exitwhen i > 5
			set trigUnit = Player__Hero[GetPlayerId(SentinelPlayers[i])]
			if trigUnit != null then
				if LK == 2 then
					call JKX(trigUnit)
				endif
				call UnitSetUsesAltIcon(trigUnit, false)
			endif
			set trigUnit = Player__Hero[GetPlayerId(ScourgePlayers[i])]
			if trigUnit != null then
				if LK == 2 then
					call JKX(trigUnit)
				endif
				call UnitSetUsesAltIcon(trigUnit, false)
			endif
			set i = i + 1
		endloop
		set trigUnit = null
	endif
endfunction
function E8R takes player p1, player p2 returns string
	local string s = GetObjectName('n0G2')
	set s = StringReplace(s, "$c1", "|c006699CC")
	set s = StringReplace(s, "$c1", "|c006699CC")
	set s = StringReplace(s, "$c1", "|c006699CC")
	set s = StringReplace(s, "$c1", "|c006699CC")
	set s = StringReplace(s, "$c2", "|c00ff0303")
	set s = StringReplace(s, "$c2", "|c00ff0303")
	set s = StringReplace(s, "$p1", PlayersColoerText[GetPlayerId(p1)] +(PlayersName[GetPlayerId((p1))])+ "|r")
	set s = StringReplace(s, "$p2", PlayersColoerText[GetPlayerId(p2)] +(PlayersName[GetPlayerId((p2))])+ "|r")
	return s
endfunction
function E9R takes string XVR, string XER returns string
	local string s = GetObjectName('n0FV')
	set s = StringReplace(s, "$c1", "|c006699CC")
	set s = StringReplace(s, "$c1", "|c006699CC")
	set s = StringReplace(s, "$c1", "|c006699CC")
	set s = StringReplace(s, "$c1", "|c006699CC")
	set s = StringReplace(s, "$p1", XVR)
	set s = StringReplace(s, "$p2", XER)
	return s
endfunction
function XXR takes player p2 returns string
	local string s = GetObjectName('n0FS')
	set s = StringReplace(s, "$p2", PlayersColoerText[GetPlayerId(p2)] +(PlayersName[GetPlayerId((p2))])+ "|r")
	set s = StringReplace(s, "$c1", "|c006699CC")
	return s
endfunction
function XOR takes player p returns nothing
	local integer loop_i
	local integer loop_max
	if (IsSentinelPlayer(p)) then
		set loop_i = 1
		set loop_max = 5
		loop
		exitwhen loop_i > loop_max
			if (SentinelPlayers[loop_i]!= p) then
				if (IsPlayingPlayer(SentinelPlayers[loop_i])) then
					call SetPlayerAllianceStateBJ(p, SentinelPlayers[loop_i], 4)
				endif
			endif
			set loop_i = loop_i + 1
		endloop
	else
		set loop_i = 1
		set loop_max = 5
		loop
		exitwhen loop_i > loop_max
			if (ScourgePlayers[loop_i]!= p) then
				if (IsPlayingPlayer(ScourgePlayers[loop_i])) then
					call SetPlayerAllianceStateBJ(p, ScourgePlayers[loop_i], 4)
				endif
			endif
			set loop_i = loop_i + 1
		endloop
	endif
endfunction
function XRR takes nothing returns nothing
	if GetOwningPlayer(GetEnumUnit()) == FM then
		call SetUnitOwner(GetEnumUnit(), GM, true)
	elseif GetOwningPlayer(GetEnumUnit()) == GM then
		call SetUnitOwner(GetEnumUnit(), FM, true)
	endif
endfunction
function XIR takes unit u, player p returns nothing
	local real x1
	local real y1
	local real x2
	local real y2
	local integer i
	local item C1X
	if IsSentinelPlayer(p) then
		set x1 = GetRectCenterX(gg_rct_ScourgeRevivalPoint)
		set y1 = GetRectCenterY(gg_rct_ScourgeRevivalPoint)
		set x2 = GetRectCenterX(gg_rct_SentinelRevivalPoint)
		set y2 = GetRectCenterY(gg_rct_SentinelRevivalPoint)
	else
		set x1 = GetRectCenterX(gg_rct_SentinelRevivalPoint)
		set y1 = GetRectCenterY(gg_rct_SentinelRevivalPoint)
		set x2 = GetRectCenterX(gg_rct_ScourgeRevivalPoint)
		set y2 = GetRectCenterY(gg_rct_ScourgeRevivalPoint)
	endif
	call SetUnitX(u, x1)
	call SetUnitY(u, y1)
	if IsUnitMessenger(u) then
		call IssueImmediateOrderById(u, 852246)
	endif
	if IsUnitType(u, UNIT_TYPE_HERO) then
		call SaveBoolean(HY,(GetHandleId(u)), 140,(true))
		call SaveInteger(HY,(GetHandleId((u))),(4259), 2)
		call UnitRemoveAbility(u,'A04R')
		call SetUnitInvulnerable(u, false)
		call PauseUnit(u, false)
		set i = 0
		loop
		exitwhen i > 5
			set C1X = UnitItemInSlot(u, i)
			if GetUnitTypeId(u)!='H00J' and C1X != null and(GetItemPlayer(C1X)!= GetOwningPlayer(u) and GetItemIndexEx(C1X)!= ASV and GetItemIndexEx(C1X)!= ATV) and GetItemTypeId(C1X)!= XOV[AIV] then
				call UnitRemoveItem(u, C1X)
			endif
			set i = i + 1
		endloop
	endif
	call SetUnitX(u, x2)
	call SetUnitY(u, y2)
	call SetUnitColor(u, GetPlayerColor(p))
	set C1X = null
endfunction
function XAR takes nothing returns boolean
	if IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) or IsUnitMessenger(GetFilterUnit()) then
		call XIR(GetFilterUnit(), WM)
	elseif GetUnitTypeId(GetFilterUnit())=='ncop' then
		call IssueImmediateOrderById(GetFilterUnit(), 852246)
	elseif GetUnitTypeId(GetFilterUnit())=='u00B' then
		return true
	endif
	return false
endfunction
function XNR takes item i, player p returns nothing
	local real x
	local real y
	if IsSentinelPlayer(p) then
		set x = GetRectCenterX(gg_rct_SentinelRevivalPoint)
		set y = GetRectCenterY(gg_rct_SentinelRevivalPoint)
	else
		set x = GetRectCenterX(gg_rct_ScourgeRevivalPoint)
		set y = GetRectCenterY(gg_rct_ScourgeRevivalPoint)
	endif
	call SetItemPosition(i, x, y)
endfunction
function XBR takes nothing returns nothing
	if GetItemPlayer(GetEnumItem()) == WM then
		call XNR(GetEnumItem(), WM)
	endif
endfunction
function XCR takes player p1, player p2 returns nothing
	local group g1 = AllocationGroup(109)
	local group g2 = AllocationGroup(110)
	set WM = p1
	set E3 = p2
	call GroupEnumUnitsOfPlayer(g1, p1, Condition(function XAR))
	set WM = p2
	set E3 = p1
	call GroupEnumUnitsOfPlayer(g2, p2, Condition(function XAR))
	call ForGroup(g1, function XRR)
	call ForGroup(g2, function XRR)
	set WM = p1
	call EnumItemsInRect(GetWorldBounds(), null, function XBR)
	set WM = p2
	call EnumItemsInRect(GetWorldBounds(), null, function XBR)
	call DeallocateGroup(g1)
	call DeallocateGroup(g2)
	set g1 = null
	set g2 = null
endfunction
function XDR takes player p1, player p2 returns nothing
	local integer x
	local integer y
	local integer i
	local integer i1
	local integer i2
	local real x1
	local real y1
	local real x2
	local real y2
	local player p
	local string XVR = PlayersColoerText[GetPlayerId(p1)] +(PlayersName[GetPlayerId((p1))])+ "|r"
	local string XER = PlayersColoerText[GetPlayerId(p2)] +(PlayersName[GetPlayerId((p2))])+ "|r"
	local integer ZZO
	local integer XFR
	local integer XGR
	set ZZO = PlayersReliableGold[GetPlayerId(p1)]
	set PlayersReliableGold[GetPlayerId(p1)]= PlayersReliableGold[GetPlayerId(p2)]
	set PlayersReliableGold[GetPlayerId(p2)]= ZZO
	call StoreDrCacheData("SWITCH_" + I2S(GetPlayerId(p1))+ "_" + I2S(GetPlayerId(p2)), 0)
	call StoreDrCacheData("SWITCH_" + I2S(GetPlayerId(p2))+ "_" + I2S(GetPlayerId(p1)), 0)
	if IsSentinelPlayer(p1) then
		set x1 = GetRectCenterX(gg_rct_ScourgeRevivalPoint)
		set y1 = GetRectCenterY(gg_rct_ScourgeRevivalPoint)
	else
		set x1 = GetRectCenterX(gg_rct_SentinelRevivalPoint)
		set y1 = GetRectCenterY(gg_rct_SentinelRevivalPoint)
	endif
	if IsSentinelPlayer(p2) then
		set x2 = GetRectCenterX(gg_rct_ScourgeRevivalPoint)
		set y2 = GetRectCenterY(gg_rct_ScourgeRevivalPoint)
	else
		set x2 = GetRectCenterX(gg_rct_SentinelRevivalPoint)
		set y2 = GetRectCenterY(gg_rct_SentinelRevivalPoint)
	endif
	set i = 1
	loop
	exitwhen i > 5
		if SentinelPlayers[i]== p1 or ScourgePlayers[i]== p1 then
			set i1 = i
		endif
		if SentinelPlayers[i]== p2 or ScourgePlayers[i]== p2 then
			set i2 = i
		endif
		set i = i + 1
	endloop
	if IsSentinelPlayer(p1) then
		set ScourgePlayers[i2]= p1
		set SentinelPlayers[i1]= p2
	else
		set SentinelPlayers[i2]= p1
		set ScourgePlayers[i1]= p2
	endif
	call SetPlayerTeam(SentinelPlayers[0], 0)
	call SetPlayerTeam(SentinelPlayers[1], 0)
	call SetPlayerTeam(SentinelPlayers[2], 0)
	call SetPlayerTeam(SentinelPlayers[3], 0)
	call SetPlayerTeam(SentinelPlayers[4], 0)
	call SetPlayerTeam(SentinelPlayers[5], 0)
	call SetPlayerTeam(ScourgePlayers[0], 1)
	call SetPlayerTeam(ScourgePlayers[1], 1)
	call SetPlayerTeam(ScourgePlayers[2], 1)
	call SetPlayerTeam(ScourgePlayers[3], 1)
	call SetPlayerTeam(ScourgePlayers[4], 1)
	call SetPlayerTeam(ScourgePlayers[5], 1)
	call K_X()
	set x = 0
	set y = 0
	loop
	exitwhen x > 5
		loop
		exitwhen y > 5
			call SetPlayerAllianceStateBJ(SentinelPlayers[x], SentinelPlayers[y], 3)
			call SetPlayerAllianceStateBJ(ScourgePlayers[x], ScourgePlayers[y], 3)
			call SetPlayerAllianceStateBJ(SentinelPlayers[x], ScourgePlayers[y], 0)
			call SetPlayerAllianceStateBJ(ScourgePlayers[x], SentinelPlayers[y], 0)
			set y = y + 1
		endloop
		set y = 0
		set x = x + 1
	endloop
	call ForceClear(SentinelForce)
	call ForceClear(ScourgeForce)
	call ForceAddPlayer(SentinelForce, SentinelPlayers[0])
	call ForceAddPlayer(SentinelForce, SentinelPlayers[1])
	call ForceAddPlayer(SentinelForce, SentinelPlayers[2])
	call ForceAddPlayer(SentinelForce, SentinelPlayers[3])
	call ForceAddPlayer(SentinelForce, SentinelPlayers[4])
	call ForceAddPlayer(SentinelForce, SentinelPlayers[5])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[0])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[1])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[2])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[3])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[4])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[5])
	call ExecuteFunc("K1X")
	call XCR(p1, p2)
	set YM = true
	if JP == null then
		call PanCameraToTimedForPlayer(p1, x1, y1, 0)
		call PanCameraToTimedForPlayer(p2, x2, y2, 0)
	endif
	call KZX()
	set BM = false
	if XM != null then
		call TriggerEvaluate(XM)
	endif
	if GetPlayerSlotState(p2) == PLAYER_SLOT_STATE_EMPTY then
		set PlayersName[GetPlayerId(p2)]= GetPlayerName(p2)
		set VPV[i]= StringHash(PlayersName[GetPlayerId(p2)])
	endif
	set i = 1
	loop
	exitwhen i > 5
		set p = SentinelPlayers[i]
		if IsOfflinePlayer(p) then
			call XOR(p)
		endif
		set p = ScourgePlayers[i]
		if IsOfflinePlayer(p) then
			call XOR(p)
		endif
		set i = i + 1
	endloop
	// 设置单位的RGB?
	call E7R()
	call JIO()
	call ClearTextMessages()
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 20, " ")
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 20, E9R(XVR, XER))
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 20, " ")
	call KQX(p1)
	call KQX(p2)
	set XFR = YUE(GetPlayerId(p1))
	set XGR = YUE(GetPlayerId(p2))
	set ZZO = ZL[XFR]
	set ZL[XFR]= ZL[XGR]
	set ZL[XGR]= ZZO
	set RM[GetPlayerId(p1)]= false
	set RM[GetPlayerId(p2)]= false
	if JP != null then
		call QAX()
	endif
	set p = null
endfunction
function XHR takes nothing returns nothing
	local integer i = 1
	local player p
	set JM = 0
	set KM = 0
	loop
	exitwhen i > 5
		set p = SentinelPlayers[i]
		if IsPlayingPlayer(p) then
			set KM = KM + 1
			if HM[GetPlayerId(p)] then
				set JM = JM + 1
			endif
		endif
		set p = ScourgePlayers[i]
		if IsPlayingPlayer(p) then
			set KM = KM + 1
			if HM[GetPlayerId(p)] then
				set JM = JM + 1
			endif
		endif
		set i = i + 1
	endloop
	set p = null
endfunction
function XJR takes nothing returns nothing
	set BM = false
	if XM != null then
		call TriggerEvaluate(XM)
	endif
	call ClearTextMessages()
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 20, E5R(GetTriggerPlayer()))
endfunction
function XKR takes nothing returns nothing
	local integer i = 1
	local player p
	local integer XLR = 0
	local integer XMR = 0
	local integer XPR = 0
	if HM[GetPlayerId(GetTriggerPlayer())]== false then
		set HM[GetPlayerId(GetTriggerPlayer())]= true
		call XHR()
		call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 20, PlayersColoerText[GetPlayerId(GetTriggerPlayer())] +(PlayersName[GetPlayerId((GetTriggerPlayer()))])+ "|r|c006699CC " + GetObjectName('n0FT')+ "|r (" + I2S(JM)+ "/" + I2S(KM)+ ")")
	endif
	loop
	exitwhen i > 5
		set p = SentinelPlayers[i]
		if IsPlayingPlayer(p) and HM[GetPlayerId(p)]== false then
			set XLR = XLR + 1
			set XPR = XPR + 1
		endif
		if IsPlayingPlayer(p) and HM[GetPlayerId(p)] then
			set XMR = XMR + 1
			set XPR = XPR + 1
		endif
		set p = ScourgePlayers[i]
		if IsPlayingPlayer(p) and HM[GetPlayerId(p)]== false then
			set XLR = XLR + 1
			set XPR = XPR + 1
		endif
		if IsPlayingPlayer(p) and HM[GetPlayerId(p)] then
			set XMR = XMR + 1
			set XPR = XPR + 1
		endif
		set i = i + 1
	endloop
	if XLR < 2 and XMR >= R2I(XPR / 2) then
		if (XPR == 2 and XMR > 1) or XPR != 2 then
			call XDR(FM, GM)
		endif
	endif
	set p = null
endfunction
function XQR takes nothing returns nothing
	local integer i = 1
	local player p = GetTriggerPlayer()
	local player XSR
	local string s
	local string s2
	loop
	exitwhen i > 5
		set s = ""
		set s2 = ""
		if IsSentinelPlayer(p) then
			set XSR = ScourgePlayers[i]
		else
			set XSR = SentinelPlayers[i]
		endif
		if GetPlayerSlotState(XSR) == PLAYER_SLOT_STATE_LEFT and GetPlayerController(XSR) == MAP_CONTROL_USER then
			set s = "|c00ff0303[" + GetObjectName('n0FY')+ "]|r"
		endif
		if Player__Hero[GetPlayerId(XSR)]!= null then
			set s2 = " (" + GetUnitName(Player__Hero[GetPlayerId(XSR)])+ ")"
		endif
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15, GetObjectName('n083')+ "|c006699CC " + "-switch " + I2S(i)+ "|r " + GetObjectName('n0FQ')+ " " + PlayersColoerText[GetPlayerId(XSR)] +(PlayersName[GetPlayerId((XSR))])+ s2 + "|r " + s)
		set i = i + 1
	endloop
	set p = null
endfunction
function XTR takes nothing returns boolean
	local integer i = 0
	if BM then
		call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 20, "|c00ff0303" + GetObjectName('n0FU')+ "|r")
	endif
	set F1V = true
	set BM = false
	set FM = null
	set GM = null
	loop
	exitwhen i > 16
		set HM[i]= false
		set i = i + 1
	endloop
	call CleanCurrentTrigger(GetTriggeringTrigger())
	set XM = null
	return false
endfunction
function XUR takes player p1, player p2 returns nothing
	local trigger t = CreateTrigger()
	local integer i = 0
	local string s
	local string J1O
	local string msg2
	local string msg3
	local player p
	local string s2
	set F1V = false
	set BM = true
	set FM = p1
	set GM = p2
	loop
	exitwhen i > 16
		set HM[i]= false
		set i = i + 1
	endloop
	set HM[GetPlayerId(FM)]= true
	call TriggerRegisterTimerEvent(t, 60, false)
	call TriggerAddCondition(t, Condition(function XTR))
	set XM = t
	set s = E8R(p1, p2)
	set s2 = E6R()
	set i = 1
	loop
	exitwhen i > 5
		set p = SentinelPlayers[i]
		if p != p1 then
			call DisplayTimedTextToPlayer(p, 0, 0, 20, s)
			call DisplayTimedTextToPlayer(p, 0, 0, 20, s2)
		endif
		set p = ScourgePlayers[i]
		if p != p1 then
			call DisplayTimedTextToPlayer(p, 0, 0, 20, s)
			call DisplayTimedTextToPlayer(p, 0, 0, 20, s2)
		endif
		set i = i + 1
	endloop
	set s = XXR(p2)
	call DisplayTimedTextToPlayer(p1, 0, 0, 20, s)
	set t = null
	set p = null
endfunction
function Y8O takes nothing returns nothing
	if YS == false then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n0GX'))
		return
	endif
	if GetEventPlayerChatString() == "-switch accept"or GetEventPlayerChatString() == "-ok"then
		if BM then
			call XKR()
		endif
	elseif GetEventPlayerChatString() == "-no"then
		if BM then
			call XJR()
		endif
	elseif GetEventPlayerChatString() == "-switch"then
		if BM == false then
			call XQR()
		endif
	elseif BM == false then
		set VM = S2I(SubString(GetEventPlayerChatString(), 8, StringLength(GetEventPlayerChatString())))
		if VM > 0 and VM < 6 then
			if IsSentinelPlayer(GetTriggerPlayer()) then
				if F0V[GetPlayerId(ScourgePlayers[VM])]== false then
					call XUR(GetTriggerPlayer(), ScourgePlayers[VM])
				else
					call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n0HY'))
				endif
			else
				if F0V[GetPlayerId(SentinelPlayers[VM])]== false then
					call XUR(GetTriggerPlayer(), SentinelPlayers[VM])
				else
					call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n0HY'))
				endif
			endif
		endif
	endif
endfunction
function XWR takes nothing returns nothing
	call SetUnitAnimation(Player__Hero[GetPlayerId(GetTriggerPlayer())], "sleep")
endfunction
function XYR takes nothing returns nothing
	call SetUnitAnimationByIndex(Player__Hero[GetPlayerId(GetTriggerPlayer())], 23)
endfunction
function XZR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer i = 1
	local player p
	loop
		set p = Player(i)
		if XD[i]== false then
			call DisplayTimedTextToPlayer(p, 0, 0, 15, "|c006699CC提示：你可以输入 -SP(-SPCD)来隐藏被动技能,技能仍然可被正常使用和升级）|r")
		endif
		set i = i + 1
	exitwhen i > 11
	endloop
	call DestroyTimer(t)
	set t = null
endfunction
function X_R takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer i = 1
	local player p
	loop
		set p = Player(i)
		if IsPlayersEnableSkillInfo[i]== false then
			call DisplayTimedTextToPlayer(p, 0, 0, 15, "|c006699CC提示：你可以输入 -SI 来查看队友技能|r")
		endif
		set i = i + 1
	exitwhen i > 11
	endloop
	call DestroyTimer(t)
	set t = null
endfunction
function X0R takes nothing returns nothing
	local trigger t
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerAddCondition(t, Condition(function MRO))
	set NK = CreateTimer()
	if IsPickingHero then
		if MainModeName =="sd" then
			set N3 = KL +(ExtraSkillsNumber * 30)
		elseif MainModeName =="md" then
			set N3 = LL +(ExtraSkillsNumber * 30)
		elseif MainModeName =="ap" then
			set N3 = JL +(ExtraSkillsNumber * 30)
		else
			set N3 = 90
		endif
		if Mode__RandomExtraAbilities then
			set N3 = N3 -(ExtraSkillsNumber * 30)
		endif
	else
		if MainModeName =="rd"then
			set N3 = ML
		else
			set N3 = 90
		endif
	endif
	call TimerStart(NK, N3 + 1, false, function SMO)
	set Q3V[1]= false
	set Q3V[2]= false
	set Q3V[3]= false
	if VT == false and ET == false then
		call ExecuteFunc("X1R")
	endif
	set t = null
endfunction
function X2R takes integer WTV returns boolean
	return WTV =='A0FW' or WTV =='A0GP' or WTV =='A1EL' or WTV =='A2BE' or WTV =='A1S4' or WTV =='A020' or WTV =='A02Z'
endfunction
function X3R takes unit u, integer WTV returns nothing
	local integer WFV = GetHandleId(u)
	local boolean b = LoadBoolean(ObjectHashTable, WFV, WTV)
	call SaveBoolean(ObjectHashTable, WFV, WTV, b == false)
endfunction
function X4R takes integer WTV returns boolean
	if X2R(WTV) then
		return LoadBoolean(ObjectHashTable, GetHandleId(GetTriggerUnit()), WTV)
	endif
	return true
endfunction
function X5R takes integer x returns boolean
	return x =='A3FJ' or x =='QM01' or x =='A0JT' or x =='A2TH' or x =='A0DI' or x =='A231' or x =='A1ZH' or x =='A1ZI' or x =='A1ZW' or x =='A28D' or x =='A2KG' or x =='A2K3' or x =='A2EA' or x =='A2K1' or x =='A2K4' or x =='A2K7' or x =='A06X' or x =='A0AQ' or x =='A14O' or x =='A0NE' or x =='A1C0' or x =='A418' or x =='A0K7' or x =='A1AC' or x =='A1QD' or x =='A0JL' or x =='AIpg' or x =='A11F' or x =='A0T9' or x =='A1T7' or x =='AIcy' or x =='A19M' or x =='A02O' or x =='A0FD' or x =='AChx' or x =='A1EW' or x =='A332' or x =='A2N1' or x =='A590' or x =='A591' or x =='A592' or x =='A593' or x =='A02Z' or x =='A0GC' or x =='A3UH' or x =='A3W8'
endfunction
function X6R takes integer id returns boolean
	return id =='A40K' or id =='A40L' or id =='A40M' or id =='A40N' or id =='A590' or id =='A591' or id =='A592' or id =='A593'
endfunction
function X7R takes integer WTV returns boolean
	return WTV =='A02Z'
endfunction
function X8R takes integer WTV returns boolean
	return WTV != 0 and X4R(WTV) and IsAttackSpecialEffects(WTV) == false and X5R(WTV) == false and LNX(WTV) == false and IsNotItemAbility(WTV) and GetUnitAbilityLevel(GetTriggerUnit(),'A04R') == 0 and X6R(WTV) == false and X7R(WTV) == false
endfunction

function X9R takes integer WWV, integer abilityId returns boolean
	local integer SQV
	if abilityId == 0 then
		return false
	endif
	// 如果 存了不能多重 并且另外个不能多重? 是攻击特效技能 是物品技能 那就返回
	if LoadBoolean(AbilityDataHashTable,'MCRS', abilityId) or X5R(abilityId) or IsAttackSpecialEffects(abilityId) or not IsNotItemAbility(abilityId) or X6R(abilityId) then
		return false
	endif
	set SQV = ZME(WWV, abilityId)
	if SQV != 0 then
		// 如果是变身 或者 灼热之箭类技能 就返回
		if CheckAbilityIdFormIndex(SQV,-1, "metamorphosis", null) then
			return false
		elseif CheckAbilityIdFormIndex(SQV,-1, "arrows", null) then
			return false
		endif
	endif
	return true
endfunction
function OVR takes integer id returns boolean
	return id =='A2T5' or id =='A2TJ' or id =='A2QI' or id =='A43J' or id =='A1A1' or id =='A1B3' or id =='A0QR' or id =='A1DP' or id =='A461' or id =='A46H' or id =='A46J'
endfunction
function OER takes integer WTV returns boolean
	return IsAttackSpecialEffects(WTV) == false and X5R(WTV) == false and LNX(WTV) == false and IsNotItemAbility(WTV) and X6R(WTV) == false
endfunction
function OXR takes integer si returns boolean
	return OVR(si) == false and X5R(si) == false and LNX(si) == false and IsNotItemAbility(si) and si !='A2M0' and si !='A32G' and si !='A32E' and si !='A32D' and si !='A32C' and si !='A32A' and si !='A0ZF'
endfunction
function OOR takes nothing returns nothing
	local integer WWV
	local integer hn
	local integer xx
	local integer id
	set WWV = 0
	if IsObserverPlayer(LocalPlayer) == false then
		call ClearSelection()
	endif
	loop
		if IsObserverPlayer(Player(WWV)) == false then
			call ShowAbilityCd_Actions(Player(WWV), true)
			call Q_X(Player(WWV), true)
			call B4X(Player(WWV))
			call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, "|cff99ccff" + " " + "你的技能:" + "|r")
			set xx = 1
			loop
				set id = PlayerSkillIndex[WWV * HL + xx]
				if id > 600 then
					call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, "	" + GetObjectName(HeroCommonSkills[id])+ "|cffffcc00" + " (" + "Invoker" + ")" + "|r")
				else
					if xx == 4 or xx == 6 then
						call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, "	" + "|c00ff0303" + GetObjectName(HeroCommonSkills[id])+ "|r" + "|cffffcc00" + " (" + GetObjectName(HeroListTypeId[(id + 3)/ 4])+ ")" + "|r")
					else
						call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, "	" + GetObjectName(HeroCommonSkills[id])+ "|cffffcc00" + " (" + GetObjectName(HeroListTypeId[(id + 3)/ 4])+ ")" + "|r")
					endif
				endif
				set xx = xx + 1
			exitwhen xx > 4 + ExtraSkillsNumber
			endloop
			if PP[WWV]== 1 then
				call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, " ")
				call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, "|c00FF0000[LoD]|r|c006699CC" + " " + "你只能选择近战英雄." + "|r")
			elseif PP[WWV]== 2 then
				call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, " ")
				call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, "|c00FF0000[LoD]|r|c006699CC" + " " + "你只能选择远程英雄." + "|r")
			endif
			call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, " ")
			call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, " ")
			call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, "|cff99ccff" + "你现在能选择英雄模型了." + "|r")
			call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, " ")
			call IRX(Player(WWV), "Sound\\Interface\\Rescue.wav")
			call SuspendTimeOfDay(false)
			set hn = 1
			call ZFO(Player(WWV), PP[WWV])
		endif
		set WWV = WWV + 1
	exitwhen WWV > 11
	endloop
endfunction
function ORR takes integer i returns nothing
	local integer k = R2I((I2R(i)+ 3.)/ 4.)
	if k > 151 then
		set k = 151
	endif
	if not(LP[k]) then
		call MDX(k, i)
		set LP[k]= true
	endif
	if HaveSavedString(ObjectHashTable, HeroCommonSkills[i], 600) and LoadBoolean(ObjectHashTable, HeroCommonSkills[i], 600) == false then
		call SaveBoolean(ObjectHashTable, HeroCommonSkills[i], 600, true)
		call ExecuteFunc(LoadStr(ObjectHashTable, HeroCommonSkills[i], 600))
	endif
	if HaveSavedString(ObjectHashTable, HeroCommonSkills[i], 601) and LoadBoolean(ObjectHashTable, HeroCommonSkills[i], 601) == false then
		call SaveBoolean(ObjectHashTable, HeroCommonSkills[i], 601, true)
		call ExecuteFunc(LoadStr(ObjectHashTable, HeroCommonSkills[i], 601))
	endif
endfunction
function OIR takes integer WWV returns nothing
	local integer xx = 1
	loop
		call ORR(PlayerSkillIndex[WWV * HL + xx])
		set xx = xx + 1
	exitwhen xx > 4 + ExtraSkillsNumber
	endloop
endfunction
function OAR takes nothing returns nothing
	call DestroyTimer(GetExpiredTimer())
	set WN = true
endfunction
function ONR takes nothing returns nothing
	local unit u
	set WN = true
	set u = CreateUnit(Player(15),'uC74',-7360  -128,-6388, 270)
	call SetUnitVertexColor(u, 255, 100, 0, 255)
	set u = CreateUnit(Player(15),'uC74', 6724, 6592, 270)
	call SetUnitVertexColor(u, 255, 100, 0, 255)
	set u = null
endfunction
function OBR takes nothing returns nothing
	set Z3 = true
endfunction

function fnDoubleClickSpellTips takes nothing returns nothing
	local timer t = GetExpiredTimer()
	// 没有启用双击施法 并且不是裁判才发
	if not IsEnableDoubleClickSystem and not IsObserverPlayer(LocalPlayer) then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, "|c006699CC提示：你可以输入 -dch来开启双击对己施法(仅适用于游戏内的快捷键)|r")
	endif
	call DestroyTimer(t)
	set t = null
endfunction

function OCR takes nothing returns nothing
	if Mode__FiveSkills or Mode__SixSkills then
		call TimerStart(CreateTimer(), 20 +180, false, function XZR)
	endif
	call TimerStart(CreateTimer(), 20 + 300, false, function X_R)
	call TimerStart(CreateTimer(), 20 + 420, false, function fnDoubleClickSpellTips)
	call TimerStart(CreateTimer(), 15, false, function OBR)
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, "|c00FF0000原图作者:  DracoL1ch & ResQ|r")
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, "|c006699CC汉化作者:  紫心芥蓝|r")
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, "|c006699CC感谢贴吧汉化组|r")
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, "|c006699CC修改者：vcccv|r")
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, " ")
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, "|cFFFF8000OMG ay|r")
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, "|c006699CCtieba.baidu.com/omgay|r")
	call TimerStart(CreateTimer(), 20 +180, false, function OAR)
endfunction
function ODR takes nothing returns nothing
endfunction
function OFR takes nothing returns boolean
	return GetUnitTypeId(GetFilterUnit())=='n00C' or GetUnitTypeId(GetFilterUnit())=='ntav'
endfunction
function OGR takes nothing returns nothing
	call ShowUnit(GetEnumUnit(), true)
endfunction
function OHR takes nothing returns nothing
	call ShowUnit(GetEnumUnit(), false)
endfunction
function OJR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group g = LoadGroupHandle(HY, h, 0)
	call ForGroup(g, function OGR)
	call DeallocateGroup(g)
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set g = null
	set t = null
endfunction
function OKR takes integer pid returns nothing
	local timer t = CreateTimer()
	local group g = AllocationGroup(111)
	call TimerStart(t, 4, false, function OJR)
	call GroupEnumUnitsOfPlayer(g, Player(pid), Condition(function OFR))
	call ForGroup(g, function OHR)
	call SaveGroupHandle(HY, GetHandleId(t), 0, g)
	set g = null
	set t = null
endfunction
function SQO takes nothing returns nothing
	local trigger t
	local integer WWV
	local timer OLR
	if ET then
		return
	endif
	set WWV = 0
	if TimerGetRemaining(NK)> 0 then
		loop
			if T6E(WWV) then
				if not(FP[WWV]) then
					return
				endif
			endif
			set WWV = WWV + 1
		exitwhen WWV > 12
		endloop
	endif
	set GP = true
	set WWV = 0
	loop
		if T6E(WWV) then
			call KillPlayerAllZoneIndicator(Player(WWV))
			call YCE(Player(WWV))
			call OIR(WWV)
		endif
		if bj_isSinglePlayer == false then
			call OKR(WWV)
		endif
		call FlushChildHashtable(HY, GetHandleId(KP[WWV]))
		call RemoveUnit(KP[WWV])
		set WWV = WWV + 1
	exitwhen WWV > 12
	endloop
	call PanCameraToTimed(-6990., 6840., .0)
	call RemoveUnit(HR)
	call RemoveUnit(JR)
	call RemoveUnit(KR)
	call RemoveUnit(LR)
	call RemoveUnit(IR)
	call ODR()
	call DestroyMultiboard(JP)
	call MultiboardDisplay(MainMultiboard, true)
	set BJ_Multiboard = MainMultiboard
	call AddUnitToStock(ScourgeTombOfRelics,'h02C', 2, 4)	//游戏开始时添加贩卖
	call AddUnitToStock(SentinelAncientOfWonders,'h02C', 2, 4)
	call AddUnitToStock(SentinelPigKing,'n139', 0, 3) 		//游戏开始时添加经验书
	call AddUnitToStock(ScourgePigKing,'n139', 0, 3)
	call ClearSelection()
	set IsPickingHero = false
	call DestroyTimer(NK)
	set NK = CreateTimer()
	call TimerStart(NK, 90 + 1, false, null)
	set OLR = CreateTimer()
	call TimerStart(OLR, 70, false, function OCR)
	if Mode__FastNeutrals then
		call SpawnAllNeutralCreepsAction()
		set t = CreateTrigger()
		call TriggerRegisterTimerEvent(t, 30, false)
		call TriggerRegisterTimerEvent(t, 90, false)
		call TriggerAddCondition(t, Condition(function SpawnAllNeutralCreepsAction))
		set t = null
	endif
	call EnableTrigger(hChooseHeroTrigger)
	set OLR = null
	call OOR()
endfunction
function OMR takes integer pid, integer sn, integer T0V returns nothing
	local multiboarditem mi
	local string s = HeroSkillsIcon[T0V]
	if LOD_DEBUGMODE then
		if IsScourgePlayer(Player(pid)) then
			set mi = MultiboardGetItem(JP,(pid + 2)-1, sn -1)
		else
			set mi = MultiboardGetItem(JP,(pid + 1)-1, sn -1)
		endif
	else
		set mi = MultiboardGetItem(JP, D2V[pid]-1, sn -1)
	endif
	if IsSentinelPlayer(Player(pid)) and G1V == false then
		if IsScourgePlayer(LocalPlayer) then
			if T0V == 0 then
				set s = HeroSkillsIcon[0]
			else
				set s = "ReplaceableTextures\\CommandButtons\\BTNQuestion.blp"
			endif
		endif
	elseif IsScourgePlayer(Player(pid)) and G1V == false then
		if IsSentinelPlayer(LocalPlayer) then
			if T0V == 0 then
				set s = HeroSkillsIcon[0]
			else
				set s = "ReplaceableTextures\\CommandButtons\\BTNQuestion.blp"
			endif
		endif
	endif
	call MultiboardSetItemIcon(mi, s)
	call MultiboardReleaseItem(mi)
	set mi = null
endfunction
function OPR takes integer pid returns integer
	local integer k = 0
	local integer c = 0
	loop
		if RB[k]!= 0 then
			if PlayerSkillIndex[pid * HL + 1]== RB[k]or PlayerSkillIndex[pid * HL + 2]== RB[k]or PlayerSkillIndex[pid * HL + 3]== RB[k]or PlayerSkillIndex[pid * HL + 4]== RB[k]or(ExtraSkillsNumber >= 1 and PlayerSkillIndex[pid * HL + 5]== RB[k]) or(ExtraSkillsNumber >= 2 and PlayerSkillIndex[pid * HL + 6]== RB[k]) then
				set c = c + 1
			endif
		endif
		set k = k + 1
	exitwhen k > IB
	endloop
	return c
endfunction
function OQR takes integer pid returns boolean
	local integer id = 34 * 4 + 3
	local integer d = pid * HL
	if PlayerSkillIndex[d + 1]== id or PlayerSkillIndex[d + 2]== id or PlayerSkillIndex[d + 3]== id or PlayerSkillIndex[d + 4]== id or(ExtraSkillsNumber >= 1 and PlayerSkillIndex[d + 5]== id) or(ExtraSkillsNumber >= 2 and PlayerSkillIndex[d + 6]== id) then
		return true
	endif
	return false
endfunction
function OSR takes integer OTR returns boolean
	local integer k = 0
	local boolean b = false
	loop
		if OTR == RB[k] then
			set b = true
		endif
		set k = k + 1
	exitwhen b or k > IB
	endloop
	return b
endfunction
function OUR takes integer XQX returns boolean
	local integer i = 1
	loop
		if HeroListTypeId[XQX]== MeleeHeroList[i] then
			return true
		endif
		set i = i + 1
	exitwhen i > MeleeHeroMax
	endloop
	return false
endfunction
function OWR takes integer OYR, integer WWV, boolean OZR returns boolean
	local boolean O_R = I2R(OYR / 4) == I2R(OYR)/ 4.
	local boolean pr = true
	local integer ns = 0
	local integer O0R = 0
	local integer O1R = 0
	local integer xx = 0
	local integer YTE = 0
	local integer O2R = 0
	local integer O3R = 0
	local string O4R = ""
	local integer O5R = 0
	local integer O6R = 0
	local boolean O7R = false
	local boolean O8R = false
	local player p = Player(WWV)
	local boolean O9R
	local boolean RVR
	local boolean RER
	local boolean RXR
	local integer ROR = WWV * HL
	local integer RRR
	local unit u
	if PlayerSkillIndex[ROR + 1]== OYR or PlayerSkillIndex[ROR + 2]== OYR or PlayerSkillIndex[ROR + 3]== OYR or PlayerSkillIndex[ROR + 4]== OYR or PlayerSkillIndex[ROR + 5]== OYR or PlayerSkillIndex[ROR + 6]== OYR then
		return false
	endif
	if OYR ==(116 -1)* 4 + 4 or OYR ==(115 -1)* 4 + 4 or OYR ==(114 -1)* 4 + 4 then
		set O_R = false
	endif
	if FP[WWV] then
		call URE(p, OZR, "你已经准备好了")
		return false
	endif
	if IsDisabledSkill[OYR] then
		call URE(p, OZR, "该技能无法被选择 :(")
		return false
	endif
	if Mode__DeathMatch or MainModeName =="ar" then
		if IsNoDeathMatchSkill[OYR] then
			return false
		endif
	endif
	if HVV then
		if IsSentinelPlayer(p) then
			set YTE = 1
		else
			set YTE = 2
		endif
		if XP[YTE * OP + OYR]!= 0 then
			call URE(p, OZR, "一个玩家已经选择了这个技能: " + PlayersColoerText[XP[YTE * OP + OYR]] + PlayersName[XP[YTE * OP + OYR]] + "|r")
			return false
		endif
	endif
	set xx = 1
	loop
		if O_R then
			if xx == 4 or xx == 6 then
				if PlayerSkillIndex[ROR + xx]== 0 then
					set O3R = xx
				exitwhen true
				endif
			endif
		else
			if not(xx == 4 or xx == 6) then
				if PlayerSkillIndex[ROR + xx]== 0 then
					set O2R = xx
				exitwhen true
				endif
			endif
		endif
		set xx = xx + 1
	exitwhen xx > 4 + ExtraSkillsNumber
	endloop
	if O3R == 0 and O_R then
		call URE(p, OZR, "你必须选择一个小技能（非最终技能）.")
		return false
	endif
	if O2R == 0 and not(O_R) then
		call URE(p, OZR, "你必须选择一个最终技能.")
		return false
	endif
	if Mode__RandomExtraAbilities then
		if PlayerSkillIndex[ROR + 5]== 0 and ExtraSkillsNumber >= 1 then
			set O2R = 5
		endif
		if PlayerSkillIndex[ROR + 6]== 0 and ExtraSkillsNumber >= 2 then
			set O3R = 6
		endif
	endif
	set RER = CheckAbilityIdFormIndex(OYR,-1, "melee only", null)
	set O9R = CheckAbilityIdFormIndex(OYR,-1, "melee morph", null)
	set RXR = CheckAbilityIdFormIndex(OYR,-1, "range only", null)
	set RVR = CheckAbilityIdFormIndex(OYR,-1, "range morph", null)
	if WWV == 0 then
		set u = LoadUnitHandle(HY,'0REA','000U')
		if u != null then
			if OUR(GetUnitUserData(u)) then
				if RXR then
					set u = null
					return false
				endif
			else
				if RER then
					set u = null
					return false
				endif
			endif
		endif
	endif
	if RER or O9R then
		set xx = 1
		loop
			if CheckAbilityIdFormIndex(PlayerSkillIndex[ROR + xx],-1, "range only", null) or CheckAbilityIdFormIndex(PlayerSkillIndex[ROR + xx],-1, "range morph", null) then
				set ns = xx
				if O9R then
					set O4R = "你不能选择一个近战变身技能"
				else
					set O4R = "你不能选择一个近战限定技能"
				endif
			exitwhen true
			endif
			set xx = xx + 1
		exitwhen xx > 4 + ExtraSkillsNumber
		endloop
		set xx = 1
		loop
			if CheckAbilityIdFormIndex(PlayerSkillIndex[ROR + xx], OYR, null, "melee only") then
				set ns = xx
				set O4R = "buggy/orderids"
			exitwhen true
			endif
			set xx = xx + 1
		exitwhen xx > 4 + ExtraSkillsNumber
		endloop
	elseif RXR or RVR then
		set xx = 1
		loop
			if CheckAbilityIdFormIndex(PlayerSkillIndex[ROR + xx],-1, "melee only", null) or CheckAbilityIdFormIndex(PlayerSkillIndex[ROR + xx],-1, "melee morph", null) then
				set ns = xx
				if RVR then
					set O4R = "你不能选择一个远程变身技能"
				else
					set O4R = "你不能选择一个远程限定技能"
				endif
			exitwhen true
			endif
			set xx = xx + 1
		exitwhen xx > 4 + ExtraSkillsNumber
		endloop
		set xx = 1
		loop
			if CheckAbilityIdFormIndex(PlayerSkillIndex[ROR + xx], OYR, null, "range only") then
				set ns = xx
				set O4R = "buggy/orderids"
			exitwhen true
			endif
			set xx = xx + 1
		exitwhen xx > 4 + ExtraSkillsNumber
		endloop
	else
		set xx = 1
		loop
			if CheckAbilityIdFormIndex(PlayerSkillIndex[ROR + xx], OYR, null, null) then
				set ns = xx
				set O4R = "buggy/orderids"
			exitwhen true
			endif
			set xx = xx + 1
		exitwhen xx > 4 + ExtraSkillsNumber
		endloop
	endif
	if IsMultiIconSkill[OYR]and(Mode__FiveSkills or Mode__SixSkills) then
		call T9E(p, OZR, "注意：该技能是多图标技能。建议用命令改键来修改额外技能快捷键。")
	endif
	if OYR ==(35 -1)* 4 + 3 then
		if IsSentinelPlayer(p) then
			if OQR(GetPlayerId(SentinelPlayers[1])) or OQR(GetPlayerId(SentinelPlayers[2])) or OQR(GetPlayerId(SentinelPlayers[3])) or OQR(GetPlayerId(SentinelPlayers[4])) or OQR(GetPlayerId(SentinelPlayers[5])) then
				call URE(p, OZR, "你的队友已经选择了这个技能，不能再选择一个了。")
				return false
			endif
		else
			if OQR(GetPlayerId(ScourgePlayers[1])) or OQR(GetPlayerId(ScourgePlayers[2])) or OQR(GetPlayerId(ScourgePlayers[3])) or OQR(GetPlayerId(ScourgePlayers[4])) or OQR(GetPlayerId(ScourgePlayers[5])) then
				call URE(p, OZR, "你的队友已经选择了这个技能，不能再选择一个了。")
				return false
			endif
		endif
	endif
	if Mode__BalanceOff == false then
		set RRR = 1
	else
		set RRR = 2
	endif
	if OSR(OYR) then
		set O7R = OPR(WWV)>= RRR
		if O7R == false then
			if IsSentinelPlayer(p) then
				set O7R =(OPR(GetPlayerId(SentinelPlayers[1]))+ OPR(GetPlayerId(SentinelPlayers[2]))+ OPR(GetPlayerId(SentinelPlayers[3]))+ OPR(GetPlayerId(SentinelPlayers[4]))+ OPR(GetPlayerId(SentinelPlayers[5])))>= 7
			else
				set O7R =(OPR(GetPlayerId(ScourgePlayers[1]))+ OPR(GetPlayerId(ScourgePlayers[2]))+ OPR(GetPlayerId(ScourgePlayers[3]))+ OPR(GetPlayerId(ScourgePlayers[4]))+ OPR(GetPlayerId(ScourgePlayers[5])))>= 7
			endif
			set O8R = O7R
		endif
	endif
	if ns == 0 then
		if (HAV) then
			if O7R == false then
				set O0R = 0
				set O1R = 0
				set O5R =(OYR -1)/ 4
				set xx = 1
				loop
					if PlayerSkillIndex[ROR + xx]!= 0 then
						set O6R =(PlayerSkillIndex[ROR + xx]-1)/ 4
						if (O6R == O5R) then
							if O0R == 0 then
								set O0R = xx
							elseif HIV then
								if O1R == 0 then
									set O1R = xx
								else
									set ns = xx
									set O4R = "同一个英雄的技能不能超过3个"
								exitwhen true
								endif
							else
								set ns = xx
								set O4R = "同一个英雄的技能不能超过2个"
							exitwhen true
							endif
						endif
					endif
					set xx = xx + 1
				exitwhen(xx > 4 + ExtraSkillsNumber) or(xx > 4 and Mode__RandomExtraAbilities)
				endloop
			endif
		endif
	endif
	if ns != 0 then
		if O4R != "" then
			if O1R != 0 then
				call URE(p, OZR, "不兼容 : " + GetObjectName(HeroCommonSkills[PlayerSkillIndex[ROR + ns]])+ "/" + GetObjectName(HeroCommonSkills[PlayerSkillIndex[ROR + O0R]])+ "/" + GetObjectName(HeroCommonSkills[PlayerSkillIndex[ROR + O1R]])+ " (" + O4R + ")")
			elseif O0R != 0 then
				call URE(p, OZR, "不兼容 : " + GetObjectName(HeroCommonSkills[PlayerSkillIndex[ROR + ns]])+ "/" + GetObjectName(HeroCommonSkills[PlayerSkillIndex[ROR + O0R]])+ " (" + O4R + ")")
			else
				call URE(p, OZR, "不兼容 : " + GetObjectName(HeroCommonSkills[PlayerSkillIndex[ROR + ns]])+ " (" + O4R + ")")
			endif
		else
			call URE(p, OZR, "不兼容 : " + GetObjectName(HeroCommonSkills[PlayerSkillIndex[ROR + ns]]))
		endif
		return false
	endif
	if O7R then
		if O8R == false then
			if RRR == 2 then
				call URE(p, OZR, "不能选择该技能，你已经有2个控制技能了！")
			else
				call URE(p, OZR, "不能选择该技能，你已经有1个控制技能了！")
			endif
		else
			call URE(p, OZR, "不能选择该技能，你的队伍已经选择7个控制技能了！")
		endif
		return false
	endif
	if HaveSavedString(AbilityDataHashTable, HeroCommonSkills[OYR], HotKeyStringHash) then
		set xx = 1
		loop
			if PlayerSkillIndex[ROR + xx]> 0 and HaveSavedString(AbilityDataHashTable, HeroCommonSkills[PlayerSkillIndex[ROR + xx]], HotKeyStringHash) then
				if LoadStr(AbilityDataHashTable, HeroCommonSkills[OYR], HotKeyStringHash) == LoadStr(AbilityDataHashTable, HeroCommonSkills[PlayerSkillIndex[ROR + xx]], HotKeyStringHash) then
					call URE(p, OZR, "快捷键冲突 : " + GetObjectName(HeroCommonSkills[PlayerSkillIndex[ROR + xx]]))
					if HaveSavedBoolean(OtherHashTable, GetHandleId(Player(WWV)),'NSHK') and VT then
						return false
					endif
				endif
			endif
			set xx = xx + 1
		exitwhen(xx > 4 + ExtraSkillsNumber)
		endloop
	endif
	if O_R then
		set PlayerSkillIndex[ROR + O3R]= OYR
		call OMR(WWV, O3R, OYR)
	else
		set PlayerSkillIndex[ROR + O2R]= OYR
		call OMR(WWV, O2R, OYR)
	endif
	if HVV then
		if XP[YTE * OP + OYR]== 0 then
			set XP[YTE * OP + OYR]= WWV
		endif
	endif
	set xx = 1
	loop
		if PlayerSkillIndex[ROR + xx]== 0 then
			set pr = false
		exitwhen true
		endif
		set xx = xx + 1
	exitwhen xx > 4 + ExtraSkillsNumber
	endloop
	set FP[WWV]= pr
	if RER then
		set PP[WWV]= 1
		call UVE(p, OZR, "注意：该技能是近战限定技能.")
	elseif RXR then
		set PP[WWV]= 2
		call UVE(p, OZR, "注意：该技能是远程限定技能.")
	endif
	if O9R then
		call UVE(p, OZR, "注意：该技能是近战变身技能.")
	elseif RVR then
		call UVE(p, OZR, "注意：该技能是远程变身技能.")
	endif
	if ( not Mode__BalanceOff and NoBalanceOffTips[OYR]!= null ) then
		call UVE(p, OZR, "平衡改动(BO)：" + NoBalanceOffTips[OYR]) // BalanceOff
	endif
	if ( not Mode__RearmCombos and NoRearmCombosTips[OYR]!= null ) then
		call UVE(p, OZR, "平衡改动(RC)：" + NoRearmCombosTips[OYR]) // RearmCombos
	endif
	if ZTP[OYR]!= null then
		call UVE(p, OZR, "注意：" + ZTP[OYR])
	endif
	return true
endfunction
function Q7X takes nothing returns nothing
	local unit u = LoadUnitHandle(HY,'hRUT', 1)
	local integer WWV = GetPlayerId(GetOwningPlayer(u))
	local integer ZKE
	local integer i = 0
	local integer te
	set PlayerSkillIndex[WWV * HL + 1]= LoadInteger(HY,'hRUT', 2)
	set PlayerSkillIndex[WWV * HL + 2]= LoadInteger(HY,'hRUT', 3)
	set PlayerSkillIndex[WWV * HL + 3]= LoadInteger(HY,'hRUT', 4)
	set PlayerSkillIndex[WWV * HL + 4]= LoadInteger(HY,'hRUT', 5)
	set PlayerSkillIndex[WWV * HL + 5]= LoadInteger(HY,'hRUT', 6)
	set PlayerSkillIndex[WWV * HL + 6]= LoadInteger(HY,'hRUT', 7)
	set IP[WWV * 2 + 1]= LoadInteger(HY,'hRUT', 8)
	set IP[WWV * 2 + 2]= LoadInteger(HY,'hRUT', 9)
	loop
		set ZKE =(GetRandomInt(1, GL * 4))
		if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
			if not CheckAbilityIdFormIndex(ZKE,-1, "range only", null) then
				call SaveInteger(HY,'0REA','0PID', WWV)
				call SaveInteger(HY,'0REA','0SID', ZKE)
				call SaveBoolean(HY,'0REA','000B', false)
				call ExecuteFunc("SPO")
			endif
		else
			if not CheckAbilityIdFormIndex(ZKE,-1, "melee only", null) then
				call SaveInteger(HY,'0REA','0PID', WWV)
				call SaveInteger(HY,'0REA','0SID', ZKE)
				call SaveBoolean(HY,'0REA','000B', false)
				call ExecuteFunc("SPO")
			endif
		endif
		set i = i + 1
	exitwhen FP[WWV]
	endloop
	if not FP[WWV] then
		call SaveInteger(HY,'hRUT', 2, PlayerSkillIndex[WWV * HL + 1])
		call SaveInteger(HY,'hRUT', 3, PlayerSkillIndex[WWV * HL + 2])
		call SaveInteger(HY,'hRUT', 4, PlayerSkillIndex[WWV * HL + 3])
		call SaveInteger(HY,'hRUT', 5, PlayerSkillIndex[WWV * HL + 4])
		call SaveInteger(HY,'hRUT', 6, PlayerSkillIndex[WWV * HL + 5])
		call SaveInteger(HY,'hRUT', 7, PlayerSkillIndex[WWV * HL + 6])
		call SaveInteger(HY,'hRUT', 8, IP[WWV * 2 + 1])
		call SaveInteger(HY,'hRUT', 9, IP[WWV * 2 + 2])
		call ExecuteFunc("Q7X")
	endif
	call FlushChildHashtable(HY,'hRUT')
	call AddHeroSkills(u, Player(WWV))
	call OIR(WWV)
	set FP[WWV]= false
	set u = null
endfunction
function MIO takes nothing returns nothing
	local integer ZKE
	local integer UXO
	local integer WWV
	local integer te
	set WWV = 0
	loop
		if T6E(WWV) then
			loop
			exitwhen FP[WWV]
				if MainModeName =="sd" or MainModeName =="md" then
					loop
						set UXO = UIE(GetRandomInt(1, GL))
					exitwhen(DP[WWV * GL + UXO]and ZQ[UXO]== false)
					endloop
					set ZKE =(UXO * 4)-4
					set ZKE = ZKE + GetRandomInt(1, 4)
					call SaveInteger(HY,'0REA','0PID', WWV)
					call SaveInteger(HY,'0REA','0SID', ZKE)
					call SaveBoolean(HY,'0REA','000B', false)
					call ExecuteFunc("SPO")
				else
					loop
						set ZKE =(GetRandomInt(1, GL * 4))
						set te = UIE((ZKE + 3)/ 4)
					exitwhen(ZQ[te]== false and GetPlayerTechMaxAllowed(GetTriggerPlayer(), HeroListTypeId[te])> 0)
					endloop
					call SaveInteger(HY,'0REA','0PID', WWV)
					call SaveInteger(HY,'0REA','0SID', ZKE)
					call SaveBoolean(HY,'0REA','000B', false)
					call ExecuteFunc("SPO")
				endif
			endloop
			call SQO()
		endif
		set WWV = WWV + 1
	exitwhen WWV > 12
	endloop
endfunction
function RIR takes integer pid, integer TPE returns boolean
	local integer xx
	local integer YTE
	local integer sn
	local integer V0R
	local integer unitTypeId = GetUnitPointValueByType(HeroListTypeId[TPE / 4])
	set sn = R2I((I2R(TPE)+ 3.)/ 4.)
	set sn = TPE -((sn -1)* 4)
	if Mode__RandomExtraAbilities then
		if PlayerSkillIndex[pid * HL + 5]== TPE and ExtraSkillsNumber >= 1 then
			call URE(Player(pid), true, "你不能在\"额外随机技能\"模式下移除该技能.")
			return false
		endif
		if PlayerSkillIndex[pid * HL + 6]== TPE and ExtraSkillsNumber >= 2 then
			call URE(Player(pid), true, "你不能在\"额外随机技能\"模式下移除该技能.")
			return false
		endif
	endif
	set xx = 1
	loop
		if (PlayerSkillIndex[pid * HL + xx]== TPE) then
			set PlayerSkillIndex[pid * HL + xx]= 0
			call OMR(pid, xx, 0)
		exitwhen true
		endif
		set xx = xx + 1
	exitwhen xx > 4 + ExtraSkillsNumber
	endloop
	set PP[pid]= 0
	set xx = 1
	loop
		if CheckAbilityIdFormIndex(PlayerSkillIndex[pid * HL + xx],-1, "melee only", null) then
			set PP[pid]= 1
		exitwhen true
		elseif CheckAbilityIdFormIndex(PlayerSkillIndex[pid * HL + xx],-1, "range only", null) then
			set PP[pid]= 2
		exitwhen true
		endif
		set xx = xx + 1
	exitwhen xx > 4 + ExtraSkillsNumber
	endloop
	if GetUnitAbilityLevel(KP[pid],'Z004'-1 + sn)> 0 then
		call UnitRemoveAbility(KP[pid],('Z004'-1)+ sn)
		call UnitAddAbility(KP[pid],('Z000'-1)+ sn)
	endif
	if HVV then
		set xx = 0
		loop
			if IsSentinelPlayer(Player(pid)) then
				set V0R = GetPlayerId(SentinelPlayers[xx])
			else
				set V0R = GetPlayerId(ScourgePlayers[xx])
			endif
			if LoadBoolean(HY, GetHandleId(Player(V0R)), unitTypeId) then
				if GetUnitAbilityLevel(KP[V0R], HeroCommonSkills[TPE])> 0 then
					call UnitRemoveAbility(KP[V0R],('Z010'-1)+ sn)
					call UnitAddAbility(KP[V0R],('Z000'-1)+ sn)
				endif
			endif
			set xx = xx + 1
		exitwhen xx > 5
		endloop
		if IsSentinelPlayer(Player(pid)) then
			set YTE = 1
		else
			set YTE = 2
		endif
		if XP[YTE * OP + TPE]== pid then
			set XP[YTE * OP + TPE]= 0
		endif
	endif
	return true
endfunction
function Y4O takes nothing returns nothing
	local integer WWV = GetPlayerId(GetTriggerPlayer())
	local integer i = S2I(SubString(GetEventPlayerChatString(), 2, 3))
	if i == 0 then
		set i = S2I(SubString(GetEventPlayerChatString(), 3, 4))
	endif
	if IsPickingHero then
		if GetGameTime()> HN[WWV] + 2 then
			if i < 7 and i > 0 then
				set HN[WWV]= GetGameTime()
				call RIR(WWV, PlayerSkillIndex[WWV * HL + i])
				set FP[WWV]= false
			else
				call InterfaceErrorForPlayer(GetTriggerPlayer(), "Wrong index, try [1-6]")
			endif
		else
			call InterfaceErrorForPlayer(GetTriggerPlayer(), "Do not spam. Try later.")
		endif
	endif
endfunction
function reset_choice takes player p, boolean b returns nothing
	local integer id = GetPlayerId(p)
	if IsPickingHero then
		if b or GetGameTime()> HN[id] + 2 then
			set HN[id]= GetGameTime()
			call RIR(id, PlayerSkillIndex[id * HL + 1])
			call RIR(id, PlayerSkillIndex[id * HL + 2])
			call RIR(id, PlayerSkillIndex[id * HL + 3])
			call RIR(id, PlayerSkillIndex[id * HL + 4])
			call RIR(id, PlayerSkillIndex[id * HL + 5])
			call RIR(id, PlayerSkillIndex[id * HL + 6])
			set FP[id]= false
		else
			call InterfaceErrorForPlayer(p, "Do not spam. Try later.")
		endif
	endif
endfunction
function RAR takes nothing returns nothing
	call reset_choice(GetTriggerPlayer(), false)
endfunction
function Reset_Ability takes nothing returns nothing
	call reset_choice(E3, true)
endfunction
function RNR takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='n00C' or GetUnitTypeId(GetFilterUnit())=='ntav' then
		call ShowUnit(GetFilterUnit(), true)
		call KillUnit(GetFilterUnit())
	endif
	return false
endfunction
function RBR takes nothing returns nothing
	local integer WWV = GetPlayerId(GetTriggerPlayer())
	local integer xx
	local group g = AllocationGroup(112)
	if not(GP) and MainModeName != "ar" then
		set xx = 1
		loop
			call RIR(WWV, PlayerSkillIndex[WWV * HL + xx])
			set xx = xx + 1
		exitwhen xx > 4 + ExtraSkillsNumber
		endloop
	endif
	call GroupEnumUnitsOfPlayer(g, GetTriggerPlayer(), Condition(function RNR))
	call DeallocateGroup(g)
	set g = null
endfunction
function RCR takes nothing returns nothing
	local integer WWV = GetPlayerId(GetOwningPlayer(GetSpellAbilityUnit()))
	local integer QLX =(MP[WWV]* 4)-4
	local integer sn
	if GetSpellAbilityId()=='Z004' then
		set QLX = QLX + 1
		set sn = 1
	elseif GetSpellAbilityId()=='Z005' then
		set QLX = QLX + 2
		set sn = 2
	elseif GetSpellAbilityId()=='Z006' then
		set QLX = QLX + 3
		set sn = 3
	elseif GetSpellAbilityId()=='Z007' then
		set QLX = QLX + 4
		set sn = 4
	else
		return
	endif
	if RIR(WWV, QLX) then
		set FP[WWV]= false
	endif
endfunction
function RDR takes nothing returns nothing
	local integer pid = GetPlayerId(GetOwningPlayer(GetSpellAbilityUnit()))
	local integer QLX =(MP[pid]* 4)-4
	local integer sn
	local integer xx
	local integer RFR
	if not((GetSpellAbilityId()>='Z000' and GetSpellAbilityId()<='Z003') or(GetSpellAbilityId()>='Z010' and GetSpellAbilityId()<='Z013')) then
		return
	endif
	if GetSpellAbilityId()=='Z000' or GetSpellAbilityId()=='Z010' then
		set QLX = QLX + 1
		set sn = 1
	elseif GetSpellAbilityId()=='Z001' or GetSpellAbilityId()=='Z011' then
		set QLX = QLX + 2
		set sn = 2
	elseif GetSpellAbilityId()=='Z002' or GetSpellAbilityId()=='Z012' then
		set QLX = QLX + 3
		set sn = 3
	elseif GetSpellAbilityId()=='Z003' or GetSpellAbilityId()=='Z013' then
		set QLX = QLX + 4
		set sn = 4
	else
		return
	endif
	if not OWR(QLX, pid, true) then
		return
	endif
	if IsPlayerHasSkill(Player(pid), QLX) then
		call UnitRemoveAbility(KP[pid],('Z000'-1)+ sn)
		call UnitAddAbility(KP[pid],('Z004'-1)+ sn)
		if HVV then
			set xx = 1
			loop
				if IsSentinelPlayer(Player(pid)) then
					set RFR = GetPlayerId(SentinelPlayers[xx])
				else
					set RFR = GetPlayerId(ScourgePlayers[xx])
				endif
				if GetUnitAbilityLevel(KP[RFR], HeroCommonSkills[QLX])> 0 and pid != RFR and GetUnitAbilityLevel(KP[RFR],'Z000'-1 + sn)> 0 then
					call UnitRemoveAbility(KP[RFR],('Z000'-1)+ sn)
					call UnitAddAbility(KP[RFR],('Z010'-1)+ sn)
				endif
				set xx = xx + 1
			exitwhen xx > 5
			endloop
		endif
	endif
	if FP[pid] then
		call SQO()
	endif
endfunction
// 创建酒馆和添加英雄
function RGR takes player p, integer iHeroTypeId, integer i2 returns nothing
	local integer h = GetHandleId(p)
	local integer c = LoadInteger(OtherHashTable, h, 32)
	// 十个英雄一个酒馆
	local integer i = R2I(c / 10)
	local integer RJR = 32 + i
	local real x = -7400 + i * 192
	local real y = 7128 -192 *(ModuloInteger(GetPlayerId(p)-1, 6))
	local integer h2
	local unit u = null
	local integer j = 1
	if p == Player(12) then
		return
	endif
	if DW then
		loop
		exitwhen j > 5
			if SentinelPlayers[j]== p or ScourgePlayers[j]== p then
				set y = 7128 -192 *(j -1)
			endif
			set j = j + 1
		endloop
	endif
	if i == 2 then
		set x = x + 16
	endif
	if not HaveSavedHandle(OtherHashTable, h, RJR) then
		set u = CreateUnit(p,'ntav', x, y, 270)
		// 自己的酒馆大一点无可厚非吧
		if LocalPlayer!= p then
			call SetUnitScale(u, .3, .3, .3)
		endif
		call SaveUnitHandle(OtherHashTable, h, RJR, u)
		// 选中第一个酒馆
		if c == 0 then
			call SelectUnitForPlayerSingle(u, p)
		endif
		set h2 = GetHandleId(u)
		// 光圈
		call SaveUnitHandle(HY, h2, RJR, CreateUnit(p,'n12C', x, y, 0))
		// 异步光圈颜色 只有自己能看见
		if LocalPlayer!= p then
			call SetUnitVertexColor(LoadUnitHandle(HY, h2, RJR), 0, 0, 0, 0)
		endif
		set u = null
	endif
	call AddUnitToStock(LoadUnitHandle(OtherHashTable, h, RJR), iHeroTypeId, 1, 1)
	call SaveInteger(OtherHashTable, h, 32, c + 1)
	call SetPlayerTechMaxAllowed(p, iHeroTypeId, 999)
	call SaveBoolean(HY, h, iHeroTypeId, true)
	call SaveInteger(HY, h,'hrpl'+ c, iHeroTypeId)
	call SaveInteger(HY, h,'bapl'+ c, i2)
endfunction
function RKR takes nothing returns nothing
	local integer WWV = 0
	local integer i = 1
	local integer j
	local integer n
	local integer f
	local integer WOV = GL
	local boolean RLR = true
	if QW then
		loop
			set QP[i]= V_V[i]
			set i = i + 1
		exitwhen V_V[i]== 0
		endloop
	elseif SW then
		loop
			set QP[i]= V3V[i]
			set i = i + 1
		exitwhen V3V[i]== 0
		endloop
	elseif TW then
		loop
			set QP[i]= V1V[i]
			set i = i + 1
		exitwhen V1V[i]== 0
		endloop
	else
		loop
			set QP[i]= i
			set i = i + 1
		exitwhen i > GL
		endloop
		set RLR = false
	endif
	set WV = i -1
	set WOV = WV * 4
	set i = 1
	loop
		set j = GetRandomInt(1, WV)
		set n = GetRandomInt(1, WV)
		if j != n then
			set f = QP[j]
			set QP[j]= QP[n]
			set QP[n]= f
		endif
		set i = i + 1
	exitwhen i > WOV
	endloop
	set UV = RLR == false and(Mode__Draft20 == false or HOV) and Mode__Draft30 == false and Mode__Draft40 == false and Mode__Draft50 == false
	if RLR == false then
		return
	endif
	set i = 1
	loop
		set QP[i]= TVE(QP[i])
		set i = i + 1
	exitwhen QP[i]== 0
	endloop
endfunction
function RMR takes integer WWV, integer i returns boolean
	local boolean b = false
	set b = DP[GetPlayerId(SentinelPlayers[1])* GL + i]== false and DP[GetPlayerId(SentinelPlayers[2])* GL + i]== false and DP[GetPlayerId(SentinelPlayers[3])* GL + i]== false and DP[GetPlayerId(SentinelPlayers[4])* GL + i]== false and DP[GetPlayerId(SentinelPlayers[5])* GL + i]== false
	set b = b and(DP[GetPlayerId(ScourgePlayers[1])* GL + i]== false and DP[GetPlayerId(ScourgePlayers[2])* GL + i]== false and DP[GetPlayerId(ScourgePlayers[3])* GL + i]== false and DP[GetPlayerId(ScourgePlayers[4])* GL + i]== false and DP[GetPlayerId(ScourgePlayers[5])* GL + i]== false)
	return b
endfunction

// 给玩家分配酒馆
function RPR takes integer iPlayerId, boolean RQR returns nothing
	local integer i
	local integer c = 10 + BP
	if c <= LoadInteger(HY, iPlayerId,'sdcn') then
		return
	endif
	loop
		set i = GetRandomInt(1, WV)
		if UV then
		exitwhen not DP[iPlayerId * GL + QP[i]] and RMR(iPlayerId, QP[i])
		else
		exitwhen not DP[iPlayerId * GL + QP[i]]
		endif
	exitwhen WV < c
	endloop
	if DP[iPlayerId * GL + QP[i]]== false then
		call RGR(Player(iPlayerId), HeroListTypeId[QP[i]], QP[i])
		set DP[iPlayerId * GL + QP[i]]= true
		if RQR then
			call RGR(Player(iPlayerId + 6), HeroListTypeId[QP[i]], QP[i])
			set DP[(iPlayerId + 6)* GL + QP[i]]= true
		endif
	endif
	call SaveInteger(HY, iPlayerId,'sdcn', LoadInteger(HY, iPlayerId,'sdcn')+ 1)
endfunction

// 给玩家分配酒馆 专门给MD模式的
function InitBarAndHeroByMDMode takes integer iTeamIndex, boolean bIsSentinelPlayer returns nothing
	local integer i
	local integer c = 10 + BP
	local integer iPlayerIndex// = GetPlayerId(SentinelPlayers[iTeamIndex])
	if bIsSentinelPlayer then
		set iPlayerIndex = GetPlayerId(SentinelPlayers[iTeamIndex])
	else
		set iPlayerIndex = GetPlayerId(ScourgePlayers[iTeamIndex])
	endif
	if c <= LoadInteger(HY, iTeamIndex,'sdcn') then
		return
	endif
	loop
		set i = GetRandomInt(1, WV)
		if UV then
		exitwhen not DP[iPlayerIndex * GL + QP[i]] and RMR(iPlayerIndex, QP[i])
		else
		exitwhen not DP[iPlayerIndex * GL + QP[i]]
		endif
	exitwhen WV < c
	endloop
	if not DP[iPlayerIndex * GL + QP[i]] then
		call RGR(Player(iPlayerIndex), HeroListTypeId[QP[i]], QP[i])
		set DP[iPlayerIndex * GL + QP[i]]= true
		// 如果是近卫军团 就给天灾军团也弄一个
		if bIsSentinelPlayer and IsPlayingPlayer(ScourgePlayers[iTeamIndex]) then
			call RGR(ScourgePlayers[iTeamIndex], HeroListTypeId[QP[i]], QP[i])
			set DP[(GetPlayerId(ScourgePlayers[iTeamIndex]))* GL + QP[i]]= true
		endif
	endif
	call SaveInteger(HY, iTeamIndex,'sdcn', LoadInteger(HY, iTeamIndex,'sdcn')+ 1)
endfunction

// 近卫SentinelPlayers[] 天灾ScourgePlayers[]
function RSR takes integer iTeamIndex, integer i returns nothing
	// 如果是近卫或天灾就返回
	if iTeamIndex == 0 or iTeamIndex == 6 or i == 0 then
		return
	endif
	if not IsPlayingPlayer(SentinelPlayers[iTeamIndex]) then
		// 如果 近卫没玩家 天灾有玩家
		if IsPlayingPlayer(ScourgePlayers[iTeamIndex]) then
			call InitBarAndHeroByMDMode(iTeamIndex, false)
			//if i == 1 then
			//	call BJDebugMsg("天灾存在玩家"+I2S(iTeamIndex))
			//endif
			// 如果两边没有玩家就返回
			return
		endif
	else
		// 那么就是近卫有玩家的情况
		call InitBarAndHeroByMDMode(iTeamIndex, true)
		//if i == 1 then
		//	call BJDebugMsg("近卫天灾存在玩家"+I2S(iTeamIndex))
		//endif
	endif
endfunction

function RemoveAllPickTavern takes nothing returns nothing
	call RemoveUnit(EVV)
	call RemoveUnit(EEV)
	call RemoveUnit(EXV)
	call RemoveUnit(EOV)
	call RemoveUnit(ERV)
	call RemoveUnit(EIV)
	call RemoveUnit(EAV)
	call RemoveUnit(ENV)
	call RemoveUnit(EBV)
	call RemoveUnit(ECV)
	call RemoveUnit(EDV)
	call RemoveUnit(EFV)
endfunction
// MD初始化酒馆
function RWR takes nothing returns nothing
	local integer i
	local integer iPlayerIndex = 1
	local integer c = 10 + BP
	loop
		set i = 1
		loop
			call RSR(iPlayerIndex, i)
			set i = i + 1
		exitwhen(i > c)
		endloop
		set iPlayerIndex = iPlayerIndex + 1
	exitwhen iPlayerIndex > 5
	endloop
endfunction
// MD初始化
function RYR takes nothing returns nothing
	call RemoveAllPickTavern()
	call RKR()
	call ExecuteFunc("RWR")
	call ExecuteFunc("QUX")
	call PanCameraToTimed(-7008., 6816., .0)
endfunction
function RZR takes integer id returns nothing
	set RB[IB]= id
	set IB = IB + 1
endfunction
function R_R takes nothing returns nothing
	call RZR((8 -1)* 4 + 1)
	call RZR((6 -1)* 4 + 1)
	call RZR((95 -1)* 4 + 4)
	call RZR((22 -1)* 4 + 1)
	call RZR((46 -1)* 4 + 1)
	call RZR((37 -1)* 4 + 4)
	call RZR((33 -1)* 4 + 2)
	call RZR((39 -1)* 4 + 2)
	call RZR((HB -1)* 4 + 4)
	call RZR((77 -1)* 4 + 4)
	call RZR((81 -1)* 4 + 1)
	call RZR((66 -1)* 4 + 2)
	call RZR((74 -1)* 4 + 4)
	call RZR((63 -1)* 4 + 1)
	call RZR(('l'-1)* 4 + 1)
	call RZR(('j'-1)* 4 + 4)
	call RZR((1 -1)* 4 + 1)
	call RZR((40 -1)* 4 + 2)
	call RZR((48 -1)* 4 + 2)
	call RZR((7 -1)* 4 + 2)
	call RZR((54 -1)* 4 + 1)
	call RZR((69 -1)* 4 + 4)
	call RZR((89 -1)* 4 + 1)
	call RZR((65 -1)* 4 + 1)
	call RZR((61 -1)* 4 + 4)
	call RZR((5 -1)* 4 + 2)
	call RZR((41 -1)* 4 + 2)
	call RZR((47 -1)* 4 + 1)
	call RZR((DB -1)* 4 + 2)
	call RZR((28 -1)* 4 + 2)
	call RZR((28 -1)* 4 + 3)
	call RZR((38 -1)* 4 + 2)
	call RZR((18 -1)* 4 + 1)
	call RZR((53 -1)* 4 + 1)
	call RZR((75 -1)* 4 + 3)
	call RZR((75 -1)* 4 + 4)
	call RZR(('h'-1)* 4 + 1)
	call RZR(('h'-1)* 4 + 2)
	call RZR((86 -1)* 4 + 1)
	call RZR((95 -1)* 4 + 1)
	call RZR(( 100 -1)* 4 + 1)
	call RZR((97 -1)* 4 + 1)
	call RZR((87 -1)* 4 + 2)
	call RZR(('e'-1)* 4 + 1)
	call RZR(('p'-1)* 4 + 1)
	call RZR((31 -1)* 4 + 1)
	call RZR((46 -1)* 4 + 4)
	call RZR(('o'-1)* 4 + 1)
	call RZR((78 -1)* 4 + 1)
	call RZR((4 -1)* 4 + 2)
	call RZR(( 120-1)* 4 + 2)
	call RZR((91 -1)* 4 + 2)
	call RZR((78 -1)* 4 + 4)
	call RZR((82 -1)* 4 + 1)
	call RZR(('m'-1)* 4 + 4)
	call RZR((96 -1)* 4 + 4)
endfunction
function R0R takes integer id, integer TXE, integer TOE, integer QMX, integer QPX returns nothing
	if Mode__RearmCombos == false and Mode__BalanceOff == false then
		if TXE =='Z601' then
			call SaveSkillOrder(id * 4 + 1, "r23")
		elseif TOE =='Z601' then
			call SaveSkillOrder(id * 4 + 2, "r23")
		elseif QMX =='Z601' then
			call SaveSkillOrder(id * 4 + 3, "r23")
		elseif QPX =='Z601' then
			call SaveSkillOrder(id * 4 + 4, "r23")
		endif
	endif
endfunction
function R1R takes nothing returns nothing
	local integer i = 1
	local integer k = 0
	local integer j = 1
	local integer array s
	local string array R2R
	local string array R3R
	local string array R4R
	local integer array QSX
	local integer array R5R
	local integer R6R
	local unit u = CreateUnit(Player(13), 'e00E', 0, 0, 0)
	//local integer rndIndex
	set s[1]= 1
	set s[2]= 2
	set s[3]= 3
	set s[4]= 4
	set s[5]= 5
	set s[6]= 6
	set s[7]= 7
	set s[8]= 8
	set s[9]= 9
	set s[10]= 10
	set R4R[1]= "t"
	set R4R[2]= "d"
	set R4R[3]= "f"
	set R4R[4]= "y"
	set R4R[5]= "v"
	set R4R[6]= "g"
	set R4R[7]= "z"
	set R4R[8]= "x"
	set R4R[9]= "c"
	set R4R[10]= "b"
	loop
	exitwhen(i == 10)
		set k = GetRandomInt(1, 10)
		set R6R = s[i]
		set s[i]= s[k]
		set s[k]= R6R
		set i = i + 1
	endloop
	set R3R[1]= "request_hero"
	set R3R[2]= "mechanicalcritter"
	set R3R[3]= "militia"
	set R3R[4]= "militiaconvert"
	set R3R[5]= "windwalk"
	set R3R[6]= "militiaoff"
	set R3R[7]= "militiaunconvert"
	set R3R[8]= "mindrot"
	set R3R[9]= "monsoon"
	set R3R[10]= "mount"
	set i = 1
	loop
		set QSX[i]='Z600'+ i
		set R5R[i]='Y600'+ i
		set R2R[i]= GetAbilitySoundById(QSX[i], SOUND_TYPE_EFFECT_LOOPED)
		set i = i + 1
	exitwhen i > 9
	endloop
	set QSX[10]='Z610'
	set R5R[10]='Y610'
	set R2R[10]= GetAbilitySoundById(QSX[10], SOUND_TYPE_EFFECT_LOOPED)
	set i = 114 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, R3R[s[1]]), QSX[s[1]], 0, R5R[s[1]], R4R[s[1]])
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, R3R[s[2]]), QSX[s[2]], 0, R5R[s[2]], R4R[s[2]])
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, R3R[s[3]]), QSX[s[3]], 0, R5R[s[3]], R4R[s[3]])
	call RegisterHeroSkill(i * 4 + 4, null, 0, 0, 0, "_")
	set IsDisabledSkill[i * 4 + 4]= true
	call R0R(i, QSX[s[1]], QSX[s[2]], QSX[s[3]], 0)
	set i = 115 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, R3R[s[4]]), QSX[s[4]], 0, R5R[s[4]], R4R[s[4]])
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, R3R[s[5]]), QSX[s[5]], 0, R5R[s[5]], R4R[s[5]])
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, R3R[s[6]]), QSX[s[6]], 0, R5R[s[6]], R4R[s[6]])
	call RegisterHeroSkill(i * 4 + 4, null, 0, 0, 0, "_")
	set IsDisabledSkill[i * 4 + 4]= true
	call R0R(i, QSX[s[4]], QSX[s[5]], QSX[s[6]], 0)
	set i = 116 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, R3R[s[7]]), QSX[s[7]], 0, R5R[s[7]], R4R[s[7]])
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, R3R[s[8]]), QSX[s[8]], 0, R5R[s[8]], R4R[s[8]])
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, R3R[s[9]]), QSX[s[9]], 0, R5R[s[9]], R4R[s[9]])
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, R3R[s[10]]), QSX[s[10]], 0, R5R[s[10]], R4R[s[10]])
	call R0R(i, QSX[s[7]], QSX[s[8]], QSX[s[9]], QSX[s[10]])
	set i = 114 -1
	loop
	exitwhen i > 116 -1
		if HeroCommonSkills[i * 4 + 1]=='Z610' then
			call RZR(i * 4 + 1)
			set i = 1231
		elseif HeroCommonSkills[i * 4 + 2]=='Z610' then
			call RZR(i * 4 + 2)
			set i = 1231
		elseif HeroCommonSkills[i * 4 + 3]=='Z610' then
			call RZR(i * 4 + 3)
			set i = 1231
		elseif HeroCommonSkills[i * 4 + 4]=='Z610' then
			call RZR(i * 4 + 4)
			set i = 1231
		endif
		set i = i + 1
	endloop
	set i = 1
	//call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, GetObjectName('n06G'))
	loop
	exitwhen i > 10
		call UnitAddAbility(u, QSX[s[i]])
		set i = i + 1
	endloop
	call UnitAddAbility(u,'QFZZ')
	call RemoveUnit(u)
	set u = null
endfunction
function R7R takes integer iPlayerIndex, integer i returns nothing
	// 如果是近卫或天灾就拉倒
	if iPlayerIndex == 0 or iPlayerIndex == 6 or i == 0 then
		return
	endif
	// 玩家不存在也拉倒 并且没有玩家名字等于"df" (不知道什么鬼 也许是俄国作者想要和谐玩家)
	if not IsPlayingPlayer(Player(iPlayerIndex)) and not JE then
		return
	endif
	call RPR(iPlayerIndex, false)
endfunction
// SD初始化酒馆
function R8R takes nothing returns nothing
	local integer iPlayerIndex = 0
	local integer i
	local integer c = 10 + BP
	loop
		set i = 1
		loop
			call R7R(iPlayerIndex, i)
			set i = i + 1
		exitwhen(i > c)
		endloop
		set iPlayerIndex = iPlayerIndex + 1
		if iPlayerIndex == 6 then
			set iPlayerIndex = 7
		endif
	exitwhen(iPlayerIndex > 11)
	endloop
endfunction
// SD初始化
function R9R takes nothing returns nothing
	call RemoveAllPickTavern()
	call RKR()
	call ExecuteFunc("R8R")
	call ExecuteFunc("QUX")
	call PanCameraToTimed(-7008., 6816., .0)
endfunction
function SPO takes nothing returns nothing
	local integer WWV = LoadInteger(HY,'0REA','0PID')
	local integer ZKE = LoadInteger(HY,'0REA','0SID')
	local boolean UEE = LoadBoolean(HY,'0REA','000B')
	call OWR(ZKE, WWV, UEE)
endfunction
function IVR takes nothing returns nothing
	local integer WWV = 0
	local integer ZKE = 0
	local integer UXO = 0
	set WWV = 1
	loop
		if T6E(WWV) then
			if ExtraSkillsNumber >= 1 then
				loop
					if MainModeName =="sd" or MainModeName =="md" then
						loop
							set UXO = UIE(GetRandomInt(1, GL))
						exitwhen DP[WWV * GL + UXO]and ZQ[UXO]== false
						endloop
						set UXO = QP[UXO]
					else
						loop
							set UXO = UIE(GetRandomInt(1, GL))
						exitwhen(ZQ[UXO]== false and GetPlayerTechMaxAllowed(Player(WWV), HeroListTypeId[UXO -1])> 0)
						endloop
					endif
					set ZKE =(UXO -1)* 4
					set ZKE = ZKE + GetRandomInt(1, 3)
					call SaveInteger(HY,'0REA','0PID', WWV)
					call SaveInteger(HY,'0REA','0SID', ZKE)
					call SaveBoolean(HY,'0REA','000B', false)
					call ExecuteFunc("SPO")
				exitwhen PlayerSkillIndex[WWV * HL + 5]!= 0
				endloop
			endif
			if ExtraSkillsNumber >= 2 then
				loop
					if MainModeName =="sd" or MainModeName =="md" then
						loop
							set UXO = UIE(GetRandomInt(1, GL))
						exitwhen DP[WWV * GL + UXO]and ZQ[UXO]== false
						endloop
						set UXO = QP[UXO]
					else
						loop
							set UXO = UIE(GetRandomInt(1, GL))
						exitwhen(ZQ[UXO]== false and GetPlayerTechMaxAllowed(Player(WWV), HeroListTypeId[UXO])> 0)
						endloop
					endif
					set ZKE =(UXO -1)* 4 + 4
					call SaveInteger(HY,'0REA','0PID', WWV)
					call SaveInteger(HY,'0REA','0SID', ZKE)
					call SaveBoolean(HY,'0REA','000B', false)
					call ExecuteFunc("SPO")
				exitwhen PlayerSkillIndex[WWV * HL + 6]!= 0
				endloop
			endif
		endif
		set WWV = WWV + 1
		if WWV == 6 then
			set WWV = 7
		endif
	exitwhen(WWV > 12)
	endloop
endfunction
function IER takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local image im
	local integer S7V = LoadInteger(HY, h, 0)-1
	local real x = LoadReal(HY, h, 10)
	local real y = LoadReal(HY, h, 11)
	local string s
	set im = LoadImageHandle(HY, h, 1)
	call DestroyImage(im)
	set im = LoadImageHandle(HY, h, 2)
	call DestroyImage(im)
	if S7V < 0 then
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
		set t = null
		return
	endif
	set s = I2S(S7V)
	if S7V < 10 then
		set s = "0" + s
	endif
	call TXV("Fonts\\" + SubString(s, 0, 1)+ ".blp", 60, 60, x, y, 0, true)
	call SaveImageHandle(HY, h, 1, R3)
	call SetImageColor(R3, 255, 255, 255, 255)
	call TXV("Fonts\\" + SubString(s, 1, 2)+ ".blp", 60, 60, x + 40, y, 0, true)
	call SaveImageHandle(HY, h, 2, R3)
	call SetImageColor(R3, 255, 255, 255, 255)
	call SaveInteger(HY, h, 0, S7V)
	set t = null
endfunction
function IXR takes real S7V returns nothing
	local integer ht = GetHandleId(GetTriggeringTrigger())
	local timer IOR = LoadTimerHandle(HY, ht, 5)
	local integer oh = GetHandleId(IOR)
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local image IRR
	local image IIR
	local string s = I2S(R2I(S7V))
	local real x =-7030
	local real y = 6766
	if oh > 1 then
		set IRR = LoadImageHandle(HY, oh, 1)
		set IIR = LoadImageHandle(HY, oh, 2)
		call DestroyImage(IRR)
		call DestroyImage(IIR)
		call PauseTimer(IOR)
		call DestroyTimer(IOR)
		call FlushChildHashtable(HY, oh)
	endif
	call SaveTimerHandle(HY, ht, 5, t)
	call SaveReal(HY, h, 10, x)
	call SaveReal(HY, h, 11, y)
	call TXV("Fonts\\" + SubString(s, 0, 1)+ ".blp", 60, 60, x, y, 0, true)
	call SaveImageHandle(HY, h, 1, R3)
	call SetImageColor(R3, 255, 255, 255, 255)
	call TXV("Fonts\\" + SubString(s, 1, 2)+ ".blp", 60, 60, x + 40, y, 0, true)
	call SaveImageHandle(HY, h, 2, R3)
	call SetImageColor(R3, 255, 255, 255, 255)
	call TimerStart(t, 1, true, function IER)
	call SaveInteger(HY, h, 0, R2I(S7V))
	set IOR = null
	set t = null
endfunction
function IAR takes integer h, real x, real y returns nothing
	local integer i = 0
	local string s = "YOUR PICK"
	local integer k = 0
	call TXV("Fonts\\Y.blp", 60, 60, x -40 * 4, y, 0, true)
	call SetImageColor(R3, 255, 0, 0, k)
	call SaveImageHandle(HY, h, 200+ 0, R3)
	call TXV("Fonts\\O.blp", 60, 60, x -40 * 3, y, 0, true)
	call SetImageColor(R3, 255, 0, 0, k)
	call SaveImageHandle(HY, h, 200+ 1, R3)
	call TXV("Fonts\\U.blp", 60, 60, x -40 * 2, y, 0, true)
	call SetImageColor(R3, 255, 0, 0, k)
	call SaveImageHandle(HY, h, 200+ 2, R3)
	call TXV("Fonts\\R.blp", 60, 60, x -40 * 1, y, 0, true)
	call SetImageColor(R3, 255, 0, 0, k)
	call SaveImageHandle(HY, h, 200+ 3, R3)
	call TXV("Fonts\\P.blp", 60, 60, x + 40 * 1, y, 0, true)
	call SetImageColor(R3, 255, 0, 0, k)
	call SaveImageHandle(HY, h, 200+ 4, R3)
	call TXV("Fonts\\I.blp", 60, 60, x + 40 * 2, y, 0, true)
	call SetImageColor(R3, 255, 0, 0, k)
	call SaveImageHandle(HY, h, 200+ 5, R3)
	call TXV("Fonts\\C.blp", 60, 60, x + 40 * 2.5, y, 0, true)
	call SetImageColor(R3, 255, 0, 0, k)
	call SaveImageHandle(HY, h, 200+ 6, R3)
	call TXV("Fonts\\K.blp", 60, 60, x + 40 * 3.5, y, 0, true)
	call SetImageColor(R3, 255, 0, 0, k)
	call SaveImageHandle(HY, h, 200+ 7, R3)
endfunction
function INR takes player p, unit IBR returns nothing
	local integer pid = GetPlayerId(p)
	local unit u
	local integer hu = GetHandleId(IBR)
	local integer h = GetHandleId(GetTriggeringTrigger())
	local integer i = LoadInteger(HY, hu, 0)
	set FP[pid]= true
	set PlayerSkillIndex[pid * HL + 1]= LoadInteger(HY, h, 100 * i + 1)
	set PlayerSkillIndex[pid * HL + 2]= LoadInteger(HY, h, 100 * i + 2)
	set PlayerSkillIndex[pid * HL + 3]= LoadInteger(HY, h, 100 * i + 3)
	set PlayerSkillIndex[pid * HL + 4]= LoadInteger(HY, h, 100 * i + 4)
	set PlayerSkillIndex[pid * HL + 5]= LoadInteger(HY, h, 100 * i + 5)
	set PlayerSkillIndex[pid * HL + 6]= LoadInteger(HY, h, 100 * i + 6)
	call ORR(PlayerSkillIndex[pid * HL + 1])
	call ORR(PlayerSkillIndex[pid * HL + 2])
	call ORR(PlayerSkillIndex[pid * HL + 3])
	call ORR(PlayerSkillIndex[pid * HL + 4])
	call ORR(PlayerSkillIndex[pid * HL + 5])
	call ORR(PlayerSkillIndex[pid * HL + 6])
	call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD) -250)
	if IsSentinelPlayer(p) then
		set Player__Hero[pid]= CreateUnit(p, HeroListTypeId[GetUnitUserData(IBR)], GetRectCenterX(gg_rct_SentinelRevivalPoint), GetRectCenterY(gg_rct_SentinelRevivalPoint), 0)
		call ShowUnit(IBR, false)
		call UnitApplyTimedLife(IBR,'BTLF', 120)
		set u = CreateUnit(p, RX[GetUnitUserData(IBR)],-7250 +(GetPlayerId(p)-1)* 110, 6900, 270)
	else
		set Player__Hero[pid]= CreateUnit(p, HeroListTypeId[GetUnitUserData(IBR)], GetRectCenterX(gg_rct_ScourgeRevivalPoint), GetRectCenterY(gg_rct_ScourgeRevivalPoint), 0)
		call ShowUnit(IBR, false)
		call UnitApplyTimedLife(IBR,'BTLF', 120)
		set u = CreateUnit(p, RX[GetUnitUserData(IBR)],-7250 +(GetPlayerId(p)-7)* 110, 6590, 90)
	endif
	call PauseUnit(u, true)
	call SaveUnitHandle(HY, h, 100 + i, u)
	call SetUnitUserData(IBR, 0)
	set u = null
endfunction
function ICR takes integer pid returns nothing
	local player p = Player(pid)
	local integer i = 0
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit u
	loop
		set i = GetRandomInt(1, XT)
		set u = LoadUnitHandle(HY, h, 50 + i)
	exitwhen GetUnitUserData(u)!= 0
	endloop
	call INR(p, u)
	set u = null
endfunction
function IDR takes nothing returns nothing
	local unit u = GetSoldUnit()
	local player p = GetOwningPlayer(u)
	local integer pid = GetPlayerId(p)
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit IBR
	if GetUnitTypeId(u)=='h06N'then
		call RemoveUnit(u)
		set u = null
		if pid != LoadInteger(HY, h, 10) and pid != LoadInteger(HY, h, 11) then
			call InterfaceErrorForPlayer(p, "还未到你选择.")
		else
			set IBR = GetSellingUnit()
			call INR(p, IBR)
			if pid == LoadInteger(HY, h, 10) then
				call RemoveSavedInteger(HY, h, 10)
			else
				call RemoveSavedInteger(HY, h, 11)
			endif
		endif
	endif
endfunction
function IFR takes integer h returns nothing
	call DestroyImage(LoadImageHandle(HY, h, 200+ 0))
	call DestroyImage(LoadImageHandle(HY, h, 200+ 1))
	call DestroyImage(LoadImageHandle(HY, h, 200+ 2))
	call DestroyImage(LoadImageHandle(HY, h, 200+ 3))
	call DestroyImage(LoadImageHandle(HY, h, 200+ 4))
	call DestroyImage(LoadImageHandle(HY, h, 200+ 5))
	call DestroyImage(LoadImageHandle(HY, h, 200+ 6))
	call DestroyImage(LoadImageHandle(HY, h, 200+ 7))
endfunction
function IGR takes integer h returns nothing
	call SetImageColor(LoadImageHandle(HY, h, 200+ 0), 255, 0, 0, 0)
	call SetImageColor(LoadImageHandle(HY, h, 200+ 1), 255, 0, 0, 0)
	call SetImageColor(LoadImageHandle(HY, h, 200+ 2), 255, 0, 0, 0)
	call SetImageColor(LoadImageHandle(HY, h, 200+ 3), 255, 0, 0, 0)
	call SetImageColor(LoadImageHandle(HY, h, 200+ 4), 255, 0, 0, 0)
	call SetImageColor(LoadImageHandle(HY, h, 200+ 5), 255, 0, 0, 0)
	call SetImageColor(LoadImageHandle(HY, h, 200+ 6), 255, 0, 0, 0)
	call SetImageColor(LoadImageHandle(HY, h, 200+ 7), 255, 0, 0, 0)
endfunction
function IHR takes integer h returns nothing
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, GetObjectName('n068'))
	call SetImageColor(LoadImageHandle(HY, h, 200+ 0), 255, 0, 0, 255)
	call SetImageColor(LoadImageHandle(HY, h, 200+ 1), 255, 0, 0, 255)
	call SetImageColor(LoadImageHandle(HY, h, 200+ 2), 255, 0, 0, 255)
	call SetImageColor(LoadImageHandle(HY, h, 200+ 3), 255, 0, 0, 255)
	call SetImageColor(LoadImageHandle(HY, h, 200+ 4), 255, 0, 0, 255)
	call SetImageColor(LoadImageHandle(HY, h, 200+ 5), 255, 0, 0, 255)
	call SetImageColor(LoadImageHandle(HY, h, 200+ 6), 255, 0, 0, 255)
	call SetImageColor(LoadImageHandle(HY, h, 200+ 7), 255, 0, 0, 255)
endfunction
function IJR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u
	local integer c = LoadInteger(HY, h, 0)
	local integer i
	local string s
	local string s1
	local string s2
	local integer IKR
	local integer V0R
	local integer ILR
	local integer IMR
	if GetTriggerEventId() == EVENT_UNIT_SELL then
		call IDR()
		set t = null
		return false
	endif
	if LoadBoolean(HY, h, 0) then
		set i = 1
		call DestroyMultiboard(JP)
		call MultiboardDisplay(MainMultiboard, true)
		set BJ_Multiboard = MainMultiboard
		call AddUnitToStock(ScourgeTombOfRelics,'h02C', 2, 4) 		//游戏开始时添加贩卖
		call AddUnitToStock(SentinelAncientOfWonders,'h02C', 2, 4)
		call AddUnitToStock(SentinelPigKing,'n139', 0, 3) 		//游戏开始时添加经验书
		call AddUnitToStock(ScourgePigKing,'n139', 0, 3)
		loop
			set u = LoadUnitHandle(HY, h, 50 + i)
			call FlushChildHashtable(HY, GetHandleId(u))
			call RemoveUnit(u)
			if HaveSavedHandle(HY, h, 100 + i) then
				set u = LoadUnitHandle(HY, h, 100 + i)
				call FlushChildHashtable(HY, GetHandleId(u))
				call RemoveUnit(u)
			endif
			set i = i + 1
		exitwhen i > XT
		endloop
		call IFR(h)
		call FogModifierStop(LoadFogModifierHandle(HY, h, 220))
		call DestroyFogModifier(LoadFogModifierHandle(HY, h, 220))
		call FogModifierStop(LoadFogModifierHandle(HY, h, 221))
		call DestroyFogModifier(LoadFogModifierHandle(HY, h, 221))
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
		set t = null
		return false
	endif
	if c == 0 then
		set i = GetRandomInt(1, 2)
		if i == 1 then
			set s = "1221122112"
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, PlayersColoerText[GetPlayerId(SentinelPlayers[0])] + GetObjectName('n065')+ "|r 将会以 1-2-2-2-2-1 的顺序选取英雄")
		else
			set s = "2112211221"
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, PlayersColoerText[GetPlayerId(ScourgePlayers[0])] + GetObjectName('n06C')+ "|r 将会以 1-2-2-2-2-1 的顺序选取英雄")
		endif
		call SaveStr(HY, h, 0, s)
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15., " ")
	endif
	set s = LoadStr(HY, h, 0)
	if LoadInteger(HY, h, 10)> 0 and Player__Hero[LoadInteger(HY, h, 10)]== null then
		call ICR(LoadInteger(HY, h, 10))
	endif
	if LoadInteger(HY, h, 11)> 0 and Player__Hero[LoadInteger(HY, h, 11)]== null then
		call ICR(LoadInteger(HY, h, 11))
	endif
	if StringLength(s)>= c + 1 then
		call IGR(h)
		set s1 = SubString(s, c, c + 1)
		set s2 = SubString(s, c + 1, c + 2)
		set IMR = LoadInteger(HY, h, 5)+ 1
		set ILR = LoadInteger(HY, h, 6)+ 1
		set IKR = S2I(s1)
		set V0R = S2I(s2)
		if IKR != V0R then
			if IKR == 1 then
				call SaveInteger(HY, h, 10, GetPlayerId(SentinelPlayers[IMR]))
				call SaveInteger(HY, h, 5, IMR)
				call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, PlayersColoerText[GetPlayerId(SentinelPlayers[IMR])] + PlayersName[GetPlayerId(SentinelPlayers[IMR])] + "|r " + GetObjectName('n064'))
				if LocalPlayer== SentinelPlayers[IMR] then
					call IHR(h)
				endif
			else
				call SaveInteger(HY, h, 10, GetPlayerId(ScourgePlayers[ILR]))
				call SaveInteger(HY, h, 6, ILR)
				call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, PlayersColoerText[GetPlayerId(ScourgePlayers[ILR])] + PlayersName[GetPlayerId(ScourgePlayers[ILR])] + "|r " + GetObjectName('n064'))
				if LocalPlayer== ScourgePlayers[ILR] then
					call IHR(h)
				endif
			endif
			call SaveInteger(HY, h, 0, c + 1)
		else
			if IKR == 1 then
				call SaveInteger(HY, h, 10, GetPlayerId(SentinelPlayers[IMR]))
				call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, PlayersColoerText[GetPlayerId(SentinelPlayers[IMR])] + PlayersName[GetPlayerId(SentinelPlayers[IMR])] + "|r " + GetObjectName('n064'))
				if LocalPlayer== SentinelPlayers[IMR] then
					call IHR(h)
				endif
				if IMR + 1 < 6 then
					call SaveInteger(HY, h, 11, GetPlayerId(SentinelPlayers[IMR + 1]))
					call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, PlayersColoerText[GetPlayerId(SentinelPlayers[IMR + 1])] + PlayersName[GetPlayerId(SentinelPlayers[IMR + 1])] + "|r " + GetObjectName('n064'))
					if LocalPlayer== SentinelPlayers[IMR + 1] then
						call IHR(h)
					endif
				endif
				call SaveInteger(HY, h, 5, IMR + 1)
			else
				call SaveInteger(HY, h, 10, GetPlayerId(ScourgePlayers[ILR]))
				call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, PlayersColoerText[GetPlayerId(ScourgePlayers[ILR])] + PlayersName[GetPlayerId(ScourgePlayers[ILR])] + "|r " + GetObjectName('n064'))
				if LocalPlayer== ScourgePlayers[ILR] then
					call IHR(h)
				endif
				if ILR + 1 < 6 then
					call SaveInteger(HY, h, 11, GetPlayerId(ScourgePlayers[ILR + 1]))
					call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, PlayersColoerText[GetPlayerId(ScourgePlayers[ILR + 1])] + PlayersName[GetPlayerId(ScourgePlayers[ILR + 1])] + "|r " + GetObjectName('n064'))
					if LocalPlayer== ScourgePlayers[ILR + 1] then
						call IHR(h)
					endif
				endif
				call SaveInteger(HY, h, 6, ILR + 1)
			endif
			call SaveInteger(HY, h, 0, c + 2)
		endif
		call TriggerRegisterTimerEvent(t, 20, false)
		call IXR(20)
	else
		call SaveBoolean(HY, h, 0, true)
		call TriggerRegisterTimerEvent(t, 20, false)
	endif
	set t = null
	return false
endfunction
// takes integer c, unit u, integer h
function IPR takes nothing returns nothing
	local integer i = 0
	local integer ZKE
	local integer te
	local unit u = U2
	local integer c = Temp__ArrayInt[0]
	local integer h = Temp__ArrayInt[1]
	set FP[i]= false
	set PlayerSkillIndex[1]= 0
	set PlayerSkillIndex[2]= 0
	set PlayerSkillIndex[3]= 0
	set PlayerSkillIndex[4]= 0
	set PlayerSkillIndex[5]= 0
	set PlayerSkillIndex[6]= 0

	loop
	exitwhen FP[i]
		set ZKE =(GetRandomInt(1, GL * 4))
		set te =((ZKE + 3)/ 4)
		call SaveInteger(HY,'0REA','0PID', i)
		call SaveInteger(HY,'0REA','0SID', ZKE)
		call SaveBoolean(HY,'0REA','000B', false)
		call SaveUnitHandle(HY,'0REA','000U', u)
		call ExecuteFunc("SPO")
	endloop
	call SaveInteger(HY, h, 100 * c + 1, PlayerSkillIndex[1])
	call SaveInteger(HY, h, 100 * c + 2, PlayerSkillIndex[2])
	call SaveInteger(HY, h, 100 * c + 3, PlayerSkillIndex[3])
	call SaveInteger(HY, h, 100 * c + 4, PlayerSkillIndex[4])
	call SaveInteger(HY, h, 100 * c + 5, PlayerSkillIndex[5])
	call SaveInteger(HY, h, 100 * c + 6, PlayerSkillIndex[6])
	call UnitAddAbility(u, QGX(HeroCommonSkills[PlayerSkillIndex[1]]))
	call SetUnitAbilityLevel(u, QGX(HeroCommonSkills[PlayerSkillIndex[1]]), 4)
	call UnitAddAbility(u, QGX(HeroCommonSkills[PlayerSkillIndex[2]]))
	call SetUnitAbilityLevel(u, QGX(HeroCommonSkills[PlayerSkillIndex[2]]), 4)
	call UnitAddAbility(u, QGX(HeroCommonSkills[PlayerSkillIndex[3]]))
	call SetUnitAbilityLevel(u, QGX(HeroCommonSkills[PlayerSkillIndex[3]]), 4)
	call UnitAddAbility(u, QGX(HeroCommonSkills[PlayerSkillIndex[4]]))
	call SetUnitAbilityLevel(u, QGX(HeroCommonSkills[PlayerSkillIndex[4]]), 4)
	
	//call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "循环:"+I2S( c ) + " 技能名" + GetObjectName( QGX(HeroCommonSkills[PlayerSkillIndex[4]]) ))
	if ExtraSkillsNumber > 0 then
		call UnitAddAbility(u, QGX(HeroCommonSkills[PlayerSkillIndex[5]]))
		call SetUnitAbilityLevel(u, QGX(HeroCommonSkills[PlayerSkillIndex[5]]), 4)
		call SaveInteger(HY, GetHandleId(u),'RDIN'+ 5, PlayerSkillIndex[5])
	endif
	if ExtraSkillsNumber > 1 then
		call UnitAddAbility(u, QGX(HeroCommonSkills[PlayerSkillIndex[6]]))
		call SetUnitAbilityLevel(u, QGX(HeroCommonSkills[PlayerSkillIndex[6]]), 4)
		call SaveInteger(HY, GetHandleId(u),'RDIN'+ 6, PlayerSkillIndex[6])
	endif
	call SaveInteger(HY, GetHandleId(u),'RDIN'+ 1, PlayerSkillIndex[1])
	call SaveInteger(HY, GetHandleId(u),'RDIN'+ 2, PlayerSkillIndex[2])
	call SaveInteger(HY, GetHandleId(u),'RDIN'+ 3, PlayerSkillIndex[3])
	call SaveInteger(HY, GetHandleId(u),'RDIN'+ 4, PlayerSkillIndex[4])

	set u = null
endfunction
// 初始化 随机征召
function InitMode__RandomDraft takes nothing returns nothing
	local integer array QSX
	local integer i = 1
	local integer iHeroIndex = 0
	local unit u
	local real x
	local real y
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local fogmodifier fm
	local timer OLR = CreateTimer()
	call TimerStart(OLR, 180, false, function OCR)
	set OLR = null
	call IAR(h,-7000, 7080)
	// 设置选择英雄状态为否
	set IsPickingHero = false
	set IY = false
	set RY = false
	// 隐藏原本的酒馆
	call ShowUnit(EVV, false)
	call ShowUnit(EEV, false)
	call ShowUnit(EXV, false)
	call ShowUnit(EOV, false)
	call ShowUnit(ERV, false)
	call ShowUnit(EIV, false)
	call ShowUnit(EAV, false)
	call ShowUnit(ENV, false)
	call ShowUnit(EBV, false)
	call ShowUnit(ECV, false)
	call ShowUnit(EDV, false)
	call ShowUnit(EFV, false)
	// 创建单位
	loop
		loop
			set iHeroIndex = GetRandomInt(1, GL)
		exitwhen not HaveSavedBoolean(HY,'00RD', iHeroIndex)
		endloop
		call SaveBoolean(HY,'00RD', iHeroIndex, true)
		set x =-7030 + 450 * Cos(i *(360. / XT * 1.)* bj_DEGTORAD)
		set y = 6766 + 450 * Sin(i *(360. / XT * 1.)* bj_DEGTORAD)
		set u = CreateUnit(Player(15), RX[iHeroIndex], x, y, AngleBetweenXY(x, y,-7030, 6766))
		call SetUnitPathing(u, false)
		call SetUnitPosition(u, x, y)
		call SetUnitUserData(u, iHeroIndex)
		call SaveUnitHandle(HY, h, 50 + i, u)
		set QSX[i]= iHeroIndex
		call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SELL)
		set U2 = u
		set Temp__ArrayInt[0] = i
		set Temp__ArrayInt[1] = h
		// call IPR(i, u, h)
		call ExecuteFunc("IPR")
		call SaveInteger(HY, GetHandleId(u), 0, i)
		set i = i + 1
	exitwhen i > XT
	endloop
	set fm = CreateFogModifierRadius(SentinelPlayers[1], FOG_OF_WAR_VISIBLE,-7030, 6766, 900, true, true)
	call SaveFogModifierHandle(HY, h, 220, fm)
	call FogModifierStart(fm)
	set fm = CreateFogModifierRadius(ScourgePlayers[1], FOG_OF_WAR_VISIBLE,-7030, 6766, 900, true, true)
	call SaveFogModifierHandle(HY, h, 221, fm)
	call FogModifierStart(fm)
	set fm = null
	// 对RD的英雄进行沉默
	set u = CreateUnit(ScourgePlayers[0],'e00E',-7030, 6766, 0)
	call UnitAddAbility(u,'A457')
	call IssuePointOrderById(u, 852592,-7030, 6766)
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 20, "所有玩家在开始挑选英雄前都有60秒的准备时间")
	call TriggerRegisterTimerEvent(t, 60, false)
	call TriggerAddCondition(t, Condition(function IJR))
	if Mode__FastNeutrals then
		set t = CreateTrigger()
		call TriggerRegisterTimerEvent(t, 210, false)
		call TriggerAddCondition(t, Condition(function SpawnAllNeutralCreepsAction))
		set t = null
	endif
	set t = null
	set u = null
endfunction
function ISR takes nothing returns nothing
	local string mn = NY
	local trigger t
	local timer OLR
	// 死亡竞赛模式或者全部随机 那就立即开始游戏(不需要选英雄)
	if mn == GetObjectName('n0I7') or mn == GetObjectName('n0II') then
		set MainModeName = "ar"
		set IsPickingHero = false
		// 游戏开始时添加贩卖经验书和假眼
		call AddUnitToStock(ScourgeTombOfRelics,'h02C', 2, 4)	
		call AddUnitToStock(SentinelAncientOfWonders,'h02C', 2, 4)
		call AddUnitToStock(SentinelPigKing,'n139', 0, 3) 		
		call AddUnitToStock(ScourgePigKing,'n139', 0, 3)
		call ODR()
		set OLR = CreateTimer()
		call TimerStart(OLR, 70, false, function OCR)
		set OLR = null
		// 如果允许立即刷野 那就刷野罢
		if Mode__FastNeutrals then
			call SpawnAllNeutralCreepsAction()
			set t = CreateTrigger()
			call TriggerRegisterTimerEvent(t, 30, false)
			call TriggerRegisterTimerEvent(t, 90, false)
			call TriggerAddCondition(t, Condition(function SpawnAllNeutralCreepsAction))
			set t = null
		endif
	elseif mn == GetObjectName('n0ID') then
		set MainModeName = "ap"
		call QUX()
		if Mode__RandomExtraAbilities then
			call IVR()
		endif
	elseif mn == GetObjectName('n0IF') then
		set MainModeName = "rd"
		// 直接运行似乎会遇到字节码上限
		call ExecuteFunc("InitMode__RandomDraft")
	elseif mn == GetObjectName('n0I4') then
		set MainModeName = "sd"
		call R9R()
		if Mode__RandomExtraAbilities then
			call IVR()
		endif
	elseif mn == GetObjectName('n0I0') then
		set MainModeName = "md"
		call RYR()
		if Mode__RandomExtraAbilities then
			call IVR()
		endif
	endif
endfunction
function ITR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u
	if GetGameTime()> LoadReal(HY, h, 0) or GetUnitAbilityLevel(LoadUnitHandle(HY, h, 0),'QH00') == 0 then
		set u = LoadUnitHandle(HY, h, 0)
		call UnitRemoveAbility(u,'C104')
		call UnitRemoveAbility(u,'C105')
		call UnitRemoveAbility(u,'C106')
		call UnitRemoveAbility(u,'C107')
		call UnitRemoveAbility(u,'QH00')
		call UnitRemoveAbility(u,'D107')
		call RemoveSavedHandle(HY, GetHandleId(u),'A0MG')
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
		set u = null
	endif
	set t = null
endfunction
function IUR takes unit R8X, unit targetUnit returns nothing
	local timer t = LoadTimerHandle(HY, GetHandleId(targetUnit),'A0MG')
	local integer h
	if t != null then
		set h = GetHandleId(t)
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, .1, true, function ITR)
		call UnitAddPermanentAbility(targetUnit,'C103'+ GetUnitAbilityLevel(R8X,'A0MG'))
		call UnitAddPermanentAbility(targetUnit,'QH00')
		call SaveUnitHandle(HY, h, 0, targetUnit)
		call SaveTimerHandle(HY, GetHandleId(targetUnit),'A0MG', t)
	endif
	call SaveReal(HY, h, 0, GetGameTime()+ 2.5)
	set t = null
endfunction
// 霜之哀伤
function IWR takes unit u, unit t returns nothing
	local integer WUV = GetUnitAbilityLevel(u,'A0MG')
	if IsUnitType(u, UNIT_TYPE_STRUCTURE) or IsUnitType(t, UNIT_TYPE_STRUCTURE) or IsUnitAlly(u, GetOwningPlayer(t)) then
		return
	endif
	if WUV > 0 then
		call UnitAddAbilityLevel1ToTimed(u,'C107'+ WUV,'D105', 4.5)
		return
	endif
	if GetUnitAbilityLevel(t,'D107') == 1 then
		set WUV = GetUnitAbilityLevel(t,'C104')+ 2 * GetUnitAbilityLevel(t,'C105')+ 3 * GetUnitAbilityLevel(t,'C106')+ 4 * GetUnitAbilityLevel(t,'C107')
		if WUV > 4 then
			set WUV = 4
		endif
		if WUV > 0 then
			call UnitAddAbilityLevel1ToTimed(u,'C107'+ WUV,'D105', 4.5)
		endif
	endif
endfunction
// 注册A杖升级 normalId changeId upgradeId AghanimUpgradeMaxIndex
// 通过GetSkillAghanimUpgradeIndex来获得技能的神杖升级索引
function RegisterAghanimUpgrade takes integer normalId, integer changeId, integer upgradeId, integer whichInteger returns nothing
	// 获取原本技能的索引()
	local integer id = GetNormalSkillIndex(normalId)
	// 原本技能
	set AghanimUpgradeNormalId[AghanimUpgradeMaxIndex] = normalId
	// 神杖升级的工程升级技能
	set AghanimUpgradeChangeId[AghanimUpgradeMaxIndex] = changeId
	call SetAllPlayerAbilityUnavailable(changeId)
	// 神杖升级后的技能
	set AghanimUpgradeUpgradeId[AghanimUpgradeMaxIndex] = upgradeId
	// 未引用 参数都是0
	set AghanimUpgradeUnknownId[AghanimUpgradeMaxIndex] = whichInteger
	if id > 0 and HeroUpgradeSkills[id]== 0 then
		set HeroUpgradeSkills[id]= upgradeId
	endif
	set AghanimUpgradeMaxIndex = AghanimUpgradeMaxIndex + 1
endfunction
// 注册被动技能
// 第一个参数为真实的技能(用这个判断)(在魔法书里面不显示)
// 第二个参数为魔法书马甲技能(会被禁用)
// 第三个参数为被学习的技能 被学习技能等级为0就说明没这个技能
// 第四个参数为技能提供的Buff(没有就是0)
// 第五个参数为显示的马甲技能(没有作用只是显示，会被-sp隐藏)
// 第六个参数为幻象出生时添加的技能
// YD为最大被动数量
function RegisterPassiveSkills takes integer iRealSkill, integer iSpellBookSkill, integer iLearnedSkill, integer iSkillBuff, integer iShowSkill, integer iillusionUnitSkill returns nothing
	set PassiveAbilityMaxCount = PassiveAbilityMaxCount + 1
	set PassiveSkills_Real[PassiveAbilityMaxCount]= iRealSkill
	set PassiveSkills_SpellBook[PassiveAbilityMaxCount]= iSpellBookSkill
	set PassiveSkills_Learned[PassiveAbilityMaxCount]= iLearnedSkill
	set PassiveSkills_Buff[PassiveAbilityMaxCount]= iSkillBuff
	set PassiveSkills_Show[PassiveAbilityMaxCount]= iShowSkill
	set PassiveSkills_illusion[PassiveAbilityMaxCount]= iillusionUnitSkill
	call SetAllPlayerAbilityUnavailable(iSpellBookSkill)
endfunction

// 设置幻象的技能
function SyncIllusionUnitSkills takes unit illusionUnit, unit summoningUnit returns nothing
	local integer i = 1
	local integer lv
	loop
		set lv = GetUnitAbilityLevel(summoningUnit, PassiveSkills_Learned[i])
		if PassiveSkills_Real[i]=='P084' then
			set lv = GetUnitAbilityLevel(summoningUnit,'A0DB')
		endif
		if lv == 0 then
			if PassiveSkills_SpellBook[i]> 0 or PassiveSkills_Real[i]> 0 then
				call UnitRemoveAbility(illusionUnit, PassiveSkills_Real[i])
				call UnitRemoveAbility(illusionUnit, PassiveSkills_SpellBook[i])
				call UnitRemoveAbility(illusionUnit, PassiveSkills_Buff[i])
			endif
		else
			if PassiveSkills_SpellBook[i]> 0 or PassiveSkills_Real[i]> 0 then
				call UnitAddPermanentAbility(illusionUnit, PassiveSkills_SpellBook[i])
				call UnitMakeAbilityPermanent(illusionUnit, true, PassiveSkills_Real[i])
				call UnitAddPermanentAbility(illusionUnit, PassiveSkills_Show[i])
				if PassiveSkills_illusion[i]> 0 then
					call UnitAddPermanentAbility(illusionUnit, PassiveSkills_illusion[i])
					call SetUnitAbilityLevel(illusionUnit, PassiveSkills_illusion[i], lv)
				endif
				call SetUnitAbilityLevel(illusionUnit, PassiveSkills_Real[i], lv)
				if PassiveSkills_SpellBook[i]=='A23F' then
					call SetUnitAbilityLevel(illusionUnit,'A1ER', lv)
					call UnitAddPermanentAbility(illusionUnit,'A1ER')
					call SetUnitAbilityLevel(illusionUnit,'A1ER', lv)
				endif
			endif
			// 瞄准
			if PassiveSkills_Learned[i] == 'A03U' then
				set U2 = illusionUnit
				set Q2 = lv
				call ExecuteFunc("range_Take_Aim")
			elseif PassiveSkills_Learned[i] == 'A0RO' then
				// ta被动
				set U2 = illusionUnit
				set Q2 = lv
				call ExecuteFunc("range_Psi_Blades")
			elseif PassiveSkills_Learned[i]=='A0CL' then
				set U2 = illusionUnit
				set Q2 = lv
				call ExecuteFunc("SyncIllusionUnitDragonBlood")
			endif
		endif
		set i = i + 1
	exitwhen i > PassiveAbilityMaxCount
	endloop
	call RefreshUnitRange(illusionUnit)
	// 如果幻象是变身单位 直接播放单位的变身Stand 否则被认出来太蠢
	if UnitTypeIsMetamorphosis(illusionUnit) or WTB(illusionUnit) then
		// call BJDebugMsg("幻象是变身单位")
		call AddUnitAnimationProperties(illusionUnit, "alternate", true)
		call SetUnitAnimation(illusionUnit, "stand alternate")
	endif
endfunction

// 0s后再设置单位缩放 否则不生效
function Wait0sSetUnitScale takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer iHandleId = GetHandleId(trig)
	local unit whichUnit = LoadUnitHandle( HY, iHandleId, 0 )

	call SetUnitCurrentScaleEx( whichUnit, GetUnitCurrentScale(whichUnit) )
	// call SetUnitAnimation( whichUnit, "stand upgrade" )
	call FlushChildHashtable(HY, iHandleId)
	call CleanCurrentTrigger(trig)
	set trig = null
	return false
endfunction
// 镜像被召唤事件
function SummonedIllusionUnitEvnet takes nothing returns boolean
	local unit    illusionUnit    = GetSummonedUnit()
	local integer trigPlayerId    = GetPlayerId(GetOwningPlayer(illusionUnit))
	local unit    summoningUnit   = null
	local integer summoningTypeId
	local real    hp
	if not IsUnitIllusion(illusionUnit) or GetUnitTypeId(illusionUnit)< 1 then
		set illusionUnit = null
		return false
	endif
	set summoningUnit = LoadUnitHandle(HY, GetHandleId(GetSummoningUnit()),'0ILU')
	if GetUnitAbilityLevel(illusionUnit,'B0EN')> 0 then
		set trigPlayerId = TempInt
	endif
	if summoningUnit != null then
		set trigPlayerId = GetPlayerId(GetOwningPlayer(summoningUnit))
	else
		set summoningUnit = Player__Hero[trigPlayerId]
	endif
	call SaveUnitHandle(HY, GetHandleId(illusionUnit),'0ILU', summoningUnit)
	// 这里似乎是判断一下是否有变体精灵的镜像
	set summoningTypeId = GetUnitTypeId(summoningUnit)
	if GetUnitTypeId(illusionUnit) != summoningTypeId then
		set hp = GetUnitState(illusionUnit, UNIT_STATE_MAX_LIFE)
		call UnitMakeAbilityPermanent(illusionUnit, true,'A09J')
		// 原本是极低效率的一大堆马甲技能，改成了japi的逆变身
		call YDWEUnitTransform(illusionUnit, summoningTypeId)
		// 然后同步下最大生命值
		call SetUnitState(illusionUnit, UNIT_STATE_MAX_LIFE, hp)
	endif
	// 同步一下幻象单位的技能 不然可能会有奇怪现象(一堆被动技能)
	call SyncIllusionUnitSkills(illusionUnit, summoningUnit)
	// 同步射手天赋给幻象
	if GetUnitAbilityLevel(summoningUnit,'A0VC')> 0 then
		call SaveUnitHandle(OtherHashTable2,'ILLU', 0, illusionUnit)
		call SaveUnitHandle(OtherHashTable2,'ILLU', 1, summoningUnit)
		call ExecuteFunc("I8R")
	endif
	// 幻象的协同升级
	if GetUnitAbilityLevel(Player__Hero[trigPlayerId],'A0A8')> 0 then
		call UnitAddPermanentAbilitySetLevel(illusionUnit,'A3L3', GetUnitAbilityLevel(Player__Hero[trigPlayerId],'A0A8'))
	endif
	// 同步长大技能
	if a_fx_b[trigPlayerId] and GetUnitTypeId(illusionUnit) == 'Ucrl' and GetUnitAbilityLevel(summoningUnit,'A2KK')> 0 then
		// 小小模型有A就拿棒子
		call AddUnitAnimationProperties(illusionUnit, "upgrade", true)
	endif
	// 长大等级
	if GetUnitAbilityLevel(summoningUnit,'A0CY')> 0 then
		set Temp__Int = CreateTimerEventTrigger( .0, false, function Wait0sSetUnitScale ) 
		call SaveUnitHandle( HY, Temp__Int, 0, illusionUnit )
		// call SaveReal( HY, Temp__Int, 1, 1 + .25 *  GetUnitAbilityLevel(summoningUnit,'A0CY') )
		call SaveReal( ExtraHT, GetHandleId(illusionUnit), HTKEY_UNIT_CURRENT_ADDSCALE, GetUnitAbilityLevel(summoningUnit,'A0CY') * 0.25 )
		// 模型缩放
		// call SetUnitCurrentScaleEx(illusionUnit, )
	endif
	if ( GetItemOfTypeFromUnit(illusionUnit, XOV[it_mlq]) != null ) or ( GetItemOfTypeFromUnit(illusionUnit, XOV[Item_HurricanePike]) != null ) then
		call AddUnitBonusRange(illusionUnit, 140., true)
	endif
	set illusionUnit  = null
	set summoningUnit = null
	return false
endfunction

function AER takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit KKX = LoadUnitHandle(HY, h, 1)
	if UnitAlive(u) then
		if KKX == null or IsUnitType(u, UNIT_TYPE_HERO) then
			if GetUnitCurrentOrder(u)== 852558 then
				call SaveUnitHandle(HY, h, 1, GetOrderTargetUnit())
			endif
		else
			if GetUnitDistanceEx(u, KKX)> 1500 then
				if GetUnitCurrentOrder(u)== 852557 then
					call SetUnitPosition(u, GetUnitX(KKX), GetUnitY(KKX))
					call IssueImmediateOrderById(u, 852557)
				elseif GetUnitCurrentOrder(u)== 852558 then
					call SetUnitPosition(u, GetUnitX(KKX), GetUnitY(KKX))
					call IssueTargetOrderById(u, 852558, KKX)
				endif
			endif
		endif
	else
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	endif
	set u = null
	set t = null
endfunction
function AXR takes unit u returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .02, true, function AER)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveUnitHandle(HY, h, 1, Player__Hero[GetPlayerId(GetOwningPlayer(u))])
	set t = null
endfunction
function AOR takes nothing returns boolean
	return GetUnitAbilityLevel(GetFilterUnit(),'B0HL')> 0 and IsUnitAlly(GetFilterUnit(), E3) and IsAliveNotStrucNotWard(GetFilterUnit())
endfunction
function GraniteAura__Actions takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group AIR = LoadGroupHandle(HY, h, 1)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit u2
	local group g
	local group gg
	local integer AAR
	local integer ANR
	if not UnitAlive(u) or u == null then
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
		loop
			set u2 = FirstOfGroup(AIR)
		exitwhen u2 == null
			call GroupRemoveUnit(AIR, u2)
			call UnitAddMaxLife(u2,-1 * LoadInteger(ObjectHashTable, GetHandleId(u2),'BHPA'))
			call SaveInteger(ObjectHashTable, GetHandleId(u2),'BHPA', 0)
			call UnitRemoveAbility(u2,'B0HL')
		endloop
		call DeallocateGroup(AIR)
	else
		set g = AllocationGroup(113)
		set E3 = GetOwningPlayer(u)
		call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 925, Condition(function AOR))
		set gg = AllocationGroup(114)
		call GroupAddGroup(AIR, gg)
		loop
			set u2 = FirstOfGroup(gg)
		exitwhen u2 == null
			if IsUnitInGroup(u2, g) == false then
				call GroupRemoveUnit(AIR, u2)
				call UnitAddMaxLife(u2,-1 * LoadInteger(ObjectHashTable, GetHandleId(u2),'BHPA'))
				call SaveInteger(ObjectHashTable, GetHandleId(u2),'BHPA', 0)
				call UnitRemoveAbility(u2,'B0HL')
			endif
			call GroupRemoveUnit(gg, u2)
		endloop
		call DeallocateGroup(gg)
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			set ANR = LoadInteger(ObjectHashTable, GetHandleId(u2),'BHPA')
			set AAR = R2I(R2I(GetUnitState(u2, UNIT_STATE_MAX_LIFE)-ANR)* .15)
			if ANR != 0 then
				if ANR != AAR then
					call UnitAddMaxLife(u2, AAR -ANR)
				endif
			else
				call UnitAddMaxLife(u2, AAR)
			endif
			call SaveInteger(ObjectHashTable, GetHandleId(u2),'BHPA', AAR)
			call GroupRemoveUnit(g, u2)
			call GroupAddUnit(AIR, u2)
		endloop
		call DeallocateGroup(g)
	endif
	set t = null
	set AIR = null
	set u = null
	set g = null
	set gg = null
endfunction
// 宝石傀儡光环
function UnitAddGraniteAura takes unit u returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .5, true, function GraniteAura__Actions)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveGroupHandle(HY, h, 1, AllocationGroup(115))
	set t = null
endfunction
function ADR takes string ZBO returns boolean
	if ZBO == "-ma"or ZBO == "-ms"or ZBO == "-cs"or ZBO == "-cson"or ZBO == "-disablehelp"or ZBO == "-enablehelp"or ZBO == "-unstuck"or ZBO == "-recreate"then
		return true
	elseif ZBO == "-swaphero"or ZBO == "-showmsg"or ZBO == "-hidemsg"or ZBO == "-showdeny"or ZBO == "-hidedeny"or ZBO == "-weather rain"or ZBO == "-weather snow"or ZBO == "-weather moonlight"or ZBO == "-weather wind"or ZBO == "-weather random"or ZBO == "-weather off"or ZBO == "-denyinfo"or ZBO == "-di"or ZBO == "-deathon"or ZBO == "-don"or ZBO == "-deathoff"or ZBO == "-doff"or ZBO == "-roll"or ZBO == "-hideheronames"or ZBO == "-hhn"or ZBO == "-test"or ZBO == "-mute"or ZBO == "-wtf"or ZBO == "-fleshstr"or ZBO == "-fs"or ZBO == "-switchon"then
		return true
	endif
	return false
endfunction
function AFR takes nothing returns boolean
	return not GS
endfunction
function AddMainModeName takes string AHR returns nothing
	if UW == ""then
		set UW = "|c006699CC" + AHR + "|r"
	else
		set UW = UW + "/|c006699CC" + AHR + "|r"
	endif
endfunction
function AddModeName takes string s returns nothing
	if UW == "" then
		set UW = "|c00C83264" + s + "|r"
	else
		set UW = UW + "/|c00C83264" + s + "|r"
	endif
endfunction
function AKR takes string ALR, integer AMR, integer APR returns string
	return SubString(ALR, 0, AMR)+ SubString(ALR, APR, StringLength(ALR))
endfunction
function AQR takes string ALR returns string
	return StringCase(SubString(ALR, 1, StringLength(ALR)), false)
endfunction
function ASR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	//local string s = LoadStr(HY, GetHandleId(t), 0)
	call ExecuteFunc("InitAghanimScepterUpgrade1")
	call ExecuteFunc("InitAghanimScepterUpgrade2")
	//call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTimer(t)
	set t = null
endfunction
function AWR takes nothing returns nothing
	call TimerStart(CreateTimer(), .5, false, function ASR)
endfunction
function ShowGameStartTopTips takes nothing returns nothing
	local string array tipList
	local integer randomTipIndex = GetRandomInt(1, 3)
	set tipList[1] = " |CFFFF8000 能量圈有改键指令的提示 |R  "
	set tipList[2] = " |CFFFF8000 输入 \"-更新\" 来查看更新日志 |R "
	set tipList[3] = " |CFFFF0000 F10菜单栏地图设置内可以进行游戏设置|R "

	call SetTopMessageText(tipList[randomTipIndex], 10)
endfunction
function AYR takes string AZR, integer A_R returns nothing
	local string EVR = AQR(AZR)
	local string array CGD
	local string array A0R
	local boolean array A1R
	local integer Z6X
	local integer A2R = StringLength(EVR)
	local integer x = 0
	local integer y = 0
	local integer z = 0
	local trigger t
	local boolean AP = false
	local boolean AR = false
	local boolean LM = false
	local boolean MM = false
	local boolean TR = false
	local boolean DM = false
	local boolean MR = false
	local boolean SP = false
	local boolean AA = false
	local boolean AI = false
	local boolean AS = false
	local boolean ID = false
	local boolean NP = false
	local boolean SC = false
	local boolean EM = false
	local boolean DU = false
	local boolean SH = false
	local boolean VR = false
	local boolean RV = false
	local boolean RD = false
	local boolean OM = false
	local boolean NT = false
	local boolean NB = false
	local boolean NM = false
	local boolean NS = false
	local boolean NR = false
	local boolean XL = false
	local boolean SD = false
	local boolean PM = false
	local boolean OI = false
	local boolean MI = false
	local boolean CM = false
	local boolean FR = false
	local boolean MO = false
	local boolean RO = false
	local boolean CD = false
	local boolean RS = false
	local boolean CP = false
	local boolean ZM = false
	local boolean UB = false
	local boolean UL = false
	local boolean SS = false
	local boolean AB = false
	local boolean S5 = false
	local boolean S6 = false
	local boolean FN = false
	local boolean D2 = false
	local boolean D3 = false
	local boolean D4 = false
	local boolean D5 = false
	local boolean OS = false
	local boolean BO = false
	local boolean MD = false
	local boolean RA = false
	local boolean LS = false
	local boolean A3R = false
	local boolean DFF = false
	local boolean A4R = false
	local boolean A5R = false
	local boolean A6R = false
	local boolean RC = false
	local boolean AH = false
	local boolean NN = false
	local boolean SO = false
	local boolean M1 = false
	local boolean MM2 = false
	local boolean MM5 = false
	set EP = EVR
	set A0R[1]= "ap"
	set A0R[2]= "ar"
	set A0R[3]= "dm"
	set A0R[4]= "sp"
	set A0R[5]= "aa"
	set A0R[6]= "ai"
	set A0R[7]= "as"
	set A0R[8]= "id"
	set A0R[9]= "np"
	set A0R[10]= "sc"
	set A0R[11]= "em"
	set A0R[12]= "du"
	set A0R[13]= "sh"
	set A0R[14]= "om"
	set A0R[15]= "nm"
	set A0R[16]= "nt"
	set A0R[17]= "nb"
	set A0R[18]= "ns"
	set A0R[19]= "nr"
	set A0R[20]= "sd"
	set A0R[21]= "pm"
	set A0R[22]= "oi"
	set A0R[23]= "mi"
	set A0R[24]= "fr"
	set A0R[25]= "mo"
	set A0R[26]= "ro"
	set A0R[27]= "zm"
	set A0R[28]= "ul"
	set A0R[29]= "ss"
	set A0R[30]= "ab"
	set A0R[31]= "s5"
	set A0R[32]= "s6"
	set A0R[33]= "fn"
	set A0R[34]= "d2"
	set A0R[35]= "d3"
	set A0R[36]= "d4"
	set A0R[37]= "d5"
	set A0R[38]= "os"
	set A0R[39]= "bo"
	set A0R[40]= "md"
	set A0R[41]= "ra"
	set A0R[42]= "3ls"
	set A0R[43]= "ls"
	set A0R[44]= "ff"
	set A0R[45]= "eb"
	set A0R[46]= "fh"
	set A0R[47]= "ma"
	set A0R[48]= "rc"
	set A0R[49]= "rd"
	set A0R[50]= "ah"
	set A0R[51]= "nn"
	set A0R[52]= "so"
	
	set A0R[53]= "m1"
	set A0R[54]= "m2"
	set A0R[55]= "m5"
	set A0R[55]= "m5"
	set Z6X = 55
	set x =-1
	loop
	exitwhen x == A2R -1
		set x = x + 1
		set y = x
		loop
		exitwhen y == A2R
			set y = y + 1
			set z = 1
			loop
			exitwhen z > Z6X
				if A0R[z]== SubString(EVR, x, y) then
					set A1R[z]= true
					set z = Z6X + 1
					set EVR = AKR(EVR, x, y)
					set x =-1
					set A2R = StringLength(EVR)
					set y = A2R
				else
					set z = z + 1
				endif
			endloop
		endloop
	endloop
	set AP = A1R[1]
	set AR = A1R[2]
	set DM = A1R[3]
	set SP = A1R[4]
	set AA = A1R[5]
	set AI = A1R[6]
	set AS = A1R[7]
	set ID = A1R[8]
	set NP = A1R[9]
	set SC = A1R[10]
	set EM = A1R[11]
	set DU = A1R[12]
	set SH = A1R[13]
	set OM = A1R[14]
	set NM = A1R[15]
	set NT = A1R[16]
	set NB = A1R[17]
	set NS = A1R[18]
	set NR = A1R[19]
	set SD = A1R[20]
	set PM = A1R[21]
	set OI = A1R[22]
	set MI = A1R[23]
	set FR = A1R[24]
	set MO = A1R[25]
	set RO = A1R[26]
	set ZM = A1R[27]
	set UL = A1R[28]
	set SS = A1R[29]
	set AB = A1R[30]
	set S5 = A1R[31]
	set S6 = A1R[32]
	set FN = A1R[33]
	set D2 = A1R[34]
	set D3 = A1R[35]
	set D4 = A1R[36]
	set D5 = A1R[37]
	set OS = A1R[38]
	set BO = A1R[39]
	set MD = A1R[40]
	set RA = A1R[41]
	set A3R = A1R[42]
	set LS = A1R[43]
	set DFF = A1R[44]
	set A5R = A1R[45]
	set A4R = A1R[46]
	set A6R = A1R[47]
	set RC = A1R[48]
	set RD = A1R[49]
	set AH = A1R[50]
	set NN = A1R[51]
	set SO = A1R[52]
	set M1 = A1R[53]
	set MM2 = A1R[54]
	set MM5 = A1R[55]
	if EVR != ""or ADR(AZR) then
		return
	endif
	if A3R and LS then
		call InterfaceErrorForPlayer(HostPlayer, GetObjectName('n02U'))
		return
	endif
	if (AR and(AP or SD or MD)) then
		call InterfaceErrorForPlayer(HostPlayer, GetObjectName('n02U'))
		return
	endif
	if (AA and(AI or AS or DM)) or(AS and(AI or DM)) or(AI and DM) then
		call InterfaceErrorForPlayer(HostPlayer, GetObjectName('n02U'))
		return
	endif
	if (RO and(MO or DM)) or(MO and DM) then
		call InterfaceErrorForPlayer(HostPlayer, GetObjectName('n02U'))
		return
	endif
	if (DM and(SH or SD or MD)) or(SH and DM) then
		call InterfaceErrorForPlayer(HostPlayer, GetObjectName('n02T'))
		return
	endif
	if SD and(AP or AR or DM or SH or RO or MO or MD) then
		call InterfaceErrorForPlayer(HostPlayer, GetObjectName('n02U'))
		return
	endif
	if S5 and S6 then
		call InterfaceErrorForPlayer(HostPlayer, "模式 <s5> 和 <s6> 不能叠加。")
		return
	endif
	if RA and not(S5 or S6) then
		call InterfaceErrorForPlayer(HostPlayer, "模式 <ra> 仅适用于 <s5> 和 <s6>。")
		return
	endif
	if RA and not(AP or SD or MD) then
		call InterfaceErrorForPlayer(HostPlayer, "模式 <ra> 仅适用于 <sd>, <ap> 和 <md>。")
		return
	endif
	if (D2 and(D3 or D4 or D5)) or(D3 and(D2 or D4 or D5)) or(D4 and(D2 or D3 or D5)) or(D5 and(D2 or D3 or D4)) then
		call InterfaceErrorForPlayer(HostPlayer, "模式 <d#> 不能叠加。")
		return
	endif
	if not(SD or MD or RD) and(D2 or D3 or D4 or D5) then
		call InterfaceErrorForPlayer(HostPlayer, "模式 <d#> 仅适用于 <sd>, <rd> 和 <md>。")
		return
	endif
	if not(AP or SD or MD) and SS then
		call InterfaceErrorForPlayer(HostPlayer, "模式 <ss> 仅适用于 <sd>, <ap> 和 <md>。")
		return
	endif
	if not(AP or SD or MD or AR) and SP then
		call InterfaceErrorForPlayer(HostPlayer, "模式 -sp 仅适用于 <sd>, <ap>, <ar> 和 <md>。")
		return
	endif
	if AP or AR or SD or MD or RD then
		call DisableTrigger(GHV)
	else
		return
	endif
	call XZX()
	call JIO()
	call LKO()
	set GS = true
	set GameModeString = AQR(AZR)
	if GGV then
		call StoreDrCacheData("Mode" + GameModeString, 0)
	else
		call StoreDrCacheData("Mode" + GameModeString, GetPlayerId(HostPlayer))
	endif
	set YW = false
	if DM then
		set NY = GetObjectName('n0II')
	elseif AP then
		set NY = GetObjectName('n0ID')
	elseif AR then
		set NY = GetObjectName('n0I7')
	elseif SD then
		set NY = GetObjectName('n0I4')
	elseif MD then
		set NY = GetObjectName('n0I0')
	elseif RD then
		set NY = GetObjectName('n0IF')
	endif
	if MD then
		set HOV = true
		call AddModeName("镜像模式")
		set Mode__FastFinish = true
		call AddModeName("快速结束")
		set Mode__AntiHack = true
		call AddModeName("反作弊")
	endif
	if RD then
		set ET = true
		if D2 then
			set XT = XT + 4
		elseif D3 then
			set XT = XT + 8
		elseif D4 then
			set XT = XT + 12
		elseif D5 then
			set XT = XT + 16
		endif
		call AddMainModeName("随机征召")
	endif
	if DM then
		call AddMainModeName(GetObjectName('n0IA'))
	endif
	if AP then
		call AddMainModeName(GetObjectName('n0IL'))
		set Mode__FastFinish = true
		call AddModeName("快速结束")
		set Mode__AntiHack = true
		call AddModeName("反作弊")
	endif
	if M1 then
		set Mode__FastFinish = true
		call AddModeName("快速结束")
		set Mode__AntiHack = true
		call AddModeName("反作弊")
		call AddModeName("天朝平衡")
		set Mode__BalanceOff = true
		call AddModeName("快速刷野")
		set Mode__FastNeutrals = true
		call AddModeName("六技能")
		set ExtraSkillsNumber = 2
		call JIO()
		set Mode__SixSkills = true
		call UnitAddAbility(ScourgeFountainOfLifeUnit,'ACrk')
		call UnitAddAbility(SentinelFountainOfLifeUnit,'ACrk')
		call UnitAddAbility(ScourgeFountainOfLifeUnit,'A1BY')
		call UnitAddAbility(SentinelFountainOfLifeUnit,'A1BY')
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第5个技能将在<5>, <8>, <11>, <14>级时自动升级" + "|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第6个技能将在<8>, <13>, <18>级时自动升级" + "|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
	endif
	if MM2 then
		set Mode__Draft20 = true
		call AddModeName("20英雄")
		set BP = 10
		set Mode__FastFinish = true
		call AddModeName("快速结束")
		set Mode__AntiHack = true
		call AddModeName("反作弊")
		call AddModeName("天朝平衡")
		set Mode__BalanceOff = true
		call AddModeName("快速刷野")
		set Mode__FastNeutrals = true
		call AddModeName("六技能")
		set ExtraSkillsNumber = 2
		call JIO()
		set Mode__SixSkills = true
		call UnitAddAbility(ScourgeFountainOfLifeUnit,'ACrk')
		call UnitAddAbility(SentinelFountainOfLifeUnit,'ACrk')
		call UnitAddAbility(ScourgeFountainOfLifeUnit,'A1BY')
		call UnitAddAbility(SentinelFountainOfLifeUnit,'A1BY')
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第5个技能将在<5>, <8>, <11>, <14>级时自动升级" + "|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第6个技能将在<8>, <13>, <18>级时自动升级" + "|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
	endif
	if MM5 then
		set Mode__Draft50 = true
		call AddModeName("50英雄")
		set BP = 40
		set Mode__FastFinish = true
		call AddModeName("快速结束")
		set Mode__AntiHack = true
		call AddModeName("反作弊")
		call AddModeName("天朝平衡")
		set Mode__BalanceOff = true
		call AddModeName("快速刷野")
		set Mode__FastNeutrals = true
		call AddModeName("六技能")
		set ExtraSkillsNumber = 2
		call JIO()
		set Mode__SixSkills = true
		call UnitAddAbility(ScourgeFountainOfLifeUnit,'ACrk')
		call UnitAddAbility(SentinelFountainOfLifeUnit,'ACrk')
		call UnitAddAbility(ScourgeFountainOfLifeUnit,'A1BY')
		call UnitAddAbility(SentinelFountainOfLifeUnit,'A1BY')
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第5个技能将在<5>, <8>, <11>, <14>级时自动升级" + "|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第6个技能将在<8>, <13>, <18>级时自动升级" + "|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
	endif
	if AR then
		call AddMainModeName(GetObjectName('n0IQ'))
	endif
	if SP then
		call AddMainModeName(GetObjectName('n0IO'))
	endif
	if AA then
		call AddMainModeName(GetObjectName('n0IU'))
	endif
	if AS then
		call AddMainModeName(GetObjectName('n0IP'))
	endif
	if AI then
		call AddMainModeName(GetObjectName('n0IS'))
	endif
	if RO then
		call AddMainModeName(GetObjectName('n0IT'))
	endif
	if MO then
		call AddMainModeName(GetObjectName('n032'))
	endif
	if DU then
		call AddMainModeName(GetObjectName('n0IX'))
	endif
	if ID then
		call AddMainModeName(GetObjectName('n0IZ'))
	endif
	if NP then
		call AddMainModeName(GetObjectName('n0J6'))
	endif
	if SC then
		call AddMainModeName(GetObjectName('n0J7'))
	endif
	if EM then
		call AddMainModeName(GetObjectName('n0J9'))
	endif
	if SH then
		call AddMainModeName(GetObjectName('n0JA'))
	endif
	if OM then
		call AddMainModeName(GetObjectName('n0IV'))
	endif
	if NM then
		call AddMainModeName(GetObjectName('n0IR'))
	endif
	if NB then
		call AddMainModeName(GetObjectName('n0JB'))
	endif
	if NT then
		call AddMainModeName(GetObjectName('n0J8'))
	endif
	if NS then
		call AddMainModeName(GetObjectName('n0JC'))
	endif
	if NR then
		call AddMainModeName(GetObjectName('n0JF'))
	endif
	if SD then
		call AddMainModeName(GetObjectName('n0J0'))
		set GKV = true
		
		set Mode__FastFinish = true
		call AddModeName("快速结束")
		set Mode__AntiHack = true
		call AddModeName("反作弊")
	endif
	if PM then
		call AddMainModeName(GetObjectName('n0IY'))
	endif
	if OI then
		call AddMainModeName(GetObjectName('n0J5'))
	endif
	if FR then
		call AddMainModeName(GetObjectName('n0JD'))
	endif
	if SO then
		call AddMainModeName(GetObjectName('n0J2'))
		set YS = true
	endif
	if ZM then
		call AddMainModeName(GetObjectName('n0KA'))
	endif
	if D2 then
		call AddModeName("20英雄")
		set Mode__Draft20 = true
		set BP = 10
	endif
	if D3 then
		call AddModeName("30英雄")
		set Mode__Draft30 = true
		set BP = 20
	endif
	if D4 then
		call AddModeName("40英雄")
		set Mode__Draft40 = true
		set BP = 30
	endif
	if D5 then
		call AddModeName("50英雄")
		set Mode__Draft50 = true
		set BP = 40
	endif
	if S5 then
		call AddModeName("五技能")
		set ExtraSkillsNumber = 1
		set Mode__FiveSkills = true
		call UnitAddAbility(ScourgeFountainOfLifeUnit,'ACrk')
		call UnitAddAbility(SentinelFountainOfLifeUnit,'ACrk')
		call UnitAddAbility(ScourgeFountainOfLifeUnit,'A1BY')
		call UnitAddAbility(SentinelFountainOfLifeUnit,'A1BY')
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第5个技能将在<5>, <8>, <11>, <14>级时自动升级" + "|r")
	endif
	if S6 then
		call AddModeName("六技能")
		set ExtraSkillsNumber = 2
		call JIO()
		set Mode__SixSkills = true
		call UnitAddAbility(ScourgeFountainOfLifeUnit,'ACrk')
		call UnitAddAbility(SentinelFountainOfLifeUnit,'ACrk')
		call UnitAddAbility(ScourgeFountainOfLifeUnit,'A1BY')
		call UnitAddAbility(SentinelFountainOfLifeUnit,'A1BY')
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第5个技能将在<5>, <8>, <11>, <14>级时自动升级" + "|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第6个技能将在<8>, <13>, <18>级时自动升级" + "|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
	endif
	if DFF then
		call AddModeName("快速结束")
		set Mode__FastFinish = true
	endif
	if AH then
		set Mode__AntiHack = true
		call AddModeName("反作弊")
	endif
	if OS then
		call AddModeName("技能唯一")
		set HVV = true
	endif
	if RA then
		call AddModeName("额外随机技能")
		set Mode__RandomExtraAbilities = true
	endif
	if BO then
		call AddModeName("天朝平衡")
		set Mode__BalanceOff = true
	endif
	if NN then
		call AddModeName("无野怪")
		set Mode__NoNeutrals = true
	endif
	if UL then
		call AddModeName("无限等级")
		set TL = 2048
		set G0V = true
	endif
	if SS then
		call AddModeName("技能可见")
		set G1V = true
	endif
	if AB then
		call AddModeName("防偷塔")
		set Mode__AntiBackdoor = true
	endif
	if FN then
		call AddModeName("快速刷野")
		set Mode__FastNeutrals = true
	endif
	if LS then
		call AddModeName("技能限定")
		set HAV = true
	endif
	if A4R then
		call AddMainModeName("Fun heroes")
	endif
	if A3R then
		call AddModeName("限制技能 3")
		set HAV = true
		set HIV = true
	endif
	if RC then
		call AddModeName("限制解除")
		set Mode__RearmCombos = true
	endif
	if LS or A3R then
		call R_R()
	endif
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., " ")
	if A_R == 1 then
		call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., PlayersColoerText[GetPlayerId(HostPlayer)] +(PlayersName[GetPlayerId((HostPlayer))])+ "|r" + " 选择了 " + UW)
	else
		call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., "系统将游戏模式默认选择为 " + UW)
	endif
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., " ")
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., "该版本移植了部分高版本内容。")
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., " ")
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., "现在可以通过指令“-更新”来查看更新日志。")
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., " ")
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., "地图内置了二种命令改键方式，详细可在能量圈查看。")
	call ShowGameStartTopTips()
	// 初始化技能表
	call ExecuteFunc("InitHeroSkillsData")
	// 初始化技能双击施法
	call ExecuteFunc("DoubleClickSkill__Init")
	call INX("A8R", SP)
	call INX("A9R", DM)
	call INX("NVR", SH)
	call INX("NER", AA)
	call INX("NXR", AI)
	call INX("NOR", AS)
	call INX("NRR", RO)
	call INX("NIR", MO)
	call INX("NAR", DU)
	call INX("NNR", AR)
	call INX("NBR", AP)
	call INX("NCR", ID)
	call INX("NDR", NP)
	call INX("NFR", SC)
	call INX("NGR", EM)
	call INX("PickMode_OnlyMid", OM)
	call INX("PickMode_NotBot" , NB)
	call INX("PickMode_NotTop" , NT)
	call INX("PickMode_NoMid"  , NM)
	call INX("NMR", NS)
	call INX("NPR", NR)
	call INX("NQR", PM)
	call INX("NSR", OI)
	call INX("NTR", FR)
	call INX("NUR", ZM)
	call INX("NWR", AH)
	// 初始化镜像召唤事件 英雄进入地图事件
	call ExecuteFunc("NYR")
	// 初始化神杖升级 0.5秒后
	call ExecuteFunc("AWR")
	// 初始化主模式
	call ExecuteFunc("ISR")
	set A3 = true
	// 设置 木头和人口 即资源栏的游戏时间
	call SetResourceBarTime(0, 0, false)
	call X0R()
	set t = null
endfunction
function NZR takes nothing returns nothing
	call AYR(GetEventPlayerChatString(), 1)
endfunction
function N_R takes nothing returns boolean
	set CV = IsGameHaveObserver and(GetPlayerName(ObserverPlayer1) == "|cFFFF0000RGC" or GetPlayerName(ObserverPlayer2) == "|cFFFF0000RGC")
	if G2 == "rgc" then
		set G2 = "sdzm3lsso"
	elseif G2 == "rgc2" then
		set G2 = "sds5zm3lsso"
	elseif G2 == "rgc3" then
		set G2 = "sdd2s6osso"
	elseif G2 == "rgc4" then
		set G2 = "md3lszmso"
	elseif G2 == "rgc5" then
		set G2 = "mdd2s5zmulos3lsso"
	elseif G2 == "rgc6" then
		set G2 = "mdd2s6zmulosso"
	elseif G2 == "rgc7" then
		set G2 = "rdd2s6zmso"
	elseif G2 == "rgc8" then
		set G2 = "rdd2lszmso"
	elseif G2 == "md" then
		set G2 = "mds6d5ulabosfnzmso"
	elseif G2 == "sd" then
		set G2 = "sds6d5ulabosfnzmso"
	elseif G2 == "ap" then
		set G2 = "aps6ulabosfnzmso"
	elseif G2 == "ar" then
		set G2 = "ardms6omfrulabzmso"
	elseif G2 == "ru0" then
		set G2 = "mdabduffso"
	elseif G2 == "ru1" then
		set G2 = "mdulabfnduffso"
	elseif G2 == "ru2" then
		set G2 = "mds6ulabfnduffso"
	elseif G2 == "ru3" then
		set G2 = "mds6ulabfnduffso"
	elseif G2 == "ru4" then
		set G2 = "mdd2s6ulabfnduffso"
	elseif G2 == "ru5" then
		set G2 = "mdd2s6ulabfnduboffso"
	elseif G2 == "ru6" then
		set G2 = "sds6ulabfnduffso"
	elseif G2 == "ru7" then
		set G2 = "sdd2s6ulabfnduffso"
	elseif G2 == "ru8" then
		set G2 = "sdd2s6ulabfnduboffso"
	elseif G2 == "ru9" then
		set G2 = "sdd5s6ulabfnduboffso"
	elseif G2 == "ru10" then
		set G2 = "ardms6ulabfndubofrscffso"
	elseif G2 == "ru11" then
		set G2 = "ardms6ulabfndubofrnpomffso"
	elseif G2 == "ru12" then
		set G2 = "ardms6ulfndubofrscffnpntnmnbso"
	elseif G2 == "i1" then
		set G2 = "mds6omnpd2abnnso"
	elseif G2 == "i2" then
		set G2 = "sds6omnpd2abnnso"
	elseif G2 == "i3" then
		set G2 = "sds6omnpd3abnnso"
	elseif G2 == "ohs1" then
		set G2 = "sds6fnulboabd3ahso"
	elseif G2 == "ohs2" then
		set G2 = "ardms6fnulboabahso"
	elseif G2 == "ohs3" then
		set G2 = "aps6fnulboabssoslsahso"
	elseif G2 == "ohs4" then
		set G2 = "sdd5s6ulabbofnfrahso"
	elseif G2 == "ohs5" then
		set G2 = "mds6d2ombo"
	elseif G2 == "o1" then
		set G2 = "ardms6boomfnulso"
	elseif G2 == "o2" then
		set G2 = "mds6d3scfnulbonmso"
	elseif G2 == "rm1" then
		set G2 = "mdd2s6fnfrboulscduabrcffah"
	elseif G2 == "rm2" then
		set G2 = "sdd3s6fnfrboulscduabrcffmaah"
	elseif G2 == "ib1" then
		set G2 = "sds6d2ulabosfnzm"
	elseif G2 == "ib2" then
		set G2 = "sds6d3ulabosfnzm"
	elseif G2 == "ib3" then
		set G2 = "mds6d3fnffulosab"
	elseif G2 == "ib4" then
		set G2 = "mds6d4fnffulosab"
	endif
	if (G2)!= ""and A3 == false then
		set GGV = true
		call AYR("-" +(G2), 2)
	else
		call TriggerRegisterPlayerChatEvent(GHV, HostPlayer, "-", false)
	endif
	return false
endfunction
function NBR takes nothing returns nothing
	local location LIX = GetRectCenter(gg_rct_SentinelTavernCamera)
	local location LAX = GetRectCenter(gg_rct_ScourgeTavernCamera)
	local integer x = 1
	local trigger t
	local integer h
	set RT = true
	set N3 = 120
	loop
	exitwhen x > 5
		if IsPlayingPlayer(SentinelPlayers[x]) then
			call YCE(SentinelPlayers[x])
		endif
		if IsPlayingPlayer(ScourgePlayers[x]) then
			call YCE(ScourgePlayers[x])
		endif
		set x = x + 1
	endloop
	call RemoveLocation(LIX)
	call RemoveLocation(LAX)
	set LIX = null
	set LAX = null
	set t = null
endfunction
function N0R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer BOX =(LoadInteger(HY, h, 55))
	local player p
	local integer X1X
	local location LIX = GetRectCenter(gg_rct_SentinelRevivalPoint)
	local location LAX = GetRectCenter(gg_rct_ScourgeRevivalPoint)
	if BOX < 6 then
		set p = SentinelPlayers[BOX]
	elseif BOX < 11 then
		set p = ScourgePlayers[BOX -5]
	endif
	if BOX > 10 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if not Mode__DeathMatch  then
			set IY = true
		endif
	elseif BOX < 6 then
		call SaveInteger(HY, h, 55,(BOX + 1))
		set Player__Hero[GetPlayerId(p)]= null
		set PlayerHeroTypeId[GetPlayerId(p)]= 0
		if IsPlayingPlayer(p) then
			loop
			exitwhen Player__Hero[GetPlayerId(p)]!= null
				set X1X = X0X()
				if ZQ[X1X]== false then
					if not PW then
						set YQ[X1X]= true
						set ZQ[X1X]= true
					endif
					set Player__Hero[GetPlayerId(p)]= CreateUnitAtLoc(p, HeroListTypeId[X1X], LIX, bj_UNIT_FACING)
					set PlayerHeroTypeId[GetPlayerId(p)]= HeroListTypeId[X1X]
				endif
			endloop
		endif
	elseif BOX < 11 then
		call SaveInteger(HY, h, 55,(BOX + 1))
		set Player__Hero[GetPlayerId(p)]= null
		set PlayerHeroTypeId[GetPlayerId(p)]= 0
		if IsPlayingPlayer(p) then
			loop
			exitwhen Player__Hero[GetPlayerId(p)]!= null
				set X1X = X0X()
				if ZQ[X1X]== false then
					if not PW then
						set YQ[X1X]= true
						set ZQ[X1X]= true
					endif
					set Player__Hero[GetPlayerId(p)]= CreateUnitAtLoc(p, HeroListTypeId[X1X], LAX, bj_UNIT_FACING)
					set PlayerHeroTypeId[GetPlayerId(p)]= HeroListTypeId[X1X]
				endif
			endloop
		endif
	endif
	call RemoveLocation(LIX)
	call RemoveLocation(LAX)
	set LIX = null
	set LAX = null
	set p = null
	set t = null
	return false
endfunction
function NNR takes nothing returns nothing
	local location LIX = GetRectCenter(gg_rct_SentinelRevivalPoint)
	local location LAX = GetRectCenter(gg_rct_ScourgeRevivalPoint)
	local location N1R = GetRectCenter(gg_rct_SentinelRevivalPoint)
	local location N2R = GetRectCenter(gg_rct_ScourgeRevivalPoint)
	local integer loop_i = 1
	local integer loop_max = 5
	local integer X1X
	local trigger t
	set VT = true
	set RY = false
	if not PW then
		call XWX()
	endif
	set GT = 250
	call PanCameraToTimedLocForPlayer(SentinelPlayers[1], N1R, 0)
	call PanCameraToTimedLocForPlayer(SentinelPlayers[2], N1R, 0)
	call PanCameraToTimedLocForPlayer(SentinelPlayers[3], N1R, 0)
	call PanCameraToTimedLocForPlayer(SentinelPlayers[4], N1R, 0)
	call PanCameraToTimedLocForPlayer(SentinelPlayers[5], N1R, 0)
	call PanCameraToTimedLocForPlayer(ScourgePlayers[1], N2R, 0)
	call PanCameraToTimedLocForPlayer(ScourgePlayers[2], N2R, 0)
	call PanCameraToTimedLocForPlayer(ScourgePlayers[3], N2R, 0)
	call PanCameraToTimedLocForPlayer(ScourgePlayers[4], N2R, 0)
	call PanCameraToTimedLocForPlayer(ScourgePlayers[5], N2R, 0)
	if Mode__SameHero then
		loop
			set X1X = X0X()
		exitwhen ZQ[X1X]== false
		endloop
		if IsSentinelPlayer(HostPlayer) then
			set Player__Hero[GetPlayerId(HostPlayer)]= CreateUnit(HostPlayer, HeroListTypeId[X1X], GetLocationX(LIX), GetLocationY(LIX), 270)
			set PlayerHeroTypeId[GetPlayerId(HostPlayer)]= HeroListTypeId[X1X]
		else
			set Player__Hero[GetPlayerId(HostPlayer)]= CreateUnit(HostPlayer, HeroListTypeId[X1X], GetLocationX(LAX), GetLocationY(LAX), 270)
			set PlayerHeroTypeId[GetPlayerId(HostPlayer)]= HeroListTypeId[X1X]
		endif
		call RemoveLocation(LIX)
		call RemoveLocation(LAX)
		call RemoveLocation(N1R)
		call RemoveLocation(N2R)
		set LIX = null
		set LAX = null
		set N1R = null
		set N2R = null
		set t = null
		return
	endif
	set IY = false
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function N0R))
	call SaveInteger(HY,(GetHandleId(t)), 55, 1)
	call RemoveLocation(LIX)
	call RemoveLocation(LAX)
	call RemoveLocation(N1R)
	call RemoveLocation(N2R)
	set LIX = null
	set LAX = null
	set N1R = null
	set N2R = null
	set t = null
endfunction
function N3R takes nothing returns nothing
	set M3 = true
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10, GetObjectName('n06K')+ " " + GetObjectName('n06L'))
	call DisableTrigger(GetTriggeringTrigger())
endfunction
function N4R takes nothing returns nothing
	local integer N5R = S2I(SubString(GetEventPlayerChatString(), 6, StringLength(GetEventPlayerChatString())))
	if N5R > 666 then
		call InterfaceErrorForPlayer(HostPlayer, GetObjectName('n03C'))
	elseif N5R < 10 then
		call InterfaceErrorForPlayer(HostPlayer, GetObjectName('n02I'))
	else
		set DeathMatch__MaxLives = N5R
		call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10, GetObjectName('n06X')+ " " + I2S(DeathMatch__MaxLives)+ " " + GetObjectName('n06N'))
		call DisableTrigger(GetTriggeringTrigger())
	endif
endfunction
function N6R takes nothing returns nothing
	call DisableTrigger((LoadTriggerHandle(HY,(GetHandleId(GetTriggeringTrigger())),170)))
	call DisableTrigger((LoadTriggerHandle(HY,(GetHandleId(GetTriggeringTrigger())),171)))
	call DisableTrigger((LoadTriggerHandle(HY,(GetHandleId(GetTriggeringTrigger())),172)))
	call DisableTrigger(GetTriggeringTrigger())
endfunction
function EnableHolyShitLimit takes nothing returns nothing
	set Mode__HolyShitLimit = true
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10, "开启了超神限制，现在，超神后会立即死亡，并增加我方队伍5条生命。")
	call DisableTrigger(GetTriggeringTrigger())
endfunction

function CheckLifes takes nothing returns nothing
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., "近卫军团已使用生命：" + I2S(TeamHeroUseLivesCount[0]) )
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., "天灾军团已使用生命：" + I2S(TeamHeroUseLivesCount[1]) )
endfunction

function N7R takes nothing returns nothing
	local trigger N8R = CreateTrigger()
	local trigger N9R = CreateTrigger()
	local trigger nd = CreateTrigger()
	local trigger hsl = CreateTrigger()
	local trigger lifes = CreateTrigger()
	set DeathMatch__MaxLives = 66
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10., " ")
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10., GetObjectName('n06O')+ " -nd " + GetObjectName('n067')+ " -lives xx " + GetObjectName('n06Q'))
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10., GetObjectName('n06O')+ " -hsl 开启超神限制" )
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10., GetObjectName('n060')+ " " + I2S(DeathMatch__MaxLives))
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10., " 输入-life来查看双方生命值" )
	call TriggerRegisterTimerEvent(N8R, 15, false)
	call TriggerAddAction(N8R, function N6R)
	call SaveTriggerHandle(HY,(GetHandleId(N8R)), 170,(nd))
	call SaveTriggerHandle(HY,(GetHandleId(N8R)), 171,(N9R))
	call SaveTriggerHandle(HY,(GetHandleId(N8R)), 172,(hsl))

	call TriggerRegisterPlayerChatEvent(nd, HostPlayer, "-nd", true)
	call TriggerAddAction(nd, function N3R)

	call TriggerRegisterPlayerChatEvent(N9R, HostPlayer, "-lives", false)
	call TriggerAddAction(N9R, function N4R)

	call TriggerRegisterPlayerChatEvent(hsl, HostPlayer, "-hsl", true)
	call TriggerAddAction(hsl, function EnableHolyShitLimit)

	call TriggerRegisterPlayerChatEvent(lifes, HostPlayer, "-life", true)
	call TriggerAddAction(lifes, function CheckLifes)

	set hsl = null
	set N8R = null
	set N9R = null
	set nd = null
endfunction
function BVR takes nothing returns nothing
	local integer BER =(LoadInteger(HY,(GetHandleId(GetTriggeringTrigger())), 173))
	local integer loop_i
	local integer loop_max
	local integer X1X
	local integer BOX
	local location LIX = GetRectCenter(gg_rct_SentinelTavernCamera)
	local location LAX = GetRectCenter(gg_rct_ScourgeTavernCamera)
	if IsGameEnd then	
		call RemoveLocation(LIX)
		call RemoveLocation(LAX)
		set LIX = null
		set LAX = null
		return
	endif
	if IsSentinelPlayer(Player(BER)) then
		set loop_i = 1
		set loop_max = VWV
		set BOX = 0
	else
		set loop_i = VYV
		set loop_max = HeroTypeMaxCount
		set BOX = 1
	endif
	set loop_i = 1
	set loop_max = HeroTypeMaxCount
	call YCE(Player(BER))
	set Q2 = BER
	if not VT then
		loop
		exitwhen loop_i > loop_max
			if ZQ[loop_i]== false then
				call SetPlayerTechMaxAllowed(Player(BER), HeroListTypeId[loop_i], 999)
			endif
			set loop_i = loop_i + 1
		endloop
		if (GetPlayerState(Player(BER), PLAYER_STATE_RESOURCE_GOLD)< 250) then
			call SetPlayerState(Player(BER), PLAYER_STATE_RESOURCE_GOLD, 250)
		endif
	elseif (TeamHeroUseLivesCount[BOX]< DeathMatch__MaxLives) then
		//if Player__Hero[BER]!= null then
		//	call RemoveUnit(Player__Hero[BER])
		//endif
		set Player__Hero[BER]= null
		set PlayerHeroTypeId[BER]= 0
		if IsPlayingPlayer(Player(BER)) then
			loop
				if IsSentinelPlayer(Player(BER)) then
					set Player__Hero[BER]= CreateUnitAtLoc(Player(BER), UFE(), LIX, bj_UNIT_FACING)
					set PlayerHeroTypeId[BER]= GetUnitTypeId(Player__Hero[BER])
				else
					set Player__Hero[BER]= CreateUnitAtLoc(Player(BER), UFE(), LAX, bj_UNIT_FACING)
					set PlayerHeroTypeId[BER]= GetUnitTypeId(Player__Hero[BER])
				endif
			exitwhen Player__Hero[BER]!= null
			endloop
		endif
	endif
	call TimerStart(ESV[BER], 0, false, null)
	call TimerStart(ETV[BER], 0, false, null)
	call RemoveLocation(LIX)
	call RemoveLocation(LAX)
	if not VT then
	endif
	set LIX = null
	set LAX = null
endfunction
function A9R takes nothing returns nothing
	local location loc
	local real BXR
	local trigger t
	local integer BOR
	local integer x
	set Mode__DeathMatch = true
	set x = 1
	loop
	exitwhen x > 5
		set BOR = GetPlayerId(SentinelPlayers[x])
		set t = CreateTrigger()
		call TriggerRegisterTimerExpireEvent(t, PS[BOR])
		call TriggerAddAction(t, function BVR)
		call SaveInteger(HY,(GetHandleId(t)), 173,(BOR))
		set BOR = GetPlayerId(ScourgePlayers[x])
		set t = CreateTrigger()
		call TriggerRegisterTimerExpireEvent(t, PS[BOR])
		call TriggerAddAction(t, function BVR)
		call SaveInteger(HY,(GetHandleId(t)), 173,(BOR))
		set x = x + 1
	endloop
	call UnitRemoveAbility(SentinelCircle1,'Aawa')
	call UnitRemoveAbility(SentinelCircle2,'Aawa')
	call UnitRemoveAbility(SentinelCircle3,'Aawa')
	call UnitRemoveAbility(SentinelCircle4,'Aawa')
	call UnitRemoveAbility(SentinelCircle5,'Aawa')
	call UnitRemoveAbility(ScourgeCircle1,'Aawa')
	call UnitRemoveAbility(ScourgeCircle2,'Aawa')
	call UnitRemoveAbility(ScourgeCircle3,'Aawa')
	call UnitRemoveAbility(ScourgeCircle4,'Aawa')
	call UnitRemoveAbility(ScourgeCircle5,'Aawa')
	call ExecuteFunc("N7R")
	set loc = null
	set t = null
endfunction
function NAR takes nothing returns nothing
	set PW = true
endfunction
function A8R takes nothing returns nothing
	local integer BRR = XKX(SentinelForce)
	local integer BIR = XKX(ScourgeForce)
	local integer WXV = BRR + BIR
	local integer k
	local integer o
	local integer x
	local integer y
	local integer z
	local player array BAR
	local player array BNR
	local integer w
	local location N1R = GetRectCenter(gg_rct_SentinelRevivalPoint)
	local location N2R = GetRectCenter(gg_rct_ScourgeRevivalPoint)
	local location LIX = GetRectCenter(gg_rct_SentinelTavernCamera)
	local location LAX = GetRectCenter(gg_rct_ScourgeTavernCamera)
	local integer i
	set DW = true
	call KillPlayerAllZoneIndicator(SentinelPlayers[1])
	call KillPlayerAllZoneIndicator(SentinelPlayers[2])
	call KillPlayerAllZoneIndicator(SentinelPlayers[3])
	call KillPlayerAllZoneIndicator(SentinelPlayers[4])
	call KillPlayerAllZoneIndicator(SentinelPlayers[5])
	call KillPlayerAllZoneIndicator(ScourgePlayers[1])
	call KillPlayerAllZoneIndicator(ScourgePlayers[2])
	call KillPlayerAllZoneIndicator(ScourgePlayers[3])
	call KillPlayerAllZoneIndicator(ScourgePlayers[4])
	call KillPlayerAllZoneIndicator(ScourgePlayers[5])
	set x = 1
	loop
	exitwhen x > 5
		if IsPlayingPlayer(SentinelPlayers[x]) then
			call YCE(SentinelPlayers[x])
		endif
		if IsPlayingPlayer(ScourgePlayers[x]) then
			call YCE(ScourgePlayers[x])
		endif
		set x = x + 1
	endloop
	call RemoveLocation(LIX)
	call RemoveLocation(LAX)
	set BAR[1]= null
	set BAR[2]= null
	set BAR[3]= null
	set BAR[4]= null
	set BAR[5]= null
	set BAR[6]= null
	set BAR[7]= null
	set BAR[8]= null
	set BAR[9]= null
	set BAR[10]= null
	set z = 1
	set w = 1
	set k = 1
	loop
	exitwhen k > 5
		if (IsPlayingPlayer(SentinelPlayers[k])) then
			set BAR[w]= SentinelPlayers[k]
			set w = w + 1
		else
			set BNR[z]= SentinelPlayers[k]
			set z = z + 1
		endif
		set k = k + 1
	endloop
	set k = 1
	loop
	exitwhen k > 5
		if (IsPlayingPlayer(ScourgePlayers[k])) then
			set BAR[w]= ScourgePlayers[k]
			set w = w + 1
		else
			set BNR[z]= ScourgePlayers[k]
			set z = z + 1
		endif
		set k = k + 1
	endloop
	set SentinelPlayers[1]= null
	set SentinelPlayers[2]= null
	set SentinelPlayers[3]= null
	set SentinelPlayers[4]= null
	set SentinelPlayers[5]= null
	set ScourgePlayers[1]= null
	set ScourgePlayers[2]= null
	set ScourgePlayers[3]= null
	set ScourgePlayers[4]= null
	set ScourgePlayers[5]= null
	set k = 1
	loop
	exitwhen k >(WXV / 2)
		set o = GetRandomInt(1, WXV)
		if (BAR[o]!= null) then
			set SentinelPlayers[k]= BAR[o]
			set BAR[o]= null
			set k = k + 1
		endif
	endloop
	set x = k
	set k = 1
	loop
	exitwhen k > WXV -x + 1
		set o = GetRandomInt(1, WXV)
		if (BAR[o]!= null) then
			set ScourgePlayers[k]= BAR[o]
			set BAR[o]= null
			set k = k + 1
		endif
	endloop
	set z = k
	set k = x
	set y = 1
	loop
	exitwhen k > 5
		set SentinelPlayers[k]= BNR[y]
		set y = y + 1
		set k = k + 1
	endloop
	set k = z
	loop
	exitwhen k > 5
		set ScourgePlayers[k]= BNR[y]
		set y = y + 1
		set k = k + 1
	endloop
	set k = 0
	loop
	exitwhen k > 5
		set k = k + 1
	endloop
	call SetPlayerTeam(SentinelPlayers[0], 0)
	call SetPlayerTeam(SentinelPlayers[1], 0)
	call SetPlayerTeam(SentinelPlayers[2], 0)
	call SetPlayerTeam(SentinelPlayers[3], 0)
	call SetPlayerTeam(SentinelPlayers[4], 0)
	call SetPlayerTeam(SentinelPlayers[5], 0)
	call SetPlayerTeam(ScourgePlayers[0], 1)
	call SetPlayerTeam(ScourgePlayers[1], 1)
	call SetPlayerTeam(ScourgePlayers[2], 1)
	call SetPlayerTeam(ScourgePlayers[3], 1)
	call SetPlayerTeam(ScourgePlayers[4], 1)
	call SetPlayerTeam(ScourgePlayers[5], 1)
	set i = 1
	loop
		set ZL[i]= GetPlayerId(SentinelPlayers[i])
		set i = i + 1
	exitwhen i > 5
	endloop
	set i = 7
	loop
		set ZL[i]= GetPlayerId(ScourgePlayers[i -6])
		set i = i + 1
	exitwhen i > 11
	endloop
	call K_X()
	set x = 0
	set y = 0
	loop
	exitwhen x > 5
		loop
		exitwhen y > 5
			call SetPlayerAllianceStateBJ(SentinelPlayers[x], SentinelPlayers[y], 3)
			call SetPlayerAllianceStateBJ(ScourgePlayers[x], ScourgePlayers[y], 3)
			call SetPlayerAllianceStateBJ(SentinelPlayers[x], ScourgePlayers[y], 0)
			call SetPlayerAllianceStateBJ(ScourgePlayers[x], SentinelPlayers[y], 0)
			set y = y + 1
		endloop
		set y = 0
		set x = x + 1
	endloop
	call ForceClear(SentinelForce)
	call ForceClear(ScourgeForce)
	call ForceAddPlayer(SentinelForce, SentinelPlayers[0])
	call ForceAddPlayer(SentinelForce, SentinelPlayers[1])
	call ForceAddPlayer(SentinelForce, SentinelPlayers[2])
	call ForceAddPlayer(SentinelForce, SentinelPlayers[3])
	call ForceAddPlayer(SentinelForce, SentinelPlayers[4])
	call ForceAddPlayer(SentinelForce, SentinelPlayers[5])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[0])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[1])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[2])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[3])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[4])
	call ForceAddPlayer(ScourgeForce, ScourgePlayers[5])
	call ExecuteFunc("K1X")
	call JIO()
	set BRR = XKX(SentinelForce)
	set BIR = XKX(ScourgeForce)
	set k = 1
	loop
	exitwhen k > 5
		if (IsPlayingPlayer(SentinelPlayers[k])) then
			call SetPlayerStateBJ(SentinelPlayers[k], PLAYER_STATE_RESOURCE_GOLD,(4375 / BRR))
			call SetPlayerStateBJ(SentinelPlayers[k], PLAYER_STATE_RESOURCE_LUMBER, 0)
		endif
		if (IsPlayingPlayer(ScourgePlayers[k])) then
			call SetPlayerStateBJ(ScourgePlayers[k], PLAYER_STATE_RESOURCE_GOLD,(4375 / BIR))
			call SetPlayerStateBJ(ScourgePlayers[k], PLAYER_STATE_RESOURCE_LUMBER, 0)
		endif
		set k = k + 1
	endloop
	if IsGameHaveObserver then
		set x = 0
		loop
		exitwhen x > 5
			call SetPlayerAlliance(Player(0), SentinelPlayers[x], ALLIANCE_PASSIVE, true)
			call SetPlayerAlliance(Player(0), SentinelPlayers[x], ALLIANCE_SHARED_SPELLS, true)
			call SetPlayerAlliance(Player(0), ScourgePlayers[x], ALLIANCE_PASSIVE, false)
			call SetPlayerAlliance(Player(0), ScourgePlayers[x], ALLIANCE_SHARED_SPELLS, false)
			set x = x + 1
		endloop
	endif
	call KZX()
	call RemoveLocation(N1R)
	call RemoveLocation(N2R)
	set N1R = null
	set N2R = null
	set LIX = null
	set LAX = null
endfunction
function NER takes nothing returns nothing
	local integer i
	local integer k
	set QW = true
	set i = 1
	set k = V4V
	loop
	exitwhen i > k
		call XSX(V3V[i])
		set YQ[TVE(V3V[i])]= true
		set i = i + 1
	endloop
	set i = 1
	set k = V2V
	loop
	exitwhen i > k
		call XSX(V1V[i])
		set YQ[TVE(V1V[i])]= true
		set i = i + 1
	endloop
endfunction
function BBR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer VXR =(LoadInteger(HY, h, 172))
	local player p
	local integer x = 1
	loop
	exitwhen x > 5
		set p = SentinelPlayers[x]
		if IsPlayingPlayer(p) and p != HostPlayer then
			set Player__Hero[GetPlayerId(p)]= CreateUnit(p, VXR, GetRectCenterX(gg_rct_SentinelRevivalPoint), GetRectCenterY(gg_rct_SentinelRevivalPoint), 270)
			set PlayerHeroTypeId[GetPlayerId(p)]= VXR
		endif
		set p = ScourgePlayers[x]
		if IsPlayingPlayer(p) and p != HostPlayer then
			set Player__Hero[GetPlayerId(p)]= CreateUnit(p, VXR, GetRectCenterX(gg_rct_ScourgeRevivalPoint), GetRectCenterY(gg_rct_ScourgeRevivalPoint), 270)
			set PlayerHeroTypeId[GetPlayerId(p)]= VXR
		endif
		set x = x + 1
	endloop
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set p = null
	return false
endfunction
function BCR takes nothing returns nothing
	local integer x = 1
	local player p
	local unit trigUnit = GetTriggerUnit()
	local integer VXR = GetUnitTypeId(trigUnit)
	local trigger t
	local integer h
	if (GetOwningPlayer(trigUnit) == HostPlayer and IsUnitType(trigUnit, UNIT_TYPE_HERO)) then
		call DisableTrigger(GetTriggeringTrigger())
		if FT[GetPlayerId(HostPlayer)]== false and VT == false and OT == false then
			call SetPlayerState(HostPlayer, PLAYER_STATE_RESOURCE_GOLD, 250+ GetPlayerState(HostPlayer, PLAYER_STATE_RESOURCE_GOLD))
		endif
		set KS[GetPlayerId(HostPlayer)]= true
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .01, false)
		call TriggerAddCondition(t, Condition(function BBR))
		call SaveInteger(HY, h, 172,(VXR))
	endif
	set p = null
	set trigUnit = null
	set t = null
endfunction
function NVR takes nothing returns nothing
	local integer x = 1
	local trigger t = CreateTrigger()
	local region r = CreateRegion()
	set Mode__SameHero = true
	loop
	exitwhen x > 5
		if (SentinelPlayers[x]!= HostPlayer ) then
			call XUX(SentinelPlayers[x])
			set FT[GetPlayerId(SentinelPlayers[x])]= true
			set KS[GetPlayerId(SentinelPlayers[x])]= true
		endif
		if (ScourgePlayers[x]!= HostPlayer ) then
			call XUX(ScourgePlayers[x])
			set FT[GetPlayerId(ScourgePlayers[x])]= true
			set KS[GetPlayerId(ScourgePlayers[x])]= true
		endif
		set x = x + 1
	endloop
	call RegionAddRect(r, bj_mapInitialPlayableArea)
	call TriggerRegisterEnterRegion(t, r, null)
	call TriggerAddAction(t, function BCR)
	set r = null
	set t = null
endfunction
function NOR takes nothing returns nothing
	local integer i
	local integer k
	set TW = true
	set i = 1
	set k = V4V
	loop
	exitwhen i > k
		call XSX(V3V[i])
		set YQ[TVE(V3V[i])]= true
		set ZQ[TVE(V3V[i])]= true
		set i = i + 1
	endloop
	set i = 1
	set k = V0V
	loop
	exitwhen i > k
		call XSX(V_V[i])
		set i = i + 1
	endloop
endfunction
function NXR takes nothing returns nothing
	local integer i
	local integer k
	set SW = true
	set i = 1
	set k = V0V
	loop
	exitwhen i > k
		call XSX(V_V[i])
		set YQ[TVE(V_V[i])]= true
		set ZQ[TVE(V_V[i])]= true
		set i = i + 1
	endloop
	set i = 1
	set k = V2V
	loop
	exitwhen i > k
		call XSX(V1V[i])
		set YQ[TVE(V1V[i])]= true
		set ZQ[TVE(V1V[i])]= true
		set i = i + 1
	endloop
endfunction
function NIR takes nothing returns nothing
	local integer i
	local integer k
	set GLV = true
	set i = 1
	set k = RangeHeroMax
	loop
	exitwhen i > k
		call XSX(RangeHeroList[i])
		set YQ[TVE(RangeHeroList[i])]= true
		set ZQ[TVE(RangeHeroList[i])]= true
		set i = i + 1
	endloop
endfunction
function NRR takes nothing returns nothing
	local integer i
	local integer k
	set GMV = true
	set i = 1
	set k = MeleeHeroMax
	loop
	exitwhen i > k
		call XSX(MeleeHeroList[i])
		set YQ[TVE(MeleeHeroList[i])]= true
		set ZQ[TVE(MeleeHeroList[i])]= true
		set i = i + 1
	endloop
endfunction
function NCR takes nothing returns nothing
	set IT = true
endfunction
function NGR takes nothing returns nothing
	set Mode__EasyMode = true

	call SetPlayerTechResearched(SentinelPlayers[0], 'R004', 1)
	call SetPlayerTechResearched(ScourgePlayers[0], 'R004', 1)

	//设置经验获取不再有用，因为是脚本给予的经验值
	//call SetPlayerHandicapXP(SentinelPlayers[1], 1.5)
	//call SetPlayerHandicapXP(SentinelPlayers[2], 1.5)
	//call SetPlayerHandicapXP(SentinelPlayers[3], 1.5)
	//call SetPlayerHandicapXP(SentinelPlayers[4], 1.5)
	//call SetPlayerHandicapXP(SentinelPlayers[5], 1.5)
	//call SetPlayerHandicapXP(ScourgePlayers[1], 1.5)
	//call SetPlayerHandicapXP(ScourgePlayers[2], 1.5)
	//call SetPlayerHandicapXP(ScourgePlayers[3], 1.5)
	//call SetPlayerHandicapXP(ScourgePlayers[4], 1.5)
	//call SetPlayerHandicapXP(ScourgePlayers[5], 1.5)
endfunction
function NDR takes nothing returns nothing
	set JT = true
	call DestroyTrigger(RuneRefreshTrigger)
endfunction
function NFR takes nothing returns nothing
	set KT = true
endfunction
function BDR takes nothing returns nothing
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10, GetObjectName('n0HA'))
	call DisableTrigger(GetTriggeringTrigger())
endfunction
function BFR takes nothing returns nothing
	call DisableTrigger((LoadTriggerHandle(HY,(GetHandleId(GetTriggeringTrigger())), 174)))
	call DisableTrigger(GetTriggeringTrigger())
endfunction
function BGR takes nothing returns nothing
	local trigger N8R = CreateTrigger()
	local trigger t = CreateTrigger()
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10., " ")
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10., "额外指令: 可以在15秒内输入 -noneutrals 取消野怪。")
	call TriggerRegisterTimerEvent(N8R, 15, false)
	call TriggerAddAction(N8R, function BFR)
	call SaveTriggerHandle(HY,(GetHandleId(N8R)), 174,(t))
	call TriggerRegisterPlayerChatEvent(t, HostPlayer, "-noneutrals", true)
	call TriggerAddAction(t, function BDR)
	set N8R = null
	set t = null
endfunction
function PickMode_OnlyMid takes nothing returns nothing
	set Mode__OnlyMid = true
	if Mode__NoNeutrals == false then
		call ExecuteFunc("BGR")
	endif
endfunction
function PickMode_NotBot takes nothing returns nothing
	set Mode__NotBot = true
endfunction
function PickMode_NoMid takes nothing returns nothing
	set Mode__NoMid = true
endfunction
function PickMode_NotTop takes nothing returns nothing
	set Mode__NotTop = true
endfunction
function NMR takes nothing returns nothing
	set F3 = true
	set J3 = true
endfunction
function NPR takes nothing returns nothing
	set GUV = true
endfunction
function NQR takes nothing returns nothing
	set L3 = true
endfunction
function BHR takes nothing returns nothing
	local integer i = 0
	local integer pid
	loop
	exitwhen i > 5
		set pid = GetPlayerId(SentinelPlayers[i])
		call SetPlayerName(SentinelPlayers[i], PlayersName[pid] + " (" + I2S(PlayerKillHerosCount[pid])+ "/" + I2S(PlayerHeroDeathCount[pid])+ " | " + I2S(PlayerCreepLastHitCount[pid])+ "-" + I2S(PlayerCreepDenyCount[pid])+ ")")
		set pid = GetPlayerId(ScourgePlayers[i])
		call SetPlayerName(ScourgePlayers[i], PlayersName[pid] + " (" + I2S(PlayerKillHerosCount[pid])+ "/" + I2S(PlayerHeroDeathCount[pid])+ " | " + I2S(PlayerCreepLastHitCount[pid])+ "-" + I2S(PlayerCreepDenyCount[pid])+ ")")
		set i = i + 1
	endloop
endfunction
function BJR takes nothing returns boolean
	if GWV == false then
		if LocalPlayer== ObserverPlayer1 or LocalPlayer== ObserverPlayer2 then
			call BHR()
		endif
	endif
	return false
endfunction
function NSR takes nothing returns nothing
	set GWV = true
endfunction
function NTR takes nothing returns nothing
	set GYV = true
endfunction
function BKR takes nothing returns boolean
	if LocalPlayer== ObserverPlayer1 or LocalPlayer== ObserverPlayer2 then
		if GetTriggerEvalCount(GetTriggeringTrigger()) == 1 then
			call CameraSetupSetDestPosition(G_V, 0, 0, .0)
		else
			call CameraSetupSetDestPosition(G_V, GetCameraTargetPositionX(), GetCameraTargetPositionY(), .0)
		endif
		call CameraSetupApplyForPlayer(true, G_V, LocalPlayer, 0)
		call SetTerrainFogEx(0, .0, 100000., .5, .353, .314, .235)
	endif
	return false
endfunction
function NUR takes nothing returns nothing
	local trigger t = CreateTrigger()
	set GZV = true
	set G_V = CreateCameraSetup()
	call CameraSetupSetField(G_V, CAMERA_FIELD_ZOFFSET, .0, .0)
	call CameraSetupSetField(G_V, CAMERA_FIELD_ROTATION, 90., .0)
	call CameraSetupSetField(G_V, CAMERA_FIELD_ANGLE_OF_ATTACK, 304., .0)
	call CameraSetupSetField(G_V, CAMERA_FIELD_TARGET_DISTANCE, 2500., .0)
	call CameraSetupSetField(G_V, CAMERA_FIELD_ROLL, .0, .0)
	call CameraSetupSetField(G_V, CAMERA_FIELD_FIELD_OF_VIEW, 70., .0)
	call CameraSetupSetField(G_V, CAMERA_FIELD_FARZ, 16000., .0)
	call CameraSetupSetDestPosition(G_V, .0, .0, .0)
	call TriggerRegisterTimerEvent(t, 180, true)
	call TriggerRegisterTimerEvent(t, .1, false)
	call TriggerAddCondition(t, Condition(function BKR))
	set t = null
endfunction
function BLR takes nothing returns nothing
	local integer i = 1
	local string id
	local player p
	loop
	exitwhen i > 5
		set p = SentinelPlayers[i]
		set id = I2S(GetPlayerId(p))
		call StoreInteger(DrCache, id, "id", i)
		set p = ScourgePlayers[i]
		set id = I2S(GetPlayerId(p))
		call StoreInteger(DrCache, id, "id", i + 5)
		if LocalPlayer == HostPlayer then
			call SyncStoredInteger(DrCache, I2S(GetPlayerId(SentinelPlayers[i])), "id")
			call SyncStoredInteger(DrCache, I2S(GetPlayerId(ScourgePlayers[i])), "id")
		endif
		set i = i + 1
	endloop
	set p = null
endfunction

function BMR takes nothing returns boolean
	if YW then
		call AYR("-sdd3s6fnabborcdusculsp", 2)
	endif
	call BLR()
	call CleanCurrentTrigger(GetTriggeringTrigger())
	return false
endfunction
function BPR takes nothing returns boolean
	set GS = true
	call CleanCurrentTrigger(GetTriggeringTrigger())
	return false
endfunction
function BQR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	if UnitRemoveAbility(LoadUnitHandle(HY, h, 0), LoadInteger(HY, h, 0)) and GetUnitAbilityLevel(LoadUnitHandle(HY, h, 0), LoadInteger(HY, h, 0)) == 0 then
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	endif
	set t = null
endfunction
function BSR takes unit u, integer id returns nothing
	local timer t
	local integer h
	if UnitRemoveAbility(u, id) == false then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, .5, true, function BQR)
		call SaveUnitHandle(HY, h, 0, u)
		call SaveInteger(HY, h, 0, id)
		set t = null
	endif
endfunction
function BTR takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local real BUR = LoadReal(HY, h, 0)
	local integer GFX = LoadInteger(HY, h, 0)
	local unit d
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call RemoveSavedHandle(HY, GetHandleId(u),'STFU')
		call BSR(u,'B463')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		if BUR < GetGameTime() or GetUnitAbilityLevel(u, GFX) == 0 or LoadBoolean(HY, h,'SLDR') then
			call RemoveSavedHandle(HY, GetHandleId(u),'STFU')
			call UnitRemoveAbility(u,'B463')
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		elseif GetUnitAbilityLevel(u, GFX)> 0 and GetUnitAbilityLevel(u,'B463') == 0 then
			set d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
			call UnitAddAbility(d,'A463')
			call IssueTargetOrderById(d, 852668, u)
			set d = null
		endif
	else
		if GetUnitAbilityLevel(u, GFX)> 0 then
			if GetIssuedOrderId()>=852008 and GetIssuedOrderId()<= 852013 then
				call EXStopUnit(u)
			endif
		endif
	endif
	set u = null
	set t = null
endfunction
function BWR takes unit u, integer GFX, real SYV returns nothing
	local trigger t
	local integer h
	local integer hu = GetHandleId(u)
	local unit d
	local real BUR
	if HaveSavedHandle(HY, hu,'STFU') then
		set t = LoadTriggerHandle(HY, hu,'STFU')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, hu,'STFU', t)
		call TriggerRegisterTimerEvent(t, .02, true)
		call TriggerRegisterDeathEvent(t, u)
		call SaveUnitHandle(HY, h, 0, u)
		call TriggerAddCondition(t, Condition(function BTR))
		call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_ORDER)
		call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_TARGET_ORDER)
		call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_POINT_ORDER)
		set d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
		call UnitAddAbility(d,'A463')
		call IssueTargetOrderById(d, 852668, u)
		set d = null
	endif
	set BUR = GetGameTime()+ SYV * 1.
	if BUR > LoadReal(HY, h, 0) then
		call SaveInteger(HY, h, 0, GFX)
		call SaveReal(HY, h, 0, BUR)
	endif
	set t = null
endfunction
function BYR takes unit u returns nothing //拉比克额外技能删除,和omg不兼容,不应该使用
	call UnitRemoveAbility(u,'A13D')
	call UnitRemoveAbility(u,'A21J')
	call UnitRemoveAbility(u,'A1QV')
	call UnitRemoveAbility(u,'A1TU')
	call UnitRemoveAbility(u,'A24A')
	call UnitRemoveAbility(u,'A24B')
	call UnitRemoveAbility(u,'A1NH')
	call UnitRemoveAbility(u,'A20N')
	call UnitRemoveAbility(u,'A1Z2')
	call UnitRemoveAbility(u,'A1Z3')
	call UnitRemoveAbility(u,'A205')
	call UnitRemoveAbility(u,'A1VU')
	call UnitRemoveAbility(u,'A0GC')
	call UnitRemoveAbility(u,'A24E')
	call UnitRemoveAbility(u,'A0RT')
	call UnitRemoveAbility(u,'A1RA')
	call UnitRemoveAbility(u,'A0HA')
	call UnitRemoveAbility(u,'A0SA')
	call UnitRemoveAbility(u,'A121')
	call UnitRemoveAbility(u,'A1WF')
	call UnitRemoveAbility(u,'A02T')
	call UnitRemoveAbility(u,'A1S9')
	call UnitRemoveAbility(u,'A21H')
	call UnitRemoveAbility(u,'A1MN')
	call UnitRemoveAbility(u,'A06K')
	call UnitRemoveAbility(u,'A0NE')
	call UnitRemoveAbility(u,'A0MP')
endfunction
function BZR takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	call SaveUnitHandle(HY, GetHandleId(p),'wrth', CreateUnit(p,'e00K', 0, 0, 0))
	call ShowUnit(LoadUnitHandle(HY, GetHandleId(p),'wrth'), false)
	call PauseUnit(LoadUnitHandle(HY, GetHandleId(p),'wrth'), true)
	call UnitRemoveAbility(u,'A3DC')
endfunction
// 禁用单位的血精石
function DisableUnitBloodstone takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	call KillUnit(LoadUnitHandle(HY, GetHandleId(p),'wrth'))
	call UnitAddPermanentAbility(u,'A3DC')
	call SetPlayerAbilityAvailable(p,'A3DC', false)
endfunction
function B0R takes unit u, unit t, integer id returns boolean
	local integer i = 0
	local real a
	local boolean b = false
	if IssueTargetOrderById(u, id, t) then
		return true
	else
		call UnitShareVision(t, GetOwningPlayer(u), true)
		if IssueTargetOrderById(u, id, t) then
			set b = true
		else
			set i = 0
			set a = AngleBetweenUnit(u, t)
			loop
				call SetUnitX(u, GetUnitX(u)+ 20 * Cos(a * bj_DEGTORAD))
				call SetUnitY(u, GetUnitY(u)+ 20 * Sin(a * bj_DEGTORAD))
				set i = i + 1
				if IssueTargetOrderById(u, id, t) then
					set b = true
				endif
			exitwhen GetUnitDistanceEx(u, t)> 1200 or b
			endloop
		endif
		call UnitShareVision(t, GetOwningPlayer(u), false)
	endif
	// debug call SingleDebug(I2S(i)+ " steps")
	return b
endfunction
function B1R takes unit d, string S6V, real x, real y returns nothing
	local real cx = GetUnitX(d)
	local real cy = GetUnitY(d)
	local real a = AngleBetweenXY(cx, cy, x, y)* bj_DEGTORAD
	local real B2R = 20 * Cos(a)
	local real B3R = 20 * Sin(a)
	local integer i = 0
	loop
	exitwhen IssuePointOrder(d, S6V, x, y) or i > 20
		call SetUnitX(d, GetUnitX(d)+ B2R)
		call SetUnitY(d, GetUnitY(d)+ B3R)
		call SaveReal(OtherHashTable2,'wave','000x', x)
		call SaveReal(OtherHashTable2,'wave','000y', y)
		set x = x + B2R
		set y = y + B3R
		set i = i + 1
	endloop
	if i > 20 then
		call UnitRemoveAbility(d,'Avul')
		call IssueTargetOrder(d, S6V, d)
	endif
endfunction
function B4R takes unit u returns real
	if GetUnitAbilityLevel(u,'A1CN') == 1 then	//撒旦主动
		return 2.
	endif
	if GetUnitAbilityLevel(u,'A04T') == 1 then	//撒旦被动
		return .25
	endif
	if GetUnitAbilityLevel(u,'A0II') == 1 then	//疯脸
		return .2
	endif
	if GetUnitAbilityLevel(u,'A09P') == 1 then	//死亡面具和支配头盔
		return .15
	endif
	return .0
endfunction
function B6R takes unit t returns nothing
	call UnitAddAbilityToTimed(t,'A3K2', 1, 15, 0)
	call UnitAddAbilityToTimed(t,'A3K3', 1, 15,'BIcb')
endfunction
function B7R takes unit u, unit t returns boolean
	if GetUnitAbilityLevel(u,'AIcb')> 0 then	//黯灭
		call B6R(t)
		return true
	endif
	return false
endfunction
function CVR takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer hu = LoadInteger(HY, h, 0)
	local real CER = LoadReal(HY, h, 0)
	local real hp = GetWidgetLife(u)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or u == null or LoadReal(HY, h, 1)< GetGameTime() then
		call RemoveSavedHandle(HY, hu,'FRZH')
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	else
		if hp < CER or LoadInteger(HY, hu,'AFRZ') == 1 then
			call SaveReal(HY, h, 0, hp)
		else
			call SetWidgetLife(u, CER)
		endif
	endif
	set t = null
	set u = null
endfunction
function CXR takes unit u, real SYV returns nothing
	local trigger t
	local integer h
	local integer hu = GetHandleId(u)
	if HaveSavedHandle(HY, hu,'FRZH') then
		set t = LoadTriggerHandle(HY, hu,'FRZH')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerAddCondition(t, Condition(function CVR))
		call SaveTriggerHandle(HY, hu,'FRZH', t)
		call SaveInteger(HY, h, 0, hu)
		call SaveUnitHandle(HY, h, 0, u)
		call SaveReal(HY, h, 0, GetWidgetLife(u))
	endif
	call SaveReal(HY, h, 1, SYV + GetGameTime())
	set t = null
endfunction
function COR takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetTriggerEvalCount(t) == 60 or GetUnitAbilityLevel(u,'A3K6') == 0 then
		call SetHeroStr(u, GetHeroStr(u, false)+ LoadInteger(HY, h, 0), true)
		call SetHeroAgi(u, GetHeroAgi(u, false)+ LoadInteger(HY, h, 1), true)
		call SetHeroInt(u, GetHeroInt(u, false)+ LoadInteger(HY, h, 2), true)
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	endif
	set u = null
	set t = null
endfunction
function CRR takes nothing returns nothing
	local real WLV = 0
	local unit u = GetEnumUnit()
	local trigger t
	local real SYV = 12.
	local integer stolen = 0
	local integer curstat = 0
	local integer level = GetUnitAbilityLevel(UN,'A32A')
	local integer CIR = 0
	local integer CAR
	local integer CNR
	local integer CBR
	local integer h
	if IsUnitType(u, UNIT_TYPE_HERO) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .2, true)
		call TriggerRegisterDeathEvent(t, u)
		set CIR = 3
		set CAR = IMinBJ(GetHeroStr(u, false)-1, level * 2)
		set CNR = IMinBJ(GetHeroAgi(u, false)-1, level * 2)
		set CBR = IMinBJ(GetHeroInt(u, false)-1, level * 2)
		call SetHeroStr(u, GetHeroStr(u, false)-CAR, true)
		call SetHeroAgi(u, GetHeroAgi(u, false)-CNR, true)
		call SetHeroInt(u, GetHeroInt(u, false)-CBR, true)
		call TriggerAddCondition(t, Condition(function COR))
		call UnitAddAbilityToTimed(u,'A3K6', 1, 12,'B3K6')
		call SaveUnitHandle(HY, h, 0, u)
		call SaveInteger(HY, h, 0, CAR)
		call SaveInteger(HY, h, 1, CNR)
		call SaveInteger(HY, h, 2, CBR)
		set t = null
	endif
	call UnitDamageTargetEx(UN, u, 3, 50 + 25 * level)
	set u = null
	set t = null
endfunction
function CCR takes nothing returns boolean
	return IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(UN)) and IsAliveNotStrucNotWard(GetFilterUnit()) and IsUnitMagicImmune(GetFilterUnit()) == false
endfunction
function FVE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local group g = AllocationGroup(116)
	local group gg = AllocationGroup(117)
	local integer level = GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())
	local real I3X = AngleBetweenXY(GetUnitX(whichUnit), GetUnitY(whichUnit), GetSpellTargetX(), GetSpellTargetY())* bj_DEGTORAD
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), I3X * bj_RADTODEG)
	call UnitAddAbility(dummyUnit,'A32X')
	call IssuePointOrderById(dummyUnit, 852580, x + 125 * Cos(I3X), y + 125 * Sin(I3X))
	set dummyUnit = null
	set UN = whichUnit
	call GroupEnumUnitsInRange(g, x + 125 * Cos(I3X), y + 125 * Sin(I3X), 175, Condition(function CCR))
	call GroupAddGroup(g, gg)
	call GroupEnumUnitsInRange(g, x + 300 * Cos(I3X), y + 300 * Sin(I3X), 200, Condition(function CCR))
	call GroupAddGroup(g, gg)
	call GroupEnumUnitsInRange(g, x + 500 * Cos(I3X), y + 500 * Sin(I3X), 200, Condition(function CCR))
	call GroupAddGroup(g, gg)
	call GroupEnumUnitsInRange(g, x + 700 * Cos(I3X), y + 700 * Sin(I3X), 250, Condition(function CCR))
	call GroupAddGroup(g, gg)
	set UN = whichUnit
	call ForGroup(gg, function CRR)
	call DeallocateGroup(g)
	call DeallocateGroup(gg)
	set whichUnit = null
	set g = null
	set gg = null
endfunction
function CDR takes nothing returns boolean
	return(IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(UN)) and IsAliveNotStrucNotWard(GetFilterUnit()) and IsUnitType(GetFilterUnit(), UNIT_TYPE_MECHANICAL) == false and IsUnitInGroup(GetFilterUnit(), GI) == false)!= null
endfunction
function CFR takes nothing returns nothing
	call UnitDamageTargetEx(UN, GetEnumUnit(), 1, MC)
	call UnitAddAbilityToTimed(GetEnumUnit(),'A3LA', 1, 3.,'A32c')
	call GroupAddUnit(GI, GetEnumUnit())
endfunction
function CGR takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local real I3X = LoadReal(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	local real x = LoadReal(HY, h, 1)
	local real y = LoadReal(HY, h, 2)
	local real cx
	local real cy
	local real N3X = LoadReal(HY, h, 3)
	local group g
	local group AIR = LoadGroupHandle(HY, h, 2)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call SetUnitPathing(u, true)
		call DestroyEffect(LoadEffectHandle(HY, h, 4))
		call DestroyEffect(LoadEffectHandle(HY, h, 5))
		call DeallocateGroup(AIR)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SetUnitPosition(u, CoordinateX50(GetUnitX(u)+ N3X * Cos(I3X)), CoordinateY50(GetUnitY(u)+ N3X * Sin(I3X)))
		if ModuloInteger(GetTriggerEvalCount(t), 10) == 0 then
			call KillTreeByCircle(GetUnitX(u), GetUnitY(u), 150)
		endif
		call SetUnitFacing(u, I3X * bj_RADTODEG)
		if GetDistanceBetween(x, y, GetUnitX(u), GetUnitY(u))< 50 or GetDistanceBetween(x, y, GetUnitX(u), GetUnitY(u))> 1200 or GetTriggerEvalCount(t)> 1200. / N3X then
			call DestroyEffect(LoadEffectHandle(HY, h, 4))
			call DestroyEffect(LoadEffectHandle(HY, h, 5))
			call SetUnitPathing(u, true)
			call SetUnitPosition(u, CoordinateX50(GetUnitX(u)), CoordinateY50(GetUnitY(u)))
			call DeallocateGroup(AIR)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			call SetUnitAnimationByIndex(u, LoadInteger(ObjectHashTable, GetUnitTypeId(u),'A1P8'))
			set cx = GetUnitX(u)
			set cy = GetUnitY(u)
			set g = AllocationGroup(118)
			set UN = u
			set GI = AIR
			call GroupEnumUnitsInRange(g, cx, cy, 275, Condition(function CDR))
			set MC = level * 50.
			set TempInt = level
			set UN = u
			call ForGroup(g, function CFR)
			call GroupAddGroup(g, AIR)
			call DeallocateGroup(g)
		endif
	endif
	set g = null
	set AIR = null
	set u = null
	set t = null
endfunction
function FEE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u, GetSpellAbilityId())
	local real cx = GetUnitX(u)
	local real cy = GetUnitY(u)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real I3X = AngleBetweenXY(cx, cy, x, y)* bj_DEGTORAD
	local trigger t
	local integer h
	local group g = AllocationGroup(119)
	local string s = GetHeroFootAttachPointName(u)
	local string s2 = ""
	if s == "foot" then
		set s = "foot,right"
		set s2 = "foot,left"
	endif
	if GetDistanceBetween(cx, cy, x, y)> 1000 then
		set x = cx + 1000* Cos(I3X)
		set y = cy + 1000* Sin(I3X)
	endif
	call SetUnitFacingTimed(u, I3X * bj_RADTODEG, .3)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function CGR))
	call SaveUnitHandle(HY, h, 0, u)
	call SaveEffectHandle(HY, h, 4, AddSpecialEffectTarget("effects\\SandWaveMissile.mdx", u, s))
	call SaveEffectHandle(HY, h, 5, AddSpecialEffectTarget("effects\\SandWaveMissile.mdx", u, s2))
	call SaveReal(HY, h, 0, I3X)
	call SaveReal(HY, h, 1, x)
	call SaveReal(HY, h, 2, y)
	call SaveReal(HY, h, 3, 1000. * .02)
	call SaveInteger(HY, h, 0, level)
	call SaveGroupHandle(HY, h, 2, g)
	call SetUnitPathing(u, false)
	set t = null
	set u = null
	set g = null
endfunction
function CHR takes nothing returns nothing
	local unit whichUnit = U2
	local unit targetUnit = MissileHitTargetUnit
	local integer level = GetUnitAbilityLevel(whichUnit,'A32E')
	local real CJR = level * 40 + 40
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, CJR)
	call CNX(targetUnit,'A32F', 1, 4,'B32F')
	set whichUnit = null
	set targetUnit = null
endfunction
function CKR takes nothing returns nothing
	local trigger t = LaunchMissileByUnitDummy(GetTriggerUnit(), GetSpellTargetUnit(),'hKOD', "CHR", 1000, true)
	set t = null
endfunction
function FOE takes nothing returns nothing
	local integer i = LoadInteger(ObjectHashTable, GetHandleId(GetTriggerUnit()),'A32D')-1
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call CKR()
	endif
	call SaveInteger(ObjectHashTable, GetHandleId(GetTriggerUnit()),'A32D', i)
	if i < 1 then
		call SaveBoolean(ObjectHashTable, GetHandleId(GetTriggerUnit()),'A32D', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(GetTriggerUnit()),'A32D', false)
	endif
endfunction
function LEE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	if LoadBoolean(ObjectHashTable, GetHandleId(u),'A32D') == false or LoadInteger(ObjectHashTable, GetHandleId(u),'A32D')< 1 then
		call EXStopUnit(u)
		call InterfaceErrorForPlayer(GetOwningPlayer(u), "没有树木可使用")
		call SaveBoolean(ObjectHashTable, GetHandleId(u),'A32D', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A32D', false)
	endif
	set u = null
endfunction
function CLR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local destructable d = LoadDestructableHandle(HY, GetHandleId(t), 0)
	local unit u = CreateUnit(Player(15),'e00E', GetDestructableX(d), GetDestructableY(d), 0)
	call UnitAddAbility(u,'A1FD')
	call IssueTargetOrderById(u, 852146, d)
	call FlushChildHashtable(HY, GetHandleId(t))
	call PauseTimer(t)
	call DestroyTimer(t)
	set u = null
	set t = null
endfunction
function CMR takes destructable d returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .3, false, function CLR)
	call SaveDestructableHandle(HY, GetHandleId(t), 0, d)
	set t = null
endfunction
function FXE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())
	call UnitAddPermanentAbility(whichUnit,'A32D')
	call SaveBoolean(ObjectHashTable, GetHandleId(whichUnit),'A32D', true)
	call SetPlayerAbilityAvailable(GetOwningPlayer(whichUnit),'A32D', true)
	call SaveInteger(ObjectHashTable, GetHandleId(whichUnit),'A32D', LoadInteger(ObjectHashTable, GetHandleId(whichUnit),'A32D')+ 1)
	call CMR(GetSpellTargetDestructable())
	set whichUnit = null
endfunction
function SQE takes nothing returns nothing
	call UnitAddPermanentAbility(GetTriggerUnit(),'A32E')
	call SetUnitAbilityLevel(GetTriggerUnit(),'A32E', GetUnitAbilityLevel(GetTriggerUnit(),'A32Y'))
endfunction
function CPR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer UYX = 0
	local integer level = GetUnitAbilityLevel(u,'A32G')
	local integer I2X = 5 + 5 * level
	local integer CQR = 4 + 2 * level
	local integer CSR = LoadInteger(ObjectHashTable, GetHandleId(u),'A32G')
	local integer CTR = LoadInteger(ObjectHashTable, GetHandleId(u),'A32G'+ 1)
	local integer i = 0
	local integer id = 0
	local integer k = 0
	local integer CUR = 0
	if level == 0 then
		if CSR > 0 then
			call UnitReduceStateBonus(u, CSR, UNIT_BONUS_DAMAGE)
			call UnitReduceStateBonus(u, CTR, UNIT_BONUS_ATTACK)
		endif
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	else
		loop
			set k = 0
			set id = GetItemTypeId(UnitItemInSlot(u, i))
			if id > 0 then
				if TEX(id)> 2000 then
					set UYX = UYX + 1
				endif
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
		set CUR = UYX * I2X
		set CQR = UYX * CQR
		if CUR != CSR then
			call UnitReduceStateBonus(u, CSR, UNIT_BONUS_DAMAGE)
			call UnitReduceStateBonus(u, CTR, UNIT_BONUS_ATTACK)
			call UnitAddStateBonus(u, CUR, UNIT_BONUS_DAMAGE)
			call UnitAddStateBonus(u, CQR, UNIT_BONUS_ATTACK)
			call SaveInteger(ObjectHashTable, GetHandleId(u),'A32G', CUR)
			call SaveInteger(ObjectHashTable, GetHandleId(u),'A32G'+ 1, CQR)
		endif
	endif
	set t = null
	set u = null
endfunction
function L_E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local timer t = CreateTimer()
	call TimerStart(t, 1, true, function CPR)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveInteger(HY, GetHandleId(t), 0, GetUnitAbilityLevel(u, GetSpellAbilityId())+ 1)
	set t = null
	set u = null
endfunction
function CWR takes unit u, integer str returns nothing
	local integer array b
	local integer a = str
	local integer c = 1
	local integer i = 0
	local integer z = 5
	//local real hp
	local integer array CYR
	set CYR[0]='A32N'
	set CYR[1]='A32O'
	set CYR[2]='A32P'
	set CYR[3]='A32Q'
	set CYR[4]='A32R'
	set CYR[5]='A32S'
	if str < 1 then
		//set hp = GetWidgetLife(u)
		call UnitRemoveAbility(u, CYR[0])
		call UnitRemoveAbility(u, CYR[1])
		call UnitRemoveAbility(u, CYR[2])
		call UnitRemoveAbility(u, CYR[3])
		call UnitRemoveAbility(u, CYR[4])
		call UnitRemoveAbility(u, CYR[5])
		//call SetWidgetLife(u, hp)
		return
	endif
	loop
		set c = a / 2
		set b[i]= a -c * 2
		set a = c
		set i = i + 1
	exitwhen c == 0
	endloop
	set i = 0
	loop
	exitwhen i > z
		if b[i]== 1 then
			call UnitAddPermanentAbility(u, CYR[i])
		else
			call UnitRemoveAbility(u, CYR[i])
		endif
		set i = i + 1
	endloop
endfunction
function CZR takes unit u, integer str, integer C_R returns nothing
	local integer array b
	local integer a = C_R
	local integer c = 1
	local integer i = 0
	local integer z
	local real hp
	local integer array CYR
	set CYR[0]='A32H'
	set CYR[1]='A32I'
	set CYR[2]='A32J'
	set CYR[3]='A32K'
	set CYR[4]='A32L'
	set CYR[5]='A32M'
	if C_R < 1 then
		call UnitRemoveAbility(u, CYR[0])
		call UnitRemoveAbility(u, CYR[1])
		call UnitRemoveAbility(u, CYR[2])
		call UnitRemoveAbility(u, CYR[3])
		call UnitRemoveAbility(u, CYR[4])
		call UnitRemoveAbility(u, CYR[5])
		call CWR(u, 0)
		return
	endif
	loop
		set c = a / 2
		set b[i]= a -c * 2
		set a = c
		set i = i + 1
	exitwhen c == 0
	endloop
	set z = 5
	set i = 0
	loop
	exitwhen i > z
		if b[i]== 1 then
			call UnitAddPermanentAbility(u, CYR[i])
		else
			call UnitRemoveAbility(u, CYR[i])
		endif
		set i = i + 1
	endloop
	call CWR(u, str)
endfunction
function C0R takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer hu = 0
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local integer i = 1
	local unit u = null
	local boolean C1R = LoadBoolean(HY, h, 0)
	local player p
	local integer pid = 0
	local integer C2R = LoadInteger(HY, h, 1)+ 1
	local integer C3R = 0
	local integer C4R = 0
	local integer C5R = 0
	local integer WOV = LoadInteger(HY, h,-1)
	local unit array C6R
	loop
		if C1R then
			set pid = GetPlayerId(ScourgePlayers[i])
		else
			set pid = GetPlayerId(SentinelPlayers[i])
		endif
		set u = Player__Hero[pid]
		if u != null then //UnitAlive(u) and
			set hu = GetHandleId(u)
			if (GetDistanceBetween(GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitX(u), GetUnitY(u))< 925 or LoadBoolean(ObjectHashTable, hu,'A32G'+ 1)) then
				//if C2R == 1 then
				call SaveBoolean(ObjectHashTable, hu,'A32G'+ 1, true)
				//endif
				set C3R = C3R + 1
				set C6R[C3R]= u
			elseif GetDistanceBetween(GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitX(u), GetUnitY(u)) > 925 then
				call CZR(u, 0, 0)
				call SaveInteger(ObjectHashTable, hu,'A32G'+ 1, 0)
				call SaveBoolean(ObjectHashTable, hu,'A32G'+ 1, false)
			endif
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	set C5R =(6 + 2 * LoadInteger(HY, h, 0) )* C3R
	set i = 1
	loop
		set u = C6R[i]
		set hu = GetHandleId(u)
		if C2R < WOV and(GetDistanceBetween(GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitX(u), GetUnitY(u))< 925 and LoadBoolean(ObjectHashTable, hu,'A32G'+ 1)) then
			set C4R = LoadInteger(ObjectHashTable, hu,'A32G'+ 1)
			if C4R != C5R then
				call CZR(u, 0, 0)
				if u != whichUnit then
					call CZR(u, R2I(C5R / 2), C5R)
				else
					call CZR(u, C5R, C5R)
				endif
				call SaveInteger(ObjectHashTable, hu,'A32G'+ 1, C5R)
			endif
		else
			call CZR(u, 0, 0)
			call SaveInteger(ObjectHashTable, hu,'A32G'+ 1, 0)
			call SaveBoolean(ObjectHashTable, hu,'A32G'+ 1, false)
		endif
		set i = i + 1
	exitwhen i > C3R
	endloop
	call SaveInteger(HY, h, 1, C2R)
	if C2R == WOV then
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	endif
	set whichUnit = null
	set t = null
	set u = null
	set C6R[1]= null
	set C6R[2]= null
	set C6R[3]= null
	set C6R[4]= null
	set C6R[5]= null
endfunction
function FRE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer lv = GetUnitAbilityLevel(u, GetSpellAbilityId())
	local timer t = CreateTimer()
	call TimerStart(t, .25, true, function C0R)
	call SaveInteger(HY, GetHandleId(t),-1, R2I(8 / .25)+ 1)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveInteger(HY, GetHandleId(t), 0, lv)
	call SaveBoolean(HY, GetHandleId(t), 0, IsScourgePlayer(GetOwningPlayer(u)))
	set t = null
	set u = null
endfunction
function C7R takes nothing returns nothing
	local unit whichUnit = U2
	local unit targetUnit = MissileHitTargetUnit
	local real CJR = 100 + 60 * GetUnitAbilityLevel(whichUnit,'A45W')
	if GetWidgetLife(targetUnit)< GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)/ 2 then
		set CJR = CJR / 2
	endif
	call DestroyEffect(LoadEffectHandle(HY, GetHandleId(GetTriggeringTrigger()),'00fx'))
	call UnitDamageTargetEx(whichUnit, targetUnit, 3, CJR)
	set whichUnit = null
	set targetUnit = null
endfunction
function B_E takes nothing returns nothing
	local trigger t = null
	local unit d = null
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = LaunchMissileByUnitDummy(GetTriggerUnit(), GetSpellTargetUnit(),'h077', "C7R", 1500, true)
		set d = LoadUnitHandle(HY, GetHandleId(t), 45)
		call SaveEffectHandle(HY, GetHandleId(t),'00fx', AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilMissile.mdl", d, "origin"))
		set t = null
		set d = null
	endif
endfunction
function C8R takes nothing returns boolean
	if UnitIsDead(GetFilterUnit()) == false and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(QN)) and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false and IsUnitMagicImmune(GetFilterUnit()) == false then
		if IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) then
			set TN = TN + 1
		endif
		return true
	endif
	return false
endfunction
function C9R takes nothing returns nothing
	local integer T0V ='A45Y'
	local integer level = 1
	call UnitDamageTargetEx(QN, GetEnumUnit(), 1, SN * 40 + 40)
	if UnitIsDead(GetEnumUnit()) == false then
		if TN < 2 then
			set level = TN + 1
		else
			set level = TN -1
			set T0V = T0V + 1
		endif
		call UnitAddAbilityToTimed(GetEnumUnit(), T0V, level, 1 + SN,'B45Y')
	endif
endfunction
function DVR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	local group g = AllocationGroup(120)
	local integer i = 0
	set SN = level
	set QN = whichUnit
	set TN = 0
	call GroupEnumUnitsInRange(g, LoadReal(HY, h, 1), LoadReal(HY, h, 2), 300 + 50 * level, Condition(function C8R))
	call ForGroup(g, function C9R)
	call DeallocateGroup(g)
	call PauseTimer(t)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set whichUnit = null
	set t = null
	set g = null
endfunction
function B0E takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(GetTriggerUnit(),'A45X'))
	call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
	call SaveReal(HY, h, 1, x)
	call SaveReal(HY, h, 2, y)
	call TimerStart(t, .4, false, function DVR)
	call SaveEffectHandle(HY, h, 10, AddSpecialEffect("war3mapImported\\ArrowShower.mdx", x, y))
	call SaveEffectHandle(HY, h, 11, AddSpecialEffect("war3mapImported\\ArrowShower.mdx", x + 250, y))
	call SaveEffectHandle(HY, h, 12, AddSpecialEffect("war3mapImported\\ArrowShower.mdx", x, y + 250))
	call SaveEffectHandle(HY, h, 13, AddSpecialEffect("war3mapImported\\ArrowShower.mdx", x + 250, y + 250))
	call SaveEffectHandle(HY, h, 14, AddSpecialEffect("war3mapImported\\ArrowShower.mdx", x  -250, y))
	call SaveEffectHandle(HY, h, 15, AddSpecialEffect("war3mapImported\\ArrowShower.mdx", x, y  -250))
	call SaveEffectHandle(HY, h, 16, AddSpecialEffect("war3mapImported\\ArrowShower.mdx", x  -250, y  -250))
	set t = null
endfunction
function DER takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit DXR = LoadUnitHandle(HY, h, 0)
	local unit triggerUnit = LoadUnitHandle(HY, h, 1)
	local real damageValue = LoadReal(HY, h, 0)
	local integer c = LoadInteger(HY, h, 0)+ 1
	if DXR == null or triggerUnit == null or damageValue == .0 or c > 3 then
		call DestroyEffect(LoadEffectHandle(HY, h, 3))
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	else
		set DV = true
		call UnitDamageTargetEx(DXR, triggerUnit, 2, damageValue)
		set DV = false
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\BloodRiteTarget.mdx", triggerUnit, "origin"))
		call SaveInteger(HY, h, 0, c)
		if c == 3 then
			call DestroyEffect(LoadEffectHandle(HY, h, 3))
			call PauseTimer(t)
			call FlushChildHashtable(HY, h)
			call DestroyTimer(t)
		endif
	endif
	set t = null
	set DXR = null
	set triggerUnit = null
endfunction
function DOR takes unit R8X, unit targetUnit returns nothing //致命创伤属于 英雄攻击 普通伤害 即物理伤害
	local timer tt = null
	local integer ht
	if GetEventDamage()> 20 and DV == false and GetUnitAbilityLevel(R8X,'A36D') == 0 and TKV(R8X,'A460', 30) then
		set tt = CreateTimer()
		set ht = GetHandleId(tt)
		call TimerStart(tt, 1, true, function DER)
		call SaveUnitHandle(HY, ht, 0, R8X)
		call SaveUnitHandle(HY, ht, 1, targetUnit)
		call SaveReal(HY, ht, 0, GetEventDamage()*(.05 *(GetUnitAbilityLevel(R8X,'A460'))+ .25))
		call SaveEffectHandle(HY, ht, 3, AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", targetUnit, "origin"))
		set tt = null
	endif
endfunction
function DRR takes nothing returns boolean
	if IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and UnitIsDead(GetFilterUnit()) == false and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(QN)) and GetUnitAbilityLevel(GetFilterUnit(),'Avul') == 0 and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 then
		if GetWidgetLife(GetFilterUnit())< LN then
			set LN = GetWidgetLife(GetFilterUnit())
			set MN = GetFilterUnit()
		endif
		return true
	endif
	return false
endfunction
function DIR takes unit u, boolean DAR returns nothing
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	local integer T0V ='A462'
	local integer level = 1
	if DAR then
		set level = 2
	endif
	call UnitAddAbility(d, T0V)
	call SetUnitAbilityLevel(d, T0V, level)
	call IssueTargetOrderById(d, 852095, u)
	call EYX("Abilities\\Spells\\Orc\\Ensnare\\ensnare_AirTarget.mdl", u, "origin", .5)
	set d = null
endfunction
function DNR takes nothing returns nothing
	local integer h = GetHandleId(GetExpiredTimer())
	local unit whichUnit =(LoadUnitHandle(HY, h, 290))
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local real sx =(LoadReal(HY, h, 284))
	local real sy =(LoadReal(HY, h, 285))
	local real tx =(LoadReal(HY, h, 286))
	local real ty =(LoadReal(HY, h, 287))
	local real Bx =(LoadReal(HY, h, 288))
	local real By =(LoadReal(HY, h, 289))
	local real a =(LoadReal(HY, h, 137))
	local real b = 1 -a
	local boolean DBR =(LoadBoolean(HY, h, 291))
	local real DCR = RMaxBJ(GetDistanceBetween(sx, sy, tx, ty)/  1300, .2)
	local boolean bb = LoadBoolean(HY, h, 0)
	local group g = null
	local real x = CoordinateX50(sx * a * a + Bx * 2 * a * b + tx * b * b)
	local real y = CoordinateY50(sy * a * a + By * 2 * a * b + ty * b * b)
	local unit u
	local real ILX
	call SetUnitFacing(whichUnit, AngleBetweenXY(GetUnitX(whichUnit), GetUnitY(whichUnit), x, y))
	call SetUnitX(whichUnit, x)
	call SetUnitY(whichUnit, y)
	if GetDistanceBetween(x, y, tx, ty)< 50 and bb == false then
		call SaveBoolean(HY, h, 0, true)
		set g = AllocationGroup(121)
		set QN = whichUnit
		set SN = GetUnitAbilityLevel(whichUnit,'A461')
		set MN = null
		set LN = 999999
		call GroupEnumUnitsInRange(g, x, y, 300, Condition(function DRR))
		if MN != null then
			call SaveBoolean(HY, h, 1, true)
			call SaveUnitHandle(HY, h, 1, MN)
		endif
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			call UnitDamageTargetEx(whichUnit, u, 1, SN * 50 + 50)
			call DIR(u, false)
			call GroupRemoveUnit(g, u)
		endloop
		call DeallocateGroup(g)
		set g = null
	endif
	if LoadBoolean(HY, h, 1) then
		call SetUnitPosition(LoadUnitHandle(HY, h, 1), x, y)
	endif
	if (DBR) then
		call SaveReal(HY, h, 137,((a -0.02 / DCR)* 1.))
		call SetUnitFlyHeight(whichUnit, GetUnitFlyHeight(whichUnit)+ LoadReal(HY, h, 291), 0)
	else
		call SaveReal(HY, h, 137,((a + .02 / DCR)* 1.))
		call SetUnitFlyHeight(whichUnit, GetUnitFlyHeight(whichUnit)-LoadReal(HY, h, 291), 0)
	endif
	if (a < 0 and DBR) then
		call SaveBoolean(HY, h, 291,(false))
		call SaveReal(HY, h, 288,((sx + 300 * Cos(Atan2(ty -sy, tx -sx)+(LoadReal(HY, h, 292))))* 1.))
		call SaveReal(HY, h, 289,((sy + 300 * Sin(Atan2(ty -sy, tx -sx)+(LoadReal(HY, h, 292))))* 1.))
	endif
	if (a > 1 and DBR == false) then
		if LoadBoolean(HY, h, 1) then
			call UnitDamageTargetEx(whichUnit, LoadUnitHandle(HY, h, 1), 1, 50 + 50 * GetUnitAbilityLevel(whichUnit,'A461'))
			call DIR(LoadUnitHandle(HY, h, 1), true)
			call EYX("Abilities\\Spells\\Orc\\Ensnare\\ensnare_AirTarget.mdl", LoadUnitHandle(HY, h, 1), "origin", 1)
			call KillTreeByCircle(GetUnitX(LoadUnitHandle(HY, h, 1)), GetUnitY(LoadUnitHandle(HY, h, 1)), 200)
		endif
		call SetUnitFlyHeight(whichUnit, LoadReal(HY, h, 290), 0)
		call KillTreeByCircle(GetUnitX(whichUnit), GetUnitY(whichUnit), 200)
		call PauseTimer(GetExpiredTimer())
		call FlushChildHashtable(HY, h)
		call DestroyTimer(GetExpiredTimer())
	endif
	set whichUnit = null
	set trigUnit = null
endfunction
function B7E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real sx = GetUnitX(whichUnit)
	local real sy = GetUnitY(whichUnit)
	local real tx = CoordinateX50(GetSpellTargetX())
	local real ty = CoordinateY50(GetSpellTargetY())
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local real a = AngleBetweenXY(sx, sy, tx, ty)* bj_DEGTORAD
	if GetDistanceBetween(sx, sy, tx, ty)< 300 then
		set tx = CoordinateX50(sx + 300 * Cos(a))
		set ty = CoordinateY50(sy + 300 * Sin(a))
	endif
	call SaveUnitHandle(HY, h, 14,(whichUnit))
	call SaveUnitHandle(HY, h, 290,(whichUnit))
	call SaveReal(HY, h, 284,((sx)* 1.))
	call SaveReal(HY, h, 285,((sy)* 1.))
	call SaveReal(HY, h, 286,((tx)* 1.))
	call SaveReal(HY, h, 287,((ty)* 1.))
	call SaveReal(HY, h, 288,((sx + 300 * Cos(Atan2(ty -sy, tx -sx)-45))* 1.))
	call SaveReal(HY, h, 289,((sy + 300 * Sin(Atan2(ty -sy, tx -sx)-45))* 1.))
	call SaveReal(HY, h, 137, 1.)
	call SaveReal(HY, h, 292, 45.)
	call SaveBoolean(HY, h, 291, true)
	call SaveReal(HY, h, 290, GetUnitFlyHeight(whichUnit))
	call SaveReal(HY, h, 291, 1300/ GetDistanceBetween(sx, sy, tx, ty))
	if O0X(whichUnit) == false then
		call UnitAddPermanentAbility(whichUnit,'Amrf')
		call UnitRemoveAbility(whichUnit,'Amrf')
	endif
	call TimerStart(t, .02, true, function DNR)
	set whichUnit = null
	set t = null
endfunction
function DDR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer count = GetTriggerEvalCount(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local integer level =(LoadInteger(HY, h, 5))
	local real DFR
	local unit dummyCaster
	set DFR = .6 *(count -25)*(count -25)
	if count < 51 and GetTriggerEventId()!= EVENT_WIDGET_DEATH then
		if ModuloInteger(count, 5) == 0 then
			call UnitDamageTargetEx(whichUnit, targetUnit, 1, 3 + 3 * level)
		endif
		if O0X(targetUnit) == false then
			call SetUnitFlyHeight(targetUnit, 500 -DFR, 0)
		endif
	else
		set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitAddPermanentAbility(dummyCaster,'A11L')
		call SetUnitAbilityLevel(dummyCaster,'A11L', level)
		call IssueTargetOrderById(dummyCaster, 852075, targetUnit)
		if O0X(targetUnit) == false then
			call SetUnitFlyHeight(targetUnit, GetUnitDefaultFlyHeight(targetUnit), 0)
		endif
		if IsGameEnd == false then
			call PauseUnit(targetUnit, false)
		endif
		call SetUnitPathing(targetUnit, true)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set dummyCaster = null
	return false
endfunction
function DGR takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = U2
	local unit targetUnit = GetEnumUnit()
	local integer level = Q2
	call PauseUnit(targetUnit, true)
	call SetUnitPathing(targetUnit, false)
	if O0X(targetUnit) == false then
		call UnitAddPermanentAbility(targetUnit,'Amrf')
		call UnitRemoveAbility(targetUnit,'Amrf')
	endif
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function DDR))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))
	call SaveInteger(HY, h, 5,(level))
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, 30 + 30 * level)
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function DHR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local integer level = LoadInteger(HY, h, 5)
	local group g = AllocationGroup(122)
	local ubersplat N4O = CreateUbersplat(x, y, "THNN", 255, 255, 255, 255, false, false)
	call SetUbersplatRenderAlways(N4O, true)
	call A8X(GetOwningPlayer(trigUnit), 4, x, y, 400)
	call DestroyEffect(LoadEffectHandle(HY, h, 175))
	call DestroyEffect(LoadEffectHandle(HY, h, 176))
	call DestroyEffect(LoadEffectHandle(HY, h, 177))
	call DestroyEffect(LoadEffectHandle(HY, h, 178))
	call DestroyEffect(LoadEffectHandle(HY, h, 179))
	call DestroyEffect(LoadEffectHandle(HY, h, 180))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl", x, y))
	call DestroyEffect(AddSpecialEffect("effects\\TidalErruption.mdx", x, y))
	set U2 = trigUnit
	set Q2 = level
	call GroupEnumUnitsInRange(g, x, y, 225+ 25, Condition(function DPX))
	call ForGroup(g, function DGR)
	call DeallocateGroup(g)
	set t = null
	set trigUnit = null
	set g = null
	set N4O = null
	return false
endfunction
function YWV takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(trigUnit,'A136')
	local string s = ""
	local real a
	local real r
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(trigUnit)) or IsObserverPlayer(LocalPlayer) then
		set s = "Objects\\Spawnmodels\\Other\\IllidanFootprint\\IllidanWaterSpawnFootPrint.mdl"
	endif
	call SaveInteger(HY, h, 5, level)
	call SaveUnitHandle(HY, h, 14, trigUnit)
	call SaveReal(HY, h, 6, x * 1.)
	call SaveReal(HY, h, 7, y * 1.)
	call SaveInteger(HY, h, 5, level)
	set r = 60 * bj_DEGTORAD
	set a = 0
	call SaveEffectHandle(HY, h, 175, AddSpecialEffect(s, x + 40 * Cos(a / r), y + 40 * Sin(a / r)))
	set a = 1
	call SaveEffectHandle(HY, h, 176, AddSpecialEffect(s, x + 40 * Cos(a / r), y + 40 * Sin(a / r)))
	set a = 2
	call SaveEffectHandle(HY, h, 177, AddSpecialEffect(s, x + 40 * Cos(a / r), y + 40 * Sin(a / r)))
	set a = 3
	call SaveEffectHandle(HY, h, 178, AddSpecialEffect(s, x + 40 * Cos(a / r), y + 40 * Sin(a / r)))
	set a = 4
	call SaveEffectHandle(HY, h, 179, AddSpecialEffect(s, x + 40 * Cos(a / r), y + 40 * Sin(a / r)))
	set a = 5
	call SaveEffectHandle(HY, h, 180, AddSpecialEffect(s, x + 40 * Cos(a / r), y + 40 * Sin(a / r)))
	call TriggerRegisterTimerEvent(t, 1.6, false)
	call TriggerAddCondition(t, Condition(function DHR))
	set trigUnit = null
	set t = null
endfunction

// 幻象的受伤害系数 很憨批的穷举 等模拟分身后再改
function GetIllusionUnitData takes unit d returns real
	//小娜迦幻象 鬼影重重 混沌之军 魔法镜像 崩裂禁锢 幻影斧 灵魂之矛 神行百变 并列
	if GetUnitAbilityLevel(d,'B0DA') > 0 then
		return 1.5
	elseif GetUnitAbilityLevel(d,'B06L') > 0 or GetUnitAbilityLevel(d,'B012') > 0 then
		return 2.
	elseif GetUnitAbilityLevel(d,'BO30') > 0 or GetUnitAbilityLevel(d,'BIil') > 0 or GetUnitAbilityLevel(d,'B0EB') > 0 or GetUnitAbilityLevel(d,'B07Z') > 0 then
		return 3.
	elseif GetUnitAbilityLevel(d,'BO35') > 0 then
		return 3.5
	elseif GetUnitAbilityLevel(d,'B40D') > 0 or GetUnitAbilityLevel(d,'B098') > 0 or GetUnitAbilityLevel(d,'BO40') > 0 then
		return 4.
	elseif GetUnitAbilityLevel(d,'BO50') > 0 then
		return 5.
	elseif GetUnitAbilityLevel(d,'B46G') > 0 or GetUnitAbilityLevel(d,'BO60') > 0 then
		return 6.
	endif
	return .0
endfunction

// 2022/1/12 A13T 和 A522 数据互换 不必使用魔法护盾来实现技能cd 重生已经可以
function Fix_Tidebringer_Add takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local integer level = LoadInteger(HY, h, 1)
	local integer iUnitHandleId = GetHandleId(whichUnit)
	if UnitAlive(whichUnit) then
		call UnitAddStateBonus(whichUnit, 15 * level + 5, UNIT_BONUS_DAMAGE)
		call UnitAddPermanentAbility(whichUnit,'A147')
		call SetUnitAbilityLevel(whichUnit,'A146', level)
		call UnitMakeAbilityPermanent(whichUnit, true,'A146')

		// debug call SingleDebug( "存活，可再加技能" )
		call SaveBoolean(ExtraHT, iUnitHandleId, HTKEY_SKILL_TIDEBRINGER, true)
		call SaveEffectHandle(ExtraHT, iUnitHandleId, HTKEY_SKILL_TIDEBRINGER, AddSpecialEffectTarget("effects\\WaterHands.mdx", whichUnit, GetHeroWeaponAttachPointName(whichUnit)))
		call CleanCurrentTrigger(t)
		call FlushChildHashtable(HY, h)
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
// 添加潮汐使者效果
function Tidebringer_Add takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local trigger trig = null
	local unit whichUnit = LoadUnitHandle(HY, GetHandleId(t), 0)
	local integer level = GetUnitAbilityLevel(whichUnit,'A13T')
	local integer iHandleId = GetHandleId(whichUnit)
	if not UnitAlive(whichUnit) then
		set trig = CreateTrigger()
		call TriggerRegisterTimerEvent(trig, 1, true)
		call TriggerAddCondition(trig, Condition(function Fix_Tidebringer_Add))
		call SaveUnitHandle(HY, GetHandleId(trig), 0, whichUnit)
		call SaveInteger(HY, GetHandleId(trig), 1, level)
		set trig = null
	else
		call UnitAddStateBonus(whichUnit, 15 * level + 5, UNIT_BONUS_DAMAGE)
		call UnitAddPermanentAbility(whichUnit,'A147')
		call SetUnitAbilityLevel(whichUnit,'A146', level)
		call UnitMakeAbilityPermanent(whichUnit, true,'A146')
		set iHandleId = GetHandleId(whichUnit)
		call SaveBoolean(ExtraHT, iHandleId, HTKEY_SKILL_TIDEBRINGER, true)
		call SaveEffectHandle(ExtraHT, iHandleId, HTKEY_SKILL_TIDEBRINGER, AddSpecialEffectTarget("effects\\WaterHands.mdx", whichUnit, GetHeroWeaponAttachPointName(whichUnit)))
	endif
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set whichUnit = null
endfunction

function Tidebringer_Ranged takes unit whichUnit, unit targetUnit, real attackDmg, integer level returns nothing
	local real x1 = GetUnitX(whichUnit)
	local real y1 = GetUnitY(whichUnit)
	local real range = 525 + 100 *(level / 4)
	local real radian = GetUnitFacing(whichUnit) * bj_DEGTORAD
	local real x2 = x1 + range * Cos(radian)
	local real y2 = y1 + range * Sin(radian)
	local real targetUnitArmor = GetUnitState(targetUnit, UNIT_STATE_ARMOR)
	local real reduceRatio = 1
	local unit firstUnit = null
	// 逆推税前伤害
	if IsFortDefenseTypeUnit(targetUnit) then
		set attackDmg = attackDmg * 2
	endif
	if targetUnitArmor >= 0 then
		set reduceRatio = 0.06 * targetUnitArmor / (0.06 * targetUnitArmor + 1)
		set reduceRatio = 1 - reduceRatio
	elseif targetUnitArmor < 0 then
		set reduceRatio = 2 - Pow(1 -0.06, -targetUnitArmor)
	endif
	set attackDmg = attackDmg / reduceRatio
	if IsUnitIllusion(targetUnit) then
		set attackDmg = attackDmg / GetIllusionUnitData(targetUnit)
	endif
	if Mode__RearmCombos then
		set Temp__ArrayReal[0]= attackDmg
	else
		set Temp__ArrayReal[0]= attackDmg * .8
	endif
	set Temp__ArrayUnit[0]= whichUnit
	set Temp__ArrayUnit[1]= targetUnit
	set Temp__Player = GetOwningPlayer(whichUnit)
	call GroupEnumUnitsInRange( AK, x2, y2, range, null )
	call GroupRemoveUnit( AK, targetUnit ) // 移除攻击目标 防止造成第二次伤害
	loop
		set firstUnit = FirstOfGroup(AK)
	exitwhen firstUnit == null
		call GroupRemoveUnit(AK, firstUnit)
		// 敌对 非守卫 非建筑 存活
		if IsUnitEnemy(firstUnit, Temp__Player) and GetUnitAbilityLevel(firstUnit,'A04R') == 0 and not IsUnitType(firstUnit, UNIT_TYPE_STRUCTURE) and UnitAlive(firstUnit) then
			call UnitDamageTargetEx(Temp__ArrayUnit[0], firstUnit, 2, Temp__ArrayReal[0])
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\WaterElementalMissile\\WaterElementalMissile.mdl", firstUnit, "chest"))
		endif
	endloop
	set firstUnit = null
endfunction

function IsUnitTidebringerAvailable takes unit whichUnit returns boolean
	return (YDWEGetUnitAbilityState(whichUnit, 'A522', 1) == 0)
endfunction

function Tidebringer_Actions takes unit whichUnit, unit targetUnit, real attackDmg returns nothing
	local integer iHandleId = GetHandleId(whichUnit)
	local integer level = GetUnitAbilityLevel(whichUnit,'A522')
	local real cooldown = 16 - 3 * level
	local integer timerHandleId = TimerStartSingle( cooldown, function Tidebringer_Add )
	call SaveUnitHandle(HY, timerHandleId, 0, whichUnit)
	// 移除潮汐使者效果
	call SaveBoolean(ExtraHT, iHandleId, HTKEY_SKILL_TIDEBRINGER, false)
	call DestroyTimerAndFlushHT_P(LoadTimerHandle(ExtraHT, iHandleId, HTKEY_SKILL_TIDEBRINGER))
	call DestroyEffect(LoadEffectHandle(ExtraHT, iHandleId, HTKEY_SKILL_TIDEBRINGER))
	call RemoveSavedHandle(ExtraHT, iHandleId, HTKEY_SKILL_TIDEBRINGER)

	call UnitReduceStateBonus(whichUnit, level * 15+ 5, UNIT_BONUS_DAMAGE)
	call UnitRemoveAbility(whichUnit,'A147')
	call YDWESetUnitAbilityState(whichUnit,'A522', 1, cooldown)

	if IsUnitType(whichUnit, UNIT_TYPE_RANGED_ATTACKER) then
		call Tidebringer_Ranged(whichUnit, targetUnit, attackDmg, level) // 远程
	endif
endfunction

function DamagedEvent__Tidebringer takes nothing returns nothing
	local integer h = GetHandleId(DESource)
	if IsUnitTidebringerAvailable(DESource) and LoadBoolean(ExtraHT, h, HTKEY_SKILL_TIDEBRINGER) and IsUnitEnemy(DESource, GetOwningPlayer(DETarget)) and(IsUnitType(DESource, UNIT_TYPE_MELEE_ATTACKER) or not IsUnitIllusion(DETarget)) then
		call Tidebringer_Actions(DESource, DETarget, DEDamage)
	endif
endfunction
function LearnSkill__Tidebringer takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer h = GetHandleId(u)
	local boolean isDestroyEffect = GetUnitAbilityLevel(u,'A36D') == 1 // 破坏效果
	// 如果有水刀 而且不是禁用技能状态 + 15 攻击力
	if LoadBoolean(ExtraHT, h, HTKEY_SKILL_TIDEBRINGER) and not isDestroyEffect then
		call UnitAddStateBonus(u, 15, UNIT_BONUS_DAMAGE)
	elseif GetUnitAbilityLevel(u,'A13T') == 1 then
		// 第一次学习
		call Learn_HaveCoolDownSkill()
		if not isDestroyEffect then
			call UnitAddStateBonus(u, 15 + 5, UNIT_BONUS_DAMAGE)
			call SaveEffectHandle(ExtraHT, h, HTKEY_SKILL_TIDEBRINGER, AddSpecialEffectTarget("effects\\WaterHands.mdx", u, GetHeroWeaponAttachPointName(u)))
		endif
		call SaveBoolean(ExtraHT, h, HTKEY_SKILL_TIDEBRINGER, true)
		if not isDestroyEffect then
			if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then // 如果是近战 就加分裂技能
				call UnitAddPermanentAbility(u,'A147')
				call UnitMakeAbilityPermanent(u, true,'A146')
			endif
		endif
	endif
	call SetUnitAbilityLevel(u,'A146', GetUnitAbilityLevel(u,'A13T'))
	set u = null
	set u = null
endfunction

//玩家是否选择了此技能
function PlayerHaveAbilityByActive takes player p, integer abid returns boolean
	local integer i = 1
	local integer maxi = 4 + ExtraSkillsNumber
	local integer pid = GetPlayerId(p)
	loop
		if HeroCommonSkills[PlayerSkillIndex[pid * HL + i]] == abid then
			return true
		endif
		set i = i + 1
	exitwhen i > maxi
	endloop
	return false
endfunction

//对切换型技能的筛选,防止拉比克大和技能导致的冲突
//先判断是否窃取的技能,再判断玩家是否选择了此技能
function Rubick_AbilityFilter takes unit u, integer abid returns boolean
	local integer h = GetHandleId(u)
	local integer pid = GetPlayerId(GetOwningPlayer(u))
	if LoadInteger(HY, h, 704) == 0 or LoadInteger(HY, h, 704) == abid then
		return true
	endif
	return PlayerHaveAbilityByActive(GetOwningPlayer(u), abid)
endfunction

function DWR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit target = LoadUnitHandle(HY, h, 30)
	local image i = LoadImageHandle(HY, h, 185)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local unit u = LoadUnitHandle(HY, h, 2)
	if GetTriggerEventId()!= EVENT_UNIT_SPELL_EFFECT or(GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A13D') then
		if GetTriggerEventId()!= EVENT_WIDGET_DEATH and(IsUnitMagicImmune(target) == false or IsUnitAlly(target, GetOwningPlayer(u))) then
			if IsUnitHidden(target) then
				call SetUnitX(target, x)
				call SetUnitY(target, y)
			else
				call SetUnitPosition(target, x, y)
			endif
		endif
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A13D', false)
		if Rubick_AbilityFilter(u, 'A11N') then
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A11N', true)
		endif
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call ShowImage(i, false)
		call DestroyImage(i)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set target = null
	set i = null
	set u = null
	return false
endfunction
function DYR takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit target = GetSpellTargetUnit()
	local real x = GetUnitX(target)
	local real y = GetUnitY(target)
	local real WBO = 90
	local image i = CreateImage("Fonts\\X.blp", WBO, WBO, 0, x -WBO / 2, y -WBO / 2, 0, 0, 0, 0, 2)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local string fx = ""
	//local integer level = GetUnitAbilityLevel(u,'A11N')
	local real dur = 4.
	if IsPlayerAlly(GetOwningPlayer(u), GetOwningPlayer(target)) then
		set dur = dur * 2
	endif
	call EPX(target, 4401, 5)
	call UnitAddPermanentAbility(u,'A13D')
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A13D', true)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A11N', false)
	call SetImageRenderAlways(i, true)
	if IsUnitAlly(u, GetOwningPlayer(target)) == false or IsUnitAlly(target, LocalPlayer) or IsObserverPlayer(LocalPlayer) then
		set fx = "effects\\BlackTide.mdx"
		call ShowImage(i, true)
	else
		call ShowImage(i, false)
	endif
	call SetImageColor(i, 255, 0, 0, 255)
	call UnitApplyTimedLife(CreateUnit(GetOwningPlayer(u),'o00G', x, y, 0),'BTLF', 5)
	call TriggerRegisterTimerEvent(t, dur, false)
	call TriggerRegisterDeathEvent(t, target)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function DWR))
	call SaveImageHandle(HY, h, 185, i)
	call SaveUnitHandle(HY, h, 30,(target))
	call SaveReal(HY, h, 6, x * 1.)
	call SaveReal(HY, h, 7, y * 1.)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget(fx, target, "overhead"))
	call SaveUnitHandle(HY, h, 2, u)
	set u = null
	set target = null
	set i = null
	set t = null
endfunction
function PZE takes nothing returns nothing
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(GetTriggerUnit()),'A13D', false)
	call UnitAddPermanentAbility(GetTriggerUnit(),'A13D')
endfunction
function D5E takes nothing returns nothing
	if IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) or not UnitHasSpellShield(GetSpellTargetUnit()) then
		call DYR()
	endif
endfunction
function KOE takes nothing returns nothing
	if (LoadBoolean(HY,(GetHandleId(GetOwningPlayer(GetSpellTargetUnit()))), 139)) and IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n038'))
	elseif IsUnitMagicImmune(GetSpellTargetUnit()) and IsUnitEnemy(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "无法作用于魔免的敌人")
	endif
endfunction
function DZR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer BOX = 1
	local player p
	local real d
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer D_R = LoadInteger(HY, h, 136)
	local integer N5O = LoadInteger(HY, h, 188)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetTriggerEvalCount(t)> N5O then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		loop
		exitwhen BOX > D_R
			set p = LoadPlayerHandle(HY, h, 1300+ BOX)
			set d = LoadReal(HY, h, 1200+ BOX)
			if p == null then
				set BOX = D_R
			else
				call SetWidgetLife(targetUnit, RMaxBJ(1, GetWidgetLife(targetUnit)-d / N5O))
			endif
			set BOX = BOX + 1
		endloop
	endif
	set t = null
	set p = null
	set targetUnit = null
	return false
endfunction
function D0R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local player p = LoadPlayerHandle(HY, h, 54)
	local trigger D1R = LoadTriggerHandle(HY, h, 135)
	local integer BOX = GetTriggerEvalCount(t)
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call TriggerRegisterTimerEvent(D1R, 1, true)
		call TriggerAddCondition(D1R, Condition(function DZR))
		call UnitRemoveAbility(targetUnit,'B09U')
	elseif FK then
		set h = GetHandleId(D1R)
		call SavePlayerHandle(HY, h, 1300+ BOX, GetOwningPlayer(GetEventDamageSource()))
		call SaveReal(HY, h, 1200+ BOX, .5 * GetEventDamage()* 1.)
		call SaveInteger(HY, h, 136, BOX)
	endif
	set t = null
	set targetUnit = null
	set p = null
	set D1R = null
	return false
endfunction
function D2R takes nothing returns nothing
	local unit whichUnit = HDV
	local unit targetUnit = GetEnumUnit()
	local integer level = HFV
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer N5O = 10
	local trigger D1R = CreateTrigger()
	call UnitAddAbilityToTimed(targetUnit,'A12D', 1, N5O,'B09U')
	call TriggerRegisterTimerEvent(t, N5O + .01, false)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function D0R))
	call SavePlayerHandle(HY, h, 54,(GetOwningPlayer(whichUnit)))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveTriggerHandle(HY, h, 135,(D1R))
	call SaveUnitHandle(HY,(GetHandleId(D1R)), 17,(targetUnit))
	call SaveInteger(HY,(GetHandleId(D1R)), 188,(N5O))
	set whichUnit = null
	set targetUnit = null
	set t = null
	set D1R = null
endfunction
function D3R takes nothing returns boolean
	if (IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) == false and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit())) and IsUnitInGroup(GetFilterUnit(), HCV) == false then
		call GroupAddUnit(HCV, GetFilterUnit())
		return true
	endif
	return false
endfunction
function D4R takes nothing returns nothing
	local unit whichUnit = HDV
	local unit targetUnit = GetEnumUnit()
	local integer level = HFV
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddPermanentAbility(dummyCaster,'A13X')
	call IssueTargetOrderById(dummyCaster, 852095, targetUnit)
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, 300 + 100 * level)
	set whichUnit = null
	set targetUnit = null
	set dummyCaster = null
endfunction

function YOI1 takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) or IsUnitIllusion(GetFilterUnit()) ) and DCX() 
endfunction

function D5R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit missileDummy =(LoadUnitHandle(HY, h, 45))
	local unit D6R
	local real a =(LoadReal(HY, h, 13))
	local real sx = GetUnitX(missileDummy)
	local real sy = GetUnitY(missileDummy)
	local real tx =(LoadReal(HY, h, 66))
	local real ty =(LoadReal(HY, h, 67))
	local integer count = GetTriggerEvalCount(t)
	local real targetX = CoordinateX50(tx + 13.33 * count * Cos(a))
	local real targetY = CoordinateY50(ty + 13.33 * count * Sin(a))
	local integer lv =(LoadInteger(HY, h, 5))
	local group D7R =(LoadGroupHandle(HY, h, 187))
	local group g
	local group g2
	local unit u
	local boolean b = LoadBoolean(HY, h, 5)
	local integer TYIPP = LoadInteger(HY, h, 6)
	if not b then
		if count < 19 then
			call SetUnitVertexColor(missileDummy, 255, 255, 255, 5 + count * 10)
			set D6R =(LoadUnitHandle(HY, h, 186))
			call SetUnitVertexColor(D6R, 255, 255, 255, 5 + count * 10)
		elseif count < 125 then
			call SetUnitVertexColor(missileDummy, 255, 255, 255, 190)
		endif
	else
		if count < 10 then
			call SetUnitVertexColor(missileDummy, 255, 255, 255, 5 + count * 20)
			call SetUnitVertexColor(LoadUnitHandle(HY, h, 186), 255, 255, 255, 5 + count * 20)
		elseif count < 62 then
			call SetUnitVertexColor(missileDummy, 255, 255, 255, 190)
		endif
	endif
	set g = AllocationGroup(123)
	set HCV = D7R
	set U2 = missileDummy
	set HDV = missileDummy
	set HFV = lv
	call GroupEnumUnitsInRange(g, GetUnitX(missileDummy), GetUnitY(missileDummy), 425, Condition(function D3R))
	call ForGroup(g, function D2R)
	call DeallocateGroup(g)
	call SetUnitX(missileDummy, targetX)
	call SetUnitY(missileDummy, targetY)
	if b then
		set g2 = AllocationGroup(124)
		set TYIPP = 70
		call GroupEnumUnitsInRange(g2, targetX, targetY, 225, Condition(function YOI1))
		loop
			set u = FirstOfGroup(g2)
		exitwhen u == null
			call SetUnitX(u, targetX)
			call SetUnitY(u, targetY)
			call GroupRemoveUnit(g2, u)
		endloop
		call DeallocateGroup(g2)
		if ModuloInteger(count, 10) == 1 then
			call KillTreeByCircle(targetX, targetY, 325)
		endif
	else
		set TYIPP = 140
	endif
	if count == TYIPP then
		set D6R =(LoadUnitHandle(HY, h, 186))
		call KillUnit(D6R)
	elseif count < TYIPP then
		set D6R =(LoadUnitHandle(HY, h, 186))
		call SetUnitX(D6R, targetX)
		call SetUnitY(D6R, targetY)
	endif
	if count == LoadInteger(HY, h, 6) then
		set g = AllocationGroup(125)
		set U2 = missileDummy
		call GroupEnumUnitsInRange(g, targetX, targetY, 450, Condition(function DHX))
		call ForGroup(g, function D4R)
		call DeallocateGroup(g)
		call KillUnit(missileDummy)
		call DeallocateGroup(D7R)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set missileDummy = null
	set D6R = null
	set D7R = null
	set g = null
	set g2 = null
	set u = null
	return false
endfunction
function YYV takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real sx = GetUnitX(u)
	local real sy = GetUnitY(u)
	local real x0 = GetSpellTargetX()
	local real y0 = GetSpellTargetY()
	local real a
	local real x1
	local real y1
	local real x2
	local real y2
	local trigger t
	local integer h
	local integer lv
	local unit missileDummy
	local unit D6R
	local string s = ""
	local integer D8R ='h06U'
	local boolean b = GetSpellAbilityId()=='Z31K'
	local integer c = 150
	if GetRandomInt(0, 5) == 0 then
		set D8R ='h0DJ'
	endif
	if IsPlayerAlly(GetOwningPlayer(u), LocalPlayer) or IsObserverPlayer(LocalPlayer) then
		set s = "war3mapImported\\Whirlpool.mdx"
	endif
	if x0 == GetUnitX(u) and y0 == GetUnitY(u) then
		set x0 = x0 + 50 * Cos(GetUnitFacing(u)* bj_DEGTORAD)
		set y0 = y0 + 50 * Sin(GetUnitFacing(u)* bj_DEGTORAD)
	endif
	set a = Atan2(y0 -sy, x0 -sx)
	if b then
		set x1 = sx
		set y1 = sy
		set c = c / 2
	else
		set x1 = sx -1000 * Cos(a)
		set y1 = sy -1000 * Sin(a)
	endif
	set x2 = sx + 1000* Cos(a)
	set y2 = sy + 1000* Sin(a)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	set lv = GetUnitAbilityLevel(u,'A11K')+ GetUnitAbilityLevel(u,'Z31K')
	set missileDummy = CreateUnit(GetOwningPlayer(u), D8R, x1, y1, Atan2(y0 -sy, x0 -sx)* bj_RADTODEG)
	set D6R = CreateUnit(GetOwningPlayer(u),'h06V', x1, y1, Atan2(y0 -sy, x0 -sx)* bj_RADTODEG)
	call SetUnitVertexColor(missileDummy, 255, 255, 255, 0)
	call SetUnitPathing(missileDummy, false)
	call SaveInteger(HY, h, 5,(lv))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveUnitHandle(HY, h, 45,(missileDummy))
	call SaveUnitHandle(HY, h, 186,(D6R))
	call SaveReal(HY, h, 66,((x1)* 1.))
	call SaveReal(HY, h, 67,((y1)* 1.))
	call SaveGroupHandle(HY, h, 187,(AllocationGroup(126)))
	call SaveBoolean(HY, h, 5, b)
	call SaveInteger(HY, h, 6, c)
	call DestroyEffect(AddSpecialEffect(s, CoordinateX50(x2), CoordinateY50(y2)))
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function D5R))
	set u = null
	set t = null
	set missileDummy = null
	set D6R = null
endfunction
function PQX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A11L')
endfunction
function D9R takes nothing returns boolean
	local unit t = GetFilterUnit()
	if IsUnitEnemy(Temp__ArrayUnit[0], GetOwningPlayer(t)) and IsAliveNotStrucNotWard(t) then
		if Temp__ArrayReal[4]== 1 and GetUnitAbilityLevel(t,'A3E9') == 1 and IsUnitMagicImmune(Temp__ArrayUnit[1]) == false then
			call SaveInteger(OtherHashTable2,'A3E9','0lvl', R2I(Temp__ArrayReal[2]))
			call SaveUnitHandle(OtherHashTable2,'A3E9','targ', Temp__ArrayUnit[1])
			call SaveUnitHandle(OtherHashTable2,'A3E9','cstr', t)
			call SaveReal(OtherHashTable2,'A3E9','0dur', Temp__ArrayReal[3])
			call ExecuteFunc("FVR")
		endif
		if UnitHasSpellShield(t) == false then
			call UnitDamageTargetEx(Temp__ArrayUnit[0], t, 2, Temp__ArrayReal[0])
			call CommonUnitAddStun(t, Temp__ArrayReal[1], false)
		else
			call UnitRemoveSpellShield(t)
		endif
	endif
	set t = null
	return false
endfunction
function FER takes unit u, real WLV, real x, real y, boolean b, integer WUV, boolean FXR returns nothing
	set Temp__ArrayReal[3]= WLV
	set WLV = WLV / 5.
	set Temp__ArrayReal[0]=(60 + 70 * WUV)* WLV
	set Temp__ArrayReal[1]=(1 + .75 * WUV)* WLV
	set Temp__ArrayReal[2]= WUV
	set Temp__ArrayReal[4]= 0
	set Temp__ArrayUnit[0]= I_X(u)
	set Temp__ArrayUnit[1]= u
	if FXR then
		set Temp__ArrayReal[4]= 1
	endif
	call GroupEnumUnitsInRange(AK, x, y, 200, Condition(function D9R))
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\DemolisherFireMissile\\DemolisherFireMissile.mdl", x, y))
	if b then
		call UnitDamageTargetEx(Temp__ArrayUnit[0], u, 2, Temp__ArrayReal[0])
		call CommonUnitAddStun(u, Temp__ArrayReal[1], false)
	endif
endfunction
function FOR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local unit missileDummy = LoadUnitHandle(HY, h, 45)
	local real SAX = LoadReal(HY, h, 444)
	local real a = AngleBetweenXY(GetUnitX(missileDummy), GetUnitY(missileDummy), GetUnitX(targetUnit), GetUnitY(targetUnit))
	local real x = GetUnitX(missileDummy)+ 18 * Cos(a * bj_DEGTORAD)
	local real y = GetUnitY(missileDummy)+ 18 * Sin(a * bj_DEGTORAD)
	local integer level = LoadInteger(HY, h, 0)
	call SetUnitX(missileDummy, x)
	call SetUnitY(missileDummy, y)
	if GetDistanceBetween(x, y, GetUnitX(targetUnit), GetUnitY(targetUnit))<= 18 or(GetUnitX(targetUnit) == 0 and GetUnitY(targetUnit) == 0) then
		call KillUnit(missileDummy)
		call FER(whichUnit, SAX, x, y, false, level, LoadBoolean(HY, h, 0))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set missileDummy = null
	return false
endfunction
function FRR takes unit Q4X, unit to, real FIR, integer level, boolean FAR returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit missileDummy = CreateUnit(GetOwningPlayer(Q4X),'h0BD', GetUnitX(Q4X), GetUnitY(Q4X), GetUnitFacing(Q4X))
	call SaveUnitHandle(HY, h, 2, Q4X)
	call SaveUnitHandle(HY, h, 17, to)
	call SaveUnitHandle(HY, h, 45, missileDummy)
	call SaveReal(HY, h, 444, FIR * 1.)
	call SaveInteger(HY, h, 0, level)
	call SaveBoolean(HY, h, 0, FAR)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function FOR))
	set missileDummy = null
	set t = null
endfunction
function FVR takes nothing returns nothing
	local unit whichUnit = LoadUnitHandle(OtherHashTable2,'A3E9','cstr')
	local unit targetUnit = LoadUnitHandle(OtherHashTable2,'A3E9','targ')
	local real FNR = LoadReal(OtherHashTable2,'A3E9','0dur')
	local integer level = LoadInteger(OtherHashTable2,'A3E9','0lvl')
	call FRR(whichUnit, targetUnit, FNR, level, true)
	call T4V(whichUnit)
	call FlushChildHashtable(OtherHashTable2,'A3E9')
	set whichUnit = null
	set targetUnit = null
endfunction
function FBR takes string s, unit targetUnit, unit trigUnit returns nothing
	local texttag tt = CreateTextTag()
	call SetTextTagPosUnit(tt, targetUnit, 64)
	call SetTextTagColor(tt, 255, 0, 0, 255)
	call SetTextTagVelocity(tt, 0, .0355)
	call SetTextTagFadepoint(tt, .15)
	call SetTextTagPermanent(tt, false)
	call SetTextTagLifespan(tt, .65)
	if (IsUnitAlly(trigUnit, LocalPlayer) or IsObserverPlayer(LocalPlayer)) == false then
		set s = ""
	endif
	call SetTextTagText(tt, s, .033)
	call SetTextTagVisibility(tt, true)
	set tt = null
endfunction
function FCR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local real FDR = LoadReal(HY, h, 442)
	local real KGX = GetGameTime()
	local real Y2X = 5. -(KGX -FDR)
	local real time = RMinBJ(KGX -FDR, 5.)
	local integer count = LoadInteger(HY, h, 34)+ 1
	local integer i
	local string s
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		if Rubick_AbilityFilter(whichUnit , 'A1NI') then
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1NI', true)
		endif
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1NH', false)
		call ResetUnitVertexColor(whichUnit)
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
		if GetSpellAbilityId()=='A1NH' then
			call FRR(whichUnit, GetSpellTargetUnit(), time, level, false)
			if Rubick_AbilityFilter(whichUnit , 'A1NI') then
				call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1NI', true)
			endif
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1NH', false)
			call ResetUnitVertexColor(whichUnit)
			call DestroyEffect(LoadEffectHandle(HY, h, 32))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	else
		call SaveInteger(HY, h, 34, count)
		if Y2X >= 0 then
			set i = R2I(Y2X)
			set s = I2S(i)
			if Y2X -i >= .5 then
				set s = s + ".5"
			else
				set s = s + ".0"
			endif
			set i = ModuloInteger(count, 2)* 75
			call FBR(s, whichUnit, whichUnit)
			call SetUnitVertexColorEx(whichUnit, 255, 100 + i, 100 + i,-1)
		else
			call SetUnitVertexColorEx(whichUnit, 255, 0, 0,-1)
		endif
		if KGX -FDR >(5. + .5) then
			call FER(whichUnit, 5., GetWidgetX(whichUnit), GetWidgetY(whichUnit), true, level, true)
			if Rubick_AbilityFilter(whichUnit , 'A1NI') then
				call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1NI', true)
			endif
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1NH', false)
			call ResetUnitVertexColor(whichUnit)
			call DestroyEffect(LoadEffectHandle(HY, h, 32))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function YZV takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local string s = "war3mapImported\\UnstableConcoctionRangeDisplay3.mdx"
	if LocalPlayer!= GetOwningPlayer(whichUnit) then
		set s = ""
	endif
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveReal(HY, h, 442, GetGameTime())
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit,'A1NI'))
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget(s, whichUnit, "origin"))
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerAddCondition(t, Condition(function FCR))
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1NI', false)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1NH', true)
	call UnitAddPermanentAbility(whichUnit,'A1NH')
	call TriggerEvaluate(t)
	set whichUnit = null
	set t = null
endfunction
function FFR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer DSR = LoadInteger(ObjectHashTable, h, 0)
	call SaveInteger(ObjectHashTable, DSR,'A0O3', LoadInteger(ObjectHashTable, DSR,'A0O3')-LoadInteger(ObjectHashTable, h, 1))
	call DestroyTimerAndFlushHT_P(t)
	set t = null
endfunction
function FGR takes unit u, unit d, player p, integer WUV returns nothing
	local timer t = CreateTimer()
	local texttag tag
	local integer h = GetHandleId(t)
	local integer hu = GetHandleId(u)
	local integer goldBonus = LoadInteger(ObjectHashTable, hu,'A0O3')+ WUV * 2 + 2
	local boolean b = IsUnitType(d, UNIT_TYPE_HERO)
	if goldBonus > (8 * WUV) then
		set goldBonus = 8 * WUV
	endif
	if b then
		set tag = CreateTextTag()
		set goldBonus = AddPlayerResourceGold(p, goldBonus)
		call SetTextTagText(tag, "+" + I2S(goldBonus), .025)
		call SetTextTagPosUnit(tag, d, .3)
		call SetTextTagColor(tag, 255, 220, 0, 255)
		call SetTextTagVelocity(tag, 0, .05)
		call SetTextTagVisibility(tag, LocalPlayer== p)
		call SetTextTagFadepoint(tag, 2)
		call SetTextTagLifespan(tag, 3)
		call SetTextTagPermanent(tag, false)
		set tag = null
	endif
	call SaveInteger(ObjectHashTable, hu,'A0O3', 2 + LoadInteger(ObjectHashTable, hu,'A0O3'))
	call SaveInteger(ObjectHashTable, h, 0, hu)
	call SaveInteger(ObjectHashTable, h, 1, 2)
	call TimerStart(t, 25, false, function FFR)
	set hu = GetHandleId(p)
	call SaveInteger(ObjectHashTable, hu,'A0O3', LoadInteger(ObjectHashTable, hu,'A0O3')+ goldBonus)
	set t = null
	set tag = null
endfunction
function FJR takes unit u, unit t returns nothing
	local player p = GetOwningPlayer(u)
	local integer WUV
	if GetUnitAbilityLevel(u,'Aloc') == 1 then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
	set WUV = GetUnitAbilityLevel(u,'P155')
	if GetUnitAbilityLevel(u,'A36D')!= 0 then
		set WUV = 0
	endif
	if WUV > 0 and IsUnitEnemy(t, p) and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false and IsUnitIllusion(t) == false and(GetUnitAbilityLevel(t,'A04R') == 0) then
		call FGR(u, t, p, WUV)
	endif
endfunction
function FKR takes nothing returns nothing
	local integer ETX
	local integer WFV
	local unit t = GetFilterUnit()
	if UnitAlive(t) and IsUnitEnemy(t, Temp__Player) and GetUnitAbilityLevel(t,'A04R') == 0 and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false and GetUnitTypeId(t)!='n0F5' then
		call GroupAddUnit(BK, t)
		call UnitDamageTargetEx(Temp__ArrayUnit[0], t, 2, XK[0])
		if IsUnitInGroup(t, IK) == false then
			set WFV = GetHandleId(t)
			set ETX = StringHash("acidspray_count")
			call UnitReduceStateBonus(t, XK[1], UNIT_BONUS_ARMOR)
			call SaveInteger(ObjectHashTable, GetHandleId(t), StringHash("acidspray"), LoadInteger(ObjectHashTable, GetHandleId(t), StringHash("acidspray")+ XK[1]))
			call UnitAddAbilityLevel1ToTimed(t,'C014','D014',-1)
			call SaveInteger(ObjectHashTable, WFV, ETX, LoadInteger(ObjectHashTable, WFV, ETX)+ 1)
			set t = null
			return
		endif
		call GroupRemoveUnit(IK, t)
	endif
	set t = null
endfunction
function FLR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(ObjectHashTable, h, 2)
	if E8X(u) == false then
		call WHV(u,'D014')
		call UnitAddStateBonus(u, LoadInteger(ObjectHashTable, h, 0), UNIT_BONUS_ARMOR)
		call DisableTrigger(t)
		call DestroyTrigger(t)
		call FlushChildHashtable(ObjectHashTable, h)
	endif
	set u = null
	set t = null
	return false
endfunction
function FMR takes nothing returns nothing
	local unit u = null
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer ETX = StringHash("acidspray_count")
	local integer UYX = LoadInteger(ObjectHashTable, WFV, 0)
	local trigger tt
	local integer h
	set XK[1]= LoadInteger(ObjectHashTable, WFV, 2)
	set IK = LoadGroupHandle(ObjectHashTable, WFV, 1)
	if UYX == 17 then
		set UYX = LoadInteger(ObjectHashTable, WFV, 2)
		call DestroyEffect(LoadEffectHandle(ObjectHashTable, WFV, 2))
		loop
			set u = FirstOfGroup(IK)
		exitwhen u == null
			set WFV = GetHandleId(u)
			set UYX = LoadInteger(ObjectHashTable, WFV, ETX)
			if E8X(u) == false then
				if UYX == 1 then
					call WHV(u,'D014')
				endif
				call SaveInteger(ObjectHashTable, GetHandleId(u), StringHash("acidspray"), IMinBJ(LoadInteger(ObjectHashTable, GetHandleId(u), StringHash("acidspray")-XK[1]), 0))
				call UnitAddStateBonus(u, XK[1], UNIT_BONUS_ARMOR)
			else
				set tt = CreateTrigger()
				call TriggerRegisterTimerEvent(tt, 1, true)
				call TriggerAddCondition(tt, Condition(function FLR))
				set h = GetHandleId(tt)
				call SaveInteger(ObjectHashTable, h, 0, XK[1])
				call SaveUnitHandle(ObjectHashTable, h, 2, u)
				set tt = null
			endif
			call SaveInteger(ObjectHashTable, WFV, ETX, UYX -1)
			call GroupRemoveUnit(IK, u)
		endloop
		call DeallocateGroup(IK)
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		return
	endif
	call SaveInteger(ObjectHashTable, WFV, 0, UYX + 1)
	set Temp__Player = LoadPlayerHandle(ObjectHashTable, WFV, 3)
	set Temp__ArrayUnit[0]= LoadUnitHandle(ObjectHashTable, WFV, 0)
	set XK[0]= LoadInteger(ObjectHashTable, WFV, 1)
	call GroupEnumUnitsInRange(AK, LoadReal(ObjectHashTable, WFV, 0), LoadReal(ObjectHashTable, WFV, 1), 650, Condition(function FKR))
	loop
		set u = FirstOfGroup(IK)
	exitwhen u == null
		set WFV = GetHandleId(u)
		set UYX = LoadInteger(ObjectHashTable, WFV, ETX)
		if UYX == 1 then
			call WHV(u,'D014')
		endif
		call SaveInteger(ObjectHashTable, WFV, ETX, UYX -1)
		call SaveInteger(ObjectHashTable, WFV, StringHash("acidspray"), LoadInteger(ObjectHashTable, WFV, StringHash("acidspray")-XK[1]))
		call UnitAddStateBonus(u, XK[1], UNIT_BONUS_ARMOR)
		call GroupRemoveUnit(IK, u)
	endloop
	loop
		set u = FirstOfGroup(BK)
	exitwhen u == null
		call GroupRemoveUnit(BK, u)
		call GroupAddUnit(IK, u)
	endloop
	set u = null
	set tt = null
	set t = null
endfunction
function YOV takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local integer WUV = GetUnitAbilityLevel(u,'A0IL')
	local integer WFV = GetHandleId(t)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	call SaveUnitHandle(ObjectHashTable, WFV, 0, u)
	call SaveGroupHandle(ObjectHashTable, WFV, 1, AllocationGroup(127))
	call SaveEffectHandle(ObjectHashTable, WFV, 2, AddSpecialEffect("effects\\Radioactivecloud_2c.mdl", x, y))
	call SavePlayerHandle(ObjectHashTable, WFV, 3, GetOwningPlayer(u))
	call SaveInteger(ObjectHashTable, WFV, 0, 0)
	call SaveInteger(ObjectHashTable, WFV, 1, WUV * 6 + 8)
	call SaveInteger(ObjectHashTable, WFV, 2, WUV + 3)
	call SaveReal(ObjectHashTable, WFV, 0, x)
	call SaveReal(ObjectHashTable, WFV, 1, y)
	call TimerStart(t, 1, true, function FMR)
	set t = null
	set u = null
endfunction
function FPR takes unit trigUnit, unit targetUnit returns nothing
	local integer level = GetUnitAbilityLevel(trigUnit,'A0E3')
	local real IXX =(.35 + .25 * level)*(GetUnitState(targetUnit, UNIT_STATE_MAX_MANA)-GetUnitState(targetUnit, UNIT_STATE_MANA))
	local group g = AllocationGroup(128)
	local unit u2
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\DragonHawkMissile\\DragonHawkMissile.mdl", targetUnit, "chest"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SpiritOfVengeanceMissile\\SpiritOfVengeanceMissile.mdl", targetUnit, "chest"))
	call DestroyEffect(AddSpecialEffect("war3mapImported\\Enchantment.mdx", GetUnitX(targetUnit), GetUnitY(targetUnit)))
	set U2 = trigUnit
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 500 + 25, Condition(function DHX))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call UnitDamageTargetEx(trigUnit, u2, 1, IXX)
		call GroupRemoveUnit(g, u2)
	endloop
	call PlaySoundOnUnitBJ(NC, 100, targetUnit)
	call DeallocateGroup(g)
	set g = null
endfunction
function FQR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	if UnitHasSpellShield(targetUnit) == false then
		call FPR(LoadUnitHandle(HY, h, 0), targetUnit)
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set targetUnit = null
endfunction
function Y_V takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
	call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
	call TimerStart(t, 0, false, function FQR)
	set t = null
endfunction
function FSR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	local integer count = GetTriggerEvalCount(t)
	local integer FTR = R2I(((.9 -0.3)/ .5)/ .03)
	local integer FUR = R2I((175 / FTR))
	local integer FWR = R2I(( 255/ FTR)* 1.75)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	if count > FTR then
		call SetUnitVertexColor(dummyCaster, 255, 255, 255, 0)
		call SetUnitVertexColorEx(trigUnit,-1,-1,-1, 255)
		call ShowUnit(dummyCaster, false)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SetUnitVertexColor(dummyCaster, 255, 255, 255, 175 -FUR * count)
		call SetUnitX(dummyCaster, x)
		call SetUnitY(dummyCaster, y)
		call SetUnitVertexColorEx(trigUnit,-1,-1,-1, FWR * count)
	endif
	set t = null
	set dummyCaster = null
	set trigUnit = null
	return false
endfunction
function BlinkOnSpellEffect takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local unit dummyCaster =(LoadUnitHandle(HY,(GetHandleId(trigUnit)), 293))
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x = GetUnitX(trigUnit)
	local real y = GetUnitY(trigUnit)
	call SetUnitX(dummyCaster, x)
	call SetUnitY(dummyCaster, y)
	call SetUnitX(trigUnit, x)
	call SetUnitY(trigUnit, y)
	call SetUnitVertexColorEx(trigUnit,-1,-1,-1, 0)
	call SetUnitVertexColor(dummyCaster, 255, 255, 255, 175)
	call SetUnitTimeScale(dummyCaster, .5)
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function FSR))
	set trigUnit = null
	set dummyCaster = null
	set t = null
endfunction
function BlinkOnSpellCast takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local unit dummyCaster
	local integer h = GetHandleId(trigUnit)
	local real a = AngleBetweenXY(GetUnitX(trigUnit), GetUnitY(trigUnit), GetSpellTargetX(), GetSpellTargetY())
	local real x = GetUnitX(trigUnit)
	local real y = GetUnitY(trigUnit)
	call SetUnitPathing(trigUnit, false)
	call UnitAddPermanentAbility(trigUnit,'Aeth') // ???
	set dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'h06K', GetUnitX(trigUnit), GetUnitY(trigUnit), a)
	call RemoveUnitToTimed(dummyCaster, 5.)
	call SetUnitPathing(dummyCaster, false)
	call UnitAddPermanentAbility(dummyCaster,'Aeth')
	call UnitAddPermanentAbility(dummyCaster,'Aloc')
	call UnitAddPermanentAbility(dummyCaster,'A04R')
	call SetUnitVertexColor(dummyCaster, 255, 255, 255, 0)
	call SetUnitX(dummyCaster, x)
	call SetUnitY(dummyCaster, y)
	call SetUnitX(trigUnit, x)
	call SetUnitY(trigUnit, y)
	call SetUnitAnimation(dummyCaster, "Spell Throw")
	call SetUnitPathing(trigUnit, true)
	call UnitRemoveAbility(trigUnit, 'Aeth') // ???
	call SaveUnitHandle(HY, h, 293,(dummyCaster))
	set trigUnit = null
	set dummyCaster = null
endfunction
function FYR takes nothing returns nothing
	if GetUnitAbilityLevel(DESource,'P133')> 0 and GetUnitAbilityLevel(DESource,'A36D') == 0 and GetUnitState(DETarget, UNIT_STATE_MANA)> 0 then
		call B2O(DESource, DETarget, 16 + 12 * GetUnitAbilityLevel(DESource,'P133'))
	endif
endfunction
function FZR takes nothing returns nothing
	if GetUnitAbilityLevel(DESource,'P133')> 0 and IsUnitType(DESource, UNIT_TYPE_MELEE_ATTACKER) and GetUnitAbilityLevel(DESource,'A36D') == 0 and GetUnitState(DETarget, UNIT_STATE_MANA)> 0 then
		call B2O(DESource, DETarget, 16 + 12 * GetUnitAbilityLevel(DESource,'P133'))
	endif
endfunction
function F_R takes nothing returns nothing
	call RegisterUnitAttackEvent("FYR", 4)
endfunction
function F0R takes unit u, real x, real y, group CNO, integer level returns nothing
	local group g = AllocationGroup(129)
	local unit u2
	call KillTreeByCircle(x, y, 150)
	call GroupEnumUnitsInRange(g, x, y, 150, null)
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		if (IsUnitInGroup(u2, CNO) == false and IsUnitEnemy(u2, GetOwningPlayer(u))) then
			if (GetUnitAbilityLevel(u2,'A04R')!= 1 and UnitIsDead(u2) == false and IsUnitType(u2, UNIT_TYPE_STRUCTURE) == false) then
				call GroupAddUnit(CNO, u2)
				call UnitDamageTargetEx(u, u2, 5, 60 + level * 30)
				call AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", u2, "overhead")
			endif
		endif
		call GroupRemoveUnit(g, u2)
	endloop
	call DeallocateGroup(g)
	set g = null
	set u2 = null
endfunction
function F1R takes nothing returns nothing
	local integer h = GetHandleId(GetExpiredTimer())
	local unit F2R = LoadUnitHandle(HY, h, 290)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	local real sx = LoadReal(HY, h, 284)
	local real sy = LoadReal(HY, h, 285)
	local real tx = LoadReal(HY, h, 286)
	local real ty = LoadReal(HY, h, 287)
	local real Bx = LoadReal(HY, h, 288)
	local real By = LoadReal(HY, h, 289)
	local real a = LoadReal(HY, h, 137)
	local real b = 1 -a
	local boolean DBR = LoadBoolean(HY, h, 291)
	local group CNO = LoadGroupHandle(HY, h, 133)
	local real DCR = RMaxBJ(GetDistanceBetween(sx, sy, tx, ty)/  ( 1300. + GetUnitCastRangeBonus(trigUnit) ), .4)
	call SetUnitX(F2R, CoordinateX50(sx * a * a + Bx * 2 * a * b + tx * b * b))
	call SetUnitY(F2R, CoordinateY50(sy * a * a + By * 2 * a * b + ty * b * b))
	call F0R(trigUnit, GetUnitX(F2R), GetUnitY(F2R), CNO, LoadInteger(HY, h, 0))
	if (DBR) then
		call SaveReal(HY, h, 137,((a -0.02 / DCR)* 1.))
	else
		call SaveReal(HY, h, 137,((a + .02 / DCR)* 1.))
		call SaveReal(HY, h, 284, GetUnitX(trigUnit))
		call SaveReal(HY, h, 285, GetUnitY(trigUnit))
	endif
	if (a < 0 and DBR) then
		call SaveBoolean(HY, h, 291, false)
		call SaveReal(HY, h, 288,(sx + 300 * Cos(Atan2(ty -sy, tx -sx)+ LoadReal(HY, h, 292)))* 1.)
		call SaveReal(HY, h, 289,(sy + 300 * Sin(Atan2(ty -sy, tx -sx)+ LoadReal(HY, h, 292)))* 1.)
	endif
	if (a > 1 and DBR == false) then
		call PauseTimer(GetExpiredTimer())
		call DeallocateGroup(CNO)
		call FlushChildHashtable(HY, h)
		call RemoveUnit(F2R)
		call DestroyTimer(GetExpiredTimer())
	endif
	set F2R = null
	set trigUnit = null
	set CNO = null
endfunction
function WildAxesOnSpellEffect takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real sx
	local real sy
	local real tx = GetSpellTargetX()
	local real ty = GetSpellTargetY()
	local unit a1
	local unit a2
	local integer h1
	local integer h2
	local timer t1 = CreateTimer()
	local timer t2 = CreateTimer()
	if GetUnitTypeId(u)=='e00E' then 
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))] 
	endif
	set sx = GetUnitX(u)
	set sy = GetUnitY(u)
	set a1 = CreateUnit(GetOwningPlayer(u),'e01T', sx, sy, 270.)
	set a2 = CreateUnit(GetOwningPlayer(u),'e01T', sx, sy, 270.)
	if GetSpellTargetUnit()!= null then
		set tx = GetUnitX(GetSpellTargetUnit())
		set ty = GetUnitY(GetSpellTargetUnit())
	endif
	call UnitAddPermanentAbility(a1,'Amrf')
	call UnitRemoveAbility(a1,'Amrf')
	call SetUnitFlyHeight(a1, 150, 0)
	call UnitAddPermanentAbility(a2,'Amrf')
	call UnitRemoveAbility(a2,'Amrf')
	call SetUnitFlyHeight(a2, 150, 0)
	set h1 = GetHandleId(t1)
	call SaveUnitHandle(HY, h1, 14, u)
	call SaveUnitHandle(HY, h1, 290, a1)
	call SaveGroupHandle(HY, h1, 133, AllocationGroup(130))
	call SaveReal(HY, h1, 284, sx * 1.)
	call SaveReal(HY, h1, 285, sy * 1.)
	call SaveReal(HY, h1, 286, tx * 1.)
	call SaveReal(HY, h1, 287, ty * 1.)
	call SaveReal(HY, h1, 288,(sx + 300 * Cos(Atan2(ty -sy, tx -sx)+ 45))* 1.)
	call SaveReal(HY, h1, 289,(sy + 300 * Sin(Atan2(ty -sy, tx -sx)+ 45))* 1.)
	call SaveReal(HY, h1, 137, 1.)
	call SaveReal(HY, h1, 292,-45.)
	call SaveBoolean(HY, h1, 291, true)
	set h2 = GetHandleId(t2)
	call SaveUnitHandle(HY, h2, 14, u)
	call SaveUnitHandle(HY, h2, 290, a2)
	call SaveGroupHandle(HY, h2, 133, AllocationGroup(131))
	call SaveReal(HY, h2, 284, sx * 1.)
	call SaveReal(HY, h2, 285, sy * 1.)
	call SaveReal(HY, h2, 286, tx * 1.)
	call SaveReal(HY, h2, 287, ty * 1.)
	call SaveReal(HY, h2, 288,(sx + 300 * Cos(Atan2(ty -sy, tx -sx)-45))* 1.)
	call SaveReal(HY, h2, 289,(sy + 300 * Sin(Atan2(ty -sy, tx -sx)-45))* 1.)
	call SaveReal(HY, h2, 137, 1.)
	call SaveReal(HY, h2, 292, 45.)
	call SaveBoolean(HY, h2, 291, true)
	call SaveInteger(HY, h2, 0, GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call SaveInteger(HY, h1, 0, GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call TimerStart(t1, .025, true, function F1R)
	call TimerStart(t2, .025, true, function F1R)
	set u = null
	set a1 = null
	set a2 = null
	set t1 = null
	set t2 = null
endfunction
function F3R takes nothing returns nothing
	local real x = GetUnitX(GetEnumUnit())
	local real y = GetUnitY(GetEnumUnit())
	local real a = bj_RADTODEG * Atan2(y -TJ, x -S2)
	local real F4R
	local real F5R
	local real UCV
	if Sin((a -RJ)* bj_DEGTORAD)< 0 then
		set UCV =-90
	else
		set UCV = 90
	endif
	set F4R = GetUnitX(GetEnumUnit())+ 15* Cos((RJ + UCV)* bj_DEGTORAD)
	set F5R = GetUnitY(GetEnumUnit())+ 15* Sin((RJ + UCV)* bj_DEGTORAD)
	call SetUnitPosition(GetEnumUnit(), F4R, F5R)
	call SetUnitFacingTimed(GetEnumUnit(), RJ -UCV, .3)
	if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
		call SaveBoolean(OtherHashTable, GetHandleId(GetEnumUnit()), 99, true)
	endif
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl", GetEnumUnit(), "origin"))
endfunction
function F6R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real a = LoadReal(HY, h, 13)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local group g = LoadGroupHandle(HY, h, 22)
	if GetTriggerEvalCount(t)> 20 then
		call DeallocateGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set S2 = x
		set TJ = y
		set RJ = a
		call ForGroup(g, function F3R)
	endif
	set t = null
	set g = null
	return false
endfunction
function F7R takes nothing returns nothing
	call UnitDamageTargetEx(U2, GetEnumUnit(), 1, S2)
endfunction
function F8R takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(trigUnit,'A0O2')
	local unit dummyCaster
	local real a = bj_RADTODEG * Atan2(GetUnitY(targetUnit)-GetUnitY(trigUnit), GetUnitX(targetUnit)-GetUnitX(trigUnit))
	local real x
	local real y
	local group g = AllocationGroup(132)
	local group g2 = AllocationGroup(133)
	if level == 0 then
		set level = GetUnitAbilityLevel(trigUnit,'A289')
	endif
	call SaveGroupHandle(HY, h, 22,(g))
	call SaveReal(HY, h, 13, a * 1.)
	call SaveReal(HY, h, 6, GetUnitX(trigUnit))
	call SaveReal(HY, h, 7, GetUnitY(trigUnit))
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function F6R))
	set x = GetUnitX(trigUnit)+ 50 * Cos(a * bj_DEGTORAD)
	set y = GetUnitY(trigUnit)+ 50 * Sin(a * bj_DEGTORAD)
	call GroupEnumUnitsInRange(g2, x, y, 275, Condition(function DDX))
	call GroupAddGroup(g2, g)
	call GroupClear(g2)
	set dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'o00Y', x, y, a)
	call UnitApplyTimedLife(dummyCaster,'BTLF', 1)
	call UnitAddPermanentAbility(dummyCaster,'A0NY')
	call SetUnitAbilityLevel(dummyCaster,'A0NY', level)
	call IssueImmediateOrderById(dummyCaster, 852096)
	set x = GetUnitX(trigUnit)+ 250* Cos(a * bj_DEGTORAD)
	set y = GetUnitY(trigUnit)+ 250* Sin(a * bj_DEGTORAD)
	call GroupEnumUnitsInRange(g2, x, y, 275, Condition(function DDX))
	call GroupAddGroup(g2, g)
	call GroupClear(g2)
	set dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'o00Y', x, y, a)
	call UnitApplyTimedLife(dummyCaster,'BTLF', 1)
	call UnitAddPermanentAbility(dummyCaster,'A0NY')
	call SetUnitAbilityLevel(dummyCaster,'A0NY', level)
	call IssueImmediateOrderById(dummyCaster, 852096)
	set x = GetUnitX(trigUnit)+ 450 * Cos(a * bj_DEGTORAD)
	set y = GetUnitY(trigUnit)+ 450 * Sin(a * bj_DEGTORAD)
	call GroupEnumUnitsInRange(g2, x, y, 275, Condition(function DDX))
	call GroupAddGroup(g2, g)
	call GroupClear(g2)
	set dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'o00Y', x, y, a)
	call UnitApplyTimedLife(dummyCaster,'BTLF', 1)
	call UnitAddPermanentAbility(dummyCaster,'A0NY')
	call SetUnitAbilityLevel(dummyCaster,'A0NY', level)
	call IssueImmediateOrderById(dummyCaster, 852096)
	if GetUnitAbilityLevel(trigUnit,'A0O2') == 0 then
		set x = GetUnitX(trigUnit)+ 650 * Cos(a * bj_DEGTORAD)
		set y = GetUnitY(trigUnit)+ 650 * Sin(a * bj_DEGTORAD)
		call GroupEnumUnitsInRange(g2, x, y, 275, Condition(function DDX))
		call GroupAddGroup(g2, g)
		call GroupClear(g2)
		set dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'o00Y', x, y, a)
		call UnitApplyTimedLife(dummyCaster,'BTLF', 1)
		call UnitAddPermanentAbility(dummyCaster,'A0NY')
		call SetUnitAbilityLevel(dummyCaster,'A0NY', level)
		call IssueImmediateOrderById(dummyCaster, 852096)
	endif
	call DeallocateGroup(g2)
	call GroupRemoveUnit(g, targetUnit)
	set S2 = 150+ 50 * level
	set U2 = trigUnit
	call ForGroup(g, function F7R)
	set t = null
	set trigUnit = null
	set targetUnit = null
	set dummyCaster = null
	set g = null
	set g2 = null
endfunction
function Y2V takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call F8R()
	endif
endfunction
function F9R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	call UnitRemoveAbility(whichUnit,'A140')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction
function Y3V takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	call UnitAddPermanentAbility(whichUnit,'A140')
	call TriggerRegisterTimerEvent(t, 6, false)
	call TriggerAddCondition(t, Condition(function F9R))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	set t = null
	set whichUnit = null
endfunction
function GVR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit GER =(LoadUnitHandle(HY, h, 2))
	local real GXR =(LoadReal(HY, h, 6))
	local real GOR =(LoadReal(HY, h, 7))
	local real GRR = GetUnitX(GER)
	local real GIR = GetUnitY(GER)
	call SaveReal(HY, h, 6,((GRR)* 1.))
	call SaveReal(HY, h, 7,((GIR)* 1.))
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if GXR == GRR and GOR == GIR then
			if GetUnitAbilityLevel(GER,'A1WG') == 0 then
				call UnitAddPermanentAbility(GER,'A1WG')
			endif
		else
			if GetUnitAbilityLevel(GER,'A1WG')> 0 then
				call UnitRemoveAbility(GER,'A1WG')
			endif
		endif
	endif
	set t = null
	set GER = null
	return false
endfunction
function Q1E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer WUV = GetUnitAbilityLevel(u,'A0OO')
	if (WUV == 1) then
		call UnitAddPermanentAbility(u,'A300')
		call UnitAddPermanentAbility(u,'A301')
	endif
	call SetUnitAbilityLevel(u,'A300', WUV)
	call SetUnitAbilityLevel(u,'A301', WUV)
	set u = null
endfunction
function D7E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer i = GetUnitAbilityLevel(u,'A301')
	local group g
	local unit GAR = null
	local integer id
	if GetUnitTypeId(u)=='e00E' then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
	if i == 1 then
		set id ='h30A'
	elseif i == 2 then
		set id ='n01M'
	elseif i == 3 then
		set id ='n01S'
	else
		set id ='h30B'
	endif
	set GAR = CreateUnit(GetOwningPlayer(u), id, GetUnitX(u), GetUnitY(u), GetUnitFacing(u))
	call UnitApplyTimedLife(GAR,'BTLF', 60)
	call SetUnitAbilityLevel(GAR,'A0OP', i)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl", GAR, "chest"))
	set i = GetUnitAbilityLevel(u,'A0A8')
	if i > 0 then
		call UnitAddMaxLife(GAR, 100 * i)
		call UnitAddPermanentAbilitySetLevel(GAR,'A3IM', i)
	endif
	set GAR = null
	set u = null
endfunction
function D6E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer i = GetUnitAbilityLevel(u,'A300')
	local trigger t
	local integer h
	local unit GNR
	local integer id
	if GetUnitTypeId(u)=='e00E' then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
	if i == 1 then
		set id ='h308'
	elseif i == 2 then
		set id ='n01Q'
	elseif i == 3 then
		set id ='n01R'
	else
		set id ='h309'
	endif
	set GNR = CreateUnit(GetOwningPlayer(u), id, GetUnitX(u), GetUnitY(u), GetUnitFacing(u))
	call UnitApplyTimedLife(GNR,'BTLF', 60)
	if i > 2 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .05, true)
		call TriggerRegisterUnitEvent(t, GNR, EVENT_UNIT_DEATH)
		call SaveReal(HY, h, 6,((GetUnitX(GNR))* 1.))
		call SaveReal(HY, h, 7,((GetUnitY(GNR))* 1.))
		call SaveUnitHandle(HY, h, 2,(GNR))
		call TriggerAddCondition(t, Condition(function GVR))
		set t = null
	endif
	set i = GetUnitAbilityLevel(u,'A0A8')
	if i > 0 then
		call SetUnitMoveSpeed(GNR, GetUnitDefaultMoveSpeed(GNR)+ 50 * i)
		call UnitAddPermanentAbility(GNR,'Amim')
	endif
	set u = null
	set GNR = null
endfunction
function GBR takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local integer h = GetHandleId(whichUnit)
	local player p =(LoadPlayerHandle(HY, h, 54))
	local integer level =(LoadInteger(HY, h, 5))
	local texttag tt = CreateTextTag()
	local integer goldBonus
	local integer i = 1
	local unit u
	local player p2
	if level == 1 then
		set goldBonus = 150
	elseif level == 2 then
		set goldBonus = 200
	else
		set goldBonus = 250
	endif
	set goldBonus = AddPlayerResourceGold(p, goldBonus)
	call SetTextTagText(tt, "+" + I2S(goldBonus), .025)
	call SetTextTagPosUnit(tt, Player__Hero[GetPlayerId(p)], 100)
	call SetTextTagColor(tt, 255, 220, 0, 255)
	call SetTextTagVelocity(tt, 0, .03)
	call SetTextTagVisibility(tt, LocalPlayer== p)
	call SetTextTagFadepoint(tt, 2)
	call SetTextTagLifespan(tt, 3)
	call SetTextTagPermanent(tt, false)
	set PlayersReliableGold[GetPlayerId(p)]= PlayersReliableGold[GetPlayerId(p)] + goldBonus
	set HHV[GetPlayerId(p)]= HHV[GetPlayerId(p)] + goldBonus
	loop
	exitwhen i > 5
		if IsSentinelPlayer(p) then
			set p2 = SentinelPlayers[i]
		else
			set p2 = ScourgePlayers[i]
		endif
		if p2 != p then
			set u = Player__Hero[GetPlayerId(p2)]
			if GetUnitDistanceEx(u, whichUnit)< 950 then
				set tt = CreateTextTag()
				if level == 1 then
					set goldBonus = 40
				elseif level == 2 then
					set goldBonus = 80
				else
					set goldBonus = 120
				endif
				set goldBonus = AddPlayerResourceGold(p2, goldBonus)
				call SetTextTagText(tt, "+" + I2S(goldBonus), .025)
				call SetTextTagPosUnit(tt, u, 100)
				call SetTextTagColor(tt, 255, 220, 0, 255)
				call SetTextTagVelocity(tt, 0, .03)
				call SetTextTagVisibility(tt, LocalPlayer== p2)
				call SetTextTagFadepoint(tt, 2)
				call SetTextTagLifespan(tt, 3)
				call SetTextTagPermanent(tt, false)
				set PlayersReliableGold[GetPlayerId(p2)]= PlayersReliableGold[GetPlayerId(p2)] + goldBonus
				set HHV[GetPlayerId(p2)]= HHV[GetPlayerId(p2)] + goldBonus
			endif
		endif
		set i = i + 1
	endloop
	set whichUnit = null
	set p = null
	set p2 = null
	set u = null
	set tt = null
endfunction
function GCR takes nothing returns nothing
	if LoadReal(HY, GetHandleId(GetTriggerUnit()), 314)> GetGameTime() then
		call GBR()
	endif
endfunction
function GDR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local unit dummyCaster = LoadUnitHandle(HY, h, 19)
	call SetUnitX(dummyCaster, GetUnitX(targetUnit))
	call SetUnitY(dummyCaster, GetUnitY(targetUnit))
	if (GetTriggerEvalCount(t)> 10 and GetUnitAbilityLevel(targetUnit,'B00L') == 0) or LoadReal(HY, GetHandleId(targetUnit), 314) == 0 then
		call UnitRemoveAbility(targetUnit,'B00L')
		call RemoveSavedHandle(HY, GetHandleId(targetUnit),'B00L')
		call SaveReal(HY, GetHandleId(targetUnit), 314, 0)
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call KillUnit(dummyCaster)
		call RemoveUnit(dummyCaster)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	set dummyCaster = null
	return false
endfunction
function Y4V takes nothing returns nothing
	local trigger t
	local integer h
	local unit targetUnit = GetSpellTargetUnit()
	local unit whichUnit = GetTriggerUnit()
	local unit dummyCaster
	local string FX = "war3mapImported\\TrackBuff.mdx"
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(targetUnit)) and IsObserverPlayer(LocalPlayer) == false then
		set FX = ""
	endif
	if HaveSavedHandle(HY, GetHandleId(targetUnit),'B00L') then
		set t = LoadTriggerHandle(HY, GetHandleId(targetUnit),'B00L')
		set h = GetHandleId(t)
		call UnitRemoveAbility(targetUnit,'B00L')
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, GetHandleId(targetUnit),'B00L', t)
		set dummyCaster = CreateUnit(GetOwningPlayer(targetUnit),'e01V', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitAddPermanentAbility(dummyCaster,'A115')
		call TriggerRegisterTimerEvent(t, .02, true)
		call TriggerAddCondition(t, Condition(function GDR))
		call SaveUnitHandle(HY, h, 17, targetUnit)
		call SaveUnitHandle(HY, h, 19, dummyCaster)
		call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget(FX, targetUnit, "overhead"))
	endif
	call SaveReal(HY, GetHandleId(targetUnit), 314, GetGameTime()+ 30 * 1.)
	call SavePlayerHandle(HY, GetHandleId(targetUnit), 54, GetOwningPlayer(whichUnit))
	call SaveInteger(HY, GetHandleId(targetUnit), 5, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	set t = null
	set targetUnit = null
	set whichUnit = null
	set dummyCaster = null
endfunction
function NRE takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	call UnitRemoveAbility(targetUnit,'A1IW')
	call UnitRemoveAbility(targetUnit,'B0CA')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set targetUnit = null
	return false
endfunction
function GFR takes unit whichUnit, unit targetUnit returns nothing
	call UnitAddAbilityToTimed(targetUnit,'A1IX', 1, 3,'B0CA')
endfunction
function GGR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamageSource() == whichUnit and(GetEventDamage()> 40 or IsUnitType(targetUnit, UNIT_TYPE_STRUCTURE) or GetUnitTypeId(targetUnit)=='umtw' or GetUnitTypeId(targetUnit)=='ebal') and(LoadBoolean(HY,(GetHandleId(whichUnit)),('A1IQ' +183))) then
			call GFR(whichUnit, targetUnit)
			call SaveBoolean(HY, GetHandleId(whichUnit),'A1IQ'+ 183, false)
			call SaveReal(HY, GetHandleId(whichUnit),'A1IQ'+ 184, GetGameTime()* 1.)
			call UnitRemoveAbility(whichUnit,'A1IS')
			call UnitRemoveAbility(whichUnit,'A1J4')
			call UnitRemoveAbility(whichUnit,'A1J3')
			call UnitRemoveAbility(whichUnit,'A1J5')
			call UnitRemoveAbility(whichUnit,'A1IU')
			call FlushChildHashtable(HY, GetHandleId(LoadTriggerHandle(HY, h, 35)))
			call CleanCurrentTrigger(LoadTriggerHandle(HY, h, 35))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function GHR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	call UnitRemoveAbility(u,'A1J4')
	call UnitRemoveAbility(u,'A1J3')
	call UnitRemoveAbility(u,'A1J5')
	call UnitRemoveAbility(u,'A1IU')
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction
function GJR takes unit u returns nothing
	local timer t = CreateTimer()
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call TimerStart(t, .2, false, function GHR)
	set t = null
endfunction
function GKR takes nothing returns boolean
	local trigger t
	local integer h
	local unit targetUnit
	local unit whichUnit
	local integer level
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call SaveBoolean(HY, GetHandleId(GetTriggerUnit()),'A1IQ'+ 183, false)
		call SaveReal(HY, GetHandleId(GetTriggerUnit()),'A1IQ'+ 184, GetGameTime()* 1.)
		call UnitRemoveAbility(GetTriggerUnit(),'A1IS')
		call UnitRemoveAbility(GetTriggerUnit(),'A1J4')
		call UnitRemoveAbility(GetTriggerUnit(),'A1J3')
		call UnitRemoveAbility(GetTriggerUnit(),'A1J5')
		call UnitRemoveAbility(GetTriggerUnit(),'A1IU')
		call FlushChildHashtable(HY, GetHandleId(GetTriggeringTrigger()))
		call CleanCurrentTrigger(GetTriggeringTrigger())
	elseif GetAttacker()==(LoadUnitHandle(HY, GetHandleId(GetTriggeringTrigger()), 182)) then
		if IsUnitAlly(GetAttacker(), GetOwningPlayer(GetTriggerUnit())) == false and IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE) == false and GetUnitAbilityLevel(GetAttacker(),'A36D') == 0 then
			set t = CreateTrigger()
			set h = GetHandleId(t)
			set targetUnit = GetTriggerUnit()
			set whichUnit = GetAttacker()
			call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
			call TriggerRegisterTimerEvent(t, 2.5, false)
			call TriggerAddCondition(t, Condition(function GGR))
			call SaveUnitHandle(HY, h, 30,(targetUnit))
			call SaveUnitHandle(HY, h, 2, whichUnit)
			if X4X(whichUnit) then
				call GJR(whichUnit)
			endif
			call SaveTriggerHandle(HY, h, 35, GetTriggeringTrigger())
			set level = GetUnitAbilityLevel(whichUnit,'A524')
			if level == 0 then
				call UnitRemoveAbility(whichUnit,'A1J4')
				call UnitRemoveAbility(whichUnit,'A1J3')
				call UnitRemoveAbility(whichUnit,'A1J5')
				call UnitRemoveAbility(whichUnit,'A1IU')
			elseif level == 1 then
				call UnitRemoveAbility(whichUnit,'A1J3')
				call UnitRemoveAbility(whichUnit,'A1J5')
				call UnitRemoveAbility(whichUnit,'A1IU')
			elseif level == 2 then
				call UnitRemoveAbility(whichUnit,'A1J4')
				call UnitRemoveAbility(whichUnit,'A1J5')
				call UnitRemoveAbility(whichUnit,'A1IU')
			elseif level == 3 then
				call UnitRemoveAbility(whichUnit,'A1J4')
				call UnitRemoveAbility(whichUnit,'A1J3')
				call UnitRemoveAbility(whichUnit,'A1IU')
			elseif level == 4 then
				call UnitRemoveAbility(whichUnit,'A1J4')
				call UnitRemoveAbility(whichUnit,'A1J3')
				call UnitRemoveAbility(whichUnit,'A1J5')
			endif
			set targetUnit = null
			set whichUnit = null
			set t = null
		endif
	endif
	return false
endfunction
function GLR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	local real GMR = GetGameTime()
	local integer level = GetUnitAbilityLevel(trigUnit,'A524')
	local real GPR = LoadReal(HY, GetHandleId(trigUnit),'A1IQ'+ 184)
	local boolean GQR = LoadBoolean(HY, GetHandleId(trigUnit),'A1IQ' +183)
	if GetUnitAbilityLevel(trigUnit,'A1IQ')> 0 and GetUnitAbilityLevel(trigUnit,'A1IQ')!= level then
		call SetUnitAbilityLevel(trigUnit,'A1IQ', level)
	endif
	if GMR -GPR > 14-level * 2 and GQR == false and IsPlayerHasSkill(GetOwningPlayer(trigUnit), 31 * 4 + 2) and UnitIsDead(trigUnit) == false then
		call SaveBoolean(HY, GetHandleId(trigUnit),'A1IQ'+ 183, true)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
		call TriggerRegisterDeathEvent(t, trigUnit)
		call TriggerAddCondition(t, Condition(function GKR))
		call SaveUnitHandle(HY, h, 182, trigUnit)
		call UnitAddPermanentAbility(trigUnit,'A1IS')
		if GetUnitAbilityLevel(trigUnit,'B068') == 0 then
			if level == 1 then
				call UnitAddPermanentAbility(trigUnit,'A1J4')
				call UnitMakeAbilityPermanent(trigUnit, true,'A1J2')
				if not Mode__RearmCombos and(GetUnitAbilityLevel(trigUnit,'A0CY')> 0 or(GetUnitAbilityLevel(trigUnit,'Y315')> 0 and IsUnitType(trigUnit, UNIT_TYPE_MELEE_ATTACKER))) then
					call SetUnitAbilityLevel(trigUnit,'A1J2', 2)
				endif
			elseif level == 2 then
				call UnitAddPermanentAbility(trigUnit,'A1J3')
				call UnitMakeAbilityPermanent(trigUnit, true,'A1IT')
				if not Mode__RearmCombos and(GetUnitAbilityLevel(trigUnit,'A0CY')> 0 or(GetUnitAbilityLevel(trigUnit,'Y315')> 0 and IsUnitType(trigUnit, UNIT_TYPE_MELEE_ATTACKER))) then
					call SetUnitAbilityLevel(trigUnit,'A1IT', 2)
				endif
			elseif level == 3 then
				call UnitAddPermanentAbility(trigUnit,'A1J5')
				call UnitMakeAbilityPermanent(trigUnit, true,'A1J1')
				if not Mode__RearmCombos and(GetUnitAbilityLevel(trigUnit,'A0CY')> 0 or(GetUnitAbilityLevel(trigUnit,'Y315')> 0 and IsUnitType(trigUnit, UNIT_TYPE_MELEE_ATTACKER))) then
					call SetUnitAbilityLevel(trigUnit,'A1J1', 2)
				endif
			elseif level == 4 then
				call UnitAddPermanentAbility(trigUnit,'A1IU')
				call UnitMakeAbilityPermanent(trigUnit, true,'A1J0')
				if not Mode__RearmCombos and(GetUnitAbilityLevel(trigUnit,'A0CY')> 0 or(GetUnitAbilityLevel(trigUnit,'Y315')> 0 and IsUnitType(trigUnit, UNIT_TYPE_MELEE_ATTACKER))) then
					call SetUnitAbilityLevel(trigUnit,'A1J0', 2)
				endif
			endif
		endif
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(trigUnit),'A1J4', false)
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(trigUnit),'A1J3', false)
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(trigUnit),'A1J5', false)
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(trigUnit),'A1IU', false)
	elseif GQR == false and GetUnitAbilityLevel(trigUnit,'B068') == 0 then
		call UnitRemoveAbility(trigUnit,'A1IS')
		call UnitRemoveAbility(trigUnit,'A1J4')
		call UnitRemoveAbility(trigUnit,'A1J3')
		call UnitRemoveAbility(trigUnit,'A1J5')
		call UnitRemoveAbility(trigUnit,'A1IU')
	endif
	set t = null
	set trigUnit = null
	return false
endfunction
function P4E takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call UnitAddPermanentAbility(trigUnit,'A1IQ')
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function GLR))
	call SaveUnitHandle(HY, h, 14, trigUnit)
	call SaveInteger(HY, h, 181, 0)
	set trigUnit = null
	set t = null
endfunction
function MEE takes nothing returns nothing
	if IsUnitIllusion(GetTriggerUnit()) == false then
		call P4E()
	endif
endfunction
function GSR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer level = GetUnitAbilityLevel(whichUnit,'A07A')
	if level < 1 then
		set level = GetUnitAbilityLevel(whichUnit,'QB09')
	endif
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamageSource() == whichUnit then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			if ((LoadInteger(HY,(GetHandleId((whichUnit))),( 2487))) == 1) == false then
				call EPX(whichUnit, 2487, .5)
				if IsUnitType(targetUnit, UNIT_TYPE_STRUCTURE) == false and IsUnitEnemy(targetUnit, GetOwningPlayer(whichUnit)) then
					call UnitDamageTargetEx(whichUnit, targetUnit, 2, 30 * level)
					call CommonTextTag(I2S(R2I(30 * level)), 1, whichUnit, .027, 216, 0, 0, 216)
				endif
			endif
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function GTR takes nothing returns nothing
	local trigger t = CreateTrigger()
	local unit targetUnit = GetTriggerUnit()
	local unit whichUnit = GetAttacker()
	local integer h = GetHandleId(t)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerRegisterTimerEvent(t, 2, false)
	call TriggerAddCondition(t, Condition(function GSR))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	set targetUnit = null
	set whichUnit = null
	set t = null
endfunction
function GUR takes nothing returns boolean
	local integer lv
	local unit u
	if GetTriggerEventId() == EVENT_UNIT_SPELL_CAST or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		set u =(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 14))
		set lv = GetUnitAbilityLevel(GetAttacker(),'A524')
		if (LoadBoolean(HY,(GetHandleId(u)),('A1IQ' +183))) then
			set lv = GetUnitAbilityLevel(u,'A1IQ')
			if lv == 0 then
				call UnitRemoveAbility(u,'A1J4')
				call UnitRemoveAbility(u,'A1J3')
				call UnitRemoveAbility(u,'A1J5')
				call UnitRemoveAbility(u,'A1IU')
			elseif lv == 1 then
				call UnitRemoveAbility(u,'A1J3')
				call UnitRemoveAbility(u,'A1J5')
				call UnitRemoveAbility(u,'A1IU')
			elseif lv == 2 then
				call UnitRemoveAbility(u,'A1J4')
				call UnitRemoveAbility(u,'A1J5')
				call UnitRemoveAbility(u,'A1IU')
			elseif lv == 3 then
				call UnitRemoveAbility(u,'A1J4')
				call UnitRemoveAbility(u,'A1J3')
				call UnitRemoveAbility(u,'A1IU')
			elseif lv == 4 then
				call UnitRemoveAbility(u,'A1J4')
				call UnitRemoveAbility(u,'A1J3')
				call UnitRemoveAbility(u,'A1J5')
			endif
		else
			call UnitRemoveAbility(u,'A1J4')
			call UnitRemoveAbility(u,'A1J3')
			call UnitRemoveAbility(u,'A1J5')
			call UnitRemoveAbility(u,'A1IU')
		endif
		call FlushChildHashtable(HY,(GetHandleId(GetTriggeringTrigger())))
		call CleanCurrentTrigger(GetTriggeringTrigger())
	elseif GetTriggerEventId() == EVENT_PLAYER_UNIT_ATTACKED then
		if GetAttacker()==(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 14)) then
			if ((LoadInteger(HY,(GetHandleId((GetAttacker()))),( 2488))) == 1) == false then
				call FlushChildHashtable(HY,(GetHandleId(GetTriggeringTrigger())))
				call CleanCurrentTrigger(GetTriggeringTrigger())
				call GTR()
			endif
			if (LoadBoolean(HY,(GetHandleId(GetAttacker())),('A1IQ' +183))) then
				set lv = GetUnitAbilityLevel(GetAttacker(),'A524')
				if lv == 0 then
					call UnitRemoveAbility(GetAttacker(),'A1J4')
					call UnitRemoveAbility(GetAttacker(),'A1J3')
					call UnitRemoveAbility(GetAttacker(),'A1J5')
					call UnitRemoveAbility(GetAttacker(),'A1IU')
				elseif lv == 1 then
					call UnitRemoveAbility(GetAttacker(),'A1J3')
					call UnitRemoveAbility(GetAttacker(),'A1J5')
					call UnitRemoveAbility(GetAttacker(),'A1IU')
				elseif lv == 2 then
					call UnitRemoveAbility(GetAttacker(),'A1J4')
					call UnitRemoveAbility(GetAttacker(),'A1J5')
					call UnitRemoveAbility(GetAttacker(),'A1IU')
				elseif lv == 3 then
					call UnitRemoveAbility(GetAttacker(),'A1J4')
					call UnitRemoveAbility(GetAttacker(),'A1J3')
					call UnitRemoveAbility(GetAttacker(),'A1IU')
				elseif lv == 4 then
					call UnitRemoveAbility(GetAttacker(),'A1J4')
					call UnitRemoveAbility(GetAttacker(),'A1J3')
					call UnitRemoveAbility(GetAttacker(),'A1J5')
				endif
			else
				call UnitRemoveAbility(GetAttacker(),'A1J4')
				call UnitRemoveAbility(GetAttacker(),'A1J3')
				call UnitRemoveAbility(GetAttacker(),'A1J5')
				call UnitRemoveAbility(GetAttacker(),'A1IU')
			endif
		endif
	else
		if LoadBoolean(HY, GetHandleId(GetTriggeringTrigger()), 0) then
			set u =(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 14))
			call L6X(u)
			call UZV(u,'I0TG')
			call RemoveSavedBoolean(HY, GetHandleId(GetTriggeringTrigger()), 0)
		else
			set u =(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 14))
			if (LoadBoolean(HY,(GetHandleId(u)),'A1IQ' +183)) == false then
				call UnitRemoveAbility(u,'A1J4')
				call UnitRemoveAbility(u,'A1J3')
				call UnitRemoveAbility(u,'A1J5')
				call UnitRemoveAbility(u,'A1IU')
			endif
			call FlushChildHashtable(HY,(GetHandleId(GetTriggeringTrigger())))
			call CleanCurrentTrigger(GetTriggeringTrigger())
		endif
	endif
	set u = null
	return false
endfunction
function Y5V takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = GetSpellTargetUnit()
	local unit whichUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())
	call EPX(whichUnit, 2488, 1.25 -0.25 * level -0.01)
	call TriggerRegisterTimerEvent(t, 10+ 5 * level, false)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_CAST)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerRegisterTimerEvent(t, 0, false)
	call SaveBoolean(HY, h, 0, true)
	call TriggerAddCondition(t, Condition(function GUR))
	call SaveUnitHandle(HY, h, 14,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call UnitAddPermanentAbility(whichUnit,'A1J4')
	call UnitAddPermanentAbility(whichUnit,'A1J3')
	call UnitAddPermanentAbility(whichUnit,'A1J5')
	call UnitAddPermanentAbility(whichUnit,'A1IU')
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1J4', false)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1J3', false)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1J5', false)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1IU', false)
	set t = null
	set targetUnit = null
	set whichUnit = null
endfunction
function GWR takes nothing returns nothing
	local unit whichUnit = U2
	local unit targetUnit = MissileHitTargetUnit
	local group g
	local group tg
	local unit u
	local integer GYR
	local real damageValue = .0
	local integer level
	local boolean GZR = false
	local integer h
	if LoadUnitHandle(ObjectHashTable, GetHandleId(whichUnit),'A004'+ 1)!= null then
		set whichUnit = LoadUnitHandle(ObjectHashTable, GetHandleId(whichUnit),'A004'+ 1)
		set GZR = true
		call RemoveSavedHandle(ObjectHashTable, GetHandleId(U2),'A004'+ 1)
	endif
	set h = GetHandleId(whichUnit)
	set g = LoadGroupHandle(ObjectHashTable, h,'A004')
	set GYR = LoadInteger(ObjectHashTable, h,'A004')
	set level = LoadInteger(ObjectHashTable, h,'A005')
	call TDV(targetUnit)
	call GroupAddUnit(g, targetUnit)
	if GZR then
		set damageValue = 25 + 50 * level
	else
		set damageValue = 75 *(level + 1)
	endif
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, damageValue)
	if GetUnitAbilityLevel(targetUnit,'A3E9') == 1 and LoadBoolean(ObjectHashTable, h,'A004') == false then
		if IsUnitMagicImmune(whichUnit) == false and GetUnitAbilityLevel(whichUnit,'Aloc') == 0 then
			call SaveUnitHandle(OtherHashTable2,'A3E9', 0, targetUnit)
			call SaveUnitHandle(OtherHashTable2,'A3E9', 1, whichUnit)
			call SaveInteger(OtherHashTable2,'A3E9', 0, level)
			call ExecuteFunc("G_R")
		endif
	endif
	if GYR > 0 then
		set tg = AllocationGroup(134)
		set U2 = whichUnit
		call GroupEnumUnitsInRange(tg, GetUnitX(targetUnit), GetUnitY(targetUnit), 425, Condition(function DSX))
		call GroupRemoveGroup(g, tg)
		set u = FirstOfGroup(tg)
		if u != null then
			call LaunchMissileByUnitDummy(targetUnit, u,'h02K', "GWR", 1000, true)
			call SaveUnitHandle(ObjectHashTable, GetHandleId(targetUnit),'A004'+ 1, whichUnit)
			call SaveInteger(ObjectHashTable, h,'A004', GYR -1)
		else
			call DeallocateGroup(g)
			call RemoveSavedInteger(ObjectHashTable, h,'A004')
			call RemoveSavedHandle(ObjectHashTable, h,'A004')
			call RemoveSavedBoolean(ObjectHashTable, h,'A004')
			call RemoveSavedInteger(ObjectHashTable, h,'A005')
		endif
		call DeallocateGroup(tg)
		set tg = null
	else
		call DeallocateGroup(g)
		call RemoveSavedInteger(ObjectHashTable, h,'A004')
		call RemoveSavedHandle(ObjectHashTable, h,'A004')
		call RemoveSavedBoolean(ObjectHashTable, h,'A004')
		call RemoveSavedInteger(ObjectHashTable, h,'A005')
	endif
	set whichUnit = null
	set targetUnit = null
	set u = null
	set g = null
	set tg = null
endfunction
function G_R takes nothing returns nothing
	local unit whichUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 0)
	local unit targetUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 1)
	local integer level = LoadInteger(OtherHashTable2,'A3E9', 0)
	call T4V(whichUnit)
	if UnitHasSpellShield(targetUnit) == false then
		call LaunchMissileByUnitDummy(whichUnit, targetUnit,'h02K', "GWR", 1000, true)
		call SaveInteger(ObjectHashTable, GetHandleId(whichUnit),'A004', level -1)
		call SaveInteger(ObjectHashTable, GetHandleId(whichUnit),'A005', level)
		call SaveGroupHandle(ObjectHashTable, GetHandleId(whichUnit),'A004', AllocationGroup(135))
		call SaveBoolean(ObjectHashTable, GetHandleId(whichUnit),'A004', true)
	else
		call UnitRemoveSpellShield(targetUnit)
	endif
	call FlushChildHashtable(OtherHashTable2,'A3E9')
	set whichUnit = null
	set targetUnit = null
endfunction
function FIE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call LaunchMissileByUnitDummy(GetTriggerUnit(), GetSpellTargetUnit(),'h02K', "GWR", 1000, true)
		call SaveInteger(ObjectHashTable, GetHandleId(GetTriggerUnit()),'A004', GetUnitAbilityLevel(GetTriggerUnit(),'A004')-1)
		call SaveGroupHandle(ObjectHashTable, GetHandleId(GetTriggerUnit()),'A004', AllocationGroup(136))
		call SaveInteger(ObjectHashTable, GetHandleId(GetTriggerUnit()),'A005', GetUnitAbilityLevel(GetTriggerUnit(),'A004'))
	endif
endfunction
function G0R takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer DSR = LoadInteger(ObjectHashTable, WFV, 0)
	local integer UYX = LoadInteger(ObjectHashTable, DSR,'A0FV')-1
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	local integer G1R = LoadInteger(ObjectHashTable, GetHandleId(u),'WARP')
	local integer N3X
	local integer WUV = LoadInteger(ObjectHashTable, GetHandleId(u),'WARL')
	local integer i = R2I(.5 * WUV * WUV + .5 * WUV + 4)
	if G1R > 0 then
		call J8X(u, G1R)
	endif
	set N3X = i +(UYX)* WUV
	if (UYX > 0) then
		call J6X(u, N3X)
		call SaveInteger(ObjectHashTable, GetHandleId(u),'WARP', N3X)
	else
		call SaveInteger(ObjectHashTable, GetHandleId(u),'WARP', 0)
		call UnitRemoveAbility(u,'A30P')
	endif
	call SaveInteger(ObjectHashTable, DSR,'A0FV', UYX)
	call UnitReduceStateBonus(u, LoadInteger(ObjectHashTable, WFV, 1), UNIT_BONUS_DAMAGE)
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set u = null
endfunction
function G2R takes unit u, integer WUV returns nothing
	local timer t = null
	local integer W0V
	local integer N3X
	local integer CJR
	local integer WFV = GetHandleId(u)
	local integer UYX = LoadInteger(ObjectHashTable, WFV,'A0FV')+ 1
	local integer i
	local integer G1R
	set CJR = 15+ 5 * WUV
	if UYX == 5 + WUV then
		return
	endif
	set t = CreateTimer()
	set W0V = GetHandleId(t)
	set N3X = UYX *(WUV + 2)
	if LoadInteger(ObjectHashTable, WFV,'WARP')> 0 then
		call J8X(u, LoadInteger(ObjectHashTable, WFV,'WARP'))
	endif
	call UnitAddStateBonus(u, CJR, UNIT_BONUS_DAMAGE)
	call SaveInteger(ObjectHashTable, WFV,'A0FV', UYX)
	call SaveInteger(ObjectHashTable, WFV,'WARP', N3X)
	call SaveInteger(ObjectHashTable, WFV,'WARL', WUV)
	call J6X(u, N3X)
	call SaveUnitHandle(ObjectHashTable, W0V, 0, u)
	call SaveInteger(ObjectHashTable, W0V, 0, WFV)
	call SaveInteger(ObjectHashTable, W0V, 1, CJR)
	call TimerStart(t, 14., false, function G0R)
	call UnitAddPermanentAbility(u,'A30P')
	call UnitMakeAbilityPermanent(u, true,'A0EF')
	set t = null
endfunction
function G3R takes unit u, integer WTV returns nothing
	local integer WUV = GetUnitAbilityLevel(u,'A0FV')
	if WUV > 0 and(WTV =='A0FW' or WTV =='A0GP' or X8R(WTV)) then
		call G2R(u, WUV)
	endif
endfunction

function G5R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer ht = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY,(ht), 0))
	local integer hc = GetHandleId(whichUnit)
	local integer i = 0
	local unit u
	local integer hu
	loop
		set i = i + 1
	exitwhen not HaveSavedHandle(HY, ht, i)
		set u = LoadUnitHandle(HY, ht, i)
		set hu = GetHandleId(u)
		if hu < 1 then
			set hu = LoadInteger(HY, ht, i)
			call FlushChildHashtable(HY, hu)
		else
			call SaveReal(HY, hc, hu, RMaxBJ(LoadReal(HY, hc, hu)-LoadReal(HY, ht, i), 0))
		endif
	endloop
	call FlushChildHashtable(HY,(ht))
	call CleanCurrentTrigger(t)
	set u = null
	set whichUnit = null
	set t = null
	return false
endfunction
// 针刺扫射
function UnitSpellEffectQuillSpray takes unit spellUnit, integer level returns nothing
	local integer spellUnitHandleId = GetHandleId(spellUnit)
	local group g = AllocationGroup(137)
	local trigger t = CreateTrigger()
	local integer ht = GetHandleId(t)
	local unit firstUnit
	local integer h
	local real extraDamage
	local real damage
	local integer addDamage = 28 + 2 * level
	local integer i = 0
	local unit dummyUnit
	if not IsUnitType(spellUnit, UNIT_TYPE_HERO) then
		set spellUnit = Player__Hero[GetPlayerId(GetOwningPlayer(spellUnit))]
		set spellUnitHandleId = GetHandleId(spellUnit)
	endif
	call GroupEnumUnitsInRange(g, GetUnitX(spellUnit), GetUnitY(spellUnit), 650, null)
	set Temp__Player = GetOwningPlayer( spellUnit )
	loop
		set firstUnit = FirstOfGroup(g)
	exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)
		// 敌对 存活不是建筑不是守卫
		if IsUnitEnemy(firstUnit, Temp__Player) and IsAliveNotStrucNotWard(firstUnit) then
			set i = i + 1
			set h = GetHandleId(firstUnit)
			set extraDamage = LoadReal(HY, spellUnitHandleId, h) // 获取挨打单位被扫射的次数
			set damage = RMinBJ(level * 20 + extraDamage, 400)
			call CommonTextTag("+" + I2S(R2I(damage)), 1, firstUnit, .023, 255, 0, 0, 216)
			call SaveReal(HY, ht, i, addDamage)
			call SaveUnitHandle(HY, ht, i, firstUnit)
			call SaveInteger(HY, ht, i, h)
			call UnitDamageTargetEx(spellUnit, firstUnit, 2, damage)
			call SaveReal(HY, spellUnitHandleId, h, extraDamage + addDamage)
		endif
	endloop
	set firstUnit = null
	call DeallocateGroup(g)
	set g = null

	call SaveUnitHandle(HY, ht, 0, spellUnit )
	call TriggerRegisterTimerEvent(t, 14, false)
	call TriggerAddCondition(t, Condition(function G5R))
	set t = null

endfunction

function SpellEffect__QuillSpray takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	call UnitSpellEffectQuillSpray( spellUnit, GetUnitAbilityLevel( spellUnit, GetSpellAbilityId() ) )
	set spellUnit = null
endfunction

function G8R takes unit whichUnit returns nothing
	local unit dummyUnit = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	local integer level = GetUnitAbilityLevel(whichUnit,'A0GP')
	//call SetUnitUserData(dummyUnit, 1)
	//call TriggerRegisterUnitEvent(UnitEventMainTrig, dummyUnit, EVENT_UNIT_SPELL_EFFECT)
	call UnitAddPermanentAbility(dummyUnit,'A0GP')
	call IssueImmediateOrderById(dummyUnit, 852526)
	// 马甲只是为了释放特效 真正的伤害和操作还得看英雄
	if level <= 0 then
		set level = 4
	endif
	call UnitSpellEffectQuillSpray( whichUnit, level )
	set dummyUnit = null
endfunction
function G9R takes unit whichUnit, real CJR returns nothing
	local integer h = GetHandleId(whichUnit)
	local real FBX = LoadReal(HY, h, 278)+ CJR
	if FBX > 230 then
		call SaveReal(HY, h, 278, 0)
		call G8R(whichUnit)
	else
		call SaveReal(HY, h, 278, FBX)
	endif
endfunction
function HVR takes nothing returns boolean
	local unit whichUnit = GetTriggerUnit()
	local unit HER = GetEventDamageSource()
	local real HXR = AngleBetweenUnit(HER, whichUnit)
	local real HOR = GetUnitFacing(whichUnit)
	local real HRR
	local real IXX = GetEventDamage()
	local real hp
	local real HIR
	local real life = GetWidgetLife(whichUnit)
	// life > .405  更改至  UnitAlive(whichUnit) 更合理的安全性检查
	if (IXX > 5) and UnitAlive(whichUnit) and FK and GetUnitAbilityLevel(whichUnit,'A36D') == 0 then
		if ((HOR -HXR)<(-180.)) then
			set HRR =(HOR -HXR + 360)
		else
			if ((HOR -HXR)> 180.) then
				set HRR =(HOR -HXR -360)
			else
				set HRR =(HOR -HXR)
			endif
		endif
		set HIR = RAbsBJ(HRR)
		if HIR <= 70 then
			set hp =((GetUnitAbilityLevel(whichUnit,'A0M3'))* .06 + .06)* IXX
			call G9R(whichUnit, IXX -hp)
			call SetUnitToReduceDamage(whichUnit, hp)
		elseif HIR <= 110 then
			set hp =((GetUnitAbilityLevel(whichUnit,'A0M3'))* .02 + .06)* IXX
			call SetUnitToReduceDamage(whichUnit, hp)
		endif
	endif
	set whichUnit = null
	set HER = null
	return false
endfunction
function PSE takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function HVR))
	set t = null
endfunction
function MXE takes nothing returns nothing
	call PSE()
endfunction
function HAR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer hu = LoadInteger(HY, h, 0)
	local integer HNR = LoadInteger(HY, hu,'A0Fw')
	call RemoveSavedHandle(HY, hu,'A0FW')
	call RemoveSavedInteger(HY, hu,'A0FW')
	call RemoveSavedInteger(HY, hu,'A0Fw')
	if GetHandleId(u)!= 0 then
		call UnitRemoveAbility(u, HNR)
		call UnitRemoveAbility(u,'B37Y')
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction
function HBR takes nothing returns nothing
	local integer h
	local unit whichUnit = U2
	local unit targetUnit = MissileHitTargetUnit
	local integer level = GetUnitAbilityLevel(whichUnit,'A0FW')+ GetUnitAbilityLevel(whichUnit,'A3OD')
	local integer HCR
	local integer HDR
	local integer HFR
	local timer t
	local integer hu = GetHandleId(targetUnit)
	local boolean HGR = false
	if level == 0 and GetUnitAbilityLevel(targetUnit,'A0FW')> 0 then
		set level = GetUnitAbilityLevel(targetUnit,'A0FW')
		set HGR = true
	endif
	set HCR ='A37U'-1 + level
	set HDR ='A3F0'+ 4 *(level -1)-1
	if GetUnitAbilityLevel(targetUnit,'B37Y') == 0 then
		set HFR = 0
	else
		set HFR = LoadInteger(HY, hu,'A0FW')
	endif
	if level > 0 then
		if HFR > 0 then
			call UnitRemoveAbility(targetUnit,'A37U')
			call UnitRemoveAbility(targetUnit,'A37V')
			call UnitRemoveAbility(targetUnit,'A37W')
			call UnitRemoveAbility(targetUnit,'A37X')
			call UnitRemoveAbility(targetUnit, LoadInteger(HY, hu,'A0Fw'))
			call UnitRemoveAbility(targetUnit,'B37Y')
		endif
		if HaveSavedHandle(HY, hu,'A0FW') then
			set t = LoadTimerHandle(HY, hu,'A0FW')
		else
			set t = CreateTimer()
			call SaveTimerHandle(HY, hu,'A0FW', t)
			call SaveUnitHandle(HY, GetHandleId(t), 0, targetUnit)
			call SaveInteger(HY, GetHandleId(t), 0, hu)
		endif
		call SaveInteger(HY, hu,'A0FW', IMinBJ(4, HFR + 1))
		call TimerStart(t, 5., false, function HAR)
		set t = null
		set HDR = HDR + IMinBJ(4, HFR + 1)
		call UnitAddPermanentAbility(targetUnit, HDR)
		call SaveInteger(HY, hu,'A0Fw', HDR)
		call UnitAddAbilityToTimed(targetUnit, HCR, HFR + 1, 5, 0)
	endif
	if GetUnitAbilityLevel(targetUnit,'A3E9') == 1 and IsUnitMagicImmune(whichUnit) and HGR == false then
		if UnitHasSpellShield(whichUnit) == false then
			call LaunchMissileByUnitDummy(targetUnit, whichUnit,'h01K', "HBR", 1000, true)
		else
			call UnitRemoveSpellShield(whichUnit)
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function Y7V takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call LaunchMissileByUnitDummy(GetTriggerUnit(), GetSpellTargetUnit(),'h01K', "HBR", 1000, true)
	endif
endfunction
function a_gangbei takes nothing returns nothing
	local group g = AllocationGroup(138)
	local unit u
	set U2 = GetTriggerUnit()
	call GroupEnumUnitsInRange(g, GetUnitX(U2), GetUnitY(U2), 725, Condition(function DJX))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call LaunchMissileByUnitDummy(GetTriggerUnit(), u,'h01K', "HBR", 1000, true)
		call GroupRemoveUnit(g, u)
	endloop
	call DeallocateGroup(g)
endfunction
function HHR takes unit R8X, unit targetUnit returns nothing
	local integer level = GetUnitAbilityLevel(targetUnit,'P123')
	local real IXX =( 14+ 2 * level)+(.18 + .12 * level)* GetHeroMaxAttributeValue(targetUnit)
	call UnitDamageTargetEx(I_X(targetUnit), R8X, 2, IXX)
endfunction



function MJX takes nothing returns nothing
	local sound s = CreateSound("abilities\\Spells\\Other\\Stampede\\StampedeCaster1.wav", false, false, false, 10, 10, "DefaultEAXON")
	call StartSound(s)
	call KillSoundWhenDone(s)
	set s = null
endfunction
function HoofStompDamagedEvent takes nothing returns nothing
	local integer lv = GetUnitAbilityLevel(DESource,'A3IA')
	if lv > 0 then
		call CommonUnitAddStun(DETarget, lv * .25 + 1.75, false)
	endif
endfunction
function ZEV takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0)
	call UnitAddAbility(d,'A3IA')
	call TGV(1)
	call SetUnitAbilityLevel(d,'A3IA', GetUnitAbilityLevel(GetTriggerUnit(),'A00S'))
	call IssueImmediateOrderById(d, 852127)
	call UnitRemoveAbility(d,'A3IA')
	set d = null
endfunction
function HTR takes nothing returns boolean
	local unit t = GetFilterUnit()
	local unit u = QF
	if IsUnitEnemy(u, GetOwningPlayer(t)) and UnitAlive(t) and IsUnitMagicImmune(t) == false and GetUnitAbilityLevel(t,'A04R') == 0 and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false then
		call UnitDamageTargetEx(u, t, 1, PF)
	endif
	set u = null
	set t = null
	return false
endfunction
function HUR takes unit u, unit t, integer level, boolean FAR returns nothing
	local real x = GetWidgetX(t)
	local real y = GetWidgetY(t)
	local group g
	if GetUnitAbilityLevel(t,'A3E9') == 1 and not FAR and GetUnitAbilityLevel(u,'A04R') == 0 then
		call SaveUnitHandle(OtherHashTable2,'A3E9', 0, t)
		call SaveUnitHandle(OtherHashTable2,'A3E9', 1, u)
		call SaveInteger(OtherHashTable2,'A3E9', 0, level)
		call ExecuteFunc("HWR")
	endif
	if UnitHasSpellShield(t) == false then
		set g = AllocationGroup(140)
		set QF = u
		set PF = 100 + level * 75
		call GroupEnumUnitsInRange(g, x, y, 215, Condition(function HTR))
		call DestroyEffect(AddSpecialEffect("war3mapImported\\DoubleEdgeTarget.mdx", x, y))
		if GetWidgetLife(u)< PF * .75 then
			set PF = R2I(GetWidgetLife(u)/ .75) -10
		endif
		call UnitDamageTargetEx(u, u, 1, PF)
		call DeallocateGroup(g)
	elseif FAR then
		call UnitRemoveSpellShield(t)
	endif
endfunction
function ZVV takes nothing returns nothing
	call HUR(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(),'A00L'), false)
endfunction
function HWR takes nothing returns nothing
	call T4V(LoadUnitHandle(OtherHashTable2,'A3E9', 0))
	call HUR(LoadUnitHandle(OtherHashTable2,'A3E9', 0), LoadUnitHandle(OtherHashTable2,'A3E9', 1), LoadInteger(OtherHashTable2,'A3E9', 0), true)
	call FlushChildHashtable(OtherHashTable2,'A3E9')
endfunction
function KBE takes nothing returns nothing
	call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\DoubleEdgeCaster.mdx", GetTriggerUnit(), "hand, right"))
endfunction
function HYR takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(ObjectHashTable, h, 0)
	if GetUnitAbilityLevel(u,'A3KA') == 1 then
		call SetUnitX(u, LoadReal(ObjectHashTable, h, 0))
		call SetUnitY(u, LoadReal(ObjectHashTable, h, 1))
	endif
	call UnitRemoveAbility(u,'A3KA')
	call FlushChildHashtable(ObjectHashTable, h)
	call CleanCurrentTrigger(t)
	set t = null
	set u = null
endfunction
function HZR takes unit u, real x, real y, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer S7V = 7 -level
	call SaveUnitHandle(ObjectHashTable, h, 0, u)
	call UnitAddPermanentAbility(u,'A3KA')
	call SaveReal(ObjectHashTable, h, 0, x)
	call SaveReal(ObjectHashTable, h, 1, y)
	call TriggerRegisterTimerEvent(t, S7V, false)
	call TriggerAddCondition(t, Condition(function HYR))
	set t = null
endfunction
function H_R takes nothing returns boolean
	return UnitIsDead(GetFilterUnit()) == false and((GetUnitAbilityLevel(GetFilterUnit(),'A0KO') == 1) or(GetUnitAbilityLevel(GetFilterUnit(),'A0KQ') == 1) or(GetUnitAbilityLevel(GetFilterUnit(),'A0KR') == 1) or(GetUnitAbilityLevel(GetFilterUnit(),'A0KP') == 1))
endfunction
function H0R takes nothing returns boolean
	return UnitIsDead(GetFilterUnit()) == false and GetUnitAbilityLevel(GetFilterUnit(),'Aloc') == 0 and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and IsUnitIdType(GetUnitTypeId(GetFilterUnit()), UNIT_TYPE_HERO) == false
endfunction
function H1R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit H2R = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	else
		call SetUnitPosition(targetUnit, GetUnitX(H2R)+ GetRandomReal(50, 100)* Cos(GetRandomReal(0, 359)* bj_DEGTORAD), GetUnitY(H2R)+ GetRandomReal(50, 100)* Sin(GetRandomReal(0, 359)* bj_DEGTORAD))
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	endif
	set H2R = null
	set targetUnit = null
	set t = null
	return false
endfunction
function H3R takes unit H2R, unit targetUnit returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer S7V = 7 -GetUnitAbilityLevel(H2R,'A0LV')
	call TriggerRegisterTimerEvent(t, S7V, false)
	call TriggerRegisterDeathEvent(t, H2R)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function H1R))
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("effects\\Test_of_Faith_FX.mdx", targetUnit, "overhead"))
	call SaveUnitHandle(HY, h, 0, H2R)
	call SaveUnitHandle(HY, h, 1, targetUnit)
	set t = null
endfunction
function YCV takes nothing returns nothing
	local unit u = GetSpellTargetUnit()
	local unit H2R = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local integer level = GetUnitAbilityLevel(H2R,'A2MC')
	local real x
	local real y
	local group g
	local unit u2
	if IsSentinelPlayer(p) then
		set x = GetRectCenterX(gg_rct_SentinelRevivalPoint)
		set y = GetRectCenterY(gg_rct_SentinelRevivalPoint)
	else
		set x = GetRectCenterX(gg_rct_ScourgeRevivalPoint)
		set y = GetRectCenterY(gg_rct_ScourgeRevivalPoint)
	endif
	if IsUnitType(u, UNIT_TYPE_HERO) and p != GetOwningPlayer(H2R) then
		if LoadBoolean(HY, GetHandleId(u), 80) then
			call InterfaceErrorForPlayer(GetOwningPlayer(H2R), GetObjectName('n036'))
		elseif LoadBoolean(HY, GetHandleId(p), 139) == false then
			call HZR(u, x, y, level)
		else
			call InterfaceErrorForPlayer(GetOwningPlayer(H2R), GetObjectName('n038'))
		endif
	elseif u == H2R then
		set g = AllocationGroup(141)
		set U2 = H2R
		call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(H2R), Condition(function H0R))
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			call H3R(H2R, u2)
			call GroupRemoveUnit(g, u2)
		endloop
		call DeallocateGroup(g)
	else
		call SetUnitX(u, x)
		call SetUnitY(u, y)
	endif
	set p = null
	set u = null
	set H2R = null
endfunction
function H4R takes unit u, unit t returns nothing
	local integer WUV = GetUnitAbilityLevel(u,'A0LV')
	local integer CJR = 0
	if WUV == 4 then
		set CJR = GetRandomInt(275, 400)
	elseif WUV == 3 then
		set CJR = GetRandomInt( 225, 300)
	elseif WUV == 2 then
		set CJR = GetRandomInt(125, 200)
	elseif WUV == 1 then
		set CJR = GetRandomInt(75, 150)
	endif
	call UnitDamageTargetEx(u, t, 3, CJR)
	call CommonTextTag(I2S(CJR), 1, t, .023, 255, 255, 0, 216)
endfunction
function H5R takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call H4R(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function YBV takes nothing returns nothing
	local timer t
	local integer h
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, 0, false, function H5R)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		set t = null
	endif
endfunction
function P7E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	if GetUnitAbilityLevel(u,'A2MC') == 0 then
		call UnitAddPermanentAbility(u,'A2MC')
	endif
	call SetUnitAbilityLevel(u,'A2MC', GetUnitAbilityLevel(u,'A0LV'))
	set u = null
endfunction
function H6R takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer level =(LoadInteger(HY,(h), 5))
	local real damageValue
	local integer hu
	local unit targetUnit = LoadUnitHandle(HY, h, 0)
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED and GetUnitAbilityLevel(targetUnit,'B05H') == 1 then
		if LoadBoolean(HY, h, 0) == false then
			call SaveBoolean(HY, h, 0, true)
			set damageValue = GetEventDamage()* LoadReal(HY, h, 5)
			call UnitDamageTargetEx(GetEventDamageSource(), targetUnit, 3, damageValue)
			call SaveBoolean(HY, h, 0, false)
		endif
	else
		set hu = LoadInteger(HY, h, 0)
		call UnitRemoveAbility(targetUnit, LoadInteger(HY, h, 1))
		call UnitRemoveAbility(targetUnit,'B05H')
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
endfunction
function ZXV takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = GetSpellTargetUnit()
	local unit H2R = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(H2R,'A0KM')
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl", H2R, "chest"))
	call SaveInteger(HY,(h), 5,(level))
	call TriggerRegisterTimerEvent(t, 7, false)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call SaveInteger(HY, h, 0, GetHandleId(targetUnit))
	call SaveUnitHandle(HY, h, 0, targetUnit)
	call UnitAddPermanentAbility(targetUnit,'A3QU'-1 + level)
	call SaveInteger(HY, h, 1,'A3QU'-1 + level)
	call SaveReal(HY, h, 5, .1 + .05 * level)
	call TriggerAddCondition(t, Condition(function H6R))
	set t = null
	set targetUnit = null
	set H2R = null
endfunction
function H7R takes nothing returns boolean
	return(H_R() and IsUnitType(GetFilterUnit(), UNIT_TYPE_ANCIENT))!= null
endfunction
function H8R takes group g returns unit
	local unit u
	local real H9R = 99999.
	set U2 = null
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if LoadReal(HY, GetHandleId(u),'0age')< H9R then
			set U2 = u
			set H9R = LoadReal(HY, GetHandleId(u),'0age')
		endif
		call GroupRemoveUnit(g, u)
	endloop
	set u = null
	return U2
endfunction
function JVR takes unit targetUnit returns nothing
	local unit H2R = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(H2R,'A28T')+ GetUnitAbilityLevel(H2R,'A361')
	local integer WOV = level
	local integer i
	local integer JER
	local group g = AllocationGroup(142)
	local integer JXR
	if IsUnitType(targetUnit, UNIT_TYPE_ANCIENT) then
		call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(H2R), Condition(function H7R))
		set JER = CountUnitsInGroup(g)
		set JXR = IMinBJ(R2I((GetUnitLevel(H2R)-1)/ 5), 3)
		if JER >= JXR then
			call KillUnit(H8R(g))
		endif
	endif
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(H2R), Condition(function H_R))
	set i = CountUnitsInGroup(g)
	if i == WOV then
		call KillUnit(H8R(g))
	endif
	call DeallocateGroup(g)
	set g = null
	if IsSentinelPlayer(GetOwningPlayer(H2R)) then
		call UnitShareVision(targetUnit, ScourgePlayers[0], false)
		call UnitShareVision(targetUnit, ScourgePlayers[1], false)
		call UnitShareVision(targetUnit, ScourgePlayers[2], false)
		call UnitShareVision(targetUnit, ScourgePlayers[3], false)
		call UnitShareVision(targetUnit, ScourgePlayers[4], false)
		call UnitShareVision(targetUnit, ScourgePlayers[5], false)
	else
		call UnitShareVision(targetUnit, SentinelPlayers[0], false)
		call UnitShareVision(targetUnit, SentinelPlayers[1], false)
		call UnitShareVision(targetUnit, SentinelPlayers[2], false)
		call UnitShareVision(targetUnit, SentinelPlayers[3], false)
		call UnitShareVision(targetUnit, SentinelPlayers[4], false)
		call UnitShareVision(targetUnit, SentinelPlayers[5], false)
	endif
	call I8X(targetUnit)
	call UnitAddPermanentAbility(targetUnit,'A0KO')
	if GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)< 600 + 100 * level then
		call UnitAddMaxLife(targetUnit, R2I(600 + 100 * level -GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)))
	endif
	call SaveReal(HY, GetHandleId(targetUnit),'0age', GetGameTime())
	call UnitAddPermanentAbility(targetUnit,'A12G')
	set i = GetUnitAbilityLevel(H2R,'A0A8')
	if i > 0 then
		call SetUnitMoveSpeed(targetUnit, GetUnitDefaultMoveSpeed(targetUnit)+ 20 + 10* i)
	endif
	set H2R = null
endfunction
function JOR takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local unit dummyCaster
	if IsUnitEnemy(targetUnit, GetOwningPlayer(whichUnit)) then
		set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitAddAbility(dummyCaster,'A069')
		call IssueTargetOrderById(dummyCaster, 852581, targetUnit)
		call JVR(targetUnit)
	endif
	set whichUnit = null
	set targetUnit = null
	set dummyCaster = null
endfunction
function ZOV takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call JOR()
	endif
endfunction
function KCE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	if IsUnitEnemy(targetUnit, GetOwningPlayer(whichUnit)) then
		if IsUnitType(targetUnit, UNIT_TYPE_HERO) or IsUnitIllusion(targetUnit) or DRX(targetUnit) then
			call EXStopUnit(whichUnit)
			call InterfaceErrorForPlayer(GetOwningPlayer(whichUnit), GetObjectName('n0K9'))
		elseif IsUnitType(targetUnit, UNIT_TYPE_ANCIENT) and GetSpellAbilityId()!='A361' then
			call EXStopUnit(whichUnit)
			call InterfaceErrorForPlayer(GetOwningPlayer(whichUnit), "只有在拥有蓝杖后才可以劝化远古单位!")
		endif
	endif
	set whichUnit = null
	set targetUnit = null
endfunction
function JRR takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and GetWidgetLife(GetFilterUnit())> 1))
endfunction
function ZRV takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A0LT')
	local group g = AllocationGroup(143)
	local unit u2
	local boolean b = false
	if level == 0 then
		set level = GetUnitAbilityLevel(u,'A1CS')
		set b = true
	endif
	call GroupEnumUnitsInRect(g, bj_mapInitialPlayableArea, Condition(function JRR))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		if (IsUnitAlly(u2, GetOwningPlayer(u))) then
			if OYX(u2) == false then
				if b then
					call SetWidgetLife(u2, GetWidgetLife(u2)+ .3 * GetUnitState(u, UNIT_STATE_MAX_LIFE))
				endif
				call SetWidgetLife(u2, GetWidgetLife(u2)+ 100 + 200 * level)
			endif
			call DestroyEffect(AddSpecialEffectTargetUnitBJ("chest", u2, "Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl"))
		endif
		call GroupRemoveUnit(g, u2)
	endloop
	call DeallocateGroup(g)
	set g = AllocationGroup(144)
	set bj_groupEnumOwningPlayer = GetOwningPlayer(u)
	call GroupEnumUnitsInRect(g, GetWorldBounds(), filterGetUnitsInRectOfPlayer)
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		if (IsUnitType(u2, UNIT_TYPE_HERO) == false and GetUnitTypeId(u2)!='n00C') then
			call SetWidgetLife(u2, 99999999)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", u2, "chest"))
		endif
		call GroupRemoveUnit(g, u2)
	endloop
	call DeallocateGroup(g)
	set g = null
	set u = null
	set u2 = null
endfunction
function JIR takes nothing returns nothing
	if IsUnitMessenger(GetEnumUnit()) == false then
		call UnitDamageTargetEx(HKV, GetEnumUnit(), 1, HJV)
	endif
endfunction
function JAR takes unit whichUnit, real x, real y, integer level returns nothing
	local real x1
	local real y1
	local group g = AllocationGroup(145)
	local real IXX = 40 + 40 * level
	set U2 = whichUnit
	set HKV = whichUnit
	set HJV = IXX
	call GroupEnumUnitsInRange(g, x, y, 600, Condition(function DHX))
	call ForGroup(g, function JIR)
	call DeallocateGroup(g)
	set x1 = x
	set y1 = y
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x1, y1))
	set x1 = x + 200
	set y1 = y + 200
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x1, y1))
	set x1 = x + 200
	set y1 = y  -200
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x1, y1))
	set x1 = x  -200
	set y1 = y + 200
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x1, y1))
	set x1 = x  -200
	set y1 = y  -200
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x1, y1))
	call A8X(GetOwningPlayer(whichUnit), 10, x, y, 600)
	set g = null
endfunction
function JNR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit
	local unit missileDummy = LoadUnitHandle(HY, h, 45)
	local real tx = LoadReal(HY, h, 47)
	local real ty = LoadReal(HY, h, 48)
	local real a = LoadReal(HY, h, 13)
	local real sx = LoadReal(HY, h, 189)
	local real sy = LoadReal(HY, h, 190)
	local real targetX = CoordinateX50(sx + 44 * Cos(a))
	local real targetY = CoordinateY50(sy + 44 * Sin(a))
	local real JBR
	local real JCR
	local integer level = LoadInteger(HY, h, 0)
	call SetUnitX(missileDummy, targetX)
	call SetUnitY(missileDummy, targetY)
	call SaveReal(HY, h, 189, targetX * 1.)
	call SaveReal(HY, h, 190, targetY * 1.)
	if GetDistanceBetween(tx, ty, targetX, targetY)<= 35 then
		call KillUnit(missileDummy)
		set trigUnit = LoadUnitHandle(HY, h, 14)
		call JAR(trigUnit, targetX, targetY, level)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set trigUnit = null
	set missileDummy = null
	return false
endfunction
function ZAV takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local real sx = CoordinateX50(GetUnitX(trigUnit))
	local real sy = CoordinateY50(GetUnitY(trigUnit))
	local real tx = CoordinateX50(GetSpellTargetX())
	local real ty = CoordinateY50(GetSpellTargetY())
	local real a = Atan2(ty -sy, tx -sx)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit missileDummy = CreateUnit(GetOwningPlayer(trigUnit),'h03Y', sx, sy, a * bj_RADTODEG)
	call SetUnitFacing(missileDummy, a * bj_RADTODEG)
	call SetUnitPathing(missileDummy, false)
	call UnitAddPermanentAbility(missileDummy,'Aloc')
	call ShowUnit(missileDummy, false)
	call UnitRemoveAbility(missileDummy,'Aloc')
	call ShowUnit(missileDummy, true)
	call SaveReal(HY, h, 191, sx * 1.)
	call SaveReal(HY, h, 192, sy * 1.)
	call SaveReal(HY, h, 189, sx * 1.)
	call SaveReal(HY, h, 190, sy * 1.)
	call SaveReal(HY, h, 47, tx * 1.)
	call SaveReal(HY, h, 48, ty * 1.)
	call SaveReal(HY, h, 13, a * 1.)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(trigUnit, GetSpellAbilityId()))
	call SaveUnitHandle(HY, h, 14, trigUnit)
	call SaveUnitHandle(HY, h, 45, missileDummy)
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function JNR))
	set trigUnit = null
	set t = null
	set missileDummy = null
endfunction
function JDR takes real s, real d1, real d2, real d3 returns boolean
	return s <= d1 and s <= d2 and s <= d3
endfunction
function JFR takes unit u, real x, real y, real d returns real
	local real x2 = GetUnitX(u)
	local real y2 = GetUnitY(u)
	local real JGR = GetDistanceBetween(x -d, y, x2, y2)
	local real JHR = GetDistanceBetween(x + d, y, x2, y2)
	local real JJR = GetDistanceBetween(x, y + d, x2, y2)
	local real JKR = GetDistanceBetween(x, y -d, x2, y2)
	if JDR(JGR, JHR, JKR, JJR) then
		return 180.
	elseif JDR(JHR, JGR, JKR, JJR) then
		return .0
	elseif JDR(JKR, JHR, JGR, JJR) then
		return 270.
	endif
	return 90.
endfunction
function JLR takes real s, real d1, real d2, real d3, real d4, real d5, real d6, real d7 returns boolean
	return s <= d1 and s <= d2 and s <= d3 and s <= d4 and s <= d5 and s <= d6 and s <= d7
endfunction
function JMR takes unit u, integer h returns unit
	local real x1 = GetUnitX(u)
	local real y1 = GetUnitY(u)
	local unit JPR =(LoadUnitHandle(HY, h,( 1100+ 1)))
	local unit JQR =(LoadUnitHandle(HY, h,( 1100+ 2)))
	local unit JSR =(LoadUnitHandle(HY, h,( 1100+ 3)))
	local unit JTR =(LoadUnitHandle(HY, h,( 1100+ 4)))
	local unit JUR =(LoadUnitHandle(HY, h,( 1100+ 5)))
	local unit JWR =(LoadUnitHandle(HY, h,( 1100+ 6)))
	local unit JYR =(LoadUnitHandle(HY, h,( 1100+ 7)))
	local unit JZR =(LoadUnitHandle(HY, h,( 1100+ 8)))
	local real d1 = GetDistanceBetween(x1, y1, GetUnitX(JPR), GetUnitY(JPR))
	local real d2 = GetDistanceBetween(x1, y1, GetUnitX(JQR), GetUnitY(JQR))
	local real d3 = GetDistanceBetween(x1, y1, GetUnitX(JSR), GetUnitY(JSR))
	local real d4 = GetDistanceBetween(x1, y1, GetUnitX(JTR), GetUnitY(JTR))
	local real d5 = GetDistanceBetween(x1, y1, GetUnitX(JUR), GetUnitY(JUR))
	local real d6 = GetDistanceBetween(x1, y1, GetUnitX(JWR), GetUnitY(JWR))
	local real d7 = GetDistanceBetween(x1, y1, GetUnitX(JYR), GetUnitY(JYR))
	local real d8 = GetDistanceBetween(x1, y1, GetUnitX(JZR), GetUnitY(JZR))
	if JLR(d1, d2, d3, d4, d5, d6, d7, d8) then
		set JQR = null
		set JSR = null
		set JTR = null
		set JUR = null
		set JWR = null
		set JYR = null
		set JZR = null
		return JPR
	elseif JLR(d2, d1, d3, d4, d5, d6, d7, d8) then
		set JPR = null
		set JSR = null
		set JTR = null
		set JUR = null
		set JWR = null
		set JYR = null
		set JZR = null
		return JQR
	elseif JLR(d3, d2, d1, d4, d5, d6, d7, d8) then
		set JPR = null
		set JQR = null
		set JTR = null
		set JUR = null
		set JWR = null
		set JYR = null
		set JZR = null
		return JSR
	elseif JLR(d4, d2, d3, d1, d5, d6, d7, d8) then
		set JPR = null
		set JQR = null
		set JSR = null
		set JUR = null
		set JWR = null
		set JYR = null
		set JZR = null
		return JTR
	elseif JLR(d5, d2, d3, d4, d1, d6, d7, d8) then
		set JPR = null
		set JQR = null
		set JSR = null
		set JTR = null
		set JWR = null
		set JYR = null
		set JZR = null
		return JUR
	elseif JLR(d6, d2, d3, d4, d5, d1, d7, d8) then
		set JPR = null
		set JQR = null
		set JSR = null
		set JTR = null
		set JUR = null
		set JYR = null
		set JZR = null
		return JWR
	elseif JLR(d7, d2, d3, d4, d5, d6, d1, d8) then
		set JPR = null
		set JQR = null
		set JSR = null
		set JTR = null
		set JUR = null
		set JWR = null
		set JZR = null
		return JYR
	elseif JLR(d8, d2, d3, d4, d5, d6, d7, d1) then
		set JPR = null
		set JQR = null
		set JSR = null
		set JTR = null
		set JUR = null
		set JWR = null
		set JYR = null
		return JZR
	endif
	return null
endfunction
function J_R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real a =(LoadReal(HY, h, 13))
	local real x = GetUnitX(targetUnit)
	local real y = GetUnitY(targetUnit)
	local real J0R = 7.5
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer level =(LoadInteger(HY, h, 5))
	local integer J1R = 40 + 40 * level
	if GetTriggerEvalCount(t)> 34 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SaveInteger(HY,(GetHandleId((targetUnit))),(4260), 2)
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, J1R)
		call SetUnitState(targetUnit, UNIT_STATE_MANA, RMaxBJ(GetUnitState(targetUnit, UNIT_STATE_MANA)-J1R, 0))
	else
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl", x, y))
		call KillTreeByCircle(x, y, 150)
		if ((LoadInteger(HY,(GetHandleId((targetUnit))),(4261))) == 1) == false then
			call SetUnitPosition(targetUnit, x + J0R * Cos(a * bj_DEGTORAD), y + J0R * Sin(a * bj_DEGTORAD))
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function J2R takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = GetEnumUnit()
	local real x = S2
	local real y = TJ
	local real d = RJ
	local real a = JFR(targetUnit, x, y, d)
	local real x2 = GetWidgetX(targetUnit)
	local real y2 = GetWidgetY(targetUnit)
	local real d2 = d -SquareRoot((x -x2)*(x -x2)+(y -y2)*(y -y2))+ 100 
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl", targetUnit, "chest"))
	call SaveInteger(HY,(GetHandleId((targetUnit))),(4260), 1)
	if d2 > 0 then
		call SetUnitX(targetUnit, x2 + d2 * Cos(a * bj_DEGTORAD))
		call SetUnitY(targetUnit, y2 + d2 * Sin(a * bj_DEGTORAD))
	endif
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveInteger(HY, h, 5,(Q2))
	call SaveUnitHandle(HY, h, 2,(U2))
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function J_R))
	set t = null
	set targetUnit = null
endfunction
function J3R takes unit u, integer h returns boolean
	local unit J4R = JMR(u, h)
	local boolean JVX = true
	if UnitIsDead(J4R) or(LoadInteger(HY,(GetHandleId(J4R)), 156)) == 1 then
		set JVX = false
	endif
	call SaveInteger(HY,(GetHandleId(J4R)), 156, 1)
	call SetUnitVertexColor(J4R, 25, 25, 25, 175)
	set J4R = null
	return JVX
endfunction
function J5R takes nothing returns nothing
	if GetUnitState(GetEnumUnit(), UNIT_STATE_MANA)> 0 and IsUnitInGroup(GetEnumUnit(), DK) == false and((LoadInteger(HY, GetHandleId(GetEnumUnit()), 4260)) == 1) == false and J3R(GetEnumUnit(), HLV) then
		call SaveInteger(HY, GetHandleId(GetEnumUnit()), 4260, 1)
		call GroupAddUnit(EK, GetEnumUnit())
	endif
endfunction
function J6R takes trigger t, unit trigUnit, real x, real y, real d, integer level returns nothing
	local integer h = GetHandleId(t)
	local real J7R = 200
	local rect r1 = Rect(x -d, y -d, x + d, y + d)
	local rect r2 = Rect(x -d -J7R, y -d -J7R, x + d + J7R, y + d + J7R)
	local group g1 = AllocationGroup(146)
	local group g2 = AllocationGroup(147)
	local group g3 = AllocationGroup(148)
	set U2 = trigUnit
	call GroupEnumUnitsInRect(g1, r1, Condition(function DQX))
	call GroupEnumUnitsInRect(g2, r2, Condition(function DQX))
	set DK = g1
	set EK = g3
	set S2 = x
	set TJ = y
	set RJ = d
	set HLV = h
	call ForGroup(g2, function J5R)
	set Q2 = level
	call ForGroup(g3, function J2R)
	call DeallocateGroup(g1)
	call DeallocateGroup(g2)
	call DeallocateGroup(g3)
	call RemoveRect(r1)
	call RemoveRect(r2)
	set g1 = null
	set g2 = null
	set g3 = null
	set r1 = null
	set r2 = null
endfunction
function J8R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local player p =(LoadPlayerHandle(HY, h, 54))
	local boolean J9R =(LoadBoolean(HY, h, 155))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	if J9R then
		call A8X(p, .2, x, y, 500)
	endif
	set t = null
	set p = null
	return false
endfunction
function KVR takes unit KER returns nothing
	local real x = GetUnitX(KER)
	local real y = GetUnitY(KER)
	local player p = GetOwningPlayer(KER)
	local unit dummyCaster = CreateUnit(p,'u00W', x, y, 0)
	call KillUnit(dummyCaster)
	set p = null
	set dummyCaster = null
endfunction
function KXR takes integer h, real x, real y, boolean J9R, player p returns nothing
	local unit JPR =(LoadUnitHandle(HY, h,( 1100+ 1)))
	local unit JQR =(LoadUnitHandle(HY, h,( 1100+ 2)))
	local unit JSR =(LoadUnitHandle(HY, h,( 1100+ 3)))
	local unit JTR =(LoadUnitHandle(HY, h,( 1100+ 4)))
	local unit JUR =(LoadUnitHandle(HY, h,( 1100+ 5)))
	local unit JWR =(LoadUnitHandle(HY, h,( 1100+ 6)))
	local unit JYR =(LoadUnitHandle(HY, h,( 1100+ 7)))
	local unit JZR =(LoadUnitHandle(HY, h,( 1100+ 8)))
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .1, false)
	call TriggerAddCondition(t, Condition(function J8R))
	call SaveReal(HY,(GetHandleId(t)), 6,((x)* 1.))
	call SaveReal(HY,(GetHandleId(t)), 7,((y)* 1.))
	call SavePlayerHandle(HY,(GetHandleId(t)), 54,(p))
	call SaveBoolean(HY,(GetHandleId(t)), 155,(J9R))
	call KVR(JPR)
	call RemoveUnit(JPR)
	call KVR(JQR)
	call RemoveUnit(JQR)
	call KVR(JSR)
	call RemoveUnit(JSR)
	call KVR(JTR)
	call RemoveUnit(JTR)
	call KVR(JUR)
	call RemoveUnit(JUR)
	call KVR(JWR)
	call RemoveUnit(JWR)
	call KVR(JYR)
	call RemoveUnit(JYR)
	call KVR(JZR)
	call RemoveUnit(JZR)
	set t = null
	set JPR = null
	set JQR = null
	set JSR = null
	set JTR = null
	set JUR = null
	set JWR = null
	set JYR = null
	set JZR = null
endfunction
function KOR takes unit KER, integer h, integer index, player p returns nothing
	if UnitVisibleToPlayer(KER, p) then
		call SaveBoolean(HY, h, 155,(true))
	endif
	call SaveUnitHandle(HY, h,( 1100+ index),(KER))
endfunction
function KRR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real N5O =(LoadReal(HY, h, 57))
	local integer count = GetTriggerEvalCount(t)
	if count > R2I(N5O * 10) then
		call KXR(h,(LoadReal(HY, h, 6)),(LoadReal(HY, h, 7)),(LoadBoolean(HY, h, 155)),(LoadPlayerHandle(HY, h, 154)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call J6R(t,(LoadUnitHandle(HY, h, 14)),(LoadReal(HY, h, 6)),(LoadReal(HY, h, 7)),(LoadReal(HY, h, 138)),(LoadInteger(HY, h, 5)))
	endif
	set t = null
	return false
endfunction
function KIR takes nothing returns nothing
	call SetUnitX(GetEnumUnit(), GetUnitX(U2))
	call SetUnitY(GetEnumUnit(), GetUnitY(U2))
endfunction
function KAR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local integer level = GetUnitAbilityLevel(trigUnit,'A0Z5')
	local integer ID ='u00S'
	local real x1 = R2I(GetUnitX(trigUnit))-ModuloInteger(R2I(GetUnitX(trigUnit)), 64)
	local real y1 = R2I(GetUnitY(trigUnit))-ModuloInteger(R2I(GetUnitY(trigUnit)), 64)
	local real x2
	local real y2
	local real d = 128
	local unit KER
	local real N5O = 4 + level
	local real BufferDuration = 5
	local group g
	local rect KNR
	local player XSR
	local real L2O = 3
	if level < 4 then
		set L2O = 2
	endif
	if IsSentinelPlayer(GetOwningPlayer(trigUnit)) then
		set XSR = ScourgePlayers[0]
	else
		set XSR = SentinelPlayers[0]
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SaveBoolean(HY, h, 155,(false))
	set g = AllocationGroup(149)
	set d = d + 110
	set KNR = Rect(x1 -d, y1 -d, x1 + d, y1 + d)
	set d = d -110
	set U2 = trigUnit
	call GroupEnumUnitsInRect(g, KNR, Condition(function D7X))
	set x2 = x1 + d
	set y2 = y1
	set KER = CreateUnit(GetOwningPlayer(trigUnit), ID, x2, y2, 0)
	call SetWidgetLife(KER, L2O)
	call SetUnitPosition(KER, x2, y2)
	call KOR(KER, h, 1, XSR)
	set x2 = x1 + d
	set y2 = y1 + d
	set KER = CreateUnit(GetOwningPlayer(trigUnit), ID, x2, y2, 0)
	call SetUnitPosition(KER, x2, y2)
	call SetWidgetLife(KER, L2O)
	call KOR(KER, h, 2, XSR)
	set x2 = x1
	set y2 = y1 + d
	set KER = CreateUnit(GetOwningPlayer(trigUnit), ID, x2, y2, 0)
	call SetUnitPosition(KER, x2, y2)
	call SetWidgetLife(KER, L2O)
	call KOR(KER, h, 3, XSR)
	set x2 = x1 -d
	set y2 = y1 + d
	set KER = CreateUnit(GetOwningPlayer(trigUnit), ID, x2, y2, 0)
	call SetUnitPosition(KER, x2, y2)
	call SetWidgetLife(KER, L2O)
	call KOR(KER, h, 4, XSR)
	set x2 = x1 -d
	set y2 = y1
	set KER = CreateUnit(GetOwningPlayer(trigUnit), ID, x2, y2, 0)
	call SetUnitPosition(KER, x2, y2)
	call SetWidgetLife(KER, L2O)
	call KOR(KER, h, 5, XSR)
	set x2 = x1 -d
	set y2 = y1 -d
	set KER = CreateUnit(GetOwningPlayer(trigUnit), ID, x2, y2, 0)
	call SetUnitPosition(KER, x2, y2)
	call SetWidgetLife(KER, L2O)
	call KOR(KER, h, 6, XSR)
	set x2 = x1
	set y2 = y1 -d
	set KER = CreateUnit(GetOwningPlayer(trigUnit), ID, x2, y2, 0)
	call SetUnitPosition(KER, x2, y2)
	call SetWidgetLife(KER, L2O)
	call KOR(KER, h, 7, XSR)
	set x2 = x1 + d
	set y2 = y1 -d
	set KER = CreateUnit(GetOwningPlayer(trigUnit), ID, x2, y2, 0)
	call SetUnitPosition(KER, x2, y2)
	call SetWidgetLife(KER, L2O)
	call KOR(KER, h, 8, XSR)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function KRR))
	call SaveReal(HY, h, 57,((N5O)* 1.))
	call SaveReal(HY, h, 6,((x1)* 1.))
	call SaveReal(HY, h, 7,((y1)* 1.))
	call SaveReal(HY, h, 138,((d)* 1.))
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call SaveInteger(HY, h, 5,(level))
	call SavePlayerHandle(HY, h, 154,(XSR))
	call ForGroup(g, function KIR)
	call DeallocateGroup(g)
	set t = null
	set g = null
	set trigUnit = null
	set KER = null
	set KNR = null
	set XSR = null
	return false
endfunction
function ZNV takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = GetTriggerUnit()
	call TriggerRegisterTimerEvent(t, .1, false)
	call TriggerAddCondition(t, Condition(function KAR))
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	set t = null
	set trigUnit = null
endfunction
function KWR takes nothing returns boolean
	return DQX() and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2))
endfunction
function KYR takes unit whichUnit, integer level returns nothing
	local group g = AllocationGroup(154)
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local unit targetUnit
	local unit dummyCaster
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, x, y, 300, Condition(function KWR))
	set targetUnit = GroupPickRandomUnit(g)
	call DeallocateGroup(g)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl", whichUnit, "origin"))
	if targetUnit != null then
		set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', x, y, 0)
		call UnitAddPermanentAbility(dummyCaster,'A0Z7')
		call SetUnitAbilityLevel(dummyCaster,'A0Z7', level)
		call IssueTargetOrderById(dummyCaster, 852095, targetUnit)
		set dummyCaster = null
	endif
	set targetUnit = null
endfunction
function KZR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer count = GetTriggerEvalCount(t)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	if count > 14 or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call KYR(trigUnit, LoadInteger(HY, h, 0))
	endif
	set t = null
	set trigUnit = null
	return false
endfunction
function ZCV takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = GetTriggerUnit()
	call TriggerRegisterTimerEvent(t, .7, true)
	call TriggerRegisterDeathEvent(t, trigUnit)
	call TriggerAddCondition(t, Condition(function KZR))
	call SaveUnitHandle(HY, h, 14, trigUnit)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(trigUnit, GetSpellAbilityId()))
	call TriggerEvaluate(t)
	set t = null
	set trigUnit = null
endfunction
function K_R takes nothing returns nothing
	call UnitDamageTargetEx(HMV, GetEnumUnit(), 1, HPV)
endfunction
function K0R takes unit whichUnit, real x, real y, integer level, boolean K1R returns nothing
	local group g = AllocationGroup(155)
	set HPV = 20 + 50 * level
	if K1R then
		set HPV = HPV + 50
	endif
	set HMV = whichUnit
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, x, y, 275, Condition(function DJX))
	call ForGroup(g, function K_R)
	call DeallocateGroup(g)
	set g = null
endfunction
function K2R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local integer level =(LoadInteger(HY, h, 5))
	local integer c = GetTriggerEvalCount(t)
	local integer K3R = ModuloInteger(c, 4)+ 1
	local real a
	local real d
	local real x
	local real y
	local group g
	set U2 = trigUnit
	if K3R == 1 then
		set a = GetRandomReal(0, 90)
	elseif K3R == 2 then
		set a = GetRandomReal(90, 180)
	elseif K3R == 3 then
		set a = GetRandomReal( 180, 270)
	else
		set a = GetRandomReal(270, 360)
	endif
	set d = GetRandomReal( 140, 710)
	if c > 150 or GetUnitAbilityLevel(trigUnit,'A03R')+ GetUnitAbilityLevel(trigUnit,'A0AV') == 0 or(GetTriggerEventId() == EVENT_UNIT_SPELL_ENDCAST and(GetSpellAbilityId()=='A03R' or GetSpellAbilityId()=='A0AV')) then
		if GetSpellAbilityId()=='A0AV' and LoadBoolean(HY, h, 0) == false then
			call UnitRemoveAbility(trigUnit,'A0ST')
			call DestroyEffect(LoadEffectHandle(HY, h, 0))
		endif
		call UnitRemoveAbility(trigUnit,'A347')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call StopSound(AC, false, true)
	else
		if LoadBoolean(HY, h, 0) == false and(R2I(2 / LoadReal(HY, h, 5))< GetTriggerEvalCount(t)) then
			call UnitRemoveAbility(trigUnit,'A0ST')
			call UnitRemoveAbility(trigUnit,'A347')
			call DestroyEffect(LoadEffectHandle(HY, h, 0))
			call SaveBoolean(HY, h, 0, true)
		endif
		set x = GetUnitX(trigUnit)+ d * Cos(a * bj_DEGTORAD)
		set y = GetUnitY(trigUnit)+ d * Sin(a * bj_DEGTORAD)
		call DestroyEffect(AddSpecialEffect("effects\\SnowyBlizzardTarget.mdx", x, y))
		call K0R(trigUnit, x, y, level, LoadBoolean(HY, h, 2))
	endif
	set t = null
	set trigUnit = null
	set g = null
	return false
endfunction
function ZDV takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level
	local real r = .07
	call A5X(AC, GetUnitX(trigUnit), GetUnitY(trigUnit))
	call UnitAddAbility(trigUnit,'A347')
	if GetSpellAbilityId()=='A03R' then
		set level = GetUnitAbilityLevel(trigUnit,'A03R')
		call SaveBoolean(HY, h, 2, false)
	else
		call SetUnitAbilityLevel(trigUnit,'A347', 2)
		call SaveBoolean(HY, h, 2, true)
		set level = GetUnitAbilityLevel(trigUnit,'A0AV')
		call UnitAddPermanentAbility(trigUnit,'A0ST')
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl", trigUnit, "origin"))
		call SaveEffectHandle(HY, h, 0, AddSpecialEffectTarget("Abilities\\Spells\\Human\\DivineShield\\DivineShieldTarget.mdl", trigUnit, "origin"))
		call SetPlayerAbilityAvailable(GetOwningPlayer(trigUnit),'A0ST', false)
	endif
	call TriggerRegisterTimerEvent(t, r, true)
	call TriggerRegisterUnitEvent(t, trigUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function K2R))
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h, 5, r)
	set t = null
	set trigUnit = null
endfunction
function K4R takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	if GetHandleId(u)> 0 then
		if GetWidgetLife(u)> 1 then
			call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ level * .1 + .1)
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
endfunction
function PHE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'AHab')
	local trigger t
	local integer h
	if HaveSavedHandle(HY, GetHandleId(u),'AHab') then
		set t = LoadTriggerHandle(HY, GetHandleId(u),'AHab')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call FlushChildHashtable(HY, h)
		call SaveTriggerHandle(HY, GetHandleId(u),'AHab', t)
		call SaveUnitHandle(HY, h, 0, u)
		call TriggerRegisterTimerEvent(t, .2, true)
		call TriggerAddCondition(t, Condition(function K4R))
	endif
	call SaveInteger(HY, h, 0, level)
	set t = null
	set u = null
endfunction
function ZFV takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local integer level = GetUnitAbilityLevel(whichUnit,'A1E9')
	local group g = AllocationGroup(156)
	local unit u2
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, x, y, 425, Condition(function DQX))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call UnitDamageTargetEx(whichUnit, u2, 1, 50 + 50 * level)
		call UnitAddAbilityToTimed(u2,'A3EO'-1 + level, 1, 4.5,'B386')
		call GroupRemoveUnit(g, u2)
	endloop
	call DeallocateGroup(g)
	call DestroyEffect(AddSpecialEffect("war3mapImported\\IceNova.mdx", x, y))
	set whichUnit = null
	set g = null
	set u2 = null
endfunction
function K5R takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	if GetUnitAbilityLevel(targetUnit,'B017')> 0 and(targetUnit != Roshan or LoadInteger(HY, h, 0)< 2 + LoadInteger(HY, h, 1)) then
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 37.5)
		call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 1)
	else
		call UnitRemoveAbility(targetUnit,'B017')
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	endif
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function K6R takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local timer t = CreateTimer()
	local integer level = GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())
	call TimerStart(t, .5, true, function K5R)
	call SaveUnitHandle(HY, GetHandleId(t), 0, whichUnit)
	call SaveInteger(HY, GetHandleId(t), 1, level)
	call SaveUnitHandle(HY, GetHandleId(t), 1, GetSpellTargetUnit())
	call UnitDamageTargetEx(whichUnit, GetSpellTargetUnit(), 1, 37.5)
	set t = null
	set whichUnit = null
endfunction
function FBE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call K6R()
	endif
endfunction
function K7R takes unit u returns nothing
	local boolean K8R = IsSentinelPlayer(GetOwningPlayer(u))
	local boolean K9R = IsScourgePlayer(GetOwningPlayer(u))
	if K9R then
		call UnitShareVision(u, ScourgePlayers[0], false)
		call UnitShareVision(u, ScourgePlayers[1], false)
		call UnitShareVision(u, ScourgePlayers[2], false)
		call UnitShareVision(u, ScourgePlayers[3], false)
		call UnitShareVision(u, ScourgePlayers[4], false)
		call UnitShareVision(u, ScourgePlayers[5], false)
	elseif K8R then
		call UnitShareVision(u, SentinelPlayers[0], false)
		call UnitShareVision(u, SentinelPlayers[1], false)
		call UnitShareVision(u, SentinelPlayers[2], false)
		call UnitShareVision(u, SentinelPlayers[3], false)
		call UnitShareVision(u, SentinelPlayers[4], false)
		call UnitShareVision(u, SentinelPlayers[5], false)
	endif
endfunction
function LVR takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local real damageValue = GetPlayerState(GetOwningPlayer(targetUnit), PLAYER_STATE_RESOURCE_GOLD)*(GetUnitAbilityLevel(whichUnit,'A44U')* .05 + .15)
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, damageValue)
	call CommonTextTag("+" + I2S(R2I(damageValue)), 1, targetUnit, .03, 255, 200, 0, 255)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\ResourceItems\\ResourceEffectTarget.mdl", targetUnit, "origin"))
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Other\\ToonBoom\\ToonBoom.mdl", targetUnit, "origin"))
	set whichUnit = null
	set targetUnit = null
endfunction
function FCE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call LVR()
	endif
endfunction
function GEE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer OJO = GetPlayerState(GetOwningPlayer(targetUnit), PLAYER_STATE_RESOURCE_GOLD)-GetPlayerState(GetOwningPlayer(whichUnit), PLAYER_STATE_RESOURCE_GOLD)
	local real damageValue
	local unit d = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local integer level = GetUnitAbilityLevel(whichUnit,'A44V')
	local integer Z6X = 400 + 400 * level
	call UnitAddAbility(d,'A44W')
	call IssueTargetOrderById(d, 852095, targetUnit)
	set d = null
	if OJO <-Z6X then
		set OJO =-Z6X
	elseif OJO > Z6X then
		set OJO = Z6X
	endif
	if OJO < 0 then
		set damageValue = OJO *(level * .1 + .6)*-1
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, damageValue)
		call CommonTextTag("+" + I2S(R2I(damageValue)), 1, targetUnit, .03, 255, 100, 0, 255)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\ResourceItems\\ResourceEffectTarget.mdl", targetUnit, "origin"))
		call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Other\\ToonBoom\\ToonBoom.mdl", targetUnit, "origin"))
	else
		call SetPlayerState(GetOwningPlayer(targetUnit), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(GetOwningPlayer(targetUnit), PLAYER_STATE_RESOURCE_GOLD)+ OJO)
		call SetPlayerState(GetOwningPlayer(whichUnit), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(GetOwningPlayer(whichUnit), PLAYER_STATE_RESOURCE_GOLD)+ OJO)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\ResourceItems\\ResourceEffectTarget.mdl", targetUnit, "origin"))
		call CommonTextTag("+" + I2S(OJO), 1, targetUnit, .03, 255, 200, 0, 255)
		call CommonTextTag("+" + I2S(OJO), 1, whichUnit, .03, 255, 200, 0, 255)
	endif
	set whichUnit = null
	set targetUnit = null
endfunction
function OgreLord_CashInWrap takes nothing returns nothing
	call GEE()
endfunction
function LER takes unit u, player p, real dur returns nothing
	call K7R(u)
	call SetUnitOwner(u, p, true)
	call UnitApplyTimedLife(u,'BTLF', dur)
	call UnitAddPermanentAbility(u,'A46M')
	call DestroyEffect(AddSpecialEffectTarget(GetAbilityEffectById('A46K', EFFECT_TYPE_TARGET, 0), u, GetAbilityEffectById('A46K', EFFECT_TYPE_TARGET, 1)))
endfunction
function LXR takes unit d, unit t, real dur, integer life returns nothing
	//call BJDebugMsg(GetUnitName(t))
	if IsUnitIllusion(t) then
		call LER(t, GetOwningPlayer(d), dur)
	elseif not IssueTargetOrderById(d, 852581, t) then
		call UnitShareVision(t, GetOwningPlayer(d), true)
		if not IssueTargetOrderById(d, 852581, t) then
			call UnitShareVision(t, GetOwningPlayer(d), false)
		else
			call UnitApplyTimedLife(t,'BTLF', dur)
			call I8X(t)
			call UnitAddPermanentAbility(t,'A46M')
			call UnitAddMaxLife(t, life)
		endif
	else
		call UnitApplyTimedLife(t,'BTLF', dur)
		call I8X(t)
		call UnitAddPermanentAbility(t,'A46M')
		call UnitAddMaxLife(t, life)
	endif
endfunction
// 宇宙兽人大第一次filter 敌对、非建筑、非守卫、存活、非英雄、非熊灵、非元素、非佣兽、非地狱火
function MindControl_Filter takes unit u returns boolean
	return (IsUnitEnemy(u, GetOwningPlayer(U2)) and IsAliveNotStrucNotWard(u) and not IsUnitType(u, UNIT_TYPE_HERO) and not IsBearUnit(u) and not CZX(GetUnitTypeId(u)) and not RHX(GetUnitTypeId(u)) and not CSX(u))
endfunction
function LRR takes nothing returns boolean
	return MindControl_Filter(GetFilterUnit())
endfunction
// 宇宙兽人大
function GXE takes nothing returns nothing
	local group g = AllocationGroup(157)
	local unit whichUnit = GetTriggerUnit()
	local unit d = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	local unit u
	local integer lv = GetUnitAbilityLevel(whichUnit,'A46J')
	local boolean b = IsSentinelPlayer(GetOwningPlayer(whichUnit))
	local integer c
	local integer GOX = 0
	local integer LAR = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetTriggerPlayer())],'A0A8')
	local real dur = 30 + 5 * LAR
	local integer life = LAR * 50
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	call UnitAddAbility(d,'A46K')
	call DestroyEffect(AddSpecialEffect("MindControl.mdx", x, y))
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, x, y, 375, Condition(function LRR))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if IsUnitType(u, UNIT_TYPE_ANCIENT) then
			if lv == 3 then
				call LXR(d, u, dur, life)
			endif
		elseif IsUnitIllusion(u) or(GetOwningPlayer(u)!= SentinelPlayers[0]and GetOwningPlayer(u)!= ScourgePlayers[0]and GetOwningPlayer(u)!= NeutralCreepPlayer) then
			if lv > 1 then
				call LXR(d, u, dur, life)
			endif
		else
			call LXR(d, u, dur, life)
		endif
		call GroupRemoveUnit(g, u)
	endloop
	call DeallocateGroup(g)
	set g = null
	set d = null
	set whichUnit = null
	set u = null
endfunction
function LNR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local real x = LoadReal(HY, h, 10)
	local real y = LoadReal(HY, h, 11)
	local integer c = LoadInteger(HY, h, 0)+ 1
	local string s = "Objects\\Spawnmodels\\NightElf\\NightElfBlood\\NightElfBloodArcher.mdl"
	if c == 1 then
		call DestroyEffect(AddSpecialEffect(s, x, y))
		call DestroyEffect(AddSpecialEffect(s, x + 50 * Cos( 15* bj_DEGTORAD), y + 50 * Sin( 15* bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 100 * Cos(7 * bj_DEGTORAD), y + 100 * Sin(7 * bj_DEGTORAD)))
	elseif c == 2 then
		call DestroyEffect(AddSpecialEffect(s, x + 150* Cos(0 * bj_DEGTORAD), y + 150* Sin(0 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 200* Cos(340 * bj_DEGTORAD), y + 200* Sin(340 * bj_DEGTORAD)))
	elseif c == 3 then
		call DestroyEffect(AddSpecialEffect(s, x + 250* Cos(325 * bj_DEGTORAD), y + 250* Sin(325 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 300 * Cos(300 * bj_DEGTORAD), y + 300 * Sin(300 * bj_DEGTORAD)))
	elseif c == 4 then
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos(275 * bj_DEGTORAD), y + 350 * Sin(270 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 400 * Cos( 250* bj_DEGTORAD), y + 400 * Sin( 250* bj_DEGTORAD)))
	elseif c == 5 then
		call DestroyEffect(AddSpecialEffect(s, x + 450 * Cos( 225* bj_DEGTORAD), y + 450 * Sin( 225* bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 500 * Cos( 200* bj_DEGTORAD), y + 500 * Sin( 200* bj_DEGTORAD)))
	elseif c == 6 then
		call DestroyEffect(AddSpecialEffect(s, x + 550 * Cos(175 * bj_DEGTORAD), y + 550 * Sin(175 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 570 * Cos( 150* bj_DEGTORAD), y + 570 * Sin( 150* bj_DEGTORAD)))
	elseif c == 7 then
		call DestroyEffect(AddSpecialEffect(s, x + 570 * Cos(125 * bj_DEGTORAD), y + 570 * Sin(125 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 570 * Cos( 100 * bj_DEGTORAD), y + 570 * Sin( 100 * bj_DEGTORAD)))
	elseif c == 8 then
		call DestroyEffect(AddSpecialEffect(s, x + 550 * Cos( 100 * bj_DEGTORAD), y + 550 * Sin( 100 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 550 * Cos(90 * bj_DEGTORAD), y + 550 * Sin(90 * bj_DEGTORAD)))
	elseif c == 9 then
		call DestroyEffect(AddSpecialEffect(s, x + 500 * Cos(70 * bj_DEGTORAD), y + 500 * Sin(70 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 450 * Cos(45 * bj_DEGTORAD), y + 450 * Sin(45 * bj_DEGTORAD)))
	elseif c == 10 then
		call DestroyEffect(AddSpecialEffect(s, x + 450 * Cos(20 * bj_DEGTORAD), y + 450 * Sin(20 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 450 * Cos(0 * bj_DEGTORAD), y + 450 * Sin(0 * bj_DEGTORAD)))
	elseif c == 11 then
		call DestroyEffect(AddSpecialEffect(s, x + 400 * Cos(345 * bj_DEGTORAD), y + 400 * Sin(345 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos(330 * bj_DEGTORAD), y + 350 * Sin(330 * bj_DEGTORAD)))
	elseif c == 12 then
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos(315 * bj_DEGTORAD), y + 350 * Sin(315 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos(300 * bj_DEGTORAD), y + 350 * Sin(300 * bj_DEGTORAD)))
	elseif c == 13 then
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos(275 * bj_DEGTORAD), y + 350 * Sin(275 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 300 * Cos( 250* bj_DEGTORAD), y + 300 * Sin( 250* bj_DEGTORAD)))
	elseif c == 14 then
		call DestroyEffect(AddSpecialEffect(s, x + 300 * Cos( 225* bj_DEGTORAD), y + 300 * Sin( 225* bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos( 200* bj_DEGTORAD), y + 350 * Sin( 200* bj_DEGTORAD)))
	elseif c == 15 then
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos( 180* bj_DEGTORAD), y + 350 * Sin( 180* bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 400 * Cos( 160* bj_DEGTORAD), y + 400 * Sin( 160* bj_DEGTORAD)))
	elseif c == 16 then
		call DestroyEffect(AddSpecialEffect(s, x + 400 * Cos( 130* bj_DEGTORAD), y + 400 * Sin( 130* bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 400 * Cos(110 * bj_DEGTORAD), y + 400 * Sin(110 * bj_DEGTORAD)))
	elseif c == 17 then
		call DestroyEffect(AddSpecialEffect(s, x + 400 * Cos(90 * bj_DEGTORAD), y + 400 * Sin(90 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 400 * Cos(70 * bj_DEGTORAD), y + 400 * Sin(70 * bj_DEGTORAD)))
	elseif c == 18 then
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos(45 * bj_DEGTORAD), y + 350 * Sin(45 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos(30 * bj_DEGTORAD), y + 350 * Sin(30 * bj_DEGTORAD)))
	elseif c == 19 then
		call DestroyEffect(AddSpecialEffect(s, x + 250* Cos(0 * bj_DEGTORAD), y + 250* Sin(0 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 250* Cos(345 * bj_DEGTORAD), y + 250* Sin(345 * bj_DEGTORAD)))
	elseif c == 20 then
		call DestroyEffect(AddSpecialEffect(s, x + 150* Cos(330 * bj_DEGTORAD), y + 150* Sin(330 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 100 * Cos(300 * bj_DEGTORAD), y + 100 * Sin(300 * bj_DEGTORAD)))
	elseif c == 21 then
		call DestroyEffect(AddSpecialEffect(s, x + 50 * Cos(275 * bj_DEGTORAD), y + 50 * Sin(275 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 0 * Cos( 250* bj_DEGTORAD), y + 0 * Sin( 250* bj_DEGTORAD)))
	elseif c == 22 then
		call DestroyEffect(AddSpecialEffect(s, x - 100 * Cos( 225* bj_DEGTORAD), y - 100 * Sin( 225* bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x  -150* Cos( 200* bj_DEGTORAD), y  -150* Sin( 200* bj_DEGTORAD)))
	elseif c == 23 then
		call DestroyEffect(AddSpecialEffect(s, x  -200* Cos(175 * bj_DEGTORAD), y  -200* Sin(175 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x  -250* Cos( 150* bj_DEGTORAD), y  -250* Sin( 150* bj_DEGTORAD)))
	elseif c == 24 then
		call DestroyEffect(AddSpecialEffect(s, x  -250* Cos( 180* bj_DEGTORAD), y  -250* Sin( 180* bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x -300 * Cos( 180* bj_DEGTORAD), y -300 * Sin( 180* bj_DEGTORAD)))
	elseif c == 25 then
		call DestroyEffect(AddSpecialEffect(s, x -350 * Cos(270 * bj_DEGTORAD), y -350 * Sin(270 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x -400 * Cos(270 * bj_DEGTORAD), y -400 * Sin(270 * bj_DEGTORAD)))
	elseif c == 26 then
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos(90 * bj_DEGTORAD), y + 350 * Sin(90 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 400 * Cos(90 * bj_DEGTORAD), y + 400 * Sin(90 * bj_DEGTORAD)))
	endif
	if c > 26 then
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	else
		call SaveInteger(HY, h, 0, c)
	endif
	set t = null
endfunction
function LBR takes real x, real y returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveReal(HY, h, 10, x)
	call SaveReal(HY, h, 11, y)
	call TimerStart(t, .1, true, function LNR)
	set t = null
endfunction
function LCR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local effect fx = LoadEffectHandle(HY, h, 1)
	local real damageValue = LoadReal(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	local group g = AllocationGroup(158)
	local real x = LoadReal(HY, h, 10)
	local real y = LoadReal(HY, h, 11)
	local unit u2
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', x, y, 0)
	call A5X(VX, x, y)
	call UnitAddAbility(d,'A450')
	call SetUnitAbilityLevel(d,'A450', level)
	call IssuePointOrderById(d, 852592, x, y)
	set d = null
	set U2 = u
	call GroupEnumUnitsInRange(g, x, y, 625, Condition(function DHX))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call UnitDamageTargetEx(u, u2, 3, damageValue)
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\BloodRiteTarget.mdx", u2, "chest"))
		call GroupRemoveUnit(g, u2)
	endloop
	call DestroyEffect(fx)
	call DeallocateGroup(g)
	set g = null
	set fx = null
	set t = null
	set u = null
endfunction
function FFE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A44Z')
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local effect fx = AddSpecialEffect("war3mapImported\\Bloodrite.mdx", x, y)
	call A8X(GetOwningPlayer(u), 2.5, x, y, 300)
	call A5X(ZE, x, y)
	call TimerStart(t, 2.6, false, function LCR)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveReal(HY, h, 0, level * 40 + 80)
	call SaveInteger(HY, h, 0, level)
	call SaveEffectHandle(HY, h, 1, fx)
	call SaveReal(HY, h, 10, x)
	call SaveReal(HY, h, 11, y)
	call LBR(x, y)
	set t = null
	set fx = null
	set u = null
endfunction
function LDR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit LFR = null
	local real WOV
	if GetTriggerEventId() == EVENT_PLAYER_UNIT_DEATH then
		set LFR = GetKillingUnit()
		if GetUnitAbilityLevel(LFR,'Aloc')> 0 or GetUnitAbilityLevel(LFR,'A04R')> 0 or GetUnitTypeId(LFR) == 'e00E'then
			set LFR = Player__Hero[GetPlayerId(GetOwningPlayer(LFR))]
		endif
		if GetKillingUnit() == u then
			if GetUnitAbilityLevel(u,'A44Y')> 0 then
				if UnitAlive(u) and IsUnitIllusion(GetTriggerUnit()) == false and IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE) == false and GetTriggerUnit()!= Roshan then
					call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HeroBloodElfBlood.mdl", u, "overhead"))
					call SetWidgetLife(u, GetWidgetLife(u)+ GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE)* .2)
				endif
			endif
		elseif GetTriggerUnit() == u then
			if GetUnitAbilityLevel(u,'A44Y')> 0 then
				set LFR = GetKillingUnit()
				if GetUnitAbilityLevel(LFR,'Aloc')> 0 or GetUnitAbilityLevel(LFR,'A04R')> 0 or GetUnitTypeId(LFR) == 'e00E'then
					set LFR = Player__Hero[GetPlayerId(GetOwningPlayer(LFR))]
				endif
				if UnitIsDead(LFR) == false and IsUnitIllusion(u) == false and u != Roshan and IsUnitType(LFR, UNIT_TYPE_STRUCTURE) == false then
					call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HeroBloodElfBlood.mdl", LFR, "overhead"))
					call SetWidgetLife(LFR, GetWidgetLife(LFR)+ GetUnitState(u, UNIT_STATE_MAX_LIFE)*(.2))
				endif
				set LFR = null
			endif
			call UnitRemoveAbility(u,'A44Y')
			call UnitRemoveAbility(u,'B44Y')
			call FlushChildHashtable(HY, h)
			call RemoveSavedHandle(ObjectHashTable, GetHandleId(u),'A2X9')
			call RemoveSavedReal(HY, GetHandleId(u),'A2X9')
			call CleanCurrentTrigger(t)
		endif
		set LFR = null
	elseif GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if LoadBoolean(HY, h, 0) == false then
			call SaveBoolean(HY, h, 0, true)
			set WOV = GetEventDamage()* LoadReal(HY, h, 10)
			call UnitDamageTargetEx(GetEventDamageSource(), GetTriggerUnit(), 3, WOV)
			call SaveBoolean(HY, h, 0, false)
		endif
	else
		set WOV = LoadReal(HY, h, 1)
		if WOV < GetGameTime() or GetUnitAbilityLevel(u,'A44Y') == 0 then
			call UnitRemoveAbility(u,'A44Y')
			call UnitRemoveAbility(u,'B44Y')
			call FlushChildHashtable(HY, h)
			call RemoveSavedHandle(ObjectHashTable, GetHandleId(u),'A2X9')
			call RemoveSavedReal(HY, GetHandleId(u),'A2X9')
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set u = null
	return false
endfunction
function LGR takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())
	local real SYV = 8 + level
	local real LHR = .15 + .05 * level
	local trigger t
	local integer h
	local real LJR
	if HaveSavedHandle(ObjectHashTable, GetHandleId(targetUnit),'A2X9') then
		set t = LoadTriggerHandle(ObjectHashTable, GetHandleId(targetUnit),'A2X9')
		set h = GetHandleId(t)
		set LJR = LoadReal(HY, h, 10)
		if LJR != LHR then
			call SaveReal(HY, h, 10, LHR)
			call SaveReal(HY, GetHandleId(targetUnit),'A2X9', LHR)
		endif
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .1, true)
		call SaveUnitHandle(HY, h, 0, targetUnit)
		call SaveTriggerHandle(ObjectHashTable, GetHandleId(targetUnit),'A2X9', t)
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
		call TriggerAddCondition(t, Condition(function LDR))
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
		call SaveReal(HY, GetHandleId(targetUnit),'A2X9', LHR)
		call SaveReal(HY, h, 10, LHR)
	endif
	call UnitAddPermanentAbility(targetUnit,'A44Y')
	call SetUnitAbilityLevel(targetUnit,'A44Y', level)
	call SaveReal(HY, h, 1, SYV + GetGameTime())
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function FDE takes nothing returns nothing
	if IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) or not UnitHasSpellShield(GetSpellTargetUnit()) then
		call LGR()
	endif
endfunction
function LKR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	local group g
	local unit u2
	local real damageValue
	if UnitIsDead(u) then
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	else
		set g = AllocationGroup(159)
		set U2 = u
		set damageValue =(level * 15+ 10.)/ 2.
		call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 175, Condition(function DJX))
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			call GroupRemoveUnit(g, u2)
			if LoadInteger(HY, GetHandleId(u2),'frwl')!= 1 then
				call EPX(u2,'frwl', .49)
				call UnitAddAbilityToTimed(u2,'A452', 1, 1,'B452')
				call UnitDamageTargetEx(u, u2, 1, damageValue)
			endif
		endloop
		call DeallocateGroup(g)
	endif
	set t = null
endfunction
function LLR takes unit d, integer level returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .5, true, function LKR)
	call SaveUnitHandle(HY, h, 0, d)
	call SaveInteger(HY, h, 0, level)
	set t = null
endfunction
function FGE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u, GetSpellAbilityId())
	local unit dummyUnit
	local integer i = 0
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real LMR = 12
	loop
		set dummyUnit = CreateUnit(GetOwningPlayer(u),'ho03', x + 450 * Cos(LMR * i), y + 450 * Sin(LMR * i), 0)
		call LLR(dummyUnit, level)
		call UnitApplyTimedLife(dummyUnit,'BTLF', 5)
		call SetUnitX(dummyUnit, x + 450 * Cos( 15* i))
		call SetUnitY(dummyUnit, y + 450 * Sin( 15* i))
		set i = i + 1
	exitwhen i * LMR > 360
	endloop
	set u = null
	set dummyUnit = null
endfunction
function JUE takes nothing returns nothing
	call DestroyEffect(AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire2.mdl", GetTriggerUnit(), "left hand"))
	call DestroyEffect(AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire2.mdl", GetTriggerUnit(), "weapon"))
endfunction
function FJE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A454')
	local unit u2
	local group g = AllocationGroup(160)
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", x, y))
	call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", x, y))
	set U2 = u
	call GroupEnumUnitsInRange(g, x, y, 350 + 25, Condition(function DJX))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call UnitDamageTargetEx(u, u2, 1, 100 * level)
		call CommonUnitAddStun(u2, level * 1., false)
		call GroupRemoveUnit(g, u2)
	endloop
	call DeallocateGroup(g)
	set u = null
	set u2 = null
endfunction
function LPR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call DestroyEffect(LoadEffectHandle(HY, h, 0))
	call DestroyEffect(LoadEffectHandle(HY, h, 1))
	call DestroyEffect(LoadEffectHandle(HY, h, 2))
	call DestroyEffect(LoadEffectHandle(HY, h, 3))
	call DestroyEffect(LoadEffectHandle(HY, h, 4))
	call DestroyEffect(LoadEffectHandle(HY, h, 5))
	call FlushChildHashtable(HY, h)
	call DestroyTrigger(t)
	set t = null
	return false
endfunction
function S1E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterTimerEvent(t, 1.2, false)
	call TriggerAddCondition(t, Condition(function LPR))
	call SaveEffectHandle(HY, h, 0, AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl", u, "hand right"))
	call SaveEffectHandle(HY, h, 1, AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlameStrike\\FlameStrikeEmbers.mdl", u, "hand right"))
	call SaveEffectHandle(HY, h, 2, AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl", u, "weapon left"))
	call SaveEffectHandle(HY, h, 3, AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlameStrike\\FlameStrikeEmbers.mdl", u, "weapon left"))
	call SaveEffectHandle(HY, h, 4, AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlameStrike\\FlameStrikeEmbers.mdl", u, "right foot"))
	call SaveEffectHandle(HY, h, 5, AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlameStrike\\FlameStrikeEmbers.mdl", u, "left foot"))
	set t = null
	set u = null
endfunction
function LQR takes nothing returns nothing
	call UnitAddStateBonus(GetEnumUnit(), LoadInteger(HY, GetHandleId(GetEnumUnit()),'MDMG'), UNIT_BONUS_ATTACK)
endfunction
function LSR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer damageValue
	local integer level = LoadInteger(HY, h, 0)
	local real LTR
	local group g = LoadGroupHandle(HY, h, 100)
	local unit u2
	local group gg
	if LoadBoolean(HY, h, 0) == false and GetTriggerEventId() == EVENT_UNIT_ATTACKED then
		set damageValue = LoadInteger(HY, GetHandleId(GetAttacker()),'MDMG')+ 5 + 5 * level
		call UnitReduceStateBonus(GetAttacker(), 5 + 5 * level, UNIT_BONUS_ATTACK)
		call SaveInteger(HY, GetHandleId(GetAttacker()),'MDMG', damageValue)
		call GroupAddUnit(g, GetAttacker())
	elseif LoadBoolean(HY, h, 0) == false and GetGameTime()> LoadReal(HY, h, 0) or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call SaveBoolean(HY, h, 0, true)
		call SaveInteger(HY, h,-1, 5 * 4)
		call DestroyEffect(LoadEffectHandle(HY, h, 1))
		call DestroyEffect(LoadEffectHandle(HY, h, 2))
		call DestroyEffect(LoadEffectHandle(HY, h, 3))
		call DestroyEffect(LoadEffectHandle(HY, h, 4))
		call DestroyEffect(LoadEffectHandle(HY, h, 5))
		call DestroyEffect(LoadEffectHandle(HY, h, 6))
		call DestroyEffect(LoadEffectHandle(HY, h, 7))
		call DestroyEffect(LoadEffectHandle(HY, h, 8))
	elseif LoadBoolean(HY, h, 0) then
		call SaveInteger(HY, h,-1, LoadInteger(HY, h,-1)-1)
		if LoadInteger(HY, h,-1)<= 0 then
			call ForGroup(g, function LQR)
			call DeallocateGroup(g)
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		endif
	else
		set gg = AllocationGroup(161)
		set U2 = u
		call GroupEnumUnitsInRange(gg, GetUnitX(u), GetUnitY(u), 350 + 25, Condition(function DHX))
		set LTR =(level * 25 + 50)/ 5
		loop
			set u2 = FirstOfGroup(gg)
		exitwhen u2 == null
			call UnitDamageTargetEx(u, u2, 1, LTR)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\ImmolationRed\\ImmolationRedDamage.mdl", u2, "chest"))
			call GroupRemoveUnit(gg, u2)
		endloop
		call DeallocateGroup(gg)
	endif
	set g = null
	set u = null
	set t = null
	return false
endfunction
function FHE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u, GetSpellAbilityId())
	local group g = AllocationGroup(162)
	local string ss = "Objects\\Spawnmodels\\Other\\FlameThrower\\FlameThrowerSpawnObj.mdl"
	local string s = "Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl"
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ATTACKED)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveGroupHandle(HY, h, 100, g)
	call SaveInteger(HY, h, 0, level)
	call SaveReal(HY, h, 0, GetGameTime()+ 14)
	call SaveEffectHandle(HY, h, 1, AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl", u, "origin"))
	call DestroyEffect(AddSpecialEffectTarget(ss, u, "weapon"))
	call DestroyEffect(AddSpecialEffectTarget(ss, u, "hand left"))
	call DestroyEffect(AddSpecialEffectTarget(ss, u, "hand right"))
	call DestroyEffect(AddSpecialEffectTarget(ss, u, "foot left"))
	call DestroyEffect(AddSpecialEffectTarget(ss, u, "foot right"))
	call DestroyEffect(AddSpecialEffectTarget(ss, u, "head"))
	call DestroyEffect(AddSpecialEffectTarget(ss, u, "chest"))
	call SaveEffectHandle(HY, h, 2, AddSpecialEffectTarget(s, u, "weapon"))
	call SaveEffectHandle(HY, h, 3, AddSpecialEffectTarget(s, u, "hand left"))
	call SaveEffectHandle(HY, h, 4, AddSpecialEffectTarget(s, u, "hand right"))
	call SaveEffectHandle(HY, h, 5, AddSpecialEffectTarget(s, u, "foot left"))
	call SaveEffectHandle(HY, h, 6, AddSpecialEffectTarget(s, u, "foot right"))
	call SaveEffectHandle(HY, h, 7, AddSpecialEffectTarget(s, u, "head"))
	call SaveEffectHandle(HY, h, 8, AddSpecialEffectTarget(s, u, "chest"))
	call TriggerAddCondition(t, Condition(function LSR))
	set t = null
	set u = null
endfunction
function LUR takes nothing returns nothing
	local group g
	local unit u
	local real a
	local integer level
	local real damageValue = 0
	local integer probability
	local real x
	local real y
	set level = GetUnitAbilityLevel(DESource,'A455')
	if IsUnitType(DESource, UNIT_TYPE_MELEE_ATTACKER) then
		set probability = level * 5 + 20
	else
		set probability = level * 5 + 5
	endif
	if TKV(DESource,'A455', probability) then
		set a = AngleBetweenUnit(DESource, DETarget)
		set g = AllocationGroup(163)
		set U2 = DESource
		set x = GetUnitX(DETarget)+ 250* Cos(a * bj_DEGTORAD)
		set y = GetUnitY(DETarget)+ 250* Sin(a * bj_DEGTORAD)
		call GroupEnumUnitsInRange(g, x, y, 275, Condition(function DHX))
		call GroupAddUnit(g, DETarget)
		if IsUnitType(DETarget, UNIT_TYPE_HERO) then
			set damageValue = GetHeroStr(DETarget, true)+ GetHeroAgi(DETarget, true)+ GetHeroInt(DETarget, true)+ GetHeroStr(DESource, true)+ GetHeroAgi(DESource, true)+ GetHeroInt(DESource, true)
			set damageValue = damageValue / 2
		else
			set damageValue = GetHeroStr(DESource, true)+ GetHeroAgi(DESource, true)+ GetHeroInt(DESource, true)
		endif
		call KillUnit(CreateUnit(GetOwningPlayer(DESource),'h02I', GetUnitX(DETarget), GetUnitY(DETarget), 0))
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			call DestroyEffect(AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire2.mdl", u, "origin"))
			call UnitDamageTargetEx(DESource, u, 1, damageValue)
			call GroupRemoveUnit(g, u)
		endloop
		call DeallocateGroup(g)
		set g = null
		set u = null
	endif
endfunction
function LWR takes nothing returns nothing
	if GetUnitAbilityLevel(DESource,'A455')> 0 and GetUnitAbilityLevel(DESource,'A36D') == 0 then
		call LUR()
	endif
endfunction
function LYR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	call SetUnitAnimationByIndex(whichUnit, 8)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction
function LZR takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SetUnitAnimationByIndex(whichUnit, 7)
	call TriggerRegisterTimerEvent(t, 2.5, false)
	call TriggerAddCondition(t, Condition(function LYR))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	set t = null
	set whichUnit = null
endfunction
function L_R takes nothing returns nothing
	if GetUnitTypeId(GetTriggerUnit())=='N0M0' then
		call LZR()
	endif
endfunction
function L0R takes nothing returns nothing
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\ChimaeraLightningMissile\\ChimaeraLightningMissile.mdl", GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit())))
	call UnitDamageTargetEx(HQV, GetEnumUnit(), 1, HSV)
endfunction
function L1R takes nothing returns boolean
	local trigger t2 = GetTriggeringTrigger()
	local integer DOO = GetHandleId(t2)
	local trigger t1 =(LoadTriggerHandle(HY,(DOO), 9))
	local integer L2R = GetHandleId(t1)
	local unit L3R =(LoadUnitHandle(HY,(DOO), 8))
	local group g
	local integer level =(LoadInteger(HY,(DOO), 5))
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		call ShowUnit(L3R, false)
		call KillUnit(L3R)
		call FlushChildHashtable(HY,(L2R))
		call CleanCurrentTrigger(t1)
		call FlushChildHashtable(HY,(DOO))
		call CleanCurrentTrigger(t2)
	elseif IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(L3R)) and IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE) == false and GetUnitAbilityLevel(GetTriggerUnit(),'A04R') == 0 then
		set g = AllocationGroup(164)
		set U2 = L3R
		set HQV = L3R
		set HSV = 100 + 40 * level
		call GroupEnumUnitsInRange(g, GetUnitX(L3R), GetUnitY(L3R), 285, Condition(function DHX))
		call ForGroup(g, function L0R)
		call DeallocateGroup(g)
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\Bolt\\BoltImpact.mdl", GetUnitX(L3R), GetUnitY(L3R)))
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\Bolt\\BoltImpact.mdl", GetUnitX(L3R), GetUnitY(L3R)))
		call ShowUnit(L3R, false)
		call KillUnit(L3R)
		call FlushChildHashtable(HY,(L2R))
		call CleanCurrentTrigger(t1)
		call FlushChildHashtable(HY,(DOO))
		call CleanCurrentTrigger(t2)
	endif
	set t1 = null
	set t2 = null
	set L3R = null
	set g = null
	return false
endfunction
function L4R takes nothing returns boolean
	local trigger t1 = GetTriggeringTrigger()
	local integer L2R = GetHandleId(t1)
	local trigger t2
	local integer DOO
	local unit L3R
	local integer level
	local real x =(LoadReal(HY,(L2R), 6))
	local real y =(LoadReal(HY,(L2R), 7))
	local real BXR
	local integer count = GetTriggerEvalCount(t1)
	if count == 1 then
		call DestroyEffect((LoadEffectHandle(HY,(L2R), 3)))
	elseif count == 2 then
		call DestroyEffect((LoadEffectHandle(HY,(L2R), 4)))
		set t2 = CreateTrigger()
		set DOO = GetHandleId(t2)
		set level =(LoadInteger(HY,(L2R), 5))
		set BXR =(LoadReal(HY,(L2R), 1))
		set L3R = CreateUnit(GetOwningPlayer((LoadUnitHandle(HY,(L2R), 2))),'h07F', x, y, BXR)
		call SetUnitVertexColor(L3R, 255, 255, 255, 100)
		call UnitApplyTimedLife(L3R,'BTLF', 12)
		call SaveUnitHandle(HY,(L2R), 8,(L3R))
		call SaveUnitHandle(HY,(DOO), 8,(L3R))
		call SaveTriggerHandle(HY,(DOO), 9,(t1))
		call SaveInteger(HY,(DOO), 5,(level))
		call TriggerRegisterUnitInRange(t2, L3R, 235, null)
		call TriggerRegisterUnitEvent(t2, L3R, EVENT_UNIT_DEATH)
		call TriggerAddCondition(t2, Condition(function L1R))
		call DestroyEffect(AddSpecialEffectTarget("effects\\ManaFlareBoltImpact_NoSound.mdx", L3R, "origin"))
	elseif count > 2 then
		set L3R =(LoadUnitHandle(HY,(L2R), 8))
		call DestroyEffect(AddSpecialEffectTarget("effects\\ManaFlareBoltImpact_NoSound.mdx", L3R, "origin"))
	endif
	set t1 = null
	set t2 = null
	set L3R = null
	return false
endfunction
function ZGV takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t1 = CreateTrigger()
	local integer L2R = GetHandleId(t1)
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	call TriggerRegisterTimerEvent(t1, .5, true)
	call TriggerAddCondition(t1, Condition(function L4R))
	call SaveReal(HY,(L2R), 6,((x)* 1.))
	call SaveReal(HY,(L2R), 7,((y)* 1.))
	call SaveInteger(HY,(L2R), 5,(GetUnitAbilityLevel(whichUnit,'A14P')))
	call SaveUnitHandle(HY,(L2R), 2,(whichUnit))
	call SaveReal(HY,(L2R), 1,((GetUnitFacing(whichUnit))* 1.))
	call SaveEffectHandle(HY,(L2R), 3,(AddSpecialEffect("Abilities\\Spells\\Orc\\LightningShield\\LightningShieldTarget.mdl", x, y)))
	call SaveEffectHandle(HY,(L2R), 4,(AddSpecialEffect("effects\\Static_Remnant_FX.mdx", x, y)))
	set whichUnit = null
	set t1 = null
endfunction
function L5R takes nothing returns nothing
	call UnitDamageTargetEx(HTV, GetEnumUnit(), 1, HUV)
	call UnitAddAbilityToTimed(GetEnumUnit(),'A335', 1, .6,'B08B')
endfunction
function L6R takes unit whichUnit, unit targetUnit returns nothing
	local integer h = GetHandleId(whichUnit)
	local group g = AllocationGroup(165)
	call DestroyEffect((LoadEffectHandle(HY, h, 200)))
	call DestroyEffect((LoadEffectHandle(HY, h, 201)))
	call SaveInteger(HY,(GetHandleId((whichUnit))),(4264), 2)
	set U2 = whichUnit
	set HTV = whichUnit
	set HUV = GetUnitAbilityLevel(whichUnit,'A0QW')* 20 + 10
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 300, Condition(function DHX))
	call ForGroup(g, function L5R)
	call DeallocateGroup(g)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl", GetUnitX(targetUnit), GetUnitY(targetUnit)))
	set g = null
endfunction
function L7R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local trigger L8R =(LoadTriggerHandle(HY, h, 202))
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamageSource() == whichUnit and((LoadInteger(HY,(GetHandleId((whichUnit))),(4264))) == 1) then
			call DisableTrigger(t)
			call L6R(whichUnit, targetUnit)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call FlushChildHashtable(HY,(GetHandleId(L8R)))
			call CleanCurrentTrigger(L8R)
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	set whichUnit = null
	set L8R = null
	return false
endfunction
function L9R takes nothing returns nothing
	local trigger t = CreateTrigger()
	local unit targetUnit = GetTriggerUnit()
	local unit whichUnit = GetAttacker()
	local integer h = GetHandleId(t)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerRegisterTimerEvent(t, 2.5, false)
	call TriggerAddCondition(t, Condition(function L7R))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveTriggerHandle(HY, h, 202,(GetTriggeringTrigger()))
	set t = null
	set targetUnit = null
	set whichUnit = null
endfunction
function MVR takes nothing returns boolean
	if GetAttacker()==(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 2)) and IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE) == false and IsUnitAlly(GetAttacker(), GetOwningPlayer(GetTriggerUnit())) == false then
		call L9R()
	endif
	return false
endfunction
function MER takes nothing returns nothing
	local trigger t = CreateTrigger()
	local unit whichUnit = GetTriggerUnit()
	local integer h = GetHandleId(whichUnit)
	local string fx = ""
	if IsUnitAlly(whichUnit, LocalPlayer) or IsObserverPlayer(LocalPlayer) then
		set fx = "Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl"
	endif
	call SaveEffectHandle(HY, h, 200,(AddSpecialEffectTarget(fx, whichUnit, "right hand")))
	call SaveEffectHandle(HY, h, 201,(AddSpecialEffectTarget(fx, whichUnit, "left hand")))
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerAddCondition(t, Condition(function MVR))
	call SaveUnitHandle(HY,(GetHandleId(t)), 2,(whichUnit))
	set t = null
	set whichUnit = null
endfunction
function MXR takes nothing returns boolean
	local integer WTV = GetSpellAbilityId()
	if (WTV =='A14O' or WTV =='A3FJ' or WTV =='A0SB' or X8R(WTV)) and(LoadInteger(HY, GetHandleId(GetTriggerUnit()), 4264)!= 1) and GetUnitAbilityLevel(GetTriggerUnit(),'A36D') == 0 and IsNotItemAbility(WTV) then
		call SaveInteger(HY, GetHandleId(GetTriggerUnit()), 4264, 1)
		call MER()
	endif
	return false
endfunction
function MZE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function MXR))
	set whichUnit = null
	set t = null
endfunction
function MOR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 17))
	local real a =(LoadReal(HY, h, 13))
	local real x = GetUnitX(u)-5 * Cos(a)
	local real y = GetUnitY(u)-5 * Sin(a)
	local integer lv =(LoadInteger(HY, h, 5))
	local real x0 =(LoadReal(HY, h, 6))
	local real y0 =(LoadReal(HY, h, 7))
	if ((x0 -x)*(x0 -x))+((y0 -y)*(y0 -y))< 100  then
		set x = x0
		set y = y0
	endif
	call SetUnitX(u, x)
	call SetUnitY(u, y)
	if GetTriggerEvalCount(t)==( 10+ 10* lv) or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	return false
endfunction

function MRR takes unit u, unit target, real x, real y, integer lv returns nothing
	local unit d = null
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	if IsUnitType(target, UNIT_TYPE_HERO) then
		set d = CreateUnit(GetOwningPlayer(target),'u00X', x, y, GetUnitFacing(u))
	else
		set d = CreateUnit(GetOwningPlayer(u),'u00X', x, y, GetUnitFacing(u))
	endif
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterDeathEvent(t, target)
	call TriggerAddCondition(t, Condition(function MOR))
	call SaveUnitHandle(HY, h, 17,(target))
	call SaveReal(HY, h, 13,((Atan2(GetUnitY(target)-y, GetUnitX(target)-x))* 1.))
	call SaveInteger(HY, h, 5,(lv))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call UnitAddPermanentAbility(d,'A14Q')
	call SetUnitAbilityLevel(d,'A14Q', lv)
	if GetUnitAbilityLevel(target,'B0AD') == 1 then
		call UnitRemoveAbility(target, 'B0AD' )
	endif
	call IssueTargetOrderById(d, 852480, target)
	call UnitApplyTimedLife(d,'BTLF', 1 + .5 * lv)
	set d = null
	set t = null
endfunction

function UNOO takes nothing returns boolean
	return IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and IsAliveNotStrucNotWard(GetFilterUnit()) and not IsUnitMagicImmune(GetFilterUnit())
endfunction

// 电子涡流
function ElectricVortex takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer lv
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local unit d
	local group g = null
	// 如果是马甲放的 那就设置为主人单位
	if GetUnitAbilityLevel(u,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(u), 0) then
		set u = LoadUnitHandle(HY, GetHandleId(u), 0)
	endif
	// 在过滤马甲单位后再获取技能等级 否则会导致多重施法失败
	set lv = GetUnitAbilityLevel(u,'A14R')
	if lv == 0 then
		set lv = GetUnitAbilityLevel(u,'A3WT')
		set g = AllocationGroup(166)
		set U2 = u
		call GroupEnumUnitsInRange(g, x, y, 275. + lv * 50., Condition(function UNOO))
		loop
			set d = FirstOfGroup(g)
		exitwhen d == null
			if GetUnitTypeId(d)!='n00L' then
				call MRR(u, d, x, y, lv)
				call UnitDamageTargetEx(u, d, 1, lv * 40 + 40)
			endif
			call GroupRemoveUnit(g, d)
		endloop
		call DeallocateGroup(g)
		set g = null
	else
		set d = GetSpellTargetUnit()
		if GetUnitTypeId(d)!='n00L' and UnitHasSpellShield(d) == false then
			call MRR(u, d, x, y, lv)
			call UnitDamageTargetEx(u, d, 1, lv * 40 + 40)
		endif
	endif
	set u = null
	set d = null
endfunction

function KDE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real mp = GetUnitState(u, UNIT_STATE_MANA)
	local real MFR
	if GetSpellAbilityId()=='A3FJ'then
		set MFR = 15+ .05 * GetUnitState(u, UNIT_STATE_MAX_MANA)
	else
		set MFR = 30 + .08 * GetUnitState(u, UNIT_STATE_MAX_MANA)
	endif
	if mp < MFR then
		call EXStopUnit(u)
		call InterfaceErrorForPlayer(GetOwningPlayer(u), GetObjectName('n0G8'))
	elseif IsUnitType(u, UNIT_TYPE_SNARED) then
		call EXStopUnit(u)
		call InterfaceErrorForPlayer(GetOwningPlayer(u), GetObjectName('n0ZD'))
	endif
	set u = null
endfunction
function MGR takes nothing returns nothing
	call SetUnitPathing(GetEnumUnit(), true)
	if IsUnitEnemy(GetEnumUnit(), GetOwningPlayer(MA)) then
		call UnitDamageTargetEx(MA, GetEnumUnit(), 1, QA)
		call UnitAddAbilityToTimed(GetEnumUnit(),'A3B7', 1, 1.,'B3B7')
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl", GetEnumUnit(), "origin"))
	endif
endfunction
function MHR takes nothing returns nothing
	call SetUnitPosition(GetEnumUnit(), GetUnitX(GetEnumUnit())+ 40 * Cos(LA), GetUnitY(GetEnumUnit())+ 40 * Sin(LA))
	call KillTreeByCircle(GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()), 200)
	call SetUnitPathing(GetEnumUnit(), false)
endfunction
function MJR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local real a = LoadReal(HY, h, 0)
	local integer c = LoadInteger(HY, h, 0)-1
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local group g = null
	if c < 1 or GetDistanceBetween(x, y, LoadReal(HY, h, 1), LoadReal(HY, h, 2))< 50 then
		set MA = whichUnit
		set QA = LoadInteger(HY, h, 5)* 50 + 50
		set g = AllocationGroup(168)
		set U2 = whichUnit
		call GroupEnumUnitsInRange(g, x, y, 275, Condition(function DHX))
		call GroupAddGroup(g, LoadGroupHandle(HY, h, 10))
		call ForGroup(LoadGroupHandle(HY, h, 10), function MGR)
		call DeallocateGroup(g)
		call KillTreeByCircle(x, y, 200)
		call DestroyLightning(LoadLightningHandle(HY, h, 11))
		call DeallocateGroup(LoadGroupHandle(HY, h, 10))
		call DestroyTimerAndFlushHT_HY(t)
	else
		set LA = a
		call ForGroup(LoadGroupHandle(HY, h, 10), function MHR)
		call MoveLightning(LoadLightningHandle(HY, h, 11), true, x, y, LoadReal(HY, h, 1), LoadReal(HY, h, 2))
		call SaveInteger(HY, h, 0, c)
	endif
	set whichUnit = null
	set t = null
endfunction
function MKR takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and UnitIsDead(GetFilterUnit()) == false)!= null
endfunction
function ERE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local real dx = GetSpellTargetX()
	local real dy = GetSpellTargetY()
	local real I3X = AngleBetweenXY(x, y, dx, dy)* bj_DEGTORAD
	local group g = AllocationGroup(169)
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local lightning l
	local real WOV = 800 + 200* GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())
	if GetDistanceBetween(x, y, dx, dy)> WOV then
		set dx = x + WOV * Cos(I3X)
		set dy = y + WOV * Sin(I3X)
	endif
	set l = AddLightning("CLPB", true, x, y, dx, dy)
	call SetLightningColor(l, .75, .75, 1, .75)
	call GroupEnumUnitsInRange(g, x, y, 350, Condition(function MKR))
	call TimerStart(t, .03, true, function MJR)
	call SaveInteger(HY, h, 0, R2I(GetDistanceBetween(x, y, dx, dy)/ 40)+ 1)
	call SaveReal(HY, h, 0, I3X)
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	call SaveGroupHandle(HY, h, 10, g)
	call SaveLightningHandle(HY, h, 11, l)
	call SaveUnitHandle(HY, h, 0, whichUnit)
	call SaveReal(HY, h, 1, dx)
	call SaveReal(HY, h, 2, dy)
	set l = null
	set t = null
	set whichUnit = null
	set g = null
endfunction
function MLR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	local unit damageSource = LoadUnitHandle(HY, GetHandleId(t), 1)
	local real damageValue = LoadReal(HY, GetHandleId(t), 0)
	call SetUnitInvulnerable(u, false)
	call UnitDamageTargetEx(damageSource, u, 2, damageValue)
	call DestroyTimerAndFlushHT_HY(t)
	set t = null
	set u = null
	set damageSource = null
endfunction
function MMR takes unit u, real MPR, unit damageSource returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, 0, false, function MLR)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveUnitHandle(HY, GetHandleId(t), 1, damageSource)
	call SaveReal(HY, GetHandleId(t), 0, MPR)
	call SetUnitInvulnerable(u, true)
	set t = null
endfunction
function MQR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	call UnitAddPermanentAbility(u,'A34D')
	call SaveInteger(HY, GetHandleId(u),'DEAT', 2)
	call DestroyTimerAndFlushHT_HY(t)
	set t = null
	set u = null
endfunction
function MSR takes unit u, real cd returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, cd, false, function MQR)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call UnitRemoveAbility(u,'A34D')
	call UnitRemoveAbility(u,'B0H7')
	call SaveInteger(HY, GetHandleId(u),'DEAT', 1)
	call IssueImmediateOrderById(u, 852478)
	set t = null
endfunction
function MTR takes nothing returns nothing
	local unit u
	local real damageValue
	local real YJX
	local real YVX
	local integer level
	local trigger t = GetTriggeringTrigger()
	local boolean b = false
	local real MUR
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		set u = GetTriggerUnit()
		set damageValue = GetEventDamage()
		set YJX = GetWidgetLife(u)
		if GetUnitAbilityLevel(u,'A36D') == 0 then
			set MUR = GetUnitState(u, UNIT_STATE_MAX_LIFE)
			if YJX / MUR > .2 and YJX > 300 then
				if damageValue >= YJX / 2 and UnitAlive(u) and GetUnitAbilityLevel(u,'B0H7') == 1 then
					set b = true
					call CommonTextTag(GetUnitName(u)+ " just Cheated Death!!", 5, u, .03, 255, 0, 0, 255)
					set level = GetUnitAbilityLevel(u,'A34A')
					if damageValue >= GetUnitState(u, UNIT_STATE_MAX_LIFE) then
						call MMR(u, damageValue *(.45 -0.05 * level), GetEventDamageSource())
					else
						call SetUnitToReduceDamage(u, damageValue *(.55 + .05 * level))
					endif
					call UnitDamageTargetEx(u, GetEventDamageSource(), 3, damageValue *(.55 + .05 * level))
					call UnitApplyTimedLife(CreateUnit(GetOwningPlayer(u),'h028', GetUnitX(u), GetUnitY(u), AngleBetweenXY(GetUnitX(u), GetUnitY(u), GetUnitX(GetEventDamageSource()), GetUnitY(GetEventDamageSource()))),'BTLF', .4)
					call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\DispelMagic\\DispelMagicTarget.mdl", u, "overhead"))
				endif
			elseif b == false and damageValue > 1000 then
				call SetUnitToReduceDamage(u, damageValue  -1000)
			endif
		endif
	endif
	set u = null
	set t = null
endfunction
function L3E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local trigger t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function MTR))
	call UnitAddPermanentAbility(u,'A34D')
	call SaveBoolean(HY, GetHandleId(t), 0, false)
	set t = null
	set u = null
endfunction
function F1E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer level = GetUnitAbilityLevel(u, GetSpellAbilityId())
	call MSR(u, 14-level)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerRegisterTimerEvent(t, 14-level, false)
	call TriggerAddCondition(t, Condition(function MTR))
	call UnitAddPermanentAbility(targetUnit,'A34D')
	call SaveUnitHandle(HY, GetHandleId(t), 0, targetUnit)
	call SaveBoolean(HY, GetHandleId(t), 0, true)
	set t = null
	set targetUnit = null
	set u = null
endfunction
function J7E takes nothing returns nothing
	if IsUnitIllusion(GetSpellTargetUnit()) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "不能用于幻象")
	endif
endfunction
function MWR takes unit whichUnit returns nothing
	local integer level = GetUnitAbilityLevel(whichUnit,'A2AI')
	call SetUnitAbilityLevel(whichUnit,'A0AR', level)
endfunction
function P8E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A2AI')
	if level == 1 then
		call UnitAddPermanentAbility(whichUnit,'A0AR')
	endif
	call MWR(whichUnit)
	set whichUnit = null
endfunction
function MYR takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamageSource() == LoadUnitHandle(HY, h, 0) then
			call CommonUnitAddStun(GetTriggerUnit(),(LoadReal(HY, h, 0)* .25)+ 2.25, false)
			call UnitDamageTargetEx(LoadUnitHandle(HY, h, 1), GetTriggerUnit(), 1, 25 * LoadReal(HY, h, 0))
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	endif
	set t = null
endfunction
function MZR takes nothing returns nothing
	local trigger t
	local integer h
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local unit d = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	call UnitAddAbility(d,'A42F')
	if IssueTargetOrderById(d, 852095, targetUnit) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 3.5, false)
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(t, Condition(function MYR))
		call SaveUnitHandle(HY, h, 0, d)
		call SaveUnitHandle(HY, h, 1, whichUnit)
		call SaveReal(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
		set t = null
	endif
	set d = null
	set whichUnit = null
	set targetUnit = null
endfunction
function ZKV takes nothing returns nothing
	local unit u = GetTriggerUnit()
	if GetUnitTypeId(u)=='H00G' or GetUnitTypeId(u)=='H00F' or GetUnitTypeId(u)=='H00E' then
		call SetUnitAnimation(u, "stand")
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Defend\\DefendCaster.mdl", u, "head"))
	elseif GetUnitTypeId(u)=='Hlgr' then
		call SetUnitAnimation(u, "stand defend")
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Defend\\DefendCaster.mdl", u, "origin"))
	endif
	set u = null
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call MZR()
	endif
endfunction
function PBX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A0AR')
	call AddAbilityIDToPreloadQueue('QB0G')
	call SetAllPlayerAbilityUnavailable('A389')
endfunction

// 刷新幻象的护甲 龙族血统
function SyncIllusionUnitDragonBlood takes nothing returns nothing
	local unit u = U2
	local integer lv = Q2
	call AddUnitState(u, UNIT_STATE_ARMOR, 3 * lv)
	set u = null
endfunction
function Q_E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A0CL')
	call AddUnitState(u, UNIT_STATE_ARMOR, 3)
	//call SetPlayerTechResearched(GetOwningPlayer(u),'R006', level)
	set u = null
endfunction

function M0R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	call MWR(whichUnit)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction
function M1R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	call MWR(whichUnit)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction
function L9X takes nothing returns nothing
	if GetUnitAbilityLevel(U2,'A0AR')> 0 or GetUnitAbilityLevel(U2,'QB0G')> 0 then
		call MWR(U2)
	endif
endfunction
function ZLV takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerAddCondition(t, Condition(function M0R))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerAddCondition(t, Condition(function M1R))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	set whichUnit = null
	set t = null
endfunction
function M2R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY,(h), 2))
	local unit target =(LoadUnitHandle(HY,(h), 17))
	local real r =(LoadReal(HY,(GetHandleId(target)),'A0O4'))
	call UnitDamageTargetEx(u, target, 1, 20)
	if (GetGameTime())>= r or UnitIsDead(target) then
		call RemoveSavedReal(HY, GetHandleId(target), 805)
		call UnitRemoveAbility(target,'A0O4')
		call UnitRemoveAbility(target,'B0O4')
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	set target = null
	return false
endfunction
function M3R takes unit R8X, unit targetUnit returns nothing
	local trigger t
	local integer h
	local real r =(LoadReal(HY,(GetHandleId(targetUnit)),'A0O4'))
	if r >(GetGameTime()) == false then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function M2R))
		call SaveUnitHandle(HY,(h), 2,(R8X))
		call SaveUnitHandle(HY,(h), 17,(targetUnit))
	endif
	call UnitAddPermanentAbility(targetUnit,'A0O4')
	call SaveReal(HY,(GetHandleId(targetUnit)),'A0O4',(((GetGameTime())+ 5)* 1.))
	set t = null
endfunction
function M4R takes nothing returns nothing
	local unit u = GetEnumUnit()
	if GetUnitTypeId(u)!='o01X' then
		call SetUnitPathing(u, true)
	endif
	call SaveInteger(HY,(GetHandleId((u))),(4336), 2)
	set u = null
endfunction
function M5R takes unit targetUnit returns nothing
	local unit d = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddAbility(d,'A2TG')
	call SetUnitAbilityLevel(d,'A2TG', EH)
	call IssueTargetOrderById(d, 852668, targetUnit)
	set d = null
endfunction
function M6R takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), NH) == false then
		call GroupAddUnit(NH, GetEnumUnit())
		call M5R(GetEnumUnit())
		if XH == 1 then
			call UnitDamageTargetEx(RH, GetEnumUnit(), 1, 50 * EH)
		endif
	endif
endfunction
function M7R takes nothing returns nothing
	local unit u = GetEnumUnit()
	local real I3X =(LoadReal(HY,(GetHandleId(u)), 801))
	local real N3X =(LoadReal(HY,(GetHandleId(u)), 802))
	local real M8R = BH + N3X * Cos(I3X)
	local real M9R = CH + N3X * Sin(I3X)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl", M8R, M9R))
	if GetUnitTypeId(u)=='o01X' or GetUnitTypeId(u)=='o020' then
		set XH = 1
		call SetUnitPosition(u, M8R, M9R)
		call SetUnitX(u, M8R)
		call SetUnitY(u, M9R)
	else
		call SetUnitX(u, M8R)
		call SetUnitY(u, M9R)
		call KillTreeByCircle(M8R, M9R, 100)
	endif
	set u = null
endfunction
function PVR takes nothing returns nothing
	local unit u = GetEnumUnit()
	if UnitIsDead(u) or((LoadInteger(HY,(GetHandleId((u))),(4306))) == 1) or GetUnitAbilityLevel(u,'B08V')> 0 or((LoadInteger(HY,(GetHandleId((u))),(4335))) == 1) then
		call GroupRemoveUnit(NH, u)
		call SaveInteger(HY,(GetHandleId((u))),(4336), 2)
		if GetUnitTypeId(u)!='o01X' then
			call SetUnitPathing(u, true)
		endif
	endif
	set u = null
endfunction
function PER takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local group g =(LoadGroupHandle(HY, h, 803))
	local real PXR =(LoadReal(HY, h, 6))
	local real POR =(LoadReal(HY, h, 7))
	local real PRR =(LoadReal(HY, h, 23))
	local real PIR =(LoadReal(HY, h, 24))
	local real I3X = bj_DEGTORAD * AngleBetweenXY(PRR, PIR, PXR, POR)
	local real PAR
	local real PNR
	local boolean b = false
	local group gg =(LoadGroupHandle(HY, h, 187))
	local group PBR
	set XH = 0
	set NH = g
	call ForGroup(g, function PVR)
	if GetTriggerEvalCount(t)> 200 or FirstOfGroup(g) == null then
		set b = true
	else
		set PAR = PRR + 1000* .03 * Cos(I3X)
		set PNR = PIR + 1000* .03 * Sin(I3X)
		if GetDistanceBetween(PAR, PNR, PXR, POR)< 30 then
			set PAR = PXR
			set PNR = POR
			set b = true
		endif
		set PAR = CoordinateX50(PAR)
		set PNR = CoordinateY50(PNR)
		set NH = g
		set BH = PAR
		set CH = PNR
		call ForGroup(g, function M7R)
		call SaveReal(HY, h, 23,((PAR)* 1.))
		call SaveReal(HY, h, 24,((PNR)* 1.))
		set PBR = AllocationGroup(170)
		set U2 = whichUnit
		set NH = gg
		set RH = whichUnit
		set EH = GetUnitAbilityLevel(whichUnit,'A2QI')
		call GroupEnumUnitsInRange(PBR, PAR, PNR, 205, Condition(function DJX))
		call ForGroup(PBR, function M6R)
		call DeallocateGroup(PBR)
		set PBR = null
	endif
	if b then
		call ForGroup(g, function M4R)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call DeallocateGroup(gg)
		call DeallocateGroup(g)
	endif
	set whichUnit = null
	set t = null
	set gg = null
	set g = null
	return false
endfunction
function PCR takes nothing returns boolean
	return GetUnitTypeId(GetFilterUnit())=='o01X' and GetOwningPlayer(GetFilterUnit()) == GetOwningPlayer(U2)
endfunction
function PDR takes nothing returns nothing
	local unit u = GetEnumUnit()
	call SetUnitPathing(u, false)
	call SaveInteger(HY,(GetHandleId((u))),(4336), 1)
	call SaveReal(HY,(GetHandleId(u)), 801,((bj_DEGTORAD * AngleBetweenXY(BH, CH, GetUnitX(u), GetUnitY(u)))* 1.))
	call SaveReal(HY,(GetHandleId(u)), 802,((GetDistanceBetween(BH, CH, GetUnitX(u), GetUnitY(u)))* 1.))
	set u = null
endfunction
function ZPV takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t
	local integer h
	local real PRR = GetUnitX(GetSpellTargetUnit())
	local real PIR = GetUnitY(GetSpellTargetUnit())
	local real PXR = GetUnitX(whichUnit)
	local real POR = GetUnitY(whichUnit)
	local real I3X = AngleBetweenXY(PXR, POR, PRR, PIR)
	local unit targetUnit = GetSpellTargetUnit()
	local group g
	if targetUnit == null then
		set g = AllocationGroup(171)
		set U2 = whichUnit
		call GroupEnumUnitsInRange(g, GetSpellTargetX(), GetSpellTargetY(), 265, Condition(function PCR))
		if FirstOfGroup(g) == null then
			call DeallocateGroup(g)
			set whichUnit = null
			set g = null
			return
		endif
		set targetUnit = FirstOfGroup(g)
		call DeallocateGroup(g)
	endif
	set g = AllocationGroup(172)
	call GroupAddUnit(g, targetUnit)
	set PRR = GetUnitX(targetUnit)
	set PIR = GetUnitY(targetUnit)
	set I3X = AngleBetweenXY(PXR, POR, PRR, PIR)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	set BH = PRR
	set CH = PIR
	call ForGroup(g, function PDR)
	set PXR = PXR + 100 * Cos(I3X * bj_DEGTORAD)
	set POR = POR + 100 * Sin(I3X * bj_DEGTORAD)
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function PER))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveReal(HY, h, 6,((PXR)* 1.))
	call SaveReal(HY, h, 7,((POR)* 1.))
	call SaveReal(HY, h, 23,((PRR)* 1.))
	call SaveReal(HY, h, 24,((PIR)* 1.))
	call SaveGroupHandle(HY, h, 187,(AllocationGroup(173)))
	call SaveGroupHandle(HY, h, 803,(g))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\MagneticGripTarget.mdx", targetUnit, "chest")))
	set whichUnit = null
	set t = null
	set g = null
	set targetUnit = null
endfunction
function KHE takes nothing returns nothing
	local unit targetUnit = GetSpellTargetUnit()
	local group g
	if targetUnit == null then
		set g = AllocationGroup(174)
		set U2 = GetTriggerUnit()
		call GroupEnumUnitsInRange(g, GetSpellTargetX(), GetSpellTargetY(), 265, Condition(function PCR))
		if FirstOfGroup(g) == null then
			call EXStopUnit(GetTriggerUnit())
			if IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) then
				call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "附近没有发现岩石")
			endif
		endif
		call DeallocateGroup(g)
	endif
	set g = null
	set targetUnit = null
endfunction
function PFR takes nothing returns boolean
	return(UnitIsDead(GetFilterUnit()) == false and IsUnitEnemy(LH, GetOwningPlayer(GetFilterUnit())) and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and((LoadInteger(HY,(GetHandleId((GetFilterUnit()))),(809))) == 1))!= null
endfunction
function PGR takes nothing returns nothing
	call CNX((GetEnumUnit()),'A2QN', 1, 2,'B0GK')
endfunction
function PHR takes unit targetUnit returns nothing
	local group g = AllocationGroup(175)
	if ((LoadInteger(HY,(GetHandleId((targetUnit))),(809))) == 1) then
		call GroupEnumUnitsInRange(g, 0, 0, 99999, Condition(function PFR))
	endif
	call GroupAddUnit(g, targetUnit)
	call ForGroup(g, function PGR)
	call DeallocateGroup(g)
	set g = null
endfunction
function PJR takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), KH) == false then
		call GroupAddUnit(KH, GetEnumUnit())
		if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
			set FH = true
			set MH = GetEnumUnit()
			if ((LoadInteger(HY,(GetHandleId((GetEnumUnit()))),(809))) == 1) then
				set PH = GetEnumUnit()
			endif
			if GH == 1 then
				call UnitDamageTargetEx(LH, GetEnumUnit(), 1, HH * 1.5)
				call PHR(GetEnumUnit())
			else
				call UnitDamageTargetEx(LH, GetEnumUnit(), 1, HH)
			endif
		else
			if GH == 1 then
				call UnitDamageTargetEx(LH, GetEnumUnit(), 1, HH * 1.5)
			else
				call UnitDamageTargetEx(LH, GetEnumUnit(), 1, HH)
			endif
		endif
	endif
endfunction
function PKR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local group g =(LoadGroupHandle(HY, h, 187))
	local group gg
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local real PLR = GetUnitX(whichUnit)
	local real PMR = GetUnitY(whichUnit)
	local real PPR = GetDistanceBetween(x, y, PLR, PMR)
	local real M8R
	local real M9R
	local real PQR =(LoadReal(HY, h, 137))
	local real N3X = 800
	local integer PSR =(LoadInteger(HY, h, 34))
	local real PTR =(LoadReal(HY, h, 138))
	local boolean b = false
	local unit targetUnit =(LoadUnitHandle(HY, h, 810))
	local integer c = GetTriggerEvalCount(t)
	set FH = false
	call SetUnitTimeScale(whichUnit, 3)
	call SetUnitFacing(whichUnit, PQR)
	call SetUnitAnimationByIndex(whichUnit, 0)
	if c > 30 then
		if PSR == 0 then
			set gg = AllocationGroup(176)
			set U2 = whichUnit
			call GroupEnumUnitsInRange(gg, PLR, PMR, 175, Condition(function PCR))
			if FirstOfGroup(gg)!= null then
				call KillUnit(FirstOfGroup(gg))
				set PSR = 1
				call SaveInteger(HY, h, 34,(PSR))
			endif
			call DeallocateGroup(gg)
		endif
		if PSR == 1 then
			set N3X = N3X * 2
		endif
		if targetUnit != null then
			set PQR = AngleBetweenUnit(whichUnit, targetUnit)
			call SaveReal(HY, h, 137,((PQR)* 1.))
		endif
		set M8R = x + .02 * N3X * Cos(PQR * bj_DEGTORAD)
		set M9R = y + .02 * N3X * Sin(PQR * bj_DEGTORAD)
		if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
			call SaveBoolean(OtherHashTable, GetHandleId(whichUnit), 99, true)
		endif
		call SetUnitX(whichUnit, CoordinateX50(M8R))
		call SetUnitY(whichUnit, CoordinateY50(M9R))
		call SaveReal(HY, h, 6,((GetUnitX(whichUnit))* 1.))
		call SaveReal(HY, h, 7,((GetUnitY(whichUnit))* 1.))
		call SetUnitX(dummyUnit, GetUnitX(whichUnit))
		call SetUnitY(dummyUnit, GetUnitY(whichUnit))
		call KillTreeByCircle(GetUnitX(whichUnit), GetUnitY(whichUnit), 100)
		set PPR = GetDistanceBetween(x, y, GetUnitX(whichUnit), GetUnitY(whichUnit))
		set PTR = PTR + PPR
		call SaveReal(HY, h, 138,((PTR)* 1.))
		set gg = AllocationGroup(177)
		set U2 = whichUnit
		set LH = whichUnit
		set KH = g
		set DH = GetUnitAbilityLevel(whichUnit,'A2TJ')
		set MH = null
		set HH = 60 + 30 * DH
		set GH = PSR
		set PH = null
		if c < 40 then
			if c < 35 then
				call GroupEnumUnitsInRange(gg, GetUnitX(whichUnit), GetUnitY(whichUnit), RMinBJ( 100 ,(c -30)* 25), Condition(function DJX))
			else
				call GroupEnumUnitsInRange(gg, GetUnitX(whichUnit), GetUnitY(whichUnit), 125, Condition(function DJX))
			endif
		else
			call GroupEnumUnitsInRange(gg, GetUnitX(whichUnit), GetUnitY(whichUnit), 175, Condition(function DJX))
		endif
		call GroupEnumUnitsInRange(gg, GetUnitX(whichUnit), GetUnitY(whichUnit), 175, Condition(function DJX))
		call ForGroup(gg, function PJR)
		call DeallocateGroup(gg)
		if PH != null then
			set gg = AllocationGroup(178)
			set MH = null
			set OJ = 9999
			call GroupEnumUnitsInRange(gg, GetUnitX(PH), GetUnitY(PH), 625, Condition(function PFR))
			call DeallocateGroup(gg)
			if MH == null then
				set b = true
				set MH = PH
			else
				set targetUnit = MH
				call SaveUnitHandle(HY, h, 810,(targetUnit))
			endif
		endif
	else
		if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
			call SaveBoolean(OtherHashTable, GetHandleId(whichUnit), 99, true)
		endif
		call SetUnitX(whichUnit, x)
		call SetUnitY(whichUnit, y)
	endif
	if C5X(whichUnit) or GetTriggerEventId() == EVENT_WIDGET_DEATH or b or(targetUnit == null and(c > 130 or FH or(PSR == 0 and PTR > 800) or(PSR == 1 and PTR > 1600))) then
		call KillUnit(dummyUnit)
		call DeallocateGroup(g)
		call DestroyEffect(LoadEffectHandle(HY, h, 5))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SetUnitTimeScale(whichUnit, 1)
		if FH then
			set M8R = GetUnitX(MH)+ 50 * Cos(PQR * bj_DEGTORAD)
			set M9R = GetUnitY(MH)+ 50 * Sin(PQR * bj_DEGTORAD)
			if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
				call SaveBoolean(OtherHashTable, GetHandleId(whichUnit), 99, true)
			endif
			call SetUnitX(whichUnit, CoordinateX50(M8R))
			call SetUnitY(whichUnit, CoordinateY50(M9R))
			call IssueTargetOrderById(whichUnit, 851983, MH)
		endif
	endif
	set whichUnit = null
	set t = null
	set gg = null
	set g = null
	set dummyUnit = null
	set targetUnit = null
	return false
endfunction
function PUR takes unit whichUnit, unit targetUnit returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit d = CreateUnit(GetOwningPlayer(whichUnit),'o01P', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	local real I3X = AngleBetweenXY(GetUnitX(whichUnit), GetUnitY(whichUnit), GetSpellTargetX(), GetSpellTargetY())
	call SaveEffectHandle(HY, h, 5, AddSpecialEffectTarget("war3mapImported\\RollingBoulder.mdx", whichUnit, "origin"))
	call SetUnitTimeScale(whichUnit, 3)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function PKR))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveGroupHandle(HY, h, 187,(AllocationGroup(179)))
	call SaveUnitHandle(HY, h, 19,(d))
	call SaveReal(HY, h, 6,((GetUnitX(whichUnit))* 1.))
	call SaveReal(HY, h, 7,((GetUnitY(whichUnit))* 1.))
	call SaveReal(HY, h, 137,((I3X)* 1.))
	call SaveInteger(HY, h, 34, 0)
	call SaveReal(HY, h, 138,(0 * 1.))
	call SaveUnitHandle(HY, h, 810,(null))
	if targetUnit != null and GetUnitTypeId(targetUnit)=='o01X' then
		call KillUnit(targetUnit)
	endif
	set t = null
	set d = null
endfunction
function PWR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local real PYR =(LoadReal(HY, h, 442))
	local integer PZR =(LoadInteger(HY,(GetHandleId(whichUnit)), 800))
	if GetTriggerEventId() == EVENT_UNIT_SPELL_CAST then
		if (GetSpellAbilityId()=='A2TH') and PZR <= 0 then
			call InterfaceErrorForPlayer(GetOwningPlayer(whichUnit), "没有足够的巨石了")
			call EXStopUnit(whichUnit)
		endif
	elseif GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
		if GetSpellAbilityId()=='A2TH' or GetSpellAbilityId()=='A2TJ' then
			if GetSpellAbilityId()=='A2TJ' then
				call PUR(whichUnit, null)
			endif
		endif
	elseif PZR < 6 then
		set PYR = PYR -0.2
		call SaveReal(HY, h, 442,((PYR)* 1.))
		if PYR <= 0.00 then
			set PZR = PZR + 1
			call SaveInteger(HY,(GetHandleId(whichUnit)), 800,(PZR))
			call SaveReal(HY, h, 442,(25 * 1.))
		endif
	endif
	set whichUnit = null
	set t = null
	return false
endfunction
function P_R takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_CAST)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function PWR))
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveReal(HY, h, 442, 30.)
	call SaveInteger(HY,(GetHandleId(u)), 800, 6)
	set t = null
endfunction
function P0R takes unit P1R returns nothing
	local unit P2R = Player__Hero[GetPlayerId(GetOwningPlayer(P1R))]
	local integer h = GetHandleId(P2R)
	local integer level = GetUnitAbilityLevel(P2R,'A2TH')
	local integer P3R =(LoadInteger(HY, h, 279))
	local integer i = 1
	local integer k = 1
	local unit P4R
	loop
	exitwhen i > P3R
		set P4R =(LoadUnitHandle(HY, h,( 1400+ i)))
		if UnitIsDead(P4R) == false then
			call SaveUnitHandle(HY, h,( 1400+ k),(P4R))
			set k = k + 1
		endif
		set i = i + 1
	endloop
	set P3R = P3R -1
	call SaveInteger(HY, h, 279,(P3R))
	set P4R = null
	set P2R = null
endfunction
function P5R takes nothing returns boolean
	if GetUnitTypeId(GetTriggerUnit())=='o01X' then
		call P0R(GetTriggerUnit())
	endif
	return false
endfunction
function ZQV takes nothing returns nothing
	local unit P6R
	local unit whichUnit = GetTriggerUnit()
	local integer h = GetHandleId(whichUnit)
	local integer level = GetUnitAbilityLevel(whichUnit,'A2TH')
	local integer P3R =(LoadInteger(HY, h, 279))
	local unit P7R =(LoadUnitHandle(HY, h, 1401))
	local real x
	local real y
	local integer PZR =(LoadInteger(HY,(GetHandleId(whichUnit)), 800))
	if PZR > 0 then
		set PZR = IMaxBJ(0, PZR -1)
		if PZR < 2 then
			call DisplayTimedTextToPlayer(GetOwningPlayer(whichUnit), 0, 0, 10, I2S(PZR)+ " 剩余巨石")
		endif
		call SaveInteger(HY,(GetHandleId(whichUnit)), 800,(PZR))
		if GetSpellTargetUnit() == null then
			set x = GetSpellTargetX()
			set y = GetSpellTargetY()
		else
			set x = GetUnitX(GetSpellTargetUnit())
			set y = GetUnitY(GetSpellTargetUnit())
		endif
		set P6R = CreateUnit(GetOwningPlayer(whichUnit),'o01X', x, y, 0)
		call SaveInteger(HY, GetHandleId(P6R), 4335, 0)
		call SaveInteger(HY, GetHandleId(P6R), 4340, 0)
		call UnitApplyTimedLife(P6R,'BTLF', 120)
		call SetUnitPathing(P6R, false)
		set P3R = P3R + 1
		call SaveUnitHandle(HY, h,( 1400+ P3R),(P6R))
		call SaveInteger(HY, h, 279,(P3R))
		if (P3R > 6) then
			call KillUnit(P7R)
		endif
	else
		call InterfaceErrorForPlayer(GetOwningPlayer(whichUnit), "没有可用的石头")
	endif
	set P6R = null
	set whichUnit = null
	set P7R = null
endfunction
function Kaolin_Stones_Summon takes nothing returns boolean
	if GetSpellAbilityId()=='A2TH' then
		call ZQV()
	endif
	return false
endfunction
function MGX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function P5R))
	set t = null
endfunction
function P8R takes nothing returns boolean
	return(UnitIsDead(GetFilterUnit()) == false and IsUnitEnemy(QH, GetOwningPlayer(GetFilterUnit())) and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and((LoadInteger(HY,(GetHandleId((GetFilterUnit()))),(809))) == 1))!= null
endfunction
function P9R takes nothing returns nothing
	call CommonUnitAddStun(GetEnumUnit(), .25 + .5 * XJ, false)
endfunction
function QVR takes unit u returns nothing
	local group g = AllocationGroup(180)
	if ((LoadInteger(HY,(GetHandleId((u))),(809))) == 1) then
		call GroupEnumUnitsInRange(g, 0, 0, 99999, Condition(function P8R))
	endif
	call GroupAddUnit(g, u)
	call ForGroup(g, function P9R)
	call DeallocateGroup(g)
	set g = null
endfunction
function QER takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), ZH) == false then
		call GroupAddUnit(ZH, GetEnumUnit())
		call UnitDamageTargetEx(QH, GetEnumUnit(), 1, NJ)
		if VJ == 1 then
			call QVR(GetEnumUnit())
		endif
		if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) and(LoadInteger(HY, GetHandleId(GetEnumUnit()), 809) == 1) then
			set UH = GetEnumUnit()
		endif
	endif
endfunction
function QXR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real dx =(LoadReal(HY, h, 6))
	local real dy =(LoadReal(HY, h, 7))
	local real QOR
	local real PRR =(LoadReal(HY, h, 23))
	local real PIR =(LoadReal(HY, h, 24))
	local real M8R
	local real M9R
	local boolean b = false
	local group g =(LoadGroupHandle(HY, h, 187))
	local group gg
	local unit QRR =(LoadUnitHandle(HY, h, 810))
	if QRR != null then
		set dx = GetUnitX(QRR)
		set dy = GetUnitY(QRR)
	endif
	set QOR = bj_DEGTORAD * AngleBetweenXY(GetUnitX(targetUnit), GetUnitY(targetUnit), dx, dy)
	set M8R = PRR + 1200* .03 * Cos(QOR)
	set M9R = PIR + 1200* .03 * Sin(QOR)
	if GetDistanceBetween(M8R, M9R, dx, dy)<(5 + 1200* .03) then
		set M8R = dx
		set M9R = dy
		set b = true
	endif
	set M8R = CoordinateX50(M8R)
	set M9R = CoordinateY50(M9R)
	set ZH = g
	set QH = whichUnit
	set XJ = GetUnitAbilityLevel(whichUnit,'A2QM')
	set NJ = 50 * XJ
	set UH = null
	if ((LoadInteger(HY,(GetHandleId(targetUnit)), 4306)) == 1) or GetTriggerEventId() == EVENT_WIDGET_DEATH or GetUnitAbilityLevel(targetUnit,'B08V')> 0 or((LoadInteger(HY,(GetHandleId(targetUnit)), 4336)) == 1) or(QRR == null and GetTriggerEvalCount(t)> 200) then
		set b = true
	else
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl", M8R, M9R))
		if GetUnitTypeId(targetUnit)=='o01X' or GetUnitTypeId(targetUnit)=='o020' then
			set VJ = 1
			call SetUnitPosition(targetUnit, M8R, M9R)
			call SetUnitX(targetUnit, CoordinateX50(M8R))
			call SetUnitY(targetUnit, CoordinateY50(M9R))
		else
			set VJ = 0
			call SetUnitX(targetUnit, CoordinateX50(M8R))
			call SetUnitY(targetUnit, CoordinateY50(M9R))
		endif
		call KillTreeByCircle(M8R, M9R, 150)
		call SaveReal(HY, h, 23,((M8R)* 1.))
		call SaveReal(HY, h, 24,((M9R)* 1.))
		set gg = AllocationGroup(181)
		set U2 = whichUnit
		call GroupEnumUnitsInRange(gg, M8R, M9R, 225, Condition(function DJX))
		call GroupRemoveUnit(gg, targetUnit)
		call ForGroup(gg, function QER)
		call DeallocateGroup(gg)
		if UH != null and VJ == 1 then
			set gg = AllocationGroup(182)
			set TH = null
			set OJ = 9999
			call GroupEnumUnitsInRange(gg, GetUnitX(UH), GetUnitY(UH), 625, Condition(function P8R))
			call DeallocateGroup(gg)
			if TH != null then
				set QRR = TH
				call SaveUnitHandle(HY, h, 810,(QRR))
				set b = false
			endif
		endif
		set gg = null
	endif
	if b then
		if GetUnitTypeId(targetUnit)!='o01X' then
			call SetUnitPathing(targetUnit, true)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call DeallocateGroup(g)
		call SaveInteger(HY,(GetHandleId((targetUnit))),(4335), 2)
		if GetTriggerEventId()!= EVENT_WIDGET_DEATH then
			if IsPlayerAlly(GetOwningPlayer(whichUnit), GetOwningPlayer(targetUnit)) == false then
				call UnitDamageTargetEx(QH, targetUnit, 1, NJ)
			endif
		endif
	endif
	set targetUnit = null
	set t = null
	set g = null
	set whichUnit = null
	set QRR = null
	return false
endfunction
function QIR takes nothing returns nothing
	local unit targetUnit = GetSpellTargetUnit()
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real I3X
	local real dx
	local real dy
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local integer i =-1
	local boolean b = false
	local real QAR = 400 + 100 * GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())
	local group g
	if targetUnit == null then
		set g = AllocationGroup(183)
		set U2 = whichUnit
		call GroupEnumUnitsInRange(g, x, y, 225, Condition(function PCR))
		set targetUnit = EXX(g, x, y)
		call DeallocateGroup(g)
		set g = null
		set I3X = AngleBetweenXY(GetUnitX(targetUnit), GetUnitY(targetUnit), GetSpellTargetX(), GetSpellTargetY())
	else
		set I3X = AngleBetweenUnit(whichUnit, targetUnit)
	endif
	if targetUnit == null then
		return
	endif
	if GetUnitTypeId(targetUnit)=='o01X' then
		set QAR = 2000
	endif
	loop
	exitwhen b or i == R2I(QAR / 25)
		set i = i + 1
		set dx = CoordinateX50(GetUnitX(targetUnit)+(QAR -i * 25)* Cos(I3X * bj_DEGTORAD))
		set dy = CoordinateY50(GetUnitY(targetUnit)+(QAR -i * 25)* Sin(I3X * bj_DEGTORAD))
		if (IsPointInRegion(TerrainCliffRegion,((dx)* 1.),((dy)* 1.))) == false then
			set b = true
		endif
	endloop
	call SetUnitPathing(targetUnit, false)
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function QXR))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveReal(HY, h, 6,((dx)* 1.))
	call SaveReal(HY, h, 7,((dy)* 1.))
	call SaveReal(HY, h, 23,((GetUnitX(targetUnit))* 1.))
	call SaveReal(HY, h, 24,((GetUnitY(targetUnit))* 1.))
	call SaveInteger(HY, h, 34, 0)
	call SaveGroupHandle(HY, h, 187,(AllocationGroup(184)))
	call SaveUnitHandle(HY, h, 810,(null))
	call SaveInteger(HY,(GetHandleId((targetUnit))),(4335), 1)
	set targetUnit = null
	set whichUnit = null
	set t = null
endfunction
function QNR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 1)
	local integer hu = GetHandleId(u)
	local unit targetUnit = LoadUnitHandle(HY, h, 0)
	local integer QBR = GetUnitCurrentOrder(u)
	if QBR != LoadInteger(HY, h, 0) then
		if QBR != 851973 then
			call CleanCurrentTrigger(t)
			call FlushChildHashtable(HY, h)
			call RemoveSavedHandle(HY, hu,'A2UU')
		else
			call IssuePointOrderById(u, 851986, GetUnitX(targetUnit), GetUnitY(targetUnit))
		endif
	else
		if GetUnitDistanceEx(u, targetUnit)<= 200 then
			call CleanCurrentTrigger(t)
			call FlushChildHashtable(HY, h)
			call RemoveSavedHandle(HY, hu,'A2UU')
			call IssueTargetOrderById(u, 852189, targetUnit)
		endif
	endif
	set targetUnit = null
	set u = null
	set t = null
	return false
endfunction
function QCR takes unit u, unit targetUnit returns nothing
	local trigger t
	local integer h
	local integer hu = GetHandleId(u)
	if HaveSavedHandle(HY, hu,'A2UU') then
		set t = LoadTriggerHandle(HY, hu,'A2UU')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .02, true)
		call TriggerAddCondition(t, Condition(function QNR))
		call SaveTriggerHandle(HY, hu,'A2UU', t)
		call SaveUnitHandle(HY, h, 1, u)
	endif
	call IssueTargetOrderById(u, 851986, targetUnit)
	call SaveUnitHandle(HY, h, 0, targetUnit)
	call SaveInteger(HY, h, 0, 851986)
	set t = null
endfunction
function QDR takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local group g = AllocationGroup(185)
	set U2 = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 205, Condition(function PCR))
	if FirstOfGroup(g) == null then
		call EXStopUnit(u)
		if IsUnitType(u, UNIT_TYPE_HERO) then
			call InterfaceErrorForPlayer(GetOwningPlayer(u), "无效目标")
		endif
	endif
	call DeallocateGroup(g)
	set u = null
	set targetUnit = null
	set g = null
endfunction
function QFR takes nothing returns nothing
	if GetUnitDistanceEx(GetTriggerUnit(), GetSpellTargetUnit())> 200 then
		call QCR(GetTriggerUnit(), GetSpellTargetUnit())
	endif
endfunction
function ZSV takes nothing returns nothing
	if IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) or not UnitHasSpellShield(GetSpellTargetUnit()) then
		call QIR()
	endif
endfunction
function J_E takes nothing returns nothing
	if GetSpellTargetUnit() == null then
		call QDR()
	elseif (GetUnitDistanceEx(GetTriggerUnit(), GetSpellTargetUnit())> 170 and GetUnitTypeId(GetSpellTargetUnit())!='n00L') then
		call QFR()
	elseif GetUnitTypeId(GetSpellTargetUnit())=='n00L' then
		call EXStopUnit(GetTriggerUnit())
		if IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) then
			call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "无效目标")
		endif
	endif
endfunction
function QGR takes nothing returns nothing
	set YH = GetEnumUnit()
	call ExecuteFunc("QHR")
endfunction
function QJR takes nothing returns boolean
	return UnitIsDead(GetFilterUnit()) == false and GetUnitTypeId(GetFilterUnit())=='o01X' and((LoadInteger(HY,(GetHandleId((GetFilterUnit()))),(4335))) == 1) == false and((LoadInteger(HY,(GetHandleId((GetFilterUnit()))),(4340))) == 1) == false
endfunction
function QKR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit triggerUnit = LoadUnitHandle(HY, h, 17)
	local real x = GetUnitX(triggerUnit)
	local real y = GetUnitY(triggerUnit)
	local group g = AllocationGroup(186)
	local integer C2R = GetTriggerEvalCount(t)
	local integer level = GetUnitAbilityLevel(whichUnit,'A2TI')
	local real QLR =(LoadReal(HY,(GetHandleId(triggerUnit)), 807))
	if ModuloInteger(C2R, 5) == 0 then
		call UnitDamageTargetEx(whichUnit, triggerUnit, 1,(25 + 25 * level)/ 2)
	endif
	set WH = whichUnit
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, x, y, 325, Condition(function QJR))
	call ForGroup(g, function QGR)
	call DeallocateGroup(g)
	if (GetGameTime())> QLR or UnitIsDead(triggerUnit) then
		call SaveInteger(HY, GetHandleId(triggerUnit), 809, 2)
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set triggerUnit = null
	set g = null
	return false
endfunction
function QMR takes unit u, unit triggerUnit returns nothing
	local trigger t
	local integer h
	local real QPR = LoadReal(HY, GetHandleId(triggerUnit), 807)
	call SaveReal(HY,(GetHandleId(triggerUnit)), 807,(((GetGameTime())+ 6)* 1.))
	if QPR <(GetGameTime()) then
		call SaveInteger(HY,(GetHandleId((triggerUnit))), 809, 1)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(u))
		call SaveUnitHandle(HY, h, 17,(triggerUnit))
		call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\MagnetizeTargetOverhead.mdx", triggerUnit, "origin")))
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerAddCondition(t, Condition(function QKR))
	endif
	set t = null
endfunction
function QQR takes nothing returns nothing
	call QMR(WH, GetEnumUnit())
endfunction
function QSR takes unit u, unit targetUnit returns nothing
	local group g = AllocationGroup(187)
	local real x = GetUnitX(targetUnit)
	local real y = GetUnitY(targetUnit)
	local real QTR = 300
	if GetUnitTypeId(targetUnit)=='o01X' then
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\DemolisherMissile\\DemolisherMissile.mdx", GetUnitX(targetUnit), GetUnitY(targetUnit)))
		call UnitApplyTimedLife(targetUnit,'BTLF', 5)
		call SaveInteger(HY,(GetHandleId((targetUnit))),(4340), 1)
		call SetUnitVertexColor(targetUnit, 0, 0, 0, 100)
		set QTR = 600
	else
		call DestroyEffect(AddSpecialEffect("war3mapImported\\MagnetizeCastAoE.mdx", GetUnitX(targetUnit), GetUnitY(targetUnit)))
	endif
	set U2 = u
	set WH = u
	set YH = targetUnit
	call GroupEnumUnitsInRange(g, x, y, QTR + 25, Condition(function DJX))
	call ForGroup(g, function QQR)
	call DeallocateGroup(g)
	set g = null
endfunction
function QHR takes nothing returns nothing
	call QSR(WH, YH)
endfunction
function F3E takes nothing returns nothing
	call QSR(GetTriggerUnit(), GetTriggerUnit())
endfunction
function QUR takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='o01X' then
		call KillUnit(GetFilterUnit())
	endif
	return false
endfunction
function QWR takes unit u returns nothing
	local group g
	local player p
	if not Mode__DeathMatch  or IsUnitType(u, UNIT_TYPE_HERO) == false or LoadBoolean(HY, GetHandleId(u), QR) then
		return
	endif
	if Mode__DeathMatch and GetUnitAbilityLevel(u,'A2TH')> 0 then
		set g = AllocationGroup(188)
		set p = GetOwningPlayer(u)
		call GroupEnumUnitsOfPlayer(g, p, Condition(function QUR))
		call DeallocateGroup(g)
		set g = null
	endif
endfunction
function QYR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call SetUnitAnimationByIndex(LoadUnitHandle(HY, h, 2), 8)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function QZR takes nothing returns nothing
	local timer t
	local unit u = GetTriggerUnit()
	if GetUnitTypeId(u)=='N0MU' then
		set t = CreateTimer()
		call SetUnitAnimationByIndex(u, 7)
		call TimerStart(t, 2.5, false, function QYR)
		call SaveUnitHandle(HY, GetHandleId(t), 2, u)
		set t = null
	endif
	set u = null
endfunction
function Q_R takes nothing returns nothing
	call ARX("war3mapImported\\FortunesEndTarget.mdx", GetEnumUnit(), "origin", 3)
	call IssueTargetOrderById(IG, 852111, GetEnumUnit())
	call UnitRemoveAbility(GetEnumUnit(),'A2T4')
	call UnitDamageTargetEx(RG, GetEnumUnit(), 1, 60 + 30 * BG)
endfunction
function Q0R takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit =(LoadUnitHandle(HY,(GetHandleId(whichUnit)), 796))
	local real time = RMinBJ((GetGameTime())-(LoadReal(HY,(GetHandleId(whichUnit)), 358)), 3)
	local integer level = GetUnitAbilityLevel(whichUnit,'A2QT')
	local integer Q1R = R2I(2. * time)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitFacing(whichUnit))
	local unit Q2R
	local group g
	local integer T0V ='A594'
	if Q1R > 3 then
		set T0V ='A595'
		set Q1R = Q1R -3
	endif
	if targetUnit != null then
		set Q2R = CreateUnit(GetOwningPlayer(whichUnit),'o00Z', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitApplyTimedLife(Q2R,'BTLF', .5)
		call UnitAddAbility(dummyUnit, T0V)
		call SetUnitAbilityLevel(dummyUnit, T0V, Q1R)
		set U2 = whichUnit
		set RG = whichUnit
		set IG = dummyUnit
		set BG = level
		set g = AllocationGroup(189)
		call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 325, Condition(function DHX))
		call ForGroup(g, function Q_R)
		if GetUnitAbilityLevel(targetUnit,'A3E9') == 1 and IsUnitMagicImmune(whichUnit) == false then
			if UnitHasSpellShield(whichUnit) == false then
				call SetUnitOwner(dummyUnit, GetOwningPlayer(targetUnit), true)
				call SetUnitX(dummyUnit, GetUnitX(whichUnit))
				call SetUnitY(dummyUnit, GetUnitY(whichUnit))
				set U2 = targetUnit
				set RG = targetUnit
				set IG = dummyUnit
				set BG = level
				call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 325, Condition(function DHX))
				call ForGroup(g, function Q_R)
			else
				call UnitRemoveSpellShield(whichUnit)
			endif
		endif
		call DeallocateGroup(g)
	endif
	set whichUnit = null
	set targetUnit = null
	set dummyUnit = null
	set Q2R = null
	set g = null
endfunction
function Q3R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 14))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call SaveReal(HY,(GetHandleId(whichUnit)), 356,((GetUnitX(targetUnit))* 1.))
		call SaveReal(HY,(GetHandleId(whichUnit)), 357,((GetUnitY(targetUnit))* 1.))
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function Q4R takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	call SaveReal(HY,(GetHandleId(whichUnit)), 358,(((GetGameTime()))* 1.))
	call SaveUnitHandle(HY,(GetHandleId(whichUnit)), 796,(GetSpellTargetUnit()))
	call DestroyEffect(AddSpecialEffect("war3mapImported\\CleanseTargetArea.mdx", GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit())))
	call SaveUnitHandle(HY, h, 14,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(GetSpellTargetUnit()))
	call TriggerRegisterTimerEvent(t, 10, false)
	call TriggerRegisterDeathEvent(t, GetSpellTargetUnit())
	call TriggerAddCondition(t, Condition(function Q3R))
	set t = null
	set whichUnit = null
endfunction
function SpellEffect__FortuneEnd takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call SaveBoolean(HY,(GetHandleId(GetTriggerUnit())), 360,(true))
	endif
endfunction
function JFE takes nothing returns nothing
	if LoadBoolean(HY, GetHandleId(GetTriggerUnit()), 360) then
		call Q0R()
	endif
endfunction
function KJE takes nothing returns nothing
	call SaveBoolean(HY,(GetHandleId(GetTriggerUnit())), 360,(false))
	call Q4R()
endfunction
function Q5R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level = LoadInteger(HY, h, 5)
	local integer c = LoadInteger(HY, h, 0)
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if LoadBoolean(HY, h, 0) == false then
			call SaveBoolean(HY, h, 0, true)
			call UnitDamageTargetEx(GetEventDamageSource(), GetTriggerUnit(), 3, GetEventDamage()* .5)
			call SaveBoolean(HY, h, 0, false)
		endif
	elseif GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(targetUnit,'A2T4')
		call UnitRemoveAbility(targetUnit,'A3KE')
		call UnitRemoveAbility(targetUnit,'B3KE')
		call UnitRemoveAbility(targetUnit,'A3KD')
		call RemoveSavedHandle(HY, GetHandleId(targetUnit),'A2T5')
	elseif c >(level + 2)* 10 or GetUnitAbilityLevel(targetUnit,'A2T4') == 0 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(targetUnit,'A2T4')
		call UnitRemoveAbility(targetUnit,'A3KE')
		call UnitRemoveAbility(targetUnit,'B3KE')
		call UnitRemoveAbility(targetUnit,'A3KD')
		call RemoveSavedHandle(HY, GetHandleId(targetUnit),'A2T5')
	else
		set c = c + 1
		call SaveInteger(HY, h, 0, c)
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function Q6R takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A2T5')
	local trigger t
	local integer h
	if HaveSavedHandle(HY, GetHandleId(targetUnit),'A2T5') then
		set t = LoadTriggerHandle(HY, GetHandleId(targetUnit),'A2T5')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, GetHandleId(targetUnit),'A2T5', t)
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function Q5R))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SetPlayerAbilityAvailable(GetOwningPlayer(targetUnit),'A2T4', false)
	endif
	call UnitAddPermanentAbility(targetUnit,'A3KE')
	call UnitAddPermanentAbility(targetUnit,'A3KD')
	call UnitAddPermanentAbility(targetUnit,'A2T4')
	call SaveInteger(HY, h, 0, 0)
	call SaveInteger(HY, h, 5, level)
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function SpellEffect__FateEdict takes nothing returns nothing
	if IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) or not UnitHasSpellShield(GetSpellTargetUnit()) then
		call Q6R()
	endif
endfunction
function Q7R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level = LoadInteger(HY, h, 5)
	local integer C2R =(LoadInteger(HY, h, 34))
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or C2R > 9 * 5 or LoadInteger(HY, GetHandleId(targetUnit),'A2SG') == 0 then
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call SaveInteger(HY, GetHandleId(targetUnit),'A2SG', IMaxBJ(LoadInteger(HY, GetHandleId(targetUnit),'A2SG')-1, 0))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set C2R = C2R + 1
		call SaveInteger(HY, h, 34,(C2R))
		if ModuloInteger(C2R, 5) == 0 then
			call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+ 11* level)
		endif
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function Q8R takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A2SG')
	local real damageValue = level * 90
	local real Q9R = .75
	call SaveInteger(HY, GetHandleId(targetUnit),'A2SG', LoadInteger(HY, GetHandleId(targetUnit),'A2SG')+ 1)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerAddCondition(t, Condition(function Q7R))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\DarkMending.mdx", targetUnit, "origin")))
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) == false then
		set Q9R = 1.
	endif
	if GetWidgetLife(targetUnit)<= damageValue * Q9R and IsUnitAlly(targetUnit, GetOwningPlayer(whichUnit)) then
		set damageValue = GetWidgetLife(targetUnit)/ .75  -10
	endif
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, damageValue)
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function ZWV takes nothing returns nothing
	if IsUnitEnemy(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) == false or not UnitHasSpellShield(GetSpellTargetUnit()) then
		call Q8R()
	endif
endfunction

function FalsePromise_CallBack takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit spellUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer damagedCount =(LoadInteger(HY, h, 34))
	local integer timeCount =(LoadInteger(HY, h, 25))
	local integer level =(LoadInteger(HY, h, 5))
	local integer i = 0
	local real SXR = (LoadReal(HY, h, 697))
	local real SOR = (LoadReal(HY, h, 811))
	local real SRR = GetWidgetLife(targetUnit)
	local real SIR = GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)
	local real restoreLife = (LoadReal(HY, h, 808))
	local real SNR
	local real damageValue
	local boolean SBR = LoadBoolean(HY, h, 5)
	local integer duration = level + 6
	if SBR then
		set duration = duration - 2
	endif
	if timeCount >(duration)* 50 or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call DisableTrigger(t)
		call UnitRemoveAbility(targetUnit,'A3KN')
		call UnitRemoveAbility(targetUnit,'B3KN')
		if GetTriggerEventId()!= EVENT_WIDGET_DEATH then
			set restoreLife = restoreLife * 2
			loop
			exitwhen i > damagedCount
				set i = i + 1
				set SRR = GetWidgetLife(targetUnit)
				set SNR = RMinBJ(SIR -SRR, restoreLife)
				call SetWidgetLife(targetUnit, SRR + SNR)
				set restoreLife = restoreLife -SNR
				set damageValue =(LoadReal(HY, h,(20000+ i)))
				if (LoadUnitHandle(HY, h,(22000+ i))) == spellUnit or((LoadInteger(HY,(GetHandleId((targetUnit))),( 2485))) == 1) then
					if GetWidgetLife(targetUnit)<= damageValue + 2 then
						set damageValue = GetWidgetLife(targetUnit)-2
					endif
				endif
				call UnitDamageTargetEx((LoadUnitHandle(HY, h,(22000+ i))), targetUnit, 6, damageValue)
			endloop
			set SRR = GetWidgetLife(targetUnit)
			set SNR = RMinBJ(SIR -SRR, restoreLife)
			call SetWidgetLife(targetUnit, SRR + SNR)
			set restoreLife = restoreLife -SNR
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_UNIT_DAMAGED and IsEffectiveDamage(GetEventDamage()) then
		set damagedCount = damagedCount + 1
		call SaveInteger(HY, h, 34,(damagedCount))
		call SaveUnitHandle(HY, h,(22000+ damagedCount),(GetEventDamageSource()))
		call SaveReal(HY, h,(20000+ damagedCount),((GetEventDamage())* 1.))
	elseif GetTriggerEventId()!= EVENT_UNIT_DAMAGED and GetTriggerEventId()!= EVENT_WIDGET_DEATH then
		set timeCount = timeCount + 1
		call SaveInteger(HY, h, 25,(timeCount))
		if SIR != SOR then
			set SOR = SIR
			set SXR = SRR
			call SaveReal(HY, h, 697,((SXR)* 1.))
			call SaveReal(HY, h, 811,((SOR)* 1.))
		endif
		if SRR > SXR then
			if ((LoadInteger(HY,(GetHandleId((targetUnit))),(4298)))!= 1) then
				set restoreLife = restoreLife + SRR -SXR
				call SaveReal(HY, h, 808,((restoreLife)* 1.))
			else
				call SetWidgetLife(targetUnit, SRR)
			endif
		endif
		call SetWidgetLife(targetUnit, SXR)
		call GBX(targetUnit)
	endif
	set t = null
	set targetUnit = null
	set spellUnit = null
	return false
endfunction

function SpellEffect__FalsePromise takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(spellUnit,'A2TF')
	local boolean SBR = false
	call UnitAddPermanentAbility(targetUnit,'A3KN')
	// 受伤事件 死亡事件
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function FalsePromise_CallBack))
	call SaveUnitHandle(HY, h, 2,(spellUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 34, 0)
	call SaveInteger(HY, h, 25, 0)
	call SaveInteger(HY, h, 5,(level))
	call SaveBoolean(HY, h, 5, SBR)
	call SaveReal(HY, h, 808, .0)
	call SaveReal(HY, h, 697,((GetWidgetLife(targetUnit))* 1.))
	call SaveReal(HY, h, 811,((GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE))* 1.))
	call GBX(targetUnit)
	set spellUnit = null
	set targetUnit = null
	set t = null
endfunction
function SCR takes nothing returns nothing
	call TriggerRegisterUnitEvent(CI, GetEnumUnit(), EVENT_UNIT_DAMAGED)
	call SaveInteger(HY, GetHandleId(CI), 0, LoadInteger(HY, GetHandleId(CI), 0)+ 1)
endfunction
function SDR takes unit u returns nothing
	local group g = AllocationGroup(190)
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 500, null)
	call ForGroup(g, function SCR)
	call DeallocateGroup(g)
	set g = null
endfunction
function SFR takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer c
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamageSource() == LoadUnitHandle(HY, h, 0) then
			call CommonUnitAddStun(GetTriggerUnit(), LoadReal(HY, h, 0), false)
			call UnitDamageTargetEx(LoadUnitHandle(HY, h, 1), GetTriggerUnit(), 1, LoadReal(HY, h, 1))
			set c = LoadInteger(HY, h, 0)
			if c == 1 then
				call FlushChildHashtable(HY, h)
				call DestroyTrigger(t)
				set CI = null
			else
				call SaveInteger(HY, h, 0, c -1)
			endif
		endif
	else
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
		set CI = null
	endif
	set t = null
endfunction

function SGR takes unit u, integer level returns nothing
	local trigger t
	local integer h
	local unit d
	local real SYV
	local real damageValue
	if GetUnitAbilityLevel(u,'A36D') == 1 then
		return
	endif
	if GetUnitAbilityLevel(u,'A0DJ')+ GetUnitAbilityLevel(u,'QP1G') > 0 then
		call YDWESetUnitAbilityState(u,'QP1G', 1, 7.5 - level * 1.5)
	endif
	set d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call UnitAddAbility(d,'A42H')
	set CI = CreateTrigger()
	set h = GetHandleId(CI)
	call SDR(d)
	call TriggerRegisterTimerEvent(CI, .02, false)
	call TriggerAddCondition(CI, Condition(function SFR))
	call SaveUnitHandle(HY, h, 0, d)
	set SYV = .3 + .3 * level
	set damageValue = 50 + 25 * level
	call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)* .96)
	call SaveReal(HY, h, 0, SYV)
	call SaveReal(HY, h, 1, damageValue)
	call SaveUnitHandle(HY, h, 1, u)
	set t = null
	call IssueImmediateOrderById(d, 852127)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl", GetUnitX(d), GetUnitY(d)))
	set d = null
endfunction

function SHR takes unit u, integer WTV returns nothing
	local integer WUV = GetUnitAbilityLevel(u,'A0DJ')+ GetUnitAbilityLevel(u,'QF85')
	if WUV > 0 then
		if OER(WTV) and(YDWEGetUnitAbilityState(u, 'QP1G', 1) == 0) then
			call SGR(u, WUV)
		endif
	endif
endfunction

function SJR takes nothing returns nothing
	call UnitDamageTargetEx(GetTriggerUnit(), GetEnumUnit(), 1, S2)
	call CommonUnitAddStun(GetEnumUnit(), Q2 * .25 + .75, false)
endfunction

function SKR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	call UnitRemoveAbility(whichUnit,'Broa')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction
function SLR takes nothing returns boolean
	local trigger t
	local integer h
	if GetUnitAbilityLevel(GetTriggerUnit(),'Broa')> 0 then
		if IsAttackSpecialEffects(GetSpellAbilityId()) then
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call TriggerRegisterTimerEvent(t, .1, false)
			call TriggerAddCondition(t, Condition(function SKR))
			call SaveUnitHandle(HY, h, 2,(GetTriggerUnit()))
		endif
	endif
	set t = null
	return false
endfunction
function MLX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function SLR))
	set t = null
endfunction
function SMR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(t), 0),'Broa')
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTimer(t)
	set t = null
endfunction
function SPR takes nothing returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .15, false, function SMR)
	call SaveUnitHandle(HY, GetHandleId(t), 0, DESource)
	set t = null
endfunction
function SQR takes nothing returns nothing
	local real x = GetUnitX(GetEnumUnit())
	local real y = GetUnitY(GetEnumUnit())
	local integer id = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))
	call SetUnitX(H0V[id], x)
	call SetUnitY(H0V[id], y)
	call IssueImmediateOrderById(H0V[id], 852526)
endfunction
function SSR takes nothing returns nothing
	local real x = GetUnitX(GetEnumUnit())
	local real y = GetUnitY(GetEnumUnit())
	local integer id = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))
	if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) or IsUnitIllusion(GetEnumUnit()) then
		call SetUnitX(H0V[id], x)
		call SetUnitY(H0V[id], y)
		call IssueImmediateOrderById(H0V[id], 852526)
	endif
endfunction
function STR takes nothing returns boolean
	return((GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit())) and UnitIsDead(GetFilterUnit()) == false))
endfunction
function SUR takes nothing returns nothing
	call UnitShareVision(GetEnumUnit(), GetOwningPlayer(UI), false)
endfunction
function SWR takes nothing returns nothing
	call UnitShareVision(GetEnumUnit(), GetOwningPlayer(UI), true)
endfunction
function SYR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group g = LoadGroupHandle(HY, h, 0)
	set UI = LoadUnitHandle(HY, h, 1)
	call ForGroup(g, function SUR)
	call DeallocateGroup(g)
	call DestroyTimerAndFlushHT_HY(t)
	set g = null
	set t = null
endfunction
function SZR takes group g, unit u returns nothing
	local group gg = AllocationGroup(193)
	local timer t = CreateTimer()
	call TimerStart(t, 0, false, function SYR)
	call GroupAddGroup(g, gg)
	call SaveGroupHandle(HY, GetHandleId(t), 0, gg)
	call SaveUnitHandle(HY, GetHandleId(t), 1, u)
	set gg = null
	set t = null
endfunction
function Z_V takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local group g = AllocationGroup(194)
	local integer pid = GetPlayerId(GetOwningPlayer(whichUnit))
	local integer level = GetUnitAbilityLevel(whichUnit,'A0DH')
	call SGR(whichUnit, 4)
	if level == 0 then
		set level = GetUnitAbilityLevel(whichUnit,'A1OB')
	endif
	set H0V[pid]= CreateUnit(GetOwningPlayer(whichUnit),'e00E', x, y, 0)
	call UnitAddAbility(H0V[pid],'A3L6')
	call SetUnitAbilityLevel(H0V[pid],'A3L6', level)
	call IssueImmediateOrderById(H0V[pid], 852526)
	call UnitRemoveAbility(H0V[pid],'A3L6')
	call SetUnitScale(H0V[pid], .25, .25, .25)
	call UnitAddPermanentAbility(H0V[pid],'A0DM')
	call SetUnitAbilityLevel(H0V[pid],'A0DM', level)
	set UI = whichUnit
	call GroupEnumUnitsInRange(g, x, y, 1200, Condition(function STR))
	call ForGroup(g, function SWR)
	call SZR(g, whichUnit)
	call GroupEnumUnitsInRange(g, x, y, 600, Condition(function STR))
	call ForGroup(g, function SQR)
	if GetUnitAbilityLevel(whichUnit,'A1OB')> 0 then
		call ForGroup(g, function SSR)
	endif
	call DeallocateGroup(g)
	set whichUnit = null
	set g = null
endfunction
function MKX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A0DM')
	call AddAbilityIDToPreloadQueue('A0SJ')
endfunction
function S_R takes nothing returns nothing
	local unit whichUnit
	local unit targetUnit
	if GetTriggerEventId() == EVENT_PLAYER_UNIT_SPELL_EFFECT then
		set whichUnit = GetSpellTargetUnit()
		set targetUnit = GetTriggerUnit()
	else
		set whichUnit = GetTriggerUnit()
		set targetUnit = GetAttacker()
	endif
	if IsUnitEnemy(targetUnit, GetOwningPlayer(whichUnit)) and IsUnitType(targetUnit, UNIT_TYPE_STRUCTURE) == false and IsUnitMagicImmune(targetUnit) == false then
		call UnitAddAbilityToTimed(targetUnit,'A3EK'-1 + GetUnitAbilityLevel(whichUnit,'A0DW'), 1, 4.,'B38B')
	endif
	set whichUnit = null
	set targetUnit = null
endfunction
function S0R takes nothing returns boolean
	if GetTriggerEventId() == EVENT_PLAYER_UNIT_SPELL_EFFECT then
		return GetUnitAbilityLevel(GetSpellTargetUnit(),'A0DW')> 0 and GetUnitAbilityLevel(GetSpellTargetUnit(),'A36D') == 0
	else
		return GetUnitAbilityLevel(GetTriggerUnit(),'A0DW')> 0 and GetUnitAbilityLevel(GetTriggerUnit(),'A36D') == 0
	endif
endfunction
function MMX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function S0R))
	call TriggerAddAction(t, function S_R)
	set t = null
endfunction
function S1R takes nothing returns boolean
	return((IsUnitAlly(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit())) and GetWidgetLife(GetFilterUnit())!= GetUnitState(GetFilterUnit(), UNIT_STATE_MAX_LIFE))!= null
endfunction

function S3R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer S4R =(LoadInteger(HY, h, 28))
	local group g
	local unit S5R
	if S4R > 10 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SaveInteger(HY, h, 28,(S4R + 1))
		set U2 = whichUnit
		set g = AllocationGroup(195)
		call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 300, Condition(function S1R))
		set S5R = GroupPickRandomUnit(g)
		call DeallocateGroup(g)
		call SetWidgetLife(S5R, GetWidgetLife(S5R)+ 10)
	endif
	set t = null
	set whichUnit = null
	set g = null
	set S5R = null
	return false
endfunction
function S6R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	call AddUnitAnimationProperties(whichUnit, "alternate", false)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction
function Z0V takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local integer i = 1
	local trigger t
	local integer h
	loop
	exitwhen i >(2 + 2 * GetUnitAbilityLevel(whichUnit,'A01B'))
		set t = CreateTrigger()
		call SaveUnitHandle(HY,(GetHandleId(t)), 2,(whichUnit))
		call SaveInteger(HY,(GetHandleId(t)), 28, 0)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function S3R))
		set i = i + 1
	endloop
	if GetUnitTypeId(whichUnit)=='E02X' then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 0, false)
		call TriggerAddCondition(t, Condition(function S6R))
		call SaveUnitHandle(HY, h, 2,(whichUnit))
		set t = null
	endif
	set t = null
	set whichUnit = null
endfunction
function S7R takes unit u, unit t returns nothing
	local real EOX = RMinBJ(GetDistanceBetween(GetUnitX(t), GetUnitY(t), GetUnitX(u), GetUnitY(u)), 2500)
	local integer level = GetUnitAbilityLevel(u,'A0DY')+ GetUnitAbilityLevel(u,'A1WB')
	local real d =(.1 + .05 * level)* EOX
	call UnitRemoveAbility(t,'B03U')
	call CommonTextTag("+" + I2S(R2I(d)), 1, t, .023, 3, 216, 216, 216)
	call UnitDamageTargetEx(u, t, 7, d)
endfunction
function S8R takes unit u returns boolean
	return IsUnitType(u, UNIT_TYPE_HERO) == false and IsUnitType(u, UNIT_TYPE_ANCIENT) == false and GetUnitTypeId(u)!='n01E' and GetUnitTypeId(u)!='n019'
endfunction
function S9R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	call UnitRemoveAbility(targetUnit,'Bslo')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set targetUnit = null
	return false
endfunction
function TVR takes nothing returns nothing
	local unit targetUnit = GetSpellTargetUnit()
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call K7R(targetUnit)
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerAddCondition(t, Condition(function S9R))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SetUnitOwner(targetUnit, GetOwningPlayer(whichUnit), true)
	if GetUnitAbilityLevel(whichUnit,'A0A8') == 0 then
		call UnitApplyTimedLife(targetUnit,'BTLF', 80)
	else
		call UnitApplyTimedLife(targetUnit,'BTLF', 180)
		call UnitAddMaxLife(targetUnit, 100 * GetUnitAbilityLevel(whichUnit,'A0A8'))
	endif
	call UnitAddPermanentAbility(targetUnit,'Aeth')
	call UnitAddPermanentAbility(targetUnit,'A12G')
	call I8X(targetUnit)
	set targetUnit = null
	set whichUnit = null
	set t = null
endfunction
function Z1V takes nothing returns nothing
	if S8R(GetSpellTargetUnit()) then
		call TVR()
	endif
endfunction
function LFE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit u = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	call UnitAddAbility(u,'A415')
	if IssuePointOrderById(u, 852221, GetSpellTargetX(), GetSpellTargetY()) == false then
		call SetUnitX(u, GetUnitX(whichUnit))
		call SetUnitY(u, GetUnitY(whichUnit))
		call UnitResetCooldownEx(u)
		if IssuePointOrderById(u, 852221, GetSpellTargetX(), GetSpellTargetY()) == false then
			call EXStopUnit(whichUnit)
			call InterfaceErrorForPlayer(GetOwningPlayer(whichUnit), "无法在此释放午夜凋零")
		endif
	endif
	call KillUnit(u)
	set whichUnit = null
	set u = null
endfunction
function Z2V takes nothing returns nothing
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit whichUnit = GetTriggerUnit()
	local real x0 = GetUnitX(whichUnit)
	local real y0 = GetUnitY(whichUnit)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', x0, y0, 0)
	call UnitApplyTimedLife(dummyCaster,'BTLF', 8)
	call UnitAddAbility(dummyCaster,'A0B2')
	call SetUnitAbilityLevel(dummyCaster,'A0B2', GetUnitAbilityLevel(whichUnit,'A0B1'))
	if IssuePointOrderById(dummyCaster, 852221, x, y) == false then
	endif
	set whichUnit = null
	set dummyCaster = null
endfunction
function TER takes unit whichUnit, unit targetUnit, integer level returns nothing
	local real IXX = 10+ 15* level
	local real TXR = .25 * level
	call CommonUnitAddStun(targetUnit, TXR, false)
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, IXX)
endfunction
function TOR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 5))
	call TER(whichUnit, targetUnit, level)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function TRR takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(whichUnit,'A0I7')
	call TER(whichUnit, targetUnit, level)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call TriggerRegisterTimerEvent(t, 2, false)
	call TriggerAddCondition(t, Condition(function TOR))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call TriggerRegisterTimerEvent(t, 4, false)
	call TriggerAddCondition(t, Condition(function TOR))
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function Z3V takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call TRR()
	endif
endfunction
function Z4V takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local real x = GetUnitX(targetUnit)
	local real y = GetUnitY(targetUnit)
	local integer level = GetUnitAbilityLevel(whichUnit,'A180')
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', x, y, 0)
	local integer TIR = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetTriggerPlayer())],'A0A8')
	local integer id ='A17Z'
	call SetWidgetLife(targetUnit, 1)
	call UnitDamageTargetEx(whichUnit, targetUnit, 2, 20)
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, 20)
	call UnitDamageTargetEx(whichUnit, targetUnit, 3, 20)
	if TIR == 1 then
		set id ='A3IU'
	elseif TIR < 4 then
		set id ='A3IV'
	elseif TIR == 4 then
		set id ='A3IW'
	endif
	call UnitAddPermanentAbility(dummyCaster, id)
	call SetUnitAbilityLevel(dummyCaster, id, level)
	call IssueImmediateOrderById(dummyCaster, 852667)
	set whichUnit = null
	set targetUnit = null
	set dummyCaster = null
endfunction
function KLE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer UHE = GetUnitLevel(targetUnit)
	if GetOwningPlayer(targetUnit)!= SentinelPlayers[0]and GetOwningPlayer(targetUnit)!= ScourgePlayers[0]and LoadInteger(SightDataHashTable, GetUnitTypeId(targetUnit), HC)> 88 then
		call EXStopUnit(trigUnit)
		call InterfaceErrorForPlayer(GetOwningPlayer(trigUnit), GetObjectName('n0CX'))
	endif
	set trigUnit = null
	set targetUnit = null
endfunction
function TAR takes real x returns real
	local real TNR = GetRectMinX(bj_mapInitialPlayableArea)+ 150
	if (x < TNR) then
		return TNR
	endif
	set TNR = GetRectMaxX(bj_mapInitialPlayableArea) -150
	if (x > TNR) then
		return TNR
	endif
	return x
endfunction
function TBR takes real y returns real
	local real TNR = GetRectMinY(bj_mapInitialPlayableArea)+ 150
	if (y < TNR) then
		return TNR
	endif
	set TNR = GetRectMaxY(bj_mapInitialPlayableArea) -150
	if (y > TNR) then
		return TNR
	endif
	return y
endfunction
function TCR takes nothing returns boolean
	return((UnitAlive(GetFilterUnit()) and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false and(IsUnitType(GetFilterUnit(), UNIT_TYPE_ANCIENT) == false or CZX(GetUnitTypeId(GetFilterUnit())) or DRX(GetFilterUnit()) or GetUnitTypeId(GetFilterUnit())=='n00U' or GetUnitTypeId(GetFilterUnit())=='n00Y' or GetUnitTypeId(GetFilterUnit())=='n00Z' or GetUnitTypeId(GetFilterUnit())=='n0KU' or GetUnitTypeId(GetFilterUnit())=='n0KV' or GetUnitTypeId(GetFilterUnit())=='n0KW' or RHX(GetUnitTypeId(GetFilterUnit()))) and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer((LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 318))))))
endfunction
function TED takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 1)
	if ((GetUnitAbilityLevel(u, 'B08V') == 0)) then
		call UnitRemoveAbility(u,'B463')
	endif
	set u = null
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction

function TDR takes nothing returns nothing
	local real x1 = GetUnitX(GetEnumUnit())
	local real y1 = GetUnitY(GetEnumUnit())
	local real x2 = GetUnitX(LoadUnitHandle(HY, GetHandleId(GetTriggeringTrigger()), 318))
	local real y2 = GetUnitY(LoadUnitHandle(HY, GetHandleId(GetTriggeringTrigger()), 318))
	local real a = AngleBetweenXY(x2, y2, x1, y1)
	local real d = (GetDistanceBetween(x1, y1, x2, y2) -2)
	call SetUnitFacing(GetEnumUnit(), a)
	call SetUnitPosition(GetEnumUnit(), x2 + d * Cos(a * bj_DEGTORAD), y2 + d * Sin(a * bj_DEGTORAD))
	if GetUnitAbilityLevel(Q6V,'A30L')> 0 and KN then
		set KN = false
		call UnitDamageTargetEx(Q6V, GetEnumUnit(), 7, GetUnitState(GetEnumUnit(), UNIT_STATE_MAX_LIFE)/ 100 *(7))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayTarget.mdl", GetEnumUnit(), "origin"))
	endif
	if IsBearUnit(GetEnumUnit()) then
		call BWR(GetEnumUnit(),'B463', 0.06)
	endif
	
endfunction

function TKR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local group g
	local integer h = GetHandleId(t)
	local unit bh = LoadUnitHandle(HY, h, 318)
	local unit dummyCaster
	local real x
	local real y
	if GetTriggerEventId() == EVENT_UNIT_SPELL_ENDCAST and(GetSpellAbilityId()=='A1BX' or GetSpellAbilityId()=='A30L') then
		call KillUnit(bh)
		set dummyCaster = LoadUnitHandle(HY, h, 19)
		call UnitApplyTimedLife(LoadUnitHandle(HY, h, 250),'BTLF', 1)
		call UnitApplyTimedLife(LoadUnitHandle(HY, h, 251),'BTLF', 1)
		call UnitApplyTimedLife(LoadUnitHandle(HY, h, 252),'BTLF', 1)
		call UnitApplyTimedLife(LoadUnitHandle(HY, h, 253),'BTLF', 1)
		
		call CleanCurrentTrigger(LoadTriggerHandle(HY, h, 10))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(dummyCaster)
	elseif GetTriggerEvalCount(t)> 90 then
		set dummyCaster = LoadUnitHandle(HY, h, 19)
		call UnitApplyTimedLife(LoadUnitHandle(HY, h, 250),'BTLF', 1)
		call UnitApplyTimedLife(LoadUnitHandle(HY, h, 251),'BTLF', 1)
		call UnitApplyTimedLife(LoadUnitHandle(HY, h, 252),'BTLF', 1)
		call UnitApplyTimedLife(LoadUnitHandle(HY, h, 253),'BTLF', 1)
		call CleanCurrentTrigger(LoadTriggerHandle(HY, h, 10))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		
		call KillUnit(bh)
		call KillUnit(dummyCaster)
		call EXStopUnit(LoadUnitHandle(HY, h, 2))
	else
		set x = GetUnitX(bh)
		set y = GetUnitY(bh)
		set Q6V = LoadUnitHandle(HY, h, 2)
		set KN = GetTriggerEvalCount(t) == 20 or GetTriggerEvalCount(t) == 40 or GetTriggerEvalCount(t) == 60 or GetTriggerEvalCount(t) == 80
		set g = AllocationGroup(196)
		call GroupEnumUnitsInRange(g, x, y, 445, Condition(function TCR))
		call ForGroup(g, function TDR)
		call DeallocateGroup(g)
	endif
	set dummyCaster = null
	set bh = null
	set t = null
	set g = null
	return false
endfunction

function BlackHoleSealed takes nothing returns nothing
	if GetUnitAbilityLevel(GetTriggerUnit(),'B08V')> 0 and(IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) ) then
		if GetIssuedOrderId()>= 852008 and GetIssuedOrderId()<= 852013 then
			call EXStopUnit(GetTriggerUnit())
		endif
	endif
endfunction

function Z5V takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local trigger t = CreateTrigger()
	local trigger tt = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', x, y, 0)
	local unit bh = CreateUnit(GetOwningPlayer(whichUnit),'u004', x, y, 0)
	call SetUnitAbilityLevel(bh,'A0C0', GetUnitAbilityLevel(whichUnit,'A1BX')+ GetUnitAbilityLevel(whichUnit,'A30L'))
	if IsScourgePlayer(GetOwningPlayer(whichUnit)) then
		call UnitAddPermanentAbility(dummyCaster,'A0X4')
	else
		call UnitAddPermanentAbility(dummyCaster,'A0X3')
	endif
	call IssuePointOrderById(dummyCaster, 852473, x, y)
	call SaveUnitHandle(HY, h, 19, dummyCaster)
	call SaveUnitHandle(HY, h, 250, CreateUnit(GetOwningPlayer(whichUnit),'h06R', x, y, 0))
	call SaveUnitHandle(HY, h, 251, CreateUnit(GetOwningPlayer(whichUnit),'h06R', x, y, 0))
	call SaveUnitHandle(HY, h, 252, CreateUnit(GetOwningPlayer(whichUnit),'h06R', x, y, 0))
	call SaveUnitHandle(HY, h, 253, CreateUnit(GetOwningPlayer(whichUnit),'h06R', x, y, 0))
	call SaveUnitHandle(HY, h, 318, bh)
	call SaveUnitHandle(HY, h, 2, whichUnit)
	
	call SaveTriggerHandle(HY, h, 10 , tt)
	
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function TKR))
	
	call TriggerRegisterPlayerUnitEventBJ(tt, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(tt, EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(tt, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call TriggerAddCondition(tt, Condition(function BlackHoleSealed))
	
	set whichUnit = null
	set bh = null
	set t = null
	set tt = null
	set dummyCaster = null
endfunction
function KME takes nothing returns nothing
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	if (x != TAR(x) and y != TBR(y)) or RectContainsCoords(gg_rct_SentinelSpecialTerrain1, x, y) or RectContainsCoords(gg_rct_SentinelSpecialTerrain2, x, y) or RectContainsCoords(gg_rct_SentinelSpecialTerrain3, x, y) or RectContainsCoords(gg_rct_SentinelSpecialTerrain4, x, y) or RectContainsCoords(gg_rct_ScourgeSpecialTerrain1, x, y) or RectContainsCoords(gg_rct_ScourgeSpecialTerrain2, x, y) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "不能在这里释放黑洞")
	endif
endfunction
function MPX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A0C0')
endfunction
function TLR takes nothing returns nothing
	call UnitDamageTargetEx(GetTriggerUnit(), GetEnumUnit(), 1, S2)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\StaffOfPurification\\PurificationTarget.mdx", GetEnumUnit(), "chest"))
endfunction
function Z7V takes nothing returns nothing
	local group g = AllocationGroup(197)
	local unit trigUnit = GetTriggerUnit()
	local real x = GetUnitX(trigUnit)
	local real y = GetUnitY(trigUnit)
	local integer level = GetUnitAbilityLevel(trigUnit,'A0SC')
	local unit dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'e00E', x, y, 0)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\StaffOfPurification\\PurificationCaster.mdx", x, y))
	call UnitAddPermanentAbility(dummyCaster,'A0SD')
	call SetUnitAbilityLevel(dummyCaster,'A0SD', level)
	call IssuePointOrderById(dummyCaster, 852592, x, y)
	set S2 = level * 60 + 40
	call GroupEnumUnitsInRange(g, x, y, 425, Condition(function DFX))
	call ForGroup(g, function TLR)
	call DeallocateGroup(g)
	set dummyCaster = null
	set g = null
	set trigUnit = null
endfunction
function TMR takes unit u, integer level returns nothing
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call UnitAddAbility(d,'A42T')
	call SetUnitAbilityLevel(d,'A42T', level)
	call IssueTargetOrderById(d, 852095, u)
	set d = null
endfunction
function TPR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local integer level
	local unit targetUnit
	local real x1
	local real y1
	local real d
	local real a
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set targetUnit =(LoadUnitHandle(HY, h, 17))
		set d =(LoadReal(HY, h, 138))
		set x =(LoadReal(HY, h, 6))
		set y =(LoadReal(HY, h, 7))
		set a =(LoadReal(HY, h, 137))
		set x1 = GetUnitX(targetUnit)+ d /  15* Cos(a)
		set y1 = GetUnitY(targetUnit)+ d /  15* Sin(a)
		call SaveBoolean(OtherHashTable, GetHandleId(targetUnit), 99, true)
		call SetUnitPosition(targetUnit, x1, y1)
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl", x1, y1))
		if GetTriggerEvalCount(t)> 15 then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
		set targetUnit = null
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function TQR takes unit targetUnit, unit TSR returns nothing
	local trigger t
	local integer h
	if RFX(targetUnit) then
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function TPR))
	call SaveReal(HY, h, 6, GetUnitX(TSR))
	call SaveReal(HY, h, 7, GetUnitY(TSR))
	call SaveReal(HY, h, 138, GetDistanceBetween(GetUnitX(TSR), GetUnitY(TSR), GetUnitX(targetUnit), GetUnitY(targetUnit)))
	call SaveReal(HY, h, 137, Atan2(GetUnitY(TSR)-GetUnitY(targetUnit), GetUnitX(TSR)-GetUnitX(targetUnit)))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	set t = null
endfunction
function TTR takes unit whichUnit, unit targetUnit, integer level, integer A_R returns nothing
	if A_R == 1 then
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, level * 50 + 50)
		call CommonUnitAddStun(targetUnit, .75 + .75 * level, false)
	else
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, level * 50 + 150)
		call TMR(targetUnit, level)
	endif
endfunction
function TUR takes unit whichUnit, unit targetUnit returns nothing
	local unit dummyCaster = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddPermanentAbility(dummyCaster,'A0SF')
	call IssueTargetOrderById(dummyCaster, 852095, targetUnit)
	set dummyCaster = null
endfunction
function TWR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer level =(LoadInteger(HY, h, 5))
	local integer A_R =(LoadInteger(HY, h, 152))
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local lightning APX =(LoadLightningHandle(HY, h, 196))
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		if A_R == 2 and GetTriggerUnit() == whichUnit then
			call TQR(targetUnit, whichUnit)
		endif
		call DestroyLightning(APX)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call MoveLightning(APX, true, GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitX(targetUnit), GetUnitY(targetUnit))
		if GetDistanceBetween(GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitX(targetUnit), GetUnitY(targetUnit))> 600 then
			call DestroyLightning(APX)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call TTR(whichUnit, targetUnit, level, A_R)
			if A_R == 2 then
				call TQR(targetUnit, whichUnit)
			endif
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set APX = null
	return false
endfunction
function TYR takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local lightning APX = AddLightning("HWPB", true, GetUnitX(H4V), GetUnitY(H4V), GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()))
	call SetLightningColor(APX, 0, .7, 1, 1)
	call SaveLightningHandle(HY, h, 196,(APX))
	call SaveUnitHandle(HY, h, 2,(H4V))
	call SaveUnitHandle(HY, h, 30,((GetEnumUnit())))
	call SaveInteger(HY, h, 5,(H1V))
	call SaveInteger(HY, h, 152,(H2V))
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerRegisterDeathEvent(t, GetEnumUnit())
	call TriggerRegisterDeathEvent(t, H4V)
	call TriggerAddCondition(t, Condition(function TWR))
	call UnitDamageTargetEx(GetTriggerUnit(), GetEnumUnit(), 1, H3V)
	call TUR(GetTriggerUnit(), GetEnumUnit())
	set t = null
	set APX = null
endfunction
function TZR takes nothing returns boolean
	return(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()) and(IsUnitIllusion(GetFilterUnit()) or IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO)))!= null
endfunction
function Z8V takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'e00U', x, y, 0)
	local group g = AllocationGroup(198)
	local integer level = GetUnitAbilityLevel(trigUnit,'A0S8')
	local real N5O = 6
	local integer A_R = 1
	if level == 0 then
		set level = GetUnitAbilityLevel(trigUnit,'A1QP')
		set N5O = 8
		set A_R = 2
	endif
	call SetUnitAnimation(dummyCaster, "channel")
	call BUX(dummyCaster, N5O)
	set H4V = dummyCaster
	set H3V = level * 50 + 50
	set H1V = level
	set H2V = A_R
	set U2 = trigUnit
	call GroupEnumUnitsInRange(g, x, y, 400, Condition(function TZR))
	call ForGroup(g, function TYR)
	call DeallocateGroup(g)
	set g = null
	set dummyCaster = null
	set trigUnit = null
endfunction

function T5R takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), DK) == false then
		call GroupAddUnit(DK, GetEnumUnit())
		call UnitDamageTargetEx(U2, GetEnumUnit(), 1, S2)
	endif
endfunction
function T6R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local group g =(LoadGroupHandle(HY, h, 22))
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	local integer level =(LoadInteger(HY, h, 5))
	local real a =(LoadReal(HY, h, 13))
	local unit whichUnit =(LoadUnitHandle(HY, h, 14))
	local group T7R
	local real x
	local real y
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		if GetUnitTypeId(whichUnit)=='e00E' then
			set whichUnit = Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))]
		endif
		set U2 = CreateUnit(GetOwningPlayer(dummyCaster),'h06O', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
		call SetUnitScale(U2, 2.5, 2.5, 2.5)
		call KillUnit(U2)
		call SetUnitPosition(whichUnit, GetUnitX(dummyCaster), GetUnitY(dummyCaster))
		call ShowUnit(whichUnit, false)
		call ShowUnit(whichUnit, true)
		call SelectUnitAddForPlayer(whichUnit, GetOwningPlayer(whichUnit))
		set H5V[GetPlayerId(GetOwningPlayer(dummyCaster))]= null
		call DeallocateGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEvalCount(t)> 120 then
		set H5V[GetPlayerId(GetOwningPlayer(dummyCaster))]= null
		call DeallocateGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SetUnitScale(dummyCaster, 2.5, 2.5, 2.5)
		call KillUnit(dummyCaster)
	else
		set x = GetUnitX(dummyCaster)
		set y = GetUnitY(dummyCaster)
		set T7R = AllocationGroup(199)
		set DK = g
		set U2 = dummyCaster
		set S2 = level * 70
		call GroupEnumUnitsInRange(T7R, x, y, 250, Condition(function DUX))
		call ForGroup(T7R, function T5R)
		call DeallocateGroup(T7R)
		call SetUnitX(dummyCaster, CoordinateX50(x + 16.25 * Cos(a * bj_DEGTORAD)))
		call SetUnitY(dummyCaster, CoordinateY50(y + 16.25 * Sin(a * bj_DEGTORAD)))
	endif
	set t = null
	set g = null
	set T7R = null
	set dummyCaster = null
	set whichUnit = null
	return false
endfunction
function Z9V takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local group g = AllocationGroup(200)
	local unit trigUnit = GetTriggerUnit()
	local real x1 = GetUnitX(trigUnit)
	local real y1 = GetUnitY(trigUnit)
	local real x2 = GetSpellTargetX()
	local real y2 = GetSpellTargetY()
	local real a = AngleBetweenXY(x1, y1, x2, y2)
	local integer level = GetUnitAbilityLevel(trigUnit,'A0S9')
	local unit dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'h06O', x1, y1, a)
	call A5X(KC, x1, y1)
	call UnitAddPermanentAbility(GetTriggerUnit(),'A0SA')
	set H5V[GetPlayerId(GetOwningPlayer(trigUnit))]= dummyCaster
	call SetUnitScale(dummyCaster, 3.5, 3.5, 3.5)
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	call SaveInteger(HY, h, 5,(level))
	call SaveGroupHandle(HY, h, 22,(g))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerRegisterDeathEvent(t, dummyCaster)
	call TriggerAddCondition(t, Condition(function T6R))
	set t = null
	set dummyCaster = null
	set g = null
	set trigUnit = null
endfunction
function VVE takes nothing returns nothing
	local integer i = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))
	if H5V[i]== null then
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n037'))
	else
		call SetUnitScale(H5V[i], 2.5, 2.5, 2.5)
		call KillUnit(H5V[i])
	endif
endfunction
function T8R takes nothing returns nothing
	call SetUnitX(GetEnumUnit(), H6V)
	call SetUnitY(GetEnumUnit(), H7V)
endfunction
function VEE takes nothing returns nothing
	local destructable array dx
	local integer loop_i
	local integer loop_max
	local fogmodifier T9R
	local unit dummyCaster = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local location UVR
	local real x
	local real y
	local group g = AllocationGroup(201)
	if targetUnit == null then
		set UVR = GetSpellTargetLoc()
	else
		set UVR = GetUnitLoc(targetUnit)
	endif
	set x = GetLocationX(UVR)
	set y = GetLocationY(UVR)
	set H6V = x
	set H7V = y
	if IsUnitAlly(dummyCaster, GetOwningPlayer(targetUnit)) or not UnitHasSpellShield(GetSpellTargetUnit()) then
		set U2 = dummyCaster
		call GroupEnumUnitsInRange(g, x, y, 150, Condition(function DHX))
		call BEX(CreateFogModifierRadiusLocBJ(true, GetOwningPlayer(dummyCaster), FOG_OF_WAR_VISIBLE, UVR, 1000.), 2 + GetUnitAbilityLevel(dummyCaster,'A21E'))
		set loop_i = 1
		set loop_max = 8
		loop
		exitwhen loop_i > loop_max
			call RemoveDestructableToTimed(CreateDestructableLoc('B005', VIX(UVR, 150.,(I2R(loop_i)* 45.)), GetRandomReal(0, 360), 1, 0), 2 + GetUnitAbilityLevel(dummyCaster,'A21E'))
			set loop_i = loop_i + 1
		endloop
	endif
	call RemoveLocation(UVR)
	call ForGroup(g, function T8R)
	call DeallocateGroup(g)
	set T9R = null
	set dummyCaster = null
	set targetUnit = null
	set UVR = null
	set g = null
endfunction
function KPE takes nothing returns nothing
	if IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) and(LoadBoolean(HY,(GetHandleId(GetOwningPlayer(GetSpellTargetUnit()))), 139)) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n038'))
	endif
endfunction
function UER takes unit whichUnit, real x, real y returns nothing
	local unit u = CreateUnit(GetOwningPlayer(whichUnit),'efon', x, y, 0)
	call UnitApplyTimedLife(u,'BEfn', 60)
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\NightElf\\EntBirthTarget\\EntBirthTarget.mdl", u, "origin"))
	call SetUnitFlyHeight(u, 0, 0)
	set u = null
endfunction
function UXR takes unit u returns nothing
	local integer i = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A0A8')
	if i > 0 then
		call UnitAddPermanentAbilitySetLevel(u,'A3IN', i)
		call UnitAddPermanentAbility(u,'AId1'-1 + i)
	endif
endfunction
function UOR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local destructable d = LoadDestructableHandle(HY, GetHandleId(t), 0)
	call RemoveSavedBoolean(ObjectHashTable, GetHandleId(d),'0FON')
	call PauseTimer(t)
	call DestroyTimer(t)
	set d = null
	set t = null
endfunction
function URR takes destructable d returns nothing
	local timer t = CreateTimer()
	call SaveBoolean(ObjectHashTable, GetHandleId(d),'0FON', true)
	call SaveDestructableHandle(HY, GetHandleId(t), 0, d)
	call TimerStart(t, 5, false, function UOR)
	set t = null
endfunction
function UIR takes nothing returns nothing
	if (IsTreeDestructable(GetEnumDestructable()) or GetDestructableTypeId(GetEnumDestructable())=='B005') and H8V <= H9V and(GetDestructableLife(GetEnumDestructable())> 0 or(DN and LoadBoolean(ObjectHashTable, GetHandleId(GetEnumDestructable()),'0FON'))) then
		set H8V = H8V + 1
		call UER(GetTriggerUnit(), BN, CN)
		if not DN then
			call URR(GetEnumDestructable())
			call KillDestructable(GetEnumDestructable())
		endif
	elseif H8V > H9V then
		call KillDestructable(GetEnumDestructable())
	endif
endfunction
function OTE takes nothing returns nothing
	local integer lv = GetUnitAbilityLevel(GetTriggerUnit(),'A333')
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real d = 75 + 75 * lv + 25
	local rect r = Rect(x -d, y -d, x + d, y + d)
	set BN = x
	set CN = y
	set DN = GetUnitTypeId(GetTriggerUnit())=='e00E'
	set H8V = 0
	set H9V = lv
	call EnumDestructablesInRect(r, null, function UIR)
	call RemoveRect(r)
	set DN = false
	set r = null
endfunction
function S_E takes nothing returns nothing
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(GetTriggerUnit())) then
		call PingMinimapEx(x, y, 3, 255, 255, 255, false)
	endif
	call DestroyEffect(AddSpecialEffect("war3mapImported\\FurionTeleportTarget.mdx", x, y))
	call DestroyEffect(AddSpecialEffect("war3mapImported\\FurionTeleportTarget.mdx", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
endfunction
function UAR takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local real d = GetDistanceBetween(GetUnitX(targetUnit), GetUnitY(targetUnit), JXV, JOV)
	if d < JEV and UnitVisibleToPlayer(targetUnit, GetOwningPlayer(JRV)) then
		set JVV = GetEnumUnit()
		set JEV = d
	endif
	set targetUnit = null
endfunction
function VRE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(GetTriggerUnit(),'A1W8')
	local integer N0X ='A07X'
	local group g
	local unit dummyCaster
	call TGV( 13)
	if level == 0 then
		set level = GetUnitAbilityLevel(GetTriggerUnit(),'A1W9')
		set N0X ='A0AL'
	endif
	if targetUnit == null then
		set JVV = null
		set JRV = whichUnit
		set JEV = 999999
		set JXV = GetSpellTargetX()
		set JOV = GetSpellTargetY()
		set U2 = whichUnit
		set g = AllocationGroup(202)
		call GroupEnumUnitsInRange(g, 0, 0, 9999, Condition(function DHX))
		call ForGroup(g, function UAR)
		call DeallocateGroup(g)
		set targetUnit = JVV
		set g = null
	endif
	if targetUnit != null then
		set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
		call UnitAddPermanentAbility(dummyCaster, N0X)
		call SetUnitAbilityLevel(dummyCaster, N0X, level)
		call IssueTargetOrderById(dummyCaster, 852119, targetUnit)
		set dummyCaster = null
	endif
	set whichUnit = null
	set targetUnit = null
endfunction
function UNR takes nothing returns nothing
	if LoadInteger(HY, GetHandleId(SV),'A3JO')> 0 then
		if IsUnitType(SV, UNIT_TYPE_HERO) then
			call UnitApplyTimedLife(CreateUnit(Player(LoadInteger(HY, GetHandleId(SV),'A3JO')),'efo2', GetUnitX(SV), GetUnitY(SV), 0),'BEfn', 60)
		else
			call UnitApplyTimedLife(CreateUnit(Player(LoadInteger(HY, GetHandleId(SV),'A3JO')),'efon', GetUnitX(SV), GetUnitY(SV), 0),'BEfn', 60)
		endif
		call DestroyEffect(AddSpecialEffect("war3mapImported\\NatureExplosion.mdx", GetUnitX(SV), GetUnitY(SV)))
	endif
endfunction
// 自然之怒
function WrathOfNatureDamagedEvent takes nothing returns nothing
	if GetUnitAbilityLevel(DETarget,'A0AL')> 0 then
		call UnitAddAbilityToTimed(DETarget,'A3JO', 1, 4,'B3JO')
		call EUX(DETarget,'A3JO', GetPlayerId(GetOwningPlayer(DESource)), 4.01)
	endif
endfunction
function UCR takes unit whichUnit, unit targetUnit, integer level, boolean UDR returns nothing
	local real UFR
	local real UGR = .35
	call CNX(targetUnit,'A334', level, 3 + level,'B083')
	if UDR then
		set UGR = .65
	endif
	set UFR = .35
	call UnitDamageTargetEx(whichUnit, whichUnit, 1, GetWidgetLife(whichUnit)* UFR)
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, GetWidgetLife(targetUnit)* UGR)
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", whichUnit, "chest"))
	call DestroyEffect(AddSpecialEffectTarget("effects\\LifeBreak.mdx", targetUnit, "chest"))
endfunction
function UHR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local real GXR = LoadReal(HY, h, 23)
	local real GOR = LoadReal(HY, h, 24)
	local real x
	local real y
	local real sx = GetUnitX(whichUnit)
	local real sy = GetUnitY(whichUnit)
	local real tx = GetUnitX(targetUnit)
	local real ty = GetUnitY(targetUnit)
	local real a = Atan2(ty -sy, tx -sx)
	local integer level = LoadInteger(HY, h, 0)
	local boolean UDR = LoadInteger(HY, h, 1)=='A1B3'
	call SetUnitAnimationByIndex(whichUnit, LoadInteger(ObjectHashTable, GetUnitTypeId(whichUnit),'A1P8'))
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetDistanceBetween(GXR, GOR, tx, ty)> 1400 or C5X(whichUnit) then
		call SetUnitPathing(whichUnit, true)
		call DestroyEffect(LoadEffectHandle(HY, h, 175))
		call DestroyEffect(LoadEffectHandle(HY, h, 176))
		call UnitRemoveAbility(whichUnit,'A0ST')
		call SetUnitTimeScale(whichUnit, 1.)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetDistanceBetween(sx, sy, tx, ty)< 125 then
		call SetUnitPathing(whichUnit, true)
		call DestroyEffect(LoadEffectHandle(HY, h, 175))
		call DestroyEffect(LoadEffectHandle(HY, h, 176))
		call UnitRemoveAbility(whichUnit,'A0ST')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SetUnitTimeScale(whichUnit, 1.)
		if targetUnit != null and UnitIsDead(targetUnit) == false then
			call IssueTargetOrderById(whichUnit, 851983, targetUnit)
			call UCR(whichUnit, targetUnit, level, UDR)
		endif
	else
		call SetUnitPathing(whichUnit, false)
		set GXR = tx
		set GOR = ty
		call SaveReal(HY, h, 23, GXR * 1.)
		call SaveReal(HY, h, 24, GOR * 1.)
		set x = sx + 15* Cos(a)
		set y = sy + 15* Sin(a)
		if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
			call SaveBoolean(OtherHashTable, GetHandleId(whichUnit), 99, true)
		endif
		call SetUnitPosition(whichUnit, x, y)
		call SetUnitFacing(whichUnit, a * bj_RADTODEG)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function UJR takes unit whichUnit, unit targetUnit, integer id, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .015, true)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerAddCondition(t, Condition(function UHR))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveInteger(HY, h, 0, level)
	call SaveInteger(HY, h, 1, id)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveReal(HY, h, 23, GetUnitX(targetUnit)* 1.)
	call SaveReal(HY, h, 24, GetUnitY(targetUnit)* 1.)
	call SaveEffectHandle(HY, h, 175, AddSpecialEffectTarget("war3mapImported\\LifeBreakCharge.mdx", whichUnit, "hand right alternate"))
	call SaveEffectHandle(HY, h, 176, AddSpecialEffectTarget("war3mapImported\\LifeBreakCharge.mdx", whichUnit, "hand left alternate"))
	call SetUnitPathing(whichUnit, false)
	call UnitAddPermanentAbility(whichUnit,'A0ST')
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A0ST', false)
	call SetUnitAnimationByIndex(whichUnit, LoadInteger(ObjectHashTable, GetUnitTypeId(whichUnit),'A1P8'))
	call FKX(whichUnit, false)
	call FJX(whichUnit)
	call SetUnitTimeScale(whichUnit, 3.)
	set t = null
endfunction
function UKR takes nothing returns nothing
	//	local string IDO = StringCase("124", false)
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	local integer id = LoadInteger(HY, h, 0)
	local integer level = LoadInteger(HY, h, 1)
	if GetUnitAbilityLevel(whichUnit,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(whichUnit), 0) then
		set whichUnit = LoadUnitHandle(HY, GetHandleId(whichUnit), 0)
	endif
	call UJR(whichUnit, targetUnit, id, level)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function VIE takes nothing returns nothing
	local timer t
	local integer h
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		call SaveInteger(HY, h, 0, GetSpellAbilityId())
		call SaveInteger(HY, h, 1, GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
		call TimerStart(t, 0, false, function UKR)
		set t = null
	endif
endfunction
function ULR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer level =(LoadInteger(HY, h, 5))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer DRO = GerHeroMainAttributesValue(targetUnit)
	local real L2O = GetWidgetLife(targetUnit)
	local real IQX = GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)
	local real YVX
	local integer c = LoadInteger(HY, h, 0)+ 1
	if L2O / IQX > .4 then
		set YVX =(level * 1.)/ 4 * .2 * DRO + 2 * level
	else
		set YVX =(level * 1. / 4 + .25)* .6 * DRO + 2 * level
	endif
	set YVX = YVX / 8.
	if c > 16 * 8. or GetUnitAbilityLevel(targetUnit,'A0QO') == 0 or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call RemoveSavedHandle(HY, GetHandleId(targetUnit),'A0QP')
		call UnitRemoveAbility(targetUnit,'A0QO')
		call UnitRemoveAbility(targetUnit,'B080')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SetWidgetLife(targetUnit, L2O + YVX)
		call SaveInteger(HY, h, 0, c)
	endif
	set targetUnit = null
	set t = null
	return false
endfunction
function VAE takes nothing returns nothing
	local unit targetUnit = GetSpellTargetUnit()
	local unit whichUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A0QP')
	local trigger t
	local integer h
	if HaveSavedHandle(HY, GetHandleId(targetUnit),'A0QP') then
		set t = LoadTriggerHandle(HY, GetHandleId(targetUnit),'A0QP')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, GetHandleId(targetUnit),'A0QP', t)
		call TriggerRegisterTimerEvent(t, 1 / 8., true)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function ULR))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
	endif
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY, h, 0, 0)
	call UnitAddPermanentAbility(targetUnit,'A0QO')
	call SetUnitAbilityLevel(targetUnit,'A0QO', level)
	set targetUnit = null
	set whichUnit = null
	set t = null
endfunction
function UMR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	if GetTriggerEvalCount(t)> 8 or UnitIsDead(targetUnit) then
		call DestroyEffect(LoadEffectHandle(HY, h, 31))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 5 * GetUnitAbilityLevel(whichUnit,'A0QN'))
	endif
	set t = null
	set targetUnit = null
	set whichUnit = null
	return false
endfunction
function UPR takes unit R8X, unit targetUnit returns nothing
	local integer hu = GetHandleId(R8X)
	local integer h
	local trigger t
	if LoadBoolean(ObjectHashTable, hu,'A0QN'+ 1) then
		call UnitRemoveAbility(R8X,'A40H')
		call SaveBoolean(ObjectHashTable, hu,'A0QN'+ 1, false)
	endif
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function UMR))
	set h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2, R8X)
	call SaveUnitHandle(HY, h, 30, targetUnit)
	call SetWidgetLife(R8X, RMaxBJ(GetWidgetLife(R8X) -15, 1))
	call SaveEffectHandle(HY, h, 31, AddSpecialEffectTarget("Abilities\\Spells\\Other\\BreathOfFire\\BreathOfFireDamage.mdl", targetUnit, "chest"))
	set t = null
endfunction
function UQR takes unit R8X, unit targetUnit returns nothing
	if GetUnitAbilityLevel(R8X,'A0QN')> 0 and not IsUnitSilence(R8X) and IsUnitType(targetUnit, UNIT_TYPE_MECHANICAL) == false then
		if LoadBoolean(ObjectHashTable, GetHandleId(R8X),'A0QN') then
			call UPR(R8X, targetUnit)
		endif
		if LoadBoolean(ObjectHashTable, GetHandleId(R8X),'A0QN'+ 1) then
			if LoadUnitHandle(ObjectHashTable, GetHandleId(R8X),'A0QN'+ 1) == targetUnit then
				call UPR(R8X, targetUnit)
			else
				call SaveBoolean(ObjectHashTable, GetHandleId(R8X),'A0QN'+ 1, false)
				call UnitRemoveAbility(R8X,'A40H')
			endif
		endif
	endif
endfunction
function USR takes unit R8X, unit targetUnit returns nothing
	if LoadBoolean(ObjectHashTable, GetHandleId(R8X),'A0QN'+ 1) then
		if LoadUnitHandle(ObjectHashTable, GetHandleId(R8X),'A0QN'+ 1)!= targetUnit then
			call SaveBoolean(ObjectHashTable, GetHandleId(R8X),'A0QN'+ 1, false)
			call UnitRemoveAbility(R8X,'A40H')
		endif
	endif
endfunction
function UTR takes unit trigUnit, integer O3O returns nothing
	local integer i = 0
	loop
		if i != O3O / 3 and GetUnitAbilityLevel(trigUnit, CG[i])> 0 then
			call UnitRemoveAbility(trigUnit, CG[i])
		endif
		set i = i + 1
	exitwhen i > 28
	endloop
	if GetUnitAbilityLevel(trigUnit, CG[O3O / 3]) == 0 then
		call UnitAddPermanentAbility(trigUnit, CG[O3O / 3])
	endif
endfunction
function UUR takes nothing returns boolean
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	local real UWR = GetWidgetLife(trigUnit)
	local integer UYR
	local integer i
	local integer level = GetUnitAbilityLevel(trigUnit,'A0QQ')
	local boolean UZR = LoadBoolean(HY, h, 319)
	local integer U_R
	local integer U2V
	if IsUnitType(trigUnit, UNIT_TYPE_HERO) and level > 0 and UnitIsDead(trigUnit) == false then
		set UYR = R2I( 100 * UWR / GetUnitState(trigUnit, UNIT_STATE_MAX_LIFE))
		set i = IMaxBJ(IMinBJ(R2I( 100 -UYR)/ 7, 14), 1)
		set U2V =(2 + level)* i
		set U_R =(6 + 2 * level)* i
		if GetUnitAbilityLevel(trigUnit,'A36D') == 1 then
			set U2V = 0
			set U_R = 0
		endif
		if U2V != LoadInteger(HY, h, 1) then
			call UTR(trigUnit, U2V)
			call SaveInteger(HY, h, 1, U2V)
		endif
		if U_R != LoadInteger(HY, h, 0) then
			if U_R -LoadInteger(HY, h, 0)> 0 then
				call UnitAddStateBonus(trigUnit, U_R -LoadInteger(HY, h, 0), UNIT_BONUS_ATTACK)
			else
				call UnitReduceStateBonus(trigUnit, LoadInteger(HY, h, 0)-U_R, UNIT_BONUS_ATTACK)
			endif
			call SaveInteger(HY, h, 0, U_R)
		endif
		if UYR < 40 then
			if UZR == false then
				call SaveBoolean(HY, h, 319, true)
				call SaveEffectHandle(HY, h, 175, AddSpecialEffectTarget("Abilities\\Spells\\Orc\\TrollBerserk\\HeadhunterWEAPONSLeft.mdl", trigUnit, "left weapon"))
				call SaveEffectHandle(HY, h, 176, AddSpecialEffectTarget("effects\\HeadhunterWEAPONSRight_NoSound.mdx", trigUnit, "right weapon"))
			endif
		else
			if UZR then
				call SaveBoolean(HY, h, 319, false)
				call DestroyEffect(LoadEffectHandle(HY, h, 175))
				call DestroyEffect(LoadEffectHandle(HY, h, 176))
			endif
		endif
	endif
	set trigUnit = null
	return false
endfunction
function MYE takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function UUR))
	call SaveUnitHandle(HY, GetHandleId(t), 14, GetTriggerUnit())
	call SaveBoolean(HY, GetHandleId(t), 319, false)
	call SaveInteger(HY, GetHandleId(t), 0, 0)
	set t = null
	set CG[1]='A2PD'
	set CG[2]='A2PA'
	set CG[3]='A2P9'
	set CG[4]='A2P8'
	set CG[5]='A2PE'
	set CG[6]='A2PC'
	set CG[7]='A2PB'
	set CG[8]='A2OW'
	set CG[9]='A2OX'
	set CG[10]='A2OY'
	set CG[11]='A2P0'
	set CG[12]='A2P1'
	set CG[13]='A2P2'
	set CG[14]='A2P7'
	set CG[15]='A2P6'
	set CG[16]='A2P5'
	set CG[17]='A2P4'
	set CG[18]='A2P3'
	set CG[19]='A2OZ'
	set CG[20]='A2PF'
	set CG[21]='A2PG'
	set CG[22]='A2T8'
	set CG[23]='A2T9'
	set CG[24]='A2T7'
	set CG[25]='A46N'
	set CG[26]='A46O'
	set CG[27]='A46P'
	set CG[28]='A46Q'
	call SetAllPlayerAbilityUnavailable(CG[1])
	call SetAllPlayerAbilityUnavailable(CG[2])
	call SetAllPlayerAbilityUnavailable(CG[3])
	call SetAllPlayerAbilityUnavailable(CG[4])
	call SetAllPlayerAbilityUnavailable(CG[5])
	call SetAllPlayerAbilityUnavailable(CG[6])
	call SetAllPlayerAbilityUnavailable(CG[7])
	call SetAllPlayerAbilityUnavailable(CG[8])
	call SetAllPlayerAbilityUnavailable(CG[9])
	call SetAllPlayerAbilityUnavailable(CG[10])
	call SetAllPlayerAbilityUnavailable(CG[11])
	call SetAllPlayerAbilityUnavailable(CG[12])
	call SetAllPlayerAbilityUnavailable(CG[13])
	call SetAllPlayerAbilityUnavailable(CG[14])
	call SetAllPlayerAbilityUnavailable(CG[15])
	call SetAllPlayerAbilityUnavailable(CG[16])
	call SetAllPlayerAbilityUnavailable(CG[17])
	call SetAllPlayerAbilityUnavailable(CG[18])
	call SetAllPlayerAbilityUnavailable(CG[19])
	call SetAllPlayerAbilityUnavailable(CG[20])
	call SetAllPlayerAbilityUnavailable(CG[21])
	call SetAllPlayerAbilityUnavailable(CG[22])
	call SetAllPlayerAbilityUnavailable(CG[23])
	call SetAllPlayerAbilityUnavailable(CG[24])
	call SetAllPlayerAbilityUnavailable(CG[25])
	call SetAllPlayerAbilityUnavailable(CG[26])
	call SetAllPlayerAbilityUnavailable(CG[27])
	call SetAllPlayerAbilityUnavailable(CG[28])
endfunction

function VCE takes nothing returns nothing
endfunction
function U3R takes timer t, integer WFV returns nothing
	local integer i = 0
	loop
		call DestroyUbersplat(LoadUbersplatHandle(ObjectHashTable, WFV, i + 500))
		call DestroyEffect(LoadEffectHandle(ObjectHashTable, WFV, i + 3))
		set i = i + 1
	exitwhen i == 14
	endloop
	call RemoveUnit(LoadUnitHandle(ObjectHashTable, WFV, 1))
	call DeallocateGroup(LoadGroupHandle(ObjectHashTable, WFV, 2))
	call DestroyTimerAndFlushHT_P(t)
	set t = null
endfunction
function U4R takes nothing returns boolean
	local unit t = GetFilterUnit()
	local unit u = Temp__ArrayUnit[0]
	local player p = GetOwningPlayer(t)
	local group g
	if IsUnitEnemy(u, p) and IsAliveNotStrucNotWard(t) and IsUnitMagicImmune(t) == false then
		set g = LoadGroupHandle(ObjectHashTable, XK[0], 2)
		if IsUnitInGroup(t, g) == false then
			call GroupAddUnit(g, t)
			call UnitDamageTargetEx(u, t, 1, XK[1])
			call CommonUnitAddStun(t,(XK[2]* 1.)* .4 + .6, false)
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathMissile.mdl", GetUnitX(t), GetUnitY(t)))
		endif
		set g = null
	endif
	set u = null
	set t = null
	return false
endfunction
function U5R takes nothing returns nothing
	local ubersplat u = null
	local timer t = GetExpiredTimer()
	local integer count
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(ObjectHashTable, WFV, 0)+ 1
	local integer UJV = LoadInteger(ObjectHashTable, WFV, 1)
	local real I3X
	local real ax
	local real ay
	local real x
	local real y
	if UYX == UJV then
		call U3R(t, WFV)
		set t = null
		return
	endif
	call SaveInteger(ObjectHashTable, WFV, 0, UYX)
	if UYX < 14 then
		set I3X = LoadReal(ObjectHashTable, WFV, 0)
		set x = LoadReal(ObjectHashTable, WFV, 1)+ 100 * UYX * Cos(I3X)
		set y = LoadReal(ObjectHashTable, WFV, 2)+ 100 * UYX * Sin(I3X)
		call SaveEffectHandle(ObjectHashTable, WFV, 2 + UYX, AddSpecialEffect("effects\\IcePath.mdx", x, y))
		set u = CreateUbersplat(x, y, "IPTH", 255, 255, 255, 255, false, false)
		call SetUbersplatRenderAlways(u, true)
		call SaveUbersplatHandle(ObjectHashTable, WFV, 500 + UYX, u)
		set t = null
		set u = null
		return
	endif
	set Temp__ArrayUnit[0]= LoadUnitHandle(ObjectHashTable, WFV, 0)
	set Temp__ArrayUnit[1]= LoadUnitHandle(ObjectHashTable, WFV, 1)
	set XK[2]= LoadInteger(ObjectHashTable, WFV, 3)
	set XK[1]= LoadInteger(ObjectHashTable, WFV, 2)
	set XK[0]= WFV
	set I3X = LoadReal(ObjectHashTable, WFV, 0)
	set x = LoadReal(ObjectHashTable, WFV, 1)
	set y = LoadReal(ObjectHashTable, WFV, 2)
	set ax = Cos(I3X)
	set ay = Sin(I3X)
	set count = 0
	loop
		call GroupEnumUnitsInRange(AK, x, y, 175, Condition(function U4R))
		set x = x + 100 * ax
		set y = y + 100 * ay
		set count = count + 1
	exitwhen count == 13
	endloop
	set t = null
endfunction
function Jakiro_Icepath_Start2 takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local integer WFV = GetHandleId(t)
	local integer WUV = GetUnitAbilityLevel(u,'A0O6')
	local real x = GetWidgetX(u)
	local real y = GetWidgetY(u)
	call SaveUnitHandle(ObjectHashTable, WFV, 0, u)
	set u = CreateUnit(Player(15),'e00E', 0, 0, 0)
	call SaveUnitHandle(ObjectHashTable, WFV, 1, u)
	call SaveGroupHandle(ObjectHashTable, WFV, 2, AllocationGroup(203))
	call SaveInteger(ObjectHashTable, WFV, 0, 0)
	call SaveInteger(ObjectHashTable, WFV, 1, WUV * 8 + 12)
	call SaveInteger(ObjectHashTable, WFV, 2, 50)
	call SaveInteger(ObjectHashTable, WFV, 3, WUV)
	call SaveReal(ObjectHashTable, WFV, 0, Atan2(GetSpellTargetY()-y, GetSpellTargetX()-x))
	call SaveReal(ObjectHashTable, WFV, 1, x)
	call SaveReal(ObjectHashTable, WFV, 2, y)
	call TimerStart(t, .05, true, function U5R)
	set t = null
	set u = null
endfunction
function MHX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A0OB')
	call AddAbilityIDToPreloadQueue('A0OC')
	call AddAbilityIDToPreloadQueue('A0OA')
	call AddAbilityIDToPreloadQueue('A0OE')
endfunction
function WVR takes unit u, unit t returns nothing
	local real a = GetRandomReal(0, 360)
	local real x = GetUnitX(t)+ 50 * Cos(a * bj_DEGTORAD)
	local real y = GetUnitY(t)+ 50 * Sin(a * bj_DEGTORAD)
	local real damage = GetRandomReal(200, 225)
	call SetUnitX(u, x)
	call SetUnitY(u, y)
	call SetUnitFacing(u, bj_RADTODEG * Atan2(GetUnitY(t)-GetUnitY(u), GetUnitX(t)-GetUnitX(u)))
	call SetUnitAnimation(u, "Attack")
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl", u, "chest"))
	if XFX(GetOwningPlayer(t)) == false and IsUnitType(t, UNIT_TYPE_ANCIENT) == false then
		set damage = 99999
	endif
	call UnitDamageTargetEx(u, t, 2, damage)
endfunction
function WXR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 14))
	local unit target =(LoadUnitHandle(HY, h, 17))
	call WVR(u, target)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set u = null
	set target = null
	return false
endfunction
function WOR takes unit trigUnit returns nothing
	local group g = AllocationGroup(206)
	set U2 = trigUnit
	call GroupEnumUnitsInRange(g, GetUnitX(trigUnit), GetUnitY(trigUnit), 450, Condition(function FXX))
	set U2 = GroupPickRandomUnit(g)
	if U2 != null then
		call WVR(trigUnit, U2)
	endif
	call DeallocateGroup(g)
	set g = null
endfunction

function WGR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call SetUnitAnimationByIndex(whichUnit, 4)
	set t = null
	set whichUnit = null
	return false
endfunction
function KQE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerAddCondition(t, Condition(function WGR))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	set t = null
	set whichUnit = null
endfunction
function WHR takes nothing returns nothing
	call UnitDamageTargetEx(JAV, GetEnumUnit(), 8,(55. + 25. * JNV)* .25)
endfunction
function WJR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer count = GetTriggerEvalCount(t)
	local group g
	if count == 16 or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		//call SetUnitPathing(whichUnit, true)
		call CleanCurrentTrigger(t)
	else
		set U2 = whichUnit
		set JAV = whichUnit
		set JNV = LoadInteger(HY, h, 0)
		set g = AllocationGroup(207)
		call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 275, Condition(function DHX))
		call ForGroup(g, function WHR)
		call DeallocateGroup(g)
		set g = null
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function VLE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerRegisterDeathEvent(t, GetTriggerUnit())
	//call SetUnitPathing(GetTriggerUnit(), false)
	call TriggerAddCondition(t, Condition(function WJR))
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(GetTriggerUnit(),'A05G'))
	call SaveUnitHandle(HY, h, 2,(GetTriggerUnit()))
	if (GetUnitTypeId(GetTriggerUnit())!='Nbbc' and GetUnitTypeId(GetTriggerUnit())!='Opgh') then
		call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\SpinFX2.mdx", GetTriggerUnit(), "origin")))
	endif
	call TriggerEvaluate(t)
	call EPX(GetTriggerUnit(), 4252, 5)
	call FKX(GetTriggerUnit(), false)
	call FJX(GetTriggerUnit())
	set t = null
endfunction
function WKR takes nothing returns boolean
	return GetUnitTypeId(GetSummonedUnit())=='o00C' or GetUnitTypeId(GetSummonedUnit())=='o01G' or GetUnitTypeId(GetSummonedUnit())=='o01H' or GetUnitTypeId(GetSummonedUnit())=='o01I'
endfunction
function WLR takes nothing returns nothing
	call SetUnitAbilityLevel(GetSummonedUnit(),'A058', GetUnitAbilityLevel(GetSummoningUnit(),'A047'))
endfunction
function MQX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function WKR))
	call TriggerAddAction(t, function WLR)
	set t = null
endfunction
function WMR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real x1
	local real y1
	local real x2
	local real y2
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or(GetTriggerEventId() == EVENT_UNIT_DAMAGED and GetEventDamage()> 2 and XFX(GetOwningPlayer(GetEventDamageSource()))) then
		call DestroyEffect((LoadEffectHandle(HY, h, 175)))
		call DestroyEffect((LoadEffectHandle(HY, h, 176)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()!= EVENT_UNIT_DAMAGED and GetTriggerEventId()!= EVENT_WIDGET_DEATH then
		set x1 = GetUnitX(whichUnit)
		set y1 = GetUnitY(whichUnit)
		set x2 = GetUnitX(targetUnit)
		set y2 = GetUnitY(targetUnit)
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x1, y1))
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl", x2, y2))
		call EPX(targetUnit, 4410, 1)
		call SetUnitPosition(targetUnit, GetUnitX(whichUnit), GetUnitY(whichUnit))
		call DestroyEffect(LoadEffectHandle(HY, h, 175))
		call DestroyEffect(LoadEffectHandle(HY, h, 176))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function WPR takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local real d = GetDistanceBetween(GetUnitX(targetUnit), GetUnitY(targetUnit), JDV, JFV)
	if d < JCV and LoadBoolean(HY, GetHandleId(GetOwningPlayer(targetUnit)), 139) == false then
		set JBV = targetUnit
		set JCV = d
	endif
	set targetUnit = null
endfunction
function VSE takes nothing returns nothing
	local unit targetUnit = GetSpellTargetUnit()
	local unit whichUnit = GetTriggerUnit()
	local trigger t
	local integer h
	local real N5O
	local group g = null
	local integer level = GetUnitAbilityLevel(whichUnit,'A10U')
	if targetUnit == null then
		set JBV = null
		set JCV = 999999
		set JDV = GetSpellTargetX()
		set JFV = GetSpellTargetY()
		set U2 = whichUnit
		set g = AllocationGroup(208)
		call GroupEnumUnitsInRange(g, 0, 0, 9999, Condition(function D4X))
		call GroupRemoveUnit(g, whichUnit)
		call ForGroup(g, function WPR)
		call DeallocateGroup(g)
		set targetUnit = JBV
		set g = null
	endif
	if targetUnit != null then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerRegisterDeathEvent(t, whichUnit)
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
		call TriggerRegisterTimerEvent(t, 6 -level, false)
		call TriggerAddCondition(t, Condition(function WMR))
		call SaveUnitHandle(HY, h, 2,(whichUnit))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SaveEffectHandle(HY, h, 175,(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTo.mdl", whichUnit, "origin")))
		call SaveEffectHandle(HY, h, 176,(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTo.mdl", targetUnit, "origin")))
	endif
	set targetUnit = null
	set whichUnit = null
	set t = null
endfunction

function KSE takes nothing returns nothing
	if GetSpellTargetUnit()!= null and LoadBoolean(HY, GetHandleId(GetOwningPlayer(GetSpellTargetUnit())), 139) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetSpellTargetUnit()), "该玩家已禁用来自盟友的帮助。")
	endif
endfunction

// 法力流失的AbilityId和Buff
function GetManaLeakAbilityFromLevel takes integer lv returns integer
	if lv == 1 then
		return'A10Z'
	elseif lv == 2 then
		return'A111'
	elseif lv == 3 then
		return'A10Y'
	elseif lv == 4 then
		return'A110'
	endif
	return 0
endfunction
function GetManaLeakBuffFromLevel takes integer lv returns integer
	if lv == 1 then
		return'B09M'
	elseif lv == 2 then
		return'B09N'
	elseif lv == 3 then
		return'B09O'
	elseif lv == 4 then
		return'B09L'
	endif
	return 0
endfunction
function ManaLeak_Fx takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 5))
	local real lastX =(LoadReal(HY, h, 23))
	local real lastY =(LoadReal(HY, h, 24))
	local real x = GetUnitX(targetUnit)
	local real y = GetUnitY(targetUnit)
	local real distance = GetDistanceBetween( lastX, lastY, x, y )//SquareRoot(lastX -x)*(lastX -x)+(lastY -y)*(lastY -y)
	local real leakValue =(.0005)* distance * GetUnitState(targetUnit, UNIT_STATE_MAX_MANA)
	local integer evalCount = GetTriggerEvalCount(trig)
	if IsUnitMagicImmune(targetUnit) then
		set leakValue = 0
	endif
	if distance > 300 then
		set leakValue = 0
	endif
	if leakValue > 1 and ModuloInteger(evalCount, 3) == 0 then
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\WingedSerpentMissile\\WingedSerpentMissile.mdl", targetUnit, "chest"))
	endif
	if leakValue > 0 then
		// debug call SingleDebug( "法力流失 移动距离" + R2S( distance ) + " 流失魔法值：" + R2S( leakValue ) )
		call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)-leakValue)
	endif
	call SaveReal(HY, h, 23,(x)* 1.)
	call SaveReal(HY, h, 24,(y)* 1.)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or evalCount == (level + 4)* 10 or GetUnitAbilityLevel(targetUnit, GetManaLeakAbilityFromLevel(level)) == 0 then
		call UnitRemoveAbility(targetUnit, GetManaLeakAbilityFromLevel(level))
		call UnitRemoveAbility(targetUnit, GetManaLeakBuffFromLevel(level))
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(trig)
	elseif GetUnitState(targetUnit, UNIT_STATE_MANA)< 1 then
		call CommonUnitAddStun(targetUnit, 1 + .5 * level, false)
		call UnitRemoveAbility(targetUnit, GetManaLeakAbilityFromLevel(level))
		call UnitRemoveAbility(targetUnit, GetManaLeakBuffFromLevel(level))
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(trig)
	endif
	set trig = null
	set targetUnit = null
	return false
endfunction
function ManaLeak_CallBack takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger trig = CreateTrigger()
	local integer h = GetHandleId(trig)
	local integer level = GetUnitAbilityLevel(spellUnit,'A10X')
	call UnitAddPermanentAbility(targetUnit, GetManaLeakAbilityFromLevel(level))
	call SaveUnitHandle(HY, h, 17, targetUnit)
	//call SaveUnitHandle(HY, h, 2, spellUnit)
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h, 23,(GetUnitX(targetUnit)* 1.))
	call SaveReal(HY, h, 24,(GetUnitY(targetUnit)* 1.))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("effects\\BasicWaterFlash.mdx", targetUnit, "chest")))
	call TriggerRegisterTimerEvent(trig, .1, true)
	call TriggerRegisterDeathEvent(trig, targetUnit)
	call TriggerAddCondition(trig, Condition(function ManaLeak_Fx))
	set spellUnit = null
	set targetUnit = null
	set trig = null
endfunction
function SpellEffect__ManaLeak takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call ManaLeak_CallBack()
	endif
endfunction
function WZR takes nothing returns nothing
	local integer h = GetHandleId(GetExpiredTimer())
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit d = LoadUnitHandle(HY, h, 1)
	if GetUnitTypeId(u)=='H06X' and UnitAlive(u) and GetWidgetLife(u)> 0 and IsUnitHidden(u) == false then
		if IsUnitHidden(d) then
			call ShowUnit(d, true)
			call UnitRemoveAbility(d, 'Aloc')
			call UnitAddAbility(d, 'Aloc')
		endif
		call SetUnitPosition(d, GetUnitX(u), GetUnitY(u))
	else
		if IsUnitHidden(d) == false then
			call ShowUnit(d, false)
		endif
	endif
	set u = null
	set d = null
endfunction
function W_R takes unit u returns nothing
	local unit d = CreateUnit(GetOwningPlayer(u),'hSPR', GetUnitX(u), GetUnitY(u), 0)
	local timer t = CreateTimer()
	call TimerStart(t, .25, true, function WZR)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveUnitHandle(HY, GetHandleId(t), 1, d)
	call SaveBoolean(ObjectHashTable, GetHandleId(u),'SPRT', true)
	set t = null
	set d = null
endfunction
function V0E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'QM01')
	local player p = GetOwningPlayer(u)
	local boolean W0R = GetUnitTypeId(u)!='H06X'
	call SetPlayerAbilityAvailable(p,'A11X', W0R)
	call SetPlayerAbilityAvailable(p,'A10U', W0R)
	call SetUnitAbilityLevel(u,'A11X', level)
	call SetUnitAbilityLevel(u,'A10U', level)
	if W0R then
		if LoadBoolean(ObjectHashTable, GetHandleId(u),'SPRT')!= true then
			call W_R(u)
		endif
	endif
	set u = null
endfunction
function FWE takes nothing returns nothing
	call SaveBoolean(ObjectHashTable, GetHandleId(GetTriggerUnit()),'A085', false)
endfunction
function JNE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer id = GetUnitTypeId(u)
	if id <'H06W' or id >'H06Y' then
		call SaveBoolean(ObjectHashTable, GetHandleId(u),'A085', false)
	endif
	set u = null
endfunction
function W4R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real W5R =(LoadReal(HY, h, 242))
	call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)+ W5R)
	call UnitAddAbilityToTimed(targetUnit,'A3DU'-1 + LoadInteger(HY, h, 5), 1, 12,'B3DU')
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIim\\AIimTarget.mdl", targetUnit, "origin"))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set targetUnit = null
	set t = null
	return false
endfunction
function V_E takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(trigUnit,'A112'))
	call SaveReal(HY, h, 242,((75 * GetUnitAbilityLevel(trigUnit,'A112'))* 1.))
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function W4R))
	set t = null
	set trigUnit = null
	set targetUnit = null
endfunction
function W6R takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local real x = GetUnitX(targetUnit)
	local real y = GetUnitY(targetUnit)
	local real a = Atan2(y -JJV, x -JHV)
	set x = CoordinateX50(x + 40 * Cos(a))
	set y = CoordinateY50(y + 40 * Sin(a))
	call KillTreeByCircle(x, y, 150)
	call SetUnitX(targetUnit, x)
	call SetUnitY(targetUnit, y)
	set targetUnit = null
endfunction
function W7R takes nothing returns nothing
	call UnitAddAbilityToTimed(GetEnumUnit(),'A3PZ', 1, 3 + JGV,'B09K')
endfunction
function W8R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player p =(LoadPlayerHandle(HY, h, 54))
	local real sx =(LoadReal(HY, h, 189))
	local real sy =(LoadReal(HY, h, 190))
	local integer CVX =(LoadInteger(HY, h, 59))
	local group g =(LoadGroupHandle(HY, h, 22))
	local integer count = GetTriggerEvalCount(t)
	set JHV = sx
	set JJV = sy
	call ForGroup(g, function W6R)
	if count == 10 then
		set JGV = CVX
		set E3 = p
		call ForGroup(g, function W7R)
		call DeallocateGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set p = null
	set g = null
	return false
endfunction
function W9R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player p =(LoadPlayerHandle(HY, h, 54))
	local real sx =(LoadReal(HY, h, 189))
	local real sy =(LoadReal(HY, h, 190))
	local integer CVX =(LoadInteger(HY, h, 59))
	local group g =(LoadGroupHandle(HY, h, 22))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .04, true)
	call TriggerAddCondition(t, Condition(function W8R))
	call SavePlayerHandle(HY, h, 54,(p))
	call SaveReal(HY, h, 189,((sx)* 1.))
	call SaveReal(HY, h, 190,((sy)* 1.))
	call SaveGroupHandle(HY, h, 22,(g))
	call SaveInteger(HY, h, 59,(CVX))
	set t = null
	set p = null
	set g = null
	return false
endfunction
function V1E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local group g = AllocationGroup(210)
	local unit whichUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	call KillUnit(CreateUnit(GetOwningPlayer(whichUnit),'h06P', x, y, 0))
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, x, y, 700, Condition(function DQX))
	call TriggerRegisterTimerEvent(t, .4, false)
	call TriggerAddCondition(t, Condition(function W9R))
	call SavePlayerHandle(HY, h, 54,(GetOwningPlayer(whichUnit)))
	call SaveReal(HY, h, 189,((x)* 1.))
	call SaveReal(HY, h, 190,((y)* 1.))
	call SaveGroupHandle(HY, h, 22,(g))
	call SaveInteger(HY, h, 59, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	call EnableAttackEffectByTime(I, 8)
	set t = null
	set g = null
	set whichUnit = null
endfunction
function YVR takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u
	local integer YER
	if GetGameTime()> LoadReal(HY, h, 0) then
		set u = LoadUnitHandle(HY, h, 0)
		call RemoveSavedHandle(HY, GetHandleId(u),'A18X')
		call UnitReduceStateBonus(u, LoadInteger(HY, h, 1), UNIT_BONUS_ATTACK)
		call J8X(u, LoadInteger(HY, h, 2))
		set YER = LoadInteger(HY, h, 0)
		call DestroyEffect(LoadEffectHandle(HY, h, 10+ 1))
		call DestroyEffect(LoadEffectHandle(HY, h, 20 + 1))
		if YER >= 2 then
			call DestroyEffect(LoadEffectHandle(HY, h, 10+ 2))
			call DestroyEffect(LoadEffectHandle(HY, h, 20 + 2))
		endif
		if YER >= 3 then
			call DestroyEffect(LoadEffectHandle(HY, h, 10+ 3))
			call DestroyEffect(LoadEffectHandle(HY, h, 20 + 3))
		endif
		call UnitRemoveAbility(u,'C021')
		call UnitRemoveAbility(u,'D021')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set u = null
	endif
	set t = null
endfunction
function YXR takes unit u returns nothing
	local trigger t = LoadTriggerHandle(HY, GetHandleId(u),'A18X')
	local integer h
	local integer YER
	local integer as
	local integer ms
	if t == null then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .5, true)
		call TriggerAddCondition(t, Condition(function YVR))
		call SaveUnitHandle(HY, h, 0, u)
		call UnitAddPermanentAbility(u,'C021')
		call SaveTriggerHandle(HY, GetHandleId(u),'A18X', t)
	else
		set h = GetHandleId(t)
	endif
	call SaveReal(HY, h, 0, GetGameTime()+ 9)
	set YER = LoadInteger(HY, h, 0)
	if YER < 3 then
		call SaveInteger(HY, h, 0, YER + 1)
		set as = 20 + 10*(GetUnitAbilityLevel(u,'A18X'))
		set ms = 4 + 1 *(GetUnitAbilityLevel(u,'A18X'))
		call UnitAddStateBonus(u, as, UNIT_BONUS_ATTACK)
		call J6X(u, ms)
		call SaveInteger(HY, h, 1, LoadInteger(HY, h, 1)+ as)
		call SaveInteger(HY, h, 2, LoadInteger(HY, h, 2)+ ms)
		call SaveEffectHandle(HY, h, 10+ YER + 1, AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl", u, "head"))
		call SaveEffectHandle(HY, h, 20 + YER + 1, AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl", u, "chest"))
	endif
	set t = null
endfunction
function YOR takes nothing returns boolean
	if GetUnitAbilityLevel(GetTriggerUnit(),'A36D') == 0 and(X8R(GetSpellAbilityId()) or(Mode__BalanceOff and OER(GetSpellAbilityId()))) then
		call YXR(GetTriggerUnit())
	endif
	return false
endfunction
function M4E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function YOR))
	set t = null
endfunction
function KTE takes nothing returns nothing
	if IsUnitMagicImmune(GetSpellTargetUnit()) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n0LR'))
	endif
endfunction
function YRR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	local unit u
	local group g = AllocationGroup(211)
	local real GEX = 1.6
	local real CJR = 40 + 40 * level
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, LoadReal(HY, h, 10), LoadReal(HY, h, 11), 225+ 20, Condition(function DJX))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call UnitDamageTargetEx(whichUnit, u, 1, CJR)
		if UnitAlive(u) then
			call CommonUnitAddStun(u, GEX, false)
		endif
		call GroupRemoveUnit(g, u)
	endloop
	call KillTreeByCircle(LoadReal(HY, h, 10), LoadReal(HY, h, 11), 225)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set whichUnit = null
	set t = null
endfunction
function V2E takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .5, false, function YRR)
	call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
	call SaveReal(HY, h, 10, GetSpellTargetX())
	call SaveReal(HY, h, 11, GetSpellTargetY())
	set t = null
endfunction
function YIR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	local real damageValue = 0
	local integer level = LoadInteger(HY, h, 0)
	if level == 1 then
		set damageValue = 450
	elseif level == 2 then
		set damageValue = 650
	elseif level == 3 then
		set damageValue = 850
	endif
	call UnitDamageTargetEx(whichUnit, targetUnit, LoadInteger(HY, h, 1), damageValue)
	call DestroyTimerAndFlushHT_HY(t)
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function V5E takes nothing returns nothing
	local timer t
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		call TimerStart(t, .25, false, function YIR)
		call SaveUnitHandle(HY, GetHandleId(t), 0, GetTriggerUnit())
		call SaveUnitHandle(HY, GetHandleId(t), 1, GetSpellTargetUnit())
		call SaveInteger(HY, GetHandleId(t), 0, GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
		if GetSpellAbilityId()=='A01P'then
			call SaveInteger(HY, GetHandleId(t), 1, 1)
		else
			call SaveInteger(HY, GetHandleId(t), 1, 7)
		endif
	endif
	set t = null
endfunction
function YAR takes nothing returns nothing
	local integer ETX
	local integer WFV
	local unit u = GetFilterUnit()
	if IsUnitType(u, UNIT_TYPE_HERO) and IsUnitAlly(u, Temp__Player) and UnitAlive(u) then
		call GroupAddUnit(BK, u)
		if IsUnitInGroup(u, IK) == false then
			set WFV = GetHandleId(u)
			set ETX = StringHash("lunar_count")
			call UnitAddAbilityLevel1ToTimed(u,'C032','D032',-1)
			call UnitAddStateBonus(u, XK[1], UNIT_BONUS_DAMAGE)
			call SaveInteger(ObjectHashTable, WFV, ETX, LoadInteger(ObjectHashTable, WFV, ETX)+ 1)
			set u = null
			return
		endif
		call GroupRemoveUnit(IK, u)
		if LoadBoolean(ObjectHashTable, 99999, 99998) then
			call UnitAddStateBonus(u, XK[1], UNIT_BONUS_DAMAGE)
			call UnitReduceStateBonus(u, XK[0], UNIT_BONUS_DAMAGE)
		endif
	endif
	set u = null
endfunction
function YNR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer ETX = StringHash("lunar_count")
	local integer WFV = GetHandleId(t)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	set IK = LoadGroupHandle(ObjectHashTable, WFV, 1)
	set XK[0]= LoadInteger(ObjectHashTable, WFV, 0)
	if UnitIsDead(u) then
		set u = FirstOfGroup(IK)
		if u != null then
			loop
				set WFV = GetHandleId(u)
				call SaveInteger(ObjectHashTable, WFV, ETX, LoadInteger(ObjectHashTable, WFV, ETX)-1)
				if LoadInteger(ObjectHashTable, WFV, ETX) == 0 then
					call WHV(u,'D032')
				endif
				call UnitReduceStateBonus(u, XK[0], UNIT_BONUS_DAMAGE)
				call GroupRemoveUnit(IK, u)
				set u = FirstOfGroup(IK)
			exitwhen u == null
			endloop
		endif
		set u = null
		set t = null
		return
	endif
	set XK[1]= GetUnitAbilityLevel(u,'A062')* 8 + 6
	set Temp__Player = GetOwningPlayer(u)
	if XK[0]!= XK[1] then
		call SaveBoolean(ObjectHashTable, 99999, 99998, true)
		call SaveInteger(ObjectHashTable, WFV, 0, XK[1])
	else
		call SaveBoolean(ObjectHashTable, 99999, 99998, false)
	endif
	call GroupEnumUnitsInRange(AK, GetWidgetX(u), GetWidgetY(u), 925, Condition(function YAR))
	loop
		set u = FirstOfGroup(IK)
	exitwhen u == null
		set WFV = GetHandleId(u)
		call SaveInteger(ObjectHashTable, WFV, ETX, LoadInteger(ObjectHashTable, WFV, ETX)-1)
		if LoadInteger(ObjectHashTable, WFV, ETX) == 0 then
			call WHV(u,'D032')
		endif
		call UnitReduceStateBonus(u, XK[0], UNIT_BONUS_DAMAGE)
		call GroupRemoveUnit(IK, u)
	endloop
	loop
		set u = FirstOfGroup(BK)
	exitwhen u == null
		call GroupRemoveUnit(BK, u)
		call GroupAddUnit(IK, u)
	endloop
	set t = null
endfunction
function L6E takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local integer WFV = GetHandleId(t)
	call SaveBoolean(ObjectHashTable, 99999, 99998, true)
	set IK = CreateGroup()
	set Temp__Player = GetOwningPlayer(u)
	set XK[0]= 0
	set XK[1]= GetUnitAbilityLevel(u,'A062')* 8 + 6
	call SaveUnitHandle(ObjectHashTable, WFV, 0, u)
	call SaveGroupHandle(ObjectHashTable, WFV, 1, IK)
	call SaveInteger(ObjectHashTable, WFV, 0, XK[1])
	call GroupEnumUnitsInRange(AK, GetWidgetX(u), GetWidgetY(u), 925, Condition(function YAR))
	loop
		set u = FirstOfGroup(BK)
	exitwhen u == null
		call GroupRemoveUnit(BK, u)
		call GroupAddUnit(IK, u)
	endloop
	call SetPlayerTechResearched(Temp__Player,'R00I', 1)
	call TimerStart(t, .25, true, function YNR)
	set u = null
	set t = null
endfunction
function YBR takes nothing returns boolean
	local unit fu = GetFilterUnit()
	local real N5X = GetUnitDistanceEx(fu, AL)
	if fu != AL and IsUnitEnemy(fu, GetOwningPlayer(IL)) and UnitIsDead(fu) == false and IsUnitEthereal(fu) == false and N5X < CL and(GetUnitAbilityLevel(fu,'A04R') == 0) and GetUnitAbilityLevel(fu,'Avul') == 0 and UnitVisibleToPlayer(fu, GetOwningPlayer(IL)) and IsUnitInRangeXY(fu, GetUnitX(AL), GetUnitY(AL), 460) then
		set CL = N5X
		set NL = fu
	endif
	set fu = null
	return false
endfunction

function MoonGlaivePickTargetUnit takes unit source, unit target, real range, group targGroup returns unit
	local player p 			 = GetOwningPlayer(source)
	local group  g 			 = AllocationGroup(213)
	local real   x           = GetUnitX(target)
	local real   y           = GetUnitY(target)
	local real   distance
	local real   minDistance = 9999.
	local unit   newTarget   = null
	local unit   firstUnit   = null

	call GroupEnumUnitsInRange(g, x, y, range + MAX_UNIT_COLLISION, null)
	call GroupRemoveUnit(g, target)

	loop
		set firstUnit = FirstOfGroup(g)
		exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)

		// 敌对 存活 在范围内 非虚无 非无敌 非守卫 可见 不在目标单位组内
		if IsUnitEnemy(firstUnit, p) and UnitAlive(firstUnit) and not IsUnitInGroup(firstUnit, targGroup) and IsUnitInRangeXY(firstUnit, x, y, range) and not IsUnitEthereal(firstUnit) and not IsUnitInvulnerable(firstUnit) and GetUnitAbilityLevel(firstUnit,'A04R') == 0 and UnitVisibleToPlayer(firstUnit, p) then
			set distance = GetUnitDistanceEx(firstUnit, target)
			if distance < minDistance then
				set minDistance = distance
				set newTarget   = firstUnit
			endif
		endif

	endloop

	call DeallocateGroup(g)
	set g = null

	set Temp__ArrayUnit[1] = newTarget
	set newTarget = null
	set firstUnit = null

	return Temp__ArrayUnit[1]
endfunction

function MoonGlaiveOnMissileHit takes nothing returns nothing
	local integer hu
	local trigger t
	local integer ht
	local unit    dummy       = LoadUnitHandle(HY, GetHandleId(GetTriggeringTrigger()), 45)
	local integer h 		  = GetHandleId(dummy)
	local integer count       = LoadInteger(HY, h, 0)-1
	local unit    u           = LoadUnitHandle(HY, h, 0)
	local unit    target      = MissileHitTargetUnit
	local real    damageValue = LoadReal(HY, h, 0)
	local group   targGroup   = LoadGroupHandle(HY, h, 1)

	local player  p           = GetOwningPlayer(u)
	local real    range       = 500.
	local unit    newTarget   = null

	call FlushChildHashtable(HY, h)
	call UnitDamageTargetEx(u, target, 2, damageValue)

	if count > 0 then

		call GroupAddUnit(targGroup, target)

		set newTarget = MoonGlaivePickTargetUnit(u, target, range, targGroup)

		if newTarget == null then
			call GroupClear(targGroup)
			set newTarget = MoonGlaivePickTargetUnit(u, target, range, targGroup)
		endif

		if newTarget != null then
			set t = LaunchMissileByUnitDummy(target, newTarget,'h999', "MoonGlaiveOnMissileHit", 880, true)
			set ht = GetHandleId(t)
			set hu = GetHandleId(LoadUnitHandle(HY, ht, 45))
			call SaveInteger(HY, hu, 0, count)
			call SaveReal(HY, hu, 0, damageValue * .6)
			call SaveUnitHandle(HY, hu, 0, u)
			call SaveGroupHandle(HY, hu, 1, targGroup)
			set t = null
		else
			call DeallocateGroup(targGroup)
		endif
	else
		call DeallocateGroup(targGroup)
	endif

	set u = null
	set target = null
	set dummy = null
	
	set newTarget = null
	set targGroup = null
endfunction

function MoonGlaiveOnMissileLaunch takes unit u, unit target, real d returns nothing
	local group   targGroup = AllocationGroup(213)
	local integer hu
	local trigger t         = null
	local integer ht
	local real    range     = 500.
	local unit    newTarget
	
	call GroupAddUnit(targGroup, target)
	set newTarget = MoonGlaivePickTargetUnit(u, target, range, targGroup)

	if newTarget != null then
		set t = LaunchMissileByUnitDummy(target, newTarget, 'h999', "MoonGlaiveOnMissileHit", 880, true)
		set ht = GetHandleId(t)
		set hu = GetHandleId(LoadUnitHandle(HY, ht, 45))
		call SaveInteger(HY, hu, 0, GetUnitAbilityLevel(u,'P098'))
		call SaveReal(HY, hu, 0, d * .65)
		call SaveUnitHandle(HY, hu, 0, u)
		call SaveGroupHandle(HY, hu, 1, targGroup)
		set t = null
	else
		call DeallocateGroup(targGroup)
	endif
	set newTarget = null
	set targGroup = null
endfunction
function YGR takes nothing returns nothing
	call SaveBoolean(ObjectHashTable,'DARK', 0, false)
	call SuspendTimeOfDay(false)
	call SetFloatGameState(GAME_STATE_TIME_OF_DAY, LoadReal(ObjectHashTable,'DARK', 1))
endfunction
function YHR takes real SYV, boolean b returns nothing
	local real YJR = GetGameTime()
	local real YKR = LoadReal(ObjectHashTable,'DARK', 0)
	local real endTime
	local real YLR
	local real YMR
	set YLR = SYV / 20.
	if YJR + SYV > YKR then
		call TimerStart(ZC, SYV + .1, false, function YGR)
		call SaveReal(ObjectHashTable,'DARK', 0, YJR + SYV)
		call SuspendTimeOfDay(true)
		if LoadBoolean(ObjectHashTable,'DARK', 0) == false then
			set YJR = GetFloatGameState(GAME_STATE_TIME_OF_DAY)
			set YMR = YJR + YLR
			if YMR >= 24 then
				set YMR = YMR -24.
			endif
			call SaveReal(ObjectHashTable,'DARK', 1, YMR)
		endif
		// debug call SingleDebug(R2S(YMR)+ " " + R2S(YLR))
		if b then
			call SetFloatGameState(GAME_STATE_TIME_OF_DAY, 0)
		endif
		call SaveBoolean(ObjectHashTable,'DARK', 0, true)
	endif
endfunction
function YPR takes nothing returns boolean
	if DPX() and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) then
		if (LoadInteger(HY,(JKV),(GetHandleId(GetFilterUnit()))))< Q2 then
			return true
		endif
	endif
	return false
endfunction
function YQR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 14))
	local integer ZQE =(LoadInteger(HY, h, 217))
	local integer WAR =(LoadInteger(HY, h, 216))
	local integer YSR =(LoadInteger(HY, h, 218))
	local group g = AllocationGroup(214)
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local unit targetUnit
	local boolean b
	local unit YTR = LoadUnitHandle(HY, h, 0)
	if LoadBoolean(HY, h, 0) then
		set b = true
		set x = LoadReal(HY, h, 0)
		set y = LoadReal(HY, h, 1)
	else
		set b = UnitIsDead(whichUnit) == false
		set x = GetUnitX(whichUnit)
		set y = GetUnitY(whichUnit)
	endif
	set U2 = whichUnit
	set Q2 = YSR
	set JKV = GetHandleId(t)
	call GroupEnumUnitsInRange(g, x, y, 700, Condition(function YPR))
	set targetUnit = GroupPickRandomUnit(g)
	call DeallocateGroup(g)
	if b and targetUnit != null and(GetUnitTypeId((targetUnit))!='u009') then
		call SaveInteger(HY,(JKV),(GetHandleId(targetUnit)),((LoadInteger(HY,(JKV),(GetHandleId(targetUnit))))+ 1))
		call ARX("effects\\Eclipse.mdx", targetUnit, "origin", 3)
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 300)
	elseif b then
		set x = x + GetRandomInt(-350, 350)
		set y = y + GetRandomInt(-350, 350)
		call ABX("effects\\Eclipse.mdx", x, y, 1.5)
	endif
	if (GetTriggerEvalCount(t)+ 1) == WAR or b == false then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set g = null
	set targetUnit = null
	return false
endfunction
function V8E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer WXV
	local integer YUR = 4
	local integer Z6X
	if GetSpellAbilityId()=='A054' then
		set WXV = 2 + 3 * GetUnitAbilityLevel(whichUnit,'A054')
		call SaveUnitHandle(HY, h, 0, whichUnit)
		set Z6X = 5 + GetUnitAbilityLevel(whichUnit,'A054')
		call E1X("Abilities\\Spells\\NightElf\\Tranquility\\Tranquility.mdx", GetUnitX(whichUnit), GetUnitY(whichUnit), 2)
	else
		set WXV = 6 * GetUnitAbilityLevel(whichUnit,'A00U')
		set Z6X = 60
		call SaveUnitHandle(HY, h, 0, whichUnit)
		if GetSpellTargetUnit() == null or IsUnitEnemy(GetSpellTargetUnit(), GetOwningPlayer(whichUnit)) then
			call SaveBoolean(HY, h, 0, true)
			call SaveReal(HY, h, 0, GetSpellTargetX())
			call SaveReal(HY, h, 1, GetSpellTargetY())
			call UnitApplyTimedLife(CreateUnit(GetOwningPlayer(whichUnit),'o01P', GetSpellTargetX(), GetSpellTargetY(), 0),'BTLF', 7)
			call E1X("Abilities\\Spells\\NightElf\\Tranquility\\Tranquility.mdx", GetSpellTargetX(), GetSpellTargetY(), 2)
		else
			set whichUnit = GetSpellTargetUnit()
			call EYX("Units\\NightElf\\Owl\\Owl.mdl", whichUnit, "origin", 4)
			call E1X("Abilities\\Spells\\NightElf\\Tranquility\\Tranquility.mdx", GetUnitX(whichUnit), GetUnitY(whichUnit), 2)
		endif
	endif
	call SaveInteger(HY,(h), 217,(YUR))
	call SaveInteger(HY,(h), 216,(WXV))
	call SaveInteger(HY,(h), 218,(Z6X))
	call SaveUnitHandle(HY,(h), 14,(whichUnit))
	call TriggerRegisterTimerEvent(t, .6, true)
	call TriggerAddCondition(t, Condition(function YQR))
	call TriggerEvaluate(t)
	call YHR(10., true)
	set t = null
	set whichUnit = null
endfunction
function V9E takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetUnitFacing(GetTriggerUnit()))
	call UnitAddAbility(d,'A3IE')
	call SetUnitAbilityLevel(d,'A3IE', GetUnitAbilityLevel(GetTriggerUnit(),'A042'))
	call IssueTargetOrderById(d, 852231, GetSpellTargetUnit())
	set d = null
endfunction
function YWR takes nothing returns nothing
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl", GetEnumUnit(), "origin"))
endfunction
function YYR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	call UnitDamageTargetEx(trigUnit, targetUnit, 1, LoadInteger(HY, h, 0)* 56.25)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set trigUnit = null
	set targetUnit = null
	return false
endfunction
function YZR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	local group g// = AllocationGroup(215)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local integer level = LoadInteger(HY, h, 0)
	if not UnitAlive(targetUnit) then
		set JMV = trigUnit
		set g = AllocationGroup(216)
		set U2 = trigUnit
		call GroupEnumUnitsInRange(g, GetUnitX(trigUnit), GetUnitY(trigUnit), 450, Condition(function DGX))
		set targetUnit = EXX(g, GetUnitX(trigUnit), GetUnitY(trigUnit))
		call DeallocateGroup(g)
		set g = null
	endif
	call DestroyEffect(LoadEffectHandle(HY, h, 32))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl", targetUnit, "origin"))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 14, trigUnit)
	call SaveUnitHandle(HY, h, 30, targetUnit)
	call SaveInteger(HY, h, 0, level)
	call TriggerRegisterTimerEvent(t, .5, false)
	call TriggerAddCondition(t, Condition(function YYR))
	set t = null
	set trigUnit = null
	set targetUnit = null
	return false
endfunction
function Y_R takes nothing returns nothing
	call UnitDamageTargetEx(JMV, GetEnumUnit(), 1, JLV)
endfunction
function Y0R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	local group g = LoadGroupHandle(HY, h, 22)
	set JLV = LoadInteger(HY, h, 0)* 75
	set JMV = trigUnit
	call ForGroup(g, function Y_R)
	call DeallocateGroup(g)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set trigUnit = null
	set g = null
	return false
endfunction
function Y1R takes nothing returns nothing
	if GetUnitDistanceEx(U2, GetEnumUnit())<= 650 then
		call GroupAddUnit(DK, GetEnumUnit())
	endif
endfunction
function xingluo takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local group g = AllocationGroup(217)
	local integer level = GetUnitAbilityLevel(u,'A0KV')+ GetUnitAbilityLevel(u,'A3UG')
	local unit targetUnit
	set U2 = u
	set JMV = u
	set DK = AllocationGroup(218)
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 900, Condition(function DGX))
	call ForGroup(g, function Y1R)
	call DeallocateGroup(g)
	set g = DK
	call ForGroup(g, function YWR)
	call SaveGroupHandle(HY, h, 22, g)
	call SaveUnitHandle(HY, h, 14, u)
	call SaveInteger(HY, h, 0, level)
	call TriggerRegisterTimerEvent(t, .5, false)
	call TriggerAddCondition(t, Condition(function Y0R))
	set JMV = u
	set g = AllocationGroup(219)
	set U2 = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 450, Condition(function DGX))
	set targetUnit = EXX(g, GetUnitX(u), GetUnitY(u))
	call DeallocateGroup(g)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 14, u)
	call SaveUnitHandle(HY, h, 30,(targetUnit))
	call SaveInteger(HY, h, 0, level)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Starfall\\StarfallCaster.mdl", u, "origin"))
	call TriggerRegisterTimerEvent(t, 1, false)
	call TriggerAddCondition(t, Condition(function YZR))
	set t = null
	set g = null
	set u = null
	set targetUnit = null
endfunction
function EVE takes nothing returns nothing
	call xingluo(GetTriggerUnit())
endfunction
function XJCAX takes nothing returns nothing
	local integer h = GetHandleId(GetExpiredTimer())
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer c = LoadInteger(HY, h, 0)
	local integer level
	local group g
	if LoadBoolean(HY, h, 0) then
		call RemoveSavedBoolean(HY, h, 0)
		call TimerStart(GetExpiredTimer(), 1., true, function XJCAX)
	endif
	if c > 0 then
		set c = c -1
		call SaveInteger(HY, h, 0, c)
	endif
	if c == 0 and GetUnitAbilityLevel(u,'A3UF')> 0 and(GetUnitAbilityLevel(u,'A0KV')> 0 or GetUnitAbilityLevel(u,'A3UG')> 0) and(GetWidgetLife(u)> 0.405 and not IsUnitType(u, UNIT_TYPE_DEAD)) and GetUnitAbilityLevel(u,'A36D') == 0 then
		set g = AllocationGroup(220)
		set U2 = u
		call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 650, Condition(function DGX))
		if FirstOfGroup(g)!= null and not DXX(u) then
			call xingluo(u)
			call SaveInteger(HY, h, 0, 12)
			call YDWESetUnitAbilityState(u,'A3UF', 1, 12.01)
		endif
		call DeallocateGroup(g)
	endif
	set u = null
endfunction
function XJVXX takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = U2
	local integer h = GetHandleId(t)
	call TimerStart(t, 0, false, function XJCAX)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveInteger(HY, h, 0, 0)
	call SaveBoolean(HY, h, 0, true)
	call SaveTimerHandle(HY, GetHandleId(u),'A3UF', t)
	set u = null
	set t = null
endfunction
function Y2R takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitAlly(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit()))))
endfunction
function Y3R takes nothing returns nothing
	call UnitRemoveAbility(GetEnumUnit(),'A37P')
	call UnitRemoveAbility(GetEnumUnit(),'A37Q')
	call UnitRemoveAbility(GetEnumUnit(),'A37R')
	call UnitRemoveAbility(GetEnumUnit(),'A3AF')
	call UnitRemoveAbility(GetEnumUnit(),'B3AF')
endfunction
function Y4R takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group g =(LoadGroupHandle(HY, h, 220))
	call ForGroup(g, function Y3R)
	call DeallocateGroup(g)
	call DestroyTimerAndFlushHT_HY(t)
	set t = null
	set g = null
endfunction
function EEE takes nothing returns nothing
	local unit R3O = GetTriggerUnit()
	local group g = AllocationGroup(221)
	local timer t = CreateTimer()
	local integer Y6R = GetHandleId(t)
	local integer lv = GetUnitAbilityLevel(R3O,('A0KU'))
	local real Y7R = 15
	local string s
	local unit u
	call GroupEnumUnitsInRange(g, 0, 0, 9999, Condition(function Y2R))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		set s = ""
		call L6X(u)
		call UnitAddAbilityToTimed(u,'A37P'-1 + lv, 1, 15., 0)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Invisibility\\InvisibilityTarget.mdl", u, "chest"))
		if IsPlayerAlly(GetOwningPlayer(u), LocalPlayer) or IsObserverPlayer(LocalPlayer) then
			set s = "Moonlight_Shadow.mdx"
		endif
		call EYX(s, u, "overhead", 15.)
		call GroupRemoveUnit(g, u)
	endloop
	call SaveGroupHandle(HY,(Y6R), 220,(g))
	call TimerStart(t, Y7R, false, function Y4R)
	set t = null
	set g = null
	set u = null
	set R3O = null
endfunction
function Y8R takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitAlly(GetFilterUnit(), GetOwningPlayer(GW))))
endfunction
function Y9R takes nothing returns nothing
	local unit trigUnit = GetEnumUnit()
	local unit dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'e01R', 0, 0, 0)
	call UnitAddPermanentAbility(dummyCaster,'A0LO')
	call SetUnitAbilityLevel(dummyCaster,'A0LO', TI)
	call UnitApplyTimedLife(dummyCaster,'BTLF', 10)
	set trigUnit = null
	set dummyCaster = null
endfunction
function ZVR takes unit trigUnit, integer level returns nothing
	local group g = AllocationGroup(222)
	set GW = trigUnit
	set TI = level
	call GroupEnumUnitsInRange(g, GetUnitX(trigUnit), GetUnitY(trigUnit), 800, Condition(function Y8R))
	call ForGroup(g, function Y9R)
	call DeallocateGroup(g)
	set g = null
endfunction
function ZER takes unit trigUnit returns nothing
	local integer h = GetHandleId(trigUnit)
	local string ZXR = LoadStr(HY, h, 206)
	local string ZOR = OrderId2String(LoadInteger(HY, h, 211))
	local real tx
	local real ty
	local unit targetUnit
	local trigger t = LoadTriggerHandle(HY, h, 204)
	local boolean ZRR = not(LoadBoolean(HY, h, 207))
	local boolean ZIR = LoadBoolean(HY, h, 208)
	call DisableTrigger(t)
	call IssueImmediateOrderById(trigUnit, 851972)
	if ZXR == "Target"and(ZRR or ZIR) then
		set targetUnit = LoadUnitHandle(HY, h, 215)
		call IssueTargetOrder(trigUnit, ZOR, targetUnit)
	elseif ZXR == "Point"and(ZRR or ZIR) then
		set tx = LoadReal(HY, h, 209)
		set ty = LoadReal(HY, h, 210)
		call IssuePointOrder(trigUnit, ZOR, tx, ty)
	elseif (ZRR or ZIR) then
		call IssueImmediateOrder(trigUnit, "OrderString")
	endif
	call SaveBoolean(HY, h, 208, false)
	call EnableTrigger(t)
	set targetUnit = null
	set t = null
endfunction
function ZAR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	local real ZNR = LoadReal(HY, h, 212)
	local real ZBR = LoadReal(HY, h, 213)
	local real a = LoadReal(HY, h, 13)
	local real targetX = GetUnitX(trigUnit)+ 30 * Cos(a * bj_DEGTORAD)
	local real targetY = GetUnitY(trigUnit)+ 30 * Sin(a * bj_DEGTORAD)
	local real ZCR = 200
	local real ZDR =(1 -ZNR / ZBR)* ZCR * 2
	if ZDR > ZCR then
		set ZDR = ZCR * 2 -ZDR
	endif
	if O0X(trigUnit) == false then
		call SetUnitFlyHeight(trigUnit, GetUnitDefaultFlyHeight(trigUnit)+ RMaxBJ(ZDR, 0), 0)
	endif
	if IsUnitType(trigUnit, UNIT_TYPE_HERO) then
		call SaveBoolean(OtherHashTable, GetHandleId(trigUnit), 99, true)
	endif
	call SetUnitX(trigUnit, CoordinateX50(targetX))
	call SetUnitY(trigUnit, CoordinateY50(targetY))
	call SetUnitFacing(trigUnit, a)
	call SaveReal(HY, h, 212,(ZNR -20)* 1.)
	if ZDR < 1 and ZNR -ZBR != 0 then
		call SaveBoolean(HY, GetHandleId(trigUnit), 214, false)
		call SetUnitFacing(trigUnit, a)
		call SetUnitAnimation(trigUnit, "stand")
		call SetUnitPathing(trigUnit, true)
		//call ZER(trigUnit) 也许想让单位恢复动作
		if O0X(trigUnit) == false then
			call SetUnitFlyHeight(trigUnit, GetUnitDefaultFlyHeight(trigUnit), 0)
		endif
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	endif
	set t = null
	set trigUnit = null
endfunction
function EXE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(trigUnit,('A0LN'))
	local real GIX = 350 + 50 * level
	local real a = GetUnitFacing(trigUnit)
	local real sx = GetUnitX(trigUnit)
	local real sy = GetUnitY(trigUnit)
	local real tx = CoordinateX50(sx + GIX * Cos(a * bj_DEGTORAD))
	local real ty = CoordinateY50(sy + GIX * Sin(a * bj_DEGTORAD))
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local trigger ZFR = LoadTriggerHandle(HY, GetHandleId(trigUnit), 204)
	set GIX = SquareRoot((sx -tx)*(sx -tx)+(sy -ty)*(sy -ty))
	call ShowUnit(trigUnit, false)
	call ShowUnit(trigUnit, true)
	if LocalPlayer== GetOwningPlayer(trigUnit) then
		call ClearSelection()
		call SelectUnit(trigUnit, true)
	endif
	if GIX > 100  then
		call UnitAddPermanentAbility(trigUnit,'Amrf')
		call UnitRemoveAbility(trigUnit,'Amrf')
		call SetUnitPathing(trigUnit, false)
		call DisableTrigger(ZFR)
		call IssueImmediateOrderById(trigUnit, 851972)
		call EnableTrigger(ZFR)
		call SaveReal(HY, h, 212, GIX * 1.)
		call SaveReal(HY, h, 213, GIX * 1.)
		call SaveReal(HY, h, 13, a * 1.)
		call SaveUnitHandle(HY, h, 14, trigUnit)
		call TimerStart(t, .025, true, function ZAR)
		call SaveBoolean(HY, GetHandleId(trigUnit), 214, true)
		call SaveBoolean(HY, GetHandleId(trigUnit), 208, false)
		call ZVR(trigUnit, level)
	endif
	set trigUnit = null
	set t = null
	set ZFR = null
endfunction
function ZGR takes nothing returns boolean
	return((IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GW)) and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and UnitIsDead(GetFilterUnit()) == false and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false and GetUnitAbilityLevel(GetFilterUnit(),'Aloc') == 0))
endfunction
function ZHR takes integer ZJR returns real
	if ZJR <= 1 then
		return .01
	elseif ZJR == 2 then
		return .6
	elseif ZJR == 3 then
		return 1.1
	elseif ZJR == 4 then
		return 1.7
	elseif ZJR == 5 then
		return 2.2
	elseif ZJR == 6 then
		return 2.8
	elseif ZJR == 7 then
		return 3.3
	elseif ZJR == 8 then
		return 3.9
	elseif ZJR == 9 then
		return 4.4
	else
		return 5.
	endif
	return .0
endfunction
function ZKR takes unit u, unit targetUnit, integer GEX returns nothing
	local texttag tt = CreateTextTag()
	local string s = ""
	if GetHandleId(tt)< 1 then
		call DestroyTextTag(tt)
	else
		set s = R2SW(ZHR(GEX), 1, 1)
		call SetTextTagText(tt, s, .03)
		call SetTextTagPosUnit(tt, targetUnit, 0)
		call SetTextTagColorBJ(tt, 150, 75, 255, 15)
		call SetTextTagVelocity(tt, 0, .035)
		call SetTextTagFadepoint(tt, 3)
		call SetTextTagLifespan(tt, RMinBJ(1., GEX / 2))
		call SetTextTagPermanent(tt, false)
		call SetTextTagVisibility(tt, IsUnitAlly(u, LocalPlayer) or IsObserverPlayer(LocalPlayer))
	endif
	set tt = null
endfunction
function ZLR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 14)
	local unit ZMR = LoadUnitHandle(HY, h, 45)
	local real ZPR = LoadReal(HY, h, 47)
	local real ZQR = LoadReal(HY, h, 48)
	local real I3X = LoadReal(HY, h, 13)
	local real ZSR = GetUnitX(ZMR)
	local real ZTR = GetUnitY(ZMR)
	local real nx = CoordinateX50(GetUnitX(ZMR)+ 30 * Cos(I3X))
	local real ny = CoordinateY50(GetUnitY(ZMR)+ 30 * Sin(I3X))
	local group g = AllocationGroup(223)
	local unit dummyUnit
	local unit targetUnit
	local integer ZJR = 0
	local integer ZUR = 0
	local integer ZWR = 0
	local player p = GetOwningPlayer(whichUnit)
	call SetUnitX(ZMR, nx)
	call SetUnitY(ZMR, ny)
	set GW = whichUnit
	call GroupEnumUnitsInRange(g, nx, ny, 140, Condition(function ZGR))
	set targetUnit = FirstOfGroup(g)
	call DeallocateGroup(g)
	if targetUnit != null then
		if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
			call SaveInteger(OtherHashTable, GetHandleId(p),'ARRH', LoadInteger(OtherHashTable, GetHandleId(p),'ARRH')+ 1)
			call StoreDrCacheData("AA_Hits" + I2S(GetPlayerId(GetOwningPlayer(whichUnit))), LoadInteger(OtherHashTable, GetHandleId(p),'ARRH'))
		endif
		set dummyUnit = CreateUnit(GetOwningPlayer(targetUnit),'e00E', ZSR, ZTR, 0)
		set ZJR = IMinBJ(R2I(GetDistanceBetween(LoadReal(HY, h, 191), LoadReal(HY, h, 192), ZSR, ZTR)/ 150), 10)
		if ZJR <= 1 then
			set ZUR ='A40Y'
			set ZWR = 1
		elseif ZJR < 4 then
			set ZUR ='A407'
			set ZWR = ZJR -1
		elseif ZJR < 7 then
			set ZUR ='A408'
			set ZWR = ZJR -3
		else
			set ZUR ='A409'
			set ZWR = ZJR -6
		endif
		call CommonUnitAddStun(targetUnit, ZHR(ZJR), false)
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 90 * LoadInteger(HY, h, 0)-40 + ZJR * 14)
		call ZKR(whichUnit, targetUnit, ZJR)
		call KillUnit(ZMR)
		call DestroyTimerAndFlushHT_HY(t)
	elseif (nx -ZPR)*(nx -ZPR)+(ny -ZQR)*(ny -ZQR)< 1600 then
		call KillUnit(ZMR)
		call DestroyTimerAndFlushHT_HY(t)
	endif
	set t = null
	set whichUnit = null
	set ZMR = null
	set g = null
	set dummyUnit = null
	set targetUnit = null
endfunction
function EOE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x1 = CoordinateX50(GetUnitX(u))
	local real y1 = CoordinateY50(GetUnitY(u))
	local real x2 = GetSpellTargetX()
	local real y2 = GetSpellTargetY()
	local real a = Atan2(y2 -y1, x2 -x1)
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local player p = GetOwningPlayer(u)
	local unit d = CreateUnit(p,'h005', x1, y1, a * bj_RADTODEG)
	call SaveInteger(OtherHashTable, GetHandleId(p),'ARRS', LoadInteger(OtherHashTable, GetHandleId(p),'ARRS')+ 1)
	call StoreDrCacheData("AA_Total" + I2S(GetPlayerId(p)), LoadInteger(OtherHashTable, GetHandleId(p),'ARRS'))
	call SetUnitFacing(d, a * bj_RADTODEG)
	set x2 = CoordinateX50(x1 + 3000* Cos(a))
	set y2 = CoordinateY50(y1 + 3000* Sin(a))
	call SaveReal(HY, h, 191, x1 * 1.)
	call SaveReal(HY, h, 192, y1 * 1.)
	call SaveReal(HY, h, 47, x2 * 1.)
	call SaveReal(HY, h, 48, y2 * 1.)
	call SaveReal(HY, h, 13, a * 1.)
	call SaveUnitHandle(HY, h, 14, u)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(u,'A0L8'))
	call SaveUnitHandle(HY, h, 45, d)
	call TimerStart(t, .035, true, function ZLR)
	set u = null
	set t = null
	set d = null
endfunction
function ZYR takes nothing returns boolean
	local unit ZZR = GetFilterUnit()
	if IsUnitInGroup(ZZR, LW) then
		set ZZR = null
		return false
	endif
	if IsUnitEnemy(ZZR, GetOwningPlayer(GW)) and GetUnitAbilityLevel(ZZR,'A04R')!= 1 and GetWidgetLife(ZZR)> 0 and IsUnitType(ZZR, UNIT_TYPE_STRUCTURE) == false then
		set ZZR = null
		return true
	endif
	set ZZR = null
	return false
endfunction
function Z1R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer count =(LoadInteger(HY, h, 34))-1
	local texttag tt
	call SaveInteger(HY, h, 34,(count))
	if GetTriggerEvalCount(t) == 1 then
		call RemoveSavedHandle(HY, h,'0ILU')
	endif
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set tt = CreateTextTag()
		call SetTextTagText(tt, I2S(count), .03)
		call SetTextTagPosUnit(tt, whichUnit, 0)
		call SetTextTagColorBJ(tt, 0, 29, 255, 15)
		call SetTextTagVelocity(tt, 0, .035)
		call SetTextTagFadepoint(tt, 3)
		call SetTextTagLifespan(tt, .9)
		call SetTextTagPermanent(tt, false)
		call SetTextTagVisibility(tt, GetOwningPlayer(whichUnit) == LocalPlayer)
		set tt = CreateTextTag()
		call SetTextTagText(tt, I2S(count), .03)
		call SetTextTagPosUnit(tt, targetUnit, 0)
		call SetTextTagColorBJ(tt, 0, 29, 255, 15)
		call SetTextTagVelocity(tt, 0, .035)
		call SetTextTagFadepoint(tt, 3)
		call SetTextTagLifespan(tt, .9)
		call SetTextTagPermanent(tt, false)
		call SetTextTagVisibility(tt, GetOwningPlayer(whichUnit) == LocalPlayer)
	endif
	set t = null
	set tt = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function Z2R takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local unit trigUnit =(LoadUnitHandle(HY,(GetHandleId(t)), 14))
	local unit Z3R =(LoadUnitHandle(HY,(GetHandleId(trigUnit)), 229))
	call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl", GetUnitX(Z3R), GetUnitY(Z3R)))
	call RemoveUnit(Z3R)
	call UnitRemoveAbility(trigUnit,('A0GC'))
	if Rubick_AbilityFilter(trigUnit , 'A0G8') then
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(trigUnit),('A0G8'), true)
	endif
	call FlushChildHashtable(HY,(GetHandleId(t)))
	call CleanCurrentTrigger((t))
	set trigUnit = null
	set Z3R = null
	set t = null
endfunction
function Z4R takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit KKX = LoadUnitHandle(HY, h, 0)
	local unit Z5R = LoadUnitHandle(HY, h, 1)
	local real x = GetUnitX(Z5R)
	local real y = GetUnitY(Z5R)
	if UnitIsDead(KKX) == false and UnitIsDead(Z5R) == false then
		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl", x, y))
		call SetUnitPosition(Z5R, GetUnitX(KKX), GetUnitY(KKX))
		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl", GetUnitX(KKX), GetUnitY(KKX)))
		call SetUnitPosition(KKX, x, y)
		call PanCameraToTimedForPlayer(GetOwningPlayer(KKX), x, y, 0)
	endif
	call PauseTimer(t)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set KKX = null
	set Z5R = null
	set t = null
endfunction
function Z6R takes unit KKX, unit Z5R returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, 0, false, function Z4R)
	call SaveUnitHandle(HY, h, 0, KKX)
	call SaveUnitHandle(HY, h, 1, Z5R)
	set t = null
endfunction
function ENE takes nothing returns nothing
	call Z6R(GetTriggerUnit(), LoadUnitHandle(HY, GetHandleId(GetTriggerUnit()), 229))
endfunction
function Z7R takes nothing returns boolean
	return GetUnitAbilityLevel(GetSummonedUnit(),('B030'))> 0 and GetWidgetLife(GetSummonedUnit())> 0
endfunction
function Z8R takes nothing returns nothing
	local unit u
	local integer h
	local unit targetUnit
	local unit Z3R = GetSummonedUnit()
	local trigger t
	set u = GetSummoningUnit()
	if GetUnitAbilityLevel(u,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(u), 0) then
		set u = LoadUnitHandle(HY, GetHandleId(u), 0)
	endif
	set h = GetHandleId(u)
	set targetUnit = LoadUnitHandle(HY, h, 228)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A0G8', false)
	if GetUnitAbilityLevel(u,'A0G8')> 0 then
		call UnitAddPermanentAbility(u,'A0GC')
	endif
	call SetUnitColor(Z3R, GetPlayerColor(GetOwningPlayer(targetUnit)))
	call SaveUnitHandle(HY, h, 229, Z3R)
	set t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, Z3R, EVENT_UNIT_DEATH)
	call TriggerAddAction(t, function Z2R)
	call SaveUnitHandle(HY, GetHandleId(t), 14, u)
	set t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, Z3R, EVENT_UNIT_DEATH)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function Z1R))
	call SaveUnitHandle(HY, GetHandleId(t), 2, u)
	call SaveUnitHandle(HY, GetHandleId(t), 17, Z3R)
	call SaveInteger(HY, GetHandleId(t), 34, GetUnitAbilityLevel(u,'A0G8')* 15+ 15-1)
	set u = null
	set targetUnit = null
	set Z3R = null
	set t = null
endfunction
function EAE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit t = GetSpellTargetUnit()
	if GetUnitAbilityLevel(u,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(u), 0) then
		set u = LoadUnitHandle(HY, GetHandleId(u), 0)
	endif
	call SaveUnitHandle(HY,(GetHandleId(u)), 228,(t))
	if IsUnitIllusion(t) then
		call SaveUnitHandle(HY, GetHandleId(u),'0ILU', LoadUnitHandle(HY, GetHandleId(t),'0ILU'))
	else
		call SaveUnitHandle(HY, GetHandleId(u),'0ILU', t)
	endif
	set u = null
	set t = null
endfunction
function MTX takes nothing returns nothing
	local trigger t
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function Z7R))
	call TriggerAddAction(t, function Z8R)
	set t = null
endfunction
function Z9R takes unit trigUnit, integer VVI, real VEI returns nothing
	local integer agi = GetHeroAgi(trigUnit, false)
	local integer str = GetHeroStr(trigUnit, false)
	local real mp = GetUnitState(trigUnit, UNIT_STATE_MANA)
	if VVI == 0 then
		if mp >= VEI and agi -LoadInteger(OtherHashTable, GetHandleId(trigUnit), 31)> 2 and UnitIsDead(trigUnit) == false and agi > PC then
			call SetUnitState(trigUnit, UNIT_STATE_MANA, mp -VEI)
			call SetHeroAgi(trigUnit, agi -2, true)
			call SetHeroStr(trigUnit, str + 2, true)
		endif
	elseif VVI == 1 then
		if mp >= VEI and str -LoadInteger(OtherHashTable, GetHandleId(trigUnit), 30)-LoadInteger(OtherHashTable, GetHandleId(trigUnit),'ARML')> 4 and UnitIsDead(trigUnit) == false and str > PC then
			call SetUnitState(trigUnit, UNIT_STATE_MANA, mp -VEI)
			call SetHeroAgi(trigUnit, agi + 2, true)
			call SetHeroStr(trigUnit, str -2, true)
		endif
	endif
endfunction
function VXI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local integer level = GetUnitAbilityLevel(trigUnit,'A0KX')
	call Z9R(trigUnit, 1, 30. / level)
	set t = null
	set trigUnit = null
	return false
endfunction
function VOI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local integer level = GetUnitAbilityLevel(trigUnit,'A0KX')
	call Z9R(trigUnit, 0, 30. / level)
	set t = null
	set trigUnit = null
	return false
endfunction
function VRI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local trigger VII =(LoadTriggerHandle(HY, h, 226))
	local integer level = GetUnitAbilityLevel(u,'A0KX')
	local integer lastorder =(LoadInteger(HY, h, 227))
	local real VEI = 1. / level
	if VEI == .25 then
		set VEI = .2
	endif
	if GetIssuedOrderId()== 852549 then
		if VII != null then
			call FlushChildHashtable(HY,(GetHandleId(VII)))
			call CleanCurrentTrigger(VII)
		endif
		set VII = CreateTrigger()
		call TriggerRegisterTimerEvent(VII, VEI, true)
		call TriggerAddCondition(VII, Condition(function VXI))
		call SaveUnitHandle(HY,(GetHandleId(VII)), 14,(u))
		call SaveTriggerHandle(HY, h, 226,(VII))
		call SaveInteger(HY, h, 227,(GetIssuedOrderId()))
		call UnitAddAbility(u,'A22L')
		call UnitRemoveAbility(u,'A22T')
	elseif GetIssuedOrderId()== 852546 then
		if VII != null then
			call FlushChildHashtable(HY,(GetHandleId(VII)))
			call CleanCurrentTrigger(VII)
		endif
		set VII = CreateTrigger()
		call TriggerRegisterTimerEvent(VII, VEI, true)
		call TriggerAddCondition(VII, Condition(function VOI))
		call SaveUnitHandle(HY,(GetHandleId(VII)), 14,(u))
		call SaveTriggerHandle(HY, h, 226,(VII))
		call SaveInteger(HY, h, 227,(GetIssuedOrderId()))
		call UnitAddAbility(u,'A22T')
		call UnitRemoveAbility(u,'A22L')
	elseif GetIssuedOrderId()== 852550 then
		if VII != null then
			call FlushChildHashtable(HY,(GetHandleId(VII)))
			call CleanCurrentTrigger(VII)
		endif
		call SaveTriggerHandle(HY, h, 226,(null))
		call SaveInteger(HY, h, 227,(GetIssuedOrderId()))
		call UnitRemoveAbility(u,'A22L')
		call UnitRemoveAbility(u,'A22T')
	elseif GetIssuedOrderId()== 852547 then
		if VII != null then
			call FlushChildHashtable(HY,(GetHandleId(VII)))
			call CleanCurrentTrigger(VII)
		endif
		call SaveTriggerHandle(HY, h, 226,(null))
		call SaveInteger(HY, h, 227,(GetIssuedOrderId()))
		call UnitRemoveAbility(u,'A22L')
		call UnitRemoveAbility(u,'A22T')
	elseif GetIssuedOrderId()== 852548 then
		if IssueImmediateOrderById(u, 852549) == false then
			call IssueImmediateOrderById(u, 852550)
		endif
	elseif GetIssuedOrderId()== 852545 then
		if IssueImmediateOrderById(u, 852546) == false then
			call IssueImmediateOrderById(u, 852547)
		endif
	endif
	set t = null
	set u = null
	set VII = null
	return false
endfunction
function PUE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(trigUnit,'A0KX')
	if level == 1 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call UnitAddPermanentAbility(trigUnit,'A0KW')
		call TriggerRegisterUnitEvent(t, trigUnit, EVENT_UNIT_ISSUED_ORDER)
		call TriggerAddCondition(t, Condition(function VRI))
		call SaveTriggerHandle(HY, h, 226,(null))
		set t = null
	else
		call SetUnitAbilityLevel(trigUnit,'A0KW', level)
	endif
	set trigUnit = null
	set t = null
endfunction
function VAI takes nothing returns nothing
	local unit K4X =(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 326))
	local real r
	local real g
	local real b
	local integer VNI
	local integer VBI
	local real VCI
	local real BXE
	if GetUnitTypeId(K4X)!='O00P' then
		call DisableTrigger(GetTriggeringTrigger())
	elseif UnitIsDead(K4X) == false and(LoadBoolean(HY,(GetHandleId(K4X)), 225)) == false then
		set VNI = GetHeroAgi(K4X, true)
		set VBI = GetHeroStr(K4X, true)
		set VCI = RMaxBJ(75 + 2 *(VNI -VBI), 35)
		set r = VCI
		set g = VCI
		set b = VCI
		call SetUnitVertexColorBJ(K4X, r, g, b, GetRandomReal(.0, 10.))
	endif
	set K4X = null
endfunction
function VDI takes nothing returns boolean
	return not IsPickingHero and GetUnitTypeId(GetTriggerUnit())=='O00P' and IsUnitIllusion(GetTriggerUnit()) == false
endfunction
function VFI takes nothing returns nothing
	local trigger t
	if ((LoadBoolean(HY,(GetHandleId(GetTriggerUnit())), 327)) == false) then
		set t = CreateTrigger()
		call SaveUnitHandle(HY,(GetHandleId(t)), 326,(GetTriggerUnit()))
		call SaveTriggerHandle(HY,(GetHandleId(GetTriggerUnit())), 328,(t))
		call TriggerAddAction(t, function VAI)
		call TriggerRegisterTimerEvent(t, 1., true)
		call SaveBoolean(HY,(GetHandleId(GetTriggerUnit())), 327,(true))
		set t = null
	endif
endfunction
// 水人转属性颜色
function MSX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	call TriggerAddCondition(t, Condition(function VDI))
	call TriggerAddAction(t, function VFI)
	set t = null
endfunction
function VGI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamageSource() == LoadUnitHandle(HY, h, 0) then
			call CommonUnitAddStun(GetTriggerUnit(), LoadReal(HY, h, 0), false)
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	endif
	set t = null
endfunction
function VHI takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(u,'A0G6')
	local integer VJI
	local integer VKI
	local real damageValue
	local unit d
	local integer ZJR
	local real I3X
	local trigger t
	local integer h
	if GetUnitAbilityLevel(u,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(u), 0) then
		set u = LoadUnitHandle(HY, GetHandleId(u), 0)
	endif
	if GetUnitAbilityLevel(u,'A04R')> 0 then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
	set VJI = GetHeroMainAttributesType(u)
	if VJI == HERO_ATTRIBUTE_INT then
		set VKI = GetHeroInt(u, true)
	elseif VJI == HERO_ATTRIBUTE_AGI then
		set VKI = GetHeroAgi(u, true)
	elseif VJI == HERO_ATTRIBUTE_STR then
		set VKI = GetHeroStr(u, true)
	endif
	set damageValue = VKI *(1 + .25 * level)+ 40 + 20 * level
	set d = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddAbility(d,'A33K')
	call SetUnitAbilityLevel(d,'A33K', level)
	if IssueTargetOrderById(d, 852095, targetUnit) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 3.5, false)
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(t, Condition(function VGI))
		call SaveUnitHandle(HY, h, 0, d)
		call SaveReal(HY, h, 0, .8 + .2 * level)
		set t = null
	endif
	call CommonTextTag("|c001ce6b9+" + I2S(R2I(damageValue))+ "|r", 1, targetUnit, .023, 255, 255, 255, 216)
	call UnitDamageTargetEx(u, targetUnit, 1, damageValue)
	set u = null
	set d = null
	set targetUnit = null
endfunction
function EBE takes nothing returns nothing
	if GetUnitTypeId(GetSpellTargetUnit())!='n00L' and not UnitHasSpellShield(GetSpellTargetUnit()) then
		call VHI()
	endif
endfunction
function VLI takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), JSV) == false then
		call GroupAddUnit(JTV, GetEnumUnit())
		call UnitRemoveAbility(GetEnumUnit(),'B02J')
		call UnitRemoveAbility(GetEnumUnit(),'BUsp')
		call UnitRemoveAbility(GetEnumUnit(),'Bust')
	endif
endfunction
function VMI takes nothing returns nothing
	call UnitRemoveAbility(GetEnumUnit(),'B02J')
	call UnitRemoveAbility(GetEnumUnit(),'BUsp')
	call UnitRemoveAbility(GetEnumUnit(),'Bust')
endfunction
function VPI takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), JQV) == false then
		call SetUnitOwner(JPV, GetOwningPlayer(GetEnumUnit()), false)
		if IssueTargetOrderById(JPV, 852227, GetEnumUnit()) then
			call GroupAddUnit(JQV, GetEnumUnit())
		endif
	endif
endfunction
function VQI takes nothing returns nothing
	call SetWidgetLife(GetEnumUnit(), GetWidgetLife(GetEnumUnit())+ .08 * GetUnitState(GetEnumUnit(), UNIT_STATE_MAX_LIFE)* .05)
endfunction
function VSI takes nothing returns boolean
	return IsUnitAlly(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit())
endfunction
function VTI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	local group g
	local group D7R =(LoadGroupHandle(HY, h, 187))
	if GetTriggerEvalCount(t)== 10 then
		call UnitAddPermanentAbility(whichUnit,'A24E')
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A07U', false)
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A38E', false)
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A24E', true)
	endif
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetTriggerEvalCount(t)> 140 or(GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A24E') then
		if Rubick_AbilityFilter(whichUnit , 'A07U') or(LoadInteger(HY,(GetHandleId(whichUnit)), 704))=='A38E' then
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A07U', true)
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A38E', true)
		endif
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A24E', false)
		call ForGroup(D7R, function VMI)
		call DeallocateGroup(D7R)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set g = AllocationGroup(226)
		set U2 = whichUnit
		set JPV = dummyCaster
		set JQV = D7R
		call GroupEnumUnitsInRange(g, x, y, 1250+ 25, Condition(function DCX))
		call ForGroup(g, function VPI)
		set JSV = g
		set JTV = AllocationGroup(227)
		call ForGroup(D7R, function VLI)
		call GroupRemoveGroup(JTV, D7R)
		set U2 = whichUnit
		if GetUnitAbilityLevel(whichUnit,'A38E')> 0 then
			call GroupEnumUnitsInRange(g, x, y, 1275, Condition(function VSI))
			call ForGroup(g, function VQI)
		endif
		call DeallocateGroup(g)
		call DeallocateGroup(JTV)
	endif
	set t = null
	set g = null
	set whichUnit = null
	set D7R = null
	set dummyCaster = null
	return false
endfunction
function ECE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', x, y, 0)
	call UnitAddAbility(dummyCaster,'A07T')
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function VTI))
	call SaveGroupHandle(HY, h, 187,(AllocationGroup(228)))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\SongOfTheSiren_2.mdx", whichUnit, "origin")))
	set t = null
	set whichUnit = null
	set dummyCaster = null
endfunction
function VUI takes unit whichUnit, unit targetUnit returns nothing
	local integer level = GetUnitAbilityLevel(whichUnit,'A2KU')
	call UnitAddAbilityToTimed(targetUnit,'A240', level, 8, 0)
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, 60 + 40 * level)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\CrushingWave\\CrushingWaveDamage.mdl", targetUnit, "chest"))
endfunction
function VWI takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), FL) == false then
		call GroupAddUnit(FL, GetEnumUnit())
		call VUI(DL, GetEnumUnit())
	endif
endfunction
function VYI takes nothing returns nothing
	local unit whichUnit = GetEnumUnit()
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local group g = AllocationGroup(229)
	call DestroyEffect(AddSpecialEffect("war3mapImported\\RipTide09.mdx", x, y))
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, x, y, 350 + 25, Condition(function DHX))
	call ForGroup(g, function VWI)
	call DeallocateGroup(g)
	set g = null
	set whichUnit = null
endfunction
function VZI takes nothing returns boolean
	return IsUnitIllusion(GetFilterUnit()) and UnitIsDead(GetFilterUnit()) == false
endfunction
function EDE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local group g = AllocationGroup(230)
	set FL = AllocationGroup(231)
	set DL = whichUnit
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(whichUnit), Condition(function VZI))
	call GroupAddUnit(g, whichUnit)
	call ForGroup(g, function VYI)
	call DeallocateGroup(g)
	call DeallocateGroup(FL)
	set whichUnit = null
	set g = null
endfunction
function V_I takes nothing returns boolean
	return IsUnitEnemy(ZK, GetOwningPlayer(GetFilterUnit())) and UnitIsDead(GetFilterUnit()) == false and(GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0)
endfunction
function V0I takes nothing returns nothing
	local unit u = GetEnumUnit()
	local real IXX = 25 + 75 * VL
	if IsUnitType(u, UNIT_TYPE_STRUCTURE) then
		call UnitDamageTargetEx(ZK, u, 1, IXX * .5)
	else
		call UnitDamageTargetEx(ZK, u, 1, IXX)
	endif
	set u = null
endfunction
function V1I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local group g = AllocationGroup(232)
	set ZK = whichUnit
	set VL = LoadInteger(HY, h, 0)
	call GroupEnumUnitsInRange(g, x, y, 425, Condition(function V_I))
	call ForGroup(g, function V0I)
	call DeallocateGroup(g)
	call PauseTimer(t)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set whichUnit = null
	set t = null
endfunction
function W7V takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit dummyCaster
	local timer t
	local integer h
	set t = CreateTimer()
	set h = GetHandleId(t)
	set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', x, y, 0)
	call UnitAddAbility(dummyCaster,'AHbz')
	call IssuePointOrderById(dummyCaster, 852089, x, y)
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveReal(HY, h, 6, x)
	call SaveReal(HY, h, 7, y)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	if GetUnitTypeId(whichUnit)!='e00E' then
		call TimerStart(t, .9, false, function V1I)
	else
		call TimerStart(t, .0, false, function V1I)
	endif
	set dummyCaster = null
	set whichUnit = null
	set t = null
endfunction
function V2I takes unit whichUnit, unit targetUnit, integer level returns nothing
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	call UnitAddAbility(dummyCaster,'A0BA')
	call SetUnitAbilityLevel(dummyCaster,'A0BA', level)
	call IssueTargetOrderById(dummyCaster, 852106, targetUnit)
	set dummyCaster = null
endfunction
function V3I takes nothing returns boolean
	if IsUnitIllusion(GetFilterUnit()) and GetOwningPlayer(GetFilterUnit()) == GetOwningPlayer(GetTriggerUnit()) then
		call V2I(GetFilterUnit(), JUV, GetUnitAbilityLevel(GetTriggerUnit(),'A24D'))
	endif
	return false
endfunction
function V4I takes nothing returns boolean
	if IsUnitIllusion(GetFilterUnit()) and GetOwningPlayer(GetFilterUnit()) == GetOwningPlayer(GetTriggerUnit()) then
		call SetUnitFacing(GetFilterUnit(), S2)
		call SetUnitAnimation(GetFilterUnit(), "spell")
	endif
	return false
endfunction
function KUE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local group g = AllocationGroup(233)
	set S2 = AngleBetweenXY(GetUnitX(trigUnit), GetUnitY(trigUnit), GetUnitX(JUV), GetUnitY(JUV))
	call GroupEnumUnitsInRange(g, GetUnitX(trigUnit), GetUnitY(trigUnit), 700, Condition(function V4I))
	call DeallocateGroup(g)
	set trigUnit = null
	set g = null
endfunction
function V5I takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local unit targetUnit = JUV
	local group g = AllocationGroup(234)
	call GroupEnumUnitsInRange(g, GetUnitX(trigUnit), GetUnitY(trigUnit), 700, Condition(function V3I))
	call DeallocateGroup(g)
	set trigUnit = null
	set targetUnit = null
	set g = null
endfunction
function EFE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set JUV = GetSpellTargetUnit()
		call V2I(GetTriggerUnit(), JUV, GetUnitAbilityLevel(GetTriggerUnit(),'A24D'))
		call V5I()
	endif
endfunction
function DOE takes nothing returns nothing
	call SetUnitState(GetTriggerUnit(), UNIT_STATE_MANA, GetUnitState(GetTriggerUnit(), UNIT_STATE_MANA)* .4)
endfunction
function V6I takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamageSource() == LoadUnitHandle(HY, h, 1) then
			call CommonUnitAddStun(GetTriggerUnit(), 1.5, false)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
endfunction
function V7I takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit target = GetSpellTargetUnit()
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(target), GetUnitY(target), 0)
	local trigger t = null
	local integer h
	call UnitAddPermanentAbility(d,'A2KR')
	if IssueTargetOrderById(d, 852095, target) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 3, false)
		call TriggerRegisterUnitEvent(t, target, EVENT_UNIT_DAMAGED)
		call SaveUnitHandle(HY, h, 1, d)
		call TriggerAddCondition(t, Condition(function V6I))
	endif
	set u = null
	set target = null
	set d = null
endfunction
function HVX takes nothing returns nothing
	local unit whichUnit = U2
	call UnitAddPermanentAbility(whichUnit,'A2KQ')
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A2KQ', true)
	set whichUnit = null
endfunction
function HAX takes nothing returns nothing
	local unit whichUnit = U2
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A2KQ', false)
	set whichUnit = null
endfunction
function V8I takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamageSource() == LoadUnitHandle(HY, h, 0) then
			call CommonUnitAddStun(GetTriggerUnit(), 1.5, false)
			call UnitDamageTargetEx(LoadUnitHandle(HY, h, 1), GetTriggerUnit(), 1, 15+ 65 * LoadReal(HY, h, 0))
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	endif
	set t = null
endfunction
function V9I takes nothing returns nothing
	local trigger t
	local integer h
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local unit d = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	call UnitAddAbility(d,'A42E')
	if IssueTargetOrderById(d, 852095, targetUnit) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 5, false)
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(t, Condition(function V8I))
		call SaveUnitHandle(HY, h, 0, d)
		call SaveUnitHandle(HY, h, 1, whichUnit)
		call SaveReal(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())* 1.)
		set t = null
	endif
	set d = null
	set whichUnit = null
	set targetUnit = null
endfunction
function F9E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call V9I()
	endif
endfunction
function EVI takes unit u, integer ETX, real EEI, real EXI returns boolean
	return(Mode__BalanceOff and TKV(u, ETX, EEI)) or(Mode__BalanceOff == false and TKV(u, ETX, EXI))
endfunction
function EOI takes nothing returns boolean
	local integer id = LoadInteger(OtherHashTable2,'MULT', 0)
	return id =='A1HS'
endfunction

function GetGroupList takes nothing returns nothing
	local string s = null
	local integer i = 100
	set GourpListStr = null
	if UIFrame__DebugLog == 0 then
		return
	endif
	if GetTriggerPlayer() == LocalPlayer then
		loop
		exitwhen i == 240
			if GroupsIsAllocated[i] then
				set s = "单位组" + I2S(i) + "已使用Id:" + I2S(GroupsId[i]) + "\n"
			else
				set s = "单位组" + I2S(i) + "号 空闲\n"
			endif
			set GourpListStr = GourpListStr + s
			set i = i + 1
		endloop
		call DzFrameShow( UIFrame__DebugLog, true )
		call DzFrameSetText(DzFrameFindByName("DebugLogArea", 0), GourpListStr)
	endif
endfunction

function ERI takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer iPlayerId = GetPlayerId(p)
	local integer i = 1
	local integer abilityId
	loop
		set abilityId = HeroCommonSkills[PlayerSkillIndex[iPlayerId * HL + i]]
		if abilityId > 0 and not IsPassiveSkill[PlayerSkillIndex[iPlayerId * HL + i]] then
			call SaveInteger(OtherHashTable2,'MULT', 0, abilityId)
			// 能被多重施法
			if (X9R(iPlayerId, abilityId) and OXR(abilityId)) or EOI() then
				call DisplayTimedTextToPlayer(p, 0, 0, 15, "	|c00ff0303" + GetObjectName(abilityId)+ "|r " + UGV(abilityId)+ " 能被多重施法")
			endif
		endif
		set i = i + 1
	exitwhen i > 4 + ExtraSkillsNumber
	endloop
endfunction

function EII takes unit u, integer lv returns integer
	local integer i = GetPlayerId(GetOwningPlayer(u))
	call SaveInteger(OtherHashTable, i,'MC_T', LoadInteger(OtherHashTable, i,'MC_T')+ 1)
	if lv == 1 then
		if EVI(u,'A088', 25, 18) then
			call SaveInteger(OtherHashTable, i,'MC_2', LoadInteger(OtherHashTable, i,'MC_2')+ 1)
			return 2
		endif
	elseif lv == 2 then
		if EVI(u,'A088'+ 1, 20, 13) then
			call SaveInteger(OtherHashTable, i,'MC_3', LoadInteger(OtherHashTable, i,'MC_3')+ 1)
			return 3
		elseif EVI(u,'A088', 40, 29.5) then
			call SaveInteger(OtherHashTable, i,'MC_2', LoadInteger(OtherHashTable, i,'MC_2')+ 1)
			return 2
		endif
	elseif lv == 3 then
		if EVI(u,'A088'+ 2, 12.5, 5.5) then
			call SaveInteger(OtherHashTable, i,'MC_4', LoadInteger(OtherHashTable, i,'MC_4')+ 1)
			return 4
		elseif EVI(u,'A088'+ 1, 25, 14.5) then
			call SaveInteger(OtherHashTable, i,'MC_3', LoadInteger(OtherHashTable, i,'MC_3')+ 1)
			return 3
		elseif EVI(u,'A088', 50, 39.5) then
			call SaveInteger(OtherHashTable, i,'MC_2', LoadInteger(OtherHashTable, i,'MC_2')+ 1)
			return 2
		endif
	endif
	if JE then
		return 4
	endif
	return 0
endfunction
function EAI takes unit u returns integer
	//	local real r
	//	local boolean MDR = false
	//	local integer ENI = 0
	local integer id = GetPlayerId(GetOwningPlayer(u))
	//	local integer probability
	//	local integer ph = GetHandleId(GetOwningPlayer(u))
	if not(X9R(id, GetSpellAbilityId())) then
		return 0
	endif
	return EII(u, GetUnitAbilityLevel(u,'A088'))
endfunction
function EBI takes nothing returns nothing
	set Q2 = 0
	if GetUnitAbilityLevel(U2,'A088') == 0 or EOI() == false then
		return
	endif
	set Q2 = EII(U2, GetUnitAbilityLevel(U2,'A088'))
	if Q2 > 0 then
		if Q2 == 2 then
			call CommonTextTag(GetObjectName('n0K7'), 5, U2, .03, 255, 0, 0, 255)
		elseif Q2 == 3 then
			call CommonTextTag(GetObjectName('n0JT'), 5, U2, .03, 255, 0, 0, 255)
		elseif Q2 == 4 then
			call CommonTextTag(GetObjectName('n0K8'), 5, U2, .03, 255, 0, 0, 255)
		endif
	endif
endfunction
function ECI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	call IssueImmediateOrderById(u, 851972)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set u = null
	set t = null
	return false
endfunction
function EDI takes nothing returns boolean
	return(IsUnitEnemy(Q5V, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()) and IsUnitMagicImmune(GetFilterUnit()) == false and GetUnitAbilityLevel(GetFilterUnit(),'B03J') == 0 and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(Q5V)))!= null
endfunction
function EFI takes nothing returns boolean
	return(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()) and IsUnitMagicImmune(GetFilterUnit()) == false and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and IsHeroUnitId(GetUnitTypeId(GetFilterUnit())) == false)!= null
endfunction
function EGI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit d = LoadUnitHandle(HY, h, 0)
	local unit u = LoadUnitHandle(HY, h, 1)
	if S3V(u) == false then
		call KillUnit(d)
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	endif
	set t = null
	set d = null
	set u = null
endfunction
function EHI takes unit d, unit u returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .1, true, function EGI)
	call SaveUnitHandle(HY, GetHandleId(t), 0, d)
	call SaveUnitHandle(HY, GetHandleId(t), 1, u)
	set t = null
endfunction

function EJI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	local player p = GetOwningPlayer(u)
	local integer ELI =(LoadInteger(HY, h, 300))
	local integer lv =(LoadInteger(HY, h, 5))
	local integer id =(LoadInteger(HY, h, 299))
	local integer S6V =(LoadInteger(HY, h,'0ORD'))
	local integer i =(LoadInteger(HY, h,'ORDT'))
	local unit dummyCaster
	local unit EQI
	local real ux
	local real uy
	local real tx
	local real ty
	local real d
	local real a
	local boolean b
	local boolean ESI
	local trigger tt = null
	local real S7V
	local group g = null
	if GetTriggerEvalCount(t)> ELI then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set dummyCaster = CreateUnit(p,'e00E', GetWidgetX(u), GetWidgetY(u), 0)
		call SaveBoolean(HY, GetHandleId(dummyCaster),'REFL', true)
		call SaveUnitHandle(HY, GetHandleId(dummyCaster),'REFL', u)
		call SetUnitX(dummyCaster, GetWidgetX(u))
		call SetUnitY(dummyCaster, GetWidgetY(u))
		call SaveUnitHandle(ObjectHashTable, GetHandleId(dummyCaster), 0, LoadUnitHandle(HY, h, 2))
		call TriggerRegisterUnitEvent(UnitEventMainTrig, dummyCaster, EVENT_UNIT_SPELL_EFFECT)
		call RemoveSavedHandle(ObjectHashTable, GetHandleId(dummyCaster), 0)
		if HaveSavedInteger(ObjectHashTable, id, 0) then
			set id = LoadInteger(ObjectHashTable, id, 0)
		endif
		call UnitAddPermanentAbility(dummyCaster, id)
		call SetUnitAbilityLevel(dummyCaster, id, lv)
		set ESI = LoadBoolean(ObjectHashTable, GetHandleId(p), id)
		if ESI then
			call SetPlayerAbilityAvailable(p, id, true)
		endif
		if i == 1 then
			set EQI = LoadUnitHandle(HY, h, 17)
			if id !='A011' and id !='A180' then
				set ux = GetUnitX(EQI)
				set uy = GetUnitY(EQI)
				set tx = GetUnitX(u)
				set ty = GetUnitY(u)
				set d = LoadReal(HY, h,'000D')
				set a = Atan2(ty -uy, tx -ux)
				call UnitShareVision(EQI, p, true)
				loop
				exitwhen IssueTargetOrderById(dummyCaster, S6V, EQI) or d < 0
					call SetUnitX(dummyCaster, ux +(d * Cos(a)))
					call SetUnitY(dummyCaster, uy +(d * Sin(a)))
					set d = d  -10
				endloop
				if id =='A2QT' then
					set S7V = RMinBJ(GetGameTime()-LoadReal(HY, GetHandleId(u), 358)-(.3 * GetTriggerEvalCount(t)), 3)
					set tt = CreateTrigger()
					call TriggerRegisterTimerEvent(tt, S7V, false)
					call TriggerAddCondition(tt, Condition(function ECI))
					call SaveUnitHandle(HY, GetHandleId(tt), 0, dummyCaster)
					set tt = null
				endif
				call UnitShareVision(EQI, p, false)
			elseif id =='A011' then
				set g = AllocationGroup(237)
				set Q5V = u
				call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 1400, Condition(function EDI))
				call GroupRemoveUnit(g, EQI)
				if FirstOfGroup(g)!= null then
					set EQI = GroupPickRandomUnit(g)
				endif
				call IssueTargetOrderById(dummyCaster, S6V, EQI)
				call DeallocateGroup(g)
				set g = null
			elseif id =='A180' then
				set g = AllocationGroup(238)
				set U2 = u
				call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 900, Condition(function EFI))
				call GroupRemoveUnit(g, EQI)
				loop
					set EQI = FirstOfGroup(g)
					if EQI != null then
						call SetUnitX(dummyCaster, GetUnitX(EQI))
						call SetUnitY(dummyCaster, GetUnitY(EQI))
					endif
				exitwhen EQI == null or(LoadInteger(SightDataHashTable, GetUnitTypeId(EQI), HC)<= 88 and IssueTargetOrderById(dummyCaster, S6V, EQI))
					call GroupRemoveUnit(g, EQI)
				endloop
				call DeallocateGroup(g)
				set g = null
			endif
		elseif i == 2 then
			set EQI = LoadUnitHandle(HY, h, 17)
			set ux = LoadReal(HY, h,'0LOX')
			set uy = LoadReal(HY, h,'0LOY')
			set tx = GetUnitX(u)
			set ty = GetUnitY(u)
			set d = LoadReal(HY, h,'000D')
			set a = Atan2(ty -uy, tx -ux)
			if id =='A0JC'then
				call SaveUnitHandle(OtherHashTable2,'A3E9', 0, dummyCaster)
				call SaveInteger(OtherHashTable2,'A3E9', 0, lv)
				call SaveReal(OtherHashTable2,'A3E9', 0, ux)
				call SaveReal(OtherHashTable2,'A3E9', 1, uy)
				call ExecuteFunc("ETI")
			else
				loop
					set b = IssuePointOrderById(dummyCaster, S6V, ux, uy)
				exitwhen b or d < 0
					call SetUnitX(dummyCaster, ux +(d * Cos(a)))
					call SetUnitY(dummyCaster, uy +(d * Sin(a)))
					set d = d  -10
				endloop
			endif
			//if id =='A3OH' then
			//	call LaunchWaveSimple(dummyCaster,'h08O', 60 + 50 * lv, 1200, 240, 240, tx, ty, ux, uy, 1500, 1, false, "GushUpgraded_Actions", lv)
			//endif
			if id =='A12K' then
				set S7V = RMinBJ((GetGameTime())-(LoadReal(HY,(GetHandleId(u)), 358))-(.3 * GetTriggerEvalCount(t)), 1.05)
				set tt = CreateTrigger()
				call TriggerRegisterTimerEvent(tt, S7V, false)
				call TriggerAddCondition(tt, Condition(function ECI))
				call SaveUnitHandle(HY, GetHandleId(tt), 0, dummyCaster)
				set tt = null
			endif
		elseif i == 3 then
			call TriggerRegisterUnitEvent(UnitEventMainTrig, dummyCaster, EVENT_UNIT_SPELL_FINISH)
			call IssueImmediateOrderById(dummyCaster, S6V)
			if id =='A03R' or id =='A0AV'then
				call EHI(dummyCaster, u)
			endif
		endif
		if ESI then
			call SetPlayerAbilityAvailable(p, id, false)
		endif
	endif
	set t = null
	set u = null
	set dummyCaster = null
	set EQI = null
	set p = null
	return false
endfunction
function EUI takes integer r returns nothing
	local unit u = GetTriggerUnit()
	local integer id = GetSpellAbilityId()
	local integer lv = GetUnitAbilityLevel(u, id)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer uh = GetHandleId(u)
	local integer i = LoadInteger(HY, uh,'ORDT')
	local real cost
	if r == 2 then
		set cost = 0.5
		call CommonTextTag(GetObjectName('n0K7'), 5, GetTriggerUnit(), .03, 255, 0, 0, 255)
	elseif r == 3 then
		set cost = 0.75
		call CommonTextTag(GetObjectName('n0JT'), 5, GetTriggerUnit(), .03, 255, 0, 0, 255)
	elseif r == 4 then
		set cost = 1.00
		call CommonTextTag(GetObjectName('n0K8'), 5, GetTriggerUnit(), .03, 255, 0, 0, 255)
	elseif r == 5 then
		set cost = 2.00
		call CommonTextTag(GetObjectName('n0JO'), 5, GetTriggerUnit(), .03, 255, 0, 0, 255)
	endif
	if not Mode__RearmCombos then
		set cost = (YDWEGetUnitAbilityDataInteger(u, id, lv, 104))* cost
		call SetUnitState(u, UNIT_STATE_MANA, (GetUnitState(u, UNIT_STATE_MANA) - cost))
	endif
	set r = r -1
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveInteger(HY, h, 300,(r))
	call SaveInteger(HY, h, 5,(lv))
	call SaveInteger(HY, h, 299,(id))
	if i == 1 then
		call SaveInteger(HY, h,'0ORD', LoadInteger(HY, uh,'0ORD'))
		call SaveReal(HY, h,'000D', LoadReal(HY, uh,'000D'))
		call SaveUnitHandle(HY, h, 17,(GetSpellTargetUnit()))
	elseif i == 2 then
		call SaveInteger(HY, h,'0ORD', LoadInteger(HY, uh,'0ORD'))
		call SaveReal(HY, h,'000D', LoadReal(HY, uh,'000D'))
		call SaveReal(HY, h,'0LOX', GetSpellTargetX())
		call SaveReal(HY, h,'0LOY', GetSpellTargetY())
	elseif i == 3 then
		call SaveInteger(HY, h,'0ORD', LoadInteger(HY, uh,'0ORD'))
	endif
	call SaveInteger(HY, h,'ORDT', i)
	call TriggerRegisterTimerEvent(t, .3, true)
	call TriggerAddCondition(t, Condition(function EJI))
	set t = null
	set u = null
endfunction
function EYI takes nothing returns boolean
	local integer r
	local unit u
	local real ux
	local real uy
	local real tx
	local real ty
	if (GetUnitAbilityLevel(GetTriggerUnit(),'A088'))> 0 then
		set u = GetTriggerUnit()
		if GetTriggerEventId() == EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER then
			call SaveInteger(HY, GetHandleId(u),'0ORD', GetIssuedOrderId())
			call SaveInteger(HY, GetHandleId(u),'ORDT', 1)
			set u = null
			return false
		elseif GetTriggerEventId() == EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER then
			call SaveInteger(HY, GetHandleId(u),'0ORD', GetIssuedOrderId())
			call SaveInteger(HY, GetHandleId(u),'ORDT', 2)
			set u = null
			return false
		elseif GetTriggerEventId() == EVENT_PLAYER_UNIT_ISSUED_ORDER then
			call SaveInteger(HY, GetHandleId(u),'0ORD', GetIssuedOrderId())
			call SaveInteger(HY, GetHandleId(u),'ORDT', 3)
			set u = null
			return false
		endif
		if OXR(GetSpellAbilityId()) and GetUnitAbilityLevel(GetTriggerUnit(),'A04R') == 0 then
			if GetSpellTargetUnit()!= null and LoadInteger(HY, GetHandleId(u),'ORDT') == 1 then
				if not UnitHasSpellShield(GetSpellTargetUnit()) and IsPlayerEnemy(GetOwningPlayer(GetSpellTargetUnit()), GetOwningPlayer(u)) then
					set r = EAI(u)
					if r > 1 then
						set ux = GetUnitX(u)
						set uy = GetUnitY(u)
						set tx = GetUnitX(GetSpellTargetUnit())
						set ty = GetUnitY(GetSpellTargetUnit())
						call SaveReal(HY, GetHandleId(u),'000D', SquareRoot(((tx -ux)*(tx -ux))+((ty -uy)*(ty -uy))))
						call EUI(r)
					endif
				endif
			elseif GetSpellTargetLoc()!= null and LoadInteger(HY, GetHandleId(u),'ORDT') == 2 then
				set r = EAI(u)
				if r > 1 then
					set ux = GetUnitX(u)
					set uy = GetUnitY(u)
					set tx = GetSpellTargetX()
					set ty = GetSpellTargetY()
					call SaveReal(HY, GetHandleId(u),'000D', SquareRoot(((tx -ux)*(tx -ux))+((ty -uy)*(ty -uy))))
					call EUI(r)
				endif
			elseif LoadInteger(HY, GetHandleId(u),'ORDT') == 3 then
				set r = EAI(u)
				if r > 1 then
					call EUI(r)
				endif
			endif
		endif
	endif
	if GetSpellAbilityId()=='A2KQ' and not UnitHasSpellShield(GetSpellTargetUnit()) then
		call V7I()
	endif
	set u = null
	return false
endfunction
function MUX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function EYI))
	set t = null
endfunction

function SetAbilityCanNotMultiCast takes integer abilityId returns nothing
	call SaveBoolean(AbilityDataHashTable,'MCRS', abilityId, true)
endfunction

// 设置一些不能被多重施法的普通技能
function InitMultiCast takes nothing returns nothing
	//call SaveBoolean(AbilityDataHashTable,'MCRS','A44U', true)		//下注
	call SetAbilityCanNotMultiCast('A1TU')
	call SetAbilityCanNotMultiCast('A33U')
	call SetAbilityCanNotMultiCast('A456')
	call SetAbilityCanNotMultiCast('A44X')
	call SetAbilityCanNotMultiCast('A1MG')
	call SetAbilityCanNotMultiCast('A19O')
	call SetAbilityCanNotMultiCast('A1MV')
	call SetAbilityCanNotMultiCast('A0DL')
	call SetAbilityCanNotMultiCast('A0WP')
	call SetAbilityCanNotMultiCast('A43D')
	call SetAbilityCanNotMultiCast('A0MQ')
	call SetAbilityCanNotMultiCast('A1B6')
	call SetAbilityCanNotMultiCast('A1TA')
	call SetAbilityCanNotMultiCast('A1T8')
	call SetAbilityCanNotMultiCast('A28Q')
	call SetAbilityCanNotMultiCast('A1TB')
	call SetAbilityCanNotMultiCast('A3FQ')
	call SetAbilityCanNotMultiCast('QB0K')
	call SetAbilityCanNotMultiCast('ANcr')
	call SetAbilityCanNotMultiCast('A0Z4')
	call SetAbilityCanNotMultiCast('A0Z5')
	call SetAbilityCanNotMultiCast('A1NI')
	call SetAbilityCanNotMultiCast('QM00')
	call SetAbilityCanNotMultiCast('A1YY')
	call SetAbilityCanNotMultiCast('A1RK')
	call SetAbilityCanNotMultiCast('A43H')
	call SetAbilityCanNotMultiCast('A1S7')
	call SetAbilityCanNotMultiCast('A1YQ')
	call SetAbilityCanNotMultiCast('A3DE')
	call SetAbilityCanNotMultiCast('A2JR')
	call SetAbilityCanNotMultiCast('A2JL')
	call SetAbilityCanNotMultiCast('A2JO')
	call SetAbilityCanNotMultiCast('A2JQ')
	call SetAbilityCanNotMultiCast('A2JP')
	call SetAbilityCanNotMultiCast('A2E5')
	call SetAbilityCanNotMultiCast('A43S')
	call SetAbilityCanNotMultiCast('A43Q')
	call SetAbilityCanNotMultiCast('A43S')
	call SetAbilityCanNotMultiCast('A43Q')
	call SetAbilityCanNotMultiCast('QB08')
	call SetAbilityCanNotMultiCast('AEbl')
	
	
	call SetAbilityCanNotMultiCast('Z607')
	call SetAbilityCanNotMultiCast('A01Z')
	call SetAbilityCanNotMultiCast('A01V')	//森林之眼
	call SetAbilityCanNotMultiCast('A05G')	//剑刃风暴
	call SetAbilityCanNotMultiCast('A0T2')	//狂暴
	
	call SetAbilityCanNotMultiCast('A05G')
	call SetAbilityCanNotMultiCast('A0M1')
	call SetAbilityCanNotMultiCast('A1AX')
	call SetAbilityCanNotMultiCast('A0A5')
	call SetAbilityCanNotMultiCast('A1EG')
	call SetAbilityCanNotMultiCast('A0AG')
	call SetAbilityCanNotMultiCast('A0KX')
	call SetAbilityCanNotMultiCast('A0G8')
	call SetAbilityCanNotMultiCast('A0KW')
	call SetAbilityCanNotMultiCast('A063')
	call SetAbilityCanNotMultiCast('A07U')
	call SetAbilityCanNotMultiCast('A38E')
	call SetAbilityCanNotMultiCast('QB0B')
	call SetAbilityCanNotMultiCast('A0D7')
	call SetAbilityCanNotMultiCast('A0LN')
	call SetAbilityCanNotMultiCast('A0KU')
	call SetAbilityCanNotMultiCast('A0BE')
	call SetAbilityCanNotMultiCast('A1EJ')
	call SetAbilityCanNotMultiCast('A229')
	call SetAbilityCanNotMultiCast('QB03')
	call SetAbilityCanNotMultiCast('A1EA')
	call SetAbilityCanNotMultiCast('A0RV')
	call SetAbilityCanNotMultiCast('QB0P')
	call SetAbilityCanNotMultiCast('A1N4')
	call SetAbilityCanNotMultiCast('A0LC')
	call SetAbilityCanNotMultiCast('A443')
	call SetAbilityCanNotMultiCast('A0IN')
	call SetAbilityCanNotMultiCast('A1AW')
	call SetAbilityCanNotMultiCast('QB09')
	call SetAbilityCanNotMultiCast('A07A')
	call SetAbilityCanNotMultiCast('QB0L')
	call SetAbilityCanNotMultiCast('A2H0')
	call SetAbilityCanNotMultiCast('A2HS')
	call SetAbilityCanNotMultiCast('A01B')
	call SetAbilityCanNotMultiCast('QM01')
	call SetAbilityCanNotMultiCast('A01O')
	call SetAbilityCanNotMultiCast('A0SB')
	call SetAbilityCanNotMultiCast('A28T')
	call SetAbilityCanNotMultiCast('A361')
	call SetAbilityCanNotMultiCast('A14O')
	call SetAbilityCanNotMultiCast('A3FJ')
	call SetAbilityCanNotMultiCast('A085')
	call SetAbilityCanNotMultiCast('A14I')
	call SetAbilityCanNotMultiCast('A12P')
	call SetAbilityCanNotMultiCast('A1D6')
	call SetAbilityCanNotMultiCast('A1SW')
	call SetAbilityCanNotMultiCast('A06B')
	call SetAbilityCanNotMultiCast('A471')
	call SetAbilityCanNotMultiCast('A065')
	call SetAbilityCanNotMultiCast('A00P')
	call SetAbilityCanNotMultiCast('A27F')
	call SetAbilityCanNotMultiCast('A27H')
	call SetAbilityCanNotMultiCast('A30J')
	call SetAbilityCanNotMultiCast('A0I6')
	call SetAbilityCanNotMultiCast('A0RW')
	call SetAbilityCanNotMultiCast('A03O')
	call SetAbilityCanNotMultiCast('A10R')
	call SetAbilityCanNotMultiCast('A1OP')
	call SetAbilityCanNotMultiCast('QP1W')
	call SetAbilityCanNotMultiCast('A194')
	call SetAbilityCanNotMultiCast('A0SW')
	call SetAbilityCanNotMultiCast('A0NS')
	call SetAbilityCanNotMultiCast('A1DA')
	call SetAbilityCanNotMultiCast('QM02')
	call SetAbilityCanNotMultiCast('A0R0')
	call SetAbilityCanNotMultiCast('A06K')
	call SetAbilityCanNotMultiCast('A0FL')
	call SetAbilityCanNotMultiCast('A1CX')
	call SetAbilityCanNotMultiCast('DRKN')
	call SetAbilityCanNotMultiCast('DRKU')
	call SetAbilityCanNotMultiCast('A05C')
	call SetAbilityCanNotMultiCast('QM03')
	call SetAbilityCanNotMultiCast('A1RD')
	call SetAbilityCanNotMultiCast('A1P8')
	call SetAbilityCanNotMultiCast('A0H0')
	call SetAbilityCanNotMultiCast('A030')
	call SetAbilityCanNotMultiCast('QB0A')
	call SetAbilityCanNotMultiCast('A025')
	call SetAbilityCanNotMultiCast('A04Q')
	call SetAbilityCanNotMultiCast('Z234')
	call SetAbilityCanNotMultiCast('A0WQ')
	call SetAbilityCanNotMultiCast('A0PL')
	call SetAbilityCanNotMultiCast('A09U')
	call SetAbilityCanNotMultiCast('A2KO')
	call SetAbilityCanNotMultiCast('QB01')
	call SetAbilityCanNotMultiCast('A0CA')
	call SetAbilityCanNotMultiCast('A0CT')
	call SetAbilityCanNotMultiCast('A3DM')
	call SetAbilityCanNotMultiCast('A1RI')
	call SetAbilityCanNotMultiCast('A07Q')
	call SetAbilityCanNotMultiCast('A0H9')
	call SetAbilityCanNotMultiCast('A1IN')
	call SetAbilityCanNotMultiCast('A0LK')
	call SetAbilityCanNotMultiCast('A1C0')
	call SetAbilityCanNotMultiCast('A418')
	call SetAbilityCanNotMultiCast('A0MP')
	call SetAbilityCanNotMultiCast('A04Y')
	call SetAbilityCanNotMultiCast('A04N')
	call SetAbilityCanNotMultiCast('A02N')
	call SetAbilityCanNotMultiCast('A0CC')
	call SetAbilityCanNotMultiCast('A02Z')
	call SetAbilityCanNotMultiCast('A0OJ')
	call SetAbilityCanNotMultiCast('A0ME')
	call SetAbilityCanNotMultiCast('A1S8')
	call SetAbilityCanNotMultiCast('Z605')
	call SetAbilityCanNotMultiCast('A1HS')
endfunction
function E_I takes nothing returns boolean
	local unit f = GetFilterUnit()
	local unit u = GetTriggerUnit()
	if IsUnitAlly(f, GetOwningPlayer(u)) and UnitIsDead(f) == false and(IsUnitType(f, UNIT_TYPE_HERO) or((GetOwningPlayer(f) == SentinelPlayers[0]or GetOwningPlayer(f) == ScourgePlayers[0])) or(GetOwningPlayer(f) == GetOwningPlayer(u) and R_X(f) == false)) then
		set f = null
		set u = null
		return true
	endif
	set f = null
	set u = null
	return false
endfunction
function E0I takes group gg returns unit
	local unit u
	local group g = AllocationGroup(239)
	set U2 = null
	set MissileHitTargetUnit = null
	call GroupAddGroup(gg, g)
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if IsUnitType(u, UNIT_TYPE_HERO) then
			if U2 == null then
				set U2 = u
			else
				if GetRandomInt(0, 1) == 1 then
					set U2 = u
				endif
			endif
		else
			if MissileHitTargetUnit == null then
				set MissileHitTargetUnit = u
			else
				if GetRandomInt(0, 1) == 1 then
					set MissileHitTargetUnit = u
				endif
			endif
		endif
		call GroupRemoveUnit(g, u)
	endloop
	call DeallocateGroup(g)
	set u = null
	set g = null
	if U2 != null then
		return U2
	endif
	return MissileHitTargetUnit
endfunction
// 多重施法逻辑
function E1I takes integer r returns nothing
	local unit u = GetTriggerUnit()
	local integer level = r
	local group g = AllocationGroup(240)
	local group gg = AllocationGroup(241)
	local unit d
	local unit t
	local integer id = GetSpellAbilityId()
	local integer k = 1
	local boolean b = false
	if r == 2 then
		call CommonTextTag(GetObjectName('n0K7'), 5, u, .03, 255, 0, 0, 255)
	elseif r == 3 then
		call CommonTextTag(GetObjectName('n0JT'), 5, u, .03, 255, 0, 0, 255)
	elseif r == 4 then
		call CommonTextTag(GetObjectName('n0K8'), 5, u, .03, 255, 0, 0, 255)
	elseif r == 5 then
		call CommonTextTag(GetObjectName('n0JO'), 5, u, .03, 255, 0, 0, 255)
	endif
	set r = r -1
	set U2 = u
	call GroupEnumUnitsInRange(gg, GetUnitX(u), GetUnitY(u), 600, Condition(function E_I))
	if u != GetSpellTargetUnit() then
		call GroupAddUnit(gg, u)
	endif
	if HaveSavedInteger(ObjectHashTable, id, 0) then
		set id = LoadInteger(ObjectHashTable, id, 0)
	endif
	call GroupAddGroup(gg, g)
	loop
	exitwhen b
		loop
		exitwhen k > level or b
			if id =='A08N' or id =='A2QM' then
				set t = GetSpellTargetUnit()
			else
				set t = E0I(gg)
			endif
			if id =='AEfn' then
				set id = 'A333'
			endif
			set b = t == null
			if b == false then
				set d = CreateUnit(GetOwningPlayer(u),'e00C', GetUnitX(u), GetUnitY(u), 270)
				call TriggerRegisterUnitEvent(UnitEventMainTrig, d, EVENT_UNIT_SPELL_EFFECT)
				call UnitAddPermanentAbility(d, id)
				call SetUnitAbilityLevel(d, id, GetUnitAbilityLevel(u, id))
				call UnitApplyTimedLife(d,'BTLF', 1.)
				call IssueTargetOrderById(d, LoadInteger(HY, GetHandleId(u),'0ORD'), t)
				call SetUnitPathing(d, false)
				call UnitAddPermanentAbility(d,'Aloc')
				call GroupRemoveUnit(gg, t)
				set k = k + 1
			endif
		endloop
		if b and level > k then
			set b = false
			call GroupAddGroup(g, gg)
		endif
	endloop
	call DeallocateGroup(gg)
	call DeallocateGroup(g)
	set d = null
	set gg = null
	set t = null
	set u = null
	set g = null
endfunction
function E2I takes nothing returns boolean
	local integer r
	if (GetUnitAbilityLevel(GetTriggerUnit(),'A088'))> 0 then
		if GetTriggerEventId() == EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER then
			call SaveInteger(HY, GetHandleId(GetTriggerUnit()),'0ORD'+ 1, GetIssuedOrderId())
		elseif GetTriggerEventId() == EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER then
			call SaveInteger(HY, GetHandleId(GetTriggerUnit()),'0ORD'+ 1, 0)
		elseif GetTriggerEventId() == EVENT_PLAYER_UNIT_ISSUED_ORDER then
			call SaveInteger(HY, GetHandleId(GetTriggerUnit()),'0ORD'+ 1, 0)
		endif
		if GetTriggerEventId() == EVENT_PLAYER_UNIT_SPELL_EFFECT and(LoadInteger(HY, GetHandleId(GetTriggerUnit()),'0ORD'+ 1)!= 0) then
			if OXR(GetSpellAbilityId()) and(GetSpellTargetUnit()!= null) and(GetSpellAbilityId()!= null) and GetUnitAbilityLevel(GetTriggerUnit(),'A04R') == 0 then
				if IsPlayerAlly(GetOwningPlayer(GetSpellTargetUnit()), GetOwningPlayer(GetTriggerUnit())) then
					set r = EAI(GetTriggerUnit())
					if r > 1 then
						call E1I(r)
					endif
				endif
			endif
		endif
	endif
	return false
endfunction
function MWX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function E2I))
	set t = null
endfunction
function PGE takes nothing returns nothing
	call UnitAddPermanentAbility(GetTriggerUnit(),'A083')
	call SetUnitAbilityLevel(GetTriggerUnit(),'A083', GetUnitAbilityLevel(GetTriggerUnit(),'A40B'))
endfunction
function E3I takes nothing returns boolean
	return(IsAliveNotStrucNotWard(GetFilterUnit()) and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(U2)))!= null
endfunction
function CLE takes nothing returns nothing
	call UnitDamageTargetEx(GetTriggerUnit(), GetEnumUnit(), 3, JW)
endfunction
function EGE takes nothing returns nothing
	local group g = AllocationGroup(242)
	local unit u = GetSpellTargetUnit()
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local unit u2
	set JW = 90 * GetUnitAbilityLevel(GetTriggerUnit(),('A08N'))
	if GetWidgetLife(u)> 1 and OYX(u) == false then
		call SetWidgetLife(u, GetWidgetLife(u)+ JW)
	endif
	set u = GetTriggerUnit()
	set U2 = u
	call GroupEnumUnitsInRange(g, x, y, 260 + 25, Condition(function E3I))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call UnitDamageTargetEx(u, u2, 3, JW)
		call GroupRemoveUnit(g, u2)
	endloop
	call DeallocateGroup(g)
	set u = null
	set u2 = null
	set g = null
endfunction
function F7E takes nothing returns nothing
	call FJX(GetSpellTargetUnit())
	call FKX(GetSpellTargetUnit(), false)
endfunction
function E4I takes nothing returns boolean
	return IsUnitAlly(GetFilterUnit(), GetOwningPlayer(U2)) and GetUnitAbilityLevel(GetFilterUnit(),'B00G')> 0 and GetUnitDistanceEx(GetFilterUnit(), U2)> 2000
endfunction
function E5I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit whichUnit = LoadUnitHandle(HY, GetHandleId(t), 0)
	local group g
	local unit u
	set g = AllocationGroup(243)
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, 0, 0, 12000, Condition(function E4I))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call UnitRemoveAbility(u,'B00G')
		call GroupRemoveUnit(g, u)
	endloop
	call DeallocateGroup(g)
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTimer(t)
	set u = null
	set whichUnit = null
	set t = null
endfunction
function VPE takes nothing returns nothing
	local timer t
	if IsUnitHaveRearmAbility(GetTriggerUnit()) then
		set t = CreateTimer()
		call TimerStart(t, 0, false, function E5I)
		call SaveUnitHandle(HY, GetHandleId(t), 0, GetTriggerUnit())
	endif
	set t = null
endfunction
function E6I takes nothing returns boolean
	local unit TJX = GetSummonedUnit()
	local unit dummyCaster
	local unit targetUnit
	if IsUnitIllusion(TJX) then
		set dummyCaster = GetSummoningUnit()
		set targetUnit =(LoadUnitHandle(HY,(GetHandleId(dummyCaster)), 303))
		if targetUnit == null or GetUnitX(targetUnit) == .0 or GetUnitY(targetUnit) == .0 then
			set TJX = null
			set dummyCaster = null
			set targetUnit = null
			return false
		endif
		call SetUnitX(TJX, GetUnitX(targetUnit))
		call SetUnitY(TJX, GetUnitY(targetUnit))
		call IssueTargetOrderById(TJX, 851983, targetUnit)
	endif
	set TJX = null
	set dummyCaster = null
	set targetUnit = null
	return false
endfunction
function E7I takes player p, unit targetUnit, integer lv returns nothing
	local unit dummyCaster = CreateUnit(p,'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local integer E8I
	call SaveUnitHandle(HY,(GetHandleId(dummyCaster)), 303,(targetUnit))
	if lv == 1 then
		set E8I ='A10H'
	elseif lv == 2 then
		set E8I ='A10G'
	elseif lv == 3 then
		set E8I ='A10I'
	else
		set E8I ='A10F'
	endif
	call UnitAddAbility(dummyCaster, E8I)
	call IssueTargetOrderById(dummyCaster, 852274, Player__Hero[GetPlayerId(p)])
	set dummyCaster = null
endfunction
function E9I takes unit whichUnit, player p, unit targetUnit, integer level, boolean XVI returns nothing
	local unit dummyCaster
	if XVI then
		set dummyCaster = CreateUnit(p,'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitAddAbility(dummyCaster,'A10C')
		call SetUnitAbilityLevel(dummyCaster,'A10C', level)
		call IssueTargetOrderById(dummyCaster, 852189, targetUnit)
		call UnitDamageTargetEx(dummyCaster, targetUnit, 1, 50 + 50 * level)
		call E7I(p, targetUnit, level)
		set dummyCaster = null
		if GetUnitAbilityLevel(targetUnit,'A3E9') == 1 and IsUnitMagicImmune(whichUnit) == false and HaveSavedHandle(HY, GetHandleId(whichUnit), 0) == false then
			call SaveUnitHandle(OtherHashTable2,'A3E9', 0, targetUnit)
			call SaveUnitHandle(OtherHashTable2,'A3E9', 1, whichUnit)
			call SaveInteger(OtherHashTable2,'A3E9', 0, level)
			call ExecuteFunc("XEI")
		endif
	endif
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\IllidanMissile\\IllidanMissile.mdl", targetUnit, "origin"))
endfunction
function XXI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player p
	local unit targetUnit
	local integer level
	local boolean F0X
	local unit missileDummy
	local real x
	local real y
	local real tx
	local real ty
	local real NAX
	local real NNX
	local real targetX
	local real targetY
	local boolean NDX
	local real NFX
	local real NGX
	if GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
		if OXX(GetSpellAbilityId()) then
			call SaveBoolean(HY, h, 0, true)
			call SaveReal(HY, h, 0, GetUnitX(GetTriggerUnit()))
			call SaveReal(HY, h, 1, GetUnitY(GetTriggerUnit()))
		endif
	else
		set p = LoadPlayerHandle(HY, h, 54)
		set targetUnit = LoadUnitHandle(HY, h, 30)
		set level = LoadInteger(HY, h, 5)
		set F0X = LoadBoolean(HY, h, 302)
		set missileDummy = LoadUnitHandle(HY, h, 45)
		set x = GetUnitX(missileDummy)
		set y = GetUnitY(missileDummy)
		set tx = GetUnitX(targetUnit)
		set ty = GetUnitY(targetUnit)
		set NAX = 1000* .035
		set NDX = LoadBoolean(HY, h, 0)
		if NDX then
			set tx = LoadReal(HY, h, 0)
			set ty = LoadReal(HY, h, 1)
		endif
		set NNX = AngleBetweenXY(x, y, tx, ty)
		set targetX = x + NAX * Cos(NNX * bj_DEGTORAD)
		set targetY = y + NAX * Sin(NNX * bj_DEGTORAD)
		call SetUnitX(missileDummy, targetX)
		call SetUnitY(missileDummy, targetY)
		call SetUnitFacing(missileDummy, NNX)
		if GetDistanceBetween(tx, ty, targetX, targetY)<= NAX then
			if NDX == false then
				call E9I(LoadUnitHandle(HY, h, 31), p, targetUnit, level, F0X)
			endif
			call KillUnit(missileDummy)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set targetUnit = null
	set missileDummy = null
	return false
endfunction
function XOI takes unit whichUnit, integer level, unit targetUnit, boolean F0X returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit missileDummy = CreateUnit(GetOwningPlayer(whichUnit),'h06L', GetUnitX(whichUnit), GetUnitY(whichUnit), AngleBetweenXY(GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitX(targetUnit), GetUnitY(targetUnit)))
	call SavePlayerHandle(HY, h, 54, GetOwningPlayer(whichUnit))
	call SaveUnitHandle(HY, h, 30,(targetUnit))
	call SaveUnitHandle(HY, h, 31,(whichUnit))
	call SaveBoolean(HY, h, 302, F0X)
	call SaveUnitHandle(HY, h, 45, missileDummy)
	call SaveInteger(HY, h, 5, level)
	call TriggerRegisterTimerEvent(t, .035, true)
	call SaveBoolean(HY, h, 0, false)
	call SaveReal(HY, h, 0, 0)
	call SaveReal(HY, h, 1, 0)
	call TriggerAddCondition(t, Condition(function XXI))
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_SPELL_EFFECT)
	set t = null
	set missileDummy = null
endfunction
function XRI takes nothing returns boolean
	if IsUnitIllusion(GetFilterUnit()) and IsPlayerHasSkill(GetOwningPlayer(GetFilterUnit()), 83) and GetOwningPlayer(GetFilterUnit()) == GetOwningPlayer(GetTriggerUnit()) then
		call XOI(GetFilterUnit(), 3, GetSpellTargetUnit(), false)
	endif
	return false
endfunction
function EHE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(trigUnit,'A10D')
	local group g = AllocationGroup(244)
	call GroupEnumUnitsInRange(g, GetUnitX(trigUnit), GetUnitY(trigUnit), 700, Condition(function XRI))
	call DeallocateGroup(g)
	call XOI(trigUnit, level, targetUnit, not UnitHasSpellShield(GetSpellTargetUnit()))
	set trigUnit = null
	set targetUnit = null
endfunction
function XEI takes nothing returns nothing
	call T4V(LoadUnitHandle(OtherHashTable2,'A3E9', 0))
	call XOI(LoadUnitHandle(OtherHashTable2,'A3E9', 0), LoadInteger(OtherHashTable2,'A3E9', 0), LoadUnitHandle(OtherHashTable2,'A3E9', 1), UnitHasSpellShield(LoadUnitHandle(OtherHashTable2,'A3E9', 1)) == false)
	call FlushChildHashtable(OtherHashTable2,'A3E9')
endfunction
function XII takes nothing returns boolean
	if IsUnitIllusion(GetFilterUnit()) and IsPlayerHasSkill(GetOwningPlayer(GetFilterUnit()), 83) and GetOwningPlayer(GetFilterUnit()) == GetOwningPlayer(GetTriggerUnit()) then
		call SetUnitFacing(GetFilterUnit(), S2)
		call SetUnitAnimation(GetFilterUnit(), "spell")
	endif
	return false
endfunction
function KWE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local group g = AllocationGroup(245)
	set S2 = AngleBetweenXY(GetUnitX(trigUnit), GetUnitY(trigUnit), GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit()))
	call GroupEnumUnitsInRange(g, GetUnitX(trigUnit), GetUnitY(trigUnit), 700, Condition(function XII))
	call DeallocateGroup(g)
	set trigUnit = null
	set g = null
endfunction
function MZX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call AddAbilityIDToPreloadQueue('A10C')
	call AddAbilityIDToPreloadQueue('A10H')
	call AddAbilityIDToPreloadQueue('A10G')
	call AddAbilityIDToPreloadQueue('A10I')
	call AddAbilityIDToPreloadQueue('A10F')
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function E6I))
	set t = null
endfunction
function XAI takes nothing returns boolean
	if (GetUnitAbilityLevel(GetFilterUnit(),'B03B')> 0 or GetUnitAbilityLevel(GetFilterUnit(),'P084')> 0) and UnitIsDead(GetFilterUnit()) == false then
		set Q2 = Q2 + 1
	endif
	return false
endfunction
function XNI takes unit u returns nothing
	local group g = AllocationGroup(246)
	local integer probability = GetRandomInt(1, 100)
	local integer level = GetUnitAbilityLevel(u,'P083')
	local unit d
	local integer WOV = 3 + 2 * level
	local integer XBI = 35 + 5 * level
	set Q2 = 0
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(u), Condition(function XAI))
	call DeallocateGroup(g)
	if Q2 < WOV then
		if IsUnitIllusion(u) == false and probability <= XBI then
			set d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
			call UnitAddPermanentAbility(d,'A0DD')
			call IssueTargetOrderById(d, 852274, u)
		endif
		if IsUnitIllusion(u) and probability <= 8 then
			set d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
			call UnitAddPermanentAbility(d,'A0DD')
			call SetUnitAbilityLevel(d,'A0DD', 2)
			call IssueTargetOrderById(d, 852274, u)
		endif
	endif
	set d = null
endfunction
function XCI takes unit u, unit targetUnit returns nothing
	if (GetUnitAbilityLevel(u,'P083')> 0 or GetUnitAbilityLevel(u,'B03B')> 0 or GetUnitAbilityLevel(u,'B03A')> 0) and GetUnitAbilityLevel(u,'A36D') == 0 and IsUnitType(targetUnit, UNIT_TYPE_STRUCTURE) == false and IsUnitEnemy(targetUnit, GetOwningPlayer(u)) then
		call XNI(u)
	endif
endfunction
function EKE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit dummyCaster = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call UnitAddPermanentAbility(dummyCaster,'A0DC')
	call IssueTargetOrderById(dummyCaster, 852274, u)
	set u = null
	set dummyCaster = null
endfunction
function XDI takes unit u, integer hu, trigger t returns nothing
	local integer h = GetHandleId(t)
	if GetUnitAbilityLevel(u,'A46D')> 0 and LoadBoolean(HY, h, 5) then
		call SetUnitNoLimitMoveSpeed(u, 0)
		call SetUnitPathing(u, true)
	endif
	call UnitRemoveAbility(u,'A46F')
	call UnitRemoveAbility(u,'B46F')
	if GetHandleId(u)> 0 then
		call RemoveSavedHandle(HY, GetHandleId(u),'A46E')
	else
		call RemoveSavedHandle(HY, LoadInteger(HY, h, 0),'A46E')
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
endfunction
function XFI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer hu = LoadInteger(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	local real EOX
	local real XGI = LoadReal(HY, h, 0)
	local boolean ESI = false
	local real x
	local real y
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		if GetTriggerUnit() == u then
			call XDI(u, hu, t)
		else
			if GetUnitCurrentOrder(u)!= 851986 then
				call DisableTrigger(t)
				call IssuePointOrderById(u, 851986, LoadReal(HY, h, 10), LoadReal(HY, h, 11))
				call EnableTrigger(t)
			endif
		endif
	elseif GetTriggerEventId() == EVENT_UNIT_ATTACKED then
		if GetAttacker() == u then
			call XDI(u, hu, t)
		endif
	elseif GetTriggerEventId() == EVENT_UNIT_ISSUED_ORDER or GetTriggerEventId() == EVENT_UNIT_ISSUED_TARGET_ORDER or GetTriggerEventId() == EVENT_UNIT_ISSUED_POINT_ORDER then
		if GetIssuedOrderId()!= 851983 and not(GetIssuedOrderId()==851971 and GetOrderTargetUnit()!= null and IsUnitEnemy(GetOrderTargetUnit(), GetOwningPlayer(u))) then
			call XDI(u, hu, t)
		endif
	else
		if C6X(u) or(LoadBoolean(HY, h, 5) and GetUnitAbilityLevel(u,'A46F') == 0) then
			call XDI(u, hu, t)
		else
			set EOX = GetUnitDistanceEx(u, targetUnit)
			if LoadBoolean(HY, h, 5) and(EOX > XGI + 150 or UnitVisibleToPlayer(targetUnit, GetOwningPlayer(u)) == false or RFX(targetUnit)) then
				if GetUnitCurrentOrder(u)!= 851986 then
					if LoadBoolean(HY, h, 0) then
						call XDI(u, hu, t)
					else
						call DisableTrigger(t)
						call SaveBoolean(HY, h, 0, true)
						call IssuePointOrderById(u, 851986, LoadReal(HY, h, 10), LoadReal(HY, h, 11))
						call EnableTrigger(t)
					endif
				elseif GetDistanceBetween(GetUnitX(u), GetUnitY(u), LoadReal(HY, h, 10), LoadReal(HY, h, 11))<= 120 then
					call XDI(u, hu, t)
				endif
			elseif LoadBoolean(HY, h, 5) == false then
				if LoadBoolean(HY, h, 0) == false and GetUnitAbilityLevel(u,'A46F') == 0 and EOX <= XGI and GetUnitAbilityLevel(u,'A46D')> 0 then
					call UnitAddPermanentAbility(u,'A46F')
					call SetUnitNoLimitMoveSpeed(u, 800)
					if GetUnitAbilityLevel(u,'A46D')> 0 then
						call SaveReal(HY, GetHandleId(u),'A46E', GetGameTime())
					endif
					call SetUnitPathing(u, false)
					call SaveBoolean(HY, h, 5, true)
				endif
			elseif GetDistanceBetween(GetUnitX(u), GetUnitY(u), LoadReal(HY, h, 10), LoadReal(HY, h, 11))<= 100  then
				call XDI(u, hu, t)
			else
				call SaveReal(HY, h, 10, GetUnitX(targetUnit))
				call SaveReal(HY, h, 11, GetUnitY(targetUnit))
				call SaveBoolean(HY, h, 0, false)
			endif
		endif
	endif
	set t = null
	return false
endfunction
function XHI takes nothing returns nothing
	local trigger t
	local integer h
	local unit u = GetTriggerUnit()
	local integer hu = GetHandleId(u)
	local integer level = GetUnitAbilityLevel(u,'A46D')
	local unit targetUnit = GetOrderTargetUnit()
	local real EOX = GetUnitDistanceEx(u, targetUnit)
	local real XGI = 500 + 100 * level
	local unit XJI
	if EOX > 300 and LoadReal(HY, hu,'A46E')+ 20 -4 * level < GetGameTime() then
		if HaveSavedHandle(HY, hu,'A46E') then
			set t = LoadTriggerHandle(HY, hu,'A46E')
			set h = GetHandleId(t)
			set XJI = LoadUnitHandle(HY, h, 1)
			if XJI != targetUnit then
				call XDI(u, hu, t)
			endif
		else
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call SaveTriggerHandle(HY, hu,'A46E', t)
			call SaveUnitHandle(HY, h, 0, u)
			call SaveInteger(HY, h, 0, hu)
			call SaveUnitHandle(HY, h, 1, targetUnit)
			call TriggerRegisterTimerEvent(t, .02, true)
			call TriggerRegisterTimerEvent(t, 0, false)
			call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_ATTACKED)
			call TriggerRegisterDeathEvent(t, targetUnit)
			call TriggerRegisterDeathEvent(t, u)
			call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_ORDER)
			call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_POINT_ORDER)
			call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_TARGET_ORDER)
			call TriggerAddCondition(t, Condition(function XFI))
		endif
		call SaveReal(HY, h, 0, XGI)
		call SaveReal(HY, h, 10, GetUnitX(targetUnit))
		call SaveReal(HY, h, 11, GetUnitY(targetUnit))
	endif
	set u = null
	set targetUnit = null
	set t = null
endfunction
// 幻影冲锋 右键
function XKI takes nothing returns boolean
	if GetOrderTargetUnit()!= null and IsUnitEnemy(GetOrderTargetUnit(), GetOwningPlayer(GetTriggerUnit())) and(GetIssuedOrderId()== 851983 or GetIssuedOrderId()==851971) then
		if GetUnitAbilityLevel(GetTriggerUnit(),'A46D')> 0 and GetUnitAbilityLevel(GetTriggerUnit(),'A36D') == 0 then
			call XHI()
		endif
	endif
	return false
endfunction
// 幻影冲锋
function XLI takes nothing returns boolean
	local unit u
	if IsUnitIllusion(GetTriggerUnit()) then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]
		if GetUnitAbilityLevel(u,'A46E')> 0 and GetUnitTypeId(GetTriggerUnit()) == GetUnitTypeId(u) then
			call UnitAddPermanentAbility(GetTriggerUnit(),'A46D')
			call SetUnitAbilityLevel(GetTriggerUnit(),'A46D', GetUnitAbilityLevel(u,'A46E'))
		endif
	endif
	set u = null
	return false
endfunction
function POE takes nothing returns boolean
	call UnitAddPermanentAbility(GetTriggerUnit(),'A46D')
	call SetUnitAbilityLevel(GetTriggerUnit(),'A46D', GetUnitAbilityLevel(GetTriggerUnit(),'A46E'))
	call SetHeroAgi(GetTriggerUnit(), GetHeroAgi(GetTriggerUnit(), false)+ 5, true)
	return false
endfunction
function XMI takes nothing returns boolean
	return GetOwningPlayer(GetFilterUnit()) == GetOwningPlayer(U2) and IsUnitIllusion(GetFilterUnit()) and UnitIsDead(GetFilterUnit()) == false
endfunction
function XPI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u
	local unit u2
	local integer i = 1
	local real N8X
	local real XQI = 325
	local real x = LoadReal(HY, h, 10)
	local real y = LoadReal(HY, h, 11)
	local real nx
	local real ny
	local real I3X
	local real EOX
	local integer c = LoadInteger(HY, h, 0)+ 1
	local real N3X
	local unit XSI
	local unit XTI
	local string s
	local group g
	if c == 50 then
		call ClearSelectionForPlayer(GetOwningPlayer(LoadUnitHandle(HY, h, 0)))
		set XSI = null
		set XTI = null
		set g = AllocationGroup(247)
		loop
		exitwhen HaveSavedHandle(HY, h, i) == false
			set u = LoadUnitHandle(HY, h, i)
			call ShowUnit(u, true)
			call PauseUnit(u, false)
			call IssueImmediateOrderById(u, 851972)
			call UnitRemoveAbility(u,'Avul')
			set nx = LoadReal(HY, h, 100 * i)
			set ny = LoadReal(HY, h, 100 * i + 1)
			call KillTreeByCircle(nx, ny, 200)
			call SetUnitPosition(u, nx, ny)
			if IsUnitIllusion(u) then
				call UnitPauseTimedLife(u, false)
			endif
			if IsUnitIllusion(u) == false or GetUnitAbilityLevel(u,'B46G')> 0 or GetUnitAbilityLevel(u,'B46H')> 0 then
				call SetUnitFacing(u, LoadReal(HY, h, 0))
				if IsUnitIllusion(u) == false then
					call SelectUnitAddForPlayer(u, GetOwningPlayer(u))
				elseif XSI == null then
					set XSI = u
				elseif XTI == null then
					set XTI = u
				endif
				if GetUnitAbilityLevel(u,'B46H')> 0 then
					set s = ""
					if IsUnitAlly(u, LocalPlayer) or(IsObserverPlayer(LocalPlayer)) then
						set s = "Abilities\\Spells\\Items\\AIda\\AIdaTarget.mdl"
					endif
					call ARX(s, u, "head", 8)
				endif
				if GetUnitAbilityLevel(u,'B46G')> 0 then
					set s = ""
					if IsUnitAlly(u, LocalPlayer) or(IsObserverPlayer(LocalPlayer)) then
						set s = "war3mapImported\\PLPower.mdx"
					endif
					call ARX(s, u, "overhead", 8)
				endif
			else
				call GroupAddUnit(g, u)
			endif
			call KillUnit(LoadUnitHandle(HY, h, 300 + i))
			set i = i + 1
		endloop
		call SelectUnitAddForPlayer(XSI, GetOwningPlayer(u))
		call SelectUnitAddForPlayer(XTI, GetOwningPlayer(u))
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			call SelectUnitAddForPlayer(u, GetOwningPlayer(u))
			call GroupRemoveUnit(g, u)
		endloop
		call DeallocateGroup(g)
		set XSI = null
		set XTI = null
		call RemoveUnit(LoadUnitHandle(HY, h,- 100 ))
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	else
		if c == 1 then
			loop
			exitwhen HaveSavedHandle(HY, h, i) == false
				set u = LoadUnitHandle(HY, h, 300 + i)
				call PauseUnit(u, true)
				set i = i + 1
			endloop
		elseif c >= 30 then
			loop
			exitwhen HaveSavedHandle(HY, h, i) == false
				set u = LoadUnitHandle(HY, h, 300 + i)
				set N3X = LoadReal(HY, h, 100 * i + 2)
				set I3X = LoadReal(HY, h, 100 * i + 3)
				set nx = CoordinateX50(GetUnitX(u)+ N3X * Cos(I3X))
				set ny = CoordinateY50(GetUnitY(u)+ N3X * Sin(I3X))
				call SetUnitAnimation(u, "walk")
				call SetUnitX(u, nx)
				call SetUnitY(u, ny)
				set i = i + 1
			endloop
		endif
		call SaveInteger(HY, h, 0, c)
	endif
	set u = null
	set u2 = null
	set t = null
endfunction
function EJE takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local group g = AllocationGroup(248)
	local integer i = 0
	local unit u2
	local real N8X = GetUnitFacing(u)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	local real I3X
	local real EOX
	local real nx
	local real ny
	call FKX(u, false)
	call UnitAddAbility(d,'A46G')
	call IssueTargetOrderById(d, 852274, u)
	call SetUnitAbilityLevel(d,'A46G', 2)
	call IssueTargetOrderById(d, 852274, u)
	set d = null
	set U2 = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 925, Condition(function XMI))
	call GroupAddUnit(g, u)
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		set i = i + 1
		call SaveUnitHandle(HY, h, i, u2)
		call UnitAddAbility(u2,'Avul')
		call ShowUnit(u2, false)
		if IsUnitIllusion(u2) then
			call UnitPauseTimedLife(u2, true)
		endif
		set d = CreateUnit(GetOwningPlayer(u2),'h07W', GetUnitX(u2), GetUnitY(u2), GetUnitFacing(u2))
		call SaveUnitHandle(HY, h, 300 + i, d)
		set I3X = GetRandomReal(0, 360)* bj_DEGTORAD
		set EOX = GetRandomReal( 10, 325)
		set nx = CoordinateX50(x + EOX * Cos(I3X))
		set ny = CoordinateY50(y + EOX * Sin(I3X))
		call SaveReal(HY, h, 100 * i + 0, nx)
		call SaveReal(HY, h, 100 * i + 1, ny)
		call SaveReal(HY, h, 100 * i + 2, GetDistanceBetween(GetUnitX(d), GetUnitY(d), nx, ny)/ .4 * .02)
		call SaveReal(HY, h, 100 * i + 3, AngleBetweenXY(GetUnitX(d), GetUnitY(d), nx, ny)* bj_DEGTORAD)
		call GroupRemoveUnit(g, u2)
	endloop
	set d = null
	call SaveUnitHandle(HY, h,- 100 , CreateUnit(GetOwningPlayer(u),'o01P', GetUnitX(u), GetUnitY(u), 0))
	call SaveReal(HY, h, 0, N8X)
	call SaveUnitHandle(HY, h, 0, u)
	call TimerStart(t, .02, true, function XPI)
	call SaveReal(HY, h, 10, x)
	call SaveReal(HY, h, 11, y)
	call DeallocateGroup(g)
	set t = null
	set u = null
endfunction
// 注册幻影长矛手触发器
function RegisterPhantomLancerTrigger takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
	call TriggerAddCondition(t, Condition(function XKI))
	set t = CreateTrigger()
	call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	call TriggerAddCondition(t, Condition(function XLI))
	set t = null
endfunction
function XUI takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit()) == HeroListTypeId[21]and GetOwningPlayer(GetFilterUnit()) == GetOwningPlayer(GetTriggerUnit()) and IsUnitIllusion(GetFilterUnit()) == false then
		set U2 = GetFilterUnit()
	endif
	return false
endfunction
function XWI takes nothing returns nothing
	local unit TJX = GetTriggerUnit()
	local unit whichUnit
	local group g = AllocationGroup(249)
	local real x
	local real y
	set U2 = null
	call GroupEnumUnitsInRange(g, GetUnitX(TJX), GetUnitY(TJX), 1000, Condition(function XUI))
	call DeallocateGroup(g)
	set whichUnit = U2
	if whichUnit != null then
		set x = GetUnitX(whichUnit)
		set y = GetUnitY(whichUnit)
		call SetUnitPosition(TJX, x, y)
	endif
	set x = GetUnitX(TJX)+ 600 * Cos(GetUnitFacing(TJX)* bj_DEGTORAD)
	set y = GetUnitY(TJX)+ 600 * Sin(GetUnitFacing(TJX)* bj_DEGTORAD)
	call IssuePointOrderById(TJX, 851986, x, y)
	set TJX = null
	set whichUnit = null
	set g = null
endfunction
function XYI takes nothing returns boolean
	if GetUnitAbilityLevel(GetTriggerUnit(),'B03A')> 0 then
		call XWI()
	endif
	return false
endfunction
function MYX takes nothing returns nothing
	local trigger t = CreateTrigger()
	local region r = CreateRegion()
	call RegionAddRect(r, bj_mapInitialPlayableArea)
	call TriggerRegisterEnterRegion(t, r, null)
	call TriggerAddCondition(t, Condition(function XYI))
	set t = null
	set r = null
endfunction
function XZI takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit())) and UnitIsDead(GetFilterUnit()) == false)
endfunction
function X_I takes nothing returns nothing
	local unit R3O = GetTriggerUnit()
	local unit R4O = CreateUnit(GetOwningPlayer(R3O),'e022', GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()), 270)
	call UnitAddPermanentAbility(R4O,'A06T')
	call SetUnitAbilityLevel(R4O,'A06T', GetUnitAbilityLevel(R3O,'A07Z')+ GetUnitAbilityLevel(R3O,'A44S'))
	call UnitRemoveAbility(GetEnumUnit(),'B0ER')
	call IssueTargetOrderById(R4O, 852171, GetEnumUnit())
	set R3O = null
	set R4O = null
endfunction
function X0I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u
	local integer h = GetHandleId(t)
	local integer i = 1
	local integer X1I = LoadInteger(HY, h, 0)
	local integer C6R = LoadInteger(HY, h,-1)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	loop
		if HaveSavedHandle(HY, h, i) then
			set u = LoadUnitHandle(HY, h, i)
			if UnitAlive(u) and GetUnitAbilityLevel(u,'B0ER')> 0 then
				call UnitDamageTargetEx(whichUnit, u, 1, 175)
			else
				call RemoveSavedBoolean(HY, LoadInteger(HY, h, i),'B0ER')
				call RemoveSavedHandle(HY, h, i)
			endif
		endif
		set i = i + 1
	exitwhen i > C6R
	endloop
	if X1I > 10 then
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	elseif X1I == 0 then
		call TimerStart(t, 1, true, function X0I)
	endif
	set t = null
	set u = null
	set whichUnit = null
endfunction
function X2I takes unit whichUnit, group g returns nothing
	local timer t = CreateTimer()
	local unit u
	local integer h = GetHandleId(t)
	local integer hu
	local integer i = 1
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		set hu = GetHandleId(u)
		if GetUnitAbilityLevel(u,'B0ER') == 0 and LoadBoolean(HY, hu,'B0ER') == false then
			call SaveUnitHandle(HY, h, i, u)
			call SaveInteger(HY, h, i, hu)
			call SaveBoolean(HY, hu,'B0ER', true)
			set i = i + 1
		endif
		call GroupRemoveUnit(g, u)
	endloop
	call TimerStart(t, 0, false, function X0I)
	call SaveUnitHandle(HY, h, 0, whichUnit)
	call SaveInteger(HY, h,-1, i)
	set t = null
	set u = null
endfunction
function FYE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local group g = AllocationGroup(250)
	local boolean MDR = GetSpellAbilityId()!='A07Z'
	local integer hu = GetHandleId(GetOwningPlayer(u))
	local group gg
	local group g3
	local integer i
	local integer k
	local destructable d
	local boolean X3I = IsUnitHaveRearmAbility(u)
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 700, Condition(function XZI))
	if MDR then
		set gg = AllocationGroup(251)
		set g3 = AllocationGroup(252)
		set i = 0
		set k = LoadInteger(HY, hu,'EinF')
		loop
			set i = i + 1
		exitwhen i > k
			set d = LoadDestructableHandle(HY, hu,'EinF'+ i)
			if X3I == false or GetDistanceBetween(GetUnitX(u), GetUnitY(u), GetDestructableX(d), GetDestructableY(d))< 3000 then
				call GroupEnumUnitsInRange(gg, GetDestructableX(d), GetDestructableY(d), 800, Condition(function XZI))
				call GroupAddGroup(gg, g)
				call GroupAddGroup(gg, g3)
			endif
		endloop
		call X2I(u, g3)
		call DeallocateGroup(g3)
		call DeallocateGroup(gg)
	endif
	call ForGroup(g, function X_I)
	call DeallocateGroup(g)
	set u = null
	set g = null
	set gg = null
	set g3 = null
	set d = null
endfunction
function X4I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer hu
	local integer i
	local unit u = LoadUnitHandle(HY, h, 2)
	if GetTriggerEventId()!= EVENT_GAME_TIMER_EXPIRED then
		set hu = LoadInteger(HY, h, 0)
		set i = LoadInteger(HY, h, 1) -1
		call DestroyUbersplat(LoadUbersplatHandle(HY, h, 3))
		call KillUnit(u)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		loop
			set i = i + 1
		exitwhen HaveSavedHandle(HY, hu,'EinF'+ i + 1) == false
			call SaveDestructableHandle(HY, hu,'EinF'+ i, LoadDestructableHandle(HY, hu,'EinF'+ i + 1))
		endloop
		call SaveInteger(HY, hu,'EinF', LoadInteger(HY, hu,'EinF') -1)
	else
		call SetUbersplatRenderAlways(LoadUbersplatHandle(HY, h, 3), IsPlayerAlly(LocalPlayer, GetOwningPlayer(u)) or IsObserverPlayer(LocalPlayer) or(UnitVisibleToPlayer(u, LocalPlayer)))
	endif
	set t = null
	set u = null
	return false
endfunction
function FZE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer hu = GetHandleId(GetOwningPlayer(u))
	local destructable d = GetSpellTargetDestructable()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer c = LoadInteger(HY, hu,'EinF')
	local unit dummyUnit = CreateUnit(GetOwningPlayer(u),'ewsp', GetDestructableX(d), GetDestructableY(d), 0)
	local ubersplat ub = CreateUbersplat(GetUnitX(dummyUnit), GetUnitY(dummyUnit), "EINF", 255, 255, 255, 40, false, false)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(dummyUnit),'e00E', GetUnitX(dummyUnit), GetUnitY(dummyUnit), 0)
	call UnitAddPermanentAbility(dummyCaster,'A44T')
	call IssueTargetOrderById(dummyCaster, 852069, dummyUnit)
	set dummyCaster = null
	call SetUnitPathing(dummyUnit, false)
	call SetUnitX(dummyUnit, GetDestructableX(d))
	call SetUnitY(dummyUnit, GetDestructableY(d))
	call UnitRemoveType(dummyUnit, UNIT_TYPE_PEON)
	call PauseUnit(dummyUnit, true)
	call TriggerRegisterDeathEvent(t, d)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function X4I))
	call SaveDestructableHandle(HY, GetHandleId(GetOwningPlayer(u)),'EinF'+ c + 1, d)
	call SaveInteger(HY, hu,'EinF', c + 1)
	call SaveInteger(HY, h, 0, hu)
	call SaveInteger(HY, h, 1, c + 1)
	call SaveUnitHandle(HY, h, 2, dummyUnit)
	call SaveUbersplatHandle(HY, h, 3, ub)
	set ub = null
	set dummyUnit = null
	set t = null
	set d = null
	set u = null
endfunction
function HBX takes nothing returns nothing
	call SetPlayerAbilityAvailable(GetOwningPlayer(U2),'A01V', false)
endfunction
function HXX takes nothing returns nothing
	call UnitAddPermanentAbility(U2,'A01V')
	call SetPlayerAbilityAvailable(GetOwningPlayer(U2),'A01V', true)
endfunction
function X5I takes nothing returns boolean
	local destructable d = GetFilterDestructable()
	local real x
	local real y
	if (IsTreeDestructable(d) or GetDestructableTypeId(d)=='B005') and GetWidgetLife(d)> 0 then
		set x = GetWidgetX(d)-Temp__ArrayReal[ 201]
		set y = GetWidgetY(d)-Temp__ArrayReal[ 202]
		if Temp__ArrayReal[ 200]> SquareRoot(x * x + y * y) then
			call SaveBoolean(ObjectHashTable, 99999, 99995, true)
		endif
	endif
	set d = null
	return false
endfunction
// 坐标的范围内是否有树
function IsPointHaveTreeInRange takes real x, real y, real ZRO returns boolean
	local rect r = null
	set Temp__ArrayReal[ 200]= ZRO
	set Temp__ArrayReal[ 201]= x
	set Temp__ArrayReal[ 202]= y
	set ZRO = ZRO + 150
	set r = Rect(x -ZRO, y -ZRO, x + ZRO, y + ZRO)
	call SaveBoolean(ObjectHashTable, 99999, 99995, false)
	call EnumDestructablesInRect(r, Condition(function X5I), null)
	call RemoveRect(r)
	set r = null
	return LoadBoolean(ObjectHashTable, 99999, 99995)
endfunction
function X7I takes unit u returns nothing
	if GetUnitAbilityLevel(u,'A23N')> 0 then
		call SaveBoolean(ObjectHashTable, GetHandleId(u), StringHash("TreeInvisibility"), false)
		call UnitRemoveAbility(u,'B021')
		call UnitRemoveAbility(u,'B0E9')
		call UnitRemoveAbility(u,'A1GA')
		call UnitRemoveAbility(u,'A23N')
	endif
endfunction
function X8I takes nothing returns nothing
	local unit d = null
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(ObjectHashTable, WFV, 0)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	local boolean b1 = GetUnitAbilityLevel(u,'B021') == 0
	local boolean b2 = IsPointHaveTreeInRange(GetWidgetX(u), GetWidgetY(u), 375)
	if LoadBoolean(ObjectHashTable, GetHandleId(u), StringHash("TreeInvisibility")) and LoadBoolean(ObjectHashTable, WFV, 0) and b1 and b2 and UYX > 1 then
		set d = CreateUnit(GetOwningPlayer(u),'e00E', GetWidgetX(u), GetWidgetY(u), 0)
		call UnitAddAbility(d,'A01Z')
		call SetUnitAbilityLevel(d,'A01Z', LoadInteger(ObjectHashTable, WFV, 2))
		call L6X(u)
		call IssueTargetOrderById(d, 852069, u)
		call SaveInteger(ObjectHashTable, WFV, 0, UYX -1)
		set d = null
		set u = null
		set t = null
		return
	endif
	if UYX == 0 or UnitIsDead(u) or b1 or LoadBoolean(ObjectHashTable, GetHandleId(u), StringHash("TreeInvisibility")) == false then
		// debug call SingleDebug("del2")
		call SaveBoolean(ObjectHashTable, WFV, 0, false)
		call UnitRemoveAbility(u,'B0E9')
		call UnitRemoveAbility(u,'B021')
		call UnitRemoveAbility(u,'A1GA')
		call UnitRemoveAbility(u,'A23N')
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		set u = null
		return
	endif
	call SaveInteger(ObjectHashTable, WFV, 0, UYX -1)
	if b2 then
		call SaveInteger(ObjectHashTable, WFV, 1, 0)
	else
		set UYX = LoadInteger(ObjectHashTable, WFV, 1)
		if UYX == 9 then
			call UnitRemoveAbility(u,'B0E9')
			call UnitRemoveAbility(u,'B021')
			call UnitRemoveAbility(u,'A23N')
			call UnitRemoveAbility(u,'A1GA')
			call DestroyTimerAndFlushHT_P(t)
		else
			call SaveInteger(ObjectHashTable, WFV, 1, UYX + 1)
		endif
	endif
	set t = null
	set u = null
endfunction
function X9I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	if UnitAlive(u) and GetUnitAbilityLevel(u,'B021')> 0 then
		call L6X(u)
		call UnitAddPermanentAbility(u,'A1GA')
		call TimerStart(t, .1, true, function X8I)
		call SaveInteger(ObjectHashTable, WFV, 0, LoadInteger(ObjectHashTable, WFV, 0)-20)
		call SaveBoolean(ObjectHashTable, WFV, 0, true)
		call SaveBoolean(ObjectHashTable, GetHandleId(u), StringHash("TreeInvisibility"), true)
		set t = null
		set u = null
		return
	endif
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set u = null
endfunction
function OVI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	call UnitRemoveAbility(LoadUnitHandle(ObjectHashTable, GetHandleId(t), 0),'B021')
	call DestroyTimerAndFlushHT_P(t)
	set t = null
endfunction

// 大自然的掩护
function FPE takes nothing returns nothing
	local unit u = null
	local unit d = GetSpellTargetUnit()
	local timer t = CreateTimer()
	local integer WFV
	local integer WUV
	if IsPointHaveTreeInRange(GetWidgetX(d), GetWidgetY(d), 375) == false then
		call TimerStart(t, 0, false, function OVI)
		call SaveUnitHandle(ObjectHashTable, GetHandleId(t), 0, d)
		call UnitRemoveAbility(d,'B021')
		set d = null
		set t = null
		return
	endif
	set u = GetTriggerUnit()
	set WFV = GetHandleId(t)
	set WUV = GetUnitAbilityLevel(u,'A01Z')
	call SaveUnitHandle(ObjectHashTable, WFV, 0, d)
	call SaveInteger(ObjectHashTable, WFV, 0, WUV * 150)
	call SaveInteger(ObjectHashTable, WFV, 1, 0)
	call SaveInteger(ObjectHashTable, WFV, 2, WUV)
	call SaveBoolean(ObjectHashTable, WFV, 0, false)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Invisibility\\InvisibilityTarget.mdl", d, "chest"))
	call UnitAddPermanentAbility(d,'A23N')
	if u == d then
		call TimerStart(t, 2, false, function X9I)
		set d = null
		set u = null
		set t = null
		return
	endif
	call TimerStart(t, .1, true, function X8I)
	set d = null
	set u = null
	set t = null
endfunction
function OEI takes unit u returns nothing
	local real x = GetWidgetX(u)-Temp__ArrayReal[0]
	local real y = GetWidgetY(u)-Temp__ArrayReal[1]
	local real d = SquareRoot(x * x + y * y)
	if Temp__ArrayReal[2]> d then
		set Temp__ArrayReal[2]= d
		set Temp__ArrayUnit[1]= u
	endif
endfunction
function OXI takes integer id returns boolean
	return id =='u00M' or id =='u00N' or id =='u00D' or id =='u00T' or id =='usep' or id =='utod' or id =='unpl' or id =='e00R' or id =='e011' or id =='e00S' or id =='e019' or id =='eaom' or id =='eaoe' or id =='etol'
endfunction
function OOI takes nothing returns boolean
	local unit t = GetFilterUnit()
	if IsUnitAlly(Temp__ArrayUnit[0], GetOwningPlayer(t)) and(IsUnitType(t, UNIT_TYPE_HERO) or(IsUnitType(t, UNIT_TYPE_STRUCTURE) and OXI(GetUnitTypeId(t)))) and UnitAlive(t) then
		call OEI(t)
	endif
	set t = null
	return false
endfunction
function ORI takes unit u returns unit
	set Temp__ArrayUnit[0]= u
	set Temp__ArrayUnit[1]= null
	set Temp__ArrayReal[0]= GetSpellTargetX()
	set Temp__ArrayReal[1]= GetSpellTargetY()
	set Temp__ArrayReal[2]= 99999
	call GroupEnumUnitsInRange(AK, 0, 0, 99999, Condition(function OOI))
	return Temp__ArrayUnit[1]
endfunction
function OII takes nothing returns real
	local trigger t = LoadTriggerHandle(HY, GetHandleId(GetTriggerUnit()),'A2ML')
	local integer h = GetHandleId(t)
	local real damageValue = LoadReal(HY, h, 0)
	local integer HUX = LoadInteger(HY, h, 0)
	local real d = GetEventDamage()
	local real OAI = .0
	if d > 5 and HUX > 0 then
		call SaveInteger(HY, h, 0, HUX -1)
		set OAI = RMinBJ(d, damageValue)
		// debug call SingleDebug(R2S(OAI))
	endif
	set t = null
	return OAI
endfunction
function ONI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer c = LoadInteger(HY, h, 1)+ 1
	if GetUnitAbilityLevel(u,'A3KF') == 0 or LoadInteger(HY, h, 0) == 0 or c >= 15* 5 or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call RemoveSavedHandle(HY, GetHandleId(u),'A2ML')
		call UnitRemoveAbility(u,'A3KF')
		call UnitRemoveAbility(u,'B3KF')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SaveInteger(HY, h, 1, c)
		call SetWidgetLife(u, GetWidgetLife(u)+ LoadReal(HY, h, 1))
	endif
	set t = null
	set u = null
endfunction
function YKV takes nothing returns nothing
	local trigger t
	local unit u = GetTriggerUnit()
	local unit u2 = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(u,'A2ML')
	local integer h
	if u2 == null then
		set u2 = ORI(u)
	endif
	if HaveSavedHandle(HY, GetHandleId(u2),'A2ML') then
		set t = LoadTriggerHandle(HY, GetHandleId(u2),'A2ML')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, GetHandleId(u2),'A2ML', t)
		call TriggerRegisterDeathEvent(t, u2)
		call TriggerRegisterTimerEvent(t, .2, true)
		call TriggerAddCondition(t, Condition(function ONI))
		call SaveUnitHandle(HY, h, 0, u2)
	endif
	call UnitAddPermanentAbility(u2,'A3KF')
	call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 3 + level)
	call SaveInteger(HY, h, 1, 0)
	call SaveReal(HY, h, 0, 20. * level)
	call SaveReal(HY, h, 1,(.1 + .3 * level))
	set t = null
	set u = null
	set u2 = null
endfunction
function OBI takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit whichUnit = U2
	local unit targetUnit = MissileHitTargetUnit
	local real OCI = LoadReal(HY, h, 21)
	call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+ OCI)
	set whichUnit = null
	set targetUnit = null
endfunction
function ODI takes nothing returns nothing
	local trigger t = LaunchMissileByUnitDummy(JWV, GetEnumUnit(),'h0D8', "OBI", 400, false)
	call SaveReal(HY, GetHandleId(t), 21, JYV * 1.)
	set t = null
endfunction
function OFI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 5))
	local group g
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(targetUnit,'A272')
		call UnitRemoveAbility(targetUnit,'B0EL')
	else
		if GetTriggerEvalCount(t)> 6 then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call UnitRemoveAbility(targetUnit,'A272')
			call UnitRemoveAbility(targetUnit,'B0EL')
		endif
		call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\NightElf\\EntBirthTarget\\EntBirthTarget.mdl", targetUnit, "origin"))
		set U2 = whichUnit
		set g = AllocationGroup(253)
		call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 525, Condition(function D2X))
		set JWV = targetUnit
		set JYV = 12+ 12* level
		call ForGroup(g, function ODI)
		call DeallocateGroup(g)
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, JYV)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set g = null
	return false
endfunction
function OGI takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call UnitAddPermanentAbility(targetUnit,'A272')
	call TriggerRegisterTimerEvent(t, .75, true)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function OFI))
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveReal(HY, h, 442, GetGameTime()* 1.)
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function ELE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call OGI()
	endif
endfunction
function OHI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	local unit dummyUnit = LoadUnitHandle(HY, h, 2)
	local unit OJI
	local eventid OKI = GetTriggerEventId()
	local integer level = LoadInteger(HY, h, 3)
	local integer WRV
	if OKI == EVENT_UNIT_SPELL_EFFECT then
		set WRV = GetSpellAbilityId()
		if IsNotItemAbility(WRV) and LNX(WRV) == false and IsAttackSpecialEffects(WRV) == false and X5R(WRV) == false then
			call UnitDamageTargetEx(whichUnit, targetUnit, 1, level * 50 + 100 )
			call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\LastWordDamageSpell.mdx", targetUnit, "overhead"))
			set OJI = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
			call UnitAddAbility(OJI,'A0LS')
			call SetUnitAbilityLevel(OJI,'A0LS', level)
			call IssueTargetOrderById(OJI, 852585, targetUnit)
			call DestroyEffect(LoadEffectHandle(HY, h, 4))
			call RemoveUnit(dummyUnit)
			call CleanCurrentTrigger(t)
			call FlushChildHashtable(HY, h)
		endif
	elseif OKI == EVENT_WIDGET_DEATH then
		call DestroyEffect(LoadEffectHandle(HY, h, 4))
		call RemoveUnit(dummyUnit)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif LoadReal(HY, h, 5)+ 5 <= GetGameTime() then
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, level * 50 + 100 )
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\LastWordDamageSpell.mdx", targetUnit, "overhead"))
		set OJI = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitAddAbility(OJI,'Z051')
		call SetUnitAbilityLevel(OJI,'Z051', level)
		call IssueTargetOrderById(OJI, 852585, targetUnit)
		call DestroyEffect(LoadEffectHandle(HY, h, 4))
		call RemoveUnit(dummyUnit)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SetUnitX(dummyUnit, GetUnitX(targetUnit))
		call SetUnitY(dummyUnit, GetUnitY(targetUnit))
	endif
	set t = null
	set dummyUnit = null
	set targetUnit = null
	set whichUnit = null
	set OJI = null
	set OKI = null
endfunction
function W5V takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())
	local unit dummyUnit = CreateUnit(GetOwningPlayer(whichUnit),'o019', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local real time = GetGameTime()
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function OHI))
	call SaveUnitHandle(HY, h, 0, whichUnit)
	call SaveUnitHandle(HY, h, 1, targetUnit)
	call SaveUnitHandle(HY, h, 2, dummyUnit)
	call SaveInteger(HY, h, 3, level)
	call SaveEffectHandle(HY, h, 4, AddSpecialEffectTarget("war3mapImported\\LastWordDebuff_6.mdx", targetUnit, "overhead"))
	call SaveReal(HY, h, 5, time)
	set t = null
	set whichUnit = null
	set targetUnit = null
	set dummyUnit = null
endfunction
function OLI takes unit R8X, unit targetUnit returns nothing
	local real d =(.15 + .1 * I2R(GetUnitAbilityLevel(R8X,'A0LZ')))* GetHeroMaxAttributeValue(R8X)
	call UnitRemoveAbility(targetUnit,'B05X')
	call CommonTextTag("+" + I2S(R2I(d)), 1, targetUnit, .023, 3, 216, 216, 216)
	call UnitDamageTargetEx(R8X, targetUnit, 3, d)
endfunction
function OMI takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit whichUnit = MissileHitTargetUnit
	local real IXX =(LoadReal(HY, h, 20))
	call SetHeroInt(whichUnit, GetHeroInt(whichUnit, false)+ 2, true)
	call CommonTextTag("+2 " + GetObjectName('n0JP'), 3, whichUnit, .023, 0, 255, 0, 230)
	set whichUnit = null
endfunction
function OPI takes nothing returns nothing
	local unit whichUnit = GetEnumUnit()
	local unit triggerUnit = GetTriggerUnit()
	set JZV[GetPlayerId(GetOwningPlayer(whichUnit))]= JZV[GetPlayerId(GetOwningPlayer(whichUnit))] + 2
	call CommonTextTag("-2 " + GetObjectName('n0JP'), 3, triggerUnit, .023, 255, 0, 0, 230)
	call SetHeroInt(triggerUnit, GetHeroInt(triggerUnit, false)-2, true)
	call LaunchMissileByUnitDummy(triggerUnit, whichUnit,'h0CP', "OMI", 2400, false)
	set whichUnit = null
	set triggerUnit = null
endfunction
function OQI takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and GetUnitAbilityLevel(GetFilterUnit(),'A0LZ')> 0 and UnitIsDead(GetFilterUnit()) == false and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(U2)))!= null
endfunction
function OSI takes unit killingUnit, unit triggerUnit returns nothing
	local group g
	if IsUnitType(triggerUnit, UNIT_TYPE_HERO) == false or LoadBoolean(HY, GetHandleId(triggerUnit), QR) then
		return
	endif
	set g = AllocationGroup(254)
	set U2 = triggerUnit
	call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), 925, Condition(function OQI))
	if IsUnitType(killingUnit, UNIT_TYPE_HERO) == false then
		set killingUnit = Player__Hero[GetPlayerId(GetOwningPlayer(killingUnit))]
	endif
	if GetUnitAbilityLevel(killingUnit,'A0LZ')> 0 and UnitIsDead(killingUnit) == false and IsUnitEnemy(killingUnit, GetOwningPlayer(triggerUnit)) then
		call GroupAddUnit(g, killingUnit)
	endif
	if FirstOfGroup(g)!= null then
		call ForGroup(g, function OPI)
	endif
	call DeallocateGroup(g)
	set g = null
endfunction
function OTI takes integer id returns boolean
	return LNX(id) == false and IsNotItemAbility(id)
endfunction
function OUI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 5)
	local integer count = LoadInteger(HY, h, 34)
	if GetTriggerEventId()!= EVENT_WIDGET_DEATH and GetTriggerEventId()!= EVENT_UNIT_SPELL_EFFECT and count < 6 then
		set count = count + 1
		call SaveInteger(HY, h, 34, count)
		call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)-8 * level)
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 5 + 15* level)
	endif
	if count >= 6 or GetUnitAbilityLevel(targetUnit,'A1PS') == 0 or GetTriggerEventId() == EVENT_WIDGET_DEATH or(GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT and OTI(GetSpellAbilityId())) then
		call UnitRemoveAbility(targetUnit,'A1PS')
		call UnitRemoveAbility(targetUnit,'B0CQ')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function OWI takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetEnumUnit()
	local integer level = KA
	//local integer level=4
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call UnitAddPermanentAbility(targetUnit,'A1PS')
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function OUI))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY, h, 34, 0)
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function OYI takes nothing returns boolean
	return(IsUnitMagicImmune(GetFilterUnit()) == false and(IsUnitIdType(GetUnitTypeId(GetFilterUnit()), UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and RFX(GetFilterUnit()) == false and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit())))!= null
endfunction
function EME takes nothing returns nothing
	local group g = AllocationGroup(255)
	set U2 = GetTriggerUnit()
	call GroupEnumUnitsInRange(g, GetSpellTargetX(), GetSpellTargetY(), 375, Condition(function OYI))
	set KA = GetUnitAbilityLevel(U2,'A14L')
	call ForGroup(g, function OWI)
	call ABX("war3mapImported\\CotS.mdx", GetSpellTargetX(), GetSpellTargetY(), 5)
	call DeallocateGroup(g)
	set g = null
endfunction
function OZI takes nothing returns boolean
	local player p = LoadPlayerHandle(HY, GetHandleId(GetTriggeringTrigger()), 0)
	call RemoveSavedHandle(HY, GetHandleId(GetTriggeringTrigger()), 0)
	call CleanCurrentTrigger(GetTriggeringTrigger())
	if IsPlayerEnemy(p, LocalPlayer) then
		call VolumeGroupReset()
	endif
	return false
endfunction
function O_I takes nothing returns boolean
	return(IsUnitMagicImmune(GetFilterUnit()) == false and(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit())))!= null
endfunction
function O0I takes nothing returns nothing
	local group g
	local integer l = 4
	if l > 0 then
		set g = AllocationGroup(256)
		call GroupEnumUnitsInRange(g, 0, 0, 9999, Condition(function O_I))
		set KA = 4
		call ForGroup(g, function OWI)
		call DeallocateGroup(g)
	endif
	set g = null
endfunction
function EPE takes nothing returns nothing
	local location loc = GetUnitLoc(GetTriggerUnit())
	local trigger t = CreateTrigger()
	local integer level = GetUnitAbilityLevel(GetTriggerUnit(),'A0L3')
	if level == 0 then
		set level = 1 + GetUnitAbilityLevel(GetTriggerUnit(),'A2QC')
		call O0I()
	endif
	call TriggerRegisterTimerEvent(t, level + 3, false)
	call SavePlayerHandle(HY, GetHandleId(t), 0, GetTriggerPlayer())
	call TriggerAddCondition(t, Condition(function OZI))
	set bj_lastCreatedUnit = CreateUnit(GetTriggerPlayer(),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0)
	call ShowUnit(bj_lastCreatedUnit, false)
	call UnitApplyTimedLife(bj_lastCreatedUnit,'BTLF', 5)
	call UnitAddAbility(bj_lastCreatedUnit,'A0L2')
	call SetUnitAbilityLevel(bj_lastCreatedUnit,'A0L2', level)
	call IssuePointOrderByIdLoc(bj_lastCreatedUnit, 852592, loc)
	if IsPlayerEnemy(LocalPlayer, GetTriggerPlayer()) then
		call VolumeGroupSetVolume(SOUND_VOLUMEGROUP_UNITSOUNDS, .0)
		call VolumeGroupSetVolume(SOUND_VOLUMEGROUP_COMBAT, .0)
		call VolumeGroupSetVolume(SOUND_VOLUMEGROUP_SPELLS, .0)
		call VolumeGroupSetVolume(SOUND_VOLUMEGROUP_MUSIC, .0)
	endif
	call RemoveLocation(loc)
	set t = null
	set loc = null
endfunction

function range_Take_Aim takes nothing returns nothing
	local unit u = U2
	local integer lv = Q2
	call AddUnitBonusRange(u, 100. * lv, true)
	set u = null
endfunction

function PTE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	call AddUnitBonusRange(u, 100., true)
	set u = null
endfunction

function O1I takes nothing returns nothing
	if GetUnitAbilityLevel(DESource,'P102')!= 0 and GetUnitAbilityLevel(DESource,'A36D') == 0 and TKV(DESource,'P102', 40) then
		call UnitAddAbilityToTimed(DETarget,'A469', 1, .5,'B469')
		call UnitDamageTargetEx(DESource, DETarget, 2, 25 * GetUnitAbilityLevel(DESource,'P102') -10)
	endif
endfunction
function O2I takes nothing returns boolean
	return(DHX() and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false)!= null
endfunction
function O3I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit dummyCaster = LoadUnitHandle(HY, h, 19)
	local integer level = LoadInteger(HY, h, 5)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local group g = AllocationGroup(257)
	local real d
	local real a
	local real x2
	local real y2
	local unit u
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, x, y, 475, Condition(function O2I))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call UnitDamageTargetEx(whichUnit, u, 1, level * 12)
		set E3 = GetOwningPlayer(dummyCaster)
		call SetUnitOwner(dummyCaster, GetOwningPlayer(u), false)
		call IssueTargetOrderById(dummyCaster, 852075, u)
		call SetUnitOwner(dummyCaster, E3, false)
		call GroupRemoveUnit(g, u)
	endloop
	call DeallocateGroup(g)
	call DestroyEffect(LoadEffectHandle(HY, h, 309))
	call DestroyEffect(LoadEffectHandle(HY, h, 175))
	call DestroyEffect(LoadEffectHandle(HY, h, 176))
	call DestroyEffect(LoadEffectHandle(HY, h, 177))
	call DestroyEffect(LoadEffectHandle(HY, h, 178))
	call DestroyEffect(LoadEffectHandle(HY, h, 179))
	call DestroyEffect(LoadEffectHandle(HY, h, 180))
	call DestroyEffect(LoadEffectHandle(HY, h, 330))
	call DestroyEffect(LoadEffectHandle(HY, h, 331))
	if GetTriggerEvalCount(t) == 11 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set d = 0
		set a = 0
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h, 309, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
		set d = 150
		set a = 45
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h, 175, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
		set d = 275
		set a = 90
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h, 176, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
		set d = 150
		set a = 135
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h, 177, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
		set d = 275
		set a = 180
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h, 178, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
		set d = 150
		set a = 225
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h, 179, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
		set d = 275
		set a = 270
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h, 180, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
		set d = 150
		set a = 305
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h, 330, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
		set d = 275
		set a = 360
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h, 331, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
	endif
	set t = null
	set whichUnit = null
	set dummyCaster = null
	set g = null
	return false
endfunction
function O4I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local integer level = LoadInteger(HY, h, 0)
	local real x1 = LoadReal(HY, h, 6)
	local real y1 = LoadReal(HY, h, 7)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', x1, y1, 0)
	local real x2
	local real y2
	local real d
	local real a
	local integer i
	call UnitAddPermanentAbility(dummyCaster,'A19F')
	call SetUnitAbilityLevel(dummyCaster,'A19F', level)
	if GetTriggerEvalCount(t) == 1 then
		set i = 1
		loop
		exitwhen i > 10
			set d = GetRandomReal(0, 450)
			set a = GetRandomReal(0, 360)
			set x2 = x1 + d * Cos(a * bj_DEGTORAD)
			set y2 = y1 + d * Sin(a * bj_DEGTORAD)
			set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00J', GetUnitX(whichUnit), GetUnitY(whichUnit), 90)
			call IssuePointOrderById(dummyCaster, 851984, x2, y2)
			call UnitApplyTimedLife(dummyCaster,'BTLF', .5)
			set i = i + 1
		endloop
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2, whichUnit)
		call SaveUnitHandle(HY, h, 19, dummyCaster)
		call SaveReal(HY, h, 6, x1 * 1.)
		call SaveReal(HY, h, 7, y1 * 1.)
		call SaveInteger(HY, h, 5, level)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function O3I))
		call TriggerEvaluate(t)
	endif
	set whichUnit = null
	set dummyCaster = null
	set t = null
	return false
endfunction
function EQE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	call SaveInteger(HY, GetHandleId(u),'A064', LoadInteger(HY, GetHandleId(u),'A064')-1)
	call A8X(GetOwningPlayer(u), 9.4, x, y, 400)
	call TriggerRegisterTimerEvent(t, .4, true)
	call TriggerAddCondition(t, Condition(function O4I))
	call SaveUnitHandle(HY, h, 2, u)
	call SaveReal(HY, h, 6, x * 1.)
	call SaveReal(HY, h, 7, y * 1.)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(u,'A064'))
	set t = null
	set u = null
endfunction
function O5I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY,(h), 0))
	local real time =(LoadReal(HY,(h), 0))
	local integer HUX = LoadInteger(HY, GetHandleId(u),'A064')
	if HUX < 3 then
		set time = time -0.2
		if time <= 0.00 then
			call SaveInteger(HY, GetHandleId(u),'A064', HUX + 1)
			call SaveReal(HY, h, 0, 40.)
		else
			call SaveReal(HY, h, 0, time * 1.)
		endif
	endif
	if HUX == 0 or GetUnitAbilityLevel(u,'A064') == 0 then
		call UnitRemoveAbility(u,'A46B')
		call UnitRemoveAbility(u,'B46B')
	elseif GetUnitAbilityLevel(u,'A064')> 0 then
		call UnitAddPermanentAbility(u,'A46B')
	endif
	set u = null
	set t = null
	return false
endfunction
function O6I takes unit O7I returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerAddCondition(t, Condition(function O5I))
	call SaveUnitHandle(HY, GetHandleId(t), 0, O7I)
	call SaveReal(HY, GetHandleId(t), 0, 40.)
	call SaveInteger(HY, GetHandleId(O7I),'A064', 3)
	call SaveTriggerHandle(HY, GetHandleId(O7I),'A064', t)
	call SaveBoolean(HY, GetHandleId(O7I),'A064', true)
	call DisplayTimedTextToPlayer(GetOwningPlayer(O7I), 0, 0, 10, "|c00FF0000提示|r: 你可以输入指令|c00bd2222-charges|r来开启或关闭充能计数面板")
	set t = null
endfunction
function JPE takes nothing returns nothing
	if HaveSavedHandle(HY, GetHandleId(GetTriggerUnit()),'A064') == false then
		call O6I(GetTriggerUnit())
	endif
	if LoadInteger(HY, GetHandleId(GetTriggerUnit()),'A064') == 0 then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "能量点数不足")
	endif
endfunction
function LHE takes nothing returns nothing
	if HaveSavedHandle(HY, GetHandleId(GetTriggerUnit()),'A064') == false then
		call O6I(GetTriggerUnit())
	endif
endfunction
function M0X takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A19F')
endfunction
function O8I takes nothing returns nothing
	local unit damageSource = U2
	local unit targetUnit = MissileHitTargetUnit
	local integer h = GetHandleId(GetTriggeringTrigger())
	local integer level = LoadInteger(HY, h, 10)
	local real damageValue
	local group g = AllocationGroup(258)
	local unit u
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 350, Condition(function DJX))
	set damageValue = 205+ 150* level
	call GroupRemoveUnit(g, targetUnit)
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\Mortar\\MortarMissile.mdl", GetUnitX(targetUnit), GetUnitY(targetUnit)))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call UnitDamageTargetEx(damageSource, u, 1, damageValue)
		call GroupRemoveUnit(g, u)
	endloop
	call DestroyEffect(LoadEffectHandle(HY, GetHandleId(LoadUnitHandle(HY, h, 45)),-1))
	call DeallocateGroup(g)
	set g = null
	set damageSource = null
	set targetUnit = null
endfunction
function F8E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = LaunchMissileByUnitDummy(whichUnit, targetUnit,'n07D', "O8I", 2500, false)
	local integer h = GetHandleId(t)
	local unit d = LoadUnitHandle(HY, h, 45)
	local effect fx = AddSpecialEffectTarget("Abilities\\Weapons\\CannonTowerMissile\\CannonTowerMissile.mdl", d, "origin")
	call SaveInteger(HY, h, 10, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	call SaveEffectHandle(HY, GetHandleId(d),-1, fx)
	set fx = null
	set d = null
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function O9I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local effect FX =(LoadEffectHandle(HY, h, 32))
	local player p = GetOwningPlayer(trigUnit)
	call DestroyEffect(FX)
	call RemoveUnit(dummyCaster)
	call UnitRemoveAbility(targetUnit,'B06H')
	call UnitRemoveAbility(targetUnit,'A313')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set trigUnit = null
	set dummyCaster = null
	set targetUnit = null
	set FX = null
	set p = null
	return false
endfunction
function S0E takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local player p = GetOwningPlayer(trigUnit)
	local unit dummyCaster
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local string s = "effects\\Snipe Target.mdx"
	if IsPlayerAlly(LocalPlayer, p) or IsObserverPlayer(LocalPlayer) then
		set s = ""
	endif
	call UnitAddPermanentAbility(targetUnit,'A313')
	call GHX(targetUnit, trigUnit,'A313')
	set dummyCaster = CreateUnit(GetOwningPlayer(targetUnit),'e01R', 0, 0, 0)
	call UnitAddPermanentAbility(dummyCaster,'A0NI')
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget(s, targetUnit, "overhead")))
	call TriggerRegisterTimerEvent(t, 4, false)
	call TriggerRegisterUnitEvent(t, trigUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function O9I))
	set t = null
	set trigUnit = null
	set targetUnit = null
	set dummyCaster = null
	set p = null
endfunction
function RVI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group AIR = LoadGroupHandle(HY, h, 0)
	local group gg
	local integer c = LoadInteger(HY, h, 0)
	local unit u2
	if c < 60 then
		set gg = AllocationGroup(259)
		set U2 = LoadUnitHandle(HY, h, 1)
		call GroupEnumUnitsInRange(gg, LoadReal(HY, h, 0), LoadReal(HY, h, 1), 250+ 25 * LoadInteger(HY, h, 5), Condition(function DPX))
		loop
			set u2 = FirstOfGroup(AIR)
		exitwhen u2 == null
			call SetUnitTurnSpeed(u2, GetUnitDefaultTurnSpeed(u2))
			call GroupRemoveUnit(AIR, u2)
		endloop
		loop
			set u2 = FirstOfGroup(gg)
		exitwhen u2 == null
			if GetUnitAbilityLevel(u2,'B0BS') == 0 then
				call GroupAddUnit(AIR, u2)
				call SetUnitTurnSpeed(u2, GetUnitDefaultTurnSpeed(u2)* .7)
			endif
			call GroupRemoveUnit(gg, u2)
		endloop
		call SaveInteger(HY, h, 0, c + 1)
		call DeallocateGroup(gg)
	else
		loop
			set u2 = FirstOfGroup(AIR)
		exitwhen u2 == null
			if GetUnitAbilityLevel(u2,'B0BS') == 0 then
				call SetUnitTurnSpeed(u2, GetUnitDefaultTurnSpeed(u2))
			endif
			call GroupRemoveUnit(AIR, u2)
		endloop
		call DeallocateGroup(AIR)
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	endif
	set t = null
	set AIR = null
	set u2 = null
	set gg = null
endfunction
function ESE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'e003', x, y, 0)
	local integer level = GetUnitAbilityLevel(trigUnit,'A0RG')
	local real REI =(83 + 17 * level)* .01
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .1, true, function RVI)
	call SaveGroupHandle(HY, h, 0, AllocationGroup(260))
	call SaveReal(HY, h, 0, x)
	call SaveReal(HY, h, 1, y)
	call SaveInteger(HY, h, 5, level)
	call SaveUnitHandle(HY, h, 1, trigUnit)
	set t = null
	call SetUnitVertexColor(dummyCaster, 255, 255, 255, 150)
	call UnitApplyTimedLife(dummyCaster,'BTLF', 6)
	call SetUnitScale(dummyCaster, REI, REI, REI)
	if IsScourgePlayer(GetOwningPlayer(trigUnit)) then
		call UnitAddPermanentAbility(dummyCaster,'A019')
		call SetUnitAbilityLevel(dummyCaster,'A019', level)
	else
		call UnitAddPermanentAbility(dummyCaster,'A0E7')
		call SetUnitAbilityLevel(dummyCaster,'A0E7', level)
	endif
	call EnableAttackEffectByTime(B, 8.)
	set F = level
	call IssuePointOrderById(dummyCaster, 852473, x, y)
	set trigUnit = null
	set dummyCaster = null
endfunction
function RXI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	local integer damageValue = LoadInteger(ObjectHashTable, GetHandleId(whichUnit),'BACK')
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
		call RemoveSavedHandle(ObjectHashTable, GetHandleId(whichUnit),'BACK')
	elseif GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamageSource() == whichUnit and AD < 1 and GetEventDamage()> 0 then
			call SaveInteger(ObjectHashTable, GetHandleId(whichUnit),'BACK', 0)
			call RemoveSavedHandle(ObjectHashTable, GetHandleId(whichUnit),'BACK')
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", targetUnit, "chest"))
			call UnitDamageTargetEx(whichUnit, targetUnit, 2, damageValue)
		endif
	else
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
		call RemoveSavedHandle(ObjectHashTable, GetHandleId(whichUnit),'BACK')
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function ROI takes unit u, unit t returns nothing
	local integer WUV = GetUnitAbilityLevel(u,'A0DZ')
	local real d
	local unit dummyUnit
	local real ENI
	local integer prevdmg
	local integer RRI
	local trigger tt
	local integer h
	local integer i
	local integer ms
	if WUV == 0 or GetUnitAbilityLevel(u,'A36D') == 1 then
		return
	endif
	set d = RAbsBJ(GetUnitFacing(u)-GetUnitFacing(t))
	if d > 180 then
		set d = 360 -d
	endif
	if LoadInteger(ObjectHashTable, GetHandleId(u),'BACK')> 0 then
		call SaveInteger(ObjectHashTable, GetHandleId(u),'BACK', 0)
	endif
	if LoadTriggerHandle(ObjectHashTable, GetHandleId(u),'BACK')!= null then
		call FlushChildHashtable(HY, GetHandleId(LoadTriggerHandle(ObjectHashTable, GetHandleId(u),'BACK')))
		call DestroyTrigger(LoadTriggerHandle(ObjectHashTable, GetHandleId(u),'BACK'))
	endif
	if IsUnitType(t, UNIT_TYPE_STRUCTURE) == false and IsUnitIllusion(u) == false and d <='i' then
		set ENI = .25 * WUV
		set ms = GetHeroMainAttributesType(u)
		if ms == HERO_ATTRIBUTE_INT then
			set i = GetHeroInt(u, true)
		elseif ms == HERO_ATTRIBUTE_AGI then
			set i = GetHeroAgi(u, true)
		elseif ms == HERO_ATTRIBUTE_STR then
			set i = GetHeroStr(u, true)
		endif
		set RRI = R2I(i *(ENI))
		call SaveInteger(ObjectHashTable, GetHandleId(u),'BACK', RRI)
		set tt = CreateTrigger()
		set h = GetHandleId(tt)
		call SaveUnitHandle(HY, h, 0, u)
		call SaveUnitHandle(HY, h, 1, t)
		call TriggerRegisterTimerEvent(tt, 5, false)
		call TriggerRegisterDeathEvent(tt, u)
		call TriggerRegisterUnitEvent(tt, t, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(tt, Condition(function RXI))
		call SaveTriggerHandle(ObjectHashTable, GetHandleId(u),'BACK', tt)
		set tt = null
	endif
	set dummyUnit = null
endfunction
function RII takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY,(h), 0))
	local real time =(LoadReal(HY,(h), 0))
	local integer HUX =(LoadInteger(HY,(GetHandleId(u)),('A0K9')))
	if HUX < GetUnitAbilityLevel(u,'A0K9')+ 3 then
		set time = time -0.2
		if time <= 0.00 then
			call SaveInteger(HY, GetHandleId(u),'A0K9', HUX + 1)
			call SaveReal(HY, h, 0, 35.)
		else
			call SaveReal(HY, h, 0, time * 1.)
		endif
	endif
	set u = null
	set t = null
	return false
endfunction
function RAI takes unit O7I, unit RNI returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerAddCondition(t, Condition(function RII))
	call SaveUnitHandle(HY, GetHandleId(t), 0, O7I)
	call SaveReal(HY, GetHandleId(t), 0, 35.)
	call SaveInteger(HY, GetHandleId(O7I),'A0K9', GetUnitAbilityLevel(RNI,'A0K9')+ 3)
	call SaveTriggerHandle(HY, GetHandleId(O7I),'A0K9', t)
	call DisplayTimedTextToPlayer(GetOwningPlayer(O7I), 0, 0, 10, "|c00FF0000提示|r: 你可以输入指令|c00bd2222-charges|r来开启或关闭充能计数面板")
	set t = null
endfunction
function RBI takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local real IXX = 10+ 30 * GetUnitAbilityLevel(whichUnit,'A0K9')
	local real x = GetUnitX(targetUnit)-75 * Cos(GetUnitFacing(targetUnit)* bj_DEGTORAD)
	local real y = GetUnitY(targetUnit)-75 * Sin(GetUnitFacing(targetUnit)* bj_DEGTORAD)
	call SetUnitX(whichUnit, x)
	call SetUnitY(whichUnit, y)
	call SetUnitFacing(whichUnit, GetUnitFacing(targetUnit))
	call DestroyEffect(AddSpecialEffect("war3mapImported\\BlinkStrike.mdx", x, y))
	if IsUnitEnemy(targetUnit, GetOwningPlayer(whichUnit)) then
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, IXX)
		call SaveBoolean(HY,(GetHandleId(whichUnit)), 332,(true))
		call WPE(whichUnit, targetUnit)
	endif
	set whichUnit = null
	set targetUnit = null
endfunction
function ETE takes nothing returns nothing
	local integer HUX = LoadInteger(HY, GetHandleId(GetTriggerUnit()),'A0K9')
	call SaveInteger(HY, GetHandleId(GetTriggerUnit()),'A0K9', HUX -1)
	if IsPlayerAlly(GetTriggerPlayer(), GetOwningPlayer(GetSpellTargetUnit())) or not UnitHasSpellShield(GetSpellTargetUnit()) then
		call RBI()
	endif
endfunction
function KYE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer HUX = LoadInteger(HY, GetHandleId(u),'A0K9')
	if HUX == 0 then
		if HaveSavedHandle(HY, GetHandleId(u),'A0K9') == false then
			call RAI(u, u)
			set HUX = LoadInteger(HY, GetHandleId(u),'A0K9')
		endif
	endif
	if HUX <= 0 then
		call EXStopUnit(u)
		call InterfaceErrorForPlayer(GetOwningPlayer(u), "能量点数不足")
	else
		call DestroyEffect(AddSpecialEffect("war3mapImported\\BlinkStrike.mdx", GetUnitX(u), GetUnitY(u)))
	endif
endfunction
function PXE takes nothing returns nothing
	if HaveSavedHandle(HY, GetHandleId(GetTriggerUnit()),'A0K9') then
		call SaveInteger(HY, GetHandleId(GetTriggerUnit()),'A0K9', LoadInteger(HY, GetHandleId(GetTriggerUnit()),'A0K9')+ 1)
	else
		call RAI(GetTriggerUnit(), GetTriggerUnit())
	endif
endfunction
function RCI takes unit u returns nothing
	local integer i
	if GetUnitAbilityLevel(u,'A30F')> 0 then
		call UnitRemoveAbility(u,'A30F')
		call UnitRemoveAbility(u,'A46I')
		set i = GetUnitAbilityLevel(u,'A00J')
		call UnitRemoveAbility(u,'A00J')
		call UnitAddPermanentAbility(u,'A00J')
		call SetUnitAbilityLevel(u,'A00J', i)
	endif
endfunction
function RDI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u
	if GetTriggerEventId() == EVENT_UNIT_SPELL_CAST then
		if GetSpellAbilityId()=='A0K9' or IsAttackSpecialEffects(GetSpellAbilityId()) then
			set u = GetTriggerUnit()
			call SaveBoolean(OtherHashTable, GetHandleId(u), 23, false)
			call RCI(u)
			set u = null
		endif
	elseif GetTriggerEventId() == EVENT_PLAYER_UNIT_ATTACKED then
		if GetAttacker() == LoadUnitHandle(ObjectHashTable, h, 0) then
			set u = GetAttacker()
			call SaveBoolean(OtherHashTable, GetHandleId(u), 23, false)
			call RCI(u)
			set u = null
		endif
	else
		set u = LoadUnitHandle(ObjectHashTable, h, 0)
		if GetUnitTypeId(u) == 0 then
			call FlushChildHashtable(OtherHashTable, GetHandleId(u))
			call FlushChildHashtable(ObjectHashTable, h)
			call CleanCurrentTrigger(t)
		else
			if LoadBoolean(OtherHashTable, GetHandleId(u), 23) and DXX(u) then
				if GetUnitAbilityLevel(u,'A30F') == 0 then
					call UnitAddPermanentAbility(u,'A30F')
				endif
			endif
		endif
	endif
	set t = null
	set u = null
endfunction
function LTE takes nothing returns nothing
	local unit u
	local trigger t
	local integer h
	call L6X(GetTriggerUnit())
	//if not Mode__RearmCombos then 
	set u = null
	set t = null
	return
	//endif
	set u = GetTriggerUnit()
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .2, true)
	call SaveUnitHandle(ObjectHashTable, h, 0, u)
	call SaveBoolean(OtherHashTable, GetHandleId(u), 23, true)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_CAST)
	call TriggerAddCondition(t, Condition(function RDI))
	set u = null
	set t = null
endfunction
function RFI takes nothing returns boolean
	return(UnitIsDead(GetFilterUnit()) == false and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and IsUnitAlly(LoadUnitHandle(OtherHashTable2,'A2IS','cast'), GetOwningPlayer(GetFilterUnit())) and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false and IsUnitIllusion(GetFilterUnit()) == false)!= null
endfunction
function RGI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer c = LoadInteger(HY, h, 0)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or c <= 0 or GetUnitAbilityLevel(u,'C025') == 0 then
		call UnitReduceStateBonus(u, LoadInteger(HY, h, 1), UNIT_BONUS_ARMOR)
		call UnitRemoveAbility(u,'C025')
		call UnitRemoveAbility(u,'D025')
		call FlushChildHashtable(HY, h)
		call RemoveSavedHandle(HY, GetHandleId(u),'A2IS')
		call CleanCurrentTrigger(t)
	else
		call SaveInteger(HY, h, 0, c -1)
	endif
	set t = null
	set u = null
endfunction
function RHI takes nothing returns nothing
	local unit u = GetEnumUnit()
	local trigger t
	local integer h
	local integer hu = GetHandleId(u)
	local integer level = LoadInteger(OtherHashTable2,'A2IS','levl')
	if HaveSavedHandle(HY, hu,'A2IS') then
		set t = LoadTriggerHandle(HY, hu,'A2IS')
		set h = GetHandleId(t)
		call SaveInteger(HY, h, 0, 70)
		call UnitAddStateBonus(u, 5 * level, UNIT_BONUS_ARMOR)
		call SaveInteger(HY, h, 1, LoadInteger(HY, h, 1)+ 5 * level)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerRegisterDeathEvent(t, u)
		call SaveUnitHandle(HY, h, 0, u)
		call SaveInteger(HY, h, 0, 70)
		call SaveTriggerHandle(HY, hu,'A2IS', t)
		call TriggerAddCondition(t, Condition(function RGI))
		call UnitAddStateBonus(u, 5 * level, UNIT_BONUS_ARMOR)
		call SaveInteger(HY, h, 1, 5 * level)
		call UnitAddPermanentAbility(u,'C025')
	endif
	set u = null
	set t = null
endfunction
function YGV takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local group g = AllocationGroup(261)
	call SaveUnitHandle(OtherHashTable2,'A2IS','cast', u)
	call SaveInteger(OtherHashTable2,'A2IS','levl', GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl", u, "overhead"))
	call GroupEnumUnitsInRange(g, GetWidgetX(u), GetWidgetY(u), 925, Condition(function RFI))
	call ForGroup(g, function RHI)
	call FlushChildHashtable(OtherHashTable2,'A2IS')
	call DeallocateGroup(g)
	set g = null
	set u = null
endfunction
function RJI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	call UnitRemoveAbility(u,'A0WO')
	call UnitRemoveAbility(u,'A43G')
	call UnitRemoveAbility(u,'B009')
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set u = null
	set t = null
endfunction
function EUE takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local unit trigUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(trigUnit, GetSpellAbilityId())
	call TimerStart(t, 25, false, function RJI)
	call SaveUnitHandle(HY, h, 0, trigUnit)
	call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\BattleCryCaster.mdx", trigUnit, "overhead"))
	call UnitAddPermanentAbility(trigUnit,'A0WO')
	call UnitMakeAbilityPermanent(trigUnit, true,'A0WM')
	call SetUnitAbilityLevel(trigUnit,'A0WM', level)
	call SetPlayerAbilityAvailable(GetOwningPlayer(trigUnit),'A0WO', false)
	if GetSpellAbilityId()=='A43D' then
		call UnitAddPermanentAbility(trigUnit,'A43G')
		call UnitMakeAbilityPermanent(trigUnit, true,'A43F')
		call SetUnitAbilityLevel(trigUnit,'A43F', level)
		call SetPlayerAbilityAvailable(GetOwningPlayer(trigUnit),'A43G', false)
	endif
	set trigUnit = null
	set t = null
endfunction
function RKI takes nothing returns nothing
	call UnitDamageTargetEx(J_V, GetEnumUnit(), 1, XK[4])
	call CommonUnitAddStun(GetEnumUnit(), 2., false)
endfunction
function RLI takes unit whichUnit, player p, unit targetUnit, integer level returns nothing
	local unit dummyCaster = CreateUnit(p,'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local integer E8I
	local group g = AllocationGroup(262)
	if GetUnitAbilityLevel(targetUnit,'A3E9') == 1 and IsUnitMagicImmune(whichUnit) == false then
		call SaveUnitHandle(OtherHashTable2,'A3E9', 0, targetUnit)
		call SaveUnitHandle(OtherHashTable2,'A3E9', 1, whichUnit)
		call SaveInteger(OtherHashTable2,'A3E9', 0, level)
		call ExecuteFunc("RMI")
	endif
	set U2 = Player__Hero[GetPlayerId(p)]
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 280, Condition(function DJX))
	call GroupAddUnit(g, targetUnit)
	set J_V = dummyCaster
	set Temp__ArrayUnit[0]= targetUnit
	set Temp__Player = p
	set XK[4]= 25 + level * 50
	call ForGroup(g, function RKI)
	call DeallocateGroup(g)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\StormBolt\\StormBoltMissile.mdl", targetUnit, "origin"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\StormBolt\\StormBoltMissile.mdl", targetUnit, "origin"))
	set dummyCaster = null
	set g = null
endfunction
function RPI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player p
	local unit targetUnit
	local integer level
	local unit missileDummy
	local real x
	local real y
	local real tx
	local real ty
	local boolean RQI
	local real NFX
	local real NGX
	local real NAX
	local real NNX
	local real targetX
	local real targetY
	local boolean I1O
	if GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
		if OXX(GetSpellAbilityId()) then
			call SaveBoolean(HY, h, 0, true)
			call SaveReal(HY, h, 0, GetUnitX(GetTriggerUnit()))
			call SaveReal(HY, h, 1, GetUnitY(GetTriggerUnit()))
		endif
	else
		set p =(LoadPlayerHandle(HY, h, 54))
		set targetUnit = LoadUnitHandle(HY, h, 30)
		set level =(LoadInteger(HY, h, 5))
		set missileDummy =(LoadUnitHandle(HY, h, 45))
		set x = GetUnitX(missileDummy)
		set y = GetUnitY(missileDummy)
		set tx = GetUnitX(targetUnit)
		set ty = GetUnitY(targetUnit)
		set RQI = LoadBoolean(HY, h, 0)
		set NFX = LoadReal(HY, h, 0)
		set NGX = LoadReal(HY, h, 1)
		set NAX = 1000* .035
		if RQI then
			set tx = NFX
			set ty = NGX
		endif
		set NNX = AngleBetweenXY(x, y, tx, ty)
		set targetX = x + NAX * Cos(NNX * bj_DEGTORAD)
		set targetY = y + NAX * Sin(NNX * bj_DEGTORAD)
		set I1O =(LoadBoolean(HY, h, 249))
		call SetUnitX(missileDummy, targetX)
		call SetUnitY(missileDummy, targetY)
		call SetUnitFacing(missileDummy, NNX)
		if GetDistanceBetween(tx, ty, targetX, targetY)<= NAX then
			if RQI == false and I1O then
				call RLI(LoadUnitHandle(HY, h, 31), p, targetUnit, level)
			endif
			call KillUnit(missileDummy)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set targetUnit = null
	set missileDummy = null
	set p = null
	return false
endfunction
function RSI takes unit whichUnit, unit targetUnit, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit missileDummy = CreateUnit(GetOwningPlayer(whichUnit),'h07Q', GetUnitX(whichUnit), GetUnitY(whichUnit), AngleBetweenXY(GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitX(targetUnit), GetUnitY(targetUnit)))
	local boolean I1O = UnitHasSpellShield(targetUnit) == false
	call SaveBoolean(HY, h, 249,(I1O))
	call SavePlayerHandle(HY, h, 54,(GetOwningPlayer(whichUnit)))
	call SaveUnitHandle(HY, h, 30, targetUnit)
	call SaveUnitHandle(HY, h, 31, whichUnit)
	call SaveUnitHandle(HY, h, 45,(missileDummy))
	call SaveInteger(HY, h, 5,(level))
	call SaveBoolean(HY, h, 0, false)
	call SaveReal(HY, h, 0, 0)
	call SaveReal(HY, h, 1, 0)
	call TriggerRegisterTimerEvent(t, .035, true)
	call TriggerAddCondition(t, Condition(function RPI))
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_SPELL_EFFECT)
	set t = null
	set missileDummy = null
endfunction
function EWE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A190')
	call RSI(whichUnit, targetUnit, level)
	set whichUnit = null
	set targetUnit = null
endfunction
function RMI takes nothing returns nothing
	call T4V(LoadUnitHandle(OtherHashTable2,'A3E9', 0))
	call RSI(LoadUnitHandle(OtherHashTable2,'A3E9', 0), LoadUnitHandle(OtherHashTable2,'A3E9', 1), LoadInteger(OtherHashTable2,'A3E9', 0))
	call FlushChildHashtable(OtherHashTable2,'A3E9')
endfunction
function KZE takes nothing returns nothing
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Bolt\\BoltImpact.mdl", GetTriggerUnit(), GetHeroWeaponAttachPointName(GetTriggerUnit())))
endfunction
function RTI takes nothing returns boolean
	return(GetUnitTypeId(GetFilterUnit())=='n01G') or(GetUnitTypeId(GetFilterUnit())=='n01C') or(GetUnitTypeId(GetFilterUnit())=='n018') or(GetUnitTypeId(GetFilterUnit())=='n004')
endfunction
function EYE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit u
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	local integer level = GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())
	local group g = AllocationGroup(263)
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(whichUnit), Condition(function RTI))
	set u = FirstOfGroup(g)
	call DeallocateGroup(g)
	call UnitAddPermanentAbility(dummyCaster,'A0AE')
	call SetUnitAbilityLevel(dummyCaster,'A0AE', level)
	call IssueTargetOrderById(dummyCaster, 852101, whichUnit)
	if u != null and UnitAlive(u) then
		call IssueTargetOrderById(dummyCaster, 852101, u)
	endif
	set g = null
	set whichUnit = null
	set u = null
	set dummyCaster = null
endfunction
function RUI takes nothing returns boolean
	return IsBearUnit(GetFilterUnit()) and IsUnitIllusion(GetFilterUnit()) == false and UnitIsDead(GetFilterUnit()) == false
endfunction
function SLE takes nothing returns nothing
	local integer level = GetUnitAbilityLevel(GetTriggerUnit(),'A0A8')
	local group g = AllocationGroup(264)
	local unit RWI
	local unit u
	call GroupEnumUnitsOfPlayer(g, GetTriggerPlayer(), Condition(function RUI))
	if FirstOfGroup(g)!= null then
		set RWI = FirstOfGroup(g)
		
		call SetUnitMoveSpeed(RWI, GetUnitDefaultMoveSpeed(RWI)+ 8 * level)
		
		if GetUnitAbilityLevel(RWI,'A3IL') == 0 then
			call UnitAddPermanentAbility(RWI,'A3IL')
		endif
		call SetUnitAbilityLevel(RWI,'A3IL', level)
	endif
	call GroupEnumUnitsOfPlayer(g, GetTriggerPlayer(), null)
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if GetUnitAbilityLevel(u,'A0KO')> 0 then
			call SetUnitMoveSpeed(u, GetUnitDefaultMoveSpeed(u)+ 20 + 10* level)
		endif
		if RHX(GetUnitTypeId(u)) then
			call RGX(u, level)
		endif
		call GroupRemoveUnit(g, u)
	endloop
	call SetPlayerTechResearched(GetTriggerPlayer(),'Recb', level)
	call DeallocateGroup(g)
endfunction
function RYI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 2)
	local real time
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamage()> 2 and GetEventDamageSource()!= GetTriggerUnit() and XFX(GetOwningPlayer(GetEventDamageSource())) then
			call SaveReal(HY, h, 785, GetGameTime()* 1.)
			call SaveReal(HY, GetHandleId(u), 785, GetGameTime()* 1.)
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A0A7', false)
		endif
	endif
	set time = LoadReal(HY, h, 785)
	if time + 3 < GetGameTime() then
		if (LoadInteger(HY, h, 34)) == 2 then
			call SaveInteger(HY, h, 34, 1)
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A0A7', true)
		endif
	else
		if (LoadInteger(HY, h, 34)) == 1 then
			call SaveInteger(HY, h, 34, 2)
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A0A7', false)
		endif
	endif
	set t = null
	set u = null
	return false
endfunction
function RZI takes unit RWI returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerRegisterUnitEvent(t, RWI, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(t, RWI, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function RYI))
	call SaveUnitHandle(HY, h, 2, RWI)
	call SaveReal(HY, h, 785, .0)
	call SaveInteger(HY, h, 34, 1)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(RWI),'A0A7', true)
	set t = null
endfunction
function R_I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 0)
	local unit RWI = LoadUnitHandle(HY, h, 1)
	local integer c = LoadInteger(HY, h, 0)+ 1
	call SaveInteger(HY, h, 0, c)
	if GetHandleId(RWI)!= 0 and(GetUnitAbilityLevel(targetUnit,'B0C1')> 0 or c == 1) then
		call UnitDamageTargetEx(I_X(RWI), targetUnit, 2, 30)
	endif
	if UnitIsDead(targetUnit) or(GetUnitAbilityLevel(targetUnit,'B0C1') == 0 and c > 1) then
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	elseif c == 1 then
		call TimerStart(t, .5, true, function R_I)
	endif
	set targetUnit = null
	set RWI = null
	set t = null
endfunction
function R0I takes unit X1O, unit targetUnit returns nothing
	local unit d = CreateUnit(GetOwningPlayer(X1O),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, 0, false, function R_I)
	call SaveUnitHandle(HY, h, 0, targetUnit)
	call SaveUnitHandle(HY, h, 1, X1O)
	call UnitAddAbility(d,'A1GZ')
	call IssueTargetOrderById(d, 852106, targetUnit)
	set d = null
	set t = null
endfunction
function R1I takes unit R8X, unit targetUnit returns nothing
	if GetUnitAbilityLevel(R8X,'A33C')> 0 and GetUnitAbilityLevel(R8X,'A36D') == 0 and GetGameTime()> LoadReal(ObjectHashTable, GetHandleId(R8X),'A33C') and TKV(R8X,'A33C', 20) then
		call SaveReal(ObjectHashTable, GetHandleId(R8X),'A33C', GetGameTime()+ 5)
		call R0I(R8X, targetUnit)
	endif
endfunction
function R3I takes nothing returns boolean
	return IsBearUnit(GetFilterUnit()) and GetUnitTypeId(GetFilterUnit())!='n01G' and UnitIsDead(GetFilterUnit()) == false
endfunction
function R4I takes nothing returns nothing
	local integer h = GetHandleId(GetOwningPlayer(GetTriggerUnit()))
	local unit u = LoadUnitHandle(HY, h, 334)
	local unit WZV = LoadUnitHandle(HY, h, 333)
	if u != null and not Mode__DeathMatch  then
		call UnitAddItem(WZV, UnitRemoveItemFromSlot(u, 0))
		call UnitAddItem(WZV, UnitRemoveItemFromSlot(u, 1))
		call UnitAddItem(WZV, UnitRemoveItemFromSlot(u, 2))
		call UnitAddItem(WZV, UnitRemoveItemFromSlot(u, 3))
		call UnitAddItem(WZV, UnitRemoveItemFromSlot(u, 4))
		call UnitAddItem(WZV, UnitRemoveItemFromSlot(u, 5))
		if GetUnitAbilityLevel(u,'A398')> 0 then
			call UnitAddPermanentAbility(WZV,'A398')
		endif
	endif
	set u = null
	set WZV = null
endfunction
function R5I takes unit u, integer level, player p, boolean b returns nothing
	if level == 0 then
		return
	endif
	call UnitAddPermanentAbility(u,'A34C')
	call SetUnitAbilityLevel(u,'A34C', level)
	call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A34C', true)
	if b then
		call TriggerRegisterUnitEvent(UnitEventMainTrig, u, EVENT_UNIT_SPELL_EFFECT)
	endif
endfunction
function PYE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local group g
	local integer level = GetUnitAbilityLevel(u,'A0A5')
	local integer i
	local unit RWI
	call SetPlayerTechResearched(GetOwningPlayer(GetTriggerUnit()),'R000', level)
	if level > 1 then
		set g = AllocationGroup(265)
		call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(u), Condition(function R3I))
		set i = CountUnitsInGroup(g)
		if (i == 1) then
			set RWI = FirstOfGroup(g)
			call AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl", RWI, "chest")
			if (level == 2) then
				call UnitAddMaxLife(RWI, 400)
				call UnitAddPermanentAbility(RWI,'A0A7')
				call RZI(RWI)
			elseif (level == 3) then
				call UnitAddMaxLife(RWI, 500)
				call UnitAddPermanentAbility(RWI,'A33C')
			elseif (level == 4) then
				call UnitAddMaxLife(RWI, 400)
				call UnitAddPermanentAbility(RWI,'A03A')
				call UnitAddPermanentAbility(RWI,'A0AH')
			endif
			call R5I(RWI, level -1, p, true)
		endif
		call DeallocateGroup(g)
	endif
	set g = null
	set u = null
	set RWI = null
endfunction
function R6I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit RWI = LoadUnitHandle(HY, h, 0)
	local unit KKX = LoadUnitHandle(HY, h, 1)
	if UnitIsDead(RWI) then
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	else
		if GetUnitDistanceEx(RWI, KKX)> 1425 and G3X(KKX) == false then
			call UnitAddPermanentAbility(RWI,'A44D')
			call UnitAddPermanentAbility(RWI,'A44E')
		elseif GetUnitAbilityLevel(RWI,'A44D')> 0 then
			call UnitRemoveAbility(RWI,'A44D')
			call UnitRemoveAbility(RWI,'A44E')
		endif
	endif
	set KKX = null
	set RWI = null
	set t = null
endfunction
function R7I takes unit RWI returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .2, true, function R6I)
	call SaveUnitHandle(HY, h, 0, RWI)
	call SaveUnitHandle(HY, h, 1, Player__Hero[GetPlayerId(GetOwningPlayer(RWI))])
	set t = null
endfunction
function E_E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local group g = AllocationGroup(266)
	local integer level = GetUnitAbilityLevel(u,'A0A5')
	local integer h = GetHandleId(p)
	local unit RWI
	local integer id = 0
	
	if HaveBear == false then
		set HaveBear = true
	endif
	
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(u), Condition(function RUI))
	if FirstOfGroup(g) == null then
		if (level == 1) then
			set id ='n004'
		elseif (level == 2) then
			set id ='n018'
		elseif (level == 3) then
			set id ='n01C'
		else
			set id ='n01G'
		endif
		set RWI = CreateUnit(GetOwningPlayer(u), id, x, y, GetUnitFacing(u))
		call R5I(RWI, level -1, p, true)
		call SaveUnitHandle(HY, h, 333, RWI)
		call R4I()
		call AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl", RWI, "chest")
		call RZI(RWI)
		call SetUnitAbilityLevel(RWI,'A09Y', level)
		call R7I(RWI)
	else
		set RWI = FirstOfGroup(g)
		call AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl", RWI, "chest")
		call SetWidgetLife(RWI, GetUnitState(RWI, UNIT_STATE_MAX_LIFE))
		call SetUnitPosition(RWI, GetUnitX(u), GetUnitY(u))
	endif
	if GetUnitAbilityLevel(u,'A0A8')> 0 then
		
		call SetUnitMoveSpeed(RWI, GetUnitDefaultMoveSpeed(RWI)+ 8 * GetUnitAbilityLevel(u,'A0A8'))
		
		if GetUnitAbilityLevel(RWI,'A3IL') == 0 then
			call UnitAddPermanentAbility(RWI,'A3IL')
		endif
		call SetUnitAbilityLevel(RWI,'A3IL', GetUnitAbilityLevel(u,'A0A8'))
	endif
	set RWI = null
	call DeallocateGroup(g)
	set u = null
	set g = null
endfunction
function E0E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer i = GetUnitTypeId(u)
	call SetPlayerTechResearched(GetOwningPlayer(u),'R001',(GetUnitAbilityLevel(u, GetSpellAbilityId())+ 1))
	if i !='N015' and i !='N014' and i !='N013' then
		call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A344', true)
	else
		call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A344', false)
	endif
	call SetUnitAbilityLevel(u,'A344', GetUnitAbilityLevel(u, GetSpellAbilityId()))
	set u = null
endfunction
// 熊灵的战争咆哮
function I4E takes nothing returns nothing
	local unit hTriggerUnit = GetTriggerUnit()
	local unit d = CreateUnit(GetOwningPlayer(hTriggerUnit),'e00E', GetUnitX(hTriggerUnit), GetUnitY(hTriggerUnit), 0)
	//local group hFindBearGroup
	call UnitAddAbility(d,'A1ED')
	call SetUnitAbilityLevel(d,'A1ED', GetUnitAbilityLevel(hTriggerUnit,'A344')+ GetUnitAbilityLevel(hTriggerUnit,'A34C'))
	call IssueImmediateOrderById(d, 852599)
	if IsBearUnit(hTriggerUnit) then
		set hTriggerUnit = Player__Hero[GetPlayerId(GetOwningPlayer(hTriggerUnit))]
	//else
	//	set hFindBearGroup = AllocationGroup(267)
	//	call GroupEnumUnitsOfPlayer(hFindBearGroup, GetOwningPlayer(hTriggerUnit), Condition(function RUI))
	//	set hTriggerUnit = FirstOfGroup(hFindBearGroup)
	//	call DeallocateGroup(hFindBearGroup)
	//	set hFindBearGroup = null
	endif
	// 给主英雄单位再放一次
	if UnitAlive(hTriggerUnit) then
		call SetUnitX(d, GetUnitX(hTriggerUnit))
		call SetUnitY(d, GetUnitY(hTriggerUnit))
		call UnitResetCooldown(d)
		call IssueImmediateOrderById(d,  852599)
	endif
	set hTriggerUnit = null
	set d = null
endfunction
function R8I takes nothing returns nothing
	local unit RWI
	local unit u
	if GetSpellAbilityId()=='A0A7' then
		set RWI = GetTriggerUnit()
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(RWI))]
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl", GetUnitX(RWI), GetUnitY(RWI)))
		call SetUnitX(RWI, GetUnitX(u)+ GetRandomReal(25, 50)* Cos(GetRandomReal(0, 360)))
		call SetUnitY(RWI, GetUnitY(u)+ GetRandomReal(25, 50)* Sin(GetRandomReal(0, 360)))
		call S5V(RWI, 851972, 0)
	endif
	set RWI = null
	set u = null
endfunction

function M1X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function R8I))
	set t = null
endfunction
function R9I takes unit triggerUnit returns nothing
	local integer pid = GetPlayerId(GetOwningPlayer(triggerUnit))
	if triggerUnit == Player__Hero[pid]and HaveSavedHandle(HY, GetHandleId(GetOwningPlayer(triggerUnit)), 333) and UnitIsDead(LoadUnitHandle(HY, GetHandleId(GetOwningPlayer(triggerUnit)), 333)) == false and G3X(triggerUnit) == false then
		call KillUnit(LoadUnitHandle(HY, GetHandleId(GetOwningPlayer(triggerUnit)), 333))
	endif
endfunction
function IVI takes nothing returns nothing
	local location l
	if IsSentinelPlayer(GetOwningPlayer(GetTriggerUnit())) then
		set l = GetRectCenter(gg_rct_SentinelRevivalPoint)
	else
		set l = GetRectCenter(gg_rct_ScourgeRevivalPoint)
	endif
	if HQX(GetEnumItem()) == false then
		call SetItemPositionLoc(GetEnumItem(), l)
	endif
	call RemoveLocation(l)
	set l = null
endfunction
function IEI takes nothing returns nothing
	local integer h = GetHandleId(GetOwningPlayer(GetTriggerUnit()))
	local unit IXI = LoadUnitHandle(HY, h, 334)
	local unit RWI = LoadUnitHandle(HY, h, 333)
	local integer x
	local integer y
	if IXI == null then
		if IsSentinelPlayer(GetOwningPlayer(RWI)) then
			set x =-6390
			set y =-5615
		else
			set x = 5875
			set y = 5000
		endif
		set IXI = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e01F', x, y, 0)
		call SaveUnitHandle(HY, h, 334, IXI)
	endif
	if HQX(GetEnumItem()) == false then
		call UnitAddItem(IXI, GetEnumItem())
	endif
	if GetUnitAbilityLevel(RWI,'A398')> 0 then
		call UnitAddPermanentAbility(IXI,'A398')
	endif
	call ShowUnit(IXI, true)
	set IXI = null
	set RWI = null
endfunction
function IOI takes nothing returns nothing
	local integer GTX = GetItemIndexEx(GetEnumItem())
	if GetWidgetLife(GetEnumItem())> 0 and GTX != AIV then
		if Mode__DeathMatch then
			call IVI()
		else
			call IEI()
		endif
	endif
endfunction
function IRI takes unit R8X, unit triggerUnit returns nothing
	local location l = GetUnitLoc(triggerUnit)
	local rect r = RectFromCenterSizeBJ(l, 400., 400.)
	local unit u = Player__Hero[GetPlayerId(GetOwningPlayer(triggerUnit))]
	local integer level = GetUnitAbilityLevel(u,'A0A5')
	call SetHeroXP(u, GetHeroXP(u)-(GetHeroXP(u)/(125 -(25 * level))), false)
	call UnitDamageTargetEx(R8X, u, 5, 100. * I2R(level))
	call EnumItemsInRect(r, null, function IOI)
	call RemoveLocation(l)
	call RemoveRect(r)
	set l = null
	set r = null
	set u = null
endfunction
function III takes unit R8X, unit triggerUnit returns nothing
	if IsBearUnit(triggerUnit) then
		call IRI(R8X, triggerUnit)
	endif
endfunction
function IAI takes unit u returns nothing
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call UnitAddAbility(d,'A325')
	call IssueTargetOrderById(d, 852095, u)
	set d = null
endfunction
function INI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer UYX = LoadInteger(HY, h, 100)
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if XFX(GetOwningPlayer(GetEventDamageSource())) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetEventDamageSource())) and J7V == false then
			if J8V == false then
				call UnitRemoveAbility(GetTriggerUnit(),'B0BM')
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			endif
		endif
		if J8V then
			set J8V = false
		endif
		if J7V then
			set J7V = false
		endif
	else
		set UYX = UYX + 1
		call SaveInteger(HY, h, 100, UYX)
		if UYX > level * 2 then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(GetTriggeringTrigger())
		else
			call IAI(LoadUnitHandle(HY, h, 0))
		endif
	endif
	set t = null
	return false
endfunction
function IBI takes nothing returns boolean
	local trigger trig = null
	local unit u = GetFilterUnit()
	if IsUnitEnemy(u, Temp__Player) and GetUnitAbilityLevel(u,'A04R') == 0 and GetUnitAbilityLevel(u,'B0BM')> 0 then
		set trig = CreateTrigger()
		call TriggerRegisterUnitEvent(trig, u, EVENT_UNIT_DAMAGED)
		call TriggerRegisterDeathEvent(trig, u)
		call TriggerRegisterTimerEvent(trig, .5, true)
		call TriggerRegisterTimerEvent(trig, 0, false)
		call TriggerAddCondition(trig, Condition(function INI))
		call SaveInteger(HY, GetHandleId(trig), 0, TempInt)
		call SaveUnitHandle(HY, GetHandleId(trig), 0, u)
		set trig = null
	endif
	set u = null
	return false
endfunction
function ICI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	set Temp__Player = LoadPlayerHandle(ObjectHashTable, WFV, 0)
	set TempInt = LoadInteger(ObjectHashTable, WFV, 0)
	call GroupEnumUnitsInRange(AK, LoadReal(ObjectHashTable, WFV, 0), LoadReal(ObjectHashTable, WFV, 1), 1000, Condition(function IBI))
	call DestroyTimerAndFlushHT_P(t)
	set t = null
endfunction
function IDI takes nothing returns boolean
	local unit t = GetFilterUnit()
	if IsUnitEnemy(t, Temp__Player) and GetUnitAbilityLevel(t,'A04R') == 0 and IsUnitMagicImmune(t) == false and UnitAlive(t) and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false then
		call UnitDamageTargetEx(I_X(Temp__ArrayUnit[0]), t, XK[0], 70 + 10* GetUnitAbilityLevel(Temp__ArrayUnit[1],'A1A9'))
		call UnitShareVision(t, Temp__Player, true)
		call IssueTargetOrderById(Temp__ArrayUnit[1], 852095, t)
		call UnitShareVision(t, Temp__Player, false)
	endif
	set t = null
	return false
endfunction
function IFI takes nothing returns boolean
	local integer WFV
	local unit d = null
	local unit t = GetFilterUnit()
	local real x
	local real y
	if GetUnitTypeId(t)=='h07U'then
		set WFV = GetHandleId(t)
		if LoadBoolean(ObjectHashTable,'A1AA', WFV) then
			set x = GetWidgetX(t)
			set y = GetWidgetY(t)
			set d = CreateUnit(GetOwningPlayer(t),'h07Z', x, y, 0)
			call SetUnitTimeScale(d, 2.5)
			call UnitApplyTimedLife(d,'BTLF', 2)
			call GroupEnumUnitsInRange(BK, x, y, 525, Condition(function IDI))
			call SaveBoolean(ObjectHashTable,'A1AA', WFV, false)
			call SaveBoolean(ObjectHashTable, WFV,'A1AA', false)
			call SetUnitAnimationByIndex(t, 3)
			set d = null
		endif
	endif
	set t = null
	return false
endfunction
function JGE takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local real x = GetWidgetX(u)
	local real y = GetWidgetY(u)
	local unit d = CreateUnit(GetOwningPlayer(u),'h07Z', x, y, 0)
	local integer WFV = GetHandleId(t)
	if GetUnitTypeId(u)=='e00E' then
		set u = Player__Hero[GetPlayerId(Temp__Player)]
	endif
	call SetUnitTimeScale(d, 2.5)
	call UnitApplyTimedLife(d,'BTLF', 2)
	set Temp__Player = GetOwningPlayer(u)
	set Temp__ArrayUnit[0]= u
	set Temp__ArrayUnit[1]= CreateUnit(Temp__Player,'e00E', x, y, 0)
	set XK[0]= 1
	call UnitAddAbility(Temp__ArrayUnit[1],'A1A9')
	call GroupEnumUnitsInRange(AK, x, y, 525, Condition(function IDI))
	set XK[0]= 2
	call GroupEnumUnitsOfPlayer(AK, GetOwningPlayer(u), Condition(function IFI))
	call SavePlayerHandle(ObjectHashTable, WFV, 0, Temp__Player)
	call SaveReal(ObjectHashTable, WFV, 0, x)
	call SaveInteger(ObjectHashTable, WFV, 0, GetUnitAbilityLevel(u,'A1AA'))
	call SaveReal(ObjectHashTable, WFV, 1, y)
	call SaveUnitHandle(ObjectHashTable, WFV, 2, u)
	call TimerStart(t, .65, false, function ICI)
	set d = null
	set u = null
	set t = null
endfunction
function IGI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit TJX =(LoadUnitHandle(HY, h, 335))
	local boolean IHI =(LoadBoolean(HY, h, 336))
	if GetTriggerEventId() == EVENT_UNIT_SPELL_ENDCAST then
		call SaveInteger(HY,(GetHandleId((whichUnit))),(4269), 2)
		call SaveBoolean(HY,(GetHandleId(TJX)), 337,(true))
		call SaveBoolean(ObjectHashTable, GetHandleId(TJX),'A1AA', false)
		call IssueImmediateOrderById(TJX, 851972)
		if GetUnitAbilityLevel(TJX,'Aloc') == 0 then
			call SetUnitAnimation(TJX, "stand")
		else
			call SetUnitAnimationByIndex(TJX, 3)
		endif
		if IHI then
			call ShowUnit(TJX, false)
			call KillUnit(TJX)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if IHI then
			call SetUnitFacing(TJX, GetUnitFacing(whichUnit))
		endif
	endif
	set t = null
	set TJX = null
	set whichUnit = null
	return false
endfunction
function IJI takes unit u, unit s, boolean b returns nothing
	local trigger t = CreateTrigger()
	local integer WFV = GetHandleId(t)
	call UnitRemoveAbility(u,'A2LK')
	call SetUnitAnimation(u, "spell slam")
	call QueueUnitAnimation(u, "spell slam")
	call SaveUnitHandle(HY, WFV, 335, u)
	call SaveUnitHandle(HY, WFV, 2, s)
	if b then
		call SaveBoolean(HY, WFV, 336, true)
		call TriggerRegisterTimerEvent(t, .1, true)
	endif
	call TriggerRegisterUnitEvent(t, s, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function IGI))
	set WFV = GetHandleId(u)
	call SaveBoolean(ObjectHashTable,'A1AA', WFV, true)
	call SaveBoolean(ObjectHashTable, WFV,'A1AA', true)
	set t = null
endfunction
function IKI takes nothing returns boolean
	local unit t = GetFilterUnit()
	if GetUnitTypeId(t)=='h07U'then
		if IssueImmediateOrderById(t, 851972) then
			call IJI(t, Temp__ArrayUnit[0], false)
		endif
		call SaveBoolean(ObjectHashTable, 99999, 99997, false)
	endif
	set t = null
	return false
endfunction
function KVE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit TJX = null
	if GetUnitTypeId(whichUnit)=='e00E'then
		set Temp__ArrayUnit[0]= Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))]
	elseif GetUnitTypeId(whichUnit)=='h07U' then
		set Temp__ArrayUnit[0]= LoadUnitHandle(ObjectHashTable, GetHandleId(whichUnit),'A1A8')
		if IssueImmediateOrderById(Temp__ArrayUnit[0], 852092) == false then
			call UnitAddAbility(whichUnit,'A2LK')
			call SetUnitAnimation(whichUnit, "stand")
			call IssueImmediateOrderById(whichUnit, 851972)
			call SaveBoolean(ObjectHashTable, GetHandleId(whichUnit),'A1AA', false)
			call SaveBoolean(ObjectHashTable,'A1AA', GetHandleId(whichUnit), false)
			set whichUnit = null
			return
		endif
	else
		set Temp__ArrayUnit[0]= whichUnit
	endif
	call SaveBoolean(ObjectHashTable, 99999, 99997, true)
	call GroupEnumUnitsOfPlayer(AK, GetOwningPlayer(whichUnit), Condition(function IKI))
	if LoadBoolean(ObjectHashTable, 99999, 99997) then
		set TJX = CreateUnit(GetOwningPlayer(whichUnit),'h07U', GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitFacing(whichUnit))
		call UnitAddPermanentAbility(TJX,'Aloc')
		call UnitAddPermanentAbility(TJX,'Aetl')
		call SetUnitPosition(TJX, GetUnitX(whichUnit), GetUnitY(whichUnit))
		call SetUnitScale(TJX, 1.4, 1.4, 1.4)
		call IssueImmediateOrderById(TJX, 851972)
		call IJI(TJX, Temp__ArrayUnit[0], true)
		set TJX = null
	endif
	set whichUnit = null
endfunction
function ILI takes nothing returns nothing
	if DVX(GetEnumUnit()) then
		return
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A1CA')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'A1CA')
		call UnitRemoveAbility(GetEnumUnit(),'B0BP')
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A1C9')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'A1C9')
		call UnitRemoveAbility(GetEnumUnit(),'B0BP')
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A1CB')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'A1CB')
		call UnitRemoveAbility(GetEnumUnit(),'B0BP')
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A1CC')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'A1CC')
		call UnitRemoveAbility(GetEnumUnit(),'B0BP')
	endif
	call KRX(GetEnumUnit(), 0)
endfunction
function IMI takes nothing returns nothing
	if DVX(GetEnumUnit()) then
		return
	endif
	if J0V == 1 then
		if GetUnitAbilityLevel(GetEnumUnit(),'A1CA') == 0 then
			call UnitAddPermanentAbility(GetEnumUnit(),'A1CA')
		endif
	elseif J0V == 2 then
		if GetUnitAbilityLevel(GetEnumUnit(),'A1C9') == 0 then
			call UnitAddPermanentAbility(GetEnumUnit(),'A1C9')
		endif
	elseif J0V == 3 then
		if GetUnitAbilityLevel(GetEnumUnit(),'A1CB') == 0 then
			call UnitAddPermanentAbility(GetEnumUnit(),'A1CB')
		endif
	elseif J0V == 4 then
		if GetUnitAbilityLevel(GetEnumUnit(),'A1CC') == 0 then
			call UnitAddPermanentAbility(GetEnumUnit(),'A1CC')
		endif
	endif
	if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
		call KRX(GetEnumUnit(), R2I((I2R(GetHeroAgi(GetEnumUnit(), true))/ 7)* I2R((J0V * 20 + 20)/ 100 )))
	endif
endfunction
function IPI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local group IQI = LoadGroupHandle(HY, h, 340)
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local group g = AllocationGroup(268)
	local group g2 = null
	local unit u = LoadUnitHandle(ObjectHashTable, GetHandleId(whichUnit),'A1A8')
	if whichUnit == null then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call DeallocateGroup(IQI)
		call DeallocateGroup(g)
		set g = null
		return false
	endif
	set U2 = whichUnit
	set J0V = GetUnitAbilityLevel(whichUnit,'A1CD')
	call GroupEnumUnitsInRange(g, x, y, 300, Condition(function DHX))
	if u != null then
		set g2 = AllocationGroup(269)
		call GroupEnumUnitsInRange(g2, GetWidgetX(u), GetWidgetY(u), 350, Condition(function DHX))
		call GroupAddGroup(g2, g)
		call DeallocateGroup(g2)
		set g2 = null
	endif
	call GroupRemoveGroup(g, IQI)
	call ForGroup(IQI, function ILI)
	if UnitIsDead(whichUnit) == false and GetUnitAbilityLevel(whichUnit,'A36D') == 0 then
		call ForGroup(g, function IMI)
	endif
	call SaveGroupHandle(HY, h, 340, g)
	call DeallocateGroup(IQI)
	set t = null
	set whichUnit = null
	set IQI = null
	set u = null
	set g = null
	return false
endfunction
function M8E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	call UnitAddPermanentAbility(whichUnit,'A1CQ')
	call TriggerRegisterTimerEvent(t, .3, true)
	call TriggerAddCondition(t, Condition(function IPI))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveGroupHandle(HY, h, 340, AllocationGroup(270))
	call SaveTriggerHandle(HY, GetHandleId(whichUnit), 338, t)
	call SaveBoolean(HY, GetHandleId(whichUnit), 339, true)
	set t = null
	set whichUnit = null
endfunction
function I8I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	call UnitReduceStateBonus(u, LoadInteger(ObjectHashTable, WFV, 3), UNIT_BONUS_DAMAGE)
	call J8X(u, R2I(LoadReal(ObjectHashTable, WFV, 0)))
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set u = null
endfunction
function I9I takes nothing returns boolean
	local unit t = GetFilterUnit()
	local group g = LoadGroupHandle(ObjectHashTable, XK[0], 2)
	if UnitAlive(t) and IsUnitEnemy(Temp__ArrayUnit[0], GetOwningPlayer(t)) and GetUnitAbilityLevel(t,'A04R') == 0 and IsUnitInGroup(t, g) == false and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false then
		if IsUnitType(t, UNIT_TYPE_HERO) then
			call SaveInteger(ObjectHashTable, XK[0], 4, LoadInteger(ObjectHashTable, XK[0], 4)+ 1)
		else
			call SaveInteger(ObjectHashTable, XK[0], 3, LoadInteger(ObjectHashTable, XK[0], 3)+ 1)
		endif
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl", t, "chest"))
		call UnitDamageTargetEx(Temp__ArrayUnit[0], t, 1, XK[1])
		call GroupAddUnit(g, t)
	endif
	set g = null
	set t = null
	return false
endfunction
function AVI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer i3
	local integer i2
	local integer i1
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	local unit d = LoadUnitHandle(ObjectHashTable, WFV, 1)
	local real x2 = GetWidgetX(u)
	local real y2 = GetWidgetY(u)
	local real x1 = GetWidgetX(d)
	local real y1 = GetWidgetY(d)
	local real I3X = Atan2(y2 -y1, x2 -x1)
	if LoadBoolean(ObjectHashTable, GetHandleId(d),'A1AA') then
		set d = null
		set u = null
		set t = null
		return
	endif
	set x1 = x1 + 15* Cos(I3X)
	set y1 = y1 + 15* Sin(I3X)
	call SetUnitX(d, x1)
	call SetUnitY(d, y1)
	call SetUnitFacing(d, I3X * bj_RADTODEG)
	set Temp__ArrayUnit[0]= u
	set XK[0]= WFV
	set XK[1]= LoadInteger(ObjectHashTable, WFV, 2)
	call GroupEnumUnitsInRange(AK, x1, y1, 300, Condition(function I9I))
	if  100 > SquareRoot((x1 -x2)*(x1 -x2)+(y1 -y2)*(y1 -y2)) then
		set i3 = LoadInteger(ObjectHashTable, WFV, 1)
		set i2 = LoadInteger(ObjectHashTable, WFV, 3)
		set i1 = LoadInteger(ObjectHashTable, WFV, 4)
		if i1 + i2 > 0 then
			set x1 =(i2 + i1 * 5)
			set i3 = i2 *(3 * i3 + 3)+ i1 * 10* i3
			call UnitAddAbilityLevel1ToTimed(u,'C015','C015', 9)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl", u, "chest"))
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl", u, "origin"))
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl", u, "hand,left"))
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl", u, "hand,right"))
			call SaveInteger(ObjectHashTable, WFV, 3, i3)
			call SaveReal(ObjectHashTable, WFV, 0, x1)
			call J6X(u, R2I(x1))
			call UnitAddStateBonus(u, i3, UNIT_BONUS_DAMAGE)
			call TimerStart(t, 9, false, function I8I)
		else
			call DestroyTimerAndFlushHT_P(t)
		endif
		set WFV = GetHandleId(u)
		set i1 = LoadInteger(ObjectHashTable, WFV,'A1A8')
		call SaveInteger(ObjectHashTable, WFV,'A1A8', i1 -1)
		if i1 == 1 then
			call UnitRemoveAbility(u,'A21J')
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A1A8', true)
		endif
		call FlushChildHashtable(ObjectHashTable, GetHandleId(d))
		call RemoveUnit(d)
	endif
	set d = null
	set u = null
	set t = null
endfunction
function AEI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(ObjectHashTable, WFV, 0)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	local unit d = LoadUnitHandle(ObjectHashTable, WFV, 1)
	local real x = GetWidgetX(d)
	local real y = GetWidgetY(d)
	set Temp__ArrayUnit[0]= u
	set XK[0]= WFV
	set XK[1]= LoadInteger(ObjectHashTable, WFV, 2)
	call GroupEnumUnitsInRange(AK, x, y, 300, Condition(function I9I))
	if UYX == 80 or LoadBoolean(ObjectHashTable, GetHandleId(u),'A1A8') or LoadBoolean(ObjectHashTable, GetHandleId(d),'A1A8') then
		call UnitAddAbility(d,'Aloc')
		call SetUnitAnimationByIndex(d, 1)
		call IssueImmediateOrderById(d, 851972)
		call SaveBoolean(ObjectHashTable, WFV, 0, true)
		call TimerStart(t, .025, true, function AVI)
		set d = null
		set u = null
		set t = null
		return
	endif
	call SetUnitMoveSpeed(d, GetHeroMoveSpeed(u))
	call SaveInteger(ObjectHashTable, WFV, 0, UYX + 1)
	set d = null
	set u = null
	set t = null
endfunction
function AXI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(ObjectHashTable, GetHandleId(t), 0)
	call UnitRemoveAbility(u,'A21J')
	call UnitAddPermanentAbility(u,'A21J')
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set u = null
endfunction
function YIV takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	call SaveUnitHandle(ObjectHashTable, GetHandleId(t), 0, u)
	call SaveBoolean(ObjectHashTable, GetHandleId(u),'A1A8', true)
	call TimerStart(t, 0, false, function AXI)
	set t = null
	set u = null
endfunction
function YRV takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local unit d = CreateUnit(p,'h07U', GetSpellTargetX(), GetSpellTargetY(), GetUnitFacing(u) -180)
	local integer WFV = GetHandleId(t)
	local integer WUV = GetUnitAbilityLevel(u,'A1A8')
	local integer id
	call UnitAddAbility(d,'Aloc')
	call UnitRemoveAbility(d,'Aloc')
	call ShowUnit(d, false)
	call ShowUnit(d, true)
	call SaveBoolean(ObjectHashTable, WFV, 0, false)
	call SaveUnitHandle(ObjectHashTable, WFV, 0, u)
	call SaveUnitHandle(ObjectHashTable, WFV, 1, d)
	call SaveGroupHandle(ObjectHashTable, WFV, 2, AllocationGroup(273))
	call SaveInteger(ObjectHashTable, WFV, 0, 0)
	call SaveInteger(ObjectHashTable, WFV, 1, WUV)
	call SaveInteger(ObjectHashTable, WFV, 2, 20 + 40 * WUV)
	call SaveInteger(ObjectHashTable, WFV, 3, 0)
	call SaveInteger(ObjectHashTable, WFV, 4, 0)
	set WFV = GetHandleId(u)
	call SaveBoolean(ObjectHashTable, WFV,'A1A8', false)
	call SaveInteger(ObjectHashTable, WFV,'A1A8', LoadInteger(ObjectHashTable, WFV,'A1A8')+ 1)
	call SaveUnitHandle(ObjectHashTable, WFV,'A1A8', d)
	call SetPlayerAbilityAvailableEx(p,'A1A8', false)
	call UnitAddAbility(u,'A21J')
	call TriggerRegisterUnitEvent(UnitEventMainTrig, d, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterUnitEvent(UnitEventMainTrig, d, EVENT_UNIT_SPELL_CAST)
	call UnitAddAbility(d,'A21J')
	call UnitAddAbility(d,'Aetl')
	if GetUnitAbilityLevel(u,'A1AA')> 0 then
		call UnitAddAbility(d,'A2LK')
	endif
	if GetUnitAbilityLevel(u,'A1CD')> 0 then
		call UnitAddPermanentAbility(d,'A1CQ')
	endif
	call SaveUnitHandle(ObjectHashTable, GetHandleId(d),'A1A8', u)
	call TimerStart(t, .1, true, function AEI)
	set d = null
	set u = null
	set t = null
	set p = null
endfunction
function AOI takes nothing returns nothing
	local unit targetUnit = GetOrderTargetUnit()
	local real x
	local real y
	if GetTriggerEventId() == EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER then
		set x = GetUnitX(GetOrderTargetUnit())
		set y = GetUnitY(GetOrderTargetUnit())
	else
		set x = GetOrderPointX()
		set y = GetOrderPointY()
	endif
	if GetDistanceBetween(GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), x, y)< 700 then
		call A5X(FE, x, y)
	endif
	set targetUnit = null
endfunction
function ARI takes nothing returns boolean
	if GetIssuedOrderId()== 852040 then
		call AOI()
	endif
	return false
endfunction
function MOE takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEvent(t, GetOwningPlayer(GetTriggerUnit()), EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER, null)
	call TriggerRegisterPlayerUnitEvent(t, GetOwningPlayer(GetTriggerUnit()), EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER, null)
	call TriggerAddCondition(t, Condition(function ARI))
	set t = null
endfunction
function AII takes nothing returns boolean
	return IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0) and not IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) and UnitAlive(GetFilterUnit())
endfunction
function AAI takes unit u returns nothing
	local integer lv = GetUnitAbilityLevel(u,'A06B')+ GetUnitAbilityLevel(u,'A471')
	local real ABI
	local real ACI
	local group g = AllocationGroup(274)
	local unit hFirstUnit
	local unit d = I_X(u)
	if lv == 1 then
		set ABI = 500
		set ACI = 260
	elseif lv == 2 then
		set ABI = 650
		set ACI = 300
	elseif lv == 3 then
		set ABI = 850
		set ACI = 340
	elseif lv == 4 then
		set ABI = 1150
		set ACI = 380
	endif
	set U2 = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 525, Condition(function AII))
	loop
		set hFirstUnit = FirstOfGroup(g)
	exitwhen hFirstUnit == null
		if IsUnitInRange(hFirstUnit, u, 205) then
			call IOX(d, hFirstUnit, 2, ABI, 0)
		else
			call IOX(d, hFirstUnit, 2, ACI, 0)
		endif
		call GroupRemoveUnit(g, hFirstUnit)
	endloop
	call DeallocateGroup(g)
	call SaveBoolean(HY, GetHandleId(u),'suic', true)
	call EPX(u,'A06B', .1)
	set d = null
	set g = null
	set hFirstUnit = null
endfunction
function FKE takes nothing returns nothing
	call AAI(GetTriggerUnit())
endfunction
function W3X takes nothing returns nothing
	call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", GetUnitX(U2), GetUnitY(U2)))
	call AAI(U2)
endfunction
function LQE takes nothing returns nothing
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "你可以使用 -show 命令将技能遥控炸弹切换至其副技能集中引爆")
	if (GetUnitAbilityLevel(GetTriggerUnit(),'A0AK') == 1 or GetUnitAbilityLevel(GetTriggerUnit(),'A1FY') == 1) then
		call UnitAddPermanentAbility(GetTriggerUnit(),'A1WF')
	endif
endfunction
function ADI takes nothing returns boolean
	return(IsUnitEnemy(GetFilterUnit(), LoadPlayerHandle(OtherHashTable2,'A0AM', 1)) and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0)!= null
endfunction
function AFI takes nothing returns nothing
	call UnitDamageTargetEx(LoadUnitHandle(OtherHashTable2,'A0AM', 0), GetEnumUnit(), 1, LoadReal(OtherHashTable2,'A0AM', 0))
endfunction
function AGI takes unit u, boolean AHI returns nothing
	local real damageValue = .0
	local integer unitTypeId = GetUnitTypeId(u)
	local group g
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	if unitTypeId =='o018' then
		set damageValue = 300.
	elseif unitTypeId =='o002'then
		set damageValue = 450.
	elseif unitTypeId =='o00B'then
		set damageValue = 600.
	elseif unitTypeId =='o01B' then
		set damageValue = 750.
	endif
	set g = AllocationGroup(275)
	call SaveUnitHandle(OtherHashTable2,'A0AM', 0, u)
	call SavePlayerHandle(OtherHashTable2,'A0AM', 1, GetOwningPlayer(u))
	call GroupEnumUnitsInRange(g, x, y, 450, Condition(function ADI))
	call ABX("Abilities\\Spells\\Human\\FlameStrike\\FlameStrike1.mdl", x, y, 5)
	call A8X(GetOwningPlayer(u), 3, x, y, 500)
	call SaveReal(OtherHashTable2,'A0AM', 0, damageValue)
	set X4 = AHI == false
	call ForGroup(g, function AFI)
	set X4 = false
	call FlushChildHashtable(OtherHashTable2,'A0AM')
	call RemoveUnit(u)
	call DeallocateGroup(g)
	set g = null
endfunction
function AJI takes unit AKI returns nothing
	if RLX(AKI) then
	endif
endfunction
function JQE takes nothing returns nothing
	call AGI(GetTriggerUnit(), false)
endfunction
function ALI takes nothing returns boolean
	return GetOwningPlayer(GetFilterUnit()) == LoadPlayerHandle(OtherHashTable2,'A0AN', 0) and UnitIsDead(GetFilterUnit()) == false and RLX(GetFilterUnit())
endfunction
function AMI takes nothing returns nothing
	call IssueImmediateOrderById(GetEnumUnit(), 852556)
endfunction
function JTE takes nothing returns nothing
	local group g = AllocationGroup(276)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	call SavePlayerHandle(OtherHashTable2,'A0AN', 0, GetOwningPlayer(GetTriggerUnit()))
	call GroupEnumUnitsInRange(g, x, y, 716, Condition(function ALI))
	call ForGroup(g, function AMI)
	call FlushChildHashtable(OtherHashTable2,'A0AN')
	call DeallocateGroup(g)
	set g = null
endfunction
function API takes nothing returns nothing
	if RLX(GetSummonedUnit()) then
		call TriggerRegisterUnitEvent(UnitEventMainTrig, GetSummonedUnit(), EVENT_UNIT_SPELL_CAST)
	endif
endfunction
function M2X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function API))
	call CJX("Units\\Creeps\\GoblinSapper\\GoblinSapperYesAttack1.wav")
	set t = null
endfunction
function AQI takes nothing returns boolean
	return RMX(GetTriggerUnit())
endfunction
function ASI takes nothing returns boolean
	return IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(U2)) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 or OPX(GetFilterUnit())) and R0X(GetFilterUnit()) == false and RFX(GetFilterUnit()) == false
endfunction
function ATI takes nothing returns boolean
	return IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(U2)) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 or OPX(GetFilterUnit())) and R0X(GetFilterUnit()) == false and RFX(GetFilterUnit()) == false and((IsUnitAliveBJ(GetEnumUnit()) == true))
endfunction
function AUI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit AKI = LoadUnitHandle(HY, h, 0)
	local group g = AllocationGroup(277)
	local unit u
	local real damageValue
	local integer id = GetUnitTypeId(AKI)
	local unit d = CreateUnit(GetOwningPlayer(AKI),'e00E', GetUnitX(AKI), GetUnitY(AKI), 0)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	call DestroyEffect(AddSpecialEffect("war3mapImported\\NewGroundEX.mdx", GetUnitX(AKI), GetUnitY(AKI)))
	call KillUnit(AKI)
	if id =='n00O'then
		set damageValue = 350
	elseif id =='n00P'then
		set damageValue = 450
	elseif id =='n00Q'then
		set damageValue = 555
	elseif id =='n00N'then
		set damageValue = 650
	endif
	set U2 = AKI
	call GroupEnumUnitsInRange(g, GetUnitX(AKI), GetUnitY(AKI), 525, Condition(function ASI))
	set WE = WE + 1
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if GetUnitDistanceEx(d, u)< 225 then
			call UnitDamageTargetEx(d, u, 5, damageValue)
		else
			call UnitDamageTargetEx(d, u, 5, damageValue / 2)
		endif
		call GroupRemoveUnit(g, u)
	endloop
	set WE = WE -1
	call DeallocateGroup(g)
	set g = null
	set u = null
	set d = null
endfunction
function AWI takes unit u, real time returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, u)
	call TimerStart(t, time, false, function AUI)
	set t = null
endfunction
function AYI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 347))
	local group g
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		if GetHandleId(GetKillingUnit()) == 0 then
			call AWI(u, .3)
		else
			call SetUnitAnimationByIndex(GetTriggerUnit(), 4)
		endif
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		if LoadBoolean(HY, h, 0) == false then
			if LoadInteger(HY, h, 0) == 0 then
				call SaveInteger(HY, h, 0, 1)
				call TriggerRegisterUnitInRange(t, u, 225, null)
			else
				set g = AllocationGroup(278)
				set U2 = u
				call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 225, Condition(function ATI))
				if FirstOfGroup(g)!= null then
					call TriggerRegisterTimerEvent(t, .3, false)
					call SaveBoolean(HY, h, 0, true)
				endif
				call DeallocateGroup(g)
			endif
		else
			call AWI(u, .3)
			call FlushChildHashtable(HY,(h))
			call CleanCurrentTrigger(t)
		endif
	else
		if IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(u)) and(GetUnitAbilityLevel(GetTriggerUnit(),'A04R') == 0 or OPX(GetTriggerUnit())) and R0X(GetTriggerUnit()) == false and RFX(GetTriggerUnit()) == false then
			call TriggerRegisterTimerEvent(t, .3, false)
			call SaveBoolean(HY, h, 0, true)
		endif
	endif
	set t = null
	set u = null
	set g = null
	return false
endfunction
function AZI takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 1.0, true)
	call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function AYI))
	call SaveUnitHandle(HY, GetHandleId(t), 347, GetTriggerUnit())
	set t = null
endfunction
function A_I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u
	local unit A0I = LoadUnitHandle(HY, h, 0)
	local group g
	local unit d
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		if GetKillingUnit()!= null then
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		else
			call TriggerRegisterTimerEvent(t, 0, false)
		endif
	elseif GetTriggerEvalCount(t) == 1 then
		call TriggerRegisterUnitInRange(t, A0I, 450, null)
	elseif GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		call DisableTrigger(t)
		call KillUnit(A0I)
		call SetUnitAnimationByIndex(A0I, 3)
		set g = AllocationGroup(279)
		set U2 = A0I
		call GroupEnumUnitsInRange(g, GetUnitX(A0I), GetUnitY(A0I), 450 + 25, Condition(function DHX))
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			set d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
			call UnitAddAbility(d,'A38L')
			call SetUnitAbilityLevel(d,'A38L', LoadInteger(HY, h, 0))
			call IssueTargetOrderById(d, 852095, u)
			call GroupRemoveUnit(g, u)
		endloop
		set d = null
		call UnitRemoveAbility(d,'A38L')
		call DeallocateGroup(g)
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	else
		set u = GetTriggerUnit()
		if IsUnitEnemy(u, GetOwningPlayer(A0I)) and IsUnitMagicImmune(u) == false and GetUnitAbilityLevel(u,'A04R') == 0 then
			if IsUnitAlly(A0I, LocalPlayer) or IsObserverPlayer(LocalPlayer) then
				call SetUnitAnimationByIndex(A0I, 5)
			endif
			call TriggerRegisterTimerEvent(t, 1.5, false)
		endif
	endif
	set t = null
	return false
endfunction
// 麻痹陷阱
function A1I takes nothing returns boolean
	local unit u
	local trigger t
	local integer h
	if GetUnitTypeId(GetTriggerUnit())=='otot' then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		set u = GetTriggerUnit()
		call SaveUnitHandle(HY, h, 0, u)
		call SaveInteger(HY, h, 0, GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A06H'))
		call TriggerRegisterTimerEvent(t, 1.5, false)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerAddCondition(t, Condition(function A_I))
		set t = null
		set u = null
	endif
	return false
endfunction
function M3X takes nothing returns nothing
	local trigger t = CreateTrigger()
	// 地精地雷
	call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	call TriggerAddCondition(t, Condition(function AQI))
	call TriggerAddAction(t, function AZI)
	// 麻痹陷阱
	set t = CreateTrigger()
	call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	call TriggerAddCondition(t, Condition(function A1I))
	set t = null
endfunction
function JHE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	call TWE(u, true)
	//call WYV(u,'A065', GetUnitAbilityLevel(u,'A065'))
	call FixUnitSkillsBug(u)
	set u = null
endfunction
function Tinker_MarchOfMachines_OnCast takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit u = CreateUnit(GetOwningPlayer(whichUnit),'n03C', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	call UnitAddAbility(u,'A416')
	if IssuePointOrderById(u, 852593, GetSpellTargetX(), GetSpellTargetY()) == false then
		call EXStopUnit(whichUnit)
		call InterfaceErrorForPlayer(GetOwningPlayer(whichUnit), "无法在此处施放机器人的进军")
	endif
	call KillUnit(u)
	set whichUnit = null
	set u = null
endfunction
// 机器人的进军
function MarchOfTheMachinesDamagedEvent takes nothing returns nothing
	if GetUnitAbilityLevel(DESource,'A05F')> 0 then
		//if ( not IsUnitMagicImmune(damageTarget) ) then
		//	call UnitDamageTargetEx(Player__Hero[DamagedEventSourcePlayerId], damageTarget, 1, GetUnitAbilityLevel(damageSource,'A05F')* 8 + 8)
		//else
			call UnitDamageTargetEx(Player__Hero[DamagedEventSourcePlayerId], DETarget, 7, GetUnitAbilityLevel(DESource,'A05F')* 8 + 8)
		//endif
	endif
endfunction
function Tinker_MarchOfMachinesOld takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local unit dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'e00E', GetUnitX(trigUnit), GetUnitY(trigUnit), 0)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local integer i = 0
	local real a = 0
	local real r = 0
	local integer level = GetUnitAbilityLevel(trigUnit,'A0BQ')
	call TGV(10)
	call UnitAddAbility(dummyCaster,'A05F')
	call SetUnitAbilityLevel(dummyCaster,'A05F', level)
	if IssuePointOrderById(dummyCaster, 852593, x, y) then
	endif
	set trigUnit = null
	set dummyCaster = null
endfunction
function E2E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real I3X = AngleBetweenXY(GetUnitX(whichUnit), GetUnitY(whichUnit), x, y)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(whichUnit),'e00E', x, y, 0)
	local integer i = 0
	local real a = 0
	local real k = 0
	local boolean b = false
	local boolean A4I = false
	call TGV(10)
	call UnitAddAbility(dummyUnit,'A05F')
	call SetUnitAbilityLevel(dummyUnit,'A05F', GetUnitAbilityLevel(whichUnit,'A0BQ'))
	set x = x + 10* Cos(bj_DEGTORAD * I3X)
	set y = y + 10* Sin(bj_DEGTORAD * I3X)
	loop
		set b = IsTerrainPathable(x + k * Cos(a), y + k * Sin(a), PATHING_TYPE_WALKABILITY) == false
		if b == false then
			call SetTerrainPathable(x + k * Cos(a), y + k * Sin(a), PATHING_TYPE_WALKABILITY, true)
		endif
		set A4I = IssuePointOrderById(dummyUnit, 852593, x + k * Cos(a), y + k * Sin(a))
		if b == false then
			call SetTerrainPathable(x + k * Cos(a), y + k * Sin(a), PATHING_TYPE_WALKABILITY, false)
		endif
	exitwhen A4I or i > 40
		set i = i + 1
		set k = k + 10
	endloop
	set whichUnit = null
	set dummyUnit = null
endfunction
function A5I takes nothing returns boolean
	return DPX() and IsHeroUnitId(GetUnitTypeId(GetFilterUnit())) and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and LoadInteger(HY, GetHandleId(GetFilterUnit()),'A33G')!= 1
endfunction
function A6I takes unit whichUnit, unit A7I returns nothing
	local group g = AllocationGroup(280)
	local unit u
	local unit A8I = A7I
	local unit d
	local integer level = GetUnitAbilityLevel(whichUnit,'A33G')
	loop
		set U2 = whichUnit
		call GroupEnumUnitsInRange(g, GetUnitX(A8I), GetUnitY(A8I), 550 + 25, Condition(function A5I))
		set u = EXX(g, GetUnitX(A8I), GetUnitY(A8I))
	exitwhen u == null
		set d = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(A8I), GetUnitY(A8I), 0)
		call UnitAddAbility(d,'A049')
		call SetUnitAbilityLevel(d,'A049', level)
		call TriggerRegisterUnitEvent(UnitEventMainTrig, d, EVENT_UNIT_SPELL_EFFECT)
		call IssueTargetOrderById(d, 852585, u)
		set d = null
		call EPX(u,'A33G', .5)
		set A8I = u
		call GroupRemoveUnit(g, u)
	endloop
	call DeallocateGroup(g)
	set u = null
	set A8I = null
endfunction
function E3E takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(spellUnit, GetSpellAbilityId())
	local real dur = 2.5 + level * .5
	if not IsHeroUnitId(GetUnitTypeId(targetUnit)) then
		set dur = 6.
	endif
	call UnitLaunchesMissileToTarget( spellUnit, targetUnit, "war3mapImported\\laser.MDX", 6000, 0., 150, null )
	if not UnitHasSpellShield(targetUnit) then
		call EnableAttackEffectByTime(14, dur + 1.)
		call UnitAddAbilityToTimed(targetUnit,'A3Q0', 1, 2.5 + level * .5,'B02P')
		call UnitDamageTargetEx(spellUnit, targetUnit, 3, level * 80)
		if GetSpellAbilityId()=='A33G' then
			call EPX(targetUnit,'A33G', .5)
			call A6I(spellUnit, targetUnit)
		endif
	endif
	set spellUnit = null
	set targetUnit = null
endfunction
function A9I takes nothing returns boolean
	return(((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) or IsUnitIllusion(GetFilterUnit())) and IsUnitMagicImmune(GetFilterUnit()) == false and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit()))))
endfunction
function NVI takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit damageSource = U2
	local unit targetUnit = MissileHitTargetUnit
	local integer level = LoadInteger(HY, h, 0)
	call UnitDamageTargetEx(damageSource, targetUnit, 1, 50 + 75 * level)
	set damageSource = null
	set targetUnit = null
endfunction
function NEI takes unit u, group g returns nothing
	local integer i = 0
	local real EOX = 99999
	local real NXI = 0
	local unit bu = null
	local unit d = null
	local group gg = AllocationGroup(281)
	call GroupAddGroup(g, gg)
	loop
		set d = FirstOfGroup(gg)
	exitwhen d == null
		set NXI = GetUnitDistanceEx(u, d)
		if NXI < EOX then
			set EOX = NXI
			set bu = d
		endif
	endloop
	call DeallocateGroup(gg)
	set U2 = bu
	set gg = null
	set d = null
	set bu = null
	set g = null
endfunction
function E4E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetTriggerUnit()
	local trigger t
	local group g = AllocationGroup(282)
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitX(whichUnit)
	local integer i = 4
	local integer k = 0
	local group gg = AllocationGroup(283)
	if GetSpellAbilityId()=='A05E' then
		set i = 2
	endif
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, x, y, 2500+ 25, Condition(function A9I))
	if CountUnitsInGroup(g)> 0 then
		loop
			call NEI(whichUnit, g)
			set targetUnit = U2
			if targetUnit != null then
				set t = LaunchMissileByUnitDummy(whichUnit, targetUnit,'hTKR', "NVI", 900, true)
				call SaveInteger(HY, GetHandleId(t), 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
				set k = k + 1
			endif
		exitwhen k >= i or targetUnit == null
		endloop
	endif
	set t = null
	call DeallocateGroup(g)
	call DeallocateGroup(gg)
	set gg = null
	set g = null
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function NOI takes nothing returns nothing
	if IsUnitType(GetEnumUnit(), UNIT_TYPE_STRUCTURE) then
		call UnitDamageTargetEx(J9V, GetEnumUnit(), 1, KVV / 3)
	else
		call UnitDamageTargetEx(J9V, GetEnumUnit(), 1, KVV)
	endif
endfunction
function NRI takes unit whichUnit, real x, real y, real r, real d returns nothing
	local group g = AllocationGroup(284)
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, x, y, r, Condition(function DWX))
	set J9V = whichUnit
	set KVV = d
	call ForGroup(g, function NOI)
	call DeallocateGroup(g)
	set g = null
endfunction
function NII takes nothing returns boolean
	return((IsAliveNotStrucNotWard(GetFilterUnit()) and GetFilterUnit()!= Roshan and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and(IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(U2)) or IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) == false or(LoadBoolean(HY, GetPlayerId(GetOwningPlayer(GetFilterUnit())), 139) == false))))
endfunction
function NAI takes unit trigUnit, real d returns unit
	local unit whichUnit = null
	local group g = AllocationGroup(285)
	set U2 = trigUnit
	call GroupEnumUnitsInRange(g, GetUnitX(trigUnit), GetUnitY(trigUnit), d, Condition(function NII))
	if GetUnitAbilityLevel(trigUnit,'A04R')> 0 then
		call GroupRemoveUnit(g, Player__Hero[GetPlayerId(GetOwningPlayer(trigUnit))])
	else
		call GroupRemoveUnit(g, trigUnit)
	endif
	set whichUnit = EXX(g, GetUnitX(trigUnit), GetUnitY(trigUnit))
	call DeallocateGroup(g)
	set U2 = whichUnit
	set whichUnit = null
	set g = null
	return U2
endfunction
function NNI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer count = GetTriggerEvalCount(t)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local real x0 = LoadReal(HY, h, 282)
	local real y0 = LoadReal(HY, h, 283)
	local real x1 = GetUnitX(whichUnit)
	local real y1 = GetUnitY(whichUnit)
	local real x2
	local real y2
	local real a
	local real NBI
	local real J0R
	local real DFR
	local real targetX
	local real targetY
	local location l
	local integer level = GetUnitAbilityLevel(trigUnit,'A0CY')
	local integer NCI = LoadInteger(HY, h, 0)
	if targetUnit != null then
		set x2 = GetUnitX(targetUnit)
		set y2 = GetUnitY(targetUnit)
	endif
	if targetUnit == null or GetDistanceBetween(x0, y0, x2, y2)> 1000 then
		set x2 = x0
		set y2 = y0
	endif
	set a = AngleBetweenXY(x1, y1, x2, y2)
	set NBI = GetDistanceBetween(x1, y1, x2, y2)
	set J0R = NBI / IMaxBJ((58 -count), 1)
	set DFR =(count -29)*(count -29)
	set targetX = x1 + J0R * Cos(a * bj_DEGTORAD)
	set targetY = y1 + J0R * Sin(a * bj_DEGTORAD)
	if count < 58 then
		if O0X(whichUnit) == false then
			call SetUnitFlyHeight(whichUnit, 775 -DFR, 0)
		endif
		if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
			call SaveBoolean(OtherHashTable, GetHandleId(whichUnit), 99, true)
		endif
		call SetUnitPosition(whichUnit, targetX, targetY)
	else
		if O0X(whichUnit) == false then
			call SetUnitFlyHeight(whichUnit, GetUnitDefaultFlyHeight(whichUnit), 0)
		endif
		call PauseUnit(whichUnit, false)
		call SetUnitPathing(whichUnit, true)
		call SetUnitPosition(whichUnit, x2, y2)
		call SaveInteger(HY, GetHandleId(whichUnit), 4268, 2)
		set l = Location(x2, y2)
		call TerrainDeformationRippleBJ(.2, true, l, 1., 300., 96., 1, 64.)
		call RemoveLocation(l)
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl", GetUnitX(whichUnit), GetUnitY(whichUnit)))
		if IsUnitEnemy(whichUnit, GetOwningPlayer(trigUnit)) then
			if G3X(trigUnit) then
				call UnitDamageTargetEx(trigUnit, whichUnit, 1,(.2 + .15 *(level + 1))* 75 * NCI)
			else
				call UnitDamageTargetEx(trigUnit, whichUnit, 1,(.2 + .15 * level)* 75 * NCI)
			endif
		endif
		if LoadBoolean(HY, h, 0) == false and targetUnit != null and IsUnitEnemy(targetUnit, GetOwningPlayer(trigUnit)) and GetUnitAbilityLevel(targetUnit,'A3E9') == 1 and IsUnitMagicImmune(trigUnit) == false then
			call SaveInteger(OtherHashTable2,'A3E9', 0, NCI)
			call SaveUnitHandle(OtherHashTable2,'A3E9', 0, targetUnit)
			call SaveUnitHandle(OtherHashTable2,'A3E9', 1, trigUnit)
			call ExecuteFunc("NDI")
		endif
		call KillTreeByCircle(x2, y2, 300)
		call NRI(trigUnit, x2, y2, 300, 75 * NCI)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set trigUnit = null
	set whichUnit = null
	set targetUnit = null
	set l = null
	return false
endfunction
function NFI takes unit trigUnit, unit targetUnit, integer level, boolean FAR returns nothing
	local unit whichUnit = KEV
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x
	local real y
	if targetUnit != null then
		set x = GetUnitX(targetUnit)
		set y = GetUnitY(targetUnit)
	else
		set x = GetItemX(GetSpellTargetItem())
		set y = GetItemY(GetSpellTargetItem())
	endif
	if GetUnitTypeId(trigUnit)=='e00C' or GetUnitTypeId(trigUnit)=='e00E'then
		if targetUnit == null then
			set trigUnit = Player__Hero[GetPlayerId(GetOwningPlayer(trigUnit))]
			if GetOwningPlayer(targetUnit) == GetOwningPlayer(trigUnit) then
				set targetUnit = NAI(trigUnit, 500 + 200* level + 25)
			endif
			if whichUnit == null or targetUnit == null then
				return
			endif
		endif
	else
		if IsUnitEnemy(trigUnit, GetOwningPlayer(whichUnit)) and not FAR then
			call IssueTargetOrderById(trigUnit, 851983, whichUnit)
		endif
	endif
	call PauseUnit(whichUnit, true)
	call SetUnitPathing(whichUnit, false)
	if O0X(whichUnit) == false then
		call UnitAddPermanentAbility(whichUnit,'Amrf')
		call UnitRemoveAbility(whichUnit,'Amrf')
	endif
	call SaveInteger(HY, GetHandleId(whichUnit), 4268, 1)
	call SaveUnitHandle(HY, h, 14, trigUnit)
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveInteger(HY, h, 0, level)
	call SaveBoolean(HY, h, 0, FAR)
	call SaveUnitHandle(HY, h, 30,(targetUnit))
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl", whichUnit, "origin"))
	call SaveReal(HY, h, 282, x)
	call SaveReal(HY, h, 283, y)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function NNI))
	set whichUnit = null
	set t = null
endfunction
function E5E takes nothing returns nothing
	call NFI(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(),'A0BZ'), false)
endfunction
function NDI takes nothing returns nothing
	local unit whichUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 0)
	local unit NGI = NAI(whichUnit, 300)
	call T4V(whichUnit)
	if NGI != null then
		set KEV = NGI
		call NFI(whichUnit, LoadUnitHandle(OtherHashTable2,'A3E9', 1), LoadInteger(OtherHashTable2,'A3E9', 0), true)
	endif
	set whichUnit = null
	set NGI = null
	call FlushChildHashtable(OtherHashTable2,'A3E9')
endfunction
function K_E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit NGI = NAI(whichUnit, 300)
	local unit targetUnit = GetSpellTargetUnit()
	set KEV = NGI
	if GetUnitTypeId(whichUnit)!='e00C' and GetUnitTypeId(whichUnit)!='e00E' then
		if NGI == null then
			call EXStopUnit(whichUnit)
			call InterfaceErrorForPlayer(GetOwningPlayer(whichUnit), GetObjectName('n0DA'))
		elseif GetSpellTargetItem()!= null and ZNX(GetItemTypeId(GetSpellTargetItem())) == false then
			call EXStopUnit(whichUnit)
			call InterfaceErrorForPlayer(GetOwningPlayer(whichUnit), "必须以符文为目标")
		endif
	endif
	set whichUnit = null
	set NGI = null
	set targetUnit = null
endfunction
function Z1O takes nothing returns nothing
	local unit whichUnit = IM
	local unit targetUnit = AM
	local unit dummyCaster =(LoadUnitHandle(HY,(GetHandleId(whichUnit)), 297))
	call SaveUnitHandle(HY,(GetHandleId(targetUnit)), 297,(dummyCaster))
	call SetUnitOwner(dummyCaster, GetOwningPlayer(targetUnit), true)
	set whichUnit = null
	set targetUnit = null
	set dummyCaster = null
endfunction
function W5X takes nothing returns nothing
	local unit trigUnit = VK
	local unit dummyCaster =(LoadUnitHandle(HY,(GetHandleId(trigUnit)), 297))
	if dummyCaster != null and GetUnitTypeId(dummyCaster)=='e01V' then
		call RemoveUnit(dummyCaster)
	endif
	set trigUnit = null
	set dummyCaster = null
endfunction

// 学习长大
function PQE takes nothing returns nothing
	local trigger t
	local unit u = GetTriggerUnit()
	local integer lv = GetUnitAbilityLevel(u,'A0CY')
	local unit dummyUnit
	local region r
	local real scale = GetUnitModelScale(u)
	local real addScale = lv * 0.25
	local player p = GetOwningPlayer(u)
	local integer pid = GetPlayerId(p)
	if lv == 1 then
		set dummyUnit = CreateUnit(p,'e01V', 0, 0, 0)
		call UnitAddPermanentAbility(dummyUnit,'A10B')
		call SaveUnitHandle(HY,(GetHandleId(u)), 297,(dummyUnit))
	else
		set dummyUnit =(LoadUnitHandle(HY,(GetHandleId(u)), 297))
	endif
	if lv == 2 then
		call UnitRemoveAbility(dummyUnit,'A10B')
		call UnitRemoveAbility(u,'B04E')
		call UnitAddPermanentAbility(dummyUnit,'A10A')
	elseif lv == 3 then
		call UnitRemoveAbility(dummyUnit,'A10B')
		call UnitRemoveAbility(dummyUnit,'A10A')
		call UnitRemoveAbility(u,'B09C')
		call UnitRemoveAbility(u,'B04E')
		call UnitAddPermanentAbility(dummyUnit,'A0ZS')
	endif
	call SetPlayerTechResearched(p,'R0L1', lv)
	if Mode__RearmCombos then
		call SetPlayerTechResearched(p,'R00E', lv)
	else
		call SetPlayerTechResearched(p,'R00L', lv)
		call SetPlayerTechResearched(p,'R00M', lv)
	endif
	// call SetUnitScale(u, scale + .25 * lv, scale + .25 * lv, scale + .25 * lv)
	// debug call SingleDebug( GetUnitName(u) + " 改变模型缩放 比例" + R2S( GetUnitCurrentScale(u) + addScale ) + "原始模型缩放" + R2S(scale))
	call SaveReal( ExtraHT, GetHandleId(u), HTKEY_UNIT_CURRENT_ADDSCALE, addScale )
	call SetUnitCurrentScaleEx(u, GetUnitCurrentScale(u) )
	set u = null
	set dummyUnit = null
endfunction
function NQI takes nothing returns boolean
	local unit whichUnit
	local unit targetUnit
	local integer level
	local unit dummyCaster
	if GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
		if IsAttackSpecialEffects(GetSpellAbilityId()) and GetSpellTargetUnit() == LoadUnitHandle(HY, GetHandleId(GetTriggeringTrigger()), 0) then
			set targetUnit = GetSpellTargetUnit()
			set whichUnit = GetTriggerUnit()
		else
			return false
		endif
	else
		set whichUnit = GetTriggerUnit()
		set targetUnit = GetAttacker()
	endif
	set level =(GetUnitAbilityLevel(whichUnit,'A19Q'))
	if level > 0 and GetUnitAbilityLevel(whichUnit,'A36D') == 0 and IsAliveNotStrucNotWard(targetUnit) and GetUnitDistanceEx(whichUnit, targetUnit)< 500 and TKV(whichUnit,'A19Q', 15) then
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 25 + 25 * level)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RockBoltMissile\\RockBoltMissile.mdl", targetUnit, "origin"))
		call CommonUnitAddStun(targetUnit, 1.1 + .1 * level, false)
	endif
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function SZE takes nothing returns nothing
	call UnitAddStateBonus(GetTriggerUnit(), 1, UNIT_BONUS_ARMOR)
endfunction
function PPE takes nothing returns nothing
	local trigger t
	local unit whichUnit = GetTriggerUnit()
	if GetUnitAbilityLevel(whichUnit,'A19Q') == 1 then
		set t = CreateTrigger()
		call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_ATTACKED)
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
		call SaveUnitHandle(HY, GetHandleId(t), 0, whichUnit)
		call TriggerAddCondition(t, Condition(function NQI))
		call UnitAddStateBonus(GetTriggerUnit(), 1, UNIT_BONUS_ARMOR)
	endif
	call UnitAddStateBonus(GetTriggerUnit(), 1, UNIT_BONUS_ARMOR)
	set t = null
	set whichUnit = null
endfunction
function NSI takes nothing returns boolean
	if ((LoadInteger(HY,(GetHandleId((GetFilterUnit()))),(4268))) == 1) and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(KXV)) then
		call UnitDamageTargetEx(KXV, GetFilterUnit(), 1, KOV)
	endif
	return false
endfunction
function NTI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local unit dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'e00E', x, y, 0)
	local integer level = GetUnitAbilityLevel(trigUnit,'A0LL')
	local group g = AllocationGroup(286)
	call UnitAddPermanentAbility(dummyCaster,'A10J')
	call SetUnitAbilityLevel(dummyCaster,'A10J', level)
	set KXV = trigUnit
	if level == 1 then
		set KOV = 25
	elseif level == 2 then
		set KOV = 45
	elseif level == 3 then
		set KOV = 65
	elseif level == 4 then
		set KOV = 75
	endif
	call GroupEnumUnitsInRange(g, x, y, 275 + 24, Condition(function NSI))
	call DeallocateGroup(g)
	if GetTriggerEvalCount(t)> 6 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set trigUnit = null
	set dummyCaster = null
	set g = null
	return false
endfunction
function E6E takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'e00E', GetUnitX(trigUnit), GetUnitY(trigUnit), 0)
	local integer level = GetUnitAbilityLevel(trigUnit,'A0LL')
	call UnitAddPermanentAbility(dummyCaster,'A10M')
	call SetUnitAbilityLevel(dummyCaster,'A10M', level)
	call IssuePointOrderById(dummyCaster, 852652, x, y)
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerAddCondition(t, Condition(function NTI))
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call TriggerEvaluate(t)
	set trigUnit = null
	set t = null
	set dummyCaster = null
endfunction
function NUI takes nothing returns nothing
	local unit u = GetEnumUnit()
	call CNX(u,'A0XE', KRV, 7,'B00B')
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A0XE', false)
	set u = null
endfunction
function NWI takes nothing returns boolean
	return(IsUnitIdType(GetUnitTypeId(GetFilterUnit()), UNIT_TYPE_HERO) and IsUnitAlly(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit()))!= null
endfunction
function E7E takes nothing returns nothing
	local group g = AllocationGroup(287)
	set KRV = GetUnitAbilityLevel(GetTriggerUnit(),'A1EJ')
	call GroupEnumUnitsInRange(g, 0, 0, 12000, Condition(function NWI))
	call ForGroup(g, function NUI)
	call DeallocateGroup(g)
	set g = null
endfunction
function NYI takes unit u returns boolean
	return GetUnitTypeId(u)=='QTW3' or GetUnitTypeId(u)=='N017' or GetUnitTypeId(u)=='N02B' or GetUnitTypeId(u)=='QTW2'
endfunction
function NZI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	call SetUnitAbilityLevel(whichUnit,'A09E', GetUnitAbilityLevel(whichUnit,'A0BE'))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set whichUnit = null
endfunction
function E8E takes nothing returns nothing
	local timer t
	if NYI(GetTriggerUnit()) == false then
		set t = CreateTimer()
		call SaveUnitHandle(HY, GetHandleId(t), 2, GetTriggerUnit())
		call TimerStart(t, 0, false, function NZI)
		set t = null
	endif
endfunction
function N_I takes unit u, unit targetUnit returns nothing
	local integer h = GetHandleId(u)
	local unit N0I = LoadUnitHandle(HY, h, 237)
	local integer c = IMaxBJ(LoadInteger(HY, h, 236), 0)
	local integer level = GetUnitAbilityLevel(u,'P107')
	local integer WFR
	local integer N1I = LoadInteger(ObjectHashTable, GetHandleId(u),'P107')
	if N0I != targetUnit then
		set c = 0
	else
		if c == 4 then
			call UnitAddAbilityToTimed(targetUnit,'A468', level, 4, 0)
		else
			set c = c + 1
		endif
	endif
	set WFR =( 15+ 5 * level)* c
	if (N1I != WFR) then
		if N1I < WFR then
			call UnitAddStateBonus(u, WFR -N1I, UNIT_BONUS_ATTACK)
		else
			call UnitReduceStateBonus(u, N1I -WFR, UNIT_BONUS_ATTACK)
		endif
		call SaveInteger(ObjectHashTable, GetHandleId(u),'P107', WFR)
	endif
	call SaveInteger(HY, h, 236, c)
	if N0I != targetUnit then
		call SaveUnitHandle(HY, h, 237, targetUnit)
	endif
	call EPX(u, 4271, .4)
	set N0I = null
endfunction
function N2I takes unit R8X, unit targetUnit returns nothing
	if GetUnitAbilityLevel(R8X,'P107')> 0 and GetUnitAbilityLevel(R8X,'A36D') == 0 and LoadInteger(HY, GetHandleId(R8X), 4271)!= 1 then
		call N_I(R8X, targetUnit)
	endif
endfunction
function N3I takes unit whichUnit, unit targetUnit, unit dummyCaster, integer level returns nothing
	call SetUnitOwner(dummyCaster, GetOwningPlayer(targetUnit), false)
	call SetUnitAbilityLevel(dummyCaster,'A21O', level)
	call IssueTargetOrderById(dummyCaster,852190, targetUnit)
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, 50 + 50 * level)
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", targetUnit, "overhead"))
endfunction
function N4I takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), KNV) == false then
		call GroupAddUnit(KNV, GetEnumUnit())
		call N3I(KIV, GetEnumUnit(), KAV, KBV)
	endif
endfunction
function N5I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local unit N6I =(LoadUnitHandle(HY, h, 675))
	local unit N7I =(LoadUnitHandle(HY, h, 676))
	local real a =(LoadReal(HY, h, 13))
	local real d =(LoadReal(HY, h, 433))
	local integer level =(LoadInteger(HY, h, 5))
	local group D7R =(LoadGroupHandle(HY, h, 187))
	local group g = AllocationGroup(288)
	if GetTriggerEvalCount(t)<= 50 then
		set a = a + 20
		set d = d + 7
		call SaveReal(HY, h, 13,((a)* 1.))
		call SaveReal(HY, h, 433,((d)* 1.))
	elseif GetTriggerEvalCount(t)<= 100  then
		set a = a + 20
		set d = d -7
		call SaveReal(HY, h, 13,((a)* 1.))
		call SaveReal(HY, h, 433,((d)* 1.))
	endif
	call SetUnitX(N6I, CoordinateX50(x + d * Cos(a * bj_DEGTORAD)))
	call SetUnitY(N6I, CoordinateY50(y + d * Sin(a * bj_DEGTORAD)))
	set a = a + 180
	call SetUnitX(N7I, CoordinateX50(x + d * Cos(a * bj_DEGTORAD)))
	call SetUnitY(N7I, CoordinateY50(y + d * Sin(a * bj_DEGTORAD)))
	set U2 = whichUnit
	set KIV = whichUnit
	set KAV = dummyCaster
	set KNV = D7R
	set KBV = level
	call GroupEnumUnitsInRange(g, GetUnitX(N6I), GetUnitY(N6I), 125, Condition(function DHX))
	call ForGroup(g, function N4I)
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, GetUnitX(N7I), GetUnitY(N7I), 125, Condition(function DHX))
	call ForGroup(g, function N4I)
	call DeallocateGroup(g)
	if GetTriggerEvalCount(t)> 100  then
		call KillUnit(N6I)
		call KillUnit(N7I)
		call KillUnit(dummyCaster)
		call DeallocateGroup(D7R)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set N6I = null
	set N7I = null
	set dummyCaster = null
	set D7R = null
	set g = null
	return false
endfunction
function XEE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local unit N6I = CreateUnit(GetOwningPlayer(whichUnit),'e02Y', x, y, 0)
	local unit N7I = CreateUnit(GetOwningPlayer(whichUnit),'e02Y', x, y, 0)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', x, y, 0)
	call UnitAddAbility(dummyCaster,'A21O')
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	call SaveUnitHandle(HY, h, 675,(N6I))
	call SaveUnitHandle(HY, h, 676,(N7I))
	call SaveReal(HY, h, 13,(0 * 1.))
	call SaveReal(HY, h, 433,(0 * 1.))
	call SaveInteger(HY, h, 5,(GetUnitAbilityLevel(whichUnit,'A21N')))
	call SaveGroupHandle(HY, h, 187,(AllocationGroup(289)))
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function N5I))
	call EnableAttackEffectByTime(16, 12.)
	set whichUnit = null
	set N6I = null
	set N7I = null
	set t = null
	set dummyCaster = null
endfunction
function N8I takes unit whichUnit, unit targetUnit, unit dummyCaster, integer level returns nothing
	call SetUnitOwner(dummyCaster, GetOwningPlayer(targetUnit), false)
	call SetUnitAbilityLevel(dummyCaster,'A21P', level)
	call IssueTargetOrderById(dummyCaster, 852075, targetUnit)
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, 75)
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", targetUnit, "overhead"))
endfunction
function N9I takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), KNV) == false then
		call GroupAddUnit(KNV, GetEnumUnit())
		call N8I(KIV, GetEnumUnit(), KAV, KBV)
	endif
endfunction
function BVI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local unit BEI = LoadUnitHandle(HY, h, 393)
	local unit BXI = LoadUnitHandle(HY, h, 394)
	local unit BOI = LoadUnitHandle(HY, h, 395)
	local unit BRI = LoadUnitHandle(HY, h, 396)
	local unit BII = LoadUnitHandle(HY, h, 397)
	local real a = LoadReal(HY, h, 13)-12.5
	local real d = LoadReal(HY, h, 433)
	local integer level = LoadInteger(HY, h, 5)
	local unit u
	local group g
	local group D7R = LoadGroupHandle(HY, h, 187)
	local unit dummyUnit = LoadUnitHandle(HY, h, 19)
	local integer i = 0
	set d = d + 900 / 20.
	call SaveReal(HY, h, 433, d * 1.)
	set KIV = whichUnit
	set KAV = dummyUnit
	set KNV = D7R
	set KBV = level
	set g = AllocationGroup(290)
	loop
	exitwhen HaveSavedHandle(HY, h, 393 + i) == false
		set u = LoadUnitHandle(HY, h, 393 + i)
		if u != null and UnitAlive(u) then
			call SetUnitX(u, CoordinateX50(LoadReal(HY, h, 6)+ d * Cos(a * bj_DEGTORAD)))
			call SetUnitY(u, CoordinateY50(LoadReal(HY, h, 7)+ d * Sin(a * bj_DEGTORAD)))
			set x = GetUnitX(u)
			set y = GetUnitY(u)
			set U2 = whichUnit
			call GroupEnumUnitsInRange(g, x, y, 125, Condition(function DJX))
			call ForGroup(g, function N9I)
			call GroupClear(g)
		endif
		set a = a + 6.25
		set i = i + 1
	endloop
	call DeallocateGroup(g)
	if GetTriggerEvalCount(t)> 20 then
		call KillUnit(BEI)
		call KillUnit(BXI)
		call KillUnit(BOI)
		call KillUnit(BRI)
		call KillUnit(BII)
		call KillUnit(dummyUnit)
		call DeallocateGroup(D7R)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set BEI = null
	set BXI = null
	set BOI = null
	set BRI = null
	set BII = null
	set dummyUnit = null
	set u = null
	set D7R = null
	set g = null
	return false
endfunction
function XVE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real x0 = GetUnitX(whichUnit)
	local real y0 = GetUnitY(whichUnit)
	local real x1 = GetSpellTargetX()
	local real y1 = GetSpellTargetY()
	local real a = AngleBetweenXY(x0, y0, x1, y1)
	local unit BEI = CreateUnit(GetOwningPlayer(whichUnit),'e02Z', x0, y0, a -12.5)
	local unit BXI = CreateUnit(GetOwningPlayer(whichUnit),'e02Z', x0, y0, a -6.25)
	local unit BOI = CreateUnit(GetOwningPlayer(whichUnit),'e02Z', x0, y0, a)
	local unit BRI = CreateUnit(GetOwningPlayer(whichUnit),'e02Z', x0, y0, a + 6.25)
	local unit BII = CreateUnit(GetOwningPlayer(whichUnit),'e02Z', x0, y0, a + 12.5)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit d = CreateUnit(GetOwningPlayer(whichUnit),'e00E', x0, y0, 0)
	call UnitAddAbility(d,'A21P')
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 19, d)
	call SaveUnitHandle(HY, h, 393, BEI)
	call SaveUnitHandle(HY, h, 394, BXI)
	call SaveUnitHandle(HY, h, 395, BOI)
	call SaveUnitHandle(HY, h, 396, BRI)
	call SaveUnitHandle(HY, h, 397, BII)
	call SaveReal(HY, h, 6, x0 * 1.)
	call SaveReal(HY, h, 7, y0 * 1.)
	call SaveReal(HY, h, 433, 0 * 1.)
	call SaveReal(HY, h, 13, a * 1.)
	call SaveGroupHandle(HY, h, 187, AllocationGroup(291))
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(whichUnit,'A21M'))
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function BVI))
	set whichUnit = null
	set BEI = null
	set BXI = null
	set BOI = null
	set BRI = null
	set BII = null
	set t = null
	set d = null
endfunction
function BAI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer level = GetUnitAbilityLevel(whichUnit,'A21L')
	if level == 0 then
		set level = GetUnitAbilityLevel(whichUnit,'A21M')
	endif
	call SetUnitAbilityLevel(whichUnit,'A21N', level)
	call SetUnitAbilityLevel(whichUnit,'A21M', level)
	set t = null
	set whichUnit = null
	return false
endfunction
function LLE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	call UnitAddPermanentAbility(whichUnit,'A21N')
	call UnitAddPermanentAbility(whichUnit,'A21M')
	call SaveInteger(HY,(GetHandleId((whichUnit))),(4416), 2)
	call SaveInteger(HY,(GetHandleId((whichUnit))),(4417), 2)
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function BAI))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SavePlayerHandle(HY, h, 54,(GetOwningPlayer(whichUnit)))
	set t = null
	set whichUnit = null
endfunction
function KMF takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer level = LoadInteger(HY, h, 5)
	local integer count = LoadInteger(HY, h, 34)
	local integer Z6X = LoadInteger(HY, h, 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call UnitRemoveAbility(whichUnit,'A1N3')
		call UnitRemoveAbility(whichUnit,'A1N7')
		call UnitRemoveAbility(whichUnit,'B0CH')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_PLAYER_UNIT_ATTACKED then
		if GetAttacker() == whichUnit then
			set count = count + 1
			call SaveInteger(HY, h, 34,(count))
			if count >= Z6X then
				call UnitRemoveAbility(whichUnit,'A1N3')
				call UnitRemoveAbility(whichUnit,'A1N7')
				call UnitRemoveAbility(whichUnit,'B0CH')
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			endif
		endif
	else
		call UnitRemoveAbility(whichUnit,'A1N3')
		call UnitRemoveAbility(whichUnit,'A1N7')
		call UnitRemoveAbility(whichUnit,'B0CH')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function BNI takes nothing returns nothing
	local integer c
	if GetUnitAbilityLevel(DESource,'A1N7')> 0 then
		set c = LoadInteger(HY, GetHandleId(DESource),'A1N7'+ 1)
		if c > 1 then
			call SaveInteger(HY, GetHandleId(DESource),'A1N7'+ 1, c -1)
		else
			call RemoveSavedInteger(HY, GetHandleId(DESource),'A1N7'+ 1)
			call UnitRemoveAbility(DESource,'A1N7')
			call UnitRemoveAbility(DESource,'B0CH')
			call UnitRemoveAbility(DESource,'A1N3')
		endif
	endif
endfunction
function XOE takes nothing returns nothing
	local trigger t
	local integer h
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u, GetSpellAbilityId())
	call UnitAddAbilityToTimed(u,'A1N7', 1, 15,'B0CH')
	if GetUnitAbilityLevel(u,'A0CY') == 0 then
		call UnitAddAbilityToTimed(u,'A1N3', 1, 15, 0)
	endif
	call SaveInteger(HY, GetHandleId(u),'A1N7'+ 1, 2 + level)
	set t = null
	set u = null
endfunction
function XRE takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0)
	call UnitAddAbility(d,'A3IC')
	call SetUnitAbilityLevel(d,'A3IC', GetUnitAbilityLevel(GetTriggerUnit(),'A03Y'))
	call IssueImmediateOrderById(d, 852096)
	set d = null
endfunction
function BBI takes unit u, real d returns nothing
	local real r = 0
	set r = B4R(u)* d
	if GetUnitAbilityLevel(u,'B075')> 0 then
		if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
			set r = r + d * .15
		else
			set r = r + d * .10
		endif
	endif
	if GetUnitAbilityLevel(u,'BVA1')> 0 then
		set r = r + d * .15
	elseif GetUnitAbilityLevel(u,'BVA2')> 0 then
		set r = r + d * .2
	elseif GetUnitAbilityLevel(u,'BVA3')> 0 then
		set r = r + d * .25
	elseif GetUnitAbilityLevel(u,'BVA4')> 0 then
		set r = r + d * .3
	endif
	if UnitAlive(u) then
		call SetWidgetLife(u, GetWidgetLife(u)+ r)
	endif
endfunction
function BDI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit
	local unit BCI
	local integer level
	local real damageValue
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		set BCI = LoadUnitHandle(HY, h, 0)
		set triggerUnit = LoadUnitHandle(HY, h, 1)
		call DestroyEffect(LoadEffectHandle(HY, h, 10))
		call UnitRemoveAbility(triggerUnit,'A349')
		call UnitRemoveAbility(triggerUnit,'B02N')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call RemoveSavedHandle(HY, GetHandleId(triggerUnit),'FRSW'+ GetPlayerId(GetOwningPlayer(BCI)))
		call RemoveSavedBoolean(HY, GetHandleId(triggerUnit),'FRSW'+ GetPlayerId(GetOwningPlayer(BCI)))
	else
		set BCI = LoadUnitHandle(HY, h, 0)
		set triggerUnit = LoadUnitHandle(HY, h, 1)
		if LoadBoolean(HY, h, 2) then
			call UnitDamageTargetEx(BCI, triggerUnit, 2, LoadReal(HY, h, 100))
			if IsUnitIllusion(triggerUnit) == false then
				call BBI(BCI, LoadReal(HY, h, 100))
			endif
			call SaveBoolean(HY, h, 2, false)
		elseif GetGameTime()> LoadReal(HY, h, 0) then
			call UnitRemoveAbility(triggerUnit,'A349')
			call UnitRemoveAbility(triggerUnit,'B02N')
			call DestroyEffect(LoadEffectHandle(HY, h, 10))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call RemoveSavedHandle(HY, GetHandleId(triggerUnit),'FRSW'+ GetPlayerId(GetOwningPlayer(BCI)))
			call RemoveSavedBoolean(HY, GetHandleId(triggerUnit),'FRSW'+ GetPlayerId(GetOwningPlayer(BCI)))
		endif
	endif
	set t = null
	set BCI = null
	set triggerUnit = null
endfunction
function BFI takes unit BCI, unit targetUnit returns nothing
	local trigger t
	local integer h
	local integer ht = GetHandleId(targetUnit)
	local integer pid = GetPlayerId(GetOwningPlayer(BCI))
	local integer level = GetUnitAbilityLevel(BCI,'P067')
	if GetUnitTypeId(targetUnit)!='n00L' then
		if LoadBoolean(HY, ht,'FRSW'+ pid) == false then
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call TriggerRegisterDeathEvent(t, targetUnit)
			call TriggerRegisterTimerEvent(t, 1, true)
			call TriggerAddCondition(t, Condition(function BDI))
			call SaveBoolean(HY, ht,'FRSW'+ pid, true)
			call SaveTriggerHandle(HY, ht,'FRSW'+ pid, t)
			call SaveBoolean(HY, h, 2, true)
			call TriggerRegisterTimerEvent(t, 0, false)
			call SaveUnitHandle(HY, h, 1, targetUnit)
			call SaveEffectHandle(HY, h, 10, AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\BattleRoar\\RoarTarget.mdl", targetUnit, "overhead"))
			call UnitAddPermanentAbility(targetUnit,'A349')
		else
			set t = LoadTriggerHandle(HY, ht,'FRSW'+ pid)
			set h = GetHandleId(t)
			call SaveBoolean(HY, h, 2, true)
			call TriggerRegisterTimerEvent(t, 0, false)
		endif
		call SaveInteger(HY, h, 0, level)
		call SaveUnitHandle(HY, h, 0, BCI)
		if IsUnitType(BCI, UNIT_TYPE_MELEE_ATTACKER) == false then
			call SaveReal(HY, h, 100, LoadReal(HY, h, 100)+ 8 + 2 * level)
			call SaveReal(HY, h, 0, GetGameTime()+ 6)
		else
			call SaveReal(HY, h, 100, LoadReal(HY, h, 100)+ 5 + 5 * level)
			call SaveReal(HY, h, 0, GetGameTime()+ 12)
		endif
	endif
	set t = null
endfunction
function BGI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local integer damageValue
	local integer BHI
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or(GetUnitAbilityLevel(whichUnit,'B02H') == 0 and GetTriggerEvalCount(t)> 4) or(GetTriggerEventId() == EVENT_PLAYER_UNIT_SPELL_EFFECT and GetSpellTargetUnit() == whichUnit and FDX(GetSpellAbilityId())) then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(whichUnit,'B02H')
		call SaveInteger(HY, GetHandleId(whichUnit),'a068', 0)
		call KVX(whichUnit)
	else
		if LoadBoolean(HY, h, 0) then
			set damageValue = R2I(GetUnitState(whichUnit, UNIT_STATE_MAX_LIFE)*(.04 + .01 * LoadInteger(HY, h, 0)))
		else
			set damageValue = R2I(GetWidgetLife(whichUnit)*(.04 + .01 * LoadInteger(HY, h, 0)))
		endif
		set BHI = LoadInteger(HY, h, 238)
		if damageValue != BHI then
			call SaveInteger(HY, h, 238, damageValue)
			call SaveInteger(HY, GetHandleId(whichUnit),'a068', damageValue)
			call KVX(whichUnit)
		endif
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function XIE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerRegisterDeathEvent(t, GetTriggerUnit())
	call TriggerAddCondition(t, Condition(function BGI))
	call SaveUnitHandle(HY, h, 2, GetTriggerUnit())
	call SaveInteger(HY, h, 238, 0)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
	call SaveBoolean(HY, h, 0, GetSpellAbilityId()=='A443')
	call GBX(GetTriggerUnit())
	set t = null
endfunction
function BMI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetTriggerEventId() == EVENT_UNIT_DEATH or GetTriggerEventId() == EVENT_UNIT_HERO_REVIVE_FINISH or GetUnitTypeId(LoadUnitHandle(HY, h, 1))!= LoadInteger(HY, h, 0) then
		call UnitRemoveAbility(u, LoadInteger(HY, h, 1))
		call UnitRemoveAbility(u,'B0HB')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set u = null
	set t = null
endfunction
function BPI takes integer level, unit killingUnit, unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call UnitAddPermanentAbility(killingUnit,'A3LC'-1 + level)
	call TriggerRegisterUnitEvent(t, killingUnit, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_HERO_REVIVE_FINISH)
	call TriggerRegisterTimerEvent(t, 1, false)
	call SaveInteger(HY, GetHandleId(t), 0, GetUnitTypeId(u))
	call TriggerAddCondition(t, Condition(function BMI))
	call SaveUnitHandle(HY, GetHandleId(t), 0, killingUnit)
	call SaveUnitHandle(HY, GetHandleId(t), 1, u)
	call SaveInteger(HY, GetHandleId(t), 1,'A3LC'-1 + level)
	set t = null
endfunction
function BQI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if UnitAlive(u) then
		call SetUnitPathing(u, true)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set u = null
	set t = null
endfunction
function BSI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real x1 =(LoadReal(HY, h, 64))
	local real x2 =(LoadReal(HY, h, 66))
	local real y1 =(LoadReal(HY, h, 65))
	local real y2 =(LoadReal(HY, h, 67))
	local trigger tt
	call SetUnitPosition(whichUnit, x2, y2)
	if (A4X(x1, y1) == false or IsPointInRegion(TerrainCliffRegion, x1, y1)) and IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		set tt = CreateTrigger()
		call SaveUnitHandle(HY, GetHandleId(tt), 0, targetUnit)
		call TriggerRegisterTimerEvent(tt, 5, false)
		call SetUnitPathing(targetUnit, false)
		call TriggerAddCondition(tt, Condition(function BQI))
		set tt = null
	endif
	call SetUnitPosition(targetUnit, x1, y1)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function XDE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local real x1 = GetUnitX(whichUnit)
	local real y1 = GetUnitY(whichUnit)
	local real x2 = GetUnitX(targetUnit)
	local real y2 = GetUnitY(targetUnit)
	local trigger t
	local integer h
	local boolean BTI = IsUnitAlly(whichUnit, GetOwningPlayer(targetUnit))
	local boolean BUI = GetUnitAbilityLevel(targetUnit,'A3E9') == 1
	if GetUnitAbilityLevel(whichUnit,'Aloc') == 1 or(BTI == false and BUI) then
		if GetUnitAbilityLevel(whichUnit,'Aloc') == 0 then
			call T4V(targetUnit)
			call SetUnitPosition(targetUnit, x2, y2)
			call SetUnitPosition(whichUnit, x1, y1)
		endif
		set targetUnit = null
		set whichUnit = null
		return
	endif
	if BTI or not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(whichUnit))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SaveReal(HY, h, 64,((x1)* 1.))
		call SaveReal(HY, h, 66,((x2)* 1.))
		call SaveReal(HY, h, 65,((y1)* 1.))
		call SaveReal(HY, h, 67,((y2)* 1.))
		call TriggerRegisterTimerEvent(t, 0, false)
		call TriggerAddCondition(t, Condition(function BSI))
		call ALX("SPLK", x1, y1, x2, y2, .5, 0, 1, 1, .3)
		call KillTreeByCircle(x1, y1, 300)
		call KillTreeByCircle(x2, y2, 300)
	endif
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function K0E takes nothing returns nothing
	if (IsTerrainPathable(GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), PATHING_TYPE_WALKABILITY)) and GetUnitAbilityLevel(GetTriggerUnit(),'Aloc') == 0 then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n03B'))
	endif
endfunction
function K2E takes nothing returns nothing
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareMissile.mdl", GetTriggerUnit(), GetHeroWeaponAttachPointName(GetTriggerUnit())))
endfunction
function BWI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamageSource() == LoadUnitHandle(HY, h, 0) then
			call CommonUnitAddStun(GetTriggerUnit(), 1.35 + LoadReal(HY, h, 0)* .1, false)
			call UnitDamageTargetEx(LoadUnitHandle(HY, h, 1), GetTriggerUnit(), 1, 25 + 75 * LoadReal(HY, h, 0))
			if GetUnitAbilityLevel(GetTriggerUnit(),'A3E9') == 1 and LoadBoolean(HY, h, 0) == false and IsUnitMagicImmune(LoadUnitHandle(HY, h, 1)) == false then
				call SaveUnitHandle(OtherHashTable2,'A3E9', 0, GetTriggerUnit())
				call SaveUnitHandle(OtherHashTable2,'A3E9', 1, LoadUnitHandle(HY, h, 1))
				call SaveInteger(OtherHashTable2,'A3E9', 0, R2I(LoadReal(HY, h, 0)))
				call ExecuteFunc("BYI")
			endif
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	endif
	set t = null
endfunction
function BZI takes unit whichUnit, unit targetUnit, integer level, boolean FAR returns nothing
	local trigger t
	local integer h
	local unit d = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	call UnitAddAbility(d,'A42D')
	if FAR then
		call B0R(d, targetUnit, 852095)
	endif
	if FAR or IssueTargetOrderById(d, 852095, targetUnit) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 5, false)
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(t, Condition(function BWI))
		call SaveUnitHandle(HY, h, 0, d)
		call SaveUnitHandle(HY, h, 1, whichUnit)
		call SaveBoolean(HY, h, 0, FAR)
		call SaveReal(HY, h, 0, level * 1.)
		set t = null
	endif
	set d = null
endfunction

function F5E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call BZI(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()), false)
	endif
endfunction
function BYI takes nothing returns nothing
	local unit whichUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 0)
	local unit targetUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 1)
	local integer level = LoadInteger(OtherHashTable2,'A3E9', 0)
	call T4V(whichUnit)
	if UnitHasSpellShield(targetUnit) == false then
		call BZI(whichUnit, targetUnit, level, true)
	endif
	set whichUnit = null
	set targetUnit = null
	call FlushChildHashtable(OtherHashTable2,'A3E9')
endfunction
function B_I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(ObjectHashTable, WFV, 0)
	if UYX == 4 or UnitIsDead(LoadUnitHandle(ObjectHashTable, WFV, 0)) then
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		return
	endif
	set UYX = UYX + 1
	call SaveInteger(ObjectHashTable, WFV, 0, UYX)
	call SaveInteger(ObjectHashTable, LoadInteger(ObjectHashTable, WFV, 1), 1, UYX)
	set t = null
endfunction
function B0I takes nothing returns boolean
	local unit t = GetFilterUnit()
	if UnitAlive(t) and IsUnitEnemy(Temp__ArrayUnit[0], GetOwningPlayer(t)) and GetUnitAbilityLevel(t,'A04R') == 0 and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false and(IsUnitType(t, UNIT_TYPE_ANCIENT) == false or DRX(t)) then
		call UnitAddAbilityLevel1ToTimed(t, XK[0],'B08M', 5)
		call UnitDamageTargetEx(U2, t, 3, 75)
	endif
	set t = null
	return false
endfunction
function B1I takes nothing returns boolean
	local unit t = GetFilterUnit()
	local real d
	local real x
	local real y
	if GetUnitTypeId(t)=='e020' and GetWidgetLife(t)> .405 then
		set x = GetWidgetX(t)-Temp__ArrayReal[1]
		set y = GetWidgetY(t)-Temp__ArrayReal[2]
		set d = SquareRoot(x * x + y * y)
		if Temp__ArrayReal[0]> d then
			set Temp__ArrayUnit[0]= t
			set Temp__ArrayReal[0]= d
		endif
	endif
	set t = null
	return false
endfunction
function B2Izi takes nothing returns boolean
	local unit t = GetFilterUnit()
	local integer i
	if GetUnitTypeId(t)=='e020' and GetWidgetLife(t)> .405 then
		set i = LoadInteger(ObjectHashTable, GetHandleId(t), 2)
		if XK[0]== 0 or XK[1]> i then
			set XK[1]= i
			set Temp__ArrayUnit[0]= t
		endif
		set XK[0]= XK[0] + 1
	endif
	set t = null
	return false
endfunction
function B3I takes player p, integer WOV returns nothing
	set XK[0]= 0
	call GroupEnumUnitsOfPlayer(AK, p, Condition(function B2Izi))
	if XK[0]> WOV then
		call RemoveUnit(Temp__ArrayUnit[0])
	endif
endfunction
function YJV takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local integer hu = GetHandleId(u)
	local integer UYX = LoadInteger(ObjectHashTable, hu,'A0RP')
	local real x
	local real y
	if GetUnitTypeId(u)=='e020'then
		set Temp__ArrayUnit[0]= u
		set XK[0]= LoadInteger(ObjectHashTable, hu, 1)+'A510'
		set u = LoadUnitHandle(ObjectHashTable, hu, 0)
		set hu = GetHandleId(u)
		set UYX = LoadInteger(ObjectHashTable, hu,'A0RP')
	else
		set Temp__ArrayUnit[0]= null
		set Temp__ArrayReal[0]= 99999
		set Temp__ArrayReal[1]= GetWidgetX(u)
		set Temp__ArrayReal[2]= GetWidgetY(u)
		call GroupEnumUnitsOfPlayer(AK, p, Condition(function B1I))
		if Temp__ArrayUnit[0]== null then
			set u = null
			return
		endif
		set XK[0]= LoadInteger(ObjectHashTable, GetHandleId(Temp__ArrayUnit[0]), 1)+'A510'
	endif
	set x = GetWidgetX(Temp__ArrayUnit[0])
	set y = GetWidgetY(Temp__ArrayUnit[0])
	set U2 = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	call GroupEnumUnitsInRange(AK, x, y, 400, Condition(function B0I))
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\TomeOfRetraining\\TomeOfRetrainingCaster.mdl", x, y))
	call RemoveUnit(LoadUnitHandle(ObjectHashTable, GetHandleId(Temp__ArrayUnit[0]), 1))
	call RemoveUnit(Temp__ArrayUnit[0])
	set p = null
	set u = null
endfunction
function B4I takes unit u returns nothing
	if GetUnitTypeId(u)=='e020'then
		call YJV()
	endif
endfunction
function YHV takes nothing returns nothing
	local timer t
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local unit d = CreateUnit(p,'e020', GetSpellTargetX(), GetSpellTargetY(), 0)
	local integer hu = GetHandleId(u)
	local integer h = LoadInteger(ObjectHashTable, hu,'A0RP')
	local integer WOV = 2 + 3 *(GetUnitAbilityLevel(u,'A0RP')+ GetUnitAbilityLevel(u,'A449'))
	local boolean b = GetUnitAbilityLevel(u,'A449')> 0
	local unit du
	call SaveInteger(ObjectHashTable, hu,'A0RP', h + 1)
	set hu = GetHandleId(d)
	call SaveUnitHandle(ObjectHashTable, hu, 0, u)
	call SaveInteger(ObjectHashTable, hu, 0, 0)
	call SaveInteger(ObjectHashTable, hu, 1, 0)
	call SaveInteger(ObjectHashTable, hu, 2, h)
	call TriggerRegisterUnitEvent(UnitEventMainTrig, d, EVENT_UNIT_SPELL_EFFECT)
	call B3I(p, WOV)
	call W1E(d)
	if b then
		call SaveInteger(ObjectHashTable, hu, 1, 4)
		set du = CreateUnit(p,'e01V', GetSpellTargetX(), GetSpellTargetY(), 0)
		call UnitAddAbility(du,'A44B')
		call SaveUnitHandle(ObjectHashTable, hu, 1, du)
		set du = null
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveInteger(ObjectHashTable, h, 0, 0)
		call SaveInteger(ObjectHashTable, h, 1, hu)
		call SaveUnitHandle(ObjectHashTable, h, 0, d)
		call TimerStart(t, 1, true, function B_I)
	endif
	set d = null
	set p = null
	set u = null
	set t = null
endfunction
function L2E takes nothing returns nothing
	call UnitAddAbility(GetTriggerUnit(),'A0RT')
endfunction
function B5I takes real xc, real xt, real x, real yc, real yt, real y returns boolean
	return((y -yc)*(xt -xc)-(x -xc)*(yt -yc)> 0)
endfunction
function B6I takes unit u, real B7I, real B8I, real B9I, real CVI, real CEI, real CXI, real COI, real CRI returns boolean
	local real a1 = GetWidgetX(u)
	local real a2 = GetWidgetY(u)
	return B5I(B7I, B8I, a1, CEI, CXI, a2) == false and B5I(B9I, CVI, a1, COI, CRI, a2) and B5I(B7I, B9I, a1, CEI, COI, a2) and B5I(B8I, CVI, a1, CXI, CRI, a2) == false
endfunction
function CII takes nothing returns boolean
	local unit t = GetFilterUnit()
	if UnitAlive(t) and IsUnitEnemy(Temp__ArrayUnit[0], GetOwningPlayer(t)) and GetUnitAbilityLevel(t,'A04R') == 0 and IsUnitMagicImmune(t) == false and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false and(IsUnitType(t, UNIT_TYPE_ANCIENT) == false or DRX(t)) and t != GetTriggerUnit() then
		if B6I(t, Temp__ArrayReal[0], Temp__ArrayReal[1], Temp__ArrayReal[2], Temp__ArrayReal[3], Temp__ArrayReal[4], Temp__ArrayReal[5], Temp__ArrayReal[6], Temp__ArrayReal[7]) then
			call UnitDamageTargetEx(Temp__ArrayUnit[0], t, 3, Temp__ArrayReal[8])
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\PriestMissile\\PriestMissile.mdl", t, "chest"))
		endif
	endif
	set t = null
	return false
endfunction
function CAI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(ObjectHashTable, WFV, 0)
	local integer count
	local integer a = 0
	if LocalPlayer== LoadPlayerHandle(ObjectHashTable, WFV, 4) then
		set a = 1
	endif
	if UYX == 10 then
		call DestroyLightning(LoadLightningHandle(ObjectHashTable, WFV, 3))
		call DestroyLightning(LoadLightningHandle(ObjectHashTable, WFV, 2))
		call DestroyLightning(LoadLightningHandle(ObjectHashTable, WFV, 1))
		call DestroyLightning(LoadLightningHandle(ObjectHashTable, WFV, 0))
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		return
	endif
	set count = 0
	call SaveInteger(ObjectHashTable, WFV, 0, UYX + 1)
	set UYX = 65 + 15* UYX
	loop
	exitwhen count == 4
		call SetLightningColor(LoadLightningHandle(ObjectHashTable, WFV, count), UYX, UYX, UYX, a)
		set count = count + 1
	endloop
	set t = null
endfunction
function CNI takes player p returns nothing
	local lightning l = null
	local timer t = CreateTimer()
	local integer WFV = GetHandleId(t)
	local integer a = 0
	if LocalPlayer== p then
		set a = 1
	endif
	call SaveInteger(ObjectHashTable, WFV, 0, 0)
	set l = AddLightning("DRAB", false, Temp__ArrayReal[0], Temp__ArrayReal[4], Temp__ArrayReal[1], Temp__ArrayReal[5])
	call SetLightningColor(l, 50, 50, 50, a)
	call SaveLightningHandle(ObjectHashTable, WFV, 0, l)
	set l = AddLightning("DRAB", false, Temp__ArrayReal[0], Temp__ArrayReal[4], Temp__ArrayReal[2], Temp__ArrayReal[6])
	call SetLightningColor(l, 50, 50, 50, a)
	call SaveLightningHandle(ObjectHashTable, WFV, 1, l)
	set l = AddLightning("DRAB", false, Temp__ArrayReal[2], Temp__ArrayReal[6], Temp__ArrayReal[3], Temp__ArrayReal[7])
	call SetLightningColor(l, 50, 50, 50, a)
	call SaveLightningHandle(ObjectHashTable, WFV, 2, l)
	set l = AddLightning("DRAB", false, Temp__ArrayReal[3], Temp__ArrayReal[7], Temp__ArrayReal[1], Temp__ArrayReal[5])
	call SetLightningColor(l, 50, 50, 50, a)
	call SaveLightningHandle(ObjectHashTable, WFV, 3, l)
	call SavePlayerHandle(ObjectHashTable, WFV, 4, p)
	call TimerStart(t, .05, true, function CAI)
	set l = null
	set t = null
endfunction
function CBI takes unit u, real ZRO, real I3X, real CJR, real x, real y returns nothing
	local player p = GetOwningPlayer(u)
	local real a1 = I3X + bj_PI / 2
	local real a2 = I3X -bj_PI / 2
	local real B7I = x + 55 * Cos(a1)
	local real CEI = y + 55 * Sin(a1)
	local real B9I = x + 55 * Cos(a2)
	local real COI = y + 55 * Sin(a2)
	local real B8I
	local real CXI
	local real CVI
	local real CRI
	set a1 = ZRO * Cos(I3X)
	set a2 = ZRO * Sin(I3X)
	set B8I = B7I + a1
	set CXI = CEI + a2
	set CVI = B9I + a1
	set CRI = COI + a2
	set Temp__ArrayUnit[0]= u
	set Temp__ArrayReal[0]= B7I
	set Temp__ArrayReal[1]= B8I
	set Temp__ArrayReal[2]= B9I
	set Temp__ArrayReal[3]= CVI
	set Temp__ArrayReal[4]= CEI
	set Temp__ArrayReal[5]= CXI
	set Temp__ArrayReal[6]= COI
	set Temp__ArrayReal[7]= CRI
	set Temp__ArrayReal[8]= CJR
	if LoadBoolean(ObjectHashTable, GetHandleId(p),'A0RO') then
		call CNI(p)
	endif
	call GroupEnumUnitsInRange(AK, x, y, ZRO, Condition(function CII))
	set p = null
endfunction
function CCI takes nothing returns boolean
	local unit u = null
	local unit t = null
	local trigger trig = GetTriggeringTrigger()
	local integer WFV = GetHandleId(trig)
	local real CJR
	local real x
	local real y
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		set t = GetTriggerUnit()
		set u = GetEventDamageSource()
		set CJR = GetEventDamage()
		if LoadUnitHandle(ObjectHashTable, WFV, 0) == u and CJR > 1 and AD < 1 and FK and UnitAlive(t) then
			set x = GetWidgetX(t)
			set y = GetWidgetY(t)
			call DisableTrigger(trig)
			call CBI(u, 575 +(GetUnitAbilityLevel(u,'A0RO'))* 40, Atan2(y -LoadReal(ObjectHashTable, WFV, 1), x -LoadReal(ObjectHashTable, WFV, 0)), CJR, x, y)
			call FlushChildHashtable(ObjectHashTable, WFV)
			call CleanCurrentTrigger(trig)
		endif
		set t = null
		set u = null
	endif
	call FlushChildHashtable(ObjectHashTable, WFV)
	call CleanCurrentTrigger(trig)
	set trig = null
	return false
endfunction
function CDI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	call SaveBoolean(ObjectHashTable, LoadInteger(ObjectHashTable, WFV, 0),'A0RO', true)
	call DestroyTimerAndFlushHT_P(t)
	set t = null
endfunction
//function CFI takes unit u, unit t, integer WUV returns nothing
//	local timer time = CreateTimer()
//	local trigger trig = CreateTrigger()
//	local integer WFV = GetHandleId(trig)
//	call TriggerRegisterUnitEvent(trig, t, EVENT_UNIT_DAMAGED)
//	call TriggerRegisterTimerEvent(trig, 2.5, false)
//	call TriggerAddCondition(trig, Condition(function CCI))
//	call SaveUnitHandle(ObjectHashTable, WFV, 0, u)
//	call SaveReal(ObjectHashTable, WFV, 0, GetWidgetX(u))
//	call SaveReal(ObjectHashTable, WFV, 1, GetWidgetY(u))
//	set WFV = GetHandleId(u)
//	call SaveBoolean(ObjectHashTable, WFV,'A0RO', false)
//	call SaveInteger(ObjectHashTable, GetHandleId(time), 0, WFV)
//	call TimerStart(time, .4, false, function CDI)
//	set time = null
//	set trig = null
//endfunction
function CFI takes unit u , unit t, real damage returns nothing
	local real x = GetWidgetX(t)
	local real y = GetWidgetY(t)
	call CBI(u, 575 +(GetUnitAbilityLevel(u,'A0RO'))* 40, Atan2(y -GetWidgetY(u), x -GetWidgetX(u)), damage, x, y)
endfunction

function CGI takes unit u, unit t, real damage returns nothing
	if damage > 1 and GetUnitAbilityLevel(u,'A0RO') > 0 and GetUnitAbilityLevel(u,'A36D') == 0 and LoadBoolean(ObjectHashTable, GetHandleId(u),'A0RO') and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false and IsUnitIllusion(t) == false then
		call CFI(u, t, damage)
	endif
endfunction
function S3E takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer WFV = GetHandleId(p)
	local boolean b = LoadBoolean(ObjectHashTable, WFV,'A0RO')
	if LocalPlayer == p then
		call GetSetupText("灵能之刃作用范围显示", b)
	endif
	call SaveBoolean(ObjectHashTable, WFV,'A0RO', not b)
	//if b then
	//	call DisplayTextToPlayer(p, 0, 0, "灵能之刃作用范围显示已|c00FF0000关闭|r")
	//else
	//	call DisplayTextToPlayer(p, 0, 0, "灵能之刃作用范围显示已|c00FF0000开启|r")
	//endif

endfunction
function CHI takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	call DisplayTextToPlayer(p, 0, 0, "输入 -display 来显示灵能之刃的作用范围")
endfunction

function range_Psi_Blades takes nothing returns nothing
	local unit u = U2
	local integer lv = Q2
	call AddUnitBonusRange(u, 60. * lv, true)
	set u = null
endfunction

function P_E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer lv =(GetUnitAbilityLevel(u,'A0RO'))
	call AddUnitBonusRange(u, 60., true)
	if lv == 1 then
		call CHI(u)
		call SaveBoolean(ObjectHashTable, GetHandleId(u),'A0RO', true)
	endif
	set u = null
endfunction
function CJI takes nothing returns boolean
	local unit trigUnit = GetTriggerUnit()
	local integer h = GetHandleId(trigUnit)
	local integer Y2X =(LoadInteger(HY, h, 352))
	if Y2X > 0 and GetTriggerEventId()!= EVENT_WIDGET_DEATH then
		if GetEventDamage()> 5 and FK then
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\PriestMissile\\PriestMissile.mdl", trigUnit, "right hand"))
			call SaveInteger(HY, h, 352,(Y2X -1))
		endif
	else
		call UnitRemoveAbility(trigUnit,'A0RN')
		call UnitRemoveAbility(trigUnit,'B08J')
		call SaveInteger(HY, h, 352, 0)
	endif
	set trigUnit = null
	return false
endfunction
function CKI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local unit trigUnit =(LoadUnitHandle(HY,(GetHandleId(t)), 14))
	local integer h = GetHandleId(trigUnit)
	local integer Y2X =(LoadInteger(HY, h, 351))
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or(GetTriggerEventId() == EVENT_PLAYER_UNIT_ATTACKED and GetAttacker() == trigUnit and IsUnitAlly(GetAttacker(), GetOwningPlayer(GetTriggerUnit())) == false) then
		if GetTriggerEventId()!= EVENT_WIDGET_DEATH and Y2X > 0 and GetEventDamage()> 0 then
			call SaveInteger(HY, h, 351,(Y2X -1))
		else
			call UnitRemoveAbility(trigUnit,'A0RF')
			call UnitRemoveAbility(trigUnit,'A0RM')
			call UnitRemoveAbility(trigUnit,'B08I')
			call SaveInteger(HY, h, 351, 0)
		endif
	endif
	set t = null
	set trigUnit = null
	return false
endfunction
function CLI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 14))
	local integer hu = GetHandleId(u)
	if LoadInteger(HY, h, 0)<= 1 then
		call RemoveSavedHandle(HY, hu,'A0RN')
		call SaveInteger(HY, hu, 352, 0)
		call SaveInteger(HY, hu, 351, 0)
		call UnitRemoveAbility(u,'A0RF')
		call UnitRemoveAbility(u,'A0RM')
		call UnitRemoveAbility(u,'A0RN')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)-1)
	endif
	set t = null
	set u = null
	return false
endfunction
function XFE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer hu = GetHandleId(u)
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(u, GetSpellAbilityId())+ 2
	if HaveSavedHandle(HY, hu,'A0RN') then
		set t = LoadTriggerHandle(HY, hu,'A0RN')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerAddCondition(t, Condition(function CLI))
		call SaveUnitHandle(HY,(GetHandleId(t)), 14,(u))
		call SaveTriggerHandle(HY, hu,'A0RN', t)
	endif
	call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 1)
	call TriggerRegisterTimerEvent(t, 17, false)
	call A5X(CE, GetUnitX(u), GetUnitY(u))
	call UnitAddPermanentAbility(u,'A0RN')
	call SaveInteger(HY, hu, 352, level)
	call UnitAddPermanentAbility(u,'A0RF')
	call SetUnitAbilityLevel(u,'A0RF', GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call UnitAddPermanentAbility(u,'A0RM')
	call SaveInteger(HY, hu, 351, level)
	set u = null
	set t = null
endfunction
function M_E takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local trigger t
	set t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, trigUnit, EVENT_UNIT_DAMAGED)
	call TriggerRegisterDeathEvent(t, trigUnit)
	call TriggerAddCondition(t, Condition(function CJI))
	call SaveInteger(HY,(GetHandleId(trigUnit)), 352, 0)
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterDeathEvent(t, trigUnit)
	call TriggerAddCondition(t, Condition(function CKI))
	call SaveUnitHandle(HY,(GetHandleId(t)), 14,(trigUnit))
	call SaveInteger(HY,(GetHandleId(trigUnit)), 351, 0)
	set t = null
	set trigUnit = null
endfunction
function CMI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(t), 14),'A0RC')
	call FlushChildHashtable(HY, GetHandleId(t))
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function CPI takes unit whichUnit, unit targetUnit, integer level returns nothing
	local trigger t = CreateTrigger()
	call SaveUnitHandle(HY, GetHandleId(t), 14, targetUnit)
	call TriggerRegisterTimerEvent(t, 10, false)
	call TriggerAddCondition(t, Condition(function CMI))
	call UnitAddPermanentAbility(targetUnit,'A0RC')
	call SetUnitAbilityLevel(targetUnit,'A0RC', level)
	call UnitDamageTargetEx(whichUnit, targetUnit, 2, 50 * level)
	call CommonTextTag(I2S(50 * level), 1, targetUnit, .03, 255, 0, 0, 255)
	call UnitRemoveAbility(whichUnit,'B08K')
	set t = null
endfunction
function CQI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local trigger CSI = LoadTriggerHandle(HY, h, 353)
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamageSource() == whichUnit and AD < 1 and FK then
			call DisableTrigger(t)
			call FlushChildHashtable(HY, GetHandleId(CSI))
			call CleanCurrentTrigger(CSI)
			call CPI(whichUnit, targetUnit, level)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	elseif GetTriggerEventId() == EVENT_UNIT_ATTACKED then
		if GetAttacker() == whichUnit then
			if LoadBoolean(HY, h, 0) == false then
				call SaveBoolean(HY, h, 0, true)
			endif
		endif
	else
		if LoadInteger(HY, h, 1) == 0 then
			if LoadBoolean(HY, h, 0) == false then
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			else
				call SaveInteger(HY, h, 1, 1)
			endif
		else
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set targetUnit = null
	set whichUnit = null
	set CSI = null
	return false
endfunction
function CTI takes unit whichUnit, unit targetUnit, trigger CSI, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_ATTACKED)
	call TriggerRegisterTimerEvent(t, 4., false)
	call TriggerRegisterTimerEvent(t, .8, false)
	call TriggerAddCondition(t, Condition(function CQI))
	call SaveUnitHandle(HY, h, 30,(targetUnit))
	call SaveInteger(HY, h, 0, level)
	call SaveInteger(HY, h, 1, 0)
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveTriggerHandle(HY, h, 353, CSI)
	set t = null
endfunction
function CUI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetTriggerEventId() == EVENT_UNIT_SPELL_CAST or(GetTriggerEventId() == EVENT_PLAYER_UNIT_ATTACKED and GetAttacker() == trigUnit and IsUnitAlly(GetTriggerUnit(), GetOwningPlayer(trigUnit)) == false) then
		if GetTriggerEventId()!= EVENT_WIDGET_DEATH and GetTriggerEventId()!= EVENT_UNIT_SPELL_CAST and IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE) == false then
			call CTI(trigUnit, GetTriggerUnit(), t, level)
			call UnitRemoveAbility(trigUnit,'B08K')
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
		if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetTriggerEventId() == EVENT_UNIT_SPELL_CAST then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	elseif GetTriggerEventId() == EVENT_UNIT_ISSUED_TARGET_ORDER then
		if (GetIssuedOrderId()== 851983 or GetIssuedOrderId()==851971) and IsUnitEnemy(GetOrderTargetUnit(), GetOwningPlayer(GetTriggerUnit())) and IsUnitType(GetOrderTargetUnit(), UNIT_TYPE_STRUCTURE) == false then
			call CTI(GetTriggerUnit(), GetOrderTargetUnit(), t, level)
			call UnitRemoveAbility(trigUnit,'B08K')
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	elseif GetTriggerEventId()!= EVENT_PLAYER_UNIT_ATTACKED then
		if (x != GetUnitX(trigUnit) or y != GetUnitY(trigUnit)) then
			call UnitRemoveAbility(trigUnit,'B08K')
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set trigUnit = null
	return false
endfunction
function XGE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call DestroyEffect(AddSpecialEffectTarget("effects\\PurpleAura.mdx", trigUnit, "origin"))
	call A5X(Y0, GetUnitX(trigUnit), GetUnitY(trigUnit))
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterDeathEvent(t, trigUnit)
	call TriggerRegisterUnitEvent(t, trigUnit, EVENT_UNIT_SPELL_CAST)
	call TriggerRegisterUnitEvent(t, trigUnit, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerAddCondition(t, Condition(function CUI))
	call SaveUnitHandle(HY, h, 14, trigUnit)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(trigUnit,'A0RV'))
	call SaveReal(HY, h, 6, GetUnitX(trigUnit))
	call SaveReal(HY, h, 7, GetUnitY(trigUnit))
	call IssueImmediateOrderById(trigUnit, 851993)
	set t = null
	set trigUnit = null
endfunction
function CWI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer level =(LoadInteger(HY, h, 5))
	local integer CYI =(LoadInteger(HY, h, 247))
	call DestroyEffect(AddSpecialEffect("effects\\Tornado.mdx", GetUnitX(whichUnit), GetUnitY(whichUnit)))
	if GetTriggerEvalCount(t)> 10*(2 + .75 * level) or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call DestroyEffect((LoadEffectHandle(HY, h, 175)))
		call DestroyEffect((LoadEffectHandle(HY, h, 176)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function XHE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(whichUnit,'A14I')
	local integer CYI
	if level == 1 then
		set CYI ='A135'
	elseif level == 2 then
		set CYI ='A12O'
	elseif level == 3 then
		set CYI ='A134'
	elseif level == 4 then
		set CYI ='A139'
	endif
	call EnableAttackEffectByTime(0, 7)
	call UnitAddAbilityToTimed(whichUnit, CYI, 1, 2 + level,'B09W')
	call UnitMakeAbilityPermanent(whichUnit, true,'ACes')
	call UnitMakeAbilityPermanent(whichUnit, true,'A12M')
	call UnitMakeAbilityPermanent(whichUnit, true,'A133')
	call UnitMakeAbilityPermanent(whichUnit, true,'A132')
	call UnitMakeAbilityPermanent(whichUnit, true,'A131')
	call UnitMakeAbilityPermanent(whichUnit, true,'A13A')
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit), CYI, false)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerAddCondition(t, Condition(function CWI))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY, h, 247,(CYI))
	call SaveEffectHandle(HY, h, 175,(AddSpecialEffectTarget("effects\\Tornado.mdx", whichUnit, "hand,left")))
	call SaveEffectHandle(HY, h, 176,(AddSpecialEffectTarget("effects\\Tornado.mdx", whichUnit, "hand,right")))
	call UnitDodgeMissile(whichUnit)
	set whichUnit = null
	set t = null
endfunction
function CZI takes nothing returns nothing
	local destructable targetUnit = GetEnumDestructable()
	local real a = Atan2(GetDestructableY(targetUnit)-GetUnitY(U2), GetDestructableX(targetUnit)-GetUnitX(U2))
	local real AXO = RAbsBJ((S2 -a)* bj_RADTODEG)
	if (IsTreeDestructable(targetUnit) or GetDestructableTypeId(targetUnit)=='B005') and GetDestructableLife(targetUnit)> 1 and AXO < KJV and AXO <(KKV) then
		set KJV = AXO
		set KGV = targetUnit
	endif
	set targetUnit = null
endfunction
function C_I takes unit missileDummy, unit whichUnit, real J2E returns destructable
	local real x = GetUnitX(missileDummy)
	local real y = GetUnitY(missileDummy)
	local rect r = Rect(x -KLV, y -KLV, x + KLV, y + KLV)
	set KJV = 9999
	set U2 = missileDummy
	set KGV = null
	call EnumDestructablesInRect(r, null, function CZI)
	call RemoveRect(r)
	set r = null
	return KGV
endfunction
function C0I takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local real a = Atan2(GetUnitY(targetUnit)-GetUnitY(U2), GetUnitX(targetUnit)-GetUnitX(U2))
	local real AXO = RAbsBJ((S2 -a)* bj_RADTODEG)
	if AXO < KJV and AXO < KKV and targetUnit != MissileHitTargetUnit then
		set KJV = AXO
		set KHV = targetUnit
	endif
	set targetUnit = null
endfunction
function C1I takes unit missileDummy, unit whichUnit, real J2E returns unit
	local group g = AllocationGroup(294)
	set KHV = null
	set KJV = 9999
	set U2 = missileDummy
	set S2 = Atan2(GetUnitY(whichUnit)-KPV, GetUnitX(whichUnit)-KMV)
	set MissileHitTargetUnit = whichUnit
	call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 600, Condition(function DQX))
	call ForGroup(g, function C0I)
	call DeallocateGroup(g)
	set g = null
	return KHV
endfunction
function C2III takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if (LoadLightningHandle(HY, h, 196))!= null then
		call DestroyLightning((LoadLightningHandle(HY, h, 196)))
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function C3I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit missileDummy =(LoadUnitHandle(HY, h, 45))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real C4I =(LoadReal(HY, h, 248))
	local real a = Atan2(GetUnitY(targetUnit)-GetUnitY(missileDummy), GetUnitX(targetUnit)-GetUnitX(missileDummy))
	local integer level =(LoadInteger(HY, h, 5))
	local real x = GetUnitX(missileDummy)+ 50 * Cos(a)
	local real y = GetUnitY(missileDummy)+ 50 * Sin(a)
	local unit C5I
	local destructable d
	local lightning APX
	local unit dummyCaster
	local boolean I1O =(LoadBoolean(HY, h, 249))
	local real FWX
	local real C6I
	local boolean FAR
	local unit whichUnit
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(missileDummy)
	else
		call SetUnitX(missileDummy, x)
		call SetUnitY(missileDummy, y)
		call SetUnitFacing(missileDummy, a * bj_RADTODEG)
		if GetDistanceBetween(x, y, GetUnitX(targetUnit), GetUnitY(targetUnit))< 45 then
			set KMV =(LoadReal(HY, h, 6))
			set KPV =(LoadReal(HY, h, 7))
			set FAR = LoadBoolean(HY, h, 0)
			set whichUnit = LoadUnitHandle(HY, h, 44)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			if GetUnitTypeId(targetUnit)!='n00L' and I1O then
				if GetUnitAbilityLevel(targetUnit,'A3E9') == 1 and IsUnitMagicImmune(whichUnit) == false and FAR == false then
					call SaveUnitHandle(OtherHashTable2,'A3E9', 0, targetUnit)
					call SaveUnitHandle(OtherHashTable2,'A3E9', 1, whichUnit)
					call SaveInteger(OtherHashTable2,'A3E9', 0, level)
					call ExecuteFunc("C7I")
				endif
				set C5I = C1I(missileDummy, targetUnit, C4I)
				set d = C_I(missileDummy, targetUnit, C4I)
				if C5I != null then
					set t = CreateTrigger()
					set h = GetHandleId(t)
					set FWX = CommonUnitAddStun(targetUnit, .75 *(level + 1), false)
					set C6I = CommonUnitAddStun(C5I, .75 *(level + 1), false)
					call TriggerRegisterTimerEvent(t, RMaxBJ(FWX, C6I), false)
					call TriggerAddCondition(t, Condition(function C2III))
					set APX = AddLightning("MFPB", true, GetUnitX(targetUnit), GetUnitY(targetUnit), GetUnitX(C5I), GetUnitY(C5I))
					call SetLightningColor(APX, .5, .5, 1, 1)
					call SaveLightningHandle(HY, h, 196,(APX))
				elseif d != null then
					set t = CreateTrigger()
					set h = GetHandleId(t)
					set dummyCaster = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
					set FWX = CommonUnitAddStun(targetUnit, .75 *(level + 1), false)
					call TriggerRegisterTimerEvent(t, FWX, false)
					call TriggerAddCondition(t, Condition(function C2III))
					set APX = AddLightning("MFPB", true, GetUnitX(targetUnit), GetUnitY(targetUnit), GetDestructableX(d), GetDestructableY(d))
					call SetLightningColor(APX, .5, .5, 1, 1)
					call SaveLightningHandle(HY, h, 196,(APX))
					call SetDestructableAnimation(d, "stand hit")
				else
					call CommonUnitAddStun(targetUnit, .75, false)
				endif
			endif
			call KillUnit(missileDummy)
		endif
	endif
	set t = null
	set missileDummy = null
	set targetUnit = null
	set APX = null
	set C5I = null
	set d = null
	set dummyCaster = null
	return false
endfunction
function C8I takes unit whichUnit, unit targetUnit, integer level, boolean FAR returns nothing
	local real a = Atan2(GetUnitY(targetUnit)-GetUnitY(whichUnit), GetUnitX(targetUnit)-GetUnitX(whichUnit))
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit missileDummy = CreateUnit(GetOwningPlayer(whichUnit),'h077', GetUnitX(whichUnit), GetUnitY(whichUnit), a * bj_RADTODEG)
	local boolean I1O = UnitHasSpellShield(targetUnit) == false
	call SaveUnitHandle(HY, h, 45,(missileDummy))
	call SaveUnitHandle(HY, h, 44, whichUnit)
	call SaveBoolean(HY, h, 0, FAR)
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h, 248,((a)* 1.))
	call SaveBoolean(HY, h, 249,(I1O))
	call SaveReal(HY, h, 6,((GetUnitX(whichUnit))* 1.))
	call SaveReal(HY, h, 7,((GetUnitY(whichUnit))* 1.))
	call TriggerRegisterTimerEvent(t, .033, true)
	call TriggerAddCondition(t, Condition(function C3I))
	call TriggerRegisterDeathEvent(t, targetUnit)
	set missileDummy = null
	set t = null
endfunction
function XJE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A12J')
	call C8I(whichUnit, targetUnit, level, false)
	set whichUnit = null
	set targetUnit = null
endfunction
function C7I takes nothing returns nothing
	local unit whichUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 0)
	local unit targetUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 1)
	local integer level = LoadInteger(OtherHashTable2,'A3E9', 0)
	call T4V(whichUnit)
	call C8I(whichUnit, targetUnit, level, true)
	set whichUnit = null
	set targetUnit = null
endfunction
function C9I takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), KQV) == false and GetUnitAbilityLevel(GetEnumUnit(),'Bcyc') == 0 then
		call UnitDamageTargetEx((KSV),(GetEnumUnit()), 1,(((KTV)* 1.))* Pow(.9,(KWV))* Pow(.99,(KUV)))
		call GroupAddUnit(KQV, GetEnumUnit())
		set KWV = KWV + 1
	endif
endfunction
function DVI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit missileDummy =(LoadUnitHandle(HY, h, 45))
	local real tx =(LoadReal(HY, h, 47))
	local real ty =(LoadReal(HY, h, 48))
	local real a =(LoadReal(HY, h, 13))
	local real IXX =(LoadReal(HY, h, 20))
	local integer DEI =(LoadInteger(HY, h, 354))
	local integer DXI =(LoadInteger(HY, h, 355))
	local group D7R =(LoadGroupHandle(HY, h, 187))
	local real x = CoordinateX50(GetUnitX(missileDummy)+(60 * Pow(.9, DXI)* Pow(.99, DEI))* Cos(a))
	local real y = CoordinateY50(GetUnitY(missileDummy)+(60 * Pow(.9, DXI)* Pow(.99, DEI))* Sin(a))
	local group g = AllocationGroup(295)
	local real d
	if GetTriggerEvalCount(t)> 2 then
		set d = 150
	else
		set d = 75
	endif
	call DestroyEffect(AddSpecialEffect("effects\\Tornado.mdx", x, y))
	set DEI = DEI + KillTreeByCircle(x, y, 75)
	call SaveInteger(HY, h, 354,(DEI))
	set KQV = D7R
	set KSV = missileDummy
	set KTV = IXX
	set KUV = DEI
	set KWV = DXI
	set U2 = missileDummy
	call GroupEnumUnitsInRange(g, x, y, d, Condition(function DJX))
	call ForGroup(g, function C9I)
	call DeallocateGroup(g)
	call SaveInteger(HY, h, 355,(KWV))
	call SetUnitX(missileDummy, x)
	call SetUnitY(missileDummy, y)
	if GetTriggerEvalCount(t)> 43 then
		call KillUnit(missileDummy)
		call DeallocateGroup(D7R)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set missileDummy = null
	set D7R = null
	set g = null
	return false
endfunction
function DOI takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real x2 =(LoadReal(HY,(GetHandleId(whichUnit)), 356))
	local real y2 =(LoadReal(HY,(GetHandleId(whichUnit)), 357))
	local real DRI = RMinBJ(GetGameTime()-LoadReal(HY, GetHandleId(whichUnit), 358), 1.)
	local real a = Atan2(y2 -GetUnitY(whichUnit), x2 -GetUnitX(whichUnit))
	local trigger t
	local integer h
	local unit missileDummy
	local integer level = GetUnitAbilityLevel(whichUnit,'A12K')
	local real IXX =(40 + 80 * level)*(DRI)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	set missileDummy = CreateUnit(GetOwningPlayer(whichUnit),'h078', GetUnitX(whichUnit), GetUnitY(whichUnit), a * bj_RADTODEG)
	set x2 = GetUnitX(whichUnit)+ 2475* Cos(a)
	set y2 = GetUnitY(whichUnit)+ 2475* Sin(a)
	call SaveUnitHandle(HY, h, 45,(missileDummy))
	call SaveReal(HY, h, 47,((x2)* 1.))
	call SaveReal(HY, h, 48,((y2)* 1.))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveReal(HY, h, 20,((IXX)* 1.))
	call SaveInteger(HY, h, 354, 0)
	call SaveInteger(HY, h, 355, 0)
	call SaveGroupHandle(HY, h, 187,(AllocationGroup(296)))
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function DVI))
	set whichUnit = null
	set t = null
	set missileDummy = null
endfunction
function DII takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	call SetUnitTimeScale(trigUnit, 1)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set trigUnit = null
	return false
endfunction
function DAI takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = GetTriggerUnit()
	local location l = GetSpellTargetLoc()
	local real x = GetLocationX(l)
	local real y = GetLocationY(l)
	call RemoveLocation(l)
	call SaveReal(HY,(GetHandleId(trigUnit)), 356,((x)* 1.))
	call SaveReal(HY,(GetHandleId(trigUnit)), 357,((y)* 1.))
	call SaveReal(HY,(GetHandleId(trigUnit)), 358, GetGameTime()-0.3)
	call SetUnitTimeScale(trigUnit, .75)
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call TriggerRegisterTimerEvent(t, .75, false)
	call TriggerRegisterDeathEvent(t, trigUnit)
	call TriggerAddCondition(t, Condition(function DII))
	set t = null
	set trigUnit = null
	set l = null
endfunction
function LIE takes nothing returns nothing
	call SaveBoolean(HY, GetHandleId(GetTriggerUnit()), 360, false)
	call DAI()
endfunction
function DNI takes nothing returns boolean
	if GetSpellAbilityId()=='A12K' then
		if (LoadBoolean(HY,(GetHandleId(GetTriggerUnit())), 360)) then
			call DOI()
		endif
	endif
	return false
endfunction
function XKE takes nothing returns nothing
	call SaveBoolean(HY, GetHandleId(GetTriggerUnit()), 360, true)
endfunction
function PSX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function DNI))
	set t = null
endfunction
function DBI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local real J0R =(LoadReal(HY, h, 193))
	local boolean KMR =(LoadBoolean(HY, h, 15))
	//	if GetTriggerEvalCount(t) == 1 then
	//		call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	//	endif
	if GetTriggerEventId() == EVENT_PLAYER_UNIT_ATTACKED then
		if GetAttacker() == whichUnit and GetTriggerUnit() == targetUnit then
			call DestroyEffect(AddSpecialEffectTarget("effects\\Tornado.mdx", whichUnit, "hand,left"))
			call DestroyEffect(AddSpecialEffectTarget("effects\\Tornado.mdx", whichUnit, "hand,right"))
			if GetUnitAbilityLevel(whichUnit,'A12R') == 0 then
				call UnitAddPermanentAbility(whichUnit,'A12R')
				call UnitMakeAbilityPermanent(whichUnit, true,'A12S')
				call UnitMakeAbilityPermanent(whichUnit, true,'A12Q')
			endif
		elseif GetAttacker() == whichUnit and GetTriggerUnit()!= targetUnit then
			call UnitRemoveAbility(whichUnit,'A12R')
			call UnitRemoveAbility(whichUnit,'B09X')
			call UnitRemoveAbility(whichUnit,'A1FK')
			call UnitRemoveAbility(whichUnit,'A1FL')
			call UnitRemoveAbility(whichUnit,'A1FJ')
		endif
	elseif GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamageSource() == whichUnit and KMR == false and FK then
			call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+(J0R)* GetEventDamage())
		endif
		//	elseif GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
		//		if GetSpellAbilityId()=='A12P' or GetSpellAbilityId()=='A1D6' then
		//			if GetUnitAbilityLevel(whichUnit,'A12R')> 0 then
		//				call UnitRemoveAbility(whichUnit,'A12R')
		//			endif
		//			call FlushChildHashtable(HY, h)
		//			call CleanCurrentTrigger(t)
		//		endif
	else
		//		call UnitAddAbility(u, 'A33Z')
		//		call UnitRemoveAbility(u, 'A33Z')
		call UnitRemoveAbility(whichUnit,'A12R')
		call UnitRemoveAbility(whichUnit,'B09X')
		call RemoveSavedHandle(HY, GetHandleId(whichUnit), 'trig')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(whichUnit,'A1FK')
		call UnitRemoveAbility(whichUnit,'A1FL')
		call UnitRemoveAbility(whichUnit,'A1FJ')
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function DCI takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger trg
	local integer h
	local integer l__K = GetHandleId(whichUnit)
	local integer level = GetUnitAbilityLevel(whichUnit,'A12P')
	local real J0R = .6 -level * .1
	local boolean KMR = false
	if GetUnitAbilityLevel(whichUnit,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(whichUnit), 0) then
		set whichUnit = LoadUnitHandle(HY, GetHandleId(whichUnit), 0)
	endif
	if (HaveSavedHandle(HY, l__K, 'trig') ) then
		set trg = LoadTriggerHandle(HY, l__K, 'trig')
		call FlushChildHashtable(HY, GetHandleId(trg))
		call CleanCurrentTrigger(trg)
	endif
	set trg = CreateTrigger()
	set h = GetHandleId(trg)
	call UnitRemoveAbility(whichUnit,'A12R')
	call UnitRemoveAbility(whichUnit,'B09X')
	//	call UnitAddAbility(u, 'A33Y')
	//    call UnitRemoveAbility(u, 'A33Y')
	if level == 0 then
		set KMR = true
		set level = GetUnitAbilityLevel(whichUnit,'A1D6')
		set J0R = .6 -level * .15
	endif
	call SetPlayerAbilityAvailable(GetOwningPlayer(whichUnit),'A12R', false)
	call UnitAddPermanentAbility(whichUnit,'A12R')
	call UnitMakeAbilityPermanent(whichUnit, true,'A12S')
	call UnitMakeAbilityPermanent(whichUnit, true,'A12Q')
	call IssueTargetOrderById(whichUnit, 851983, targetUnit)
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveBoolean(HY, h, 15,(KMR))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))
	call SaveReal(HY, h, 193,((J0R)* 1.))
	call SaveInteger(HY, h, 361, 0)
	call SaveTriggerHandle(HY, l__K, 'trig', trg)
	call TriggerRegisterTimerEvent(trg, 20, false)
	call TriggerRegisterPlayerUnitEventBJ(trg, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterUnitEvent(trg, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerRegisterDeathEvent(trg, whichUnit)
	call TriggerRegisterDeathEvent(trg, targetUnit)
	call TriggerAddCondition(trg, Condition(function DBI))
	set whichUnit = null
	set targetUnit = null
	set trg = null
endfunction
function XLE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call DCI()
	endif
endfunction
function DFI takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and GetUnitTypeId(GetFilterUnit())!='H00J' and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(KYV))))
endfunction
function DGI takes nothing returns nothing
	local real x = GetUnitX(GetEnumUnit())
	local real y = GetUnitY(GetEnumUnit())
	local unit d = CreateUnit(GetOwningPlayer(KYV),'e000', x, y, 0)
	local integer id ='A06L'
	call UnitAddAbility(d,'Aloc')
	call UnitApplyTimedLife(d,'BTLF', 3)
	if GetSpellAbilityId()!='A29G' then
		set id ='A07C'
	endif
	call UnitAddAbility(d, id)
	call SetUnitAbilityLevel(d, id, QI)
	if GetUnitAbilityLevel(GetEnumUnit(),'A1HX') == 0 then
		call IssueTargetOrderById(d, 852119, GetEnumUnit())
	endif
	set d = null
endfunction
function XME takes nothing returns nothing
	local group g = AllocationGroup(297)
	set KYV = GetTriggerUnit()
	set QI = GetUnitAbilityLevel(KYV,'A29G')+ GetUnitAbilityLevel(KYV,'A29H')
	call GroupEnumUnitsInRect(g, bj_mapInitialPlayableArea, Condition(function DFI))
	call ForGroup(g, function DGI)
	call DeallocateGroup(g)
	set g = null
endfunction
function DHI takes nothing returns boolean
	local unit t = GetFilterUnit()
	local unit u = Temp__ArrayUnit[0]
	if IsUnitEnemy(u, GetOwningPlayer(t)) and UnitAlive(t) and IsUnitMagicImmune(t) == false and GetUnitAbilityLevel(t,'A04R') == 0 and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false and GetUnitTypeId(t)!='n00L' then
		call UnitDamageTargetEx(u, t, 1, GetWidgetLife(t)*(.03 + .02 * XK[0])+ .01 * GetUnitState(t, UNIT_STATE_MAX_LIFE))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\ForkedLightning\\ForkedLightningTarget.mdl", t, "overhead"))
	endif
	set u = null
	set t = null
	return false
endfunction
function DJI takes unit u returns nothing
	local group g = AllocationGroup(298)
	local unit u2
	local unit damageSource = null
	local integer level
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 1300, Condition(function D5X))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		if GetUnitAbilityLevel(u2,'A0N5')> 0 then
			set damageSource = u2
		exitwhen true
		endif
		call GroupRemoveUnit(g, u2)
	endloop
	if damageSource != null then
		set XK[0]= GetUnitAbilityLevel(damageSource,'A0N5')
		set Temp__ArrayUnit[0]= damageSource
		call GroupEnumUnitsInRange(AK, GetWidgetX(damageSource), GetWidgetY(damageSource), 1225, Condition(function DHI))
	endif
	set damageSource = null
	set u2 = null
	call DeallocateGroup(g)
	set g = null
endfunction
function DKI takes unit u, integer WTV returns nothing
	set XK[0]= GetUnitAbilityLevel(u,'A0N5')
	if GetUnitAbilityLevel(u,'A36D') == 0 and((IsAttackSpecialEffects(WTV) == false and X5R(WTV) == false and LNX(WTV) == false and IsNotItemAbility(WTV) and GetUnitAbilityLevel(u,'A04R') == 0 and X6R(WTV) == false) or(Mode__BalanceOff and OER(WTV))) then
		if XK[0]> 0 then
			set Temp__ArrayUnit[0]= u
			call GroupEnumUnitsInRange(AK, GetWidgetX(u), GetWidgetY(u), 1225, Condition(function DHI))
		endif
	endif
endfunction
function DLI takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsAliveNotStrucNotWard(GetFilterUnit()) and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(U2)) and IsUnitMagicImmune(GetFilterUnit()) == false)!= null
endfunction
function DMI takes unit u, unit t, integer lv, boolean FAR, real x, real y returns nothing
	local unit d
	local real damageValue = 25 + lv * 75
	local group g
	if lv == 3 then
		set damageValue = 275
	endif
	if lv == 4 then
		set damageValue = 350
	endif
	if t == null then
		set g = AllocationGroup(299)
		set U2 = u
		call GroupEnumUnitsInRange(g, x, y, 425, Condition(function DLI))
		set t = EXX(g, x, y)
		call DeallocateGroup(g)
		set g = null
	endif
	if t != null and UnitHasSpellShield(t) == false then
		if GetUnitAbilityLevel(t,'A3E9') == 1 and IsUnitMagicImmune(u) == false and FAR == false then
			call SaveUnitHandle(OtherHashTable2,'A3E9', 0, t)
			call SaveUnitHandle(OtherHashTable2,'A3E9', 1, u)
			call SaveInteger(OtherHashTable2,'A3E9', 0, lv)
			call ExecuteFunc("DPI")
		endif
		set x = GetUnitX(t)
		set y = GetUnitY(t)
		call TDV(t)
		call IOX(u, t, 1, damageValue, .25)
	endif
	set d = CreateUnit(GetOwningPlayer(u),'e000', x, y, 0)
	call UnitAddAbility(d,'Aloc')
	call UnitAddAbility(d,'A3FR')
	call UnitApplyTimedLife(d,'BTLF', 4.5)
	call SetUnitPathing(d, false)
	if t == null or IssueTargetOrderById(d, 852119, t) == false then
		set t = CreateUnit(GetOwningPlayer(u),'e00C', x, y, 0)
		call UnitApplyTimedLife(t,'BTLF', .2)
		call UnitAddAbility(t,'Aetl')
		call IssueTargetOrderById(d, 852119, t)
		call DestroyEffect(AddSpellEffectById('A3FR', EFFECT_TYPE_TARGET, x, y))
	endif
	set g = null
	set d = null
endfunction
function XPE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit t = GetSpellTargetUnit()
	call DMI(u, t, GetUnitAbilityLevel(u,'A0JC'), false, GetSpellTargetX(), GetSpellTargetY())
	set u = null
	set t = null
endfunction
function DPI takes nothing returns nothing
	local unit whichUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 0)
	local unit targetUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 1)
	local integer lv = LoadInteger(OtherHashTable2,'A3E9', 0)
	call T4V(LoadUnitHandle(OtherHashTable2,'A3E9', 0))
	call DMI(whichUnit, targetUnit, lv, true, GetUnitX(targetUnit), GetUnitY(targetUnit))
	set whichUnit = null
	set targetUnit = null
	call FlushChildHashtable(OtherHashTable2,'A3E9')
endfunction
function ETI takes nothing returns nothing
	local unit u = LoadUnitHandle(OtherHashTable2,'A3E9', 0)
	local integer lv = LoadInteger(OtherHashTable2,'A3E9', 0)
	local real x = LoadReal(OtherHashTable2,'A3E9', 0)
	local real y = LoadReal(OtherHashTable2,'A3E9', 1)
	call DMI(u, null, lv, true, x, y)
	set u = null
	call FlushChildHashtable(OtherHashTable2,'A3E9')
endfunction
function DQI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit dummyCaster = LoadUnitHandle(HY, h, 19)
	local integer UYX = LoadInteger(HY, h, 0)+ 1
	call SaveInteger(HY, h, 0, UYX)
	call SetUnitX(dummyCaster, GetUnitX(whichUnit))
	call SetUnitY(dummyCaster, GetUnitY(whichUnit))
	if UYX > 80 then
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	endif
	set t = null
	set whichUnit = null
	set dummyCaster = null
endfunction
function DSI takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e02C', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call UnitAddPermanentAbility(dummyCaster,'A1FM')
	call SetUnitAbilityLevel(dummyCaster,'A1FM', GetUnitAbilityLevel(whichUnit,'A020'))
	call IssueTargetOrderById(dummyCaster, 852119, targetUnit)
	call UnitApplyTimedLife(dummyCaster,'BTLF', 10)
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 19, dummyCaster)
	call TimerStart(t, .05, true, function DQI)
	set whichUnit = null
	set targetUnit = null
	set dummyCaster = null
	set t = null
endfunction
function XQE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call DSI()
	endif
endfunction
function DTI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call UnitDamageTargetEx(LoadUnitHandle(HY, h, 14), LoadUnitHandle(HY, h, 14), 3, LoadReal(HY, h, 20))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function DUI takes unit whichUnit, unit targetUnit returns nothing
	local real damageValue = 25 + 25 * GetUnitAbilityLevel(whichUnit,('A0I3'))
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	if IsUnitType(whichUnit, UNIT_TYPE_HERO) == false and HaveSavedHandle(HY, GetHandleId(whichUnit), 0) then
		set whichUnit = LoadUnitHandle(HY, GetHandleId(whichUnit), 0)
	endif
	if IsUnitAlly(targetUnit, GetOwningPlayer(whichUnit)) then
		if UnitAlive(targetUnit) then
			call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+ 2 * damageValue + 75)
		endif
	else
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 2 * damageValue + 75)
	endif
	call SaveUnitHandle(HY, h, 14, whichUnit)
	call SaveReal(HY, h, 20,(damageValue + 50)* 1.)
	call TimerStart(t, 0, false, function DTI)
	set t = null
endfunction
function DWI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call DUI(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function XSE takes nothing returns nothing
	local timer t
	local integer h
	if IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) or not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, 0, false, function DWI)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		set t = null
	endif
endfunction
function DYI takes nothing returns nothing
	local unit dummyCaster = CreateUnit(GetOwningPlayer(KZV),'e00E', GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()), 0)
	call UnitAddPermanentAbility(dummyCaster,'A0MJ')
	call SetUnitAbilityLevel(dummyCaster,'A0MJ', K_V)
	call IssueTargetOrderById(dummyCaster, 852587, GetEnumUnit())
	set dummyCaster = null
endfunction
function DZI takes unit whichUnit, unit targetUnit, integer level returns nothing
	local group g = AllocationGroup(300)
	set U2 = whichUnit
	set K_V = level
	set KZV = whichUnit
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 700, Condition(function DGX))
	call ForGroup(g, function DYI)
	call DeallocateGroup(g)
	set g = null
endfunction
function D_I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real D0I =(LoadReal(HY, h, 362))
	local unit whichUnit
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local integer level
	local integer c = LoadInteger(HY, h, 0)
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if FK and LoadBoolean(ObjectHashTable, GetHandleId(GetTriggerUnit()),'A0NS') == false then
			if D0I < GetEventDamage() then
				set whichUnit =(LoadUnitHandle(HY, h, 2))
				set level =(LoadInteger(HY, h, 5))
				call SaveBoolean(HY,(GetHandleId(targetUnit)), 363,(false))
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
				call UnitRemoveAbility(targetUnit,'C000')
				call UnitRemoveAbility(targetUnit,'D000')
				call SetUnitToReduceDamage(GetTriggerUnit(), D0I)
				call DZI(whichUnit, GetTriggerUnit(), level)
			elseif GetEventDamage()> 0 then
				call SetUnitToReduceDamage(GetTriggerUnit(), GetEventDamage())
				call SaveReal(HY, h, 362,((D0I -GetEventDamage())* 1.))
			endif
		endif
	else
		if GetUnitAbilityLevel(targetUnit,'C000') == 0 or c > 15* 5 then
			set whichUnit =(LoadUnitHandle(HY, h, 2))
			set level =(LoadInteger(HY, h, 5))
			call SaveBoolean(HY,(GetHandleId(targetUnit)), 363,(false))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call DZI(whichUnit, targetUnit, level)
			call UnitRemoveAbility(targetUnit,'C000')
			call UnitRemoveAbility(targetUnit,'D000')
		else
			call SaveInteger(HY, h, 0, c + 1)
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function XTE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = GetSpellTargetUnit()
	local unit whichUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A0MF')
	local integer hu = GetHandleId(targetUnit)
	local real D0I
	if (LoadBoolean(HY,(hu), 363)) then
		call UnitRemoveAbility(targetUnit,'C000')
		call TriggerEvaluate((LoadTriggerHandle(HY,(hu), 364)))
	endif
	call GBX(targetUnit)
	if level == 1 then
		set D0I = 100
	elseif level == 2 then
		set D0I = 175
	elseif level == 3 then
		set D0I = 250
	else
		set D0I = 325
	endif
	call UnitAddPermanentAbility(targetUnit,'C000')
	call SaveReal(HY, h, 362,((D0I)* 1.))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerAddCondition(t, Condition(function D_I))
	call SaveTriggerHandle(HY,(hu), 364,(t))
	call SaveBoolean(HY,(hu), 363,(true))
	set t = null
	set targetUnit = null
	set whichUnit = null
endfunction
function D1I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local boolean Q0X = LoadBoolean(ObjectHashTable, WFV,'forc')
	if LoadBoolean(ObjectHashTable, WFV, 0) then
		call SaveBoolean(ObjectHashTable,'A0NS', LoadInteger(ObjectHashTable, WFV, 0), true)
		call DestroyTimerAndFlushHT_P(t)
	else
		call TimerStart(t, LoadInteger(ObjectHashTable, WFV, 1), false, function D1I)
		call SaveBoolean(ObjectHashTable, LoadInteger(ObjectHashTable, WFV, 0),'A0NS', false)
		call SaveBoolean(ObjectHashTable, WFV, 0, true)
	endif
	set t = null
endfunction
function D2IIII takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit D3I = LoadUnitHandle(HY, h, 0)
	local boolean b = GetUnitAbilityLevel( D3I, 'C022' ) == 0
	local real damageValue
	local unit u
	local integer j = LoadInteger(HY, h, 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or b == false then
		if j > 0 then
			loop
				set u = LoadUnitHandle(HY, h, j)
				call UnitRemoveAbility(u,'A3KG')
				call UnitRemoveAbility(u,'B3KG')
				call RemoveSavedHandle(HY, GetHandleId(u),'A3KG')
				set j = j -1
			exitwhen j <= 0
			endloop
		endif
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	else
		if j > 0 then
			loop
				set u = LoadUnitHandle(HY, h, j)
				if GetUnitDistanceEx(D3I, u)< 900 then
					if GetUnitAbilityLevel(u,'A3KG') == 0 then
						call UnitAddPermanentAbility(u,'A3KG')
						call SaveUnitHandle(HY, GetHandleId(u),'A3KG', D3I)
					endif
				else
					call UnitRemoveAbility(u,'A3KG')
					call UnitRemoveAbility(u,'B3KG')
					call RemoveSavedHandle(HY, GetHandleId(u),'A3KG')
				endif
				set j = j -1
			exitwhen j <= 0
			endloop
		endif
	endif
	set t = null
	set D3I = null
endfunction
function D4I takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local player p = GetOwningPlayer(u)
	local integer i = 1
	local integer k = 5
	local boolean b = false
	local integer j = 0
	if IsScourgePlayer(p) then
		set b = true
	endif
	loop
		if b then
			if Player__Hero[GetPlayerId(ScourgePlayers[i])]!= null and Player__Hero[GetPlayerId(ScourgePlayers[i])]!= u then
				set j = j + 1
				call SaveUnitHandle(HY, h, j, Player__Hero[GetPlayerId(ScourgePlayers[i])])
			endif
		else
			if Player__Hero[GetPlayerId(SentinelPlayers[i])]!= null and Player__Hero[GetPlayerId(SentinelPlayers[i])]!= u then
				set j = j + 1
				call SaveUnitHandle(HY, h, j, Player__Hero[GetPlayerId(SentinelPlayers[i])])
			endif
		endif
		set i = i + 1
	exitwhen i > k
	endloop
	call TriggerRegisterDeathEvent(t, u)
	call TriggerRegisterTimerEvent(t, .1, true)
	call SaveInteger(HY, h, 0, j)
	call TriggerAddCondition(t, Condition(function D2IIII))
	call SaveUnitHandle(HY, h, 0, u)
	set t = null
endfunction
//回光返照
function UnitSpellEffect__BorrowedTime takes unit u, integer DSR returns nothing
	local timer t = CreateTimer()
	local player trigPlayer = GetOwningPlayer(u)
	local integer h = GetHandleId(t)
	local integer lv = GetUnitAbilityLevel(u,'A0NS') //技能等级
	local boolean isSelected = IsUnitSelected(u, trigPlayer) //玩家是否选择了该单位
	local real dur = 0
	local integer id ='A0NS'
	local real cool = 100 - lv * 10
	call GBX(u)
	if lv == 0 then
		set lv = GetUnitAbilityLevel(u,'A1DA')
		set dur = 2.5 + lv * 1.
		set id ='A1DA'
		call D4I(u)
	else
		set dur = 2.7 + .3 * lv
	endif
	if GetUnitAbilityLevel(u,'A39S') == 1 then
		set cool = cool * 0.75
	endif
	call YDWESetUnitAbilityState(u, id, 1, cool)
	if trigPlayer == LocalPlayer and isSelected then
		call SelectUnit(u, true) //让玩家再选择他
	endif
	call UnitAddAbilityLevel1ToTimed(u,'C022','D022', dur) // 添加Buff

	//call SaveInteger(ObjectHashTable, h, 1, R2I(YDWEGetUnitAbilityDataReal(u, id, lv, 105))-R2I(dur))
	//call SaveBoolean(ObjectHashTable, DSR,'A0NS', true)
	//call SaveBoolean(ObjectHashTable,'A0NS', DSR, false)
	//call SaveInteger(ObjectHashTable, h, 0, DSR)
	//call SaveBoolean(ObjectHashTable, h, 0, false)
	//call TimerStart(t, dur, false, function D1I)
	//call SaveTimerHandle(HY, DSR,'A0NS', t)
	set t = null
	set trigPlayer = null
endfunction
function YDV takes nothing returns nothing
	local unit u = GetTriggerUnit()
	call UnitSpellEffect__BorrowedTime(u, GetHandleId(u))
	set u = null
endfunction
function D6I takes unit u, real d returns nothing
	local integer hu = GetHandleId(u)
	if LoadBoolean( ExtraHT, hu, HTKEY_HAS_BORROWEDTIME ) and YDWEGetUnitAbilityState(u, 'A0NS', 1) == 0. and YDWEGetUnitAbilityState(u, 'A1DA', 1) == 0. and 400 > GetWidgetLife(u) and GetUnitAbilityLevel(u,'A36D') == 0 then
		call UnitSpellEffect__BorrowedTime(u, hu)
	endif
endfunction
function LearnSkill__BorrowedTime takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer h = GetHandleId(u)
	if (GetUnitAbilityLevel(u,'A0NS') == 1 or GetUnitAbilityLevel(u,'A1DA') == 1) and IsUnitIllusion(u) == false then
		call SaveBoolean( ExtraHT, h, HTKEY_HAS_BORROWEDTIME, true )
		call TriggerRegisterUnitEvent(UnitEventMainTrig, u, EVENT_UNIT_DAMAGED)
	endif
	set u = null
endfunction
function D7I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 5))
	local integer count =(LoadInteger(HY, h, 34))
	local real IXX =(level + 1)* 8
	local integer N5O = 10
	local unit TMX
	if GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
		if GetTriggerEvalCount(t)> 1 and GetSpellAbilityId()=='A0S1' and not UnitHasSpellShield(GetSpellTargetUnit()) and targetUnit == GetSpellTargetUnit() then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	elseif GetTriggerEventId() == EVENT_PLAYER_UNIT_SPELL_EFFECT then
		if FDX(GetSpellAbilityId()) and GetSpellTargetUnit() == targetUnit then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	elseif GetTriggerEventId() == EVENT_PLAYER_UNIT_DEATH then
		if IsUnitIllusion(GetTriggerUnit()) == false and GetUnitTypeId(GetTriggerUnit())!='u00S' then
			set TMX = GetKillingUnit()
			if OZX(TMX) then
				set TMX =(Player__Hero[GetPlayerId(GetOwningPlayer((TMX)))])
			endif
			if GetTriggerUnit() == targetUnit or TMX == targetUnit then
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
				call UnitRemoveAbility(targetUnit,'A1W2')
				call UnitRemoveAbility(targetUnit,'B0DO')
			endif
		endif
	else
		set count = count + 1
		call SaveInteger(HY, h, 34,(count))
		if GetUnitAbilityLevel(targetUnit,'A1W2') == 0 or count == N5O then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call UnitRemoveAbility(targetUnit,'A1W2')
			call UnitRemoveAbility(targetUnit,'B0DO')
		endif
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, IXX)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set TMX = null
	return false
endfunction
function D8I takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A0S1')
	local real IXX
	local real N5O
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Demon\\ReviveDemon\\ReviveDemon.mdl", targetUnit, "overhead"))
	call UnitAddPermanentAbility(targetUnit,'A1W2')
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function D7I))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY, h, 34, 0)
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function D9I takes nothing returns nothing
	if GetUnitAbilityLevel(GetEnumUnit(),'B0DO')> 0 then
		set Q2 = Q2 + 1
	endif
endfunction
function FVI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local group g = AllocationGroup(301)
	set U2 = whichUnit
	set Q2 = 0
	call GroupEnumUnitsInRange(g, 0, 0, 9999, Condition(function DHX))
	call ForGroup(g, function D9I)
	call DeallocateGroup(g)
	if Q2 == 0 then
		if GetUnitAbilityLevel(whichUnit,'B0EZ')> 0 then
			call UnitRemoveAbility(whichUnit,'A2AO')
			call UnitRemoveAbility(whichUnit,'B0EZ')
		endif
	elseif GetUnitAbilityLevel(whichUnit,'A2AO')!= Q2 then
		call UnitAddPermanentAbility(whichUnit,'A2AO')
		if UnitAlive(whichUnit) then	// 修复死亡时改变光环等级导致崩溃
			call SetUnitAbilityLevel(whichUnit,'A2AO', Q2)
		endif
	endif
	set t = null
	set whichUnit = null
	set g = null
	return false
endfunction
function LSE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function FVI))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	set t = null
	set whichUnit = null
endfunction
function XUE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call D8I()
	endif
endfunction
function FEI takes nothing returns boolean
	return DHX() and RFX(GetFilterUnit()) == false
endfunction
function FXI takes integer h, integer FOI returns nothing
	local integer i = 1
	loop
	exitwhen i > FOI
		call DestroyEffect((LoadEffectHandle(HY, h,( 2700+ i))))
		set i = i + 1
	endloop
endfunction
function FRI takes nothing returns nothing
	call UnitWakeUp(GetEnumUnit())
	call IssueTargetOrderById(GetEnumUnit(), 851983, K1V)
endfunction
function FII takes nothing returns nothing
	call UnitRemoveAbility(GetEnumUnit(),'C003')
endfunction
function FAI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local group g =(LoadGroupHandle(HY, h, 220))
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local integer FOI =(LoadInteger(HY, h, 365))
	local integer level =(LoadInteger(HY, h, 5))
	local integer count =(LoadInteger(HY, h, 34))
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		set count = count + 1
		if GetTriggerEventId() == EVENT_WIDGET_DEATH then
			set count = 9999
		endif
		call SaveInteger(HY, h, 34,(count))
		if count >=(5 + 2.5 * level) then
			call UnitReduceStateBonus(trigUnit, 30, UNIT_BONUS_ARMOR)
			call UnitRemoveAbility(trigUnit,'A0I5')
			call ForGroup(g, function FII)
			call DeallocateGroup(g)
			call FXI(h, FOI)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			call DisableTrigger(t)
			set K1V = trigUnit
			call ForGroup(g, function FRI)
			call EnableTrigger(t)
		endif
	else
		if IsUnitInGroup(GetTriggerUnit(), g) and UnitIsSleeping(GetTriggerUnit()) == false and GetIssuedOrderId()!= 851973 and K0V == false then
			call DisableTrigger(t)
			call IssueTargetOrderById(GetTriggerUnit(), 851983, trigUnit)
			call EnableTrigger(t)
		endif
	endif
	set t = null
	set g = null
	set trigUnit = null
	return false
endfunction
function FNI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetUnitAbilityLevel(u,'C003') == 2 then
	elseif GetUnitAbilityLevel(u,'C003') == 0 then
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	endif
	set u = null
	set t = null
endfunction
function FBI takes nothing returns nothing
	local unit u = GetEnumUnit()
	set Q2 = Q2 + 1
	call UnitAddAbilityToTimed(u,'C003', 1, GetUnitAbilityLevel(GetTriggerUnit(),'A0I6')* .5 + 1,'D003')
	call SaveEffectHandle(HY,(WK),( 2700+ Q2),(AddSpecialEffectTarget("Abilities\\Weapons\\LavaSpawnMissile\\LavaSpawnBirthMissile.mdl", u, "chest")))
	set u = null
endfunction
function XWE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(trigUnit,'A0I6')
	local group g = AllocationGroup(302)
	set U2 = trigUnit
	set K1V = trigUnit
	set Q2 = 0
	set WK = h
	call UnitAddStateBonus(trigUnit, 30, UNIT_BONUS_ARMOR)
	call UnitAddAbilityLevel1ToTimed(trigUnit,'C004','D004', level * .5 + 1)
	call GroupEnumUnitsInRange(g, GetUnitX(trigUnit), GetUnitY(trigUnit), 325, Condition(function FEI))
	call ForGroup(g, function FBI)
	call ForGroup(g, function FRI)
	call SaveInteger(HY, h, 365,(Q2))
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call SaveGroupHandle(HY, h, 220,(g))
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY, h, 34, 0)
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerRegisterDeathEvent(t, trigUnit)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call TriggerAddCondition(t, Condition(function FAI))
	set t = null
	set g = null
	set trigUnit = null
endfunction
function FCI takes nothing returns boolean
	return((IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and((GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0) and(IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false) and UnitIsDead(GetFilterUnit()) == false)))
endfunction
function FDI takes unit trigUnit returns nothing
	local group g = AllocationGroup(303)
	local unit u
	//local unit d = I_X(trigUnit)
	local integer level = GetUnitAbilityLevel(trigUnit,'P327')
	local real damageValue = level * 35 + 65
	set U2 = trigUnit
	if IsUnitIllusion(trigUnit) == false then
		call YDWESetUnitAbilityState(trigUnit,'QP17', 1, 0.51 - level * 0.05)
	endif
	call GroupEnumUnitsInRange(g, GetUnitX(trigUnit), GetUnitY(trigUnit), 300, Condition(function FCI))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", u, "origin"))
		call UnitDamageTargetEx(trigUnit, u, 2, damageValue)
		call GroupRemoveUnit(g, u)
	endloop
	if (GetUnitTypeId(trigUnit)!='Nbbc' and GetUnitTypeId(trigUnit)!='Opgh') then
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\SpinFX3.mdx", trigUnit, "origin"))
	else
		call SetUnitAnimation(trigUnit, "spin")
	endif
	set u = null
	call BAX(trigUnit, .6)
	call EPX(trigUnit, 4267, .5 -0.05 * level)
	call DeallocateGroup(g)
endfunction
function FFI takes unit R8X, unit targetUnit returns nothing
	if GetUnitAbilityLevel(targetUnit,'B03P')> 0 and IsUnitType(R8X, UNIT_TYPE_STRUCTURE) == false and(IsUnitType(R8X, UNIT_TYPE_MECHANICAL) == false and GetUnitAbilityLevel(R8X,'A04R') == 0 or IsFortDefenseTypeUnit(R8X)) and IsUnitEnemy(R8X, GetOwningPlayer(targetUnit)) and LoadInteger(HY, GetHandleId(targetUnit), 4267)!= 1 and GetUnitAbilityLevel(targetUnit,'A1HX') == 0 and GetUnitAbilityLevel(targetUnit,'A36D') == 0 and TKV(targetUnit,'B03P', 20) then
		call FDI(targetUnit)
	endif
endfunction
function FGI takes nothing returns nothing
	call UnitAddAbilityToTimed(GetEnumUnit(),'A2IB', 1, XK[0],'B0FV')
endfunction
function FHI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit trigUnit = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	local real D0I = GetWidgetLife(targetUnit)
	local integer FJI = LoadInteger(HY, h, 1)
	local integer level = LoadInteger(HY, h, 0)
	local unit dummyCaster
	local boolean FKI = LoadBoolean(HY, h, 0)
	local group g
	local real WOV = 999
	if FKI then
		if level == 1 then
			set WOV = 300
		elseif level == 2 then
			set WOV = 450
		else
			set WOV = 625
		endif
		set XK[0]= 10
	else
		set WOV = 150+ 100 * level
		set XK[0]= 6
	endif
	if (D0I <= WOV) then
		call PlaySoundOnUnitBJ(K0, 100, targetUnit)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile.mdl", targetUnit, "overhead"))
		set dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'e00E', 0, 0, 0)
		if IsUnitType(targetUnit, UNIT_TYPE_SUMMONED) == false then
			call UnitRemoveBuffs(targetUnit, true, true)
		endif
		call UnitRemoveAbility(targetUnit,'Aetl')
		call UnitDamageTargetEx(dummyCaster, targetUnit, 4, 100000000)
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\AxeUltiMSFX_01.mdx", trigUnit, "origin"))
		set g = AllocationGroup(304)
		set U2 = trigUnit
		call GroupEnumUnitsInRange(g, GetUnitX(trigUnit), GetUnitY(trigUnit), 925, Condition(function B7O))
		call ForGroup(g, function FGI)
		call DeallocateGroup(g)
		if IsUnitType(targetUnit, UNIT_TYPE_HERO) and IsUnitType(trigUnit, UNIT_TYPE_HERO) then
			//call LFX(trigUnit, FJI, true, 100) //直接刷新技能 需要用reset
			call Japi_ResetUnitAbilityCoolDownActions(trigUnit, FJI)
		endif
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set trigUnit = null
	set targetUnit = null
	set dummyCaster = null
	set t = null
endfunction
function X_E takes nothing returns nothing
	local timer t
	local integer h
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		call SaveInteger(HY, h, 0, GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
		call SaveInteger(HY, h, 1, GetSpellAbilityId())
		if GetSpellAbilityId()=='A1MR' then
			call SaveBoolean(HY, h, 0, true)
		endif
		call TimerStart(t, 0, false, function FHI)
		set t = null
	endif
endfunction
function FLI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	local integer i
	set i = GetUnitAbilityLevel(u,'A0GK')
	if IsUnitType(u, UNIT_TYPE_HERO) == false then
		if HaveSavedHandle(HY, GetHandleId(u), 0) then
			set u = LoadUnitHandle(HY, GetHandleId(u), 0)
		endif
	endif
	call UnitDamageTargetEx(u, targetUnit, 3, 20 + 70 * i)
	if GetWidgetLife(u)> 1 then
		call SetWidgetLife(u, GetWidgetLife(u)+ 20 + 70 * i)
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set targetUnit = null
	set u = null
	set t = null
endfunction
function FAE takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		call TimerStart(t, 0, false, function FLI)
	else
		call DestroyTimer(t)
	endif
	set t = null
endfunction
function FMI takes nothing returns boolean
	local trigger FPI = GetTriggeringTrigger()
	local integer h = GetHandleId(FPI)
	local integer level =(LoadInteger(HY,(h), 30))
	local unit R3O = LoadUnitHandle(HY, h, 30)
	local unit R4O =(LoadUnitHandle(HY,(h), 2))
	local player FQI =(LoadPlayerHandle(HY,(h), 54))
	local integer FSI =(LoadInteger(HY,(h), 5))
	local unit FTI
	local boolean b = GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED
	if GetUnitAbilityLevel(R3O,'B02F') == 0 then
		call SetPlayerAbilityAvailable(GetOwningPlayer(R3O),'A04Y', true)
		call SetPlayerAbilityAvailable(GetOwningPlayer(R3O),'A2O9', false)
		call UnitRemoveAbility(R3O,'A37S')
		call UnitRemoveAbility(R3O,'A3C9')
		call UnitAddAbilityToTimed(R3O,'A3CA', 1, 1,'A3CA')
		if HaveSavedHandle(HY, GetHandleId(R3O),'VisD') then
			call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A37S')
			call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A3C9')
			call UnitAddAbilityToTimed(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A3CA', 1, 1,'A3CA')
		endif
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(FPI)
	elseif b == false and GetTriggerUnit() == R3O then
		call SetPlayerAbilityAvailable(GetOwningPlayer(R3O),'A04Y', true)
		call SetPlayerAbilityAvailable(GetOwningPlayer(R3O),'A2O9', false)
		call UnitRemoveAbility(R3O,'B02F')
		set FTI = CreateUnit(FQI,'e00E', GetUnitX(R3O), GetUnitY(R3O), 0)
		call UnitAddPermanentAbility(FTI,'A04Y')
		call UnitRemoveAbility(R3O,'A37S')
		call UnitRemoveAbility(R3O,'A3C9')
		call UnitAddAbilityToTimed(R3O,'A3CA', 1, 1,'A3CA')
		if HaveSavedHandle(HY, GetHandleId(R3O),'VisD') then
			call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A37S')
			call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A3C9')
			call UnitAddAbilityToTimed(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A3CA', 1, 1,'A3CA')
		endif
		call SetUnitAbilityLevel(FTI,'A04Y', FSI)
		call IssueTargetOrderById(FTI, 852227, GetAttacker())
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(FPI)
	elseif b then
		call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 1)
		if LoadInteger(HY, h, 0) == 9 then
			call UnitRemoveAbility(R3O,'A3C9')
			if HaveSavedHandle(HY, GetHandleId(R3O),'VisD') then
				call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A3C9')
			endif
		endif
		if ModuloInteger(LoadInteger(HY, h, 0), 10) == 0 then
			if GetUnitState(R3O, UNIT_STATE_LIFE)> 21 then
				call SetUnitState(R3O, UNIT_STATE_LIFE, GetUnitState(R3O, UNIT_STATE_LIFE)-20)
			else
				call SetPlayerAbilityAvailable(GetOwningPlayer(R3O),'A04Y', true)
				call SetPlayerAbilityAvailable(GetOwningPlayer(R3O),'A2O9', false)
				call UnitRemoveAbility(R3O,'B02F')
				call UnitRemoveAbility(R3O,'A37S')
				call UnitRemoveAbility(R3O,'A3C9')
				if HaveSavedHandle(HY, GetHandleId(R3O),'VisD') then
					call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A37S')
					call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A3C9')
					call UnitAddAbilityToTimed(R3O,'A3CA', 1, 1,'A3CA')
				endif
				call UnitAddAbilityToTimed(R3O,'A3CA', 1, 1,'A3CA')
				call UnitDamageTargetEx(R4O, R3O, 1, 50)
				call FlushChildHashtable(HY,(h))
				call CleanCurrentTrigger(FPI)
			endif
		endif
	endif
	set FPI = null
	set FQI = null
	set FTI = null
	set R3O = null
	set R4O = null
	return false
endfunction
function FUI takes unit R3O, unit R4O returns nothing
	local trigger FPI = CreateTrigger()
	local integer Y6R = GetHandleId(FPI)
	set Y6R = GetHandleId(FPI)
	call SaveUnitHandle(HY,(Y6R), 30,((R4O)))
	call SaveUnitHandle(HY,(Y6R), 2,(R3O))
	call SavePlayerHandle(HY,(Y6R), 54,(GetOwningPlayer(R3O)))
	call SaveInteger(HY,(Y6R), 5,(GetUnitAbilityLevel(R3O,'A04Y')))
	call TriggerRegisterPlayerUnitEventBJ(FPI, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterTimerEvent(FPI, .1, true)
	call TriggerAddCondition(FPI, Condition(function FMI))
	if GetUnitAbilityLevel(R4O,'A04Y')> 0 then
		call SetPlayerAbilityAvailable(GetOwningPlayer(R4O),'A04Y', false)
		call UnitAddPermanentAbility(R4O,'A2O9')
		call SetPlayerAbilityAvailable(GetOwningPlayer(R4O),'A2O9', true)
	endif
	call UnitAddAbility(R4O,'A37S')
	call UnitAddAbility(R4O,'A3C9')
	if HaveSavedHandle(HY, GetHandleId(R4O),'VisD') then
		call UnitAddAbility(LoadUnitHandle(HY, GetHandleId(R4O),'VisD'),'A37S')
		call UnitAddAbility(LoadUnitHandle(HY, GetHandleId(R4O),'VisD'),'A3C9')
	endif
	set DMV = true
	call UnitDamageTargetEx(R3O, R4O, 2, 0)
	set DMV = false
	set FPI = null
endfunction
function FWI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call FUI(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function X1E takes nothing returns nothing
	local timer t
	local integer h
	if IsUnitMessenger(GetSpellTargetUnit()) == false and not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, 0, false, function FWI)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		set t = null
	endif
endfunction
function J4E takes nothing returns boolean
	if IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) then
		if GetOwningPlayer(GetTriggerUnit())!= GetOwningPlayer(GetSpellTargetUnit()) and IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) and(LoadBoolean(HY, GetHandleId(GetOwningPlayer(GetSpellTargetUnit())), 139)) then
			call EXStopUnit(GetTriggerUnit())
			call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n038'))
		endif
	endif
	return false
endfunction
function FYI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(ObjectHashTable, GetHandleId(t), 0)
	call UnitRemoveAbility(u,'B02F')
	call UnitRemoveAbility(u,'A2O9')
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A04Y', true)
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set u = null
endfunction
function FZI takes nothing returns boolean
	local timer t = null
	local unit u = GetTriggerUnit()
	if GetIssuedOrderId() == 852589and GetUnitAbilityLevel(u,'A2O9')> 0 then
		set t = CreateTimer()
		call TimerStart(t, 0, false, function FYI)
		call SaveUnitHandle(ObjectHashTable, GetHandleId(t), 0, u)
		set t = null
	endif
	set u = null
	return false
endfunction
function M4X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call TriggerAddCondition(t, Condition(function FZI))
	set t = null
endfunction
function F_I takes unit R8X, unit targetUnit returns nothing
	local unit u
	if LoadBoolean(ObjectHashTable, GetHandleId(targetUnit),'Grip') then
		if IsUnitEnemy(R8X, GetOwningPlayer(targetUnit)) then
			set u = CreateUnit(GetOwningPlayer(R8X),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
			call UnitAddPermanentAbility(u,'A04Y')
			call SetUnitAbilityLevel(u,'A04Y', 2)
			call IssueTargetOrderById(u, 852227, R8X)
			set u = null
		endif
	endif
endfunction
function F0I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real W5R
	local integer count = 6
	local fogmodifier fm =(LoadFogModifierHandle(HY, h, 42))
	if GetUnitAbilityLevel(whichUnit,'A1D9')> 0 then
		set count = 8
	endif
	if GetTriggerEventId() == EVENT_UNIT_SPELL_ENDCAST then
		call FogModifierStop(fm)
		call DestroyFogModifier(fm)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SaveBoolean(ObjectHashTable, GetHandleId(whichUnit),'Grip', false)
		call FIX(targetUnit)
	elseif GetTriggerEvalCount(t)> count or(GetTriggerEvalCount(t) == 1 and GetUnitAbilityLevel(targetUnit,'A3E9') == 1) then
		call FogModifierStop(fm)
		call DestroyFogModifier(fm)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call EXStopUnit(whichUnit)
		call SaveBoolean(ObjectHashTable, GetHandleId(whichUnit),'Grip', false)
		call FIX(targetUnit)
	else
		if GetUnitAbilityLevel(whichUnit,'A1D9')> 0 then
			set W5R = RMinBJ(.1 * GetUnitState(targetUnit, UNIT_STATE_MAX_MANA), GetUnitState(targetUnit, UNIT_STATE_MANA))
		else
			set W5R = RMinBJ(.05 * GetUnitState(targetUnit, UNIT_STATE_MAX_MANA), GetUnitState(targetUnit, UNIT_STATE_MANA))
		endif
		if W5R > 0 then
			call SetUnitState(whichUnit, UNIT_STATE_MANA, GetUnitState(whichUnit, UNIT_STATE_MANA)+ W5R)
			call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)-W5R)
		endif
		if UnitIsDead(targetUnit) == false and GetUnitAbilityLevel(targetUnit,'Bdet') == 0 then
			call FAX(whichUnit, targetUnit)
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set fm = null
	return false
endfunction
function F1I takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local fogmodifier ff = CreateFogModifierRadius(GetOwningPlayer(whichUnit), FOG_OF_WAR_VISIBLE, GetUnitX(targetUnit), GetUnitY(targetUnit), 350, true, true)
	call FogModifierStart(ff)
	call UnitRemoveAbility(targetUnit,'B02F')
	call UnitRemoveAbility(targetUnit,'BUsp')
	call UnitRemoveAbility(targetUnit,'Bust')
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterTimerEvent(t, .1, false)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function F0I))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveFogModifierHandle(HY, h, 42, ff)
	call SaveBoolean(ObjectHashTable, GetHandleId(whichUnit),'Grip', GetUnitAbilityLevel(whichUnit,'A1D9')> 0)
	call FAX(whichUnit, targetUnit)
	set whichUnit = null
	set targetUnit = null
	set t = null
	set ff = null
endfunction
function X2E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call F1I()
	endif
endfunction
function F2I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	call UnitAddStateBonus(u, LoadInteger(ObjectHashTable, WFV, 0), UNIT_BONUS_ATTACK)
	call RemoveSavedHandle(ObjectHashTable, GetHandleId(u),'A04V')
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set u = null
endfunction
function F3I takes unit u returns nothing
	local unit d = GetTriggerUnit()
	local timer t = LoadTimerHandle(ObjectHashTable, GetHandleId(u),'A04V')
	local integer WFV = GetHandleId(t)
	local integer O3O = 30 * GetUnitAbilityLevel(d,'A04V')
	if t == null or GetUnitAbilityLevel(u,'D018') == 0 or GetUnitTypeId(d)=='e00E' then
		set t = CreateTimer()
		set WFV = GetHandleId(t)
		call SaveTimerHandle(ObjectHashTable, GetHandleId(u),'A04V', t)
		call SaveUnitHandle(ObjectHashTable, WFV, 0, u)
	else
		call UnitAddStateBonus(u, LoadInteger(ObjectHashTable, WFV, 0), UNIT_BONUS_ATTACK)
	endif
	call SaveInteger(ObjectHashTable, WFV, 0, O3O)
	call TimerStart(t, 20, false, function F2I)
	call UnitReduceStateBonus(u, O3O, UNIT_BONUS_ATTACK)
	call UnitAddAbilityLevel1ToTimed(u,'C018','D018', 20)
	set d = null
	set t = null
endfunction
function YNV takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call F3I(GetSpellTargetUnit())
	endif
endfunction
function F4I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer count =(LoadInteger(HY,(GetHandleId(targetUnit)), 281))
	local boolean F5I =(LoadBoolean(HY, h, 280))
	local real damageValue = 0.5
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call SetUnitTurnSpeed(targetUnit, GetUnitDefaultTurnSpeed(targetUnit))
		call SaveInteger(HY,(GetHandleId(targetUnit)), 281, 0)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call FNX(targetUnit, 0, 0)
	elseif count == 0 then
		call SetUnitTurnSpeed(targetUnit, GetUnitDefaultTurnSpeed(targetUnit))
		call SaveInteger(HY,(GetHandleId(targetUnit)), 281, 0)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_UNIT_DAMAGED and F5I == false then
		if count > 0 and GetUnitAbilityLevel(GetEventDamageSource(),'A1EL')> 0 and whichUnit == GetEventDamageSource() and FK then
			call SaveBoolean(HY, h, 280,(true))
			set damageValue =(3 + 5 * GetUnitAbilityLevel(whichUnit,'A1EL'))* count
			if LEV then
				set damageValue = damageValue * 0.5
			endif
			if IsHeroUnitId(GetUnitTypeId(targetUnit)) then
				set damageValue = damageValue * 1
			endif
			if GetEventDamage()> 10 or LEV then
				call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\LordofFlameMissile\\LordofFlameMissile.mdl", targetUnit, "chest"))
				call UnitDamageTargetEx(whichUnit, targetUnit, 1, damageValue)
			endif
			call SaveBoolean(HY, h, 280,(false))
		endif
	else
		call SetUnitTurnSpeed(targetUnit, GetUnitDefaultTurnSpeed(targetUnit)* .3)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function F6I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real IWO =(LoadReal(HY,(GetHandleId(targetUnit)), 675))
	local integer StickyCount =(LoadInteger(HY,(GetHandleId(targetUnit)), 281))
	if (GetGameTime())-IWO >= 8 then
		call SetUnitTurnSpeed(targetUnit, GetUnitDefaultTurnSpeed(targetUnit))
		call SaveInteger(HY,(GetHandleId(targetUnit)), 281, 0)
		call FNX(targetUnit, 0, 0)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function F7I takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetEnumUnit()
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(whichUnit,'A1EL')
	local integer count = IMinBJ((LoadInteger(HY,(GetHandleId(targetUnit)), 281))+ 1, 10)
	if IsUnitMagicImmune(targetUnit) then
		set whichUnit = null
		set targetUnit = null
		return
	endif
	call FNX(targetUnit, level, count)
	call SaveInteger(HY,(GetHandleId(targetUnit)), 281,(count))
	call SaveReal(HY,(GetHandleId(targetUnit)), 675,(((GetGameTime()))* 1.))
	call SetUnitTurnSpeed(targetUnit, GetUnitDefaultTurnSpeed(targetUnit)* .3)
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		call AYX(GetOwningPlayer(whichUnit), I2S(count)+ "!", 2, targetUnit, .026, 50, 0, 255, 216)
	endif
	if count == 1 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(whichUnit))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SaveBoolean(HY, h, 280,(false))
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function F4I))
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 8, false)
	call TriggerAddCondition(t, Condition(function F6I))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function X4E takes nothing returns nothing
	local group g = AllocationGroup(305)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit whichUnit = GetTriggerUnit()
	local string s = "Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodGargoyle.mdl"
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, x, y, 400, Condition(function DHX))
	call ForGroup(g, function F7I)
	call A8X(GetOwningPlayer(whichUnit), 2, x, y, 500)
	call DestroyEffect(AddSpecialEffect(s, x, y))
	call DestroyEffect(AddSpecialEffect(s, x, y + 130))
	call DestroyEffect(AddSpecialEffect(s, x, y  -130))
	call DestroyEffect(AddSpecialEffect(s, x + 130, y))
	call DestroyEffect(AddSpecialEffect(s, x + 130, y + 130))
	call DestroyEffect(AddSpecialEffect(s, x + 130, y  -130))
	call DestroyEffect(AddSpecialEffect(s, x  -130, y))
	call DestroyEffect(AddSpecialEffect(s, x  -130, y + 130))
	call DestroyEffect(AddSpecialEffect(s, x  -130, y  -130))
	call DeallocateGroup(g)
	set whichUnit = null
endfunction
function PTX takes nothing returns nothing
	local integer i
	set K2V[1]='A1XC'
	set K2V[2]='A1XB'
	set K2V[3]='A1X4'
	set K2V[4]='A1X5'
	set K2V[5]='A1X6'
	set K2V[6]='A1X7'
	set K2V[7]='A1XA'
	set K2V[8]='A1X8'
	set K2V[9]='A1X9'
	set K2V[10]='A1XD'
	set K3V[1]='A1XM'
	set K3V[2]='A1XE'
	set K3V[3]='A1XF'
	set K3V[4]='A1XG'
	set K3V[5]='A1XH'
	set K3V[6]='A1XI'
	set K3V[7]='A1XJ'
	set K3V[8]='A1XK'
	set K3V[9]='A1XN'
	set K3V[10]='A1XL'
	set K4V[1]='A1XO'
	set K4V[2]='A1XV'
	set K4V[3]='A1XW'
	set K4V[4]='A1XQ'
	set K4V[5]='A1XR'
	set K4V[6]='A1XS'
	set K4V[7]='A1XX'
	set K4V[8]='A1XT'
	set K4V[9]='A1XU'
	set K4V[10]='A1XP'
	set K5V[1]='A1XY'
	set K5V[2]='A1XZ'
	set K5V[3]='A1Y5'
	set K5V[4]='A1Y6'
	set K5V[5]='A1Y7'
	set K5V[6]='A1Y1'
	set K5V[7]='A1Y2'
	set K5V[8]='A1Y3'
	set K5V[9]='A1Y4'
	set K5V[10]='A1Y0'
	set i = 1
	loop
	exitwhen i > 10
		call AddAbilityIDToPreloadQueue(K2V[i])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > 10
		call AddAbilityIDToPreloadQueue(K3V[i])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > 10
		call AddAbilityIDToPreloadQueue(K4V[i])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > 10
		call AddAbilityIDToPreloadQueue(K5V[i])
		set i = i + 1
	endloop
endfunction
function F8I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real a =(LoadReal(HY, h, 137))
	local real d =(LoadReal(HY, h, 138))
	local real x1 =(LoadReal(HY, h, 6))
	local real y1 =(LoadReal(HY, h, 7))
	local real x2
	local real y2
	local real x
	local real y
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetTriggerEvalCount(t)> 10 then
		call KillTreeByCircle(GetUnitX(targetUnit), GetUnitY(targetUnit), 200)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set x2 = x1 + d * Cos(a)
		set y2 = y1 + d * Sin(a)
		if (IsPointInRegion(TerrainCliffRegion,((x2)* 1.),((y2)* 1.))) == false then
			call SaveReal(HY, h, 6,((x2)* 1.))
			call SaveReal(HY, h, 7,((y2)* 1.))
			set x = x2
			set y = y2
		else
			set x = x1
			set y = y1
		endif
		if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
			call SetUnitPosition(targetUnit, x, y)
		else
			call SetUnitX(targetUnit, x)
			call SetUnitY(targetUnit, y)
		endif
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function F9I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer c = LoadInteger(HY, h, 0)
	local unit u = LoadUnitHandle(HY, h, 1)
	if c == 1 or UnitIsDead(u) or GetUnitAbilityLevel(u,'A37T') == 0 then
		if GetUnitAbilityLevel(u,'A37T')!= 0 then
			call UnitDamageTargetEx(LoadUnitHandle(HY, h, 0), u, 1, LoadReal(HY, h, 0))
		endif
		call UnitRemoveAbility(u,'A37T')
		call UnitRemoveAbility(u,'B37T')
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	else
		call UnitDamageTargetEx(LoadUnitHandle(HY, h, 0), u, 1, LoadReal(HY, h, 0))
		call SaveInteger(HY, h, 0, c -1)
	endif
	set t = null
	set u = null
endfunction
function GVI takes unit whichUnit, unit targetUnit returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, whichUnit)
	call SaveUnitHandle(HY, h, 1, targetUnit)
	call SaveInteger(HY, h, 0, K7V + 2)
	call UnitAddPermanentAbility(targetUnit,'A37T')
	call SaveReal(HY, h, 0, K7V * 5 + 20)
	call TimerStart(t, 1, true, function F9I)
	set t = null
endfunction
function GEI takes nothing returns nothing
	local unit whichUnit = K6V
	local unit targetUnit = GetEnumUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function F8I))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveReal(HY, h, 137,((Atan2(GetUnitY(targetUnit)-K9V, GetUnitX(targetUnit)-K8V))* 1.))
	call SaveReal(HY, h, 138,((RMaxBJ((400 -GetDistanceBetween(K8V, K9V, GetUnitX(targetUnit), GetUnitY(targetUnit))), 10)/  10)* 1.))
	call SaveReal(HY, h, 6,((GetUnitX(targetUnit))* 1.))
	call SaveReal(HY, h, 7,((GetUnitY(targetUnit))* 1.))
	call GVI(whichUnit, targetUnit)
	set whichUnit = null
	set targetUnit = null
	set t = null
	call UnitDamageTargetEx(K6V, GetEnumUnit(), 1, 20 + K7V * 40)
endfunction
function GXI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local real a =(LoadReal(HY, h, 137))
	local group g
	local unit targetUnit
	local real x = GetUnitX(dummyCaster)
	local real y = GetUnitY(dummyCaster)
	local real GOI =(LoadReal(HY, h, 6))
	local real GRI =(LoadReal(HY, h, 7))
	set x = CoordinateX50(x + 36 * Cos(a))
	set y = CoordinateY50(y + 36 * Sin(a))
	call SetUnitX(dummyCaster, x)
	call SetUnitY(dummyCaster, y)
	set U2 = dummyCaster
	if GetDistanceBetween(x, y, GOI, GRI)< 40 or GetTriggerEvalCount(t)> 100  then
		set targetUnit = null
		set x = GOI
		set y = GRI
		set K6V = whichUnit
		set K7V =(LoadInteger(HY, h, 5))
		set K8V = x
		set K9V = y
		set g = AllocationGroup(306)
		set U2 = whichUnit
		call GroupEnumUnitsInRange(g, x, y, 400, Condition(function DPX))
		call ForGroup(g, function GEI)
		call KillUnit(dummyCaster)
		call DeallocateGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	set dummyCaster = null
	set whichUnit = null
	set g = null
	return false
endfunction
function X5E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = Atan2(y -GetUnitY(whichUnit), x -GetUnitX(whichUnit))
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(whichUnit,'A19V')
	local unit dummyCaster
	set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'h0ED', GetUnitX(whichUnit), GetUnitY(whichUnit), a * bj_RADTODEG)
	call SaveReal(HY, h, 137,((a)* 1.))
	call SaveInteger(HY, h, 5,(level))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call TriggerRegisterTimerEvent(t, .04, true)
	call TriggerAddCondition(t, Condition(function GXI))
	set whichUnit = null
	set dummyCaster = null
	set t = null
endfunction
function GII takes nothing returns nothing
	local unit whichUnit = LVV
	local unit CSO = GetEnumUnit()
	local unit targetUnit
	local group g
	if GetUnitCurrentOrder(CSO) == 0 then
		set g = AllocationGroup(307)
		set U2 = CSO
		call GroupEnumUnitsInRange(g, GetUnitX(CSO), GetUnitY(CSO), 825, Condition(function DKX))
		set targetUnit = FirstOfGroup(g)
		if targetUnit != null then
			call GroupRemoveUnit(g, targetUnit)
		endif
		if FirstOfGroup(g) == null and targetUnit == whichUnit then
			call IssueTargetOrderById(CSO, 851983, targetUnit)
		endif
		call DeallocateGroup(g)
		set targetUnit = null
		set g = null
	endif
	set whichUnit = null
	set CSO = null
endfunction
function GAI takes unit whichUnit returns nothing
	local group g = AllocationGroup(308)
	set U2 = whichUnit
	set LVV = whichUnit
	call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 1000, Condition(function FRX))
	call ForGroup(g, function GII)
	call DeallocateGroup(g)
	set g = null
endfunction
function GNI takes nothing returns nothing
	call UnitDamageTargetEx(LVV, GetEnumUnit(), 1, LXV)
endfunction
function GBI takes unit whichUnit, integer h, integer count, integer level returns nothing
	local group g1 = AllocationGroup(309)
	local group g2 = AllocationGroup(310)
	local integer i = 0
	set U2 = whichUnit
	loop
	exitwhen i > count
		call GroupEnumUnitsInRange(g2, LoadReal(HY, h, 2300+ i), LoadReal(HY, h, 2500+ i), 225, Condition(function DKX))
		call GroupAddGroup(g2, g1)
		call GroupClear(g2)
		set i = i + 1
	endloop
	call DeallocateGroup(g2)
	if FirstOfGroup(g1)!= null then
		set LVV = whichUnit
		set LXV = level * 10-5
		call ForGroup(g1, function GNI)
	endif
	call DeallocateGroup(g1)
	set g1 = null
	set g2 = null
endfunction
function GCI takes nothing returns boolean
	local unit whichUnit = null
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer count = LoadInteger(HY, h, 34)
	local integer i
	local real x
	local real y
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEvalCount(t)> 360 then
		set i = 0
		loop
		exitwhen i > count
			call DestroyEffect(LoadEffectHandle(HY, h, 2700+ i))
			set i = i + 1
		endloop
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set t = null
		return false
	endif
	set whichUnit = LoadUnitHandle(HY, h, 2)
	set x = GetWidgetX(whichUnit)
	set y = GetWidgetY(whichUnit)
	if IsGameHaveObserver then
		call GAI(whichUnit)
	endif
	if GetDistanceBetween(x, y, LoadReal(HY, h, 23), LoadReal(HY, h, 24))> 125 then
		set count = count + 1
		call SaveInteger(HY, h, 34, count)
		call SaveReal(HY, h, 23, x * 1.)
		call SaveReal(HY, h, 24, y * 1.)
		call SaveEffectHandle(HY, h, 2700+ count, AddSpecialEffect("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl", x, y))
		call SaveReal(HY, h, 2300+ count, x * 1.)
		call SaveReal(HY, h, 2500+ count, y * 1.)
	endif
	if ModuloInteger(GetTriggerEvalCount(t), 10) == 0 then
		set LEV = true
		call GBI(whichUnit, h, count, level)
		set LEV = false
	endif
	if UnitIsDead(whichUnit) == false then
		call KillTreeByCircle(x, y, 100)
	endif
	set whichUnit = null
	set t = null
	return false
endfunction
function GDI takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x = GetWidgetX(whichUnit)
	local real y = GetWidgetY(whichUnit)
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function GCI))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveEffectHandle(HY, h, 2700, AddSpecialEffect("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl", x, y))
	call SaveReal(HY, h, 23, x * 1.)
	call SaveReal(HY, h, 24, y * 1.)
	call SaveReal(HY, h, 2300, x * 1.)
	call SaveReal(HY, h, 2500, y * 1.)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	set whichUnit = null
	set t = null
endfunction
function GFI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	call SetTerrainPathable(x, y, PATHING_TYPE_WALKABILITY, false)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function GGI takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	call SetTerrainPathable(x, y, PATHING_TYPE_WALKABILITY, true)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function GFI))
	call SaveReal(HY, h, 6, x * 1.)
	call SaveReal(HY, h, 7, y * 1.)
	set whichUnit = null
	set t = null
endfunction
function X7E takes nothing returns nothing
	if GetUnitTypeId(GetTriggerUnit())!='O017' then
		call GDI()
		if (GetRandomInt(1, 10) == 1) then
			call PlaySoundOnUnitBJ(B1, 100, GetTriggerUnit())
		endif
	elseif IsTerrainPathable(GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), PATHING_TYPE_WALKABILITY) then
		call GGI()
	endif
endfunction
function GHI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local unit dummyCaster = LoadUnitHandle(HY, h, 19)
	local real d = GetDistanceBetween(GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitX(targetUnit), GetUnitY(targetUnit))
	local real a
	local real N5O = LoadReal(HY, h, 57)
	local real x0 = LoadReal(HY, h, 282)
	local real y0 = LoadReal(HY, h, 283)
	local real x1
	local real y1
	local boolean MDR = LoadBoolean(HY, h, 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetTriggerEvalCount(t)> R2I(20 * N5O) then
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(dummyCaster)
		call SetUnitPathing(targetUnit, true)
		call KillTreeByCircle(GetUnitX(targetUnit), GetUnitY(targetUnit), 175)
		if MDR == false then
			call UnitRemoveAbility(whichUnit,'Abun')
		endif
	else
		call SetUnitX(dummyCaster, GetUnitX(whichUnit))
		call SetUnitY(dummyCaster, GetUnitY(whichUnit))
		if MDR and ModuloInteger(GetTriggerEvalCount(t), 20) == 0 then
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl", targetUnit, "chest"))
			call UnitDamageTargetEx(whichUnit, targetUnit, 1, 50 + 25 * LoadInteger(HY, h, 0))
		endif
		if GetDistanceBetween(x0, y0, GetUnitX(whichUnit), GetUnitY(whichUnit))> 400 then
			call DestroyEffect(LoadEffectHandle(HY, h, 32))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call KillUnit(dummyCaster)
			call SetUnitPathing(targetUnit, true)
			call KillTreeByCircle(GetUnitX(targetUnit), GetUnitY(targetUnit), 175)
			if MDR == false then
				call UnitRemoveAbility(whichUnit,'Abun')
			endif
		else
			call SaveReal(HY, h, 282, GetUnitX(whichUnit)* 1.)
			call SaveReal(HY, h, 283, GetUnitY(whichUnit)* 1.)
			if d > 300 then
				set a = Atan2(GetUnitY(targetUnit)-GetUnitY(whichUnit), GetUnitX(targetUnit)-GetUnitX(whichUnit))
				set x1 = GetUnitX(whichUnit)+ 300 * Cos(a)
				set y1 = GetUnitY(whichUnit)+ 300 * Sin(a)
				if (IsPointInRegion(TerrainCliffRegion, x1 * 1., y1 * 1.)) == false then
					call SetUnitX(targetUnit, x1)
					call SetUnitY(targetUnit, y1)
				endif
			endif
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set dummyCaster = null
	return false
endfunction
function GJI takes unit whichUnit, unit targetUnit returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'u00Y', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	local integer level = GetUnitAbilityLevel(whichUnit,'A19O')+ GetUnitAbilityLevel(whichUnit,'A1MV')
	local boolean MDR = GetUnitAbilityLevel(whichUnit,'A1MV')> 0
	if IsUnitType(whichUnit, UNIT_TYPE_HERO) == false then
		if HaveSavedHandle(HY, GetHandleId(whichUnit), 0) then
			set whichUnit = LoadUnitHandle(HY, GetHandleId(whichUnit), 0)
		endif
	endif
	if MDR == false then
		call UnitAddPermanentAbility(whichUnit,'Abun')
	endif
	call SaveBoolean(HY, h, 0, MDR)
	call SaveInteger(HY, h, 0, level)
	call UnitAddPermanentAbility(dummyCaster,'A19N')
	call SetUnitAbilityLevel(dummyCaster,'A19N', level)
	call IssueTargetOrderById(dummyCaster, 852480, targetUnit)
	call SetUnitPathing(dummyCaster, false)
	call SetUnitPathing(targetUnit, false)
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function GHI))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveUnitHandle(HY, h, 19, dummyCaster)
	call SaveReal(HY, h, 57,(2.5 + level * .5)* 1.)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("Abilities\\Spells\\Human\\AerialShackles\\AerialShacklesTarget.mdl", targetUnit, "chest"))
	call SaveReal(HY, h, 282, GetUnitX(whichUnit)* 1.)
	call SaveReal(HY, h, 283, GetUnitY(whichUnit)* 1.)
	set t = null
	set dummyCaster = null
endfunction
function GKI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call GJI(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function X8E takes nothing returns nothing
	local timer t = null
	local integer h
	if not UnitHasSpellShield(GetSpellTargetUnit()) and GetUnitTypeId(GetSpellTargetUnit())!='n00L' then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		call TimerStart(t, 0, false, function GKI)
		set t = null
	endif
endfunction
function GLI takes unit whichUnit, unit targetUnit, real J0R returns nothing
	call SetWidgetLife(whichUnit, GetWidgetLife(whichUnit)+ GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)* J0R)
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HeroBloodElfBlood.mdl", whichUnit, "overhead"))
endfunction
function GMI takes nothing returns boolean
	if UnitIsDead(GetFilterUnit()) == false and GetUnitAbilityLevel(GetFilterUnit(),'A0LE')> 0 and IsUnitEnemy(LOV, GetOwningPlayer(GetFilterUnit())) then
		call GLI(GetFilterUnit(), LOV, GetUnitAbilityLevel(GetFilterUnit(),'A0LE')* .1 * .5)
	endif
	return false
endfunction
function GPI takes unit whichUnit, unit targetUnit, integer level returns nothing
	local group g = AllocationGroup(311)
	set LOV = targetUnit
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 350, Condition(function GMI))
	call DeallocateGroup(g)
	set LOV = null
	set g = null
endfunction
function GQI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	local boolean GSI = LoadBoolean(HY, h, 0)
	local integer GTI = level * 10
	local integer GUI = level * 5
	if GSI then
		set GTI = GTI * 2
		set GUI = GUI * 2
	endif
	call UnitReduceStateBonus(u, GTI, UNIT_BONUS_ATTACK)
	call UnitReduceStateBonus(u, GUI, UNIT_BONUS_DAMAGE)
	call UnitRemoveAbility(u,'A33M')
	call UnitRemoveAbility(u,'B0GY')
	call SaveBoolean(ObjectHashTable, GetHandleId(u),'A0LE', false)
	call RemoveSavedHandle(ObjectHashTable, GetHandleId(u),'A0LE')
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set u = null
	set t = null
endfunction
function GWI takes unit u, integer level, boolean GSI returns nothing
	local integer GYI
	local timer t
	local real r
	local integer h = GetHandleId(u)
	local boolean b = LoadBoolean(ObjectHashTable, h,'A0LE')
	local integer GZI
	local integer G_I
	local real WLV = 5
	local integer G0I = 1
	if GSI then
		set WLV = 20
		set G0I = 2
	endif
	if b then
		set t = LoadTimerHandle(ObjectHashTable, h,'A0LE')
		set GYI = LoadInteger(HY, GetHandleId(t), 0)
		set GZI = GYI * 10
		set G_I = GYI * 5
		if LoadBoolean(HY, GetHandleId(t), 0) then
			set GZI = GZI * 2
			set G_I = G_I * 2
		endif
		if TimerGetRemaining(t)< WLV or GZI < level * 10* G0I then
			call TimerStart(t, WLV, false, function GQI)
			if GZI < level * 10* G0I then
				call UnitAddStateBonus(u, level * 10* G0I -GZI, UNIT_BONUS_ATTACK)
				call UnitAddStateBonus(u, level * 5 * G0I -G_I, UNIT_BONUS_DAMAGE)
				call SaveInteger(HY, GetHandleId(t), 0, level)
				call SaveBoolean(HY, GetHandleId(t), 0, GSI)
			endif
		endif
	else
		call SaveBoolean(ObjectHashTable, h,'A0LE', true)
		set t = CreateTimer()
		call TimerStart(t, WLV, false, function GQI)
		call SaveBoolean(HY, GetHandleId(t), 0, GSI)
		call SaveInteger(HY, GetHandleId(t), 0, level)
		call SaveUnitHandle(HY, GetHandleId(t), 0, u)
		call SaveTimerHandle(ObjectHashTable, h,'A0LE', t)
		call UnitAddStateBonus(u, level * 10* G0I, UNIT_BONUS_ATTACK)
		call UnitAddStateBonus(u, level * 5 * G0I, UNIT_BONUS_DAMAGE)
		call UnitAddPermanentAbility(u,'A33M')
	endif
	set t = null
endfunction
function G1I takes unit whichUnit, unit targetUnit returns nothing
	local integer level
	local real ratio = 1.
	if GetUnitTypeId(whichUnit)=='e00E' or IsUnitType(whichUnit, UNIT_TYPE_HERO) == false then
		set whichUnit = Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))]
	endif
	set level = GetUnitAbilityLevel(whichUnit,'A0LE')
	if IsUnitIllusion(targetUnit) == false and IsUnitType(targetUnit, UNIT_TYPE_STRUCTURE) == false and targetUnit != Roshan then
		if IsUnitType(whichUnit, UNIT_TYPE_MELEE_ATTACKER) == false then
			set ratio = .5
		endif
		if IsUnitType(targetUnit, UNIT_TYPE_HERO) == false then
			if level > 0 then
				call GWI(whichUnit, level, false)
				call GLI(whichUnit, targetUnit,(level * .05 + .05)* ratio)
			endif
		else
			if level > 0 then
				call GWI(whichUnit, level, true)
				call GLI(whichUnit, targetUnit, level * .1 * ratio)
			else
				call GPI(whichUnit, targetUnit, level)
			endif
		endif
	endif
endfunction
function G2I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 5))
	local real GXR =(LoadReal(HY, h, 23))
	local real GOR =(LoadReal(HY, h, 24))
	local real x = GetUnitX(targetUnit)
	local real y = GetUnitY(targetUnit)
	local real d = SquareRoot((GXR -x)*(GXR -x)+(GOR -y)*(GOR -y))
	local real damageValue = .2 * level * d
	local integer G3I =(LoadInteger(HY, h, 25))
	if d > 1300 then
		set damageValue = 0
	endif
	if damageValue > 5 then
		call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", targetUnit, "origin"))
	endif
	if damageValue > 0 and UnitIsDead(targetUnit) == false then
		call UnitDamageTargetEx(whichUnit, targetUnit, 7, damageValue)
	endif
	call SaveReal(HY, h, 23,((x)* 1.))
	call SaveReal(HY, h, 24,((y)* 1.))
	call SaveInteger(HY, h, 25,(G3I + 1))
	if UnitIsDead(targetUnit) then
		call UnitRemoveAbility(targetUnit,'A0IH')
		call UnitRemoveAbility(targetUnit,'B08L')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif G3I > 4 *(6 + level) then
		call UnitRemoveAbility(targetUnit,'A0IH')
		call UnitRemoveAbility(targetUnit,'B08L')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function G4I takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(whichUnit,'A0LH')
	call UnitAddPermanentAbility(targetUnit,'A0IH')
	call SetUnitAbilityLevel(targetUnit,'A0IH', level)
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", targetUnit, "chest"))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h, 23,((GetUnitX(targetUnit))* 1.))
	call SaveReal(HY, h, 24,((GetUnitY(targetUnit))* 1.))
	call SaveInteger(HY, h, 25, 0)
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerAddCondition(t, Condition(function G2I))
	call UnitDamageTargetEx(whichUnit, targetUnit, 6, 50 + 100 * level)
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function X9E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) and IsUnitMessenger(GetSpellTargetUnit()) == false then
		call G4I()
	endif
endfunction


function OVE takes nothing returns nothing
	local unit targetUnit
	local unit HNI
	if not UnitHasSpellShield(GetSpellTargetUnit()) or IsUnitAlly(GetSpellTargetUnit(), GetTriggerPlayer()) then
		set targetUnit = GetSpellTargetUnit()
		set HNI = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitAddAbility(HNI,'A2TN')
		call SaveUnitHandle(HY, GetHandleId(HNI), 0, GetTriggerUnit())
		call IssueTargetOrderById(HNI, 852111, targetUnit)
		call RemoveSavedHandle(HY, GetHandleId(HNI), 0)
	endif
	set targetUnit = null
	set HNI = null
endfunction
function JZE takes nothing returns nothing
	if GetSpellTargetUnit()!= GetTriggerUnit() and IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) and(LoadBoolean(HY, GetHandleId(GetOwningPlayer(GetSpellTargetUnit())), 139)) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n038'))
	endif
endfunction
function HBI takes nothing returns boolean
	return GetUnitTypeId(GetSummonedUnit())=='o003'
endfunction
function HCI takes nothing returns nothing
	local unit HDI = GetSummonedUnit()
	local unit HFI = Player__Hero[GetPlayerId(GetOwningPlayer(GetSummoningUnit()))]
	local integer h = GetHandleId(HFI)
	local integer level = GetUnitAbilityLevel(HFI,'Z234')
	local integer HGI =(LoadInteger(HY, h, 279))
	local unit HHI =(LoadUnitHandle(HY, h,( 1400+ 1)))
	local integer x = 1
	set HGI = HGI + 1
	call SetUnitVertexColorBJ(HDI, 100, 100, 100, 85)
	call UnitAddPermanentAbility(HDI,'Aloc')
	call SaveUnitHandle(HY, h,( 1400+ HGI),(HDI))
	if (HGI > level * 2) then
		call KillUnit(HHI)
		loop
		exitwhen x == HGI
			call SaveUnitHandle(HY, h,( 1400+ x),((LoadUnitHandle(HY, h,( 1400+ x + 1)))))
			set x = x + 1
		endloop
		set HGI = HGI -1
	endif
	call SaveInteger(HY, h, 279,(HGI))
	call SetUnitAbilityLevel(HDI,'A0BF', level)
	set HDI = null
	set HFI = null
	set HHI = null
endfunction
function OEE takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'o003', GetSpellTargetX(), GetSpellTargetY(), 0)
	local unit u = Player__Hero[GetPlayerId(GetOwningPlayer(d))]
	local integer h = GetHandleId(u)
	local integer lv = GetUnitAbilityLevel(u,'Z234')
	local integer maxi =(LoadInteger(HY, h, 279))
	local unit HHI =(LoadUnitHandle(HY, h,(1400 + 1)))
	local integer x = 1
	call SetUnitAnimation(d, "birth")
	call QueueUnitAnimation(d, "stand")
	set maxi = maxi + 1
	call SetUnitVertexColorBJ(d, 100, 100, 100, 85)
	call UnitAddPermanentAbility(d,'Aloc')
	call SaveUnitHandle(HY, h,(1400 + maxi),(d))
	if (maxi > lv * 2) then
		call KillUnit(HHI)
		loop
		exitwhen x == maxi
			call SaveUnitHandle(HY, h,(1400 + x),((LoadUnitHandle(HY, h,(1400 + x + 1)))))
			set x = x + 1
		endloop
		set maxi = maxi -1
	endif
	call SaveInteger(HY, h, 279,(maxi))
	call SetUnitAbilityLevel(d,'A0BF', lv)
	set d = null
	set u = null
	set HHI = null
endfunction
function M5X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function HBI))
	call TriggerAddAction(t, function HCI)
	set t = null
endfunction
function HJI takes nothing returns boolean
	return GetOwningPlayer(GetFilterUnit()) == GetOwningPlayer(XB) and(GetUnitAbilityLevel(GetFilterUnit(),'Aloc') == 0 and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0)
endfunction
function HKI takes nothing returns nothing
	local real x
	local real y
	local unit web
	local integer i = 1
	local unit u = GetEnumUnit()
	local boolean b = false
	if Player__Hero[GetPlayerId(GetOwningPlayer(u))] != null then
		loop
			set web = LoadUnitHandle(HY, GetHandleId(u), 1400 + i)
			if web != null then
				set x = GetUnitX(web)
				set y = GetUnitY(web)
				if (GetDistanceBetween(x, y, GetUnitX(u), GetUnitY(u))< 875) then
					set b = true
				endif
			else
				set i = 9
			endif
			set i = i + 1
		exitwhen i > 9 or b
		endloop
	endif
	if b == false then
		if IsUnitType(u, UNIT_TYPE_HERO) then
			call UnitRemoveAbility(u,'A021')
		else
			call UnitRemoveAbility(u,'A29C')
		endif
		call UnitRemoveAbility(u,'B01C')
		call SetUnitPathingEx(u, true)
	endif
	set web = null
	set u = null
endfunction
function HMI takes nothing returns nothing	//如果三秒内没被打则设置无视地形。
	local unit u = GetEnumUnit()
	if IsUnitType(u, UNIT_TYPE_HERO) then
		if GetUnitAbilityLevel(u,'A021') == 0 then
			call L6X(u)
			call UnitAddAbility(u,'A021')
		endif
	else
		if GetUnitAbilityLevel(u,'A29C') == 0 then
			call UnitAddAbility(u,'A29C')
		endif
	endif
	call SetUnitPathingEx(u, LoadReal(HY, GetHandleId(u), 785) + 3 > GetGameTime())
	set u = null
endfunction
function HPI takes nothing returns nothing//织网
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local group g
	local group gg = null
	local unit u
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		call DestroyGroup(LoadGroupHandle(HY, h, 1))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if LoadBoolean(HY, h, 0) == false then
			set g = CreateGroup()
			call SaveBoolean(HY, h, 0, true)
			call SaveGroupHandle(HY, h, 1, g)
		endif
		set u = LoadUnitHandle(HY, h, 0)
		set g = LoadGroupHandle(HY, h, 1)
		set gg = AllocationGroup(312)
		set XB = u
		call GroupEnumUnitsInRange(gg, GetUnitX(u), GetUnitY(u), 900, Condition(function HJI))
		call GroupRemoveGroup(gg, g)
		set XB = u
		call ForGroup(g, function HKI)
		call ForGroup(gg, function HMI)
		call GroupClear(g)
		call GroupAddGroup(gg, g)
		call DeallocateGroup(gg)
		set gg = null
	endif
	set t = null
	set g = null
	set u = null
endfunction
function HQI takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .3, true)
	call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function HPI))
	call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
	call SaveBoolean(HY, h, 0, false)
	set t = null
endfunction
function HSI takes nothing returns nothing
	if GetUnitTypeId(GetTriggerUnit())=='o003' then
		call HQI()
	endif
endfunction
// 蜘蛛网
function M6X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	call TriggerAddCondition(t, Condition(function HSI))
	set t = null
endfunction
function RQF takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 14))
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetUnitAbilityLevel(u,'A0WR') == 0 or GetTriggerEvalCount(t)>= 5 * 14 then
		if UnitAlive(u) then
			call UnitRemoveAbility(u,'A0WR')
			call UnitRemoveAbility(u,'B01E')
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	return false
endfunction
function Brood_Hungerold takes nothing returns nothing
endfunction
function HTI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY,(h), 14))
	local integer c = LoadInteger(HY, h, 1)+ 1
	if GetUnitAbilityLevel(u,'A0WR') == 0 or c > 5 * 14 or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call UnitReduceStateBonus(u, LoadInteger(HY, h, 0), UNIT_BONUS_DAMAGE)
		//if UnitAlive(u) then
		call UnitRemoveAbility(u,'A0WR')
		call UnitRemoveAbility(u,'B01E')
		//endif
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	else
		call SaveInteger(HY, h, 1, c)
	endif
	set t = null
	set u = null
	return false
endfunction
function OXE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local integer lv = GetUnitAbilityLevel(u,'A0WQ')
	local integer damageValue
	if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
		set damageValue = 60 + 20 * lv
	else
		set damageValue = 50 + 10 * lv
	endif
	call FlushChildHashtable(HY, h)
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function HTI))
	call SaveUnitHandle(HY,(h), 14,(u))
	call UnitAddPermanentAbility(u,'A0WR')
	call UnitMakeAbilityPermanent(u, true,'A0WW')
	call UnitMakeAbilityPermanent(u, true,'A340')
	call UnitAddStateBonus(u, damageValue, UNIT_BONUS_DAMAGE)
	call SaveInteger(HY, h, 0, damageValue)
	call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A0WR', false)
	
	set t = null
	set u = null
endfunction
function HUI takes unit R8X, unit targetUnit returns nothing
	call UnitAddAbilityToTimed(targetUnit,'A3PV'-1 + GetUnitAbilityLevel(R8X,'A0BK'), 1, 2,'B01D')
	call EnableAttackEffectByTime(9, 2.5)
endfunction
function HWI takes nothing returns nothing
	if (GetUnitAbilityLevel(DESource,'Q0BK')> 0) and GetUnitAbilityLevel(DESource,'A36D') == 0 and GetUnitAbilityLevel(DETarget,'A04R') == 0 then
		call HUI(DESource, DETarget)
	endif
endfunction

function HYI_Actions takes unit u, real damage returns nothing
	if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
		call SetWidgetLife(u, GetWidgetLife(u)+ damage *(GetUnitAbilityLevel(u,'A0WR')* .2 + .4))
	else
		call SetWidgetLife(u, GetWidgetLife(u)+ damage *(GetUnitAbilityLevel(u,'A0WR')* .1 + .4))
	endif
endfunction

function HYI takes nothing returns nothing
	if GetUnitAbilityLevel(DESource,'A340')> 0 and IsUnitIllusion(DETarget) == false and GetUnitAbilityLevel(DETarget,'A04R') == 0 then
		call HYI_Actions(DESource, DEDamage)
	endif
endfunction
function HZI takes nothing returns boolean
	local unit u = U2
	local unit target = MissileHitTargetUnit
	local integer level = GetUnitAbilityLevel(u,'A0BH')
	local boolean HGR = false
	if level == 0 then
		set level = GetUnitAbilityLevel(target,'A0BH')
		set HGR = true
	endif
	if level != 0 then
		call UnitAddAbilityToTimed(target,'A3B8', level, 2,'B3B8')
		call EUX(target,'A3B8', GetPlayerId(GetOwningPlayer(u)), 2)
		call UnitDamageTargetEx(u, target, 1, level * 75)
		if GetUnitAbilityLevel(target,'A3E9') == 1 and IsUnitType(u, UNIT_TYPE_HERO) and HGR == false and IsUnitMagicImmune(u) == false then
			if UnitHasSpellShield(u) == false then
				call T4V(target)
				call LaunchMissileByUnitDummy(target, u,'h07V', "HZI", 1200, true)
			else
				call UnitRemoveSpellShield(u)
			endif
		endif
	endif
	set u = null
	set target = null
	return false
endfunction
function H_I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call LaunchMissileByUnitDummy(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1),'h07V', "HZI", 1200, true)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function OOE takes nothing returns nothing
	local timer t = null
	local integer h
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		call TimerStart(t, 0, false, function H_I)
		set t = null
	endif
endfunction
function H0I takes unit u returns nothing
	local integer i = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A0A8')
	if i > 0 then
		if GetUnitTypeId(u)=='n019'then
			call UnitAddPermanentAbilitySetLevel(u,'A3IT', i)
			call UnitAddPermanentAbilitySetLevel(u,'A3IR', i)
		elseif i > 1 then
			call UnitAddPermanentAbilitySetLevel(u,'A3IS', i -1)
		endif
	endif
endfunction
function H1I takes nothing returns boolean
	local texttag tag
	local unit u
	local trigger trig = GetTriggeringTrigger()
	local integer WFV = GetHandleId(trig)
	local real i
	local real d
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED then
		call FlushChildHashtable(ObjectHashTable, WFV)
		call CleanCurrentTrigger(trig)
	elseif GetEventDamageSource() == LoadUnitHandle(ObjectHashTable, WFV, 0) then
		call DisableTrigger(trig)
		set tag = CreateTextTag()
		set d = LoadReal(ObjectHashTable, WFV, 1)
		set i = LoadReal(ObjectHashTable, WFV, 0)
		set u = LoadUnitHandle(ObjectHashTable, WFV, 2)
		if GetUnitAbilityLevel(u,'A3E9') == 1 and IsUnitMagicImmune(LoadUnitHandle(ObjectHashTable, WFV, 1)) == false and GetUnitAbilityLevel(LoadUnitHandle(ObjectHashTable, WFV, 1),'Aloc') == 0 then
			if LoadBoolean(ObjectHashTable, WFV, 0) == false then
				call SaveUnitHandle(OtherHashTable2,'A3E9', 0, u)
				call SaveUnitHandle(OtherHashTable2,'A3E9', 1, LoadUnitHandle(ObjectHashTable, WFV, 1))
				call SaveInteger(OtherHashTable2,'A3E9', 0, LoadInteger(ObjectHashTable, WFV, 1))
				call ExecuteFunc("H2III")
			endif
		endif
		call CommonUnitAddStun(u, i, false)
		call SetTextTagText(tag, "+" + I2S(R2I(d)), .025)
		call SetTextTagPosUnit(tag, u, 10)
		call SetTextTagColor(tag, 255, 0, 0, 255)
		call SetTextTagVelocity(tag, 0, .0355)
		call SetTextTagFadepoint(tag, 2)
		call SetTextTagPermanent(tag, false)
		call SetTextTagLifespan(tag, 2)
		call CommonTextTag(R2SW(i, 1, 1), i, u, .03, 127, 127, 255, 255)
		call UnitDamageTargetEx(LoadUnitHandle(ObjectHashTable, WFV, 1), u, 1, d)
		call FlushChildHashtable(ObjectHashTable, WFV)
		call CleanCurrentTrigger(trig)
		set tag = null
		set u = null
	endif
	set trig = null
	return false
endfunction
function H3I takes unit u, unit t, integer WUV, boolean H4I returns nothing
	local unit d = CreateUnit(GetOwningPlayer(t),'e00E', GetWidgetX(u), GetWidgetY(u), 0)
	local trigger trig = CreateTrigger()
	local integer WFV = GetHandleId(trig)
	local real GEX
	set GEX = GetRandomInt(25 + 50 * WUV, 100 + 50 * WUV)* 1. / 100.
	call SaveReal(ObjectHashTable, WFV, 1,(175 + 25 * WUV)* 1. -15.625 * R2I(RAbsBJ((25 + 50 * WUV)* 1. / 100. -GEX)* 10))
	call SaveUnitHandle(ObjectHashTable, WFV, 0, d)
	call SaveUnitHandle(ObjectHashTable, WFV, 1, u)
	call SaveUnitHandle(ObjectHashTable, WFV, 2, t)
	call SaveReal(ObjectHashTable, WFV, 0, GEX)
	call SaveInteger(ObjectHashTable, WFV, 1, WUV)
	call SaveBoolean(ObjectHashTable, WFV, 0, H4I)
	call TriggerRegisterTimerEvent(trig, 10, false)
	call TriggerRegisterUnitEvent(trig, t, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(trig, Condition(function H1I))
	call UnitAddAbility(d,'A04U')
	call IssueTargetOrderById(d, 852095, t)
	set trig = null
	set d = null
endfunction
function FTE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call H3I(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(),'A055')+ GetUnitAbilityLevel(GetTriggerUnit(),'QB00'), false)
	endif
endfunction
function H2III takes nothing returns nothing
	local unit targetUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 1)
	call T4V(LoadUnitHandle(OtherHashTable2,'A3E9', 0))
	if UnitHasSpellShield(targetUnit) == false then
		call H3I(LoadUnitHandle(OtherHashTable2,'A3E9', 0), targetUnit, LoadInteger(OtherHashTable2,'A3E9', 0), true)
	else
		call UnitRemoveSpellShield(targetUnit)
	endif
	set targetUnit = null
	call FlushChildHashtable(OtherHashTable2,'A3E9')
endfunction
function RAF takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction
function H6I takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit()) == GetUnitTypeId(LNV) and GetOwningPlayer(GetFilterUnit()) == GetOwningPlayer(LNV) and IsUnitIllusion(GetFilterUnit()) then
		call SetUnitX(GetFilterUnit(), LIV)
		call SetUnitY(GetFilterUnit(), LAV)
		call IssueTargetOrderById(GetFilterUnit(), 851983, LBV)
	endif
	return false
endfunction
function H7I takes unit whichUnit, unit targetUnit, integer level returns nothing
	local real sx = GetUnitX(whichUnit)
	local real sy = GetUnitY(whichUnit)
	local real tx = GetUnitX(targetUnit)
	local real ty = GetUnitY(targetUnit)
	local real a = AngleBetweenXY(sx, sy, tx, ty)
	local real GIX = GetDistanceBetween(sx, sy, tx, ty)
	local real d = GetRandomReal(GIX * .3, GIX * .8)
	local real targetX = sx + d * Cos(a * bj_DEGTORAD)
	local real targetY = sy + d * Sin(a * bj_DEGTORAD)
	local unit u = CreateUnit(GetOwningPlayer(whichUnit),'h06J', targetX, targetY, 0)
	local unit u2
	local group g
	local trigger t
	local integer h
	call SetUnitX(whichUnit, targetX)
	call SetUnitY(whichUnit, targetY)
	call SetUnitFacing(whichUnit,-a)
	call PlaySoundOnUnitBJ(OC, 100, targetUnit)
	if targetUnit != Roshan then
		call UnitAddAbilityToTimed(whichUnit,'A3K9', level, 1.2, 0)
		set targetX = sx +(d -25)* Cos(a * bj_DEGTORAD)
		set targetY = sy +(d -25)* Sin(a * bj_DEGTORAD)
		call EPX(targetUnit, 4405, 1)
		call SetUnitX(targetUnit, targetX)
		call SetUnitY(targetUnit, targetY)
		call SetUnitFacing(targetUnit, a)
		call IssueTargetOrderById(whichUnit, 851983, targetUnit)
		set g = AllocationGroup(313)
		set LIV = targetX
		set LAV = targetY
		set LNV = whichUnit
		set LBV = targetUnit
		call GroupEnumUnitsInRange(g, sx, sy, 1400, Condition(function H6I))
		call DeallocateGroup(g)
		call KillUnit(CreateUnit(GetOwningPlayer(whichUnit),'h06J', targetX, targetY, 0))
	endif
	call KillUnit(u)
	set whichUnit = null
	set targetUnit = null
	set u = null
	set u2 = null
	set g = null
endfunction
function H8I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	local integer level = GetUnitAbilityLevel(u,'A0RW')
	if GetUnitAbilityLevel(u,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(u), 0) then
		set u = LoadUnitHandle(HY, GetHandleId(u), 0)
	endif
	if UnitHasSpellShield(targetUnit) == false then
		call H7I(u, targetUnit, level)
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set targetUnit = null
	set u = null
endfunction
function ORE takes nothing returns nothing
	local timer t = null
	local integer h
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		call TimerStart(t, 0, false, function H8I)
		set t = null
	endif
endfunction
function H9I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	call UnitRemoveAbility(u,'A40D')
	if GetUnitAbilityLevel(u,'A40D') == 0 then
		call DestroyTimerAndFlushHT_HY(t)
		
	elseif LoadBoolean(HY, GetHandleId(t), 0) == false then
		call SaveBoolean(HY, GetHandleId(t), 0, true)
		call TimerStart(t, 1, true, function H9I)
	endif
	set u = null
	set t = null
endfunction
function Naga_MirrorImage takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local trigger trg
	if UnitHasSpellShield(u) then
		set trg = CreateTrigger()
		call SaveBoolean(HY, GetHandleId(u),  129, true)
		call TriggerRegisterTimerEvent(trg, .61, false)
		call TriggerAddCondition(trg, Condition(function F4O))
		call SaveUnitHandle(HY, GetHandleId(trg), 2, u)
		set trg = null
	endif
	set u = null
endfunction
function OIE takes nothing returns nothing
	local timer t
	local unit u = GetTriggerUnit()
	local trigger trg
	if UnitHasSpellShield(u) then
		set trg = CreateTrigger()
		call SaveBoolean(HY, GetHandleId(u),  129, true)
		call TriggerRegisterTimerEvent(trg, .81, false)
		call TriggerAddCondition(trg, Condition(function F4O))
		call SaveUnitHandle(HY, GetHandleId(trg), 2, u)
		set trg = null
	endif
	if GetRandomInt(0, 1) == 1 then
		set t = CreateTimer()
		call TimerStart(t, .51, false, function H9I)
		call UnitAddPermanentAbility(u,'A40D')
		call SaveUnitHandle(HY, GetHandleId(t), 0, u)
		set t = null
	endif
	set u = null
endfunction
function JVI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local unit u = CreateUnit(GetOwningPlayer(trigUnit),'h06J', GetUnitX(trigUnit), GetUnitY(trigUnit), 0)
	call PlaySoundOnUnitBJ(OC, 100, trigUnit)
	call KillUnit(u)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set u = null
	set t = null
	set trigUnit = null
	return false
endfunction
function K3E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerAddCondition(t, Condition(function JVI))
	call TriggerRegisterTimerEvent(t, .3, false)
	call SaveUnitHandle(HY, h, 14,(GetTriggerUnit()))
	set t = null
endfunction
function Q2E takes nothing returns nothing
	local integer level = GetUnitAbilityLevel(GetTriggerUnit(),'A303')
	if level == 1 then
		call UnitAddPermanentAbility(GetTriggerUnit(),'AHfa')
	endif
	call SetUnitAbilityLevel(GetTriggerUnit(),'AHfa', level)
endfunction
function JEI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local real hp = GetWidgetLife(whichUnit)
	local integer JXI = LoadInteger(HY, h, 10)
	local integer JOI = LoadInteger(HY, h, 11)
	call SaveInteger(HY, GetHandleId(whichUnit),'a272', LoadInteger(HY, GetHandleId(whichUnit),'a272')-JXI)
	call KVX(whichUnit)
	call UnitAddMaxLife(whichUnit,-1 * JOI)
	call SaveInteger(HY, GetHandleId(whichUnit),'h272', LoadInteger(HY, GetHandleId(whichUnit),'a272')-JOI)
	if LoadInteger(HY, GetHandleId(whichUnit),'a272') == 0 then
		call UnitRemoveAbility(whichUnit,'A1R0')
		call UnitRemoveAbility(whichUnit,'B0D5')
	endif
	call SetWidgetLife(whichUnit, hp)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction
function JRI takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(whichUnit,'A04Q')
	local real JII = GetWidgetLife(targetUnit)
	local real JAI = GetWidgetLife(whichUnit)
	local integer JXI = R2I((.035 + .015 * level)* JII)
	local integer JOI = R2I((.35 + .15 * level)* JII)
	call SaveInteger(HY, h, 10, JXI)
	call SaveInteger(HY, h, 11, JOI)
	call SaveInteger(HY, GetHandleId(whichUnit),'a272', LoadInteger(HY, GetHandleId(whichUnit),'a272')+ JXI)
	call KVX(whichUnit)
	call SaveInteger(HY, GetHandleId(whichUnit),'h272', LoadInteger(HY, GetHandleId(whichUnit),'h272')+ JOI)
	call UnitAddMaxLife(whichUnit, JOI)
	call UnitAddPermanentAbility(whichUnit,'A1R0')
	call SetWidgetLife(targetUnit, 1)
	call UnitDamageTargetEx(whichUnit, targetUnit, 2, 20)
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, 20)
	call UnitDamageTargetEx(whichUnit, targetUnit, 3, 20)
	call SetWidgetLife(whichUnit, JAI + JOI)
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", targetUnit, "chest"))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerRegisterTimerEvent(t, 35, false)
	call TriggerAddCondition(t, Condition(function JEI))
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function ONE takes nothing returns nothing
	if GetWidgetLife(GetTriggerUnit())> .5 and IsUnitMessenger(GetSpellTargetUnit()) == false then
		call JRI()
	endif
endfunction
function JNI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call L6X(LoadUnitHandle(HY, h, 0))
	call UZV(LoadUnitHandle(HY, h, 0),'I0TH')
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function Y6V takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
	call TimerStart(t, 0, false, function JNI)
	set t = null
endfunction
function JBI takes integer x returns boolean
	return x =='A3FJ' or x =='A06X' or x =='A0AQ' or x =='A14O' or x =='A0NE' or x =='A1C0' or x =='A0SB' or x =='A418'
endfunction
function JCI takes nothing returns boolean
	return GetUnitAbilityLevel(GetTriggerUnit(),'B06X')> 0 and JBI(GetSpellAbilityId()) == false and LNX(GetSpellAbilityId()) == false and X5R(GetSpellAbilityId()) == false and IsNotItemAbility(GetSpellAbilityId())
endfunction
function JDI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer level = LoadInteger(HY, h, 0)
	local unit u = LoadUnitHandle(HY, h, 0)
	if not Mode__RearmCombos and(GetUnitAbilityLevel(u,'A14O')> 0 or GetUnitAbilityLevel(u,'A3FJ')> 0) then
		call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+(.06 + .02 * level)* GetUnitState(u, UNIT_STATE_MAX_MANA))
	else
		call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+(.05 + .05 * level)* GetUnitState(u, UNIT_STATE_MAX_MANA))
	endif
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction
function JFI takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit u = GetTriggerUnit()
	local unit JGI =(LoadUnitHandle(HY, h, 254))
	local integer level = GetUnitAbilityLevel(JGI,'P347')
	local timer t
	if GetUnitAbilityLevel(JGI,'A36D') == 0 and GetUnitDistanceEx(u, JGI)< 1400 and TKV(u,'P347', 40) then
		set t = CreateTimer()
		call TimerStart(t, 0, false, function JDI)
		call SaveUnitHandle(HY, GetHandleId(t), 0, u)
		call SaveInteger(HY, GetHandleId(t), 0, level)
		set t = null
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCasterOverhead.mdl", u, "overhead"))
	endif
	set u = null
	set JGI = null
	set t = null
endfunction
function P5E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A0IF')
	local trigger t
	if (level == 1) then
		set t = CreateTrigger()
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
		call TriggerAddCondition(t, Condition(function JCI))
		call TriggerAddAction(t, function JFI)
		call SaveUnitHandle(HY, GetHandleId(t), 254, u)
	endif
	if (level == 1) then
		call UnitAddPermanentAbility(u,'A0OL')
	elseif (level == 2) then
		call UnitAddPermanentAbility(u,'A0OM')
	elseif (level == 3) then
		call UnitAddPermanentAbility(u,'A0ON')
	elseif (level == 4) then
		call UnitAddPermanentAbility(u,'A0OH')
	endif
	set u = null
	set t = null
endfunction
function JHI takes unit u, unit t, boolean b returns nothing
	local real d = .01 *(5 + GetUnitAbilityLevel(u,'A0OI'))*(GetUnitState(u, UNIT_STATE_MANA)+ 100 )
	call UnitRemoveAbility(t,'B06Y')
	if (IsUnitType(t, UNIT_TYPE_SUMMONED) or IsUnitIllusion(t)) and IsBearUnit(t) == false and CSX(t) == false then
		set d = d + 100 * GetUnitAbilityLevel(u,'A0OI')
	endif
	call CommonTextTag("+" + I2S(R2I(d)), 1, t, .023, 191, 64, 255, 216)
	call UnitDamageTargetEx(u, t, 3, d)
	if b == false and TKV(u,'P347', GetUnitAbilityLevel(u,'P347')* 10) then
		call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ .25 * GetUnitState(u, UNIT_STATE_MAX_MANA))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCasterOverhead.mdl", u, "overhead"))
	endif
endfunction
function JKI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer JLI =(LoadInteger(HY, h, 262))
	call SetHeroInt(targetUnit, GetHeroInt(targetUnit, false)+ JLI, true)
	call SetHeroInt(whichUnit, GetHeroInt(whichUnit, false)-JLI, true)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function K4E takes nothing returns nothing
	if IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) and(LoadBoolean(HY, GetHandleId(GetOwningPlayer(GetSpellTargetUnit())), 139)) and GetSpellTargetUnit()!= GetTriggerUnit() then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n038'))
	endif
endfunction
function JWI takes nothing returns nothing
	call UnitDamageTargetEx(LCV, GetEnumUnit(), 1, LDV)
endfunction
function JYI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local group g
	local integer count = LoadInteger(HY, h, 34)
	if count > 250 or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call WHV(targetUnit,'D001')
		call DestroyEffect((LoadEffectHandle(HY, h, 31)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_PLAYER_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A0QG' and GetSpellTargetUnit() == targetUnit then
		call DestroyEffect((LoadEffectHandle(HY, h, 31)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if count == 1 then
			call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
		endif
		set count = count + 1
		call SaveInteger(HY, h, 34, count)
		set g = AllocationGroup(315)
		set U2 = whichUnit
		set LCV = whichUnit
		set LDV = 1. + 2. * LoadInteger(HY, h, 0)
		call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 275, Condition(function DJX))
		call GroupRemoveUnit(g, targetUnit)
		call ForGroup(g, function JWI)
		call DeallocateGroup(g)
		set targetUnit = null
	endif
	set t = null
	set whichUnit = null
	set g = null
	return false
endfunction
function ODE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call UnitAddAbilityLevel1ToTimed(targetUnit,'C001','D001', 0)
	call A5X(LC, GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit()))
	call SaveUnitHandle(HY, h, 2, u)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveEffectHandle(HY, h, 31, AddSpecialEffectTarget("war3mapImported\\NewSoulArmor.mdx", GetSpellTargetUnit(), "chest"))
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function JYI))
	set u = null
	set t = null
	set targetUnit = null
endfunction
function JZI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local integer level
	local unit whichUnit
	local unit targetUnit
	local real x1
	local real y1
	local real d
	local real a
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call SetUnitPathing(LoadUnitHandle(HY, h, 17), true)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set targetUnit =(LoadUnitHandle(HY, h, 17))
		set d =(LoadReal(HY, h, 138))
		set x =(LoadReal(HY, h, 6))
		set y =(LoadReal(HY, h, 7))
		set a =(LoadReal(HY, h, 137))
		set x1 = GetUnitX(targetUnit)+ d /  15* Cos(a)
		set y1 = GetUnitY(targetUnit)+ d /  15* Sin(a)
		if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
			call SaveBoolean(OtherHashTable, GetHandleId(targetUnit), 99, true)
			call SetUnitPosition(targetUnit, x1, y1)
		else
			call SetUnitX(targetUnit, x1)
			call SetUnitY(targetUnit, y1)
		endif
		if GetTriggerEvalCount(t)> 15 then
			set whichUnit =(LoadUnitHandle(HY, h, 2))
			set level =(LoadInteger(HY, h, 5))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call SetUnitPathing(targetUnit, true)
			call UnitDamageTargetEx(whichUnit, targetUnit, 1, level * 40)
			set whichUnit = null
		endif
		set targetUnit = null
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function J_I takes nothing returns nothing
	local trigger t = null
	local unit whichUnit = null
	local unit targetUnit = GetEnumUnit()
	local integer h
	if RFX(targetUnit) then
		set targetUnit = null
		return
	endif
	set t = CreateTrigger()
	set whichUnit = GetTriggerUnit()
	set h = GetHandleId(t)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function JZI))
	call SaveReal(HY, h, 6,((LFV)* 1.))
	call SaveReal(HY, h, 7,((LGV)* 1.))
	call SaveReal(HY, h, 138,((GetDistanceBetween(LFV, LGV, GetUnitX(targetUnit), GetUnitY(targetUnit)))* 1.))
	call SaveReal(HY, h, 137,((Atan2(LGV -GetUnitY(targetUnit), LFV -GetUnitX(targetUnit)))* 1.))
	call SaveInteger(HY, h, 5,(LHV))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SetUnitPathing(targetUnit, false)
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function OFE takes nothing returns nothing
	local group g = AllocationGroup(316)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local integer lv = GetUnitAbilityLevel(GetTriggerUnit(),'A0QE')
	local real r = 175 + 100 * lv
	set U2 = GetTriggerUnit()
	call A5X(CE, x, y)
	call DestroyEffect(AddSpecialEffect("war3mapImported\\Star Aura.mdx", x, y))
	call GroupEnumUnitsInRange(g, x, y, r, Condition(function DQX))
	set LFV = x
	set LGV = y
	set LHV = lv
	call ForGroup(g, function J_I)
	call KillTreeByCircle(x, y, 200)
	call DeallocateGroup(g)
	set g = null
endfunction
function K5E takes nothing returns nothing
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	if A4X(x, y) == false or(IsPointInRegion(TerrainCliffRegion,((x)* 1.),((y)* 1.))) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n03K'))
	endif
endfunction
function TFF takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	call UnitRemoveAbility(targetUnit,'B07W')
	call UnitRemoveAbility(targetUnit,'Bblo')
	call UnitRemoveAbility(targetUnit,'B062')
	call UnitRemoveAbility(targetUnit,'B065')
	call UnitRemoveAbility(targetUnit,'Bcrs')
	call UnitRemoveAbility(targetUnit,'B016')
	set t = null
	set targetUnit = null
	return false
endfunction
function OGE takes nothing returns nothing
	call UnitAddAbilityToTimed(GetSpellTargetUnit(),'A3KB', 1, 1.5 + 1.5 * GetUnitAbilityLevel(GetTriggerUnit(),'A0R7'),'B07W')
	call A5X(TD, GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit()))
endfunction
function J0I takes boolean KMR returns boolean
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit J1I = LoadUnitHandle(HY, h, 259)
	local unit targetUnit = GetTriggerUnit()
	local unit trigUnit = Player__Hero[GetPlayerId(GetOwningPlayer(J1I))]
	local integer level = LoadInteger(HY, h, 0)
	local integer J2I ='A3H3'
	local integer J3I = level
	if KMR then
		set J2I ='A3H4'
	endif
	call UnitAddAbility(J1I, J2I)
	call SetUnitAbilityLevel(J1I, J2I, J3I)
	set LJV = GetUnitX(targetUnit)
	set LKV = GetUnitY(targetUnit)
	set LLV = targetUnit
	call SaveUnitHandle(HY, GetHandleId(J1I),'0ILU', targetUnit)
	call U1V(J1I, 852274, targetUnit)
	call UnitDamageTargetEx(J1I, targetUnit, 1, 150)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl", GetUnitX(targetUnit), GetUnitY(targetUnit)))
	set J1I = null
	set targetUnit = null
	set trigUnit = null
	return false
endfunction
function J4I takes nothing returns boolean
	local group g
	if IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(LoadUnitHandle(HY, GetHandleId(GetTriggeringTrigger()), 259))) and(GetUnitTypeId(GetFilterUnit())!='H00J') then
		set g = LoadGroupHandle(HY, GetHandleId(GetTriggeringTrigger()), 257)
		if IsUnitInGroup(GetFilterUnit(), g) == false then
			call GroupAddUnit(g, GetFilterUnit())
			call J0I(false)
		endif
	endif
	set g = null
	return false
endfunction
function J5I takes nothing returns boolean
	local group g
	if IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(LoadUnitHandle(HY, GetHandleId(GetTriggeringTrigger()), 259))) and(GetUnitTypeId(GetFilterUnit())!='H00J') then
		set g = LoadGroupHandle(HY, GetHandleId(GetTriggeringTrigger()), 257)
		if IsUnitInGroup(GetFilterUnit(), g) == false then
			call GroupAddUnit(g, GetFilterUnit())
			call J0I(true)
		endif
	endif
	set g = null
	return false
endfunction
function J6I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call GroupRemoveUnit(LoadGroupHandle(HY, h, 257), LoadUnitHandle(HY, h, 261))
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
	call FlushChildHashtable(HY, h)
	call DisableTrigger(t)
	set t = null
	return false
endfunction
function J7I takes nothing returns boolean
	local unit J8I = GetSummoningUnit()
	local unit TJX = GetSummonedUnit()
	local integer h = GetHandleId(J8I)
	local integer J9I =(LoadInteger(HY, h, 260))
	local trigger t = CreateTrigger()
	call SetUnitVertexColor(TJX, 255, 255, 255, 100)
	call TriggerRegisterUnitEvent(t, TJX, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function J6I))
	call SaveGroupHandle(HY, GetHandleId(t), 257, LoadGroupHandle(HY, h, 257))
	call SaveUnitHandle(HY, GetHandleId(t), 261, LLV)
	set J9I = J9I + 1
	call SaveInteger(HY, h, 260, J9I)
	call SaveUnitHandle(HY, h, 2800 + J9I,(TJX))
	call SaveTriggerHandle(HY, h, 2900+ J9I, t)
	call SetUnitX(TJX, LJV)
	call SetUnitY(TJX, LKV)
	set J8I = null
	set TJX = null
	set t = null
	return false
endfunction
function KVI takes nothing returns nothing
	call RemoveUnit(GetEnumUnit())
endfunction
function KEI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local trigger t2 = LoadTriggerHandle(HY, h, 255)
	local integer h2 = GetHandleId(t2)
	local trigger t3 = LoadTriggerHandle(HY, h2, 256)
	local group g1 = LoadGroupHandle(HY, h2, 257)
	local group g2 = LoadGroupHandle(HY, h2, 258)
	local unit u2 = LoadUnitHandle(HY, h2, 259)
	local integer uh = GetHandleId(u2)
	local integer J9I = LoadInteger(HY, uh, 260)
	local integer i
	local unit u
	call ForGroup(g2, function KVI)
	set i = 1
	loop
	exitwhen i > J9I
		set u = LoadUnitHandle(HY, uh, 2800 + i)
		call FlushChildHashtable(HY, GetHandleId(LoadTriggerHandle(HY, uh, 2900+ i)))
		call CleanCurrentTrigger(LoadTriggerHandle(HY, uh, 2900+ i))
		if IsUnitIllusion(u) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl", GetUnitX(u), GetUnitY(u)))
			call RemoveUnit(u)
		endif
		set i = i + 1
	endloop
	call FlushChildHashtable(HY, h)
	call FlushChildHashtable(HY, h2)
	call FlushChildHashtable(HY, uh)
	call RemoveUnit(u2)
	call DeallocateGroup(g1)
	call DeallocateGroup(g2)
	call CleanCurrentTrigger(t2)
	call CleanCurrentTrigger(t3)
	call CleanCurrentTrigger(t)
	set t = null
	set t2 = null
	set t3 = null
	set g1 = null
	set g2 = null
	set u2 = null
	set u = null
	return false
endfunction
function OHE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real KXI = GetUnitFacing(trigUnit)-45
	local unit J8I = CreateUnit(GetOwningPlayer(trigUnit),'h00O', x, y, KXI)
	local unit u
	local real F4R
	local real F5R
	local integer i
	local real IMX
	local trigger t = CreateTrigger()
	local group g1 = AllocationGroup(317)
	local integer h = GetHandleId(t)
	local group g2 = AllocationGroup(318)
	local trigger KOI = t
	local integer level = GetUnitAbilityLevel(trigUnit,'A0QK')
	local boolean KMR = false
	if level == 0 then
		set KMR = true
		set level = GetUnitAbilityLevel(trigUnit,'A21Q')
	endif
	call SetUnitAbilityLevel(J8I,'A0QL', level)
	call A5X(DE, x, y)
	call SaveGroupHandle(HY, h, 257, g1)
	call SaveGroupHandle(HY, GetHandleId(J8I), 257, g1)
	call SaveGroupHandle(HY, h, 258, g2)
	call SaveUnitHandle(HY, h, 259, J8I)
	call SaveInteger(HY, GetHandleId(J8I), 260, 0)
	set i = 0
	loop
	exitwhen i > 39
		set F4R = x +(500 -25 * i)* Cos((KXI -45)* bj_DEGTORAD)
		set F5R = y +(500 -25 * i)* Sin((KXI -45)* bj_DEGTORAD)
		set u = CreateUnit(GetOwningPlayer(trigUnit),'h00P', F4R, F5R, KXI)
		call GroupAddUnit(g2, u)
		call TriggerRegisterUnitInRange(t, u, 17, null)
		set i = i + 1
	endloop
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(trigUnit, GetSpellAbilityId()))
	call SaveBoolean(HY, h, 0, KMR)
	if KMR then
		call TriggerAddCondition(t, Condition(function J5I))
	else
		call TriggerAddCondition(t, Condition(function J4I))
	endif
	set t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, J8I, EVENT_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function J7I))
	call SaveTriggerHandle(HY, h, 256, t)
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 45, false)
	call TriggerAddCondition(t, Condition(function KEI))
	call SaveTriggerHandle(HY, GetHandleId(t), 255, KOI)
	set trigUnit = null
	set u = null
	set t = null
	set KOI = null
	set g1 = null
	set g2 = null
	set J8I = null
endfunction
function KRI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	call UnitRemoveAbility(u,'A34E')
	call DestroyTimerAndFlushHT_HY(t)
	set t = null
	set u = null
endfunction
function KII takes unit u returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .3, false, function KRI)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	set t = null
endfunction
function KAI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	call UnitRemoveAbility(u,'A34F')
	call UnitRemoveAbility(u,'A40A')
	call DestroyTimerAndFlushHT_HY(t)
	set t = null
	set u = null
endfunction
function KNI takes unit u returns nothing
	local timer t = CreateTimer()
	if X4X(u) then
		call TimerStart(t, .2, false, function KAI)
	else
		call TimerStart(t, .3, false, function KAI)
	endif
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	set t = null
endfunction
function KBI takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	if GetTriggerEventId() == EVENT_UNIT_ATTACKED then
		call SaveReal(ObjectHashTable, GetHandleId(whichUnit),'LSTE', GetGameTime())
		call KII(whichUnit)
	else
		if IsAttackSpecialEffects(GetSpellAbilityId()) and GetSpellTargetUnit() == LoadUnitHandle(HY, GetHandleId(GetTriggeringTrigger()), 0) then
			call SaveReal(ObjectHashTable, GetHandleId(GetSpellTargetUnit()),'LSTE', GetGameTime())
			call KII(GetSpellTargetUnit())
		endif
	endif
	set whichUnit = null
endfunction
function KCI takes nothing returns nothing
	if GetAttacker() == LoadUnitHandle(HY, GetHandleId(GetTriggeringTrigger()), 0) and IsUnitEnemy(GetAttacker(), GetOwningPlayer(GetTriggerUnit())) then
		call SaveReal(ObjectHashTable, GetHandleId(GetAttacker()),'LSTC', GetGameTime())
		call KNI(GetAttacker())
	endif
endfunction
function KDI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	local integer hu = GetHandleId(u)
	local real currentTime = GetGameTime()
	if currentTime - LoadReal(ObjectHashTable, hu,'LSTC')>= 10 and GetUnitAbilityLevel(u,'A34F') == 0 then
		call UnitAddPermanentAbility(u,'A34F')
		call UnitAddPermanentAbility(u,'A40A')
	endif
	if currentTime - LoadReal(ObjectHashTable, hu,'LSTE')>= 10 and GetUnitAbilityLevel(u,'A34E') == 0 then
		call UnitAddPermanentAbility(u,'A34E')
	endif
	set t = null
	set u = null
endfunction
function LearnSkill__DrunkenBrawler takes nothing returns nothing
	local trigger t = CreateTrigger()
	local unit u = GetTriggerUnit()
	local timer tt = CreateTimer()
	call EnableAttackEffectByTime(1, 0)
	// 被攻击和 主动法球 - 闪避
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ATTACKED)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function KBI))
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	// 攻击 - 暴击
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerAddCondition(t, Condition(function KCI))
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call TimerStart(tt, 1, true, function KDI)
	call SaveUnitHandle(HY, GetHandleId(tt), 0, u)
	call SaveReal(ObjectHashTable, GetHandleId(u),'LSTC', GetGameTime())
	call SaveReal(ObjectHashTable, GetHandleId(u),'LSTE', GetGameTime())
	set tt = null
	set u = null
	set t = null
endfunction
function JOE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local group g = null
	local unit u2 = null
	local integer level = GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())-1 +'A3PR'
	if UnitHasSpellShield(targetUnit) then
		set whichUnit = null
		set targetUnit = null
		return
	endif
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\StrongDrink\\BrewmasterMissile.mdl", targetUnit, "origin"))
	set U2 = whichUnit
	set g = AllocationGroup(319)
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 225, Condition(function DJX))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call GroupRemoveUnit(g, u2)
		if IsHeroUnitId(GetUnitTypeId(u2)) then
			call UnitAddAbilityToTimed(u2, level, 1, 8.,'BNdh')
		else
			call UnitAddAbilityToTimed(u2, level, 1, 12.,'BNdh')
		endif
	endloop
	call DeallocateGroup(g)
	call EnableAttackEffectByTime(8, 13)
	set whichUnit = null
	set targetUnit = null
endfunction
function KFI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer str = LoadInteger(HY, h, 29)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		if (LoadBoolean(HY, h, 276)) == false and GetTriggerUnit()==(whichUnit) then
			call SaveBoolean(HY, h, 276, true)
			call SetHeroStr(whichUnit, GetHeroStr(whichUnit, false)-str, true)
			call SaveInteger(OtherHashTable, GetHandleId(whichUnit), 30, LoadInteger(OtherHashTable, GetHandleId(whichUnit), 30)-str)
		elseif (LoadBoolean(HY, h, 277)) == false and GetTriggerUnit() == targetUnit then
			call SaveBoolean(HY, h, 277, true)
			call SetHeroStr(targetUnit, GetHeroStr(targetUnit, false)+ str, true)
		endif
	else
		if (LoadBoolean(HY, h, 276)) == false then
			call SaveBoolean(HY, h, 276, true)
			call SetHeroStr(whichUnit, GetHeroStr(whichUnit, false)-str, true)
			call SaveInteger(OtherHashTable, GetHandleId(whichUnit), 30, LoadInteger(OtherHashTable, GetHandleId(whichUnit), 30)-str)
		endif
		if (LoadBoolean(HY, h, 277)) == false then
			call SaveBoolean(HY, h, 277, true)
			call SetHeroStr(targetUnit, GetHeroStr(targetUnit, false)+ str, true)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function KGI takes nothing returns nothing
	local unit whichUnit = LMV
	local unit targetUnit = GetEnumUnit()
	local integer KHI
	local integer level = LPV
	local trigger t
	local integer h
	local integer KJI = 4
	if GetUnitAbilityLevel(whichUnit,'A3JX')> 0 then
		set KJI = 8
	endif
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		set KHI = IMinBJ(GetHeroStr(targetUnit, false)-1, KJI)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SetHeroStr(whichUnit, GetHeroStr(whichUnit, false)+ KHI, true)
		call SaveInteger(OtherHashTable, GetHandleId(whichUnit), 30, LoadInteger(OtherHashTable, GetHandleId(whichUnit), 30)+ KHI)
		call SetHeroStr(targetUnit, GetHeroStr(targetUnit, false)-KHI, true)
		call TriggerRegisterTimerEvent(t, 30, false)
		call TriggerRegisterDeathEvent(t, whichUnit)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function KFI))
		call SaveBoolean(HY, h, 276,(false))
		call SaveBoolean(HY, h, 277,(false))
		call SaveUnitHandle(HY, h, 2,(whichUnit))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SaveInteger(HY, h, 29,(KHI))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", whichUnit, "origin"))
	endif
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, 40 * level -20)
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function OJE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local group g = AllocationGroup(320)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer lv = GetUnitAbilityLevel(u,'A15S')+ GetUnitAbilityLevel(u,'A3JX')
	local unit d = CreateUnit(GetOwningPlayer(u),'h07J', x, y, 0)
	call DestroyEffect(AddSpecialEffect("effects\\DecayGreen_Groundonly_1.mdx", x, y))
	if IsUnitType(u, UNIT_TYPE_HERO) == false then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
	set U2 = u
	set LMV = u
	set LPV = lv
	call GroupEnumUnitsInRange(g, x, y, 350, Condition(function DQX))
	call ForGroup(g, function KGI)
	call EPX(u,'AFRZ', .03)
	call DeallocateGroup(g)
	call KillUnit(d)
	set u = null
	set g = null
	set t = null
	set d = null
endfunction
function KKI takes nothing returns nothing
	if LTV <= 8 + LUV * 2 then
		set LTV = LTV + 1
		call GroupAddUnit(LQV, GetEnumUnit())
	endif
endfunction
function KLI takes unit u, unit t returns nothing
	call ALX("SPLK", GetUnitX(u), GetUnitY(u), GetUnitX(t), GetUnitY(t), .1, .6, .44, .9, .6)
endfunction
function KMI takes nothing returns nothing
	if RKX(LSV) then
		if LUV > 0 then
			set LUV = LUV -1
			call SetUnitState(LSV, UNIT_STATE_LIFE, GetUnitState(LSV, UNIT_STATE_LIFE)+ 1.)
			call KLI(GetEnumUnit(), LSV)
			if GetUnitTypeId(GetEnumUnit())!='n0F5' then
				call B5X(GetEnumUnit(), S2)
			endif
		endif
	else
		if GetUnitTypeId(GetEnumUnit())!='n0F5' then
			call B5X(GetEnumUnit(), 10 + 4 * LUV)
		endif
		call SetWidgetLife(LSV, GetWidgetLife(LSV)+ 10 + 4 * LUV)
		call KLI(GetEnumUnit(), LSV)
	endif
endfunction
function KPI takes nothing returns nothing
	if GetUnitTypeId(GetEnumUnit())!='n0F5' then
		call B5X(GetEnumUnit(), 10 + 4 * LUV)
	endif
	call KLI(GetEnumUnit(), LSV)
endfunction
function KQI takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local group g = AllocationGroup(321)
	local integer lv = GetUnitAbilityLevel(u,'A0R5')
	local integer c
	local unit t = GetSpellTargetUnit()
	if GetUnitTypeId(u)=='e00E' then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
	set LQV = AllocationGroup(322)
	set LTV = 0
	set LUV = lv
	set U2 = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 1325, Condition(function FOX))
	call GroupRemoveUnit(g, u)
	call GroupRemoveUnit(g, t)
	call ForGroup(g, function KKI)
	call DeallocateGroup(g)
	set g = LQV
	set LSV = t
	set LUV = lv
	if IsUnitAlly(t, GetOwningPlayer(u)) then
		call ForGroup(g, function KMI)
	else
		set c = CountUnitsInGroup(g)
		call ForGroup(g, function KPI)
		call UnitDamageTargetEx(u, t, 1,(10 + 4 * lv)* c)
	endif
	call DeallocateGroup(g)
	set u = null
	set g = null
	set t = null
endfunction
function OKE takes nothing returns nothing
	if (IsUnitType(GetSpellTargetUnit(), UNIT_TYPE_STRUCTURE) == false or GetOwningPlayer(GetSpellTargetUnit()) == GetOwningPlayer(GetTriggerUnit())) then
		call KQI()
	endif
endfunction
function KSI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local unit KTI =(LoadUnitHandle(HY, h, 269))
	if GetTriggerEventId() == EVENT_UNIT_DEATH or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if GetTriggerUnit() == targetUnit then
			call KillUnit(KTI)
		endif
	elseif IsGameEnd then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call PauseUnit(KTI, true)
	elseif GetTriggerEventId() == EVENT_UNIT_ISSUED_ORDER or GetTriggerEventId() == EVENT_UNIT_ISSUED_POINT_ORDER or GetTriggerEventId() == EVENT_UNIT_ISSUED_TARGET_ORDER then
		call DisableTrigger(t)
		call IssueTargetOrderById(KTI, 851983, targetUnit)
		call EnableTrigger(t)
	elseif (GetWidgetLife(targetUnit)<( 100 * LYV) or GetWidgetLife(targetUnit)/ GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)< LYV * .05 + .15) and GetUnitAbilityLevel(KTI,'B0AN') == 0 then
		call IssueTargetOrderById(LZV[GetPlayerId(GetOwningPlayer(KTI))], 852101, KTI)
	elseif UnitVisibleToPlayer(targetUnit, GetOwningPlayer(KTI)) == false then
		if (LoadBoolean(HY, h, 270)) then
			if (LoadBoolean(HY, h, 271)) then
				if (LoadBoolean(HY, h, 272)) then
					call FlushChildHashtable(HY, h)
					call CleanCurrentTrigger(t)
					call KillUnit(KTI)
				else
					call SaveBoolean(HY, h, 272,(true))
				endif
			else
				call SaveBoolean(HY, h, 271,(true))
			endif
		else
			call SaveBoolean(HY, h, 270,(true))
		endif
	else
		call SaveBoolean(HY, h, 270,(false))
		call SaveBoolean(HY, h, 271,(false))
		call SaveBoolean(HY, h, 272,(false))
	endif
	set t = null
	set targetUnit = null
	set KTI = null
	return false
endfunction
function KUI takes nothing returns boolean
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = GetEnumUnit()
	local unit KTI = CreateUnit(LWV,'n0F5', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call IssueTargetOrderById(KTI, 851983, targetUnit)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterUnitEvent(t, KTI, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, KTI, EVENT_UNIT_ISSUED_ORDER)
	call TriggerRegisterUnitEvent(t, KTI, EVENT_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterUnitEvent(t, KTI, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function KSI))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))
	call SaveUnitHandle(HY, h, 269,(KTI))
	call SaveInteger(HY, h, 5,(LYV))
	set t = null
	set targetUnit = null
	set KTI = null
	return false
endfunction
function KWI takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='n0F5' and GetWidgetLife(GetFilterUnit())> 1 then
		call KillUnit(GetFilterUnit())
	endif
	return false
endfunction
function KYI takes player p returns nothing
	local group g = AllocationGroup(323)
	call GroupEnumUnitsOfPlayer(g, p, Condition(function KWI))
	call DeallocateGroup(g)
	set g = null
endfunction
function KZI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit K_I =(LoadUnitHandle(HY, h, 266))
	local unit K0I =(LoadUnitHandle(HY, h, 267))
	local unit K1I =(LoadUnitHandle(HY, h, 268))
	local integer level =(LoadInteger(HY, h, 5))
	local group g
	local player XSR
	if IsSentinelPlayer(GetOwningPlayer(whichUnit)) then
		set XSR = ScourgePlayers[0]
	else
		set XSR = SentinelPlayers[0]
	endif
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		if (LoadBoolean(HY, h, 265)) then
			call A8X(XSR, .4, GetUnitX(whichUnit), GetUnitY(whichUnit), 600)
		endif
		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UDeathMedium\\UDeath.mdl", GetUnitX(whichUnit), GetUnitY(whichUnit)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call S9V(whichUnit, 2)
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\Darksummoning\\DarkSummonTarget.mdl", GetUnitX(K_I), GetUnitY(K_I)))
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\Darksummoning\\DarkSummonTarget.mdl", GetUnitX(K0I), GetUnitY(K0I)))
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\Darksummoning\\DarkSummonTarget.mdl", GetUnitX(K1I), GetUnitY(K1I)))
		call RemoveUnit(K_I)
		call RemoveUnit(K0I)
		call RemoveUnit(K1I)
		call KYI(GetOwningPlayer(whichUnit))
	else
		if UnitVisibleToPlayer(whichUnit, XSR) then
			call SaveBoolean(HY, h, 265,(true))
		endif
		set g = AllocationGroup(324)
		set U2 = whichUnit
		set LWV = GetOwningPlayer(whichUnit)
		set LYV = level
		call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 25 + 400 + 200* level, Condition(function DGX))
		if IsGameEnd == false then
			call ForGroup(g, function KUI)
		endif
		call DeallocateGroup(g)
		set g = null
	endif
	set t = null
	set whichUnit = null
	set K_I = null
	set K0I = null
	set K1I = null
	set XSR = null
	return false
endfunction
function K2I takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call RemoveSavedBoolean(HY, h, 0)
		call CleanCurrentTrigger(GetTriggeringTrigger())
	elseif IsUnitIdType(GetUnitTypeId(GetEventDamageSource()), UNIT_TYPE_HERO) == false or GetUnitAbilityLevel(GetEventDamageSource(),'A1W4')> 0 then
		if (GetUnitTypeId(GetEventDamageSource())=='n01G' or GetUnitAbilityLevel(GetEventDamageSource(),'A1W4')> 0) then
			if LoadBoolean(HY, h, 0) == false then
				call SaveBoolean(HY, h, 0, true)
				call UnitDamageTargetEx(GetEventDamageSource(), GetTriggerUnit(), 10, 1)
				call SaveBoolean(HY, h, 0, false)
			endif
		else
			call SetUnitToReduceDamage(GetTriggerUnit(), .5)
		endif
	endif
endfunction
function OME takes nothing returns nothing
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit K3I
	local real dx
	local real dy
	local real K4I
	local unit K5I
	local unit K6I
	local unit K7I
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(GetTriggerUnit(),'A15V')
	local integer id
	local real a
	local string s
	local string ss
	local integer i = 1
	local integer LAR = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))],'A0A8')
	if level == 1 then
		set K3I = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'n0FJ', x, y, 0)
	elseif level == 2 then
		set K3I = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'n0FI', x, y, 0)
	elseif level == 3 then
		set K3I = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'n0F6', x, y, 0)
	else
		set K3I = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'n0FH', x, y, 0)
	endif
	call SetUnitAnimation(K3I, "birth")
	if LAR > 0 then
		call UnitAddPermanentAbility(K3I,'A1AC')
	endif
	call A5X(MF, x, y)
	set id = GetPlayerId(GetOwningPlayer(K3I))
	if LZV[id]== null then
		set LZV[id]= CreateUnit(GetOwningPlayer(K3I),'e01V', x, y, 0)
		call UnitAddPermanentAbility(LZV[id],'A176')
	endif
	call SetUnitPosition(K3I, CoordinateX50(x), CoordinateY50(y))
	call UnitApplyTimedLife(K3I,'BTLF', 10+ 5 * level)
	call KillTreeByCircle(x, y, 300)
	set dx = x + 200* Cos(0 * bj_DEGTORAD)
	set dy = y + 200* Sin(0 * bj_DEGTORAD)
	set K4I = AngleBetweenXY(dx, dy, x, y)
	set K5I = CreateUnit(GetOwningPlayer(K3I),'h07H', dx, dy, K4I)
	set ss = "Stand Work Gold"
	call SetUnitAnimation(K5I, ss)
	set dx = x + 200* Cos( 120* bj_DEGTORAD)
	set dy = y + 200* Sin( 120* bj_DEGTORAD)
	set K4I = AngleBetweenXY(dx, dy, x, y)
	set K6I = CreateUnit(GetOwningPlayer(K3I),'h07H', dx, dy, K4I)
	call SetUnitAnimation(K6I, ss)
	set dx = x + 200* Cos( 240* bj_DEGTORAD)
	set dy = y + 200* Sin( 240* bj_DEGTORAD)
	set K4I = AngleBetweenXY(dx, dy, x, y)
	set K7I = CreateUnit(GetOwningPlayer(K3I),'h07H', dx, dy, K4I)
	call SetUnitAnimation(K7I, ss)
	set s = "Stand Work"
	call SetUnitAnimation(K3I, s)
	set i = 1
	loop
		call QueueUnitAnimation(K5I, ss)
		call QueueUnitAnimation(K6I, ss)
		call QueueUnitAnimation(K7I, ss)
		call QueueUnitAnimation(K3I, s)
		set i = i + 1
	exitwhen i > 17
	endloop
	call TriggerRegisterUnitEvent(t, K3I, EVENT_UNIT_DEATH)
	if LAR > 0 then
		call TriggerRegisterTimerEvent(t, 3.1 -0.4 * LAR, true)
	else
		call TriggerRegisterTimerEvent(t, 3, true)
	endif
	call TriggerAddCondition(t, Condition(function KZI))
	call SaveUnitHandle(HY, h, 2,(K3I))
	call SaveUnitHandle(HY, h, 266,(K5I))
	call SaveUnitHandle(HY, h, 267,(K6I))
	call SaveUnitHandle(HY, h, 268,(K7I))
	call SaveInteger(HY, h, 5,(level))
	call SaveBoolean(HY, h, 265,(false))
	call TriggerEvaluate(t)
	set t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, K3I, EVENT_UNIT_DAMAGED)
	call TriggerRegisterDeathEvent(t, K3I)
	call TriggerAddCondition(t, Condition(function K2I))
	set K3I = null
	set K5I = null
	set K6I = null
	set K7I = null
	set t = null
endfunction
function K8I takes unit whichUnit returns boolean
	return LoadInteger(OtherHashTable, GetHandleId(whichUnit),'AGH1')=='QM03' or LoadInteger(OtherHashTable, GetHandleId(whichUnit),'AGH2')=='QM03'
endfunction
function K9I takes nothing returns nothing
	if IsUnitType(U2, UNIT_TYPE_HERO) then
		if K8I(MissileHitTargetUnit) then
			call SetWidgetLife(MissileHitTargetUnit, GetWidgetLife(MissileHitTargetUnit)+ GetUnitState(MissileHitTargetUnit, UNIT_STATE_MAX_LIFE)* .1)
		else
			call SetWidgetLife(MissileHitTargetUnit, GetWidgetLife(MissileHitTargetUnit)+ GetUnitState(MissileHitTargetUnit, UNIT_STATE_MAX_LIFE)* .06)
		endif
	else
		if K8I(MissileHitTargetUnit) then
			call SetWidgetLife(MissileHitTargetUnit, GetWidgetLife(MissileHitTargetUnit)+ GetUnitState(MissileHitTargetUnit, UNIT_STATE_MAX_LIFE)* .03)
		else
			call SetWidgetLife(MissileHitTargetUnit, GetWidgetLife(MissileHitTargetUnit)+ GetUnitState(MissileHitTargetUnit, UNIT_STATE_MAX_LIFE)* .02)
		endif
	endif
endfunction
function LVI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	call SaveBoolean(ObjectHashTable, LoadInteger(ObjectHashTable, GetHandleId(t), 0),'QM03', false)
	call DestroyTimerAndFlushHT_P(t)
	set t = null
endfunction
function LEI takes unit u returns nothing
	local timer t = CreateTimer()
	local integer WFV = GetHandleId(u)
	call SaveBoolean(ObjectHashTable, WFV,'QM03', true)
	call SaveInteger(ObjectHashTable, GetHandleId(t), 0, WFV)
	call TimerStart(t, .25, false, function LVI)
	set t = null
endfunction
function LXI takes unit damageSource, group g returns nothing
	local group gg = AllocationGroup(325)
	local unit u
	local real LJR
	local real d
	local real a
	call GroupAddGroup(g, gg)
	loop
		set u = FirstOfGroup(gg)
	exitwhen u == null
		set LJR = LoadReal(HY, GetHandleId(u),'ZMBI')
		set d = GetUnitDistanceEx(damageSource, u)
		if d < 775 then
			set a = 20 + 5 * GetUnitAbilityLevel(damageSource,'QM03')
			if K8I(damageSource) then
				set a = a + 5
			endif
			if d > 200 then
				set a = a  -15*((d  -150)/(775  -150))
			endif
			set a = a / 100 
			if a != LJR then
				call SaveReal(HY, GetHandleId(u),'AMPL', LoadReal(HY, GetHandleId(u),'AMPL')-LJR + a)
				call SaveReal(HY, GetHandleId(u),'ZMBI', a)
			endif
		else
			call SaveReal(HY, GetHandleId(u),'AMPL', LoadReal(HY, GetHandleId(u),'AMPL')-LJR)
			call RemoveSavedReal(HY, GetHandleId(u),'ZMBI')
		endif
		call GroupRemoveUnit(gg, u)
	endloop
	call DeallocateGroup(gg)
endfunction
function LOI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group g = LoadGroupHandle(HY, h, 0)
	call LXI(null, g)
	call DeallocateGroup(g)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set g = null
endfunction
function LRI takes group g returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .0, false, function LOI)
	call SaveGroupHandle(HY, GetHandleId(t), 0, g)
	set t = null
endfunction
function LII takes nothing returns boolean
	local trigger t2 = GetTriggeringTrigger()
	local integer h2 = GetHandleId(t2)
	local trigger t1 = LoadTriggerHandle(HY, h2, 274)
	local integer h = GetHandleId(t1)
	local unit whichUnit = LoadUnitHandle(HY, h2, 2)
	local unit targetUnit
	local real d
	local real a
	local boolean b = LoadBoolean(HY, h2, 273)
	local real LAI = LoadReal(HY, h2, 30)
	if (GetTriggerEventId() == EVENT_UNIT_DEATH and GetTriggerUnit() == whichUnit) or(GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED and GetGameTime()> LAI) then
		call LEI(whichUnit)
		call LRI(LoadGroupHandle(HY, h2, 30))
		call FlushChildHashtable(HY, h)
		call FlushChildHashtable(HY, h2)
		call CleanCurrentTrigger(t1)
		call CleanCurrentTrigger(t2)
	elseif GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		call LXI(whichUnit, LoadGroupHandle(HY, h2, 30))
	elseif GetTriggerEventId() == EVENT_UNIT_DAMAGED then
	elseif GetTriggerEventId() == EVENT_UNIT_DEATH then
		if IsUnitIllusion(GetDyingUnit()) == false then
			call LaunchMissileByUnitDummy(GetDyingUnit(), whichUnit,'h07Y', "K9I", 9999, false)
		endif
	endif
	set t2 = null
	set t1 = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function LNI takes nothing returns boolean
	local trigger t1 = GetTriggeringTrigger()
	local integer L2R = GetHandleId(t1)
	local trigger t2 =(LoadTriggerHandle(HY,(L2R), 275))
	local integer DOO = GetHandleId(t2)
	local unit targetUnit = GetTriggerUnit()
	local unit whichUnit =(LoadUnitHandle(HY,(L2R), 2))
	if IsUnitEnemy(whichUnit, GetOwningPlayer(targetUnit)) and IsUnitType(targetUnit, UNIT_TYPE_STRUCTURE) == false and GetUnitAbilityLevel(targetUnit,'A04R') == 0 then
		if (LoadBoolean(HY,(DOO),(GetHandleId(targetUnit)))) == false then
			call GroupAddUnit(LoadGroupHandle(HY, DOO, 30), targetUnit)
			call TriggerRegisterUnitEvent(t2, targetUnit, EVENT_UNIT_DEATH)
			call TriggerRegisterTimerEvent(t2, .1, true)
			call SaveBoolean(HY,(DOO),(GetHandleId(targetUnit)),(true))
		endif
	endif
	set t1 = null
	set t2 = null
	set targetUnit = null
	set whichUnit = null
	return false
endfunction
function LBI takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t1 = CreateTrigger()
	local integer L2R = GetHandleId(t1)
	local trigger t2 = CreateTrigger()
	local integer DOO = GetHandleId(t2)
	local integer level = GetUnitAbilityLevel(whichUnit,'QM03')
	call SetPlayerAbilityAvailable(GetOwningPlayer(whichUnit),'A17A', false)
	call TriggerRegisterUnitInRange(t1, whichUnit, 750, null)
	call TriggerAddCondition(t1, Condition(function LNI))
	call SaveTriggerHandle(HY,(L2R), 275,(t2))
	call SaveUnitHandle(HY,(L2R), 2,(whichUnit))
	call TriggerRegisterTimerEvent(t2, 30, false)
	call SaveReal(HY, DOO, 30, GetGameTime()+ 30.)
	call TriggerRegisterUnitEvent(t2, whichUnit, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t2, Condition(function LII))
	call SaveTriggerHandle(HY,(DOO), 274,(t1))
	call SaveUnitHandle(HY,(DOO), 2,(whichUnit))
	call SaveBoolean(HY,(DOO), 273,(false))
	call SaveGroupHandle(HY, DOO, 30, AllocationGroup(326))
	set whichUnit = null
	set t1 = null
	set t2 = null
endfunction
function OPE takes nothing returns nothing
	if GetUnitTypeId(GetTriggerUnit())!='H07I' then
		call LBI()
		call GroupAddUnit(OX, GetTriggerUnit())
	else
		call GroupRemoveUnit(OX, GetTriggerUnit())
	endif
	if GetUnitAbilityLevel(GetTriggerUnit(),'QINV') == 1 then
		call UnitRemoveAbility(GetTriggerUnit(),'QINV')
	endif
endfunction



function LFI takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real d = GetEventDamage()
	if (d > 0) and GetWidgetLife(u)> 1 and FK and GetUnitAbilityLevel(u,'A36D') == 0 then
		if (d <= 20) then
			if GetRandomInt(0, 100)< 5 + 5 *(GetUnitAbilityLevel(u,'A0CZ')) then
				call SetWidgetLife(u, GetWidgetLife(u)+ d)
				call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\WingedSerpentMissile\\WingedSerpentMissile.mdl", u, "hand,left"))
			endif
		elseif TKV(u,'A0CZ', 5 + 5 *(GetUnitAbilityLevel(u,'A0CZ'))) then
			call SetWidgetLife(u, GetWidgetLife(u)+ d)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\WingedSerpentMissile\\WingedSerpentMissile.mdl", u, "hand,left"))
		endif
	endif
	set u = null
endfunction
function LPE takes nothing returns nothing
	set HaveBacktrack = true
	//local trigger t = CreateTrigger()
	//call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_DAMAGED)
	//call TriggerAddCondition(t, Condition(function LFI))
	//set t = null
endfunction
function U1F takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit LHI =(LoadUnitHandle(HY, h, 19))
	call PauseTimer(t)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set LHI = null
endfunction
function LJI takes nothing returns boolean
	return GetUnitTypeId(GetFilterUnit()) != 'ewsp' and UnitIsDead(GetFilterUnit()) == false and GetOwningPlayer(GetFilterUnit())!= GetOwningPlayer(U2) and GetOwningPlayer(GetFilterUnit())!= NEUTRAL_PASSIVE_PLAYER
endfunction
function LKI takes nothing returns boolean
	return GetUnitTypeId(GetTriggerUnit()) != 'ewsp' and UnitIsDead(GetTriggerUnit()) == false and GetOwningPlayer(GetTriggerUnit())!= GetOwningPlayer(U2) and GetOwningPlayer(GetTriggerUnit())!= NEUTRAL_PASSIVE_PLAYER
endfunction
function LLI takes unit u returns nothing
	call SetUnitTimeScale(u, 0)
	call SaveBoolean(HY, GetHandleId(u), 4306, true)
	if IsHeroUnitId(GetUnitTypeId(u)) or IsUnitIllusion(u) then
		if IsUnitPaused(u) == false then
			if IssueTargetOrderById(LoadUnitHandle(OtherHashTable2,'CHRN', 0), 852095, u) == false then
				call UnitShareVision(u, GetOwningPlayer(LoadUnitHandle(OtherHashTable2,'CHRN', 0)), true)
				if IssueTargetOrderById(LoadUnitHandle(OtherHashTable2,'CHRN', 0), 852095, u) == false then
					if RCX(u) == false and RDX(u) == false then
						call PauseUnit(u, true)
					endif
				endif
				call UnitShareVision(u, GetOwningPlayer(LoadUnitHandle(OtherHashTable2,'CHRN', 0)), false)
			endif
		endif
	else
		call PauseUnit(u, true)
	endif
endfunction
function LMI takes nothing returns nothing
	call LLI(GetEnumUnit())
endfunction
function LPI takes nothing returns nothing
	local unit u = GetEnumUnit()
	call SaveBoolean(HY, GetHandleId(u), 4306, false)
	call PauseUnit(u, false)
	call SetUnitTimeScale(u, 1)
	set u = null
endfunction
function LQI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit d = LoadUnitHandle(HY, h, 19)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	local integer level = LoadInteger(HY, h, 5)
	local group g = LoadGroupHandle(HY, h, 220)
	local integer c = LoadInteger(HY, h, 28)
	local real tx = GetUnitX(d)
	local real ty = GetUnitY(d)
	local group gg
	local integer SYV = LoadInteger(HY, h, 6)
	call SaveUnitHandle(OtherHashTable2,'CHRN', 0, d)
	if GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		set c = c + 1
		call SaveInteger(HY, h, 28, c)
		if GetUnitDistanceEx(trigUnit, d)< 435 then
			call SetUnitNoLimitMoveSpeed(trigUnit, 700)
		else
			call SetUnitNoLimitMoveSpeed(trigUnit, 0)
		endif
		set gg = AllocationGroup(329)
		call ForGroup(g, function LPI)
		set U2 = trigUnit
		call GroupEnumUnitsInRange(gg, tx, ty, 475, Condition(function LJI))
		call GroupClear(g)
		call GroupAddGroup(gg, g)
		call ForGroup(gg, function LMI)
		call DeallocateGroup(gg)
	else
		set U2 = trigUnit
		if LKI() and GetUnitAbilityLevel(GetTriggerUnit(),'Aloc') == 0 and GetUnitAbilityLevel(GetTriggerUnit(),'A04R') == 0 and IsUnitInGroup(GetTriggerUnit(), g) == false then
			call GroupAddUnit(g, GetTriggerUnit())
			call LLI(GetTriggerUnit())
		endif
	endif
	call RemoveSavedHandle(OtherHashTable2,'CHRN', 0)
	if c > SYV then
		if IsGameEnd == false then
			call ForGroup(g, function LPI)
		endif
		call SetUnitNoLimitMoveSpeed(trigUnit, 0)
		call KillUnit(d)
		call RemoveUnit(d)
		call KillUnit(LoadUnitHandle(HY, h, 18))
		call DeallocateGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set d = null
	set trigUnit = null
	set g = null
	set gg = null
endfunction
function OSE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(trigUnit,'A0J1')+ GetUnitAbilityLevel(trigUnit,'A1D7')
	local real tx = GetSpellTargetX()
	local real ty = GetSpellTargetY()
	local unit d = CreateUnit(GetOwningPlayer(trigUnit),'u00L', tx, ty, 0)
	local integer h
	local trigger tt
	local unit Q2R = CreateUnit(GetOwningPlayer(trigUnit),'e00E', tx, ty, 0)
	call UnitAddAbility(Q2R,'A21K')
	set tt = CreateTrigger()
	set h = GetHandleId(tt)
	call SaveUnitHandle(HY, h, 19, d)
	call SaveUnitHandle(HY, h, 18, Q2R)
	call SaveUnitHandle(HY, h, 14, trigUnit)
	call SaveGroupHandle(HY, h, 220, AllocationGroup(330))
	call SaveInteger(HY, h, 28, 0)
	call SaveInteger(HY, h, 5, level)
	if GetUnitAbilityLevel(trigUnit,'A1D7')> 0 then
		call SaveInteger(HY, h, 6, 33 + level * 2)
	else
		call SaveInteger(HY, h, 6, 28 + level * 2)
	endif
	call SavePlayerHandle(HY, h, 0, GetOwningPlayer(trigUnit))
	call TriggerRegisterTimerEvent(tt, .1, true)
	call TriggerRegisterTimerEvent(tt, 0, false)
	call TriggerRegisterUnitInRange(tt, d, 425, Condition(function LJI))
	call TriggerAddCondition(tt, Condition(function LQI))
	call UnitAddAbility(d,'A45D')
	set trigUnit = null
	set d = null
	set tt = null
	set Q2R = null
endfunction
function LSI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(ObjectHashTable, GetHandleId(t), 0)
	if GetUnitAbilityLevel(u,'B0C2') == 0 then
		call RemoveSavedHandle(ObjectHashTable, GetHandleId(u),'A081')
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		set u = null
		return
	endif
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl", u, "chest"))
	set t = null
	set u = null
endfunction
function LTI takes unit u, integer WFV returns nothing
	local timer t = CreateTimer()
	call SaveTimerHandle(ObjectHashTable, WFV,'A081', t)
	call SaveUnitHandle(ObjectHashTable, GetHandleId(t), 0, u)
	call TimerStart(t, .1, true, function LSI)
	set t = null
endfunction
function LUI takes unit u, unit t returns nothing
	local integer WFV = GetHandleId(t)
	local integer WUV = GetUnitAbilityLevel(u,'A081')
	if WUV > 0 and GetUnitAbilityLevel(t,'B0C2') == 1 and HaveSavedHandle(ObjectHashTable, WFV,'A081') == false then
		call LTI(t, GetHandleId(t))
		if LoadBoolean(HY, WFV, 4306) then
			call UnitDamageTargetEx(u, t, 1, WUV * 10+ 30)
		endif
	endif
endfunction
function LWI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 30)
	local integer hu = GetHandleId(u)
	local integer c = LoadInteger(HY, h, 1)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or c == 1 then
		call UnitAddStateBonus(u, LoadInteger(HY, h, 2), UNIT_BONUS_ARMOR)
		call RemoveSavedHandle(HY, hu,'A0VW')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SaveInteger(HY, h, 1, c -1)
	endif
	set t = null
	set u = null
endfunction
function LYI takes unit u returns nothing
	local trigger t
	local integer h
	local integer level
	local integer c
	if HaveSavedHandle(HY, GetHandleId(u),'A0VW') then
		set t = LoadTriggerHandle(HY, GetHandleId(u),'A0VW')
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 5, false)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, GetHandleId(u),'A0VW', t)
		call TriggerRegisterTimerEvent(t, 5, false)
		call TriggerRegisterDeathEvent(t, u)
		call SaveUnitHandle(HY, h, 30, u)
		call TriggerAddCondition(t, Condition(function LWI))
	endif
	set c = LoadInteger(HY, h, 2)
	if c < 10 then
		call SaveInteger(HY, h, 2, c + 1)
		call UnitReduceStateBonus(u, 1, UNIT_BONUS_ARMOR)
	endif
	call SaveInteger(HY, h, 1, LoadInteger(HY, h, 1)+ 1)
	set t = null
endfunction
function LZI takes nothing returns boolean
	local real d
	if GetUnitAbilityLevel(GetTriggerUnit(),'B091')> 0 and GetUnitAbilityLevel(GetEventDamageSource(),'A0VV')> 0 and(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 2)) == GetEventDamageSource() then
		call UnitRemoveAbility(GetTriggerUnit(),'B091')
		call DisableTrigger(GetTriggeringTrigger())
		call LYI(GetTriggerUnit())
		call FlushChildHashtable(HY,(GetHandleId(GetTriggeringTrigger())))
		call CleanCurrentTrigger(GetTriggeringTrigger())
	endif
	return false
endfunction
function L_I takes nothing returns nothing
	local trigger t
	local unit targetUnit
	local unit whichUnit
	if GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
		set targetUnit = GetSpellTargetUnit()
		set whichUnit = GetTriggerUnit()
	else
		set targetUnit = GetTriggerUnit()
		set whichUnit = GetAttacker()
	endif
	if IsUnitIllusion(whichUnit) == false then
		set t = CreateTrigger()
		call SaveUnitHandle(HY,(GetHandleId(t)), 2,(whichUnit))
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(t, Condition(function LZI))
	endif
	set t = null
	set targetUnit = null
	set whichUnit = null
endfunction
function L0I takes nothing returns boolean
	if GetTriggerEventId() == EVENT_PLAYER_UNIT_ATTACKED then
		if GetUnitAbilityLevel(GetAttacker(),'A0VV')> 0 and(LoadBoolean(HY,(GetHandleId(GetTriggeringTrigger())), 3008)) and IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE) == false and GetAttacker()==(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 2)) then
			call L_I()
		endif
	elseif GetTriggerEventId() == EVENT_UNIT_ISSUED_ORDER then
		if (GetIssuedOrderId()== 852255) then
			call SaveBoolean(HY,(GetHandleId(GetTriggeringTrigger())), 3008,(true))
		elseif (GetIssuedOrderId()== 852256) then
			call SaveBoolean(HY,(GetHandleId(GetTriggeringTrigger())), 3008,(false))
		endif
	elseif GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A0VV' then
		call L_I()
	endif
	return false
endfunction
function L1I takes unit whichUnit returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_ISSUED_ORDER)
	call TriggerAddCondition(t, Condition(function L0I))
	call SaveUnitHandle(HY,(GetHandleId(t)), 2,(whichUnit))
	call SaveBoolean(HY,(GetHandleId(t)), 3008,(true))
	set t = null
endfunction
function L2I takes nothing returns boolean
	if not IsPickingHero then
		if (IsPlayerHasSkill(GetOwningPlayer(GetTriggerUnit()), 316) or IsPlayerHasSkill(GetOwningPlayer(GetTriggerUnit()), 212)) and IsUnitIllusion(GetTriggerUnit()) == false then
			set U2 = GetTriggerUnit()
		elseif IsPlayerHasSkill(GetOwningPlayer(GetTriggerUnit()), 356) and IsUnitIllusion(GetTriggerUnit()) == false and GetUnitTypeId(GetTriggerUnit())!='H00J' then
			set U2 = GetTriggerUnit()
			call ExecuteFunc("L3I")
		endif
	endif
	return false
endfunction

function MXI takes unit whichUnit, unit targetUnit, integer MOI returns nothing
	local real MRI = RMaxBJ(RMinBJ(GetUnitState(targetUnit, UNIT_STATE_MANA), MOI), 0)
	local real MII = MRI * .5
	local real MAI = 0
	if IsUnitMagicImmune(targetUnit) == false and MRI > 0 and RCX(targetUnit) == false then
		if IsUnitIllusion(targetUnit) == false then
			if GetUnitState(targetUnit, UNIT_STATE_MANA)> MRI then
				set MAI = MAI + MRI
			else
				set MAI = MAI + GetUnitState(targetUnit, UNIT_STATE_MANA)
			endif
		endif
		if GetWidgetLife(targetUnit)>(MII + .5) then
			call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)-MII)
		else
			call SetWidgetLife(targetUnit, 1)
			call UnitDamageTargetEx(L2V, targetUnit, 1, MII)
		endif
		call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)-MRI)
	endif
	set MAI = MAI / 2
	if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
		call SetUnitState(whichUnit, UNIT_STATE_MANA, GetUnitState(whichUnit, UNIT_STATE_MANA)+ MAI)
	endif
endfunction
function MNI takes unit whichUnit, integer level, unit trigUnit returns nothing
	local group g = AllocationGroup(336)
	local unit u2
	set L2V = whichUnit
	set U2 = whichUnit
	set L1V = level * 100 
	set U2 = trigUnit
	call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 700, Condition(function DHX))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call GroupRemoveUnit(g, u2)
		call MXI(trigUnit, u2, level * 100 )
	endloop
	call DeallocateGroup(g)
	set g = null
endfunction
function MBI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer count = GetTriggerEvalCount(t)
	local integer level =(LoadInteger(HY, h, 5))
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit MCI
	local real MDI = 2.00
	local real MFI = 1 +(3.9 -1)* count /(MDI / .05)
	call SetUnitScale(dummyCaster, MFI, MFI, MFI)
	if count >(MDI / .05) then
		call MNI(dummyCaster, level, whichUnit)
		set MCI = CreateUnit(GetOwningPlayer(dummyCaster),'e01O', GetUnitX(dummyCaster), GetUnitY(dummyCaster), 0)
		call SetUnitTimeScale(MCI, .3)
		call RemoveUnit(dummyCaster)
		call KillUnit(MCI)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set dummyCaster = null
	set MCI = null
	set whichUnit = null
	return false
endfunction
function OWE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = Atan2(y -GetUnitY(whichUnit), x -GetUnitX(whichUnit))
	local integer level = GetUnitAbilityLevel(whichUnit,'Z609')
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e01M', x, y, a * bj_RADTODEG)
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function MBI))
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveInteger(HY, h, 5,(level))
	set t = null
	set whichUnit = null
	set dummyCaster = null
endfunction
function MGI takes unit whichUnit, unit targetUnit, integer level returns nothing
	local unit dummyCaster = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local unit MHI = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddAbility(dummyCaster,'A0XK')
	call SetUnitAbilityLevel(dummyCaster,'A0XK', level)
	call UnitAddAbility(dummyCaster,'A3G2')
	call SetUnitAbilityLevel(dummyCaster,'A3G2', level)
	call SaveUnitHandle(HY, GetHandleId(dummyCaster), 0, whichUnit)
	call FJO(targetUnit, dummyCaster)
	call IOX(MHI, targetUnit, 1, 60. + level * 60., .8 + .3 * level)
	set dummyCaster = null
	set MHI = null
endfunction
function MJI takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), DK) == false then
		call GroupAddUnit(DK, GetEnumUnit())
		call MGI(U2, GetEnumUnit(), Q2)
	endif
endfunction
function MKI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	local real x2 =(LoadReal(HY, h, 66))
	local real y2 =(LoadReal(HY, h, 67))
	local real a =(LoadReal(HY, h, 137))
	local integer level =(LoadInteger(HY, h, 5))
	local group g =(LoadGroupHandle(HY, h, 22))
	local real x = GetUnitX(dummyCaster)+ 25 * Cos(a)
	local real y = GetUnitY(dummyCaster)+ 25 * Sin(a)
	local group MLI = AllocationGroup(337)
	local real GIX = GetDistanceBetween(x, y, x2, y2)
	if GIX <= 30 then
		set x = x2
		set y = y2
	endif
	call SetUnitX(dummyCaster, CoordinateX50(x))
	call SetUnitY(dummyCaster, CoordinateX50(y))
	set U2 = dummyCaster
	set DK = g
	set Q2 = level
	call GroupEnumUnitsInRange(MLI, x, y, 200, Condition(function DHX))
	call ForGroup(MLI, function MJI)
	call DeallocateGroup(MLI)
	if GIX <= 30 or GetTriggerEvalCount(t)> 125 then
		call DeallocateGroup(g)
		call KillUnit(dummyCaster)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set dummyCaster = null
	set g = null
	set MLI = null
	return false
endfunction
function OYE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'Z608')
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = Atan2(y -GetUnitY(whichUnit), x -GetUnitX(whichUnit))
	local unit dummyCaster
	if GetUnitTypeId(whichUnit)=='e00E' then
		if GetRandomInt(0, 1) == 1 then
			set a = a + GetRandomReal(0, bj_PI / 4)
		else
			set a = a -GetRandomReal(0, bj_PI / 4)
		endif
	endif
	set x = GetUnitX(whichUnit)
	set y = GetUnitY(whichUnit)
	set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'n01U', x, y, a * bj_RADTODEG)
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function MKI))
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	call SaveReal(HY, h, 66,(x +(750 + 500. * level)* Cos(a)))
	call SaveReal(HY, h, 67,(y +(750 + 500. * level)* Sin(a)))
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h, 137,((a)* 1.))
	call SaveGroupHandle(HY, h, 22,(AllocationGroup(338)))
	set t = null
	set whichUnit = null
	set dummyCaster = null
endfunction
function O_E takes nothing returns nothing
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(GetTriggerUnit(),'Z607')
	call UnitAddAbilityToTimed(targetUnit,'A0VJ', level, 13, 0)
	call UnitAddAbilityToTimed(targetUnit,'A109', level, 13, 0)
	set targetUnit = null
endfunction
function MMI takes unit whichUnit returns integer
	local integer level = GetUnitAbilityLevel(whichUnit,'Z606')+ 1
	if level == 1 then
		return'A230'
	elseif level == 2 then
		return'A22Z'
	elseif level == 3 then
		return'A22Y'
	elseif level == 4 then
		return'A22U'
	elseif level == 5 then
		return'A22V'
	elseif level == 6 then
		return'A22W'
	elseif level == 7 then
		return'A22X'
	endif
	return'A230'
endfunction
function MPI takes unit targetUnit returns nothing
	call UnitRemoveAbility(targetUnit,'A230')
	call UnitRemoveAbility(targetUnit,'A22Z')
	call UnitRemoveAbility(targetUnit,'A22Y')
	call UnitRemoveAbility(targetUnit,'A22U')
	call UnitRemoveAbility(targetUnit,'A22V')
	call UnitRemoveAbility(targetUnit,'A22W')
	call UnitRemoveAbility(targetUnit,'A22X')
	call UnitRemoveAbility(targetUnit,'B08Z')
endfunction
function MQI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real MSI =(LoadReal(HY,(GetHandleId(targetUnit)), 681))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or MSI <(GetGameTime()) then
		call MPI(targetUnit)
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function MTI takes nothing returns nothing
	local unit whichUnit = U2
	local unit targetUnit = GetEnumUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real MSI =(LoadReal(HY,(GetHandleId(targetUnit)), 681))
	if MSI <(GetGameTime()) then
		call UnitAddPermanentAbility(targetUnit, MMI(whichUnit))
	endif
	call SaveReal(HY,(GetHandleId(targetUnit)), 681,(((GetGameTime())+ 2)* 1.))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call TriggerRegisterTimerEvent(t, 2.01, false)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function MQI))
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function MUI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local real sx =(LoadReal(HY, h, 6))
	local real sy =(LoadReal(HY, h, 7))
	local real a =(LoadReal(HY, h, 137))
	local real MWI =(LoadReal(HY, h, 57))
	local real x
	local real y
	local integer i = 1
	local integer count = GetTriggerEvalCount(t)
	local group g
	if count * .1 > MWI then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set g = AllocationGroup(339)
		set U2 = whichUnit
		loop
		exitwhen i > 7
			set x = sx + 80 * i * Cos((a + 90)* bj_DEGTORAD)
			set y = sy + 80 * i * Sin((a + 90)* bj_DEGTORAD)
			call GroupEnumUnitsInRange(g, x, y,'i', Condition(function DPX))
			call ForGroup(g, function MTI)
			set x = sx + 80 * i * Cos((a -90)* bj_DEGTORAD)
			set y = sy + 80 * i * Sin((a -90)* bj_DEGTORAD)
			call GroupEnumUnitsInRange(g, x, y,'i', Condition(function DPX))
			call ForGroup(g, function MTI)
			set i = i + 1
		endloop
		call DeallocateGroup(g)
		set g = null
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function O0E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real a = GetUnitFacing(whichUnit)
	local integer i = 1
	local unit dummyCaster
	local real x
	local real y
	local real sx = GetUnitX(whichUnit)+ 225* Cos(a * bj_DEGTORAD)
	local real sy = GetUnitY(whichUnit)+ 225* Sin(a * bj_DEGTORAD)
	local integer level = GetUnitAbilityLevel(whichUnit,'Z606')
	local real MWI = 1.5 + 2 * level
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	if GetUnitTypeId(whichUnit)=='e00E' then
		set whichUnit = Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))]
		set a = GetRandomReal(0, 360)
		set sx = GetUnitX(whichUnit)+ 225* Cos(a * bj_DEGTORAD)
		set sy = GetUnitY(whichUnit)+ 225* Sin(a * bj_DEGTORAD)
	endif
	loop
	exitwhen i > 7
		set x = sx + 80 * i * Cos((a + 90)* bj_DEGTORAD)
		set y = sy + 80 * i * Sin((a + 90)* bj_DEGTORAD)
		set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'u00O', x, y, GetRandomReal(0, 360))
		call SetUnitAbilityLevel(dummyCaster,'A0XN', level)
		call SetUnitAnimation(dummyCaster, "birth")
		call QueueUnitAnimation(dummyCaster, "stand")
		call UnitApplyTimedLife(dummyCaster,'BTLF', MWI)
		set x = sx + 80 * i * Cos((a -90)* bj_DEGTORAD)
		set y = sy + 80 * i * Sin((a -90)* bj_DEGTORAD)
		set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'u00O', x, y, GetRandomReal(0, 360))
		call SetUnitAbilityLevel(dummyCaster,'A0XN', level)
		call SetUnitAnimation(dummyCaster, "birth")
		call QueueUnitAnimation(dummyCaster, "stand")
		call UnitApplyTimedLife(dummyCaster,'BTLF', MWI)
		set i = i + 1
	endloop
	call TriggerAddCondition(t, Condition(function MUI))
	call TriggerRegisterTimerEvent(t, .1, true)
	call SaveReal(HY, h, 6,((sx)* 1.))
	call SaveReal(HY, h, 7,((sy)* 1.))
	call SaveReal(HY, h, 137,((a)* 1.))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveReal(HY, h, 57,((MWI)* 1.))
	set dummyCaster = null
	set whichUnit = null
	set t = null
endfunction
function MYI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	if UnitAlive(u) then
		call UnitRemoveAbility(u,'QFZZ')
		if GetUnitAbilityLevel(u,'QFZZ') == 0 then
			call FlushChildHashtable(HY, GetHandleId(t))
			call DestroyTrigger(t)
		endif
	endif
	set t = null
	set u = null
	return false
endfunction
function MZI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local trigger tt
	if GetUnitAbilityLevel(trigUnit,'B08X') == 0 then
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(trigUnit),'Z605', true)
		call UnitRemoveAbility(trigUnit,'QFZZ')
		if GetUnitAbilityLevel(trigUnit,'QFZZ')> 0 then
			set tt = CreateTrigger()
			call TriggerRegisterTimerEvent(tt, 1, true)
			call TriggerAddCondition(tt, Condition(function MYI))
			call SaveUnitHandle(HY, GetHandleId(tt), 0, trigUnit)
			set tt = null
		endif
		call KillUnit(dummyCaster)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SetUnitX(dummyCaster, GetUnitX(trigUnit))
		call SetUnitY(dummyCaster, GetUnitY(trigUnit))
	endif
	set t = null
	set dummyCaster = null
	set trigUnit = null
	return false
endfunction
function O1E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = GetTriggerUnit()
	local unit dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'e01V', GetUnitX(trigUnit), GetUnitY(trigUnit), 0)
	local integer level = GetUnitAbilityLevel(trigUnit,'Z605')
	call UnitAddPermanentAbility(dummyCaster,'QH50')
	call SetUnitAbilityLevel(dummyCaster,'QH50', level)
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function MZI))
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(trigUnit),'Z605', false)
	call UnitAddAbility(trigUnit,'QFZZ')
	call SetUnitAbilityLevel(trigUnit,'QFZZ', 1)
	set t = null
	set trigUnit = null
	set dummyCaster = null
endfunction
function M_I takes unit whichUnit, unit targetUnit, integer level returns nothing
	local unit dummyCaster = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddPermanentAbility(dummyCaster,'A0VI')
	call IssueTargetOrderById(dummyCaster, 852095, targetUnit)
	if IsUnitMagicImmune(targetUnit) == false then
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 25 + 5 * level)
	endif
	set dummyCaster = null
endfunction
function M0I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local integer level =(LoadInteger(HY, h, 5))
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamage()> 10 and((LoadInteger(HY,(GetHandleId((t))),(4263))) == 1) == false and GetOwningPlayer(GetEventDamageSource())!= GetOwningPlayer(GetTriggerUnit()) and FK then
			call DisableTrigger(t)
			call M_I(whichUnit, targetUnit, level)
			call EnableTrigger(t)
			call EFX(t, 4263, .6)
		endif
	else
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	set whichUnit = null
	return false
endfunction
function O2E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(trigUnit,'Z604')
	call TriggerRegisterTimerEvent(t, 2.5 + level * .5, false)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function M0I))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))
	call SaveInteger(HY, h, 5,(level))
	call SaveUnitHandle(HY, h, 2,(trigUnit))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("Abilities\\Weapons\\SpiritOfVengeanceMissile\\SpiritOfVengeanceMissile.mdl", targetUnit, "overhead")))
	call M_I(trigUnit, targetUnit, level)
	set t = null
	set trigUnit = null
	set targetUnit = null
endfunction
function M1I takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='fRG1' or GetUnitTypeId(GetFilterUnit())=='fRG2' or GetUnitTypeId(GetFilterUnit())=='fRG3' or GetUnitTypeId(GetFilterUnit())=='fRG4' then
		call KillUnit(GetFilterUnit())
	endif
	return false
endfunction
function M2I takes player p returns nothing
	local group g = AllocationGroup(340)
	call GroupEnumUnitsOfPlayer(g, p, Condition(function M1I))
	call DeallocateGroup(g)
	set g = null
endfunction
function O4E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit d
	local integer level = GetUnitAbilityLevel(whichUnit,'Z603')
	local integer LAR = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))],'A0A8')
	if GetUnitTypeId(whichUnit)!='e00E' then
		call M2I(GetOwningPlayer(whichUnit))
	endif
	set d = CreateUnit(GetOwningPlayer(whichUnit),'fRG0'+ level, GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitFacing(whichUnit))
	call SetUnitColor(d, GetPlayerColor(SentinelPlayers[0]))
	call AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl", d, "chest")
	call UnitApplyTimedLife(d,'BTLF', 35)
	call SetUnitAbilityLevel(d,'A0VV', level)
	call L1I(d)
	if level > 1 and LAR > 0 then
		call UnitAddPermanentAbilitySetLevel(d,'A3J3', 1)
		call UnitAddPermanentAbilitySetLevel(d,'A3J4', 1)
		call UnitAddPermanentAbilitySetLevel(d,'A3J5', 1)
	endif
	call W1E(d)
	if level > 2 then
		set d = CreateUnit(GetOwningPlayer(whichUnit),'fRG0'+ level, GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitFacing(whichUnit))
		call SetUnitColor(d, GetPlayerColor(SentinelPlayers[0]))
		call AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl", d, "chest")
		call UnitApplyTimedLife(d,'BTLF', 35)
		call SetUnitAbilityLevel(d,'A0VV', level)
		call L1I(d)
		call W1E(d)
		if LAR > 0 then
			call UnitAddPermanentAbilitySetLevel(d,'A3J3', 1)
			call UnitAddPermanentAbilitySetLevel(d,'A3J4', 1)
			call UnitAddPermanentAbilitySetLevel(d,'A3J5', 1)
		endif
	endif
	set whichUnit = null
	set d = null
endfunction
function M3I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local real IXX =(LoadReal(HY, h, 20))
	local effect FX =(LoadEffectHandle(HY, h, 32))
	local integer count = GetTriggerEvalCount(t)
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, IXX)
	if GetUnitAbilityLevel(targetUnit,'A42R') == 0 or count == 3 then
		call SaveInteger(ObjectHashTable, GetHandleId(targetUnit),'A42R', LoadInteger(ObjectHashTable, GetHandleId(targetUnit),'A42R')-1)
		if LoadInteger(ObjectHashTable, GetHandleId(targetUnit),'A42R')<= 0 then
			call UnitRemoveAbility(targetUnit,'A42R')
			call UnitRemoveAbility(targetUnit,'B0HI')
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call DestroyEffect(FX)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set FX = null
	return false
endfunction
function M4I takes unit whichUnit, unit targetUnit, real IXX, boolean M5I returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))
	call SaveReal(HY, h, 20,((IXX)* 1.))
	call SaveBoolean(HY, h, 0, M5I)
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("Environment\\SmallBuildingFire\\SmallBuildingFire2.mdl", targetUnit, "chest")))
	call TriggerRegisterTimerEvent(t, 1, true)
	call UnitAddPermanentAbility(targetUnit,'A42R')
	call SaveInteger(ObjectHashTable, GetHandleId(targetUnit),'A42R', LoadInteger(ObjectHashTable, GetHandleId(targetUnit),'A42R')+ 1)
	call TriggerAddCondition(t, Condition(function M3I))
	set t = null
endfunction
function M6I takes nothing returns nothing
	call M4I(U2, GetEnumUnit(), S2 / 5, X3)
	call UnitDamageTargetEx(U2, GetEnumUnit(), 1, S2)
endfunction
function M7I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local real a =(LoadReal(HY, h, 137))
	local integer level =(LoadInteger(HY, h, 5))
	local integer count = GetTriggerEvalCount(t)-26
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local real targetX
	local real targetY
	local unit dummyCaster
	local group g
	if count == 1 then
		set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e01L', x, y, a * bj_RADTODEG)
		call SaveUnitHandle(HY, h, 19,(dummyCaster))
	elseif count > 1 then
		set dummyCaster =(LoadUnitHandle(HY, h, 19))
	endif
	if count > 0 then
		set targetX = CoordinateX50(GetUnitX(dummyCaster)+ 15* Cos(a))
		set targetY = CoordinateY50(GetUnitY(dummyCaster)+ 15* Sin(a))
		call SetUnitX(dummyCaster, targetX)
		call SetUnitY(dummyCaster, targetY)
		if (count > 1 and ModuloInteger(count, 10) == 0) or count == 1 then
			set g = AllocationGroup(341)
			set U2 = whichUnit
			set S2 = 40 + 20 * level
			call GroupEnumUnitsInRange(g, targetX, targetY, 300, Condition(function DHX))
			set X3 = count > LoadInteger(HY, h, 7)
			call ForGroup(g, function M6I)
			call DeallocateGroup(g)
			call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", targetX, targetY))
		endif
		if count > LoadInteger(HY, h, 7) then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call KillUnit(dummyCaster)
		endif
	endif
	set t = null
	set g = null
	set dummyCaster = null
	set whichUnit = null
	return false
endfunction
function O5E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = Atan2(y -GetUnitY(whichUnit), x -GetUnitX(whichUnit))
	local unit M8I = CreateUnit(GetOwningPlayer(whichUnit),'e01K', x, y, a * bj_RADTODEG)
	local integer level = GetUnitAbilityLevel(whichUnit,'Z602')
	call SetUnitTimeScale(M8I, .58)
	call UnitApplyTimedLife(M8I,'BTLF', 1.75)
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function M7I))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call SaveReal(HY, h, 137,((a)* 1.))
	call SaveInteger(HY, h, 5, level)
	call SaveInteger(HY, h, 7, R2I((350 + 200* level)/ 16.6))
	set t = null
	set whichUnit = null
	set M8I = null
endfunction
function M9I takes nothing returns nothing
	call UnitDamageTargetEx(U2, GetEnumUnit(), 3, S2)
endfunction
function PVI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local real IXX =(LoadReal(HY, h, 20))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local group g = AllocationGroup(342)
	local integer count
	set U2 = trigUnit
	call A8X(GetOwningPlayer(trigUnit), 4, x, y, 400)
	call GroupEnumUnitsInRange(g, x, y, 200, Condition(function DHX))
	set count = CountUnitsInGroup(g)
	if count > 0 then
		set S2 = IXX / count
		call ForGroup(g, function M9I)
	endif
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", x, y))
	call DeallocateGroup(g)
	call DestroyEffect((LoadEffectHandle(HY, h, 32)))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set trigUnit = null
	set g = null
	return false
endfunction
function O6E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real IXX = 100 + 75 * GetUnitAbilityLevel(trigUnit,'Z601')
	local string s = ""
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(trigUnit)) or(IsObserverPlayer(LocalPlayer)) then
		set s = "war3mapImported\\SunStrike.mdx"
	endif
	call A8X(GetOwningPlayer(trigUnit), 5.7, x, y, 400)
	call TriggerRegisterTimerEvent(t, 1.7, false)
	call TriggerAddCondition(t, Condition(function PVI))
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call SaveReal(HY, h, 20,((IXX)* 1.))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffect(s, x, y)))
	set t = null
	set trigUnit = null
endfunction
function PEI takes nothing returns boolean
	local unit t = GetFilterUnit()
	local integer damageValue = 0
	local integer h = GetHandleId(t)
	local integer ETX = 344691
	local boolean b = false
	if IsUnitAlly(t, EG) and GetUnitAbilityLevel(t,'A04R') == 0 and UnitAlive(t) then
		if LoadBoolean(HY, h, ETX) then
			set damageValue = LoadInteger(HY, h, ETX)
			set b = true
		endif
		if IsUnitIdType(GetUnitTypeId(t), UNIT_TYPE_HERO) then
			if IsUnitType(t, UNIT_TYPE_RANGED_ATTACKER) == IsUnitType(VG, UNIT_TYPE_RANGED_ATTACKER) and IsUnitType(t, UNIT_TYPE_MELEE_ATTACKER) == IsUnitType(VG, UNIT_TYPE_MELEE_ATTACKER) then
				if b or GetUnitAbilityLevel(t,'D006')> 0 then
					if OG then
						if damageValue != XG then
							call UnitReduceStateBonus(t, damageValue, UNIT_BONUS_DAMAGE)
							call SaveInteger(HY, h, ETX, XG)
							call UnitAddStateBonus(t, XG, UNIT_BONUS_DAMAGE)
						endif
					else
						call WHV(t,'D006')
						call UnitReduceStateBonus(t, damageValue, UNIT_BONUS_DAMAGE)
						call SaveInteger(HY, h, ETX, 0)
						call SaveBoolean(HY, h, ETX, false)
					endif
				else
					if OG then
						call SaveInteger(HY, h, ETX, XG)
						call SaveBoolean(HY, h, ETX, true)
						call UnitAddStateBonus(t, XG, UNIT_BONUS_DAMAGE)
						call UnitAddAbilityLevel1ToTimed(t,'C006','D006',-1)
					endif
				endif
			else
				if b then
					call UnitReduceStateBonus(t, damageValue, UNIT_BONUS_DAMAGE)
					call SaveInteger(HY, h, ETX, 0)
					call SaveBoolean(HY, h, ETX, false)
					call WHV(t,'D006')
				endif
			endif
		else
			if IsUnitType(t, UNIT_TYPE_RANGED_ATTACKER) and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false then
				if b then
					if OG and LoadInteger(HY, GetHandleId(VG), 344692) == 1 then
						if damageValue != XG then
							call SaveInteger(HY, h, ETX, XG)
							call UnitReduceStateBonus(t, damageValue, UNIT_BONUS_DAMAGE)
							call UnitAddStateBonus(t, XG, UNIT_BONUS_DAMAGE)
						endif
					else
						call WHV(t,'D006')
						call UnitReduceStateBonus(t, damageValue, UNIT_BONUS_DAMAGE)
						call SaveInteger(HY, h, ETX, 0)
						call SaveBoolean(HY, h, ETX, false)
					endif
				else
					if OG and LoadInteger(HY, GetHandleId(VG), 344692) == 1 then
						call SaveInteger(HY, h, ETX, XG)
						call SaveBoolean(HY, h, ETX, true)
						call UnitAddStateBonus(t, XG, UNIT_BONUS_DAMAGE)
						call UnitAddAbilityLevel1ToTimed(t,'C006','D006',-1)
					endif
				endif
			endif
		endif
	endif
	set t = null
	return false
endfunction
function PXI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer level = GetUnitAbilityLevel(u,'A2O2')
	local real DRO = GetHeroMaxAttributeValue(u)* 1.
	local integer damageValue = R2I(( 12+ 6 * level)* DRO / 100.)
	local boolean POI = LoadBoolean(HY, h, 10) and LoadInteger(HY,(GetHandleId(u)), 704)!='A2O2'
	local player p = LoadPlayerHandle(HY, h, 10)
	local boolean PRI
	set VG = u
	set EG = GetOwningPlayer(u)
	set XG = damageValue
	set OG = true
	set PRI = p != EG
	if UnitIsDead(u) or u == null or GetUnitTypeId(u)< 1 or POI or PRI or GetUnitAbilityLevel(u,'A36D') == 1 then
		set XG = 0
		set OG = false
	endif
	if PRI then
		set EG = p
	endif
	call GroupEnumUnitsInRange(YF, 0, 0, 12000, Condition(function PEI))
	if PRI then
		call SavePlayerHandle(HY, h, 10, GetOwningPlayer(u))
	endif
	if POI then
		call RemoveSavedHandle(HY, GetHandleId(u),'TSHT')
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	endif
	set t = null
	set u = null
endfunction
function PII takes unit u returns nothing
	local timer t = null
	local integer h
	if HaveSavedHandle(HY, GetHandleId(u),'TSHT') == false then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, .5, true, function PXI)
		call SaveUnitHandle(HY, h, 0, u)
		call SaveTimerHandle(HY, GetHandleId(u),'TSHT', t)
		call SaveBoolean(HY, h, 10, LoadInteger(HY,(GetHandleId(u)), 704)=='A2O2')
		call SavePlayerHandle(HY, h, 10, GetOwningPlayer(u))
		set t = null
	endif
endfunction
function L4E takes nothing returns nothing
	call PII(GetTriggerUnit())
endfunction
function PAI takes nothing returns nothing
	call PII(U2)
endfunction
function F0E takes nothing returns nothing
	call EPX(GetTriggerUnit(), 344692, 30)
endfunction
function PNI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local real I3X = LoadReal(HY, h, 13)
	local real EOX = LoadReal(HY, h, 138)
	local real O3O = LoadInteger(HY, h, 0)
	local real PBI = EOX / O3O
	local real M8R
	local real M9R
	local integer c = GetTriggerEvalCount(t)
	if c > O3O or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call KillTreeByCircle(GetUnitX(targetUnit), GetUnitY(targetUnit), 100)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set M8R = CoordinateX50(GetUnitX(targetUnit)+ PBI * Cos(I3X))
		set M9R = CoordinateY50(GetUnitY(targetUnit)+ PBI * Sin(I3X))
		call SetUnitX(targetUnit, M8R)
		call SetUnitY(targetUnit, M9R)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function PCI takes unit dummyUnit, unit targetUnit, unit whichUnit, real x, real y returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real I3X = Atan2(GetUnitY(targetUnit)-GetUnitY(dummyUnit), GetUnitX(targetUnit)-GetUnitX(dummyUnit))
	local real EOX = GetDistanceBetween(x, y, GetUnitX(targetUnit), GetUnitY(targetUnit))
	local real PDI = RMaxBJ(1, 350 *(1 -EOX / 900))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveReal(HY, h, 13,(I3X * 1.))
	call SaveReal(HY, h, 138,(PDI * 1.))
	call SaveInteger(HY, h, 0, 25 + 5 * GetUnitUserData(dummyUnit))
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function PNI))
	set t = null
endfunction
function PFI takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), RN) == false and GetEnumUnit()!= Roshan then
		call GroupAddUnit(RN, GetEnumUnit())
		call PCI(U2, GetEnumUnit(), EN, XN, ON)
	endif
endfunction
function PGI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit dummyUnit = LoadUnitHandle(HY, h, 19)
	local real I3X = LoadReal(HY, h, 137)
	local real PXR = LoadReal(HY, h, 64)
	local real POR = LoadReal(HY, h, 65)
	local real PRR = LoadReal(HY, h, 66)
	local real PIR = LoadReal(HY, h, 67)
	local group g = LoadGroupHandle(HY, h, 22)
	local real PHI = GetUnitX(dummyUnit)
	local real PJI = GetUnitY(dummyUnit)
	local group gg
	local unit PKI = LoadUnitHandle(HY, h, 0)
	if GetDistanceBetween(PHI, PJI, PRR, PIR)< 100  then
		set PHI = PRR
		set PJI = PIR
	else
		set PHI = PHI + 40 * Cos(I3X)
		set PJI = PJI + 40 * Sin(I3X)
	endif
	set PHI = CoordinateX50(PHI)
	set PJI = CoordinateY50(PJI)
	call SetUnitX(dummyUnit, PHI)
	call SetUnitY(dummyUnit, PJI)
	call SetUnitX(PKI, PHI)
	call SetUnitY(PKI, PJI)
	if ModuloInteger(GetTriggerEvalCount(t), 2) == 1 and GetTriggerEvalCount(t)< 20 then
		call IssuePointOrderById(PKI, 852592, PHI, PJI)
	endif
	set gg = AllocationGroup(343)
	set U2 = dummyUnit
	set EN = whichUnit
	set XN = PXR
	set ON = POR
	set RN = g
	call GroupEnumUnitsInRange(gg, PHI, PJI, 275, Condition(function DJX))
	call ForGroup(gg, function PFI)
	call DeallocateGroup(gg)
	if (PHI == PRR and PJI == PIR) or GetTriggerEvalCount(t)> 35 then
		set gg = AllocationGroup(344)
		set U2 = dummyUnit
		set EN = whichUnit
		set XN = PXR
		set ON = POR
		set RN = g
		call GroupEnumUnitsInRange(gg, PHI, PJI, 275, Condition(function DJX))
		call ForGroup(gg, function PFI)
		call DeallocateGroup(gg)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(dummyUnit)
		call DeallocateGroup(g)
	endif
	set PKI = null
	set t = null
	set dummyUnit = null
	set g = null
	set gg = null
	set whichUnit = null
	return false
endfunction
function O7E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local location l = GetSpellTargetLoc()
	local unit u = GetTriggerUnit()
	local real x = GetLocationX(l)
	local real y = GetLocationY(l)
	local real I3X = Atan2(y -GetUnitY(u), x -GetUnitX(u))
	local unit d = CreateUnit(GetOwningPlayer(u),'h02J', GetUnitX(u), GetUnitY(u), I3X * bj_RADTODEG)
	local unit PKI = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call UnitAddAbility(PKI,'A0QB')
	call SetUnitAbilityLevel(PKI,'A0QB', GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function PGI))
	call SaveUnitHandle(HY, h, 2, u)
	call SaveUnitHandle(HY, h, 19, d)
	call SetUnitUserData(d, GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call SaveUnitHandle(HY, h, 0, PKI)
	call SaveReal(HY, h, 137,(I3X * 1.))
	call SaveReal(HY, h, 64, GetUnitX(u))
	call SaveReal(HY, h, 65, GetUnitY(u))
	call SaveReal(HY, h, 66, GetUnitX(u)+ 900 * Cos(I3X))
	call SaveReal(HY, h, 67, GetUnitY(u)+ 900 * Sin(I3X))
	call SaveGroupHandle(HY, h, 22, AllocationGroup(345))
	call RemoveLocation(l)
	set t = null
	set PKI = null
	set l = null
	set d = null
	set u = null
endfunction
function PLI takes nothing returns nothing
	local unit t = GetFilterUnit()
	local unit u = Temp__ArrayUnit[0]
	if OK and IsUnitType(t, UNIT_TYPE_HERO) and IsUnitEnemy(u, GetOwningPlayer(t)) and IsAliveNotStrucNotWard(GetFilterUnit()) then
		set OK = false
	endif
	set t = null
	set u = null
endfunction
function PMI takes nothing returns nothing
	local integer level
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer id ='A0VC'
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetHandleId(u)> 0 then
		set Temp__ArrayUnit[0]= u
		set OK = true
		if LoadBoolean(HY, h, 0) == false then
			if GetUnitAbilityLevel(u, id)< GetUnitAbilityLevel(u,'QF88') then
				call SetUnitAbilityLevel(u, id, GetUnitAbilityLevel(u,'QF88'))
			endif
		endif
		call GroupEnumUnitsInRange(AK, GetWidgetX(u), GetWidgetY(u), 400 + 25, Condition(function PLI))
		if OK and GetUnitAbilityLevel(u,'A36D') == 0 then
			call SaveInteger(HY, h, 1, 0)
			if LoadBoolean(HY, h, 0) then
				set level = LoadInteger(HY, h, 0)
			else
				set level = GetUnitAbilityLevel(u,'QF88')
			endif
			if GetUnitAbilityLevel(u,'A2NX')!= level then
				call UnitAddPermanentAbility(u,'A2NX')
				call UnitAddPermanentAbility(u,'A3B6')
				call SetUnitAbilityLevel(u,'A2NX', level)
				if GetHeroMainAttributesType(u)!= HERO_ATTRIBUTE_AGI then
					call UnitAddPermanentAbility(u,'A33L')
					call SetUnitAbilityLevel(u,'A33L', level)
				endif
			endif
			set u = null
			set t = null
			return
		elseif OK == false then
			call SaveInteger(HY, h, 1, LoadInteger(HY, h, 1)+ 1)
			if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) and LoadInteger(HY, h, 1)< 40 then
				set u = null
				set t = null
				return
			endif
		endif
		call UnitRemoveAbility(u,'A2NX')
		call UnitRemoveAbility(u,'A33L')
		call UnitRemoveAbility(u,'A3B6')
	else
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	endif
	set u = null
	set t = null
endfunction

function Q_A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetGameTime()> LoadReal(HY, h, 0) or GetUnitAbilityLevel(u,'B0DM') == 0 then
		call UnitRemoveAbility(u,'A2OV')
		call UnitRemoveAbility(u,'A2OU')
		call UnitRemoveAbility(u,'B0DM')
		call RemoveSavedHandle(HY, GetHandleId(u),'A2OV')
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	else
		call UnitDamageTargetEx(LoadUnitHandle(HY, h, 1), u, 1, 4)
	endif
	set u = null
	set t = null
endfunction
function Q0A takes unit u, unit sou, boolean b returns nothing
	local timer t = LoadTimerHandle(HY, GetHandleId(u),'A2OV')
	local integer h
	local integer id
	if b then
		set id = 'A2OV'
	else
		set id = 'A2OU'
	endif
	if t != null then
		set h = GetHandleId(t)
		if b != LoadBoolean(HY, h, 1) then
			call UnitRemoveAbility(u,'A2OV')
			call UnitRemoveAbility(u,'A2OU')
			call UnitRemoveAbility(u,'B0DM')
			call UnitAddPermanentAbility(u, id)
		endif
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, 1., true, function Q_A)
		call UnitAddPermanentAbility(u, id)
		call SaveUnitHandle(HY, h, 0, u)
		call SaveUnitHandle(HY, h, 1, sou)
		call SaveTimerHandle(HY, GetHandleId(u),'A2OV', t)
	endif
	call SaveBoolean(HY, h, 1, b)
	call SaveReal(HY, h, 0, GetGameTime()+ 4.)
	set t = null
endfunction

function QYA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	if GetGameTime()> LoadReal(HY, h, 0) or GetUnitAbilityLevel(LoadUnitHandle(HY, h, 0),'A40W') == 0 then
		call ResetUnitVertexColor(LoadUnitHandle(HY, h, 0))
		call UnitRemoveAbility(LoadUnitHandle(HY, h, 0),'A40W')
		call UnitRemoveAbility(LoadUnitHandle(HY, h, 0),'B0HF')
		call RemoveSavedHandle(HY, GetHandleId(LoadUnitHandle(HY, h, 0)),'A40W')
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	endif
	set t = null
endfunction
function QZA takes unit u, boolean ZOO returns nothing
	local timer t = LoadTimerHandle(HY, GetHandleId(u),'A40W')
	local integer h
	if t != null then
		set h = GetHandleId(t)
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, .1, true, function QYA)
		call UnitAddPermanentAbility(u,'A40W')
		call SaveUnitHandle(HY, h, 0, u)
		call SaveTimerHandle(HY, GetHandleId(u),'A40W', t)
	endif
	if ZOO then
		call SaveReal(HY, h, 0, GetGameTime()+ 5)
	else
		call SaveReal(HY, h, 0, GetGameTime()+ 2.5)
	endif
	call JFX(u)
	set t = null
endfunction

function TGA takes unit whichUnit, unit targetUnit, integer i returns nothing
	if i == 1 then
		call UnitDamageTargetEx(whichUnit, targetUnit, 2, 40 + 20 * GetUnitAbilityLevel(whichUnit,'A0JJ'))
		call CommonUnitAddStun(targetUnit, 1., true)
	elseif i == 2 then
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 30 + 10 * GetUnitAbilityLevel(whichUnit,'A081'))
		call CommonUnitAddStun(targetUnit, 1., true)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl", targetUnit, "chest"))
	elseif i == 3 then
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 10 + 10 * GetUnitAbilityLevel(whichUnit,'A09E'))
		call CommonUnitAddStun(targetUnit, .4 + .4 * GetUnitAbilityLevel(whichUnit,'A09E'), true)
	elseif i == 4 then
		call CommonUnitAddStun(targetUnit, 1.4, true)
	elseif i == 5 then
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 100)
		call CommonUnitAddStun(targetUnit, 0.01, true)
	elseif i == 6 then
		call CommonUnitAddStun(targetUnit, 1., true)
	endif
endfunction

function Z1I takes unit u, unit t returns nothing
	local unit d
	local integer i
	if GetUnitAbilityLevel(u,'A061') == 1 then
		if TKV(u, 'A061', 35) then	//金箍棒
			call TGA(u, t, 5)
		endif
	endif
	if GetItemOfTypeFromUnit(u, XOV[I5V])!= null then	//散夜对剑
		if TKV(u, XOV[I5V], 16) then
			call ISO(t)
		endif
	elseif GetItemOfTypeFromUnit(u, XOV[IPV])!= null or GetItemOfTypeFromUnit(u, XOV[RLV])!= null or GetItemOfTypeFromUnit(u, XOV[N1V])!= null then
		if TKV(u, XOV[IPV], 15) then	//散华和天堂之戟和白银之锋
			call IYO(t)
		endif
	endif
	if GetUnitAbilityLevel(u,'A3L2')> 0 then	//深渊之刃和小晕锤
		if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
			set i = 25
		else
			set i = 10
		endif
		if LoadInteger(HY, GetHandleId(u),'bash')!= 1 and TKV(u,'A3L2', i) then
			if GetUnitAbilityLevel(u,'A3TZ') == 1 then
				call YDWESetUnitAbilityState(u,'A3TZ', 1, 2.3)
			endif
			call EPX(u,'bash', 2.3)
			call TGA(u, t, 4)
		endif
	endif
	if GetUnitAbilityLevel(u,'A0JH')> 0 or GetUnitAbilityLevel(u,'A0FJ')> 0 then
		call B1O(u, t)	//漩涡和雷神之锤
	endif
	if GetUnitAbilityLevel(u,'Afbt')> 0 and IsUnitMagicImmune(t) == false then
		call B4O(u, t)	//净魂之刃1-2级
	endif
	call B7R(u, t)	//黯灭
	if GetUnitAbilityLevel(u,'A2KV')> 0 then	//斯嘉蒂之眼
		call QZA(t, IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER))
	endif
	if GetUnitAbilityLevel(u,'A1V7')> 0 then	//淬毒之珠
		call Q0A(t, u, IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER))
	endif
	set d = null
endfunction


function MarksmanshipActions takes nothing returns nothing
	local unit target = MissileHitTargetUnit
	local integer h = GetHandleId(GetTriggeringTrigger())
	call UnitDamageTargetEx(LoadUnitHandle(HY, h,'xhts'), target, 2, LoadReal(HY, h,'xhts'))
	call Z1I(LoadUnitHandle(HY, h,'xhts'), target)
	set target = null
endfunction

function Marksmanship_tsw takes unit u, unit u2, unit target, real damage returns nothing
	local trigger t = LaunchMissileByUnitDummy(u2, target,'h30C', "MarksmanshipActions", 900, true)
	local integer h = GetHandleId(t)
	
	call SaveReal(HY, h,'xhts', damage)
	call SaveUnitHandle(HY, h,'xhts', u)
	set t = null
endfunction

function MarksmanshipEnumTarget takes nothing returns boolean
	return(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()) and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) ) != null
endfunction

function MarksmanshipEnum takes unit u, unit target returns nothing
	local unit fu
	local group g = AllocationGroup(346) 
	local real damage
	local integer i = 1
	set U2 = u
	call GroupEnumUnitsInRange(g, GetUnitX(target), GetUnitY(target), 475, Condition(function MarksmanshipEnumTarget))
	set damage = (GetUnitState(u, UNIT_STATE_ATTACK1_DAMAGE_BASE) + GetUnitState(u, UNIT_STATE_ATTACK1_DAMAGE_BONUS) )* 0.5
	
	loop
		set fu = GroupPickRandomUnit(g)
	exitwhen(fu == null or i > 3)
		if target != fu then
			call Marksmanship_tsw(u, target, fu, damage)
			
			set i = i + 1
		endif
		call GroupRemoveUnit(g, fu)
	endloop
	call DeallocateGroup(g)
	set fu = null
	set g = null
endfunction

function Marksmanship takes nothing returns nothing
	if GetUnitAbilityLevel(DESource,'A36D') == 0 and GetUnitAbilityLevel(DESource,'S3UR')> 0 and IsUnitEnemy(DESource, GetOwningPlayer(DETarget)) then
		call MarksmanshipEnum(DESource, DETarget)
	endif
endfunction


function L5E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local timer t = CreateTimer()
	local integer id ='A0VC'
	
	call RegisterUnitAttackEvent("Marksmanship", 0)
	
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveBoolean(HY, GetHandleId(u), 4336821, false)
	call TimerStart(t, .1, true, function PMI)
	set t = null
	set u = null
endfunction
function PPI takes unit u, integer level returns nothing
	local timer t = CreateTimer()
	local integer pid = GetPlayerId(GetOwningPlayer(u))
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call TimerStart(t, .1, true, function PMI)
	call SaveInteger(HY, GetHandleId(t), 0, level)
	call SaveBoolean(HY, GetHandleId(t), 0, true)
	set t = null
endfunction
function I8R takes nothing returns nothing
	local unit PQI = LoadUnitHandle(OtherHashTable2,'ILLU', 0)
	local unit PSI = LoadUnitHandle(OtherHashTable2,'ILLU', 1)
	call RemoveSavedHandle(OtherHashTable2,'ILLU', 0)
	call RemoveSavedHandle(OtherHashTable2,'ILLU', 1)
	if GetUnitAbilityLevel(PSI,'A0VC')> 0 then
		call PPI(PQI, GetUnitAbilityLevel(PSI,'A0VC'))
	endif
	set PQI = null
	set PSI = null
endfunction
function PTI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 5)
	local real IXX
	if level == 1 then
		set IXX = 15
	elseif level == 2 then
		set IXX = 30
	elseif level == 3 then
		set IXX = 40
	elseif level == 4 then
		set IXX = 50
	endif
	if GetTriggerEvalCount(t) == 3 or GetTriggerEvalCount(t) == 4 then
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, IXX)
	endif
	if GetTriggerEvalCount(t) == 4 then
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call UnitRemoveAbility(targetUnit,'A1VS')
		call UnitRemoveAbility(targetUnit,'B0DN')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function PUI takes unit damageSource, unit targetUnit, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function PTI))
	call SaveUnitHandle(HY, h, 2, damageSource)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveInteger(HY, h, 5, level)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl", targetUnit, "chest"))
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(targetUnit),'A1VS', false)
	call UnitAddPermanentAbility(targetUnit,'A1VS')
	set t = null
endfunction
function PWI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamageSource() == LoadUnitHandle(HY, h, 0) then
			if GetUnitAbilityLevel(GetTriggerUnit(),'A3E9') == 1 and IsUnitMagicImmune(LoadUnitHandle(HY, h, 1)) == false and LoadBoolean(HY, h, 0) == false then
				call SaveUnitHandle(OtherHashTable2,'A3E9', 0, GetTriggerUnit())
				call SaveUnitHandle(OtherHashTable2,'A3E9', 1, LoadUnitHandle(HY, h, 1))
				call SaveInteger(OtherHashTable2,'A3E9', 0, R2I(LoadReal(HY, h, 0)))
				call ExecuteFunc("PYI")
			endif
			call CommonUnitAddStun(GetTriggerUnit(), 2., false)
			call UnitDamageTargetEx(LoadUnitHandle(HY, h, 1), GetTriggerUnit(), 1, 50 * LoadReal(HY, h, 0))
			call PUI(LoadUnitHandle(HY, h, 1), GetTriggerUnit(), R2I(LoadReal(HY, h, 0)))
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	endif
	set t = null
endfunction
function PZI takes unit whichUnit, unit targetUnit, integer level, boolean FAR returns nothing
	local trigger t
	local integer h
	local unit d = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	call UnitAddAbility(d,'A42G')
	call B0R(d, targetUnit, 852095)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 5, false)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function PWI))
	call SaveUnitHandle(HY, h, 0, d)
	call SaveUnitHandle(HY, h, 1, whichUnit)
	call SaveReal(HY, h, 0, level)
	call SaveBoolean(HY, h, 0, FAR)
	set t = null
	set d = null
endfunction
function O8E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call PZI(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()), false)
	endif
endfunction
function PYI takes nothing returns nothing
	local unit whichUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 0)
	local unit targetUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 1)
	local integer level = LoadInteger(OtherHashTable2,'A3E9', 0)
	call T4V(LoadUnitHandle(OtherHashTable2,'A3E9', 0))
	if UnitHasSpellShield(targetUnit) == false then
		call PZI(whichUnit, targetUnit, level, true)
	endif
	set whichUnit = null
	set targetUnit = null
	call FlushChildHashtable(OtherHashTable2,'A3E9')
endfunction
function P_I takes nothing returns boolean
	return CZX(GetUnitTypeId(GetFilterUnit()))
endfunction

function P0I takes unit killingUnit, unit u returns nothing
	local group g = AllocationGroup(347)
	local unit u2
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(u), Condition(function P_I))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call UnitRemoveAbility(u2,'Avul')
		if IsUnitType(u2, UNIT_TYPE_SUMMONED) == false then
			call UnitRemoveBuffs(u2, true, true)
		endif
		call UnitRemoveAbility(u2,'Aetl')
		call SetUnitInvulnerable(u2, false)
		call UnitDamageTargetEx(killingUnit, u2, 1, 99999999)
		call UnitDamageTargetEx(killingUnit, u2, 2, 99999999)
		call UnitDamageTargetEx(killingUnit, u2, 3, 99999999)
		call UnitDamageTargetEx(killingUnit, u2, 7, 99999999)
		call UnitDamageTargetEx(killingUnit, u2, 10, 99999999)
		call GroupRemoveUnit(g, u2)
	endloop
	call DeallocateGroup(g)
	set u2 = null
	set g = null
endfunction

function K6E takes nothing returns nothing
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIfb\\AIfbSpecialArt.mdl", GetTriggerUnit(), GetHeroWeaponAttachPointName(GetTriggerUnit())))
endfunction

function AhalimReincarnation_Actions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		if GetUnitAbilityLevel(u,'A3DA') == 1 then
			call UnitRemoveAbility(u,'A3DA')
			call UnitRemoveAbility(u,'B3DA')
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call ResetUnitVertexColor(u)
			call BZR(u)
		elseif GetUnitAbilityLevel(u,'A3D9') == 1 then
			// 如果有盾或者自杀就倒闭
			if LoadBoolean(HY, GetHandleId(u),'suic') or GetUnitAbilityLevel(u,'AIrc') == 1 then
				call UnitRemoveAbility(u,'A3DK')
				call UnitRemoveAbility(u,'B3I9')
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			else
				// 正常死亡 0 0.1 4 秒计时器
				call TriggerRegisterTimerEvent(t, 0, false)
				call TriggerRegisterTimerEvent(t, .1, false)
				call TriggerRegisterTimerEvent(t, 4, false)
				call SaveUnitHandle(HY, h, 0, u)
				call SaveReal(HY, h, 10, GetUnitState(u, UNIT_STATE_MANA))
			endif
		else
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
		call RemoveSavedHandle(HY, GetHandleId(u),'Leor')
	else
		//============================================
		// 计时器到期事件	
		set u = LoadUnitHandle(HY, h, 0)
		if LoadInteger(HY, h, 0) == 0 then // 0秒 复活了
			call UnitRemoveAbility(u,'A3DK')
			call UnitRemoveAbility(u,'B3I9')
			call UnitAddPermanentAbility(u,'A3DA')
			call SaveInteger(HY, h, 0, 1)
			call SetUnitVertexColor(u, 140, 120, 100, 70)
			call DisableUnitBloodstone(u)
			if LoadInteger(HY, GetHandleId(u), 4333) == 1 then
				call EPX(u, 4334, 4.01)
			endif
			if LoadInteger(HY, GetHandleId(u), 4418) == 1 then
				call EPX(u, 4419, 4.01)
			endif
		elseif LoadInteger(HY, h, 0) == 1 then
			call SaveInteger(HY, h, 0, 2)
			call SelectUnitAddForPlayer(u, GetOwningPlayer(u))
			call SetUnitState(u, UNIT_STATE_MANA, LoadReal(HY, h, 10))
		else
			call UnitRemoveAbility(u,'A3DA')
			call UnitRemoveAbility(u,'B3DA')
			call ResetUnitVertexColor(u)
			call UnitRemoveAbility(u,'Avul')
			call SetUnitInvulnerable(u, false)
			if not IsUnitType(u, UNIT_TYPE_SUMMONED) then
				call UnitRemoveBuffs(u, true, true)
			endif
			call UnitRemoveAbility(u,'Aetl')
			call SetWidgetLife(u, 1)
			if LoadUnitHandle(HY, GetHandleId(u),'lstd')!= null then
				call UnitDamageTargetEx(LoadUnitHandle(HY, GetHandleId(u),'lstd'), u, 1, 99999999)
				call UnitDamageTargetEx(LoadUnitHandle(HY, GetHandleId(u),'lstd'), u, 2, 99999999)
				call UnitDamageTargetEx(LoadUnitHandle(HY, GetHandleId(u),'lstd'), u, 3, 99999999)
				call UnitDamageTargetEx(LoadUnitHandle(HY, GetHandleId(u),'lstd'), u, 7, 99999999)
				call UnitDamageTargetEx(LoadUnitHandle(HY, GetHandleId(u),'lstd'), u, 10, 99999999)
				if UnitAlive(u) then
					if GetHandleId(LoadUnitHandle(HY, GetHandleId(u),'lstd')) == 0 then
						call KillUnit(u)
					else
						if GetUnitAbilityLevel(u,'A0MQ')> 0 or GetUnitAbilityLevel(u,'A1B6')> 0 then
							call P0I(LoadUnitHandle(HY, GetHandleId(u),'lstd'), u)
						endif
					endif
				endif
			else
				call KillUnit(u)
			endif
			call BZR(u)
			if not UnitAlive(u) then
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			else
				call TriggerRegisterTimerEvent(t, .02, true)
			endif
		endif
	endif
	set t = null
	set u = null
	return false
endfunction

// 给单位添加效果
function register_AhalimReincarnation takes unit whichUnit returns nothing
	local trigger t
	local integer h
	local integer hu = GetHandleId(whichUnit)
	if not HaveSavedHandle(HY, hu,'Leor') and GetUnitAbilityLevel(whichUnit,'A3DA') == 0 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, hu,'Leor', t)
		call TriggerRegisterDeathEvent(t, whichUnit)
		call TriggerAddCondition(t, Condition(function AhalimReincarnation_Actions))
	endif
	set t = null
endfunction
// 绿翔光环 0.3秒粘滞时间
function EnumAddBuff_Reincarnation takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit skeletonKing = LoadUnitHandle(HY, h, 0)
	local group auraGroup = LoadGroupHandle(HY, h, 1)
	local group enumGroup
	local unit firstUnit
	// 单位死亡并且在重生 或者单位失去技能了
	if ( not UnitAlive(skeletonKing) and LoadInteger(HY, GetHandleId(skeletonKing),'A1AZ')!= 1) or GetUnitAbilityLevel(skeletonKing,'A1AZ') == 0 then
		loop
			set firstUnit = FirstOfGroup(auraGroup)
		exitwhen firstUnit == null
			call UnitRemoveAbility(firstUnit,'A3DK')
			call UnitRemoveAbility(firstUnit,'B3I9')
			call GroupRemoveUnit(auraGroup, firstUnit)
		endloop
	else
		set U2 = skeletonKing
		set enumGroup = AllocationGroup(348)
		call GroupEnumUnitsInRange(enumGroup, GetUnitX(skeletonKing), GetUnitY(skeletonKing), 1225, null)
		//=======================================
		// remove
		loop
			set firstUnit = FirstOfGroup(auraGroup)
		exitwhen firstUnit == null
			if not IsUnitInGroup(firstUnit, enumGroup) then
				call UnitRemoveAbility(firstUnit,'A3DK')
				call UnitRemoveAbility(firstUnit,'B3I9')
			endif
			call GroupRemoveUnit(auraGroup, firstUnit)
		endloop
		//=======================================
		// add
		loop
			set firstUnit = FirstOfGroup(enumGroup)
		exitwhen firstUnit == null
			call GroupRemoveUnit(enumGroup, firstUnit)
			// 友军 存活 非建筑 非守卫 英雄 并且没有绿翔光环
			if IsUnitAlly(U2, GetOwningPlayer(firstUnit)) and IsAliveNotStrucNotWard(firstUnit) and IsUnitType(firstUnit, UNIT_TYPE_HERO) and GetUnitAbilityLevel(firstUnit,'A3DA') == 0 then
				call GroupAddUnit(auraGroup, firstUnit)
				if GetUnitAbilityLevel(firstUnit,'A3DK') == 0 then
					call UnitAddPermanentAbility(firstUnit,'A3DK')
					call UnitMakeAbilityPermanent(firstUnit, true,'A3D9')
					call UnitMakeAbilityPermanent(firstUnit, true,'A3I9')
				endif
				call register_AhalimReincarnation(firstUnit)
			endif
		endloop
		call DeallocateGroup(enumGroup)
		//=======================================
	endif
	set t = null
	set skeletonKing = null
	set auraGroup = null
	set enumGroup = null
	set firstUnit = null
	return false
endfunction

function P4I takes unit u returns nothing
	local trigger t
	local integer h
	local integer hu = GetHandleId(u)
	if HaveSavedHandle(HY, hu,'LeoR') == false then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, hu,'LeoR', t)
		call TriggerRegisterTimerEvent(t, .3, true)
		call SaveUnitHandle(HY, h, 0, u)
		call SaveGroupHandle(HY, h, 1, AllocationGroup(349))
		call TriggerAddCondition(t, Condition(function EnumAddBuff_Reincarnation))
	endif
	call SetAllPlayerAbilityUnavailable('A3DK')
	set t = null
endfunction

function HRX takes nothing returns nothing
	call P4I(U2)
endfunction

function P5I takes unit u, unit t returns nothing	//吸血光环
	local integer lv
	local real i
	if GetUnitAbilityLevel(t,'A04R') == 0 and IsUnitIllusion(t) == false and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false and IsUnitType(t, UNIT_TYPE_MECHANICAL) == false and IsUnitEnemy(u, GetOwningPlayer(t)) and(GetUnitAbilityLevel(u,'BVA1')> 0 or GetUnitAbilityLevel(u,'BVA2')> 0 or GetUnitAbilityLevel(u,'BVA3')> 0 or GetUnitAbilityLevel(u,'BVA4')> 0) and UnitAlive(u) then
		set lv = GetUnitAbilityLevel(u,'BVA1')+ GetUnitAbilityLevel(u,'BVA2')* 2 + GetUnitAbilityLevel(u,'BVA3')* 3 + GetUnitAbilityLevel(u,'BVA4')* 4
		set i = .1 + .05 * lv
		call SetWidgetLife(u, GetWidgetLife(u)+ GetEventDamage()* i)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl", u, "origin"))
	endif
endfunction
function P6I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	local integer id
	local integer lv
	local real c
	local unit d
	if GetTriggerEvalCount(t) == 1 then
		set id = LoadInteger(HY, h, 1)
		set lv = GetUnitAbilityLevel(u, id)
		set c = YDWEGetUnitAbilityState(u, id, 1)
		set id = 280 - 60 * lv
		if c == id or c == (id * 0.75) then
			set d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
			call UnitAddAbility(d,'A274')
			call IssueImmediateOrderById(d, 852096)
		endif
	else
		call SelectUnitForPlayerSingle(u, GetOwningPlayer(u))
		call KPX(u)
		if GetUnitTypeId(u) == 'N0MH' then
			call YDWEUnitTransform( u, LoadInteger(ExtraHT, GetHandleId(u), HTKEY_UNIT_ORIGIN_TYPEID ))
		endif
		// call FixUnitSkillsBug(u)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set h = GetHandleId(u)
		if LoadBoolean(ObjectHashTable, h, StringHash("morphedburn")) then
			call RAX(u, LoadInteger(ObjectHashTable, h, StringHash("second")))
			call RAX(u, LoadInteger(ObjectHashTable, h, StringHash("first")))
			call SaveBoolean(ObjectHashTable, h, StringHash("morphedburn"), false)
		endif
	endif
	set t = null
	set u = null
	set d = null
	return false
endfunction
function ReincarnationActions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	local integer pid = GetPlayerId(GetOwningPlayer(u))
	local boolean b = false
	local real cd
	local integer id = 'A01Y'
	local integer lv = GetUnitAbilityLevel(u, id)
	local timer tim = ESV[pid]

	// debug call SingleDebug("英雄单位死亡 包括重生ReincarnationActions")
	if lv == 0 then
		set lv = GetUnitAbilityLevel(u,'A1AZ')
		set id = 'A1AZ'
	endif
	if HeroCommonSkills[PlayerSkillIndex[pid * HL + 6]]=='A01Y' then
		set tim = ETV[pid]
	endif
	if YDWEGetUnitAbilityState(u, id, 1) == 0 and GetUnitState(u, UNIT_STATE_MANA)>= 120 + 40 * lv then
		if HeroCommonSkills[PlayerSkillIndex[pid * HL + 4]]=='A01Y' or HeroCommonSkills[PlayerSkillIndex[pid * HL + 6]]=='A01Y'  then
			set b = true
			if GetUnitAbilityLevel(u,'A39S') == 1 then
				if GetUnitAbilityLevel(u,'A01Y')> 0 then
					set cd = YDWEGetUnitAbilityDataReal(u, 'A01Y', lv, 105)
					call Japi_ReduceUnitAbilityCoolDown(u,'A01Y', cd * 0.25)
				else
					set cd = YDWEGetUnitAbilityDataReal(u, 'A1AZ', lv, 105)
					call Japi_ReduceUnitAbilityCoolDown(u,'A1AZ', cd * 0.25)
				endif
				call TimerStart(tim, (280 -lv * 60)*(1. -25 * 1. / 100.), false, null)
			else
				call TimerStart(tim, (280 -lv * 60), false, null)
			endif
		endif
	endif
	if b then
		if GetUnitAbilityLevel(u,'A3DK')!= 0 then
			call UnitRemoveAbility(u,'A3DK')
		endif
		call EPX(u,'A1AZ', 3.)
		// debug call SingleDebug("		call EPX(u,'A1AZ', 3.)")
		if IsTerrainPathable(GetUnitX(u), GetUnitY(u), PATHING_TYPE_WALKABILITY) then
			call Y_X(u)
		endif
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 0, false)
		call TriggerRegisterTimerEvent(t, 3 + .01, false)
		call TriggerAddCondition(t, Condition(function P6I))
		call SaveUnitHandle(HY, h, 2,(u))
		call SaveInteger(HY, h, 1, id)
	endif
	set t = null
	set u = null
	set tim = null
	return false
endfunction
function SKill_Learn_Reincarnation takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = GetTriggerUnit()
	call TriggerRegisterDeathEvent(t, trigUnit)
	call TriggerAddCondition(t, Condition(function ReincarnationActions))
	call SaveUnitHandle(HY, h, 2,(trigUnit))
	set t = null
	set trigUnit = null
endfunction
function P8I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = GetUnitAbilityLevel(whichUnit,'A2S0')
	local real P9I = LoadReal(HY, h, 797)
	local real QVI = LoadReal(HY, h, 798)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call SaveInteger(HY, GetHandleId(whichUnit), 4338, 2)
		call SetPlayerAbilityAvailable(GetOwningPlayer(whichUnit),'AOcr', true)
		call DestroyEffect(LoadEffectHandle(HY, h, 175))
		call DestroyEffect(LoadEffectHandle(HY, h, 176))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif P9I > 0 then
		call SaveInteger(HY, GetHandleId(whichUnit), 4338, 2)
		call SetPlayerAbilityAvailable(GetOwningPlayer(whichUnit),'AOcr', true)
		call DestroyEffect(LoadEffectHandle(HY, h, 175))
		call DestroyEffect(LoadEffectHandle(HY, h, 176))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if UnitIsDead(whichUnit) == false then
			call SetWidgetLife(whichUnit, RMaxBJ(1, GetWidgetLife(whichUnit)-P9I))
		endif
		if UnitAlive(targetUnit) then
			call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+ QVI)
		endif
	else
		set P9I = GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)* .2
		call SaveReal(HY, h, 798, P9I * 1.)
		if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
			call SetWidgetLife(targetUnit, RMaxBJ(1, GetWidgetLife(targetUnit)-P9I))
		endif
		if P9I + GetWidgetLife(whichUnit)> GetUnitState(whichUnit, UNIT_STATE_MAX_LIFE) then
			set P9I = GetUnitState(whichUnit, UNIT_STATE_MAX_LIFE)-GetWidgetLife(whichUnit)
		endif
		if P9I == 0 then
			set P9I = .01
		endif
		call SetWidgetLife(whichUnit, GetWidgetLife(whichUnit)+ P9I)
		call SaveReal(HY, h, 797, P9I * 1.)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function QEI takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerRegisterTimerEvent(t, 7, false)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerAddCondition(t, Condition(function P8I))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveReal(HY, h, 797, 0)
	call SaveReal(HY, h, 798, 0)
	call SaveEffectHandle(HY, h, 175, AddSpecialEffectTarget("war3mapImported\\MortalStrikeCaster.mdx", whichUnit, "overhead"))
	call SaveEffectHandle(HY, h, 176, AddSpecialEffectTarget("war3mapImported\\MortalStrikeTarget.mdx", targetUnit, "overhead"))
	call SaveInteger(HY, GetHandleId(whichUnit), 4338, 1)
	call SetPlayerAbilityAvailable(GetOwningPlayer(whichUnit),'AOcr', false)
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function P9E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A2S0')
	if level == 1 then
		call UnitAddPermanentAbility(u,'Q251')
		call UnitMakeAbilityPermanent(u, true,'AOcr')
	endif
	call SetUnitAbilityLevel(u,'AOcr', level)
	set u = null
endfunction
function O9E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call QEI()
	endif
endfunction
function QXI takes unit whichUnit returns boolean
	return(IsUnitIllusion(whichUnit)) and GetWidgetLife(whichUnit)> .5 and GetOwningPlayer(whichUnit) == GetOwningPlayer(GetTriggerUnit())
endfunction
function QOI takes nothing returns boolean
	return QXI(GetFilterUnit())
endfunction
function QRI takes nothing returns nothing
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Feedback\\ArcaneTowerAttack.mdl", GetEnumUnit(), "origin"))
	call UnitDamageTargetEx(GetTriggerUnit(), GetEnumUnit(), 1, JW)
endfunction
function RXE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local real x
	local real y
	local real sx = GetUnitX(whichUnit)
	local real sy = GetUnitY(whichUnit)
	local group g
	local boolean QII = false
	if targetUnit != null and QXI(targetUnit) then
		set QII = true
	else
		set g = AllocationGroup(350)
		call GroupEnumUnitsInRange(g, 0, 0, 999999, Condition(function QOI))
		call GroupAddUnit(g, whichUnit)
		set targetUnit = EXX(g, GetSpellTargetX(), GetSpellTargetY())
		call DeallocateGroup(g)
		set QII = targetUnit != null
	endif
	if QII then
		set x = GetUnitX(targetUnit)
		set y = GetUnitY(targetUnit)
		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\ToonBoom\\ToonBoom.mdl", sx, sy))
		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\ToonBoom\\ToonBoom.mdl", x, y))
		call SetUnitX(whichUnit, x)
		call SetUnitY(whichUnit, y)
		set JW = 60 + GetUnitAbilityLevel(GetTriggerUnit(),'A0N8')* 40
		set g = AllocationGroup(351)
		set U2 = whichUnit
		call GroupEnumUnitsInRange(g, sx, sy, 400, Condition(function DHX))
		call ForGroup(g, function QRI)
		set U2 = whichUnit
		call GroupEnumUnitsInRange(g, x, y, 400, Condition(function DHX))
		call ForGroup(g, function QRI)
		call DeallocateGroup(g)
	endif
	set g = null
	set whichUnit = null
	set targetUnit = null
endfunction
function QAI takes nothing returns boolean
	return(IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GW)) and IsUnitMagicImmune(GetFilterUnit()) == false and(IsUnitInvision(GetFilterUnit()) == false or IsUnitVisible(GetFilterUnit(), GetOwningPlayer(GW))) and IsAliveNotStrucNotWard(GetFilterUnit()) and GetFilterUnit()!= Roshan)!= null
endfunction
function QNI takes nothing returns nothing
	local unit dummyCaster = CreateUnit(GetOwningPlayer(GW),'e00E', GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()), 0)
	call UnitAddPermanentAbility(dummyCaster,'A0NC')
	call SetUnitAbilityLevel(dummyCaster,'A0NC', Q2)
	call B0R(dummyCaster, GetEnumUnit(), 852106)
	if UnitHasSpellShield(GetEnumUnit()) == false then
		call UnitDamageTargetEx(GW, GetEnumUnit(), 1, 75 + 25 * Q2)
	endif
	set dummyCaster = null
endfunction
function QBI takes unit missileDummy, real x, real y, integer level returns nothing
	local group g = AllocationGroup(352)
	set GW = missileDummy
	set U2 = missileDummy
	call GroupEnumUnitsInRange(g, x, y, 325, Condition(function QAI))
	set JW = x
	set Q2 = level
	call ForGroup(g, function QNI)
	call DeallocateGroup(g)
	set g = null
endfunction
function QCI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit missileDummy = LoadUnitHandle(HY, h, 45)
	local real tx = LoadReal(HY, h, 47)
	local real ty = LoadReal(HY, h, 48)
	local real a = LoadReal(HY, h, 13)
	local real targetX = GetUnitX(missileDummy)+ 30 * Cos(a)
	local real targetY = GetUnitY(missileDummy)+ 30 * Sin(a)
	if (targetX -tx)*(targetX -tx)+(targetY -ty)*(targetY -ty)< 1200 then
		call SetUnitX(missileDummy, tx)
		call SetUnitY(missileDummy, ty)
		call QBI(missileDummy, tx, ty, LoadInteger(HY, h, 0))
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call KillUnit(missileDummy)
		call DestroyTimer(t)
	else
		call SetUnitX(missileDummy, targetX)
		call SetUnitY(missileDummy, targetY)
	endif
	set t = null
	set missileDummy = null
endfunction
function RAE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local real tx = CoordinateX50(GetSpellTargetX())
	local real ty = CoordinateY50(GetSpellTargetY())
	local real sx = CoordinateX50(GetUnitX(trigUnit))
	local real sy = CoordinateY50(GetUnitY(trigUnit))
	local unit missileDummy = CreateUnit(GetOwningPlayer(trigUnit),'h00C', sx, sy, 0)
	local real a = Atan2(ty -sy, tx -sx)
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SetUnitScale(missileDummy, 2, 2, 2)
	call SaveUnitHandle(HY, h, 45, missileDummy)
	call SaveReal(HY, h, 47, tx * 1.)
	call SaveReal(HY, h, 48, ty * 1.)
	call SaveReal(HY, h, 13, a * 1.)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(trigUnit, GetSpellAbilityId()))
	call TimerStart(t, .035, true, function QCI)
	set trigUnit = null
	set missileDummy = null
	set t = null
endfunction
function QDI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit QFI = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or LoadReal(HY, h, 0)< GetGameTime() or GetUnitAbilityLevel(targetUnit, LoadInteger(HY, h, 0)) == 0 then
		call UnitRemoveAbility(targetUnit, LoadInteger(HY, h, 0))
		call UnitRemoveAbility(targetUnit,'B079')
		call RemoveSavedHandle(ObjectHashTable, GetHandleId(targetUnit),'A40F')
		call FlushChildHashtable(HY, h)
		call DisableTrigger(t)
		call DestroyTrigger(t)
	else
		if ModuloInteger(GetTriggerEvalCount(t), 2) == 1 then
			call UnitDamageTargetEx(QFI, targetUnit, 1, LoadInteger(HY, h, 1)* 5 + 10)
		endif
	endif
	set QFI = null
	set targetUnit = null
	set t = null
endfunction
function QGI takes unit u returns boolean
	return GetUnitAbilityLevel(u,'A3A0') == 1 or GetUnitAbilityLevel(u,'A3A1') == 1 or GetUnitAbilityLevel(u,'A3A2') == 1 or GetUnitAbilityLevel(u,'A3A3') == 1 or GetUnitAbilityLevel(u,'A3A4') == 1 or GetUnitAbilityLevel(u,'A3A5') == 1 or GetUnitAbilityLevel(u,'A3A6') == 1 or GetUnitAbilityLevel(u,'A3A7') == 1
endfunction
function QHI takes unit u, unit targetUnit returns nothing
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(u,'A0N7')
	if QGI(targetUnit) then
		set t = LoadTriggerHandle(ObjectHashTable, GetHandleId(targetUnit),'A40F')
		set h = GetHandleId(t)
		if IsUnitType(u, UNIT_TYPE_RANGED_ATTACKER) and IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) == false then
			if GetUnitAbilityLevel(targetUnit,'A3A0'-1 + level) == 0 then
				call UnitRemoveAbility(targetUnit, LoadInteger(HY, h, 0))
				call UnitRemoveAbility(targetUnit,'B079')
				call UnitAddPermanentAbility(targetUnit,'A3A0'-1 + level)
				call SaveInteger(HY, h, 0,'A3A0'-1 + level)
			endif
		else
			if GetUnitAbilityLevel(targetUnit,'A3A4'-1 + level) == 0 then
				call UnitRemoveAbility(targetUnit, LoadInteger(HY, h, 0))
				call UnitRemoveAbility(targetUnit,'B079')
				call UnitAddPermanentAbility(targetUnit,'A3A4'-1 + level)
				call SaveInteger(HY, h, 0,'A3A4'-1 + level)
			endif
		endif
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(ObjectHashTable, GetHandleId(targetUnit),'A40F', t)
		call TriggerRegisterTimerEvent(t, .5, true)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function QDI))
		call SaveUnitHandle(HY, h, 0, u)
		call SaveUnitHandle(HY, h, 1, targetUnit)
		if IsUnitType(u, UNIT_TYPE_RANGED_ATTACKER) and IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) == false then
			call UnitAddPermanentAbility(targetUnit,'A3A0'-1 + level)
			call SaveInteger(HY, h, 0,'A3A0'-1 + level)
		else
			call UnitAddPermanentAbility(targetUnit,'A3A4'-1 + level)
			call SaveInteger(HY, h, 0,'A3A4'-1 + level)
		endif
		call SaveInteger(HY, h, 1, level)
	endif
	if Mode__BalanceOff == false and IsUnitType(u, UNIT_TYPE_RANGED_ATTACKER) and IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) == false then
		call SaveReal(HY, h, 0, GetGameTime()+ 2)
	else
		call SaveReal(HY, h, 0, GetGameTime()+ 4)
	endif
	set t = null
endfunction
function QJI takes unit whichUnit returns boolean
	return GetUnitTypeId(whichUnit)==('H00I') or GetUnitTypeId(whichUnit)==('H00J')
endfunction
function QKI takes nothing returns nothing
	local integer QLI = GetHandleId(GetTriggeringTrigger())
	local player p =(LoadPlayerHandle(HY,(QLI), 370))
	local integer QMI = GetHandleId(p)
	local unit S2X =(LoadUnitHandle(HY,(QMI), 699))
	local unit S3X =(LoadUnitHandle(HY,(QMI), 700))
	local unit S4X =(LoadUnitHandle(HY,(QMI), 701))
	local unit S5X =(LoadUnitHandle(HY,(QMI), 702))
	local unit S6X =(LoadUnitHandle(HY,(QMI), 703))
	local integer QPI = GetUnitAbilityLevel(S2X,'Aamk')* 2
	local integer VNI = GetHeroAgi(S2X, false)
	local integer QQI = GetHeroAgi(S2X, true)-VNI -QPI
	local integer VBI = GetHeroStr(S2X, false)
	local integer QSI = GetHeroStr(S2X, true)-VBI -QPI
	local integer QTI = GetHeroInt(S2X, false)
	local integer QUI = GetHeroInt(S2X, true)-QTI -QPI
	local real QWI = .25
	local integer QYI = R2I(VNI + QQI * QWI)
	local integer QZI = R2I(VBI + QSI * QWI)
	local integer Q_I = R2I(QTI + QUI * QWI)
	if GetWidgetLife(S2X)> 1 then
		if S3X != null then
			call SetHeroAgi(S3X, QYI, false)
			call SetHeroStr(S3X, QZI, false)
			call SetHeroInt(S3X, Q_I, false)
		endif
		if S4X != null then
			call SetHeroAgi(S4X, QYI, false)
			call SetHeroStr(S4X, QZI, false)
			call SetHeroInt(S4X, Q_I, false)
		endif
		if S5X != null then
			call SetHeroAgi(S5X, QYI, false)
			call SetHeroStr(S5X, QZI, false)
			call SetHeroInt(S5X, Q_I, false)
		endif
		if S6X != null then
			call SetHeroAgi(S6X, QYI, false)
			call SetHeroStr(S6X, QZI, false)
			call SetHeroInt(S6X, Q_I, false)
		endif
	endif
	set p = null
	set S2X = null
	set S3X = null
	set S4X = null
	set S5X = null
	set S6X = null
endfunction
function Q0I takes nothing returns nothing
	local integer QLI = GetHandleId(GetTriggeringTrigger())
	local player p =(LoadPlayerHandle(HY,(QLI), 370))
	local integer QMI = GetHandleId(p)
	local unit S2X =(LoadUnitHandle(HY,(QMI), 699))
	local unit S3X =(LoadUnitHandle(HY,(QMI), 700))
	local unit S4X =(LoadUnitHandle(HY,(QMI), 701))
	local unit S5X =(LoadUnitHandle(HY,(QMI), 702))
	local unit S6X =(LoadUnitHandle(HY,(QMI), 703))
	local integer Q1I = GetHandleId(S2X)
	local integer Q2I = GetHandleId(S3X)
	local integer Q3I = GetHandleId(S4X)
	local integer Q4I = GetHandleId(S5X)
	local integer Q5I = GetHandleId(S6X)
	local integer Q6I =(LoadInteger(HY,(Q1I), 367))
	local integer Q7I =(LoadInteger(HY,(Q1I), 368))
	local integer Q8I =(LoadInteger(HY,(Q2I), 367))
	local integer Q9I =(LoadInteger(HY,(Q2I), 368))
	local integer SVI =(LoadInteger(HY,(Q3I), 367))
	local integer SEI =(LoadInteger(HY,(Q3I), 368))
	local integer SXI =(LoadInteger(HY,(Q4I), 367))
	local integer SOI =(LoadInteger(HY,(Q4I), 368))
	local integer SRI =(LoadInteger(HY,(Q5I), 367))
	local integer SII =(LoadInteger(HY,(Q5I), 368))
	local integer SAI = GetHeroXP(S2X)
	local integer SNI = GetHeroXP(S3X)
	local integer SBI = GetHeroXP(S4X)
	local integer SCI = GetHeroXP(S5X)
	local integer SDI = GetHeroXP(S6X)
	local integer SFI = SAI -Q6I -Q7I
	local integer SGI = SNI -Q8I -Q9I
	local integer SHI = SBI -SVI -SEI
	local integer SJI = SCI -SXI -SOI
	local integer SKI = SDI -SRI -SII
	if GetWidgetLife(S2X)> 1 then
		set Q6I = Q6I + SFI
		set Q8I = Q8I + SGI
		set SVI = SVI + SHI
		set SXI = SXI + SJI
		set SRI = SRI + SKI
		if S2X != null then
			call AddHeroXPSimple(S3X, SFI, false)
			if GetHeroXP(S3X)!= SNI then
				set Q9I = Q9I + SFI
			endif
			call AddHeroXPSimple(S4X, SFI, false)
			if GetHeroXP(S4X)!= SBI then
				set SEI = SEI + SFI
			endif
			call AddHeroXPSimple(S5X, SFI, false)
			if GetHeroXP(S5X)!= SCI then
				set SOI = SOI + SFI
			endif
			call AddHeroXPSimple(S6X, SFI, false)
			if GetHeroXP(S6X)!= SDI then
				set SII = SII + SFI
			endif
		endif
		if S3X != null then
			call AddHeroXPSimple(S2X, SGI, false)
			if GetHeroXP(S2X)!= SAI then
				set Q7I = Q7I + SGI
			endif
			call AddHeroXPSimple(S4X, SGI, false)
			if GetHeroXP(S4X)!= SBI then
				set SEI = SEI + SGI
			endif
			call AddHeroXPSimple(S5X, SGI, false)
			if GetHeroXP(S5X)!= SCI then
				set SOI = SOI + SGI
			endif
			call AddHeroXPSimple(S6X, SGI, false)
			if GetHeroXP(S6X)!= SDI then
				set SII = SII + SGI
			endif
		endif
		if S4X != null then
			call AddHeroXPSimple(S3X, SHI, false)
			if GetHeroXP(S3X)!= SNI then
				set Q9I = Q9I + SHI
			endif
			call AddHeroXPSimple(S2X, SHI, false)
			if GetHeroXP(S2X)!= SAI then
				set Q7I = Q7I + SHI
			endif
			call AddHeroXPSimple(S5X, SHI, false)
			if GetHeroXP(S5X)!= SCI then
				set SOI = SOI + SHI
			endif
			call AddHeroXPSimple(S6X, SHI, false)
			if GetHeroXP(S6X)!= SDI then
				set SII = SII + SHI
			endif
		endif
		if S5X != null then
			call AddHeroXPSimple(S3X, SJI, false)
			if GetHeroXP(S3X)!= SNI then
				set Q9I = Q9I + SJI
			endif
			call AddHeroXPSimple(S4X, SJI, false)
			if GetHeroXP(S4X)!= SBI then
				set SEI = SEI + SJI
			endif
			call AddHeroXPSimple(S2X, SJI, false)
			if GetHeroXP(S2X)!= SAI then
				set Q7I = Q7I + SJI
			endif
			call AddHeroXPSimple(S6X, SJI, false)
			if GetHeroXP(S6X)!= SDI then
				set SII = SII + SJI
			endif
		endif
		if S6X != null then
			call AddHeroXPSimple(S3X, SKI, false)
			if GetHeroXP(S3X)!= SNI then
				set Q9I = Q9I + SKI
			endif
			call AddHeroXPSimple(S4X, SKI, false)
			if GetHeroXP(S4X)!= SBI then
				set SEI = SEI + SKI
			endif
			call AddHeroXPSimple(S2X, SKI, false)
			if GetHeroXP(S2X)!= SAI then
				set Q7I = Q7I + SKI
			endif
			call AddHeroXPSimple(S5X, SKI, false)
			if GetHeroXP(S5X)!= SCI then
				set SOI = SOI + SKI
			endif
		endif
		call SaveInteger(HY,(Q1I), 367,(Q6I))
		call SaveInteger(HY,(Q1I), 368,(Q7I))
		call SaveInteger(HY,(Q2I), 367,(Q8I))
		call SaveInteger(HY,(Q2I), 368,(Q9I))
		call SaveInteger(HY,(Q3I), 367,(SVI))
		call SaveInteger(HY,(Q3I), 368,(SEI))
		call SaveInteger(HY,(Q4I), 367,(SXI))
		call SaveInteger(HY,(Q4I), 368,(SOI))
		call SaveInteger(HY,(Q5I), 367,(SRI))
		call SaveInteger(HY,(Q5I), 368,(SII))
	endif
	set p = null
	set S2X = null
	set S3X = null
	set S4X = null
	set S5X = null
	set S6X = null
endfunction
function SLI takes nothing returns boolean
	return QJI(GetTriggerUnit()) and IsUnitIllusion(GetTriggerUnit()) == false
endfunction
function SMI takes unit SPI, unit trigUnit returns nothing
	local trigger t =(LoadTriggerHandle(HY,(GetHandleId(GetOwningPlayer(trigUnit))), 369))
	local integer i = 0
	local boolean SQI = false
	local boolean SSI = false
	local boolean STI = false
	local boolean SUI = false
	local boolean SWI = false
	local boolean SYI = false
	local boolean SZI = false
	local boolean S_I = false
	local boolean S0I = false
	call DisableTrigger(t)
	call DisableTrigger(CUV)
	loop
	exitwhen i > 5
		if GetItemTypeId(UnitItemInSlot(trigUnit, i))==(XOV[XMV]) then
			set SQI = true
		endif
		if (GetItemTypeId(UnitItemInSlot(trigUnit, i)))==(XOV[IAV]) then
			set SSI = true
		endif
		if GetItemTypeId(UnitItemInSlot(trigUnit, i))==(XOV[IDV]) then
			set STI = true
		endif
		if GetItemTypeId(UnitItemInSlot(trigUnit, i))==(XOV[ICV]) then
			set SUI = true
		endif
		if GetItemTypeId(UnitItemInSlot(trigUnit, i))==(XOV[IBV]) then
			set SWI = true
		endif
		if GetItemTypeId(UnitItemInSlot(trigUnit, i))==(XOV[NKV]) then
			set SYI = true
		endif
		if GetItemTypeId(UnitItemInSlot(trigUnit, i))==(XOV[NZV]) then
			set SZI = true
		endif
		if GetItemTypeId(UnitItemInSlot(trigUnit, i))==(XOV[RNV]) then
			set S_I = true
		endif
		if GetItemTypeId(UnitItemInSlot(trigUnit, i))==(XOV[RBV]) then
			set S0I = true
		endif
		set i = i + 1
	endloop
	if S0I then
		call UnitAddItem(SPI, CreateItem((XOV[RBV]), 0, 0))
	elseif S_I then
		call UnitAddItem(SPI, CreateItem((XOV[RNV]), 0, 0))
	elseif SZI then
		call UnitAddItem(SPI, CreateItem((XOV[NZV]), 0, 0))
	elseif SYI then
		call UnitAddItem(SPI, CreateItem((XOV[NKV]), 0, 0))
	elseif SWI then
		call UnitAddItem(SPI, CreateItem((XOV[IBV]), 0, 0))
	elseif SUI then
		call UnitAddItem(SPI, CreateItem((XOV[ICV]), 0, 0))
	elseif STI then
		call UnitAddItem(SPI, CreateItem((XOV[IDV]), 0, 0))
	elseif SSI then
		call UnitAddItem(SPI, CreateItem((XOV[IAV]), 0, 0))
	elseif SQI then
		call UnitAddItem(SPI, CreateItem((XOV[XMV]), 0, 0))
	endif
	call EnableTrigger(t)
	call EnableTrigger(CUV)
	set t = null
endfunction
function S1I takes nothing returns nothing
	local unit S3I = GetTriggerUnit()
	local integer i = 0
	local boolean SQI = false
	local boolean SSI = false
	local boolean STI = false
	local boolean SUI = false
	local boolean SWI = false
	local boolean SYI = false
	local boolean SZI = false
	local boolean S_I = false
	local boolean S0I = false
	local integer QMI = GetHandleId(GetOwningPlayer(S3I))
	local unit S2X =(LoadUnitHandle(HY,(QMI), 699))
	local unit S3X =(LoadUnitHandle(HY,(QMI), 700))
	local unit S4X =(LoadUnitHandle(HY,(QMI), 701))
	local unit S5X =(LoadUnitHandle(HY,(QMI), 702))
	local unit S6X =(LoadUnitHandle(HY,(QMI), 703))
	local integer JCX
	local boolean S4I = false
	local integer S5I = 0
	local integer S6I = 0
	local integer S7I = 0
	local integer S8I = 0
	local integer S9I = 0
	local integer TVI = 0
	local integer TEI = 0
	local integer TXI = 0
	local integer TOI = 0
	call DisableTrigger(GetTriggeringTrigger())
	if GetUnitTypeId(S3I)==('H00J') then
		call UnitRemoveItemFromSlot(S3I, 0)
		call EnableTrigger(GetTriggeringTrigger())
		return
	endif
	if not(GetItemTypeId(GetManipulatedItem())==(XOV[XMV]) or(GetItemTypeId(GetManipulatedItem()))==(XOV[IAV]) or GetItemTypeId(GetManipulatedItem())==(XOV[IDV]) or GetItemTypeId(GetManipulatedItem())==(XOV[ICV]) or GetItemTypeId(GetManipulatedItem())==(XOV[IBV]) or(GetItemTypeId(GetManipulatedItem()))==(XOV[NKV]) or GetItemTypeId(GetManipulatedItem())==(XOV[NZV]) or GetItemTypeId(GetManipulatedItem())==(XOV[RNV]) or GetItemTypeId(GetManipulatedItem())==(XOV[RBV])) then
		call EnableTrigger(GetTriggeringTrigger())
		return
	endif
	call DisableTrigger(CUV)
	if GetTriggerEventId() == EVENT_PLAYER_UNIT_DROP_ITEM then
		set S4I = true
	endif
	loop
	exitwhen i > 5
		set JCX = GetItemTypeId(UnitItemInSlot(S3I, i))
		if JCX ==(XOV[XMV]) then
			set S5I = S5I + 1
			if (not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(S5I > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set SQI = true
			endif
		endif
		if (JCX)==(XOV[IAV]) then
			set S6I = S6I + 1
			if (not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(S6I > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set SSI = true
			endif
		endif
		if JCX ==(XOV[IDV]) then
			set S7I = S7I + 1
			if (not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(S7I > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set STI = true
			endif
		endif
		if JCX ==(XOV[ICV]) then
			set S8I = S8I + 1
			if (not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(S8I > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set SUI = true
			endif
		endif
		if JCX ==(XOV[IBV]) then
			set S9I = S9I + 1
			if (not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(S9I > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set SWI = true
			endif
		endif
		if (JCX)==(XOV[NKV]) then
			set TVI = TVI + 1
			if (not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(TVI > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set SYI = true
			endif
		endif
		if JCX ==(XOV[NZV]) then
			set TEI = TEI + 1
			if (not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(TEI > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set SZI = true
			endif
		endif
		if JCX ==(XOV[RNV]) then
			set TXI = TXI + 1
			if (not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(TXI > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set S_I = true
			endif
		endif
		if JCX ==(XOV[RBV]) then
			set TOI = TOI + 1
			if (not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(TXI > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set S0I = true
			endif
		endif
		set i = i + 1
	endloop
	call RemoveItem(UnitRemoveItemFromSlot(S3X, 0))
	if S4X != null then
		call RemoveItem(UnitRemoveItemFromSlot(S4X, 0))
	endif
	if S5X != null then
		call RemoveItem(UnitRemoveItemFromSlot(S5X, 0))
	endif
	if S6X != null then
		call RemoveItem(UnitRemoveItemFromSlot(S6X, 0))
	endif
	if S0I then
		call UnitAddItem(S3X, CreateItem((XOV[RBV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((XOV[RBV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((XOV[RBV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((XOV[RBV]), 0, 0))
		endif
	elseif S_I then
		call UnitAddItem(S3X, CreateItem((XOV[RNV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((XOV[RNV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((XOV[RNV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((XOV[RNV]), 0, 0))
		endif
	elseif SZI then
		call UnitAddItem(S3X, CreateItem((XOV[NZV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((XOV[NZV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((XOV[NZV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((XOV[NZV]), 0, 0))
		endif
	elseif SYI then
		call UnitAddItem(S3X, CreateItem((XOV[NKV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((XOV[NKV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((XOV[NKV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((XOV[NKV]), 0, 0))
		endif
	elseif SWI then
		call UnitAddItem(S3X, CreateItem((XOV[IBV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((XOV[IBV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((XOV[IBV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((XOV[IBV]), 0, 0))
		endif
	elseif SUI then
		call UnitAddItem(S3X, CreateItem((XOV[ICV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((XOV[ICV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((XOV[ICV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((XOV[ICV]), 0, 0))
		endif
	elseif STI then
		call UnitAddItem(S3X, CreateItem((XOV[IDV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((XOV[IDV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((XOV[IDV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((XOV[IDV]), 0, 0))
		endif
	elseif SSI then
		call UnitAddItem(S3X, CreateItem((XOV[IAV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((XOV[IAV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((XOV[IAV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((XOV[IAV]), 0, 0))
		endif
	elseif SQI then
		call UnitAddItem(S3X, CreateItem((XOV[XMV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((XOV[XMV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((XOV[XMV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((XOV[XMV]), 0, 0))
		endif
	endif
	call EnableTrigger(GetTriggeringTrigger())
	call EnableTrigger(CUV)
	set S3I = null
	set S4X = null
	set S5X = null
	set S6X = null
	set S2X = null
	set S3X = null
endfunction
function TRI takes unit TII, integer TAI returns nothing
	local integer QMI = GetHandleId(GetOwningPlayer(TII))
	local unit S2X =(LoadUnitHandle(HY,(QMI), 699))
	local unit S3X =(LoadUnitHandle(HY,(QMI), 700))
	local unit S4X =(LoadUnitHandle(HY,(QMI), 701))
	local unit S5X =(LoadUnitHandle(HY,(QMI), 702))
	local unit S6X =(LoadUnitHandle(HY,(QMI), 703))
	if S2X != null and S2X != TII then
		call SelectHeroSkill(S2X, TAI)
	endif
	if S3X != null and S3X != TII then
		call SelectHeroSkill(S3X, TAI)
	endif
	if S4X != null and S4X != TII then
		call SelectHeroSkill(S4X, TAI)
	endif
	if S5X != null and S5X != TII then
		call SelectHeroSkill(S5X, TAI)
	endif
	if S6X != null and S6X != TII then
		call SelectHeroSkill(S6X, TAI)
	endif
	set S4X = null
	set S5X = null
	set S6X = null
	set S2X = null
	set S3X = null
endfunction
function TNI takes integer E8I, unit TBI, unit TCI returns nothing
	local integer loop_i = 1
	local integer loop_max = GetUnitAbilityLevel(TBI, E8I)
	loop
	exitwhen loop_i > loop_max
		call SelectHeroSkill(TCI, E8I)
		set loop_i = loop_i + 1
	endloop
endfunction
function TDI takes unit SPI, unit TFI returns nothing
	local integer i = GetPlayerId(GetOwningPlayer(TFI))
	local integer Z_E = HeroCommonSkills[PlayerSkillIndex[i * HL + 1]]
	local integer Z0E = HeroCommonSkills[PlayerSkillIndex[i * HL + 2]]
	local integer TGI = HeroCommonSkills[PlayerSkillIndex[i * HL + 3]]
	local integer THI = HeroCommonSkills[PlayerSkillIndex[i * HL + 4]]
	local integer TJI = HeroUpgradeSkills[PlayerSkillIndex[i * HL + 4]]
	call UnitAddPermanentAbility(SPI, HeroChangeAbilitySkills[PlayerSkillIndex[i * HL + 1]])
	call UnitAddPermanentAbility(SPI, HeroChangeAbilitySkills[PlayerSkillIndex[i * HL + 2]])
	call UnitAddPermanentAbility(SPI, HeroChangeAbilitySkills[PlayerSkillIndex[i * HL + 3]])
	call UnitAddPermanentAbility(SPI, HeroChangeAbilitySkills[PlayerSkillIndex[i * HL + 4]])
	call AddHeroXPSimple(SPI, GetHeroXP(TFI), false)
	call SaveInteger(HY,(GetHandleId(SPI)), 368,(GetHeroXP(TFI)))
	call SaveInteger(HY,(GetHandleId(SPI)), 367, 0)
	call TNI(Z_E, TFI, SPI)
	call TNI(Z0E, TFI, SPI)
	call TNI(TGI, TFI, SPI)
	call TNI('A0NR', TFI, SPI)
	call TNI(THI, TFI, SPI)
	call TNI(TJI, TFI, SPI)
endfunction
function TKI takes unit S3X, unit S4X, integer TAI, integer S5I, integer S6I returns nothing
	if S5I > S6I then
		call SelectHeroSkill(S4X, TAI)
	elseif S6I > S5I then
		call SelectHeroSkill(S3X, TAI)
	endif
endfunction
function TLI takes unit S3X, unit S4X returns nothing
	local integer SNI = GetHeroXP(S3X)
	local integer SBI = GetHeroXP(S4X)
	local integer Q2I = GetHandleId(S3X)
	local integer Q3I = GetHandleId(S4X)
	local integer Q9I =(LoadInteger(HY,(Q2I), 368))
	local integer SEI =(LoadInteger(HY,(Q3I), 368))
	local integer ZZO
	if SNI > SBI then
		set ZZO = SNI -SBI
		call AddHeroXPSimple(S4X, ZZO, true)
		if SBI != GetHeroXP(S4X) then
			call SaveInteger(HY,(Q3I), 368,(SEI + ZZO))
		endif
	elseif SNI < SBI then
		set ZZO = SBI -SNI
		call AddHeroXPSimple(S3X, ZZO, true)
		if SNI != GetHeroXP(S3X) then
			call SaveInteger(HY,(Q2I), 368,(Q9I + ZZO))
		endif
	endif
endfunction
function TMI takes unit S3X, unit S4X returns nothing
	local integer i = GetPlayerId(GetOwningPlayer(S3X))
	local integer Z_E = HeroCommonSkills[PlayerSkillIndex[i * HL + 1]]
	local integer Z0E = HeroCommonSkills[PlayerSkillIndex[i * HL + 2]]
	local integer TGI = HeroCommonSkills[PlayerSkillIndex[i * HL + 3]]
	local integer THI = HeroCommonSkills[PlayerSkillIndex[i * HL + 4]]
	local integer TJI = HeroUpgradeSkills[PlayerSkillIndex[i * HL + 4]]
	local integer TPI = GetUnitAbilityLevel(S3X, Z_E)
	local integer TQI = GetUnitAbilityLevel(S3X, Z0E)
	local integer TSI = GetUnitAbilityLevel(S3X, TGI)
	local integer TTI = GetUnitAbilityLevel(S3X, THI)
	local integer TUI = GetUnitAbilityLevel(S3X,'A0NR')
	local integer TWI = GetUnitAbilityLevel(S3X, TJI)
	local integer TYI = GetUnitAbilityLevel(S4X, Z_E)
	local integer TZI = GetUnitAbilityLevel(S4X, Z0E)
	local integer T_I = GetUnitAbilityLevel(S4X, TGI)
	local integer T0I = GetUnitAbilityLevel(S4X, THI)
	local integer T1I = GetUnitAbilityLevel(S4X,'A0NR')
	local integer T2Z = GetUnitAbilityLevel(S4X, TJI)
	call TLI(S3X, S4X)
	call TKI(S3X, S4X, Z_E, TPI, TYI)
	call TKI(S3X, S4X, Z0E, TQI, TZI)
	call TKI(S3X, S4X, TGI, TSI, T_I)
	call TKI(S3X, S4X, THI, TTI, T0I)
	call TKI(S3X, S4X, TJI, TWI, T2Z)
	call TKI(S3X, S4X,'A0NR', TUI, T1I)
endfunction
function T3I takes unit S3X, unit S4X returns nothing
	if S3X != null and S4X != null then
		call TMI(S3X, S4X)
	endif
endfunction
function T4I takes nothing returns nothing
	local integer QMI = GetHandleId((LoadPlayerHandle(HY,(GetHandleId(GetTriggeringTrigger())), 370)))
	local unit S2X =(LoadUnitHandle(HY,(QMI), 699))
	local unit S3X =(LoadUnitHandle(HY,(QMI), 700))
	local unit S4X =(LoadUnitHandle(HY,(QMI), 701))
	local unit S5X =(LoadUnitHandle(HY,(QMI), 702))
	local unit S6X =(LoadUnitHandle(HY,(QMI), 703))
	call DisableTrigger(L4V)
	call T3I(S2X, S3X)
	call T3I(S2X, S4X)
	call T3I(S2X, S5X)
	call T3I(S2X, S6X)
	call T3I(S3X, S4X)
	call T3I(S3X, S5X)
	call T3I(S3X, S6X)
	call T3I(S4X, S5X)
	call T3I(S4X, S6X)
	call T3I(S5X, S6X)
	call EnableTrigger(L4V)
	set S4X = null
	set S5X = null
	set S6X = null
	set S2X = null
	set S3X = null
endfunction
function T5I takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerAddAction(t, function T4I)
	call SavePlayerHandle(HY,(GetHandleId(t)), 370,(GetOwningPlayer(GetTriggerUnit())))
	set t = null
endfunction
function T6I takes unit whichUnit returns nothing
	local trigger t
	call SaveUnitHandle(HY,(GetHandleId(GetOwningPlayer(whichUnit))), 699,(whichUnit))
	call SaveInteger(HY,(GetHandleId(whichUnit)), 367,(GetHeroXP(whichUnit)))
	call SaveInteger(HY,(GetHandleId(whichUnit)), 368, 0)
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddAction(t, function Q0I)
	call SavePlayerHandle(HY,(GetHandleId(t)), 370,(GetOwningPlayer(whichUnit)))
	call SaveTriggerHandle(HY,(GetHandleId(GetOwningPlayer(whichUnit))), 371,(t))
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .3, true)
	call TriggerAddAction(t, function QKI)
	call SavePlayerHandle(HY,(GetHandleId(t)), 370,(GetOwningPlayer(whichUnit)))
	call SaveTriggerHandle(HY,(GetHandleId(GetOwningPlayer(whichUnit))), 372,(t))
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_DROP_ITEM)
	call TriggerAddAction(t, function S1I)
	call TriggerAddCondition(t, Condition(function SLI))
	call SaveTriggerHandle(HY,(GetHandleId(GetOwningPlayer(whichUnit))), 369,(t))
	call ExecuteFunc("T5I")
	set t = null
endfunction
function T7I takes unit whichUnit, boolean RFO returns nothing
	local player p = GetOwningPlayer(whichUnit)
	local integer h = GetHandleId(p)
	local unit SPI
	set L5V = L5V + 1
	if L5V == 1 then
		call T6I(whichUnit)
		call BJDebugMsg("dividedwestand start")
	endif
	call TriggerExecute((LoadTriggerHandle(HY,(GetHandleId(GetOwningPlayer(whichUnit))), 371)))
	call TriggerExecute((LoadTriggerHandle(HY,(GetHandleId(GetOwningPlayer(whichUnit))), 372)))
	if RFO == false then
		call TRI(whichUnit,'A0MW')
		call TRI(whichUnit,'A27C')
	endif
	set SPI = CreateUnit(GetOwningPlayer(whichUnit),'H00J', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	call TDI(SPI, whichUnit)
	call SMI(SPI, whichUnit)
	call SaveUnitHandle(HY, h,(699 + L5V),(SPI))
	set p = null
	set SPI = null
endfunction
function T8I takes nothing returns boolean
	local integer i = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))
	local integer Z_E = HeroCommonSkills[PlayerSkillIndex[i * HL + 1]]
	local integer Z0E = HeroCommonSkills[PlayerSkillIndex[i * HL + 2]]
	local integer TGI = HeroCommonSkills[PlayerSkillIndex[i * HL + 3]]
	local integer THI = HeroCommonSkills[PlayerSkillIndex[i * HL + 4]]
	local integer TJI = HeroUpgradeSkills[PlayerSkillIndex[i * HL + 4]]
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	if IsUnitIllusion(GetTriggerUnit()) == false and GetOwningPlayer(GetTriggerUnit()) == GetOwningPlayer(whichUnit) then
		if GetLearnedSkill()=='A0MW' or GetLearnedSkill()=='A27C' then
			call DisableTrigger(GetTriggeringTrigger())
			call T7I(GetTriggerUnit(), false)
			call EnableTrigger(GetTriggeringTrigger())
		elseif GetLearnedSkill()=='A0NR' or GetLearnedSkill() == Z_E or GetLearnedSkill() == Z0E or GetLearnedSkill() == TGI or GetLearnedSkill() == THI or GetLearnedSkill() == TJI then
			call TriggerExecute((LoadTriggerHandle(HY,(GetHandleId(GetOwningPlayer(GetTriggerUnit()))), 371)))
			call TriggerExecute((LoadTriggerHandle(HY,(GetHandleId(GetOwningPlayer(GetTriggerUnit()))), 372)))
			call DisableTrigger(GetTriggeringTrigger())
			call TRI(GetTriggerUnit(), GetLearnedSkill())
			call EnableTrigger(GetTriggeringTrigger())
		endif
	endif
	set whichUnit = null
	set t = null
	return false
endfunction
function L3I takes nothing returns nothing
	local unit whichUnit = U2
	local integer h
	set L3V = CreateTrigger()
	set L4V = L3V
	set h = GetHandleId(L3V)
	call TriggerRegisterPlayerUnitEventBJ(L3V, EVENT_PLAYER_HERO_SKILL)
	call TriggerAddCondition(L3V, Condition(function T8I))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	set whichUnit = null
endfunction
function RNE takes nothing returns nothing
	local location l = GetSpellTargetLoc()
	local unit dummyCaster = CreateUnitAtLoc(GetOwningPlayer(GetTriggerUnit()),'e00E', l, 0)
	call UnitAddAbility(dummyCaster,'A06W')
	call SetUnitAbilityLevel(dummyCaster,'A06W', GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
	if IssuePointOrderByIdLoc(dummyCaster, 852224, l) == false then
		call IssuePointOrderByIdLoc(dummyCaster, 852232, l)
	endif
	call ABX("Abilities\\Spells\\Orc\\EarthQuake\\EarthQuakeTarget.mdl", GetLocationX(l), GetLocationY(l), 2)
	call TerrainDeformationRippleBJ(.3, false, l, 0, 300, 100, .4, 20)
	call RemoveLocation(l)
	set l = null
	set dummyCaster = null
endfunction
function LightningStormDamagedEvent takes nothing returns nothing
	if GetUnitAbilityLevel(DESource,'A3A8')> 0 then
		call CNX(DETarget,'A34I', 1, .6 + .1 * GetUnitAbilityLevel(DESource,'A3A8'),'B0H8')
	endif
endfunction
function UVI takes unit whichUnit, unit targetUnit returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetUnitFacing(GetTriggerUnit()))
	call UnitAddAbility(d,'A3A8')
	call TGV(10)
	call SetUnitAbilityLevel(d,'A3A8', GetUnitAbilityLevel(GetTriggerUnit(),'A06V'))
	call IssueTargetOrderById(d, 852119, GetSpellTargetUnit())
	set d = null
endfunction
function RBE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call UVI(GetTriggerUnit(), GetSpellTargetUnit())
	endif
endfunction
function UEI takes nothing returns boolean
	return IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and UnitIsDead(GetFilterUnit()) == false and GetUnitAbilityLevel(GetFilterUnit(),'Avul') == 0
endfunction
function UXI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local integer level =(LoadInteger(HY, h, 5))
	local group g
	local unit u
	local real d
	local real a
	local real x
	local real y
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	if GetTriggerEvalCount(t)> 40 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set g = AllocationGroup(353)
		set U2 = trigUnit
		call GroupEnumUnitsInRange(g, GetUnitX(trigUnit), GetUnitY(trigUnit), 500 + 12, Condition(function UEI))
		set u = GroupPickRandomUnit(g)
		if u == null then
			set d = GetRandomReal(175, 400)
			set a = GetRandomReal(0, 6)
			set x = GetUnitX(trigUnit)+ d * Cos(a)
			set y = GetUnitY(trigUnit)+ d * Sin(a)
			call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\SteamTank\\SteamTankImpact.mdl", x, y))
		else
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SteamTank\\SteamTankImpact.mdl", u, "origin"))
			call UnitDamageTargetEx(dummyCaster, u, 5, 12.5 * level)
		endif
		call DeallocateGroup(g)
	endif
	set u = null
	set g = null
	set t = null
	set trigUnit = null
	set dummyCaster = null
	return false
endfunction
function RCE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = GetTriggerUnit()
	local unit dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'e00E', GetUnitX(trigUnit), GetUnitY(trigUnit), 0)
	if GetUnitTypeId(trigUnit)=='e00E' then
		set trigUnit = Player__Hero[GetPlayerId(GetOwningPlayer(trigUnit))]
	endif
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RocketMissile\\RocketMissile.mdl", trigUnit, "hand right"))
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	call SaveInteger(HY, h, 5,(GetUnitAbilityLevel(trigUnit,'A20T')))
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerAddCondition(t, Condition(function UXI))
	set t = null
	set trigUnit = null
	set dummyCaster = null
endfunction
function UOI takes nothing returns nothing
	local unit whichUnit = L6V
	local unit targetUnit = GetEnumUnit()
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, L7V)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", targetUnit, "origin"))
	set whichUnit = null
	set targetUnit = null
endfunction
// 脉冲新星动作
function URI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 2)
	local integer lv = GetUnitAbilityLevel(u,'A21F')
	local group g
	local boolean b = GetUnitAbilityLevel(u,'A21G') > 0
	if not b then
		set L7V = 70 + 30 * lv
	else
		set lv = GetUnitAbilityLevel(u,'A21G')
		set L7V = 140 + 20 * lv
	endif
	if GetTriggerEvalCount(t) == 1 and b then
		call UnitAddPermanentAbility(u,'A345')
	endif
	set b = false
	if LoadInteger(HY, GetHandleId(u), 704) == - 1 then
		if not PlayerHaveAbilityByActive(GetOwningPlayer(u), 'A21F') then
			set b = true //如果窃取技能丢失,则判断单位是否选择了该技能,如果没选择则设置b=true结束此触发
		endif
	endif
	//脉冲新星结束 事件==死亡 or 魔法不足 or 释放关闭技能 LoadInteger(HY, GetHandleId(u), 704) == -1 and not 
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetUnitState(u, UNIT_STATE_MANA)< 20 * lv or b or( GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT and( GetSpellAbilityId()=='A21H' or GetSpellAbilityId()=='A27H' or GetSpellAbilityId()=='A30J' )) then
		set b = Rubick_AbilityFilter(u, 'A21F')
		if b then
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A21F', true)
		endif
		if b or LoadInteger(HY, GetHandleId(u), 704)=='A21G' then
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A21G', true)
		endif
		call UnitRemoveAbility(u,'A345')
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A21H', false)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()!= EVENT_UNIT_SPELL_EFFECT then
		call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)-20 * lv)
		set U2 = u
		set L6V = u
		set g = AllocationGroup(354)
		call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 475, Condition(function DPX))
		call ForGroup(g, function UOI)
		call DeallocateGroup(g)
		set g = null
	endif
	set t = null
	set u = null
	return false
endfunction
//脉冲新星
function RQE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", u, "origin"))
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A21F', false)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A21G', false)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A21H', true)
	call UnitAddPermanentAbility(u,'A21H')
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function URI))
	call SaveUnitHandle(HY, h, 2,(u))
	call TriggerEvaluate(t)
	set u = null
	set t = null
endfunction
function UII takes nothing returns boolean
	return IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and(IsUnitInvision(GetFilterUnit()) == false or UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2))) and RFX(GetFilterUnit()) == false
endfunction
function UAI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local unit UNI =(LoadUnitHandle(HY, h, 374))
	local integer level =(LoadInteger(HY, h, 5))
	local integer UBI =(LoadInteger(HY, h, 233))
	local integer KLR =(LoadInteger(HY, h, 12))
	local unit dummyCaster
	local group g
	local real a
	local real x
	local real y
	local integer UCI =(LoadInteger(HY, h, 720))
	if UCI > 0 then
		set UCI = UCI -1
		call SaveInteger(HY, h, 720,(UCI))
		set whichUnit = null
		set t = null
		set targetUnit = null
		set UNI = null
		return false
	endif
	if GetDistanceBetween(GetUnitX(UNI), GetUnitY(UNI), GetUnitX(targetUnit), GetUnitY(targetUnit))> 20 then
		set a = AngleBetweenXY(GetUnitX(UNI), GetUnitY(UNI), GetUnitX(targetUnit), GetUnitY(targetUnit))
		call SetUnitFacing(UNI, a)
		set x = GetUnitX(UNI)+ 17 * Cos(a * bj_DEGTORAD)
		set y = GetUnitY(UNI)+ 17 * Sin(a * bj_DEGTORAD)
		call SetUnitX(UNI, x)
		call SetUnitY(UNI, y)
	else
		if UnitIsDead(targetUnit) == false then
			if IsUnitMagicImmune(targetUnit) == false then
				set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
				call UnitAddPermanentAbility(dummyCaster,'A091')
				call SetUnitAbilityLevel(dummyCaster,'A091', LoadInteger(HY, h, 6))
				if B0R(dummyCaster, targetUnit, 852226) then
					call UnitAddAbilityToTimed(targetUnit,'A3JM', 1, 4, 0)
				endif
			endif
			if UBI == 1 and not LoadBoolean(HY, h, 0) then
				if GetUnitAbilityLevel(targetUnit,'A3E9') == 1 then
					if UnitHasSpellShield(whichUnit) == false then
						call SaveUnitHandle(OtherHashTable2,'A3E9', 0, targetUnit)
						call SaveUnitHandle(OtherHashTable2,'A3E9', 1, whichUnit)
						call SaveInteger(OtherHashTable2,'A3E9', 0, level)
						if KLR > 100  then
							call SaveInteger(OtherHashTable2,'A3E9', 1,'A08H')
						else
							call SaveInteger(OtherHashTable2,'A3E9', 1,'A05T')
						endif
						call ExecuteFunc("UDI")
					else
						call UnitRemoveSpellShield(whichUnit)
					endif
				endif
			endif
		endif
		if UBI > KLR then
			call RemoveUnit(UNI)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			set g = AllocationGroup(355)
			set U2 = whichUnit
			call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 600, Condition(function UII))
			call GroupRemoveUnit(g, targetUnit)
			set targetUnit = GroupPickRandomUnit(g)
			call DeallocateGroup(g)
			if targetUnit == null then
				call RemoveUnit(UNI)
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			else
				call SaveInteger(HY, h, 720, 10)
				call SaveInteger(HY, h, 233,(UBI + 1))
				call SaveUnitHandle(HY, h, 17,(targetUnit))
				if UBI > 60 then
					call UnitAddPermanentAbility(UNI,'A3C9')
				endif
			endif
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set UNI = null
	set dummyCaster = null
	set g = null
	return false
endfunction
function UFI takes nothing returns nothing
	local timer t2 = GetExpiredTimer()
	local integer h2 = GetHandleId(t2)
	local unit whichUnit = LoadUnitHandle(HY, h2, 0)
	local unit targetUnit = LoadUnitHandle(HY, h2, 1)
	local integer level = LoadInteger(HY, h2, 0)
	local integer KLR = 10
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit UNI
	local unit d
	local integer UGI = level
	if LoadInteger(HY, h2, 1)=='A08H' then
		set KLR = 99999
		set UGI = 1 + GetUnitAbilityLevel(whichUnit,'A08H')
	endif
	set UNI = CreateUnit(GetOwningPlayer(whichUnit),'e009', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	if GetUnitTypeId(whichUnit)=='e00E' then
		call SaveUnitHandle(HY, h, 2, Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))])
	else
		call SaveUnitHandle(HY, h, 2,(whichUnit))
	endif
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveUnitHandle(HY, h, 374,(UNI))
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY,(h), 6,(UGI))
	call SaveInteger(HY, h, 233, 1)
	call SaveInteger(HY, h, 12,(KLR))
	call SaveInteger(HY, h, 720, 0)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function UAI))
	if LoadBoolean(HY, h2, 0) then
		call SaveBoolean(HY, h, 0, true)
		set d = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitAddAbility(d,'A05T')
		call THV(d, "thunderbolt", targetUnit)
		set d = null
	endif
	call FlushChildHashtable(HY, h2)
	call DestroyTimer(t2)
	set whichUnit = null
	set targetUnit = null
	set UNI = null
	set t = null
	set t2 = null
endfunction
function UDI takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call T4V(LoadUnitHandle(OtherHashTable2,'A3E9', 0))
	call TimerStart(t, 0, false, function UFI)
	call SaveUnitHandle(HY, h, 0, LoadUnitHandle(OtherHashTable2,'A3E9', 0))
	call SaveUnitHandle(HY, h, 1, LoadUnitHandle(OtherHashTable2,'A3E9', 1))
	call SaveInteger(HY, h, 0, LoadInteger(OtherHashTable2,'A3E9', 0))
	call SaveInteger(HY, h, 1, LoadInteger(OtherHashTable2,'A3E9', 1))
	call SaveBoolean(HY, h, 0, true)
	set t = null
	call FlushChildHashtable(OtherHashTable2,'A3E9')
endfunction
function RTE takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, 0, false, function UFI)
	call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
	call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(GetTriggerUnit(),'A05T'))
	call SaveInteger(HY, h, 1, GetSpellAbilityId())
	set t = null
endfunction
function UHI takes unit u, integer d returns nothing
	local texttag t = CreateTextTag()
	call SetTextTagText(t, "+" + I2S(d)+ " " + GetObjectName('n0LQ'), .03)
	call SetTextTagPosUnit(t, u, 0)
	call SetTextTagColorBJ(t, 50, 75, 255, 15)
	call SetTextTagVelocity(t, 0, .035)
	call SetTextTagFadepoint(t, 3)
	call SetTextTagLifespan(t, 2.5)
	call SetTextTagPermanent(t, false)
	call SetTextTagVisibility(t, UnitVisibleToPlayer(u, LocalPlayer) or IsObserverPlayer(LocalPlayer))
	set t = null
endfunction
function UJI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local real mp = LoadReal(HY, h, 0)
	call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ mp)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set u = null
endfunction
function UKI takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t
	local integer h
	if GetUnitTypeId(whichUnit)=='e00C' then
		set whichUnit = Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))]
	endif
	if GetWidgetLife(whichUnit)> 1 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 0, false)
		call TriggerAddCondition(t, Condition(function UJI))
		call SaveUnitHandle(HY, h, 0, whichUnit)
		call SaveReal(HY, h, 0, GetWidgetLife(targetUnit)*(GetUnitAbilityLevel(whichUnit,'A053')*(.15)+ .1))
		call UHI(targetUnit, R2I(GetWidgetLife(targetUnit)*(GetUnitAbilityLevel(whichUnit,'A053')*(.15)+ .1)))
		set YB = true
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 99999)
		call UnitDamageTargetEx(whichUnit, targetUnit, 2, 99999)
		call UnitDamageTargetEx(whichUnit, targetUnit, 3, 99999)
		set t = null
	endif
	set whichUnit = null
	set targetUnit = null
endfunction
function R_E takes nothing returns nothing
	if IsUnitMessenger(GetSpellTargetUnit()) == false then
		call UKI()
	endif
endfunction
function ULI takes nothing returns nothing
	call ResetUnitVertexColor(GetEnumUnit())
	call UnitRemoveAbility(GetEnumUnit(),'A30A')
	call UnitRemoveAbility(GetEnumUnit(),'B30A')
endfunction
function UMI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local group g = LoadGroupHandle(HY, h, 1)
	call ForGroup(g, function ULI)
	call GroupClear(g)
	call DestroyGroup(g)
	set g = null
	set t = null
endfunction
function UPI takes nothing returns boolean
	return IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(Q5V)) and IsAliveNotStrucNotWard(GetFilterUnit()) and IsUnitMagicImmune(GetFilterUnit()) == false
endfunction
function UQI takes nothing returns nothing
	local unit u = GetEnumUnit()
	call UnitDamageTargetEx(LoadUnitHandle(OtherHashTable2,'A07F', 0), u, 1, 50 + 25 * Q2)
	if UnitAlive(u) then
		call UnitAddPermanentAbility(u,'A30A')
		call JFX(u)
	endif
	set u = null
endfunction
function USI takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local group g = CreateGroup()
	call TriggerRegisterTimerEvent(t, 4, false)
	call TriggerAddCondition(t, Condition(function UMI))
	call TriggerRegisterDeathEvent(t, targetUnit)
	call UnitDamageTargetEx(u, targetUnit, 1, 50 * GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl", targetUnit, "origin"))
	set Q5V = u
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 225, Condition(function UPI))
	call GroupAddUnit(g, targetUnit)
	call SaveUnitHandle(OtherHashTable2,'A07F', 0, u)
	set Q2 = GetUnitAbilityLevel(u,'A07F')
	call ForGroup(g, function UQI)
	call SaveGroupHandle(HY, h, 1, g)
	call RemoveSavedHandle(OtherHashTable2,'A07F', 0)
	set g = null
	set targetUnit = null
	set u = null
	set t = null
endfunction
function D8E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call USI()
	endif
endfunction
function UTI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	if UnitAlive(u) then
		call UnitRemoveAbility(u,'A308')
		call UnitRemoveAbility(u,'B308')
	endif
	if GetUnitAbilityLevel(u,'B308') == 0 then
		call SaveBoolean(HY, GetHandleId(u), 1991, false)
		call RemoveSavedHandle(HY, GetHandleId(u), 1991)
		call FlushChildHashtable(HY, GetHandleId(t))
		call DestroyTimer(t)
	else
		call TimerStart(t, 1, true, function UTI)
	endif
	set t = null
	set u = null
endfunction
function UUI takes unit u, unit t returns nothing
	local timer tt
	if IsUnitMagicImmune(u) == false then
		call UnitAddPermanentAbility(u,'A308')
		if (LoadBoolean(HY, GetHandleId(u), 1991)) then
			set tt = LoadTimerHandle(HY, GetHandleId(u), 1991)
			call TimerStart(tt, 2, false, function UTI)
		else
			set tt = CreateTimer()
			call TimerStart(tt, 2, false, function UTI)
			call SaveUnitHandle(HY, GetHandleId(tt), 0, u)
			call SaveBoolean(HY, GetHandleId(u), 1991, true)
			call SaveTimerHandle(HY, GetHandleId(u), 1991, tt)
		endif
	endif
	set tt = null
endfunction
function RUE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x1 = GetUnitX(u)
	local real y1 = GetUnitY(u)
	local real a
	local real x2
	local real y2
	local integer lv = GetUnitAbilityLevel(u,'A0X5')
	local real damage
	local real dur
	local unit target = null
	if GetSpellTargetUnit()!= null then
		set x2 = GetUnitX(GetSpellTargetUnit())
		set y2 = GetUnitY(GetSpellTargetUnit())
	else
		set x2 = GetSpellTargetX()
		set y2 = GetSpellTargetY()
	endif
	set a = Atan2(y2 -y1, x2 -x1)
	set x2 = x1 + 700 * Cos(a)
	set y2 = y1 + 700 * Sin(a)
	if lv == 1 then
		set damage = 60
		set dur = .5
	elseif lv == 2 then
		set damage = 130
		set dur = 1
	elseif lv == 3 then
		set damage = 200
		set dur = 1.5
	elseif lv == 4 then
		set damage = 260
		set dur = 2
	endif
	if GetSpellTargetUnit()!= null and UnitHasSpellShield(GetSpellTargetUnit()) then
		set target = GetSpellTargetUnit()
	endif
	call UnitSpellEffectImpale(u, target, damage, dur, .52, x1, y1, x2, y2, 150, null, true, 1600)
	set u = null
	set target = null
endfunction

// 0秒后重置大小
function VoodooCallBack takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local unit whichUnit = LoadUnitHandle( HY, h, 0 )
	
	call SetUnitCurrentScaleEx(whichUnit, GetUnitCurrentScale(whichUnit))
	set whichUnit = null
	
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(trig)
	set trig = null
	return false
endfunction

function SpellEffect__Voodoo takes nothing returns nothing
	local integer h = CreateTimerEventTrigger( 0., false, function VoodooCallBack )
	local integer id = GetSpellAbilityId()
	local unit spellUnit = GetTriggerUnit()
	local real dur = YDWEGetUnitAbilityDataReal( spellUnit, id, GetUnitAbilityLevel(spellUnit, id), ABILITY_DATA_HERODUR )
	call SaveUnitHandle( HY, h, 0, GetSpellTargetUnit() )
	set h = CreateTimerEventTrigger( dur + 0.01, false, function VoodooCallBack )
	call SaveUnitHandle( HY, h, 0, GetSpellTargetUnit() )
	set spellUnit = null
endfunction

function UWI takes nothing returns nothing
	local real damageValue = 475 + 125 * GetUnitAbilityLevel(UA,'A09W')
	call UnitDamageTargetEx(UA, GetEnumUnit(), 1, damageValue)
endfunction
function UYI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	local integer level = LoadInteger(HY, h, 0)
	local group g = AllocationGroup(356)
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 300 + 25, Condition(function DQX))
	call GroupRemoveUnit(g, targetUnit)
	if FirstOfGroup(g)!= null then
		set UA = whichUnit
		call ForGroup(g, function UWI)
	endif
	call DeallocateGroup(g)
	call DestroyTimerAndFlushHT_HY(t)
	set t = null
	set g = null
	set targetUnit = null
	set whichUnit = null
endfunction
function Z6V takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .25, false, function UYI)
	call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
	call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
	set t = null
endfunction
function LRE takes nothing returns nothing
	if IsUnitMagicImmune(GetSpellTargetUnit()) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n0LR'))
	endif
endfunction
function UZI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 14))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosDone.mdl", whichUnit, "origin"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl", whichUnit, "origin"))
	call UnitRemoveAbility(whichUnit,'A0ZC')
	call UnitRemoveAbility(whichUnit,'B00V')
	call UnitRemoveAbility(whichUnit,'A521')
	//call ResetUnitVertexColor(whichUnit)
	//call SetUnitVertexColorEx(whichUnit,-1,-1,-1, 255)
	call RemoveUnit(LoadUnitHandle(HY, h, 15))
	call SetUnitNoLimitMoveSpeed(whichUnit, 0)
	call UnitAddMaxLife(whichUnit,-1 * LoadInteger(HY, h, 16))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction
function Shapeshift_CallBack takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 14))
	local unit d = LoadUnitHandle(HY, h, 15)
	local integer I2X = LoadInteger(HY, h, 16)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosDone.mdl", whichUnit, "origin"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl", whichUnit, "origin"))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 18 -0.1, false)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerAddCondition(t, Condition(function UZI))
	call SaveUnitHandle(HY, h, 14,(whichUnit))
	call SaveUnitHandle(HY, h, 15, d)
	call SaveInteger(HY, h, 16, I2X)
	call SetUnitNoLimitMoveSpeed(whichUnit, 650)
	set d = null
	set t = null
	set whichUnit = null
	return false
endfunction
// 变狼
function U0I takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(whichUnit),'e01V', 0, 0, 0)
	local real N5O = 18
	local real hp = GetWidgetLife(whichUnit)
	local real extraMaxLife = 100 * GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())
	call UnitAddMaxLife(whichUnit, R2I(extraMaxLife))
	call SaveInteger(HY, h, 16, R2I(extraMaxLife))
	call SetWidgetLife(whichUnit, hp + extraMaxLife)
	call UnitAddPermanentAbility(dummyUnit,'A0ZC')
	call UnitApplyTimedLife(dummyUnit,'BTLF', N5O)
	//call SetUnitVertexColorEx(whichUnit, 255, 100, 255, 175)
	call TriggerRegisterTimerEvent(t, .1, false)
	call TriggerAddCondition(t, Condition(function Shapeshift_CallBack))
	call SaveUnitHandle(HY, h, 14,(whichUnit))
	call SaveUnitHandle(HY, h, 15, dummyUnit)
	set t = null
	set whichUnit = null
	set dummyUnit = null
endfunction
function R1E takes nothing returns nothing
	if GetUnitTypeId(GetTriggerUnit())!='E015' then
		call U0I()
	endif
endfunction
function R3E takes nothing returns nothing
	local unit U1I
	local integer id = 0
	local integer level = GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId())
	local real x = GetUnitX(GetTriggerUnit())
	local real y = GetUnitY(GetTriggerUnit())
	local real a = GetUnitFacing(GetTriggerUnit())
	if level == 1 then
		set id ='o005'
	elseif level == 2then
		set id ='o006'
	elseif level == 3 then
		set id ='o007'
	else
		set id ='o00F'
	endif
	set U1I = CreateUnit(GetTriggerPlayer(), id, x + 30 * Cos(a * bj_DEGTORAD), y + 30 * Sin(a * bj_DEGTORAD), a)
	call UnitApplyTimedLife(U1I,'BTLF', 55)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl", U1I, "origin"))
	set U1I = CreateUnit(GetTriggerPlayer(), id, x + 30 * Cos(a * bj_DEGTORAD), y + 30 * Sin(a * bj_DEGTORAD), a)
	call UnitApplyTimedLife(U1I,'BTLF', 55)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl", U1I, "origin"))
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(GetTriggerUnit()),'A03B', true)
	set U1I = null
endfunction
function Z0O takes nothing returns nothing
	local unit whichUnit = IM
	local unit targetUnit = AM
	local unit dummyCaster =(LoadUnitHandle(HY,(GetHandleId(whichUnit)), 219))
	call SaveUnitHandle(HY,(GetHandleId(whichUnit)), 219,(dummyCaster))
	call SetUnitOwner(dummyCaster, GetOwningPlayer(targetUnit), true)
	set whichUnit = null
	set targetUnit = null
	set dummyCaster = null
endfunction
function W4X takes nothing returns nothing
	local unit trigUnit = VK
	local unit dummyCaster =(LoadUnitHandle(HY,(GetHandleId(trigUnit)), 219))
	if dummyCaster != null and GetUnitTypeId(dummyCaster)=='e01V' then
		call RemoveUnit(dummyCaster)
	endif
	set trigUnit = null
	set dummyCaster = null
endfunction
function U2III takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	if dummyCaster != null and GetUnitTypeId(dummyCaster)=='e01V' then
		if UnitIsDead(whichUnit) == false then
			call SetUnitX(dummyCaster, GetUnitX(whichUnit))
			call SetUnitY(dummyCaster, GetUnitY(whichUnit))
		endif
	endif
	set t = null
	set dummyCaster = null
	set whichUnit = null
	return false
endfunction
function PFE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(trigUnit,'A03E')
	local unit dummyCaster
	local trigger t
	local integer h
	if level == 1 then
		set dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'e01V', 0, 0, 0)
		call UnitAddPermanentAbility(dummyCaster,'A0ZJ')
		call SaveUnitHandle(HY,(GetHandleId(trigUnit)), 219,(dummyCaster))
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerAddCondition(t, Condition(function U2III))
		call TriggerRegisterTimerEvent(t, .2, true)
		call SaveUnitHandle(HY, h, 2,(trigUnit))
		call SaveUnitHandle(HY, h, 19,(dummyCaster))
		set t = null
	else
		set dummyCaster =(LoadUnitHandle(HY,(GetHandleId(trigUnit)), 219))
	endif
	if level == 2 then
		call UnitRemoveAbility(dummyCaster,'A0ZJ')
		call UnitAddPermanentAbility(dummyCaster,'A0ZI')
		call UnitRemoveAbility(trigUnit,'B09B')
	elseif level == 3 then
		call UnitRemoveAbility(dummyCaster,'A0ZJ')
		call UnitRemoveAbility(dummyCaster,'A0ZI')
		call UnitRemoveAbility(trigUnit,'B09A')
		call UnitRemoveAbility(trigUnit,'B09B')
		call UnitAddPermanentAbility(dummyCaster,'A0ZH')
	elseif level == 4 then
		call UnitRemoveAbility(dummyCaster,'A0ZJ')
		call UnitRemoveAbility(dummyCaster,'A0ZI')
		call UnitRemoveAbility(dummyCaster,'A0ZH')
		call UnitRemoveAbility(trigUnit,'B097')
		call UnitRemoveAbility(trigUnit,'B09A')
		call UnitRemoveAbility(trigUnit,'B09B')
		call UnitAddPermanentAbility(dummyCaster,'A0ZG')
	endif
	set trigUnit = null
	set dummyCaster = null
endfunction
function U3I takes unit u returns nothing
	local integer i = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A0A8')
	if i > 0 then
		call UnitAddPermanentAbilitySetLevel(u,'A3IP', i)
		call UnitAddPermanentAbilitySetLevel(u,'A3IQ', i)
	endif
endfunction
function IVE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local unit dummyCaster
	local integer i = 1
	local player p
	local integer TXE
	local integer TOE
	local integer level = GetUnitAbilityLevel(trigUnit,'A0ZF')
	if level == 1 then
		set TXE ='A104'
		set TOE ='A107'
	elseif level == 2 then
		set TXE ='A101'
		set TOE ='A106'
	elseif level == 3 then
		set TXE ='A102'
		set TOE ='A105'
	elseif level == 4 then
		set TXE ='A103'
		set TOE ='A108'
	endif
	loop
	exitwhen i > 5
		if IsSentinelPlayer(GetOwningPlayer(trigUnit)) then
			set p = SentinelPlayers[i]
		else
			set p = ScourgePlayers[i]
		endif
		set dummyCaster = CreateUnit(p,'e01V', 0, 0, 0)
		call UnitAddPermanentAbility(dummyCaster, TXE)
		call UnitAddPermanentAbility(dummyCaster, TOE)
		call UnitApplyTimedLife(dummyCaster,'BTLF', 10)
		set i = i + 1
	endloop
	set trigUnit = null
	set dummyCaster = null
	set p = null
endfunction
function IXE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer tl = GetHeroLevel(targetUnit)
	local integer level = GetUnitAbilityLevel(whichUnit,'A094')
	local real damageValue = 75 + 50 * level
	if (IsUnitType(whichUnit, UNIT_TYPE_HERO) or HaveSavedHandle(HY, GetHandleId(whichUnit), 0)) and(ModuloInteger(tl, 7 -level) == 0 or tl == 25) then
		set damageValue = damageValue + GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)* .2
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Demon\\DemonBoltImpact\\DemonBoltImpact.mdl", targetUnit, "chest"))
	endif
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, damageValue)
	call TDV(targetUnit)
	set whichUnit = null
	set targetUnit = null
endfunction
function U4I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit U5I = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	if GetUnitAbilityLevel(targetUnit,'A464') == 0 or UnitIsDead(targetUnit) then
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	else
		call UnitDamageTargetEx(U5I, targetUnit, 7, LoadReal(HY, h, 0))
	endif
	if LoadBoolean(HY, h, 0) then
		call RemoveSavedBoolean(HY, h, 0)
		call TimerStart(t, 1, true, function U4I)
	endif
	set U5I = null
	set targetUnit = null
	set t = null
endfunction
function U6I takes unit u, unit targetUnit returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, 0, false, function U4I)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveUnitHandle(HY, h, 1, targetUnit)
	call SaveReal(HY, h, 0, GetUnitAbilityLevel(u,'A0MU')* 25. + 5.)
	call SaveBoolean(HY, h, 0, true)
	set t = null
endfunction
function U7I takes nothing returns nothing
	local unit U5I = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local unit d
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		call UnitAddAbilityToTimed(targetUnit,'A464', 1, 14,'B464')
		call BWR(targetUnit,'B464', 14)
		call U6I(U5I, targetUnit)
	else
		set d = CreateUnit(GetOwningPlayer(U5I),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitAddAbility(d,'A465')
		call SetUnitAbilityLevel(d,'A465', GetUnitAbilityLevel(U5I,'A0MU'))
		call IssueTargetOrderById(d, 852583, targetUnit)
		set d = null
	endif
	if S3V(targetUnit) then
		call IssueImmediateOrderById(targetUnit, 851972)
	endif
	set U5I = null
	set targetUnit = null
endfunction
function IBE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call GCX(GetSpellTargetUnit())
		call U7I()
	endif
endfunction
function U8I takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetOrderTargetUnit()
	if IsUnitType(targetUnit, UNIT_TYPE_ANCIENT) and not IsBearUnit(targetUnit) then
		call EXStopUnit(whichUnit)
		call InterfaceErrorForPlayer(GetOwningPlayer(whichUnit), GetObjectName('n0K9'))
	endif
	set whichUnit = null
	set targetUnit = null
endfunction
function T_E takes nothing returns nothing
	local unit u = U2
	local integer hu = GetHandleId(u)
	local integer TXE = LoadInteger(OtherHashTable, hu,'DEVR'+ 0)
	local integer TOE = LoadInteger(OtherHashTable, hu,'DEVR'+ 1)
	local boolean U9I = LoadBoolean(OtherHashTable, hu,'DEVR'+ 0)
	local boolean WVI = LoadBoolean(OtherHashTable, hu,'DEVR'+ 1)
	if U9I == false then
		call UnitRemoveAbility(u, TXE)
		call UnitAddPermanentAbility(u, TXE)
	endif
	if WVI == false then
		call UnitRemoveAbility(u, TOE)
		call UnitAddPermanentAbility(u, TOE)
	endif
	set u = null
endfunction
function WEI takes unit u returns nothing
	call UnitRemoveAbility(u, LoadInteger(OtherHashTable, GetHandleId(u),'DEVR'+ 0))
	call UnitRemoveAbility(u, LoadInteger(OtherHashTable, GetHandleId(u),'DEVR'+ 1))
	call RemoveSavedInteger(OtherHashTable, GetHandleId(u),'DEVR'+ 0)
	call RemoveSavedInteger(OtherHashTable, GetHandleId(u),'DEVR'+ 1)
	call RemoveSavedBoolean(OtherHashTable, GetHandleId(u),'DEVR'+ 0)
	call RemoveSavedBoolean(OtherHashTable, GetHandleId(u),'DEVR'+ 1)
endfunction
function WXI takes unit u, integer unitTypeId returns nothing
	local integer TXE = 0
	local integer TOE = 0
	local boolean U9I = false
	local boolean WVI = false
	local integer WOI = 0
	local integer WRI = 0
	local integer hu = GetHandleId(u)
	if unitTypeId =='n0HX' then
		set TXE ='A1OQ'
	elseif unitTypeId =='nomg' then
		set TXE ='A1OR'
	elseif unitTypeId =='nfpu' then
		set TXE ='A1OS'
		set TOE ='QDP3'
		set WVI = true
		set WRI ='S00N'
	elseif unitTypeId =='nstl' then
		set TXE ='A1OT'
	elseif unitTypeId =='nsat' then
		set TXE ='A1OU'
	elseif unitTypeId =='nsth' then
		set TXE ='A1OV'
		set TOE ='QDP0'
		set WVI = true
		set WRI ='A1OW'
	elseif unitTypeId =='n00S' then
		set TXE ='QDP6'
		set WOI ='A1OX'
		set U9I = true
		set WRI ='A1OY'
	elseif unitTypeId =='nkol' then
		set TXE ='QDP1'
		set WOI ='S00M'
		set U9I = true
	elseif unitTypeId =='nfsh' then
		set TXE ='A1OZ'
		set TOE ='QDP2'
		set WRI ='A2AG'
		set WVI = true
	elseif unitTypeId =='ncnk' then
		set TXE ='A1P0'
	elseif unitTypeId =='ngns' then
		set TXE ='QDP4'
		set WOI ='A1P1'
		set U9I = true
	elseif unitTypeId =='ngh1' then
		set TXE ='QDP7'
		set WOI ='A1P7'
		set U9I = true
		set WRI ='A1PA'
	elseif unitTypeId =='nowe' then
		set TXE ='QDP5'
		set WOI ='A1P3'
		set U9I = true
		set TOE ='A1P4'
	elseif unitTypeId =='ndtw' then
		set TXE ='A1P5'
		set TOE ='A1P6'
	elseif unitTypeId =='nwlg' then
		set TXE ='QDP8'
		set WOI ='A1OY'
		set U9I = true
	elseif unitTypeId =='n026' then
		set TXE ='A36K'
		set TOE ='A36J'
	elseif unitTypeId =='n127' then
		set TXE ='A36K'
	endif
	if TXE != 0 and(LoadInteger(OtherHashTable, hu,'DEVR'+ 0)!= TXE or LoadInteger(OtherHashTable, hu,'DEVR'+ 1)!= TOE) then
		call WEI(u)
		call UnitAddPermanentAbility(u, TXE)
		if U9I then
			call SetPlayerAbilityAvailable(GetOwningPlayer(u), TXE, false)
			call UnitMakeAbilityPermanent(u, true, WOI)
			call UnitMakeAbilityPermanent(u, true, WRI)
		endif
		if TOE != 0 then
			call UnitAddPermanentAbility(u, TOE)
			if WVI then
				call SetPlayerAbilityAvailable(GetOwningPlayer(u), TOE, false)
				call UnitMakeAbilityPermanent(u, true, WOI)
				call UnitMakeAbilityPermanent(u, true, WRI)
			endif
		endif
		call SaveInteger(OtherHashTable, hu,'DEVR'+ 0, TXE)
		call SaveBoolean(OtherHashTable, hu,'DEVR'+ 0, U9I)
		call SaveInteger(OtherHashTable, hu,'DEVR'+ 1, TOE)
		call SaveBoolean(OtherHashTable, hu,'DEVR'+ 1, WVI)
	endif
endfunction
function WII takes real r returns string
	local string c1 = "|c00ff0303"
	local string c = "||"
	local string p = " "
	local string s = c1 + c + "|r"
	local string JVX
	if r > 85 then
		set JVX = s + p + s + p + s + p + s + p + s + p + s + p + s
	elseif r > 70 then
		set JVX = s + p + s + p + s + p + s + p + s + p + s + p + c
	elseif r > 55 then
		set JVX = s + p + s + p + s + p + s + p + s + p + c + p + c
	elseif r > 40 then
		set JVX = s + p + s + p + s + p + s + p + c + p + c + p + c
	elseif r > 25 then
		set JVX = s + p + s + p + s + p + c + p + c + p + c + p + c
	elseif r > 10 then
		set JVX = s + p + s + p + c + p + c + p + c + p + c + p + c
	elseif r > 0 then
		set JVX = s + p + c + p + c + p + c + p + c + p + c + p + c
	else
		set JVX = c + p + c + p + c + p + c + p + c + p + c + p + c
	endif
	return JVX
endfunction
function WAI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local integer level =(LoadInteger(HY, h, 5))
	local real HP =(LoadReal(HY, h, 232))
	local texttag tt =(LoadTextTagHandle(HY, h, 231))
	local integer count = GetTriggerEvalCount(t)
	local real WNI = RMaxBJ(HP -count, 0)
	call SetTextTagText(tt, WII( 100 * WNI / HP), .018)
	call SetTextTagPosUnit(tt, trigUnit, 0)
	call SetTextTagVisibility(tt, UnitVisibleToPlayer(trigUnit, LocalPlayer) or IsObserverPlayer(LocalPlayer))
	if WNI == 0 then
		call BMX(GetOwningPlayer(trigUnit), trigUnit, 25 * level)
	endif
	if WNI == 0 or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(trigUnit),'A10R', true)
		call UnitRemoveAbility(trigUnit,'A10S')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call DestroyTextTag(tt)
	endif
	set t = null
	set trigUnit = null
	set tt = null
	return false
endfunction
function IOE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(trigUnit,'A10R')
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real HP = GetWidgetLife(targetUnit)
	local texttag tt = CreateTextTag()
	local unit dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'e00E', 0, 0, 0)
	call ALX("SPLK", GetUnitX(trigUnit), GetUnitY(trigUnit), GetUnitX(targetUnit), GetUnitY(targetUnit), .1, .1, .2, .9, .5)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\Devour\\DevourEffectArt.mdl", GetUnitX(targetUnit), GetUnitY(targetUnit)))
	call SetTextTagText(tt, WII( 100 ), .018)
	call SetTextTagPosUnit(tt, trigUnit, 0)
	call SetTextTagVisibility(tt, UnitVisibleToPlayer(trigUnit, LocalPlayer))
	call SetTextTagPermanent(tt, true)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(trigUnit),'A10R', false)
	call UnitAddPermanentAbility(trigUnit,'A10S')
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call SaveTextTagHandle(HY, h, 231,(tt))
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h, 232,((HP)* 1.))
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterDeathEvent(t, trigUnit)
	call TriggerAddCondition(t, Condition(function WAI))
	call WXI(trigUnit, GetUnitTypeId(targetUnit))
	if IsUnitType(targetUnit, UNIT_TYPE_SUMMONED) == false then
		call UnitRemoveBuffs(targetUnit, true, true)
	endif
	call UnitRemoveAbility(targetUnit,'Aetl')
	call UnitDamageTargetEx(dummyCaster, targetUnit, 4, 100000000)
	call ShowUnit(targetUnit, false)
	set t = null
	set trigUnit = null
	set targetUnit = null
	set tt = null
	set dummyCaster = null
endfunction
function SWE takes nothing returns nothing
	call UnitAddPermanentAbility(GetTriggerUnit(),'A10R')
	call SetUnitAbilityLevel(GetTriggerUnit(),'A10R', GetUnitAbilityLevel(GetTriggerUnit(),'A32Z'))
endfunction
function WBI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer level = LoadInteger(HY, h, 3)
	local integer bookabil
	local integer WCI
	local integer WDI
	if GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
		if level == 1 then
			set WCI ='A1OE'
			set WDI ='A1OJ'
		elseif level == 2 then
			set WCI ='A1OF'
			set WDI ='A1OH'
		elseif level == 3 then
			set WCI ='A1OG'
			set WDI ='A1OK'
		elseif level == 4 then
			set WCI ='A1OD'
			set WDI ='A1OF'
		endif
		call SetUnitAbilityLevel(whichUnit, WCI, 1)
		call UnitMakeAbilityPermanent(whichUnit, true, WCI)
		call SetUnitAbilityLevel(whichUnit, WDI, 1)
		call UnitMakeAbilityPermanent(whichUnit, true, WDI)
	else
		if LoadInteger(HY, h, 0)< 1 then
			call UnitRemoveAbility(whichUnit,'A1OL')
			call UnitRemoveAbility(whichUnit,'A1ON')
			call UnitRemoveAbility(whichUnit,'A1OO')
			call UnitRemoveAbility(whichUnit,'A1OM')
			call UnitRemoveAbility(whichUnit,'B04J')
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call RemoveSavedHandle(HY, GetHandleId(whichUnit),'SCRD')
		else
			call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)-1)
		endif
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function IRE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(whichUnit,'A1OP')
	local integer T0V = 0
	local integer WFI = 0
	local integer WGI = 0
	if level == 1 then
		set T0V ='A1OL'
		set WFI ='A1OE'
		set WGI ='A1OJ'
	elseif level == 2 then
		set T0V ='A1ON'
		set WFI ='A1OF'
		set WGI ='A1OH'
	elseif level == 3 then
		set T0V ='A1OO'
		set WFI ='A1OG'
		set WGI ='A1OK'
	elseif level == 4 then
		set T0V ='A1OM'
		set WFI ='A1OD'
		set WGI ='A0FF'
	endif
	if HaveSavedHandle(HY, GetHandleId(whichUnit),'SCRD') then
		set t = LoadTriggerHandle(HY, GetHandleId(whichUnit),'SCRD')
		set h = GetHandleId(t)
		call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 1)
		if LoadInteger(HY, h, 3)!= level then
			call UnitRemoveAbility(whichUnit,'A1OL')
			call UnitRemoveAbility(whichUnit,'A1ON')
			call UnitRemoveAbility(whichUnit,'A1OO')
			call UnitRemoveAbility(whichUnit,'A1OM')
			call UnitRemoveAbility(whichUnit,'B04J')
			call SaveInteger(HY, h, 3, level)
		endif
		call TriggerRegisterTimerEvent(t, 6 + 2 * level, false)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 6 + 2 * level, false)
		call TriggerRegisterDeathEvent(t, whichUnit)
		call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
		call TriggerAddCondition(t, Condition(function WBI))
		call SaveUnitHandle(HY, h, 2, whichUnit)
		call SaveInteger(HY, h, 3, level)
		call SaveTriggerHandle(HY, GetHandleId(whichUnit),'SCRD', t)
	endif
	call UnitAddPermanentAbility(whichUnit, T0V)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit), T0V, false)
	call UnitMakeAbilityPermanent(whichUnit, true, WFI)
	call UnitMakeAbilityPermanent(whichUnit, true, WGI)
	call UnitMakeAbilityPermanent(whichUnit, true,'A33I')
	set whichUnit = null
	set t = null
endfunction	//call CIO(targetUnit, 3.) //末日A
function WHI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit stg_u = LoadUnitHandle(HY, h, 17)
	local integer time = LoadInteger(HY, h, 34)
	if GetUnitDistanceEx(whichUnit, stg_u)> 900 or UnitIsDead(whichUnit) then
		set time = time + 1
		call SaveInteger(HY, h, 34, time)
	endif
	if ModuloInteger(GetTriggerEvalCount(t), 10) == 1 then
		call UnitDamageTargetEx(whichUnit, stg_u, 7, LoadReal(HY, h, 5))
	endif
	if time > 150 or(GetUnitAbilityLevel(stg_u,'BNdo') == 0 and GetTriggerEvalCount(t)> 2) then
		call UnitRemoveAbility(stg_u,'BNdo')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call CIO(stg_u, 0.10)
	endif
	set t = null
	set whichUnit = null
	set stg_u = null
	return false
endfunction
function WJI takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitRemoveAbility(targetUnit,'A464')
	call UnitRemoveAbility(targetUnit,'B464')
	call UnitRemoveAbility(targetUnit,'BNdo')
	call GCX(GetSpellTargetUnit())
	call TriggerRegisterTimerEvent(t, .1, true)
	call CIO(targetUnit, 0.11)
	call TriggerAddCondition(t, Condition(function WHI))
	call SaveUnitHandle(HY,(h), 2,(u))
	call SaveUnitHandle(HY,(h), 17,(targetUnit))
	call SaveInteger(HY,(h), 34, 0)
	call SaveReal(HY, h, 5, 20 + 30 * GetUnitAbilityLevel(u,'A0A2'))
	call UnitAddAbility(d,'A466')
	call SetUnitAbilityLevel(d,'A466', GetUnitAbilityLevel(u,'A0A2'))
	call IssueTargetOrderById(d, 852583, targetUnit)
	set d = null
	set u = null
	set targetUnit = null
	set t = null
endfunction
function IAE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call WJI()
	endif
endfunction
function LTF takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	if GetUnitAbilityLevel(targetUnit,'B00U') == 0 or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call UnitRemoveAbility(targetUnit,'A1Q0')
		call UnitRemoveAbility(targetUnit,'A1Q1')
		call UnitRemoveAbility(targetUnit,'A1Q2')
		call UnitRemoveAbility(targetUnit,'A1Q3')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function IKE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A037')
	local integer N0X
	local integer WLI
	if level == 1 then
		set N0X ='A1Q0'
		set WLI ='A1PZ'
	elseif level == 2 then
		set N0X ='A1Q1'
		set WLI ='A1PI'
	elseif level == 3 then
		set N0X ='A1Q2'
		set WLI ='A1PY'
	elseif level == 4 then
		set N0X ='A1Q3'
		set WLI ='A1PX'
	endif
	call UnitRemoveAbility(targetUnit,'A1Q0')
	call UnitRemoveAbility(targetUnit,'A1Q1')
	call UnitRemoveAbility(targetUnit,'A1Q2')
	call UnitRemoveAbility(targetUnit,'A1Q3')
	call UnitAddAbilityToTimed(targetUnit, N0X, 1, 40, 0)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(targetUnit), N0X, false)
	call UnitMakeAbilityPermanent(targetUnit, true, WLI)
	set whichUnit = null
	set targetUnit = null
endfunction


function LWF takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	call UnitRemoveAbility(targetUnit,'A1Q6')
	call UnitRemoveAbility(targetUnit,'B0CX')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set targetUnit = null
	return false
endfunction

function WWI takes nothing returns boolean
	local real d
	if IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false and UnitIsDead(GetFilterUnit()) == false and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and IsUnitAlly(GetFilterUnit(), GetOwningPlayer(MEV)) and IsUnitInGroup(GetFilterUnit(), MOV) == false and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(MXV)) then
		set d = GetDistanceBetween(GetUnitX(GetFilterUnit()), GetUnitY(GetFilterUnit()), GetUnitX(MEV), GetUnitY(MEV))
		if d < MRV then
			set MVV = GetFilterUnit()
			set MRV = d
		endif
	endif
	return false
endfunction
function WYI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	local integer level =(LoadInteger(HY, h, 5))
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local group D7R =(LoadGroupHandle(HY, h, 187))
	local real WZI =(LoadReal(HY, h, 222))
	local real W_I =(LoadReal(HY, h, 223))
	local real W0I =(LoadReal(HY, h, 224))
	local real W5R
	local group g
	local real a
	local real x
	local real y
	local boolean b = false
	set a = Atan2(GetUnitY(targetUnit)-GetUnitY(dummyCaster), GetUnitX(targetUnit)-GetUnitX(dummyCaster))
	if whichUnit == targetUnit then
		set x = GetUnitX(dummyCaster)+ 25 * Cos(a)
		set y = GetUnitY(dummyCaster)+ 25 * Sin(a)
	else
		set x = GetUnitX(dummyCaster)+ 24 * Cos(a)
		set y = GetUnitY(dummyCaster)+ 24 * Sin(a)
	endif
	call SetUnitX(dummyCaster, x)
	call SetUnitY(dummyCaster, y)
	if GetDistanceBetween(x, y, GetUnitX(targetUnit), GetUnitY(targetUnit))< 60 then
		call SetUnitX(dummyCaster, GetUnitX(targetUnit))
		call SetUnitY(dummyCaster, GetUnitY(targetUnit))
		if whichUnit == targetUnit then
			call SetUnitState(whichUnit, UNIT_STATE_MANA, GetUnitState(whichUnit, UNIT_STATE_MANA)+ WZI)
			call KillUnit(dummyCaster)
			call DeallocateGroup(D7R)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			if UnitVisibleToPlayer(targetUnit, GetOwningPlayer(dummyCaster)) then
				set b = UnitHasSpellShield(targetUnit)
				if b == false then
					if GetUnitAbilityLevel(targetUnit,'A2S5')> 0 then
						call UnitDamageTargetEx(whichUnit, targetUnit, 3,(.35 * W0I + 1.)*(40 + 40 * level))
					else
						call UnitDamageTargetEx(whichUnit, targetUnit, 1,(.35 * W0I + 1.)*(40 + 40 * level))
					endif
					set W0I = W0I + 1
					if GetUnitState(targetUnit, UNIT_STATE_MANA)> 0 then
						set W5R = RMinBJ(GetUnitState(targetUnit, UNIT_STATE_MANA),(.35 * W_I + 1.)*(5 + 15* level))
						call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)-W5R)
						call A5X(NE, GetUnitX(targetUnit), GetUnitY(targetUnit))
						set WZI = WZI + W5R
						set W_I = W_I + 1
					endif
				else
					call UnitRemoveSpellShield(targetUnit)
				endif
			endif
			call SaveReal(HY, h, 222,((WZI)* 1.))
			call SaveReal(HY, h, 224,((W0I)* 1.))
			call SaveReal(HY, h, 223,((W_I)* 1.))
			set g = AllocationGroup(360)
			set MVV = null
			set MEV = targetUnit
			set MOV = D7R
			set MRV = 99999
			set MXV = whichUnit
			call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 500, Condition(function WWI))
			call DeallocateGroup(g)
			if MVV == null or W0I ==(2 + level) or b then
				call SaveUnitHandle(HY, h, 30,((whichUnit)))
			else
				call SaveUnitHandle(HY, h, 30,((MVV)))
				call GroupAddUnit(D7R, MVV)
			endif
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set dummyCaster = null
	set g = null
	set D7R = null
	return false
endfunction
function W1I takes unit whichUnit, unit targetUnit, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local group g = AllocationGroup(361)
	local real W0I = 0
	local real W_I = 0
	local real W5R = 0
	local real WZI = 0
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'h090', GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitFacing(whichUnit))
	call A5X(ME, GetUnitX(whichUnit), GetUnitY(whichUnit))
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function WYI))
	call SaveGroupHandle(HY, h, 187,(g))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	call SaveInteger(HY, h, 5,(level))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))
	call SaveInteger(HY, h, 34, 0)
	call SaveReal(HY, h, 222,((WZI)* 1.))
	call SaveReal(HY, h, 224,((W0I)* 1.))
	call SaveReal(HY, h, 223,((W_I)* 1.))
	call GroupAddUnit(g, targetUnit)
	set dummyCaster = null
	set t = null
endfunction
function IPE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A0G2')
	if GetUnitAbilityLevel(whichUnit,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(whichUnit), 0) then
		set whichUnit = LoadUnitHandle(HY, GetHandleId(whichUnit), 0)
	endif
	if UnitHasSpellShield(targetUnit) == false then
		call W1I(whichUnit, targetUnit, level)
	endif
	set whichUnit = null
	set targetUnit = null
endfunction
function ISE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer i = GetUnitAbilityLevel(u,'A418')
	call UnitRemoveAbility(u,'A09J')
	call UnitRemoveAbility(u,'A1ER')
	call UnitRemoveAbility(u,'A23F')
	call UnitRemoveAbility(u,'A417')
	call UnitRemoveAbility(u,'A419')
	call SetUnitAbilityLevel(u,'A1C0', i)
	set u = null
	call CDO(GetTriggerUnit())
endfunction
function IQE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A1C0')
	call UnitAddPermanentAbility(u,'A417')
	call SetUnitAbilityLevel(u,'A417', level)
	call UnitAddPermanentAbility(u,'A23F')
	call SetUnitAbilityLevel(u,'A09J', level)
	call UnitMakeAbilityPermanent(u, true,'A09J')
	call UnitAddPermanentAbility(u,'A1ER')
	call SetUnitAbilityLevel(u,'A1ER', level)
	call UnitAddPermanentAbility(u,'A419')
	set u = null
	call CDO(GetTriggerUnit())
endfunction
function W2I takes nothing returns nothing
	local unit u = GetEnumUnit()
	call SaveReal(HY, GetHandleId(u), 799, .0)
	set u = null
endfunction
function W3I takes nothing returns nothing
	local unit u = GetEnumUnit()
	call UnitRemoveAbility(u,'A2S3')
	call UnitRemoveAbility(u,'A2TM')
	call UnitRemoveAbility(u,'B0BQ')
	call SetUnitTurnSpeed(u, GetUnitDefaultTurnSpeed(u))
	set u = null
endfunction
function W4I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 2)
	local unit triggerUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 0)
	local real W5I = LoadReal(HY, h, 0)
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if LoadBoolean(HY, h, 0) == false then
			call SaveBoolean(HY, h, 0, true)
			call UnitDamageTargetEx(GetEventDamageSource(), GetTriggerUnit(), 7, GetEventDamage()* W5I)
			call SaveBoolean(HY, h, 0, false)
		endif
	else
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(triggerUnit,'A2S1')
		call UnitRemoveAbility(triggerUnit,'A2TL')
	endif
	set t = null
	set u = null
	set triggerUnit = null
	return false
endfunction
function W6I takes unit u, unit triggerUnit, integer level returns nothing
	local trigger t
	local integer h
	local unit dummyUnit
	local real W5I
	if IsUnitIllusion(triggerUnit) then
		call KillUnit(triggerUnit)
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	set dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'e00E', GetUnitX(triggerUnit), GetUnitY(triggerUnit), 0)
	call UnitAddAbility(dummyUnit,'A2S4')
	call IssueTargetOrderById(dummyUnit, 852095, triggerUnit)
	call TriggerRegisterDeathEvent(t, triggerUnit)
	call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_DAMAGED)
	call TriggerRegisterTimerEvent(t, 3, false)
	call TriggerAddCondition(t, Condition(function W4I))
	call SaveUnitHandle(HY, h, 2, u)
	call SaveUnitHandle(HY, h, 17, triggerUnit)
	call SaveInteger(HY, h, 0, level)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("Abilities\\Spells\\Orc\\EtherealForm\\SpiritWalkerChange.mdl", triggerUnit, "chest"))
	set W5I = .2 + .1 * level
	call SaveReal(HY, h, 0, W5I)
	call UnitAddPermanentAbility(triggerUnit,'A2S1')
	call UnitAddPermanentAbility(triggerUnit,'A2TL')
	call SetPlayerAbilityAvailable(GetOwningPlayer(triggerUnit),'A2S1', false)
	set t = null
	set dummyUnit = null
endfunction
function W7I takes nothing returns nothing
	local unit u = GetEnumUnit()
	call SaveReal(HY, GetHandleId(u), 799,(LoadReal(HY, GetHandleId(u), 799)+ .02)* 1.)
	if GetUnitAbilityLevel(u,'A2S3') == 0 then
		call UnitAddPermanentAbility(u,'A2S3')
		call UnitAddPermanentAbility(u,'A2TM')
		call SetUnitTurnSpeed(u, GetUnitDefaultTurnSpeed(u)* .5)
	endif
	if (LoadReal(HY, GetHandleId(u), 799)) == 2. then
		call W6I(DG, u, Q2)
	endif
	set u = null
endfunction
function W8I takes unit u, unit triggerUnit returns boolean
	local real I3X = AngleBetweenUnit(triggerUnit, u)
	local real N8X = GetUnitFacing(triggerUnit)
	local real W9I
	local real YVI
	local real YEI =-1.
	local real YXI =-1.
	local real YOI
	local real YRI
	local real YII =-1.
	local real YAI =-1.
	set W9I = RMaxBJ(N8X -85, 0)
	set YVI = N8X
	if N8X -85 <= 0 then
		set YEI = 360 -(85 -(YVI -W9I))
		set YXI = 360
	endif
	set YOI = N8X
	set YRI = RMinBJ(N8X + 85, 360)
	if N8X + 85 >= 360 then
		set YII = 0
		set YAI = 0 +(85 -(YRI -YOI))
	endif
	if I3X < 0 then
		set I3X = I3X + 360
	elseif I3X > 360 then
		set I3X = I3X -360
	endif
	if (I3X > W9I and I3X < YVI) or(YEI !=-1 and I3X > YEI and I3X < YXI) or(I3X > YOI and I3X < YRI) or(YII !=-1 and I3X > YII and I3X < YAI) then
		return true
	endif
	return false
endfunction
function YNI takes nothing returns boolean
	return DHX() and W8I(U2, GetFilterUnit())
endfunction
function YBI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local integer level = LoadInteger(HY, h, 0)
	local group g = AllocationGroup(362)
	local group gg = AllocationGroup(363)
	local group ag = LoadGroupHandle(HY, h, 187)
	set DG = whichUnit
	set U2 = whichUnit
	set Q2 = level
	call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 1025, Condition(function YNI))
	call ForGroup(g, function W7I)
	call GroupAddGroup(g, ag)
	call GroupAddGroup(ag, gg)
	call GroupRemoveGroup(g, gg)
	call DeallocateGroup(g)
	call DeallocateGroup(gg)
	call DestroyEffect(LoadEffectHandle(HY, h, 32))
	if GetTriggerEvalCount(t)> R2I(6 / .02) then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call ForGroup(ag, function W3I)
		call ForGroup(ag, function W2I)
		call DeallocateGroup(ag)
	else
		call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("Abilities\\Spells\\Orc\\EtherealForm\\SpiritWalkerChange.mdl", whichUnit, "chest"))
	endif
	set whichUnit = null
	set g = null
	set gg = null
	set ag = null
	set t = null
	return false
endfunction
function SpellEffect__StoneGaze takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterTimerEvent(t, .0, false)
	call TriggerAddCondition(t, Condition(function YBI))
	call SaveUnitHandle(HY, h, 2, GetTriggerUnit())
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("Abilities\\Spells\\Orc\\EtherealForm\\SpiritWalkerChange.mdl", GetTriggerUnit(), "chest"))
	call SaveGroupHandle(HY, h, 187, AllocationGroup(364))
	set t = null
endfunction
function YCI takes integer Y6R, unit R3O, unit R4O returns nothing
	if Y6R == 0 then
		call IssueTargetOrderById(R3O, 851983, R4O)
	endif
	if GetUnitAbilityLevel(R4O,'A3EC') == 1 and IsUnitMagicImmune(R4O) == false then
		if Y6R < 3 then
			call UnitAddAbilityToTimed(R4O,'A3ED', 1, 1.,'B3ED')
		elseif Y6R == 3 then
			call UnitAddAbilityToTimed(R4O,'A3EE', 1, 1.,'B3EE')
		elseif Y6R == 4 then
			call UnitAddAbilityToTimed(R4O,'A3EF', 1, 1.,'B3EF')
		elseif Y6R == 5 then
			call UnitAddAbilityToTimed(R4O,'A3EG', 1, 1.,'B3EG')
		else
			call UnitAddAbilityToTimed(R4O,'A3EH', 1, 1.,'B3EH')
		endif
	endif
endfunction
function YDI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer level =(LoadInteger(HY, h, 5))
	local integer count =(LoadInteger(HY, h, 34))
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local real YFI = .5
	local unit u = GetEventDamageSource()
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED then
		set count = count + 1
		call YCI(count, whichUnit, targetUnit)
		if count == 9 then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			call SaveInteger(HY, h, 34,(count))
		endif
	elseif IsEffectiveDamage(GetEventDamage()) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(u)) and IsUnitType(u, UNIT_TYPE_STRUCTURE) == false then
		if IsUnitType(u, UNIT_TYPE_HERO) or GetUnitAbilityLevel(u,'A04R') == 0 then
			call SetWidgetLife(u, GetWidgetLife(u)+ GetEventDamage()* YFI)
		else
			set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
			call SetWidgetLife(u, GetWidgetLife(u)+ GetEventDamage()* YFI)
		endif
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl", u, "origin"))
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set u = null
	return false
endfunction
function YGI takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call YCI(0, whichUnit, targetUnit)
	call UnitAddPermanentAbility(targetUnit,'A3EC')
	call SaveInteger(HY, h, 375, 0)
	call SaveInteger(HY, h, 5,(GetUnitAbilityLevel(whichUnit,'A194')))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 30, targetUnit)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function YDI))
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function IUE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call YGI()
	endif
endfunction
function PPX takes nothing returns nothing
	call SetBuffAbilityId('A3EC','PRGE')
	call SetBuffAbilityId('A3ED','PRGE')
	call SetBuffAbilityId('A3EE','PRGE')
	call SetBuffAbilityId('A3EF','PRGE')
	call SetBuffAbilityId('A3EG','PRGE')
	call SetBuffAbilityId('A3EH','PRGE')
	call SetBuffAbilityId('B3ED','PRGE')
	call SetBuffAbilityId('B3EE','PRGE')
	call SetBuffAbilityId('B3EF','PRGE')
	call SetBuffAbilityId('B3EG','PRGE')
	call SetBuffAbilityId('B3EH','PRGE')
endfunction
function YHI takes nothing returns nothing
	local unit whichUnit = MIV
	local unit targetUnit = GetEnumUnit()
	local integer level = MAV
	local trigger t = LaunchMissileByUnitDummy(whichUnit, targetUnit,'h0DF', "YJI", 600, false)
	local integer h = GetHandleId(t)
	call SaveReal(HY, h, 20,((level * 125 + 25)* 1.))
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function YKI takes unit whichUnit, unit targetUnit, integer level returns nothing
	local group g = AllocationGroup(365)
	set U2 = whichUnit
	set MIV = whichUnit
	set MAV = level
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 725, Condition(function DKX))
	call ForGroup(g, function YHI)
	call DeallocateGroup(g)
	set g = null
endfunction
//u=施法者 target=施法目标 ghoul = 噬魂鬼(马甲)
function Infest_Actions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit target =(LoadUnitHandle(HY, h, 17))
	local unit u =(LoadUnitHandle(HY, h, 14))
	local unit ghoul =(LoadUnitHandle(HY, h, 19))
	local integer lv =(LoadInteger(HY, h, 5))
	local player p = GetOwningPlayer(u)
	//call BJDebugMsg(I2S( GetIssuedOrderId() ))
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call UnitShareVision(target, p, false)
		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Human\\HumanLargeDeathExplode\\HumanLargeDeathExplode.mdl", GetUnitX(target), GetUnitY(target)))
		call SetUnitPosition(u, GetUnitX(target), GetUnitY(target))
		call ShowUnit(u, true)
		call SetUnitPathing(u, true)
		call EXPauseUnit(u, false)
		call ClearSelectionForPlayer(p)
		call SelectUnitForPlayerSingle(u, p)
		call SetUnitInvulnerable(u, false)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call DestroyEffect((LoadEffectHandle(HY, h, 177)))
		call RemoveUnit(ghoul)
		call UnitRemoveAbility(u,'A3L7')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call YKI(u, target, lv)
		call SaveInteger(HY,(GetHandleId((u))),(4310), 2)
	elseif IsUnitType(target, UNIT_TYPE_HERO) and IsUnitEnemy(target, p) then
		call UnitShareVision(target, p, false)
		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Human\\HumanLargeDeathExplode\\HumanLargeDeathExplode.mdl", GetUnitX(target), GetUnitY(target)))
		call SetUnitPosition(u, GetUnitX(target), GetUnitY(target))
		call ShowUnit(u, true)
		call EXPauseUnit(u, false)
		call UnitRemoveAbility(u,'A3L7')
		call SetUnitPathing(u, true)
		call ClearSelectionForPlayer(p)
		call SelectUnitForPlayerSingle(u, p)
		call SetUnitInvulnerable(u, false)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call DestroyEffect((LoadEffectHandle(HY, h, 177)))
		call RemoveUnit(ghoul)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call YKI(u, target, lv)
		call SaveInteger(HY,(GetHandleId((u))),(4310), 2)
	elseif GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT or(GetTriggerEventId() == EVENT_UNIT_ISSUED_ORDER and GetIssuedOrderId() == 852129) then
		if GetSpellAbilityId()=='A0SX' or GetSpellAbilityId()=='A459' or GetTriggerEventId() == EVENT_UNIT_ISSUED_ORDER then
			call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Human\\HumanLargeDeathExplode\\HumanLargeDeathExplode.mdl", GetUnitX(target), GetUnitY(target)))
			if IsUnitEnemy(target, p) then
				call SetWidgetLife(u, GetWidgetLife(u)+ GetWidgetLife(target))
			endif
			call UnitShareVision(target, p, false)
			call SetUnitPosition(u, GetUnitX(target), GetUnitY(target))
			call ShowUnit(u, true)
			call EXPauseUnit(u, false)
			call UnitRemoveAbility(u,'A3L7')
			call SetUnitPathing(u, true)
			call SetUnitAnimation(u, "Stand Victory")
			call BAX(u, 1.5)
			call ClearSelectionForPlayer(p)
			call SelectUnitForPlayerSingle(u, p)
			call SetUnitInvulnerable(u, false)
			call DestroyEffect((LoadEffectHandle(HY, h, 32)))
			call DestroyEffect((LoadEffectHandle(HY, h, 177)))
			call RemoveUnit(ghoul)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call YKI(u, target, lv)
			if IsUnitType(target, UNIT_TYPE_HERO) == false then
				if IsUnitType(target, UNIT_TYPE_SUMMONED) == false then
					call UnitRemoveBuffs(target, true, true)
				endif
				call UnitDamageTargetEx(u, target, 1, 100000)
				call UnitDamageTargetEx(u, target, 2, 100000)
				call UnitDamageTargetEx(u, target, 3, 100000)
			endif
			call SaveInteger(HY,(GetHandleId((u))),(4310), 2)
		elseif GetSpellAbilityId()=='A44H' then
			call SetUnitOwner(target, p, false)
			call I8X(target)
			if LoadBoolean(HY, h,'{') == false then
				call SaveBoolean(HY, h,'{', true)
				call TriggerRegisterUnitEvent(t, target, EVENT_UNIT_SPELL_EFFECT)
				if GetUnitTypeId(target)=='ncnk' or GetUnitTypeId(target)=='nowe' then
					call UnitAddPermanentAbility(target,'A459')
				else
					call UnitAddPermanentAbility(target,'A0SX')
				endif
			endif
			call SetUnitMoveSpeed(target, GetUnitMoveSpeed(u))
			call ClearSelectionForPlayer(p)
			call SelectUnitAddForPlayer(target, p)
		endif
	elseif GetTriggerEventId() == EVENT_PLAYER_UNIT_SELECTED and GetTriggerUnit() == target and GetOwningPlayer(target)!= p then
		call ClearSelectionForPlayer(p)
		call SelectUnitAddForPlayer(ghoul, p)
	else
		if GetOwningPlayer(target) == p then
			call SetUnitMoveSpeed(target, GetUnitMoveSpeed(u))
		endif
		call SetUnitPosition(u, GetUnitX(target), GetUnitY(target))
	endif
	set t = null
	set target = null
	set u = null
	set ghoul = null
	return false
endfunction
function Infest takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit target = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit ghoul = CreateUnit(GetOwningPlayer(u),'e010', 7260,-7732, 0)
	local string YMI = "Objects\\Spawnmodels\\Naga\\NagaBlood\\NagaBloodWindserpent.mdl"
	local string YPI = "Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBase.mdl"
	local string YQI = "Abilities\\Spells\\Other\\Aneu\\AneuTarget.mdl"
	// call PingMinimap(7260, -7732, 5)
	if IsPlayerEnemy(LocalPlayer, GetOwningPlayer(u)) and IsObserverPlayer(LocalPlayer) == false then
		set YMI = ""
		set YPI = ""
		set YQI = ""
	endif
	call FKX(u, false)
	if IsUnitType(u, UNIT_TYPE_SUMMONED) == false then
		call UnitRemoveBuffs(u, true, true)
	endif
	call SetUnitInvulnerable(ghoul, true)
	call UnitAddPermanentAbility(ghoul,'A0SX')
	if IsUnitType(target, UNIT_TYPE_HERO) == false and GetOwningPlayer(target)!= GetOwningPlayer(u) then
		call UnitAddPermanentAbility(ghoul,'A44H')
		call TriggerRegisterUnitEvent(t, target, EVENT_UNIT_ISSUED_ORDER)
	endif
	call ClearSelectionForPlayer(GetOwningPlayer(u))
	if GetOwningPlayer(target) == GetOwningPlayer(u) then
		if GetUnitTypeId(target)=='ncnk' or GetUnitTypeId(target)=='nowe' then
			call UnitAddPermanentAbility(target,'A459')
		else
			call UnitAddPermanentAbility(target,'A0SX')
		endif
		call TriggerRegisterUnitEvent(t, target, EVENT_UNIT_SPELL_EFFECT)
		call SelectUnitForPlayerSingle(target, GetOwningPlayer(u))
	else
		call SelectUnitForPlayerSingle(ghoul, GetOwningPlayer(u))
	endif
	call UnitShareVision(target, GetOwningPlayer(u), true)
	call SetUnitInvulnerable(u, true)
	call ShowUnit(u, false)
	call EXPauseUnit(u, true)
	call UnitAddPermanentAbility(u,'A3L7')
	call SetUnitPathing(u, false)
	call DestroyEffect(AddSpecialEffectTarget(YMI, target, "overhead"))
	call SaveUnitHandle(HY, h, 17,(target))
	call SaveUnitHandle(HY, h, 14,(u))
	call SaveUnitHandle(HY, h, 19,(ghoul))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget(YPI, target, "overhead")))
	call SaveEffectHandle(HY, h, 177,(AddSpecialEffectTarget(YQI, target, "overhead")))
	call SaveInteger(HY, h, 5,(GetUnitAbilityLevel(u,'A0SW')))
	call TriggerRegisterDeathEvent(t, u)
	call TriggerRegisterDeathEvent(t, target)
	call TriggerRegisterPlayerUnitEvent(t, GetOwningPlayer(u), EVENT_PLAYER_UNIT_SELECTED, null)
	call TriggerRegisterUnitEvent(t, ghoul, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerAddCondition(t, Condition(function Infest_Actions))
	call SaveInteger(HY, GetHandleId(u), 4310, 1)
	set t = null
	set u = null
	set target = null
	set ghoul = null
endfunction

//感染目标条件
function InfestTargetCondition takes unit u returns boolean
	return ( IsUnitEnemy(u, GetOwningPlayer(GetTriggerUnit())) and( IsUnitType(u, UNIT_TYPE_HERO) or IsUnitIllusion(u) or u== Roshan or IsBearUnit(u) ) ) or IsUnitMessenger(u) 
endfunction

function JYE takes nothing returns nothing
	if InfestTargetCondition(GetSpellTargetUnit()) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n0LV'))
	endif
endfunction
function YSI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	call ResetUnitVertexColor(trigUnit)
	call UnitRemoveAbility(trigUnit,'A0SR')
	call UnitRemoveAbility(trigUnit,'A0ST')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set trigUnit = null
	return false
endfunction
function IYE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(trigUnit,'A0T2')
	local integer i = 0
	call SetUnitVertexColorEx(trigUnit, 0, 0, 0,-1)
	call SetPlayerAbilityAvailable(GetOwningPlayer(trigUnit),'A0ST', false)
	call UnitAddPermanentAbility(trigUnit,'A0ST')
	call UnitAddPermanentAbility(trigUnit,'A0SR')
	call SetUnitAbilityLevel(trigUnit,'A0SR', level)
	call FKX(trigUnit, false)
	call FJX(trigUnit)
	call SaveUnitHandle(HY, h, 14, trigUnit)
	call TriggerRegisterTimerEvent(t, 2 + level, false)
	call TriggerAddCondition(t, Condition(function YSI))
	set trigUnit = null
	set t = null
endfunction
function YTI takes nothing returns boolean
	return(IsUnitEnemy(DESource, GetOwningPlayer(DETarget)) and(GetUnitAbilityLevel(DESource,'A0SS')> 0) and GetUnitTypeId(DETarget)!='n00L' and GetUnitTypeId(DETarget)!='n0F5' and RHX(GetUnitTypeId(DETarget)) == false and GetUnitAbilityLevel(DESource,'A36D') == 0 and IsUnitType(DETarget, UNIT_TYPE_STRUCTURE) == false and GetUnitAbilityLevel(DETarget,'A04R') == 0)!= null
endfunction
function YUI takes unit whichUnit, unit targetUnit returns nothing
	local integer level = GetUnitAbilityLevel(whichUnit,'A0SS')
	local real IXX
	if (not(Mode__BalanceOff)) and(IsUnitType(whichUnit, UNIT_TYPE_RANGED_ATTACKER)) then
		set IXX =(.0175 + .01 * level)* GetWidgetLife(targetUnit)
	else
		set IXX =(.03 + .01 * level)* GetWidgetLife(targetUnit)
	endif
	call SetWidgetLife(whichUnit, IXX + GetWidgetLife(whichUnit))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl", whichUnit, "origin"))
endfunction
function YWI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call UnitReduceStateBonus(LoadUnitHandle(ObjectHashTable, h, 0), LoadInteger(ObjectHashTable, h, 0), UNIT_BONUS_DAMAGE)
	call RemoveSavedHandle(ObjectHashTable, GetHandleId(LoadUnitHandle(ObjectHashTable, h, 0)),'A0SS')
	call FlushChildHashtable(ObjectHashTable, h)
	call DestroyTimer(t)
	set t = null
endfunction
function YYI takes unit u, unit targetUnit, integer level returns nothing
	local timer t
	local integer h
	local integer d
	local real r = GetWidgetLife(targetUnit)
	local boolean b = HaveSavedHandle(ObjectHashTable, GetHandleId(u),'A0SS')
	if b then
		set t = LoadTimerHandle(ObjectHashTable, GetHandleId(u),'A0SS')
		set h = GetHandleId(t)
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveTimerHandle(ObjectHashTable, GetHandleId(u),'A0SS', t)
		call SaveUnitHandle(ObjectHashTable, h, 0, u)
	endif
	call TimerStart(t, 2, false, function YWI)
	if (not(Mode__BalanceOff)) and(IsUnitType(u, UNIT_TYPE_RANGED_ATTACKER)) then
		set d = R2I((.0175 + .01 * level)* r)
	else
		set d = R2I((.03 + .01 * level)* r)
	endif
	if b then
		if d != LoadInteger(ObjectHashTable, h, 0) then
			call UnitAddStateBonus(u, d -LoadInteger(ObjectHashTable, h, 0), UNIT_BONUS_DAMAGE)
		endif
	else
		call UnitAddStateBonus(u, d, UNIT_BONUS_DAMAGE)
	endif
	call SaveInteger(ObjectHashTable, h, 0, d)
	call SaveUnitHandle(ObjectHashTable, h, 0, u)
	set t = null
endfunction
function YZI takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local real hp = GetWidgetLife(targetUnit)-1
	local real Y_I = GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)
	local real damageValue = .003 * MBV * Y_I / 2
	call UnitDamageTargetEx(MNV, targetUnit, 11, damageValue)
	set targetUnit = null
endfunction
function Y0I takes nothing returns boolean
	return DKX() and GetUnitAbilityLevel(GetFilterUnit(),'B084')> 0
endfunction
function Y1I takes nothing returns nothing
	local integer h = GetHandleId(GetExpiredTimer())
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local group g
	if UnitIsDead(whichUnit) == false and GetUnitAbilityLevel(whichUnit,'A36D') == 0 then
		set g = AllocationGroup(366)
		set MNV = whichUnit
		set MBV = GetUnitAbilityLevel(whichUnit,'P302')+ 1
		call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 1225, Condition(function Y0I))
		call ForGroup(g, function YZI)
		call DeallocateGroup(g)
	endif
	set g = null
	set whichUnit = null
endfunction
function MAE takes nothing returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .5, true, function Y1I)
	call SaveUnitHandle(HY, GetHandleId(t), 2, GetTriggerUnit())
	set t = null
endfunction
function Y2I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	local integer c = LoadInteger(ObjectHashTable, WFV, 2)+ 1
	if UnitIsDead(u) or c > 6 * 10 then
		call DestroyTimerAndFlushHT_P(t)
	else
		call SetWidgetLife(u, GetWidgetLife(u)+ LoadInteger(ObjectHashTable, WFV, 0)* .1)
		call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ LoadInteger(ObjectHashTable, WFV, 1)* .1)
		call SaveInteger(ObjectHashTable, WFV, 2, c)
	endif
	set t = null
	set u = null
endfunction
function Y3I takes unit u, integer WUV, boolean b returns nothing
	local timer t = CreateTimer()
	local integer WFV = GetHandleId(t)
	local integer mp = 2 * WUV
	local integer hp = WUV
	if WUV == 4 then
		set mp = 12
		set hp = 6
	endif
	if b then
		set mp = mp * 10
		set hp = hp * 10
	endif
	call UnitAddAbilityLevel1ToTimed(u,'C012','D012', 6)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl", u, "origin"))
	call SaveUnitHandle(ObjectHashTable, WFV, 0, u)
	call SaveInteger(ObjectHashTable, WFV, 0, hp)
	call SaveInteger(ObjectHashTable, WFV, 1, mp)
	call TimerStart(t, .1, true, function Y2I)
	set t = null
endfunction
function Y4I takes unit killingUnit, unit triggerUnit returns nothing
	local unit u
	local integer WUV
	if IsUnitIllusion(triggerUnit) or GetUnitTypeId(triggerUnit)=='u00S' then
		set u = null
		return
	endif
	if LoadInteger(HY, GetHandleId(triggerUnit), 4333) == 1 then
		set u = Player__Hero[GetPlayerId(LoadPlayerHandle(HY, GetHandleId(triggerUnit), 4333))]
	elseif GetUnitAbilityLevel(killingUnit,'Aloc') == 1 then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(killingUnit))]
	else
		set u = killingUnit
	endif
	set WUV = GetUnitAbilityLevel(u,'P303')
	if WUV > 0 and UnitAlive(u) and GetUnitAbilityLevel(u,'A36D') == 0 then
		call Y3I(u, WUV, IsUnitType(triggerUnit, UNIT_TYPE_HERO))
	endif
	set u = null
endfunction
function YJI takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit whichUnit = U2
	local unit targetUnit = MissileHitTargetUnit
	local real IXX =(LoadReal(HY, h, 20))
	local real OCI =(LoadReal(HY, h, 21))
	if IsUnitAlly(targetUnit, GetOwningPlayer(whichUnit)) then
		call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+ OCI)
	else
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, IXX)
	endif
	set whichUnit = null
	set targetUnit = null
endfunction
function Y5I takes nothing returns nothing
	local trigger t = LaunchMissileByUnitDummy(U2, GetEnumUnit(),'h00W', "YJI", 400, false)
	local integer h = GetHandleId(t)
	call SaveReal(HY, h, 20,((S2)* 1.))
	call SaveReal(HY, h, 21,((TJ)* 1.))
	set t = null
endfunction
function Y6I takes nothing returns nothing
	if UnitVisibleToPlayer(GetEnumUnit(), GetOwningPlayer(U2)) or(IsUnitFogged(GetEnumUnit(), GetOwningPlayer(U2)) and IsUnitInvision(GetEnumUnit()) == false) then
		call Y5I()
	endif
endfunction
function IZE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local group g = AllocationGroup(367)
	local integer level = GetUnitAbilityLevel(trigUnit,'A05V')
	local real r = 500
	local real IXX
	if level == 1 then
		set IXX = 125
	elseif level == 2 then
		set IXX = 175
	elseif level == 3 then
		set IXX = 225
	elseif level == 4 then
		set IXX = 275
	endif
	set U2 = trigUnit
	set S2 = IXX
	set TJ = 50 + 20 * level
	call GroupEnumUnitsInRange(g, GetUnitX(trigUnit), GetUnitY(trigUnit), r, Condition(function FVX))
	call GroupRemoveUnit(g, trigUnit)
	call ForGroup(g, function Y6I)
	call DeallocateGroup(g)
	call SetWidgetLife(trigUnit, GetWidgetLife(trigUnit)+ TJ)
	set trigUnit = null
	set g = null
endfunction
function Y7I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real YFI =(LoadReal(HY, h, 680))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl", targetUnit, "origin"))
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, YFI *(GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)-GetWidgetLife(targetUnit)))
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function Y8I takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer Y9I = GetUnitAbilityLevel(whichUnit,'A067')
	local integer ZVI = GetUnitAbilityLevel(whichUnit,'A08P')
	local real YFI
	if GetUnitAbilityLevel(whichUnit,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(whichUnit), 0) then
		set whichUnit = LoadUnitHandle(HY, GetHandleId(whichUnit), 0)
	endif
	if Y9I == 1 then
		set YFI = .4
	elseif Y9I == 2 or ZVI == 1 then
		set YFI = .6
	elseif Y9I == 3 or ZVI == 2 then
		set YFI = .9
	elseif ZVI == 3 then
		set YFI = 1.2
	endif
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveReal(HY, h, 680,((YFI)* 1.))
	call TriggerRegisterTimerEvent(t, 1., false)
	call TriggerAddCondition(t, Condition(function Y7I))
	call EPX(targetUnit, 4333, 1.5)
	call SavePlayerHandle(HY, GetHandleId(targetUnit), 4333, GetOwningPlayer(whichUnit))
	if ZVI > 0 then
		call EPX(targetUnit, 4418, 1.51)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function I_E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call Y8I()
	endif
endfunction
function I0E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x1 = GetUnitX(u)
	local real y1 = GetUnitY(u)
	local real a
	local real x2
	local real y2
	local integer lv = GetUnitAbilityLevel(u,'A0X7')
	local real damage
	local real dur
	local unit target = null
	if GetSpellTargetUnit()!= null then
		set x2 = GetUnitX(GetSpellTargetUnit())
		set y2 = GetUnitY(GetSpellTargetUnit())
	else
		set x2 = GetSpellTargetX()
		set y2 = GetSpellTargetY()
	endif
	set a = Atan2(y2 -y1, x2 -x1)
	set x2 = x1 + 700 * Cos(a)
	set y2 = y1 + 700 * Sin(a)
	if lv == 1 then
		set damage = 80
		set dur = .75
	elseif lv == 2 then
		set damage = 140
		set dur = 1.25
	elseif lv == 3 then
		set damage = 200
		set dur = 1.75
	elseif lv == 4 then
		set damage = 260
		set dur = 2.25
	endif
	if GetSpellTargetUnit()!= null and UnitHasSpellShield(GetSpellTargetUnit()) then
		set target = GetSpellTargetUnit()
	endif
	call UnitSpellEffectImpale(u, target, damage, dur, .52, x1, y1, x2, y2, 150, null, true, 1600)
	set u = null
	set target = null
endfunction
function ZEI takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local real r = GetHeroInt(targetUnit, true)*(3 + .5 * GetUnitAbilityLevel(whichUnit,'A1H5'))
	local integer ZXI = IMinBJ(R2I(r), R2I(GetUnitState(targetUnit, UNIT_STATE_MANA)))
	call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)-ZXI)
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, ZXI)
	call CHX("MBUR", whichUnit, targetUnit, 1, 1, 1, 1, .5)
	call CommonTextTag("-" + I2S(ZXI), 3, targetUnit, .023, 82, 82, 255, 255)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ManaBurn\\ManaBurnTarget.mdl", targetUnit, "chest"))
	set whichUnit = null
	set targetUnit = null
endfunction
function I1E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call ZEI()
	endif
endfunction

// 清除尖刺外壳
function ZOI takes trigger trig, unit u, integer WFV returns nothing
	call RemoveSavedHandle(HY, GetHandleId(u),'A2KO')
	call DestroyEffect(LoadEffectHandle(HY, WFV, 3))
	call DestroyEffect(LoadEffectHandle(HY, WFV, 4))
	call DestroyEffect(LoadEffectHandle(HY, WFV, 5))
	call DestroyEffect(LoadEffectHandle(HY, WFV, 6))
	call DeallocateGroup(LoadGroupHandle(HY, WFV, 7))
	call FlushChildHashtable(HY, WFV)
	call CleanCurrentTrigger(trig)
endfunction

// 尖刺外壳事件
function ZRI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamage()> 0 and IsPlayerEnemy(GetOwningPlayer(GetEventDamageSource()), GetOwningPlayer(whichUnit)) and FK and IsUnitInGroup(Player__Hero[GetPlayerId(GetOwningPlayer(GetEventDamageSource()))], LoadGroupHandle(HY, h, 7)) == false then
			// 判断是否玩家单位
			if XFX(GetOwningPlayer(GetEventDamageSource())) and IsEffectiveDamage(GetEventDamage()) then
				// 减伤
				call SetUnitToReduceDamage(whichUnit, GetEventDamage())
				if GetUnitAbilityLevel(GetEventDamageSource(),'A04R')> 0 or GetUnitAbilityLevel(GetEventDamageSource(),'Aloc')> 0 then
					set targetUnit = Player__Hero[GetPlayerId(GetOwningPlayer(GetEventDamageSource()))]
				else
					set targetUnit = GetEventDamageSource()
				endif
				call GroupAddUnit(LoadGroupHandle(HY, h, 7), targetUnit)
				if UnitAlive(targetUnit) then
					call CommonUnitAddStun(targetUnit, .6 * LoadInteger(HY, h, 0), false)
					// 返回纯粹伤害
					call UnitDamageTargetEx(whichUnit, targetUnit, 3, GetEventDamage())
				endif
			endif
		endif
	elseif LoadInteger(HY, h, 1) == 0 then
		call ZOI(t, whichUnit, h)
	else
		// 这里没 - 1 可能是导致出bug的原因
		call SaveInteger(HY, h, 1, LoadInteger(HY, h, 1) - 1 )
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction

// 尖刺外壳
function I2E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t
	local integer h
	if HaveSavedHandle(HY, GetHandleId(whichUnit),'A2KO') then
		set t = LoadTriggerHandle(HY, GetHandleId(whichUnit),'A2KO')
		set h = GetHandleId(t)
		call GroupClear(LoadGroupHandle(HY, h, 7))
		call TriggerRegisterTimerEvent(t, 2.25, false)
		call SaveInteger(HY, h, 1, LoadInteger(HY, h, 1)+ 1)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 2.25, false)
		call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(t, Condition(function ZRI))
		call SaveUnitHandle(HY, h, 2,(whichUnit))
		call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
		call SaveGroupHandle(HY, h, 7, AllocationGroup(368))
		call SaveEffectHandle(HY, h, 3, AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ThornyShield\\ThornyShieldTargetChestLeft.mdl", whichUnit, "chest,left"))
		call SaveEffectHandle(HY, h, 4, AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ThornyShield\\ThornyShieldTargetChestRight.mdl", whichUnit, "chest,right"))
		call SaveEffectHandle(HY, h, 5, AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ThornyShield\\ThornyShieldTargetChestMountLeft.mdl", whichUnit, "mount,left"))
		call SaveEffectHandle(HY, h, 6, AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ThornyShield\\ThornyShieldTargetChestMountRight.mdl", whichUnit, "mount,right"))
		call SaveTriggerHandle(HY, GetHandleId(whichUnit),'A2KO', t)
	endif
	set whichUnit = null
	set t = null
endfunction

function WIO takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit whichUnit = MissileHitTargetUnit
	local unit targetUnit = U2
	local integer ZII
	local integer ZAI
	local integer level
	if GetUnitAbilityLevel(whichUnit,'A04R')!= 0 then
		set whichUnit = Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))]
	endif
	set ZII = GetUnitAbilityLevel(whichUnit,'A0CQ')
	set level = GetUnitAbilityLevel(whichUnit,'A0BR')
	if level == 1 then
		set ZAI = 12
	elseif level == 2 then
		set ZAI = 20
	elseif level == 3 then
		set ZAI = 28
	else
		set ZAI = 36
	endif
	set ZAI = ZAI + 1
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) == false then
		set ZII = ZII + 1
	else
		set ZII = ZII + 12
	endif
	set ZII = IMinBJ(ZAI, ZII)
	call SetUnitAbilityLevel(whichUnit,'A0CQ', ZII)
	call SaveInteger(HY,(GetHandleId(whichUnit)), 710,(ZII))
	set whichUnit = null
	set targetUnit = null
endfunction
function ZNI takes nothing returns nothing
	local integer ZII
	local integer level
	local integer ZAI
	local trigger t
	local integer h
	local unit whichUnit = GetKillingUnit()
	if GetUnitTypeId(whichUnit)=='e00E' then
		set whichUnit = Player__Hero[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]
	endif
	set ZII = GetUnitAbilityLevel(whichUnit,'A0CQ')
	set level = GetUnitAbilityLevel(whichUnit,'A0BR')
	set ZAI = 8 + 7 * level
	if ZII <= ZAI then
		set t = LaunchMissileByUnitDummy(GetTriggerUnit(), whichUnit,'h0CR', "WIO", 3000, false)
		set h = GetHandleId(t)
		set t = null
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\ZigguratMissile\\ZigguratMissile.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
	endif
	set whichUnit = null
endfunction
function ZBI takes nothing returns nothing
	local integer i = R2I(GetUnitAbilityLevel(GetTriggerUnit(),'A0CQ')* .5)+ 1
	call SaveInteger(HY, GetHandleId(GetTriggerUnit()), 710, R2I(GetUnitAbilityLevel(GetTriggerUnit(),'A0CQ')* .5)+ 1)
	call UnitRemoveAbility(GetTriggerUnit(), 'A0CQ')
	call UnitAddAbility(GetTriggerUnit(), 'A0CQ')
	call UnitMakeAbilityPermanent(GetTriggerUnit(), true, 'A0CQ')
	call SetUnitAbilityLevel(GetTriggerUnit(),'A0CQ', i)
endfunction
function ZCI takes unit killingUnit, unit triggerUnit returns nothing
	if IsUnitIllusion(triggerUnit) then
		return
	endif
	if IsUnitType(killingUnit, UNIT_TYPE_HERO) == false then
		set killingUnit = Player__Hero[GetPlayerId(GetOwningPlayer(killingUnit))]
	endif
	if GetUnitAbilityLevel(killingUnit,'A0BR')> 0 then
		call ZNI()
	endif
	if GetUnitAbilityLevel(triggerUnit,'A0BR')> 0 then
		call ZBI()
	endif
endfunction
function ZDI takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0)!= null
endfunction
function ZFI takes nothing returns nothing
	call UnitDamageTargetEx(TK, GetEnumUnit(), 1, 25 + 75 * UK)
endfunction
function I3E takes nothing returns boolean
	local unit trigUnit = GetTriggerUnit()
	local real ZRO
	local real a
	local real x
	local real y
	local group g = AllocationGroup(369)
	if GetUnitAbilityLevel(trigUnit,'A04R')> 0 then
		set trigUnit = Player__Hero[GetPlayerId(GetOwningPlayer(trigUnit))]
	endif
	if GetSpellAbilityId()=='A0EY'then
		set ZRO = 200
	elseif GetSpellAbilityId()=='A0FH'then
		set ZRO = 450
	elseif GetSpellAbilityId()=='A0F0'then
		set ZRO = 700
	endif
	set a = GetUnitFacing(trigUnit)
	set x = GetWidgetX(trigUnit)+ ZRO * Cos(a * bj_DEGTORAD)
	set y = GetWidgetY(trigUnit)+ ZRO * Sin(a * bj_DEGTORAD)
	set TK = trigUnit
	set UK = GetUnitAbilityLevel(trigUnit, GetSpellAbilityId())
	call UnitApplyTimedLife(CreateUnit(GetOwningPlayer(trigUnit),'e006', x, y, 0),'BTLF', 2)
	call GroupEnumUnitsInRange(g, x, y, 275, Condition(function ZDI))
	call ForGroup(g, function ZFI)
	call DeallocateGroup(g)
	set trigUnit = null
	set g = null
	return false
endfunction
function MNE takes nothing returns nothing
	call UnitAddPermanentAbility(GetTriggerUnit(),'A0CQ')
endfunction
function PDE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer WUV = GetUnitAbilityLevel(u,'A0EY')
	if WUV == 1 then
		call UnitAddPermanentAbility(u,'A0F0')
		call UnitAddPermanentAbility(u,'A0FH')
	else
		call SetUnitAbilityLevel(u,'A0F0', WUV)
		call SetUnitAbilityLevel(u,'A0FH', WUV)
	endif
	set u = null
endfunction

function I5E takes nothing returns nothing
	local unit dummyCaster
	if (O6X() == false) then
		set dummyCaster = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit()), bj_UNIT_FACING)
		call UnitAddPermanentAbility(dummyCaster,'A02R')
		call IssueTargetOrderById(dummyCaster, 852075, GetSpellTargetUnit())
	else
		set dummyCaster = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit()), bj_UNIT_FACING)
		call UnitAddPermanentAbility(dummyCaster,'A1H1')
		call IssueTargetOrderById(dummyCaster, 852075, GetSpellTargetUnit())
	endif
	set dummyCaster = null
endfunction
function ZLI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit dummyCaster = LoadUnitHandle(HY, h, 19)
	call ResetUnitAnimation(whichUnit)
	call RemoveUnit(dummyCaster)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set whichUnit = null
	set dummyCaster = null
	set t = null
	return false
endfunction
function ZMI takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'u01I', GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitFacing(whichUnit))
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call EnableAttackEffectByTime(A, 4 + GetUnitAbilityLevel(whichUnit,'A08Q'))
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function ZLI))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 19, dummyCaster)
	call SetUnitVertexColorBJ(dummyCaster, 0, 0, 0, 75)
	call SetUnitAnimation(dummyCaster, "spell third")
	set whichUnit = null
	set dummyCaster = null
	set t = null
endfunction
function bsckj takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call EnableAttackEffectByTime(A, 3)
	endif
endfunction
function LXE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call ZMI()
	endif
endfunction



function PNE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A086')
	call UnitAddPermanentAbility(u,'P247')
	if (O6X() or GetUnitAbilityLevel(u,'A36D') == 1) then
		call SetUnitAbilityLevel(u,'P247', 5)
	else
		call SetUnitAbilityLevel(u,'P247', level)
	endif
	set u = null
endfunction
function sckj takes unit u, boolean b returns nothing
	if b then
		call UnitAddAbility(u,'A08w')	//A08c 变晚上
		call UnitRemoveAbility(u,'A08w')
		call SetUnitAbilityLevel(u,'A08Q', GetUnitAbilityLevel(u,'A08E'))
	else
		call SetUnitAbilityLevel(u,'A08Q', 1)
		call UnitAddAbility(u,'A08q')	//A08Q 变白天
		call UnitRemoveAbility(u,'A08q')
	endif
endfunction
function SME takes nothing returns nothing
	local unit u = GetTriggerUnit()
	if GetUnitAbilityLevel(u,'A08E') == 1 then
		call UnitAddPermanentAbility(u,'A08Q')
	endif
	call SetUnitAbilityLevel(u,'A08Q', GetUnitAbilityLevel(u,'A08E'))
	if (O6X()) then
		call sckj(u, false)
	else
		call sckj(u, true)
	endif
	set u = null
endfunction
function ZSI takes nothing returns nothing
	local real ZTI
	local real ZUI = 800
	local integer id
	local integer i
	local integer ZWI = 0
	local integer level
	local integer ZYI
	if LoadInteger(SightDataHashTable, GetUnitTypeId(GetEnumUnit()), NightSightHash)> 0 then
		set ZUI = LoadInteger(SightDataHashTable, GetUnitTypeId(GetEnumUnit()), NightSightHash)* 1.
	endif
	if GetPlayerTechResearched(GetOwningPlayer(GetEnumUnit()),'R00I', true) then
		set ZUI = 1800.
	endif
	set ZYI = R2I(ZUI / 128)
	if ZYI > 5 then
		set ZWI = IMinBJ(ZYI -5, 8)
	endif
	if ZWI > 0 then
		set id ='DRK0'-1 + ZWI
		if GetUnitAbilityLevel(GetEnumUnit(), id) == 0 then
			call UnitRemoveAbility(GetEnumUnit(),'DRK0')
			call UnitRemoveAbility(GetEnumUnit(),'DRK1')
			call UnitRemoveAbility(GetEnumUnit(),'DRK2')
			call UnitRemoveAbility(GetEnumUnit(),'DRK3')
			call UnitRemoveAbility(GetEnumUnit(),'DRK4')
			call UnitRemoveAbility(GetEnumUnit(),'DRK5')
			call UnitRemoveAbility(GetEnumUnit(),'DRK6')
			call UnitRemoveAbility(GetEnumUnit(),'DRK7')
			call UnitAddPermanentAbility(GetEnumUnit(), id)
		endif
	endif
endfunction
function ZZI takes nothing returns nothing
	if GetUnitAbilityLevel(GetEnumUnit(),'DRK0')> 0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK1')> 0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK2')> 0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK3')> 0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK4')> 0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK5')> 0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK6')> 0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK7')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'DRK0')
		call UnitRemoveAbility(GetEnumUnit(),'DRK1')
		call UnitRemoveAbility(GetEnumUnit(),'DRK2')
		call UnitRemoveAbility(GetEnumUnit(),'DRK3')
		call UnitRemoveAbility(GetEnumUnit(),'DRK4')
		call UnitRemoveAbility(GetEnumUnit(),'DRK5')
		call UnitRemoveAbility(GetEnumUnit(),'DRK6')
		call UnitRemoveAbility(GetEnumUnit(),'DRK7')
	endif
endfunction
function Z_I takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player p = LoadPlayerHandle(HY, h, 0)
	local real WOV = LoadReal(HY, h, 0)-0.5
	local group g = AllocationGroup(371)
	local group gg = AllocationGroup(372)
	local player p2
	local integer i = 0
	loop
		set p2 = Player(i)
		if IsPlayerEnemy(p, p2) then
			call GroupEnumUnitsOfPlayer(gg, p2, null)
			call GroupAddGroup(gg, g)
		endif
		set i = i + 1
	exitwhen i > 15
	endloop
	call SaveReal(HY, h, 0, WOV)
	set E3 = p
	if WOV > 0 then
		call ForGroup(g, function ZSI)
	else
		call ForGroup(g, function ZZI)
	endif
	if WOV <-20 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	call DeallocateGroup(g)
	call DeallocateGroup(gg)
	set t = null
endfunction
function Z0I takes unit u, real SYV returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function Z_I))
	call SavePlayerHandle(HY, h, 0, GetOwningPlayer(u))
	call SaveReal(HY, h, 0, SYV)
	set t = null
endfunction
function YSV takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real SYV = 50.
	local unit d = CreateUnit(SentinelPlayers[1],'e00E', 0, 0, 0)
	call YHR(SYV, false)
	call UnitAddAbility(d,'A1T6')
	call IssueImmediateOrderById(d, 852621)
	if Mode__BalanceOff then
		call Z0I(u, SYV)
	endif
	set d = null
	set u = null
endfunction

globals
	unit AttackReadySource
	unit AttackReadyTarget
endglobals

function UnitLaunchAttack takes unit source, unit target returns nothing
	set AttackReadySource = source
	set AttackReadyTarget = target
	call MHGame_ExecuteFunc("ExecteAttackReady")
	call AddUnitBonusRange(source, 99999, false)
	call MHUnit_LaunchAttack(source, 1, target)
	call AddUnitBonusRange(source, - 99999, false)
endfunction
// 窒息之刃
function StiflingDaggerOnMissileHit takes nothing returns nothing
	local integer h           = GetHandleId(GetTriggeringTrigger())
	local unit    whichUnit  = U2
	local unit    targetUnit  = MissileHitTargetUnit
	local integer level       = (LoadInteger(HY, h, 5))
	local real    damage      = level * 40 + 20
	local unit    dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local boolean b 		  = LoadBoolean(HY, h, 6)
	if b then
		set damage = damage * LoadReal(HY, h, 6)
	endif
	call UnitAddPermanentAbility(dummyCaster,'A0YL')
	call SetUnitAbilityLevel(dummyCaster,'A0YL', level)
	call IssueTargetOrderById(dummyCaster, 852075, targetUnit)
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		set damage = damage / 2
	endif
	
	if UnitAlive(targetUnit) and LoadBoolean(HY, h, 0) then
		call UnitLaunchAttack(whichUnit, targetUnit)
	endif

	call UnitDamageTargetEx(whichUnit, targetUnit, 3, damage)

	if b then
		call CommonTextTag(I2S(R2I(damage))+ "!", 3, targetUnit, .02, 255, 0, 0, 255)
	endif
	
	set b = false
	if GetUnitAbilityLevel(whichUnit,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(whichUnit), 0) then
		set whichUnit = LoadUnitHandle(HY, GetHandleId(whichUnit), 0)
		set b = true
	endif
	// 回音护盾？
	if b == false and GetUnitAbilityLevel(targetUnit,'A3E9') == 1 and IsUnitMagicImmune(whichUnit) == false then
		set Q2 = level
		set U2 = whichUnit
		set MissileHitTargetUnit = targetUnit
		call ExecuteFunc("Z3I")
	endif
	set whichUnit = null
	set targetUnit = null
	set dummyCaster = null
endfunction
function StiflingDaggerOnMissileLaunch takes unit trigUnit, unit targetUnit, integer level returns nothing
	local trigger t 
	local integer h
	local unit u
	if GetUnitAbilityLevel(trigUnit,'Aloc') > 0 then
		set trigUnit = Player__Hero[GetPlayerId(GetOwningPlayer(trigUnit))]
	endif
	set t = LaunchMissileByUnitDummy(trigUnit, targetUnit,'h010', "StiflingDaggerOnMissileHit", 1200, false)
	set h = GetHandleId(t)
	set u = LoadUnitHandle(HY, GetHandleId(t), 45)
	
	if IsUnitType(trigUnit, UNIT_TYPE_MELEE_ATTACKER) then
		call SaveBoolean(HY, h, 0, true)
	else
		call UnitLaunchAttack(trigUnit, targetUnit)
	endif

	call SaveInteger(HY, h, 5, level)
	call SaveInteger(HY, h, 6, level -1)
	if level > 1 and TKV(trigUnit,'P240', 15) then
		call SaveBoolean(HY, h, 6, true)
		call SaveReal(HY, h, 6, .5 + level * 1.)
		call SetUnitScale(u, 2.5, 0, 0)
		call SetUnitVertexColor(u, 255, 50, 50, 255)
	endif
	set t = null
	set u = null
endfunction
function Z3I takes nothing returns nothing
	call T4V(MissileHitTargetUnit)
	if UnitHasSpellShield(U2) == false then
		call StiflingDaggerOnMissileLaunch(MissileHitTargetUnit, U2, Q2)
	endif
endfunction
function StiflingDaggerOnSpellEffect takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call StiflingDaggerOnMissileLaunch(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(),'A0YM'))
	endif
endfunction
function Z5I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local integer count = LoadInteger(HY, h, 34)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetUnitAbilityLevel(whichUnit,'A1CO') == 0 then
		call UnitRemoveAbility(whichUnit,'A1CO')
		call UnitRemoveAbility(whichUnit,'B1CO')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_PLAYER_UNIT_ATTACKED then
		if GetAttacker() == whichUnit then
			if GetTriggerUnit()!= targetUnit then
				call UnitRemoveAbility(whichUnit,'A1CO')
				call UnitRemoveAbility(whichUnit,'B1CO')
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			else
				set count = count + 1
				call SaveInteger(HY, h, 34,(count))
				if count == 4 then
					call UnitRemoveAbility(whichUnit,'A1CO')
					call UnitRemoveAbility(whichUnit,'B1CO')
					call FlushChildHashtable(HY, h)
					call CleanCurrentTrigger(t)
				endif
			endif
		endif
	else
		call UnitRemoveAbility(whichUnit,'A1CO')
		call UnitRemoveAbility(whichUnit,'B1CO')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function Z6I takes unit u, unit targetUnit returns nothing
	local trigger t
	local integer h
	call DestroyEffect(AddSpecialEffect("war3mapImported\\PhantomStrike.mdx", GetUnitX(u), GetUnitY(u)))
	call SetUnitX(u, GetUnitX(targetUnit))
	call SetUnitY(u, GetUnitY(targetUnit))
	if IsUnitEnemy(u, GetOwningPlayer(targetUnit)) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call UnitAddPermanentAbility(u,'A1CO')
		call WPE(u, targetUnit)
		call TriggerRegisterTimerEvent(t, 3, false)
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function Z5I))
		call SaveUnitHandle(HY, h, 2, u)
		call SaveUnitHandle(HY, h, 30, targetUnit)
	endif
	set t = null
endfunction
function Z7I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	if GetUnitAbilityLevel(u,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(u), 0) then
		set u = LoadUnitHandle(HY, GetHandleId(u), 0)
	endif
	call Z6I(u, targetUnit) // GetUnitAbilityLevel(u,'A0PL')
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set targetUnit = null
	set u = null
endfunction
function I7E takes nothing returns nothing
	local timer t = null
	local integer h
	if IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) or not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		call TimerStart(t, 0, false, function Z7I)
		set t = null
	endif
endfunction
function Z8I takes unit whichUnit, boolean Z9I returns nothing
	local integer level = GetUnitAbilityLevel(whichUnit,'P239')
	if Z9I == false then
		call UnitRemoveAbility(whichUnit,'A13F')
		call UnitRemoveAbility(whichUnit,'B0A2')
	else
		call UnitAddPermanentAbility(whichUnit,'A13F')
	endif
endfunction
function VVA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local group g
	local integer count =(LoadInteger(HY, h, 34))
	local boolean VEA =(LoadBoolean(HY, h, 674))
	set count = count + 1
	call SaveInteger(HY, h, 34,(count))
	if whichUnit != null and UnitIsDead(whichUnit) == false and GetUnitAbilityLevel(whichUnit,'P239')> 0 then
		set U2 = whichUnit
		set g = AllocationGroup(373)
		if GetUnitAbilityLevel(whichUnit,'A36D') == 0 then
			call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 1625, Condition(function DLX))
		else
			call GroupAddUnit(g, whichUnit)
		endif
		if FirstOfGroup(g)!= null then
			if VEA then
				set VEA = false
				call SaveBoolean(HY, h, 674,(VEA))
				set count = 0
				call SaveInteger(HY, h, 34,(count))
			else
				set count = 0
				call SaveInteger(HY, h, 34,(count))
				call SaveInteger(HY,(GetHandleId((whichUnit))),(4302), 2)
				call Z8I(whichUnit, true)
				call SetUnitVertexColorEx(whichUnit,-1,-1,-1, 255)
				if GetUnitAbilityLevel(whichUnit,'A20S') == 0 then
					call UnitSetUsesAltIcon(whichUnit, false)
				endif
			endif
		else
			if VEA == false then
				set VEA = true
				set count = 0
				call SaveBoolean(HY, h, 674,(VEA))
				call SaveInteger(HY, h, 34,(count))
			else
				set count = 0
				call SaveInteger(HY, h, 34,(count))
				call SaveInteger(HY,(GetHandleId((whichUnit))),(4302), 1)
				call Z8I(whichUnit, false)
				call SetUnitVertexColorEx(whichUnit,-1,-1,-1, 64)
				call UnitSetUsesAltIcon(whichUnit, IsPlayerEnemy(GetOwningPlayer(whichUnit), LocalPlayer) and IsUnitFogged(whichUnit, LocalPlayer) == false and IsObserverPlayer(LocalPlayer) == false)
			endif
		endif
		call DeallocateGroup(g)
		set g = null
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function MBE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function VVA))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveInteger(HY, h, 34, 0)
	call EnableAttackEffectByTime(4, 99999)
	call SaveBoolean(HY, h, 674,(false))
	set t = null
	set whichUnit = null
endfunction
function VXA takes nothing returns nothing
	local unit dummyCaster
	if IsUnitInGroup(GetEnumUnit(), DK) == false and UnitVisibleToPlayer(GetEnumUnit(), GetOwningPlayer(MCV)) then
		set dummyCaster = CreateUnit(GetOwningPlayer(MCV),'e00E', GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()), 0)
		call UnitAddPermanentAbility(dummyCaster,'A0RI')
		call SetUnitAbilityLevel(dummyCaster,'A0RI', GetUnitAbilityLevel(MCV,'A0RA'))
		if IssueTargetOrderById(dummyCaster, 852106, GetEnumUnit()) then
			call GroupAddUnit(DK, GetEnumUnit())
			call UnitDamageTargetEx(MCV, GetEnumUnit(), 1, 100)
		endif
		call UnitRemoveAbility(dummyCaster,'A0RI')
		set dummyCaster = null
	endif
endfunction
function VOA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer i
	local group g =(LoadGroupHandle(HY, h, 22))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local group F5X = AllocationGroup(374)
	local unit K4X =(LoadUnitHandle(HY, h, 221))
	set U2 = K4X
	set MCV = K4X
	call GroupEnumUnitsInRange(F5X, x, y, 300, Condition(function DHX))
	set DK = g
	call ForGroup(F5X, function VXA)
	call DeallocateGroup(F5X)
	if GetTriggerEvalCount(t)> 7 * 10 then
		set i = 1
		loop
		exitwhen i > 16
			call DestroyEffect((LoadEffectHandle(HY, h,( 2700+ i))))
			set i = i + 1
		endloop
		call DeallocateGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set g = null
	set F5X = null
	set K4X = null
	return false
endfunction
function I8E takes nothing returns nothing
	local integer i = 1
	local real VRA = GetSpellTargetX()
	local real VIA = GetSpellTargetY()
	local real x
	local real y
	local integer VAA = 16
	local string fx = "Abilities\\Spells\\Undead\\Graveyard\\GraveMarker.mdl"
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local group g = AllocationGroup(375)
	call A8X(GetOwningPlayer(GetTriggerUnit()), 7, VRA, VIA, 300 + 500)
	call A5X(BC, VRA, VIA)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function VOA))
	call SaveGroupHandle(HY, h, 22,(g))
	call SaveUnitHandle(HY, h, 221,(GetTriggerUnit()))
	call SaveReal(HY, h, 6,((VRA)* 1.))
	call SaveReal(HY, h, 7,((VIA)* 1.))
	call CreateCorpse(GetOwningPlayer(GetTriggerUnit()),'ugho', VRA, VIA, 0)
	loop
	exitwhen i > VAA
		set x = VRA + 300 * Cos(i * 360 / VAA * bj_DEGTORAD)
		set y = VIA + 300 * Sin(i * 360 / VAA * bj_DEGTORAD)
		call SaveEffectHandle(HY, h,( 2700+ i),(AddSpecialEffect(fx, x, y)))
		if i == 1 or i == 5 or i == 9 or i == 13 then
			set x = VRA + 275 * Cos(i * 360 / VAA * bj_DEGTORAD)
			set y = VIA + 275 * Sin(i * 360 / VAA * bj_DEGTORAD)
			call CreateCorpse(GetOwningPlayer(GetTriggerUnit()),'ugho', x, y, 0)
		endif
		set i = i + 1
	endloop
	set t = null
	set g = null
endfunction
function VBA takes nothing returns nothing
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl", GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit())))
	call EPX(GetEnumUnit(), 4406, 1)
	call SetUnitPosition(GetEnumUnit(), S2, TJ)
	call PanCameraToTimedForPlayer(GetOwningPlayer(GetEnumUnit()), S2, TJ, 0)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl", GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit())))
endfunction

function VCA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(ObjectHashTable, GetHandleId(t), 0)
	call UnitRemoveAbility(u,'A2MB')
	call UnitAddPermanentAbility(u,'A2MB')
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set u = null
endfunction

function VDA takes unit u returns nothing
	local timer t = CreateTimer()
	call SaveUnitHandle(ObjectHashTable, GetHandleId(t), 0, u)
	call TimerStart(t, 0, false, function VCA)
	set t = null
endfunction

function VFA takes nothing returns boolean
	return IsUnitAlly(GetFilterUnit(), GetOwningPlayer(U2)) and GetUnitAbilityLevel(GetFilterUnit(),'Aloc') == 0 and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and UnitIsDead(GetFilterUnit()) == false and XFX(GetOwningPlayer(GetFilterUnit()))
endfunction

function VGA takes unit whichUnit, unit targetUnit returns nothing
	local group g = AllocationGroup(376)
	local player p = GetOwningPlayer(whichUnit)
	local real x1 = GetWidgetX(whichUnit)
	local real y1 = GetWidgetY(whichUnit)
	local real x2 = GetWidgetX(targetUnit)
	local real y2 = GetWidgetY(targetUnit)
	call DestroyEffect(AddSpecialEffect("Doodads\\Cinematic\\ShimmeringPortal\\ShimmeringPortal.mdl", x1, y1))
	call DestroyEffect(AddSpecialEffect("Doodads\\Cinematic\\ShimmeringPortal\\ShimmeringPortal.mdl", x2, y2))
	set S2 = x2
	set TJ = y2
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, x1, y1, 475, Condition(function VFA))
	call ForGroup(g, function VBA)
	call DeallocateGroup(g)
	call UnitRemoveAbility(whichUnit,'A2MB')
	call SetPlayerAbilityAvailableEx(p,'A2MB', false)
	call SetPlayerAbilityAvailableEx(p,'A0R0', true)
	set g = null
	set p = null
endfunction

function VHA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local player p = GetOwningPlayer(whichUnit)
	local boolean b = GetSpellAbilityId()=='A2MB'
	if UnitIsDead(targetUnit) or UnitIsDead(whichUnit) or targetUnit == null or whichUnit == null or b then
		if b then
			call VDA(whichUnit)
		else
			call InterfaceErrorForPlayer(p, GetObjectName('n03F'))
		endif
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call UnitRemoveType(targetUnit, UNIT_TYPE_PEON)
		call SetPlayerAbilityAvailableEx(p,'A2MB', false)
		call SetPlayerAbilityAvailableEx(p,'A0R0', true)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set t = null
		set whichUnit = null
		set targetUnit = null
		return false
	endif
	if GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call VGA(whichUnit, targetUnit)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set p = null
	return false
endfunction

function VJA takes nothing returns boolean
	local real d
	if IsUnitAlly(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit())) == false or GetUnitAbilityLevel(GetFilterUnit(),'A04R')> 0 or GetOwningPlayer(GetFilterUnit()) == Player(15) or UnitIsDead(GetFilterUnit()) then
		return false
	endif
	if IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) or(LWO(GetFilterUnit())) then
		set d = GetDistanceBetween(TJ, RJ, GetUnitX(GetFilterUnit()), GetUnitY(GetFilterUnit()))
		if d < S2 then
			set S2 = d
			set U2 = GetFilterUnit()
		endif
	endif
	return false
endfunction

function DarkRift_EnumUnit takes unit whichUnit returns unit
	local group g
	local real x
	local real y
	set x = GetSpellTargetX()
	set y = GetSpellTargetY()
	set g = AllocationGroup(377)
	set U2 = null
	set S2 = 9999
	set TJ = x
	set RJ = y
	call GroupEnumUnitsInRange(g, x, y, 4000, Condition(function VJA))
	call DeallocateGroup(g)
	set g = null
	return U2
endfunction

function VNA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit dummyCaster =(LoadUnitHandle(HY, h, 393))
	local integer level =(LoadInteger(HY, h, 5))
	local integer FTR = 90
	local integer count = GetTriggerEvalCount(t)
	if GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId() == 'A2MB' then
		call KillUnit(dummyCaster)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set t = null
		set dummyCaster = null
		set whichUnit = null
		return false
	endif
	if level == 1 then
		set FTR = 160
	elseif level == 2 then
		set FTR = 120
	endif
	call SetUnitX(dummyCaster, GetUnitX(whichUnit))
	call SetUnitY(dummyCaster, GetUnitY(whichUnit))
	if count > FTR then
		call KillUnit(dummyCaster)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif count == 30 then
		call UnitRemoveAbility(dummyCaster, 'Aloc')
		call ShowUnit(dummyCaster, true)
		call UnitAddAbility(dummyCaster,'Aloc')
	endif
	set t = null
	set dummyCaster = null
	set whichUnit = null
	return false
endfunction

function Effect_DarkRift takes unit trigUnit returns nothing
	local trigger t
	local integer h
	local unit stg_u = GetSpellTargetUnit()
	local real x
	local real y
	if stg_u == null then
		set stg_u = DarkRift_EnumUnit(trigUnit)
	endif
	if stg_u == null then
		call InterfaceErrorForPlayer(GetOwningPlayer(trigUnit), GetObjectName('n03H'))
		return
	endif
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(trigUnit),'A0R0', false)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(trigUnit),'A2MB', true)
	call UnitAddPermanentAbility(trigUnit,'A2MB')
	set t = CreateTrigger()
	set h = GetHandleId(t)
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(trigUnit)) or IsObserverPlayer(LocalPlayer) then
		call PingMinimapEx(GetUnitX(stg_u), GetUnitY(stg_u), 3, 255, 255, 255, false)
	endif
	call TriggerRegisterTimerEvent(t, 7 -GetUnitAbilityLevel(trigUnit,'A0R0'), false)
	call TriggerRegisterDeathEvent(t, stg_u)
	call TriggerRegisterUnitEvent(t, trigUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function VHA))
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("war3mapImported\\DarkHands.mdl", stg_u, "overhead"))
	call SaveUnitHandle(HY, h, 2, trigUnit)
	call SaveUnitHandle(HY, h, 17, stg_u)
	call UnitAddType(stg_u, UNIT_TYPE_PEON)
	
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function VNA))
	call TriggerRegisterUnitEvent(t, trigUnit, EVENT_UNIT_SPELL_EFFECT)
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(trigUnit,'A0R0'))
	call SaveUnitHandle(HY, h, 2, trigUnit)
	set stg_u = CreateUnit(GetOwningPlayer(trigUnit),'h098', GetUnitX(trigUnit), GetUnitY(trigUnit), 0)
	call SaveUnitHandle(HY, h, 393, stg_u)
	call UnitRemoveAbility(stg_u,'Aloc')
	call ShowUnit(stg_u, false)
	
	set t = null
	set stg_u = null
endfunction

function K7E takes nothing returns nothing
	local unit stg_u = GetSpellTargetUnit()
	local unit trigUnit = GetTriggerUnit()
	if stg_u != null then
		if IsUnitEnemy(stg_u, GetOwningPlayer(trigUnit)) or LWO(stg_u) == false then
			call EXStopUnit(trigUnit)
			call InterfaceErrorForPlayer(GetOwningPlayer(trigUnit), GetObjectName('n041'))
		endif
	else
		set stg_u = DarkRift_EnumUnit(trigUnit)
	endif
	if stg_u == null then
		call EXStopUnit(trigUnit)
		call InterfaceErrorForPlayer(GetOwningPlayer(trigUnit), GetObjectName('n040'))
	endif
	set stg_u = null
	set trigUnit = null
endfunction

function DarkRift takes nothing returns nothing
	call Effect_DarkRift(GetTriggerUnit())
endfunction

function PJX takes nothing returns nothing
	call B6X('h094')
	call B6X('h095')
	call B6X('h096')
endfunction
function VMA takes nothing returns nothing
	local unit t = GetEnumUnit()
	if GetUnitAbilityLevel(t,'D009') == 1 then
		if IsUnitType(t, UNIT_TYPE_STRUCTURE) then
			call UnitDamageTargetEx(Temp__ArrayUnit[0], t, 1, XK[0]/ 3)
		else
			call UnitDamageTargetEx(Temp__ArrayUnit[0], t, 1, XK[0])
		endif
	endif
	set t = null
endfunction
function VPA takes nothing returns boolean
	local unit t = GetFilterUnit()
	local unit u = Temp__ArrayUnit[0]
	if IsUnitEnemy(u, GetOwningPlayer(t)) and UnitAlive(t) and GetUnitAbilityLevel(t,'A04R') == 0 and IsUnitMagicImmune(t) == false then
		if IsUnitType(t, UNIT_TYPE_STRUCTURE) then
			call UnitDamageTargetEx(u, t, 1, XK[0]/ 3)
		else
			call UnitDamageTargetEx(u, t, 1, XK[0])
		endif
		call UnitAddAbilityLevel1ToTimed(t,'C009','D009', 2)
		call GroupAddUnit(LoadGroupHandle(ObjectHashTable, XK[1], 1), t)
	endif
	set u = null
	set t = null
	return false
endfunction
function VQA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer count = 0
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(ObjectHashTable, WFV, 0)
	local real x = LoadReal(ObjectHashTable, WFV, 0)
	local real y = LoadReal(ObjectHashTable, WFV, 1)
	local group g = LoadGroupHandle(ObjectHashTable, WFV, 1)
	set Temp__ArrayUnit[0]= LoadUnitHandle(ObjectHashTable, WFV, 0)
	set XK[0]= LoadInteger(ObjectHashTable, WFV, 1)
	call ForGroup(g, function VMA)
	call SaveInteger(ObjectHashTable, WFV, 0, UYX -1)
	if UYX > 2 then
		set XK[0]= LoadInteger(ObjectHashTable, WFV, 2)
		set XK[1]= WFV
		call GroupEnumUnitsInRange(AK, x, y, 425, Condition(function VPA))
		if UYX == 3 then
			set t = null
			set g = null
			return
		endif
		loop
		exitwhen count == 12
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Demon\\RainOfFire\\RainOfFireTarget.mdl", x + GetRandomReal(50, 275)* Cos(count * 30 * bj_DEGTORAD), y + GetRandomReal(50, 275)* Sin(count * 30 * bj_DEGTORAD)))
			set count = count + 1
		endloop
	elseif UYX == 1 then
		call DeallocateGroup(g)
		call DestroyTimerAndFlushHT_P(t)
	endif
	set g = null
	set t = null
endfunction
function YVV takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local group g = AllocationGroup(378)
	local integer count = 0
	local integer WFV = GetHandleId(t)
	local integer WUV = GetUnitAbilityLevel(u,'A01I')
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	loop
	exitwhen count == 12
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Demon\\RainOfFire\\RainOfFireTarget.mdl", x + GetRandomReal(50, 275)* Cos(count * 30 * bj_DEGTORAD), y + GetRandomReal(50, 275)* Sin(count * 30 * bj_DEGTORAD)))
		set count = count + 1
	endloop
	call SaveInteger(ObjectHashTable, WFV, 0, 8)
	call SaveInteger(ObjectHashTable, WFV, 1, WUV * 5)
	call SaveInteger(ObjectHashTable, WFV, 2, 10+ 15* WUV)
	call SaveReal(ObjectHashTable, WFV, 0, x)
	call SaveReal(ObjectHashTable, WFV, 1, y)
	call SaveUnitHandle(ObjectHashTable, WFV, 0, u)
	call SaveGroupHandle(ObjectHashTable, WFV, 1, g)
	call TimerStart(t, .9, true, function VQA)
	set g = null
	set u = null
	set t = null
endfunction
function VSA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	call UnitReduceStateBonus(LoadUnitHandle(ObjectHashTable, WFV, 0), LoadInteger(ObjectHashTable, WFV, 0), UNIT_BONUS_DAMAGE)
	call DestroyTimerAndFlushHT_P(t)
	set t = null
endfunction
function VTA takes unit u, boolean b returns nothing
	local timer t = CreateTimer()
	local integer WFV = GetHandleId(t)
	local integer CJR = 5
	local integer level = GetUnitAbilityLevel(u,'AIcd')
	if b then
		set CJR = 20
	endif
	call SaveUnitHandle(ObjectHashTable, WFV, 0, u)
	call SaveInteger(ObjectHashTable, WFV, 0, CJR)
	call UnitAddStateBonus(u, CJR, UNIT_BONUS_DAMAGE)
	call TimerStart(t, level * 5 + 25, false, function VSA)
	set t = null
endfunction
function VUA takes nothing returns boolean
	local unit t = GetFilterUnit()
	if LoadBoolean(ObjectHashTable, GetHandleId(t),'AIcd') and UnitAlive(t) and IsUnitEnemy(t, Temp__Player) then
		call VTA(t, IsUnitType(Temp__ArrayUnit[0], UNIT_TYPE_HERO))
	endif
	set t = null
	return false
endfunction
function VWA takes nothing returns boolean
	local unit u = GetTriggerUnit()
	local integer id = GetUnitTypeId(u)
	if GetUnitAbilityLevel(u,'A04R') == 0 and id !='n0F5' and id !='N0MM' and IsUnitIllusion(u) == false and UnitIsDead(u) then
		set Temp__Player = GetOwningPlayer(u)
		set Temp__ArrayUnit[0]= u
		call GroupEnumUnitsInRange(AK, GetWidgetX(Temp__ArrayUnit[0]), GetWidgetY(Temp__ArrayUnit[0]), 925, Condition(function VUA))
	endif
	set u = null
	return false
endfunction
function L0E takes nothing returns nothing
	local trigger trig = null
	call SaveBoolean(ObjectHashTable, GetHandleId(GetTriggerUnit()),'AIcd', true)
	if LoadBoolean(ObjectHashTable,'AIcd', 0) then
		return
	endif
	set trig = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(trig, EVENT_PLAYER_UNIT_DEATH)
	call TriggerAddCondition(trig, Condition(function VWA))
	call SaveBoolean(ObjectHashTable,'AIcd', 0, true)
	set trig = null
endfunction
function VYA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer hu = GetHandleId(u)
	local group g
	local unit u2
	local real damageValue
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call DestroyTrigger(t)
		call FlushChildHashtable(HY, h)
		call RemoveSavedHandle(HY, hu,'A0AZ')
	elseif IsUnitHidden(u) == false then
		set g = AllocationGroup(379)
		set U2 = u
		call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 300, Condition(function DHX))
		set damageValue = 7 * GetUnitAbilityLevel(u,'A06K')
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			call UnitDamageTargetEx(u, u2, 1, damageValue)
			call GroupRemoveUnit(g, u2)
		endloop
		call UnitDamageTargetEx(u, u, 1, damageValue)
		call DeallocateGroup(g)
	endif
	set t = null
	set u = null
	return false
endfunction
function VZA takes boolean b returns nothing
	local trigger t = null
	local integer h = 0
	local unit u = GetTriggerUnit()
	local integer hu = GetHandleId(u)
	if HaveSavedHandle(HY, hu,'A0AZ') then
		set t = LoadTriggerHandle(HY, hu,'A0AZ')
		set h = GetHandleId(t)
	elseif b then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, hu,'A0AZ', t)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerRegisterTimerEvent(t, .2, true)
		call TriggerRegisterTimerEvent(t, .0, false)
		call TriggerAddCondition(t, Condition(function VYA))
		call SaveUnitHandle(HY, h, 0, u)
	endif
	if b == false then
		if t != null then
			call DestroyTrigger(t)
			call FlushChildHashtable(HY, h)
			call RemoveSavedHandle(HY, hu,'A0AZ')
		endif
	endif
	set t = null
	set u = null
endfunction
function V_A takes nothing returns boolean
	return GetUnitAbilityLevel(GetTriggerUnit(),'A06K')> 0
endfunction
function V0A takes nothing returns nothing
	if (GetIssuedOrderId()== 852177) then
		call UnitAddPermanentAbility(GetTriggerUnit(),'A0AZ')
		call VZA(true)
	elseif (GetIssuedOrderId()== 852178) then
		call UnitRemoveAbility(GetTriggerUnit(),'A0AZ')
		call VZA(false)
	endif
endfunction
function M7X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterUserUnitEvent(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call TriggerAddCondition(t, Condition(function V_A))
	call TriggerAddAction(t, function V0A)
	set t = null
endfunction
function W2X takes nothing returns nothing
	local unit triggerUnit = U2
	local unit killingUnit = MissileHitTargetUnit
	local integer i = 1
	local integer k = 5
	local integer pid
	if IsSentinelPlayer(GetOwningPlayer(triggerUnit)) then
		loop
			set pid = GetPlayerId(ScourgePlayers[i])
			if UnitIsDead(Player__Hero[pid]) == false and(GetPlayerId(GetOwningPlayer(killingUnit)) == pid or GetUnitDistanceEx(triggerUnit, Player__Hero[pid])< 725) then
				set SI[pid]= SI[pid] + 1
			endif
			set i = i + 1
		exitwhen i > k
		endloop
	elseif IsScourgePlayer(GetOwningPlayer(triggerUnit)) then
		loop
			set pid = GetPlayerId(SentinelPlayers[i])
			if UnitIsDead(Player__Hero[pid]) == false and(GetPlayerId(GetOwningPlayer(killingUnit)) == pid or GetUnitDistanceEx(triggerUnit, Player__Hero[pid])< 725) then
				set SI[pid]= SI[pid] + 1
			endif
			set i = i + 1
		exitwhen i > k
		endloop
	endif
	set killingUnit = null
	set triggerUnit = null
endfunction
function V1A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	if GetTriggerEvalCount(t) == 1 then
		call ShowUnit(u, false)
	elseif GetTriggerEvalCount(t)> 80 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	return false
endfunction
function Rot_Suicide takes nothing returns nothing
	local unit u = null
	local trigger t
	local integer h
	local unit triggerUnit = GetTriggerUnit()
	local unit killingUnit = GetKillingUnit()
	if GetUnitAbilityLevel(killingUnit,'A06K')> 0 then
		if triggerUnit == killingUnit then
			set u = CreateUnit(GetOwningPlayer(triggerUnit),'h0BB', GetUnitX(triggerUnit), GetUnitY(triggerUnit), GetUnitFacing(triggerUnit))
			call SetUnitTimeScale(u, .75)
			call UnitApplyTimedLife(u,'BTLF', 1.)
			call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodAbomination.mdl", u, "origin"))
			set u = null
			call SetSoundPosition(SE, GetUnitX(triggerUnit), GetUnitY(triggerUnit), 50)
			call SetSoundVolumeBJ(SE, 100)
			call PlaySoundBJ(SE)
			call SetSoundPosition(RE, GetUnitX(triggerUnit), GetUnitY(triggerUnit), 50)
			call SetSoundVolumeBJ(RE, 100)
			call PlaySoundBJ(RE)
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call TriggerRegisterTimerEvent(t, .1, true)
			call TriggerAddCondition(t, Condition(function V1A))
			call SaveUnitHandle(HY, h, 2, triggerUnit)
			set t = null
		endif
	endif
	set triggerUnit = null
	set killingUnit = null
endfunction
//设置被动的充能点数，模板必须为照明弹或哨兵，用lua屏蔽点击技能按钮。
function SetAbilitydataD takes unit u, integer ab, integer i returns nothing
	local integer lv = GetUnitAbilityLevel(u, ab)
	call YDWESetUnitAbilityDataReal(u, ab, 1, 111, i * 1.)
	call UnitRemoveAbility(u, ab)
	call UnitAddPermanentAbilitySetLevel(u, ab, lv)
endfunction
function V2A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local unit u =(LoadUnitHandle(HY,(GetHandleId(t)), 2))
	local integer h = GetHandleId(u)
	local integer V3A = LoadInteger(ObjectHashTable, h,'A06D')
	local integer lv = GetUnitAbilityLevel(u,'A06D')
	local integer V4A = R2I(I2R(SI[GetPlayerId(GetOwningPlayer(u))])*(.5 * lv))
	if u == null then
		call FlushChildHashtable(HY, GetHandleId(t))
		call CleanCurrentTrigger(t)
	endif
	if V4A > V3A then
		call ModifyHeroStat(0, u, 0, V4A -V3A)
		call SetAbilitydataD(u,'QP13', V4A)
		call SaveInteger(ObjectHashTable, h,'A06D', V4A)
		call CommonTextTag("+" + I2S(V4A -V3A)+ " " + GetObjectName('n0MJ'), 3, u, .023, 0, 255, 0, 230)
		if GetHeroMainAttributesType(u)!= HERO_ATTRIBUTE_STR then
			call SaveInteger(HY, GetHandleId(u),'axxx', V4A)
			call KVX(u)
		endif
	endif
	set t = null
	set u = null
	return false
endfunction
function MCE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer i
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function V2A))
	call SaveUnitHandle(HY, h, 2,(u))
	set u = null
	set t = null
endfunction
function V5A takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if UnitAlive(u) then
		call SetUnitPathing(u, true)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set u = null
	set t = null
endfunction
function V6A takes unit u, unit t returns nothing
	local unit d1 = CreateUnit(GetOwningPlayer(t),'e00E', GetUnitX(t), GetUnitY(t), 0)
	local unit d2 = CreateUnit(GetOwningPlayer(u),'e02A', GetUnitX(t), GetUnitY(t), 0)
	call UnitAddPermanentAbility(d1,'A0PZ')
	call IssueTargetOrderById(d1, 852095, t)
	call UnitApplyTimedLife(d1,'BTLF', 1)
	call UnitApplyTimedLife(d2,'BTLF', 1)
	set d1 = null
	set d2 = null
endfunction
function V7A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer V8A =(LoadInteger(HY, h, 376))
	local boolean V9A =(LoadBoolean(HY, h, 377))
	local unit u =(LoadUnitHandle(HY, h, 17))
	local unit EVA =(LoadUnitHandle(HY, h,( 2100+ V8A)))
	local real x
	local real y
	local trigger tt
	if V9A then
		set x = GetUnitX(EVA)
		set y = GetUnitY(EVA)
		if GetDistanceBetween(GetUnitX(EVA), GetUnitY(EVA), GetUnitX(u), GetUnitY(u))< 1200 then
			if IsUnitType(u, UNIT_TYPE_HERO) then
				call SaveBoolean(OtherHashTable, GetHandleId(u), 99, true)
			endif
			call SetUnitX(u, x)
			call SetUnitY(u, y)
			if ModuloInteger(GetTriggerEvalCount(t), 3) == 0 and IsUnitEnemy(u, GetOwningPlayer(EVA)) then
				call FYX(u , .1)
			endif
		else
			call SaveBoolean(HY, h, 377, false)
		endif
		if u == null then
			call SaveBoolean(HY, h, 377, false)
		endif
	endif
	call RemoveUnit(EVA)
	set V8A = V8A -1
	call SaveInteger(HY, h, 376,(V8A))
	if V8A <= 0 then
		//if (A4X(x, y) == false or IsPointInRegion(TerrainCliffRegion, x, y)) and IsUnitType(u, UNIT_TYPE_HERO) then
		//	set tt = CreateTrigger()
		//	call SaveUnitHandle(HY, GetHandleId(tt), 0, u)
		//	call TriggerRegisterTimerEvent(tt, 5, false)
		//	call TriggerAddCondition(tt, Condition(function V5A))
		//	set tt = null
		//else
		//	call SetUnitPathing(u, true)
		//endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	set EVA = null
	return false
endfunction
function EEA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer i =(LoadInteger(HY, h, 376))
	local integer lv =(LoadInteger(HY, h, 5))
	local real a =(LoadReal(HY, h, 13))
	local unit u =(LoadUnitHandle(HY, h, 14))
	local trigger trg2 =(LoadTriggerHandle(HY, h, 11))
	local integer h2 = GetHandleId(trg2)
	local group g
	local unit target
	local real x
	local real y
	local real z
	local integer hp = GetHandleId(GetOwningPlayer(u))
	local real QTR = 110
	if i < 22.5 + 2.5 * lv then
		set i = i + 1
		if i == 1 then
			set QTR = 50
		elseif i == 2 then
			set QTR = 75
		endif
		call SaveInteger(HY, h, 376,(i))
		set x = GetUnitX(u)+ i * 40 * Cos(a * bj_DEGTORAD)
		set y = GetUnitY(u)+ i * 40 * Sin(a * bj_DEGTORAD)
		call SaveUnitHandle(HY,(h2),( 2100+ i),(CreateUnit(GetOwningPlayer(u),'u00H', x, y, a)))
		set g = AllocationGroup(380)
		call GroupEnumUnitsInRange(g, x, y, QTR, Condition(function D9X))
		call GroupRemoveUnit(g, u)
		if GetUnitTypeId(u)=='e00E' then
			call GroupRemoveUnit(g, Player__Hero[GetPlayerId(GetOwningPlayer(u))])
		endif
		set target = GroupPickRandomUnit(g)
		call DeallocateGroup(g)
		if target != null then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call TriggerRegisterTimerEvent(trg2, .025, true)
			call TriggerRegisterDeathEvent(trg2, target)
			call TriggerAddCondition(trg2, Condition(function V7A))
			call SaveInteger(HY,(h2), 376,(i))
			call SaveBoolean(HY,(h2), 377,(true))
			call SaveUnitHandle(HY,(h2), 17,(target))
			call SetUnitPathing(target, false)
			if IsUnitEnemy(target, GetOwningPlayer(u)) then
				if IsUnitType(target, UNIT_TYPE_HERO) then
					call SaveInteger(OtherHashTable, hp,'HK_H', LoadInteger(OtherHashTable, hp,'HK_H')+ 1)
					call StoreDrCacheData("HA_Hits" + I2S(GetPlayerId(GetOwningPlayer(u))), LoadInteger(OtherHashTable, hp,'HK_H'))
					call EPX(u, 4400, 1.5)
				endif
				call V6A(u, target)
				call UnitDamageTargetEx(u, target, 7, 90 * lv)
				call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", target, "origin"))
			endif
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call TriggerRegisterTimerEvent(trg2, .025, true)
		call TriggerAddCondition(trg2, Condition(function V7A))
		call SaveInteger(HY,(h2), 376,(i))
		call SaveBoolean(HY,(h2), 377,(false))
	endif
	set t = null
	set u = null
	set trg2 = null
	set g = null
	set target = null
	return false
endfunction
function I9E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real a = AngleBetweenXY(GetUnitX(u), GetUnitY(u), GetSpellTargetX(), GetSpellTargetY())
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer hp = GetHandleId(GetOwningPlayer(u))
	call SaveUnitHandle(HY, h, 14,(u))
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(u,'A06I') )
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveInteger(HY, h, 376, 0)
	call SaveTriggerHandle(HY, h, 11,(CreateTrigger()))
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function EEA))
	call SaveInteger(OtherHashTable, hp,'HK_T', LoadInteger(OtherHashTable, hp,'HK_T')+ 1)
	call StoreDrCacheData("HA_Total" + I2S(GetPlayerId(GetOwningPlayer(u))), LoadInteger(OtherHashTable, hp,'HK_T'))
	set u = null
	set t = null
endfunction
function dismember_upgraded_effect takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	local unit target =(LoadUnitHandle(HY, h, 17))
	local integer lv =(LoadInteger(HY, h, 5))
	local real damage =(75 + 50 * lv)+ GetHeroMaxAttributeValue(u)
	local integer c =(LoadInteger(HY, h, 34))
	if GetTriggerEventId() == EVENT_UNIT_DEATH or GetTriggerEventId() == EVENT_UNIT_SPELL_ENDCAST then
		if GetTriggerEventId() == EVENT_UNIT_DEATH or(GetTriggerEventId() == EVENT_UNIT_SPELL_ENDCAST and GetSpellAbilityId()=='A1CX') then
			call FIX(target)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	elseif GetTriggerEvalCount(t)> 7 then
		call FIX(target)
		call EXStopUnit(u)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if lv > 0 then
			set c = c + 1
			if (c < 4 and IsUnitType(target, UNIT_TYPE_HERO)) or(c < 7 and IsUnitType(target, UNIT_TYPE_HERO) == false) then
				call SetWidgetLife(u, GetWidgetLife(u)+ damage)
				call UnitDamageTargetEx(u, target, 1, damage)
			endif
			call SaveInteger(HY, h, 34,(c))
		endif
		if UnitIsDead(target) == false and GetUnitAbilityLevel(target,'Bdet')==0 then
			call FAX(u,target)
		endif
	endif
	set t = null
	set u = null
	set target = null
	return false
endfunction
function dismember_upgraded_actions takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local unit target = GetSpellTargetUnit()
	local integer lv = GetUnitAbilityLevel(u,'A1CX')
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterUnitEvent(t, target, EVENT_UNIT_DEATH)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function dismember_upgraded_effect))
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveUnitHandle(HY, h, 17,(target))
	call SaveInteger(HY, h, 5,(lv))
	call SaveInteger(HY, h, 34, 0)
	call FAX(u, target)
	call TriggerEvaluate(t)
	set t = null
	set u = null
	set target = null
endfunction
function Dismember_Upgraded takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call dismember_upgraded_actions()
	endif
endfunction
function dismember_effect takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	local unit target =(LoadUnitHandle(HY, h, 17))
	local integer lv =(LoadInteger(HY, h, 5))
	local real damage =(50 + 50 * lv)
	local integer c =(LoadInteger(HY, h, 34))
	if GetTriggerEventId() == EVENT_UNIT_DEATH or GetTriggerEventId() == EVENT_UNIT_SPELL_ENDCAST then
		if GetTriggerEventId() == EVENT_UNIT_DEATH or(GetTriggerEventId() == EVENT_UNIT_SPELL_ENDCAST and GetSpellAbilityId()=='A0FL') then
			call FIX(target)
			call FlushChildHashtable(HY,(h))
			call CleanCurrentTrigger(t)
		endif
	elseif GetTriggerEvalCount(t)> 7 then
		call FIX(target)
		call EXStopUnit(u)
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	else
		if lv > 0 then
			set c = c + 1
			if (c < 4 and IsUnitType(target, UNIT_TYPE_HERO)) or(c < 7 and IsUnitType(target, UNIT_TYPE_HERO) == false) then
				call UnitDamageTargetEx(u, target, 1, damage)
			endif
			call SaveInteger(HY, h, 34,(c))
		endif
		if UnitIsDead(target) == false and GetUnitAbilityLevel(target,'Bdet') == 0 then
			call FAX(u, target)
		endif
	endif
	set t = null
	set u = null
	set target = null
	return false
endfunction
function dismember_actions takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local unit target = GetSpellTargetUnit()
	local integer lv = GetUnitAbilityLevel(u,'A0FL')
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterUnitEvent(t, target, EVENT_UNIT_DEATH)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function dismember_effect))
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveUnitHandle(HY, h, 17,(target))
	call SaveInteger(HY, h, 5,(lv))
	call SaveInteger(HY, h, 34, 0)
	call FAX(u, target)
	call TriggerEvaluate(t)
	set t = null
	set u = null
	set target = null
endfunction
function Dismember takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call dismember_actions()
	endif
endfunction
function EAA takes unit FAO, real ENA returns nothing
	local real IQX = GetUnitState(FAO, UNIT_STATE_MAX_LIFE)
	local real ISX = GetWidgetLife(FAO)
	if ENA > 0 then
		if ENA >(IQX -ISX) then
			if ENA >= ISX then
				call SetWidgetLife(FAO, IQX)
				call SetUnitToReduceDamage(FAO, ENA -(IQX -ISX))
			else
				call SetUnitToReduceDamage(FAO, ENA)
			endif
		else
			call SetWidgetLife(FAO, GetWidgetLife(FAO)+ ENA)
		endif
	endif
endfunction
function EBA takes nothing returns nothing
	local real damageValue = .25
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if IsUnitType(GetEventDamageSource(), UNIT_TYPE_HERO) == false then
			call EAA(GetTriggerUnit(), GetEventDamage()-0.25)
		else
			call EAA(GetTriggerUnit(), GetEventDamage()-1)
		endif
	elseif GetTriggerEventId() == EVENT_UNIT_DEATH then
		call CleanCurrentTrigger(GetTriggeringTrigger())
	endif
endfunction
function ECA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit FAO =(LoadUnitHandle(HY, h, 19))
	local integer level =(LoadInteger(HY, h, 5))
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call SetUnitAnimation(FAO, "death")
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if IsUnitIdType(GetUnitTypeId(GetEventDamageSource()), UNIT_TYPE_HERO) then
			call SetUnitToReduceDamage(FAO, GetEventDamage()-1)
		else
			call SetUnitToReduceDamage(FAO, GetEventDamage()-0.25)
		endif
	endif
	set t = null
	set FAO = null
	return false
endfunction
function W8V takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A09D')
	local real x = CoordinateX50(GetSpellTargetX())
	local real y = CoordinateY50(GetSpellTargetY())
	local unit FAO
	local integer id = 0
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	if level == 1 then
		set id ='o00M'
	elseif level == 2 then
		set id ='o00L'
	elseif level == 3 then
		set id ='o00O'
	else
		set id ='o00N'
	endif
	set FAO = CreateUnit(GetTriggerPlayer(), id, x, y, 0)
	call TriggerRegisterDeathEvent(t, FAO)
	call TriggerRegisterUnitEvent(t, FAO, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function ECA))
	call SaveUnitHandle(HY, h, 19,(FAO))
	call SaveInteger(HY, h, 5, level)
	call SetUnitAbilityLevel(FAO,'A08T', level)
	call SetUnitAbilityLevel(FAO,'A0CF', level)
	call IssueImmediateOrderById(FAO, 852512)
	call UnitApplyTimedLife(FAO,'BTLF', 30)
	set whichUnit = null
	set FAO = null
	set t = null
endfunction
function EDA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	local real level = LoadInteger(HY, h, 0)
	local boolean HPR = LoadBoolean(HY, h, 0)
	local real EFA = 0
	local real targetsMana = 0
	if GetUnitAbilityLevel(u,'Bdcl') == 0 or(GetTriggerEventId() == EVENT_UNIT_SPELL_ENDCAST and(GetSpellAbilityId()=='A0CC' or GetSpellAbilityId()=='A02Z')) then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if HPR then
			set EFA = 30 + 15* level
		else
			set EFA = 20 + 10* level
		endif
		if (GetWidgetLife(u)+ EFA >= GetUnitState(u, UNIT_STATE_MAX_LIFE)) then
			call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ EFA)
		endif
	endif
	set u = null
	set targetUnit = null
	set t = null
endfunction
function D9E takes nothing returns nothing
	local unit u
	local unit targetUnit
	local trigger t
	local integer h
	local boolean HPR
	if IsUnitType(GetSpellTargetUnit(), UNIT_TYPE_HERO) then
		set HPR = GetSpellAbilityId()=='A02Z'
		set t = CreateTrigger()
		set h = GetHandleId(t)
		set targetUnit = GetSpellTargetUnit()
		set u = GetTriggerUnit()
		call TriggerRegisterTimerEvent(t, .25, true)
		call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_ENDCAST)
		call SaveInteger(HY, h, 0, GetUnitAbilityLevel(u, GetSpellAbilityId()))
		call SaveBoolean(HY, h, 0, HPR)
		call SaveUnitHandle(HY, h, 0, u)
		call SaveUnitHandle(HY, h, 1, targetUnit)
		call TriggerAddCondition(t, Condition(function EDA))
	endif
	set t = null
	set targetUnit = null
	set u = null
endfunction
function EGA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	call SetUnitVertexColor(targetUnit, 255, 255, 255, 255)
	call DestroyEffect((LoadEffectHandle(HY, h, 32)))
	call UnitRemoveAbility(targetUnit,'A30D')
	call UnitRemoveAbility(targetUnit,'A30E')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set targetUnit = null
	return false
endfunction
function EHA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetUnitAbilityLevel(u,'B01N') == 0 or UnitIsDead(u) then
		call UnitRemoveAbility(u, LoadInteger(HY, h, 0))
		call UnitRemoveAbility(u, LoadInteger(HY, h, 1))
		call UnitRemoveAbility(u,'B0HM')
		call UnitRemoveAbility(u,'B38G')
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	endif
	set u = null
	set t = null
endfunction
function EJA takes unit whichUnit, unit targetUnit, integer level returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local integer id
	local integer TOE
	local integer QMX
	if IsPlayerAlly(GetOwningPlayer(whichUnit), GetOwningPlayer(targetUnit)) then
		set id ='A30D'
		set TOE ='A30D'
		call UnitAddPermanentAbility(targetUnit,'A44I')
		set QMX ='A44I'
	else
		set id ='A30E'
		set TOE ='A30E'
		call UnitAddAbilityToTimed(targetUnit,'A3C0'-1 + level, 1, 3.5,'B38G')
		set QMX ='A3C0'-1 + level
	endif
	call TimerStart(t, .1, true, function EHA)
	call SaveUnitHandle(HY, h, 0, targetUnit)
	call SaveInteger(HY, h, 0, id)
	call SaveInteger(HY, h, 1, QMX)
	call UnitAddPermanentAbility(targetUnit, id)
	call UnitMakeAbilityPermanent(targetUnit, true, TOE)
	set t = null
endfunction
function AAE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local integer level = GetUnitAbilityLevel(whichUnit,'A2TD')
	local trigger t
	local integer h
	call UnitAddAbility(dummyUnit,'A0CE')
	call SetUnitAbilityLevel(dummyUnit,'A0CE', level)
	call IssueTargetOrderById(dummyUnit, 852486, targetUnit)
	if GetUnitTypeId(targetUnit)=='n0FJ' or GetUnitTypeId(targetUnit)=='n0FI' or GetUnitTypeId(targetUnit)=='n0F6' or GetUnitTypeId(targetUnit)=='n0FH' then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 1.5 + .5 * level, false)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function EGA))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SetUnitVertexColor(targetUnit, 50, 255, 50, 150)
		call SaveEffectHandle(HY, h, 32,(AddSpecialEffect("Abilities\\Spells\\Undead\\Cripple\\CrippleTarget.mdl", GetUnitX(targetUnit), GetUnitY(targetUnit))))
		set t = null
	else
		call EJA(whichUnit, targetUnit, level)
	endif
	set whichUnit = null
	set targetUnit = null
	set dummyUnit = null
endfunction
function LOE takes nothing returns nothing
	local unit u = GetSpellTargetUnit()
	if not((IsUnitType(u, UNIT_TYPE_STRUCTURE) == false and IsUnitMagicImmune(u) == false) or GetUnitTypeId(u)=='n0FJ' or GetUnitTypeId(u)=='n0FI' or GetUnitTypeId(u)=='n0F6' or GetUnitTypeId(u)=='n0FH') then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "非法目标")
	endif
	set u = null
endfunction
function EKA takes unit whichUnit, unit targetUnit returns nothing
	local real ELA = 20 + 40 * MFV
	local real H0X = 70 + 30 * MFV
	local real F0X = ELA +(H0X -ELA)* MHV / 700
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, F0X)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\ChimaeraLightningMissile\\ChimaeraLightningMissile.mdl", targetUnit, "chest"))
endfunction
function EMA takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local group CNO = MDV
	local unit whichUnit = MGV
	if IsUnitInGroup(targetUnit, CNO) == false then
		call GroupAddUnit(CNO, targetUnit)
		call EKA(whichUnit, targetUnit)
	endif
	set targetUnit = null
	set CNO = null
	set whichUnit = null
endfunction
function EPA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit dummyCaster = LoadUnitHandle(HY, h, 19)
	local group CNO = LoadGroupHandle(HY, h, 133)
	local effect fx
	local integer count = GetTriggerEvalCount(t)
	local real x
	local real x0 = GetUnitX(whichUnit)
	local real y
	local real y0 = GetUnitY(whichUnit)
	local integer i
	local integer d
	local group g = AllocationGroup(381)
	call SetUnitX(dummyCaster, GetUnitX(whichUnit))
	call SetUnitY(dummyCaster, GetUnitY(whichUnit))
	set MDV = CNO
	set MGV = whichUnit
	set MFV = LoadInteger(HY, h, 0)
	if count > 20 then
		set d = 21 * 36 +(20 -count)* 36
		set MHV = d
		set i = 0
		loop
		exitwhen i > 36
			set x = x0 + d * Cos(360 * i / 36 * bj_DEGTORAD)
			set y = y0 + d * Sin(360 * i / 36 * bj_DEGTORAD)
			set U2 = whichUnit
			call GroupEnumUnitsInRange(g, x, y, 100, Condition(function DUX))
			call ForGroup(g, function EMA)
			set i = i + 1
		endloop
	else
		set d = count * 36
		set MHV = d
		set i = 0
		loop
		exitwhen i > 36
			set x = x0 + d * Cos(360 * i / 36 * bj_DEGTORAD)
			set y = y0 + d * Sin(360 * i / 36 * bj_DEGTORAD)
			set U2 = whichUnit
			call GroupEnumUnitsInRange(g, x, y, 100, Condition(function DUX))
			call ForGroup(g, function EMA)
			set i = i + 1
		endloop
	endif
	call DeallocateGroup(g)
	if count == 40 then
		call KillUnit(dummyCaster)
		call DeallocateGroup(CNO)
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif count == 20 then
		call GroupClear(CNO)
		set fx = null
	endif
	set t = null
	set dummyCaster = null
	set CNO = null
	set whichUnit = null
	set g = null
	return false
endfunction
function ABE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local real x = GetUnitX(trigUnit)
	local real y = GetUnitY(trigUnit)
	local unit dummyCaster
	local integer i = 0
	local integer XMR = 36
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	if GetUnitTypeId(trigUnit)=='e00E'then
		set trigUnit = Player__Hero[GetPlayerId(GetOwningPlayer(trigUnit))]
	endif
	set dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'h092', x, y, 0)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("effects\\Lightning_Ball_Tail_FX.mdx", trigUnit, "origin"))
	call SaveGroupHandle(HY, h, 133, AllocationGroup(382))
	call SaveUnitHandle(HY, h, 2, trigUnit)
	call SaveUnitHandle(HY, h, 19, dummyCaster)
	call TriggerRegisterTimerEvent(t, .06, true)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(trigUnit, GetSpellAbilityId()))
	call TriggerAddCondition(t, Condition(function EPA))
	set t = null
	set dummyCaster = null
	set trigUnit = null
endfunction
function EQA takes integer ESA returns boolean
	return ESA !='A09V' and ESA !='A026' and ESA !='A0LZ' and ESA !='A0OI' and ESA !='A0DY' and ESA !='A1WB' and ESA !='AHfa'
endfunction
function ETA takes unit EUA, unit whichUnit, unit targetUnit, integer level returns nothing
	local unit dummyCaster = CreateUnit(GetOwningPlayer(EUA),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	call UnitAddPermanentAbility(dummyCaster,'A1AK')
	call SetUnitAbilityLevel(dummyCaster,'A1AK', level)
	call IssueTargetOrderById(dummyCaster, 852119, targetUnit)
	call UnitAddPermanentAbility(dummyCaster,'A18D')
	call SetUnitAbilityLevel(dummyCaster,'A18D', level)
	call IssueTargetOrderById(dummyCaster, 852111, targetUnit)
	set dummyCaster = null
endfunction
function EWA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer level
	if GetSpellTargetUnit() == whichUnit and GetUnitAbilityLevel(whichUnit,'A36D') == 0 and EQA(GetSpellAbilityId()) and IsUnitAlly(GetTriggerUnit(), GetOwningPlayer(whichUnit)) == false and IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) then
		set level = GetUnitAbilityLevel(whichUnit,'P283')
		call ETA(whichUnit, whichUnit, GetTriggerUnit(), level)
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function MWE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function EWA))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	set whichUnit = null
	set t = null
endfunction
function EYA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer i = LoadInteger(ObjectHashTable, WFV, 1)
	call UnitAddStateBonus(LoadUnitHandle(ObjectHashTable, WFV, 1), i, UNIT_BONUS_ATTACK)
	call UnitReduceStateBonus(LoadUnitHandle(ObjectHashTable, WFV, 0), i, UNIT_BONUS_DAMAGE)
	call DestroyTimerAndFlushHT_P(t)
	set t = null
endfunction
function EZA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(ObjectHashTable, WFV, 0)+ 1
	local integer O3O = LoadInteger(ObjectHashTable, WFV, 1)
	local unit u1 = LoadUnitHandle(ObjectHashTable, WFV, 0)
	local unit u2 = LoadUnitHandle(ObjectHashTable, WFV, 1)
	local unit dummyUnit = LoadUnitHandle(ObjectHashTable, WFV, 33)
	local real x2 = GetWidgetX(u2)
	local real y2 = GetWidgetY(u2)
	local real x1 = GetWidgetX(u1)
	local real y1 = GetWidgetY(u1)
	if UYX == 320 or UnitIsDead(u1) or UnitIsDead(u2) or(x1 -x2)*(x1 -x2)+(y1 -y2)*(y1 -y2)> 490000 then
		call DestroyLightning(LoadLightningHandle(ObjectHashTable, WFV, 2))
		call UnitAddAbilityLevel1ToTimed(u1,'C023','D023', 18)
		call UnitAddAbilityLevel1ToTimed(u2,'C024','D024', 18)
		call TimerStart(t, 18, false, function EYA)
		call RemoveUnit(dummyUnit)
		set u2 = null
		set u1 = null
		set t = null
		set dummyUnit = null
		return
	endif
	call SaveInteger(ObjectHashTable, WFV, 0, UYX)
	call MoveLightning(LoadLightningHandle(ObjectHashTable, WFV, 2), false, x1, y1, x2, y2)
	call SetUnitPosition(dummyUnit, GetUnitX(u2), GetUnitY(u2))
	set UYX = R2I(LoadInteger(ObjectHashTable, WFV, 2)* UYX * 1. / 40.)
	if LoadInteger(ObjectHashTable, WFV, 1)<= UYX then
		call UnitReduceStateBonus(u2, UYX -LoadInteger(ObjectHashTable, WFV, 1), UNIT_BONUS_ATTACK)
		call UnitAddStateBonus(u1, UYX -LoadInteger(ObjectHashTable, WFV, 1), UNIT_BONUS_DAMAGE)
		call SaveInteger(ObjectHashTable, WFV, 1, UYX)
	endif
	set dummyUnit = null
	set u2 = null
	set u1 = null
	set t = null
endfunction
function YFV takes nothing returns nothing
	local lightning l = null
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local unit d = GetSpellTargetUnit()
	local integer WFV = GetHandleId(t)
	local integer i = GetUnitAbilityLevel(u,'A1DP')
	local unit dummyUnit
	if GetUnitTypeId(u)=='e00E'then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
	set dummyUnit = CreateUnit(GetOwningPlayer(u),'h088', GetUnitX(d), GetUnitY(d), 0)
	set l = AddLightning("CLSB", true, GetWidgetX(u), GetWidgetY(u), GetWidgetX(d), GetWidgetY(d))
	set i = 7 * i
	call SetLightningColor(l, .3, .5, 1, 1)
	call SaveUnitHandle(ObjectHashTable, WFV, 0, u)
	call SaveUnitHandle(ObjectHashTable, WFV, 1, d)
	call SaveUnitHandle(ObjectHashTable, WFV, 33, dummyUnit)
	call SaveLightningHandle(ObjectHashTable, WFV, 2, l)
	call SaveInteger(ObjectHashTable, WFV, 0, 0)
	call SaveInteger(ObjectHashTable, WFV, 2, i)
	call TimerStart(t, .025, true, function EZA)
	set d = null
	set u = null
	set l = null
	set t = null
	set dummyUnit = null
endfunction
function E_A takes integer h returns nothing
	local integer i = 1
	local integer D_R = LoadInteger(HY, h, 136)
	local unit targetUnit
	if D_R == 0 then
		return
	endif
	loop
	exitwhen i > D_R
		set targetUnit = LoadUnitHandle(HY, h, 2200+ i)
		call UnitRemoveAbility(targetUnit, O4[0])
		call UnitRemoveAbility(targetUnit, O4[1])
		call UnitRemoveAbility(targetUnit, O4[2])
		call UnitRemoveAbility(targetUnit, O4[3])
		call UnitRemoveAbility(targetUnit, O4[4])
		call UnitRemoveAbility(targetUnit, O4[5])
		set i = i + 1
	endloop
	set targetUnit = null
endfunction
function E0A takes unit targetUnit, integer h returns nothing
	local integer D_R = LoadInteger(HY, h, 136)
	set D_R = D_R + 1
	call SaveInteger(HY, h, 136, D_R)
	call SaveUnitHandle(HY, h, 2200+ D_R, targetUnit)
endfunction
function E1A takes unit u returns integer
	return GetUnitAbilityLevel(u, O4[0])* 1 + GetUnitAbilityLevel(u, O4[1])* 2 + GetUnitAbilityLevel(u, O4[2])* 4 + GetUnitAbilityLevel(u, O4[3])* 8 + GetUnitAbilityLevel(u, O4[4])* 16
endfunction
function E2A takes unit u, integer d returns nothing
	local integer array b
	local integer a = d
	local integer c = 1
	local integer i = 0
	local integer H0X
	if d < 1 then
		call UnitRemoveAbility(u, O4[0])
		call UnitRemoveAbility(u, O4[1])
		call UnitRemoveAbility(u, O4[2])
		call UnitRemoveAbility(u, O4[3])
		call UnitRemoveAbility(u, O4[4])
		call UnitRemoveAbility(u, O4[5])
		return
	endif
	loop
	exitwhen c == 0
		set c = a / 2
		set b[i]= a -c * 2
		set a = c
		set i = i + 1
	endloop
	set H0X = i
	set i = 0
	loop
	exitwhen i > H0X
		if b[i]== 1 then
			call UnitAddPermanentAbility(u, O4[i])
		else
			call UnitRemoveAbility(u, O4[i])
		endif
		set i = i + 1
	endloop
endfunction
function E3A takes unit u, integer d returns nothing
	if IsUnitType(u, UNIT_TYPE_STRUCTURE) == false then
		call E2A(u, d + E1A(u))
		call E0A(u, MLV)
	endif
endfunction
function E4A takes unit whichUnit, unit dummyCaster, unit targetUnit, integer level returns nothing
	call IssueTargetOrderById(dummyCaster, 852119, targetUnit)
	call IOX(I_X(whichUnit), targetUnit, 2,(50 + 25 * level)/ 2, .3)
	call E3A(targetUnit, 1)
endfunction
function E5A takes nothing returns boolean
	if (UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit()))) and GetUnitTypeId(GetFilterUnit())!='n00L' then
		if GetWidgetLife(GetFilterUnit())< MKV then
			set MKV = GetWidgetLife(GetFilterUnit())
			set MJV = GetFilterUnit()
		endif
	endif
	return false
endfunction
function E6A takes nothing returns boolean
	if (UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and UnitIsDead(GetFilterUnit()) == false)) and GetUnitTypeId(GetFilterUnit())!='emow' and GetUnitTypeId(GetFilterUnit())!='uzig' and GetUnitTypeId(GetFilterUnit())!='n00L' then
		if GetWidgetLife(GetFilterUnit())< MKV then
			set MKV = GetWidgetLife(GetFilterUnit())
			set MJV = GetFilterUnit()
		endif
	endif
	return false
endfunction
function E7A takes unit whichUnit, unit dummyCaster, integer level returns nothing
	local group g = AllocationGroup(383)
	set MJV = null
	set MKV = 999999
	set U2 = whichUnit
	if GetUnitAbilityLevel(whichUnit,'A1UV')> 0 then
		call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 525, Condition(function E6A))
	else
		call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 525, Condition(function E5A))
	endif
	call DeallocateGroup(g)
	if MJV != null then
		call E4A(whichUnit, dummyCaster, MJV, level)
	endif
	set g = null
endfunction
function E8A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	local integer level =(LoadInteger(HY, h, 5))
	local integer count = GetTriggerEvalCount(t)
	local integer interval
	local real S7V
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call E_A(h)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if GetTriggerUnit() == whichUnit then
			call KillUnit(dummyCaster)
		endif
	else
		if GetUnitAbilityLevel(whichUnit,'A1UV')> 0 then
			if level == 1 then
				set S7V = .6
			elseif level == 2 then
				set S7V = .5
			else
				set S7V = .4
			endif
		else
			if level == 1 then
				set S7V = .7
			elseif level == 2 then
				set S7V = .6
			else
				set S7V = .5
			endif
		endif
		set S7V = S7V / .05
		if ModuloInteger(count, R2I(S7V)) == 0 or count == 1 then
			set MLV = h
			call E7A(whichUnit, dummyCaster, level)
		endif
		call SetUnitX(dummyCaster, GetUnitX(whichUnit))
		call SetUnitY(dummyCaster, GetUnitY(whichUnit))
	endif
	set t = null
	set whichUnit = null
	set dummyCaster = null
	return false
endfunction
function AME takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A1AO')+ GetUnitAbilityLevel(whichUnit,'A1UV')
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'h081', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	if GetUnitTypeId(whichUnit)=='e00E' then
		set whichUnit = Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))]
	endif
	call UnitApplyTimedLife(dummyCaster,'BTLF', 30)
	call SetUnitAbilityLevel(dummyCaster,'A1DJ', level)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerRegisterDeathEvent(t, dummyCaster)
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function E8A))
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveInteger(HY, h, 5,(level))
	set whichUnit = null
	set dummyCaster = null
	set t = null
endfunction
function PHX takes nothing returns nothing
	set O4[0]='A1DK'
	set O4[1]='A1DL'
	set O4[2]='A1DN'
	set O4[3]='A1DM'
	set O4[4]='A1DO'
endfunction
function E9A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 14))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	call DzSetUnitPosition(whichUnit, CoordinateX50(x), CoordinateY50(y))
	call SetUnitAnimation(whichUnit, "morph ALTERNATE")
	call QueueUnitAnimation( whichUnit, "stand" )

	call YDWEUnitRemoveStun( whichUnit )

	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction

function EXUnitAddStunCallBack takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	
	call YDWEUnitAddStun( LoadUnitHandle( HY, h, 0 ) )

	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(trig)
	set trig = null
	return false
endfunction

function EXUnitAddStunWait0s takes unit whichUnit returns nothing
	local integer h = CreateTimerEventTrigger( 0., false, function EXUnitAddStunCallBack )
	call SaveUnitHandle( HY, h, 0, whichUnit )
endfunction

function APE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer lv = GetUnitAbilityLevel(u,'A06O')+ GetUnitAbilityLevel(u,'A3NX')
	local real a
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local real tx
	local real ty
	local integer h
	local unit target = GetSpellTargetUnit()
	if target != null then
		set tx = GetUnitX(target)
		set ty = GetUnitY(target)
	else
		set tx = GetSpellTargetX()
		set ty = GetSpellTargetY()
	endif
	set a = AngleBetweenXY(x, y, tx, ty)
	set h = CreateTimerEventTrigger( GetDistanceBetween(x, y, tx, ty)/ 2000, false, function E9A )
	call EXUnitAddStunWait0s( u )
	call SaveUnitHandle(HY, h, 14,(u))
	call SaveReal(HY, h, 6,((tx)* 1.))
	call SaveReal(HY, h, 7,((ty)* 1.))

	if GetDistanceBetween(x, y, tx, ty)< 150 then
		set tx = x + 150 * Cos(a * bj_DEGTORAD)
		set ty = y + 150 * Sin(a * bj_DEGTORAD)
	endif
	if target != null and not UnitHasSpellShield(target) then
		set target = null
	endif
	call UnitSpellEffectImpale(u, target, 40 + 60 * lv, 1.65, .52, x, y, tx, ty, 175, null, true, 1600)
	set u = null
	set target = null
endfunction
function XXA takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetEnumUnit()),'e00E', GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()), 0)
	call UnitAddAbility(d,'A33J')
	call IssueTargetOrderById(d, 852095, GetEnumUnit())
	set d = null
	call UnitDamageTargetEx(MPV, GetEnumUnit(), 1, 130)
	call IssueTargetOrderById(MQV, 852075, GetEnumUnit())
endfunction
function XOA takes unit whichUnit, real x, real y, integer level, integer XRA returns nothing
	local group g = AllocationGroup(384)
	local real r
	local string fx
	if XRA == 8 then
		set r = 675
	elseif XRA == 9 then
		set r = 700
	elseif XRA == 10 then
		set r = 725
	else
		set r = 250+ 50 * XRA
	endif
	if XRA < 4 then
		set fx = "war3mapImported\\EpiPulse_1_4.mdx"
	elseif XRA < 8 then
		set fx = "war3mapImported\\EpiPulse_5_8.mdx"
	else
		set fx = "war3mapImported\\EpiPulse_9_12.mdx"
	endif
	call DestroyEffect(AddSpecialEffect(fx, x, y))
	set U2 = whichUnit
	set MPV = whichUnit
	set MQV = MMV[GetPlayerId(GetOwningPlayer(whichUnit))]
	call GroupEnumUnitsInRange(g, x, y, r, Condition(function DHX))
	call ForGroup(g, function XXA)
	call DeallocateGroup(g)
	call BNX(.03, false, x, y, 150 + 100 * XRA, 150 + 100 * XRA, 72, .03, 512)
	set g = null
endfunction
function XIA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player p = LoadPlayerHandle(HY, h, 54)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	local real GXR = LoadReal(HY, h, 23)
	local real GOR = LoadReal(HY, h, 24)
	local boolean KMR = LoadBoolean(HY, h, 15)
	local integer level = LoadInteger(HY, h, 5)
	local integer WWR = LoadInteger(HY, h, 25)
	local integer XAA = 4 + level * 2
	local real x = GXR
	local real y = GOR
	if KMR then
		set XAA = XAA + 2
	endif
	if WWR > XAA then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if trigUnit != null and UnitIsDead(trigUnit) == false then
			set x = GetUnitX(trigUnit)
			set y = GetUnitY(trigUnit)
		endif
		call XOA(trigUnit, x, y, level, WWR)
		call SaveInteger(HY, h, 25, WWR + 1)
		call SaveReal(HY, h, 23, x * 1.)
		call SaveReal(HY, h, 24, y * 1.)
	endif
	set t = null
	set p = null
	set trigUnit = null
	return false
endfunction
function XNA takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local player p = GetOwningPlayer(trigUnit)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(trigUnit,'A06R')
	local boolean KMR = false
	if level == 0 then
		set KMR = true
		set level = GetUnitAbilityLevel(trigUnit,'A1B4')
	endif
	if GetUnitAbilityLevel(trigUnit,'Aloc') > 0 then
		set trigUnit = Player__Hero[GetPlayerId(GetOwningPlayer(trigUnit))]
	endif
	if IsSentinelPlayer(p) then
		set MMV[GetPlayerId(p)]= CreateUnit(ScourgePlayers[0],'e00E', GetUnitX(trigUnit), GetUnitY(trigUnit), 0)
	else
		set MMV[GetPlayerId(p)]= CreateUnit(SentinelPlayers[0],'e00E', GetUnitX(trigUnit), GetUnitY(trigUnit), 0)
	endif
	call UnitAddPermanentAbility(MMV[GetPlayerId(p)],'A17B')
	call SaveUnitHandle(HY, h, 14, trigUnit)
	call SavePlayerHandle(HY, h, 54, GetOwningPlayer(trigUnit))
	call SaveReal(HY, h, 23, GetUnitX(trigUnit))
	call SaveReal(HY, h, 24, GetUnitY(trigUnit))
	call SaveInteger(HY, h, 5, level)
	call SaveInteger(HY, h, 25, 2)
	call SaveBoolean(HY, h, 15,(KMR))
	call TriggerRegisterTimerEvent(t, .35, true)
	call TriggerAddCondition(t, Condition(function XIA))
	call XOA(trigUnit, GetUnitX(trigUnit), GetUnitY(trigUnit), level, 1)
	set trigUnit = null
	set p = null
	set t = null
endfunction
function XBA takes nothing returns boolean
	if GetSpellAbilityId()=='A06R' or GetSpellAbilityId()=='A1B4' then
		call XNA()
	endif
	return false
endfunction
function M8X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_FINISH)
	call TriggerAddCondition(t, Condition(function XBA))
	call AddAbilityIDToPreloadQueue('A17B')
	set t = null
endfunction
function XCA takes nothing returns boolean
	if (IsUnitMagicImmune(GetFilterUnit()) == false and IsUnitEnemy(GA, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())))!= null then
		call UnitDamageTargetEx(GA, GetFilterUnit(), 1, HA)
		call UnitAddAbilityToTimed(GetFilterUnit(),'A38I', 1, 3,'B38I')
	endif
	return false
endfunction
function XDA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	call DestroyEffect(LoadEffectHandle(HY, GetHandleId(t), 0))
	call DestroyTimerAndFlushHT_HY(t)
	set t = null
endfunction
function XFA takes unit triggerUnit returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, 1, false, function XDA)
	call SaveEffectHandle(HY, GetHandleId(t), 0, AddSpecialEffectTarget("Abilities\\Spells\\Undead\\PlagueCloud\\PlagueCloudCaster.mdl", triggerUnit, "chest"))
	set t = null
endfunction
function XGA takes unit sk, unit triggerUnit, integer level, boolean XHA returns nothing
	local group g = AllocationGroup(385)
	local real damageValue = 50 + 40 * level
	if level == 4 then
		set damageValue = 220
	endif
	if XHA then
		set damageValue = damageValue / 2
	endif
	set GA = sk
	set HA = damageValue
	call XFA(triggerUnit)
	call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), 425, Condition(function XCA))
	call DeallocateGroup(g)
	set g = null
endfunction
function XJA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 1)
	local unit sk = LoadUnitHandle(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call XGA(sk, triggerUnit, level, false)
		call DestroyEffect(LoadEffectHandle(HY, h, 10))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call RemoveSavedHandle(HY, GetHandleId(triggerUnit),'CFNL')
		call RemoveSavedBoolean(HY, GetHandleId(triggerUnit),'CFNL')
	elseif GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		if GetGameTime()> LoadReal(HY, h, 0) then
			call XGA(sk, triggerUnit, level, true)
			call UnitRemoveAbility(triggerUnit,'A348')
			call UnitRemoveAbility(triggerUnit,'B03F')
			call DestroyEffect(LoadEffectHandle(HY, h, 10))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call RemoveSavedHandle(HY, GetHandleId(triggerUnit),'CFNL')
			call RemoveSavedBoolean(HY, GetHandleId(triggerUnit),'CFNL')
		endif
	else
		call XGA(sk, triggerUnit, level, true)
	endif
	set t = null
	set sk = null
	set triggerUnit = null
endfunction
function XKA takes unit sk, unit targetUnit returns nothing
	local trigger t
	local integer h
	local integer ht = GetHandleId(targetUnit)
	if LoadBoolean(HY, ht,'CFNL') == false then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function XJA))
		call SaveBoolean(HY, ht,'CFNL', true)
		call SaveTriggerHandle(HY, ht,'CFNL', t)
		call SaveUnitHandle(HY, h, 1, targetUnit)
		call SaveEffectHandle(HY, h, 10, AddSpecialEffectTarget("Abilities\\Spells\\Other\\AcidBomb\\BottleImpact.mdl", targetUnit, "chest"))
		call UnitAddPermanentAbility(targetUnit,'A348')
		call SaveBoolean(HY, h, 0, IsUnitType(sk, UNIT_TYPE_MELEE_ATTACKER))
	else
		set t = LoadTriggerHandle(HY, ht,'CFNL')
		set h = GetHandleId(t)
	endif
	call SaveReal(HY, h, 0, GetGameTime()+ 8)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(sk,'A0FA'))
	call SaveUnitHandle(HY, h, 0, sk)
	if (LoadBoolean(HY, h, 0) and LoadInteger(HY, h, 1) == 2) or LoadInteger(HY, h, 1) == 4 then
		call SaveInteger(HY, h, 1, 0)
		call TriggerEvaluate(t)
	else
		call SaveInteger(HY, h, 1, LoadInteger(HY, h, 1)+ 1)
	endif
	set t = null
endfunction
function XLA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	if ((LoadInteger(HY,(GetHandleId((trigUnit))),(4299))) == 1) == false then
		call UnitRemoveAbility(trigUnit,'B04R')
	endif
	call RemoveUnit((LoadUnitHandle(HY, h, 379)))
	call RemoveUnit((LoadUnitHandle(HY, h, 380)))
	call RemoveUnit((LoadUnitHandle(HY, h, 381)))
	call RemoveUnit((LoadUnitHandle(HY, h, 382)))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set trigUnit = null
	return false
endfunction
function XMA takes unit trigUnit, integer level, unit XPA, unit XQA, unit XSA, unit XTA returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real N5O = 1.5
	call SaveInteger(HY,(GetHandleId((trigUnit))),(4299), 2)
	call TriggerRegisterTimerEvent(t, N5O, false)
	call TriggerAddCondition(t, Condition(function XLA))
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call SaveUnitHandle(HY, h, 379,(XPA))
	call SaveUnitHandle(HY, h, 380,(XQA))
	call SaveUnitHandle(HY, h, 381,(XSA))
	call SaveUnitHandle(HY, h, 382,(XTA))
	set t = null
endfunction
function XUA takes nothing returns boolean
	if (IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit())) then
		call UnitDamageTargetEx(U2, GetFilterUnit(), 1, S2)
	endif
	return false
endfunction
function XWA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local unit XPA =(LoadUnitHandle(HY, h, 379))
	local unit XQA =(LoadUnitHandle(HY, h, 380))
	local unit XSA =(LoadUnitHandle(HY, h, 381))
	local unit XTA =(LoadUnitHandle(HY, h, 382))
	local integer level = GetUnitAbilityLevel(trigUnit,'A0H0')
	local integer count = GetTriggerEvalCount(t)
	local group g
	local integer XYA = 550
	if GetTriggerEventId() == EVENT_UNIT_SPELL_ENDCAST or count > level * 40 then
		call XMA(trigUnit, level, XPA, XQA, XSA, XTA)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set g = AllocationGroup(386)
		set U2 = trigUnit
		set S2 = level * 25 / 2
		call GroupEnumUnitsInRange(g, GetUnitX(trigUnit), GetUnitY(trigUnit), XYA, Condition(function XUA))
		call DeallocateGroup(g)
	endif
	set t = null
	set trigUnit = null
	set XPA = null
	set XQA = null
	set XSA = null
	set XTA = null
	set g = null
	return false
endfunction
function AQE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit XPA = CreateUnit(GetOwningPlayer(trigUnit),'e00Q', GetUnitX(trigUnit) +150, GetUnitY(trigUnit) +150, 0)
	local unit XQA = CreateUnit(GetOwningPlayer(trigUnit),'e00Q', GetUnitX(trigUnit) +150, GetUnitY(trigUnit) -150, 0)
	local unit XSA = CreateUnit(GetOwningPlayer(trigUnit),'e00Q', GetUnitX(trigUnit) -150, GetUnitY(trigUnit) +150, 0)
	local unit XTA = CreateUnit(GetOwningPlayer(trigUnit),'e00Q', GetUnitX(trigUnit) -150, GetUnitY(trigUnit) -150, 0)
	local integer level = GetUnitAbilityLevel(trigUnit,'A0H0')
	local unit dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'e00E', GetUnitX(trigUnit), GetUnitY(trigUnit), 0)
	call UnitAddAbility(XPA,'A45U')
	call UnitAddAbility(XPA,'A45V')
	call UnitAddAbility(XQA,'A45U')
	call UnitAddAbility(XQA,'A45V')
	call UnitAddAbility(XSA,'A45U')
	call UnitAddAbility(XSA,'A45V')
	call UnitAddAbility(XTA,'A45U')
	call UnitAddAbility(XTA,'A45V')
	call SaveInteger(HY, GetHandleId(trigUnit), 4299, 1)
	call UnitAddPermanentAbility(dummyCaster,'A0HO')
	call SetUnitAbilityLevel(dummyCaster,'A0HO', level)
	call IssueTargetOrderById(dummyCaster, 852069, trigUnit)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerRegisterUnitEvent(t, trigUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function XWA))
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call SaveUnitHandle(HY, h, 379,(XPA))
	call SaveUnitHandle(HY, h, 380,(XQA))
	call SaveUnitHandle(HY, h, 381,(XSA))
	call SaveUnitHandle(HY, h, 382,(XTA))
	call SetUnitTimeScale(XPA, 0)
	call SetUnitTimeScale(XQA, 0)
	call SetUnitTimeScale(XSA, 0)
	call SetUnitTimeScale(XTA, 0)
	set t = null
	set trigUnit = null
	set dummyCaster = null
	set XPA = null
	set XQA = null
	set XSA = null
	set XTA = null
endfunction
function ATE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', x, y, 0)
	local group g = AllocationGroup(387)
	local integer level = GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())
	local unit u
	call UnitAddPermanentAbility(dummyCaster,'A0M9')
	call SetUnitAbilityLevel(dummyCaster,'A0M9', level)
	call IssueImmediateOrderById(dummyCaster, 852096)
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, x, y, 350 + 25, Condition(function DHX))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call UnitDamageTargetEx(dummyCaster, u, 2, 50 * level)
		call CommonUnitAddStun(u, .5 + level * 1. * .5, false)
		call GroupRemoveUnit(g, u)
	endloop
	call DeallocateGroup(g)
	set whichUnit = null
	set dummyCaster = null
	set g = null
endfunction

function XZA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer hu = GetHandleId(u)
	local real X_A = LoadReal(HY, h, 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or(GetUnitAbilityLevel(u,'B013') == 0 and GetTriggerEvalCount(t)> 2) or GetGameTime()>= X_A then
		call RemoveSavedHandle(HY, hu,'A05C')
		//call UnitRemoveAbility(u,'B3JQ')
		call SetUnitPhaseMove( u, false )
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	else
		//if GetUnitAbilityLevel(u,'B3JQ')==0 and GetUnitAbilityLevel(u,'B07T')==0 and GetUnitAbilityLevel(u,'B39C')==0 then
		//		call UZV(u,'I0T9')
		//	endif
	endif
	set t = null
	set u = null
endfunction
function ASE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local trigger t
	local integer h
	local integer hu = GetHandleId(u)
	if HaveSavedHandle(HY, hu,'A05C') then
		set t = LoadTriggerHandle(HY, hu,'A05C')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		//call UnitRemoveAbility(u,'B3JQ')
		call SetUnitPhaseMove( u, true )
		//if not IsUnitType(u, UNIT_TYPE_FLYING) then
		//	call EXSetUnitMoveType(u, MOVE_TYPE_FOOT )
	//		call EXSetUnitCollisionType(false, u, COLLISION_TYPE_UNIT)
	//	endif
		call TriggerRegisterTimerEvent(t, .02, true)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerAddCondition(t, Condition(function XZA))
		call SaveTriggerHandle(HY, hu,'A05C', t)
		//call UZV(u,'I0T9')
		call SaveUnitHandle(HY, h, 0, u)
	endif
	call SaveReal(HY, h, 0, GetGameTime()+ 12.)
	set u = null
	set t = null
endfunction
function X0A takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 0)
	local real time = GetGameTime()
	local real WOV = LoadReal(ObjectHashTable, GetHandleId(targetUnit),'A034')
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		call UnitRemoveAbility(targetUnit,'A310')
		call UnitRemoveAbility(targetUnit,'B30Z')
		call FlushChildHashtable(HY, h)
		call RemoveSavedHandle(ObjectHashTable, GetHandleId(targetUnit),'A034')
		call CleanCurrentTrigger(t)
	else
		if time > WOV then
			call UnitRemoveAbility(targetUnit,'A310')
			call UnitRemoveAbility(targetUnit,'B30Z')
			call FlushChildHashtable(HY, h)
			call RemoveSavedHandle(ObjectHashTable, GetHandleId(targetUnit),'A034')
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set targetUnit = null
endfunction
function Slardar_AmplifyDamage takes nothing returns nothing
	local trigger t = null
	local integer h
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local real WLV
	local integer level = GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())
	if (UnitHasSpellShield(targetUnit)) then
		set whichUnit = null
		set targetUnit = null
		return
	endif
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) or IsUnitIllusion(targetUnit) then
		set WLV = 30
	else
		set WLV = 120
	endif
	call SaveReal(ObjectHashTable, GetHandleId(targetUnit),'A034', GetGameTime()+ WLV)
	call UnitAddPermanentAbility(targetUnit,'A310')
	call SetPlayerAbilityAvailable(GetOwningPlayer(targetUnit),'A310', false)
	call UnitMakeAbilityPermanent(targetUnit, true,'A30Y')
	call UnitMakeAbilityPermanent(targetUnit, true,'A30Z')
	call SetUnitAbilityLevel(targetUnit,'A30Y', level)
	call GHX(targetUnit, whichUnit,'A310')
	call GQX(targetUnit,'A310','B30Z')
	if LoadTriggerHandle(ObjectHashTable, GetHandleId(targetUnit),'A304') == null then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DEATH)
		call TriggerAddCondition(t, Condition(function X0A))
		call SaveUnitHandle(HY, h, 0, targetUnit)
		call SaveTriggerHandle(ObjectHashTable, GetHandleId(targetUnit),'A034', t)
		set t = null
	endif
	set whichUnit = null
	set targetUnit = null
endfunction
function X1A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 221)
	local unit X2A = LoadUnitHandle(HY, h, 383)
	local unit dummyCaster
	local real N5O = LoadReal(HY, h, 57)
	local integer level = LoadInteger(HY, h, 0)
	local real X3A =(LoadReal(HY, h, 6))
	local real X4A =(LoadReal(HY, h, 7))
	local real targetX = GetUnitX(u)
	local real targetY = GetUnitY(u)
	if (targetX -X3A)*(targetX -X3A)+(targetY -X4A)*(targetY -X4A)> 900 then
		set dummyCaster = CreateUnit(GetOwningPlayer(X2A),('h002'), GetUnitX(u), GetUnitY(u), 0)
		call SetUnitAbilityLevel(dummyCaster,('A0I2'), level)
		call SetUnitAbilityLevel(dummyCaster,('A0HY'), level)
		call UnitApplyTimedLife(dummyCaster,'BTLF', 7)
		call SaveReal(HY, h, 6,((targetX)* 1.))
		call SaveReal(HY, h, 7,((targetY)* 1.))
	endif
	set N5O = N5O + .2
	call SaveReal(HY, h, 57,((N5O)* 1.))
	if N5O > 7 or GetWidgetLife(u)< 1 then
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
	endif
	set t = null
	set u = null
	set X2A = null
	set dummyCaster = null
endfunction
function X5A takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local sound X6A
	local timer t
	local integer h
	call UnitDamageTargetEx(GW, targetUnit, 1, JW)
	call GroupAddUnit(LW, targetUnit)
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		set X6A = CreateSound("Sounds\\Spectral Dagger.mp3", false, true, true, 10, 10, "DefaultEAXON")
		call SetSoundPosition(X6A, GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call SetSoundDistanceCutoff(X6A, 700)
		call StartSound(X6A)
		call KillSoundWhenDone(X6A)
		call SaveUnitHandle(HY, h, 221,(targetUnit))
		call SaveUnitHandle(HY, h, 383,(GW))
		call SaveReal(HY, h, 6,((GetUnitX(targetUnit))* 1.))
		call SaveReal(HY, h, 7,((GetUnitY(targetUnit))* 1.))
		call SaveInteger(HY, h, 0, Q2)
		call TimerStart(t, .2, true, function X1A)
	endif
	set targetUnit = null
	set t = null
endfunction
function X7A takes nothing returns boolean
	return((IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GW)) and IsUnitInGroup(GetFilterUnit(), LW) == false and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and GetWidgetLife(GetFilterUnit())> 1 and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false))
endfunction
function X8A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group gg = LoadGroupHandle(HY, h, 133)
	local group g = AllocationGroup(388)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	local unit missileDummy = LoadUnitHandle(HY, h, 45)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local real tx = GetUnitX(targetUnit)
	local real ty = GetUnitY(targetUnit)
	local real sx = GetUnitX(missileDummy)
	local real sy = GetUnitY(missileDummy)
	local real I3X = Atan2(ty -sy, tx -sx)
	local real targetX = CoordinateX50(GetUnitX(missileDummy)+ 30 * Cos(I3X))
	local real targetY = CoordinateY50(GetUnitY(missileDummy)+ 30 * Sin(I3X))
	local unit dummyCaster
	local integer level = LoadInteger(HY, h, 0)
	if (LoadBoolean(HY, h, 384)) then
		call SaveBoolean(HY, h, 384, false)
		set dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'h002', sx, sy, 0)
		call SetUnitAbilityLevel(dummyCaster,'A0I2', level)
		call SetUnitAbilityLevel(dummyCaster,'A0HY', level)
		call UnitApplyTimedLife(dummyCaster,'BTLF', 12)
	else
		call SaveBoolean(HY, h, 384, true)
	endif
	call SetUnitX(missileDummy, targetX)
	call SetUnitY(missileDummy, targetY)
	call SetUnitFacing(missileDummy, I3X * bj_RADTODEG)
	set LW = gg
	set GW = trigUnit
	set JW = 50 * level
	set Q2 = level
	call GroupEnumUnitsInRange(g, targetX, targetY, 150, Condition(function X7A))
	call ForGroup(g, function X5A)
	call DeallocateGroup(g)
	if (targetX -tx)*(targetX -tx)+(targetY -ty)*(targetY -ty)< 1600 then
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call KillUnit(missileDummy)
		call DeallocateGroup(gg)
	endif
	set gg = null
	set t = null
	set g = null
	set trigUnit = null
	set missileDummy = null
	set targetUnit = null
	set dummyCaster = null
endfunction
function X9A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group gg =(LoadGroupHandle(HY, h, 133))
	local group g = AllocationGroup(389)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local unit missileDummy =(LoadUnitHandle(HY, h, 45))
	local real tx =(LoadReal(HY, h, 47))
	local real ty =(LoadReal(HY, h, 48))
	local real sx = GetUnitX(missileDummy)
	local real sy = GetUnitY(missileDummy)
	local real I3X =(LoadReal(HY, h, 13))
	local real nX = CoordinateX50(GetUnitX(missileDummy)+ 30 * Cos(I3X))
	local real nY = CoordinateY50(GetUnitY(missileDummy)+ 30 * Sin(I3X))
	local unit dummyCaster
	local integer level = LoadInteger(HY, h, 0)
	if (LoadBoolean(HY, h, 384)) then
		call SaveBoolean(HY, h, 384,(false))
		set dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),('h002'), sx, sy, 0)
		call SetUnitAbilityLevel(dummyCaster,('A0I2'), level)
		call SetUnitAbilityLevel(dummyCaster,('A0HY'), level)
		call UnitApplyTimedLife(dummyCaster,'BTLF', 12)
	else
		call SaveBoolean(HY, h, 384,(true))
	endif
	call SetUnitX(missileDummy, nX)
	call SetUnitY(missileDummy, nY)
	set LW = gg
	set GW = trigUnit
	set JW = 50 * GetUnitAbilityLevel(trigUnit,'A0HW')+ 50
	call GroupEnumUnitsInRange(g, nX, nY, 165, Condition(function X7A))
	call ForGroup(g, function X5A)
	call DeallocateGroup(g)
	if (nX -tx)*(nX -tx)+(nY -ty)*(nY -ty)< 1600 then
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call KillUnit(missileDummy)
		call DeallocateGroup(gg)
	endif
	set gg = null
	set t = null
	set g = null
	set trigUnit = null
	set missileDummy = null
	set dummyCaster = null
endfunction
//function OVA takes unit K4X, integer index returns boolean
//	return(GetItemTypeId(UnitItemInSlot(K4X, index))=='pspd') or(GetItemTypeId(UnitItemInSlot(K4X, index))=='oflg')
//endfunction
function OEA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	local real N5O = LoadReal(HY, h, 57)
	//local integer loop_i = 0
	//loop
	//exitwhen loop_i > 5
	//	if OVA(trigUnit, loop_i) then
	//		if GetUnitAbilityLevel(trigUnit,('B047')) == 0 then
	//			call SetItemDropOnDeath(UnitItemInSlot(trigUnit, loop_i), true)
	//			if GetItemTypeId(UnitItemInSlot(trigUnit, loop_i))=='oflg' then
	//				call SetItemDroppable(UnitItemInSlot(trigUnit, loop_i), true)
	//			endif
	//		else
	//			call SetItemDropOnDeath(UnitItemInSlot(trigUnit, loop_i), false)
	//			if GetItemTypeId(UnitItemInSlot(trigUnit, loop_i))=='oflg' then
	//				call SetItemDroppable(UnitItemInSlot(trigUnit, loop_i), false)
	//			endif
	//		endif
	//	endif
	//	set loop_i = loop_i + 1
	//endloop
	set N5O = N5O + .2
	call SaveReal(HY, h, 57, N5O * 1.)
	if GetUnitAbilityLevel(trigUnit,('B047')) == 0 then
		call SetUnitPathingEx(trigUnit, true)
	else
		call SetUnitPathingEx(trigUnit, false)
	endif
	if N5O > 30 then
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call SetUnitPathingEx(trigUnit, true)
		//set loop_i = 0
		//loop
		//exitwhen loop_i > 5
		//	if OVA(trigUnit, loop_i) then
		//		call SetItemDropOnDeath(UnitItemInSlot(trigUnit, loop_i), true)
		//		if GetItemTypeId(UnitItemInSlot(trigUnit, loop_i))=='oflg' then
		//			call SetItemDroppable(UnitItemInSlot(trigUnit, loop_i), true)
		//		endif
		//	endif
		//	set loop_i = loop_i + 1
		//endloop
	endif
	set t = null
	set trigUnit = null
endfunction
function OXA takes unit trigUnit, integer level returns nothing
	local unit targetUnit = GetSpellTargetUnit()
	local real sx = CoordinateX50(GetUnitX(trigUnit))
	local real sy = CoordinateY50(GetUnitY(trigUnit))
	local unit missileDummy = CreateUnit(GetOwningPlayer(trigUnit),('h003'), sx, sy, 0)
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local group CNO = AllocationGroup(390)
	local real a
	local real tx
	local real ty
	call SetUnitPathing(missileDummy, false)
	call SaveGroupHandle(HY, h, 133, CNO)
	call SaveUnitHandle(HY, h, 14, trigUnit)
	call SaveUnitHandle(HY, h, 45, missileDummy)
	if targetUnit != null then
		call SaveUnitHandle(HY, h, 30, targetUnit)
		call SaveInteger(HY, h, 0, level)
		call TimerStart(t, .035, true, function X8A)
	else
		set tx = GetSpellTargetX()
		set ty = GetSpellTargetY()
		set a = Atan2(ty -sy, tx -sx)
		call SetUnitFacing(missileDummy, a * bj_RADTODEG)
		set tx = CoordinateX50(sx + 2100* Cos(a))
		set ty = CoordinateY50(sy + 2100* Sin(a))
		call SaveReal(HY, h, 47, tx * 1.)
		call SaveReal(HY, h, 48, ty * 1.)
		call SaveReal(HY, h, 13, a * 1.)
		call SaveInteger(HY, h, 0, level)
		call TimerStart(t, .035, true, function X9A)
	endif
	set t = CreateTimer()
	set h = GetHandleId(t)
	call SetUnitPathingEx(trigUnit, false)
	call SaveUnitHandle(HY, h, 14, trigUnit)
	call TimerStart(t, .2, true, function OEA)
	set targetUnit = null
	set missileDummy = null
	set t = null
	set CNO = null
endfunction
function AUE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A0HW')
	if GetUnitAbilityLevel(whichUnit,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(whichUnit), 0) then
		set whichUnit = LoadUnitHandle(HY, GetHandleId(whichUnit), 0)
	endif
	call OXA(whichUnit, level)
	set whichUnit = null
endfunction
function PIX takes nothing returns nothing
	call CreateSound("Sounds\\Spectral Dagger.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call AddAbilityIDToPreloadQueue('A0I2')
	call AddAbilityIDToPreloadQueue('A0HY')
endfunction
function OOA takes nothing returns boolean
	return(IsUnitAlly(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()))!= null
endfunction
function ORA takes unit R8X, unit targetUnit returns nothing
	local group g = AllocationGroup(391)
	local real d = 20 * GetUnitAbilityLevel(R8X,'P338')
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 275, Condition(function OOA))
	call GroupRemoveUnit(g, targetUnit)
	if FirstOfGroup(g) == null then
		if IsUnitIllusion(R8X) or IsUnitType(R8X, UNIT_TYPE_MELEE_ATTACKER) == false then
			set d = 0 + 10* GetUnitAbilityLevel(R8X,'P338')
			if GetUnitAbilityLevel(R8X,'B06L')> 0 then
				set d = d * .75
			endif
		endif
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayTarget.mdl", targetUnit, "overhead"))
		call EPX(R8X, 4275, .3)
		call UnitDamageTargetEx(R8X, targetUnit, 3, d)
	endif
	call DeallocateGroup(g)
	set g = null
endfunction
function OIA takes unit R8X, unit targetUnit returns nothing
	if GetUnitAbilityLevel(R8X,'P338')> 0 and(IsUnitIllusion(R8X) or IsUnitType(R8X, UNIT_TYPE_MELEE_ATTACKER)) and GetUnitAbilityLevel(R8X,'A36D') == 0 and LoadInteger(HY, GetHandleId(R8X), 4275)!= 1 and IsAliveNotStrucNotWard(targetUnit) and targetUnit != Roshan then
		call ORA(R8X, targetUnit)
	endif
endfunction
function Spectre_Dispersion_Spread takes nothing returns nothing
	local real d = GetUnitDistanceEx(GetTriggerUnit(), GetEnumUnit())-25
	local real ENI =( 1000-d)/ 700
	if ENI > 1. then
		set ENI = 1.
	endif
	if ENI > 0 then
		call UnitDamageTargetEx(GetTriggerUnit(), GetEnumUnit(), 11, MSV * ENI)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayDamage.mdl", GetEnumUnit(), "chest"))
	endif
endfunction
function OAA takes nothing returns boolean
	local unit damagedUnit = GetTriggerUnit()
	local real rDamageValue = GetEventDamage()
	local integer level = GetUnitAbilityLevel(damagedUnit,'A0NA')
	local group g = null
	local real d
	local real ENI
	local real ONA
	local unit firstUnit = null
	if IsEffectiveDamage(rDamageValue) and FK and UnitAlive(damagedUnit) and GetUnitAbilityLevel(damagedUnit,'A36D') == 0 then
		set g = AllocationGroup(392)
		if not Mode__RearmCombos and GetHeroMainAttributesType(damagedUnit) == HERO_ATTRIBUTE_STR then
			set ONA = rDamageValue *(.06 + .02 * level)
		else
			set ONA = rDamageValue *(.06 + .04 * level)
		endif
		call GroupEnumUnitsInRange(g, GetUnitX(damagedUnit), GetUnitY(damagedUnit), 1025, null)
		set Temp__ArrayPlayer[8191] = GetOwningPlayer(damagedUnit)
		loop
			set firstUnit = FirstOfGroup(g)
		exitwhen firstUnit == null
			call GroupRemoveUnit(g, firstUnit)
			// 敌对单位 存活 不是建筑不是守卫 不是魔免
			if IsUnitEnemy(firstUnit, Temp__ArrayPlayer[8191]) and IsAliveNotStrucNotWard(firstUnit) and not IsUnitMagicImmune(firstUnit) then
				set d = GetUnitDistanceEx(damagedUnit, firstUnit)-25
				set ENI =( 1000 - d ) / 700
				if ENI > 1. then
					set ENI = 1.
				endif
				if ENI > 0 then
					call UnitDamageTargetEx(damagedUnit, firstUnit, 11, ONA * ENI)
					call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayDamage.mdl", firstUnit, "chest"))
				endif
			endif
		endloop
		set firstUnit = null
		call DeallocateGroup(g)
		set g = null
	endif
	set damagedUnit = null
	return false
endfunction
function MME takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function OAA))
	set t = null
endfunction
function OBA takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local unit trigUnit = GetTriggerUnit()
	local unit dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call SaveUnitHandle(HY,(GetHandleId(dummyCaster)), 387,(targetUnit))
	call UnitAddPermanentAbility(dummyCaster,('A0N9'))
	call SetUnitAbilityLevel(dummyCaster,('A0N9'), GetUnitAbilityLevel(trigUnit,'A0H9'))
	call IssueTargetOrderById(dummyCaster, 852274, trigUnit)
	set targetUnit = null
	set dummyCaster = null
	set trigUnit = null
endfunction
function OCA takes nothing returns boolean
	return((UnitIsDead(GetFilterUnit()) == false and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit()))))
endfunction
function ODA takes nothing returns nothing
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local unit TJX =(LoadUnitHandle(HY, h, 386))
	local unit targetUnit =(LoadUnitHandle(HY, h, 387))
	local integer OFA =(LoadInteger(HY, h, 385))
	if GetTriggerEventId()!= EVENT_WIDGET_DEATH and GetTriggerEventId()!= EVENT_UNIT_ISSUED_TARGET_ORDER and GetTriggerEventId()!= EVENT_UNIT_ISSUED_POINT_ORDER then
		set OFA = OFA + 1
		call SaveInteger(HY, h, 385,(OFA))
	endif
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call DisableTrigger(GetTriggeringTrigger())
		call FlushChildHashtable(HY,(GetHandleId(trig)))
		call SaveInteger(HY, h, 385,(OFA))
		if targetUnit == GetTriggerUnit() then
			call KillUnit(TJX)
		endif
		call CleanCurrentTrigger(trig)
	elseif IsUnitPaused(TJX) == false then
		if OFA == 2 then
			call SetUnitVertexColor(TJX, 255, 255, 255, 255)
		endif
		if OFA > 1 then
			call DisableTrigger(trig)
			if GetUnitDistanceEx(TJX, targetUnit)< 1200 then
				call IssueTargetOrderById(TJX, 851983, targetUnit)
			endif
			call EnableTrigger(trig)
		else
			call DisableTrigger(trig)
			if GetUnitDistanceEx(TJX, targetUnit)< 1200 then
				call IssueTargetOrderById(TJX, 851986, targetUnit)
			endif
			call EnableTrigger(trig)
		endif
	endif
	set targetUnit = null
	set trig = null
	set TJX = null
endfunction
function OGA takes nothing returns boolean
	return GetUnitAbilityLevel(GetSummonedUnit(),'B06L')> 0
endfunction
function OHA takes nothing returns nothing
	local unit dummyCaster = GetSummoningUnit()
	local unit TJX = GetSummonedUnit()
	local unit targetUnit = LoadUnitHandle(HY, GetHandleId(dummyCaster), 387)
	local trigger t = CreateTrigger()
	call SaveUnitHandle(HY, GetHandleId(Player__Hero[GetPlayerId(GetOwningPlayer(dummyCaster))]), 7100 + GetHandleId(TJX), targetUnit)
	call SetUnitPathing(TJX, false)
	call SetUnitMoveSpeed(TJX, 400)
	call SetUnitX(TJX, GetUnitX(targetUnit))
	call SetUnitY(TJX, GetUnitY(targetUnit))
	call IssueTargetOrderById(TJX, 851986, targetUnit)
	call SetUnitVertexColor(TJX, 255, 255, 255, 50)
	call TriggerRegisterUnitEvent(t, TJX, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterUnitEvent(t, TJX, EVENT_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterDeathEvent(t, TJX)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddAction(t, function ODA)
	call DestroyEffect(AddSpecialEffect("units\\nightelf\\SpiritOfVengeance\\SpiritOfVengeance.mdl", GetUnitX(TJX), GetUnitY(TJX)))
	call SaveUnitHandle(HY, GetHandleId(t), 387, targetUnit)
	call SaveUnitHandle(HY, GetHandleId(t), 386, TJX)
	call SaveInteger(HY, GetHandleId(t), 385, 0)
	call FlushChildHashtable(HY, GetHandleId(dummyCaster))
	set dummyCaster = null
	set TJX = null
	set targetUnit = null
	set t = null
endfunction
function AWE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local group g = AllocationGroup(393)
	local sound s
	call UnitAddPermanentAbility(GetTriggerUnit(),'A0HA')
	call SetUnitPathing(trigUnit, false)
	call GroupEnumUnitsInRect(g, bj_mapInitialPlayableArea, Condition(function OCA))
	call ForGroup(g, function OBA)
	call SetUnitPathing(trigUnit, true)
	if FirstOfGroup(g)!= null then
		set s = CreateSound("Abilities\\Spells\\Other\\ANsa\\SacrificeUnit.wav", false, false, false, 10, 10, "DefaultEAXON")
		call StartSound(s)
		call KillSoundWhenDone(s)
	endif
	call DeallocateGroup(g)
	set g = null
	set trigUnit = null
endfunction
function MPE takes nothing returns nothing
	call UnitAddPermanentAbility(GetTriggerUnit(),'A0HA')
endfunction
function PAX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function OGA))
	call TriggerAddAction(t, function OHA)
	call CreateSound("Abilities\\Spells\\Other\\ANsa\\SacrificeUnit.wav", false, false, false, 10, 10, "DefaultEAXON")
	call AddAbilityIDToPreloadQueue('A0N9')
	set t = null
endfunction
function OJA takes nothing returns boolean
	return GetUnitAbilityLevel(GetFilterUnit(),('B06L'))> 0
endfunction
function OKA takes nothing returns nothing
	local unit K4X
	local real GIX = I0X(GetEnumUnit(), GetSpellTargetLoc())
	if GIX < JW then
		set GW = GetEnumUnit()
		set JW = GIX
	endif
	set K4X = null
endfunction
function OLA takes nothing returns unit
	local group g = AllocationGroup(394)
	set GW = null
	set JW = 9999999
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(GetTriggerUnit()), Condition(function OJA))
	call ForGroup(g, function OKA)
	call DeallocateGroup(g)
	set g = null
	return GW
endfunction
function OMA takes nothing returns nothing
	if LoadInteger(HY, GetHandleId(GetEnumUnit()),'A0H9')!= 1 then
		call EPX(GetEnumUnit(),'A0H9', 6)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\SpiritLink\\SpiritLinkZapTarget.mdl", GetEnumUnit(), "chest"))
		call UnitDamageTargetEx(JA, GetEnumUnit(), 1, GetUnitAbilityLevel(JA,'A0H9')* 50 + 50)
	endif
endfunction
function OPA takes unit KKX, unit PQI returns nothing
	local group g = AllocationGroup(395)
	set U2 = KKX
	call GroupEnumUnitsInRange(g, GetUnitX(PQI), GetUnitY(PQI), 375, Condition(function DJX))
	set JA = KKX
	call KillUnit(PQI)
	call ForGroup(g, function OMA)
	call DeallocateGroup(g)
	set g = null
endfunction
function AYE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local unit targetUnit = OLA()
	local unit OQA =(LoadUnitHandle(HY,(GetHandleId(trigUnit)),(7100 + GetHandleId(targetUnit))))
	local real tx
	local real ty
	if targetUnit == null then
		call InterfaceErrorForPlayer(GetOwningPlayer(trigUnit), GetObjectName('n03Z'))
	else
		set tx = GetUnitX(targetUnit)
		set ty = GetUnitY(targetUnit)
		call OPA(trigUnit, targetUnit)
		call SetUnitX(targetUnit, GetUnitX(trigUnit))
		call SetUnitY(targetUnit, GetUnitY(trigUnit))
		call SetUnitX(trigUnit, tx)
		call SetUnitY(trigUnit, ty)
		if GetDistanceBetween(GetCameraEyePositionX(), GetCameraEyePositionY(), tx, ty)> 1400 then
			call PanCameraToTimedForPlayer(GetOwningPlayer(trigUnit), tx, ty, 0)
		endif
		call IssueTargetOrderById(trigUnit, 851983, OQA)
	endif
	set trigUnit = null
	set targetUnit = null
	set OQA = null
endfunction
function OSA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit target =(LoadUnitHandle(HY, h, 17))
	local unit u =(LoadUnitHandle(HY, h, 2))
	local real I3X =(LoadReal(HY, h, 13))
	local real x = GetUnitX(target)
	local real y = GetUnitY(target)
	local integer c = GetTriggerEvalCount(t)
	local real EOX = LoadReal(HY, h, 193)
	local integer WOV =(LoadInteger(HY, h, 12))
	local integer i
	if c > 35 then
		call SaveReal(HY, h, 193, EOX * .98)
	endif
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or c > WOV then
		set i = LoadInteger(ObjectHashTable, h,'A0G5')-1
		call SaveInteger(ObjectHashTable, h,'A0G5', i)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl", x, y))
		call KillTreeByCircle(x, y, 150)
		set x = CoordinateX50(x + EOX * Cos(I3X))
		set y = CoordinateY50(y + EOX * Sin(I3X))
		if (IsPointInRegion(TerrainCliffRegion,((x)* 1.),((y)* 1.))) == false then
			if IsUnitType(target, UNIT_TYPE_HERO) then
				call SaveBoolean(OtherHashTable, GetHandleId(target), 99, true)
			endif
			call SetUnitX(target, x)
			call SetUnitY(target, y)
		endif
		if c == 1 and LoadBoolean(HY, h, 0) then
			call IssueTargetOrderById(u, 851983, target)
		endif
	endif
	set t = null
	set target = null
	set u = null
	return false
endfunction
function OTA takes unit u, unit target, integer lv, boolean OUA returns nothing
	local trigger t = null
	local integer h
	call UnitAddAbilityToTimed(u,'A24G', 1, 3,'B0EC')
	if target == Roshan then
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .01, true)
	call TriggerRegisterDeathEvent(t, target)
	call TriggerAddCondition(t, Condition(function OSA))
	call SaveInteger(HY, h, 12, 80 + 20 * lv)
	call SaveUnitHandle(HY, h, 2, u)
	call SaveUnitHandle(HY, h, 17, target)
	call SaveBoolean(HY, h, 0, OUA)
	call SaveReal(HY, h, 193, 2.)
	call SaveReal(HY, h, 13, Atan2(GetUnitY(target)-GetUnitY(u), GetUnitX(target)-GetUnitX(u)))
	call UnitDamageTargetEx(u, target, 1, GetHeroMoveSpeed(u)* .1 * lv)
	call SaveInteger(ObjectHashTable, GetHandleId(u),'A0G5', LoadInteger(ObjectHashTable, GetHandleId(u),'A0G5')+ 1)
	set t = null
endfunction
function OWA takes unit u, unit t, boolean b, integer i returns nothing
	local unit d = null
	local integer lv
	if GetUnitAbilityLevel(u,'A36D') == 1 then
		return
	endif
	set lv = GetUnitAbilityLevel(u,'A0G5')
	set d = CreateUnit(GetOwningPlayer(t),'e00E', GetUnitX(t), GetUnitY(t), 0)
	if lv == 0 then
		if i == 2 then
			set lv = 4
		elseif i == 3 then
			set lv = GetUnitAbilityLevel(u,'A1P8')
		endif
	endif
	call UnitAddAbility(d,'A1WQ')
	call SetUnitAbilityLevel(d,'A1WQ', lv)
	if t == Roshan or IssueTargetOrderById(d, 852095, t) then
		call OTA(u, t, lv, b)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl", u, GetHeroWeaponAttachPointName(u)))
	endif
	call KillUnit(d)
	set d = null
endfunction
function OYA takes unit u, unit t returns nothing
	if IsUnitIllusion(u) == false and(Mode__BalanceOff or LoadReal(ObjectHashTable, GetHandleId(u),'A0G5')< GetGameTime()) then
		if GetUnitAbilityLevel(u,'A36D') == 0 and GetUnitAbilityLevel(u,'A3L2') == 0 and TKV(u,'A0G5', 17) then
			call SaveReal(ObjectHashTable, GetHandleId(u),'A0G5', GetGameTime()+ 1.5)
			call OWA(u, t, true, 1)
		endif
	endif
endfunction
function OZA takes nothing returns boolean
	local unit t = GetFilterUnit()
	local unit u = Temp__ArrayUnit[0]
	local real x1
	local real y1
	local real x2
	local real y2
	local real O_A
	if IsUnitEnemy(u, GetOwningPlayer(t)) and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false and GetUnitAbilityLevel(t,'A04R') == 0 and UnitVisibleToPlayer(t, GetOwningPlayer(u)) and UnitAlive(t) and(IsUnitType(t, UNIT_TYPE_ANCIENT) == false or DRX(t)) and IsUnitMagicImmune(t) == false then
		set u = Temp__ArrayUnit[2]
		set x1 = GetWidgetX(u)
		set y1 = GetWidgetY(u)
		set x2 = GetWidgetX(t)
		set y2 = GetWidgetY(t)
		set O_A = SquareRoot((x1 -x2)*(x1 -x2)+(y1 -y2)*(y1 -y2))
		if Temp__ArrayReal[0]> O_A then
			set Temp__ArrayUnit[1]= t
			set Temp__ArrayReal[0]= O_A
		endif
	endif
	set t = null
	set u = null
	return false
endfunction
function O0A takes unit u, unit t, integer i returns boolean
	local string s = ""
	set Temp__ArrayUnit[0]= u
	set Temp__ArrayUnit[1]= null
	set Temp__ArrayUnit[2]= t
	set Temp__ArrayReal[0]= 99999.
	call GroupEnumUnitsInRange(AK, GetWidgetX(t), GetWidgetY(t), 4000, Condition(function OZA))
	if Temp__ArrayUnit[1]== null then
		call IssueImmediateOrderById(u, 851972)
		return true
	endif
	if Temp__ArrayUnit[1]!= null then
		call UnitAddPermanentAbility(Temp__ArrayUnit[1],'A315')
		call GHX(Temp__ArrayUnit[1], u,'A315')
		call SaveUnitHandle(ObjectHashTable, GetHandleId(u), StringHash("ChargedUnit"), Temp__ArrayUnit[1])
	endif
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(u)) or IsObserverPlayer(LocalPlayer) then
		set s = "Abilities\\Spells\\Other\\HowlOfTerror\\HowlTarget.mdl"
	endif
	call DestroyEffect(LoadEffectHandle(ObjectHashTable, i, 5))
	call DestroyEffect(LoadEffectHandle(ObjectHashTable, i, 4))
	call SaveEffectHandle(ObjectHashTable, i, 4, AddSpecialEffectTarget(s, Temp__ArrayUnit[1], "overhead"))
	call SaveEffectHandle(ObjectHashTable, i, 5, AddSpecialEffectTarget(s, Temp__ArrayUnit[1], "overhead"))
	call SaveUnitHandle(ObjectHashTable, i, 1, Temp__ArrayUnit[1])
	call UnitRemoveAbility(Temp__ArrayUnit[2],'A315')
	return false
endfunction
function O1A takes timer t, unit u, unit targetUnit, integer WFV returns nothing
	call SetUnitTimeScale(u, 1)
	call SetUnitPathing(u, true)
	call SetUnitAnimation(u, "stand")
	call SetUnitVertexColorEx(u,-1,-1,-1, 255)
	if LoadUnitHandle(ObjectHashTable, GetHandleId(u), StringHash("ChargedUnit"))!= null then
		call UnitRemoveAbility(LoadUnitHandle(ObjectHashTable, GetHandleId(u), StringHash("ChargedUnit")),'A315')
	endif
	call UnitRemoveAbility(targetUnit,'A315')
	call SaveBoolean(ObjectHashTable, GetHandleId(u),'A1P8', false)
	call DestroyEffect(LoadEffectHandle(ObjectHashTable, WFV, 5))
	call DestroyEffect(LoadEffectHandle(ObjectHashTable, WFV, 4))
	call DestroyEffect(LoadEffectHandle(ObjectHashTable, WFV, 3))
	call DeallocateGroup(LoadGroupHandle(ObjectHashTable, WFV, 2))
	call DestroyTimerAndFlushHT_P(t)
endfunction
function O2A takes nothing returns boolean
	local unit t = GetFilterUnit()
	local unit u = Temp__ArrayUnit[0]
	local group g = LoadGroupHandle(ObjectHashTable, XK[0], 2)
	if IsUnitEnemy(u, GetOwningPlayer(t)) and IsUnitInGroup(t, g) == false and t != Temp__ArrayUnit[1]and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false and GetUnitAbilityLevel(t,'A04R') == 0 and UnitAlive(t) and(IsUnitType(t, UNIT_TYPE_ANCIENT) == false or DRX(t)) then
		call GroupAddUnit(g, t)
		call OWA(u, t, false, 3)
	endif
	set t = null
	set u = null
	set g = null
	return false
endfunction
function O3A takes nothing returns nothing
	local timer time = GetExpiredTimer()
	local integer WFV = GetHandleId(time)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	local unit t = LoadUnitHandle(ObjectHashTable, WFV, 1)
	local real x1 = GetWidgetX(u)
	local real y1 = GetWidgetY(u)
	local real O_A
	local real I3X
	local real N3X
	local real x2
	local real y2
	if LoadBoolean(ObjectHashTable, GetHandleId(u),'A1P8') == false or(UnitIsDead(t) and O0A(u, t, WFV)) then
		call O1A(time, u, t, WFV)
		set time = null
		set t = null
		set u = null
		return
	endif
	set x2 = GetWidgetX(t)
	set y2 = GetWidgetY(t)
	set N3X = LoadReal(ObjectHashTable, WFV, 0)
	set O_A = SquareRoot((x1 -x2)*(x1 -x2)+(y1 -y2)*(y1 -y2))
	if  100 > O_A then
		call O1A(time, u, t, WFV)
		call IssueTargetOrderById(u, 851983, t)
		call SetUnitAnimation(u, "attack")
		call OWA(u, t, true, 3)
		set u = CreateUnit(GetOwningPlayer(t),'e00E', GetWidgetX(t), GetWidgetY(t), 0)
		call CommonUnitAddStun(u,(.4 * LoadInteger(ObjectHashTable, WFV, 0))+ .8, false)
		set time = null
		set t = null
		set u = null
		return
	endif
	set I3X = Atan2(y2 -y1, x2 -x1)
	set XK[0]= WFV
	set x2 = x1 + N3X * Cos(I3X)
	set y2 = y1 + N3X * Sin(I3X)
	set Temp__ArrayUnit[0]= u
	set Temp__ArrayUnit[1]= t
	call SetUnitFacing(u, I3X * bj_RADTODEG)
	call SetUnitX(u, x2)
	call SetUnitY(u, y2)
	call GroupEnumUnitsInRange(AK, x2, y2, 325, Condition(function O2A))
	set time = null
	set t = null
	set u = null
endfunction
function JRE takes nothing returns nothing
	local unit targetUnit = LoadUnitHandle(ObjectHashTable, GetHandleId(GetTriggerUnit()), StringHash("ChargedUnit"))
	call SaveBoolean(ObjectHashTable, GetHandleId(GetTriggerUnit()),'A1P8', false)
	call UnitRemoveAbility(targetUnit,'A315')
	set targetUnit = null
endfunction
function O4A takes unit whichUnit, integer WUV returns nothing
	local timer time = CreateTimer()
	local unit targetUnit = GetSpellTargetUnit()
	local integer WFV = GetHandleId(time)
	local integer W0V = GetHandleId(whichUnit)
	local string s = ""
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(whichUnit)) or IsObserverPlayer(LocalPlayer) then
		set s = "Abilities\\Spells\\Other\\HowlOfTerror\\HowlTarget.mdl"
		call PingMinimapEx(GetWidgetX(targetUnit), GetWidgetY(targetUnit), 2, 255, 255, 255, false)
	endif
	call SetUnitPathing(whichUnit, false)
	call SetUnitTimeScale(whichUnit, 2.5)
	call SetUnitAnimationByIndex(whichUnit, LoadInteger(ObjectHashTable, GetUnitTypeId(whichUnit),'A1P8'))
	call SetUnitVertexColorEx(whichUnit,-1,-1,-1, 100)
	call UnitAddPermanentAbility(targetUnit,'A315')
	call GHX(targetUnit, whichUnit,'A315')
	call SaveBoolean(ObjectHashTable, W0V,'A1P8', true)
	call SaveUnitHandle(ObjectHashTable, WFV, 0, whichUnit)
	call SaveUnitHandle(ObjectHashTable, WFV, 1, targetUnit)
	call SaveUnitHandle(ObjectHashTable, GetHandleId(whichUnit), StringHash("ChargedUnit"), targetUnit)
	call SaveGroupHandle(ObjectHashTable, WFV, 2, AllocationGroup(396))
	call SaveEffectHandle(ObjectHashTable, WFV, 3, AddSpecialEffectTarget("war3mapImported\\ShockwaveMissilePurple.mdx", whichUnit, "origin"))
	call SaveEffectHandle(ObjectHashTable, WFV, 4, AddSpecialEffectTarget(s, targetUnit, "overhead"))
	call SaveEffectHandle(ObjectHashTable, WFV, 5, AddSpecialEffectTarget(s, targetUnit, "overhead"))
	call SaveInteger(ObjectHashTable, WFV, 0, WUV)
	call SaveReal(ObjectHashTable, WFV, 0, WUV * 1.25 + 13.75)
	call TimerStart(time, .025, true, function O3A)
	set whichUnit = null
	set targetUnit = null
	set time = null
endfunction
function W9V takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A1P8')
	if GetUnitAbilityLevel(whichUnit,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(whichUnit), 0) then
		set whichUnit = LoadUnitHandle(HY, GetHandleId(whichUnit), 0)
	endif
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call O4A(whichUnit, level)
	endif
	set whichUnit = null
endfunction
function LKE takes nothing returns nothing
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(GetTriggerUnit()),'A179', false)
endfunction
function O5A takes nothing returns nothing
	local integer i = 1
	local integer O6A
	local integer V4A
	local unit u
	loop
		set u = Player__Hero[i]
		if GetUnitAbilityLevel(u,'P310')> 0 and u != null and UnitAlive(u) and M2[i]== false then
			set O6A = LoadInteger(ObjectHashTable, GetHandleId(u),'P310')
			set V4A = R2I(.03 * GetUnitAbilityLevel(u,'P310')* GetHeroMoveSpeed(u))
			if O6A != V4A then
				if O6A > V4A then
					call UnitReduceStateBonus(u, O6A -V4A, UNIT_BONUS_DAMAGE)
					call SaveInteger(ObjectHashTable, GetHandleId(u),'P310', V4A)
				else
					call UnitAddStateBonus(u, V4A -O6A, UNIT_BONUS_DAMAGE)
					call SaveInteger(ObjectHashTable, GetHandleId(u),'P310', V4A)
				endif
			endif
		endif
		set i = i + 1
		if i == 6 then
			set i = 7
		endif
	exitwhen i > 11
	endloop
	set u = null
endfunction
function PMX takes nothing returns nothing
	call TimerStart(CreateTimer(), .5, true, function O5A)
endfunction
function Spiritbreaker_EmpoweringHaste_PostEnd takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	call UnitRemoveAbility(u,'A44L')
	call UnitRemoveAbility(u,'B03Y')
	call SetPlayerAbilityAvailable(GetOwningPlayer(u),'P310', true)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set u = null
	set t = null
endfunction
function O7A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	call UnitRemoveAbility(u,'A44M')
	call UnitRemoveAbility(u,'B44M')
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set u = null
	set t = null
endfunction
function O8A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	call UnitRemoveAbility(u,'A44K')
	call UnitRemoveAbility(u,'B44K')
	if UnitAlive(u) then
		call UnitAddPermanentAbilitySetLevel(u,'A44M', GetUnitAbilityLevel(u,'A0ES'))
		call TimerStart(t, 6, false, function O7A)
	else
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	endif
	set u = null
	set t = null
endfunction
function W6V takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	call TimerStart(t, 6, false, function O8A)
	call SaveUnitHandle(HY, h, 0, u)
	call UnitAddPermanentAbilitySetLevel(u,'A44K', GetUnitAbilityLevel(u,'A0ES'))
	set u = null
	set t = null
endfunction
function O9A takes unit whichUnit, unit targetUnit returns nothing
	call OWA(whichUnit, targetUnit, true, 2)
endfunction
function RVA takes nothing returns nothing
	call OWA(MTV, GetEnumUnit(), false, 2)
endfunction
function REA takes unit whichUnit, unit Targer returns nothing
	local group g = AllocationGroup(397)
	set U2 = whichUnit
	set MTV = whichUnit
	call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 275, Condition(function DHX))
	call ForGroup(g, function RVA)
	call DeallocateGroup(g)
	set g = null
endfunction
function RXA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer count = GetTriggerEvalCount(t)
	local integer ROA
	local integer level
	local real a
	local real GXR =(LoadReal(HY, h, 23))
	local real GOR =(LoadReal(HY, h, 24))
	local real x = GetUnitX(targetUnit)
	local real y = GetUnitY(targetUnit)
	local real d = GetDistanceBetween(x, y, GXR, GOR)
	call SaveReal(HY, h, 23,((x)* 1.))
	call SaveReal(HY, h, 24,((y)* 1.))
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or d > 1800 or count > 100  then
		call SetUnitVertexColorEx(whichUnit,-1,-1,-1, 255)
		call UnitRemoveAbility(targetUnit,'A314')
		call UnitRemoveAbility(whichUnit,'A179')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set ROA = 50 + count * 2
		call SetUnitVertexColorEx(whichUnit,-1,-1,-1, ROA)
		if count == 1 then
			set level =(LoadInteger(HY, h, 5))
			set a = Atan2(GetUnitY(targetUnit)-GetUnitY(whichUnit), GetUnitX(targetUnit)-GetUnitX(whichUnit))
			call SetUnitPosition(whichUnit, GetUnitX(targetUnit)+ 80 * Cos(a), GetUnitY(targetUnit)+ 80 * Sin(a))
			call SetUnitAnimation(whichUnit, "attack")
			call IssueTargetOrderById(whichUnit, 851983, targetUnit)
			if LoadBoolean(HY, h, 0) then
				call REA(whichUnit, targetUnit)
			else
				call O9A(whichUnit, targetUnit)
			endif
			call UnitDamageTargetEx(whichUnit, targetUnit, 1, 50 + 100 * level)
			if GetUnitAbilityLevel(targetUnit,'A3E9') == 1 and UnitIsDead(targetUnit) == false and UnitIsDead(whichUnit) == false then
				call SaveUnitHandle(OtherHashTable2,'A3E9', 0, targetUnit)
				call SaveUnitHandle(OtherHashTable2,'A3E9', 1, whichUnit)
				call SaveInteger(OtherHashTable2,'A3E9', 0, LoadInteger(HY, h, 4))
				call SaveInteger(OtherHashTable2,'A3E9', 0, level)
				call ExecuteFunc("RRA")
			endif
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function RIA takes unit whichUnit, unit targetUnit, integer T0V, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local boolean b = T0V =='A1D8'
	call UnitAddPermanentAbility(targetUnit,'A314')
	call GHX(targetUnit, whichUnit,'A314')
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY, h, 4, T0V)
	call SaveBoolean(HY, h, 0, b)
	call SaveReal(HY, h, 23,((GetUnitX(targetUnit))* 1.))
	call SaveReal(HY, h, 24,((GetUnitY(targetUnit))* 1.))
	call TriggerRegisterTimerEvent(t, .01, true)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function RXA))
	if b then
		call UnitAddPermanentAbility(whichUnit,'A179')
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A179', false)
	endif
	set t = null
endfunction
function AZE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local integer T0V = GetSpellAbilityId()
	local integer level = GetUnitAbilityLevel(whichUnit, T0V)
	if GetUnitAbilityLevel(whichUnit,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(whichUnit), 0) then
		set whichUnit = LoadUnitHandle(HY, GetHandleId(whichUnit), 0)
	endif
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call RIA(whichUnit, GetSpellTargetUnit(), T0V, level)
	endif
	set whichUnit = null
endfunction
function RRA takes nothing returns nothing
	local unit targetUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 1)
	call T4V(LoadUnitHandle(OtherHashTable2,'A3E9', 0))
	if UnitHasSpellShield(targetUnit) == false then
		call RIA(LoadUnitHandle(OtherHashTable2,'A3E9', 0), targetUnit, LoadInteger(OtherHashTable2,'A3E9', 0), LoadInteger(OtherHashTable2,'A3E9', 1))
	else
		call UnitRemoveSpellShield(targetUnit)
	endif
	set targetUnit = null
	call FlushChildHashtable(OtherHashTable2,'A3E9')
endfunction
function RAA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real RNA =(LoadReal(HY, h, 295))
	local real RBA =(LoadReal(HY, h, 296))
	local integer level = LoadInteger(HY, h, 2)
	local real RCA = .25
	if GetSpellTargetUnit() == whichUnit then
		call EPX(whichUnit,'AFRZ', .03)
		call SetWidgetLife(whichUnit, RMaxBJ(GetUnitState(whichUnit, UNIT_STATE_MAX_LIFE)* RBA * .01, GetUnitState(whichUnit, UNIT_STATE_MAX_LIFE)* RCA))
	endif
	if GetSpellTargetUnit() == targetUnit and GetWidgetLife(targetUnit)> .5 then
		call EPX(targetUnit,'AFRZ', .03)
		call SetUnitLifePercentBJ(targetUnit, RNA)
		if GetUnitLifePercent(targetUnit)< 25 then
			call SetUnitLifePercentBJ(targetUnit, 25.)
		endif
	endif
	if GetTriggerEvalCount(t) == 2 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function RDA takes nothing returns boolean
	if GetSpellAbilityId()=='A07R' then
		call RAA()
	endif
	return false
endfunction
function RFA takes unit whichUnit, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = GetSpellTargetUnit()
	local unit dummyCaster
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveInteger(HY, h, 2, level)
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveReal(HY, h, 295,((GetUnitLifePercent(whichUnit))* 1.))
	call SaveReal(HY, h, 296,((GetUnitLifePercent(targetUnit))* 1.))
	call TriggerAddCondition(t, Condition(function RDA))
	set dummyCaster = CreateUnit(GetOwningPlayer(targetUnit),'e00Y', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call TriggerRegisterUnitEvent(t, dummyCaster, EVENT_UNIT_SPELL_EFFECT)
	call UnitAddPermanentAbility(dummyCaster,'A07R')
	call IssueTargetOrderById(dummyCaster, 852095, whichUnit)
	call ShowUnit(dummyCaster, false)
	call SetUnitPathing(dummyCaster, false)
	call SetUnitInvulnerable(dummyCaster, true)
	call UnitApplyTimedLife(dummyCaster,'BTLF', .2)
	set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00Y', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	call TriggerRegisterUnitEvent(t, dummyCaster, EVENT_UNIT_SPELL_EFFECT)
	call UnitAddPermanentAbility(dummyCaster,'A07R')
	call IssueTargetOrderById(dummyCaster, 852095, targetUnit)
	call ShowUnit(dummyCaster, false)
	call SetUnitPathing(dummyCaster, false)
	call SetUnitInvulnerable(dummyCaster, true)
	call UnitApplyTimedLife(dummyCaster,'BTLF', .2)
	set t = null
	set targetUnit = null
	set dummyCaster = null
endfunction

function MJN takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit DKO =(LoadUnitHandle(HY, h, 2))
	local unit UBT =(LoadUnitHandle(HY, h, 17))
	local real MKN = GetUnitLifePercent(DKO)
	local real MLN = GetUnitLifePercent(UBT)
	local integer facing = LoadInteger(HY, h, 5)
	local real FAR = 0.25
	//call H9O(DKO,'AFRZ',0.12)
	//call H9O(UBT,'AFRZ',0.12)
	call SetWidgetLife(DKO, RMaxBJ(GetUnitState(DKO, UNIT_STATE_MAX_LIFE)* MLN * 0.01, GetUnitState(DKO, UNIT_STATE_MAX_LIFE)* FAR))
	call SetUnitLifePercentBJ(UBT, MKN)
	if GetUnitLifePercent(UBT)< 25. and GetWidgetLife(UBT)> 1 then
		call SetUnitLifePercentBJ(UBT, 25.)
	endif
	call FlushChildHashtable(HY, h)
	set DKO = null
	set UBT = null
	set t = null
endfunction

function ATG takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(u,'A07Q'))
	call SaveUnitHandle(HY, h, 17, GetSpellTargetUnit())
	if GetUnitTypeId(u)=='e00E' then
		set u = LoadUnitHandle(HY, GetHandleId(u), 0)
	endif
	call SaveUnitHandle(HY, h, 2,(u))
	call TimerStart(t, 0., false, function MJN)
	set t = null
	set u = null
endfunction

function ATB takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) or IsUnitAlly(GetTriggerUnit(), GetOwningPlayer(GetSpellTargetUnit())) then
		call ATG()
	endif
endfunction

function A_E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())
	if GetUnitAbilityLevel(whichUnit,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(whichUnit), 0) then
		set whichUnit = LoadUnitHandle(HY, GetHandleId(whichUnit), 0)
	endif
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call RFA(whichUnit, level)
	endif
	set whichUnit = null
endfunction
function RGA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local unit d = LoadUnitHandle(ObjectHashTable, WFV, 0)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 1)
	if UnitIsDead(u) or UnitIsDead(d) then
		call DestroyEffect(LoadEffectHandle(ObjectHashTable, WFV, 2))
		call KillUnit(d)
		call DestroyTimerAndFlushHT_P(t)
	endif
	call IssueTargetOrderById(d, 851983, u)
	set d = null
	set u = null
	set t = null
endfunction
function S2E takes nothing returns nothing
	local integer DSR = GetHandleId(GetTriggerUnit())
	local unit d = GetSummonedUnit()
	local unit u = LoadUnitHandle(ObjectHashTable, DSR, 0)
	local timer t = LoadTimerHandle(ObjectHashTable, DSR, 1)
	local integer WFV = GetHandleId(t)
	call SetUnitMoveSpeed(d, 522)
	call UnitAddAbility(d,'Aloc')
	call SetUnitOwner(d, LoadPlayerHandle(ObjectHashTable, DSR, 2), false)
	call IssueTargetOrderById(d, 851983, u)
	call SetUnitX(d, GetWidgetX(u)+ 100 * Cos(GetRandomReal(-1.8, 1.8)))
	call SetUnitY(d, GetWidgetY(u)+ 100 * Sin(GetRandomReal(-1.8, 1.8)))
	call SaveUnitHandle(ObjectHashTable, WFV, 0, d)
	call SaveUnitHandle(ObjectHashTable, WFV, 1, u)
	call SaveEffectHandle(ObjectHashTable, WFV, 2, AddSpecialEffectTarget("war3mapImported\\UnholyPresence.mdx", u, "overhead"))
	call TimerStart(t, .2, true, function RGA)
	call FlushChildHashtable(ObjectHashTable, DSR)
	set t = null
	set u = null
	set d = null
endfunction
function RHA takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()) and IsUnitMagicImmune(GetFilterUnit()) == false and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)))!= null
endfunction
function YAV takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit u
	local integer level = GetUnitAbilityLevel(whichUnit,'A2KZ')
	local unit d
	local trigger t
	local integer h
	local group g = AllocationGroup(398)
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 925, Condition(function RHA))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call UnitAddAbilityToTimed(u,'A26T', 1, 1.5 + level,'B0EJ')
		set d = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
		call SaveInteger(ObjectHashTable, GetHandleId(d),'SPEL','A24K')
		call SaveUnitHandle(ObjectHashTable, GetHandleId(d), 0, u)
		call SaveTimerHandle(ObjectHashTable, GetHandleId(d), 1, CreateTimer())
		call SavePlayerHandle(ObjectHashTable, GetHandleId(d), 2, GetOwningPlayer(whichUnit))
		call UnitAddPermanentAbility(d,'A24K')
		call SetUnitAbilityLevel(d,'A24K', level)
		call SaveUnitHandle(HY, GetHandleId(d),'0ILU', u)
		call TriggerRegisterUnitEvent(UnitEventMainTrig, d, EVENT_UNIT_SUMMON)
		call U1V(d, 852274, u)
		set d = null
		call GroupRemoveUnit(g, u)
	endloop
	call DeallocateGroup(g)
	call A5X(EX, GetUnitX(whichUnit), GetUnitY(whichUnit))
	set whichUnit = null
	set u = null
	set d = null
	set t = null
	set whichUnit = null
endfunction
function RJA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local unit d =(LoadUnitHandle(HY, h, 19))
	local integer level =(LoadInteger(HY, h, 5))
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetTriggerEvalCount(t)> 28or IsUnitSilence(whichUnit) or GetUnitDistanceEx(whichUnit, targetUnit)> 600 or UnitVisibleToPlayer(targetUnit, GetOwningPlayer(whichUnit)) == false then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(d)
	elseif GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
		if GetTriggerEvalCount(t)> 1 and GetSpellAbilityId()=='A1RA' then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call UnitRemoveAbility(whichUnit,'A1RA')
			call KillUnit(d)
		endif
	else
		if IsUnitEnemy(whichUnit, GetOwningPlayer(targetUnit)) then
			call SetWidgetLife(whichUnit, GetWidgetLife(whichUnit)+ level * 25. / 4.)
		else
			call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+ level * 25. / 4.)
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set d = null
	return false
endfunction
function RKA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local unit d =(LoadUnitHandle(HY, h, 19))
	local boolean b = HaveSavedHandle(HY, h, 21)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call UnitRemoveAbility(whichUnit,'A1RA')
		if b then
			call RemoveUnit(LoadUnitHandle(HY, h, 21))
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if GetTriggerEvalCount(t) == 1 then
			call IssueImmediateOrderById(whichUnit, 851993)
		endif
		if IsUnitEnemy(whichUnit, GetOwningPlayer(targetUnit)) then
			call SetUnitX(d, GetUnitX(whichUnit))
			call SetUnitY(d, GetUnitY(whichUnit))
			call SetUnitX(LoadUnitHandle(HY, h, 21), GetUnitX(targetUnit))
			call SetUnitY(LoadUnitHandle(HY, h, 21), GetUnitY(targetUnit))
		else
			call SetUnitX(d, GetUnitX(targetUnit))
			call SetUnitY(d, GetUnitY(targetUnit))
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set d = null
	return false
endfunction
function RLA takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A1PH')
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit d
	if GetUnitTypeId(whichUnit)=='e00E' then
		if HaveSavedHandle(HY, GetHandleId(whichUnit), 0) then
			set whichUnit = LoadUnitHandle(HY, GetHandleId(whichUnit), 0)
		else
			set whichUnit = Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))]
		endif
	endif
	if IsUnitEnemy(whichUnit, GetOwningPlayer(targetUnit)) then
		set d = CreateUnit(GetOwningPlayer(whichUnit),'u01G', 0, 0, 0)
		call UnitAddAbility(d,'A04L')
		call SetUnitAbilityLevel(d,'A04L', level)
		call SetUnitX(d, GetUnitX(whichUnit))
		call SetUnitY(d, GetUnitY(whichUnit))
		call IssueTargetOrderById(d, 852487, targetUnit)
	else
		call UnitAddPermanentAbility(whichUnit,'A1RA')
		set d = CreateUnit(NeutralCreepPlayer,'u01G', 0, 0, 0)
		call SetUnitUserData(d, GetPlayerId(GetOwningPlayer(whichUnit)))
		call UnitAddAbility(d,'A04L')
		call SetUnitAbilityLevel(d,'A04L', level)
		call SetUnitX(d, GetUnitX(targetUnit))
		call SetUnitY(d, GetUnitY(targetUnit))
		call U1V(d, 852487, whichUnit)
	endif
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function RJA))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveUnitHandle(HY, h, 19,(d))
	call SaveInteger(HY, h, 5,(level))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .01, true)
	call TriggerRegisterDeathEvent(t, d)
	call TriggerAddCondition(t, Condition(function RKA))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveUnitHandle(HY, h, 19,(d))
	if IsUnitEnemy(targetUnit, GetOwningPlayer(whichUnit)) then
		call SaveUnitHandle(HY, h, 21, CreateUnit(GetOwningPlayer(whichUnit),'hBST', GetUnitX(targetUnit), GetUnitY(targetUnit), 0))
	endif
	set whichUnit = null
	set targetUnit = null
	set t = null
	set d = null
endfunction
function DRE takes nothing returns boolean
	if GetUnitTypeId(GetSpellTargetUnit())!='n00L' and(IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) or(not UnitHasSpellShield(GetSpellTargetUnit()))) then
		call RLA()
	endif
	return false
endfunction
function A1E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer lv = GetUnitAbilityLevel(u,'A0H4')
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	if GetUnitTypeId(u)=='e00E' then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
	call UnitAddAbility(d,'A2JN')
	call SetUnitAbilityLevel(d,'A2JN', lv)
	call IssueTargetOrderById(d, 852274, u)
	set d = null
	set u = null
endfunction
function Q5E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A0H4')
	local integer id ='A275'+ level
	if level == 1 then
		call UnitAddPermanentAbility(u,'A33N')
	else
		call SetUnitAbilityLevel(u,'A33N', level)
		call UnitRemoveAbility(u, id -1)
	endif
	call UnitAddPermanentAbility(u, id)
	set u = null
endfunction

function RPA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = GetEventDamageSource()
	local real d = GetEventDamage()
	local real RQA = LoadReal(HY, h, 412)
	local real time = LoadReal(HY, h, 411)
	local integer level = GetUnitAbilityLevel(whichUnit,'A04E')
	if XFX(GetOwningPlayer(targetUnit)) and GetUnitAbilityLevel(whichUnit,'A36D') == 0 then
		if (time + 6)<(GetGameTime()) then
			set RQA = 0
		endif
		set time = GetGameTime()
		set RQA = RQA + d
		if RQA > 400 then
			set RQA = 0
			call GBX(whichUnit)
			call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl", whichUnit, "origin"))
		endif
		call SaveReal(HY, h, 412, RQA)
		call SaveReal(HY, h, 411, time)
	endif
	if AD > 0 and(GX == 2 or GX == 3) then
		call SetUnitToReduceDamage(whichUnit, RMinBJ(12. * level, GetEventDamage()))
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function MDE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function RPA))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveReal(HY, h, 412, .0)
	call SaveReal(HY, h, 411, GetGameTime())
	set t = null
	set whichUnit = null
endfunction
function RSA takes unit u, unit t returns nothing
	local integer level = GetUnitAbilityLevel(t,'A04E')*(1 -GetUnitAbilityLevel(t,'A36D'))
	// debug call SingleDebug(I2S(level))
	if level == 0 then
		call UnitRemoveAbility(u,'A3LB')
	else
		call UnitAddAbilityToTimed(u,'A3LB', level, 2, 0)
	endif
endfunction
function RTA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call DeallocateGroup(LoadGroupHandle(HY, h, 22))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function RUA takes group g returns nothing
	local trigger t = CreateTrigger()
	call SaveGroupHandle(HY, GetHandleId(t), 22,(g))
	call TriggerRegisterTimerEvent(t, 10, false)
	call TriggerAddCondition(t, Condition(function RTA))
	set t = null
endfunction
function NNE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer i = 1
	local real x1 = GetUnitX(u)
	local real y1 = GetUnitY(u)
	local real x2
	local real y2
	local real damage
	local real dur
	local integer lv = GetUnitAbilityLevel(u,'A29I')
	local group g = AllocationGroup(399)
	local real r = 725 + lv * 100
	if lv == 1 then
		set dur = 1.5
		set damage = 200
	elseif lv == 2 then
		set dur = 1.8
		set damage = 290
	elseif lv == 3 then
		set dur = 2.25
		set damage = 380
	endif
	loop
	exitwhen i > 16
		set x2 = x1 + r * Cos(22.5 * i * bj_DEGTORAD)
		set y2 = y1 + r * Sin(22.5 * i * bj_DEGTORAD)
		call UnitSpellEffectImpale(u, null, damage, dur, .52, x1, y1, x2, y2, 250, g, false, 775)
		set i = i + 1
	endloop
	call RUA(g)
	set u = null
	set g = null
endfunction
function NCE takes nothing returns nothing
	local group g = AllocationGroup(400)
	local unit u = GetTriggerUnit()
	local integer lv = GetUnitAbilityLevel(u,'A226')
	local real dmg = 50 * lv + 25
	local unit fu
	if GetUnitTypeId(u)=='e00E' then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
	set U2 = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 500, Condition(function DHX))
	loop
		set fu = FirstOfGroup(g)
	exitwhen fu == null
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\CrushingWave\\CrushingWaveDamage.mdl", fu, "chest"))
		call UnitDamageTargetEx(u, fu, 2, dmg)
		call UnitAddAbilityToTimed(fu,'A228', 1, 6,'B0E8')
		call UnitMakeAbilityPermanent(fu, true,'A227')
		call GroupRemoveUnit(g, fu)
	endloop
	call DeallocateGroup(g)
	set g = null
	set fu = null
	set u = null
endfunction
function RWA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call SetUnitTimeScale(whichUnit, 1)
	set t = null
	set whichUnit = null
	return false
endfunction
function K9E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	call TriggerRegisterTimerEvent(t, .3, false)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerAddCondition(t, Condition(function RWA))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SetUnitTimeScale(whichUnit, 2)
	set t = null
	set whichUnit = null
endfunction
function RYA takes nothing returns boolean
	return((IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GW)) and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0))
endfunction
function RZA takes nothing returns nothing
	call UnitDamageTargetEx(I_X(GW), GetEnumUnit(), 2, JW)
endfunction
function R_A takes unit whichUnit, unit targetUnit, real IXX returns nothing
	local group g = AllocationGroup(401)
	set GW = whichUnit
	set JW = IXX
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 210, Condition(function RYA))
	call ForGroup(g, function RZA)
	call DeallocateGroup(g)
	set g = null
endfunction
function R0A takes nothing returns boolean
	return((IsUnitInGroup(GetFilterUnit(), LW) == false and IsUnitAlly(GetFilterUnit(), GetOwningPlayer(GW)) and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and UnitIsDead(GetFilterUnit()) == false and GetFilterUnit()!= MUV))
endfunction
function R1A takes group R2A, unit R3A, unit whichUnit, unit OriginalTargetreturns returns unit
	local group g = AllocationGroup(402)
	local unit R4A = null
	local unit u
	set LW = R2A
	set GW = whichUnit
	call GroupEnumUnitsInRange(g, GetUnitX(R3A), GetUnitY(R3A), 500, Condition(function R0A))
	set u = FirstOfGroup(g)
	set R4A = u
	loop
	exitwhen u == null
		if GetWidgetLife(u)!= GetUnitState(u, UNIT_STATE_MAX_LIFE) then
			if u != whichUnit and IsUnitType(u, UNIT_TYPE_HERO) and IsUnitType(R4A, UNIT_TYPE_HERO) == false then
				set R4A = u
			elseif u != whichUnit and GetWidgetLife(u)< GetWidgetLife(R4A) and IsUnitType(u, UNIT_TYPE_HERO) and IsUnitType(R4A, UNIT_TYPE_HERO) then
				set R4A = u
			elseif u != whichUnit and IsUnitType(R4A, UNIT_TYPE_HERO) == false and GetWidgetLife(u)< GetWidgetLife(R4A) then
				set R4A = u
			elseif u == whichUnit then
				set R4A = u
			endif
		endif
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call DeallocateGroup(g)
	set g = null
	set u = null
	set Q5V = R4A
	set R4A = null
	return Q5V
endfunction
function NFE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local string R5A = "Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCaster.mdl"
	local string R6A = "origin"
	local unit array R7A
	local integer x
	local integer i = 1
	local integer level = GetUnitAbilityLevel(trigUnit,'A0OR')
	local real IXX = 60 + level * 20
	local group R8A = AllocationGroup(403)
	local integer WOV = level + 2
	local boolean R9A = false
	set MUV = trigUnit
	call SetWidgetLife(trigUnit, GetWidgetLife(trigUnit)+ IXX)
	call R_A(trigUnit, trigUnit, IXX)
	call GroupAddUnit(R8A, trigUnit)
	call ARX(R5A, trigUnit, R6A, 2)
	if targetUnit == trigUnit then
		set R7A[i]= R1A(R8A, trigUnit, trigUnit, targetUnit)
	else
		set R7A[i]= targetUnit
	endif
	if R7A[i]== null then
		call DeallocateGroup(R8A)
		set trigUnit = null
		set targetUnit = null
		return
	endif
	call SetWidgetLife(R7A[i], GetWidgetLife(R7A[i])+ IXX)
	call R_A(trigUnit, R7A[i], IXX)
	call GroupAddUnit(R8A, R7A[i])
	call ARX(R5A, R7A[i], R6A, 2)
	call ALX("SPLK", GetUnitX(trigUnit), GetUnitY(trigUnit), GetUnitX(R7A[i]), GetUnitY(R7A[i]), .3, .5, .9, 1, .7)
	set i = 2
	loop
	exitwhen i > WOV or R9A
		set R7A[i]= R1A(R8A, R7A[i -1], trigUnit, targetUnit)
		if R7A[i]== null then
			set R9A = true
		else
			call GroupAddUnit(R8A, R7A[i])
			call ARX(R5A, R7A[i], R6A, 2)
			call SetWidgetLife(R7A[i], GetWidgetLife(R7A[i])+ IXX)
			call R_A(trigUnit, R7A[i], IXX)
			call ALX("SPLK", GetUnitX(R7A[i -1]), GetUnitY(R7A[i -1]), GetUnitX(R7A[i]), GetUnitY(R7A[i]), .3, .5, .9, 1, .7)
			set i = i + 1
		endif
	endloop
	call DeallocateGroup(R8A)
	set R8A = null
	set trigUnit = null
	set targetUnit = null
endfunction
function IVA takes unit whichUnit, unit targetUnit, integer level returns nothing
	local unit dummyCaster = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddPermanentAbility(dummyCaster,'A0NJ')
	call SetUnitAbilityLevel(dummyCaster,'A0NJ', level)
	call IssueTargetOrderById(dummyCaster, 852075, targetUnit)
	call UnitRemoveAbility(dummyCaster,'A0NJ')
	set dummyCaster = null
endfunction
function IEA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 0)
	local integer c = GetTriggerEvalCount(t)
	local real IXX = 8 + 6 * level
	local unit dummyCaster = LoadUnitHandle(HY, h, 19)
	if GetUnitAbilityLevel(targetUnit,'A0OW') == 0 or c > 6 then
		call UnitRemoveAbility(targetUnit,'A0OW')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call UnitDamageTargetEx(dummyCaster, targetUnit, 2, IXX)
		if level == 1 then
			if c <= 3 then
				call IVA(whichUnit, targetUnit, 1)
			endif
		elseif level == 2 then
			if c <= 2 then
				call IVA(whichUnit, targetUnit, 1)
			elseif c == 3 then
				call IVA(whichUnit, targetUnit, 2)
			endif
		elseif level == 3 then
			if c <= 3 then
				call IVA(whichUnit, targetUnit, c)
			endif
		else
			if c < 3 then
				call IVA(whichUnit, targetUnit, c)
			elseif c == 3 then
				call CommonUnitAddStun(targetUnit, 1., false)
			endif
		endif
	endif
	set dummyCaster = null
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function IXA takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(U2),'e00E', GetUnitX(MissileHitTargetUnit), GetUnitY(MissileHitTargetUnit), 0)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function IEA))
	call SaveUnitHandle(HY, h, 2, U2)
	call SaveUnitHandle(HY, h, 17, MissileHitTargetUnit)
	call SaveUnitHandle(HY, h, 19, dummyCaster)
	call SaveInteger(HY, h, 0, LoadInteger(HY, GetHandleId(GetTriggeringTrigger()), 5))
	call UnitAddPermanentAbility(MissileHitTargetUnit,'A0OW')
	if GetUnitAbilityLevel(MissileHitTargetUnit,'A3E9') == 1 and LoadBoolean(HY, GetHandleId(GetTriggeringTrigger()), 0) == false and IsUnitMagicImmune(MissileHitTargetUnit) == false then
		call SaveUnitHandle(OtherHashTable2,'A3E9', 0, MissileHitTargetUnit)
		call SaveUnitHandle(OtherHashTable2,'A3E9', 1, U2)
		call SaveInteger(OtherHashTable2,'A3E9', 0, LoadInteger(HY, GetHandleId(GetTriggeringTrigger()), 5))
		call ExecuteFunc("IOA")
	endif
	call TriggerEvaluate(t)
	set dummyCaster = null
	set t = null
endfunction
function IRA takes unit whichUnit, unit targetUnit, integer level, boolean FAR returns nothing
	local trigger t = LaunchMissileByUnitDummy(whichUnit, targetUnit,'e00E', "IXA", 1300, true)
	call SaveInteger(HY, GetHandleId(t), 5, level)
	call SaveBoolean(HY, GetHandleId(t), 0, FAR)
	set t = null
endfunction
function NGE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A0NQ')
	if UnitHasSpellShield(targetUnit) == false then
		call IRA(whichUnit, targetUnit, level, false)
	endif
	set whichUnit = null
	set targetUnit = null
endfunction
function IOA takes nothing returns nothing
	local unit whichUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 0)
	local unit targetUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 1)
	local integer level = LoadInteger(OtherHashTable2,'A3E9', 0)
	call T4V(LoadUnitHandle(OtherHashTable2,'A3E9', 0))
	if UnitHasSpellShield(targetUnit) == false then
		call IRA(whichUnit, targetUnit, level, true)
	endif
	set whichUnit = null
	set targetUnit = null
endfunction
function PGX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A0NJ')
endfunction
function IIA takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local integer HCR = LoadInteger(OtherHashTable, GetHandleId(targetUnit), GetHandleId(GetTriggeringTrigger()))
	if IsUnitAlly(targetUnit, E3) == false then
		call UnitAddStateBonus(targetUnit, HCR, UNIT_BONUS_ARMOR)
	else
		call UnitReduceStateBonus(targetUnit, HCR, UNIT_BONUS_ARMOR)
	endif
	call SaveInteger(OtherHashTable, GetHandleId(targetUnit), GetHandleId(GetTriggeringTrigger()), 0)
	set targetUnit = null
endfunction
function IAA takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local integer HCR = R2I(Q2 * S2)
	local integer INA
	if Q2 > 0 then
		set INA = R2I((Q2 -1)* S2)
		if IsUnitAlly(targetUnit, E3) == false then
			call UnitAddStateBonus(targetUnit, INA, UNIT_BONUS_ARMOR)
		else
			call UnitReduceStateBonus(targetUnit, INA, UNIT_BONUS_ARMOR)
		endif
	endif
	if UnitIsDead(targetUnit) == false then
		if IsUnitAlly(targetUnit, E3) == false then
			call UnitReduceStateBonus(targetUnit, HCR, UNIT_BONUS_ARMOR)
			call SaveInteger(OtherHashTable, GetHandleId(targetUnit), GetHandleId(GetTriggeringTrigger()), HCR)
		else
			call UnitAddStateBonus(targetUnit, HCR, UNIT_BONUS_ARMOR)
			call SaveInteger(OtherHashTable, GetHandleId(targetUnit), GetHandleId(GetTriggeringTrigger()), HCR)
		endif
	endif
	set targetUnit = null
endfunction
function IBA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local group g =(LoadGroupHandle(HY, h, 22))
	local player p =(LoadPlayerHandle(HY, h, 54))
	local integer count = GetTriggerEvalCount(t)
	local integer N5O =(LoadInteger(HY, h, 188))
	local real HCR = LoadReal(HY, h, 0)
	set E3 = p
	set Q2 = count
	set S2 = HCR
	if count == N5O then
		call ForGroup(g, function IIA)
		call DeallocateGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call ForGroup(g, function IAA)
	endif
	set t = null
	set g = null
	set p = null
	return false
endfunction
function ICA takes nothing returns nothing
	call ARX("Abilities\\Weapons\\AvengerMissile\\AvengerMissile.mdl", GetEnumUnit(), "chest", 3)
	call ARX("Abilities\\Weapons\\AvengerMissile\\AvengerMissile.mdl", GetEnumUnit(), "chest", 3)
	call ARX("Abilities\\Weapons\\AvengerMissile\\AvengerMissile.mdl", GetEnumUnit(), "right hand", 3)
	call ARX("Abilities\\Weapons\\AvengerMissile\\AvengerMissile.mdl", GetEnumUnit(), "left hand", 3)
endfunction
function NJE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local group g = AllocationGroup(404)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(trigUnit,'A10Q')
	local integer N5O = 24
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'h007', x, y, 0)
	local integer a = 0
	local boolean KMR = false
	local real HCR = level * .25 + .5
	if level == 0 then
		set level = GetUnitAbilityLevel(trigUnit,'A1DB')
		set N5O = 20
		set KMR = true
		set HCR = level * .25 + 1.
	endif
	set Q2 = N5O
	set a = 255
	call SetUnitVertexColor(dummyCaster, 255, 255, 255, a)
	call UnitApplyTimedLife(dummyCaster,'BTLF', 5)
	if KMR then
		call GroupEnumUnitsInRange(g, x, y, 800, Condition(function FEX))
	else
		call GroupEnumUnitsInRange(g, x, y, 600, Condition(function FEX))
	endif
	call ForGroup(g, function ICA)
	call SaveGroupHandle(HY, h, 22,(g))
	call SavePlayerHandle(HY, h, 54,(GetOwningPlayer(trigUnit)))
	call SaveInteger(HY, h, 188,(N5O))
	call SaveReal(HY, h, 0, HCR)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function IBA))
	call TriggerEvaluate(t)
	set trigUnit = null
	set g = null
	set t = null
	set dummyCaster = null
endfunction
function IDA takes string ATX, unit targetUnit, unit trigUnit returns nothing
	local texttag tt = CreateTextTag()
	if GetHandleId(tt)> 0 then
		call SetTextTagText(tt, ATX, .033)
		call SetTextTagPosUnit(tt, targetUnit, 64)
		call SetTextTagColor(tt, 160, 0, 255, 255)
		call SetTextTagVelocity(tt, 0, .0355)
		call SetTextTagFadepoint(tt, .15)
		call SetTextTagPermanent(tt, false)
		call SetTextTagLifespan(tt, .65)
		call SetTextTagVisibility(tt, IsUnitAlly(trigUnit, LocalPlayer) or IsObserverPlayer(LocalPlayer))
	else
		call DestroyTextTag(tt)
	endif
	set tt = null
endfunction
function IFA takes real N5O returns string
	if N5O > 4.5 then
		return"5.0"
	elseif N5O > 4. then
		return"4.5"
	elseif N5O > 3.5 then
		return"4.0"
	elseif N5O > 3. then
		return"3.5"
	elseif N5O > 2.5 then
		return"3.0"
	elseif N5O > 2. then
		return"2.5"
	elseif N5O > 1.5 then
		return"2.0"
	elseif N5O > 1. then
		return"1.5"
	elseif N5O > .5 then
		return"1.0"
	elseif N5O > .0 then
		return"0.5"
	else
		return"0.0"
	endif
	return" "
endfunction
function IGA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer count = GetTriggerEvalCount(t)
	if count > 11 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call IDA(IFA(5.5 -0.5 * count), targetUnit, targetUnit)
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function IHA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real IXX =(LoadReal(HY, h, 20))
	local real IJA = RMaxBJ(GetWidgetLife(targetUnit)-IXX, 1)
	local real IKA =(LoadReal(HY,(GetHandleId(targetUnit)), 243))
	call SetWidgetLife(targetUnit, IJA)
	call SaveReal(HY,(GetHandleId(targetUnit)), 243,((IKA -IXX)* 1.))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set targetUnit = null
	return false
endfunction
function ILA takes unit targetUnit, real IXX returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real IKA =(LoadReal(HY,(GetHandleId(targetUnit)), 243))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveReal(HY, h, 20,((IXX)* 1.))
	call SaveReal(HY,(GetHandleId(targetUnit)), 243,((IKA + IXX)* 1.))
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function IHA))
	set t = null
endfunction
function IMA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit
	local real D0I
	local real IXX
	local integer count = GetTriggerEvalCount(t)
	local real IKA
	local real IPA =(LoadReal(HY, h, 389))
	local real IQA =(LoadReal(HY, h, 390))
	if IPA !=(GetGameTime()) then
		set IPA =(GetGameTime())
		set IQA = 0
		call SaveReal(HY, h, 389,((IPA)* 1.))
		call SaveReal(HY, h, 390,((IQA)* 1.))
	endif
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if FK then
			set targetUnit = GetTriggerUnit()
			set IKA =(LoadReal(HY,(GetHandleId(targetUnit)), 243))
			set D0I = GetWidgetLife(targetUnit)
			set IXX = GetEventDamage()
			if ((D0I -IKA -IQA)-IXX)< 1 then
				call SetWidgetLife(targetUnit, D0I + IXX + IQA)
				call ILA(targetUnit, IXX)
			else
				set IQA = IQA + IXX
				call SaveReal(HY, h, 390,((IQA)* 1.))
			endif
		endif
	else
		call SaveInteger(HY,(GetHandleId(((LoadUnitHandle(HY, h, 17))))),( 2485), 2)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call UnitRemoveAbility((LoadUnitHandle(HY, h, 17)),'A21I')
		call UnitRemoveAbility((LoadUnitHandle(HY, h, 17)),'B07D')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set targetUnit = null
	set t = null
	return false
endfunction
function NKE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	call UnitAddPermanentAbility(targetUnit,'A21I')
	call TriggerRegisterTimerEvent(t, 5, false)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function IMA))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\DarkHands.mdx", targetUnit, "overhead")))
	call SaveReal(HY,(GetHandleId(targetUnit)), 243,(0 * 1.))
	call SaveReal(HY, h, 389,(((GetGameTime()))* 1.))
	call SaveReal(HY, h, 390,(0 * 1.))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY,(GetHandleId((targetUnit))),( 2485), 1)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function IGA))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function ISA takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), DK) == false then
		set MWV = CreateUnit(GetOwningPlayer(U2),'e00E', GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()), 0)
		call UnitAddPermanentAbility(MWV,'A17N')
		call SetUnitAbilityLevel(MWV,'A17N', MYV)
		if IssueTargetOrderById(MWV, 852527, GetEnumUnit()) == false then
			call UnitShareVision(GetEnumUnit(), GetOwningPlayer(U2), true)
			call IssueTargetOrderById(MWV, 852527, GetEnumUnit())
			call UnitShareVision(GetEnumUnit(), GetOwningPlayer(U2), false)
		endif
		call GroupAddUnit(DK, GetEnumUnit())
		set MWV = null
	endif
endfunction
function ITA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local group g =(LoadGroupHandle(HY, h, 22))
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	local integer level =(LoadInteger(HY, h, 5))
	local real a =(LoadReal(HY, h, 13))
	local group T7R
	local real x
	local real y
	local real IUA
	local real IWA
	local real J0R = 30
	set MYV = level
	if GetTriggerEvalCount(t)> 28 then
		call DeallocateGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call ShowUnit(dummyCaster, false)
		call KillUnit(dummyCaster)
	else
		set x = GetUnitX(dummyCaster)
		set y = GetUnitY(dummyCaster)
		set T7R = AllocationGroup(405)
		set DK = g
		set U2 = dummyCaster
		set S2 = level * 70
		call GroupEnumUnitsInRange(T7R, x, y, 150, Condition(function DUX))
		call ForGroup(T7R, function ISA)
		call DeallocateGroup(T7R)
		set IUA = CoordinateX50(x + J0R * Cos(a * bj_DEGTORAD))
		set IWA = CoordinateY50(y + J0R * Sin(a * bj_DEGTORAD))
		call SetUnitX(dummyCaster, IUA)
		call SetUnitY(dummyCaster, IWA)
	endif
	set t = null
	set g = null
	set T7R = null
	set dummyCaster = null
	return false
endfunction
function NLE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local group g = AllocationGroup(406)
	local unit trigUnit = GetTriggerUnit()
	local real x1 = GetUnitX(trigUnit)
	local real y1 = GetUnitY(trigUnit)
	local real x2 = GetSpellTargetX()
	local real y2 = GetSpellTargetY()
	local real a = AngleBetweenXY(x1, y1, x2, y2)
	local integer level = GetUnitAbilityLevel(trigUnit,'A173')
	local unit dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'h07K', x1, y1, a)
	call A5X(GE, x1, y1)
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	call SaveInteger(HY, h, 5,(level))
	call SaveGroupHandle(HY, h, 22,(g))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function ITA))
	set t = null
	set dummyCaster = null
	set g = null
	set trigUnit = null
endfunction
function IYA takes nothing returns nothing
	call ShowUnit(GetTriggerUnit(), false)
	call DestroyTrigger(GetTriggeringTrigger())
endfunction
function IZA takes nothing returns nothing
	local integer id = GetUnitTypeId(GetSummonedUnit())
	local integer level
	local trigger t
	local integer h
	local unit u
	if id =='o00T' or id =='o00U' or id =='o00V' or id =='o00W' then
		set u = GetSummonedUnit()
		set t = CreateTrigger()
		call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
		call TriggerAddCondition(t, Condition(function IYA))
		set t = null
		set level = id -'o00T'
		if level > 0 then
			call UnitAddPermanentAbility(u,'QVEN')
			call SetUnitAbilityLevel(u,'QVEN', level)
		endif
		if RectContainsUnit(XO, u) then
			call UnitAddAbility(u,'Aeth')
		endif
		if GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A0A8')> 0 then
			call UnitAddPermanentAbilitySetLevel(u,'A3JB', GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A0A8'))
		endif
		set u = null
	endif
endfunction
function M9X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function IZA))
	set t = null
	set XO = Rect( -1104,-7248, -1474,-6668)
endfunction
function I_A takes unit R8X, unit targetUnit, real damageValue returns nothing
	if GetWidgetLife(targetUnit)> damageValue then
		call UnitDamageTargetEx(R8X, targetUnit, 1, damageValue)
	else
		call UnitDamageTargetEx(R8X, targetUnit, 1, RMaxBJ(GetWidgetLife(targetUnit)-1, 0))
	endif
endfunction
function Veno_PoisonNova_Act takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit d
	local integer i = 1
	local real I3X
	local real x
	local real y
	local real dx
	local real dy
	local real SYV = LoadReal(HY, h, 0)
	if LoadInteger(HY, h, 0)> 50 * SYV then
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
		set t = null
		return
	endif
	loop
		set d = LoadUnitHandle(HY, h, i)
		set x = GetUnitX(d)
		set y = GetUnitY(d)
		set I3X = i * 20 * bj_DEGTORAD
		set dx = CoordinateX50(x + 10* Cos(I3X))
		set dy = CoordinateY50(y + 10* Sin(I3X))
		call SetUnitX(d, dx)
		call SetUnitY(d, dy)
		set i = i + 1
	exitwhen i > 18
	endloop
	call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 1)
	set d = null
	set t = null
endfunction
function I0A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit YTR
	local unit triggerUnit = LoadUnitHandle(HY, h, 2)
	local integer SYV = LoadInteger(HY, h, 0)
	local unit I1A
	if UnitIsDead(triggerUnit) or SYV < 1 or GetUnitAbilityLevel(triggerUnit,'A42O') == 0 then
		call RemoveSavedHandle(ObjectHashTable, GetHandleId(triggerUnit),'A0A6')
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
		call UnitRemoveAbility(triggerUnit,'A42O')
		call UnitRemoveAbility(triggerUnit,'B028')
	else
		set YTR = LoadUnitHandle(HY, h, 0)
		set I1A = LoadUnitHandle(HY, h, 1)
		if UnitIsDead(YTR) and YTR != I1A then
			set YTR = I1A
		endif
		call I_A(YTR, triggerUnit, LoadReal(HY, h, 0))
		call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)-1)
	endif
	set I1A = null
	set YTR = null
	set triggerUnit = null
	set t = null
endfunction
function I2AAA takes unit whichUnit, unit u, real damageValue, real SYV, boolean b returns nothing
	local timer t
	local integer h
	if HaveSavedHandle(ObjectHashTable, GetHandleId(u),'A0A6') then
		set t = LoadTimerHandle(ObjectHashTable, GetHandleId(u),'A0A6')
		set h = GetHandleId(t)
		call SaveInteger(HY, h, 0, R2I(SYV))
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, 1, true, function I0A)
		call SaveReal(HY, h, 0, damageValue)
		call SaveInteger(HY, h, 0, R2I(SYV))
		call SaveUnitHandle(HY, h, 0, whichUnit)
		call SaveUnitHandle(HY, h, 2, u)
		call SaveUnitHandle(HY, h, 1, Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))])
		call SaveTimerHandle(ObjectHashTable, GetHandleId(u),'A0A6', t)
		call UnitAddPermanentAbility(u,'A42O')
		if b and IsUnitType(u, UNIT_TYPE_HERO) then
			call CXR(u, SYV)
		endif
	endif
	set t = null
endfunction
function I3A takes nothing returns boolean
	return(IsAliveNotStrucNotWard(GetFilterUnit()) and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(U2)) and IsUnitInGroup(GetFilterUnit(), LB) == false and IsUnitType(GetFilterUnit(), UNIT_TYPE_MECHANICAL) == false)!= null
endfunction
function I4A takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local group g2 = LoadGroupHandle(HY, h, 1)
	local group g = AllocationGroup(407)
	local integer c = GetTriggerEvalCount(t)
	local unit u2
	if c > 23 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call DeallocateGroup(g2)
	else
		set U2 = u
		set LB = g2
		call GroupEnumUnitsInRange(g, LoadReal(HY, h, 1), LoadReal(HY, h, 2), 25 * c + 255, Condition(function I3A))
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			call GroupAddUnit(g2, u2)
			call I2AAA(u, u2, LoadReal(HY, h, 0), 16, LoadBoolean(HY, h, 0))
			call GroupRemoveUnit(g, u2)
		endloop
	endif
	call DeallocateGroup(g)
	set u = null
	set u2 = null
	set t = null
	set g = null
	set g2 = null
endfunction
function NPE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer lv = GetUnitAbilityLevel(u, GetSpellAbilityId())
	local boolean b = GetSpellAbilityId()=='A0A6'
	local real dmg
	local integer i = 1
	local unit d
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	loop
	exitwhen i > 18
		set d = CreateUnit(GetOwningPlayer(u),'e017', x, y, 0)
		call IssuePointOrderById(d, 851986, x + 675 * Cos(i * 20 * bj_DEGTORAD), y + 675 * Sin(i * 20 * bj_DEGTORAD))
		call UnitApplyTimedLife(d,'BTLF', 1.15)
		set i = i + 1
	endloop
	if b then
		set dmg = 35 + 25 * lv
	else
		set dmg = 5 + 25 * lv
	endif
	call SetUnitAnimation(u, "attack")
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function I4A))
	call SaveUnitHandle(HY, h, 0, u)
	call SaveGroupHandle(HY, h, 1, AllocationGroup(408))
	call SaveReal(HY, h, 0, dmg)
	call SaveReal(HY, h, 1, x)
	call SaveReal(HY, h, 2, y)
	call SaveBoolean(HY, h, 0, b)
	set t = null
	set u = null
	set d = null
endfunction
function I5A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	call UnitReduceStateBonus(LoadUnitHandle(ObjectHashTable, WFV, 0), LoadInteger(ObjectHashTable, WFV, 0), UNIT_BONUS_DAMAGE)
	call SaveBoolean(ObjectHashTable, LoadInteger(ObjectHashTable, WFV, 1),'A1A3', false)
	call DestroyTimerAndFlushHT_P(t)
	set t = null
endfunction
function I6A takes unit u, unit d, integer WUV returns nothing
	local timer t = CreateTimer()
	local integer WFV = GetHandleId(t)
	local integer O3O = 0
	local real dr = 2.5 * WUV
	local real r = 100 * GetWidgetLife(d)/ GetUnitState(d, UNIT_STATE_MAX_LIFE)
	if r > 80 then
	elseif r > 60 then
		set dr = dr * 2
	elseif r > 40 then
		set dr = dr * 4
	elseif r > 20 then
		set dr = dr * 8
	else
		set dr = dr * 16
	endif
	if IsUnitIdType(GetUnitTypeId(d), UNIT_TYPE_HERO) == false and IsUnitType(d, UNIT_TYPE_STRUCTURE) == false then
		set dr = dr / 2
	endif
	set O3O = R2I(dr)
	call UnitAddStateBonus(u, O3O, UNIT_BONUS_DAMAGE)
	call SaveUnitHandle(ObjectHashTable, WFV, 0, u)
	call SaveInteger(ObjectHashTable, WFV, 0, O3O)
	call SaveInteger(ObjectHashTable, WFV, 1, GetHandleId(u))
	call SaveBoolean(ObjectHashTable, GetHandleId(u),'A1A3', true)
	call TimerStart(t, .5, false, function I5A)
	set t = null
endfunction
function I7A takes unit R8X, unit targetUnit returns nothing
	local integer WUV = GetUnitAbilityLevel(R8X,'A1A3')*(1 -GetUnitAbilityLevel(R8X,'A36D'))
	if WUV == 0 or LoadBoolean(ObjectHashTable, GetHandleId(R8X),'A1A3') then
		return
	endif
	if IsUnitEnemy(R8X, GetOwningPlayer(targetUnit)) then
		call I6A(R8X, targetUnit, WUV)
	endif
endfunction
function I8A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 5)
	local real MSI = LoadReal(HY, GetHandleId(targetUnit), 684)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or MSI <(GetGameTime()) or IsUnitMagicImmune(targetUnit) then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SaveReal(HY, GetHandleId(targetUnit), 684, .0)
		call UnitRemoveAbility(targetUnit,'A23S')
		call UnitRemoveAbility(targetUnit,'A23P')
		call UnitRemoveAbility(targetUnit,'A23Q')
		call UnitRemoveAbility(targetUnit,'A23R')
		call UnitRemoveAbility(targetUnit,'B0EA')
	else
		set OB = true
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 5 + 5 * level)
		set OB = false
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function I9A takes nothing returns nothing
	local trigger t
	local integer h
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetEventDamageSource()
	local real MSI = LoadReal(HY, GetHandleId(targetUnit), 684)
	local integer level = GetUnitAbilityLevel(whichUnit,'A0MM')
	if MSI <=(GetGameTime()) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function I8A))
		call SaveUnitHandle(HY, h, 2, whichUnit)
		call SaveUnitHandle(HY, h, 17, targetUnit)
		call SaveInteger(HY, h, 5, level)
		if DVX(targetUnit) == false then
			if level == 1 then
				call UnitAddPermanentAbility(targetUnit,'A23S')
			elseif level == 2 then
				call UnitAddPermanentAbility(targetUnit,'A23P')
			elseif level == 3 then
				call UnitAddPermanentAbility(targetUnit,'A23Q')
			elseif level == 4 then
				call UnitAddPermanentAbility(targetUnit,'A23R')
			endif
		endif
	endif
	call SaveReal(HY, GetHandleId(targetUnit), 684, GetGameTime()+ 4)
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function AVA takes nothing returns boolean
	if GetUnitAbilityLevel(GetTriggerUnit(),'A0MM')> 0 and IsAliveNotStrucNotWard(GetEventDamageSource()) and IsUnitEnemy(GetEventDamageSource(), GetOwningPlayer(GetTriggerUnit())) and IsUnitMagicImmune(GetEventDamageSource()) == false and GetUnitDistanceEx(GetEventDamageSource(), GetTriggerUnit())<= 1400 then
		if GetUnitAbilityLevel(GetTriggerUnit(),'A36D') == 0 and OB == false then
			call I9A()
		endif
	endif
	return false
endfunction
function MFE takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function AVA))
	set t = null
endfunction
function AEA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit damageSource = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	if UnitIsDead(targetUnit) or GetUnitAbilityLevel(targetUnit,'B06D') == 0 then
		call RemoveSavedHandle(HY, LoadInteger(HY, h,-1),'A09V')
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	else
		call UnitDamageTargetEx(damageSource, targetUnit, 1, 8 + 6 * LoadInteger(HY, h, 0))
	endif
	set damageSource = null
	set targetUnit = null
	set t = null
endfunction
function AXA takes unit R8X, unit targetUnit returns nothing
	local timer t
	local integer h
	local integer hu = GetHandleId(targetUnit)
	if HaveSavedHandle(HY, hu,'A09V') then
		set t = LoadTimerHandle(HY, hu,'A09V')
		set h = GetHandleId(t)
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveTimerHandle(HY, hu,'A09V', t)
		call TimerStart(t, 1, true, function AEA)
		call SaveUnitHandle(HY, h, 0, R8X)
		call SaveUnitHandle(HY, h, 1, targetUnit)
		call SaveInteger(HY, h,-1, hu)
	endif
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(R8X,'A09V'))
	set t = null
endfunction
function NYE takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetUnitFacing(GetTriggerUnit()))
	call UnitAddAbility(d,'A3IF')
	call SetUnitAbilityLevel(d,'A3IF', GetUnitAbilityLevel(GetTriggerUnit(),'A080'))
	call UnitRemoveAbility(GetSpellTargetUnit(),'BEsh')
	call UnitRemoveAbility(GetSpellTargetUnit(),'B0AQ')
	call IssueTargetOrderById(d, 852527, GetSpellTargetUnit())
	set d = null
endfunction
function NQE takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetUnitFacing(GetTriggerUnit()))
	call UnitAddAbility(d,'A3IG')
	call SetUnitAbilityLevel(d,'A3IG', GetUnitAbilityLevel(GetTriggerUnit(),'A1UZ'))
	call UnitRemoveAbility(GetSpellTargetUnit(),'BEsh')
	call UnitRemoveAbility(GetSpellTargetUnit(),'B0AQ')
	call IssueTargetOrderById(d, 852527, GetSpellTargetUnit())
	set d = null
endfunction

function AOA takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A08X')
	call UnitAddAbilityToTimed(whichUnit,'A3KH', 1, 2 + level,'B3KH')
	set whichUnit = null
endfunction
function N_E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call AOA()
	endif
endfunction
function ARA takes unit whichUnit, integer level, integer AIA returns nothing
	call UnitRemoveAbility(whichUnit,'A1KR')
	call UnitRemoveAbility(whichUnit,'A1KS')
	call UnitRemoveAbility(whichUnit,'A1KQ')
	call UnitRemoveAbility(whichUnit,'A1KP')
	call UnitRemoveAbility(whichUnit,'A1K1')
	call UnitRemoveAbility(whichUnit,'A1KW')
	call UnitRemoveAbility(whichUnit,'A1KX')
	call UnitRemoveAbility(whichUnit,'A1KY')
	call UnitRemoveAbility(whichUnit,'A1L4')
	call UnitRemoveAbility(whichUnit,'A1L3')
	call UnitRemoveAbility(whichUnit,'A1L2')
	call UnitRemoveAbility(whichUnit,'A1L1')
	call UnitRemoveAbility(whichUnit,'A1L8')
	call UnitRemoveAbility(whichUnit,'A1L7')
	call UnitRemoveAbility(whichUnit,'A1L9')
	call UnitRemoveAbility(whichUnit,'A1LB')
	if level == 1 then
		if AIA == 1 then
			call UnitAddPermanentAbility(whichUnit,'A1KR')
		elseif AIA == 2 then
			call UnitAddPermanentAbility(whichUnit,'A1KS')
		elseif AIA == 3 then
			call UnitAddPermanentAbility(whichUnit,'A1KQ')
		elseif AIA == 4 then
			call UnitAddPermanentAbility(whichUnit,'A1KP')
		endif
	elseif level == 2 then
		if AIA == 1 then
			call UnitAddPermanentAbility(whichUnit,'A1K1')
		elseif AIA == 2 then
			call UnitAddPermanentAbility(whichUnit,'A1KW')
		elseif AIA == 3 then
			call UnitAddPermanentAbility(whichUnit,'A1KX')
		elseif AIA == 4 then
			call UnitAddPermanentAbility(whichUnit,'A1KY')
		endif
	elseif level == 3 then
		if AIA == 1 then
			call UnitAddPermanentAbility(whichUnit,'A1L4')
		elseif AIA == 2 then
			call UnitAddPermanentAbility(whichUnit,'A1L3')
		elseif AIA == 3 then
			call UnitAddPermanentAbility(whichUnit,'A1L2')
		elseif AIA == 4 then
			call UnitAddPermanentAbility(whichUnit,'A1L1')
		endif
	elseif level == 4 then
		if AIA == 1 then
			call UnitAddPermanentAbility(whichUnit,'A1L8')
		elseif AIA == 2 then
			call UnitAddPermanentAbility(whichUnit,'A1L7')
		elseif AIA == 3 then
			call UnitAddPermanentAbility(whichUnit,'A1L9')
		elseif AIA == 4 then
			call UnitAddPermanentAbility(whichUnit,'A1LB')
		endif
	endif
endfunction
function AAA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer ANA =(LoadInteger(HY, h, 426))
	local unit whichUnit =(LoadUnitHandle(HY,(ANA), 2))
	local integer AIA =(LoadInteger(HY,(ANA), 425))
	local integer level = GetUnitAbilityLevel(whichUnit,'A0VX')
	set AIA = IMinBJ(AIA + 1, 4)
	call SaveInteger(HY,(ANA), 425,(AIA))
	call ARA(whichUnit, level, AIA)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction
function ABA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer EKI = LoadInteger(HY, h, 426)
	local unit u = LoadUnitHandle(HY, EKI, 2)
	local integer AIA = LoadInteger(HY, EKI, 425)
	local integer level = GetUnitAbilityLevel(u,'A0VX')
	call ARA(u, level, AIA)
	call DestroyTrigger(t)
	call FlushChildHashtable(HY, h)
	set u = null
	set t = null
endfunction
function ACA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer AIA =(LoadInteger(HY, h, 425))
	local integer level = GetUnitAbilityLevel(GetTriggerUnit(),'A0VX')
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamage()> 2 and GetEventDamageSource()!= GetTriggerUnit() and XFX(GetOwningPlayer(GetEventDamageSource())) and FK then
			set AIA = IMaxBJ(AIA -1, 0)
			if GetUnitAbilityLevel(whichUnit,'A36D') == 1 then
				set AIA = 0
			endif
			call SaveInteger(HY, h, 425,(AIA))
			call ARA(whichUnit, level, AIA)
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call TriggerRegisterTimerEvent(t, 4, false)
			call TriggerAddCondition(t, Condition(function AAA))
			call SaveInteger(HY, h, 426,(GetHandleId(GetTriggeringTrigger())))
		endif
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .4, false)
		call TriggerAddCondition(t, Condition(function ABA))
		call SaveInteger(HY, h, 426, GetHandleId(GetTriggeringTrigger()))
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function P0E takes nothing returns nothing
	local trigger t
	local integer h
	local unit whichUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A0VX')
	if level == 1 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_DAMAGED)
		call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
		call TriggerAddCondition(t, Condition(function ACA))
		call SaveUnitHandle(HY, h, 2,(whichUnit))
		call SaveInteger(HY, h, 425, 4)
	endif
	call ARA(whichUnit, level, 4)
	set t = null
	set whichUnit = null
endfunction
function POX takes nothing returns nothing
	call SetAllPlayerAbilityUnavailable('A1KR')
	call SetAllPlayerAbilityUnavailable('A1KS')
	call SetAllPlayerAbilityUnavailable('A1KQ')
	call SetAllPlayerAbilityUnavailable('A1KP')
	call SetAllPlayerAbilityUnavailable('A1K1')
	call SetAllPlayerAbilityUnavailable('A1KW')
	call SetAllPlayerAbilityUnavailable('A1KX')
	call SetAllPlayerAbilityUnavailable('A1KY')
	call SetAllPlayerAbilityUnavailable('A1L4')
	call SetAllPlayerAbilityUnavailable('A1L3')
	call SetAllPlayerAbilityUnavailable('A1L2')
	call SetAllPlayerAbilityUnavailable('A1L1')
	call SetAllPlayerAbilityUnavailable('A1L8')
	call SetAllPlayerAbilityUnavailable('A1L7')
	call SetAllPlayerAbilityUnavailable('A1L9')
	call SetAllPlayerAbilityUnavailable('A1LB')
endfunction
function ADA takes nothing returns nothing
	local integer level
	local unit whichUnit = GetTriggerUnit()
	local unit dummyCaster
	if GetUnitTypeId(whichUnit)=='u017' or GetUnitTypeId(whichUnit)=='u019' or GetUnitTypeId(whichUnit)=='u018' or GetUnitTypeId(whichUnit)=='u01A' or GetUnitTypeId(whichUnit)=='u01B' or GetUnitTypeId(whichUnit)=='u01C' or GetUnitTypeId(whichUnit)=='u01U' or GetUnitTypeId(whichUnit)=='u01V' or GetUnitTypeId(whichUnit)=='u01W' then
		return
	endif
	set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	if GetUnitTypeId(whichUnit)=='u014' or GetUnitTypeId(whichUnit)=='u01D' or GetUnitTypeId(whichUnit)=='u01R' then
		set level = 1
	elseif GetUnitTypeId(whichUnit)=='u015' or GetUnitTypeId(whichUnit)=='u01E' or GetUnitTypeId(whichUnit)=='u01S' then
		set level = 2
	else
		set level = 3
	endif
	call UnitAddPermanentAbility(dummyCaster,'A1NF')
	call SetUnitAbilityLevel(dummyCaster,'A1NF', level)
	call IssueImmediateOrderById(dummyCaster, 852127)
	set whichUnit = null
	set dummyCaster = null
endfunction
function AFA takes unit AGA, integer Y2X, integer level returns nothing
	local integer AHA
	if level == 1 then
		set AHA = 8
	elseif level == 2 then
		set AHA = 14
	elseif level == 3 then
		set AHA = 22
	endif
	call J9X(AGA, Y2X * AHA)
endfunction
function AJA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit AGA =(LoadUnitHandle(HY, h, 2))
	local unit whichUnit = AGA
	local integer level =(LoadInteger(HY, h, 5))
	local integer S4R =(LoadInteger(HY, h, 28))
	local integer Y2X =(LoadInteger(HY, h, 194))
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_PLAYER_UNIT_ATTACKED then
		if GetAttacker() == AGA then
			set Y2X = IMaxBJ(Y2X -1, 0)
			call SaveInteger(HY, h, 194,(Y2X))
			call AFA(AGA, Y2X, level)
		endif
	else
		set S4R = S4R + 1
		call SaveInteger(HY, h, 28,(S4R))
		if ModuloInteger(S4R, 15) == 0 then
			set Y2X = IMinBJ(Y2X + 1, 7)
			call SaveInteger(HY, h, 194,(Y2X))
		endif
		if GetUnitTypeId(whichUnit)=='u017' or GetUnitTypeId(whichUnit)=='u019' or GetUnitTypeId(whichUnit)=='u018' or GetUnitTypeId(whichUnit)=='u01A' or GetUnitTypeId(whichUnit)=='u01B' or GetUnitTypeId(whichUnit)=='u01C' or GetUnitTypeId(whichUnit)=='u01U' or GetUnitTypeId(whichUnit)=='u01V' or GetUnitTypeId(whichUnit)=='u01W' then
			set Y2X = 7
			call SaveInteger(HY, h, 194,(Y2X))
		endif
		call AFA(AGA, Y2X, level)
		if GetUnitTypeId(AGA)=='u017' or GetUnitTypeId(AGA)=='u019' or GetUnitTypeId(AGA)=='u018' or GetUnitTypeId(AGA)=='u01A' or GetUnitTypeId(AGA)=='u01B' or GetUnitTypeId(AGA)=='u01C' or GetUnitTypeId(AGA)=='u01U' or GetUnitTypeId(AGA)=='u01V' or GetUnitTypeId(AGA)=='u01W' then
			call SetWidgetLife(AGA, GetWidgetLife(AGA)+ 31.25 + 18.75 * level)
		endif
	endif
	set t = null
	set AGA = null
	set whichUnit = null
	return false
endfunction
function AKA takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='u014' or GetUnitTypeId(GetFilterUnit())=='u015' or GetUnitTypeId(GetFilterUnit())=='u016' or GetUnitTypeId(GetFilterUnit())=='u01D' or GetUnitTypeId(GetFilterUnit())=='u01E' or GetUnitTypeId(GetFilterUnit())=='u01F' or GetUnitTypeId(GetFilterUnit())=='u01R' or GetUnitTypeId(GetFilterUnit())=='u01S' or GetUnitTypeId(GetFilterUnit())=='u01T' or GetUnitTypeId(GetFilterUnit())=='u017' or GetUnitTypeId(GetFilterUnit())=='u019' or GetUnitTypeId(GetFilterUnit())=='u018' or GetUnitTypeId(GetFilterUnit())=='u01A' or GetUnitTypeId(GetFilterUnit())=='u01B' or GetUnitTypeId(GetFilterUnit())=='u01C' or GetUnitTypeId(GetFilterUnit())=='u01U' or GetUnitTypeId(GetFilterUnit())=='u01V' or GetUnitTypeId(GetFilterUnit())=='u01W' then
		call KillUnit(GetFilterUnit())
	endif
	return false
endfunction
function N0E takes nothing returns nothing
	local group g = AllocationGroup(409)
	local unit whichUnit = GetTriggerUnit()
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local integer level = GetUnitAbilityLevel(whichUnit,'A1NE')
	local unit ALA
	local unit AMA
	local unit APA = null
	local trigger t
	local integer h
	local boolean FKI = false
	local integer i
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(whichUnit), Condition(function AKA))
	call DeallocateGroup(g)
	if level == 0 then
		set level = GetUnitAbilityLevel(whichUnit,'A2IG')
		set FKI = true
	endif
	if level == 1 then
		set ALA = CreateUnit(GetOwningPlayer(whichUnit),'u014', x + 75, y + 75, GetUnitFacing(whichUnit))
		set AMA = CreateUnit(GetOwningPlayer(whichUnit),'u01D', x -75, y -75, GetUnitFacing(whichUnit))
	elseif level == 2 then
		set ALA = CreateUnit(GetOwningPlayer(whichUnit),'u015', x + 75, y + 75, GetUnitFacing(whichUnit))
		set AMA = CreateUnit(GetOwningPlayer(whichUnit),'u01E', x -75, y -75, GetUnitFacing(whichUnit))
	elseif level == 3 then
		set ALA = CreateUnit(GetOwningPlayer(whichUnit),'u016', x + 75, y + 75, GetUnitFacing(whichUnit))
		set AMA = CreateUnit(GetOwningPlayer(whichUnit),'u01F', x -75, y -75, GetUnitFacing(whichUnit))
	endif
	set i = GetUnitAbilityLevel(whichUnit,'A0A8')
	call SelectUnitAddForPlayer(ALA, GetOwningPlayer(whichUnit))
	call SelectUnitAddForPlayer(AMA, GetOwningPlayer(whichUnit))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", ALA, "origin"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", AMA, "origin"))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterDeathEvent(t, ALA)
	call TriggerAddCondition(t, Condition(function AJA))
	call SaveUnitHandle(HY, h, 2,(ALA))
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY, h, 28, 0)
	call SaveInteger(HY, h, 194, 7)
	call AFA(ALA, 7, level)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterDeathEvent(t, AMA)
	call TriggerAddCondition(t, Condition(function AJA))
	call SaveUnitHandle(HY, h, 2,(AMA))
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY, h, 28, 0)
	call SaveInteger(HY, h, 194, 7)
	call AFA(AMA, 7, level)
	if FKI then
		if level == 1 then
			set APA = CreateUnit(GetOwningPlayer(whichUnit),'u01R', x + 75, y, GetUnitFacing(whichUnit))
		elseif level == 2 then
			set APA = CreateUnit(GetOwningPlayer(whichUnit),'u01S', x + 75, y, GetUnitFacing(whichUnit))
		elseif level == 3 then
			set APA = CreateUnit(GetOwningPlayer(whichUnit),'u01T', x + 75, y, GetUnitFacing(whichUnit))
		endif
		call SelectUnitAddForPlayer(APA, GetOwningPlayer(whichUnit))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", APA, "origin"))
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerRegisterDeathEvent(t, APA)
		call TriggerAddCondition(t, Condition(function AJA))
		call SaveUnitHandle(HY, h, 2,(APA))
		call SaveInteger(HY, h, 5,(level))
		call SaveInteger(HY, h, 28, 0)
		call SaveInteger(HY, h, 194, 7)
		call AFA(APA, 7, level)
	endif
	if i > 0 then
		call RGX(ALA, i)
		call RGX(AMA, i)
		call RGX(APA, i)
	endif
	set g = null
	set whichUnit = null
	set ALA = null
	set AMA = null
	set APA = null
	set t = null
endfunction
function AQA takes nothing returns boolean
	if GetSpellAbilityId()=='A1NB' or GetSpellAbilityId()=='A1NC' or GetSpellAbilityId()=='A1ND' or GetSpellAbilityId()=='A1NL' or GetSpellAbilityId()=='A1NM' or GetSpellAbilityId()=='A1NN' or GetSpellAbilityId()=='A2IZ' or GetSpellAbilityId()=='A2J0' or GetSpellAbilityId()=='A2J1' then
		call ADA()
	endif
	return false
endfunction
function PEX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function AQA))
	set t = null
endfunction
function ASA takes unit whichUnit, integer CHO, integer ATA returns nothing
	local string c1 = "|c0000cc00"
	local string c = "||"
	local string p = " "
	local string s = c1 + "|||r"
	local string JVX
	local texttag tt =(LoadTextTagHandle(HY,(GetHandleId(whichUnit)), 451))
	if CHO == 0 then
		set JVX = " "
	elseif ATA == 1 then
		if CHO == 0 then
			set JVX = c + p + c + p + c
		elseif CHO == 1 then
			set JVX = s + p + c + p + c
		elseif CHO == 2 then
			set JVX = s + p + s + p + c
		elseif CHO == 3 then
			set JVX = s + p + s + p + s
		endif
	elseif ATA == 2 then
		if CHO == 0 then
			set JVX = c + p + c + p + c + p + c
		elseif CHO == 1 then
			set JVX = s + p + c + p + c + p + c
		elseif CHO == 2 then
			set JVX = s + p + s + p + c + p + c
		elseif CHO == 3 then
			set JVX = s + p + s + p + s + p + c
		elseif CHO == 4 then
			set JVX = s + p + s + p + s + p + s
		endif
	elseif ATA == 3 then
		if CHO == 0 then
			set JVX = c + p + c + p + c + p + c + p + c
		elseif CHO == 1 then
			set JVX = s + p + c + p + c + p + c + p + c
		elseif CHO == 2 then
			set JVX = s + p + s + p + c + p + c + p + c
		elseif CHO == 3 then
			set JVX = s + p + s + p + s + p + c + p + c
		elseif CHO == 4 then
			set JVX = s + p + s + p + s + p + s + p + c
		elseif CHO == 5 then
			set JVX = s + p + s + p + s + p + s + p + s
		endif
	elseif ATA == 4 then
		if CHO == 0 then
			set JVX = c + p + c + p + c + p + c + p + c + p + c
		elseif CHO == 1 then
			set JVX = s + p + c + p + c + p + c + p + c + p + c
		elseif CHO == 2 then
			set JVX = s + p + s + p + c + p + c + p + c + p + c
		elseif CHO == 3 then
			set JVX = s + p + s + p + s + p + c + p + c + p + c
		elseif CHO == 4 then
			set JVX = s + p + s + p + s + p + s + p + c + p + c
		elseif CHO == 5 then
			set JVX = s + p + s + p + s + p + s + p + s + p + c
		elseif CHO == 6 then
			set JVX = s + p + s + p + s + p + s + p + s + p + s
		endif
	endif
	call SetTextTagText(tt, JVX, .023)
	call SetTextTagPosUnit(tt, whichUnit, 0)
	call SetTextTagVisibility(tt, GetOwningPlayer(whichUnit) == LocalPlayer and UnitIsDead(whichUnit) == false)
	call SetTextTagPermanent(tt, true)
	set tt = null
endfunction
function AUA takes unit trigUnit, integer level returns nothing
	local integer ATA = GetUnitAbilityLevel(trigUnit,'A1NA')
	call ASA(trigUnit, level, ATA)
	if level == 0 or((LoadInteger(HY,(GetHandleId((trigUnit))),( 2484))) == 1) then
		call UnitRemoveAbility(trigUnit,'A1O7')
		call UnitRemoveAbility(trigUnit,'A1O8')
		call UnitRemoveAbility(trigUnit,'A1O9')
		call UnitAddPermanentAbility(trigUnit,'A1O1')
		call UnitRemoveAbility(trigUnit,'A1O2')
		call UnitRemoveAbility(trigUnit,'A1NZ')
		call UnitRemoveAbility(trigUnit,'A1N9')
		call UnitRemoveAbility(trigUnit,'A1NY')
		call UnitRemoveAbility(trigUnit,'A1O0')
		call UnitRemoveAbility(trigUnit,'A1O3')
		call UnitRemoveAbility(trigUnit,'A0LR')
		call UnitRemoveAbility(trigUnit,'A0YP')
		call UnitRemoveAbility(trigUnit,'A0OG')
		call UnitRemoveAbility(trigUnit,'A0YO')
		call UnitRemoveAbility(trigUnit,'A0NF')
		call UnitRemoveAbility(trigUnit,'A0MD')
	elseif level == 1 then
		call UnitRemoveAbility(trigUnit,'A1O7')
		call UnitRemoveAbility(trigUnit,'A1O8')
		call UnitRemoveAbility(trigUnit,'A1O9')
		call UnitRemoveAbility(trigUnit,'A1O1')
		call UnitAddPermanentAbility(trigUnit,'A1O2')
		call UnitRemoveAbility(trigUnit,'A1NZ')
		call UnitRemoveAbility(trigUnit,'A1N9')
		call UnitRemoveAbility(trigUnit,'A1NY')
		call UnitRemoveAbility(trigUnit,'A1O0')
		call UnitRemoveAbility(trigUnit,'A1O3')
		call UnitAddPermanentAbility(trigUnit,'A0LR')
		call UnitRemoveAbility(trigUnit,'A0YP')
		call UnitRemoveAbility(trigUnit,'A0OG')
		call UnitRemoveAbility(trigUnit,'A0YO')
		call UnitRemoveAbility(trigUnit,'A0NF')
		call UnitRemoveAbility(trigUnit,'A0MD')
	elseif level == 2 then
		call UnitRemoveAbility(trigUnit,'A1O7')
		call UnitRemoveAbility(trigUnit,'A1O8')
		call UnitRemoveAbility(trigUnit,'A1O9')
		call UnitRemoveAbility(trigUnit,'A1O1')
		call UnitRemoveAbility(trigUnit,'A1O2')
		call UnitAddPermanentAbility(trigUnit,'A1NZ')
		call UnitRemoveAbility(trigUnit,'A1N9')
		call UnitRemoveAbility(trigUnit,'A1NY')
		call UnitRemoveAbility(trigUnit,'A1O0')
		call UnitRemoveAbility(trigUnit,'A1O3')
		call UnitRemoveAbility(trigUnit,'A0LR')
		call UnitAddPermanentAbility(trigUnit,'A0YP')
		call UnitRemoveAbility(trigUnit,'A0OG')
		call UnitRemoveAbility(trigUnit,'A0YO')
		call UnitRemoveAbility(trigUnit,'A0NF')
		call UnitRemoveAbility(trigUnit,'A0MD')
	elseif level == 3 then
		call UnitRemoveAbility(trigUnit,'A1O7')
		call UnitRemoveAbility(trigUnit,'A1O8')
		call UnitRemoveAbility(trigUnit,'A1O9')
		call UnitRemoveAbility(trigUnit,'A0LR')
		call UnitRemoveAbility(trigUnit,'A0YP')
		call UnitAddPermanentAbility(trigUnit,'A0OG')
		call UnitRemoveAbility(trigUnit,'A0YO')
		call UnitRemoveAbility(trigUnit,'A0NF')
		call UnitRemoveAbility(trigUnit,'A0MD')
		call UnitRemoveAbility(trigUnit,'A1O1')
		call UnitRemoveAbility(trigUnit,'A1O2')
		call UnitRemoveAbility(trigUnit,'A1NZ')
		call UnitRemoveAbility(trigUnit,'A1N9')
		call UnitRemoveAbility(trigUnit,'A1NY')
		call UnitRemoveAbility(trigUnit,'A1O0')
		call UnitRemoveAbility(trigUnit,'A1O3')
		if ATA == 1 then
			call UnitAddPermanentAbility(trigUnit,'A1O7')
		else
			call UnitAddPermanentAbility(trigUnit,'A1N9')
		endif
	elseif level == 4 then
		call UnitRemoveAbility(trigUnit,'A1O7')
		call UnitRemoveAbility(trigUnit,'A1O8')
		call UnitRemoveAbility(trigUnit,'A1O9')
		call UnitRemoveAbility(trigUnit,'A0LR')
		call UnitRemoveAbility(trigUnit,'A0YP')
		call UnitRemoveAbility(trigUnit,'A0OG')
		call UnitAddPermanentAbility(trigUnit,'A0YO')
		call UnitRemoveAbility(trigUnit,'A0NF')
		call UnitRemoveAbility(trigUnit,'A0MD')
		call UnitRemoveAbility(trigUnit,'A1O1')
		call UnitRemoveAbility(trigUnit,'A1O2')
		call UnitRemoveAbility(trigUnit,'A1NZ')
		call UnitRemoveAbility(trigUnit,'A1N9')
		call UnitRemoveAbility(trigUnit,'A1NY')
		call UnitRemoveAbility(trigUnit,'A1O0')
		call UnitRemoveAbility(trigUnit,'A1O3')
		if ATA == 2 then
			call UnitAddPermanentAbility(trigUnit,'A1O8')
		else
			call UnitAddPermanentAbility(trigUnit,'A1NY')
		endif
	elseif level == 5 then
		call UnitRemoveAbility(trigUnit,'A1O7')
		call UnitRemoveAbility(trigUnit,'A1O8')
		call UnitRemoveAbility(trigUnit,'A1O9')
		call UnitRemoveAbility(trigUnit,'A1O1')
		call UnitRemoveAbility(trigUnit,'A1O2')
		call UnitRemoveAbility(trigUnit,'A1NZ')
		call UnitRemoveAbility(trigUnit,'A1N9')
		call UnitRemoveAbility(trigUnit,'A1NY')
		call UnitAddPermanentAbility(trigUnit,'A1O0')
		call UnitRemoveAbility(trigUnit,'A1O3')
		call UnitRemoveAbility(trigUnit,'A0LR')
		call UnitRemoveAbility(trigUnit,'A0YP')
		call UnitRemoveAbility(trigUnit,'A0OG')
		call UnitRemoveAbility(trigUnit,'A0YO')
		call UnitAddPermanentAbility(trigUnit,'A0NF')
		call UnitRemoveAbility(trigUnit,'A0MD')
		call UnitRemoveAbility(trigUnit,'A1O1')
		call UnitRemoveAbility(trigUnit,'A1O2')
		call UnitRemoveAbility(trigUnit,'A1NZ')
		call UnitRemoveAbility(trigUnit,'A1N9')
		call UnitRemoveAbility(trigUnit,'A1NY')
		call UnitRemoveAbility(trigUnit,'A1O0')
		call UnitRemoveAbility(trigUnit,'A1O3')
		if ATA == 3 then
			call UnitAddPermanentAbility(trigUnit,'A1O9')
		else
			call UnitAddPermanentAbility(trigUnit,'A1O0')
		endif
	elseif level == 6 then
		call UnitRemoveAbility(trigUnit,'A1O7')
		call UnitRemoveAbility(trigUnit,'A1O8')
		call UnitRemoveAbility(trigUnit,'A1O9')
		call UnitRemoveAbility(trigUnit,'A1O1')
		call UnitRemoveAbility(trigUnit,'A1O2')
		call UnitRemoveAbility(trigUnit,'A1NZ')
		call UnitRemoveAbility(trigUnit,'A1N9')
		call UnitRemoveAbility(trigUnit,'A1NY')
		call UnitRemoveAbility(trigUnit,'A1O0')
		call UnitAddPermanentAbility(trigUnit,'A1O3')
		call UnitRemoveAbility(trigUnit,'A0LR')
		call UnitRemoveAbility(trigUnit,'A0YP')
		call UnitRemoveAbility(trigUnit,'A0OG')
		call UnitRemoveAbility(trigUnit,'A0YO')
		call UnitRemoveAbility(trigUnit,'A0NF')
		call UnitAddPermanentAbility(trigUnit,'A0MD')
	endif
	if (GetUnitAbilityLevel(trigUnit,'A1NA')+ 2) == level then
		call UnitAddPermanentAbility(trigUnit,'A1NJ')
	else
		call UnitRemoveAbility(trigUnit,'A1NJ')
	endif
endfunction
function AWA takes unit whichUnit, real IXX returns nothing
	local integer level = 0
	local real AYA = 110
	if IXX > AYA * 6 then
		set level = 6
	elseif IXX > AYA * 5 then
		set level = 5
	elseif IXX > AYA * 4 then
		set level = 4
	elseif IXX > AYA * 3 then
		set level = 3
	elseif IXX > AYA * 2 then
		set level = 2
	elseif IXX > AYA * 1 then
		set level = 1
	endif
	set level = IMinBJ(level, 2 + GetUnitAbilityLevel(whichUnit,'A1NA'))
	call SaveInteger(HY,(GetHandleId(whichUnit)), 450,(level))
	call AUA(whichUnit, level)
endfunction
function AZA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer ATA = GetUnitAbilityLevel(whichUnit,'A1NA')
	call ASA(whichUnit,(LoadInteger(HY,(GetHandleId((whichUnit))), 450)), ATA)
	call AWA(whichUnit,(LoadReal(HY,(GetHandleId(whichUnit)), 443)))
	set t = null
	set whichUnit = null
	return false
endfunction
function A_A takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit whichUnit = U2
	local unit targetUnit = MissileHitTargetUnit
	local real IXX =(LoadReal(HY, h, 20))
	set M_V = true
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, IXX)
	set M_V = false
	if LoadBoolean(HY, h, 20) == false and GetUnitAbilityLevel(targetUnit,'A3E9') == 1 and IsUnitMagicImmune(whichUnit) == false then
		call SaveUnitHandle(OtherHashTable2,'A3E9', 0, targetUnit)
		call SaveUnitHandle(OtherHashTable2,'A3E9', 1, whichUnit)
		call SaveInteger(OtherHashTable2,'A3E9', 0, LoadInteger(HY, h, 20))
		call ExecuteFunc("A0A")
	endif
	call FlushChildHashtable(HY, h)
	set whichUnit = null
	set targetUnit = null
endfunction
function A1A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	call AWA(whichUnit,(LoadReal(HY,(GetHandleId(whichUnit)), 443)))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction
function A2A takes unit whichUnit, unit targetUnit, integer level, boolean FAR returns nothing
	local trigger t = LaunchMissileByUnitDummy(whichUnit, targetUnit,'h0BE', "A_A", 1000, false)
	local integer h = GetHandleId(t)
	call SaveReal(HY, h, 20,((20 + level * 65)* 1.))
	call SaveInteger(HY, h, 20, level)
	call SaveBoolean(HY, h, 20, FAR)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AntiMagicShell\\AntiMagicShell.mdl", whichUnit, "chest"))
	call SaveReal(HY,(GetHandleId(whichUnit)), 443,(0 * 1.))
	call AWA(whichUnit, 0)
	call EPX(whichUnit, 2484, 4)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerAddCondition(t, Condition(function A1A))
	call TriggerRegisterTimerEvent(t, 4, false)
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	set t = null
endfunction
function N1E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call A2A(GetTriggerUnit(), GetSpellTargetUnit(), LoadInteger(HY, GetHandleId(GetTriggerUnit()), 450), false)
	endif
endfunction
function A0A takes nothing returns nothing
	local unit whichUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 0)
	local unit targetUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 1)
	local integer level = LoadInteger(OtherHashTable2,'A3E9', 0)
	call T4V(LoadUnitHandle(OtherHashTable2,'A3E9', 0))
	if UnitHasSpellShield(targetUnit) == false then
		call A2A(whichUnit, targetUnit, level, true)
	endif
	set whichUnit = null
	set targetUnit = null
	call FlushChildHashtable(OtherHashTable2,'A3E9')
endfunction


//function PXX takes nothing returns nothing
//	call MDO("SoulAssumptionDamagedEvent")
//endfunction
function A9A takes nothing returns boolean
	return((IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GW)) and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and GetWidgetLife(GetFilterUnit())> 1))
endfunction
function NVA takes unit targetUnit, integer level returns nothing
	local unit d = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local integer HNR
	local integer NEA
	local integer i
	if level > 12 then
		set level = 12
	elseif level < 1 then
		set level = 1
	endif
	set HNR ='A3HN'+(level -1)/ 4
	set NEA = ModuloInteger(level, 4)
	if NEA == 0 then
		set NEA = 4
	endif
	call UnitAddAbility(d, HNR)
	call SetUnitAbilityLevel(d, HNR, NEA)
	call IssueTargetOrderById(d, 852075, targetUnit)
	call EXPauseUnit( d, false )
	set d = null
endfunction
function NXA takes nothing returns nothing
	call NVA(GetEnumUnit(), HW)
endfunction
function NOA takes unit dummyCaster, unit trigUnit returns nothing
	local group g = AllocationGroup(410)
	set GW = trigUnit
	call GroupEnumUnitsInRange(g, GetUnitX(dummyCaster), GetUnitY(dummyCaster), 675, Condition(function A9A))
	call ForGroup(g, function NXA)
	call DeallocateGroup(g)
	set g = null
endfunction
function NRA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit
	local unit dummyCaster = LoadUnitHandle(HY, h, 19)
	//if GetTriggerEventId() == EVENT_UNIT_SPELL_ENDCAST then
	//call KillUnit(dummyCaster)
	//call FlushChildHashtable(HY, h)
	//call CleanCurrentTrigger(t)
	//elseif GetTriggerEvalCount(t)> 22 then
	if GetTriggerEvalCount(t)> 22 then
		call KillUnit(dummyCaster)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call EXStopUnit(LoadUnitHandle(HY, h, 14))
	else
		call SetUnitAnimation(dummyCaster, "birth")
		set trigUnit = LoadUnitHandle(HY, h, 14)
		set HW = GetTriggerExecCount(t)* LoadInteger(HY, h, 0)/ 2
		call NOA(dummyCaster, trigUnit)
	endif
	set t = null
	set dummyCaster = null
	set trigUnit = null
endfunction
function SpellEffect__Upheaval takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(trigUnit),'e01G', GetSpellTargetX(), GetSpellTargetY(), 0)
	//call TriggerRegisterUnitEvent(t, trigUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddAction(t, function NRA)
	call SaveUnitHandle(HY, h, 14, trigUnit)
	call SaveUnitHandle(HY, h, 19, dummyCaster)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(trigUnit, GetSpellAbilityId()))
	set trigUnit = null
	set dummyCaster = null
	set t = null
endfunction
function PCX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A0JE')
endfunction
function NIA takes nothing returns nothing
	call UnitAddPermanentAbility(GetEnumUnit(),('A0P2'))
endfunction
function NAA takes nothing returns nothing
	call UnitRemoveAbility(GetEnumUnit(),('A0P2'))
endfunction
function NNA takes unit NBA, unit NCA returns nothing
	if NBA != null and NCA != null then
		call ALX("CLPB", GetUnitX(NBA), GetUnitY(NBA), GetUnitX(NCA), GetUnitY(NCA), .7, .1, .9, 1, .3)
	endif
endfunction
function NDA takes nothing returns nothing
	local unit trigUnit =(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 14))
	local real IXX = .2 * GetEventDamage()
	set IXX = RMinBJ(IXX, GetWidgetLife(GetTriggerUnit()))
	if GetWidgetLife(GetEnumUnit())> 1 and GetEnumUnit()!= GetTriggerUnit() then
		if GetWidgetLife(GetEnumUnit())< IXX then
			call UnitDamageTargetEx(trigUnit, GetEnumUnit(), 3, IXX)
		else
			call B5X(GetEnumUnit(), IXX)
		endif
	endif
	set trigUnit = null
endfunction
function NFA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local group g =(LoadGroupHandle(HY, h, 220))
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED then
		call ForGroup(g, function NAA)
		call FlushChildHashtable(HY, h)
		call DeallocateGroup(g)
		call CleanCurrentTrigger((t))
	elseif GetEventDamage()> 10 and GetEventDamage()< 6000 and FK then
		call DisableTrigger(t)
		call ForGroup(g, function NDA)
		call EnableTrigger(t)
	endif
	set t = null
	set g = null
endfunction
function NGA takes nothing returns boolean
	return((IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit())) and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit())) and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false and GetUnitAbilityLevel(GetFilterUnit(),'A04R') == 0 and UnitIsDead(GetFilterUnit()) == false))
endfunction
function NHA takes nothing returns nothing
	set S2 = GetUnitDistanceEx(GetEnumUnit(), U2)
	if S2 < T2 then
		set T2 = S2
		set Q5V = GetEnumUnit()
	endif
endfunction
function N3E takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local group g = AllocationGroup(411)
	local integer level = GetUnitAbilityLevel(trigUnit,('A0J5'))
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer i = 2
	local group MLI = AllocationGroup(412)
	local unit array NJA
	local string FX = "Abilities\\Spells\\Undead\\Curse\\CurseTarget.mdl"
	if GetUnitAbilityLevel(trigUnit,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(trigUnit), 0) then
		set trigUnit = LoadUnitHandle(HY, GetHandleId(trigUnit), 0)
	endif
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call NNA(trigUnit, targetUnit)
	call ARX(FX, targetUnit, "overhead", 25)
	set NJA[1]= targetUnit
	call SaveUnitHandle(HY, h, 246,(NJA[1]))
	call TriggerRegisterUnitEvent(t, NJA[1], EVENT_UNIT_DAMAGED)
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 725, Condition(function NGA))
	call GroupRemoveUnit(g, targetUnit)
	call GroupAddUnit(MLI, targetUnit)
	call SaveGroupHandle(HY, h, 220,(MLI))
	set U2 = null
	loop
	exitwhen i >(1 + 2 * level) or FirstOfGroup(g) == null
		set T2 = 9999
		set U2 = NJA[i -1]
		set Q5V = null
		call ForGroup(g, function NHA)
		if Q5V != null then
			set NJA[i]= Q5V
			call NNA(NJA[i -1], NJA[i])
			call TriggerRegisterUnitEvent(t, NJA[i], EVENT_UNIT_DAMAGED)
			call GroupAddUnit(MLI, NJA[i])
			call GroupRemoveUnit(g, NJA[i])
			call ARX(FX, NJA[i], "overhead", 25)
			set i = i + 1
		else
		exitwhen true
		endif
	endloop
	call SaveInteger(HY, h, 245,(i -1))
	set HW = GetUnitAbilityLevel(trigUnit,('A0J5'))
	call ForGroup(MLI, function NIA)
	call TriggerRegisterTimerEvent(t, 25, false)
	call TriggerAddAction(t, function NFA)
	call DeallocateGroup(g)
	set g = null
	set t = null
	set trigUnit = null
	set targetUnit = null
	set MLI = null
endfunction
function NKA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEvalCount(t)> LoadInteger(HY, h, 1) or GetTriggerEventId() == EVENT_WIDGET_DEATH or GetUnitAbilityLevel(targetUnit,'A17K') == 0 then
		call UnitRemoveAbility(targetUnit,'A17K')
		call UnitRemoveAbility(targetUnit,'B0AP')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, level * 10+ 10)
	endif
	set whichUnit = null
	set targetUnit = null
	set t = null
	return false
endfunction
function NLA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEvalCount(t)> LoadInteger(HY, h, 1) or GetTriggerEventId() == EVENT_WIDGET_DEATH or GetUnitAbilityLevel(targetUnit,'A0P0') == 0 then
		call UnitRemoveAbility(targetUnit,'A0P0')
		call UnitRemoveAbility(targetUnit,'B073')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+ level * 10+ 10)
	endif
	set whichUnit = null
	set targetUnit = null
	set t = null
	return false
endfunction
function N5E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	call SaveInteger(HY, h, 1, 11)
	if IsUnitAlly(targetUnit, GetOwningPlayer(whichUnit)) then
		call TriggerAddCondition(t, Condition(function NLA))
		call UnitAddPermanentAbility(targetUnit,'A0P0')
	elseif not UnitHasSpellShield(GetSpellTargetUnit()) then
		call TriggerAddCondition(t, Condition(function NKA))
		call UnitAddPermanentAbility(targetUnit,'A17K')
	endif
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function JWE takes nothing returns nothing
	if IsUnitEnemy(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) and IsUnitMagicImmune(GetSpellTargetUnit()) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "无法作用于魔免的敌人")
	endif
endfunction
function PDX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A0P0')
	call AddAbilityIDToPreloadQueue('A17K')
endfunction
function QZG takes nothing returns nothing
	call UnitDamageTargetEx(M0V, GetEnumUnit(), 1, 20 + 10* M1V)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Immolation\\ImmolationDamage.mdl", GetEnumUnit(), "head"))
endfunction
function NMA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer level
	local integer OVX = GetUnitTypeId(whichUnit)
	local group g
	local unit u
	local integer i = 1
	if OVX =='n00U' or OVX =='n0KU' then
		set level = 1
	elseif OVX =='n00Y' or OVX =='n0KV' then
		set level = 2
	elseif OVX =='n00Z' or OVX =='n0KW' then
		set level = 3
	endif
	if GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))],'A0A8')> 0 then
		set i = 2
	endif
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		set whichUnit = GetTriggerUnit()
		set i = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))],'A0A8')
		if i > 0 and GetUnitAbilityLevel(whichUnit,'A3J0') == 0 and(GetUnitTypeId(whichUnit)=='n0KU' or GetUnitTypeId(whichUnit)=='n0KV' or GetUnitTypeId(whichUnit)=='n0KW') then
			set g = AllocationGroup(413)
			set U2 = whichUnit
			call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 275, Condition(function DHX))
			call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", GetUnitX(whichUnit), GetUnitY(whichUnit)))
			loop
				set u = FirstOfGroup(g)
			exitwhen u == null
				call UnitDamageTargetEx(whichUnit, u, 1, 50 + 50 * i)
				call GroupRemoveUnit(g, u)
			endloop
			call DeallocateGroup(g)
		endif
		set whichUnit = null
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set U2 = whichUnit
		set M0V = whichUnit
		set M1V = level
		set g = AllocationGroup(414)
		call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 325, Condition(function DHX))
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			call UnitDamageTargetEx(whichUnit, u, 1,(20 + 10* level)* i)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Immolation\\ImmolationDamage.mdl", u, "head"))
			call GroupRemoveUnit(g, u)
		endloop
		call DeallocateGroup(g)
		set g = null
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function NPA takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function NMA))
	call SaveUnitHandle(HY, h, 2,(u))
	if GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A0A8')> 0 then
		if GetUnitTypeId(u)=='n00U' then
			call UnitAddPermanentAbility(u,'A3IX')
		elseif GetUnitTypeId(u)=='n00Y' then
			call UnitAddPermanentAbility(u,'A3IY')
		elseif GetUnitTypeId(u)=='n00Z' then
			call UnitAddPermanentAbility(u,'A3IZ')
		elseif GetUnitAbilityLevel(u,'BNin') == 0 then
			call UnitApplyTimedLife(u,'BTLF', 60)
			call UnitAddPermanentAbility(u,'A3J0')
		endif
	endif
	set t = null
endfunction
function NQA takes nothing returns boolean
	local integer OVX = GetUnitTypeId(GetTriggerUnit())
	if OVX =='n00U' or OVX =='n0KU' or OVX =='n00Y' or OVX =='n0KV' or OVX =='n00Z' or OVX =='n0KW' then
		call NPA(GetTriggerUnit())
	endif
	return false
endfunction
function NSA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local real JBR =(LoadReal(HY, h, 191))
	local real JCR =(LoadReal(HY, h, 192))
	local integer level = GetUnitAbilityLevel(whichUnit,'S00U')
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', JBR, JCR, 0)
	call UnitAddPermanentAbility(dummyCaster,'S00U')
	call SetUnitAbilityLevel(dummyCaster,'S00U', level)
	call IssuePointOrderById(dummyCaster, 852224, x, y)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set whichUnit = null
	set dummyCaster = null
	set t = null
	return false
endfunction
function NTA takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .3, false)
	call TriggerAddCondition(t, Condition(function NSA))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveReal(HY, h, 6,((GetSpellTargetX())* 1.))
	call SaveReal(HY, h, 7,((GetSpellTargetY())* 1.))
	call SaveReal(HY, h, 191,((GetUnitX(whichUnit))* 1.))
	call SaveReal(HY, h, 192,((GetUnitY(whichUnit))* 1.))
	set whichUnit = null
	set t = null
endfunction
function N6E takes nothing returns nothing
	if IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) then
		call NTA()
	endif
endfunction
// 地狱火
function PFX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	call TriggerAddCondition(t, Condition(function NQA))
	set t = null
endfunction
function NUA takes unit R8X, unit targetUnit returns nothing
	local group g
	local unit u
	local real a
	local real damageValue
	if GetRandomReal(0, 100)< 40 then
		set g = AllocationGroup(415)
		set a = AngleBetweenUnit(R8X, targetUnit)* bj_DEGTORAD
		if GetUnitAbilityLevel(R8X,'A0IM') == 1 then
			set damageValue = 80
		elseif GetUnitAbilityLevel(R8X,'A0IQ') == 1 then
			set damageValue = 115
		else
			set damageValue = 150
		endif
		set U2 = R8X
		call GroupEnumUnitsInRange(g, GetUnitX(targetUnit)+ 150* Cos(a), GetUnitY(targetUnit)+ 150* Sin(a), 325, Condition(function DHX))
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			call UnitDamageTargetEx(R8X, u, 7, damageValue)
			call GroupRemoveUnit(g, u)
		endloop
		call DeallocateGroup(g)
	endif
endfunction
function NWA takes nothing returns nothing
	if CSX(DESource) and IsUnitType(DETarget, UNIT_TYPE_STRUCTURE) == false then
		call NUA(DESource, DETarget)
	endif
endfunction
function NYA takes nothing returns boolean
	local unit t = GetFilterUnit()
	local unit u = LoadUnitHandle(OtherHashTable2,'A0CA', 0)
	local group g = LoadGroupHandle(ObjectHashTable, GetHandleId(u), StringHash("ShukuGroup"))
	if u != null and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(u)) and(t != u) and IsUnitInGroup(t, g) == false and GetUnitAbilityLevel(t,'A04R') == 0 and IsUnitMagicImmune(t) == false and UnitAlive(t) and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false and(IsUnitType(t, UNIT_TYPE_ANCIENT) == false or DRX(t)) then
		call GroupAddUnit(g, t)
		call UnitDamageTargetEx(u, t, 1, LoadInteger(ObjectHashTable, GetHandleId(u), StringHash("ShukuDamage")))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl", t, "chest"))
	endif
	set g = null
	set u = null
	set t = null
	return false
endfunction
function NZA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	local group g
	if GetUnitAbilityLevel(u,'BHfs') == 0 then
		call DeallocateGroup(LoadGroupHandle(ObjectHashTable, GetHandleId(u), StringHash("ShukuGroup")))
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		set u = null
		return
	endif
	call SaveUnitHandle(OtherHashTable2,'A0CA', 0, u)
	set g = AllocationGroup(416)
	call GroupEnumUnitsInRange(g, GetWidgetX(u), GetWidgetY(u), 200, Condition(function NYA))
	call DeallocateGroup(g)
	call RemoveSavedHandle(OtherHashTable2,'A0CA', 0)
	set g = null
	set t = null
	set u = null
endfunction
function FQE takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local integer WFV = GetHandleId(t)
	local integer WUV = GetUnitAbilityLevel(u,'A0CA')+ GetUnitAbilityLevel(u,'QB01')
	call SaveUnitHandle(ObjectHashTable, WFV, 0, u)
	call SaveGroupHandle(ObjectHashTable, GetHandleId(u), StringHash("ShukuGroup"), AllocationGroup(417))
	call SaveInteger(ObjectHashTable, GetHandleId(u), StringHash("ShukuDamage"), WUV * 25 + 50)
	call TimerStart(t, .05, true, function NZA)
	set t = null
	set u = null
endfunction
function PIE takes nothing returns nothing
	call UnitMakeAbilityPermanent(GetTriggerUnit(), true,'A0CN')
	call UnitMakeAbilityPermanent(GetTriggerUnit(), true,'A0CR')
	call UnitMakeAbilityPermanent(GetTriggerUnit(), true,'A0CS')
	call UnitMakeAbilityPermanent(GetTriggerUnit(), true,'A0CM')
endfunction
function SXE takes nothing returns nothing
	call UnitMakeAbilityPermanent(GetTriggerUnit(), true,'A0BM')
	call UnitMakeAbilityPermanent(GetTriggerUnit(), true,'A0BL')
	call UnitMakeAbilityPermanent(GetTriggerUnit(), true,'A0BN')
	call UnitMakeAbilityPermanent(GetTriggerUnit(), true,'A0BO')
endfunction
function N_A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call SetUnitState((LoadUnitHandle(HY, h, 26)), UNIT_STATE_MANA,(LoadReal(HY, h, 242)))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function N0A takes unit u, real N1A returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function N_A))
	call SaveUnitHandle(HY, h, 26,(u))
	call SaveReal(HY, h, 242,((N1A)* 1.))
	set t = null
endfunction
function N7E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer h
	local real hp
	local real mp
	local real x
	local real y
	if GetSpellAbilityId()=='A3DM' then
		set u = GetSpellTargetUnit()
	endif
	set h = GetHandleId(GetTriggerUnit())
	set hp = RMaxBJ((LoadReal(HY, h,(7200 + 1))), 1)
	set mp = RMaxBJ((LoadReal(HY, h,(7250 + 1))), 1)
	set x =(LoadReal(HY, h,(7300 + 1)))
	set y =(LoadReal(HY, h,(7350 + 1)))
	if (LoadReal(HY, h,(7200 + 1)))> 1 and GetWidgetLife(u)> 1 then
		call AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkTarget.mdl", GetUnitX(u), GetUnitY(u))
		call SetUnitX(u, x)
		call SetUnitY(u, y)
		call EPX(u,'AFRZ', .03)
		call SetWidgetLife(u, hp)
		call SetUnitState(u, UNIT_STATE_MANA, mp)
		if IsUnitType(u, UNIT_TYPE_SUMMONED) == false then
			call UnitRemoveBuffs(u, false, true)
		endif
		call GBX(u)
		call N0A(u, mp)
	endif
	set u = null
endfunction
function KXE takes nothing returns nothing
	if IsUnitIllusion(GetSpellTargetUnit()) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "无法作用于幻象.")
	elseif LoadBoolean(HY, GetHandleId(GetOwningPlayer(GetSpellTargetUnit())), 139) and GetOwningPlayer(GetSpellTargetUnit())!= GetOwningPlayer(GetTriggerUnit()) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "目标拒绝了队友的帮助.")
	endif
endfunction

function Weaver_TimeLapse_Learn takes nothing returns nothing
	//local trigger t = CreateTrigger()
	//call TriggerRegisterTimerEventPeriodic(t, .5)
	//call TriggerAddAction(t, function N2A)
	//call SaveUnitHandle(HY, GetHandleId(t), 221, GetTriggerUnit())
	//set t = null
endfunction
function N3A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer c = LoadInteger(HY, h, 2)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call UnitAddStateBonus(targetUnit, c, UNIT_BONUS_ARMOR)
		call SaveInteger(HY,(GetHandleId((targetUnit))),(4290), 2)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if GetTriggerUnit() == targetUnit then
			call KillUnit(whichUnit)
		endif
	elseif GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamageSource() == whichUnit then
			call UnitReduceStateBonus(targetUnit, 1, UNIT_BONUS_ARMOR)
			call SaveInteger(HY, h, 2, c + 1)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SkeletalMageMissile\\SkeletalMageMissile.mdl", targetUnit, "chest"))
		endif
	else
		call SetUnitX(whichUnit, GetUnitX(targetUnit)-40)
		call SetUnitY(whichUnit, GetUnitY(targetUnit)-40)
		if IsUnitInvision(targetUnit) and UnitVisibleToPlayer(targetUnit, GetOwningPlayer(whichUnit)) == false then
			call KillUnit(whichUnit)
		elseif ModuloInteger(GetTriggerEvalCount(t), 5) == 0 then
			call IssueTargetOrderById(whichUnit, 851983, targetUnit)
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function N4A takes unit N5A, unit targetUnit, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer id = GetUnitTypeId(N5A)
	local player p = GetOwningPlayer(N5A)
	local real x = GetUnitX(N5A)
	local real y = GetUnitY(N5A)
	local real a = GetUnitFacing(N5A)
	call KillUnit(N5A)
	set N5A = CreateUnit(p, id, x, y, a)
	call UnitRemoveAbility(N5A,'Avul')
	call SaveUnitHandle(HY, h, 2,(N5A))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterDeathEvent(t, N5A)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function N3A))
	call TriggerEvaluate(t)
	call UnitApplyTimedLife(N5A,'BTLF', 16)
	set t = null
endfunction
function N6A takes nothing returns boolean
	return DHX() and LoadInteger(HY, GetHandleId(GetFilterUnit()), 4290)!= 1 and(UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) or IsUnitInvision(GetFilterUnit()) == false)
endfunction
function N7A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local group g
	local integer i = 1
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local real a = LoadReal(HY, h, 137)
	local unit N5A
	local unit targetUnit
	local real tx = LoadReal(HY, h, 47)
	local real ty = LoadReal(HY, h, 48)
	set x = CoordinateX50(x + 18 * Cos(a))
	set y = CoordinateY50(y + 18 * Sin(a))
	call SaveReal(HY, h, 6, x * 1.)
	call SaveReal(HY, h, 7, y * 1.)
	if GetTriggerEvalCount(t)> 166 then
		loop
		exitwhen i > 12
			if (LoadBoolean(HY, h, 511 + i -1)) == false then
				call KillUnit(LoadUnitHandle(HY, h, 393 + i -1))
			endif
			set i = i + 1
		endloop
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set g = AllocationGroup(418)
		set U2 = whichUnit
		call GroupEnumUnitsInRange(g, x, y, 400, Condition(function N6A))
		loop
		exitwhen i > 12
			if (LoadBoolean(HY, h, 511 + i -1)) == false then
				set N5A = LoadUnitHandle(HY, h, 393 + i -1)
				set x = LoadReal(HY, h, 549 + i -1)
				set y = LoadReal(HY, h, 567 + i -1)
				set x = CoordinateX50(x + 18 * Cos(a))
				set y = CoordinateY50(y + 18 * Sin(a))
				call SaveReal(HY, h, 549 + i -1, x * 1.)
				call SaveReal(HY, h, 567 + i -1, y * 1.)
				call SetUnitX(N5A, x)
				call SetUnitY(N5A, y)
				set targetUnit = FirstOfGroup(g)
				if targetUnit != null then
					call GroupRemoveUnit(g, targetUnit)
					call SaveInteger(HY, GetHandleId(targetUnit), 4290, 1)
					call SaveBoolean(HY, h, 511 + i -1, true)
					call N4A(N5A, targetUnit, LoadInteger(HY, h, 0))
				endif
			endif
			set i = i + 1
		endloop
		call DeallocateGroup(g)
		set g = null
		set N5A = null
		set targetUnit = null
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function N8E takes nothing returns nothing
	local real tx = GetSpellTargetX()
	local real ty = GetSpellTargetY()
	local unit whichUnit = GetTriggerUnit()
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local real a = AngleBetweenXY(x, y, tx, ty)* bj_DEGTORAD
	local unit dummyCaster
	local real targetX = CoordinateX50(x + 3000* Cos(a))
	local real targetY = CoordinateY50(y + 3000* Sin(a))
	local integer i = 1
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real IMX
	local integer level = GetUnitAbilityLevel(whichUnit,'A1QW')
	local integer OVX
	if level == 1 then
		set OVX ='u01K'
	elseif level == 2 then
		set OVX ='u01H'
	elseif level == 3 then
		set OVX ='u01J'
	elseif level == 4 then
		set OVX ='u01L'
	endif
	loop
	exitwhen i > 12
		set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit), OVX, x + GetRandomInt(-300, 300), y + GetRandomInt(-300, 300), a * bj_RADTODEG)
		call SaveUnitHandle(HY, h, 393 + i -1, dummyCaster)
		call SaveBoolean(HY, h, 511 + i -1, false)
		call SaveReal(HY, h, 549 + i -1, GetUnitX(dummyCaster)* 1.)
		call SaveReal(HY, h, 567 + i -1, GetUnitY(dummyCaster)* 1.)
		call UnitAddAbility(dummyCaster,'Aloc')
		call UnitAddAbility(dummyCaster,'Abun')
		set i = i + 1
	endloop
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function N7A))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveReal(HY, h, 6, x * 1.)
	call SaveReal(HY, h, 7, y * 1.)
	call SaveReal(HY, h, 137, a * 1.)
	call SaveReal(HY, h, 47, targetX * 1.)
	call SaveReal(HY, h, 48, targetY * 1.)
	call SaveInteger(HY, h, 0, level)
	set whichUnit = null
	set dummyCaster = null
	set t = null
endfunction
function PRX takes nothing returns nothing
	call B6X('u01K')
	call B6X('u01H')
	call B6X('u01J')
	call B6X('u01L')
endfunction
function N8A takes unit whichUnit, unit A2O returns unit
	local group g = AllocationGroup(419)
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, GetUnitX(A2O), GetUnitY(A2O), 600, Condition(function DQX))
	call GroupRemoveUnit(g, A2O)
	set U2 = GroupPickRandomUnit(g)
	call DeallocateGroup(g)
	set g = null
	return U2
endfunction
function N9A takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	local unit damageSource = LoadUnitHandle(HY, h, 2)
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamageSource() == dummyUnit then
			if LoadUnitHandle(HY, h,-1) == LoadUnitHandle(HY, h, 2) then
				if GetUnitAbilityLevel(targetUnit,'A3E9') == 1 and IsUnitMagicImmune(damageSource) and LoadBoolean(HY, h, 0) == false then
					if UnitHasSpellShield(damageSource) == false then
						call SaveUnitHandle(OtherHashTable2,'A3E9', 0, targetUnit)
						call SaveUnitHandle(OtherHashTable2,'A3E9', 1, damageSource)
						call SaveInteger(OtherHashTable2,'A3E9', 0, LoadInteger(HY, h, 0))
						call ExecuteFunc("BVA")
					else
						call UnitRemoveSpellShield(damageSource)
					endif
				endif
			endif
			if IsUnitType(targetUnit, UNIT_TYPE_HERO) or C_X(targetUnit) then
				call CommonUnitAddStun(targetUnit, 1, false)
				call UnitDamageTargetEx(damageSource, targetUnit, 1, 75)
			else
				call CommonUnitAddStun(targetUnit, 5, false)
				call UnitDamageTargetEx(damageSource, targetUnit, 1, 50 + 25 * LoadInteger(HY, h, 0))
			endif
			if LoadInteger(HY, h, 1)> 0 then
				call SaveUnitHandle(OtherHashTable2,'cask', 0, targetUnit)
				call RemoveSavedHandle(OtherHashTable2,'cask', 1)
				call SaveUnitHandle(OtherHashTable2,'cask', 2, damageSource)
				call SaveInteger(OtherHashTable2,'cask', 0, LoadInteger(HY, h, 0))
				call SaveInteger(OtherHashTable2,'cask', 1, LoadInteger(HY, h, 1))
				call ExecuteFunc("BEA")
			else
				call FlushChildHashtable(OtherHashTable2,'cask')
			endif
			call CleanCurrentTrigger(t)
			call FlushChildHashtable(HY, h)
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set dummyUnit = null
	set targetUnit = null
	set t = null
endfunction
function BXA takes unit whichUnit, unit BOA, unit BRA, integer level, integer c, boolean FAR returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(BOA), GetUnitY(BOA), 0)
	local boolean b = IsUnitType(BRA, UNIT_TYPE_HERO)
	call TriggerRegisterUnitEvent(t, BRA, EVENT_UNIT_DAMAGED)
	call TriggerRegisterTimerEvent(t, 15, false)
	call SaveUnitHandle(HY, h, 0, dummyCaster)
	call SaveUnitHandle(HY, h,-1, BOA)
	call SaveUnitHandle(HY, h, 1, BRA)
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveInteger(HY, h, 0, level)
	call SaveBoolean(HY, h, 0, FAR)
	call SaveInteger(HY, h, 1, c -1)
	call TriggerAddCondition(t, Condition(function N9A))
	call UnitAddAbility(dummyCaster,'A0WY')
	call B0R(dummyCaster, BRA, 852095)
	set t = null
	set dummyCaster = null
endfunction
function BEA takes nothing returns nothing
	local unit BOA = LoadUnitHandle(OtherHashTable2,'cask', 0)
	local unit BRA = LoadUnitHandle(OtherHashTable2,'cask', 1)
	local unit whichUnit = LoadUnitHandle(OtherHashTable2,'cask', 2)
	local integer level = LoadInteger(OtherHashTable2,'cask', 0)
	local integer c = LoadInteger(OtherHashTable2,'cask', 1)
	if BRA == null then
		set BRA = N8A(whichUnit, BOA)
	endif
	if BRA != null then
		call BXA(whichUnit, BOA, BRA, level, c, LoadBoolean(OtherHashTable2,'cask', 0))
	endif
	set BOA = null
	set whichUnit = null
endfunction
function BIA takes unit trigUnit, unit targetUnit, integer level, boolean FAR returns nothing
	call SaveUnitHandle(OtherHashTable2,'cask', 0, trigUnit)
	call SaveUnitHandle(OtherHashTable2,'cask', 1, targetUnit)
	call SaveUnitHandle(OtherHashTable2,'cask', 2, trigUnit)
	call SaveInteger(OtherHashTable2,'cask', 0, level)
	call SaveInteger(OtherHashTable2,'cask', 1, level * 2 + 1)
	call SaveBoolean(OtherHashTable2,'cask', 0, FAR)
	call BEA()
endfunction
function N9E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call BIA(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(),'A0NM'), false)
	endif
endfunction
function BVA takes nothing returns nothing
	local unit whichUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 0)
	local unit targetUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 1)
	local integer level = LoadInteger(OtherHashTable2,'A3E9', 0)
	call T4V(whichUnit)
	call BIA(whichUnit, targetUnit, level, true)
	call FlushChildHashtable(OtherHashTable2,'A3E9')
	set whichUnit = null
	set targetUnit = null
endfunction
function BAA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	local integer level = GetUnitAbilityLevel(trigUnit,'A0NE')
	call UnitRemoveAbility(trigUnit,'A0NE')
	call UnitAddPermanentAbility(trigUnit,'A0NE')
	call SetUnitAbilityLevel(trigUnit,'A0NE', level)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set trigUnit = null
	return false
endfunction
function BNA takes unit targetUnit, integer level returns nothing
	local real BBA =(8 + level * 8)/ 3
	call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+ BBA)
endfunction
function BCA takes nothing returns boolean
	if (IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) == false and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit())) then
		call BNA(GetFilterUnit(), Q2)
	endif
	return false
endfunction
function BDA takes unit trigUnit returns nothing
	local integer level = GetUnitAbilityLevel(trigUnit,'A0NE')
	local group g = AllocationGroup(420)
	set U2 = trigUnit
	set Q2 = level
	call GroupEnumUnitsInRange(g, GetUnitX(trigUnit), GetUnitY(trigUnit), 525, Condition(function BCA))
	call DeallocateGroup(g)
	set g = null
endfunction
function BFA takes unit trigUnit returns nothing
	local integer level = GetUnitAbilityLevel(trigUnit,'A0NE')
	local real BGA = 4 + 4 * level
	call SetUnitState(trigUnit, UNIT_STATE_MANA, GetUnitState(trigUnit, UNIT_STATE_MANA)-(BGA / 3))
	if GetUnitState(trigUnit, UNIT_STATE_MANA)< BGA then
		if ((LoadInteger(HY,(GetHandleId((trigUnit))),(4265))) == 1) == false then
			call IssueImmediateOrderById(trigUnit, 852178)
		endif
	endif
endfunction
function BHA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit =(LoadUnitHandle(HY, h, 14))
	if GetTriggerEventId() == EVENT_UNIT_ISSUED_ORDER then
		if GetIssuedOrderId()== 852178 then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call SaveUnitHandle(HY, h, 14,(trigUnit))
			call TriggerRegisterTimerEvent(t, 0, false)
			call TriggerAddCondition(t, Condition(function BAA))
		endif
	else
		call BDA(trigUnit)
		call BFA(trigUnit)
	endif
	set t = null
	set trigUnit = null
	return false
endfunction
function BEE takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 14, trigUnit)
	call TriggerRegisterTimerEvent(t, .33, true)
	call TriggerRegisterUnitEvent(t, trigUnit, EVENT_UNIT_ISSUED_ORDER)
	call TriggerAddCondition(t, Condition(function BHA))
	set trigUnit = null
	set t = null
endfunction
function BJA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 0)
	local integer count = GetTriggerEvalCount(t)
	local real BKA = LoadReal(HY, h, 392)
	local real BLA = 0
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call WHV(targetUnit,'D002')
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if count == 4 or count == 8 or count == 12 then
			call DestroyEffect(LoadEffectHandle(HY, h, 32))
			if count == 12 then
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			elseif count == 4 or count == 8 then
				call DestroyEffect(LoadEffectHandle(HY, h, 32))
				call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("effects\\NetherInferno.mdx", targetUnit, "origin"))
			endif
			set BLA =(level * .08 + .08)* RMaxBJ(BKA -GetWidgetLife(targetUnit), 0)
			if BLA > 0 then
				call CommonTextTag("+" + I2S(R2I(BLA)), 2, targetUnit, .023, 68, 0, 187, 216)
			endif
		endif
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, level * 5 + BLA)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function BMA takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetEnumUnit()
	call UnitAddAbilityLevel1ToTimed(targetUnit,'C002','D002', 12.)
	call DestroyEffect(AddSpecialEffectTarget("effects\\NetherInferno.mdx", targetUnit, "origin"))
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function BJA))
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	call SaveReal(HY, h, 392, GetWidgetLife(targetUnit)* 1.)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("effects\\NetherInferno.mdx", targetUnit, "origin"))
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function BPA takes nothing returns boolean
	return(IsUnitIdType(GetUnitTypeId(GetFilterUnit()), UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())))!= null
endfunction
function BRE takes nothing returns nothing
	local group g = AllocationGroup(421)
	call GroupEnumUnitsInRange(g, GetSpellTargetX(), GetSpellTargetY(), 190, Condition(function BPA))
	call ForGroup(g, function BMA)
	call DeallocateGroup(g)
	set g = null
endfunction
function BQA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	if GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		call EXStopUnit(whichUnit)
	endif
	set whichUnit = null
	set t = null
	return false
endfunction
function BIE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2,(u))
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_FINISH)
	call TriggerRegisterTimerEvent(t, 10, false)
	call TriggerAddCondition(t, Condition(function BQA))
	call FVO(u, false)
	set t = null
	set u = null
endfunction
function BSA takes nothing returns boolean
	if GetUnitTypeId(GetSummonedUnit())=='o000' or GetUnitTypeId(GetSummonedUnit())=='o001' or GetUnitTypeId(GetSummonedUnit())=='o00A' or GetUnitTypeId(GetSummonedUnit())=='o00X' then
		call EPX(GetSummoningUnit(), 4265, 8)
	endif
	return false
endfunction
function PNX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function BSA))
	set t = null
endfunction
function SIG takes nothing returns boolean
	local integer id = 0
	local unit u
	local real time = GetGameTime()
	local real hp
	local integer BTA
	loop
	exitwhen id > 12
		set u = Player__Hero[id]
		set BTA = GetUnitAbilityLevel(u,'B0CD')
		if u != null and BTA == 0 and M2V[id]> time then
			set M2V[id]= 0
		endif
		if u != null and BTA > 0 then
			if M2V[id]> time and UnitAlive(u) then
				set hp = GetWidgetLife(u)
				if hp < M3V[id]or LoadInteger(HY, GetHandleId(u),'AFRZ') == 1 then
					set M3V[id]= hp
				endif
				call SetWidgetLife(u, M3V[id])
				set M5V[id]= M5V[id] + 1
				if M5V[id]== 10 and BTA > 0 then
					set M5V[id]= 0
					call UnitDamageTargetEx(M4V[id], u, 1, 5 + 10* M6V[id])
				endif
			elseif M2V[id]> time and UnitIsDead(u) then
				set M2V[id]= 0
				set M3V[id]= 99999
			endif
			if (BTA > 0 and M2V[id]< time) then
				call UnitRemoveAbility(u,'A1JA')
				call UnitRemoveAbility(u,'B0CD')
			endif
		endif
		set id = id + 1
	endloop
	set u = null
	return false
endfunction
function BUA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 5)
	local unit dummyCaster
	local string s
	local real BWA = LoadReal(HY, h, 0)
	local integer c = LoadInteger(HY, h, 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call UnitRemoveAbility(targetUnit,'A1JA')
		call UnitRemoveAbility(targetUnit,'B0CD')
		call RemoveSavedHandle(HY, GetHandleId(targetUnit),'A1MI')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		// debug call SingleDebug("dest 1")
	elseif GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		if GetGameTime()> BWA then
			call UnitRemoveAbility(targetUnit,'A1JA')
			call UnitRemoveAbility(targetUnit,'B0CD')
			call RemoveSavedHandle(HY, GetHandleId(targetUnit),'A1MI')
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		else
			set c = c + 1
			call SaveInteger(HY, h, 0, c)
			if ModuloInteger(c, 10) == 0 then
				call UnitDamageTargetEx(LoadUnitHandle(HY, h, 0), targetUnit, 1, 5 + 10* level)
			endif
		endif
	else
		if GetUnitAbilityLevel(targetUnit,'A1JA') == 0 then
			if GetTriggerEvalCount(t)> 4 then
				call UnitRemoveAbility(targetUnit,'A1JA')
				call UnitRemoveAbility(targetUnit,'B0CD')
				call RemoveSavedHandle(HY, GetHandleId(targetUnit),'A1MI')
				call FlushChildHashtable(HY, h)
				call DestroyTrigger(t)
			endif
		elseif GetOwningPlayer(targetUnit)!= GetOwningPlayer(GetEventDamageSource()) and GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)*(.09 + .01 * level)> GetWidgetLife(targetUnit) and((LoadInteger(HY,(GetHandleId((targetUnit))),( 2485)))!= 1) then
			call RemoveSavedHandle(HY, GetHandleId(targetUnit),'A1MI')
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
			call UnitRemoveAbility(targetUnit,'A1JA')
			call UnitRemoveAbility(targetUnit,'B0CD')
			set s = "Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl"
			call DestroyEffect(AddSpecialEffectTarget(s, targetUnit, "overhead"))
			call DestroyEffect(AddSpecialEffectTarget(s, targetUnit, "chest"))
			call DestroyEffect(AddSpecialEffectTarget(s, targetUnit, "origin"))
			set dummyCaster = CreateUnit(GetOwningPlayer(GetEventDamageSource()),'e00E', 0, 0, 0)
			if IsUnitType(targetUnit, UNIT_TYPE_SUMMONED) == false then
				call UnitRemoveBuffs(targetUnit, true, true)
			endif
			call UnitRemoveAbility(targetUnit,'Aetl')
			call UnitDamageTargetEx(dummyCaster, targetUnit, 4, 100000000.)
			set dummyCaster = null
		endif
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function BYA takes unit whichUnit, unit targetUnit returns nothing
	local integer level = GetUnitAbilityLevel(whichUnit,'A1MI')+ GetUnitAbilityLevel(whichUnit,'A2QE')
	local integer id = GetPlayerId(GetOwningPlayer(targetUnit))
	local trigger t
	local integer h
	local real BZA = 7 + level
	if GetUnitAbilityLevel(whichUnit,'A2QE')> 0 then
		set BZA = 17
	endif
	if level > 0 and IsUnitType(targetUnit, UNIT_TYPE_HERO) and GetUnitAbilityLevel(targetUnit,'A04R') == 0 then
		if HaveSavedHandle(HY, GetHandleId(targetUnit),'A1MI') then
			set t = LoadTriggerHandle(HY, GetHandleId(targetUnit),'A1MI')
			set h = GetHandleId(t)
		else
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call FlushChildHashtable(HY, h)
			call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
			call TriggerAddCondition(t, Condition(function BUA))
			call TriggerRegisterDeathEvent(t, targetUnit)
			call TriggerRegisterTimerEvent(t, .1, true)
			call SaveReal(HY, h, 0, GetGameTime()+ BZA * 1.)
			call SaveUnitHandle(HY, h, 17,(targetUnit))
			call UnitAddPermanentAbility(targetUnit,'A1JA')
			call SaveTriggerHandle(HY, GetHandleId(targetUnit),'A1MI', t)
		endif
		call SaveInteger(HY, h, 5,(level))
		call SaveUnitHandle(HY, h, 0, whichUnit)
		call CXR(targetUnit, BZA)
	endif
	set t = null
endfunction
function PUX takes nothing returns nothing
endfunction
function B_A takes nothing returns nothing
	if DVX(GetEnumUnit()) then
		return
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A1HZ')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'A1HZ')
		call UnitRemoveAbility(GetEnumUnit(),'B0C5')
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A1I4')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'A1I4')
		call UnitRemoveAbility(GetEnumUnit(),'B0C5')
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A1I3')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'A1I3')
		call UnitRemoveAbility(GetEnumUnit(),'B0C5')
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A1I6')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'A1I6')
		call UnitRemoveAbility(GetEnumUnit(),'B0C5')
	endif
endfunction
function B0A takes nothing returns nothing
	if DVX(GetEnumUnit()) then
		return
	endif
	if IsUnitMagicImmune(GetEnumUnit()) == false then
		if M7V == 1 then
			if GetUnitAbilityLevel(GetEnumUnit(),'A1HZ') == 0 then
				call UnitRemoveAbility(GetEnumUnit(),'B0C5')
				call UnitAddPermanentAbility(GetEnumUnit(),'A1HZ')
			endif
		elseif M7V == 2 then
			if GetUnitAbilityLevel(GetEnumUnit(),'A1I4') == 0 then
				call UnitRemoveAbility(GetEnumUnit(),'B0C5')
				call UnitAddPermanentAbility(GetEnumUnit(),'A1I4')
			endif
		elseif M7V == 3 then
			if GetUnitAbilityLevel(GetEnumUnit(),'A1I3') == 0 then
				call UnitRemoveAbility(GetEnumUnit(),'B0C5')
				call UnitAddPermanentAbility(GetEnumUnit(),'A1I3')
			endif
		elseif M7V == 4 then
			if GetUnitAbilityLevel(GetEnumUnit(),'A1I6') == 0 then
				call UnitRemoveAbility(GetEnumUnit(),'B0C5')
				call UnitAddPermanentAbility(GetEnumUnit(),'A1I6')
			endif
		endif
	endif
endfunction
function B1A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit dummyCaster = LoadUnitHandle(HY, h, 19)
	local group IQI = LoadGroupHandle(HY, h, 340)
	local real x = GetUnitX(dummyCaster)
	local real y = GetUnitY(dummyCaster)
	local group g = AllocationGroup(422)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call ForGroup(IQI, function B_A)
		call DeallocateGroup(g)
		call DeallocateGroup(IQI)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call ShowUnit(dummyCaster, false)
		set t = null
		set whichUnit = null
		set dummyCaster = null
		set IQI = null
		return false
	endif
	set M7V = LoadInteger(HY, h, 0)
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, x, y, LoadReal(HY, h,'0aoe'), Condition(function DHX))
	call GroupRemoveGroup(g, IQI)
	call ForGroup(IQI, function B_A)
	call ForGroup(g, function B0A)
	call SaveGroupHandle(HY, h, 340, g)
	call DeallocateGroup(IQI)
	set t = null
	set whichUnit = null
	set dummyCaster = null
	set IQI = null
	return false
endfunction
function BAE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'n0HQ', GetSpellTargetX(), GetSpellTargetY(), 0)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call UnitApplyTimedLife(dummyCaster,'BTLF', 16)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterDeathEvent(t, dummyCaster)
	call TriggerAddCondition(t, Condition(function B1A))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 19, dummyCaster)
	call SaveGroupHandle(HY, h, 340, AllocationGroup(423))
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit,'A1HS'))
	call SaveInteger(OtherHashTable2,'MULT', 0,'A1HS')
	call SaveReal(HY, h,'0aoe', 300)
	set U2 = whichUnit
	call ExecuteFunc("EBI")
	if Q2 > 0 then
		call SaveReal(HY, h,'0aoe', 300 + 100 *(Q2 -1))
		call SetUnitScale(dummyCaster, 1. + .33 *(Q2 -1), 1, 1)
	endif
	set whichUnit = null
	set dummyCaster = null
	set t = null
endfunction
function B2A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local integer level = LoadInteger(HY, h, 5)
	local real IXX =( 100 + 50 * level)/ 4
	local integer i = GetTriggerEvalCount(t)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetDistanceBetween(x, y, GetUnitX(targetUnit), GetUnitY(targetUnit))> 765 or GetUnitAbilityLevel(targetUnit,'B0CC') == 0 then
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call DestroyEffect(LoadEffectHandle(HY, h, 176))
		call UnitRemoveAbility(targetUnit,'A1J9')
		call UnitRemoveAbility(targetUnit,'B0CC')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif i == 8 or i == 16 or i == 25 or i == 34 then
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("war3mapImported\\ShivasEnchantment.mdx", targetUnit, "overhead"))
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, IXX)
	elseif i > 39 then
		call DestroyEffect(LoadEffectHandle(HY, h, 176))
		call UnitRemoveAbility(targetUnit,'A1J9')
		call UnitRemoveAbility(targetUnit,'B0CC')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call CommonUnitAddStun(targetUnit, .5 + .75 * level, false)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function B3A takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(whichUnit,'A1MG')
	local string s = "Doodads\\Cinematic\\GlowingRunes\\GlowingRunes4.mdl"
	if GetUnitTypeId(whichUnit)=='e00E' then
		set whichUnit = Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))]
	endif
	call UnitAddPermanentAbility(targetUnit,'A1J9')
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveReal(HY, h, 6, GetUnitX(targetUnit)* 1.)
	call SaveReal(HY, h, 7, GetUnitY(targetUnit)* 1.)
	call SaveInteger(HY, h, 5, level)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("war3mapImported\\ShivasEnchantment.mdx", targetUnit, "overhead"))
	call SaveEffectHandle(HY, h, 176, AddSpecialEffect(s, GetUnitX(targetUnit), GetUnitY(targetUnit)))
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function B2A))
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function BCE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call B3A()
	endif
endfunction
function B4A takes nothing returns nothing
	local unit whichUnit = M9V
	local unit targetUnit = GetEnumUnit()
	local integer level = M8V
	call BYA(whichUnit, targetUnit)
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, 150 + 100 * level)
	call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\PlasmaShot.mdl", targetUnit, "chest"))
	set whichUnit = null
	set targetUnit = null
endfunction
function B5A takes nothing returns nothing
	local unit whichUnit = M9V
	local unit targetUnit = GetEnumUnit()
	local integer level = M8V
	call BYA(whichUnit, targetUnit)
	set whichUnit = null
	set targetUnit = null
endfunction
function B6A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit missileDummy = LoadUnitHandle(HY, h, 45)
	local real tx = LoadReal(HY, h, 47)
	local real ty = LoadReal(HY, h, 48)
	local real a = LoadReal(HY, h, 13)
	local real KJR = LoadReal(HY, h, 432)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local integer level = LoadInteger(HY, h, 5)
	local real x = GetUnitX(missileDummy)+ 30 * Cos(a)
	local real y = GetUnitY(missileDummy)+ 30 * Sin(a)
	local group g
	local fogmodifier fm
	if GetDistanceBetween(x, y, tx, ty)< 35 or x != CoordinateX50(x) or y != CoordinateY50(y) then
		set x = tx
		set y = ty
		call SetUnitX(missileDummy, x)
		call SetUnitY(missileDummy, y)
		call DestroyEffect(LoadEffectHandle(HY, h, 14))
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		set fm = LoadFogModifierHandle(HY, h, 440)
		call FogModifierStop(fm)
		call DestroyFogModifier(fm)
		set fm = null
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(missileDummy)
		set U2 = whichUnit
		set M9V = whichUnit
		set M8V = level
		set g = AllocationGroup(424)
		call GroupEnumUnitsInRange(g, x, y, KJR + 25, Condition(function DHX))
		call ForGroup(g, function B4A)
		call DeallocateGroup(g)
		set g = null
	else
		call SetUnitX(missileDummy, x)
		call SetUnitY(missileDummy, y)
		set U2 = whichUnit
		set M9V = whichUnit
		set M8V = level
		set g = AllocationGroup(425)
		call GroupEnumUnitsInRange(g, x, y, 300, Condition(function DHX))
		call ForGroup(g, function B5A)
		call DeallocateGroup(g)
		set g = null
	endif
	set t = null
	set missileDummy = null
	set whichUnit = null
	return false
endfunction
function B7A takes unit whichUnit, real x, real y, real DRI, effect FX, fogmodifier fm, integer level, real PJZ  returns nothing
	local real a = Atan2(y -GetUnitY(whichUnit), x -GetUnitX(whichUnit))
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit missileDummy = CreateUnit(GetOwningPlayer(whichUnit),'h0B6', GetUnitX(whichUnit), GetUnitY(whichUnit), a * bj_RADTODEG)
	local real KJR = RMinBJ(275 + 25 * DRI * 2, 1000)
	local real GIX = GetDistanceBetween(GetUnitX(whichUnit), GetUnitY(whichUnit), x, y)
	local string s = ""
	local effect eff = null
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(whichUnit)) or IsObserverPlayer(LocalPlayer) then
		set s = "H\\AA\\IceBlastAoE.mdx"
	endif
	set eff= AddSpecialEffect(s, x,y)
	call EXSetEffectSize(eff ,0.25*PJZ/100.)
	call SaveEffectHandle(HY, h, 14, eff)
	set eff = null
	if IsUnitEnemy(missileDummy, LocalPlayer) and IsObserverPlayer(LocalPlayer) == false then
		call UnitSetUsesAltIcon(missileDummy, true)
	endif
	call TriggerRegisterTimerEvent(t, RMinBJ(2. /(GIX / 30), .04), true)
	call TriggerAddCondition(t, Condition(function B6A))
	call SaveUnitHandle(HY, h, 45, missileDummy)
	call SaveReal(HY, h, 47, x * 1.)
	call SaveReal(HY, h, 48, y * 1.)
	call SaveReal(HY, h, 13, a * 1.)
	call SaveReal(HY, h, 432, KJR * 1.)
	call SaveInteger(HY, h, 5, level)
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveFogModifierHandle(HY, h, 440, fm)
	call SaveEffectHandle(HY, h, 32, FX)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1MI', true)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A2QE', true)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1MN', false)
	set t = null
	set missileDummy = null
endfunction
function B8A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit missileDummy = LoadUnitHandle(HY, h, 45)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local real a = LoadReal(HY, h, 13)
	local real x
	local real y
	local real DRI = GetGameTime()-LoadReal(HY, h, 431)
	local real PJZ
	local string s
	local fogmodifier fm
	local effect FX
	local real B9A = GetUnitX(missileDummy)+ 30 * Cos(a)
	local real CVA = GetUnitY(missileDummy)+ 30 * Sin(a)
	local integer level = LoadInteger(HY, h, 0)
	set x = CoordinateX50(B9A)
	set y = CoordinateY50(CVA)
	call SetUnitX(missileDummy, x)
	call SetUnitY(missileDummy, y)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or(GetTriggerEventId() == EVENT_PLAYER_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A1MN') or x != B9A or y != CVA then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call RemoveUnit(missileDummy)
		set PJZ= RMinBJ(25+250+50*DRI,1000)
		set s = ""
		if IsPlayerAlly(GetOwningPlayer(whichUnit), LocalPlayer) or IsObserverPlayer(LocalPlayer) then
			set s = "war3mapImported\\IceWindGroundFX.mdl"
		endif
		set fm = CreateFogModifierRadius(GetOwningPlayer(whichUnit), FOG_OF_WAR_VISIBLE, x, y, 500, true, true)
		call FogModifierStart(fm)
		set FX = AddSpecialEffect(s, x, y)
		call B7A(whichUnit, x, y, DRI, FX, fm, level, PJZ)
		set fm = null
		set FX = null
	endif
	set t = null
	set missileDummy = null
	set whichUnit = null
	return false
endfunction
//冰晶爆轰
function BDE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = Atan2(y -GetUnitY(whichUnit), x -GetUnitX(whichUnit))
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit missileDummy = CreateUnit(GetOwningPlayer(whichUnit),'H0B8', GetUnitX(whichUnit), GetUnitY(whichUnit), a * bj_RADTODEG)
	if IsUnitEnemy(missileDummy, LocalPlayer) and IsObserverPlayer(LocalPlayer) == false then
		call UnitSetUsesAltIcon(missileDummy, true)
	endif
	call SaveUnitHandle(HY, h, 45, missileDummy)
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveReal(HY, h, 13, a * 1.)
	call SaveReal(HY, h, 431, GetGameTime()* 1.)
	call TriggerRegisterTimerEvent(t, .02, true)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	call SaveInteger(HY, h, 1, GetSpellAbilityId())
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerAddCondition(t, Condition(function B8A))
	call SetUnitColor(missileDummy, GetPlayerColor(Player( 14)))
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1MI', false)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A2QE', false)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1MN', true)
	call UnitAddPermanentAbility(whichUnit,'A1MN')
	set whichUnit = null
	set t = null
	set missileDummy = null
endfunction
function CEA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer level =(LoadInteger(HY, h, 5))
	local integer CXA =(LoadInteger(HY,(GetHandleId(whichUnit)), 449))
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamageSource() == whichUnit and GetEventDamage()> 1 and FK then
			call DisableTrigger(t)
			if CXA > 0 then
				call SaveInteger(HY,(GetHandleId(whichUnit)), 449,(CXA -1))
				call CommonTextTag("+" + I2S(40 + 10* level), 1, whichUnit, .024, 100, 200, 255, 255)
				call UnitDamageTargetEx(whichUnit, targetUnit, 1, 40 + 10* level)
			endif
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function COA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local integer level = LoadInteger(HY, h, 5)
	if GetTriggerEventId()!= EVENT_PLAYER_UNIT_ATTACKED or(LoadInteger(HY, GetHandleId(whichUnit), 449)) == 0 or GetUnitAbilityLevel(whichUnit,'A1HN') == 0 then
		call SaveInteger(HY, GetHandleId(whichUnit), 449, 0)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(whichUnit,'A1HN')
		call UnitRemoveAbility(whichUnit,'B0CJ')
	elseif GetAttacker() == whichUnit and(LoadInteger(HY, GetHandleId(whichUnit), 4289)!= 1) then
		call EPX(whichUnit, 4289, .4)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_DAMAGED)
		call TriggerRegisterTimerEvent(t, 2., false)
		call TriggerAddCondition(t, Condition(function CEA))
		call SaveUnitHandle(HY, h, 17, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 2, whichUnit)
		call SaveInteger(HY, h, 5, level)
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function T7G takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetEnumUnit()
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(whichUnit,'A1HQ')
	if LoadInteger(HY, GetHandleId(targetUnit), 449)> 0 and GetUnitAbilityLevel(targetUnit,'A1HN') == 1 then
		call SaveInteger(HY, GetHandleId(targetUnit), 449, 2 + level + LoadInteger(HY, GetHandleId(targetUnit), 449))
		set whichUnit = null
		set targetUnit = null
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call UnitAddPermanentAbility(targetUnit,'A1HN')
	call SaveUnitHandle(HY, h, 2, targetUnit)
	call SaveInteger(HY, h, 5, level)
	call TriggerRegisterTimerEvent(t, 30, false)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerAddCondition(t, Condition(function COA))
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function CRA takes nothing returns nothing
	local trigger t
	local integer h
	if GetUnitAbilityLevel(DESource,'A1HN') == 1 then
		set t = LoadTriggerHandle(HY, GetHandleId(DESource),'A1HN')
		set h = GetHandleId(t)
		call CommonTextTag("+" + I2S(R2I(LoadReal(HY, h, 1))), 1, DESource, .024, 100, 200, 255, 255)
		call UnitDamageTargetEx(DESource, DETarget, 1, LoadReal(HY, h, 1))
		call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)-1)
		set t = null
	endif
endfunction
function CIA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetUnitAbilityLevel(u,'A1HN') == 0 or GetGameTime()> LoadReal(HY, h, 0) or LoadInteger(HY, h, 0)<= 0 then
		call RemoveSavedHandle(HY, GetHandleId(u),'A1HN')
		call UnitRemoveAbility(u,'A1HN')
		call UnitRemoveAbility(u,'B0CJ')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set u = null
	set t = null
endfunction
function CAA takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local integer hu = GetHandleId(targetUnit)
	local trigger t
	local integer h
	if HaveSavedHandle(HY, hu,'A1HN') then
		set t = LoadTriggerHandle(HY, hu,'A1HN')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call FlushChildHashtable(HY, h)
		call SaveTriggerHandle(HY, hu,'A1HN', t)
		call TriggerRegisterTimerEvent(t, .2, true)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function CIA))
		call SaveUnitHandle(HY, h, 0, targetUnit)
	endif
	call UnitAddPermanentAbility(targetUnit,'A1HN')
	call SaveInteger(HY, h, 0, Q2 + 2 + LoadInteger(HY, h, 0))
	call SaveReal(HY, h, 0, GetGameTime()+ 30)
	call SaveReal(HY, h, 1, Q2 * 10+ 40)
	set t = null
	set targetUnit = null
endfunction
function BFE takes nothing returns nothing
	local group g = AllocationGroup(426)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	call DestroyEffect(AddSpecialEffect("war3mapImported\\IcyWind.mdl", x, y))
	call GroupEnumUnitsInRange(g, x, y, 550, Condition(function D3X))
	call GroupAddUnit(g, GetTriggerUnit())
	set Q2 = GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId())
	call ForGroup(g, function CAA)
	call DeallocateGroup(g)
	set g = null
endfunction
function CNA takes unit u, real damageValue returns nothing
	if GetWidgetLife(u)<= damageValue * .75 then
		set damageValue = GetWidgetLife(u)/ .75  -10
	endif
	call UnitDamageTargetEx(u, u, 1, damageValue)
endfunction
function CBA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local group g
	local integer i = GetTriggerEvalCount(t)
	local unit u
	local real damageValue
	local boolean b = LoadBoolean(HY, h, 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set whichUnit = null
		return false
	else
		set damageValue = LoadReal(HY, h, 0)
		if i == 1 then
			call UnitApplyTimedLife(CreateUnit(GetOwningPlayer(whichUnit),'h0B2', x, y, 0),'BTLF', 1)
			call TriggerRegisterTimerEvent(t, .1, true)
		elseif i == 10 then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
		call GBX(whichUnit)
		set g = AllocationGroup(427)
		set U2 = whichUnit
		call GroupEnumUnitsInRange(g, x, y, 350, Condition(function DHX))
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			call UnitDamageTargetEx(whichUnit, u, 1, damageValue)
			call GroupRemoveUnit(g, u)
		endloop
		if b then
			call CNA(whichUnit, damageValue / 2)
		endif
		call DeallocateGroup(g)
	endif
	set t = null
	set g = null
	set whichUnit = null
	return false
endfunction
function BJE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	call SaveBoolean(HY, h, 0, true)
	if GetUnitTypeId(whichUnit)=='e00E'then
		set whichUnit = Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))]
		call SaveBoolean(HY, h, 0, false)
	endif
	call TriggerRegisterTimerEvent(t, 1.5, false)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerAddCondition(t, Condition(function CBA))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveReal(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())* 7.5)
	set t = null
	set whichUnit = null
endfunction
function CCA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local player p
	local integer level = GetUnitAbilityLevel(whichUnit,'A1IN')
	local real KGX = GetGameTime()
	local real CDA = LoadReal(HY, h, 415)
	local real CFA = LoadReal(HY, h, 416)
	local integer ratio
	if UnitIsDead(whichUnit) then
		set t = null
		set whichUnit = null
		return false
	endif
	if IsSentinelPlayer(GetOwningPlayer(whichUnit)) then
		set p = ScourgePlayers[1]
	else
		set p = SentinelPlayers[1]
	endif
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED and GetOwningPlayer(GetEventDamageSource()) == NeutralCreepPlayer then
		if GetUnitAbilityLevel(whichUnit,'A1IE')> 0 then
			call UnitRemoveAbility(whichUnit,'A1IE')
			call UnitRemoveAbility(whichUnit,'B0C9')
		endif
		if GetUnitAbilityLevel(whichUnit,'A1IF')> 0 then
			call UnitRemoveAbility(whichUnit,'A1IF')
			call UnitRemoveAbility(whichUnit,'B0C9')
		endif
		if GetUnitAbilityLevel(whichUnit,'A1IG')> 0 then
			call UnitRemoveAbility(whichUnit,'A1IG')
			call UnitRemoveAbility(whichUnit,'B0C9')
		endif
		call SaveReal(HY, h, 414,(KGX + 2)* 1.)
		set t = null
		set whichUnit = null
		return false
	endif
	if (LoadReal(HY, h, 414))> KGX then
		set t = null
		set whichUnit = null
		return false
	endif
	if (UnitVisibleToPlayer(whichUnit, p) and GetUnitAbilityLevel(whichUnit,'A1HX') == 0) or GetUnitAbilityLevel(whichUnit,'A36D') == 1 then
		set CFA = 0
		if GetUnitAbilityLevel(whichUnit,'A1IE')> 0 or GetUnitAbilityLevel(whichUnit,'A1IF')> 0 or GetUnitAbilityLevel(whichUnit,'A1IG')> 0 then
			set CDA = CDA + .1
			if CDA > .4 then
				set CDA = 0
				if GetUnitAbilityLevel(whichUnit,'A1IE')> 0 then
					call UnitRemoveAbility(whichUnit,'A1IE')
					call UnitRemoveAbility(whichUnit,'B0C9')
				endif
				if GetUnitAbilityLevel(whichUnit,'A1IF')> 0 then
					call UnitRemoveAbility(whichUnit,'A1IF')
					call UnitRemoveAbility(whichUnit,'B0C9')
				endif
				if GetUnitAbilityLevel(whichUnit,'A1IG')> 0 then
					call UnitRemoveAbility(whichUnit,'A1IG')
					call UnitRemoveAbility(whichUnit,'B0C9')
				endif
			endif
		endif
		call SaveReal(HY, h, 415, CDA * 1.)
		call SaveReal(HY, h, 416, CFA * 1.)
	elseif (UnitVisibleToPlayer(whichUnit, p) == false or GetUnitAbilityLevel(whichUnit,'A1HX')> 0) and GetUnitAbilityLevel(whichUnit,'A36D') == 0 then
		set CDA = 0
		if (GetUnitAbilityLevel(whichUnit,'A1IE'-1 + level) == 0) then
			set CFA = CFA + .1
			if CFA > .4 then
				set CFA = 0
				if level == 1 then
					if GetUnitAbilityLevel(whichUnit,'A1IE') == 0 then
						call UnitAddPermanentAbility(whichUnit,'A1IE')
						call UnitMakeAbilityPermanent(whichUnit, true,'A1I7')
						call UnitMakeAbilityPermanent(whichUnit, true,'A1I8')
					endif
				endif
				if level == 2 then
					if GetUnitAbilityLevel(whichUnit,'A1IE')> 0 then
						call UnitRemoveAbility(whichUnit,'A1IE')
						call UnitRemoveAbility(whichUnit,'B0C9')
					endif
					if GetUnitAbilityLevel(whichUnit,'A1IF') == 0 then
						call UnitAddPermanentAbility(whichUnit,'A1IF')
						call UnitMakeAbilityPermanent(whichUnit, true,'A1I7')
						call UnitMakeAbilityPermanent(whichUnit, true,'A1I9')
					endif
				endif
				if level == 3 then
					if GetUnitAbilityLevel(whichUnit,'A1IE')> 0 then
						call UnitRemoveAbility(whichUnit,'A1IE')
						call UnitRemoveAbility(whichUnit,'B0C9')
					endif
					if GetUnitAbilityLevel(whichUnit,'A1IF')> 0 then
						call UnitRemoveAbility(whichUnit,'A1IF')
						call UnitRemoveAbility(whichUnit,'B0C9')
					endif
					if GetUnitAbilityLevel(whichUnit,'A1IG') == 0 then
						call UnitAddPermanentAbility(whichUnit,'A1IG')
						call UnitMakeAbilityPermanent(whichUnit, true,'A1I7')
						call UnitMakeAbilityPermanent(whichUnit, true,'A1IA')
					endif
				endif
			endif
		elseif UnitIsDead(whichUnit) == false then
			set ratio = 2 + level
			call SetWidgetLife(whichUnit, GetWidgetLife(whichUnit)+ GetUnitState(whichUnit, UNIT_STATE_MAX_LIFE)/ 1000* ratio)
		endif
		call SaveReal(HY, h, 415, CDA * 1.)
		call SaveReal(HY, h, 416, CFA * 1.)
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function M9E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveReal(HY, h, 415, .0)
	call SaveReal(HY, h, 416, .0)
	call SaveReal(HY, h, 414, GetGameTime())
	call SaveUnitHandle(HY, h, 2, GetTriggerUnit())
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function CCA))
	set t = null
endfunction
function CGA takes unit R8X, unit triggerUnit returns boolean
	if GetUnitAbilityLevel(triggerUnit,'A1HX')> 0 then
		call IssueImmediateOrderById(R8X, 851972)
		call InterfaceErrorForPlayer(GetOwningPlayer(R8X), "不能攻击该单位")
		return true
	endif
	return false
endfunction
function CHA takes nothing returns nothing
	local unit targetUnit = GetSpellTargetUnit()
	local unit u = GetTriggerUnit()
	if GetUnitAbilityLevel(targetUnit,'A1HX')> 0 and((IsUnitEnemy(targetUnit, GetOwningPlayer(u)) and GetUnitAbilityLevel(u,'Aloc') == 0) or IsUnitType(u, UNIT_TYPE_HERO) == false and GetUnitTypeId(u)!='u00L') then
		call IssueImmediateOrderById(u, 851972)
		if IsUnitType(u, UNIT_TYPE_HERO) == false then
			call InterfaceErrorForPlayer(GetOwningPlayer(u), "不能以该单位为目标")
		endif
	endif
	set targetUnit = null
	set u = null
endfunction
function PLX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_CAST)
	call TriggerAddCondition(t, Condition(function CHA))
	set t = null
endfunction
function CJA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer agi = LoadInteger(HY, h, 422)
	local integer str = LoadInteger(HY, h, 423)
	local integer int = LoadInteger(HY, h, 424)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		if (LoadBoolean(HY, h, 276)) == false and GetTriggerUnit() == whichUnit then
			call SaveBoolean(HY, h, 276,(true))
			call SetHeroAgi(whichUnit, GetHeroAgi(whichUnit, false)-agi -str -int, true)
			call SaveInteger(OtherHashTable, GetHandleId(whichUnit), 31, LoadInteger(OtherHashTable, GetHandleId(whichUnit), 31)-agi -str -int)
			call SetAbilitydataD(whichUnit,'QP1F', LoadInteger(OtherHashTable, GetHandleId(whichUnit), 31))
			if LoadInteger(HY, h, 0)> 0 then
				call UnitReduceStateBonus(whichUnit, LoadInteger(HY, h, 0), UNIT_BONUS_DAMAGE)
			endif
		elseif (LoadBoolean(HY, h, 277)) == false and GetTriggerUnit() == targetUnit then
			call SaveBoolean(HY, h, 277,(true))
			call SetHeroAgi(targetUnit, GetHeroAgi(targetUnit, false)+ agi, true)
			call SetHeroStr(targetUnit, GetHeroStr(targetUnit, false)+ str, true)
			call SetHeroInt(targetUnit, GetHeroInt(targetUnit, false)+ int, true)
		endif
	else
		if (LoadBoolean(HY, h, 276)) == false then
			call SaveBoolean(HY, h, 276,(true))
			call SetHeroAgi(whichUnit, GetHeroAgi(whichUnit, false)-agi -str -int, true)
			call SaveInteger(OtherHashTable, GetHandleId(whichUnit), 31, LoadInteger(OtherHashTable, GetHandleId(whichUnit), 31)-agi -str -int)
			call SetAbilitydataD(whichUnit,'QP1F', LoadInteger(OtherHashTable, GetHandleId(whichUnit), 31))
			if LoadInteger(HY, h, 0)> 0 then
				call UnitReduceStateBonus(whichUnit, LoadInteger(HY, h, 0), UNIT_BONUS_DAMAGE)
			endif
		endif
		if (LoadBoolean(HY, h, 277)) == false then
			call SaveBoolean(HY, h, 277,(true))
			call SetHeroAgi(targetUnit, GetHeroAgi(targetUnit, false)+ agi, true)
			call SetHeroStr(targetUnit, GetHeroStr(targetUnit, false)+ str, true)
			call SetHeroInt(targetUnit, GetHeroInt(targetUnit, false)+ int, true)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function CKA takes unit u, unit targetUnit returns nothing
	local trigger t
	local integer h
	local integer agi
	local integer str
	local integer int
	local integer i = LoadInteger(ObjectHashTable, GetHandleId(u), QL)+ 1
	local integer pid = GetPlayerId(GetOwningPlayer(u))
	set agi = IMinBJ(GetHeroAgi(targetUnit, false)-1, 1)
	set str = IMinBJ(GetHeroStr(targetUnit, false)-1, 1)
	set int = IMinBJ(GetHeroInt(targetUnit, false)-1, 1)
	if i > 3 then
		set i = 1
	endif
	call SaveInteger(ObjectHashTable, GetHandleId(u), QL, i)
	if ((not(Mode__BalanceOff)) and(i < 3 or IsUnitIdType(GetUnitTypeId(u), UNIT_TYPE_RANGED_ATTACKER) == false)) or Mode__BalanceOff then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SetHeroAgi(u, GetHeroAgi(u, false)+ agi + str + int, true)
		call SaveInteger(OtherHashTable, GetHandleId(u), 31, LoadInteger(OtherHashTable, GetHandleId(u), 31)+ agi + str + int)
		call SetAbilitydataD(u,'QP1F', LoadInteger(OtherHashTable, GetHandleId(u), 31))
		if GetHeroMainAttributesType(u)!= HERO_ATTRIBUTE_AGI then
			call UnitAddStateBonus(u, agi + str + int, UNIT_BONUS_DAMAGE)
			call SaveInteger(HY, h, 0, agi + str + int)
		endif
		call SetHeroAgi(targetUnit, GetHeroAgi(targetUnit, false)-agi, true)
		call SetHeroStr(targetUnit, GetHeroStr(targetUnit, false)-str, true)
		call SetHeroInt(targetUnit, GetHeroInt(targetUnit, false)-int, true)
		call SaveInteger(HY, h, 422, agi)
		call SaveInteger(HY, h, 424, str)
		call SaveInteger(HY, h, 423, int)
		call SaveUnitHandle(HY, h, 2, u)
		call SaveUnitHandle(HY, h, 17, targetUnit)
		call SaveBoolean(HY, h, 276, false)
		call SaveBoolean(HY, h, 277, false)
		call TriggerRegisterTimerEvent(t, 20 * GetUnitAbilityLevel(u,'A1HR') , false)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function CJA))
		set t = null
	endif
	set t = null
endfunction
function CLA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 2)
	local unit target = LoadUnitHandle(HY, h, 17)
	if GetTriggerEventId()!= EVENT_WIDGET_DEATH then
		call CKA(u, target)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set target = null
	return false
endfunction
function CMA takes unit u, unit target returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerAddCondition(t, Condition(function CLA))
	call TriggerRegisterDeathEvent(t, u)
	call TriggerRegisterDeathEvent(t, target)
	call SaveUnitHandle(HY, h, 2, u)
	call SaveUnitHandle(HY, h, 17, target)
	set t = null
endfunction

function CSA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer count = GetTriggerEvalCount(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local lightning APX = LoadLightningHandle(HY, h, 196)
	local integer level = LoadInteger(HY, h, 5)
	local real sx = LoadReal(HY, h, 189)
	local real sy = LoadReal(HY, h, 190)
	local real tx = GetUnitX(targetUnit)
	local real ty = GetUnitY(targetUnit)
	local real targetX
	local real targetY
	local real GXR = LoadReal(HY, h, 23)
	local real GOR = LoadReal(HY, h, 24)
	local real a
	local real GIX = GetDistanceBetween(GXR, GOR, tx, ty)
	call SaveReal(HY, h, 23,((tx)* 1.))
	call SaveReal(HY, h, 24,((ty)* 1.))
	if GIX > 100  or count >(3.5 / .03) or IsUnitMagicImmune(targetUnit) or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call DestroyLightning(APX)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call MoveLightning(APX, true, sx, sy, tx, ty)
		if GetDistanceBetween(sx, sy, tx, ty)> 325 then
			set a = Atan2(ty -sy, tx -sx)
			set targetX = sx + 325 * Cos(a)
			set targetY = sy + 325 * Sin(a)
			call SetUnitX(targetUnit, targetX)
			call SetUnitY(targetUnit, targetY)
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set APX = null
	return false
endfunction
function CTA takes unit whichUnit, unit targetUnit, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local lightning APX = AddLightning("PONC", true, GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitX(targetUnit), GetUnitY(targetUnit))
	call SetLightningColor(APX, 1, 1, 1, 1)
	call SaveLightningHandle(HY, h, 196,(APX))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h, 189,((GetUnitX(whichUnit))* 1.))
	call SaveReal(HY, h, 190,((GetUnitY(whichUnit))* 1.))
	call SaveReal(HY, h, 23,((GetUnitX(targetUnit))* 1.))
	call SaveReal(HY, h, 24,((GetUnitY(targetUnit))* 1.))
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function CSA))
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, 60 * level)
	call IssueTargetOrderById(whichUnit, 851983, targetUnit)
	set t = null
	set APX = null
endfunction
function CUA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer count = GetTriggerEvalCount(t)
	local integer level = LoadInteger(HY, h, 5)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local real a = LoadReal(HY, h, 13)
	local real JBR = LoadReal(HY, h, 189)
	local real JCR = LoadReal(HY, h, 190)
	local real tx = LoadReal(HY, h, 47)
	local real ty = LoadReal(HY, h, 48)
	local real targetX = JBR +(30 *(20 + 4 * 2)/ 30)* count * Cos(a * bj_DEGTORAD)
	local real targetY = JCR +(30 *(20 + 4 * 2)/ 30)* count * Sin(a * bj_DEGTORAD)
	local real ZNR = SquareRoot((targetX -tx)*(targetX -tx)+(targetY -ty)*(targetY -ty))
	local real ZBR = 700
	local real ZCR = 175
	local real ZDR =(1 -ZNR / ZBR)* ZCR * 2
	local group g = AllocationGroup(428)
	local unit targetUnit
	if count == 1 then
		call SetUnitTimeScale(whichUnit, 1.5)
	endif
	if ZDR > ZCR then
		set ZDR = ZCR * 2 -ZDR
	endif
	if O0X(whichUnit) == false then
		call SetUnitFlyHeight(whichUnit, GetUnitDefaultFlyHeight(whichUnit)+ RMaxBJ(ZDR, 0), 0)
	endif
	if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
		call SaveBoolean(OtherHashTable, GetHandleId(whichUnit), 99, true)
	endif
	call SetUnitX(whichUnit, CoordinateX50(targetX))
	call SetUnitY(whichUnit, CoordinateY50(targetY))
	call EXSetUnitFacing(whichUnit, a)
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, targetX, targetY, 120, Condition(function D8X))
	set targetUnit = FirstOfGroup(g)
	call DeallocateGroup(g)
	if ZNR < 30 or targetUnit != null or GetTriggerEvalCount(t)> 75 then
		if O0X(whichUnit) == false then
			call SetUnitFlyHeight(whichUnit, GetUnitDefaultFlyHeight(whichUnit), 0)
		endif
		call SetUnitFacing(whichUnit, a)
		call SetUnitTimeScale(whichUnit, 1)
		call SetUnitAnimation(whichUnit, "stand")
		call SetUnitPathing(whichUnit, true)
		call UnitRemoveAbility(whichUnit,'A1J6')
		call KillTreeByCircle(GetUnitX(whichUnit), GetUnitY(whichUnit), 100)
		if targetUnit != null and IsUnitMagicImmune(targetUnit) == false then
			call EPX(targetUnit, 4408, 5)
			call CTA(whichUnit, targetUnit, level)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set g = null
	return false
endfunction
function BLE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A1J7')
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real GIX = 700
	local real a
	local real sx
	local real sy
	local real tx
	local real ty
	if GetUnitTypeId(u)=='e00E' then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))] 
	endif
	set a = GetUnitFacing(u)
	set sx = GetUnitX(u)
	set sy = GetUnitY(u)
	set tx = CoordinateX50(sx + GIX * Cos(a * bj_DEGTORAD))
	set ty = CoordinateY50(sy + GIX * Sin(a * bj_DEGTORAD))
	call UnitAddAbility(u,'Amrf')
	call UnitRemoveAbility(u,'Amrf')
	call SetUnitPathing(u, false)
	call UnitAddPermanentAbility(u,'A1J6')
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function CUA))
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveReal(HY, h, 189,((sx)* 1.))
	call SaveReal(HY, h, 190,((sy)* 1.))
	call SaveReal(HY, h, 47,((tx)* 1.))
	call SaveReal(HY, h, 48,((ty)* 1.))
	set u = null
	set t = null
endfunction
function CWA takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit whichUnit = U2
	local unit targetUnit = MissileHitTargetUnit
	local real IXX = LoadReal(HY, h, 20)
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, IXX)
	set whichUnit = null
	set targetUnit = null
endfunction
function CYA takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetEnumUnit()
	local trigger t = LaunchMissileByUnitDummy(whichUnit, targetUnit,'h0BP', "CWA", 700, false)
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(whichUnit,'A04A')
	local real IXX
	if level == 1 then
		set IXX = 135
	elseif level == 2 then
		set IXX = 215
	elseif level == 3 then
		set IXX = 275
	elseif level == 4 then
		set IXX = 350
	endif
	call SaveReal(HY, h, 20,((IXX)* 1.))
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function BPE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local group g = AllocationGroup(429)
	local integer level = GetUnitAbilityLevel(whichUnit,'A04A')
	call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 500, Condition(function DDX))
	call ForGroup(g, function CYA)
	call DeallocateGroup(g)
	call PlaySoundOnUnitBJ(QE, 100, whichUnit)
	set whichUnit = null
	set g = null
endfunction


function C7A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit = LoadUnitHandle(HY, h, 3)
	local real r = LoadReal(HY, h, 0)-0.1
	local unit d
	if GetTriggerEventId() == EVENT_UNIT_SPELL_ENDCAST then
		call FIX(targetUnit)
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	elseif r <= 0 then
		call FIX(targetUnit)
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
		call EXStopUnit(whichUnit)
	else
		call SaveReal(HY, h, 0, r)
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, LoadReal(HY, h, 1))
		if GetUnitAbilityLevel(targetUnit,'Bdet') == 0 then
			call FAX(whichUnit, targetUnit)
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function B3E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(whichUnit,'A00P')
	local unit targetUnit = GetSpellTargetUnit()
	local real damageValue = 0
	local unit d
	if level == 1 then
		set damageValue = 4.28
	elseif level == 2 then
		set damageValue = 5.14
	elseif level == 3 then
		set damageValue = 5.58
	else
		set damageValue = 6.
	endif
	call TriggerRegisterTimerEvent(t, .1, true)
	call SaveReal(HY, h, 0, 2.75 + .75 * level)
	call SaveReal(HY, h, 1, damageValue)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function C7A))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 3, targetUnit)
	call FAX(whichUnit, targetUnit)
	set targetUnit = null
	set whichUnit = null
	set t = null
endfunction
function C8A takes unit u returns nothing
	local integer level = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A0A8')
	if level > 0 then
		call UnitAddPermanentAbilitySetLevel(u,'A3IO', level)
	endif
endfunction
function B4E takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetUnitFacing(GetTriggerUnit()))
	call UnitAddAbility(d,'A3IB')
	call SetUnitAbilityLevel(d,'A3IB', GetUnitAbilityLevel(GetTriggerUnit(),'A010'))
	call IssueTargetOrderById(d, 852587, GetSpellTargetUnit())
	set d = null
endfunction
function C9A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 5)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetTriggerEvalCount(t) == 4 or IsUnitMagicImmune(whichUnit) then
		call WHV(targetUnit,'D011')
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	if GetTriggerEventId()!= EVENT_WIDGET_DEATH then
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 10+(level -1)* 20)
	endif
	set t = null
	set targetUnit = null
	set whichUnit = null
	return false
endfunction
function DVA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer c = LoadInteger(HY, h, 0)+ 1
	if IsUnitMagicImmune(u) or c > 20 or UnitIsDead(u) then
		call UnitRemoveAbility(u,'A43V')
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	else
		call SaveInteger(HY, h, 0, c)
	endif
	set u = null
	set t = null
endfunction
function DEA takes unit u returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .1, true, function DVA)
	call UnitAddPermanentAbility(u,'A43V')
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	set t = null
endfunction
function DXA takes unit u, unit whichUnit, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerAddCondition(t, Condition(function C9A))
	call UnitAddAbilityLevel1ToTimed(whichUnit,'C011','D011', 4)
	if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
		call DEA(whichUnit)
	endif
	call SaveUnitHandle(HY, h, 2, u)
	call SaveUnitHandle(HY, h, 17, whichUnit)
	call SaveInteger(HY, h, 5,(level))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl", whichUnit, "chest")))
	set t = null
endfunction
function DOA takes nothing returns boolean
	local unit u = GetEnumUnit()
	if IsUnitInGroup(u, PVV) == false and IsUnitMagicImmune(u) == false then
		call GroupAddUnit(PVV, u)
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\FireBlast.mdx", u, "chest"))
		call DXA(PXV, u, PEV)
	endif
	set u = null
	return false
endfunction
function DRA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer count =(LoadInteger(HY, h, 34))
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local real sx =(LoadReal(HY, h, 189))
	local real sy =(LoadReal(HY, h, 190))
	local real tx =(LoadReal(HY, h, 47))
	local real ty =(LoadReal(HY, h, 48))
	local real a =(LoadReal(HY, h, 13))
	local real DIA =(1 -I2R(count)/ 50)* bj_PI
	local real DAA = 1400/ 2 * Cos(DIA)
	local real DNA = 500 / 2 * Sin(DIA)
	local real x = CoordinateX50(tx + DAA * Cos(a)-DNA * Sin(a))
	local real y = CoordinateY50(ty + DAA * Sin(a)+ DNA * Cos(a))
	local group CNO =(LoadGroupHandle(HY, h, 133))
	local group g
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or(GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()!='A1Z2' and count > 0) or count > 100  or C6X(whichUnit) then
		call KillTreeByCircle(x, y, 300)
		call SetUnitVertexColorEx(whichUnit,-1,-1,-1, 255)
		if  Rubick_AbilityFilter(whichUnit , 'A1RJ') then
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1RJ', true)
		endif
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A20N', false)
		call SetUnitPathing(whichUnit, true)
		call DeallocateGroup(CNO)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if ModuloInteger(count, 10) == 0 then
			call KillTreeByCircle(x, y, 200)
		endif
		call SaveInteger(HY, h, 34,(count + 1))
		if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
			call SaveBoolean(OtherHashTable, GetHandleId(whichUnit), 99, true)
		endif
		call SetUnitX(whichUnit, x)
		call SetUnitY(whichUnit, y)
		call SetUnitFacing(whichUnit,(a + DIA -bj_PI / 2)* bj_RADTODEG)
		set g = AllocationGroup(432)
		set PVV = CNO
		set U2 = whichUnit
		set PXV = whichUnit
		set PEV = level
		call GroupEnumUnitsInRange(g, x, y, 325, Condition(function DQX))
		call ForGroup(g, function DOA)
		call DeallocateGroup(g)
	endif
	set t = null
	set whichUnit = null
	set g = null
	set CNO = null
	return false
endfunction
function B6E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local real sx = GetUnitX(whichUnit)
	local real sy = GetUnitY(whichUnit)
	local real a = AngleBetweenXY(sx, sy, GetSpellTargetX(), GetSpellTargetY())* bj_DEGTORAD
	local real tx = sx + 1400/ 2 * Cos(a)
	local real ty = sy + 1400/ 2 * Sin(a)
	local real L2O = GetWidgetLife(whichUnit)
	call SetWidgetLife(whichUnit, L2O -L2O * .15)
	call EPX(whichUnit, 4301, 2)
	call EPX(whichUnit, 4415, 2)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function DRA))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveReal(HY, h, 189,((sx)* 1.))
	call SaveReal(HY, h, 190,((sy)* 1.))
	call SaveReal(HY, h, 47,((tx)* 1.))
	call SaveReal(HY, h, 48,((ty)* 1.))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	call SaveGroupHandle(HY, h, 133,(AllocationGroup(433)))
	call SetUnitPathing(whichUnit, false)
	call SetUnitVertexColorEx(whichUnit,-1,-1,-1, 50)
	call UnitAddPermanentAbility(whichUnit,'A20N')
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1RJ', false)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A20N', true)
	set t = null
	set whichUnit = null
endfunction
function DBA takes nothing returns nothing
	local unit whichUnit = POV
	local unit targetUnit = GetEnumUnit()
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, 40 + 20 * PRV)
	call ARX("Doodads\\Cinematic\\FireTrapUp\\FireTrapUp.mdl", targetUnit, "origin", 1)
	set whichUnit = null
	set targetUnit = null
endfunction
function DCA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local integer level = LoadInteger(HY, h, 0)
	local group g
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set U2 = whichUnit
		set POV = whichUnit
		set PRV = level
		set g = AllocationGroup(434)
		call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 1025, Condition(function DHX))
		call ForGroup(g, function DBA)
		call DeallocateGroup(g)
		set g = null
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function DDA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit DFA = LoadUnitHandle(HY, h, 589)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 3)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if AD > 0 or IsUnitIllusion(GetEventDamageSource()) then
			call SetUnitToReduceDamage(DFA, GetEventDamage())
		endif
	else
		if GetUnitX(DFA)!= x or GetUnitY(DFA)!= y then
			call SetUnitPosition(DFA, x, y)
		endif
		call IssueImmediateOrderById(targetUnit, 851972)
		if GetUnitX(targetUnit)!= x or GetUnitY(targetUnit)!= y then
			call SetUnitPosition(targetUnit, x, y)
		endif
		if GetUnitY(whichUnit)!= x or GetUnitY(whichUnit)!= y then
			call SetUnitPosition(whichUnit, x, y)
		endif
		set DFA = LoadUnitHandle(HY, h, 19)
		call SetUnitX(DFA, GetWidgetX(whichUnit))
		call SetUnitY(DFA, GetWidgetY(whichUnit))
	endif
	if GetTriggerEvalCount(t) == 1 then
		call PauseUnit(whichUnit, true)
	endif
	set t = null
	set DFA = null
	set whichUnit = null
	return false
endfunction
function DGA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 3)
	local unit DHA = LoadUnitHandle(HY, h, 588)
	local unit DFA = LoadUnitHandle(HY, h, 589)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local unit DJA = LoadUnitHandle(HY, h, 239)
	local integer level = LoadInteger(HY, h, 0)
	local group g
	local unit dummyCaster
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		call StopSound(IF, false, false)
		call ShowUnit(DHA, false)
		call ShowUnit(DJA, false)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call ShowUnit(whichUnit, true)
		call UnitRemoveAbility(whichUnit,'A04R')
		call SetUnitInvulnerable(whichUnit, false)
		call PauseUnit(whichUnit, false)
		if targetUnit != null and targetUnit != whichUnit then
			call ShowUnit(targetUnit, true)
			call UnitRemoveAbility(targetUnit,'A04R')
			call SetUnitInvulnerable(targetUnit, false)
			call PauseUnit(targetUnit, false)
			if LocalPlayer== GetOwningPlayer(targetUnit) then
				call ClearSelection()
				call SelectUnit(targetUnit, true)
			endif
			call SetWidgetLife(targetUnit, 1)
			set dummyCaster = CreateUnit(GetOwningPlayer(GetKillingUnit()),'e00E', 0, 0, 0)
			if IsUnitType(targetUnit, UNIT_TYPE_SUMMONED) == false then
				call UnitRemoveBuffs(targetUnit, true, true)
			endif
			call UnitRemoveAbility(targetUnit,'Aetl')
			call UnitDamageTargetEx(dummyCaster, targetUnit, 4, 100000000)
		endif
		if LocalPlayer== GetOwningPlayer(whichUnit) then
			call ClearSelection()
			call SelectUnit(whichUnit, true)
		endif
		call SetWidgetLife(whichUnit, 1)
		set dummyCaster = CreateUnit(GetOwningPlayer(GetKillingUnit()),'e00E', 0, 0, 0)
		if IsUnitType(whichUnit, UNIT_TYPE_SUMMONED) == false then
			call UnitRemoveBuffs(whichUnit, true, true)
		endif
		call UnitRemoveAbility(whichUnit,'Aetl')
		call UnitDamageTargetEx(dummyCaster, whichUnit, 4, 100000000)
		set dummyCaster = null
	else
		if GetTriggerEvalCount(t) == 1 then
			call SetUnitFlyHeight(DFA, 0, 200)
		elseif GetTriggerEvalCount(t) == 2 then
			call PauseUnit(DFA, false)
			call UnitApplyTimedLife(DFA,'BTLF', .1)
			call StopSound(IF, false, false)
			call StartSound(OF)
			call DestroyEffect(AddSpecialEffect("war3mapImported\\FireNova2.mdx", GetUnitX(DHA), GetUnitY(DHA)))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call ShowUnit(whichUnit, true)
			call UnitRemoveAbility(whichUnit,'A04R')
			call GBX(targetUnit)
			call TWE(whichUnit, false)
			call FixUnitSkillsBug(whichUnit)
			call SetUnitInvulnerable(whichUnit, false)
			call SetUnitAnimationByIndex(whichUnit, 8)
			call QueueUnitAnimation(whichUnit, "idle")
			call PauseUnit(whichUnit, false)
			if LocalPlayer== GetOwningPlayer(whichUnit) then
				call ClearSelection()
				call SelectUnit(whichUnit, true)
			endif
			if targetUnit != null and targetUnit != whichUnit then
				call ShowUnit(targetUnit, true)
				call UnitRemoveAbility(targetUnit,'A04R')
				call SetUnitInvulnerable(targetUnit, false)
				call SetUnitAnimationByIndex(targetUnit, 8)
				call QueueUnitAnimation(targetUnit, "idle")
				call PauseUnit(targetUnit, false)
				call TWE(targetUnit, false)
				call FixUnitSkillsBug(targetUnit)
				call GBX(targetUnit)
				if LocalPlayer== GetOwningPlayer(targetUnit) and IsUnitIllusion(targetUnit) == false then
					call ClearSelection()
					call SelectUnit(targetUnit, true)
				endif
				call EPX(targetUnit,'AFRZ', .03)
				call SetWidgetLife(targetUnit, GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE))
				call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MAX_MANA))
			endif
			call ShowUnit(DHA, false)
			call ShowUnit(DJA, false)
			call EPX(whichUnit,'AFRZ', .03)
			call SetWidgetLife(whichUnit, GetUnitState(whichUnit, UNIT_STATE_MAX_LIFE))
			call SetUnitState(whichUnit, UNIT_STATE_MANA, GetUnitState(whichUnit, UNIT_STATE_MAX_MANA))
			set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
			call UnitAddPermanentAbility(dummyCaster,'A1ZT')
			call SetUnitAbilityLevel(dummyCaster,'A1ZT', level)
			call IssueImmediateOrderById(dummyCaster, 852127)
			set dummyCaster = null
		endif
	endif
	set t = null
	set whichUnit = null
	set DHA = null
	set DJA = null
	set DFA = null
	set g = null
	set targetUnit = null
	return false
endfunction
function DKA takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local unit DHA
	local unit DFA
	local unit DJA = CreateUnit(GetOwningPlayer(whichUnit),'h0CL', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	local integer level = GetUnitAbilityLevel(whichUnit,'A1RK')+ GetUnitAbilityLevel(whichUnit,'A43H')
	local unit dummyCaster
	local unit targetUnit = GetSpellTargetUnit()
	set DHA = CreateUnit(GetOwningPlayer(whichUnit),'h0BX', x, y, 0)
	if level == 1 then
		set DFA = CreateUnit(GetOwningPlayer(whichUnit),'h0CV', x, y, 0)
	elseif level == 2 then
		set DFA = CreateUnit(GetOwningPlayer(whichUnit),'h0CX', x, y, 0)
	elseif level == 3 then
		set DFA = CreateUnit(GetOwningPlayer(whichUnit),'h0CW', x, y, 0)
	endif
	call AddSpecialEffectTarget("war3mapImported\\PhoenixDown_2.mdl", DHA, "origin")
	if LocalPlayer== GetOwningPlayer(whichUnit) then
		call ClearSelection()
		call SelectUnit(DFA, true)
	endif
	call KillTreeByCircle(x, y, 400)
	call SetUnitInvulnerable(whichUnit, true)
	call ShowUnit(whichUnit, false)
	call UnitAddPermanentAbility(whichUnit,'A04R')
	if targetUnit != null and targetUnit != whichUnit then
		call ShowUnit(targetUnit, false)
		call UnitAddPermanentAbility(targetUnit,'A04R')
		call SetUnitX(targetUnit, x)
		call SetUnitY(targetUnit, y)
	endif
	call StartSound(IF)
	call UnitRemoveAbility(DFA,'Arav')
	//	call PauseUnit(DFA,true)
	call UnitApplyTimedLife(DHA,'BTLF', 6.1)
	call UnitApplyTimedLife(DJA,'BTLF', 6.1)
	call UnitApplyTimedLife(DFA,'BTLF', 6.1)
	call TriggerRegisterTimerEvent(t, 5.2, false)
	call TriggerRegisterTimerEvent(t, 6, false)
	call TriggerAddCondition(t, Condition(function DGA))
	call TriggerRegisterUnitEvent(t, DFA, EVENT_UNIT_DEATH)
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 3, targetUnit)
	call SaveUnitHandle(HY, h, 588, DHA)
	call SaveUnitHandle(HY, h, 589, DFA)
	call SaveUnitHandle(HY, h, 239, DJA)
	call SaveReal(HY, h, 6, GetUnitX(whichUnit)* 1.)
	call SaveReal(HY, h, 7, GetUnitY(whichUnit)* 1.)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterUnitEvent(t, DFA, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function DCA))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterUnitEvent(t, DFA, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, DFA, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function DDA))
	call SaveUnitHandle(HY, h, 589, DFA)
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 3, targetUnit)
	call SaveReal(HY, h, 6, GetUnitX(whichUnit)* 1.)
	call SaveReal(HY, h, 7, GetUnitY(whichUnit)* 1.)
	if GYX(whichUnit,'I0A8') then
		set dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', x, y, 0)
		call UnitAddPermanentAbility(dummyCaster,'A04I')
		call SaveUnitHandle(HY, h, 19, dummyCaster)
		set dummyCaster = null
	endif
	set DJA = null
	set t = null
	set whichUnit = null
	set DHA = null
	set DFA = null
	set targetUnit = null
endfunction
function CNE takes nothing returns nothing
	if LoadInteger(HY, GetHandleId(GetTriggerUnit()), 1111111)!= 1 then
		call DKA()
	endif
endfunction
function PWX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A1ZT')
endfunction
function DLA takes unit u, timer t, integer WFV returns nothing
	local player p = GetOwningPlayer(u)
	local integer W0V = GetHandleId(u)
	call DestroyLightning(LoadLightningHandle(ObjectHashTable, WFV, 6))
	call DestroyLightning(LoadLightningHandle(ObjectHashTable, WFV, 5))
	call DestroyLightning(LoadLightningHandle(ObjectHashTable, WFV, 4))
	call DestroyLightning(LoadLightningHandle(ObjectHashTable, WFV, 3))
	call DestroyLightning(LoadLightningHandle(ObjectHashTable, WFV, 2))
	call DeallocateGroup(LoadGroupHandle(ObjectHashTable, WFV, 1))
	call SaveInteger(HY, W0V, 4312, 2)
	if Rubick_AbilityFilter(u , 'A1YY') then
		call SetPlayerAbilityAvailableEx(p,'A1YY', true)
	endif
	if LoadInteger(HY, W0V, 4311)!= 1 then
		call UnitRemoveAbility(u,'Abun')
	endif
	call SetPlayerAbilityAvailableEx(p,'A1YY', true)
	call SaveBoolean(ObjectHashTable, W0V,'A1YY', false)
	call SaveBoolean(ObjectHashTable, W0V,'A205', false)
	call UnitRemoveAbility(u,'A205')
	call UnitRemoveAbility(u,'A1Z3')
	call SetUnitPathing(u, true)
	call SetUnitAnimation(u, "stand")
	call StopSound(WF, false, true)
	call DestroyTimerAndFlushHT_P(t)
	set p = null
endfunction
function DMA takes nothing returns boolean
	local unit t = GetFilterUnit()
	if GetUnitAbilityLevel(t,'A04R') == 0 and UnitAlive(t) and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false and t != Temp__ArrayUnit[0]and(IsUnitType(t, UNIT_TYPE_ANCIENT) == false or DRX(t)!= null) then
		call GroupAddUnit(LoadGroupHandle(ObjectHashTable, XK[0], 1), t)
	endif
	set t = null
	return false
endfunction
function DPA takes nothing returns nothing
	local unit t = GetEnumUnit()
	local real O3O =(Temp__ArrayReal[0] + Temp__ArrayReal[1]* GetUnitState(t, UNIT_STATE_MAX_LIFE))/ 5.
	if IsUnitAlly(Temp__ArrayUnit[0], GetOwningPlayer(t)) then
		call SetWidgetLife(t, GetWidgetLife(t)+ O3O * .5)
	else
		call UnitDamageTargetEx(Temp__ArrayUnit[0], t, 3, O3O)
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\FireRayTarget.mdx", t, "origin"))
		call A8X(GetOwningPlayer(t), 2, GetUnitX(Temp__ArrayUnit[0]), GetUnitY(Temp__ArrayUnit[0]), 500)
	endif
	set t = null
endfunction
function DQA takes unit u, integer WTV returns nothing
	if WTV =='A1Z3' or WTV =='A1RK' or WTV =='A43H' or WTV =='A27H' or WTV =='A30J' then
		call SaveBoolean(ObjectHashTable, GetHandleId(u),'A1YY', true)
	endif
endfunction
function DSA takes unit u, integer S6V returns nothing
	local integer WFV
	local real x2
	local real y2
	local real x1
	local real y1
	if GetUnitAbilityLevel(u,'A205')> 0 then
		if S6V == 851983 then
			call DisableTrigger(UnitEventMainTrig)
			call EXStopUnit(u)
			call SetUnitAnimationByIndex(u, LoadInteger(ObjectHashTable, GetUnitTypeId(u),'A1P8'))
			call EnableTrigger(UnitEventMainTrig)
			return
		endif
		set WFV = LoadInteger(ObjectHashTable, GetHandleId(u),'A1YY')
		if S6V == 852177then
			call SaveBoolean(ObjectHashTable, WFV, 1, true)
			call SetUnitAnimationByIndex(u, LoadInteger(ObjectHashTable, GetUnitTypeId(u),'A1P8'))
		elseif S6V == 852178then
			call SaveBoolean(ObjectHashTable, WFV, 1, false)
			call SetUnitAnimation(u, "stand")
		endif
		if S6V ==851971 then
			set x1 = GetWidgetX(u)
			set y1 = GetWidgetY(u)
			if GetTriggerEventId() == EVENT_UNIT_ISSUED_TARGET_ORDER then
				set x2 = GetWidgetX(GetOrderTargetUnit())
				set y2 = GetWidgetY(GetOrderTargetUnit())
			else
				set x2 = GetOrderPointX()
				set y2 = GetOrderPointY()
			endif
			set x1 = Atan2(y2 -y1, x2 -x1)
			if 0 > x1 then
				set x1 = x1 + 6.28318
			endif
			call SaveBoolean(ObjectHashTable, WFV, 0, true)
			call SaveReal(ObjectHashTable, WFV, 0, x1)
			call SaveReal(ObjectHashTable, WFV, 1, GetUnitFacing(u)* bj_DEGTORAD)
			call DisableTrigger(UnitEventMainTrig)
			call EXStopUnit(u)
			call EnableTrigger(UnitEventMainTrig)
		endif
	endif
endfunction
//烈日炙烤
function DTA takes nothing returns nothing
	local group g = null
	local lightning l = null
	local timer t = GetExpiredTimer()
	local integer DSR
	local integer WUV
	local integer count = 2
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(ObjectHashTable, WFV, 0)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	local boolean active = false
	local real IMX
	local real I3X
	local real DUA
	local real DWA
	local real DYA
	local real DZA
	local real x2
	local real y2
	local real z2
	local real x1
	local real y1
	local real z1
	if LoadInteger(HY, GetHandleId(u), 704) == -1 then//同等脉冲新星,进行二次判断
		if not PlayerHaveAbilityByActive(GetOwningPlayer(u), 'A1YY') then
			set active = true
		endif
	endif 
	set DSR = GetHandleId(u)
	if UnitIsDead(u) or C5X(u) or IsUnitSilence(u) or IsUnitPaused(u) or RCX(u) or active or UYX > 239 or LoadBoolean(ObjectHashTable, DSR,'A1YY') then
		call DLA(u, t, WFV)
		set t = null
		set u = null
		return
	endif
	set x1 = GetWidgetX(u)
	set y1 = GetWidgetY(u)
	set DUA = GetWidgetLife(u)
	set I3X = GetUnitFacing(u)* bj_DEGTORAD
	call SetWidgetLife(u, DUA -DUA * .0015)
	if LoadBoolean(ObjectHashTable, WFV, 0) then
		set I3X = LoadReal(ObjectHashTable, WFV, 0)
		set DWA = I3X -GetUnitFacing(u)* bj_DEGTORAD
		set IMX = LoadReal(ObjectHashTable, WFV, 1)
		set DUA = I3X -IMX
		if DUA > 0 then
			set DYA = bj_DEGTORAD / 2
		else
			set DYA =-bj_DEGTORAD / 2
		endif
		if  -180* bj_DEGTORAD > DUA or DUA > 180* bj_DEGTORAD then
			set DYA =-DYA
		endif
		set I3X = IMX + DYA
		call SaveReal(ObjectHashTable, WFV, 1, I3X)
		if HaveSavedReal(ObjectHashTable, WFV, 2) then
			if 0 > DWA then
				set DWA =-DWA
			endif
			if .02 > DWA then
				call SaveBoolean(ObjectHashTable, WFV, 0, false)
				call RemoveSavedReal(ObjectHashTable, WFV, 2)
			endif
		endif
		if LoadBoolean(ObjectHashTable, WFV, 0) then
			call SaveReal(ObjectHashTable, WFV, 2, DWA)
		endif
		if LoadInteger(HY, DSR, 4301)!= 1 then
			call SetUnitFacing(u, I3X * bj_RADTODEG)
		endif
	endif
	if LoadBoolean(ObjectHashTable, WFV, 1) then
		set x1 = CoordinateX50(x1 + 5 * Cos(I3X))
		set y1 = CoordinateY50(y1 + 5 * Sin(I3X))
		call KillTreeByCircle(x1, y1, 200)
		if IsUnitType(u, UNIT_TYPE_HERO) then
			call SaveBoolean(OtherHashTable, GetHandleId(u), 99, true)
		endif
		call SetUnitX(u, x1)
		call SetUnitY(u, y1)
	endif
	if UYX == 1 then
		call DisableTrigger(UnitEventMainTrig)
		call EXStopUnit(u)
		call EnableTrigger(UnitEventMainTrig)
	endif
	set DYA = Cos(I3X)
	set DZA = Sin(I3X)
	set I3X =(GetUnitFacing(u)+ 90)* bj_DEGTORAD
	set DUA = Cos(I3X)
	set DWA = Sin(I3X)
	set x1 = GetWidgetX(u)+ 50 * DYA
	set y1 = GetWidgetY(u)+ 50 * DZA
	call MoveLocation(Temp__Location, x1, y1)
	set z1 = GetUnitFlyHeight(u)
	if 50 > z1 then
		set z1 = 50
	endif
	set z1 = z1 + GetLocationZ(Temp__Location)
	set x2 = x1 + 1150* DYA
	set y2 = y1 + 1150* DZA
	call MoveLocation(Temp__Location, x2, y2)
	set z2 = GetLocationZ(Temp__Location)
	loop
	exitwhen count == 7
		set I3X = 30 *(count / 5)* Pow(-1, count)
		set IMX = 30 *((8 -count)/ 5)* Pow(-1, count)
		set l = LoadLightningHandle(ObjectHashTable, WFV, count)
		call MoveLightningEx(l, false, x1 + I3X * DUA, y1 + I3X * DWA, z1 + IMX, x2, y2, z2)
		set count = count + 1
	endloop
	call DestroyEffect(AddSpecialEffect("war3mapImported\\FireRayTarget.mdx", x2, y2))
	call SaveInteger(ObjectHashTable, WFV, 0, UYX + 1)
	if UYX / 10== UYX / 10. then
		set x2 = x1
		set y2 = y1
		set count = 0
		set g = LoadGroupHandle(ObjectHashTable, WFV, 1)
		set Temp__ArrayUnit[0]= u
		set XK[0]= WFV
		loop
		exitwhen count == 26
			set x2 = x2 + 50 * DYA
			set y2 = y2 + 50 * DZA
			call GroupEnumUnitsInRange(AK, x2, y2, 100, Condition(function DMA))
			if count / 3 == count / 3.then
				call A8X(GetOwningPlayer(u), 2, x2, y2, 225)
			endif
			set count = count + 1
		endloop
		set WUV = LoadInteger(ObjectHashTable, WFV,-1)
		set I3X = UYX / 239.
		set IMX = 8 * WUV + 8
		set Temp__ArrayReal[0]= IMX + IMX * I3X
		set Temp__ArrayReal[1]=(WUV * 1.25 + I3X *(WUV * 1.25))/ 100 
		call ForGroup(g, function DPA)
		call GroupClear(g)
	endif
	set g = null
	set u = null
	set t = null
	set l = null
endfunction
function YEV takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local timer t = CreateTimer()
	local integer count = 2
	local integer WFV = GetHandleId(t)
	local integer W0V = GetHandleId(u)
	call UnitAddPermanentAbility(u,'Abun')
	call UnitAddPermanentAbility(u,'A205')
	call UnitAddPermanentAbility(u,'A1Z3')
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(u),'A1YY', false)
	call SetUnitPathing(u, false)
	call SaveInteger(ObjectHashTable, W0V,'A1YY', WFV)
	call SaveBoolean(ObjectHashTable, W0V,'A1YY', false)
	call SaveUnitHandle(ObjectHashTable, WFV, 0, u)
	call SaveGroupHandle(ObjectHashTable, WFV, 1, AllocationGroup(435))
	call SaveBoolean(ObjectHashTable, WFV, 0, false)
	call SaveBoolean(ObjectHashTable, WFV, 1, false)
	call SaveInteger(ObjectHashTable, WFV,-1, GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call StartSound(WF)
	call SetSoundPosition(WF, GetWidgetX(u), GetWidgetY(u), 100)
	call SetUnitAnimationByIndex(u, LoadInteger(ObjectHashTable, GetUnitTypeId(u),'A1P8'))
	loop
	exitwhen count == 7
		call SaveLightningHandle(ObjectHashTable, WFV, count, AddLightning("SRAY", false, 0, 0, 0, 0))
		set count = count + 1
	endloop
	call TimerStart(t, .025, true, function DTA)
	set u = null
	set t = null
endfunction
function SYE takes nothing returns nothing
	call UnitAddPermanentAbility(GetTriggerUnit(),'A1YX')
	call SetUnitAbilityLevel(GetTriggerUnit(),'A1YX', GetUnitAbilityLevel(GetTriggerUnit(),'A331'))
endfunction
function D_A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(ObjectHashTable, WFV, 0)
	local unit targetUnit = LoadUnitHandle(ObjectHashTable, WFV, 0)
	if UYX <= 1 or IsUnitMagicImmune(targetUnit) or UnitIsDead(targetUnit) then
		call RemoveSavedHandle(ObjectHashTable, GetHandleId(targetUnit),'A1YX')
		call DestroyEffect(LoadEffectHandle(ObjectHashTable, WFV, 2))
		call DestroyTimerAndFlushHT_P(t)
		call UnitRemoveAbility(targetUnit,'C010')
		call UnitRemoveAbility(targetUnit,'D010')
		set t = null
		set targetUnit = null
		return
	endif
	if UYX / 4 == UYX / 4. then
		call UnitDamageTargetEx(LoadUnitHandle(ObjectHashTable, WFV, 1), targetUnit, 1, LoadInteger(ObjectHashTable, WFV, 1))
	endif
	call SaveInteger(ObjectHashTable, WFV, 0, UYX -1)
	set t = null
	set targetUnit = null
endfunction
function D0A takes unit whichUnit, unit targetUnit, integer level returns nothing
	local timer time = LoadTimerHandle(ObjectHashTable, GetHandleId(targetUnit),'A1YX')
	local integer WFV
	if time != null then
		call SaveInteger(ObjectHashTable, GetHandleId(time), 0, 16)
	else
		set time = CreateTimer()
		set WFV = GetHandleId(time)
		call SaveUnitHandle(ObjectHashTable, WFV, 0, targetUnit)
		call SaveUnitHandle(ObjectHashTable, WFV, 1, whichUnit)
		call SaveEffectHandle(ObjectHashTable, WFV, 2, AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl", targetUnit, "chest"))
		call SaveInteger(ObjectHashTable, WFV, 0, 16)
		call SaveInteger(ObjectHashTable, WFV, 1, level * 20 -5)
		call TimerStart(time, .25, true, function D_A)
		call SaveTimerHandle(ObjectHashTable, GetHandleId(targetUnit),'A1YX', time)
	endif
	set time = null
endfunction
function D1A takes unit targetUnit, integer level returns nothing
	call D0A(Temp__ArrayUnit[0], targetUnit, level)
	call UnitAddPermanentAbility(targetUnit,'C010')
endfunction
function D2A takes nothing returns boolean
	local unit t = GetFilterUnit()
	local unit u = Temp__ArrayUnit[0]
	if IsAliveNotStrucNotWard(t) and IsUnitEnemy(u, GetOwningPlayer(t)) and IsUnitMagicImmune(t) == false then
		call UnitAddAbilityToTimed(t,'A45O'-1 + TempInt, 1, 4, 0)
		call D1A(t, TempInt)
	endif
	set t = null
	set u = null
	return false
endfunction
function D3A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	call ShowUnit(u, false)
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTimer(t)
	set u = null
	set t = null
endfunction
function D4A takes unit u, real d returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, d, false, function D3A)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	set t = null
endfunction
function D5A takes unit whichUnit, unit missileDummy, real x, real y, integer level returns nothing
	set Temp__ArrayUnit[0]= whichUnit
	set TempInt = level
	call GroupEnumUnitsInRange(AK, x, y, 200, Condition(function D2A))
	call DestroyEffect(AddSpecialEffect("war3mapImported\\Firaga_2.mdx", x, y))
	call KillUnit(missileDummy)
	call D4A(missileDummy, 1.)
endfunction
function D6A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer count = LoadInteger(HY, h, 34)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local unit D7A = LoadUnitHandle(HY, h, 393)
	local real D8A = LoadReal(HY, h, 685)
	local real tx
	local real ty
	local real x
	local real y
	local real a
	local real r = 18
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		set tx = GetUnitX(targetUnit)
		set ty = GetUnitY(targetUnit)
		call SaveReal(HY, h, 47, tx * 1.)
		call SaveReal(HY, h, 48, ty * 1.)
		call RemoveSavedHandle(HY, h, 17)
		call SaveUnitHandle(HY, h, 17, null)
	elseif targetUnit == null then
		set tx = LoadReal(HY, h, 47)
		set ty = LoadReal(HY, h, 48)
	else
		set tx = GetUnitX(targetUnit)
		set ty = GetUnitY(targetUnit)
	endif
	set a = AngleBetweenXY(GetUnitX(D7A), GetUnitY(D7A), tx, ty)
	call SetUnitFacing(D7A, a)
	set a = a * bj_DEGTORAD
	set x = GetWidgetX(D7A)+ r * Cos(a)
	set y = GetWidgetY(D7A)+ r * Sin(a)
	call SetUnitX(D7A, x)
	call SetUnitY(D7A, y)
	if GetDistanceBetween(x, y, tx, ty)< r * 2 then
		call D5A(whichUnit, D7A, x, y, level)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set D7A = null
	return false
endfunction
function D9A takes unit whichUnit, unit D7A, unit targetUnit, real D8A, unit dummyCaster returns nothing
	local trigger t = null
	local integer h
	if whichUnit == targetUnit then
		call KillUnit(D7A)
		call ShowUnit(D7A, false)
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SetUnitVertexColor(D7A, 255, 255, 255, 255)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function D6A))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveUnitHandle(HY, h, 393, D7A)
	call SaveReal(HY, h, 47, GetSpellTargetX()* 1.)
	call SaveReal(HY, h, 48, GetSpellTargetY()* 1.)
	call SaveReal(HY, h, 685, D8A * 1.)
	call SaveInteger(HY, h, 0, PI)
	set t = null
endfunction
function FVA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer count = LoadInteger(HY, h, 34)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local real sx = GetUnitX(whichUnit)
	local real sy = GetUnitY(whichUnit)
	local unit FEA = LoadUnitHandle(HY, h, 393)
	local unit FXA = LoadUnitHandle(HY, h, 394)
	local unit FOA = LoadUnitHandle(HY, h, 395)
	local unit FRA = LoadUnitHandle(HY, h, 396)
	local integer level = LoadInteger(HY, h, 0)
	local real a = GetUnitFacing(whichUnit)
	local real x
	local real y
	local group g
	local group g2
	local real VEI =-1 * 360 * .02 / 4
	local real a2
	local real IMX
	local real D8A = LoadReal(HY, h, 685)
	local real REI
	local unit dummyCaster = LoadUnitHandle(HY, h, 19)
	set PI = level
	if GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
		if GetSpellAbilityId()=='A1Z2' then
			if UnitIsDead(FEA) == false then
				call D9A(whichUnit, FEA, GetSpellTargetUnit(), D8A, dummyCaster)
				call RemoveSavedHandle(HY, h, 393)
			elseif UnitIsDead(FXA) == false then
				call D9A(whichUnit, FXA, GetSpellTargetUnit(), D8A, dummyCaster)
				call RemoveSavedHandle(HY, h, 394)
			elseif UnitIsDead(FOA) == false then
				call D9A(whichUnit, FOA, GetSpellTargetUnit(), D8A, dummyCaster)
				call RemoveSavedHandle(HY, h, 395)
			elseif UnitIsDead(FRA) == false then
				call D9A(whichUnit, FRA, GetSpellTargetUnit(), D8A, dummyCaster)
				call RemoveSavedHandle(HY, h, 396)
				call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1Z2', false)
				if Rubick_AbilityFilter(whichUnit , 'A1YX') then
					call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1YX', true)
				endif
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			endif
		elseif GetSpellAbilityId()=='A1RK' or GetSpellAbilityId()=='A43H' then
			if FEA != null and UnitIsDead(FEA) == false then
				call D9A(whichUnit, FEA, whichUnit, D8A, dummyCaster)
			endif
			if FXA != null and UnitIsDead(FXA) == false then
				call D9A(whichUnit, FXA, whichUnit, D8A, dummyCaster)
			endif
			if FOA != null and UnitIsDead(FOA) == false then
				call D9A(whichUnit, FOA, whichUnit, D8A, dummyCaster)
			endif
			if FRA != null and UnitIsDead(FRA) == false then
				call D9A(whichUnit, FRA, whichUnit, D8A, dummyCaster)
			endif
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1Z2', false)
			if Rubick_AbilityFilter(whichUnit , 'A1YX') then
				call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1YX', true)
			endif
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	else
		set count = count + 1
		call SaveInteger(HY, h, 34, count)
		if FEA != null and UnitIsDead(FEA) == false then
			set IMX = 360 * 4 / 4.
			set a2 = IMX + VEI * count
			set x = CoordinateX50(sx + 200* Cos(a2 * bj_DEGTORAD))
			set y = CoordinateY50(sy + 200* Sin(a2 * bj_DEGTORAD))
			call SetUnitFacing(FEA, a2 -90)
			call SetUnitX(FEA, x)
			call SetUnitY(FEA, y)
		endif
		if FXA != null and UnitIsDead(FXA) == false then
			set IMX = 360 * 3 / 4.
			set a2 = IMX + VEI * count
			set x = CoordinateX50(sx + 200* Cos(a2 * bj_DEGTORAD))
			set y = CoordinateY50(sy + 200* Sin(a2 * bj_DEGTORAD))
			call SetUnitFacing(FXA, a2 -90)
			call SetUnitX(FXA, x)
			call SetUnitY(FXA, y)
		endif
		if FOA != null and UnitIsDead(FOA) == false then
			set IMX = 360 * 2 / 4.
			set a2 = IMX + VEI * count
			set x = CoordinateX50(sx + 200* Cos(a2 * bj_DEGTORAD))
			set y = CoordinateY50(sy + 200* Sin(a2 * bj_DEGTORAD))
			call SetUnitFacing(FOA, a2 -90)
			call SetUnitX(FOA, x)
			call SetUnitY(FOA, y)
		endif
		if FRA != null and UnitIsDead(FRA) == false then
			set IMX = 360 * 1 / 4.
			set a2 = IMX + VEI * count
			set x = CoordinateX50(sx + 200* Cos(a2 * bj_DEGTORAD))
			set y = CoordinateY50(sy + 200* Sin(a2 * bj_DEGTORAD))
			call SetUnitFacing(FRA, a2 -90)
			call SetUnitX(FRA, x)
			call SetUnitY(FRA, y)
		endif
		if count > 800 or GetTriggerEventId() == EVENT_WIDGET_DEATH then
			if FEA != null and UnitIsDead(FEA) == false then
				call D9A(whichUnit, FEA, whichUnit, D8A, dummyCaster)
			endif
			if FXA != null and UnitIsDead(FXA) == false then
				call D9A(whichUnit, FXA, whichUnit, D8A, dummyCaster)
			endif
			if FOA != null and UnitIsDead(FOA) == false then
				call D9A(whichUnit, FOA, whichUnit, D8A, dummyCaster)
			endif
			if FRA != null and UnitIsDead(FRA) == false then
				call D9A(whichUnit, FRA, whichUnit, D8A, dummyCaster)
			endif
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1Z2', false)
			if Rubick_AbilityFilter(whichUnit , 'A1YX') then
				call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1YX', true)
			endif
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			call SaveReal(HY, h, 685, RMinBJ(.25 + .75 *(I2R(count)/ 500.), 1))
			if count == 625 then
				call BYX(XF, GetOwningPlayer(whichUnit))
			endif
			if count > 600 then
				if ModuloInteger(count, 10) == 0 or ModuloInteger(count, 10) == 1 or ModuloInteger(count, 10) == 2 or ModuloInteger(count, 10) == 3 or ModuloInteger(count, 10) == 4 then
					call SetUnitVertexColor(FEA, 255, 0, 0, 255)
					call SetUnitVertexColor(FXA, 255, 0, 0, 255)
					call SetUnitVertexColor(FOA, 255, 0, 0, 255)
					call SetUnitVertexColor(FRA, 255, 0, 0, 255)
				else
					call SetUnitVertexColor(FEA, 255, 255, 255, 255)
					call SetUnitVertexColor(FXA, 255, 255, 255, 255)
					call SetUnitVertexColor(FOA, 255, 255, 255, 255)
					call SetUnitVertexColor(FRA, 255, 255, 255, 255)
				endif
			endif
		endif
	endif
	set t = null
	set whichUnit = null
	set FEA = null
	set FXA = null
	set FOA = null
	set FRA = null
	set g = null
	set g2 = null
	set dummyCaster = null
	return false
endfunction
function CFE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local real sx = GetUnitX(whichUnit)
	local real sy = GetUnitY(whichUnit)
	local real x
	local real y
	local unit FEA
	local unit FXA
	local unit FOA
	local unit FRA
	local real a = GetUnitFacing(whichUnit)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', sx, sy, 0)
	call SetWidgetLife(whichUnit, GetWidgetLife(whichUnit)-GetWidgetLife(whichUnit)* .15)
	call UnitAddPermanentAbility(whichUnit,'A1Z2')
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1Z2', true)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1YX', false)
	set x = GetUnitX(whichUnit)+ 200* Cos(bj_DEGTORAD * 360 * 4 / 4. *-1.)
	set y = GetUnitY(whichUnit)+ 200* Sin(bj_DEGTORAD * 360 * 4 / 4. *-1.)
	set FEA = CreateUnit(GetOwningPlayer(whichUnit),'h0CU', x, y, 360 * 4 / 4. *-1.)
	set x = GetUnitX(whichUnit)+ 200* Cos(bj_DEGTORAD * 360 * 3 / 4. *-1.)
	set y = GetUnitY(whichUnit)+ 200* Sin(bj_DEGTORAD * 360 * 3 / 4. *-1.)
	set FXA = CreateUnit(GetOwningPlayer(whichUnit),'h0CU', x, y, 360 * 3 / 4. *-1.)
	set x = GetUnitX(whichUnit)+ 200* Cos(bj_DEGTORAD * 360 * 2 / 4. *-1.)
	set y = GetUnitY(whichUnit)+ 200* Sin(bj_DEGTORAD * 360 * 2 / 4. *-1.)
	set FOA = CreateUnit(GetOwningPlayer(whichUnit),'h0CU', x, y, 360 * 2 / 4. *-1.)
	set x = GetUnitX(whichUnit)+ 200* Cos(bj_DEGTORAD * 360 * 1 / 4. *-1.)
	set y = GetUnitY(whichUnit)+ 200* Sin(bj_DEGTORAD * 360 * 1 / 4. *-1.)
	set FRA = CreateUnit(GetOwningPlayer(whichUnit),'h0CU', x, y, 360 * 1 / 4. *-1.)
	call SetUnitScale(FEA, 2.25, 2.25, 2.25)
	call SetUnitScale(FXA, 2.25, 2.25, 2.25)
	call SetUnitScale(FOA, 2.25, 2.25, 2.25)
	call SetUnitScale(FRA, 2.25, 2.25, 2.25)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerAddCondition(t, Condition(function FVA))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 393, FEA)
	call SaveUnitHandle(HY, h, 394, FXA)
	call SaveUnitHandle(HY, h, 395, FOA)
	call SaveUnitHandle(HY, h, 396, FRA)
	call SaveUnitHandle(HY, h, 19, dummyCaster)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	set t = null
	set whichUnit = null
	set FEA = null
	set FXA = null
	set FOA = null
	set FRA = null
	set dummyCaster = null
endfunction
function FIA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer count =(LoadInteger(HY,(GetHandleId(targetUnit)), 627))
	local real FAA =(LoadReal(HY,(GetHandleId(targetUnit)), 628))
	local integer level = GetUnitAbilityLevel(whichUnit,'A1S4')
	local real IXX =(5 + level * 15)* Pow(2, IMinBJ(count, 5)-1)
	if count == 0 then
		set IXX = 0
	else
		set IXX = IXX + IMaxBJ(count -5, 0)* 50
	endif
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SaveInteger(HY,(GetHandleId(targetUnit)), 627, 0)
		call SaveReal(HY,(GetHandleId(targetUnit)), 628,(0 * 1.))
	elseif GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
		if GetSpellAbilityId()=='A1S9' then
			call DestroyEffect((LoadEffectHandle(HY, h, 32)))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call SaveInteger(HY,(GetHandleId(targetUnit)), 627, 0)
			call SaveReal(HY,(GetHandleId(targetUnit)), 628,(0 * 1.))
			if ((LoadInteger(HY,(GetHandleId((targetUnit))),(4293))) == 1) then
				call SetUnitInvulnerable(targetUnit, false)
			endif
			call UnitDamageTargetEx(whichUnit, targetUnit, 1, IXX)
			if ((LoadInteger(HY,(GetHandleId((targetUnit))),(4293))) == 1) then
				call SetUnitInvulnerable(targetUnit, true)
			endif
			call CommonTextTag(I2S(R2I(IXX))+ "!", 2, targetUnit, .025, 100, 0, 200, 216)
		endif
	elseif (GetGameTime())> FAA then
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SaveInteger(HY,(GetHandleId(targetUnit)), 627, 0)
		call SaveReal(HY,(GetHandleId(targetUnit)), 628,(0 * 1.))
		if ((LoadInteger(HY,(GetHandleId((targetUnit))),(4293))) == 1) then
			call SetUnitInvulnerable(targetUnit, false)
		endif
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, IXX)
		if ((LoadInteger(HY,(GetHandleId((targetUnit))),(4293))) == 1) then
			call SetUnitInvulnerable(targetUnit, true)
		endif
		call CommonTextTag(I2S(R2I(IXX))+ "!", 2, targetUnit, .025, 100, 0, 200, 216)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function FNA takes unit whichUnit, unit targetUnit returns nothing
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(whichUnit,'A1S4')
	local unit missileDummy
	if (LoadInteger(HY,(GetHandleId(targetUnit)), 627))> 0 then
		call SaveInteger(HY,(GetHandleId(targetUnit)), 627,((LoadInteger(HY,(GetHandleId(targetUnit)), 627))+ 1))
		call SaveReal(HY,(GetHandleId(targetUnit)), 628,(((GetGameTime())+ 10)* 1.))
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(whichUnit))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SaveInteger(HY,(GetHandleId(targetUnit)), 627, 1)
		if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
			call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\shamanyouranus-ShadowyMissile.mdl", targetUnit, "chest")))
		else
			call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\shamanyouranus-ShadowyMissile.mdl", targetUnit, "origin")))
		endif
		call SaveReal(HY,(GetHandleId(targetUnit)), 628,(((GetGameTime())+ 10)* 1.))
		call TriggerRegisterTimerEvent(t, .05, true)
		call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function FIA))
		set missileDummy = null
	endif
	call CommonTextTag("+" + I2S((LoadInteger(HY,(GetHandleId(targetUnit)), 627))), 3, targetUnit, .025, 100, 0, 200, 216)
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, 50)
	set t = null
endfunction
function FBA takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), PAV) == false then
		call GroupAddUnit(PAV, GetEnumUnit())
		call FNA(PIV, GetEnumUnit())
	endif
endfunction
function FCA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit missileDummy =(LoadUnitHandle(HY, h, 45))
	local integer count = GetTriggerEvalCount(t)
	local real a =(LoadReal(HY, h, 137))
	local real x = CoordinateX50(GetUnitX(missileDummy)+ 20 * Cos(a))
	local real y = CoordinateY50(GetUnitY(missileDummy)+ 20 * Sin(a))
	local group g
	local group CNO =(LoadGroupHandle(HY, h, 133))
	local unit targetUnit
	if count == 75 then
		call DeallocateGroup(CNO)
		call KillUnit(missileDummy)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set U2 = whichUnit
		set PIV = whichUnit
		set PAV = CNO
		call SetUnitX(missileDummy, x)
		call SetUnitY(missileDummy, y)
		set g = AllocationGroup(436)
		call GroupEnumUnitsInRange(g, x, y, 215, Condition(function DPX))
		set targetUnit =(LoadUnitHandle(HY,(GetHandleId(whichUnit)), 673))
		if targetUnit != null then
			if GetDistanceBetween(GetUnitX(targetUnit), GetUnitY(targetUnit), x, y)< 215 and IsUnitEnemy(targetUnit, GetOwningPlayer(whichUnit)) then
				call GroupAddUnit(g, targetUnit)
			endif
		endif
		call ForGroup(g, function FBA)
		set targetUnit = FirstOfGroup(g)
		call DeallocateGroup(g)
	endif
	set t = null
	set whichUnit = null
	set missileDummy = null
	set g = null
	set targetUnit = null
	set CNO = null
	return false
endfunction
function CGE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = AngleBetweenXY(GetUnitX(whichUnit), GetUnitY(whichUnit), x, y)* bj_DEGTORAD
	local unit missileDummy = CreateUnit(GetOwningPlayer(whichUnit),'h0C2', GetUnitX(whichUnit), GetUnitY(whichUnit), a * bj_RADTODEG)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function FCA))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 45,(missileDummy))
	call SaveReal(HY, h, 137,((a)* 1.))
	call SaveGroupHandle(HY, h, 133,(AllocationGroup(437)))
	call UnitAddPermanentAbility(whichUnit,'A1S9')
	set t = null
	set whichUnit = null
	set missileDummy = null
endfunction

function LNE takes nothing returns nothing
	if GetSpellTargetUnit()!= GetTriggerUnit() and IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) and LoadBoolean(HY, GetHandleId(GetOwningPlayer(GetSpellTargetUnit())), 139) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n038'))
	endif
endfunction
function FJA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer level = LoadInteger(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 0)
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if LoadBoolean(HY, h, 0) == false then
			call SaveBoolean(HY, h, 0, true)
			call UnitDamageTargetEx(GetEventDamageSource(), GetTriggerUnit(), 3, GetEventDamage()* LoadReal(HY, h, 0))
			call SaveBoolean(HY, h, 0, false)
		endif
	else
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	return false
endfunction
function SpellEffect__SoulCatcher takes nothing returns nothing
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local group g = AllocationGroup(438)
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit
	local trigger t
	local integer h
	local real r
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, x, y, 475, Condition(function DQX))
	set targetUnit = LoadUnitHandle(HY, GetHandleId(whichUnit), 673)
	if targetUnit != null then
		if GetDistanceBetween(GetUnitX(targetUnit), GetUnitY(targetUnit), x, y)< 475 and IsUnitEnemy(targetUnit, GetOwningPlayer(whichUnit)) then
			call GroupAddUnit(g, targetUnit)
		endif
	endif
	set targetUnit = GroupPickRandomUnit(g)
	call DeallocateGroup(g)
	call DestroyEffect(AddSpecialEffect("war3mapImported\\Desecrate.mdx", x, y))
	if targetUnit != null then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
		call TriggerRegisterTimerEvent(t, 12, false)
		set r = .1 + .1 * GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())
		call TriggerAddCondition(t, Condition(function FJA))
		call SaveReal(HY, h, 0, r)
		call SaveUnitHandle(HY, h, 0, targetUnit)
		call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
		call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("war3mapImported\\void.mdx", targetUnit, "chest"))
	endif
	set g = null
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function time_effect_demonic_purge takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = LoadUnitHandle(HY, h, 2)
	local unit stg_u = LoadUnitHandle(HY, h, 17)
	local integer tri_ec = GetTriggerEvalCount(t)
	if tri_ec == 5 then
		if (LoadInteger(HY, GetHandleId(stg_u), 4293) == 1) then
			call SetUnitInvulnerable(stg_u, false)
		endif
		call UnitDamageTargetEx(trigUnit, stg_u, 1, 4 *(25 + 25 * LoadInteger(HY, h, 0)))
		if (LoadInteger(HY, GetHandleId(stg_u), 4293) == 1) then
			call SetUnitInvulnerable(stg_u, true)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set trigUnit = null
	set stg_u = null
	return false
endfunction
function effect_demonic_purge takes unit u, unit stg_u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(stg_u), GetUnitY(stg_u), 0)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function time_effect_demonic_purge))
	call SaveUnitHandle(HY, h, 2, u)
	call SaveUnitHandle(HY, h, 17, stg_u)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call UnitAddAbility(d,'A1SA')
	call SetUnitAbilityLevel(d,'A1SA', GetUnitAbilityLevel(u,'A343')+ GetUnitAbilityLevel(u,'A34J'))
	call IssueTargetOrderById(d, 852111, stg_u)
	call TriggerEvaluate(t)
	if GetUnitAbilityLevel(u,'A34J')> 0 then
		call CIO(stg_u, 5.)
	endif
	set t = null
	set d = null
endfunction
function enum_demonic_purge takes nothing returns boolean
	if (IsUnitEnemy(LoadUnitHandle(OtherHashTable2,'A1SA','cast'), GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'Aloc') == 0 and IsAliveNotStrucNotWard(GetFilterUnit())))!= null then
		call effect_demonic_purge(LoadUnitHandle(OtherHashTable2,'A1SA','cast'), GetFilterUnit())
	endif
	return false
endfunction
function CUE takes nothing returns nothing
	local group g = AllocationGroup(439)
	set U2 = GetTriggerUnit()
	call SaveUnitHandle(OtherHashTable2,'A1SA','cast', GetTriggerUnit())
	call GroupEnumUnitsInRange(g, GetSpellTargetX(), GetSpellTargetY(), 265, Condition(function enum_demonic_purge))
	call RemoveSavedHandle(OtherHashTable2,'A1SA','cast')
	call DeallocateGroup(g)
	set g = null
endfunction
function timer_charges_demonic_purge takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local real cool_down_time = LoadReal(HY, h, 0)
	local integer ab_charges = LoadInteger(HY, GetHandleId(u),'A34J')
	if ab_charges < 3 then
		set cool_down_time = cool_down_time -0.2
		if cool_down_time <= 0.00 then
			call SaveInteger(HY, GetHandleId(u),'A34J', ab_charges + 1)
			call SaveReal(HY, h, 0, 40.)
		else
			call SaveReal(HY, h, 0, cool_down_time * 1.)
		endif
	endif
	set u = null
	set t = null
	return false
endfunction
function charges_demonic_purge takes unit u returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerAddCondition(t, Condition(function timer_charges_demonic_purge))
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveReal(HY, GetHandleId(t), 0, 40.)
	call SaveInteger(HY, GetHandleId(u),'A34J', 3)
	call SaveTriggerHandle(HY, GetHandleId(u),'A34J', t)
	call DisplayTimedTextToPlayer(GetOwningPlayer(u), 0, 0, 10, "|c00FF0000提示|r: 你可以输入指令|c00bd2222-charges|r来开启或关闭充能计数面板")
	set t = null
endfunction
function demonic_purge_charges0 takes nothing returns nothing //0充能邪恶净化
	local unit u = GetTriggerUnit()
	if HaveSavedHandle(HY, GetHandleId(u),'A34J') == false then
		call charges_demonic_purge(u)
	endif
	if LoadInteger(HY, GetHandleId(u),'A34J')< 1 then
		call InterfaceErrorForPlayer(GetOwningPlayer(u), "邪恶净化能量点数不足.")
		call EXStopUnit(u)
	endif
	set u = null
endfunction
function hystr_demonic_purge takes nothing returns nothing
	call CUE()
	call SaveInteger(HY, GetHandleId(GetTriggerUnit()),'A34J', LoadInteger(HY, GetHandleId(GetTriggerUnit()),'A34J')-1)
endfunction
function LZE takes nothing returns nothing
	local integer h = GetHandleId(GetTriggerUnit())
	if HaveSavedHandle(HY, h,'A34J') == false then
		call charges_demonic_purge(GetTriggerUnit())
	endif
endfunction
function G9X takes nothing returns nothing
	local integer h = GetHandleId(U2)
	if HaveSavedHandle(HY, h,'A34J') == false then
		call charges_demonic_purge(U2)
	endif
endfunction
function FSA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer count = GetTriggerEvalCount(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	call UnitRemoveAbility(whichUnit,'A1SP')
	set t = null
	set whichUnit = null
	return false
endfunction
function Gyro_RocketBarrageOld takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	call UnitAddPermanentAbility(whichUnit,'A1SP')
	call UnitMakeAbilityPermanent(whichUnit, true,'A1SP')
	call SetUnitAbilityLevel(whichUnit,'A1SP', GetUnitAbilityLevel(whichUnit,'A1SO'))
	call TriggerRegisterTimerEvent(t, 3, false)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerAddCondition(t, Condition(function FSA))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	set t = null
	set whichUnit = null
endfunction
function FTA takes nothing returns nothing
	if GetUnitAbilityLevel(GetTriggerUnit(),'B1SP')> 0 then
		call UnitRemoveAbility(GetTriggerUnit(),'B1SP')
	endif
endfunction
function FUA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetTriggerEvalCount(t)> 3 / .05 then
		call UnitRemoveAbility(LoadUnitHandle(HY, h, 2),'A1SP')
		call KillUnit(LoadUnitHandle(HY, h, 19))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SetUnitX(LoadUnitHandle(HY, h, 19), GetUnitX(LoadUnitHandle(HY, h, 2)))
		call SetUnitY(LoadUnitHandle(HY, h, 19), GetUnitY(LoadUnitHandle(HY, h, 2)))
		call SetUnitFlyHeight(LoadUnitHandle(HY, h, 19), GetUnitFlyHeight(LoadUnitHandle(HY, h, 2)), 0)
	endif
	set t = null
	return false
endfunction
function C_E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	if GetUnitTypeId(u)=='e00E' then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))] 
	endif
	call TGV(10)
	call UnitAddPermanentAbility(d,'A1SP')
	call SetUnitAbilityLevel(d,'A1SP', GetUnitAbilityLevel(u,'A1SO'))
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function FUA))
	call SaveUnitHandle(HY,(h), 2,(u))
	call SaveUnitHandle(HY,(h), 19, d)
	set t = null
	set d = null
	set u = null
endfunction
function FWA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer count = GetTriggerEvalCount(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local unit missileDummy = LoadUnitHandle(HY, h, 45)
	local real x
	local real y
	local real d
	local real F0X
	local real GXR = GetUnitX(missileDummy)
	local real GOR = GetUnitY(missileDummy)
	local real a = AngleBetweenXY(GXR, GOR, GetUnitX(targetUnit), GetUnitY(targetUnit))* bj_DEGTORAD
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call UnitShareVision(missileDummy, GetOwningPlayer(targetUnit), false)
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if GetTriggerUnit()!= missileDummy then
			call KillUnit(missileDummy)
		endif
	elseif GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		call UnitRemoveBuffs(missileDummy, true, true)
	elseif count < 3 / .02 then
		call SetUnitFacing(missileDummy, a * bj_RADTODEG)
	else
		if count == 4 / .02 then
			call UnitShareVision(missileDummy, GetOwningPlayer(targetUnit), true)
		endif
		call SetUnitFacing(missileDummy, a * bj_RADTODEG)
		set x = GXR +(280 + 20 * count * .02)* .02 * Cos(a)
		set y = GOR +(280 + 20 * count * .02)* .02 * Sin(a)
		call SetUnitPosition(missileDummy, x, y)
		call SaveReal(HY, h, 23, x * 1.)
		call SaveReal(HY, h, 24, y * 1.)
		if GetDistanceBetween(x, y, GetUnitX(targetUnit), GetUnitY(targetUnit))< 20 then
			set d = RMinBJ(GetDistanceBetween(x, y, LoadReal(HY, h, 6), LoadReal(HY, h, 7)), 1500)
			set x = LoadInteger(HY, h, 0)
			set F0X = d /  1500*(125 * x)
			set F0X = RMaxBJ(F0X, 50)
			call KillUnit(missileDummy)
			call DestroyEffect(LoadEffectHandle(HY, h, 32))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call UnitDamageTargetEx(whichUnit, targetUnit, 1, F0X)
			call CommonUnitAddStun(targetUnit, 2 + .2 * x, false)
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set missileDummy = null
	return false
endfunction
function FYA takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local real a = AngleBetweenXY(GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitX(targetUnit), GetUnitY(targetUnit))* bj_DEGTORAD
	local real x = CoordinateX50(GetUnitX(whichUnit)+ 150* Cos(a))
	local real y = CoordinateY50(GetUnitY(whichUnit)+ 150* Sin(a))
	local integer level = GetUnitAbilityLevel(whichUnit,'A1SQ')
	local unit missileDummy
	local integer OVX
	local string s = "effects\\Snipe Target.mdx"
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(whichUnit)) == false and IsObserverPlayer(LocalPlayer) == false then
		set s = ""
	endif
	if level == 1 then
		set OVX ='h0CG'
	elseif level == 2 then
		set OVX ='h0C1'
	elseif level == 3 then
		set OVX ='h0CF'
	elseif level == 4 then
		set OVX ='h0CH'
	endif
	set missileDummy = CreateUnit(GetOwningPlayer(whichUnit), OVX, x, y, a * bj_RADTODEG)
	call UnitRemoveAbility(missileDummy,'Amov')
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterDeathEvent(t, missileDummy)
	call TriggerRegisterUnitEvent(t, missileDummy, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function FWA))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveInteger(HY, h, 0, level)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveUnitHandle(HY, h, 45, missileDummy)
	call SaveReal(HY, h, 6, GetUnitX(whichUnit)* 1.)
	call SaveReal(HY, h, 7, GetUnitY(whichUnit)* 1.)
	call SaveReal(HY, h, 23, GetUnitX(missileDummy)* 1.)
	call SaveReal(HY, h, 24, GetUnitY(missileDummy)* 1.)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget(s, targetUnit, "overhead"))
	set t = null
	set whichUnit = null
	set targetUnit = null
	set missileDummy = null
endfunction
function C1E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call FYA()
	endif
endfunction
function FZA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local group g
	local integer count = GetTriggerEvalCount(t)
	local fogmodifier fm = LoadFogModifierHandle(HY, h, 42)
	local integer level = LoadInteger(HY, h, 0)
	local unit u2
	if count == 1 then
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Calldown_FlyUp.mdx", whichUnit, "chest"))
	elseif count == 2 then
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Calldown_FlyUp.mdx", whichUnit, "chest"))
	elseif count == 3 then
		call DestroyEffect(AddSpecialEffect("war3mapImported\\Calldown_FlyDown.mdx", x, y))
	elseif count == 4 then
		set g = AllocationGroup(440)
		set U2 = whichUnit
		call GroupEnumUnitsInRange(g, x, y, 625, Condition(function DHX))
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			call UnitDamageTargetEx(whichUnit, u2, 1, level * 50 + 200)
			call UnitAddAbilityToTimed(u2,'A1T3', 1, 2,'B0DG')
			call GroupRemoveUnit(g, u2)
		endloop
		call DeallocateGroup(g)
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\DemolisherFireMissile\\DemolisherFireMissile.mdl", x, y))
	elseif count == 5 then
		call DestroyEffect(AddSpecialEffect("war3mapImported\\Calldown_FlyDown.mdx", x, y))
	elseif count == 6 then
		set g = AllocationGroup(441)
		set U2 = whichUnit
		call GroupEnumUnitsInRange(g, x, y, 625, Condition(function DHX))
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			if LoadBoolean(HY, h, 0) then
				call UnitDamageTargetEx(whichUnit, u2, 1, level * 50 + 50 + 75)
			else
				call UnitDamageTargetEx(whichUnit, u2, 1, level * 50 + 50)
			endif
			call UnitAddAbilityToTimed(u2,'A1ST', 1, 4,'B0DE')
			call GroupRemoveUnit(g, u2)
		endloop
		call DeallocateGroup(g)
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\DemolisherFireMissile\\DemolisherFireMissile.mdl", x, y))
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FogModifierStop(fm)
		call DestroyFogModifier(fm)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set g = null
	set fm = null
	return false
endfunction
function C3E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local string s = ""
	local fogmodifier fm = CreateFogModifierRadius(GetOwningPlayer(whichUnit), FOG_OF_WAR_VISIBLE, x, y, 450, true, true)
	call FogModifierStart(fm)
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(whichUnit)) or IsObserverPlayer(LocalPlayer) then
		set s = "war3mapImported\\CallDown_4.mdx"
	endif
	call TriggerRegisterTimerEvent(t, .1, false)
	call TriggerRegisterTimerEvent(t, .8, false)
	call TriggerRegisterTimerEvent(t, 1.6, false)
	call TriggerRegisterTimerEvent(t, 2, false)
	call TriggerRegisterTimerEvent(t, 3.6, false)
	call TriggerRegisterTimerEvent(t, 4, false)
	call TriggerAddCondition(t, Condition(function FZA))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	call SaveBoolean(HY, h, 0, GetSpellAbilityId()=='A235')
	call SaveReal(HY, h, 6, x * 1.)
	call SaveReal(HY, h, 7, y * 1.)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffect(s, x, y))
	call SaveFogModifierHandle(HY, h, 42, fm)
	set t = null
	set whichUnit = null
	set fm = null
endfunction
function F_A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer F0A = LoadInteger(HY, h, 375)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local integer count
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if GetEventDamageSource() == whichUnit and(GetEventDamage()> 20 or IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE)) and FK then
			set count = LoadInteger(HY, F0A, 34)
			if count > 0 then
				call SaveInteger(HY, F0A, 34, count + 1)
			endif
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function F1A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	if R5X(whichUnit) == false then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(whichUnit,'A237')
		call UnitAddAbility(whichUnit,'A22B')
		call UnitRemoveAbility(whichUnit,'A22B')
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function F2A takes unit whichUnit returns nothing
	local trigger t
	local integer h
	if R5X(whichUnit) == false then
		call UnitRemoveAbility(whichUnit,'A237')
		call UnitAddAbility(whichUnit,'A22B')
		call UnitRemoveAbility(whichUnit,'A22B')
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(whichUnit))
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerAddCondition(t, Condition(function F1A))
		set t = null
	endif
endfunction
function F3A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local integer count = LoadInteger(HY, h, 34)
	local integer level = LoadInteger(HY, h, 0)
	local integer F0A = h
	if GetTriggerEventId() == EVENT_PLAYER_UNIT_ATTACKED then
		if IsUnitIllusion(GetAttacker()) and GetUnitAbilityLevel(GetAttacker(),'A1TW')> 0 then
			call F2A(GetAttacker())
			call UnitRemoveAbility(GetAttacker(),'A1TW')
		endif
		if GetAttacker() == whichUnit then
			set count = count + 1
			if count > 3 + level then
				call UnitRemoveAbility(whichUnit,'A1TW')
				call UnitRemoveAbility(whichUnit,'B0DJ')
				call F2A(whichUnit)
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			else
				set t = CreateTrigger()
				set h = GetHandleId(t)
				call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_DAMAGED)
				call TriggerRegisterTimerEvent(t, 2, false)
				call TriggerAddCondition(t, Condition(function F_A))
				call SaveUnitHandle(HY, h, 2, whichUnit)
				call SaveInteger(HY, h, 375, F0A)
			endif
		endif
	else
		call UnitRemoveAbility(whichUnit,'A1TW')
		call UnitRemoveAbility(whichUnit,'B0DJ')
		call F2A(whichUnit)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function C8E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	call UnitAddAbility(whichUnit,'A1TW')
	call UnitMakeAbilityPermanent(whichUnit, true,'A1TW')
	call TriggerRegisterTimerEvent(t, 15, false)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerAddCondition(t, Condition(function F3A))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveInteger(HY, h, 34, 1)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	call UnitRemoveAbility(whichUnit,'A237')
	set t = null
	set whichUnit = null
endfunction
function F4A takes nothing returns boolean
	local unit targetUnit = GetFilterUnit()
	local unit whichUnit = PNV
	local real sx = PBV
	local real sy = PCV
	local real GRR = PDV
	local real GIR = PFV
	local real x
	local real y
	local real a
	local real d
	if (IsUnitMagicImmune(GetFilterUnit()) == false and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit())) then
		set d = GetDistanceBetween(sx, sy, GetUnitX(targetUnit), GetUnitY(targetUnit))
		set a = AngleBetweenXY(sx, sy, GetUnitX(targetUnit), GetUnitY(targetUnit))* bj_DEGTORAD
		if d > PGV then
			set x = GetUnitX(targetUnit)+ 11* Cos(a)
			set y = GetUnitY(targetUnit)+ 11* Sin(a)
		else
			set x = GetUnitX(targetUnit) -11* Cos(a)
			set y = GetUnitY(targetUnit) -11* Sin(a)
		endif
		call SetUnitX(targetUnit, x)
		call SetUnitY(targetUnit, y)
	endif
	set targetUnit = null
	set whichUnit = null
	return false
endfunction
function F5A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local real sx = LoadReal(HY, h, 6)
	local real sy = LoadReal(HY, h, 7)
	local real x
	local real y
	local integer i = 0
	local group g
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEvalCount(t)>(50 *(2 + .6 * level)) then
		loop
		exitwhen i > 16
			set i = i + 1
		endloop
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set g = AllocationGroup(442)
		set PBV = sx
		set PCV = sy
		set PNV = whichUnit
		set U2 = whichUnit
		loop
		exitwhen i > 16
			set x = sx + PGV * Cos(bj_DEGTORAD * 360. * i / 16.)
			set y = sy + PGV * Sin(bj_DEGTORAD * 360. * i / 16.)
			set PDV = x
			set PFV = y
			call GroupEnumUnitsInRange(g, x, y, 75, Condition(function F4A))
			set i = i + 1
		endloop
		call DeallocateGroup(g)
		set g = null
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function F6A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local real sx = LoadReal(HY, h, 6)
	local real sy = LoadReal(HY, h, 7)
	local real x
	local real y
	local integer i = 0
	local integer level = LoadInteger(HY, h, 0)
	call DestroyEffect(LoadEffectHandle(HY, h, 32))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	loop
	exitwhen i > 16
		set x = sx + PGV * Cos(bj_DEGTORAD * 360. * i / 16.)
		set y = sy + PGV * Sin(bj_DEGTORAD * 360. * i / 16.)
		set i = i + 1
	endloop
	call SaveEffectHandle(HY, h, 32, AddSpecialEffect("war3mapImported\\KineticField_FX_Stand.mdx", sx, sy))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveReal(HY, h, 6, sx * 1.)
	call SaveReal(HY, h, 7, sy * 1.)
	call SaveInteger(HY, h, 0, level)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function F5A))
	set t = null
	set whichUnit = null
	return false
endfunction
function C9E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local real sx = GetSpellTargetX()
	local real sy = GetSpellTargetY()
	call SaveEffectHandle(HY, h, 32, AddSpecialEffect("war3mapImported\\KineticField_FX_Start.mdx", sx, sy))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveReal(HY, h, 6, sx * 1.)
	call SaveReal(HY, h, 7, sy * 1.)
	call TriggerRegisterTimerEvent(t, 1.2, false)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit,'A1SU'))
	call TriggerAddCondition(t, Condition(function F6A))
	call A8X(GetOwningPlayer(whichUnit), 5.5, sx, sy, 325)
	set t = null
	set whichUnit = null
endfunction
function F7A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local unit missileDummy =(LoadUnitHandle(HY, h, 45))
	local real tx =(LoadReal(HY, h, 6))
	local real ty =(LoadReal(HY, h, 7))
	local real x = GetUnitX(missileDummy)
	local real y = GetUnitY(missileDummy)
	local real a = AngleBetweenXY(x, y, tx, ty)
	local real d = GetDistanceBetween(x, y, tx, ty)
	local real r =(LoadReal(HY, h, 671))
	call SetUnitFacing(missileDummy, a)
	set x = x + r * Cos(a * bj_DEGTORAD)
	set y = y + r * Sin(a * bj_DEGTORAD)
	call SetUnitX(missileDummy, x)
	call SetUnitY(missileDummy, y)
	if d < 40 then
		call KillUnit(missileDummy)
		call DestroyEffect((LoadEffectHandle(HY, h, 175)))
		call DestroyEffect((LoadEffectHandle(HY, h, 176)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call EPX(targetUnit, 4411, 1)
		call SetUnitPosition(targetUnit, tx, ty)
		call PanCameraToTimedForPlayer(GetOwningPlayer(targetUnit), tx, ty, 0)
	elseif IsUnitMagicImmune(targetUnit) then
		call KillUnit(missileDummy)
		call DestroyEffect((LoadEffectHandle(HY, h, 175)))
		call DestroyEffect((LoadEffectHandle(HY, h, 176)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	set missileDummy = null
	return false
endfunction
function F8A takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local real x =(LoadReal(HY,(GetHandleId(targetUnit)), 7400))
	local real y =(LoadReal(HY,(GetHandleId(targetUnit)), 7500))
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit missileDummy = CreateUnit(GetOwningPlayer(whichUnit),'h0C6', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local real d = GetDistanceBetween(x, y, GetUnitX(targetUnit), GetUnitY(targetUnit))
	local real r = .02 *(RMaxBJ(d / 1.8, 600))
	call TriggerAddCondition(t, Condition(function F7A))
	call TriggerRegisterTimerEvent(t, .02, true)
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveUnitHandle(HY, h, 45,(missileDummy))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call SaveReal(HY, h, 671,((r)* 1.))
	call SaveEffectHandle(HY, h, 175,(AddSpecialEffectTarget("effects\\Lightning_Ball_Tail_FX.mdx", targetUnit, "overhead")))
	call SaveEffectHandle(HY, h, 176,(AddSpecialEffect("effects\\Lightning_Ball_Tail_FX.mdx", x, y)))
	call TriggerEvaluate(t)
	set whichUnit = null
	set targetUnit = null
	set missileDummy = null
	set t = null
endfunction
function DVE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		if IsUnitIllusion(GetSpellTargetUnit()) then
			call KillUnit(GetSpellTargetUnit())
		else
			call F8A()
		endif
	endif
endfunction
function F9A takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local integer h = GetHandleId(targetUnit)
	local integer i = 1
	loop
	exitwhen i > 14
		call SaveReal(HY, h, 7400 + i -1, LoadReal(HY, h, 7400 + i)* 1.)
		call SaveReal(HY, h, 7500 + i -1, LoadReal(HY, h, 7500 + i)* 1.)
		set i = i + 1
	endloop
	call SaveReal(HY, h, 7400 + 14, GetUnitX(targetUnit)* 1.)
	call SaveReal(HY, h, 7500 + 14, GetUnitY(targetUnit)* 1.)
	set targetUnit = null
endfunction
function GVA takes nothing returns boolean
	local group g = AllocationGroup(443)
	call GroupEnumUnitsInRange(g, 0, 0, 99999, Condition(function FEX))
	call ForGroup(g, function F9A)
	call DeallocateGroup(g)
	set g = null
	return false
endfunction
function PYX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerAddCondition(t, Condition(function GVA))
	set t = null
endfunction
function GEA takes nothing returns nothing
	if PHV != GetEnumUnit() then
		call UnitDamageTargetEx(PJV, GetEnumUnit(), 1, PKV * 20 + 20)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Bolt\\BoltImpact.mdl", GetEnumUnit(), "chest"))
	endif
endfunction
function GXA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local unit dummyCaster = LoadUnitHandle(HY, h, 19)
	local integer level = LoadInteger(HY, h, 5)
	local group g
	local integer count = GetTriggerEvalCount(t)
	local unit d = null
	call SetUnitX(dummyCaster, GetUnitX(targetUnit))
	call SetUnitY(dummyCaster, GetUnitY(targetUnit))
	if count == 1 or count == 100  or count == 200 or count == 300 then
		set g = AllocationGroup(444)
		if UnitIsDead(targetUnit) then
			set d = CreateUnit(GetOwningPlayer(targetUnit),'e00C', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
			call UnitApplyTimedLife(d,'BTLF', .2)
			call IssueTargetOrderById(dummyCaster, 852119, d)
			set d = null
		else
			call IssueTargetOrderById(dummyCaster, 852119, targetUnit)
			call UnitDamageTargetEx(whichUnit, targetUnit, 1, level * 20 + 20)
		endif
		call ARX("war3mapImported\\ThunderStorm_Groundeffect.mdx", targetUnit, "origin", .6)
		set U2 = whichUnit
		set PJV = whichUnit
		set PHV = targetUnit
		set PKV = level
		call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 265, Condition(function DHX))
		call ForGroup(g, function GEA)
		call DeallocateGroup(g)
		set g = null
	endif
	if GetUnitAbilityLevel(targetUnit,'A42Q') == 0 or GetTriggerEvalCount(t) == 300 then
		call UnitRemoveAbility(targetUnit,'A42Q')
		call UnitRemoveAbility(targetUnit,'B0HH')
		call KillUnit(dummyCaster)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set dummyCaster = null
	return false
endfunction
function GOA takes unit whichUnit, unit targetUnit returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(whichUnit,'A1TV')
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e02P', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddPermanentAbility(dummyCaster,'A1U7')
	call SetUnitAbilityLevel(dummyCaster,'A1U7', level)
	call UnitAddPermanentAbility(dummyCaster,'Aloc')
	call UnitAddPermanentAbility(targetUnit,'A42Q')
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function GXA))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveUnitHandle(HY, h, 19, dummyCaster)
	call SaveInteger(HY, h, 5, level)
	set dummyCaster = null
	set t = null
endfunction
function GRA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call GOA(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function DEE takes nothing returns nothing
	local timer t
	local integer h
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, 0, false, function GRA)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		set t = null
	endif
endfunction
function Disruptor_StaticStormClear takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, GetHandleId(t))
		call CleanCurrentTrigger(t)
	else
		if GetUnitAbilityLevel(u,'B0DL') == 0 then
			call FlushChildHashtable(HY, GetHandleId(t))
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set u = null
endfunction
function GIA takes unit u returns nothing
	call BWR(u,'B0DL', 8)
endfunction
function GAA takes nothing returns nothing
	call UnitDamageTargetEx(PMV, GetEnumUnit(), 1, PLV)
	call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Purge_NoBirth.mdx", GetEnumUnit(), "origin"))
	if PPV and GetUnitAbilityLevel(GetEnumUnit(),'QINV') == 0 and GetUnitAbilityLevel(GetEnumUnit(),'AInv')> 0 and IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
		call GIA(GetEnumUnit())
	endif
endfunction
function GNA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer level =(LoadInteger(HY, h, 5))
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit missileDummy =(LoadUnitHandle(HY, h, 45))
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	local group g
	local integer count = GetTriggerEvalCount(t)
	local boolean HPR = LoadBoolean(HY, h, 0)
	local integer WOV = 20
	if HPR then
		set WOV = 28
	endif
	if count > WOV then
		call StopSound(BF, false, true)
		call KillUnit(missileDummy)
		call ShowUnit(missileDummy, false)
		call KillUnit(dummyCaster)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set g = AllocationGroup(445)
		set U2 = whichUnit
		set PMV = whichUnit
		set PLV = .25 *( 150+ 50 * level)*(count / 20.)
		set PPV = HPR
		call GroupEnumUnitsInRange(g, GetUnitX(missileDummy), GetUnitY(missileDummy), 475, Condition(function DHX))
		call ForGroup(g, function GAA)
		call DeallocateGroup(g)
		set g = null
	endif
	set t = null
	set whichUnit = null
	set missileDummy = null
	set dummyCaster = null
	return false
endfunction
function DXE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local real tx = GetSpellTargetX()
	local real ty = GetSpellTargetY()
	local unit missileDummy = CreateUnit(GetOwningPlayer(whichUnit),'h0CK', tx, ty, 0)
	local integer level = GetUnitAbilityLevel(whichUnit,'A1U6')+ GetUnitAbilityLevel(whichUnit,'A30N')
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', tx, ty, 0)
	call SetSoundVolume(BF, 200)
	call StartSound(BF)
	call SetSoundPosition(BF, tx, ty, 100)
	if IsScourgePlayer(GetOwningPlayer(whichUnit)) then
		call UnitAddPermanentAbility(dummyCaster,'A1U5')
		if GetSpellAbilityId()=='A30N' then
			call SetUnitAbilityLevel(dummyCaster,'A1U5', 2)
		endif
	else
		call UnitAddPermanentAbility(dummyCaster,'A1U4')
		if GetSpellAbilityId()=='A30N' then
			call SetUnitAbilityLevel(dummyCaster,'A1U4', 2)
		endif
	endif
	call IssuePointOrderById(dummyCaster, 852473, tx, ty)
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 45,(missileDummy))
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	call SaveInteger(HY, h, 5,(level))
	call SaveBoolean(HY, h, 0, GetSpellAbilityId()=='A30N')
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerAddCondition(t, Condition(function GNA))
	set t = null
	set whichUnit = null
	set dummyCaster = null
	set missileDummy = null
endfunction
function GBA takes nothing returns nothing
	local integer GCA = PWV
	local unit targetUnit = GetEnumUnit()
	local integer GDA = 662 -1 + GCA
	local real GFA =(LoadReal(HY,(GetHandleId(targetUnit)),(GDA)))
	local real ECX =(GetGameTime())
	if GFA < ECX then
		call SaveReal(HY,(GetHandleId(targetUnit)),(GDA),((ECX + 2)* 1.))
		if IsUnitType(GetEnumUnit(), UNIT_TYPE_STRUCTURE) == false then
			call UnitDamageTargetEx(PQV, targetUnit, 1, 2 + 6 * PUV)
		endif
	endif
	set targetUnit = null
endfunction
function GGA takes nothing returns nothing
	if IsUnitType(GetEnumUnit(), UNIT_TYPE_STRUCTURE) == false then
		call UnitDamageTargetEx(PQV, GetEnumUnit(), 1, PSV)
		if IsUnitMagicImmune(GetEnumUnit()) == false then
			call CNX(GetEnumUnit(),'A437', 3, 1,'B0DI')
			call GQX(GetEnumUnit(),'A437','B0DI')
		endif
	endif
endfunction
function GHA takes unit whichUnit, unit GJA returns nothing
	local group g = AllocationGroup(446)
	set U2 = whichUnit
	set PSV = 25 * PUV
	set PQV = whichUnit
	call GroupEnumUnitsInRange(g, GetUnitX(GJA), GetUnitY(GJA), 325, Condition(function DZX))
	call ForGroup(g, function GGA)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathMissile.mdl", GetUnitX(GJA), GetUnitY(GJA)))
	call KillUnit(GJA)
	call DeallocateGroup(g)
	call UnitApplyTimedLife(CreateUnit(GetOwningPlayer(whichUnit),'o00Q', GetUnitX(GJA), GetUnitY(GJA), 0),'BTLF', 2)
	set g = null
endfunction
function GKA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit GLA =(LoadUnitHandle(HY, h, 393))
	local unit GMA =(LoadUnitHandle(HY, h, 394))
	local unit GPA =(LoadUnitHandle(HY, h, 395))
	local unit GQA =(LoadUnitHandle(HY, h, 396))
	local unit GSA =(LoadUnitHandle(HY, h, 397))
	local real x
	local real y
	local real a
	local real d =(LoadReal(HY, h, 138))
	local real sx = GetUnitX(whichUnit)
	local real sy = GetUnitY(whichUnit)
	local real VEI
	local integer count = GetTriggerEvalCount(t)
	local real IMX
	local group g
	local integer GTA = 0
	local real time = 2.25
	local real GUA
	local integer level = LoadInteger(HY, h, 5)
	if UnitIsDead(GLA) == false then
		set GTA = GTA + 1
	endif
	if UnitIsDead(GMA) == false then
		set GTA = GTA + 1
	endif
	if UnitIsDead(GPA) == false then
		set GTA = GTA + 1
	endif
	if UnitIsDead(GQA) == false then
		set GTA = GTA + 1
	endif
	if UnitIsDead(GSA) == false then
		set GTA = GTA + 1
	endif
	if GTA == 5 then
		set time = 2.25
	elseif GTA == 4 then
		set time = 2.1
	elseif GTA == 3 then
		set time = 1.95
	elseif GTA == 2 then
		set time = 1.8
	elseif GTA == 1 then
		set time = 1.65
	endif
	set VEI =-1 * 360 * .02 / time
	set GUA =(LoadReal(HY, h, 137))+ VEI
	call SaveReal(HY, h, 137,((GUA)* 1.))
	set PUV = level
	set PQV = whichUnit
	if count == 50 then
		call ShowUnit(GMA, true)
		call SaveBoolean(HY, h, 512,(true))
		call UnitAddPermanentAbility(GMA,'Aloc')
	endif
	if count == 100  then
		call ShowUnit(GPA, true)
		call SaveBoolean(HY, h, 513,(true))
		call UnitAddPermanentAbility(GPA,'Aloc')
	endif
	if count == 150 then
		call ShowUnit(GQA, true)
		call SaveBoolean(HY, h, 514,(true))
		call UnitAddPermanentAbility(GQA,'Aloc')
	endif
	if count == 200 then
		call ShowUnit(GSA, true)
		call SaveBoolean(HY, h, 515,(true))
		call UnitAddPermanentAbility(GSA,'Aloc')
	endif
	if GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
		if GetSpellAbilityId()=='A24A' then
			if (LoadBoolean(HY, h, 655)) then
				call SaveBoolean(HY, h, 655,(false))
				call SaveBoolean(HY, h, 656,(false))
			else
				call SaveBoolean(HY, h, 655,(true))
				call SaveBoolean(HY, h, 656,(false))
			endif
		elseif GetSpellAbilityId()=='A24B' then
			if (LoadBoolean(HY, h, 656)) then
				call SaveBoolean(HY, h, 655,(false))
				call SaveBoolean(HY, h, 656,(false))
			else
				call SaveBoolean(HY, h, 655,(false))
				call SaveBoolean(HY, h, 656,(true))
			endif
		endif
	endif
	if (LoadBoolean(HY, h, 655)) then
		set d = RMaxBJ(d -5, 100)
		call SaveReal(HY, h, 138,((d)* 1.))
	elseif (LoadBoolean(HY, h, 656)) then
		set d = RMinBJ(d + 5, 875)
		call SaveReal(HY, h, 138,((d)* 1.))
	endif
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or count == 950 or(UnitIsDead(GLA) and UnitIsDead(GMA) and UnitIsDead(GPA) and UnitIsDead(GQA) and UnitIsDead(GSA)) or(count > 1 and GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A1T8') then
		if GetTriggerEventId()!= EVENT_UNIT_SPELL_EFFECT then
			call UnitRemoveAbility(whichUnit,'A24A')
			call UnitRemoveAbility(whichUnit,'A24B')
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if UnitIsDead(GLA) == false then
			call GHA(whichUnit, GLA)
		endif
		if UnitIsDead(GMA) == false then
			call GHA(whichUnit, GMA)
		endif
		if UnitIsDead(GPA) == false then
			call GHA(whichUnit, GPA)
		endif
		if UnitIsDead(GQA) == false then
			call GHA(whichUnit, GQA)
		endif
		if UnitIsDead(GSA) == false then
			call GHA(whichUnit, GSA)
		endif
	else
		set g = AllocationGroup(447)
		if UnitIsDead(GLA) == false and(LoadBoolean(HY, h, 511)) then
			set IMX = 360 * 5 / 5.
			set a = IMX + GUA
			set x = CoordinateX50(sx + d * Cos(a * bj_DEGTORAD))
			set y = CoordinateY50(sy + d * Sin(a * bj_DEGTORAD))
			call SetUnitX(GLA, x)
			call SetUnitY(GLA, y)
			set U2 = whichUnit
			call GroupEnumUnitsInRange(g, x, y, 95, Condition(function D8X))
			if FirstOfGroup(g)!= null then
				call GHA(whichUnit, GLA)
			endif
			call GroupClear(g)
			set PTV = GLA
			set PWV = 1
			set PQV = whichUnit
			call GroupEnumUnitsInRange(g, x, y, 175, Condition(function DYX))
			call ForGroup(g, function GBA)
			call GroupClear(g)
		endif
		if UnitIsDead(GMA) == false and(LoadBoolean(HY, h, 512)) then
			set IMX = 360 * 4 / 5.
			set a = IMX + GUA
			set x = CoordinateX50(sx + d * Cos(a * bj_DEGTORAD))
			set y = CoordinateY50(sy + d * Sin(a * bj_DEGTORAD))
			call SetUnitX(GMA, x)
			call SetUnitY(GMA, y)
			set U2 = whichUnit
			call GroupEnumUnitsInRange(g, x, y, 95, Condition(function D8X))
			if FirstOfGroup(g)!= null then
				call GHA(whichUnit, GMA)
			endif
			call GroupClear(g)
			set PTV = GMA
			set PWV = 2
			set PQV = whichUnit
			call GroupEnumUnitsInRange(g, x, y, 175, Condition(function DYX))
			call ForGroup(g, function GBA)
			call GroupClear(g)
		endif
		if UnitIsDead(GPA) == false and(LoadBoolean(HY, h, 513)) then
			set IMX = 360 * 3 / 5.
			set a = IMX + GUA
			set x = CoordinateX50(sx + d * Cos(a * bj_DEGTORAD))
			set y = CoordinateY50(sy + d * Sin(a * bj_DEGTORAD))
			call SetUnitX(GPA, x)
			call SetUnitY(GPA, y)
			set U2 = whichUnit
			call GroupEnumUnitsInRange(g, x, y, 95, Condition(function D8X))
			if FirstOfGroup(g)!= null then
				call GHA(whichUnit, GPA)
			endif
			call GroupClear(g)
			set PTV = GPA
			set PWV = 3
			set PQV = whichUnit
			call GroupEnumUnitsInRange(g, x, y, 175, Condition(function DYX))
			call ForGroup(g, function GBA)
			call GroupClear(g)
		endif
		if UnitIsDead(GQA) == false and(LoadBoolean(HY, h, 514)) then
			set IMX = 360 * 2 / 5.
			set a = IMX + GUA
			set x = CoordinateX50(sx + d * Cos(a * bj_DEGTORAD))
			set y = CoordinateY50(sy + d * Sin(a * bj_DEGTORAD))
			call SetUnitX(GQA, x)
			call SetUnitY(GQA, y)
			set U2 = whichUnit
			call GroupEnumUnitsInRange(g, x, y, 95, Condition(function D8X))
			if FirstOfGroup(g)!= null then
				call GHA(whichUnit, GQA)
			endif
			call GroupClear(g)
			set PTV = GQA
			set PWV = 4
			set PQV = whichUnit
			call GroupEnumUnitsInRange(g, x, y, 175, Condition(function DYX))
			call ForGroup(g, function GBA)
			call GroupClear(g)
		endif
		if UnitIsDead(GSA) == false and(LoadBoolean(HY, h, 515)) then
			set IMX = 360 * 1 / 5.
			set a = IMX + GUA
			set x = CoordinateX50(sx + d * Cos(a * bj_DEGTORAD))
			set y = CoordinateY50(sy + d * Sin(a * bj_DEGTORAD))
			call SetUnitX(GSA, x)
			call SetUnitY(GSA, y)
			set U2 = whichUnit
			call GroupEnumUnitsInRange(g, x, y, 95, Condition(function D8X))
			if FirstOfGroup(g)!= null then
				call GHA(whichUnit, GSA)
			endif
			call GroupClear(g)
			set PTV = GSA
			set PWV = 5
			set PQV = whichUnit
			call GroupEnumUnitsInRange(g, x, y, 175, Condition(function DYX))
			call ForGroup(g, function GBA)
			call GroupClear(g)
		endif
		call DeallocateGroup(g)
	endif
	set t = null
	set whichUnit = null
	set GLA = null
	set GMA = null
	set GPA = null
	set GQA = null
	set GSA = null
	set g = null
	return false
endfunction
function DIE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit GLA
	local unit GMA
	local unit GPA
	local unit GQA
	local unit GSA
	local real x
	local real y
	set x = GetUnitX(whichUnit)+ 250* Cos(bj_DEGTORAD * 360 * 5 / 5. *-1.)
	set y = GetUnitY(whichUnit)+ 250* Sin(bj_DEGTORAD * 360 * 5 / 5. *-1.)
	set GLA = CreateUnit(GetOwningPlayer(whichUnit),'h0CJ', x, y, 360 * 5 / 5. *-1.)
	call UnitAddPermanentAbility(GLA,'Aloc')
	set x = GetUnitX(whichUnit)+ 250* Cos(bj_DEGTORAD * 360 * 4 / 5. *-1.)
	set y = GetUnitY(whichUnit)+ 250* Sin(bj_DEGTORAD * 360 * 4 / 5. *-1.)
	set GMA = CreateUnit(GetOwningPlayer(whichUnit),'h0CJ', x, y, 360 * 4 / 5. *-1.)
	call ShowUnit(GMA, false)
	call SetUnitInvulnerable(GMA, true)
	set x = GetUnitX(whichUnit)+ 250* Cos(bj_DEGTORAD * 360 * 3 / 5. *-1.)
	set y = GetUnitY(whichUnit)+ 250* Sin(bj_DEGTORAD * 360 * 3 / 5. *-1.)
	set GPA = CreateUnit(GetOwningPlayer(whichUnit),'h0CJ', x, y, 360 * 3 / 5. *-1.)
	call ShowUnit(GPA, false)
	call SetUnitInvulnerable(GMA, true)
	set x = GetUnitX(whichUnit)+ 250* Cos(bj_DEGTORAD * 360 * 2 / 5. *-1.)
	set y = GetUnitY(whichUnit)+ 250* Sin(bj_DEGTORAD * 360 * 2 / 5. *-1.)
	set GQA = CreateUnit(GetOwningPlayer(whichUnit),'h0CJ', x, y, 360 * 2 / 5. *-1.)
	call ShowUnit(GQA, false)
	call SetUnitInvulnerable(GQA, true)
	set x = GetUnitX(whichUnit)+ 250* Cos(bj_DEGTORAD * 360 * 1 / 5. *-1.)
	set y = GetUnitY(whichUnit)+ 250* Sin(bj_DEGTORAD * 360 * 1 / 5. *-1.)
	set GSA = CreateUnit(GetOwningPlayer(whichUnit),'h0CJ', x, y, 360 * 1 / 5. *-1.)
	call ShowUnit(GSA, false)
	call SetUnitInvulnerable(GSA, true)
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 393,(GLA))
	call SaveUnitHandle(HY, h, 394,(GMA))
	call SaveUnitHandle(HY, h, 395,(GPA))
	call SaveUnitHandle(HY, h, 396,(GQA))
	call SaveUnitHandle(HY, h, 397,(GSA))
	call SaveBoolean(HY, h, 511,(true))
	call SaveBoolean(HY, h, 512,(false))
	call SaveBoolean(HY, h, 513,(false))
	call SaveBoolean(HY, h, 514,(false))
	call SaveBoolean(HY, h, 515,(false))
	call SaveBoolean(HY, h, 655,(false))
	call SaveBoolean(HY, h, 656,(false))
	call SaveReal(HY, h, 138,( 150* 1.))
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(whichUnit,'A1T8'))
	call UnitAddPermanentAbility(whichUnit,'A24B')
	call UnitAddPermanentAbility(whichUnit,'A24A')
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function GKA))
	set whichUnit = null
	set t = null
	set GLA = null
	set GMA = null
	set GPA = null
	set GQA = null
	set GSA = null
endfunction
function GWA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer level =(LoadInteger(HY, h, 5))
	if FK then
		call SetUnitToReduceDamage(whichUnit, GetEventDamage()* .05 * level)
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function GYA takes unit u returns nothing
	call UnitRemoveAbility(u,'A1VM')
	if LoadBoolean(ExtraHT, GetHandleId(u), HTKEY_DAMAGE_OVERCHARGE) then
		call SaveBoolean(ExtraHT, GetHandleId(u), HTKEY_DAMAGE_OVERCHARGE,(false))
		//set t =(LoadTriggerHandle(HY,(GetHandleId(u)), 709))
		//call FlushChildHashtable(HY,(GetHandleId(t)))
		//call CleanCurrentTrigger(t)
		//call RemoveSavedHandle(HY,(GetHandleId(u)), 709)
		//set t = null
	endif
endfunction
function GZA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	call GYA(whichUnit)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction
function G_A takes unit u, integer i returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2,(u))
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function GZA))
	call UnitAddPermanentAbilitySetLevel(u,'A1VM', i)
	if not LoadBoolean(ExtraHT, GetHandleId(u), HTKEY_DAMAGE_OVERCHARGE) then
		call SaveBoolean(ExtraHT, GetHandleId(u), HTKEY_DAMAGE_OVERCHARGE, true )
		//set t = CreateTrigger()
		//set h = GetHandleId(t)
		//call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DAMAGED)
		//call TriggerAddCondition(t, Condition(function GWA))
		//call SaveTriggerHandle(HY,(GetHandleId(u)), 709,(t))
		//call SaveUnitHandle(HY,(GetHandleId(t)), 2,(u))
		//call SaveInteger(HY,(GetHandleId(t)), 5,(i))
	endif
	set t = null
endfunction
// 过载
function G0A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer count =(LoadInteger(HY, h, 34))
	local integer level = GetUnitAbilityLevel(whichUnit,'A28Q')
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local unit G1A =(LoadUnitHandle(HY,(GetHandleId(whichUnit)), 652))
	local boolean I1O = false
	local real G2A = .2 *(GetWidgetLife(whichUnit)* .025)
	local real G3A = .2 *(GetUnitState(whichUnit, UNIT_STATE_MANA)* .025)
	if GetTriggerEventId() == EVENT_UNIT_ISSUED_ORDER then
		if GetIssuedOrderId() == 852589 then
			call G_A(whichUnit, level)
		elseif GetIssuedOrderId() == 852590 then
			call GYA(whichUnit)
		endif
	endif
	if GetUnitAbilityLevel(whichUnit,'A1VM')> 0 then
		set I1O = true
		call SetWidgetLife(whichUnit, RMaxBJ(GetWidgetLife(whichUnit)-G2A, 1))
		call SetUnitState(whichUnit, UNIT_STATE_MANA, RMaxBJ(GetUnitState(whichUnit, UNIT_STATE_MANA)-G3A, 1))
	endif
	if G1A == null then
		if targetUnit != null then
			call GYA(targetUnit)
			set targetUnit = null
			call SaveUnitHandle(HY, h, 17,(targetUnit))
		endif
	else
		if targetUnit == null then
			set targetUnit = G1A
			if I1O then
				call SaveUnitHandle(HY, h, 17,(targetUnit))
				call G_A(targetUnit, level)
			else
				call GYA(targetUnit)
			endif
		elseif targetUnit != G1A then
			call GYA(targetUnit)
			if I1O then
				set targetUnit = G1A
				call SaveUnitHandle(HY, h, 17,(targetUnit))
				call G_A(targetUnit, level)
			endif
		elseif I1O == false then
			call GYA(targetUnit)
		elseif targetUnit == G1A then
			if I1O then
				set targetUnit = G1A
				call SaveUnitHandle(HY, h, 17,(targetUnit))
				call G_A(targetUnit, level)
			endif
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set G1A = null
	return false
endfunction
function PVE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(whichUnit,'A28Q')
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(null))
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_ISSUED_ORDER)
	call TriggerAddCondition(t, Condition(function G0A))
	set whichUnit = null
	set t = null
endfunction
function G4A takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), PYV) == false then
		call GroupAddUnit(PYV, GetEnumUnit())
		call UnitAddAbilityToTimed(GetEnumUnit(),'A304', 1, .25 + .5 * PZV,'B304')
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\DragonHawkMissile\\DragonHawkMissile.mdl", GetEnumUnit(), "chest"))
	endif
endfunction
function G5A takes unit whichUnit, unit targetUnit, group CNO, integer level returns nothing
	local real x1 = GetUnitX(whichUnit)
	local real y1 = GetUnitY(whichUnit)
	local real x2 = GetUnitX(targetUnit)
	local real y2 = GetUnitY(targetUnit)
	local real a = AngleBetweenXY(x1, y1, x2, y2)* bj_DEGTORAD
	local real x
	local real y
	local real d = GetDistanceBetween(x1, y1, x2, y2)
	local group g = AllocationGroup(448)
	local integer i = 1
	set PYV = CNO
	set PZV = level
	loop
	exitwhen i > 8
		set U2 = whichUnit
		set x = x1 + d * i / 8 * Cos(a)
		set y = y1 + d * i / 8 * Sin(a)
		call GroupEnumUnitsInRange(g, x, y, 100, Condition(function DHX))
		call ForGroup(g, function G4A)
		call GroupClear(g)
		set i = i + 1
	endloop
	call DeallocateGroup(g)
	set g = null
endfunction
function G6A takes unit whichUnit, unit targetUnit returns boolean
	return((LoadInteger(HY,(GetHandleId((whichUnit))),(4294))) == 1)
endfunction
function G7A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real d = GetUnitDistanceEx(whichUnit, targetUnit)
	local real a = AngleBetweenUnit(whichUnit, targetUnit)* bj_DEGTORAD
	local real x = GetUnitX(whichUnit)+ 20 * Cos(a)
	local real y = GetUnitY(whichUnit)+ 20 * Sin(a)
	local location l
	if d < 300 or d > 2150 then
		set l = GetTerrainCliffFixLocation(x, y)
		set x = GetLocationX(l)
		set y = GetLocationY(l)
		if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
			call SaveBoolean(OtherHashTable, GetHandleId(whichUnit), 99, true)
		endif
		call SetUnitX(whichUnit, CoordinateX50(x))
		call SetUnitY(whichUnit, CoordinateY50(y))
		call KillTreeByCircle(x, y, 350)
		call RemoveLocation(l)
		set l = null
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SaveInteger(HY,(GetHandleId((whichUnit))),(4295), 2)
	else
		if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
			call SaveBoolean(OtherHashTable, GetHandleId(whichUnit), 99, true)
		endif
		call SetUnitX(whichUnit, x)
		call SetUnitY(whichUnit, y)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function G8A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local group CNO =(LoadGroupHandle(HY, h, 133))
	local lightning APX =(LoadLightningHandle(HY, h, 196))
	local integer count = GetTriggerEvalCount(t)
	local real d = GetUnitDistanceEx(whichUnit, targetUnit)
	local real a = 1
	local real G9A = GetWidgetLife(whichUnit)
	local real DDO = GetUnitState(whichUnit, UNIT_STATE_MANA)
	local real HVA =(LoadReal(HY, h, 670))
	local real HEA =(LoadReal(HY, h, 667))
	local real HXA
	local real HOA
	if targetUnit == null or whichUnit == null or UnitIsDead(whichUnit) or(count > 600 and G6A(whichUnit, targetUnit) == false and((LoadInteger(HY,(GetHandleId((whichUnit))),(4295))) == 1) == false) or(d > 925 and((LoadInteger(HY,(GetHandleId((whichUnit))),(4295)))!= 1)) or GetTriggerEventId() == EVENT_WIDGET_DEATH or(GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A1TU') then
		call DeallocateGroup(CNO)
		call DestroyLightning(APX)
		call UnitRemoveAbility(targetUnit,'A1TM')
		call UnitRemoveAbility(targetUnit,'A1TL')
		call UnitRemoveAbility(targetUnit,'A1TK')
		call UnitRemoveAbility(targetUnit,'A1TN')
		call UnitRemoveAbility(targetUnit,'B0DH')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(whichUnit,'A1TM')
		call UnitRemoveAbility(whichUnit,'A1TL')
		call UnitRemoveAbility(whichUnit,'A1TK')
		call UnitRemoveAbility(whichUnit,'A1TN')
		call UnitRemoveAbility(whichUnit,'B0DH')
		call UnitRemoveAbility(whichUnit,'A1TU')
		if Rubick_AbilityFilter(whichUnit , 'A1TA') then
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1TA', true)
		endif
		call RemoveSavedHandle(HY, GetHandleId(whichUnit), 652)
	else
		set HXA = G9A / GetUnitState(whichUnit, UNIT_STATE_MAX_LIFE)
		set HOA = DDO / GetUnitState(whichUnit, UNIT_STATE_MAX_MANA)
		if HXA -HVA > 0 and(HXA -HVA)< .5 then
			if ((LoadInteger(HY,(GetHandleId((whichUnit))),(4298))) == 1) == false then
				call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+(HXA -HVA)* GetUnitState(whichUnit, UNIT_STATE_MAX_LIFE)* 1.5)
			endif
		endif
		if HOA -HEA > 0 and(HOA -HEA)< .5 then
			call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)+(HOA -HEA)* GetUnitState(whichUnit, UNIT_STATE_MAX_MANA)* 1.5)
		endif
		call SaveReal(HY, h, 670,((GetWidgetLife(whichUnit)/ GetUnitState(whichUnit, UNIT_STATE_MAX_LIFE))* 1.))
		call SaveReal(HY, h, 667,((GetUnitState(whichUnit, UNIT_STATE_MANA)/ GetUnitState(whichUnit, UNIT_STATE_MAX_MANA))* 1.))
		call MoveLightning(APX, true, GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitX(targetUnit), GetUnitY(targetUnit))
		call G5A(whichUnit, targetUnit, CNO, LoadInteger(HY, h, 0))
		if UnitVisibleToPlayer(whichUnit, LocalPlayer) == false and UnitVisibleToPlayer(targetUnit, LocalPlayer) == false then
			set a = 0
		endif
		if IsObserverPlayer(LocalPlayer) then
			set a = 1
		endif
		if d < 700 or((LoadInteger(HY,(GetHandleId((whichUnit))),(4295))) == 1) then
			call SetLightningColor(APX, .0, 1., 1., a)
		else
			call SetLightningColor(APX, .8, .7, .4, a)
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set CNO = null
	set APX = null
	return false
endfunction
function DAE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local lightning APX = AddLightning("CHIM", true, GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitX(targetUnit), GetUnitY(targetUnit))
	local integer level = GetUnitAbilityLevel(whichUnit,'A1TA')
	local integer HRA
	local real d = GetUnitDistanceEx(whichUnit, targetUnit)
	local real a = AngleBetweenUnit(whichUnit, targetUnit)* bj_DEGTORAD
	local location l
	local real x
	local real y
	call SetLightningColor(APX, .0, 1., 1., 1)
	call UnitAddPermanentAbility(whichUnit,'A1TU')
	if level == 1 then
		set HRA ='A1TM'
	elseif level == 2 then
		set HRA ='A1TL'
	elseif level == 3 then
		set HRA ='A1TK'
	elseif level == 4 then
		set HRA ='A1TN'
	endif
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A1TA', false)
	call UnitAddPermanentAbility(whichUnit, HRA)
	call UnitAddPermanentAbility(targetUnit, HRA)
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveInteger(HY, h, 0, level)
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveGroupHandle(HY, h, 133,(AllocationGroup(449)))
	call SaveLightningHandle(HY, h, 196,(APX))
	call SaveReal(HY, h, 670,((GetWidgetLife(whichUnit)/ GetUnitState(whichUnit, UNIT_STATE_MAX_LIFE))* 1.))
	call SaveReal(HY, h, 667,((GetUnitState(whichUnit, UNIT_STATE_MANA)/ GetUnitState(whichUnit, UNIT_STATE_MAX_MANA))* 1.))
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function G8A))
	call SaveUnitHandle(HY,(GetHandleId(whichUnit)), 652,(targetUnit))
	if d > 700 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(whichUnit))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("Abilities\\Weapons\\DragonHawkMissile\\DragonHawkMissile.mdl", whichUnit, "chest")))
		call TriggerRegisterTimerEvent(t, .02, true)
		call TriggerAddCondition(t, Condition(function G7A))
		call SaveInteger(HY,(GetHandleId((whichUnit))),(4295), 1)
	endif
	set whichUnit = null
	set targetUnit = null
	set APX = null
	set t = null
	set l = null
endfunction
function HIA takes unit whichUnit, real x, real y returns boolean
	local boolean JVX = false
	local player p = GetOwningPlayer(whichUnit)
	local unit dummyCaster = CreateUnit(p,'e02Q', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	call UnitAddPermanentAbility(dummyCaster,'A1V4')
	if IssuePointOrderById(dummyCaster, 852525, x, y) then
		call KillUnit(dummyCaster)
		set dummyCaster = null
		set p = null
		return true
	else
		call KillUnit(dummyCaster)
		set dummyCaster = null
		set p = null
		return false
	endif
endfunction
function HAA takes string ATX, unit targetUnit returns nothing
	local texttag tt = CreateTextTag()
	call SetTextTagText(tt, ATX, .033)
	call SetTextTagPosUnit(tt, targetUnit, 64)
	call SetTextTagColor(tt, 0, 50, 255, 255)
	call SetTextTagVelocity(tt, 0, .0355)
	call SetTextTagFadepoint(tt, .15)
	call SetTextTagPermanent(tt, false)
	call SetTextTagLifespan(tt, .85)
	call SetTextTagVisibility(tt, IsPlayerAlly(LocalPlayer, GetOwningPlayer(targetUnit)))
	set tt = null
endfunction
function HNA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer count = GetTriggerEvalCount(t)
	if UnitIsDead(whichUnit) == false and count < 12 then
		call HAA(I2S( 12-count), whichUnit)
	endif
	if count == 12 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function HBA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY,(GetHandleId(whichUnit)), 652))
	local real tx =(LoadReal(HY, h, 47))
	local real ty =(LoadReal(HY, h, 48))
	local real sx =(LoadReal(HY, h, 189))
	local real sy =(LoadReal(HY, h, 190))
	local fogmodifier fm =(LoadFogModifierHandle(HY, h, 42))
	local string s
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call SaveInteger(HY,(GetHandleId((whichUnit))),(4294), 2)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FogModifierStop(fm)
		call DestroyFogModifier(fm)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call KillTreeByCircle(tx, ty, 250)
		call KillTreeByCircle(sx, sy, 250)
		set s = "Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl"
		if GetTriggerEvalCount(t) == 1 then
			if UnitIsDead(whichUnit) == false then
				call DestroyEffect(AddSpecialEffect(s, GetUnitX(whichUnit), GetUnitY(whichUnit)))
				call SetUnitPosition(whichUnit, tx, ty)
				call PanCameraToTimedForPlayer(GetOwningPlayer(whichUnit), tx, ty, 0)
				call DestroyEffect(AddSpecialEffect(s, GetUnitX(whichUnit), GetUnitY(whichUnit)))
			endif
			if targetUnit != null and UnitIsDead(targetUnit) == false and GetOwningPlayer(targetUnit)!= SentinelPlayers[0]and GetOwningPlayer(targetUnit)!= ScourgePlayers[0]and(LoadBoolean(HY, GetHandleId(GetOwningPlayer(targetUnit)), 139) == false) then
				call DestroyEffect(AddSpecialEffect(s, GetUnitX(targetUnit), GetUnitY(targetUnit)))
				call EPX(targetUnit, 4402, 1)
				call SetUnitPosition(targetUnit, tx, ty)
				if IsUnitType(targetUnit, UNIT_TYPE_HERO) and UnitIsDead(targetUnit) == false then
					call PanCameraToTimedForPlayer(GetOwningPlayer(targetUnit), tx, ty, 0)
				endif
				call DestroyEffect(AddSpecialEffect(s, GetUnitX(targetUnit), GetUnitY(targetUnit)))
			endif
		else
			if UnitIsDead(whichUnit) == false then
				call DestroyEffect(AddSpecialEffect(s, GetUnitX(whichUnit), GetUnitY(whichUnit)))
				call SetUnitPosition(whichUnit, sx, sy)
				call PanCameraToTimedForPlayer(GetOwningPlayer(whichUnit), sx, sy, 0)
				call DestroyEffect(AddSpecialEffect(s, GetUnitX(whichUnit), GetUnitY(whichUnit)))
			endif
			if targetUnit != null and UnitIsDead(targetUnit) == false and GetOwningPlayer(targetUnit)!= SentinelPlayers[0]and GetOwningPlayer(targetUnit)!= ScourgePlayers[0]and(LoadBoolean(HY, GetHandleId(GetOwningPlayer(targetUnit)), 139) == false) then
				call DestroyEffect(AddSpecialEffect(s, GetUnitX(targetUnit), GetUnitY(targetUnit)))
				call EPX(targetUnit, 4402, 1)
				call SetUnitPosition(targetUnit, sx, sy)
				if IsUnitType(targetUnit, UNIT_TYPE_HERO) and UnitIsDead(targetUnit) == false then
					call PanCameraToTimedForPlayer(GetOwningPlayer(targetUnit), sx, sy, 0)
				endif
				call DestroyEffect(AddSpecialEffect(s, GetUnitX(targetUnit), GetUnitY(targetUnit)))
			endif
			call SaveInteger(HY,(GetHandleId((whichUnit))),(4294), 2)
			call DestroyEffect((LoadEffectHandle(HY, h, 32)))
			call FogModifierStop(fm)
			call DestroyFogModifier(fm)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set fm = null
	return false
endfunction
function HCA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local real tx =(LoadReal(HY, h, 47))
	local real ty =(LoadReal(HY, h, 48))
	local fogmodifier fm = null
	local integer level = GetUnitAbilityLevel(whichUnit,'A1TB')+ GetUnitAbilityLevel(whichUnit,'A3FQ')
	if C5X(whichUnit) or C4X(whichUnit) or UnitIsDead(whichUnit) then
		call SaveInteger(HY,(GetHandleId((whichUnit))),(4294), 2)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEvalCount(t)==(2.75 -0.25 * level)/ .05 then
		set fm = null
		call FogModifierStart(fm)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(whichUnit))
		call TriggerRegisterTimerEvent(t, .01, false)
		call TriggerRegisterTimerEvent(t, 12, false)
		call TriggerRegisterDeathEvent(t, whichUnit)
		call TriggerAddCondition(t, Condition(function HBA))
		call SaveReal(HY, h, 189,((GetUnitX(whichUnit))* 1.))
		call SaveReal(HY, h, 190,((GetUnitY(whichUnit))* 1.))
		call SaveReal(HY, h, 47,((tx)* 1.))
		call SaveReal(HY, h, 48,((ty)* 1.))
		call SaveEffectHandle(HY, h, 32,(AddSpecialEffect("war3mapImported\\EarthlyEminence.mdl", GetUnitX(whichUnit), GetUnitY(whichUnit))))
		call SaveFogModifierHandle(HY, h, 42,(fm))
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(whichUnit))
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function HNA))
	endif
	set whichUnit = null
	set t = null
	set fm = null
	return false
endfunction
function DNE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit targetUnit =(LoadUnitHandle(HY,(GetHandleId(whichUnit)), 652))
	local integer id = GetPlayerId(GetOwningPlayer(whichUnit))
	local integer level = GetUnitAbilityLevel(whichUnit,'A1TB')+ GetUnitAbilityLevel(whichUnit,'A3FQ')
	//local boolean b = false
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl", whichUnit, "chest"))
	//if IsPlayerAlly(GetOwningPlayer(whichUnit), LocalPlayer) or(IsGameHaveObserver and IsObserverPlayer(LocalPlayer)) or IsVisibleToPlayer(x, y, LocalPlayer) then
		//set b = true
		call PingMinimapEx(x, y, 4., 255, 0, 0, false)
	//endif
	call A8X(GetOwningPlayer(whichUnit), 2.5, x, y, 300)
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function HCA))
	call SaveReal(HY, h, 47,((x)* 1.))
	call SaveReal(HY, h, 48,((y)* 1.))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffect("war3mapImported\\EarthlyEminence.mdl", x, y)))
	call SaveInteger(HY,(GetHandleId((whichUnit))),(4294), 1)
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function LBE takes nothing returns nothing
	if HIA(GetTriggerUnit(), GetSpellTargetX(), GetSpellTargetY()) == false then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n0KX'))
	else
		if IsSentinelPlayer(GetOwningPlayer(GetTriggerUnit())) then
			if IsPointInRegion(P0V, GetSpellTargetX(), GetSpellTargetY()) then
				call EXStopUnit(GetTriggerUnit())
				call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n03Y'))
			endif
		else
			if IsPointInRegion(P_V, GetSpellTargetX(), GetSpellTargetY()) then
				call EXStopUnit(GetTriggerUnit())
				call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n03Y'))
			endif
		endif
	endif
endfunction
function PZX takes nothing returns nothing
	set P_V = CreateRegion()
	call RegionAddRect(P_V, gg_rct_SentinelBuyArea)
	call RegionAddRect(P_V, gg_rct_SentinelFountainOfLifeRange)
	set P0V = CreateRegion()
	call RegionAddRect(P0V, gg_rct_ScourgeBuyArea)
	call RegionAddRect(P0V, gg_rct_ScourgeFountainOfLifeRange)
endfunction
function HDA takes unit whichUnit, unit targetUnit, real sx, real sy, real a2 returns nothing
	local integer i = 0
	local real tx
	local real ty
	local real a
	local real x
	local real y
	local real HFA
	set a = a2
	set tx = sx + 50 * Cos(a * bj_DEGTORAD)
	set ty = sy + 50 * Sin(a * bj_DEGTORAD)
	set HFA = a
	set x = tx + 200* Cos(HFA * bj_DEGTORAD)
	set y = ty + 200* Sin(HFA * bj_DEGTORAD)
	call RemoveDestructableToTimed(CreateDestructable('B006', x, y,-1 * HFA, .6, 1), 7)
	call KillTreeByCircle(x, y, 300)
	set HFA = a -40
	set x = tx + 200* Cos(HFA * bj_DEGTORAD)
	set y = ty + 200* Sin(HFA * bj_DEGTORAD)
	call RemoveDestructableToTimed(CreateDestructable('B006', x, y,-1 * HFA, .6, 1), 7)
	call KillTreeByCircle(x, y, 300)
	set HFA = a -80
	set x = tx + 200* Cos(HFA * bj_DEGTORAD)
	set y = ty + 200* Sin(HFA * bj_DEGTORAD)
	call RemoveDestructableToTimed(CreateDestructable('B006', x, y,-1 * HFA, .6, 1), 7)
	call KillTreeByCircle(x, y, 300)
	set HFA = a + 40
	set x = tx + 200* Cos(HFA * bj_DEGTORAD)
	set y = ty + 200* Sin(HFA * bj_DEGTORAD)
	call RemoveDestructableToTimed(CreateDestructable('B006', x, y,-1 * HFA, .6, 1), 7)
	call KillTreeByCircle(x, y, 300)
	set HFA = a + 80
	set x = tx + 200* Cos(HFA * bj_DEGTORAD)
	set y = ty + 200* Sin(HFA * bj_DEGTORAD)
	call RemoveDestructableToTimed(CreateDestructable('B006', x, y,-1 * HFA, .6, 1), 7)
	call KillTreeByCircle(x, y, 300)
endfunction
function HGA takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), P3V) == false then
		call GroupAddUnit(P3V, GetEnumUnit())
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\ChainFreeze_F6.mdx", GetEnumUnit(), "chest"))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl", GetEnumUnit(), "chest"))
		call UnitDamageTargetEx(P1V, GetEnumUnit(), 1, P2V * 70)
	endif
endfunction
function HHA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local unit HJA = LoadUnitHandle(HY, h, 45)
	local real HKA = LoadReal(HY, h, 683)
	local real HLA = LoadReal(HY, h, 684)
	local real sx = GetUnitX(HJA)
	local real sy = GetUnitY(HJA)
	local real I3X = Atan2(HLA -sy, HKA -sx)
	local real nx = sx + 22 * Cos(I3X)
	local real ny = sy + 22 * Sin(I3X)
	local group gg = LoadGroupHandle(HY, h, 133)
	local integer level = LoadInteger(HY, h, 0)
	local group g = AllocationGroup(450)
	set U2 = whichUnit
	set P1V = whichUnit
	set P3V = gg
	set P2V = level
	call GroupEnumUnitsInRange(g, nx, ny, 225, Condition(function DJX))
	call ForGroup(g, function HGA)
	call DeallocateGroup(g)
	call SetUnitPosition(HJA, nx, ny)
	if GetDistanceBetween(nx, ny, HKA, HLA)< 40 then
		call KillUnit(HJA)
		call SetUnitPathing(HJA, true)
		call HDA(whichUnit, null, nx, ny, I3X * bj_RADTODEG)
		call DeallocateGroup(gg)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set whichUnit = null
	set targetUnit = null
	set t = null
	set HJA = null
	set gg = null
	set g = null
	return false
endfunction
function DBE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit HJA = CreateUnit(GetOwningPlayer(whichUnit),'h0CS', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	local real sx = GetUnitX(whichUnit)
	local real sy = GetUnitY(whichUnit)
	local real tx = GetSpellTargetX()
	local real ty = GetSpellTargetY()
	local real I3X = Atan2(ty -sy, tx -sx)
	local real HKA = CoordinateX50(tx)
	local real HLA = CoordinateY50(ty)
	call SetUnitFacing(HJA, I3X * bj_RADTODEG)
	call SetUnitPathing(HJA, false)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function HHA))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveReal(HY, h, 683, HKA * 1.)
	call SaveReal(HY, h, 684, HLA * 1.)
	call SaveReal(HY, h, 13, I3X * 1.)
	call SaveUnitHandle(HY, h, 45, HJA)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	call SaveGroupHandle(HY, h, 133, AllocationGroup(451))
	set whichUnit = null
	set HJA = null
	set t = null
endfunction
function HMA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 0)
	local integer count = GetTriggerEvalCount(t)
	local real y =(count -50)*(count -50)/ 4.3
	local real IXX
	if level == 1 then
		set IXX = 75
	elseif level == 2 then
		set IXX = 150
	else
		set IXX = 225
	endif
	if count == 1 then
		call IssueTargetOrderById(whichUnit, 851983, targetUnit)
	endif
	if count < 50 then
		if O0X(targetUnit) == false then
			call SetUnitFlyHeight(targetUnit, 700 * count / 50, 0)
		endif
	elseif count < 100  then
		if O0X(targetUnit) == false then
			call SetUnitFlyHeight(targetUnit, 700 -700 *(count -50)/ 50, 0)
		endif
	else
		if O0X(targetUnit) == false then
			call SetUnitFlyHeight(targetUnit, GetUnitDefaultFlyHeight(targetUnit), 0)
		endif
		call DestroyEffect(LoadEffectHandle(HY, h, 175))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call CNX(targetUnit,'A204', 1, 1 + level,'B0DY')
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(targetUnit),'A204', false)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function HPA takes unit whichUnit, unit targetUnit, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call CommonTextTag("WALRUS PUNCH !!", 3.5, whichUnit, .03, 255, 0, 0, 255)
	call A5X(VF, GetUnitX(targetUnit), GetUnitY(targetUnit))
	call CommonUnitAddStun(targetUnit, 1., false)
	if O0X(targetUnit) == false then
		call UnitAddPermanentAbility(targetUnit,'Amrf')
		call UnitRemoveAbility(targetUnit,'Amrf')
	endif
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl", targetUnit, "overhead"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl", targetUnit, "head"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl", targetUnit, "left,hand"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl", targetUnit, "right,hand"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl", targetUnit, "chest"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl", targetUnit, "origin"))
	call TriggerRegisterTimerEvent(t, .01, true)
	call TriggerAddCondition(t, Condition(function HMA))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveInteger(HY, h, 0, level)
	call SaveEffectHandle(HY, h, 175, AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathMissile.mdl", targetUnit, "chest"))
	set t = null
endfunction
function HQA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	call UnitRemoveAbility(u,'A1UH')
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTimer(t)
	set u = null
	set t = null
endfunction
function HSA takes nothing returns boolean
	local trigger t2 = GetTriggeringTrigger()
	local integer h2 = GetHandleId(t2)
	local unit u = LoadUnitHandle(HY, h2, 2)
	local unit target = LoadUnitHandle(HY, h2, 17)
	local effect eff = LoadEffectHandle(HY, h2, 32)
	local trigger t = LoadTriggerHandle(HY, h2, 35)
	local integer h = LoadInteger(HY, h2, 375)
	if GetTriggerEvalCount(t2) == 1 then
		call IssueTargetOrderById(u, 851983, target)
	else
		if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
			if GetEventDamageSource() == u and EXGetEventDamageData(1) != 0 and FK then
				call CXX(u,'A1UH', 1, .1)
				call DestroyEffect(eff)
				call CleanCurrentTrigger(t2)
				call FlushChildHashtable(HY, h2)
				call CleanCurrentTrigger(t)
				call FlushChildHashtable(HY, h)
				call HPA(u, target, LoadInteger(HY, h2, 0))
			endif
		elseif GetTriggerEventId() == EVENT_PLAYER_UNIT_ATTACKED then
			if GetAttacker() == u and GetTriggerUnit()!= target then
				call FlushChildHashtable(HY, h2)
				call CleanCurrentTrigger(t2)
			endif
		else
			call UnitRemoveAbility(u,'A1UH')
			call RemoveSavedHandle(HY, h, 17)
			call FlushChildHashtable(HY, h2)
			call CleanCurrentTrigger(t2)
		endif
	endif
	set t2 = null
	set t = null
	set u = null
	set target = null
	set eff = null
	return false
endfunction
function HUA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 2)
	local unit target
	local effect eff = LoadEffectHandle(HY, h, 32)
	local trigger t2
	local integer h2
	if GetTriggerEventId()!= EVENT_PLAYER_UNIT_ATTACKED then
		call DestroyEffect(eff)
		call UnitRemoveAbility(u,'A1UH')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetAttacker() == u and GetTriggerUnit()!=(LoadUnitHandle(HY, h, 17)) and IsUnitAlly(GetTriggerUnit(), GetOwningPlayer(u)) == false and IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE) == false and GetUnitTypeId(u)!='N0MH' then
		set target = GetTriggerUnit()
		call SaveUnitHandle(HY, h, 17, target)
		set t2 = CreateTrigger()
		set h2 = GetHandleId(t2)
		call TriggerRegisterTimerEvent(t2, 0, false)
		call TriggerRegisterTimerEvent(t2, 2, false)
		call TriggerRegisterUnitEvent(t2, target, EVENT_UNIT_DAMAGED)
		call TriggerRegisterPlayerUnitEventBJ(t2, EVENT_PLAYER_UNIT_ATTACKED)
		call TriggerAddCondition(t2, Condition(function HSA))
		call SaveUnitHandle(HY, h2, 2, u)
		call SaveUnitHandle(HY, h2, 17, target)
		call SaveEffectHandle(HY, h2, 32, eff)
		call SaveInteger(HY, h2, 375, h)
		call SaveTriggerHandle(HY, h2, 35, t)
		call SaveInteger(HY, h2, 0, LoadInteger(HY, h, 0))
	endif
	set t = null
	set u = null
	set target = null
	set eff = null
	set t2 = null
	return false
endfunction
function DCE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterTimerEvent(t, 10, false)
	call TriggerAddCondition(t, Condition(function HUA))
	call SaveUnitHandle(HY, h, 2, u)
	call SaveUnitHandle(HY, h, 17, null)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("war3mapImported\\WalrusPunchWeaponFX.mdx", u, GetHeroWeaponAttachPointName(u)))
	call UnitAddPermanentAbility(u,'A1UH')
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(u, GetSpellAbilityId()))
	if (GetUnitAbilityLevel(u,'A0DL')> 0) then
		call SetUnitAbilityLevel(u,'A1UL', 2)
	endif
	call UnitMakeAbilityPermanent(u, true,'A1UL')
	set t = null
	set u = null
endfunction
function HOX takes nothing returns nothing
	call UnitAddPermanentAbility(U2,'A3DF')
	call SetPlayerAbilityAvailable(GetOwningPlayer(U2),'A3DF', true)
endfunction
function HCX takes nothing returns nothing
	call SetPlayerAbilityAvailable(GetOwningPlayer(U2),'A3DF', false)
endfunction
function HWA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY,(h), 2))
	local unit targetUnit =(LoadUnitHandle(HY,(h), 17))
	local real HYA =(LoadReal(HY,(h), 6))
	local real HZA =(LoadReal(HY,(h), 7))
	local real a = LoadReal(HY, h, 1)
	local real H_A =(LoadReal(HY,(h), 23))
	local real H0A =(LoadReal(HY,(h), 24))
	local real nX
	local real nY
	local boolean X_A = false
	local real LMR = LoadReal(HY, h, 0)
	set nX = H_A + LMR * Cos(a)
	set nY = H0A + LMR * Sin(a)
	if GetDistanceBetween(nX, nY, HYA, HZA)<(5 + LMR) then
		set nX = HYA
		set nY = HZA
		set X_A = true
	endif
	set nX = CoordinateX50(nX)
	set nY = CoordinateY50(nY)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetUnitAbilityLevel(targetUnit,'B08V')> 0 or GetTriggerEvalCount(t)> 200 then
		set X_A = true
	else
		call SetUnitPosition(targetUnit, nX, nY)
		call SetUnitX(targetUnit, nX)
		call SetUnitY(targetUnit, nY)
		call KillTreeByCircle(nX, nY, 120)
		call SaveReal(HY,(h), 23,((nX)* 1.))
		call SaveReal(HY,(h), 24,((nY)* 1.))
	endif
	if X_A then
		call SetUnitPathing(targetUnit, true)
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	endif
	set targetUnit = null
	set t = null
	set whichUnit = null
	return false
endfunction
function H1A takes nothing returns nothing
	local unit targetUnit = GetSpellTargetUnit()
	local unit whichUnit = GetTriggerUnit()
	local integer level = 1
	local trigger t
	local integer h
	local real N8X
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local integer i =-1
	local boolean H2A = false
	local real EOX = 900
	set N8X = AngleBetweenUnit(whichUnit, targetUnit)* bj_DEGTORAD
	set t = CreateTrigger()
	set h = GetHandleId(t)
	loop
	exitwhen H2A or i == 23
		set i = i + 1
		set x = CoordinateX50(GetUnitX(targetUnit)+(EOX -i * 25)* Cos(N8X))
		set y = CoordinateY50(GetUnitY(targetUnit)+(EOX -i * 25)* Sin(N8X))
		if (IsPointInRegion(TerrainCliffRegion,((x)* 1.),((y)* 1.))) == false then
			set H2A = true
		endif
	endloop
	call SetUnitPathing(targetUnit, false)
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function HWA))
	call SaveUnitHandle(HY,(h), 2,(whichUnit))
	call SaveUnitHandle(HY,(h), 17,(targetUnit))
	call SaveReal(HY,(h), 6,((x)* 1.))
	call SaveReal(HY,(h), 7,((y)* 1.))
	call SaveReal(HY,(h), 23,((GetUnitX(targetUnit))* 1.))
	call SaveReal(HY,(h), 24,((GetUnitY(targetUnit))* 1.))
	call SaveInteger(HY,(h), 34, 0)
	call SaveReal(HY, h, 0, 900 * .03)
	call SaveReal(HY, h, 1, N8X)
	call UnitAddAbilityToTimed(targetUnit,'A3DG', 1, 5,'B3DG')
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, 200)
	set targetUnit = null
	set whichUnit = null
	set t = null
endfunction
function KNE takes nothing returns nothing
	if GetSpellTargetUnit() == Roshan then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n0K9'))
	else
		call EYX("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl", GetTriggerUnit(), "hand", .2)
	endif
endfunction
function DDE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call H1A()
	endif
endfunction
function H3A takes nothing returns nothing
	local unit u = GetEnumUnit()
	call ShowUnit(u, true)
	call UnitRemoveAbility(u,'A04R')
	call SetUnitInvulnerable(u, false)
	call PauseUnit(u, false)
	if IsUnitType(u, UNIT_TYPE_HERO) then
		call SetUnitPosition(u, P9V, QVV)
		call SelectUnitForPlayerSingle(u, GetOwningPlayer(u))
	else
		call SetUnitX(u, P9V)
		call SetUnitY(u, QVV)
	endif
	if u == P5V and P6V != null then
		call IssueTargetOrderById(P5V, 851983, P6V)
	endif
	call DestroyEffect(AddSpecialEffect("war3mapImported\\ChainFreeze_F6.mdx", GetUnitX(u), GetUnitY(u)))
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl", GetUnitX(u), GetUnitY(u)))
	set u = null
endfunction
function H4A takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), P4V) == false then
		call GroupAddUnit(P4V, GetEnumUnit())
		call UnitDamageTargetEx(P5V, GetEnumUnit(), 1, 40 * P8V + 40)
		call CommonUnitAddStun(GetEnumUnit(), .25 * P8V + .25, false)
	endif
endfunction
function H5A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY,(h), 2))
	local unit targetUnit =(LoadUnitHandle(HY,(h), 17))
	local unit d =(LoadUnitHandle(HY,(h), 45))
	local real tx = GetUnitX(targetUnit)
	local real ty = GetUnitY(targetUnit)
	local real r =(LoadReal(HY,(h), 671))
	local real a = AngleBetweenXY(GetUnitX(d), GetUnitY(d), tx, ty)* bj_DEGTORAD
	local real x = GetUnitX(d)+ r * Cos(a)
	local real y = GetUnitY(d)+ r * Sin(a)
	local group CNO =(LoadGroupHandle(HY,(h), 133))
	local group g
	local integer c = GetTriggerEvalCount(t)
	local real REI = RMinBJ(2.5 +(c * .02), 10)
	local real KJR = 225+ 40 *(c * .02)
	set P8V = GetUnitAbilityLevel(u,'A1S7')
	set U2 = u
	set P4V = CNO
	set P5V = u
	set P6V = targetUnit
	set P7V =(LoadUnitHandle(HY,(h), 19))
	call SetUnitX(d, x)
	call SetUnitY(d, y)
	call SetUnitFacing(d, a * bj_RADTODEG  -180)
	call SetUnitScale(d, REI, REI, REI)
	if GetDistanceBetween(x, y, tx, ty)< r * 2 or c == 150 then
		call KillTreeByCircle(x, y, 200)
		set g = AllocationGroup(452)
		call GroupEnumUnitsInRange(g, x, y, KJR, Condition(function DHX))
		call ForGroup(g, function H4A)
		call DeallocateGroup(g)
		set g = null
		set P9V = x
		set QVV = y
		set g = LoadGroupHandle(HY,(h), 22)
		call ForGroup((g), function H3A)
		call DeallocateGroup(g)
		call DeallocateGroup(CNO)
		call KillUnit(d)
		call CleanCurrentTrigger(t)
		if GetUnitAbilityLevel(targetUnit,'A3E9') == 1 and IsUnitMagicImmune(u) == false then
			call SaveUnitHandle(OtherHashTable2,'A3E9', 0, targetUnit)
			call SaveUnitHandle(OtherHashTable2,'A3E9', 1, u)
			call SaveInteger(OtherHashTable2,'A3E9', 0, LoadInteger(HY, h, 5))
			call ExecuteFunc("H6A")
		endif
		call FlushChildHashtable(HY,(h))
	else
		if ModuloInteger(GetTriggerEvalCount(t), 5) == 0 then
			call KillTreeByCircle(x, y, 200)
			set g = AllocationGroup(453)
			call GroupEnumUnitsInRange(g, x, y, KJR, Condition(function DHX))
			call ForGroup(g, function H4A)
			call DeallocateGroup(g)
			set g = null
		endif
	endif
	set t = null
	set u = null
	set d = null
	set CNO = null
	set targetUnit = null
	return false
endfunction
function Web_removestate takes unit u returns nothing
	if IsUnitType(u, UNIT_TYPE_HERO) then//防止蜘蛛网检测不到，先删了蜘蛛网隐身。
		call UnitRemoveAbility(u,'A021')
	else
		call UnitRemoveAbility(u,'A29C')
	endif
	call UnitRemoveAbility(u,'B01C')
endfunction
function H7A takes nothing returns nothing
	local unit u = GetEnumUnit()
	call DestroyEffect(AddSpecialEffect("war3mapImported\\ChainFreeze_F6.mdx", GetUnitX(u), GetUnitY(u)))
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl", GetUnitX(u), GetUnitY(u)))
	call ShowUnit(u, false)
	call UnitAddPermanentAbility(u,'A04R')
	call SetUnitInvulnerable(u, true)
	call PauseUnit(u, true)
	call Web_removestate(u)
	set u = null
endfunction
function H8A takes nothing returns boolean
	local unit t = GetFilterUnit()
	local player p = GetOwningPlayer(t)
	local boolean b = false
	if IsUnitAlly(P5V, p) and(p == GetOwningPlayer(P5V) or(LoadBoolean(HY, GetHandleId(p), 139) == false and IsUnitType(t, UNIT_TYPE_HERO))) and IsAliveNotStrucNotWard(t) then
		set b = true
	endif
	set t = null
	return b
endfunction
function H9A takes unit u, unit target, integer lv returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x1 = GetUnitX(u)
	local real y1 = GetUnitY(u)
	local real x2 = GetUnitX(target)
	local real y2 = GetUnitY(target)
	local real a = AngleBetweenXY(x1, y1, x2, y2)* bj_DEGTORAD
	local unit d = CreateUnit(GetOwningPlayer(u),'h0C3', GetUnitX(u), GetUnitY(u), GetUnitFacing(u))
	local group g = AllocationGroup(454)
	set HV = 0
	set P5V = u
	set HV = 675
	call GroupEnumUnitsInRange(g, x1, y1, 255, Condition(function H8A))
	call ForGroup(g, function H7A)
	set P7V = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call SetUnitTimeScale(d, 2)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function H5A))
	call SaveUnitHandle(HY,(h), 2,(u))
	call SaveInteger(HY, h, 5, lv)
	call SaveUnitHandle(HY,(h), 17,(target))
	call SaveUnitHandle(HY,(h), 19,(P7V))
	call SaveUnitHandle(HY,(h), 45,(d))
	call SaveReal(HY,(h), 137,((a)* 1.))
	call SaveReal(HY,(h), 671,((HV * .02)* 1.))
	call SaveReal(HY,(h), 47,((x2)* 1.))
	call SaveReal(HY,(h), 48,((y2)* 1.))
	call SaveGroupHandle(HY,(h), 22,(g))
	call SaveGroupHandle(HY,(h), 133,(AllocationGroup(455)))
	set t = null
	set d = null
endfunction
function DFE takes nothing returns nothing
	call H9A(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(),'A1S7'))
endfunction
function H6A takes nothing returns nothing
	call T4V(LoadUnitHandle(OtherHashTable2,'A3E9', 0))
	call H9A(LoadUnitHandle(OtherHashTable2,'A3E9', 0), LoadUnitHandle(OtherHashTable2,'A3E9', 0), LoadInteger(OtherHashTable2,'A3E9', 0))
	call FlushChildHashtable(OtherHashTable2,'A3E9')
endfunction
function JVA takes unit u returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call TriggerAddCondition(t, Condition(function EBA))
	set t = null
endfunction
function JEA takes nothing returns boolean
	if IsUnitEnemy(GetFilterUnit(), E3) and IsAliveNotStrucNotWard(GetFilterUnit()) and IsUnitMagicImmune(GetFilterUnit()) == false then
		call UnitAddAbilityToTimed(GetFilterUnit(), Q2, 1, 2, Q22)
	endif
	return false
endfunction
function JXA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit JOA =(LoadUnitHandle(HY, h, 2))
	local unit whichUnit =(LoadUnitHandle(HY, h, 17))
	local group g
	local integer level = LoadInteger(HY, h, 5)
	if GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		if GetTriggerEvalCount(t) == 1 then
			call IssueTargetOrderById(JOA, 851986, whichUnit)
			call TriggerRegisterDeathEvent(t, JOA)
		endif
		set E3 = GetOwningPlayer(JOA)
		if level == 1 then
			set Q2 = 'A3JT'
			set Q22 ='B0DT'
		elseif level == 2 then
			set Q2 = 'A3JU'
			set Q22 ='B0DU'
		elseif level == 3 then
			set Q2 = 'A3JV'
			set Q22 = 'B0DS'
		elseif level == 4 then
			set Q2 ='A3JW'
			set Q22 = 'B0DR'
		endif
		//set Q2='A3JT'+level-1
		set g = AllocationGroup(456)
		call GroupEnumUnitsInRange(g, GetUnitX(JOA), GetUnitY(JOA), 1200, Condition(function JEA))
		call DeallocateGroup(g)
	else
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl", GetUnitX(JOA), GetUnitY(JOA)))
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set JOA = null
	set whichUnit = null
	return false
endfunction
function JRA takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerAddCondition(t, Condition(function JXA))
	call TriggerRegisterTimerEvent(t, .2, true)
	call SaveUnitHandle(HY, h, 2, GetSummonedUnit())
	call SaveUnitHandle(HY, h, 17, GetSummoningUnit())
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(GetSummoningUnit(),'A1YR'))
	set t = null
endfunction
function JIA takes nothing returns boolean
	local integer id = GetUnitTypeId(GetSummonedUnit())
	if id =='o01J' or id =='o01K' or id =='o01L' or id =='o01M' then
		call JVA(GetSummonedUnit())
		call JRA()
	endif
	return false
endfunction
function P_X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function JIA))
	set t = null
endfunction
function JAA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local unit dummyCaster =(LoadUnitHandle(HY, h, 19))
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_UNIT_DAMAGED and FK then
		set QEV = GetEventDamageSource()
	else
		call SetUnitX(whichUnit, GetUnitX(targetUnit))
		call SetUnitY(whichUnit, GetUnitY(targetUnit))
		call SetUnitX(dummyCaster, GetUnitX(targetUnit))
		call SetUnitY(dummyCaster, GetUnitY(targetUnit))
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set dummyCaster = null
	return false
endfunction
function JNA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	if GetTriggerEventId() == EVENT_UNIT_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		set QEV = GetEventDamageSource()
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function JBA takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetSummoningUnit()
	local unit targetUnit = GetSummonedUnit()
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	local integer level
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function JAA))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveUnitHandle(HY, h, 19,(dummyCaster))
	if GYX(whichUnit,'I0A8') then
		call UnitAddAbility(dummyCaster,'A04I')
	endif
	if GetUnitAbilityLevel(whichUnit,'A14K')> 0 then
		call UnitAddAbility(dummyCaster,'A14K')
	endif
	set level = GetUnitAbilityLevel(whichUnit,'A06M')
	if level == 0 then
		set level = 4
	endif
	if GetUnitAbilityLevel(whichUnit,'A1B6')> 0 then
		call UnitAddPermanentAbility(targetUnit,'A06M')
		call SetUnitAbilityLevel(targetUnit,'A06M', level)
	endif
	call SaveInteger(HY, GetHandleId(whichUnit), 4500, 1)
	set t = null
	set whichUnit = null
	set targetUnit = null
	set dummyCaster = null
endfunction
function JCA takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetSummoningUnit()
	local unit targetUnit = GetSummonedUnit()
	local integer level
	local integer id
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function JNA))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	if GetUnitAbilityLevel(whichUnit,'A1B6')> 0 then
		if GetUnitTypeId(targetUnit)=='npn2' or GetUnitTypeId(targetUnit)=='npn5' or GetUnitTypeId(targetUnit)=='n012' then
			set id ='Acdh'
			set level = GetUnitAbilityLevel(whichUnit,'Acdh')
			if level == 0 then
				set level = 4
			endif
		else
			set id ='Q119'
			set level = GetUnitAbilityLevel(whichUnit,'P119')
			if level == 0 then
				set level = 4
			endif
		endif
		if id =='Q119' then
			call UnitAddPermanentAbility(targetUnit, id)
			call SetUnitAbilityLevel(targetUnit,'P119', level)
			call UnitAddPermanentAbility(targetUnit,'A0MX')
			call SetUnitAbilityLevel(targetUnit,'A0MX', level)
		else
			call UnitAddPermanentAbility(targetUnit, id)
			call SetUnitAbilityLevel(targetUnit, id, level)
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function PrimalSplitCondition takes nothing returns boolean
	local integer OVX = GetUnitTypeId(GetSummonedUnit())
	if OVX =='npn3' or OVX =='npn6' or OVX =='n010' or OVX =='n0GZ' then
		call JBA()
	elseif CZX(OVX) then
		call JCA()
	endif
	return false
endfunction
function CreatePrimalSplitTrigger takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function PrimalSplitCondition))
	set t = null
endfunction
function JFA takes nothing returns boolean
	if UnitIsDead(GetFilterUnit()) == false and IsAliveNotStrucNotWard(GetFilterUnit()) then
		call FKX(GetFilterUnit(), IsUnitEnemy(GetFilterUnit(), E3))
	endif
	return false
endfunction
function JXE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local group g = AllocationGroup(457)
	set E3 = GetOwningPlayer(u)
	call GroupEnumUnitsInRange(g, GetSpellTargetX(), GetSpellTargetY(), 625, Condition(function JFA))
	call DeallocateGroup(g)
	set u = null
endfunction
function F6E takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0)
	call UnitAddAbility(d,'A3ID')
	call SetUnitAbilityLevel(d,'A3ID', GetUnitAbilityLevel(GetTriggerUnit(),'A06M'))
	call IssueImmediateOrderById(d, 852096)
	set d = null
endfunction
function JGA takes nothing returns nothing
	call CommonUnitAddStun(GetEnumUnit(), .75 + .25 * LI, false)
endfunction
function JHA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local real a = LoadReal(HY, h, 137)
	local real tx = LoadReal(HY, h, 47)
	local real ty = LoadReal(HY, h, 48)
	local real sx = LoadReal(HY, h, 189)
	local real sy = LoadReal(HY, h, 190)
	local group g
	local real d = GetDistanceBetween(sx, sy, tx, ty)/ 25
	local location l
	local integer count = GetTriggerEvalCount(t)
	local real x = sx + d * count * Cos(a)
	local real y = sy + d * count * Sin(a)
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		call SaveBoolean(OtherHashTable, GetHandleId(targetUnit), 99, true)
	endif
	call SetUnitX(targetUnit, CoordinateX50(x))
	call SetUnitY(targetUnit, CoordinateY50(y))
	if O0X(targetUnit) == false then
		call SetUnitFlyHeight(targetUnit, 325  -13* count, 0)
	endif
	if count == 25 then
		if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
			call SaveBoolean(OtherHashTable, GetHandleId(targetUnit), 99, true)
		endif
		call SetUnitX(targetUnit, CoordinateX50(tx))
		call SetUnitY(targetUnit, CoordinateY50(ty))
		if IsPointInRegion(TerrainCliffRegion, GetUnitX(targetUnit), GetUnitY(targetUnit)) then
			set l = GetTerrainCliffFixLocation(GetUnitX(targetUnit), GetUnitY(targetUnit))
			if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
				call SaveBoolean(OtherHashTable, GetHandleId(targetUnit), 99, true)
			endif
			call SetUnitX(targetUnit, CoordinateX75(GetLocationX(l)))
			call SetUnitY(targetUnit, CoordinateY75(GetLocationY(l)))
			call RemoveLocation(l)
			set l = null
		endif
		set U2 = whichUnit
		set g = AllocationGroup(458)
		call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 350, Condition(function DKX))
		call GroupRemoveUnit(g, targetUnit)
		set LI = LoadInteger(HY, h, 0)
		call ForGroup(g, function JGA)
		call DeallocateGroup(g)
		call KillTreeByCircle(GetUnitX(targetUnit), GetUnitY(targetUnit), 150)
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl", GetUnitX(targetUnit), GetUnitY(targetUnit)))
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call DestroyEffect(LoadEffectHandle(HY, h, 176))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if O0X(targetUnit) == false then
			call SetUnitFlyHeight(targetUnit, GetUnitDefaultFlyHeight(targetUnit), 0)
		endif
		call SetUnitPathing(targetUnit, true)
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set g = null
	return false
endfunction
function JJA takes unit whichUnit, unit targetUnit, unit Target2, real JKA, real JLA, effect FX, effect JMA, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real tx = JKA
	local real ty = JLA
	local real a = AngleBetweenXY(GetUnitX(targetUnit), GetUnitY(targetUnit), JKA, JLA)* bj_DEGTORAD
	if GetDistanceBetween(GetUnitX(targetUnit), GetUnitY(targetUnit), JKA, JLA)> 375 then
		set tx = GetUnitX(targetUnit)+ 375 * Cos(a)
		set ty = GetUnitY(targetUnit)+ 375 * Sin(a)
	endif
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveReal(HY, h, 137, a * 1.)
	call SaveReal(HY, h, 47, tx * 1.)
	call SaveReal(HY, h, 48, ty * 1.)
	call SaveReal(HY, h, 189, GetUnitX(targetUnit)* 1.)
	call SaveReal(HY, h, 190, GetUnitY(targetUnit)* 1.)
	call SaveEffectHandle(HY, h, 32, FX)
	call SaveEffectHandle(HY, h, 176, JMA)
	call SaveInteger(HY, h, 0, level)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function JHA))
	set t = null
endfunction
function JPA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer count = LoadInteger(HY, h, 34)
	local integer KLR = LoadInteger(HY, h, 12)
	local real tx = LoadReal(HY, h, 47)
	local real ty = LoadReal(HY, h, 48)
	local integer JQA = LoadInteger(HY, h, 706)
	local real a
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or(GetTriggerEventId()!= EVENT_UNIT_SPELL_EFFECT and C5X(targetUnit) == false) then
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A27F', true)
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A27X', false)
		call JJA(whichUnit, targetUnit, LoadUnitHandle(HY, h, 711), tx, ty, LoadEffectHandle(HY, h, 32), LoadEffectHandle(HY, h, 176), LoadInteger(HY, h, 0))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
		if GetSpellAbilityId()=='A27X' then
			call DestroyEffect((LoadEffectHandle(HY, h, 176)))
			set a = AngleBetweenXY(GetUnitX(targetUnit), GetUnitY(targetUnit), GetSpellTargetX(), GetSpellTargetY())* bj_DEGTORAD
			if GetDistanceBetween(GetUnitX(targetUnit), GetUnitY(targetUnit), GetSpellTargetX(), GetSpellTargetY())> 375 then
				set tx = GetUnitX(targetUnit)+ 375 * Cos(a)
				set ty = GetUnitY(targetUnit)+ 375 * Sin(a)
			else
				set tx = GetSpellTargetX()
				set ty = GetSpellTargetY()
			endif
			call SaveEffectHandle(HY, h, 176, AddSpecialEffect("Abilities\\Spells\\Other\\GeneralAuraTarget\\GeneralAuraTarget.mdl", tx, ty))
			call SaveReal(HY, h, 47, tx * 1.)
			call SaveReal(HY, h, 48, ty * 1.)
			call SaveUnitHandle(HY, h, 711, GetSpellTargetUnit())
			call SaveEffectHandle(HY, h, 176, AddSpecialEffectTarget("Abilities\\Spells\\Other\\GeneralAuraTarget\\GeneralAuraTarget.mdl", GetSpellTargetUnit(), "origin"))
		endif
	else
		set count = count + 1
		call SaveInteger(HY, h, 34, count)
		call SetUnitPathing(targetUnit, false)
		if (LoadInteger(HY, h, 707)) == 1 then
			set JQA = JQA + 3
		else
			set JQA = JQA -3
		endif
		call SaveInteger(HY, h, 706, JQA)
		if JQA == 30 then
			call SaveInteger(HY, h, 707,-1)
		elseif JQA ==-30 then
			call SaveInteger(HY, h, 707, 1)
		endif
		if O0X(targetUnit) == false then
			if count < 15 then
				call SetUnitFlyHeight(targetUnit, count * 20, 0)
			else
				call SetUnitFlyHeight(targetUnit, 300 + JQA, 0)
			endif
		endif
		if count >(KLR -25) then
			if O0X(targetUnit) == false then
				call SetUnitFlyHeight(targetUnit, 300, 0)
			endif
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A27F', true)
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A27X', false)
			call JJA(whichUnit, targetUnit, LoadUnitHandle(HY, h, 711), tx, ty, LoadEffectHandle(HY, h, 32), LoadEffectHandle(HY, h, 176), LoadInteger(HY, h, 0))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function JSA takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(whichUnit,'A27F')
	local real TXR = 1.25 + .25 * level
	local unit dummyCaster = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	set TXR = CommonUnitAddStun(targetUnit, TXR, false)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A27F', false)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A27X', true)
	call UnitAddAbility(whichUnit,'A27X')
	call SetUnitPathing(targetUnit, false)
	if O0X(targetUnit) == false then
		call UnitAddPermanentAbility(targetUnit,'Amrf')
		call UnitRemoveAbility(targetUnit,'Amrf')
	endif
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveUnitHandle(HY, h, 711, targetUnit)
	call SaveInteger(HY, h, 12, R2I(TXR / .02))
	call SaveInteger(HY, h, 34, 0)
	call SaveInteger(HY, h, 0, level)
	call SaveInteger(HY, h, 706, 0)
	call SaveInteger(HY, h, 707, 1)
	call SaveReal(HY, h, 47, GetUnitX(targetUnit)* 1.)
	call SaveReal(HY, h, 48, GetUnitY(targetUnit)* 1.)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("war3mapImported\\AntiGravityTarget.mdx", targetUnit, "origin"))
	call SaveEffectHandle(HY, h, 176, AddSpecialEffect("Abilities\\Spells\\Other\\GeneralAuraTarget\\GeneralAuraTarget.mdl", GetUnitX(targetUnit), GetUnitY(targetUnit)))
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function JPA))
	set whichUnit = null
	set targetUnit = null
	set t = null
	set dummyCaster = null
endfunction
function DGE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call JSA()
	endif
endfunction
function P1X takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A282')
endfunction
function JTA takes unit whichUnit, unit targetUnit, integer level returns nothing
	local integer id
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		if level == 1 then
			set id ='A27W'
		elseif level == 2 then
			set id ='A286'
		elseif level == 3 then
			set id ='A285'
		else
			set id ='A287'
		endif
	else
		if level == 1 then
			set id ='A291'
		elseif level == 2 then
			set id ='A28Z'
		elseif level == 3 then
			set id ='A292'
		else
			set id ='A290'
		endif
	endif
	call CXX(targetUnit, id, 1, 10)
	call A5X(SF, GetUnitX(targetUnit), GetUnitY(targetUnit))
endfunction
function JUA takes nothing returns nothing
	local real d
	if IsUnitInGroup(GetEnumUnit(), QRV) == false then
		set d = GetUnitDistanceEx(GetEnumUnit(), QOV)
		if d < QIV then
			set QIV = d
			set QXV = GetEnumUnit()
		endif
	endif
endfunction
function JWA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local group D7R = LoadGroupHandle(HY, h, 187)
	local real x = GetUnitX(targetUnit)
	local real y = GetUnitY(targetUnit)
	local group g = AllocationGroup(459)
	call GroupAddUnit(D7R, targetUnit)
	call JTA(whichUnit, targetUnit, LoadInteger(HY, h, 0))
	set U2 = whichUnit
	set QXV = null
	set QOV = targetUnit
	set QRV = D7R
	set QIV = 999999
	call GroupEnumUnitsInRange(g, x, y, 465, Condition(function DSX))
	call ForGroup(g, function JUA)
	call DeallocateGroup(g)
	if QXV == null or GetTriggerEvalCount(t)> 26 then
		call DeallocateGroup(D7R)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set targetUnit = QXV
		call SaveUnitHandle(HY, h, 17, targetUnit)
	endif
	set g = null
	set t = null
	set whichUnit = null
	set targetUnit = null
	set D7R = null
	return false
endfunction
function JYA takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local group D7R = AllocationGroup(460)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitFacing(whichUnit))
	call A5X(SF, GetUnitX(whichUnit), GetUnitY(whichUnit))
	call UnitAddPermanentAbility(dummyCaster,'A284')
	call SetUnitAbilityLevel(dummyCaster,'A284', GetUnitAbilityLevel(whichUnit,'A27G'))
	call IssueTargetOrderById(dummyCaster, 852119, targetUnit)
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveGroupHandle(HY, h, 187, D7R)
	call TriggerRegisterTimerEvent(t, .25, true)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	call TriggerAddCondition(t, Condition(function JWA))
	set whichUnit = null
	set targetUnit = null
	set t = null
	set dummyCaster = null
	set D7R = null
endfunction
function DHE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call JYA()
	endif
endfunction
function JZA takes integer id returns nothing
	set QAV[QNV]= id
	set QNV = QNV + 1
endfunction
function J_A takes integer id returns boolean
	local integer i = 0
	if IsNotItemAbility(id) == false then
		return true
	endif
	loop
	exitwhen i == QNV
		if id == QAV[i] then
			return true
		endif
		set i = i + 1
	endloop
	return false
endfunction
function J0A takes nothing returns boolean
	local unit u = GetTriggerUnit()
	local integer id = GetSpellAbilityId()
	local integer h
	if IsUnitType(u, UNIT_TYPE_HERO) and J_A(id) == false and GetUnitAbilityLevel(u,'A04R') == 0 then
		set h = GetHandleId(u)
		call SaveInteger(HY, h, 705, id)
		call SaveInteger(HY, h, 712, GetUnitAbilityLevel(u, id))
	endif
	set u = null
	return false
endfunction
function J1A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = (LoadUnitHandle(HY, h, 2))
	local integer id = (LoadInteger(HY, h, 704))
	local integer time = (LoadInteger(HY, h, 713))
	if id ==(LoadInteger(HY,(GetHandleId(u)), 704) ) then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEvalCount(t)>(15 - time) and UnitAlive(u) then
		call UnitRemoveAbility(u, id)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	return false
endfunction
function J4A takes unit u, integer id, real r returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function J1A))
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveInteger(HY, h, 704,(id))
	call SaveInteger(HY,(GetHandleId(u)), 704,(-1))
	call SaveInteger(HY, h, 713,(R2I(GetGameTime()-r)))
	set t = null
endfunction
function J5A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	local integer id =(LoadInteger(HY, h, 704))
	local integer c =(LoadInteger(HY, h, 34))
	local real r =(LoadReal(HY, h, 411))
	if GetTriggerEventId()!= EVENT_UNIT_SPELL_EFFECT and GetTriggerEventId()!= EVENT_WIDGET_DEATH then
		if c == 0 then
			call SaveInteger(HY, h, 34, 1)
			call DisplayTimedTextToPlayer(GetOwningPlayer(u), 0, 0, 10, "|c00ff0303" + GetObjectName('n0LW')+ "|r")
		else
			//call BYR(u)
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(u), id, false)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call J4A(u, id, r)
		endif
	elseif GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
		if (GetSpellAbilityId()=='A27H' or GetSpellAbilityId()=='A30J') then
			if LoadInteger(HY,(GetHandleId(GetSpellTargetUnit())), 705) != id then
				call SetPlayerAbilityAvailableEx(GetOwningPlayer(u), id, false)
				call J4A(u, id, r)
			endif
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		elseif GetSpellAbilityId() == id then
		//if GetSpellAbilityId() == id then
			call SaveReal(HY, h, 411, GetGameTime()* 1.)
		endif
	elseif GetTriggerEventId() == EVENT_WIDGET_DEATH then
		//call BYR(u)
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(u), id, false)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call J4A(u, id, r)
	endif
	set t = null
	set u = null
	return false
endfunction
function J6A takes unit u, integer id, integer level returns nothing
	if id =='A2O2'then
		set U2 = u
		call ExecuteFunc("PAI")
	endif
endfunction
function J7A takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	local unit target =(LoadUnitHandle(HY, h, 17))
	local integer J2A =(LoadInteger(HY, h, 704))
	local integer lv =(LoadInteger(HY, h, 5))
	local real J8A = 60 *(2 + IMaxBJ(GetUnitAbilityLevel(u,'A27H'), GetUnitAbilityLevel(u,'A30J')))
	local integer id = GetPlayerId(GetOwningPlayer(u))
	local boolean J9A = (GetUnitAbilityLevel(u, J2A) == 0) or J2A == LoadInteger(HY,(GetHandleId(u)), 704)
	local integer i = 1
	call A5X(LF, GetUnitX(u), GetUnitY(u))
	loop
	exitwhen i > 4 + ExtraSkillsNumber or J9A == false
		if HeroCommonSkills[PlayerSkillIndex[id * HL + i]] == J2A then
			set J9A = false
		endif
		if HeroUpgradeSkills[PlayerSkillIndex[id * HL + i]] == J2A then
			set J9A = false
		endif
		set i = i + 1
	endloop
	if J9A then
		if (LoadInteger(HY,(GetHandleId(target)), 710))> 0 then
			call SaveInteger(HY,(GetHandleId(u)), 710,((LoadInteger(HY,(GetHandleId(target)), 710))))
		endif
		call CommonTextTag(GetObjectName(J2A), 3.5, u, .024, 170, 0, 255, 216)
		call SaveInteger(HY,(GetHandleId(u)), 704,(J2A))
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(u), J2A, true)
		call UnitAddPermanentAbility(u, J2A)
		call SetUnitAbilityLevel(u, J2A, lv)
		call J6A(u, J2A, lv)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(u))
		call SaveInteger(HY, h, 34, 0)
		call SaveInteger(HY, h, 704,(J2A))
		call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_EFFECT)
		call TriggerRegisterTimerEvent(t, J8A, false)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerRegisterTimerEvent(t, J8A -20, false)
		call TriggerAddCondition(t, Condition(function J5A))
	else
		call CommonTextTag("窃取失败 ;(", 3.5, u, .024, 170, 0, 255, 216)
	endif
	set t = null
	set u = null
	set target = null
endfunction
function KVA takes unit u, unit target, integer id, integer lv returns nothing
	local trigger t = LaunchMissileByUnitDummy(target, u,'h0DB', "J7A", 900, false)
	local integer h = GetHandleId(t)
	call A5X(KF, GetUnitX(target), GetUnitY(target))
	call CommonTextTag(GetObjectName(id), 3.75, target, .024, 170, 0, 255, 216)
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveUnitHandle(HY, h, 17,(target))
	call SaveInteger(HY, h, 704,(id))
	call SaveInteger(HY, h, 5,(lv))
	set t = null
endfunction
function KXA takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit t = GetSpellTargetUnit()
	local integer id = LoadInteger(HY,(GetHandleId(t)), 705)
	local boolean b = GetSpellAbilityId()=='A30J'
	local integer key = 0
	if id != 0 then
		set key = GetSkillAghanimUpgradeIndex(id)
		if b then
			if key> 0 and AghanimUpgradeUpgradeId[key]> 0 then
				set id = AghanimUpgradeUpgradeId[key]
			endif
		else
			if key> 0 and AghanimUpgradeNormalId[key]> 0 then
				set id = AghanimUpgradeNormalId[key]
			endif
		endif
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Nebula.mdx", t, "origin"))
		call KVA(u, t, id, LoadInteger(HY, GetHandleId(t), 712))
	endif
	set u = null
	set t = null
endfunction
function DJE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call KXA()
	endif
endfunction
//lbk 不能偷的技能
function KOA takes nothing returns nothing
	call JZA('QB0L')
	call JZA('A0A5')
	call JZA('A0AG')
	call JZA('A0BG')
	call JZA('A0DY')
	call JZA('A0ES')
	call JZA('A0FH')
	call JZA('A0GC')
	call JZA('A0NS')
	call JZA('A0Q5')
	call JZA('A0TE')
	call JZA('A0TK')
	call JZA('A0WP')
	call JZA('A0WQ')
	call JZA('A03G')
	call JZA('A03J')
	call JZA('A04J')
	call JZA('A04M')
	call JZA('A04N')
	call JZA('A073')
	call JZA('A1C0')
	call JZA('A1DA')
	call JZA('A1EA')
	call JZA('A1FQ')
	call JZA('A1MN')
	call JZA('A1NA')
	call JZA('A1NH')
	call JZA('A1RI')
	call JZA('A1S9')
	call JZA('A1T8')
	call JZA('A1TU')
	call JZA('A1TX')
	call JZA('A1VG')
	//call JZA('A1VH')
	call JZA('A1VU')
	call JZA('A1WF')
	call JZA('A1WO')
	call JZA('A1Z2')
	call JZA('A1Z3')
	call JZA('A2FX')
	call JZA('A2JL')
	call JZA('A2JO')
	call JZA('A2JP')
	call JZA('A2JQ')
	call JZA('A2JR')
	call JZA('A2K9')
	call JZA('A2KE')
	call JZA('A2KH')
	call JZA('A10R')
	//call JZA('A11N')
	call JZA('A11T')
	call JZA('A20N')
	call JZA('A21H')
	call JZA('A21J')
	call JZA('A24A')
	call JZA('A24B')
	call JZA('A24E')
	call JZA('A27F')
	call JZA('A27G')
	call JZA('A27H')
	call JZA('A27X')
	call JZA('A28F')
	call JZA('A28Q')
	call JZA('A30J')
	call JZA('A32D')
	call JZA('A43D')
	call JZA('A43P')
	call JZA('A121')
	call JZA('A205')
	call JZA('A229')
	call JZA('A418')
	call JZA('ANcr')
	call JZA('QB0K')
	call JZA('QB03')
	call JZA('QM00')
	call JZA('QM01')
	call JZA('QM02')
	call JZA('QM03')
	call JZA('QM04')
	call JZA('Z234')
endfunction
function P2X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function J0A))
	set t = null
	call KOA()
endfunction
function KRA takes nothing returns nothing
	if DVX(GetEnumUnit()) then
		return
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A27N')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'A27N')
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A27O')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'A27O')
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A27M')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'A27M')
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A27P')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'A27P')
	endif
endfunction
function KIA takes nothing returns nothing
	if DVX(GetEnumUnit()) then
		return
	endif
	if QBV == 1 then
		if GetUnitAbilityLevel(GetEnumUnit(),'A27N') == 0 then
			call UnitAddPermanentAbility(GetEnumUnit(),'A27N')
		endif
	elseif QBV == 2 then
		if GetUnitAbilityLevel(GetEnumUnit(),'A27O') == 0 then
			call UnitRemoveAbility(GetEnumUnit(),'A27N')
			call UnitAddPermanentAbility(GetEnumUnit(),'A27O')
		endif
	elseif QBV == 3 then
		if GetUnitAbilityLevel(GetEnumUnit(),'A27M') == 0 then
			call UnitRemoveAbility(GetEnumUnit(),'A27N')
			call UnitRemoveAbility(GetEnumUnit(),'A27O')
			call UnitAddPermanentAbility(GetEnumUnit(),'A27M')
		endif
	elseif QBV == 4 then
		if GetUnitAbilityLevel(GetEnumUnit(),'A27P') == 0 then
			call UnitRemoveAbility(GetEnumUnit(),'A27N')
			call UnitRemoveAbility(GetEnumUnit(),'A27O')
			call UnitRemoveAbility(GetEnumUnit(),'A27M')
			call UnitAddPermanentAbility(GetEnumUnit(),'A27P')
		endif
	endif
endfunction
function KIAA2 takes nothing returns nothing
	local integer xp = 2
	if QBV == 2 then
		set xp = 4
	elseif QBV == 3 then
		set xp = 6
	elseif QBV == 4 then
		set xp = 8
	endif
	call AddHeroXPSimple(GetEnumUnit(), xp, true)
endfunction
function KAAA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local group g = AllocationGroup(461)
	if whichUnit == null then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call DeallocateGroup(g)
		return false
	endif
	set U2 = whichUnit
	set QBV = GetUnitAbilityLevel(whichUnit,'P211')
	if UnitIsDead(whichUnit) == false then
		call GroupEnumUnitsInRange(g, x, y, 925, Condition(function B7O))
	endif
	if UnitIsDead(whichUnit) == false and GetUnitAbilityLevel(whichUnit,'A36D') == 0 then
		call ForGroup(g, function KIAA2)
	endif
	call DeallocateGroup(g)
	set t = null
	set whichUnit = null
	set g = null
	return false
endfunction
function KAA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local group IQI =(LoadGroupHandle(HY, h, 340))
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local group g = AllocationGroup(462)
	if whichUnit == null or GetUnitTypeId(whichUnit) == 0 then //or GetUnitTypeId(whichUnit)!='E02X' 
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call ForGroup(IQI, function KRA)
		call DeallocateGroup(IQI)
		call DeallocateGroup(g)
		return false
	endif
	set U2 = whichUnit
	set QBV = GetUnitAbilityLevel(whichUnit,'P211')
	if UnitIsDead(whichUnit) == false then
		call GroupEnumUnitsInRange(g, x, y, 925, Condition(function B7O))
	endif
	call GroupRemoveGroup(g, IQI)
	call ForGroup(IQI, function KRA)
	if UnitIsDead(whichUnit) == false and GetUnitAbilityLevel(whichUnit,'A36D') == 0 then
		call ForGroup(g, function KIA)
	endif
	call SaveGroupHandle(HY, h, 340,(g))
	call DeallocateGroup(IQI)
	set t = null
	set whichUnit = null
	set IQI = null
	set g = null
	return false
endfunction
function PEE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local trigger t1 = CreateTrigger()
	local integer h1 = GetHandleId(t1)
	call TriggerRegisterTimerEvent(t, .3, true)
	call TriggerAddCondition(t, Condition(function KAA))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveGroupHandle(HY, h, 340,(AllocationGroup(463)))
	
	call TriggerRegisterTimerEvent(t1, 2, true)
	call TriggerAddCondition(t1, Condition(function KAAA))
	call SaveUnitHandle(HY, h1, 2,(whichUnit))
	set t = null
	set whichUnit = null
	set t1 = null
endfunction
function KNA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit KKX = LoadUnitHandle(HY, h, 1)
	local unit d = LoadUnitHandle(HY, h, 0)
	local real KBA = LoadReal(HY, h, 0)
	local integer c = LoadInteger(HY, h, 0)+ 1
	if UnitIsDead(KKX) and LoadBoolean(HY, h, 0) == false then
		call SaveBoolean(HY, h, 0, true)
	endif
	if LoadBoolean(HY, h, 0) == false then
		call SetUnitPosition(d, GetUnitX(KKX), GetUnitY(KKX))
		if GetWidgetLife(d)> KBA then
			call SetWidgetLife(KKX, GetWidgetLife(KKX)+(GetWidgetLife(d)-KBA))
			call SaveReal(HY, h, 0, GetWidgetLife(d))
		endif
	endif
	if c > 50 * 50 or UnitIsDead(KKX) or UnitIsDead(d) then
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
		call KillUnit(d)
	else
		call SaveInteger(HY, h, 0, c)
	endif
	set d = null
	set KKX = null
	set t = null
endfunction
function DLE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit d = CreateUnit(GetOwningPlayer(u),'e01V', GetUnitX(u), GetUnitY(u), 0)
	local timer t = CreateTimer()
	call KillUnit(LoadUnitHandle(HY, GetHandleId(u),'EXOR'))
	call UnitAddPermanentAbility(d,'A44C')
	call SetUnitAbilityLevel(d,'A44C', GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call IssueImmediateOrderById(d, 852556)
	call SetWidgetLife(d, 1)
	call TimerStart(t, .02, true, function KNA)
	call SaveUnitHandle(HY, GetHandleId(t), 0, d)
	call SaveUnitHandle(HY, GetHandleId(t), 1, u)
	call SaveReal(HY, GetHandleId(t), 0, 1)
	call SaveUnitHandle(HY, GetHandleId(u),'EXOR', d)
	set t = null
	set u = null
	set d = null
endfunction
function KCA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer id = LoadInteger(HY, h, 0)
	local timer tt = LoadTimerHandle(HY, h, 0)
	if YDWEGetUnitAbilityState(u, id, 1) > 0.5 then
		call Japi_SetUnitAbilityCoolDown1(u, id, 0.5)
		//call RefreshUnitAbilityCoolDownTimer(u, id, 0.5)
		call CommonTextTag("傻了吧!爷还有!", 3.5, u, .03, 255, 0, 0, 255)
	endif
	call DestroyTimer(tt)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set tt = null
	set t = null
endfunction
function KDA takes unit u, integer id returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local timer tt = CreateTimer()
	call TimerStart(tt, 0., false, null)
	call SaveBoolean(HY, h, 0, true)
	call TriggerRegisterTimerExpireEvent(t, tt)
	call SaveTimerHandle(HY, h, 0, tt)
	call TriggerAddCondition(t, Condition(function KCA))
	call SaveUnitHandle(HY, h, 0, u)
	call SaveInteger(HY, h, 0, id)
	set t = null
	set tt = null
endfunction
function KFA takes nothing returns nothing
	local integer probability
	local unit u = GetTriggerUnit()
	local integer id = GetSpellAbilityId()	
	if GetUnitAbilityLevel(GetTriggerUnit(),'A02C')!= 0 and YDWEGetUnitAbilityDataReal(u, id, GetUnitAbilityLevel(GetTriggerUnit(), id), 105)> 0.5 then
		set u = GetTriggerUnit()
		if IsUltimateSkill(id) then
			set probability = GetUnitAbilityLevel(u,'A02C')* 5 -5
		else
			set probability = GetUnitAbilityLevel(u,'A02C')* 5 + 5
		endif
		if probability > 0 and IsMetamorphosisSkill(id) == false and X8R(id) then
			if TKV(u,'A02C', probability) or JE then
				call KDA(u, id)
			endif
		endif
		set u = null
	endif
endfunction
function KGA takes nothing returns nothing
	local unit u = GetTriggerUnit()
	if GetUnitTypeId(u)=='H00S' then
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl", u, "origin"))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl", u, "origin"))
	endif
	set u = null
endfunction
function KHA takes nothing returns nothing
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\ImmolationRed\\ImmolationRedDamage.mdl", GetEnumUnit(), "chest"))
	call UnitDamageTargetEx(QCV, GetEnumUnit(), 1,(20 + 10* QDV)/ 5)
endfunction
function KJA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local integer level = LoadInteger(HY, h, 0)
	local group g
	if (GetUnitAbilityLevel(whichUnit,'B0FP') == 0 and GetUnitAbilityLevel(whichUnit,'B0FQ') == 0) or(GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A2HS') then
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(whichUnit,'A2H7')
		call UnitRemoveAbility(whichUnit,'B0FO')
		call UnitRemoveAbility(whichUnit,'A2IX')
		call UnitRemoveAbility(whichUnit,'A2IW')
		call UnitRemoveAbility(whichUnit,'A2IV')
		call UnitRemoveAbility(whichUnit,'A2IY')
	else
		set U2 = whichUnit
		set QCV = whichUnit
		set QDV = level
		set g = AllocationGroup(464)
		call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 400 + 25, Condition(function DJX))
		call ForGroup(g, function KHA)
		call DeallocateGroup(g)
	endif
	set g = null
	set t = null
	set whichUnit = null
	return false
endfunction
function DME takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	local integer level = GetUnitAbilityLevel(whichUnit,'A2HS')
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call UnitAddAbility(dummyCaster,'A2H5')
	call SetUnitAbilityLevel(dummyCaster,'A2H5', level)
	call IssueTargetOrderById(dummyCaster, 852186, whichUnit)
	call TriggerRegisterTimerEvent(t, .2, true)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	call TriggerAddCondition(t, Condition(function KJA))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("war3mapImported\\FlameGuard.mdx", whichUnit, "origin"))
	set whichUnit = null
	set dummyCaster = null
	set t = null
endfunction
function KKA takes unit whichUnit returns nothing
	call UnitRemoveAbility(whichUnit,'BOhx')
	call UnitRemoveAbility(whichUnit,'B00H')
endfunction
function KLA takes unit whichUnit returns nothing
	call UnitRemoveAbility(whichUnit,'A2H9')
	call UnitRemoveAbility(whichUnit,'B0FM')
endfunction
function KMA takes unit whichUnit returns nothing
	call UnitRemoveAbility(whichUnit,'A2JH')
	call UnitRemoveAbility(whichUnit,'A2JG')
	call UnitRemoveAbility(whichUnit,'A2JJ')
	call UnitRemoveAbility(whichUnit,'A2JI')
	call UnitRemoveAbility(whichUnit,'B0FL')
endfunction

function KSA takes unit whichUnit returns nothing
	call UnitAddPermanentAbility(whichUnit,'A2H9')
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A2H9', false)
endfunction
function KTA takes unit whichUnit, integer level returns nothing
	if level < 1 then
		return
	endif
	if level == 1 then
		call UnitAddPermanentAbility(whichUnit,'A2JH')
	elseif level == 2 then
		call UnitAddPermanentAbility(whichUnit,'A2JG')
	elseif level == 3 then
		call UnitAddPermanentAbility(whichUnit,'A2JJ')
	else
		call UnitAddPermanentAbility(whichUnit,'A2JI')
	endif
endfunction
function K1A takes nothing returns boolean
	local unit TJX = GetSummonedUnit()
	if IsUnitIllusion(TJX) and GetUnitTypeId(TJX)=='N0MH' then
		call KLA(TJX)
		call UnitRemoveAbility(TJX,'A2JF')
		call KMA(TJX)
		call UnitAddAbility(TJX,'A2H2')
		call UnitRemoveAbility(TJX,'A2H2')
	endif
	set TJX = null
	return false
endfunction
function LCE takes nothing returns nothing
	if GetUnitTypeId(GetTriggerUnit())=='N0MH' or LoadInteger(HY, GetHandleId(GetTriggerUnit()), 4319) == 1 or (IsUnitAttackDisable(GetTriggerUnit())) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "现在无法使用。")
	endif
endfunction
function P3X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function K1A))
	set t = null
endfunction
function K2A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 0)
	local integer KLR = 2
	if level > 2 then
		set KLR = 3
	endif
	if GetTriggerEvalCount(t) == KLR then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, 20 + 20 * level)
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction
function K3A takes nothing returns nothing
	local unit whichUnit = U2
	local unit targetUnit = MissileHitTargetUnit
	local unit dummyCaster = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = LoadInteger(HY, GetHandleId(GetTriggeringTrigger()), 0)
	call UnitAddAbility(dummyCaster,'A2H4')
	call IssueTargetOrderById(dummyCaster, 852106, targetUnit)
	call TriggerAddCondition(t, Condition(function K2A))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveInteger(HY, h, 0, level)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerRegisterTimerEvent(t, 1, true)
	set dummyCaster = null
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function DQE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local group g = AllocationGroup(467)
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local unit u1 = null
	local unit u2 = null
	local unit u3 = null
	local integer XMR = 0
	local unit u
	local trigger t
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, x, y, 425, Condition(function DSX))
	loop
	exitwhen FirstOfGroup(g) == null or XMR == 2
		set u = GroupPickRandomUnit(g)
		if u != null then
			if XMR == 0 then
				set u1 = u
			elseif XMR == 1 then
				set u2 = u
			elseif XMR == 2 then
				set u3 = u
			endif
			set XMR = XMR + 1
			call GroupRemoveUnit(g, u)
		endif
	endloop
	call DeallocateGroup(g)
	if u1 != null then
		set t = LaunchMissileByUnitDummy(whichUnit, u1,'h0E0', "K3A", 9000, false)
		call SaveInteger(HY, GetHandleId(t), 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	endif
	if u2 != null then
		set t = LaunchMissileByUnitDummy(whichUnit, u2,'h0E0', "K3A", 9000, false)
		call SaveInteger(HY, GetHandleId(t), 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	endif
	if u3 != null then
		set t = LaunchMissileByUnitDummy(whichUnit, u3,'h0E0', "K3A", 9000, false)
		call SaveInteger(HY, GetHandleId(t), 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
	endif
	set g = null
	set whichUnit = null
	set u = null
	set u1 = null
	set u2 = null
	set u3 = null
	set t = null
endfunction
function K4A takes nothing returns boolean
	local unit whichUnit =(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 2))
	local integer h = GetHandleId(whichUnit)
	local integer i = 0
	local real ECX =(GetGameTime())
	local integer K5A =(LoadInteger(HY, h, 749))
	local real x
	local real y
	local real t
	loop
	exitwhen i > K5A
		set t =(LoadReal(HY, h,( 10000+ i)))
		if t + 10> ECX then
			set x =(LoadReal(HY, h,( 11000+ i)))
			set y =(LoadReal(HY, h,( 12000+ i)))
		endif
		set i = i + 1
	endloop
	set whichUnit = null
	return false
endfunction
function K6A takes integer h, integer K5A, real targetX, real targetY returns boolean
	local real x
	local real y
	local real t
	local integer i = 0
	local real ECX =(GetGameTime())
	loop
	exitwhen i > K5A
		set t =(LoadReal(HY, h,( 10000+ i)))
		if t + 10> ECX then
			set x =(LoadReal(HY, h,( 11000+ i)))
			set y =(LoadReal(HY, h,( 12000+ i)))
			if GetDistanceBetween(x, y, targetX, targetY)< 75 then
				return true
			endif
		endif
		set i = i + 1
	endloop
	return false
endfunction
function K7A takes integer h, integer K5A returns integer
	local real t
	local integer i = 0
	local real ECX =(GetGameTime())
	loop
	exitwhen i > K5A
		set t =(LoadReal(HY, h,( 10000+ i)))
		if t + 10< ECX then
			return i
		endif
		set i = i + 1
	endloop
	return -1
endfunction
function K8A takes unit whichUnit, integer K9A, real x, real y returns nothing
	local integer h = GetHandleId(whichUnit)
	local integer K5A =(LoadInteger(HY, h, 749))
	local integer LVA
	if K6A(h, K5A, x, y) then
		return
	endif
	set LVA = K7A(h, K5A)
	if LVA ==-1 then
		set LVA = K5A
		set K5A = K5A + 1
		call SaveInteger(HY, h, 749,(K5A))
	endif
	call SaveInteger(HY, h, 13000,(K9A))
	call SaveReal(HY, h, 10000,(((GetGameTime()))* 1.))
	call SaveReal(HY, h, 11000,((x)* 1.))
	call SaveReal(HY, h, 11000,((y)* 1.))
endfunction
function LEA takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function K4A))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	set whichUnit = null
	set t = null
endfunction
function LXA takes nothing returns nothing
	call UnitDamageTargetEx(QGV, GetEnumUnit(), 1, 50 + QFV * 50)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\LordofFlameMissile\\LordofFlameMissile.mdl", GetEnumUnit(), "origin"))
endfunction
function LOA takes unit whichUnit, unit L3R, real x, real y returns nothing
	local group g
	call KillUnit(L3R)
	call ABX("war3mapImported\\Firaga_2.mdx", x, y, 2)
	set g = AllocationGroup(468)
	set U2 = whichUnit
	set QGV = whichUnit
	set QFV = GetUnitAbilityLevel(whichUnit,'A2JK')
	call GroupEnumUnitsInRange(g, x, y, 450 + 25, Condition(function DJX))
	call UnitRemoveAbility(whichUnit,'A04R')
	call ForGroup(g, function LXA)
	call UnitAddPermanentAbility(whichUnit,'A04R')
	call DeallocateGroup(g)
	set g = null
endfunction
function LRA takes unit whichUnit, unit LIA returns nothing
	local integer h = GetHandleId(whichUnit)
	local integer LAA =(LoadInteger(HY, h, 746))
	local unit LNA
	local integer i = 1
	local integer x
	loop
	exitwhen i > LAA
		set LNA =(LoadUnitHandle(HY, h,( 1450+ i)))
		if LNA == LIA then
			set LAA = LAA -1
			call SaveUnitHandle(HY, h,( 1450+ i),((LoadUnitHandle(HY, h,( 1450+ i + 1)))))
			call SaveInteger(HY, h, 746,(LAA))
			set x = i + 1
			loop
			exitwhen x > LAA
				call SaveUnitHandle(HY, h,( 1450+ x),((LoadUnitHandle(HY, h,( 1450+ x + 1)))))
				set x = x + 1
			endloop
		endif
		set i = i + 1
	endloop
	set LNA = null
endfunction

function FireRemnatTimeText takes unit u, real s returns nothing
	local texttag tt = LoadTextTagHandle(HY, GetHandleId(u), 'time')
	local unit d
	call SetTextTagText(tt, I2S(R2I(s)), .025)
	
	call SetTextTagPosUnit(tt, u, -32)
	call SetTextTagColor(tt, 255, 200, 0, 255)
	call SetTextTagVelocity(tt, 0, 0)
	call SetTextTagVisibility(tt, IsUnitAlly(u, LocalPlayer) or IsObserverPlayer(LocalPlayer))
	call SetTextTagPermanent(tt, true)
	
	set tt = null
endfunction

function LBA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit L3R =(LoadUnitHandle(HY, h, 19))
	local real GRR = GetUnitX(L3R)
	local real GIR = GetUnitY(L3R)
	local real tx =(LoadReal(HY, h, 47))
	local real ty =(LoadReal(HY, h, 48))
	local real a = AngleBetweenXY(GRR, GIR, tx, ty)* bj_DEGTORAD
	local real targetX
	local real targetY
	local real d = GetDistanceBetween(GRR, GIR, tx, ty)
	local real VEI = GetHeroMoveSpeed(whichUnit)* 2.5 * .02
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call LRA(whichUnit, L3R)
		
		call DestroyTextTag(LoadTextTagHandle(HY, GetHandleId(L3R), 'time'))
		
		call DestroyEffect((LoadEffectHandle(HY, h, 175)))
		call DestroyEffect((LoadEffectHandle(HY, h, 176)))
		call DestroyEffect((LoadEffectHandle(HY, h, 177)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif d < 2 then
		call FireRemnatTimeText(L3R , 45 - GetTriggerEvalCount(t) * .02)
		call SetUnitAnimationByIndex(L3R, 1)
	else
		if d < VEI then
			set targetX = tx
			set targetY = ty
		else
			set targetX = GRR + VEI * Cos(a)
			set targetY = GIR + VEI * Sin(a)
		endif
		call SetUnitX(L3R, targetX)
		call SetUnitY(L3R, targetY)
	endif
	set t = null
	set whichUnit = null
	set L3R = null
	return false
endfunction
function LCA takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real a = AngleBetweenXY(GetUnitX(whichUnit), GetUnitY(whichUnit), GetSpellTargetX(), GetSpellTargetY())* bj_DEGTORAD
	local integer h = GetHandleId(whichUnit)
	local integer LAA =(LoadInteger(HY, h, 746))
	local integer level = GetUnitAbilityLevel(whichUnit,'A2JK')
	local unit d = CreateUnit(GetOwningPlayer(whichUnit),'h0E8', GetUnitX(whichUnit), GetUnitY(whichUnit), a * bj_RADTODEG)
	local trigger t
	local integer i = 1
	set LAA = LAA + 1
	call SaveUnitHandle(HY, h,( 1450+ LAA),(d))
	call SaveInteger(HY, h, 746,(LAA))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SetUnitVertexColor(d, 255, 255, 255, 75)
	call SetUnitTimeScale(d, 2)
	call SetUnitAnimationByIndex(d, 0)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function LBA))
	call TriggerRegisterDeathEvent(t, d)
	call UnitApplyTimedLife(d,'BTLF', 45)
	
	call SaveTextTagHandle(HY, GetHandleId(d), 'time', CreateTextTag())
	
	call SaveEffectHandle(HY, h, 175,(AddSpecialEffectTarget("war3mapImported\\Phoenix_Missile_smaller.mdx", d, "hand right alternate")))
	call SaveEffectHandle(HY, h, 176,(AddSpecialEffectTarget("war3mapImported\\Phoenix_Missile_smaller.mdx", d, "hand left alternate")))
	call SaveEffectHandle(HY, h, 177,(AddSpecialEffectTarget("war3mapImported\\FlameDash_Ground.mdx", d, "origin")))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 19,(d))
	call SaveReal(HY, h, 47, CoordinateX50((GetSpellTargetX())* 1.))
	call SaveReal(HY, h, 48, CoordinateY50((GetSpellTargetY())* 1.))
	set whichUnit = null
	set t = null
	set d = null
endfunction
function DSE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local integer CHO =(LoadInteger(HY,(GetHandleId(whichUnit)), 747))
	if CHO > 0 then
		call LCA()
		call UnitRemoveAbility(whichUnit, QMV[CHO])
		set CHO = CHO -1
		call SaveInteger(HY,(GetHandleId(whichUnit)), 747,(CHO))
		call UnitAddPermanentAbility(whichUnit, QMV[CHO])
	else
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "充能点数不足")
	endif
	set whichUnit = null
endfunction
function LDA takes nothing returns boolean
	return GetUnitTypeId(GetFilterUnit())=='h0E8'
endfunction
function LFA takes nothing returns nothing
	local real GIX = GetDistanceBetween(GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()), QHV, QJV)
	if GIX > QKV and UnitIsDead(GetEnumUnit()) == false then
		set QLV = GetEnumUnit()
		set QKV = GIX
	endif
endfunction
function LGA takes unit whichUnit, real x, real y returns unit
	local group g = AllocationGroup(469)
	set QLV = null
	set QKV =-1
	set QHV = x
	set QJV = y
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(whichUnit), Condition(function LDA))
	call ForGroup(g, function LFA)
	call DeallocateGroup(g)
	set g = null
	return QLV
endfunction
function LHA takes unit u1, unit u2 returns real
	local real LJA = GetUnitDistanceEx(u1, u2)
	local real time = LJA / 1300.
	if time > .4 then
		return LJA / .4
	endif
	return 1300.
endfunction
function LKA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local real XVA =(LoadReal(HY, h, 47))
	local real XEA =(LoadReal(HY, h, 48))
	local unit L3R =(LoadUnitHandle(HY, h, 19))
	local real GRR = GetUnitX(whichUnit)
	local real GIR = GetUnitY(whichUnit)
	local real tx =(LoadReal(HY, h, 6))
	local real ty =(LoadReal(HY, h, 7))
	local real a
	local real targetX
	local real targetY
	local real d
	local real speed =(LoadReal(HY, h, 44))
	local real VEI = speed * .02
	local group g
	local integer count =(LoadInteger(HY, h, 34))
	if L3R != null then
		set tx = GetUnitX(L3R)
		set ty = GetUnitY(L3R)
		call SaveReal(HY, h, 6,((tx)* 1.))
		call SaveReal(HY, h, 7,((ty)* 1.))
	endif
	set a = AngleBetweenXY(GRR, GIR, tx, ty)* bj_DEGTORAD
	set d = GetDistanceBetween(GRR, GIR, tx, ty)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call SaveInteger(HY, GetHandleId(whichUnit), 4319, 2)
		call ResetUnitVertexColor(whichUnit)
		call SetUnitVertexColorEx(whichUnit,-1,-1,-1, 255)
		call SetUnitTimeScale(whichUnit, 1)
		call SetUnitAnimationByIndex(whichUnit, 0)
		call SetUnitPathing(whichUnit, true)
		call SetUnitInvulnerable(whichUnit, false)
		call UnitRemoveAbility(whichUnit,'A04R')
		call DestroyEffect((LoadEffectHandle(HY, h, 175)))
		call DestroyEffect((LoadEffectHandle(HY, h, 176)))
		call DestroyEffect((LoadEffectHandle(HY, h, 177)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif d < VEI then
		call SetUnitX(whichUnit, tx)
		call SetUnitY(whichUnit,(ty))
		call KillTreeByCircle(tx, ty, 100)
		call SaveBoolean(OtherHashTable, GetHandleId(whichUnit), 99, true)
		call LOA(whichUnit, L3R, tx, ty)
		set L3R = LGA(whichUnit, XVA, XEA)
		if L3R == null then
			call SaveInteger(HY, GetHandleId(whichUnit), 4319, 2)
			call ResetUnitVertexColor(whichUnit)
			call SetUnitVertexColorEx(whichUnit,-1,-1,-1, 255)
			call SetUnitTimeScale(whichUnit, 1)
			call SetUnitAnimationByIndex(whichUnit, 1)
			call SetUnitPathing(whichUnit, true)
			call SetUnitInvulnerable(whichUnit, false)
			call UnitRemoveAbility(whichUnit,'A04R')
			call DestroyEffect((LoadEffectHandle(HY, h, 175)))
			call DestroyEffect((LoadEffectHandle(HY, h, 176)))
			call DestroyEffect((LoadEffectHandle(HY, h, 177)))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			call SaveInteger(HY, h, 34,(count + 1))
			call SaveUnitHandle(HY, h, 19,(L3R))
			call SaveReal(HY, h, 44,((LHA(whichUnit, L3R))* 1.))
			call SaveReal(HY, h, 6,((GetUnitX(L3R))* 1.))
			call SaveReal(HY, h, 7,((GetUnitY(L3R))* 1.))
		endif
	else
		call SetUnitAnimationByIndex(whichUnit, 0)
		call SetUnitPathing(whichUnit, false)
		set targetX = GRR + VEI * Cos(a)
		set targetY = GIR + VEI * Sin(a)
		if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
			call SaveBoolean(OtherHashTable, GetHandleId(whichUnit), 99, true)
		endif
		call SetUnitX(whichUnit,(targetX))
		call SetUnitY(whichUnit, targetY)
		call SaveBoolean(OtherHashTable, GetHandleId(whichUnit), 99, true)
		call KillTreeByCircle(targetX, targetY, 100)
		call SetUnitFacing(whichUnit, a * bj_RADTODEG)
	endif
	call K8A(whichUnit, count, GetUnitX(whichUnit), GetUnitY(whichUnit))
	set t = null
	set whichUnit = null
	set L3R = null
	set g = null
	return false
endfunction
function LLA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	call SetUnitState(whichUnit, UNIT_STATE_MANA, GetUnitState(whichUnit, UNIT_STATE_MANA)+ 100)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction
function DTE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t
	local integer h = GetHandleId(whichUnit)
	local integer LAA =(LoadInteger(HY, h, 746))
	local unit L3R
	if LAA > 0 and LoadInteger(HY, GetHandleId(whichUnit), 4319)!= 1 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SetUnitVertexColorEx(whichUnit, 255, 0, 0, 75)
		call SetUnitTimeScale(whichUnit, 2)
		call SetUnitAnimationByIndex(whichUnit, 0)
		call SetUnitPathing(whichUnit, false)
		call SetUnitInvulnerable(whichUnit, true)
		call UnitAddPermanentAbility(whichUnit,'A04R')
		call Web_removestate(whichUnit) //删除蜘蛛网状态
		call SaveInteger(HY, GetHandleId(whichUnit), 4319, 1)
		call TriggerRegisterTimerEvent(t, .02, true)
		call TriggerAddCondition(t, Condition(function LKA))
		call TriggerRegisterDeathEvent(t, whichUnit)
		call SaveEffectHandle(HY, h, 175,(AddSpecialEffectTarget("war3mapImported\\Phoenix_Missile_smaller.mdx", whichUnit, "hand right alternate")))
		call SaveEffectHandle(HY, h, 176,(AddSpecialEffectTarget("war3mapImported\\Phoenix_Missile_smaller.mdx", whichUnit, "hand left alternate")))
		call SaveEffectHandle(HY, h, 177,(AddSpecialEffectTarget("war3mapImported\\FlameDash_Ground.mdx", whichUnit, "origin")))
		call SaveUnitHandle(HY, h, 2,(whichUnit))
		call SaveReal(HY, h, 47,((GetSpellTargetX())* 1.))
		call SaveReal(HY, h, 48,((GetSpellTargetY())* 1.))
		set L3R = LGA(whichUnit, GetSpellTargetX(), GetSpellTargetY())
		call SaveUnitHandle(HY, h, 19,(L3R))
		call SaveReal(HY, h, 44,((LHA(whichUnit, L3R))* 1.))
		call SaveReal(HY, h, 6,((GetUnitX(L3R))* 1.))
		call SaveReal(HY, h, 7,((GetUnitY(L3R))* 1.))
		call SaveInteger(HY, h, 34, 1)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .0, false)
		call TriggerAddCondition(t, Condition(function LLA))
		call SaveUnitHandle(HY, h, 2,(whichUnit))
	endif
	set t = null
	set whichUnit = null
	set L3R = null
endfunction
function LMA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer CHO =(LoadInteger(HY,(GetHandleId(whichUnit)), 747))
	local integer count =(LoadInteger(HY, h, 34))
	if CHO < 3 then
		set count = count -1
		call SaveInteger(HY, h, 34,(count))
		if count == 0 then
			call UnitRemoveAbility(whichUnit, QMV[CHO])
			set count = 35
			call SaveInteger(HY, h, 34,(count))
			set CHO = CHO + 1
			call SaveInteger(HY,(GetHandleId(whichUnit)), 747,(CHO))
			call UnitAddPermanentAbility(whichUnit, QMV[CHO])
		endif
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
function LPA takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveInteger(HY,(GetHandleId(whichUnit)), 747, 3)
	call UnitAddPermanentAbility(whichUnit, QMV[3])
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function LMA))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveInteger(HY, h, 34, 30)
	set whichUnit = null
	set t = null
endfunction
function SAE takes nothing returns nothing
	call UnitAddPermanentAbility(GetTriggerUnit(),'A2JL')
	call SetUnitAbilityLevel(GetTriggerUnit(),'A2JL', GetUnitAbilityLevel(GetTriggerUnit(),'A2JK'))
	if GetUnitAbilityLevel(GetTriggerUnit(),'A2JK') == 1 then
		call LPA()
		call LEA()
	endif
endfunction
function P4X takes nothing returns nothing
	set QMV[0]='A2JO'
	set QMV[1]='A2JQ'
	set QMV[2]='A2JP'
	set QMV[3]='A2JR'
endfunction
function LQA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local integer CVX =(LoadInteger(HY, h, 59))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call UnitRemoveAbility(whichUnit, CVX)
	call UnitRemoveAbility(whichUnit,'B0FJ')
	call UnitRemoveAbility(whichUnit,'B0FK')
	set t = null
	set whichUnit = null
	return false
endfunction
function LSA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	call UnitRemoveAbility(u,'A2GD')
	call UnitRemoveAbility(u,'A2GE')
	call UnitRemoveAbility(u,'A2GF')
	call UnitRemoveAbility(u,'A2GC')
	call UnitRemoveAbility(u,'B0FJ')
	call UnitRemoveAbility(u,'B0FK')
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction
function LTA takes unit u, unit targetUnit returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, 0, false, function LSA)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	if IsUnitIllusion(targetUnit) == false and IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) == false and IsUnitType(targetUnit, UNIT_TYPE_STRUCTURE) == false then
		call SetWidgetLife(u, GetWidgetLife(u)+ GetEventDamage()*(.1 *(GetUnitAbilityLevel(u,'A2EY'))+ .45))
	endif
	set t = null
endfunction
function LUA takes unit targetUnit returns nothing
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(targetUnit,'A2EY')
	local integer id
	local integer probability = 25
	if IsUnitType(DESource, UNIT_TYPE_HERO) then
		set probability = 35
	endif
	if TKV(targetUnit,'A2EY', probability) then
		call EPX(targetUnit, 4316, 3.3 -0.6 * level)
		call YDWESetUnitAbilityState(targetUnit,'QP1O', 1, 3.31 - level * 0.6)
		if level == 1 then
			set id ='A2GD'
		elseif level == 2 then
			set id ='A2GE'
		elseif level == 3 then
			set id ='A2GF'
		elseif level == 4 then
			set id ='A2GC'
		endif
		call UnitAddPermanentAbility(targetUnit, id)
		call SetPlayerAbilityAvailable(GetOwningPlayer(targetUnit), id, false)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerRegisterTimerEvent(t, .5, false)
		call TriggerAddCondition(t, Condition(function LQA))
		call SaveUnitHandle(HY, h, 2, targetUnit)
		call SaveInteger(HY, h, 59, id)
		set t = null
	endif
endfunction
function LWA takes unit R8X, unit targetUnit returns nothing
	if GetUnitAbilityLevel(targetUnit,'A2EY')> 0 and LoadInteger(HY, GetHandleId(targetUnit), 4316)!= 1 and IsUnitEnemy(targetUnit, GetOwningPlayer(R8X)) and GetUnitAbilityLevel(targetUnit,'A36D') == 0 then
		call LUA(targetUnit)
	endif
endfunction
function LYA takes unit whichUnit, integer level, unit targetUnit returns nothing
	local integer ph = GetHandleId(GetOwningPlayer(whichUnit))
	local integer damageValue = LoadInteger(OtherHashTable, ph,'DDUE')
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		set ph = GetHandleId(GetOwningPlayer(whichUnit))
		call SaveInteger(OtherHashTable, ph,'DUEL', LoadInteger(OtherHashTable, ph,'DUEL')+ 1)
		call SaveInteger(OtherHashTable, ph,'DDUE', LoadInteger(OtherHashTable, ph,'DDUE')+ 6 + 4 * level)
		call CommonTextTag(GetUnitName(whichUnit)+ " 获得了胜利!!", 5, whichUnit, .03, 255, 0, 0, 255)
		call KVX(whichUnit)
	endif
endfunction

function UnitAddLocked_Actions takes nothing returns boolean
	//local trigger trig = GetTriggeringTrigger()
	local unit whichUnit = GetTriggerUnit()
	local integer id = GetIssuedOrderId()

	if id >=852008 and id <= 852013 then // 說明使用了物品Id
		call EXStopUnit( whichUnit )
	endif

	set whichUnit = null
	//set trig = null
	return false
endfunction

// 给单位添加锁闭效果 有一个计数 当计数 = 0 时 结束锁闭效果
function UnitAddLocked takes unit whichUnit returns nothing
	local integer uHandleId = GetHandleId( whichUnit )
	local trigger trig = LoadTriggerHandle( ExtraHT, uHandleId, HTKEY_LOCKED_BUFF_TRIGGER )
	local integer tHandleId = GetHandleId( trig )
	if trig == null then
		set trig = CreateTrigger()
		call TriggerRegisterUnitEvent( trig, whichUnit, EVENT_UNIT_ISSUED_ORDER )
		call TriggerRegisterUnitEvent( trig, whichUnit, EVENT_UNIT_ISSUED_TARGET_ORDER )
		call TriggerRegisterUnitEvent( trig, whichUnit, EVENT_UNIT_ISSUED_POINT_ORDER )
		call TriggerAddCondition( trig, Condition(function UnitAddLocked_Actions) )

		call SaveUnitHandle( HY, tHandleId, 0, whichUnit )
		call SaveInteger( HY, tHandleId, 0, 1 ) // count
	else
		call SaveInteger( HY, tHandleId, 0, LoadInteger( HY, tHandleId, 0 ) + 1 ) // count ++
	endif
	set trig = null
endfunction

function UnitRemoveLocked takes unit whichUnit returns nothing
	local integer uHandleId = GetHandleId( whichUnit )
	local trigger trig = LoadTriggerHandle( ExtraHT, uHandleId, HTKEY_LOCKED_BUFF_TRIGGER )
	local integer tHandleId = GetHandleId( trig )
	local integer buffCount = LoadInteger( HY, tHandleId, 0 )
	if trig != null then
		set buffCount = buffCount - 1 // count --
		if buffCount == 0 then
			call RemoveSavedHandle( ExtraHT, uHandleId, HTKEY_LOCKED_BUFF_TRIGGER )
			call FlushChildHashtable( HY, tHandleId )
			call CleanCurrentTrigger( trig )
		else
			call SaveInteger( HY, tHandleId, 0, buffCount )
		endif
	endif
	set trig = null
endfunction

function LZA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 5))
	local real KGX =(LoadReal(HY, h, 442))
	local unit dummyCaster
	local integer ph
	local unit u
	if GetTriggerEvalCount(t) == 1 then
		if LoadBoolean(HY, h, 0) then
			call BWR(whichUnit,'B467', 9999)
			call BWR(targetUnit,'B467', 9999)
			call UnitAddAbilityToTimed(whichUnit,'A467', 1, 9999,'B467')
			call UnitAddAbilityToTimed(targetUnit,'A467', 1, 9999,'B467')
		else
			call BWR(whichUnit,'B467', .75 * level + 3.25)
			call BWR(targetUnit,'B467', .75 * level + 3.25)
			call UnitAddAbilityToTimed(whichUnit,'A467', 1, .75 * level + 3.25,'B467')
			call UnitAddAbilityToTimed(targetUnit,'A467', 1, .75 * level + 3.25,'B467')
		endif
	endif
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or KGX <(GetGameTime()) or GetUnitDistanceEx(whichUnit, targetUnit)> 2000 then
		if GetTriggerEventId() == EVENT_WIDGET_DEATH then
			if GetTriggerUnit() == whichUnit then
				set u = targetUnit
			else
				set u = whichUnit
			endif
			call LYA(u, level, GetTriggerUnit())
		endif
		call SaveBoolean(HY, GetHandleId(LoadTriggerHandle(HY, GetHandleId(whichUnit),'STFU')),'SLDR', true)
		call SaveBoolean(HY, GetHandleId(LoadTriggerHandle(HY, GetHandleId(targetUnit),'STFU')),'SLDR', true)
		call UnitRemoveAbility(whichUnit,'A467')
		call UnitRemoveAbility(whichUnit,'B467')
		call UnitRemoveAbility(targetUnit,'A467')
		call UnitRemoveAbility(targetUnit,'B467')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SetUnitPathing(whichUnit, true)
		call SetUnitPathing(targetUnit, true)
	elseif GetIssuedOrderId()!= 851973 then
		call SetUnitPathing(whichUnit, false)
		call SetUnitPathing(targetUnit, false)
		call DisableTrigger(t)
		call IssueTargetOrderById(whichUnit, 851983, targetUnit)
		call IssueTargetOrderById(targetUnit, 851983, whichUnit)
		call EnableTrigger(t)
	else
		if GetUnitAbilityLevel(whichUnit,'Abun')> 0 then
			call UnitRemoveAbility(whichUnit,'NOAT')
			call UnitRemoveAbility(whichUnit,'Abun')
		endif
		if GetUnitAbilityLevel(targetUnit,'Abun')> 0 then
			call UnitRemoveAbility(targetUnit,'NOAT')
			call UnitRemoveAbility(targetUnit,'Abun')
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set dummyCaster = null
	return false
endfunction
function L_A takes unit whichUnit, unit targetUnit returns nothing
	local integer level = GetUnitAbilityLevel(whichUnit,'A2CI')+ GetUnitAbilityLevel(whichUnit,'A38C')
	local trigger t
	local integer h
	local boolean MDR = GetUnitAbilityLevel(whichUnit,'A38C')> 0
	if GetUnitAbilityLevel(whichUnit,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(whichUnit), 0) then
		set whichUnit = LoadUnitHandle(HY, GetHandleId(whichUnit), 0)
	endif
	call SetUnitPathing(whichUnit, false)
	call SetUnitPathing(targetUnit, false)
	call IssueTargetOrderById(whichUnit, 851983, targetUnit)
	call IssueTargetOrderById(targetUnit, 851983, whichUnit)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	if MDR then
		call SaveReal(HY, h, 442,(((GetGameTime())+ 9999)* 1.))
		call SaveBoolean(HY, h, 0, true)
	else
		call SaveReal(HY, h, 442,(((GetGameTime())+ .75 * level + 3.25)* 1.))
	endif
	call TriggerAddCondition(t, Condition(function LZA))
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_ISSUED_ORDER)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_ISSUED_ORDER)
	set t = null
endfunction
function L0A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call L_A(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function DUE takes nothing returns nothing
	local timer t
	local integer h
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		call TimerStart(t, 0, false, function L0A)
		set t = null
	endif
endfunction
function L1A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 5))
	local integer count =(LoadInteger(HY, h, 34))
	set count = count + 1
	call SaveInteger(HY, h, 34,(count))
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or count > 50 or GetUnitAbilityLevel(targetUnit,'A2J4') == 0 then
		call UnitRemoveAbility(targetUnit,'A2J4')
		call FlushChildHashtable(HY, h)
		call RemoveSavedHandle(HY, GetHandleId(targetUnit),'A2J2')
		call CleanCurrentTrigger(t)
	else
		call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+ 2 + 1 * level)
		if ModuloInteger(count, 10) == 1 then
			call ARX("Abilities\\Spells\\Orc\\SpiritLink\\SpiritLinkZapTarget.mdl", targetUnit, "chest", 1.9)
		endif
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function DWE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A2J2')
	local trigger t
	local integer h
	if HaveSavedHandle(HY, GetHandleId(targetUnit),'A2J2') then
		set t = LoadTriggerHandle(HY, GetHandleId(targetUnit),'A2J2')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, GetHandleId(targetUnit),'A2J2', t)
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function L1A))
		call SaveUnitHandle(HY, h, 17, targetUnit)
	endif
	call GBX(targetUnit)
	call UnitAddPermanentAbilitySetLevel(targetUnit,'A2J4', level)
	call SaveInteger(HY, h, 5, level)
	call SaveInteger(HY, h, 34, 0)
	call TriggerEvaluate(t)
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function Legion_PtA_Init takes nothing returns nothing
	set QPV[1]='A2J4'
	set QPV[2]='A2J5'
	set QPV[3]='A2J3'
	set QPV[4]='A2J6'
endfunction
function L2A takes nothing returns nothing
	if (IsUnitType(GetEnumUnit(), UNIT_TYPE_SUMMONED) and CYX(GetEnumUnit()) == false and GetUnitAbilityLevel(GetEnumUnit(),'ACrk') == 0 and GetUnitAbilityLevel(GetEnumUnit(),'A12G') == 0) or IsUnitIllusion(GetEnumUnit()) then
		call UnitDamageTargetEx(GetTriggerUnit(), GetEnumUnit(), 1, GetUnitState(GetEnumUnit(), UNIT_STATE_MAX_LIFE)* .5)
	endif
	call UnitDamageTargetEx(GetTriggerUnit(), GetEnumUnit(), 1, 50 * QTV +( 12+ QTV * 2)* QQV +(5 + QTV * 15)* QSV)
endfunction
function L3A takes nothing returns nothing
	if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
		set QSV = QSV + 1
	else
		set QQV = QQV + 1
	endif
endfunction
function L4A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer c = LoadInteger(HY, h, 0)
	local unit u = LoadUnitHandle(HY, h, 0)
	if c >= 5 * 7 or GetUnitAbilityLevel(u,'C020') == 0 then
		call UnitRemoveAbility(u,'C020')
		call UnitRemoveAbility(u,'D020')
		call J8X(u, LoadInteger(HY, h, 1))
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
		call RemoveSavedHandle(HY, GetHandleId(u),'A2JB')
	else
		call SaveInteger(HY, h, 0, c + 1)
	endif
	set u = null
	set t = null
endfunction
function DYE takes nothing returns nothing
	local timer t
	local unit whichUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local integer level = GetUnitAbilityLevel(whichUnit,'A2JB')
	local group g = AllocationGroup(470)
	local integer h
	call DestroyEffect(AddSpecialEffect("war3mapImported\\OverwhelmingOdds.mdx", x, y))
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, x, y, 330 + 25, Condition(function DHX))
	set QQV = 0
	set QSV = 0
	set QTV = level
	call ForGroup(g, function L3A)
	call ForGroup(g, function L2A)
	call DeallocateGroup(g)
	set x =(9 * QSV + 3 * QQV)
	if x > 0 then
		call J6X(whichUnit, R2I(x))
		call UnitAddPermanentAbility(whichUnit,'C020')
		if HaveSavedHandle(HY, GetHandleId(whichUnit),'A2JB') then
			set t = LoadTimerHandle(HY, GetHandleId(whichUnit),'A2JB')
			set h = GetHandleId(t)
		else
			set t = CreateTimer()
			set h = GetHandleId(t)
			call SaveTimerHandle(HY, GetHandleId(whichUnit),'A2JB', t)
			call TimerStart(t, .2, true, function L4A)
		endif
		call SaveInteger(HY, h, 0, 0)
		call SaveUnitHandle(HY, h, 0, whichUnit)
		call SaveInteger(HY, h, 1, LoadInteger(HY, h, 1)+ R2I(x))
	endif
	set whichUnit = null
	set t = null
endfunction
function MysticFlareFilterHeroes takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and RFX(GetFilterUnit()) == false) and IsUnitMagicImmune(GetFilterUnit()))
endfunction
function L5A takes nothing returns boolean
	return IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) or IsUnitIllusion(GetFilterUnit()))
endfunction
function L6A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local group g = null
	local unit u2
	local integer level
	local integer c
	if GetTriggerEvalCount(t)> 20 then
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set g = AllocationGroup(471)
		set U2 = u
		call GroupEnumUnitsInRange(g, x, y, 170+ 25, Condition(function D7X))
		set level = GetUnitAbilityLevel(u,'A2BG')+ GetUnitAbilityLevel(u,'A30H')
		set c = CountUnitsInGroup(g)
		if c == 0 then
			call GroupEnumUnitsInRange(g, x, y, 170+ 25, Condition(function L5A))
			set c = CountUnitsInGroup(g)
		endif
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			call UnitDamageTargetEx(u, u2, 1,(( 200+ 400 * level)/ c)/ 20)
			call GroupRemoveUnit(g, u2)
		endloop
		call DeallocateGroup(g)
		set g = null
	endif
	set t = null
	set u = null
	set u2 = null
	return false
endfunction
function DZE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local string s = "war3mapImported\\DivineWrathTarget.mdx"
	local location l = GetSpellTargetLoc()
	call PlaySoundAtPointBJ(QUV, 100, l, 0)
	call RemoveLocation(l)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function L6A))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call DestroyEffect(AddSpecialEffect(s, x, y))
	set t = null
	set whichUnit = null
	set l = null
endfunction
function P5X takes nothing returns nothing
	set QUV = CreateSound("Abilities\\Spells\\Demon\\RainOfFire\\RainOfFireTarget2.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(QUV, "StarfallTarget")
	call SetSoundDuration(QUV, 3000)
endfunction
function L7A takes nothing returns nothing
	local unit whichUnit = U2
	local unit targetUnit = MissileHitTargetUnit
	local integer level = LoadInteger(HY, GetHandleId(GetTriggeringTrigger()), 0)
	local integer i = GetHeroMaxAttributeValue(whichUnit)
	local real IXX = 40 + 20 * level + 1.6 * i
	if GetUnitAbilityLevel(targetUnit,'A3E9') == 1 and IsUnitMagicImmune(whichUnit) == false then
		call SaveUnitHandle(OtherHashTable2,'A3E9', 0, targetUnit)
		call SaveUnitHandle(OtherHashTable2,'A3E9', 1, whichUnit)
		call SaveInteger(OtherHashTable2,'A3E9', 0, level)
		call ExecuteFunc("L8A")
	endif
	if i == 0 then
		set IXX = 40 + 20 * level + 1.6 * GetHeroMaxAttributeValue(Player__Hero[GetPlayerId(GetOwningPlayer(whichUnit))])
	endif
	call UnitDamageTargetEx(whichUnit, targetUnit, 1, IXX)
	set whichUnit = null
	set targetUnit = null
endfunction
function L9A takes unit whichUnit, unit targetUnit, integer level returns nothing
	call SaveInteger(HY, GetHandleId(LaunchMissileByUnitDummy(whichUnit, targetUnit,'h0DQ', "L7A", 500, false)), 0, level)
endfunction
function L8A takes nothing returns nothing
	call T4V(LoadUnitHandle(OtherHashTable2,'A3E9', 0))
	if UnitHasSpellShield(LoadUnitHandle(OtherHashTable2,'A3E9', 1)) == false then
		call L9A(LoadUnitHandle(OtherHashTable2,'A3E9', 0), LoadUnitHandle(OtherHashTable2,'A3E9', 1), LoadInteger(OtherHashTable2,'A3E9', 0))
	endif
	call FlushChildHashtable(OtherHashTable2,'A3E9')
endfunction
function D_E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call L9A(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
	endif
endfunction
function MVA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real d
	call UnitRemoveAbility(targetUnit,'A2HX')
	call UnitRemoveAbility(targetUnit,'A2I0')
	call UnitRemoveAbility(targetUnit,'A2HY')
	call UnitRemoveAbility(targetUnit,'A2HZ')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set targetUnit = null
	set t = null
	return false
endfunction
function MEA takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A2HN')
	local real EHX = 2 + level
	local integer id ='A2HX'
	if level == 2 then
		set id ='A2I0'
	elseif level == 3 then
		set id ='A2HY'
	elseif level == 4 then
		set id ='A2HZ'
	endif
	call UnitAddPermanentAbility(targetUnit, id)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(targetUnit), id, false)
	call TriggerRegisterTimerEvent(t, EHX, false)
	call TriggerAddCondition(t, Condition(function MVA))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	set whichUnit = null
	set targetUnit = null
	set t = null
endfunction
function D0E takes nothing returns nothing
	if IsUnitType(GetSpellTargetUnit(), UNIT_TYPE_HERO) and not UnitHasSpellShield(GetSpellTargetUnit()) then
		call MEA()
	endif
endfunction
function MXA takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local real x = GetUnitX(MissileHitTargetUnit)
	local real y = GetUnitY(MissileHitTargetUnit)
	local unit dummyCaster = CreateUnit(GetOwningPlayer(U2),'e00E', x, y, 0)
	call UnitAddAbility(dummyCaster,'A2IU')
	call SetUnitAbilityLevel(dummyCaster,'A2IU', LoadInteger(HY, h, 0))
	call IssueImmediateOrderById(dummyCaster, 852096)
	set dummyCaster = null
endfunction
function MOA takes unit whichUnit, group g returns unit
	local unit MRA = null
	local real d = 99999
	local unit MIA = FirstOfGroup(g)
	call GroupRemoveUnit(g, MIA)
	loop
	exitwhen MIA == null
		if GetUnitDistanceEx(whichUnit, MIA)< d then
			set d = GetUnitDistanceEx(whichUnit, MIA)
			set MRA = MIA
		endif
		set MIA = FirstOfGroup(g)
		call GroupRemoveUnit(g, MIA)
	endloop
	set MIA = null
	set Q5V = MRA
	set MRA = null
	return Q5V
endfunction
function D1E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = null
	local group g = AllocationGroup(472)
	local trigger t
	set U2 = whichUnit
	call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 1600+ 25, Condition(function D6X))
	set targetUnit = MOA(whichUnit, g)
	call DeallocateGroup(g)
	if targetUnit != null then
		set t = LaunchMissileByUnitDummy(whichUnit, targetUnit,'h0E6', "MXA", 800, false)
		call SaveInteger(HY, GetHandleId(t), 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
		set t = null
	endif
	set g = null
	set targetUnit = null
	set whichUnit = null
endfunction
function MAA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer MNA =(LoadInteger(HY, h, 422))
	local integer MBA =(LoadInteger(HY, h, 423))
	local integer JLI =(LoadInteger(HY, h, 424))
	if GetUnitAbilityLevel(targetUnit,'A42S') == 0 or GetTriggerEvalCount(t)> 35 or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call SetHeroAgi(targetUnit, GetHeroAgi(targetUnit, false)+ MNA, true)
		call SetHeroStr(targetUnit, GetHeroStr(targetUnit, false)+ MBA, true)
		call SetHeroInt(targetUnit, GetHeroInt(targetUnit, false)+ JLI, true)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function MCA takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetEnumUnit()
	local integer level = GetUnitAbilityLevel(whichUnit,'A2FK')
	local trigger t
	local integer h
	local integer MDA
	local integer agi
	local integer str
	local integer int
	local real VEI
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		set MDA = GetHeroMainAttributesType(targetUnit)
		set VEI = .15
		call UnitAddAbilityToTimed(targetUnit,'A42S', 1, 7,'B0HJ')
		if MDA == HERO_ATTRIBUTE_AGI then
			set agi = R2I(VEI * GetHeroAgi(targetUnit, false))-1
			set str = 0
			set int = 0
		elseif MDA == HERO_ATTRIBUTE_STR then
			set agi = 0
			set str = R2I(VEI * GetHeroStr(targetUnit, false))-1
			set int = 0
		elseif MDA == HERO_ATTRIBUTE_INT then
			set agi = 0
			set str = 0
			set int = R2I(VEI * GetHeroInt(targetUnit, false))-1
		endif
		call SetHeroAgi(targetUnit, GetHeroAgi(targetUnit, false)-agi, true)
		call SetHeroStr(targetUnit, GetHeroStr(targetUnit, false)-str, true)
		call SetHeroInt(targetUnit, GetHeroInt(targetUnit, false)-int, true)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .2, true)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function MAA))
		call SaveInteger(HY, h, 422, agi)
		call SaveInteger(HY, h, 424, int)
		call SaveInteger(HY, h, 423, str)
		call SaveUnitHandle(HY, h, 17, targetUnit)
		set t = null
	endif
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", targetUnit, "chest"))
	call UnitDamageTargetEx(whichUnit, targetUnit, QWV, 50 + 50 * level)
	set whichUnit = null
	set targetUnit = null
endfunction
function D2E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local group g = AllocationGroup(473)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = AngleBetweenXY(GetUnitX(whichUnit), GetUnitY(whichUnit), x, y)* bj_DEGTORAD
	set x = GetUnitX(whichUnit)
	set y = GetUnitY(whichUnit)
	if KillTreeByCircle(x, y, 300)> 0 then
		set QWV = 3
	else
		set QWV = 1
	endif
	call GroupEnumUnitsInRange(g, x, y, 300 + 25, Condition(function DDX))
	call ForGroup(g, function MCA)
	call DeallocateGroup(g)
	call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\WhirlingDeath_01.mdx", whichUnit, "origin"))
	set whichUnit = null
	set g = null
endfunction
function MFA takes unit whichUnit, unit targetUnit returns nothing
	local integer level = KI
	call UnitDamageTargetEx(whichUnit, targetUnit, 3, 60 + 40 * level)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", targetUnit, "origin"))
endfunction
function MGA takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), DK) == false then
		call GroupAddUnit(DK, GetEnumUnit())
		call MFA(U2, GetEnumUnit())
	endif
endfunction
function MHA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer KFR = LoadInteger(HY, h, 18)
	local integer count = GetTriggerEvalCount(t)
	local unit KGR
	local group KHR = LoadGroupHandle(HY, h, 16)
	local group g
	local boolean SKX = LoadBoolean(HY, h, 727)
	local boolean MJA = LoadBoolean(HY, h, 740)
	set KI = LoadInteger(HY, h, 0)
	if C5X(trigUnit) then
		set MJA = true
		call SaveBoolean(HY, h, 740, MJA)
	endif
	if SKX == false then
		set KGR = LoadUnitHandle(HY, h, 700 + KFR + 1 -count)
		call RemoveUnit(KGR)
	else
		set KGR = LoadUnitHandle(HY, h, 700 + count)
		if MJA == false then
			if IsUnitType(trigUnit, UNIT_TYPE_HERO) then
				call SaveBoolean(OtherHashTable, GetHandleId(trigUnit), 99, true)
			endif
			call SetUnitX(trigUnit, GetUnitX(KGR))
			call SetUnitY(trigUnit, GetUnitY(KGR))
		endif
		call RemoveUnit(KGR)
		set g = AllocationGroup(474)
		set U2 = trigUnit
		set DK = KHR
		call GroupEnumUnitsInRange(g, GetUnitX(trigUnit), GetUnitY(trigUnit), 250, Condition(function DMX))
		call ForGroup(g, function MGA)
		call DeallocateGroup(g)
	endif
	if count ==(KFR) then
		call KillTreeByCircle(GetUnitX(trigUnit), GetUnitY(trigUnit), 90)
		call DeallocateGroup(KHR)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set trigUnit = null
	set targetUnit = null
	set KGR = null
	set KHR = null
	set g = null
	return false
endfunction
function MKA takes nothing returns nothing
	if IsTreeDestructable(GetEnumDestructable()) and IsDestructableDeadBJ(GetEnumDestructable()) == false then
		set QYV = QYV + 1
	endif
endfunction
function MLA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = LoadUnitHandle(HY, h, 14)
	local real a = LoadReal(HY, h, 13)
	local integer KLR = LoadInteger(HY, h, 12)
	local integer count = GetTriggerEvalCount(t)
	local real x = LoadReal(HY, h, 6)+ count * 50 * Cos(a * bj_DEGTORAD)
	local real y = LoadReal(HY, h, 7)+ count * 50 * Sin(a * bj_DEGTORAD)
	local boolean KMR = LoadBoolean(HY, h, 15)
	local unit KPR
	local trigger KQR = LoadTriggerHandle(HY, h, 11)
	local integer KSR = GetHandleId(KQR)
	local integer ID ='u01Q'
	local real KJR = 250
	local rect r
	local real d = 90
	local integer level = LoadInteger(HY, h, 0)
	set r = Rect(x -d, y -d, x + d, y + d)
	set QYV = 0
	call EnumDestructablesInRect(r, null, function MKA)
	if QYV > 0 or count == KLR or count ==(KLR -1) or count ==(KLR -2) then
		set ID ='u01P'
	endif
	set KPR = CreateUnit(GetOwningPlayer(trigUnit), ID, x, y, a)
	call SaveUnitHandle(HY, KSR, 700 + count, KPR)
	if QYV > 0 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call TriggerRegisterTimerEvent(KQR, .5 / KLR, true)
		call TriggerAddCondition(KQR, Condition(function MHA))
		call SaveInteger(HY, KSR, 18, count)
		call SaveInteger(HY, KSR, 0, level)
		call SaveBoolean(HY, KSR, 727, true)
		call SaveUnitHandle(HY, KSR, 14, trigUnit)
		call SaveGroupHandle(HY, KSR, 16, AllocationGroup(475))
		call SaveReal(HY, KSR, 6, x * 1.)
		call SaveReal(HY, KSR, 7, y * 1.)
		call SaveBoolean(HY, KSR, 740, false)
	elseif count > KLR then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call TriggerRegisterTimerEvent(KQR, .5 / KLR, true)
		call TriggerAddCondition(KQR, Condition(function MHA))
		call SaveInteger(HY, KSR, 18, count)
		call SaveInteger(HY, KSR, 0, level)
		call SaveBoolean(HY, KSR, 727, false)
		call SaveUnitHandle(HY, KSR, 14, trigUnit)
		call SaveGroupHandle(HY, KSR, 16, AllocationGroup(476))
		call SaveBoolean(HY, KSR, 740, false)
	endif
	set t = null
	set trigUnit = null
	set KPR = null
	set KQR = null
	return false
endfunction
function D3E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit trigUnit = GetTriggerUnit()
	local real a = AngleBetweenXY(GetUnitX(trigUnit), GetUnitY(trigUnit), GetSpellTargetX(), GetSpellTargetY())
	local integer level = GetUnitAbilityLevel(trigUnit,'A2E3')
	local integer KTR
	local integer KLR
	local trigger KUR = CreateTrigger()
	set KTR = 600 + 200* level
	set KLR = KTR / 50
	call SaveUnitHandle(HY, h, 14,(trigUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveInteger(HY, h, 12,(KLR))
	call SaveTriggerHandle(HY, h, 11,(KUR))
	call SaveReal(HY, h, 6,((GetUnitX(trigUnit))* 1.))
	call SaveReal(HY, h, 7,((GetUnitY(trigUnit))* 1.))
	call TriggerRegisterTimerEvent(t, .5 / KLR, true)
	call TriggerAddCondition(t, Condition(function MLA))
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(trigUnit, GetSpellAbilityId()))
	set t = null
	set trigUnit = null
	set KUR = null
endfunction
function MMA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 2)
	local integer uh = GetHandleId(u)
	call SaveInteger(HY, uh,'A2E4', LoadInteger(HY, uh,'A2E4')-1)
	if 4 *(GetUnitAbilityLevel(u,'A2E4'))> LoadInteger(HY, uh,'A2E4') then
		call UnitReduceStateBonus(u, 1, UNIT_BONUS_LIFE_REGEM)
		call UnitReduceStateBonus(u, 1, UNIT_BONUS_ARMOR)
		call SaveInteger(HY, uh,'A2E5', LoadInteger(HY, uh,'A2E5')-1)
		call SetAbilitydataD(u,'QP1P', LoadInteger(HY, uh,'A2E5'))
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set u = null
	return false
endfunction
function MPA takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(u)
	if LoadInteger(HY, h,'A2E5')< 4 *(GetUnitAbilityLevel(u,'A2E4')) then
		call UnitAddStateBonus(u, 1, UNIT_BONUS_LIFE_REGEM)
		call UnitAddStateBonus(u, 1, UNIT_BONUS_ARMOR)
		call SaveInteger(HY, h,'A2E5', LoadInteger(HY, h,'A2E5')+ 1)
		call SetAbilitydataD(u,'QP1P', LoadInteger(HY, h,'A2E5'))
	endif
	call SaveInteger(HY, h,'A2E4', LoadInteger(HY, h,'A2E4')+ 1)
	set h = GetHandleId(t)
	call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\ReactiveArmor.mdx", u, "chest"))
	call TriggerRegisterTimerEvent(t, 16, false)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function MMA))
	call SaveUnitHandle(HY, h, 2, u)
	set t = null
endfunction
function MSA takes unit R8X, unit targetUnit returns nothing
	if GetUnitAbilityLevel(targetUnit,'A2E4')> 0 and GetUnitAbilityLevel(targetUnit,'A36D') == 0 and IsUnitEnemy(R8X, GetOwningPlayer(targetUnit)) then
		call MPA(targetUnit)
	endif
endfunction
function MTA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	call UnitRemoveAbility(whichUnit,'Bpig')
	call UnitRemoveAbility(whichUnit,'BEia')
	call UnitRemoveAbility(whichUnit,'BNms')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction
function MUA takes unit t returns unit
	if HaveSavedHandle(OtherHashTable2,'A3GA', 0) and GetUnitState(LoadUnitHandle(OtherHashTable2,'A3GA', 0), UNIT_STATE_LIFE)> .5 then
		call SetUnitX(LoadUnitHandle(OtherHashTable2,'A3GA', 0), GetUnitX(t))
		call SetUnitY(LoadUnitHandle(OtherHashTable2,'A3GA', 0), GetUnitY(t))
		call SetUnitOwner(LoadUnitHandle(OtherHashTable2,'A3GA', 0), GetOwningPlayer(t), false)
	else
		call SaveUnitHandle(OtherHashTable2,'A3GA', 0, CreateUnit(GetOwningPlayer(t),'e00E', GetUnitX(t), GetUnitY(t), 0))
	endif
	return LoadUnitHandle(OtherHashTable2,'A3GA', 0)
endfunction
function MWA takes unit whichUnit, unit targetUnit returns nothing
	local unit dummyCaster = MUA(targetUnit)
	local integer MYA = R2I( 100 * GetWidgetLife(targetUnit)/ GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE))
	local integer level = IMaxBJ(IMinBJ(R2I( 100 -MYA)/ 5, 20), 1)
	call UnitAddAbility(dummyCaster,'A3GA'-1 + level)
	call IssueTargetOrderById(dummyCaster, 852075, targetUnit)
	call UnitRemoveAbility(dummyCaster,'A3GA'-1 + level)
	set dummyCaster = null
endfunction
function MZA takes nothing returns nothing
	if IsGameEnd == false then
		call UnitDamageTargetEx(Q_V, GetEnumUnit(), 3,(25 + 25 * Q0V)* .5)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", GetEnumUnit(), "origin"))
		call MWA(Q_V, GetEnumUnit())
	endif
endfunction
function M_A takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), QZV) == false then
		call GroupAddUnit(QZV, GetEnumUnit())
		call UnitDamageTargetEx(Q_V, GetEnumUnit(), 3, 60 + 40 * Q0V)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", GetEnumUnit(), "origin"))
		call MWA(Q_V, GetEnumUnit())
	endif
endfunction
function M0A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call UnitRemoveAbility(LoadUnitHandle(HY, h, 0),'A43P')
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
endfunction
function M1A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit missileDummy = LoadUnitHandle(HY, h, 45)
	local real tx = LoadReal(HY, h, 6)
	local real ty = LoadReal(HY, h, 7)
	local real x
	local real y
	local real a
	local integer M2A = LoadInteger(HY, h, 33)
	local group D7R = LoadGroupHandle(HY, h, 187)
	local group g
	local integer count = LoadInteger(HY, h, 34)
	local real M3A
	local integer FJI = LoadInteger(HY, h, 2)
	local integer M4A = LoadInteger(HY, h, 3)
	local integer M5A = LoadInteger(HY, h, 4)
	local boolean b = false
	if LoadInteger(HY, GetHandleId(whichUnit), 704) == -1 then//同等脉冲新星,进行二次判断
		if not PlayerHaveAbilityByActive(GetOwningPlayer(whichUnit), 'A2E5') then
			set b = true
		endif
	endif
	call UnitAddPermanentAbility(whichUnit, M4A)
	if GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then //释放技能结束
		if GetSpellAbilityId() == M5A then
			call SaveInteger(HY, h, 33, 2)
			call GroupClear(D7R) //
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit), M5A, false)
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call TriggerRegisterTimerEvent(t, 0, false)
			call TriggerAddCondition(t, Condition(function MTA))
			call SaveUnitHandle(HY, h, 2,(whichUnit))
			call TEV(whichUnit, M5A, 0)
		endif
	//单位死亡或拉比克大窃取的技能换了
	elseif GetTriggerEventId() == EVENT_WIDGET_DEATH or b then
		call TEV(whichUnit, M5A, 0)
		set b = Rubick_AbilityFilter(whichUnit , 'A2E5')
		if b or (LoadInteger(HY, GetHandleId(whichUnit), 704)) == FJI then
			if FJI =='A43Q' then
				if LoadBoolean(ObjectHashTable, GetHandleId(U2),'A43Q') then
					call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit), FJI, true)
				endif
			else
				call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit), FJI, true)
			endif
		endif
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit), M5A, false)
		if b and FJI !='A43Q' then
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A2E5', true)
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A43S', true)
		endif
		call CDO(whichUnit)
		call UnitRemoveAbility(whichUnit,'BNms')
		call KillUnit(missileDummy)
		call DeallocateGroup(D7R)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif M2A == 0 then //前进
		set a = AngleBetweenXY(GetUnitX(missileDummy), GetUnitY(missileDummy), tx, ty)* bj_DEGTORAD
		set x = GetUnitX(missileDummy)+ 18 * Cos(a)
		set y = GetUnitY(missileDummy)+ 18 * Sin(a)
		call KillTreeByCircle(x, y, 175)
		if GetDistanceBetween(x, y, tx, ty)< 40 then
			set x = tx
			set y = ty
		endif
		call SetUnitX(missileDummy, x)
		call SetUnitY(missileDummy, y)
		set U2 = whichUnit
		set Q_V = whichUnit
		set Q0V = LoadInteger(HY, h, 0)
		set QZV = D7R
		set g = AllocationGroup(477)
		call GroupEnumUnitsInRange(g, x, y, 200+ 25, Condition(function DHX))
		call ForGroup(g, function M_A)
		call DeallocateGroup(g)
		if x == tx and y == ty then
			call SaveInteger(HY, h, 33, 1)
			call GroupClear(D7R)
		endif
	elseif M2A == 1 then //停留
		set count = count + 1
		if count == 25 then
			set x = GetUnitX(missileDummy)
			set y = GetUnitY(missileDummy)
			call KillTreeByCircle(x, y, 175)
			set count = 0
			set U2 = whichUnit
			set Q_V = whichUnit
			set Q0V = LoadInteger(HY, h, 0)
			set g = AllocationGroup(478)
			call GroupEnumUnitsInRange(g, x, y, 200+ 25, Condition(function DHX))
			call ForGroup(g, function MZA)
			call DeallocateGroup(g)
			set M3A =( 15+ 5 * Q0V)/ 2
			if GetUnitState(whichUnit, UNIT_STATE_MANA)< M3A or GetUnitDistanceEx(whichUnit, missileDummy)> 2000 then
				call SaveInteger(HY, h, 33, 2)
				call GroupClear(D7R)
				call UnitRemoveAbility(whichUnit, M5A)
				call CDO(whichUnit)
				call UnitRemoveAbility(whichUnit,'BNms')
			else
				call SetUnitState(whichUnit, UNIT_STATE_MANA, GetUnitState(whichUnit, UNIT_STATE_MANA)-M3A)
			endif
		endif
		call SaveInteger(HY, h, 34,(count))
	elseif M2A == 2 then //收回
		set a = AngleBetweenXY(GetUnitX(missileDummy), GetUnitY(missileDummy), GetUnitX(whichUnit), GetUnitY(whichUnit))* bj_DEGTORAD
		set x = GetUnitX(missileDummy)+ 16 * Cos(a)
		set y = GetUnitY(missileDummy)+ 16 * Sin(a)
		call KillTreeByCircle(x, y, 175)
		call SetUnitX(missileDummy, x)
		call SetUnitY(missileDummy, y)
		set U2 = whichUnit
		set Q_V = whichUnit
		set Q0V = LoadInteger(HY, h, 0)
		set QZV = D7R
		set g = AllocationGroup(479)
		call GroupEnumUnitsInRange(g, x, y, 200+ 25, Condition(function DHX))
		call ForGroup(g, function M_A)
		call DeallocateGroup(g)
		if GetDistanceBetween(x, y, GetUnitX(whichUnit), GetUnitY(whichUnit))< 40 then
			call UnitRemoveAbility(whichUnit, M4A)
			call KillUnit(missileDummy)
			call DeallocateGroup(D7R)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			if Rubick_AbilityFilter(whichUnit , 'A2E5') or(LoadInteger(HY,(GetHandleId(whichUnit)), 704)) == FJI then
				if FJI =='A43Q' then
					//这里判断一下是否选了此技能 没选并且是偷的就可以重新显示
					if LoadBoolean(ObjectHashTable, GetHandleId(U2),'A43Q') or ( not PlayerHaveAbilityByActive(GetOwningPlayer(whichUnit), 'A2E5') and LoadInteger(HY, GetHandleId(whichUnit), 704) == 'A43Q' ) then
						call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit), FJI, true)
					endif
				else
					call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit), FJI, true)
				endif
			endif
			call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit), M5A, false)
			if FJI !='A43Q' then
				call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A2E5', true)
				call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A43S', true)
			endif
			call UnitRemoveAbility(whichUnit, M5A)
		endif
	endif
	set t = null
	set whichUnit = null
	set missileDummy = null
	set D7R = null
	set g = null
	return false
endfunction
function D4E takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = AngleBetweenXY(GetUnitX(whichUnit), GetUnitY(whichUnit), x, y)* bj_DEGTORAD
	local unit missileDummy = CreateUnit(GetOwningPlayer(whichUnit),'h0DS', GetUnitX(whichUnit), GetUnitY(whichUnit), a * bj_RADTODEG)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer M4A
	local integer M5A
	local integer FJI = GetSpellAbilityId()
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function M1A))
	call SaveUnitHandle(HY, h, 45, missileDummy)
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveReal(HY, h, 6, x * 1.)
	call SaveReal(HY, h, 7, y * 1.)
	call SaveInteger(HY, h, 33, 0)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, FJI))
	call SaveGroupHandle(HY, h, 187, AllocationGroup(480))
	call SaveInteger(HY, h, 2, FJI)
	if FJI =='A2E5' or FJI =='A43S' then
		set M4A ='A43N'
		set M5A ='A2FX'
	else
		set M4A ='A43O'
		set M5A ='A43P'
	endif
	call UnitAddPermanentAbility(whichUnit, M4A)
	call UnitAddPermanentAbility(whichUnit, M5A)
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit), FJI, false)
	if FJI !='A43Q' then
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A2E5', false)
		call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit),'A43S', false)
	endif
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(whichUnit), M5A, true)
	call SaveInteger(HY, h, 3, M4A)
	call SaveInteger(HY, h, 4, M5A)
	set whichUnit = null
	set t = null
	set missileDummy = null
endfunction
function PBE takes nothing returns nothing
	if GetUnitAbilityLevel(GetTriggerUnit(),'A43Q')> 0 then
		call SetUnitAbilityLevel(GetTriggerUnit(),'A43Q', GetUnitAbilityLevel(GetTriggerUnit(),'A2E5')+ GetUnitAbilityLevel(GetTriggerUnit(),'A43S'))
	endif
endfunction
function addXL takes nothing returns nothing
	local unit u = U2
	call UnitAddAbility(u,'A3UF')
	call UnitMakeAbilityPermanent(u, true,'A3UF')
	if HaveSavedHandle(PassiveAbilityCooldown, GetHandleId(u),'PACD') == false then
		call PasSkillCoolDownTrigger(u)
	endif
	if not HaveSavedHandle(HY, GetHandleId(u),'A3UF') then
		call XJVXX()
	endif
	set u = null
endfunction
function delXL takes nothing returns nothing
	call UnitRemoveAbility(U2,'A3UF')
endfunction

function FlakCannonAghanimUpgradeOnUpdate takes nothing returns nothing
	local trigger trig = GetTriggeringTrigger()
	local integer h    = GetHandleId(trig)
	local unit    u    = LoadUnitHandle(HY, h, 0)
	local player  p    
	local real    x
	local real    y
	local group   enumGroup
	local group   targGroup
	local unit    first = null
	local real    area  = 700.

	if UnitAlive(u) and GetUnitAbilityLevel(u, 'A3UR') > 0 and not IsUnitInvision(u) and not IsUnitHidden(u) and GetUnitAbilityLevel(u,'A36D') == 0 then
		set enumGroup = AllocationGroup(79912)
		set targGroup = AllocationGroup(79913)

		set x = GetUnitX(u)
		set y = GetUnitY(u)
		set p = GetOwningPlayer(u)

		call GroupEnumUnitsInRange(enumGroup, x, y, area + MAX_UNIT_COLLISION, null)
		loop
			set first = FirstOfGroup(enumGroup)
			exitwhen first == null
			call GroupRemoveUnit(enumGroup, first)

			if UnitAlive(first) and IsUnitInRangeXY(first, x, y, area) and IsUnitEnemy(first, p) and not IsUnitWard(first) then
				call GroupAddUnit(targGroup, first)
			endif

		endloop

		loop
			set first = GroupPickRandomUnit(targGroup)
			exitwhen first == null
			call GroupRemoveUnit(targGroup, first)

			if IsUnitVisible(first, p) and not IsUnitEthereal(first) and not IsUnitInvulnerable(first) then
				call UnitLaunchAttack(u, first)
				call MHAbility_SetCooldown(u, 'A3UR', 1.5)
				exitwhen true
			endif
			
		endloop

		call DeallocateGroup(enumGroup)
		call DeallocateGroup(targGroup)
	endif

	set u    = null
	set trig = null
endfunction

function FlakCannonOnAddAghanimUpgrade takes nothing returns nothing
	local unit 	  u = U2
	local trigger trig 
	local integer h
	call UnitAddPermanentAbility(u, 'A3UR')
	if not HaveSavedHandle(HY, GetHandleId(u), 'A3UR')then
		set trig = CreateTrigger()
		set h = GetHandleId(trig)
		call TriggerAddCondition(trig, Condition(function FlakCannonAghanimUpgradeOnUpdate))
		call TriggerRegisterTimerEvent(trig, 1.5, true)
		call SaveTriggerHandle(HY, GetHandleId(u), 'A3UR', trig)
		call SaveUnitHandle(HY, h, 0, u)
		call SetPlayerAbilityAvailable(GetOwningPlayer(u), 'A3UR', true)
		set trig = null
	endif
	set u = null
endfunction
function FlakCannonOnRemoveAghanimUpgrade takes nothing returns nothing
	local unit u = U2
	call BJDebugMsg("Bye")
	call UnitRemoveAbility(u, 'A3UR')
	set u = null
endfunction

function HEX takes nothing returns nothing
	call UnitAddPermanentAbility(U2,'A43Q')
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(U2),'A43Q', GetUnitAbilityLevel(U2,'A43O') == 0)
	call SaveBoolean(ObjectHashTable, GetHandleId(U2),'A43Q', true)
	call SetUnitAbilityLevel(U2,'A43Q', GetUnitAbilityLevel(U2,'A2E5')+ GetUnitAbilityLevel(U2,'A43S'))
endfunction
function HNX takes nothing returns nothing
	call SetPlayerAbilityAvailableEx(GetOwningPlayer(U2),'A43Q', false)
	call SaveBoolean(ObjectHashTable, GetHandleId(U2),'A43Q', false)
endfunction
function P6X takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A2DV')
endfunction
function M6A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer T0V = LoadInteger(HY, h, 1)
	local integer hu = GetHandleId(u)
	local integer c = LoadInteger(HY, h, 100)+ 1
	local integer JOX
	if c == 240 or T0V =='DRKN' or T0V =='DRKU' or T0V =='A29J' then
		if LoadInteger(ObjectHashTable, hu,'A40K')!= T0V and LoadInteger(ObjectHashTable, hu,'A40K'+ 1)!= T0V and LoadInteger(ObjectHashTable, hu,'A40K'+ 2)!= T0V and LoadInteger(ObjectHashTable, hu,'A40K'+ 3)!= T0V then
			call UnitRemoveAbility(u, T0V)
			set JOX = LoadInteger(HY, h, 2)
			if (LoadBoolean(ObjectHashTable, hu,'A40K'+ JOX)) then
				call RemoveSavedBoolean(ObjectHashTable, hu,'A40K'+ JOX)
			endif
		endif
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	else
		call SaveInteger(HY, h, 100, c)
		if LoadInteger(ObjectHashTable, hu,'A40K')!= T0V and LoadInteger(ObjectHashTable, hu,'A40K'+ 1)!= T0V and LoadInteger(ObjectHashTable, hu,'A40K'+ 2)!= T0V and LoadInteger(ObjectHashTable, hu,'A40K'+ 3)!= T0V then
			call SetPlayerAbilityAvailable(GetOwningPlayer(u), T0V, false)
		endif
	endif
	set t = null
	set u = null
endfunction
function M7A takes unit u, integer Z_E, integer JOX returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .5, true, function M6A)
	call SetPlayerAbilityAvailable(GetOwningPlayer(u), Z_E, false)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveInteger(HY, GetHandleId(t), 1, Z_E)
	call SaveInteger(HY, GetHandleId(t), 2, JOX)
	call SaveInteger(ObjectHashTable, GetHandleId(u),'A40K'+ JOX, 0)
	call BYR(u)
	set t = null
endfunction
function M8A takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = null
	local integer level = LoadInteger(HY, h, 2)
	local integer i = LoadInteger(HY, h, 3)
	if GetTriggerEventId() == EVENT_UNIT_SPELL_ENDCAST and GetSpellAbilityId() == LoadInteger(HY, h, 0) then
		set i = i + 1
		if i >= LoadInteger(HY, h, 4) then
			set u = LoadUnitHandle(HY, h, 0)
			call M7A(u, LoadInteger(HY, h, 0), LoadInteger(HY, h, 1))
			call UnitRemoveAbility(u, LoadInteger(HY, h, 1)+'A40O')
			call SetPlayerAbilityAvailable(GetOwningPlayer(u), LoadInteger(HY, h, 0), false)
			set u = null
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		else
			call SaveInteger(HY, h, 3, i)
		endif
	else
		set u = LoadUnitHandle(HY, h, 0)
		if GetUnitAbilityLevel(u,'A40S'+ LoadInteger(HY, h, 1))!= GetUnitAbilityLevel(u, LoadInteger(HY, h, 0)) then
			call SetUnitAbilityLevel(u, LoadInteger(HY, h, 0), GetUnitAbilityLevel(u,'A40S'+ LoadInteger(HY, h, 1)))
		endif
		set u = null
	endif
	set t = null
endfunction
function M9A takes unit u, integer TPE, integer PVA, integer level returns nothing
	local trigger t = null
	local integer h
	if not UnitAddPermanentAbility(u, HeroCommonSkills[PlayerSkillIndex[TPE]]) and GetUnitAbilityLevel(u, HeroCommonSkills[PlayerSkillIndex[TPE]]) == 0 then
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function M8A))
	call SaveUnitHandle(HY, h, 0, u)
	call SaveInteger(HY, h, 0, HeroCommonSkills[PlayerSkillIndex[TPE]])
	call SetUnitAbilityLevel(u, HeroCommonSkills[PlayerSkillIndex[TPE]], level)
	call SetPlayerAbilityAvailable(GetOwningPlayer(u), HeroCommonSkills[PlayerSkillIndex[TPE]], true)
	call SaveInteger(ObjectHashTable, GetHandleId(u),'A40K'+ PVA, HeroCommonSkills[PlayerSkillIndex[TPE]])
	call SaveInteger(HY, h, 1, PVA)
	call SaveInteger(HY, h, 2, level)
	if CheckAbilityIdFormIndex(GetNormalSkillIndex(TPE),-1, "metamorphosis", null) then
		call SaveBoolean(ObjectHashTable, GetHandleId(u),'A40K'+ PVA, true)
	endif
	if PVA == 3 then
		call SaveInteger(HY, h, 4, level)
	else
		call SaveInteger(HY, h, 4, level + 1)
	endif
	if (PVA == 3 and level < 3) or(PVA < 3 and level < 4) then
		call TriggerRegisterTimerEvent(t, 1, true)
	endif
	call UnitAddPermanentAbility(u, PVA +'A40O')
	set t = null
endfunction
function PEA takes unit u, integer TPE, integer PXA returns boolean
	local integer i = GetPlayerId(GetOwningPlayer(u))
	local integer xx
	local integer k
	if X6R(TPE) or IsAttackSpecialEffects(TPE) or LNX(TPE) then
		return false
	endif
	if TPE =='A3FQ' or TPE =='A3FJ' or TPE =='A0KX' or TPE =='A0G8' or TPE =='A07U' or TPE =='A38E' or TPE =='A0A5' or TPE =='A0AG' or TPE =='QM01' or TPE =='A0BE' or TPE =='A0EY' or TPE =='A0NS' or TPE =='A0H9' or TPE =='A0NE' or TPE =='A32E' or TPE =='A21F' or TPE =='A1S4' or TPE =='A1NA' or TPE =='A2QM' or TPE =='A2TJ' or TPE =='A2QI' or TPE =='A2TI' or TPE =='A06K' or TPE =='A1T8' or TPE =='A28Q' or TPE =='A1TB' or TPE =='A0MQ' or TPE =='A2O2' or TPE =='A0OO' or TPE =='A14O' or TPE =='A1EA' or TPE =='QB03' or TPE =='A27H' or TPE =='A2JR' or TPE =='Z234' or TPE =='A0WQ' or TPE =='A1C0' or TPE =='A0MP' or TPE =='A01Y' or TPE =='A32Z' or TPE =='A0SW' or TPE =='A0LV' or TPE =='A21M' or TPE =='A40B' or TPE =='A418' or TPE =='A0ES' then
		return false
	endif
	set xx = 1
	loop
		if HeroCommonSkills[PlayerSkillIndex[i * HL + xx]]== TPE or CheckAbilityIdFormIndex(PXA, PlayerSkillIndex[i * HL + xx], null, null) then
			return false
		endif
		set xx = xx + 1
	exitwhen xx > 6
	endloop
	if CheckAbilityIdFormIndex(PXA,-1, "metamorphosis", null) and(UnitTypeIsMetamorphosis(u) or LoadBoolean(ObjectHashTable, GetHandleId(u),'A40K') or LoadBoolean(ObjectHashTable, GetHandleId(u),'A40K'+ 1) or LoadBoolean(ObjectHashTable, GetHandleId(u),'A40K'+ 2) or LoadBoolean(ObjectHashTable, GetHandleId(u),'A40K'+ 3)) then
		return false
	endif
	if (LoadInteger(ObjectHashTable, GetHandleId(u),'A40K') == TPE or LoadInteger(ObjectHashTable, GetHandleId(u),'A40K'+ 1) == TPE or LoadInteger(ObjectHashTable, GetHandleId(u),'A40K'+ 2) == TPE or LoadInteger(ObjectHashTable, GetHandleId(u),'A40K'+ 3) == TPE) then
		return false
	endif
	return true
endfunction
// 无形复制技能
function F2E takes nothing returns nothing
	local integer i = 0
	local integer iu = 0
	local integer array a
	local integer array b
	local integer k = 1
	local integer pid = 0
	local integer xx = 0
	local unit u = GetTriggerUnit()
	local integer playerId = GetPlayerId(GetOwningPlayer(u))
	local integer PVA = GetSpellAbilityId()-'A40K'
	local integer F2O = 0
	local integer c = 0
	if k == playerId then
		set k = 2
	endif
	loop
		set xx = 1
		loop
			if PlayerSkillIndex[k * HL + xx]!= 0 then
				if IsPassiveSkill[PlayerSkillIndex[k * HL + xx]]== false and PEA(u, HeroCommonSkills[PlayerSkillIndex[k * HL + xx]], PlayerSkillIndex[k * HL + xx]) then
					if xx == 4 or xx == 6 then
						set b[iu]= k * HL + xx
						set iu = iu + 1
					else
						set a[i]= k * HL + xx
						set i = i + 1
					endif
				endif
			endif
			set xx = xx + 1
		exitwhen xx > HL
		endloop
		set k = k + 1
		if k == playerId then
			set k = k + 1
		endif
		if k == 6 then
			set k = 7
		endif
	exitwhen k > 11
	endloop
	if PVA == 3 then
		if iu > 0 then
			set F2O = b[GetRandomInt(0, iu -1)]
		endif
	else
		if i > 0 then
			set F2O = a[GetRandomInt(0, i -1)]
		endif
	endif
	if F2O == 0 then
		call InterfaceErrorForPlayer(GetOwningPlayer(u), "复制失败")
	else
		call M9A(u, F2O, PVA, GetUnitAbilityLevel(u, GetSpellAbilityId()))
	endif
	set u = null
endfunction
function PRA takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	if UnitIsDead(MissileHitTargetUnit) == false then
		call SetWidgetLife(MissileHitTargetUnit, GetWidgetLife(MissileHitTargetUnit)+ LoadReal(HY, h,'n020')* .2)
	endif
endfunction
function PIA takes unit u returns nothing
	local trigger t
	if GetUnitTypeId(u)=='n020' and UnitIsDead(Player__Hero[GetPlayerId(GetOwningPlayer(u))]) == false then
		set t = LaunchMissileByUnitDummy(u, Player__Hero[GetPlayerId(GetOwningPlayer(u))],'h00W', "PRA", 400, false)
		call SaveReal(HY, GetHandleId(t),'n020', GetUnitState(u, UNIT_STATE_MAX_LIFE))
		set t = null
	endif
endfunction
function SCE takes nothing returns nothing
	local integer i
	local integer k
	if IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) then
		set i = GetHeroMainAttributesType(GetTriggerUnit())
		if GetUnitAbilityLevel(GetTriggerUnit(),'A440')> 1 then
			set k = 10
		else
			set k = 15
		endif
		if i == HERO_ATTRIBUTE_INT then
			call SetHeroInt(GetTriggerUnit(), GetHeroInt(GetTriggerUnit(), false)+ k, true)
		elseif i == HERO_ATTRIBUTE_AGI then
			call SetHeroAgi(GetTriggerUnit(), GetHeroAgi(GetTriggerUnit(), false)+ k, true)
		elseif i == HERO_ATTRIBUTE_STR then
			call SetHeroStr(GetTriggerUnit(), GetHeroStr(GetTriggerUnit(), false)+ k, true)
		endif
	endif
endfunction
function PAA takes unit R8X, unit targetUnit returns nothing
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) == false and IsUnitType(targetUnit, UNIT_TYPE_ANCIENT) == false and IsUnitIllusion(targetUnit) == false and TKV(R8X,'A43Z', 10) then
		call UnitDamageTargetEx(R8X, targetUnit, 1, 10000)
	endif
endfunction
function PNA takes nothing returns boolean
	if (GetUnitTypeId(GetFilterUnit())=='u012' or GetUnitTypeId(GetFilterUnit())=='u013') and UnitIsDead(GetFilterUnit()) == false then
		set Q2 = Q2 -1
		return true
	endif
	return false
endfunction
function PBA takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local real a = GetUnitFacing(u)
	local group g
	local integer level = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A00T')
	local real time = 99999
	local unit u2 = null
	if GetUnitAbilityLevel(u,'BFig') == 1 then
		call KillUnit(u)
		call RemoveUnit(u)
		set Q2 = 1 + level
		set g = AllocationGroup(481)
		call GroupEnumUnitsOfPlayer(g, p, Condition(function PNA))
		if Q2 < 1 then
			loop
				set u = FirstOfGroup(g)
			exitwhen u == null
				if LoadReal(HY, GetHandleId(u),'spwn')< time then
					set u2 = u
					set time = LoadReal(HY, GetHandleId(u),'spwn')
				endif
				call GroupRemoveUnit(g, u)
			endloop
		endif
		call KillUnit(u2)
		call DeallocateGroup(g)
		set u = CreateUnit(p,'u012', x, y, a)
		call TriggerRegisterUnitEvent(UnitEventMainTrig, u, EVENT_UNIT_SPELL_EFFECT)
		if GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A0A8')> 0 then
			call UnitAddPermanentAbility(u,'A1HW')
		endif
		call SaveReal(HY, GetHandleId(u),'spwn', GetGameTime())
		set u = null
	endif
endfunction
function PCA takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='ushd' and UnitIsDead(GetFilterUnit()) == false then
		set Q2 = Q2 -1
		return true
	endif
	return false
endfunction
function PDA takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local real a = GetUnitFacing(u)
	local group g
	local integer level = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A43Y')
	local real time = 99999
	local unit u2 = null
	if GetUnitAbilityLevel(u,'BFig') == 1 then
		call KillUnit(u)
		call RemoveUnit(u)
		set Q2 = 1 + level * 2
		set g = AllocationGroup(482)
		call GroupEnumUnitsOfPlayer(g, p, Condition(function PCA))
		if Q2 < 1 then
			loop
				set u = FirstOfGroup(g)
			exitwhen u == null
				if LoadReal(HY, GetHandleId(u),'spwn')< time then
					set u2 = u
					set time = LoadReal(HY, GetHandleId(u),'spwn')
				endif
				call GroupRemoveUnit(g, u)
			endloop
		endif
		call KillUnit(u2)
		call DeallocateGroup(g)
		set u = CreateUnit(p,'ushd', x, y, a)
		call SaveReal(HY, GetHandleId(u),'spwn', GetGameTime())
		set u = null
	endif
endfunction

// Lod的触发器
function CreateLodTrigger takes nothing returns nothing
	local trigger t
	// 伤害显示和镜头晃动
	// set t = CreateTrigger()
	// call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	// call TriggerAddAction(t, function ZGE)

	// 等级上限
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_HERO_LEVEL)
	call TriggerAddAction(t, function Y9E)

	// 选择技能
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddAction(t, function RDR)

	// 取消技能
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddAction(t, function RCR)

	// 禁止选择技能马甲释放技能
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
	call TriggerAddAction(t, function YAE)

	// 英雄升级时增加技能
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_HERO_LEVEL)
	call TriggerAddAction(t, function HeroLevelUp)

	/*if LOD_DEBUGMODE then*/ if DEBUG_MODE then
		// debug Order
		set t = CreateTrigger()
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
		call TriggerAddAction(t, function T4E)
		// debug skillName
		set t = CreateTrigger()
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
		call TriggerAddAction(t, function T3E)
		// debg unitName
		set t = CreateTrigger()
		call TriggerRegisterPlayerSelectionEventBJ(t, Player(1), true)
		call TriggerAddAction(t, function T2E)
	endif
	call Y3E()
	// call TriggerSleepAction(1)
	set t = null
endfunction
function PGA takes nothing returns boolean
	local unit t = GetFilterUnit()
	if UnitAlive(t) and IsUnitAlly(Temp__ArrayUnit[0], GetOwningPlayer(t)) and GetUnitAbilityLevel(t,'A04R') == 0 and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false and t != Temp__ArrayUnit[0] then
		call SaveBoolean(ObjectHashTable, 99999, 99999, false)
		set t = null
	endif
	set t = null
	return false
endfunction
function PHA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(ObjectHashTable, WFV, 0)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	if UYX == 120 or UnitIsDead(u) then
		call DestroyEffect(LoadEffectHandle(ObjectHashTable, WFV, 2))
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		set u = null
		return
	endif
	call SaveInteger(ObjectHashTable, WFV, 0, UYX + 1)
	set Temp__ArrayUnit[0]= u
	call SaveBoolean(ObjectHashTable, 99999, 99999, true)
	call GroupEnumUnitsInRange(AK, GetWidgetX(u), GetWidgetY(u), 250, Condition(function PGA))
	if LoadBoolean(ObjectHashTable, 99999, 99999) then
		if GetUnitAbilityLevel(u,'D027') == 0 then
			call UnitAddAbilityLevel1ToTimed(u,'C027','D027', 6 -UYX * .05)
		endif
		if UYX / 10== UYX / 10. then
			call UnitDamageTargetEx(LoadUnitHandle(ObjectHashTable, WFV, 1), u, 1, LoadReal(ObjectHashTable, WFV, 0))
		endif
	else
		call WHV(u,'D027')
	endif
	set t = null
	set u = null
endfunction
function YLV takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local unit d = GetSpellTargetUnit()
	local integer WFV = GetHandleId(t)
	call SaveUnitHandle(ObjectHashTable, WFV, 0, d)
	call SaveUnitHandle(ObjectHashTable, WFV, 1, u)
	call SaveEffectHandle(ObjectHashTable, WFV, 2, AddSpecialEffectTarget("war3mapImported\\Flux3.mdx", d, "origin"))
	call SaveInteger(ObjectHashTable, WFV, 0, 0)
	call SaveReal(ObjectHashTable, WFV, 0, GetUnitAbilityLevel(u,'A2M1')* 7.5)
	call TimerStart(t, .05, true, function PHA)
	call UnitAddAbilityLevel1ToTimed(d,'C027','D027', 6)
	set d = null
	set u = null
	set t = null
endfunction
function PJA takes nothing returns nothing
	local integer ETX
	local integer WFV
	local unit u = GetFilterUnit()
	if IsUnitAlly(u, Temp__Player) and(IsUnitType(u, UNIT_TYPE_HERO) or IsUnitType(u, UNIT_TYPE_STRUCTURE)) and GetUnitAbilityLevel(u,'A04R') == 0 and UnitAlive(u) then
		call GroupAddUnit(BK, u)
		if IsUnitInGroup(u, IK) == false then
			set WFV = GetHandleId(u)
			set ETX = StringHash("field_count")
			call UnitAddAbilityLevel1ToTimed(u,'C028','D028',-1)
			if IsUnitType(u, UNIT_TYPE_HERO) then
				call UnitAddStateBonus(u, XK[0], UNIT_BONUS_ATTACK)
			else
				call UnitAddStateBonus(u, XK[1], UNIT_BONUS_ATTACK)
			endif
			call SaveInteger(ObjectHashTable, WFV, ETX, LoadInteger(ObjectHashTable, WFV, ETX)+ 1)
			call UnitAddAbility(u,'A515')
			call UnitMakeAbilityPermanent(u, true,'A515')
			call UnitMakeAbilityPermanent(u, true,'ACes')
			set u = null
			return
		endif
		call GroupRemoveUnit(IK, u)
	endif
	set u = null
endfunction
function PKA takes nothing returns nothing
	local unit u = null
	local timer t = GetExpiredTimer()
	local integer ETX = StringHash("field_count")
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(ObjectHashTable, WFV, 0)
	local integer O3O = LoadInteger(ObjectHashTable, WFV, 1)
	set IK = LoadGroupHandle(ObjectHashTable, WFV, 1)
	if UYX == 0 then
		call DestroyEffect(LoadEffectHandle(ObjectHashTable, WFV, 2))
		loop
			set u = FirstOfGroup(IK)
		exitwhen u == null
			set WFV = GetHandleId(u)
			set UYX = LoadInteger(ObjectHashTable, WFV, ETX)
			if UYX == 1 then
				call UnitRemoveAbility(u,'A515')
				call WHV(u,'D028')
			endif
			call SaveInteger(ObjectHashTable, WFV, ETX, UYX -1)
			call UnitReduceStateBonus(u, O3O, UNIT_BONUS_ATTACK)
			call GroupRemoveUnit(IK, u)
		endloop
		call DeallocateGroup(IK)
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		return
	endif
	call SaveInteger(ObjectHashTable, WFV, 0, UYX -1)
	set Temp__Player = LoadPlayerHandle(ObjectHashTable, WFV, 0)
	set XK[0]= O3O
	set XK[1]= O3O / 2
	call GroupEnumUnitsInRange(AK, LoadReal(ObjectHashTable, WFV, 0), LoadReal(ObjectHashTable, WFV, 1), 325, Condition(function PJA))
	loop
		set u = FirstOfGroup(IK)
	exitwhen u == null
		set WFV = GetHandleId(u)
		set UYX = LoadInteger(ObjectHashTable, WFV, ETX)
		if UYX == 1 then
			call UnitRemoveAbility(u,'A515')
			call WHV(u,'D028')
		endif
		call SaveInteger(ObjectHashTable, WFV, ETX, UYX -1)
		call UnitReduceStateBonus(u, O3O, UNIT_BONUS_ATTACK)
		call GroupRemoveUnit(IK, u)
	endloop
	loop
		set u = FirstOfGroup(BK)
	exitwhen u == null
		call GroupRemoveUnit(BK, u)
		call GroupAddUnit(IK, u)
	endloop
	set u = null
	set t = null
endfunction
function YMV takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local integer WFV = GetHandleId(t)
	local integer WUV = GetUnitAbilityLevel(u,'A2LM')
	call SavePlayerHandle(ObjectHashTable, WFV, 0, GetOwningPlayer(u))
	call SaveGroupHandle(ObjectHashTable, WFV, 1, AllocationGroup(483))
	call SaveEffectHandle(ObjectHashTable, WFV, 2, AddSpecialEffect("war3mapImported\\MagneticField04.mdl", x, y))
	call SaveInteger(ObjectHashTable, WFV, 0, 30 + 5 * WUV)
	call SaveInteger(ObjectHashTable, WFV, 1, 40 + 10* WUV)
	call SaveReal(ObjectHashTable, WFV, 0, x)
	call SaveReal(ObjectHashTable, WFV, 1, y)
	call TimerStart(t, .1, true, function PKA)
	call EnableAttackEffectByTime(0, 6)
	set t = null
	set u = null
endfunction
function PLA takes unit u returns nothing
	local real x = GetWidgetX(u)-Temp__ArrayReal[0]
	local real y = GetWidgetY(u)-Temp__ArrayReal[1]
	local real d = SquareRoot(x * x + y * y)
	if Temp__ArrayReal[2]> d then
		set Temp__ArrayReal[2]= d
		set Temp__ArrayUnit[0]= u
	endif
endfunction
function PMA takes nothing returns boolean
	local unit t = GetFilterUnit()
	if IsUnitEnemy(t, Temp__Player) and GetUnitAbilityLevel(t,'A04R') == 0 and IsUnitMagicImmune(t) == false and UnitAlive(t) and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false and(IsUnitType(t, UNIT_TYPE_ANCIENT) == false or DRX(t)) then
		call PLA(t)
	endif
	set t = null
	return false
endfunction
function PPA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local unit u1 = LoadUnitHandle(ObjectHashTable, WFV, 0)
	local unit u2 = LoadUnitHandle(ObjectHashTable, WFV, 1)
	local real x2
	local real y2
	local real x1
	local real y1
	if UnitIsDead(u2) then
		call KillUnit(u1)
		call DestroyTimerAndFlushHT_P(t)
		set u2 = null
		set u1 = null
		set t = null
		return
	endif
	set x1 = GetWidgetX(u1)
	set y1 = GetWidgetY(u1)
	set x2 = x1 -GetWidgetX(u2)
	set y2 = y1 -GetWidgetY(u2)
	if  15> SquareRoot(x2 * x2 + y2 * y2) then
		call UnitDamageTargetEx(LoadUnitHandle(ObjectHashTable, WFV, 3), u2, 1, LoadInteger(ObjectHashTable, WFV, 1))
		call KillUnit(u1)
		call DestroyTimerAndFlushHT_P(t)
		set u2 = null
		set u1 = null
		set t = null
		return
	endif
	set x2 = Atan2(-y2,-x2)
	call SetUnitX(u1, x1 + 10.625 * Cos(x2))
	call SetUnitY(u1, y1 + 10.625 * Sin(x2))
	set u2 = null
	set u1 = null
	set t = null
endfunction
function PQA takes nothing returns nothing
	local unit u = null
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(ObjectHashTable, WFV, 0)
	if UYX == 1000 then
		call KillUnit(LoadUnitHandle(ObjectHashTable, WFV, 0))
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		return
	endif
	set Temp__Player = LoadPlayerHandle(ObjectHashTable, WFV, 2)
	set Temp__ArrayUnit[0]= null
	set Temp__ArrayReal[0]= LoadReal(ObjectHashTable, WFV, 0)
	set Temp__ArrayReal[1]= LoadReal(ObjectHashTable, WFV, 1)
	set Temp__ArrayReal[2]= 450
	call GroupEnumUnitsInRange(AK, Temp__ArrayReal[0], Temp__ArrayReal[1], 400, Condition(function PMA))
	call SaveInteger(ObjectHashTable, WFV, 0, UYX + 1)
	if Temp__ArrayUnit[0]!= null then
		set u = LoadUnitHandle(ObjectHashTable, WFV, 0)
		call SetUnitAnimationByIndex(u, 2)
		call SetUnitVertexColorEx(u,-1,-1,-1, 150)
		call SaveUnitHandle(ObjectHashTable, WFV, 1, Temp__ArrayUnit[0])
		call TimerStart(t, .025, true, function PPA)
		set u = null
	endif
	set t = null
endfunction
function PSA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	call TimerStart(t, .05, true, function PQA)
	call SetUnitAnimationByIndex(LoadUnitHandle(ObjectHashTable, WFV, 0), 1)
	set t = null
endfunction
function YPV takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit d = CreateUnit(p,'h0EG', x, y, 270)
	local integer WFV = GetHandleId(t)
	call UnitAddAbility(d,'Aloc')
	call UnitAddAbility(d,'A04R')
	call UnitAddAbility(d,'Arav')
	call SaveUnitHandle(ObjectHashTable, WFV, 0, d)
	call SaveUnitHandle(ObjectHashTable, WFV, 3, u)
	call SavePlayerHandle(ObjectHashTable, WFV, 2, p)
	call SaveInteger(ObjectHashTable, WFV, 0, 0)
	call SaveInteger(ObjectHashTable, WFV, 1, 100 + 50 * GetUnitAbilityLevel(u,'A2LL'))
	call SaveReal(ObjectHashTable, WFV, 0, x)
	call SaveReal(ObjectHashTable, WFV, 1, y)
	call SetUnitAnimationByIndex(d, 0)
	call TimerStart(t, 3, false, function PSA)
	set p = null
	set d = null
	set u = null
	set t = null
endfunction
function PTA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit PUA =(LoadUnitHandle(HY, h, 17))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call FlushChildHashtable(HY,(GetHandleId(PUA)))
	call RemoveUnit(PUA)
	set t = null
	set PUA = null
	return false
endfunction
function PWA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit PUA =(LoadUnitHandle(HY, h, 2))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call FlushChildHashtable(HY,(GetHandleId(PUA)))
	call ShowUnit(PUA, false)
	set t = null
	set PUA = null
	return false
endfunction
function PYA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit PUA =(LoadUnitHandle(HY, h, 17))
	local integer level = GetUnitAbilityLevel(whichUnit,'A2M0')
	if GetTriggerEvalCount(t)== 200 or GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(PUA)
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl", GetUnitX(PUA), GetUnitX(PUA)))
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(PUA))
		call TriggerRegisterTimerEvent(t, 0, false)
		call TriggerAddCondition(t, Condition(function PWA))
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 3, false)
		call TriggerAddCondition(t, Condition(function PTA))
		call SaveUnitHandle(HY, h, 17,(PUA))
	else
		call SuspendHeroXP(PUA, true)
		call UnitModifySkillPoints(PUA,-25)
	endif
	set t = null
	set whichUnit = null
	set PUA = null
	return false
endfunction
// 风暴双雄
function YUV takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit PUA
	local integer level = GetUnitAbilityLevel(whichUnit,'A2M0')
	local integer i = 0
	local item it
	local integer PZA ='I02M'
	local integer pid = GetPlayerId(GetOwningPlayer(whichUnit))
	set QV = true
	call DisableTrigger(hChooseHeroTrigger)
	set PUA = CreateUnit(GetOwningPlayer(whichUnit), GetUnitTypeId(whichUnit), GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	call EnableTrigger(hChooseHeroTrigger)
	call SetUnitVertexColorEx(PUA,-1,-1,-1, 130)
	call SaveBoolean(HY, GetHandleId(PUA), QR, true)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl", PUA, "chest"))
	call SelectUnitAddForPlayer(PUA, GetOwningPlayer(whichUnit))
	call DisableTrigger(CUV)
	loop
	exitwhen i > 5
		if UnitItemInSlot(whichUnit, i)!= null and GetItemTypeId(UnitItemInSlot(whichUnit, i))!= XOV[AIV]and GetItemTypeId(UnitItemInSlot(whichUnit, i))!= XOV[A6V]and GetItemTypeId(UnitItemInSlot(whichUnit, i))!= XOV[R2V]and GetItemTypeId(UnitItemInSlot(whichUnit, i))!= XOV[R3V]and GetItemTypeId(UnitItemInSlot(whichUnit, i))!= XOV[IVV] then
			set it = CreateItem(GetItemTypeId(UnitItemInSlot(whichUnit, i)), 0, 0)
			if GetItemCharges(UnitItemInSlot(whichUnit, i))> 0 then
				call SetItemCharges(it, GetItemCharges(UnitItemInSlot(whichUnit, i)))
			endif
			call UnitAddItem(PUA, it)
			call SetItemPlayer(it, GetOwningPlayer(PUA), false)
			if GetItemTypeId(it) == XOV[ASV]or GetItemTypeId(it) == XOV[ATV]or GetItemTypeId(it) == XOV[X4V] then
				call SetItemDropOnDeath(it, false)
			endif
		else
			call UnitAddItem(PUA, CreateItem(PZA, 0, 0))
		endif
		set i = i + 1
	endloop
	call EnableTrigger(CUV)
	call SetHeroLevel(PUA, GetHeroLevel(whichUnit), false)
	set i = 1
	loop
	exitwhen i > GetUnitAbilityLevel(whichUnit,'Aamk')
		call SelectHeroSkill(PUA,'Aamk')
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > GetUnitAbilityLevel(whichUnit,'A0NR')
		call SelectHeroSkill(PUA,'A0NR')
		set i = i + 1
	endloop
	call UnitAddPermanentAbility(PUA, HeroChangeAbilitySkills[PlayerSkillIndex[pid * HL + 1]])
	call UnitAddPermanentAbility(PUA, HeroChangeAbilitySkills[PlayerSkillIndex[pid * HL + 2]])
	call UnitAddPermanentAbility(PUA, HeroChangeAbilitySkills[PlayerSkillIndex[pid * HL + 3]])
	call UnitAddPermanentAbility(PUA, HeroChangeAbilitySkills[PlayerSkillIndex[pid * HL + 4]])
	set i = 1
	loop
	exitwhen i > GetUnitAbilityLevel(whichUnit, HeroCommonSkills[PlayerSkillIndex[pid * HL + 1]])
		call SelectHeroSkill(PUA, HeroCommonSkills[PlayerSkillIndex[pid * HL + 1]])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > GetUnitAbilityLevel(whichUnit, HeroCommonSkills[PlayerSkillIndex[pid * HL + 2]])
		call SelectHeroSkill(PUA, HeroCommonSkills[PlayerSkillIndex[pid * HL + 2]])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > GetUnitAbilityLevel(whichUnit, HeroCommonSkills[PlayerSkillIndex[pid * HL + 3]])
		call SelectHeroSkill(PUA, HeroCommonSkills[PlayerSkillIndex[pid * HL + 3]])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > GetUnitAbilityLevel(whichUnit, HeroCommonSkills[PlayerSkillIndex[pid * HL + 4]])
		call SelectHeroSkill(PUA, HeroCommonSkills[PlayerSkillIndex[pid * HL + 4]])
		set i = i + 1
	endloop
	call UnitRemoveAbility(PUA,'A2M0')
	call UnitModifySkillPoints(PUA,-25)
	call SuspendHeroXP(PUA, true)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterDeathEvent(t, PUA)
	call TriggerAddCondition(t, Condition(function PYA))
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(PUA))
	call SetWidgetLife(whichUnit, GetWidgetLife(whichUnit)*(1 -(.45 -0.15 * level)))
	call SetUnitState(whichUnit, UNIT_STATE_MANA, GetUnitState(whichUnit, UNIT_STATE_MANA)*(1 -(.45 -0.15 * level)))
	call SetWidgetLife(PUA, GetWidgetLife(whichUnit))
	call SetUnitState(PUA, UNIT_STATE_MANA, GetUnitState(whichUnit, UNIT_STATE_MANA))
	set QV = false
	set whichUnit = null
	set PUA = null
	set t = null
	set it = null
endfunction
function P_A takes unit u returns boolean
	return GetUnitAbilityLevel(u,'D100') == 1 or GetUnitAbilityLevel(u,'D101') == 1 or GetUnitAbilityLevel(u,'D102') == 1 or GetUnitAbilityLevel(u,'D103') == 1
endfunction
function P0A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(ObjectHashTable, WFV, 0)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	local real L2O
	if UYX == 4 or UnitIsDead(u) or P_A(u) == false then
		call DestroyEffect(LoadEffectHandle(ObjectHashTable, WFV, 1))
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		set u = null
		return
	endif
	set L2O = GetWidgetLife(u)
	set L2O = L2O -L2O * .09
	if .405 > L2O then
		set L2O = .406
	endif
	call SetWidgetLife(u, L2O)
	call SaveInteger(ObjectHashTable, WFV, 0, UYX + 1)
	set t = null
	set u = null
endfunction
function P1A takes unit u, unit d, integer WUV returns nothing
	local timer t = CreateTimer()
	local integer WFV = GetHandleId(t)
	call UnitAddAbilityLevel1ToTimed(d,'C100'+ WUV,'D100'+ WUV, 5)
	call SaveUnitHandle(ObjectHashTable, WFV, 0, d)
	call SaveEffectHandle(ObjectHashTable, WFV, 1, AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostDamage\\FrostDamage.mdl", d, "chest"))
	call SaveInteger(ObjectHashTable, WFV, 0, 0)
	call TimerStart(t, 1, true, function P0A)
	set t = null
endfunction
function P2A takes nothing returns nothing
	local unit u = null
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED then
		call CleanCurrentTrigger(t)
		call FlushChildHashtable(ObjectHashTable, h)
		set t = null
		return
	endif
	set u = GetEventDamageSource()
	if u == LoadUnitHandle(ObjectHashTable, h, 0) and GetEventDamage()> 5 then
		if P_A(GetTriggerUnit()) == false then
			call P1A(u, GetTriggerUnit(), LoadInteger(ObjectHashTable, h, 0)-1)
		endif
		call CleanCurrentTrigger(t)
		call FlushChildHashtable(ObjectHashTable, h)
	endif
	set t = null
	set u = null
endfunction
function P3A takes unit u, unit t returns nothing
	local trigger trig = CreateTrigger()
	call SaveUnitHandle(ObjectHashTable, GetHandleId(trig), 0, u)
	call TriggerRegisterUnitEvent(trig, t, EVENT_UNIT_DAMAGED)
	call TriggerRegisterTimerEvent(trig, 3, false)
	call SaveInteger(ObjectHashTable, GetHandleId(trig), 0, GetUnitAbilityLevel(u,'A332'))
	call TriggerAddCondition(trig, Condition(function P2A))
	set trig = null
endfunction
function P4A takes unit u, unit t returns nothing
	if GetUnitAbilityLevel(u,'D029') == 1 and GetUnitAbilityLevel(t,'A04R') == 0 and P_A(t) == false and IsUnitType(t, UNIT_TYPE_STRUCTURE) == false and IsUnitEnemy(u, GetOwningPlayer(t)) and GetUnitTypeId(t)!='n00L'then
		call P3A(u, t)
	endif
endfunction
// 看起来像是逆变身
function P5A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	local integer level
	local integer h
	if UnitAlive(u) and LoadBoolean(ObjectHashTable, GetHandleId(u), StringHash("morphedburn")) then
		call RAX(u, LoadInteger(ObjectHashTable, WFV, 1))
		call RAX(u, LoadInteger(ObjectHashTable, WFV, 0))
		call KillTreeByCircle(GetWidgetX(u), GetWidgetY(u), 150)
		call SaveBoolean(ObjectHashTable, GetHandleId(u), StringHash("morphedburn"), false)
		call SaveInteger(ObjectHashTable, GetHandleId(u), StringHash("morphedburn"), 0)
		call FixUnitSkillsBug(u)
		if GetUnitAbilityLevel(u,'A2AI')> 0 then
			call UnitRemoveAbility(u,'QF0O')
			call SetUnitAbilityLevel(u,'QB0G', GetUnitAbilityLevel(u,'A2AI'))
		endif
		call DestroyTimerAndFlushHT_P(t)
	elseif UnitIsDead(u) and LoadBoolean(ObjectHashTable, GetHandleId(u), StringHash("morphedburn")) then
		call TimerStart(t, 1, true, function P5A)
	endif
	set t = null
	set u = null
endfunction
function YQV takes nothing returns nothing
	local unit u = GetTriggerUnit()
	if GetUnitTypeId(u)!='N0MA' and GetUnitTypeId(u)!='N0MO' and GetUnitTypeId(u)!='N0MB' and GetUnitTypeId(u)!='N0MC' then
		call FixUnitSkillsBug(u)
		call UnitAddAbilityLevel1ToTimed(u,'C029','D029', 6)
	else
		call KillTreeByCircle(GetUnitX(u), GetUnitY(u), 200)
	endif
	set u = null
endfunction
function P6A takes nothing returns boolean
	return IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNotAncientOrBear(GetFilterUnit())
endfunction
function P7A takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = ZG
	local integer level = LoadInteger(HY, h, 0)
	if IsUnitMagicImmune(targetUnit) == false then
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 20 + 80 * level)
		call UnitAddAbilityLevel1ToTimed(targetUnit,'C030','D030', 4)
		call CXX(targetUnit,'A2MJ', 1, 4)
	endif
	set whichUnit = null
	set targetUnit = null
endfunction
function P8A takes nothing returns nothing
	local unit u = UG
	local unit targetUnit = GetEnumUnit()
	local trigger t = N6X(WG, targetUnit,'h0EC', "P7A", 600)
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2, u)
	call SaveInteger(HY, h, 0, Q2)
	set u = null
	set targetUnit = null
	set t = null
endfunction
function P9A takes unit whichUnit, unit targetUnit, integer level, boolean FAR returns nothing
	local group g = AllocationGroup(484)
	set U2 = whichUnit
	set UG = whichUnit
	set WG = targetUnit
	set Q2 = level
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 525, Condition(function P6A))
	call GroupRemoveUnit(g, targetUnit)
	call ForGroup(g, function P8A)
	call DeallocateGroup(g)
	if GetUnitAbilityLevel(targetUnit,'A3E9') == 1 and FAR == false and IsUnitMagicImmune(whichUnit) then
		call SaveUnitHandle(OtherHashTable2,'A3E9', 0, targetUnit)
		call SaveUnitHandle(OtherHashTable2,'A3E9', 1, whichUnit)
		call SaveInteger(OtherHashTable2,'A3E9', 0, level)
		call ExecuteFunc("QVA")
	endif
	set whichUnit = null
	set targetUnit = null
	set g = null
endfunction
function QEA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local unit HJA = LoadUnitHandle(HY, h, 45)
	local real px = GetUnitX(HJA)
	local real py = GetUnitY(HJA)
	local real tx = GetUnitX(targetUnit)
	local real ty = GetUnitY(targetUnit)
	local real O_A = GetDistanceBetween(tx, ty, px, py)
	local integer UYX = GetTriggerEvalCount(t)
	local real I3X = AngleBetweenXY(px, py, tx, ty)
	local real M8R
	local real M9R
	local real N3X = O_A /((1. / .02)-UYX)
	if N3X < 650 * .02 then
		set N3X = 650 * .02
	endif
	set M8R = px + N3X * Cos(I3X * bj_DEGTORAD)
	set M9R = py + N3X * Sin(I3X * bj_DEGTORAD)
	call SetUnitX(HJA, M8R)
	call SetUnitY(HJA, M9R)
	call SetUnitFacing(HJA, I3X)
	if GetDistanceBetween(tx, ty, M8R, M9R)<= N3X then
		call KillUnit(HJA)
		call P9A(whichUnit, targetUnit, LoadInteger(HY, h, 0), LoadBoolean(HY, h, 0))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	set whichUnit = null
	set HJA = null
	return false
endfunction
function QXA takes unit whichUnit, unit targetUnit, integer level, boolean FAR returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit HJA = CreateUnit(GetOwningPlayer(whichUnit),'e01E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function QEA))
	call SaveUnitHandle(HY, h, 2, whichUnit)
	call SaveInteger(HY, h, 0, level)
	call SaveBoolean(HY, h, 0, FAR)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveUnitHandle(HY, h, 45, HJA)
	set HJA = null
	set t = null
endfunction
function YTV takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())
	if UnitHasSpellShield(targetUnit) == false then
		call QXA(whichUnit, targetUnit, level, false)
	endif
	set whichUnit = null
	set targetUnit = null
endfunction
function QVA takes nothing returns nothing
	local unit whichUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 0)
	local unit targetUnit = LoadUnitHandle(OtherHashTable2,'A3E9', 1)
	local integer level = LoadInteger(OtherHashTable2,'A3E9', 0)
	call T4V(LoadUnitHandle(OtherHashTable2,'A3E9', 0))
	if UnitHasSpellShield(targetUnit) == false then
		call QXA(whichUnit, targetUnit, level, true)
	endif
	set whichUnit = null
	set targetUnit = null
	call FlushChildHashtable(OtherHashTable2,'A3E9')
endfunction
function QOA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(ObjectHashTable, WFV, 0)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	if UYX == 40 or UnitIsDead(u) or IsUnitHidden(u) or(C5X(u) == false and UYX > 4) then
		set UYX = 1
		loop
		exitwhen UYX == 10
			call DestroyEffect(LoadEffectHandle(ObjectHashTable, WFV, UYX))
			set UYX = UYX + 1
		endloop
		set WFV = GetHandleId(u)
		set UYX = LoadInteger(ObjectHashTable, WFV,'A516')
		if UYX == 1 then
			call UnitRemoveAbility(u,'A516')
		endif
		call SaveInteger(ObjectHashTable, WFV,'A516', UYX -1)
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		set u = null
		return
	endif
	call SetWidgetLife(u, GetWidgetLife(u)+ 2 + GetUnitState(u, UNIT_STATE_MAX_LIFE)* LoadReal(ObjectHashTable, WFV, 0))
	call SaveInteger(ObjectHashTable, WFV, 0, UYX + 1)
	set t = null
	set u = null
endfunction
function FLE takes nothing returns nothing
	local timer t = null
	local integer WFV
	local unit u = GetTriggerUnit()
	local unit u2 = GetSpellTargetUnit()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(u2),'e00E', GetUnitX(u2), GetUnitY(u2), 0)
	call UnitAddAbility(dummyUnit,'A2LG')
	if IssueTargetOrderById(dummyUnit, 852095, u2) then
		set t = CreateTimer()
		set WFV = GetHandleId(t)
		call SaveUnitHandle(ObjectHashTable, WFV, 0, u2)
		call SaveReal(ObjectHashTable, WFV, 0, GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A2LB')* .001 + .002)
		call SaveInteger(ObjectHashTable, WFV, 0, 0)
		call SaveEffectHandle(ObjectHashTable, WFV, 1, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, "hand right"))
		call SaveEffectHandle(ObjectHashTable, WFV, 2, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, "hand left"))
		call SaveEffectHandle(ObjectHashTable, WFV, 3, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, "foot right"))
		call SaveEffectHandle(ObjectHashTable, WFV, 4, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, "foot left"))
		call SaveEffectHandle(ObjectHashTable, WFV, 5, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, "foot right mount rear"))
		call SaveEffectHandle(ObjectHashTable, WFV, 6, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, "foot left mount rear"))
		call SaveEffectHandle(ObjectHashTable, WFV, 7, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, "head"))
		call SaveEffectHandle(ObjectHashTable, WFV, 8, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, "chest"))
		call SaveEffectHandle(ObjectHashTable, WFV, 9, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, GetHeroWeaponAttachPointName(u2)))
		call UnitAddAbility(u2,'A516')
		call SaveInteger(ObjectHashTable, GetHandleId(u2),'A516', LoadInteger(ObjectHashTable, GetHandleId(u2),'A516')+ 1)
		call TimerStart(t, .1, true, function QOA)
		set t = null
	endif
	set dummyUnit = null
	set u2 = null
	set u = null
	set t = null
endfunction
function QRA takes unit u returns nothing
	if GetUnitAbilityLevel(u,'D031')> 0 and UnitIsSleeping(u) == false and GetUnitAbilityLevel(u,'B008') == 0 and K0V == false then
		call DisableTrigger(UnitEventMainTrig)
		call IssueTargetOrderById(u, 851983, LoadUnitHandle(ObjectHashTable, GetHandleId(u),'A0Z0'))
		call EnableTrigger(UnitEventMainTrig)
	endif
endfunction
function QIA takes nothing returns nothing
	local unit u = GetEnumUnit()
	call DisableTrigger(FG)
	call UnitWakeUp(u)
	call IssueTargetOrderById(u, 851983, GG)
	call EnableTrigger(FG)
	set u = null
endfunction
function QAA takes nothing returns nothing
	call EPX(GetEnumUnit(), 4328, .75)
	if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
		call SelectUnitAddForPlayer(GetEnumUnit(), GetOwningPlayer(GetEnumUnit()))
	endif
endfunction
function QNA takes nothing returns nothing
	local unit u = GetEnumUnit()
	if IsUnitInGroup(u, HG) == false then
		call GroupAddUnit(HG, u)
		call TriggerRegisterUnitEvent(FG, u, EVENT_UNIT_ISSUED_TARGET_ORDER)
		call TriggerRegisterUnitEvent(FG, u, EVENT_UNIT_ISSUED_POINT_ORDER)
		call TriggerRegisterUnitEvent(FG, u, EVENT_UNIT_ISSUED_TARGET_ORDER)
		call SaveInteger(HY, GetHandleId(u), 4328, 1)
	endif
	set u = null
endfunction
function QBA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 5))
	local integer C2R =(LoadInteger(HY, h, 34))
	local group g =(LoadGroupHandle(HY, h, 22))
	local group gg
	if GetTriggerEventId()!= EVENT_UNIT_ISSUED_TARGET_ORDER and GetTriggerEventId()!= EVENT_UNIT_ISSUED_POINT_ORDER and GetTriggerEventId()!= EVENT_UNIT_ISSUED_TARGET_ORDER then
		set C2R = C2R + 1
		call SaveInteger(HY, h, 34,(C2R))
		set HG = g
		set FG = t
		set gg = AllocationGroup(485)
		set U2 = whichUnit
		call GroupEnumUnitsInRange(gg, GetUnitX(targetUnit), GetUnitY(targetUnit), 375, Condition(function DQX))
		call GroupRemoveUnit(gg, targetUnit)
		call ForGroup(gg, function QNA)
		call DeallocateGroup(gg)
		if C2R ==(2.25 + .25 * level)* 20 or UnitIsDead(targetUnit) then
			call ForGroup(g, function QAA)
			call UnitRemoveAbility(targetUnit,'A342')
			call DeallocateGroup(g)
			call DestroyEffect((LoadEffectHandle(HY, h, 176)))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			set FG = t
			set GG = targetUnit
			call ForGroup(g, function QIA)
		endif
	else
		if UnitIsSleeping(GetTriggerUnit()) == false and GetUnitAbilityLevel(GetTriggerUnit(),'B008') == 0 and GetIssuedOrderId()!= 851973 then
			call DisableTrigger(t)
			call ClearSelectionForPlayer(GetOwningPlayer(GetTriggerUnit()))
			call IssueTargetOrderById(GetTriggerUnit(), 851983, targetUnit)
			call EnableTrigger(t)
		endif
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	set g = null
	set gg = null
	return false
endfunction
function QCA takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(whichUnit,'A0Z0')
	local unit targetUnit = GetSpellTargetUnit()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	if GetUnitAbilityLevel(whichUnit,'Aloc') == 1 and HaveSavedHandle(HY, GetHandleId(whichUnit), 0) then
		set whichUnit = LoadUnitHandle(HY, GetHandleId(whichUnit), 0)
	endif
	set PG = whichUnit
	call UnitAddPermanentAbility(targetUnit,'A342')
	call UnitAddAbility(dummyUnit,'A2NJ')
	call SetUnitAbilityLevel(dummyUnit,'A2NJ', level)
	call IssueTargetOrderById(dummyUnit, 852095, targetUnit)
	call TriggerRegisterTimerEvent(t, .05, true)
	call SaveUnitHandle(HY, h, 2,(whichUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveGroupHandle(HY, h, 22,(AllocationGroup(486)))
	call SaveEffectHandle(HY, h, 176,(AddSpecialEffect("war3mapImported\\WintersCurseAoE.mdx", GetUnitX(targetUnit), GetUnitY(targetUnit))))
	call TriggerAddCondition(t, Condition(function QBA))
	set whichUnit = null
	set targetUnit = null
	set dummyUnit = null
	set t = null
endfunction
function FME takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call QCA()
	endif
endfunction
function QDA takes nothing returns nothing
	local unit d = null
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(ObjectHashTable, WFV, 0)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	if UnitIsDead(u) or(GetUnitAbilityLevel(u,'B0G8') == 0 and UYX > LoadInteger(ObjectHashTable, WFV, 2)) or(LoadBoolean(ObjectHashTable, WFV, 0) and(LoadReal(ObjectHashTable, WFV, 0)!= GetWidgetX(u) or LoadReal(ObjectHashTable, WFV, 1)!= GetWidgetY(u))) then
		call SaveBoolean(ObjectHashTable, GetHandleId(u),'A2N5', false)
		call UnitRemoveAbility(u,'B0G8')
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		set u = null
		return
	endif
	if UYX == LoadInteger(ObjectHashTable, WFV, 2) then
		set d = CreateUnit(Player(15),'e00E', 0, 0, 0)
		call UnitAddAbility(d,'A2N5')
		call L6X(u)
		call IssueTargetOrderById(d, 852069, u)
		call SaveBoolean(ObjectHashTable, GetHandleId(u),'A2N5', false)
		set d = null
		call IssueImmediateOrderById(u, 851993)
		call SaveReal(ObjectHashTable, WFV, 0, GetWidgetX(u))
		call SaveReal(ObjectHashTable, WFV, 1, GetWidgetY(u))
		call SaveBoolean(ObjectHashTable, WFV, 0, true)
	endif
	call SaveInteger(ObjectHashTable, WFV, 0, UYX + 1)
	set t = null
	set u = null
endfunction
function QFA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local unit u = LoadUnitHandle(ObjectHashTable, WFV, 0)
	call SaveInteger(ObjectHashTable, WFV, 0, 0)
	call SaveInteger(ObjectHashTable, WFV, 2, R2I(1.5 / .05))
	call TimerStart(t, .05, true, function QDA)
	set t = null
	set u = null
endfunction
function QGA takes unit u returns nothing
	local timer t = CreateTimer()
	local string s = ""
	if GetOwningPlayer(u) == LocalPlayer then
		set s = "Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayTarget.mdl"
	endif
	call DestroyEffect(AddSpecialEffectTarget(s, u, "chest"))
	call DestroyEffect(AddSpecialEffectTarget(s, u, "hand,left"))
	call DestroyEffect(AddSpecialEffectTarget(s, u, "hand,right"))
	call SaveUnitHandle(ObjectHashTable, GetHandleId(t), 0, u)
	call TimerStart(t, .01, false, function QFA)
	set t = null
endfunction
function FSE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer WFV = GetHandleId(targetUnit)
	if targetUnit == null and GetSpellTargetItem()!= null then
		set targetUnit = u
		set WFV = GetHandleId(targetUnit)
	endif
	if targetUnit != null then
		if LoadBoolean(ObjectHashTable, WFV,'A2N5') == false then
			call SaveBoolean(ObjectHashTable, WFV,'A2N5', true)
			call QGA(targetUnit)
		endif
	endif
	set targetUnit = null
	set u = null
endfunction
function QHA takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitAlly(GetFilterUnit(), GetOwningPlayer(U2)) and UnitIsDead(GetFilterUnit()) == false and LoadInteger(HY, GetHandleId(GetFilterUnit()),'CRMS')!= 1)!= null
endfunction
function QJA takes nothing returns nothing
	call EPX(GetEnumUnit(),'CRMS', 70)
	call CXX(GetEnumUnit(),'A42L', 1, 10)
	call UnitMakeAbilityPermanent(GetEnumUnit(), true,'A42K')
	call CNX(GetEnumUnit(),'A42N', 1, 10,'B0HG')
endfunction
function GOE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local group g = AllocationGroup(487)
	set U2 = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 900 + 25, Condition(function QHA))
	call ForGroup(g, function QJA)
	call DeallocateGroup(g)
	set u = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call UnitAddAbility(u,'AIda')
	call IssueImmediateOrderById(u, 852269)
	set g = null
	set u = null
endfunction
function QKA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if LoadReal(HY, h, 0)< GetGameTime() then
		call UnitRemoveAbility(u,'A42Y')
		call UnitRemoveAbility(u,'B0HK')
		if GetItemOfTypeFromUnit(u, XOV[A5V])!= null then
			call UnitAddPermanentAbility(u,'A431')
			call UnitMakeAbilityPermanent(u, true,'AIev')
		endif
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
		call RemoveSavedHandle(HY, GetHandleId(u),'AIev')
		call WAE(u)
	endif
	set t = null
	set u = null
endfunction
function GRE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local timer t
	if HaveSavedHandle(HY, GetHandleId(u),'AIev') then
		set t = LoadTimerHandle(HY, GetHandleId(u),'AIev')
	else
		set t = CreateTimer()
		call UnitRemoveAbility(u,'AIev')
		call TimerStart(t, .5, true, function QKA)
		call SaveUnitHandle(HY, GetHandleId(t), 0, u)
		call SaveTimerHandle(HY, GetHandleId(u),'AIev', t)
	endif
	call SaveReal(HY, GetHandleId(t), 0, GetGameTime()+ 6)
	call UnitRemoveAbility(u,'A431')
	call UnitRemoveAbility(u,'AIev')
	call WAE(u)
	call UnitAddPermanentAbility(u,'A42Y')
	set t = null
	set u = null
endfunction
function GAE takes nothing returns nothing
	if GetSpellTargetItem()!= null then
		call SetUnitState(GetTriggerUnit(), UNIT_STATE_MANA, GetUnitState(GetTriggerUnit(), UNIT_STATE_MANA)+ 150)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\MoonWell\\MoonWellCasterArt.mdx", GetTriggerUnit(), "origin"))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", GetTriggerUnit(), "origin"))
	else
		call SetUnitState(GetSpellTargetUnit(), UNIT_STATE_MANA, GetUnitState(GetSpellTargetUnit(), UNIT_STATE_MANA)+ 150)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\MoonWell\\MoonWellCasterArt.mdx", GetSpellTargetUnit(), "origin"))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", GetSpellTargetUnit(), "origin"))
	endif
endfunction
function QLA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetTriggerEventId() == EVENT_WIDGET_DEATH then
		call UnitRemoveAbility(u,'A38T')
		call UnitRemoveAbility(u,'A38X')
		call UnitRemoveAbility(u,'A3G1')
		call UnitRemoveAbility(u,'B3G1')
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	elseif GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		if GetGameTime()>= LoadReal(HY, h, 1) then
			call UnitRemoveAbility(u,'A38T')
			call UnitRemoveAbility(u,'A38X')
			call UnitRemoveAbility(u,'A3G1')
			call UnitRemoveAbility(u,'B3G1')
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		elseif GetGameTime()>= LoadReal(HY, h, 0) then
			call UnitAddPermanentAbility(u,'A38T')
			call UnitAddPermanentAbility(u,'A3G1')
		endif
	else
		if (GetTriggerEventId() == EVENT_PLAYER_UNIT_ATTACKED and u == GetAttacker()) or GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT then
			call SaveReal(HY, h, 0, GetGameTime()+ .4)
			call UnitRemoveAbility(u,'A38T')
			call UnitRemoveAbility(u,'A3G1')
			call UnitRemoveAbility(u,'B3G1')
		endif
	endif
	set t = null
	set u = null
	return false
endfunction
function QMA takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterTimerEvent(t, .1, true)
	call L6X(u)
	call SetAllPlayerAbilityUnavailable('A38T')
	call UnitAddPermanentAbility(u,'A38X')
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Invisibility\\InvisibilityTarget.mdl", u, "origin"))
	call TriggerAddCondition(t, Condition(function QLA))
	call SaveUnitHandle(HY, h, 0, u)
	call SaveReal(HY, h, 1, GetGameTime()+ 5.)
	call SaveReal(HY, h, 0, GetGameTime()+ .4)
	set t = null
endfunction
function GNE takes nothing returns nothing
	local unit targetUnit
	if GetSpellTargetItem()!= null then
		set targetUnit = GetTriggerUnit()
	else
		set targetUnit = GetSpellTargetUnit()
	endif
	call QMA(targetUnit)
	set targetUnit = null
endfunction
function QPA takes nothing returns boolean
	return IsUnitAlly(GetFilterUnit(), GetOwningPlayer(U2)) and IsAliveNotStrucNotWard(GetFilterUnit())
endfunction
function GDE takes nothing returns nothing
	local group g = AllocationGroup(488)
	local unit u
	call FKX(GetTriggerUnit(), false)
	set U2 = GetTriggerUnit()
	call GroupEnumUnitsInRange(g, GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 775, Condition(function QPA))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if LoadInteger(HY, GetHandleId(u), 4258)!= 1 then
			if IsUnitType(u, UNIT_TYPE_HERO) then
				call EPX(u, 4258, 25)
			endif
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIre\\AIreTarget.mdl", u, "origin"))
			call DestroyEffect(AddSpecialEffectTarget("Unleash.mdx", u, "chest"))
			call SetWidgetLife(u, GetWidgetLife(u)+ 250)
		endif
		if GetUnitState(u, UNIT_STATE_MANA)< GetUnitState(u, UNIT_STATE_MAX_MANA) then
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", u, "origin"))
			call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ 160)
		endif
		call GroupRemoveUnit(g, u)
	endloop
	call DeallocateGroup(g)
endfunction
function QQA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	if GetGameTime()< LoadReal(HY, h, 0) then
		if GetUnitAbilityLevel(whichUnit,'A39G') == 1 then
			call SetUnitAbilityLevel(whichUnit,'A39G', 2)
			call WAE(whichUnit)
		endif
	else
		if HaveSavedHandle(HY, h, 1) then
			call WAE(LoadUnitHandle(HY, h, 1))
		endif
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
		call SetUnitAbilityLevel(whichUnit,'A39G', 1)
		call WAE(whichUnit)
	endif
	set whichUnit = null
	set t = null
endfunction
function GCE takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local unit d
	if IsUnitAlly(whichUnit, GetOwningPlayer(targetUnit)) then
		call UnitAddAbilityToTimed(targetUnit,'A39J', 1, 7,'B39J')
		call UnitAddAbilityToTimed(targetUnit,'A39E', 1, 7,'A39E')
		call UnitAddAbilityToTimed(targetUnit,'A3C8', 1, 7,'A39M')
		call SetAllPlayerAbilityUnavailable('A3C8')
		
		call UnitAddAbilityToTimed(whichUnit,'A39F', 1, 7,'A39F')
		call SaveUnitHandle(HY, h, 1, targetUnit)
	else
		call UnitAddAbilityToTimed(targetUnit,'A39F', 1, 7,'A39F')
		call UnitAddAbilityToTimed(whichUnit,'A39F', 1, 7,'A39F')
		call UnitAddAbilityToTimed(targetUnit,'A39I', 1, 7,'B39I')
		call UnitAddAbilityToTimed(targetUnit,'A39D', 1, 3,'B39D')
		call EnableAttackEffectByTime(D, 8.)
		call CIO(targetUnit, 3.)
		if targetUnit == Roshan then
			call SetUnitAbilityLevel(targetUnit,'A39F', 2)
		endif
	endif
	call TimerStart(t, .1, true, function QQA)
	call SaveUnitHandle(HY, h, 0, whichUnit)
	call SetUnitAbilityLevel(whichUnit,'A39G', 2)
	call SaveReal(HY, h, 0, GetGameTime()+ 7.01)
	set t = null
	set whichUnit = null
	set targetUnit = null
endfunction
function GBE takes nothing returns nothing
	local unit targetUnit
	if GetSpellTargetItem()!= null then
		set targetUnit = GetTriggerUnit()
	else
		set targetUnit = GetSpellTargetUnit()
	endif
	call UnitAddAbilityToTimed(targetUnit,'A3E9', 1, 5.,'B3E9')
	call FKX(targetUnit, false)
	set targetUnit = null
endfunction
function QSA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local unit QTA = LoadUnitHandle(HY, h, 1)
	local unit d
	if GetTriggerEventId() == EVENT_UNIT_SPELL_ENDCAST then
		set d = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
		call UnitAddAbility(d,'A33T')
		call SetUnitAbilityLevel(d,'A33T', GetUnitAbilityLevel(QTA,'A33O'))
		call IssueTargetOrderById(d, 852585, whichUnit)
		set d = null
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	set QTA = null
endfunction
function QUA takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and UnitIsDead(GetFilterUnit()) == false and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit())) and GetUnitAbilityLevel(GetFilterUnit(),'A33O')> 0)!= null
endfunction
function QWA takes unit whichUnit, integer T0V returns nothing
	local trigger t
	local integer h
	local group g
	local unit QTA
	if OER(T0V) == false then
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	set g = AllocationGroup(489)
	call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 800, Condition(function QUA))
	set QTA = FirstOfGroup(g)
	call DeallocateGroup(g)
	set g = null
	call TriggerRegisterTimerEvent(t, 10, false)
	call TriggerRegisterUnitEvent(t, whichUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function QSA))
	call SaveUnitHandle(HY, h, 0, whichUnit)
	call SaveUnitHandle(HY, h, 1, QTA)
	set QTA = null
	set t = null
endfunction
function F_E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', x, y, 0)
	local group g = AllocationGroup(490)
	local unit u2
	call UnitAddAbility(d,'A1GG')
	if GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetTriggerPlayer())],'A0A8')> 0 then
		call SetUnitAbilityLevel(d,'A1GG', GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetTriggerPlayer())],'A0A8'))
	endif
	set U2 = u
	call GroupEnumUnitsInRange(g, x, y, 300, Condition(function DHX))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call IssueTargetOrderById(d, 852668, u2)
		call GroupRemoveUnit(g, u2)
	endloop
	call DeallocateGroup(g)
	call KillUnit(u)
	call SetUnitAnimation(u, "death")
	call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UndeadLargeDeathExplode\\UndeadLargeDeathExplode.mdl", x, y))
	set u = null
	set d = null
	set g = null
endfunction
function UrnaSwarmInfest takes nothing returns boolean
	if GetSpellAbilityId()=='A1HH' then
		call F_E()
	endif
	return false
endfunction
function Q1A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer level = LoadInteger(HY, h, 0)
	local unit Q2A = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	if GetUnitAbilityLevel(targetUnit,'Bpoi')+ GetUnitAbilityLevel(targetUnit,'Bpsd') == 0 then
		call RemoveSavedHandle(ObjectHashTable, GetHandleId(targetUnit),'Pois')
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	else
		call UnitDamageTargetEx(Q2A, targetUnit, 11, 6 * level * .75)
	endif
	set Q2A = null
	set targetUnit = null
	set t = null
endfunction
function Q3A takes unit R8X, unit targetUnit returns nothing
	local timer t
	local integer h
	local integer hu = GetHandleId(targetUnit)
	if HaveSavedHandle(ObjectHashTable, hu,'Pois') then
		set t = LoadTimerHandle(ObjectHashTable, hu,'Pois')
		set h = GetHandleId(t)
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, 1, true, function Q1A)
		call SaveUnitHandle(HY, h, 0, R8X)
		call SaveUnitHandle(HY, h, 1, targetUnit)
		call SaveTimerHandle(ObjectHashTable, hu,'Pois', t)
	endif
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(R8X,'P418'))
	set t = null
endfunction
function Q4A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	local unit u
	local real damageValue
	if UnitAlive(targetUnit) then
		set u = LoadUnitHandle(HY, h, 0)
		set damageValue = LoadReal(HY, h, 0)
		if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
			call UnitDamageTargetEx(u, targetUnit, 10, damageValue * .32)
		else
			call UnitDamageTargetEx(u, targetUnit, 10, damageValue * .12)
		endif
	endif
	call PauseTimer(t)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set targetUnit = null
	set u = null
	set t = null
endfunction
function Q5A takes unit u, unit tar, real d returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, 0, false, function Q4A)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveUnitHandle(HY, GetHandleId(t), 1, tar)
	call SaveReal(HY, GetHandleId(t), 0, d)
	set t = null
endfunction
function CustomUnitBountyAllyFilter takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitAlly(GetFilterUnit(), GetOwningPlayer(SB)) and UnitIsDead(GetFilterUnit()) == false and R5X(GetFilterUnit()) == false)!= null
endfunction
function CustomUnitBountyEnemyFilter takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(SB)) and UnitIsDead(GetFilterUnit()) == false and R5X(GetFilterUnit()) == false)!= null
endfunction
function Q6A takes unit killingUnit, unit Q7A returns nothing
	local integer i = 0
	local integer goldBonus = 0
	local integer xp = 0
	local group g = null
	local group gg = null
	local integer UYX = 0
	local boolean b = false
	local integer Q8A = 0
	local integer Q9A = 0
	local player p
	if IsUnitType(Q7A, UNIT_TYPE_HERO) or IsUnitIllusion(Q7A) or killingUnit == null then
		set Q7A = null
		set killingUnit = null
		return
	endif
	set b = IsUnitAlly(killingUnit, GetOwningPlayer(Q7A))
	if b then
		set i = GetUnitTypeId(Q7A)
		if YB then
			set xp = 0
		else
			set xp = LoadInteger(SightDataHashTable, i, HC)/ 2
		endif
		if xp > 0 then
			set SB = killingUnit
			call UDX()
			if (FirstOfGroup(IV)!= null) then
				set WB = R2I(xp / CountUnitsInGroup(IV))
				call ForGroup(IV, function Y3X)
			endif
			set SB = null
		endif
	endif
	if b == false or YB then
		set i = GetUnitTypeId(Q7A)
		set p = GetOwningPlayer(killingUnit)
		if (YB == false) and(p != SentinelPlayers[0]and p != ScourgePlayers[0]and p != NeutralCreepPlayer) then
			if GetUnitAbilityLevel(killingUnit,'Aloc') == 1 then
				set killingUnit = Player__Hero[GetPlayerId(p)]
			endif
			set Q9A = GetUnitAbilityLevel(killingUnit,'P155')
			if Q9A > 0 and GetUnitAbilityLevel(killingUnit,'A36D') == 0 then
				set UYX = GetHandleId(killingUnit)
				if IsUnitType(Q7A, UNIT_TYPE_STRUCTURE) == false and(GetUnitAbilityLevel(Q7A,'A04R') == 0) then
					set Q8A = IMinBJ(LoadInteger(ObjectHashTable, UYX,'A0O3')* 2 + Q9A * 2 + 2, 8 * Q9A)
					call SaveInteger(ObjectHashTable, GetHandleId(p),'A0O3', LoadInteger(ObjectHashTable, GetHandleId(p),'A0O3')+ Q8A)
					call DestroyEffect(AddSpecialEffect("war3mapImported\\GoblinCoin.mdx", GetUnitX(Q7A), GetUnitY(Q7A)))
				endif
			endif
			set goldBonus = GetRandomInt(LoadInteger(SightDataHashTable, i, CC), LoadInteger(SightDataHashTable, i, DC))+ Q8A
			if goldBonus > 0 then
				call BMX(p, Q7A, goldBonus)
			endif
		endif
		set xp = LoadInteger(SightDataHashTable, i, HC)
		if (xp > 0 and p != NeutralCreepPlayer) then
			call Y4X(xp, p, killingUnit)
		endif
		set YB = false
	endif
	set g = null
	set gg = null
endfunction
function SVA takes nothing returns nothing
	if IsUnitType(DESource, UNIT_TYPE_HERO) or IsUnitType(DESource, UNIT_TYPE_STRUCTURE) or GetUnitAbilityLevel(DETarget,'AZ00') == 1 then
		call KillUnit(DETarget)
	else
		call UnitAddAbility(DETarget,'AZ00')
	endif
endfunction
function SEA takes nothing returns nothing
	if GetUnitTypeId(DETarget)=='n0F5' then
		call SVA()
	endif
endfunction
function SXA takes nothing returns nothing
	local real YJX = GetWidgetLife(DETarget)
	local real damageValue = 2500
	if IsUnitType(DESource, UNIT_TYPE_HERO) then
		set damageValue = 10000
	elseif IsUnitType(DESource, UNIT_TYPE_STRUCTURE) then
		set damageValue = 5000
	endif
	if YJX > damageValue + 100.5 then
		call SetWidgetLife(DETarget, YJX -damageValue + GetEventDamage())
	else
		call UnitDamageTargetEx(DESource, DETarget, 2, 9999999)
	endif
endfunction
function PVX takes nothing returns nothing
	if RHX(GetUnitTypeId(DETarget)) then
		call SXA()
	endif
endfunction
function SOA takes nothing returns nothing	//毒性攻击
	if GetUnitAbilityLevel(DESource,'A09V')> 0 and GetUnitAbilityLevel(DETarget,'B06D')> 0 then
		call AXA(DESource, DETarget)
	endif
endfunction
function SRA takes nothing returns nothing
	call RegisterUnitAttackEvent("SOA", 4)	//毒性攻击
endfunction
function ExecuteAttackEvent takes integer i returns nothing
	local integer k = 0
	loop
	exitwhen HaveSavedString(AbilityDataHashTable,'DMGE'+ i, k) == false
		call ExecuteFunc(LoadStr(AbilityDataHashTable,'DMGE'+ i, k))
		set k = k + 1
	endloop
endfunction
function SAA takes nothing returns nothing	//冰甲
	if GetUnitAbilityLevel(DETarget,'B0H6')> 0 and IsUnitType(DESource, UNIT_TYPE_MELEE_ATTACKER) == false then
		call UUI(DESource, DETarget)
	endif
endfunction
function SNA takes nothing returns nothing	//吸血光环
	call P5I(DESource, DETarget)
endfunction
function OGO takes nothing returns nothing	//祭品
	local real i
	if GetUnitAbilityLevel(DESource,'B3B5') == 0 then
		return
	endif
	if IsUnitIllusion(DETarget) == false and IsUnitType(DETarget, UNIT_TYPE_STRUCTURE) == false and IsUnitType(DETarget, UNIT_TYPE_MECHANICAL) == false and GetUnitAbilityLevel(DETarget,'A04R') == 0 and IsUnitEnemy(DESource, GetOwningPlayer(DETarget)) and UnitIsDead(DESource) == false then
		if IsUnitType(DESource, UNIT_TYPE_MELEE_ATTACKER) then
			set i = .15
		else
			set i = .1
		endif
		call SetWidgetLife(DESource, GetWidgetLife(DESource)+ GetEventDamage()* i)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl", DESource, "origin"))
	endif
endfunction

function IXO takes unit whichUnit returns nothing
	local integer h = GetHandleId(whichUnit)
	call SaveReal(HY, h, 730, GetGameTime())
endfunction

function hyzrcd takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 1)
	call SaveInteger(HY, GetHandleId(u), 'echs', 0)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction

function hrzycd takes unit u returns nothing
	local timer t = CreateTimer()
	call YDWESetUnitAbilityState(u,'A3TY', 1, 5)
	call SaveInteger(HY, GetHandleId(u), 'echs', 1)
	call SaveUnitHandle(HY, GetHandleId(t), 1, u)
	call TimerStart(t, 5 , false, function hyzrcd)
	set t = null
endfunction

function Hyzr_Actions takes unit u , unit t returns nothing
	if LoadInteger(HY, GetHandleId(DESource),'echs') == 0 then
		call UnitAddAbility(u,'A3TW')
		call hrzycd(u)
		if not IsUnitType(u, UNIT_TYPE_STRUCTURE) and not R_X(t) then
			call UnitAddAbilityToTimed(t,'A3TX', 1, 0.8,'a3TX')
		endif
	endif
endfunction

function Hyzr takes nothing returns nothing
	if GetUnitAbilityLevel(DESource,'A3TW')> 0 then
		call UnitRemoveAbility(DESource,'A3TW')
	endif
	if (GetUnitAbilityLevel(DESource,'A3TY')> 0) and LoadBoolean(HY, EO, 15) and IsUnitType(DESource, UNIT_TYPE_MELEE_ATTACKER) and not IsUnitIllusion(DESource) then
		call Hyzr_Actions(DESource, DETarget)
	endif
endfunction


function X6O takes nothing returns nothing	//静谧之鞋
	if IsUnitType(DETarget, UNIT_TYPE_HERO) or IsBearUnit(DETarget) then
		call IXO(DETarget)
	endif
	//	if IsUnitType(DESource, UNIT_TYPE_HERO) or IsBearUnit(DESource) then
	//		call IXO(DESource)
	//	endif
endfunction

function OVO takes nothing returns nothing	//压制之刃
	if IsUnitType(DETarget, UNIT_TYPE_STRUCTURE) == false and IsUnitIllusion(DETarget) == false and IsUnitEnemy(DETarget, GetOwningPlayer(DESource)) and IsUnitType(DETarget, UNIT_TYPE_HERO) == false and(GetUnitAbilityLevel(DESource,'A1AB')> 0) and DETarget != Roshan then
		call Q5A(DESource, DETarget, DEDamage)
	endif
endfunction
function X8O takes nothing returns nothing	//雷神之锤and漩涡
	if IsUnitType(DETarget, UNIT_TYPE_STRUCTURE) == false and IsUnitType(DETarget, UNIT_TYPE_MECHANICAL) == false and IsUnitEnemy(DETarget, GetOwningPlayer(DESource)) and(GetUnitAbilityLevel(DESource,'A0JH')> 0 or GetUnitAbilityLevel(DESource,'A0FJ')> 0) then
		call B1O(DESource, DETarget)
	endif
endfunction
function MoonGlaiveOnAttackHit takes nothing returns nothing	//月刃
	if GetUnitAbilityLevel(DESource,'A36D') == 0 and LoadBoolean(HY, EO, 11) == false and LoadBoolean(HY, EO, 12) == false and LoadBoolean(HY, EO, 14) then
		if GetUnitAbilityLevel(DESource,'P098')> 0 then
			call MoonGlaiveOnMissileLaunch(DESource, DETarget, DEDamage)
		endif
	endif
endfunction
function OXO takes nothing returns nothing	//净魂之刃
	if IsUnitEnemy(DESource, GetOwningPlayer(DETarget)) and GetUnitAbilityLevel(DESource,'Afbt')> 0 and GetUnitState(DETarget, UNIT_STATE_MANA)> 0 then
		call B4O(DESource, DETarget)
	endif
endfunction
function Physical_Lifesteal takes unit u, unit t, real d returns nothing
	local real r = B4R(DESource)
	if r == 0. then
		return
	endif
	if IsUnitIllusion(u) == false and IsUnitIllusion(t) == false then
		call SetWidgetLife(u, GetWidgetLife(u)+ d * r)
	endif
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl", u, "origin"))
endfunction
function OPL takes nothing returns nothing	//物品吸血
	if (IsUnitType(DESource, UNIT_TYPE_HERO) or IsUnitIllusion(DESource) ) then
		if LoadBoolean(HY, EO, 11) == false and LoadBoolean(HY, EO, 14) and LoadBoolean(HY, EO, 15) then
			call Physical_Lifesteal(DESource, DETarget, DEDamage)
		endif
	endif
endfunction
function ORO takes nothing returns nothing	//黯灭
	if IsUnitEnemy(DESource, GetOwningPlayer(DETarget)) and GetUnitAbilityLevel(DESource,'AIcb')> 0 then
		call B6R(DETarget)
	endif
endfunction
function SCA takes nothing returns nothing
	if GetUnitAbilityLevel(DESource,'Broa')> 0 then
		call UnitRemoveAbility(DESource,'Broa')
	endif
endfunction
function SDA takes nothing returns nothing
	if GetUnitAbilityLevel(DESource,'Broa')> 0 and X4X(DESource) then
		call SPR()
	endif
endfunction
function SFA takes nothing returns nothing
	if LoadInteger(HY, EO, 120)> 0 and(GetUnitAbilityLevel(DESource,'A2GD')> 0 or GetUnitAbilityLevel(DESource,'A2GE')> 0 or GetUnitAbilityLevel(DESource,'A2GF')> 0 or GetUnitAbilityLevel(DESource,'A2GC')> 0) then
		call SaveInteger(HY, EO, 120, LoadInteger(HY, EO, 120)-1)
		call LTA(DESource, DETarget)
	endif
endfunction
function SGA takes nothing returns nothing
	call SaveBoolean(HY, EO, 120, GetUnitAbilityLevel(DESource,'B0FJ')> 0)
	if GetUnitAbilityLevel(DESource,'B0FJ')> 0 then
		call SaveInteger(HY, EO, 120, LoadInteger(HY, EO, 120)+ 1)
	endif
endfunction
function SHA takes nothing returns nothing
	if GetUnitTypeId(DESource)=='H00E' or GetUnitTypeId(DESource)=='H00F' or GetUnitTypeId(DESource)=='H00G' then
		call M3R(DESource, DETarget)
	endif
endfunction
function SJA takes nothing returns nothing
	if (GetUnitAbilityLevel(DESource,'A0FA')> 0) and GetUnitAbilityLevel(DESource,'A36D') == 0 then
		if IsUnitType(DESource, UNIT_TYPE_MELEE_ATTACKER) == false and GetRandomInt(0, 1) == 0 then
			return
		endif
		call XKA(DESource, DETarget)
	endif
endfunction
function SKA takes nothing returns nothing
	if GetUnitAbilityLevel(DESource,'A43Z')> 0 and GetUnitAbilityLevel(DESource,'A36D') == 0 then
		call PAA(DESource, DETarget)
	endif
endfunction
function SLA takes nothing returns nothing
	if GetUnitAbilityLevel(DETarget,'B03U')> 0 then
		call S7R(DESource, DETarget)
	endif
endfunction
function SMA takes nothing returns nothing
	if YTI() then
		call YYI(DESource, DETarget, GetUnitAbilityLevel(DESource,'A0SS'))
	endif
endfunction
function SPA takes nothing returns nothing
	if YTI() then
		call YUI(DESource, DETarget)
	endif
endfunction
function SQA takes nothing returns nothing
	if GetUnitAbilityLevel(DETarget,'B06Y')> 0 then
		call JHI(DESource, DETarget, LoadBoolean(HY, EO, 0))
	endif
endfunction
function SSA takes nothing returns nothing
	if GetUnitAbilityLevel(DETarget,'B05X')> 0 then
		call OLI(DESource, DETarget)
	endif
endfunction
function STA takes nothing returns nothing
	if (GetUnitAbilityLevel(DESource,'A1HR')> 0) and IsUnitType(DETarget, UNIT_TYPE_HERO) and GetUnitAbilityLevel(DESource,'A36D') == 0 then
		call CMA(DESource, DETarget)
	endif
endfunction
function SUA takes nothing returns nothing
	if (GetUnitAbilityLevel(DESource,'A0G5')> 0) and GetUnitAbilityLevel(DESource,'A36D') == 0 then
		call OYA(DESource, DETarget)
	endif
endfunction
function SWA takes nothing returns nothing
	if GetUnitAbilityLevel(DESource,'P067')> 0 and GetUnitAbilityLevel(DESource,'A36D') == 0 then
		call BFI(DESource, DETarget)
	endif
endfunction


function OAO takes nothing returns nothing	//淬毒之珠
	if GetUnitAbilityLevel(DESource,'A1V7') > 0 then
		call Q0A(DETarget, DESource, IsUnitType(DESource, UNIT_TYPE_MELEE_ATTACKER))
	endif
endfunction

function OBO takes nothing returns nothing	//斯嘉蒂之眼
	if GetUnitAbilityLevel(DESource,'A2KV')> 0 then
		call QZA(DETarget, IsUnitType(DESource, UNIT_TYPE_MELEE_ATTACKER))
	endif
endfunction
function SYA takes nothing returns nothing
	if GetUnitAbilityLevel(DESource,'P418')> 0 and GetUnitAbilityLevel(DETarget,'Bpsd')> 0 and IsAliveNotStrucNotWard(DETarget) and IsUnitEnemy(DESource, GetOwningPlayer(DETarget)) and GetUnitAbilityLevel(DESource,'A36D') == 0 then
		call Q3A(DESource, DETarget)
	endif
endfunction
function SZA takes nothing returns nothing
	if GetUnitAbilityLevel(DESource,'P338')> 0 and IsUnitType(DESource, UNIT_TYPE_MELEE_ATTACKER) == false and GetUnitAbilityLevel(DESource,'A36D') == 0 and LoadInteger(HY, GetHandleId(DESource), 4275)!= 1 and IsAliveNotStrucNotWard(DETarget) and DETarget != Roshan then
		call ORA(DESource, DETarget)
	endif
endfunction
function S_A takes nothing returns nothing
	if GetUnitAbilityLevel(DESource,'A36D') == 0 and(GetUnitAbilityLevel(DESource,'A0MG')> 0) then
		call IUR(DESource, DETarget)
	endif
endfunction
function S0A takes nothing returns nothing
	if IsBearUnit(DESource) and IsUnitIllusion(DESource) == false then
		call R1I(DESource, DETarget)
	endif
endfunction
function S1A takes nothing returns nothing
	call UQR(DESource, DETarget)
endfunction
function S2A takes nothing returns nothing
	if (GetUnitAbilityLevel(DESource,'A0N7')> 0) and GetUnitAbilityLevel(DESource,'A36D') == 0 then
		call QHI(DESource, DETarget)
	endif
endfunction
function S3A takes nothing returns nothing
	call USR(DESource, DETarget)
endfunction
function S4A takes nothing returns nothing
	call LUI(DESource, DETarget)
endfunction
function S5A takes nothing returns nothing
	if AD < 1 and DEDamage > 40 or IsUnitType(DETarget, UNIT_TYPE_STRUCTURE) then
		call Tidebringer_Actions(DESource, DETarget, DEDamage)
	endif
endfunction
function S6A takes nothing returns nothing
	//	call DamagedEvent__Tidebringer(DESource, DETarget)
endfunction
function S7A takes nothing returns nothing
	call CGI(DESource, DETarget, DEDamage)	//灵能之刃
endfunction
function S8A takes nothing returns nothing
	call P4A(DESource, DETarget)
endfunction
function S9A takes nothing returns nothing
	call X7I(DESource)
endfunction
function TVA takes nothing returns nothing
	call IWR(DESource, DETarget)
endfunction
function TEA takes nothing returns nothing
	call ROI(DESource, DETarget)
endfunction
function TXA takes nothing returns nothing
	call XCI(DESource, DETarget)
endfunction
function TOA takes nothing returns nothing
	call N2I(DESource, DETarget)
endfunction
function TRA takes nothing returns nothing
	call FFI(DESource, DETarget)
endfunction
function TIA takes nothing returns nothing
	call I7A(DESource, DETarget)	//幽冥剧毒
endfunction
function TAA takes nothing returns nothing
	call RSA(DESource, DETarget)	//海妖外壳
endfunction
function TNA takes nothing returns nothing
	call OIA(DESource, DETarget)
endfunction
function TBA takes nothing returns nothing
	if GetUnitAbilityLevel(DETarget,'P123')> 0 and R_X(DESource) == false and GetUnitAbilityLevel(DESource,'A04R') == 0 and GetUnitAbilityLevel(DETarget,'A36D') == 0 then
		call HHR(DESource, DETarget)
	endif
endfunction
function TCA takes nothing returns nothing	//活性护甲
	call MSA(DESource, DETarget)
endfunction
function TDA takes nothing returns nothing
	call LWA(DESource, DETarget)
endfunction
function TFA takes nothing returns nothing
	call F_I(DESource, DETarget)
endfunction
function AddingBashOrCritWrapper takes nothing returns nothing
	call RegisterUnitAttackEvent("TJA", 0)
endfunction
function ODO takes nothing returns nothing
	if LoadBoolean(HY, EO, 20) then
		if IsUnitMagicImmune(DETarget) == false then
			call UnitAddAbilityToTimed(DETarget,'A39D', 1, 5.,'B39D')
			call CIO(DETarget, 5.)
		endif
		call RemoveSavedBoolean(HY, EO, 20)
	endif
endfunction
function TKA takes unit u, unit target, real c, real dmg returns nothing
	local texttag tt = CreateTextTag()
	call SetTextTagText(tt, I2S(R2I(dmg * c))+ "!", .025)
	call SetTextTagColor(tt, 255, 0, 0, 255)
	call SetTextTagPos(tt, GetUnitX(u), GetUnitY(u), .0)
	call SetTextTagVelocity(tt, .0, .04)
	call SetTextTagVisibility(tt, UnitVisibleToPlayer(u, LocalPlayer))
	call SetTextTagFadepoint(tt, 2.)
	call SetTextTagLifespan(tt, 5.)
	call SetTextTagPermanent(tt, false)
	set tt = null
	call UnitDamageTargetEx(u, target, 10, dmg *(c -1))
endfunction
function H5I takes unit u returns nothing
	call UnitAddAbilityToTimed(u,'A3JG', 1, 8,'B3JG')
	call UnitAddAbilityToTimed(u,'A3JH', 1, 8, 0)
endfunction
function TJA takes nothing returns nothing
	if HaveSavedReal(HY, EO, 16) then
		call TKA(DESource, DETarget, LoadReal(HY, EO, 16), DEDamage)
		call RemoveSavedReal(HY, EO, 16)
		call H5I(DETarget)
	endif
endfunction
function TLA takes unit u, unit t, real dmg returns nothing
	local integer id
	local real r1 = 0
	if TKV(u,'P431', 15) then
		set r1 = .75 + .5 * GetUnitAbilityLevel(u,'P431')
	endif
	if r1 != 0 then
		call TKA(u, t, r1, dmg)
		call H5I(t)
	endif
endfunction
function TMA takes nothing returns nothing	//混沌一击
	if GetUnitAbilityLevel(DESource,'A36D') == 0 and LoadBoolean(HY, EO, 11) == false and LoadBoolean(HY, EO, 12) == false and LoadBoolean(HY, EO, 14) then
		if GetUnitAbilityLevel(DESource,'P431')> 0 then
			call TLA(DESource, DETarget, DEDamage)
		endif
	endif
endfunction
// 被动晕眩
function TPA takes nothing returns nothing
	local integer probability
	local boolean isMeleeAttacker = IsUnitType(DESource, UNIT_TYPE_MELEE_ATTACKER)
	if GetUnitAbilityLevel(DESource,'A3L2')> 0 then	//碎颅锤and深渊之刃
		if isMeleeAttacker then
			set probability = 25
		else
			set probability = 10
		endif
		if LoadInteger(HY, GetHandleId(DESource),'bash')!= 1 and TKV(DESource,'A3L2', probability) then
			if GetUnitAbilityLevel(DESource,'A3TZ') == 1 then
				call YDWESetUnitAbilityState(DESource,'A3TZ', 1, 2.3)
			endif
			call EPX(DESource,'bash', 2.3)
			call TGA(DESource, DETarget, 4)
		endif
	elseif GetUnitAbilityLevel(DESource,'A36D') == 0 then
		if GetUnitAbilityLevel(DESource,'A0JJ')> 0 then	//重击
			if isMeleeAttacker then
				if TKV(DESource,'A0JJ', 5 + 5 * GetUnitAbilityLevel(DESource,'A0JJ')) then
					call TGA(DESource, DETarget, 1)
				endif
			else
				if TKV(DESource,'A0JJ', 4 * GetUnitAbilityLevel(DESource,'A0JJ')) then
					call TGA(DESource, DETarget, 1)
				endif
			endif
		elseif GetUnitAbilityLevel(DESource,'A081')> 0 then	//时间锁定
			if isMeleeAttacker then
				if TKV(DESource,'A081', 5 + 5 * GetUnitAbilityLevel(DESource,'A081')) then
					call TGA(DESource, DETarget, 2)
				endif
			else
				if TKV(DESource,'A081', 4 * GetUnitAbilityLevel(DESource,'A081')) then
					call TGA(DESource, DETarget, 2)
				endif
			endif
		elseif GetUnitAbilityLevel(DESource,'A09E')> 0 then	//狂战士之怒
			if TKV(DESource,'A09E', 10) then
				call TGA(DESource, DETarget, 3)
			endif
		elseif GetUnitAbilityLevel(DESource,'A340')> 0 then	//极度饥渴
			if isMeleeAttacker then
				set probability = 20
			else
				set probability = 10
			endif
			if TKV(DESource,'A340', probability) then
				call TGA(DESource, DETarget, 6)
			endif
		endif
	endif
	if GetUnitAbilityLevel(DESource,'A061') == 1 then	//金箍棒
		if TKV(DESource,'A061', 35) then
			call TGA(DESource, DETarget, 5)
		endif
	endif
endfunction
function TSA takes nothing returns nothing
	call RegisterUnitAttackEvent("TMA", 0)	//混沌一击
endfunction
function OPO takes nothing returns nothing
	call RegisterUnitAttackEvent("TPA", 2)
endfunction
function TTA takes unit u, unit target, real damage returns nothing
	set DESource = u
	set DETarget = target
	set DEDamage = damage
	set EO = GetHandleId(GetTriggeringTrigger())
	call ExecuteAttackEvent(0)
	if not LoadBoolean(HY, EO, 10) then	//攻击者非英雄，非熊灵则返回
		return
	endif
	call ExecuteAttackEvent(1)	
	//攻击目标非建筑，非守卫
	if not LoadBoolean(HY, EO, 11) and LoadBoolean(HY, EO, 14) then
		call ExecuteAttackEvent(2)	//攻击目标非建筑，非守卫
		if LoadBoolean(HY, EO, 15) then	//攻击目标是敌对单位
			call ExecuteAttackEvent(3)	//攻击目标非建筑，非守卫，非友军
			if IsUnitMagicImmune(target) == false then	//攻击目标非魔免
				call ExecuteAttackEvent(4)	//攻击目标非建筑，非守卫，非友军，非魔免
			endif
		endif
	endif
endfunction
// 大部分的攻击特效遍历在这
function TUA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED and LoadInteger(HY, h, 0)> 0 then	//右键伤害
		if GetEventDamageSource() == LoadUnitHandle(HY, h, 0) and FK and(EXGetEventDamageData(1) != 0) and(GetEventDamage()> 0 or not LoadBoolean(HY, h, 10)) then
			call DisableTrigger(t)
			call TTA(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1), GetEventDamage())
			call EnableTrigger(t)
			if LoadInteger(HY, h, 0) == 1 then
				call SaveInteger(HY, h, 0, 0)
			else
				call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)-1)
			endif
		endif
	elseif GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		//call RemoveSavedHandle(HY, GetHandleId(LoadUnitHandle(HY, h, 0)), 'A09J')	//美杜莎分裂箭
		call RemoveSavedHandle(ObjectHashTable, LoadInteger(HY, h, 10), LoadInteger(HY, h, 11))
		call PauseTimer(LoadTimerHandle(HY, h, 3))
		call DestroyTimer(LoadTimerHandle(HY, h, 3))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set LX = LX -1
	endif
	set t = null
endfunction
function SetUnitMiss takes nothing returns nothing
	//call setmiss(DESource, DETarget)
	local integer probability = 0
	local integer TYA = 0
	local unit d
	// 有金箍棒
	if (IsAttackEffectEnabled[17]and GetUnitAbilityLevel(DESource,'A1FO') == 1 and(not IsUnitType(DETarget, UNIT_TYPE_STRUCTURE) or(GetOwningPlayer(DETarget)!= ScourgePlayers[0]and GetOwningPlayer(DETarget)!= SentinelPlayers[0]))) or GetUnitAbilityLevel(DETarget,'A3Q3') == 1 then
		call UnitRemoveAbility(DESource,'a3PQ')
		return
	endif
	// 大隐刀 仇杀
	if (IsAttackEffectEnabled[19]and GetUnitAbilityLevel(DESource,'B39C') == 1) or(IsAttackEffectEnabled[20]and GetUnitAbilityLevel(DESource,'B00K') == 1) then
		call UnitRemoveAbility(DESource,'a3PQ')
		return
	endif
	// 攻击者不是近战单位 和 飞行单位
	if not IsUnitType(DESource, UNIT_TYPE_MELEE_ATTACKER) and not IsUnitType(DESource, UNIT_TYPE_FLYING) then
		// 如果悬崖高就有 25% 几率丢失
		if GetTerrainCliffLevel(GetUnitX(DESource), GetUnitY(DESource))< GetTerrainCliffLevel(GetUnitX(DETarget), GetUnitY(DETarget)) then
			set TYA = 25
		endif
	endif
	// 查各种丢失 磁场 和 醉拳百分百闪避
	if (IsAttackEffectEnabled[0]and GetUnitAbilityLevel(DETarget,'ACes')> 0) or(IsAttackEffectEnabled[1]and GetUnitAbilityLevel(DETarget,'A34E')> 0 and GetUnitAbilityLevel(DETarget,'A36D') == 0) then
		set probability = 100
	else
		set probability = GetUnitMissProbability(DETarget)
	endif
	set TYA = UUE(TYA, GetUnitBlind(DESource))
	//if IsAttackEffectEnabled[18] and GetUnitAbilityLevel(DETarget,'B0F5') == 1 then // 阿托斯的60%致盲？
	//	set probability = R2I(probability * .6)
	//	set TYA = R2I(TYA * .6)
	//endif
	if (probability > 0 or TYA > 0) and(GetRandomInt(1, 100)< probability or GetRandomInt(1, 100)< TYA) then
		set d = IYX(DESource)
		call SetUnitX(d, GetUnitX(DESource))
		call SetUnitY(d, GetUnitY(DESource))
		call UnitAddAbility(d,'A3PQ')
		if not IssueTargetOrderById(d, 852190, DESource) then
			if GetUnitState(DESource, UNIT_STATE_TYPE) == 0 then
				call SetUnitState(DESource, UNIT_STATE_TYPE, 2) 
				call IssueTargetOrderById(d, 852190, DESource)
				call SetUnitState(DESource, UNIT_STATE_TYPE, 0) 
			endif
		endif
		call UnitRemoveAbility(d,'A3PQ')
		set d = null
		set bDodgeAttack = true
	else
		call UnitRemoveAbility(DESource,'a3PQ')
		set bDodgeAttack = false
	endif
endfunction

// 动态注册伤害事件
function TZA takes unit attackerUnit, unit targetUnit, boolean isAbility returns nothing
	local trigger t
	local integer h
	local timer tt
	set DESource = attackerUnit
	set DETarget = targetUnit
	set PV = isAbility
	// 遍历 单位被攻击 事件 会第一时间运行闪避类
	call ExecuteAttackEvent(-1)
	// 是玩家单位 或者 有吸血光环 则继续 否则返回
	if not(XFX(GetOwningPlayer(attackerUnit)) or XFX(GetOwningPlayer(targetUnit)) or(EE and(GetUnitAbilityLevel(attackerUnit,'BVA1') == 1 or GetUnitAbilityLevel(attackerUnit,'BVA2') == 1 or GetUnitAbilityLevel(attackerUnit,'BVA3') == 1 or GetUnitAbilityLevel(attackerUnit,'BVA4') == 1)) or(EV and GetUnitAbilityLevel(attackerUnit,'B07O') == 1)) then
		return
	endif
	if HaveSavedHandle(ObjectHashTable, GetHandleId(attackerUnit), GetHandleId(targetUnit)) then
		set t = LoadTriggerHandle(ObjectHashTable, GetHandleId(attackerUnit), GetHandleId(targetUnit))
		set h = GetHandleId(t)
		if not bDodgeAttack then
			call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0) + 1)
		endif
		set tt = LoadTimerHandle(HY, h, 3)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		set tt = CreateTimer()
		call SaveTimerHandle(HY, h, 3, tt)
		call SaveTriggerHandle(ObjectHashTable, GetHandleId(attackerUnit), GetHandleId(targetUnit), t)
		if not bDodgeAttack then
			call SaveInteger(HY, h, 0, 1)
		else
			call SaveInteger(HY, h, 0, 0)
		endif
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
		call TriggerRegisterTimerExpireEvent(t, tt)
		call TriggerAddCondition(t, Condition(function TUA))
		call SaveUnitHandle(HY, h, 0, attackerUnit)
		call SaveUnitHandle(HY, h, 1, targetUnit)
		call SaveInteger(HY, h, 10, GetHandleId(attackerUnit))
		call SaveInteger(HY, h, 11, GetHandleId(targetUnit))
		// 攻击单位是否是英雄或者是熊
		call SaveBoolean(HY, h, 10, IsUnitType(attackerUnit, UNIT_TYPE_HERO) or IsBearUnit(attackerUnit) )
		// 目标单位是否是建筑
		call SaveBoolean(HY, h, 11, IsUnitType(targetUnit, UNIT_TYPE_STRUCTURE))
		// 目标单位不是守卫单位
		call SaveBoolean(HY, h, 14, GetUnitAbilityLevel(targetUnit,'A04R') == 0)
		// 攻击单位是否是目标单位的敌军
		call SaveBoolean(HY, h, 15, IsUnitEnemy(attackerUnit, GetOwningPlayer(targetUnit)))
		set LX = LX + 1
	endif
	set EO = h
	if not LoadBoolean(HY, h, 11) and LoadBoolean(HY, h, 14) then
		if GetUnitAbilityLevel(attackerUnit,'B39C')> 0 then
			call SaveBoolean(HY, h, 20, true)
		endif
	endif
	//if GetUnitAbilityLevel(attackerUnit,'A09J') > 0 then
	//	call SaveUnitHandle(HY,GetHandleId(attackerUnit),'A09J',targetUnit)
	//endif
	if IsUnitType(attackerUnit, UNIT_TYPE_HERO) then
		call ExecuteAttackEvent(-2)
	endif
	call TimerStart(tt, 4, false, null)
	call SaveBoolean(HY, h, 0, isAbility)
	set tt = null
	set t = null
endfunction

function ExecteAttackReady takes nothing returns nothing
	call TZA(AttackReadySource, AttackReadyTarget, false)
endfunction

function T4A takes unit R8X, unit targetUnit, real damageValue returns nothing
	local integer hu = GetHandleId(targetUnit)
	if LoadBoolean(HY, hu,'BMON') then
		if IsUnitType(R8X, UNIT_TYPE_STRUCTURE) == false then
			if R_X(R8X) == false then
				if GetUnitAbilityLevel(R8X,'A04R')> 0 then
					set R8X = Player__Hero[GetPlayerId(GetOwningPlayer(R8X))]
				endif
				call SaveBoolean(HY, hu,'BMON', false)
				call UnitDamageTargetEx(targetUnit, R8X, 3, damageValue)
				call SaveBoolean(HY, hu,'BMON', true)
			endif
		endif
	endif
endfunction
function SplitShot_A takes nothing returns nothing
	local unit u = U2
	local unit t = MissileHitTargetUnit
	local integer h = GetHandleId(GetTriggeringTrigger())
	call UnitDamageTargetEx(u, t, 2, LoadReal(HY, h, 0))
	set u = null
	set t = null
endfunction
function SplitShot_EnumUnit takes nothing returns boolean
	return(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()) and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) ) != null
endfunction
function SplitShot takes unit u returns nothing
	local real r = GetUnitState(u, UNIT_STATE_ATTACK1_RANGE)+ 125
	local real d = (GetUnitState(u, UNIT_STATE_ATTACK1_DAMAGE_BASE) + GetUnitState(u, UNIT_STATE_ATTACK1_DAMAGE_BONUS) )* 0.8
	local group g = AllocationGroup(491)
	local unit t
	local trigger trg
	local integer i = 0
	local integer h
	local integer maxi = GetUnitAbilityLevel(u,'A418') + 1
	set U2 = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), r, Condition(function SplitShot_EnumUnit))
	call GroupRemoveUnit(g, LoadUnitHandle(HY, GetHandleId(u),'A09J'))
	loop
		set t = EXX(g, GetUnitX(u), GetUnitY(u))
	exitwhen t == null
		call GroupRemoveUnit(g, t)
		set trg = LaunchMissileByUnitDummy(u, t,'h30C', "SplitShot_A", 900, true)
		set h = GetHandleId(trg)
		call SaveReal(HY, h, 0, d)
		set i = i + 1
	exitwhen i == maxi
	endloop
	call DeallocateGroup(g)
	set t = null
	set trg = null
	set g = null
endfunction

function SNE takes unit u returns nothing
	if EXGetEventDamageData(3) != 0 and GetUnitAbilityLevel(u,'a3PQ') == 0 then
		call EXSetEventDamage(.0)
		call SplitShot(u)
	endif
endfunction

function ZNE takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call CameraClearNoiseForPlayer(LoadPlayerHandle(HY, h, 0) )
	call RemoveSavedHandle(OtherHashTable, GetHandleId(LoadPlayerHandle(HY, h, 0)),'CAMS')
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
endfunction
function ZBE takes unit u, real damageValue returns nothing
	local timer t
	local integer h
	local player p = GetOwningPlayer(u)
	local integer hp = GetHandleId(p)
	local real ZDE = RMinBJ(damageValue, 1000)/ 100 
	if HaveSavedHandle(OtherHashTable, hp,'CAMS') then
		set t = LoadTimerHandle(OtherHashTable, hp,'CAMS')
		set h = GetHandleId(t)
		if LoadReal(HY, h, 0)< ZDE then
			call CameraClearNoiseForPlayer(p)
		endif
		call CameraSetEQNoiseForPlayer(p, ZDE)
	else
		set t = CreateTimer()
		call TimerStart(t, .3, false, function ZNE)
		set h = GetHandleId(t)
		call SavePlayerHandle(HY, h, 0, p)
		call SaveReal(HY, h, 0, ZDE)
		call CameraSetEQNoiseForPlayer(p, ZDE)
		call SaveTimerHandle(OtherHashTable, hp,'CAMS', t)
	endif
	set t = null
endfunction

//function MFO takes nothing returns boolean
	//call ExecuteFunc("SoulAssumptionDamagedEvent")
	//call ExecuteFunc("SetAssistList")
	//call ExecuteFunc("ICO")
	//return false
//endfunction

//function MGO takes unit u returns nothing	//英雄单位挨打
//	local trigger t = CreateTrigger()
//	call SaveBoolean(HY, GetHandleId(u), 38, true)
//	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DAMAGED)
//	call TriggerAddCondition(t, Condition(function MFO))
//	set t = null
//endfunction
//function MHO takes nothing returns boolean
//	if not IsPickingHero and IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) and GetUnitTypeId(GetTriggerUnit())!='H0B8' and GetUnitTypeId(GetTriggerUnit())!='H00M' and GetUnitTypeId(GetTriggerUnit())!='H07G' and GetUnitTypeId(GetTriggerUnit())!='H00Y' and IsUnitIllusion(GetTriggerUnit()) == false and HaveSavedBoolean(HY, GetHandleId(GetTriggerUnit()), 38) == false then
		//if (GetUnitTypeId(GetTriggerUnit())!='O00P') then
			// 注册英雄单位受伤
//			call MGO(GetTriggerUnit())
		//endif
//	endif
//	return false
//endfunction


function N2A takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local unit u =(LoadUnitHandle(HY,(GetHandleId(t)), 221))
	local integer h = GetHandleId(u)
	local integer i = 1
	local integer k = 10
	if h == 0 then
		call FlushChildHashtable(HY, LoadInteger(HY, GetHandleId(t), 0))
		call DestroyTrigger(t)
		return
	endif
	loop
	exitwhen i > k
		call SaveReal(HY, h,(7300 +(i -1)),(((LoadReal(HY, h,(7300 +(i)))))* 1.))
		call SaveReal(HY, h,(7350 +(i -1)),(((LoadReal(HY, h,(7350 +(i)))))* 1.))
		call SaveReal(HY, h,(7200 +(i -1)),(((LoadReal(HY, h,(7200 +(i)))))* 1.))
		call SaveReal(HY, h,(7250 +(i -1)),(((LoadReal(HY, h,(7250 +(i)))))* 1.))
		set i = i + 1
	endloop
	call SaveReal(HY, h,(7300 + 10),((GetUnitX(u))* 1.))
	call SaveReal(HY, h,(7350 + 10),((GetUnitY(u))* 1.))
	call SaveReal(HY, h,(7200 + 10),((GetWidgetLife(u))* 1.))
	call SaveReal(HY, h,(7250 + 10),((GetUnitState(u, UNIT_STATE_MANA))* 1.))
	set t = null
	set u = null
endfunction

// 单位的视野马甲
function ZPI takes nothing returns boolean
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit ZQI = LoadUnitHandle(HY, h, 304)
	local unit dummyUnit = LoadUnitHandle(HY, h, 305)
	if GetTriggerEvalCount(GetTriggeringTrigger()) == 1 then
		call UnitAddAbility(dummyUnit,'Aloc')
	endif
	if ZQI == null or not UnitAlive(ZQI) or O6X() or GetUnitAbilityLevel(ZQI,'DRKN')+ GetUnitAbilityLevel(ZQI,'DRKU') == 0 then
		call ShowUnit(dummyUnit, false)
		call SetUnitX(dummyUnit, GetUnitX(ZQI))
		call SetUnitY(dummyUnit, GetUnitY(ZQI))
		call UnitRemoveAbility(ZQI,'A1VA')
	else
		call ShowUnit(dummyUnit, true)
		call UnitRemoveAbility(dummyUnit, 'Aloc')
		call UnitAddAbility(dummyUnit, 'Aloc')
		call SetUnitX(dummyUnit, GetUnitX(ZQI))
		call SetUnitY(dummyUnit, GetUnitY(ZQI))
		call UnitAddPermanentAbility(ZQI,'A1VA')
	endif
	if GetOwningPlayer(dummyUnit)!= GetOwningPlayer(ZQI) then
		call SetUnitOwner(dummyUnit, GetOwningPlayer(ZQI), true)
	endif
	set ZQI = null
	set dummyUnit = null
	return false
endfunction

// 视野马甲和状态记录
function RegisterHeroVisionAndState takes unit u returns nothing
	local trigger t = CreateTrigger()
	local unit d = null
	local integer h
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddAction(t, function N2A)
	call SaveUnitHandle(HY, GetHandleId(t), 221, u)
	call SaveInteger(HY, GetHandleId(t), 0, GetHandleId(u))
	// 创建视野马甲
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function ZPI))
	call SaveUnitHandle(HY, h, 304, u)
	set d = CreateUnit(GetOwningPlayer(u),'o01A', GetUnitX(u), GetUnitY(u), 0)
	call SaveUnitHandle(HY, h, 305, d)
	call SaveUnitHandle(OtherHashTable, GetHandleId(u),'DUMM', d)
	// debug call SingleDebug("给" + GetUnitName( u ) + YDWEId2S(GetUnitTypeId( u )) + " 注册视野和坐标记录触发器。")
	set d = null
	set t = null
endfunction

// 土猫的四个技能
// AddEarthSpiritManaStone
function AddEarthSpiritManaStone takes unit whichUnit returns nothing
	local integer iPlayerId = GetPlayerId(GetOwningPlayer(whichUnit))
	local integer loop_Index = 1
	local boolean b = false
	loop
		if PlayerSkillIndex[iPlayerId * HL + loop_Index]>= 441 and PlayerSkillIndex[iPlayerId * HL + loop_Index]<= 444 then
			set b = true
		endif
		set loop_Index = loop_Index + 1
	exitwhen b or loop_Index > 4 + ExtraSkillsNumber
	endloop
	if not LoadBoolean(HY, GetHandleId(whichUnit), StringHash("rolling stones")) and b then
		call UnitAddPermanentAbility(whichUnit,'A2TH')
		call P_R(whichUnit)
		call SaveBoolean(HY, GetHandleId(whichUnit), StringHash("rolling stones"), true)
	endif
endfunction

function RegisterOtherEvent takes unit whichUnit returns nothing
	local integer level
	local trigger trig
	local integer i
	// 给英雄注册学习技能事件
	set trig = CreateTrigger()
	call TriggerRegisterUnitEvent(trig, whichUnit, EVENT_UNIT_HERO_SKILL)
	call TriggerAddCondition(trig, Condition(function W5E))
	// 给英雄注册变身事件
	set trig = CreateTrigger()
	//call TriggerRegisterUnitEvent(trig, u, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterUnitEvent(trig, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(trig, Condition(function RVX))
	call SaveUnitHandle(HY, GetHandleId(trig), 0, whichUnit)
	set i = 1
	loop
		set level = GetUnitAbilityLevel(whichUnit, PassiveSkills_Learned[i])
		if level == 0 and PassiveSkills_SpellBook[i]> 0 then
			call UnitRemoveAbility(whichUnit, PassiveSkills_SpellBook[i])
			call UnitRemoveAbility(whichUnit, PassiveSkills_Buff[i])
		endif
		set i = i + 1
	exitwhen i > PassiveAbilityMaxCount
	endloop
	set trig = null
endfunction

function ZKI takes nothing returns nothing
	call ExecuteFunc("RequiemOfSoulsOnDeath")
endfunction

// 英雄死亡的触发器
function RegisterHeroDeathEvent takes unit u returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
	// 击杀
	call TriggerAddCondition(t, Condition(function U7X))

	// 一血
	call TriggerAddCondition(t, Condition(function W8X))
	// 如果是蓝猫 则会有个特效
	if GetUnitTypeId(u)=='H00S' then
		call TriggerAddCondition(t, Condition(function KGA))
	endif
	// 火猫有倒地动作
	if GetUnitTypeId(u)=='N0M0' then
		call TriggerAddCondition(t, Condition(function L_R))
	endif
	// 土猫也有倒地动作
	if GetUnitTypeId(u)=='N0MU' then
		call TriggerAddCondition(t, Condition(function QZR))
	endif
	// 血精石
	call TriggerAddCondition(t, Condition(function R_O))
	// 魂之挽歌
	call TriggerAddCondition(t, Condition(function ZKI))
	// 追踪术 赏金
	call TriggerAddCondition(t, Condition(function GCR))
	set t = null
endfunction

// 0秒后修正路径可通行状态
function U3A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call FixUnitSkillsBug(LoadUnitHandle(HY, h, 0))
	call SetTerrainPathable(LoadReal(HY, h, 0), LoadReal(HY, h, 1), PATHING_TYPE_WALKABILITY, false)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction

function U4A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	call FixUnitSkillsBug(u)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction

function WaitToFixUnitSkills takes unit whichUnit, real timeout returns nothing
	local integer h = TimerStartSingle(timeout, function U4A)
	call SaveUnitHandle(HY, h, 0, whichUnit)
endfunction

// 英雄单位死亡
function HeroReincarnationEvent takes nothing returns boolean
	local unit whichUnit = GetTriggerUnit()
	local integer iHandleId
	local real x
	local real y
	local real duration = .0
	local integer reincarnationLevel = GetUnitAbilityLevel(whichUnit,'A01Y')+ GetUnitAbilityLevel(whichUnit,'A1AZ')
	
	// debug call SingleDebug("英雄单位死亡 包括重生U6A" + GetUnitName( whichUnit ) + YDWEId2S(GetUnitTypeId( whichUnit )) )
	// 清除一些buff
	call GBX(whichUnit)
	// 不朽盾(AIrc) 骷髅王冥魂(A3DK) 重生和A杖(A01Y,A1AZ) 真实视野(A14K)?
	if reincarnationLevel > 0 or GetUnitAbilityLevel(whichUnit,'AIrc') == 1 or GetUnitAbilityLevel(whichUnit,'A3DK')> 0 or GetUnitAbilityLevel(whichUnit,'A46S') == 1 or GetUnitAbilityLevel(whichUnit,'A14K') == 1 then
		if GetUnitAbilityLevel(whichUnit,'AIrc') == 1 then
			set duration = 5.01
		elseif reincarnationLevel > 0 and GetUnitState(whichUnit, UNIT_STATE_MANA) >= 120 + 40 * reincarnationLevel and ( YDWEGetUnitAbilityState(whichUnit, 'A01Y', 1) + YDWEGetUnitAbilityState(whichUnit, 'A1AZ', 1) ) == 0 then
			set duration = 3.01
		// 骷髅王绿魂 秒活
		elseif GetUnitAbilityLevel(whichUnit,'A3DK')> 0 then
			set duration = .01
		endif
		// 等待一段时间后修正单位的技能
		call WaitToFixUnitSkills(whichUnit, duration)
		set x = GetUnitX(whichUnit)
		set y = GetUnitY(whichUnit)
		// 视野马甲修正
		call KPX(whichUnit)
		if IsTerrainPathable(x, y, PATHING_TYPE_WALKABILITY) then
			call Y_X(whichUnit)
		endif
	endif
	set whichUnit = null
	return false
endfunction

function RegisterHeroUnitCommonEvent takes unit whichUnit returns nothing
	if LoadBoolean(ObjectHashTable, GetHandleId(whichUnit), 2) then
		return
	endif
	call TriggerRegisterUnitEvent(UnitEventMainTrig, whichUnit, EVENT_UNIT_HERO_SKILL)
	call TriggerRegisterUnitEvent(UnitEventMainTrig, whichUnit, EVENT_UNIT_SPELL_CAST)
	call TriggerRegisterUnitEvent(UnitEventMainTrig, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterUnitEvent(UnitEventMainTrig, whichUnit, EVENT_UNIT_SPELL_FINISH)
	call TriggerRegisterUnitEvent(UnitEventMainTrig, whichUnit, EVENT_UNIT_SPELL_CHANNEL)
	call TriggerRegisterUnitEvent(UnitEventMainTrig, whichUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterUnitEvent(UnitEventMainTrig, whichUnit, EVENT_UNIT_ISSUED_ORDER)
	call TriggerRegisterUnitEvent(UnitEventMainTrig, whichUnit, EVENT_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterUnitEvent(UnitEventMainTrig, whichUnit, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call SaveBoolean(ObjectHashTable, GetHandleId(whichUnit), 2, true)
endfunction

// 注册英雄单位的事件 等0秒后再检查一次是否有效英雄
function RegisterHeroEventWait0sFilter takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer iHandleId = GetHandleId(trig)
	local unit whichUnit = LoadUnitHandle(HY, iHandleId, 0)
	if whichUnit != null and GetUnitAbilityLevel(whichUnit,'Aloc') == 0 then
		// 伤害事件
		//call TriggerRegisterUnitEvent(AnyUnitDamagedTrig, whichUnit, EVENT_UNIT_DAMAGED)
		// 视野和状态记录
		call RegisterHeroVisionAndState(whichUnit)
		// 土猫的召唤巨石
		call AddEarthSpiritManaStone(whichUnit)

		// 从别的触发器合并来的
		// 修正重生事件的触发器
		call TriggerRegisterDeathEvent(HeroReincarnationTrigger, whichUnit)
		// 大概是减伤事件
		// call ExecuteFunc("T1A") 弃用 移动至任意单位受伤事件
		// 给英雄单位注册常用事件
		call RegisterHeroUnitCommonEvent(whichUnit)

		// debug call SingleDebug("给" + GetUnitName( whichUnit ) + YDWEId2S(GetUnitTypeId( whichUnit )) + " RegisterHeroUnitCommonEvent")
		// debug call SingleDebug("给 " + GetUnitName(whichUnit) + " 英雄注册任意单位受伤事件 以及状态记录和视野" )
		call GroupAddUnit(OV, whichUnit)
		// 英雄阵亡
		call RegisterHeroDeathEvent(whichUnit)

		// 从其他触发器合来的事件
		call RegisterOtherEvent(whichUnit)
		
		// 存单位的原始Id
		call SaveInteger( ExtraHT, GetHandleId(whichUnit), HTKEY_UNIT_ORIGIN_TYPEID, GetUnitTypeId(whichUnit) )
		// 初始化单位的缩放
		// call SaveReal( ExtraHT, GetHandleId(whichUnit), HTKEY_UNIT_CURRENT_PERCENT_SCALE, 1. )
		if IsTriggerEnabled( hChooseHeroTrigger ) then
			call PlayerChooseHeroUnit( whichUnit )
		endif

		if IsUnitAlly(whichUnit, LocalPlayer) then
			call MHUnit_EnableViewSkill(whichUnit, LocalPlayer)
		endif
	endif
	call FlushChildHashtable(HY, iHandleId)
	call CleanCurrentTrigger(trig)
	set whichUnit = null
	set trig = null
	return false
endfunction

// 该单位是否能注册单位事件
function UnitIsCanRegisterUnitEvent takes unit whichUnit returns boolean
	local integer typeId = GetUnitTypeId(whichUnit)
	//  i!='H00M' and i!='H07G' and i!='H00Y' and i!='H00J' and i!='H0B8'
	// 不是巨石(o01X) 不是区域指示器(n00C) 不是酒馆马甲(hfoo) 不是森林之眼 不是预载英雄 不是冰晶爆轰 不是蓝猫马甲 不是中立被动单位
	return typeId != 'o01X' and typeId != 'hfoo' and typeId != 'n00C' and typeId != 'ewsp' and typeId != 'H00Y' and typeId != 'H0B8' and typeId != 'H07G' and GetOwningPlayer(whichUnit)!= Player(15) 
endfunction
// 注册任意单位事件 过滤
function AnyUnitEventRegisterFilter takes nothing returns boolean
	local trigger trig = null
	local unit whichUnit = GetEnteringUnit()
	if GetUnitAbilityLevel(whichUnit,'Aloc') == 0 and UnitIsCanRegisterUnitEvent(whichUnit) then
		// 如果是英雄 等0秒后再检查一次是否有效
		if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
			if not IsPickingHero then
				set trig = CreateTrigger() 
				call TriggerRegisterTimerEvent(trig, 0, false)
				call TriggerAddCondition(trig, Condition(function RegisterHeroEventWait0sFilter))
				call SaveUnitHandle(HY, GetHandleId(trig), 0, whichUnit)
				set trig = null
			endif
		else
			// debug call SingleDebug("给 " + GetUnitName(whichUnit) + " 单位注册任意单位受伤事件" )
			call TriggerRegisterUnitEvent(AnyUnitDamagedTrig, whichUnit, EVENT_UNIT_DAMAGED)
		endif
	endif
	set whichUnit = null
	return false
endfunction
function GVE takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetUnitFacing(GetTriggerUnit()))
	call UnitAddAbility(d,'A3IK')
	call SetUnitAbilityLevel(d,'A3IK', GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
	call IssueTargetOrderById(d, 852662, GetSpellTargetUnit())
	set d = null
endfunction
function T8A takes unit u, integer level returns nothing
	call SetUnitAbilityLevel(u,'A11F', level)
	call SetUnitAbilityLevel(u,'A3BP', level)
	call SetUnitAbilityLevel(u,'A1R5', level)
	call SetUnitAbilityLevel(u,'A11E', level)
	call SetUnitAbilityLevel(u,'A0S3', level)
	call SetUnitAbilityLevel(u,'A11D', level)
	call SetUnitAbilityLevel(u,'A11G', level)
	call SetUnitAbilityLevel(u,'A11H', level)
	call SetUnitAbilityLevel(u,'A0T9', level)
	call SetUnitAbilityLevel(u,'A2TK', level)
	call SetUnitAbilityLevel(u,'A1WE', level)
	call SetUnitAbilityLevel(u,'A0B8', level)
	call SetUnitAbilityLevel(u,'AChx', level)
	call SetUnitAbilityLevel(u,'A0FD', level)
	call SetUnitAbilityLevel(u,'A1T7', level)
	call SetUnitAbilityLevel(u,'A19M', level)
	call SetUnitAbilityLevel(u,'A02O', level)
	call SetUnitAbilityLevel(u,'A08Y', level)
	call SetUnitAbilityLevel(u,'A08Z', level)
	call SetUnitAbilityLevel(u,'A090', level)
	call SetUnitAbilityLevel(u,'A092', level)
	call SetUnitAbilityLevel(u,'A0HB', level)
	call SetUnitAbilityLevel(u,'A0D3', level)
	call SetUnitAbilityLevel(u,'A0DF', level)
	call SetUnitAbilityLevel(u,'A02W', level)
	call SetUnitAbilityLevel(u,'A28D', level)
	call SetUnitAbilityLevel(u,'A2EA', level)
	call SetUnitAbilityLevel(u,'A0CK', level)
	call SetUnitAbilityLevel(u,'A0K7', level)
	call SetUnitAbilityLevel(u,'A1EW', level)
	call SetUnitAbilityLevel(u,'A1MO', level)
	call SetUnitAbilityLevel(u,'A1ZW', level)
	call SetUnitAbilityLevel(u,'A2K7', level)
	call SetUnitAbilityLevel(u,'A017', level)
	call SetUnitAbilityLevel(u,'A1QD', level)
	call SetUnitAbilityLevel(u,'A1FP', level)
	call SetUnitAbilityLevel(u,'AIxk', level)
	call SetUnitAbilityLevel(u,'A0JL', level)
	call SetUnitAbilityLevel(u,'AIpg', level)
	call SetUnitAbilityLevel(u,'A2K4', level)
	call SetUnitAbilityLevel(u,'A231', level)
	call SetUnitAbilityLevel(u,'A28Y', level)
	call SetUnitAbilityLevel(u,'A12W', level)
	call SetUnitAbilityLevel(u,'A1Q8', level)
	call SetUnitAbilityLevel(u,'A0JY', level)
	call SetUnitAbilityLevel(u,'AIbk', level)
	call SetUnitAbilityLevel(u,'A1AC', level)
	call SetUnitAbilityLevel(u,'AItb', level)
	call SetUnitAbilityLevel(u,'A38V', level)
	call SetUnitAbilityLevel(u,'A395', level)
	call SetUnitAbilityLevel(u,'A39C', level)
	call SetUnitAbilityLevel(u,'A3AG', level)
	call SetUnitAbilityLevel(u,'A42I', level)
endfunction
function I8O takes nothing returns nothing
	//	call T8A(U2, 1)
endfunction
function T9A takes integer id returns boolean
	return id =='A04C' or id =='A0A2' or id =='A0MU' or id =='A0I7' or id =='Z604' or id =='A07F' or id =='A0MN' or id =='A0G6' or id =='A08Q' or id =='A1H5' or id =='A0OJ' or id =='A27G' or id =='A1S8' or id =='A010' or id =='A0RX' or id =='A2HN' or id =='A14R' or id =='A049' or id =='A33G' or id =='A26N' or id =='A0R5' or id =='A020' or id =='A0EC' or id =='A04Y' or id =='AChx' or id =='A1T7' or id =='A02O' or id =='A08Y' or id =='A08Z' or id =='A090' or id =='A092' or id =='A094'
endfunction
function UVA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call B0R(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1), LoadInteger(HY, h, 0))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function UEA takes unit d, unit targetUnit, integer S6V returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, 0, false, function UVA)
	call SaveUnitHandle(HY, h, 0, d)
	call SaveUnitHandle(HY, h, 1, targetUnit)
	call SaveInteger(HY, h, 0, S6V)
	set t = null
endfunction
// 莲花的反弹流程
function UXA takes nothing returns nothing
	local unit t = GetSpellTargetUnit()
	local integer id = GetSpellAbilityId()
	local unit whichUnit = GetTriggerUnit()
	local unit u = CreateUnit(GetOwningPlayer(t),'e00E', GetUnitX(t), GetUnitY(t), 0)
	// 获取施法者的命令
	local integer S6V = GetUnitCurrentOrder(whichUnit)
	local integer i
	// 给马甲注册释放技能事件
	call TriggerRegisterUnitEvent(UnitEventMainTrig, u, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterUnitEvent(UnitEventMainTrig, u, EVENT_UNIT_SPELL_CAST)
	call TriggerRegisterUnitEvent(UnitEventMainTrig, u, EVENT_UNIT_SPELL_CHANNEL)
	call TriggerRegisterUnitEvent(UnitEventMainTrig, u, EVENT_UNIT_SPELL_ENDCAST)
	call SaveUnitHandle(HY, GetHandleId(u), 0, t)
	call T4V(t)
	call UnitAddAbility(u, id)
	call SetUnitAbilityLevel(u, id, GetUnitAbilityLevel(whichUnit, id))
	if id =='A04P' then
		call UnitRemoveAbility(u, id)
		set id ='A3E3'
		call UnitAddAbility(u, id)
		call SetUnitAbilityLevel(u, id, GetUnitAbilityLevel(whichUnit,'A04P'))
		set S6V = 852095
	endif
	if LoadBoolean(HY, GetHandleId(whichUnit),'REFL') then
		set whichUnit = LoadUnitHandle(HY, GetHandleId(whichUnit),'REFL')
	endif
	// 如果在使用技能 则读取物品技能表里面的技能
	if S6V >=852008 and S6V <=852013 then
		call UnitRemoveAbility(u, id)
		set i = GetItemTypeId(UnitItemInSlot(whichUnit, S6V -852008))
		set id = LoadInteger(AbilityDataHashTable,'A3E9', i)
		call UnitAddAbility(u, id)
		if LoadBoolean(AbilityDataHashTable,'A3E9', i) then
			set S6V = S2I(LoadStr(AbilityDataHashTable,'A3E9', i))
		else
			set S6V = OrderId(LoadStr(AbilityDataHashTable,'A3E9', i))
		endif
	endif
	if T9A(id) then
		call UEA(u, whichUnit, S6V)
	else
		call B0R(u, whichUnit, S6V)
	endif
	set u = null
	set t = null
	set whichUnit = null
endfunction
function UOA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	call UnitRemoveAbility(GetTriggerUnit(), LoadInteger(HY, GetHandleId(t), 0))
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTrigger(t)
	set t = null
endfunction
function URA takes nothing returns nothing
	local unit UIA = GetSpellTargetUnit()
	local unit whichUnit = GetTriggerUnit()
	local integer id = GetSpellAbilityId()
	local integer level = GetUnitAbilityLevel(whichUnit, id)
	local trigger t
	local integer h
	if GetUnitAbilityLevel(UIA, id) == 0 then
		call UnitAddPermanentAbilitySetLevel(UIA, id, level)
		set HE = true
		if IssueTargetOrderById(UIA, 852487, whichUnit) then
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call TriggerRegisterUnitEvent(t, UIA, EVENT_UNIT_SPELL_ENDCAST)
			call TriggerRegisterUnitEvent(t, UIA, EVENT_UNIT_ISSUED_ORDER)
			call TriggerRegisterUnitEvent(t, UIA, EVENT_UNIT_ISSUED_TARGET_ORDER)
			call TriggerRegisterUnitEvent(t, UIA, EVENT_UNIT_ISSUED_POINT_ORDER)
			call TriggerAddCondition(t, Condition(function UOA))
			call SaveInteger(HY, h, 0, id)
			set t = null
		else
			call UnitRemoveAbility(UIA, id)
		endif
		set HE = false
	endif
	set UIA = null
	set whichUnit = null
endfunction
function UAA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call EXStopUnit(LoadUnitHandle(HY, h, 0))
	call T4V(LoadUnitHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function UNA takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
	call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
	call TimerStart(t, 0, false, function UAA)
	set t = null
endfunction
function IsSpecialAbility takes integer id returns boolean
	return id =='A06B' or id =='A471' or id =='A0LK' or id =='A27H' or id =='A05S' or id =='A08V' or id =='A1MO' or id =='A1ZI' or id =='A0FN' or id =='A0K9' or id =='A06I' or id =='A0O7' or id =='A0O6' or id =='A0O5' or id =='A1B1' or id =='A0N8' or id =='A01F' or id =='A02S' or id =='A085' or id =='QB06' or id =='A078' or id =='A1OV'
endfunction
// abilityIsDrain
function IsDrainAbility takes integer id returns boolean
	return id =='A02N' or id =='A0CC' or id =='A02Z'
endfunction
function UDA takes integer id returns boolean
	return id =='A10R'
endfunction
function UFA takes integer id returns boolean
	return id =='A02Q' or id =='A1D9'
endfunction
// 是枷锁技能
function UGA takes integer id returns boolean
	return id =='A0FL' or id =='A1CX' or id =='A00P' or id =='A02Q' or id =='A1D9'
endfunction
function UHA takes integer id returns boolean
	return id =='A0IN' or id =='A1AW' or id =='A05T' or id =='A08H' or id =='A0BZ' or id =='A004' or id =='A0FW' or id =='A0BH' or id =='A055' or id =='QB00' or id =='A0YM' or id =='A2QT' or id =='A10D' or id =='A0G4' or id =='A1D8' or id =='A190' or id =='A1NH' or id =='A2BE' or id =='A02A' or id =='A1NA' or id =='A0NM' or id =='A2LA' or id =='AHtb' or id =='QB0H' or id =='A0JC' or id =='A3FR' or id =='A0NQ'
endfunction
function UJA takes nothing returns nothing
	local integer k = 0
	loop
	exitwhen HaveSavedString(AbilityDataHashTable,'SPLL', k) == false
		call ExecuteFunc(LoadStr(AbilityDataHashTable,'SPLL', k))
		set k = k + 1
	endloop
endfunction
function UKA takes string s returns nothing
	local integer i = 0
	loop
	exitwhen HaveSavedString(AbilityDataHashTable,'SPLL', i) == false
		if LoadStr(AbilityDataHashTable,'SPLL', i) == s then
			return
		endif
		set i = i + 1
	endloop
	call SaveStr(AbilityDataHashTable,'SPLL', i, s)
endfunction
function ULA takes nothing returns nothing
	call DKI(GetTriggerUnit(), GetSpellAbilityId())
endfunction
function UMA takes nothing returns nothing
	call SHR(GetTriggerUnit(), GetSpellAbilityId())
endfunction
function UPA takes nothing returns nothing
	call G3R(GetTriggerUnit(), GetSpellAbilityId())
endfunction
function UQA takes nothing returns nothing
	call DQA(GetTriggerUnit(), GetSpellAbilityId())
endfunction
function USA takes nothing returns nothing
	if GetUnitAbilityLevel(GetTriggerUnit(),'B0H0')> 0 then
		call QWA(GetTriggerUnit(), GetSpellAbilityId())
	endif
endfunction

// 获取单位的冷却缩减数值
function GetUnitCoolDownReduce takes unit whichUnit, integer id returns real
	// ChakraMagicCoolDownReduce
	local real rReduceCoolDown = 0.
	local real abilityCoolDown = YDWEGetUnitAbilityDataReal(whichUnit, id, GetUnitAbilityLevel(whichUnit, id), ABILITY_DATA_COOL)
	if abilityCoolDown <= 0. then
		return rReduceCoolDown
	endif
	if GetUnitAbilityLevel(whichUnit,'A39S') == 1 then
		set rReduceCoolDown = abilityCoolDown * 0.25
	endif
	if GetUnitAbilityLevel(whichUnit,'B3DU') == 1 then
		// 是物品技能就不减cd
		if not IsNotItemAbility(id) then
			return rReduceCoolDown
		endif
		if GetUnitAbilityLevel(whichUnit,'A3DU') == 1 then
				//	call LFX(whichUnit, id, false, 2)
			set rReduceCoolDown = rReduceCoolDown + 2
			call UnitRemoveAbility(whichUnit,'A3DU')
		elseif GetUnitAbilityLevel(whichUnit,'A3DV') == 1 then
			//	call LFX(whichUnit, id, false, 3)
			set rReduceCoolDown = rReduceCoolDown + 3
			call UnitRemoveAbility(whichUnit,'A3DV')
		elseif GetUnitAbilityLevel(whichUnit,'A3DW') == 1 then
				//	call LFX(whichUnit, id, false, 4)
			set rReduceCoolDown = rReduceCoolDown + 4
			call UnitRemoveAbility(whichUnit,'A3DW')
		elseif GetUnitAbilityLevel(whichUnit,'A3DX') == 1 then
				//	call LFX(whichUnit, id, false, 5)
			set rReduceCoolDown = rReduceCoolDown + 5
			call UnitRemoveAbility(whichUnit,'A3DX')
		endif
		call UnitRemoveAbility(whichUnit,'B3DU')
	endif
	return rReduceCoolDown
endfunction

// 释放技能事件
function UTA takes unit whichUnit, integer id returns nothing
	local integer lv = GetUnitAbilityLevel(whichUnit, id)
	local unit targetUnit = GetSpellTargetUnit()
	local real rReduceCoolDown = GetUnitCoolDownReduce(whichUnit, id) // 获取缩减的冷却
	if rReduceCoolDown > 0 and YDWEGetUnitAbilityState(whichUnit, id, 1) == 0.00 then // 必须是技能施法时才减 中途触发的不减 过滤变身技能
		call Japi_ReduceUnitAbilityCoolDown(whichUnit, id, rReduceCoolDown) // 缩减冷却
	endif
	// 技能施法目标 不等于没有 并且是技能目标的敌对玩家 有莲花 而且施法者不是蝗虫
	// 莲花的判断
	if targetUnit!= null and IsUnitEnemy(whichUnit, GetOwningPlayer(targetUnit)) and GetUnitAbilityLevel(targetUnit,'A3E9') == 1 and(GetUnitAbilityLevel(whichUnit,'Aloc') == 0 or LoadBoolean(HY, GetHandleId(whichUnit),'REFL')) then
		// 技能不等于攻击特效 不等于汲取技能(生命魔法) 不等于吞噬技能 不是特殊技能 不是莲花技能 还有一些奇怪的技能不能被反弹
		if not IsAttackSpecialEffects(id) and not UDA(id) and not IsSpecialAbility(id) and not HE and not UHA(id) then
			if IsDrainAbility(id) then
				call URA()
			else
				// 不是枷锁技能
				if not UGA(id) then
					call UXA()
				// 不是恶魔的掌握
				elseif not UFA(id) then
					call UNA()
				endif
			endif
		endif
	endif
	// 遍历释放技能事件 ExecuteFunc(func) 感觉效率有点低
	call UJA()

	if X2R(id) then
		call X3R(whichUnit, id)
	endif
	if IsAttackSpecialEffects(id) then
		call TZA(whichUnit, targetUnit, true)
	endif
	call SXX()
	set targetUnit = null
endfunction
function UUA takes unit u, integer S6V, eventid id returns nothing
	if id == EVENT_UNIT_ISSUED_ORDER then
		if GetUnitAbilityLevel(u,'A0QN')> 0 then
			if S6V == 852255 or S6V == 852458 then
				call SaveBoolean(ObjectHashTable, GetHandleId(u),'A0QN', true)
				call UnitAddPermanentAbility(u,'A40H')
			elseif S6V == 852256 or S6V == 852459 then
				call SaveBoolean(ObjectHashTable, GetHandleId(u),'A0QN', false)
				call UnitRemoveAbility(u,'A40H')
			endif
		endif
		if S6V ==852129 and(C5X(u) or RCX(u)) then
			if GetUnitAbilityLevel(u,'A0NS')> 0 or GetUnitAbilityLevel(u,'A1DA')> 0 then
				if YDWEGetUnitAbilityState(u, 'A0NS', 1) == 0. and YDWEGetUnitAbilityState(u, 'A1DA', 1) == 0. then
					call UnitSpellEffect__BorrowedTime(u, GetHandleId(u))
				//else
				//	call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "技能尚未就绪。")
				endif
			endif
		endif
	endif
	if id == EVENT_UNIT_ISSUED_TARGET_ORDER then
		if GetUnitAbilityLevel(u,'A0QN')> 0 then
			if S6V ==852225 then
				call EXStopUnit(u)
				set EI = true
				call IssueTargetOrderById(u, 851985, GetOrderTargetUnit())
				set EI = false
				call UnitAddPermanentAbility(u,'A40H')
				call SaveBoolean(ObjectHashTable, GetHandleId(u),'A0QN'+ 1, true)
				call SaveUnitHandle(ObjectHashTable, GetHandleId(u),'A0QN'+ 1, GetOrderTargetUnit())
			endif
		endif
	endif
	call DSA(u, S6V)
	call QRA(u)
endfunction

function UWA takes unit u, unit t returns nothing	//单位被攻击
	if CGA(u, t) then
		return
	endif
	call TZA(u, t, false)

	// 泉水
	if (GetUnitTypeId(t)=='ndfl' or GetUnitTypeId(t)=='nfoh') and IsUnitType(u, UNIT_TYPE_HERO) then
		call DisplayTextToPlayer(GetOwningPlayer(u), 0, 0, "你这是在自寻死路")
	endif
	if GetUnitTypeId(u)=='ndfl' or GetUnitTypeId(u)=='nfoh' then 
		call UnitAddAbilityToTimed(t,'A39D', 1, 5.,'B39D')
		call CIO(t, 5.)	
		call UnitDamageTargetEx(u, t, 6, 1000)
	endif
endfunction
function UYA takes nothing returns nothing
	local integer i = GetUnitAbilityLevel(SV,'A3B8')
	local real x = GetUnitX(SV)
	local real y = GetUnitY(SV)
	local player p = Player(LoadInteger(HY, GetHandleId(SV),'A3B8'))
	local unit u
	if p == Player(0) then
		return
	endif
	if i == 0 then
		set i = GetUnitAbilityLevel(Player__Hero[LoadInteger(HY, GetHandleId(SV),'A3B8')],'A0BH')
	endif
	if i == 0 then
		set i = 4
	endif
	loop
		set u = CreateUnit(p,'n019', x, y, 0)
		call UnitApplyTimedLife(u,'BTLF', 60)
		set i = i -1
	exitwhen i == 0
	endloop
endfunction
function UZA takes nothing returns nothing
	if LoadInteger(HY, GetHandleId(SV),'A3B8')> 0 then
		call UYA()
	endif
endfunction

function U0A takes nothing returns boolean
	return GetUnitAbilityLevel(GetFilterUnit(),'B3JF')> 0 and IsUnitAlly(GetFilterUnit(), E3) and IsAliveNotStrucNotWard(GetFilterUnit()) and GetFilterUnit()!= Roshan
endfunction

function DragonHideAura__Actions takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group AIR = LoadGroupHandle(HY, h, 1)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit u2
	local group g
	local group gg
	local integer AAR
	local integer ANR
	if not UnitAlive(u) or u == null then
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
		loop
			set u2 = FirstOfGroup(AIR)
		exitwhen u2 == null
			call GroupRemoveUnit(AIR, u2)
			call UnitReduceStateBonus(u2, 2, UNIT_BONUS_ARMOR)
		endloop
		call DeallocateGroup(AIR)
	else
		set g = AllocationGroup(492)
		set E3 = GetOwningPlayer(u)
		call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 925, Condition(function U0A))
		set gg = AllocationGroup(493)
		call GroupAddGroup(AIR, gg)
		loop
			set u2 = FirstOfGroup(gg)
		exitwhen u2 == null
			if IsUnitInGroup(u2, g) == false then
				call GroupRemoveUnit(AIR, u2)
				call UnitReduceStateBonus(u2, 2, UNIT_BONUS_ARMOR)
			endif
			call GroupRemoveUnit(gg, u2)
		endloop
		call DeallocateGroup(gg)
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			if IsUnitInGroup(u2, AIR) == false then
				call UnitAddStateBonus(u2, 2, UNIT_BONUS_ARMOR)
			endif
			call GroupRemoveUnit(g, u2)
			call GroupAddUnit(AIR, u2)
		endloop
		call DeallocateGroup(g)
	endif
	set t = null
	set AIR = null
	set u = null
	set g = null
	set gg = null
endfunction

// 龙隐光环
function UnitAddDragonHideAura takes unit u returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .5, true, function DragonHideAura__Actions)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveGroupHandle(HY, h, 1, AllocationGroup(494))
	set t = null
endfunction

// 任意单位进入地图2
function U8A takes nothing returns boolean
	local unit    whichUnit   = GetEnteringUnit()
	local player  whichPlayer = GetOwningPlayer(whichUnit)
	local integer typeId      = GetUnitTypeId(whichUnit)
	local boolean isHero      = IsUnitType(whichUnit, UNIT_TYPE_HERO)
	local integer level       = 0
	if isHero then
		set whichUnit = null
		set whichPlayer = null
		return false
	endif
	if not Mode__SixSkills then
		call UnitRemoveAbility(whichUnit, 'A3J6')
	endif
	// 召唤食尸鬼(可能是小狗大)
	if typeId =='u00G' then
		call AXR(whichUnit)
	// 召唤树人(应该是先知的)
	elseif typeId =='efon' or typeId =='efo2' then
		call UXR(whichUnit)
	// 召唤小蜘蛛
	elseif typeId =='n01E' or typeId =='n019' then
		call H0I(whichUnit)
	// 召唤小狼
	elseif typeId =='o005' or typeId =='o006' or typeId =='o007' or typeId =='o00F' then
		call U3I(whichUnit)
	// 召唤蛇棒
	elseif typeId =='osp4' or typeId =='o008' or typeId =='o009' or typeId =='o01C' or typeId =='o01D' or typeId =='o01E'then
		call C8A(whichUnit)
	// 召唤守望者(宇宙兽人)
	elseif typeId =='ushd' then
		call PDA(whichUnit)
	// 召唤甲虫(宇宙兽人)
	elseif typeId =='u012' then
		call PBA(whichUnit)
	// 真假眼
	elseif typeId =='o004' or typeId =='oeye' then
		call R2O(whichUnit, whichUnit)
		// 真眼额外设置视野
		if typeId =='oeye' then
			call A8X(whichPlayer, 12, GetUnitX(whichUnit), GetUnitY(whichUnit), 150)
		endif
	elseif typeId =='n020' then
		// 活死人
		set level = GetUnitAbilityLevel(Player__Hero[GetPlayerId(whichPlayer)],'A0A8')
		// 活死人协同升级
		if level > 0 then
			call UnitAddPermanentAbilitySetLevel(whichUnit,'A3J8', level)
			call UnitAddPermanentAbilitySetLevel(whichUnit,'A3J9', level)
		endif
		// Japi设置最大生命值 节省一下效率
		call UnitAddMaxLife(whichUnit, R2I(GetUnitState(Player__Hero[GetPlayerId(whichPlayer)], UNIT_STATE_MAX_LIFE)*(.2 + .05 * level)))
		// call UnitAddMaxLife(u, R2I(GetUnitState(Player__Hero[GetPlayerId(whichPlayer)], UNIT_STATE_MAX_LIFE)*(.2 + .05 * i)))
	endif
	// 野怪进入
	if whichPlayer == NeutralCreepPlayer or whichPlayer == SentinelPlayers[0] or whichPlayer == ScourgePlayers[0] then
		// 待优化 都是二进制属性系统增加的属性
		// 如果有宝石傀儡光环
		if GetUnitAbilityLevel(whichUnit,'A44G')> 0 then
			call UnitAddGraniteAura(whichUnit)
		endif
		// 龙隐光环
		if GetUnitAbilityLevel(whichUnit,'A3JF')> 0 then
			call UnitAddDragonHideAura(whichUnit)
		endif
	endif
	// 如果是有效英雄 并且不处于选择英雄阶段 还不是风暴双雄
	//if isHero and not IsPickingHero and(bIsDummyHero == false) and LoadBoolean(HY, GetHandleId(whichUnit), QR) == false then
		// 可能是给英雄单位再注册一下死亡和受伤事件
		// 全部移动至AnyUnitEventRegisterFilter
	//endif
	if not isHero or IsPickingHero then
		if not IsUnitIllusion(whichUnit) then
			set whichUnit = null
			// 如果不是镜像 并且不是有效英雄还处于选择英雄阶段 那就直接返回
			return false
		endif
	endif
	if IsUnitIllusion(whichUnit) then
		// 自动选择召唤物
		// set hTmpTrigUnit = Player__Hero[GetPlayerId(p)]
		call W1E(whichUnit)
	endif
	set whichUnit = null
	return false
endfunction
function NYR takes nothing returns nothing
	local trigger t = CreateTrigger()
	call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	//call TriggerAddCondition(t, Condition(function AVR))
	call TriggerAddCondition(t, Condition(function U8A))
	set t = CreateTrigger()
	// 幻象被召唤
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function SummonedIllusionUnitEvnet))
	// 初始化被动技能表
	call ExecuteFunc("InitPassiveSkills")
	set t = null
endfunction
function WEA takes string s returns nothing
	local integer i = 0
	loop
	exitwhen HaveSavedString(AbilityDataHashTable,'DEAD', i) == false
		if LoadStr(AbilityDataHashTable,'DEAD', i) == s then
			return
		endif
		set i = i + 1
	endloop
	call SaveStr(AbilityDataHashTable,'DEAD', i, s)
endfunction
function WXA takes nothing returns nothing
endfunction
function OnDeath_Rot_SuicideWrapper takes nothing returns nothing
	call WEA("WXA")
endfunction
function WOA takes nothing returns nothing
endfunction
function OnDeath_BH_TrackKillWrapper takes nothing returns nothing
	call WEA("WOA")
endfunction
function WRA takes nothing returns nothing
	call OSI(TV, SV)
endfunction
function WIA takes nothing returns nothing
	call WEA("WRA")
endfunction
function WAA takes nothing returns nothing
	call QWR(SV)
endfunction
function WNA takes nothing returns nothing
	call WEA("WAA")
endfunction
function WBA takes nothing returns nothing
	if IsUnitType(SV, UNIT_TYPE_HERO) and GetUnitAbilityLevel(SV,'ACac')> 0 and XFX(GetOwningPlayer(TV)) and IsUnitEnemy(TV, GetOwningPlayer(SV)) then
		if IsUnitType(TV, UNIT_TYPE_HERO) then
			call BPI(GetUnitAbilityLevel(SV,'ACac'), TV, SV)
		else
			if UnitIsDead(Player__Hero[GetPlayerId(GetOwningPlayer(TV))]) == false then
				call BPI(GetUnitAbilityLevel(SV,'ACac'), Player__Hero[GetPlayerId(GetOwningPlayer(TV))], SV)
			endif
		endif
	endif
endfunction
function WCA takes nothing returns nothing
	call WEA("WBA")
endfunction
function WDA takes nothing returns nothing
	call AJI(SV)
endfunction
function WFA takes nothing returns nothing
	call WEA("WDA")
endfunction
function WGA takes nothing returns nothing
	call PIA(SV)
endfunction
function WHA takes nothing returns nothing
	call WEA("WGA")
endfunction
function WJA takes nothing returns nothing
	call B4I(SV)
endfunction
function WKA takes nothing returns nothing
	call WEA("WJA")
endfunction
function OnDeath_CourierDeath takes nothing returns nothing
	call ZRX(SV)
endfunction
function WLA takes nothing returns nothing
	call III(TV, SV)
	call R9I(SV)
endfunction
function WMA takes nothing returns nothing
	call WEA("WLA")
endfunction
function WPA takes nothing returns nothing
	call UZA()
endfunction
function WQA takes nothing returns nothing
	call WEA("WPA")
endfunction
function WSA takes nothing returns nothing
	call WEA("UNR")
endfunction
function WTA takes nothing returns nothing
	call FJR(TV, SV)
endfunction
function WUA takes nothing returns nothing
	call WEA("WTA")
endfunction
function WWA takes nothing returns nothing
	call G1I(TV, SV)
endfunction
function WYA takes nothing returns nothing
	call WEA("WWA")
endfunction
function WZA takes nothing returns nothing
	call Y4I(TV, SV)
endfunction
function W_A takes nothing returns nothing
	call WEA("WZA")
endfunction
function W0A takes nothing returns nothing
	call ZCI(TV, SV)
endfunction
function W1A takes nothing returns nothing
	call WEA("W0A")
endfunction
function W2A takes nothing returns nothing
	local integer k = 0
	loop
	exitwhen HaveSavedString(AbilityDataHashTable,'DEAD', k) == false
		call ExecuteFunc(LoadStr(AbilityDataHashTable,'DEAD', k))
		set k = k + 1
	endloop
endfunction
function W3A takes unit killingUnit, unit triggerUnit returns nothing
	call FlushUnitData(triggerUnit)
	if LoadBoolean(SightDataHashTable, GetUnitTypeId(triggerUnit), 0) or IsUnitIllusion(triggerUnit) then
		return
	endif
	set SV = triggerUnit
	set TV = killingUnit
	if IsUnitType(triggerUnit, UNIT_TYPE_HERO) and LoadBoolean(HY, GetHandleId(triggerUnit), QR) == false then
	else
		call SWX(killingUnit, triggerUnit)
		call ZRX(triggerUnit)
		call I6O(killingUnit, triggerUnit)
		call Q6A(killingUnit, triggerUnit)
	endif
	call W2A()
endfunction
function W4A takes unit u, unit t, real d returns nothing
	if d > 0 then
		call D6I(t, d)
	endif
endfunction
function W5A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local unit whichUnit = LoadUnitHandle(HY, GetHandleId(t), 0)
	local unit u = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	local integer id ='QFZX'
	call UnitRemoveAbility(whichUnit,'Broa')
	if Mode__BalanceOff == false and((GetUnitAbilityLevel(whichUnit,'A0CG')> 0 and IsUnitType(whichUnit, UNIT_TYPE_MELEE_ATTACKER)) or GetUnitAbilityLevel(whichUnit,'A1IQ')> 0 or GetUnitAbilityLevel(whichUnit,'A13T')> 0 or GetUnitAbilityLevel(whichUnit,'A1YQ')> 0 or GetUnitAbilityLevel(whichUnit,'A3DE')> 0 or GetUnitAbilityLevel(whichUnit,'A2H0')> 0 or GetUnitAbilityLevel(whichUnit,'QB0L')> 0 or GetUnitAbilityLevel(whichUnit,'A0KX')> 0) then
		set id ='QFZY'
	endif
	call UnitAddAbility(u, id)
	call SetUnitAbilityLevel(u, id, GetUnitAbilityLevel(whichUnit,'A0DL'))
	call IssueImmediateOrderById(u, 852164)
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTrigger(t)
	set t = null
	set u = null
	set whichUnit = null
	return false
endfunction
function ZIV takes nothing returns nothing
	local unit whichUnit
	local trigger t
	set whichUnit = GetTriggerUnit()
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerAddCondition(t, Condition(function W5A))
	call SaveUnitHandle(HY, GetHandleId(t), 0, whichUnit)
	set t = null
	set whichUnit = null
endfunction
function W6A takes unit u returns nothing
	if GetUnitAbilityLevel(u,'Aetl')> 0 or GetUnitAbilityLevel(u,'B017')> 0 then
		call EXStopUnit(u)
	endif
endfunction

// 应该是多用于英雄的
function W7A takes nothing returns boolean
	local unit u = null
	local integer i = GetSpellAbilityId()
	local integer l
	local eventid id = GetTriggerEventId()
	if i != 0 then
		if id == EVENT_UNIT_SPELL_EFFECT then
			// 发动技能效果
			//	if IsSpellingMorph() == false then
			if G then
				call BJDebugMsg(GetUnitName(u)+ " has used " + GetObjectName(i)+ " [" + UGV(i)+ "]")
			endif
			call UTA(GetTriggerUnit(), i)
			// 0 == OnSpellEffect 
			if HaveSavedString(ObjectHashTable, i, 0) then
				call ExecuteFunc(LoadStr(ObjectHashTable, i, 0))
			endif
			//	endif
		elseif id == EVENT_UNIT_SPELL_ENDCAST then
			// 停止施法
			if HaveSavedString(ObjectHashTable, i, 1) then
				call ExecuteFunc(LoadStr(ObjectHashTable, i, 1))
			endif
		elseif id == EVENT_UNIT_SPELL_FINISH then
			// 结束施法
			if HaveSavedString(ObjectHashTable, i, 2) then
				call ExecuteFunc(LoadStr(ObjectHashTable, i, 2))
			endif
		elseif id == EVENT_UNIT_SPELL_CAST then
			// 开始施法
			if IsAttackSpecialEffects(i) then
				call W6A(GetTriggerUnit())
				call I7A(GetTriggerUnit(), GetSpellTargetUnit())
				call RSA(GetTriggerUnit(), GetSpellTargetUnit())
			endif
			if HaveSavedString(ObjectHashTable, i, 3) then
				call ExecuteFunc(LoadStr(ObjectHashTable, i, 3))
			endif
		elseif id == EVENT_UNIT_SPELL_CHANNEL then
			// 准备施法
			if HaveSavedString(ObjectHashTable, i, 7) then
				call ExecuteFunc(LoadStr(ObjectHashTable, i, 7))
			endif
		endif
	endif
	if id == EVENT_UNIT_HERO_SKILL then
		// 学技能
		set u = GetTriggerUnit()
		set i = GetLearnedSkill()
		set l = GetLearnedSkillLevel()
		call W1V(u, i, l)
		if HaveSavedString(ObjectHashTable, i, 5) then
			call ExecuteFunc(LoadStr(ObjectHashTable, i, 5))
		endif
		if l == 1 then
			// 学习 1 级技能
			if HaveSavedString(ObjectHashTable, i, 4) then
				call ExecuteFunc(LoadStr(ObjectHashTable, i, 4))
			endif
		endif
		set u = null

	elseif id == EVENT_PLAYER_UNIT_ATTACKED then
		// 单位被攻击
		call UWA(GetAttacker(), GetTriggerUnit())
	elseif id == EVENT_UNIT_ISSUED_ORDER or id == EVENT_UNIT_ISSUED_POINT_ORDER or id == EVENT_UNIT_ISSUED_TARGET_ORDER then
		// 发布无目标 指定点目标 指定单位目标
		call UUA(GetTriggerUnit(), GetIssuedOrderId(), id)
	elseif id == EVENT_PLAYER_UNIT_DEATH then
		// 单位死亡
		call W3A(GetKillingUnit(), GetTriggerUnit())
	elseif id == EVENT_UNIT_SUMMON then
		// 单位被召唤
		set u = GetSummoningUnit()
		if HaveSavedString(ObjectHashTable, LoadInteger(ObjectHashTable, GetHandleId(u),'SPEL'), 9) then
			call ExecuteFunc(LoadStr(ObjectHashTable, LoadInteger(ObjectHashTable, GetHandleId(u),'SPEL'), 9))
		endif
		set u = null
	elseif id == EVENT_UNIT_DAMAGED then
		// 单位被伤害
		call W4A(GetEventDamageSource(), GetTriggerUnit(), GetEventDamage())
	endif
	set u = null
	set id = null
	return false
endfunction

function W9A takes integer LQO, integer r, integer g, integer b, integer a, real x, real y, integer h returns nothing
	local string s = I2S(LQO)
	local integer i1
	local integer i2
	local integer i3
	if LQO > 99 then
		set Q3V[1]= true
		set Q3V[2]= true
		set Q3V[3]= true
		call TXV("Fonts\\" + SubString(s, 0, 1)+ ".blp", 61, 61, x -50, y, 0, true)
		call SaveImageHandle(HY, h, 1520, R3)
		call SetImageColor(R3, r, g, b, a)
		call TXV("Fonts\\" + SubString(s, 1, 2)+ ".blp", 61, 61, x -20, y, 0, true)
		call SaveImageHandle(HY, h, 1521, R3)
		call SetImageColor(R3, r, g, b, a)
		call TXV("Fonts\\" + SubString(s, 2, 3)+ ".blp", 61, 61, x + 20, y, 0, true)
		call SaveImageHandle(HY, h, 1522, R3)
		call SetImageColor(R3, r, g, b, a)
	elseif LQO > 9 then
		set Q3V[2]= true
		set Q3V[3]= true
		call TXV("Fonts\\" + SubString(s, 0, 1)+ ".blp", 61, 61, x -33, y, 0, true)
		call SaveImageHandle(HY, h, 1521, R3)
		call SetImageColor(R3, r, g, b, a)
		call TXV("Fonts\\" + SubString(s, 1, 2)+ ".blp", 61, 61, x -3, y, 0, true)
		call SaveImageHandle(HY, h, 1522, R3)
		call SetImageColor(R3, r, g, b, a)
	else
		set Q3V[2]= true
		set Q3V[3]= true
		call PlaySoundBJ(AN)
		call TXV("Fonts\\0.blp", 61, 61, x -33, y, 0, true)
		call SaveImageHandle(HY, h, 1521, R3)
		call SetImageColor(R3, r, g, b, a)
		call TXV("Fonts\\" + s + ".blp", 61, 61, x -3, y, 0, true)
		call SaveImageHandle(HY, h, 1522, R3)
		call SetImageColor(R3, r, g, b, a)
	endif
endfunction
function YVA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer i = R2I(TimerGetRemaining(NK))
	local image im
	local integer k = 1
	loop
		set TQ[k]= GetGameTime()
		set k = k + 1
	exitwhen k > 11
	endloop
	if Q3V[1] then
		set im = LoadImageHandle(HY, h, 1520)
		call DestroyImage(im)
		set Q3V[1]= false
	endif
	if Q3V[2] then
		set im = LoadImageHandle(HY, h, 1521)
		call DestroyImage(im)
		set Q3V[2]= false
	endif
	if Q3V[3] then
		set im = LoadImageHandle(HY, h, 1522)
		call DestroyImage(im)
		set Q3V[3]= false
	endif
	if i == 0 or GP then
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	else
		if (GKV or HOV) and(Mode__Draft30 or Mode__Draft40 or Mode__Draft50) then
			call W9A(i, 255, 2, 2, 255,-6454, 6945, h)
		else
			call W9A(i, 255, 2, 2, 255,-6970, 6726, h)
		endif
	endif
	set t = null
endfunction
function X1R takes nothing returns nothing
	local real x
	local real y
	set Q4V = CreateTrigger()
	set AN = CreateSound("Sound\\Interface\\BattleNetTick.wav", false, false, false, 10, 10, "")
	call SetSoundParamsFromLabel(AN, "ChatroomTimerTick")
	call SetSoundDuration(AN, 476)
	call TriggerRegisterTimerEvent(Q4V, 1, true)
	call TriggerAddCondition(Q4V, Condition(function YVA))
	call TriggerEvaluate(Q4V)
	if GKV or HOV then
		set HR = CreateUnit(Player(15),'h302',-7200, 7300, 270)
		set JR = CreateUnit(Player(15),'h302',-7400, 7300, 270)
		set KR = CreateUnit(Player(15),'h303',-6600, 7300, 270)
		set LR = CreateUnit(Player(15),'h303',-6800, 7300, 270)
		set IR = CreateUnit(Player(15),'h306',-6995, 7300, 270)
	else
		set HR = CreateUnit(Player(15),'h302',-7070, 6936, 270)
		set JR = CreateUnit(Player(15),'h302',-7070, 6616, 270)
		set KR = CreateUnit(Player(15),'h303',-6920, 6616, 270)
		set LR = CreateUnit(Player(15),'h303',-6920, 6936, 270)
		set IR = CreateUnit(Player(15),'h306',-6995, 7200, 270)
	endif
endfunction
function YEA takes nothing returns boolean
	local integer i = 1
	local integer k = 0
	local item it = null
	local boolean f = false
	local integer h = GetHandleId(GetTriggeringTrigger())
	local real time = GetGameTime()
	loop
		if UnitAlive(Player__Hero[i]) and TimerGetRemaining(PS[i])<= 0 and time -LoadReal(HY, h, GetHandleId(Player__Hero[i]))> 2 then
			call SaveReal(HY, h, GetHandleId(Player__Hero[i]), time)
			set k = 0
			loop
			exitwhen k > 5
				set it = UnitItemInSlot(Player__Hero[i], k)
				if it != null then
					if GetItemIndexEx(it)==-1 then
						call UnitRemoveItem(Player__Hero[i], it)
					else
						call XKO(Player__Hero[i], it)
					endif
				endif
				set k = k + 1
			endloop
		endif
		set i = i + 1
		if i == 6 then
			set i = 7
		endif
	exitwhen i > 12
	endloop
	set it = null
	return false
endfunction


function YNA takes nothing returns nothing
	local unit KKX
	local unit dummyUnit
	local integer i = 1
	local integer level = 0
	local boolean b = Mode__FiveSkills or Mode__SixSkills
	if IsPickingHero then
		set KKX = null
		set dummyUnit = null
		return
	endif
	loop
		set KKX = Player__Hero[i]
		set dummyUnit = VB[i]
		set level = GetUnitAbilityLevel(KKX,'A086')
		if level == 0 and b then
			if HeroCommonSkills[PlayerSkillIndex[i * HL + 5]]=='P247' then
				set level = IP[i * 2 + 1]
			endif
		endif
		if level > 0 then
			if O6X() or GetUnitAbilityLevel(KKX,'A36D') == 1 then
				if GetUnitAbilityLevel(dummyUnit,'A330')!= 0 then
					call UnitRemoveAbility(dummyUnit,'A330')
				endif
				if M2[GetPlayerId(GetOwningPlayer(KKX))]== false then
					if GetUnitAbilityLevel(KKX,'P247')> 0 and GetUnitAbilityLevel(KKX,'P247')!= 5 then
						call SetUnitAbilityLevel(KKX,'P247', 5)
					endif
					if GetUnitAbilityLevel(KKX,'A116')> 0 then
						call UnitRemoveAbility(KKX,'A116')
						call UnitRemoveAbility(KKX,'A117')
					endif
				endif
			else
				if GetUnitAbilityLevel(dummyUnit,'A330')!= level then
					call UnitAddPermanentAbility(dummyUnit,'A330')
					call SetUnitAbilityLevel(dummyUnit,'A330', level)
				endif
				if M2[GetPlayerId(GetOwningPlayer(KKX))]== false then
					if GetUnitAbilityLevel(KKX,'P247')!= level then
						call SetUnitAbilityLevel(KKX,'P247', level)
					endif
					if GetUnitAbilityLevel(KKX,'A116') == 0 then
						call UnitAddPermanentAbility(KKX,'A116')
						call UnitAddPermanentAbility(KKX,'A117')
					endif
				endif
			endif
		elseif GetUnitAbilityLevel(dummyUnit,'A330')> 0 then
			call UnitRemoveAbility(dummyUnit,'A330')
		endif
		if UnitIsDead(KKX) == false and M2[GetPlayerId(GetOwningPlayer(KKX))]== false and(GetUnitAbilityLevel(KKX,'A08E')> 0 or HeroCommonSkills[PlayerSkillIndex[GetPlayerId(GetOwningPlayer(KKX))* HL + 5]]=='A08Q') then
			if O6X() == false then
				if GetUnitAbilityLevel(KKX,'A08E')> 0 then
					call sckj(KKX, true)
				else
					call sckj(KKX, true)
				endif
			else
				call sckj(KKX, false)
			endif
		endif
		set i = i + 1
		if i == 6 then
			set i = 7
		endif
	exitwhen i > 11
	endloop
	set KKX = null
	set dummyUnit = null
endfunction
function MFX takes nothing returns nothing
	local timer t = CreateTimer()
	local integer i = 1
	loop
		set VB[i]= CreateUnit(Player(i),'e00C', 0, 0, 0)
		call UnitAddPermanentAbility(VB[i],'Aloc')
		set i = i + 1
		if i == 6 then
			set i = 7
		endif
	exitwhen i > 11
	endloop
	call TimerStart(t, 1, true, function YNA)
	set t = null
endfunction
function YBA takes nothing returns nothing
	local unit t = GetEnumUnit()
	if LoadInteger(HY, GetHandleId(t), 4341)!= 1 then
		call EPX(t, 4341, .99)
		call UnitDamageTargetEx(SQX(H), t, 1, 50)
	endif
	call UnitAddAbilityToTimed(t,'A3Q1', 1, 1.,'B3DJ')
	set t = null
endfunction
function YCA takes nothing returns boolean //辉耀，此物品本身自带龙卷风破坏光环'A04I'，看情况可删除。
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 14)
	local group g = null
	if GetTriggerEventId() == EVENT_UNIT_DROP_ITEM then
		if GetManipulatedItem() == LoadItemHandle(HY, h , 96) then
			call FlushChildHashtable(HY,(h))
			call CleanCurrentTrigger(t)
		endif
	else
		if u == null then
			call FlushChildHashtable(HY,(h))
			call CleanCurrentTrigger(t)
		endif
		if UnitAlive(u) then
			set g = AllocationGroup(495)
			set U2 = u
			call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 725, Condition(function DPX))
			set H = u
			call EnableAttackEffectByTime(N, 2.)
			//set bj_makeUnitRescuableUnit = CreateUnit(GetOwningPlayer(u),'e00E', 0, 0, 0)
			//call UnitAddAbility(bj_makeUnitRescuableUnit,'A3DJ')
			call ForGroup(g, function YBA)
			//call UnitRemoveAbility(bj_makeUnitRescuableUnit,'A3DJ')
			call DeallocateGroup(g)
			set g = null
		endif
	endif
	set t = null
	set u = null
	return false
endfunction
// 获得辉耀
function PickRadianceItem takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DROP_ITEM)
	call TriggerAddCondition(t, Condition(function YCA))
	call SaveUnitHandle(HY, h, 14, u)
	call SaveItemHandle(HY, h, 96, GetManipulatedItem() )
	set t = null
endfunction
function YFA takes nothing returns boolean
	return IsUnitAlly(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit())
endfunction
function YGA takes nothing returns nothing
	call UnitRemoveAbility(GetEnumUnit(),'A393')
	call UnitRemoveAbility(GetEnumUnit(),'A394')
	call UnitRemoveAbility(GetEnumUnit(),'A3E2')
endfunction
function YHA takes nothing returns nothing
	if GetUnitAbilityLevel(GetEnumUnit(),'A393') == 0 then
		call UnitAddPermanentAbility(GetEnumUnit(),'A393')
		call UnitAddPermanentAbility(GetEnumUnit(),'A394')
	endif
	if IsHeroUnitId(GetUnitTypeId(GetEnumUnit())) then
		if GetWidgetLife(GetEnumUnit())/ GetUnitState(GetEnumUnit(), UNIT_STATE_MAX_LIFE)<= .2 then
			call SetUnitAbilityLevel(GetEnumUnit(),'A393', 2)
			call UnitAddPermanentAbility(GetEnumUnit(),'A3E2')
		elseif GetUnitAbilityLevel(GetEnumUnit(),'A393') == 2 then
			call SetUnitAbilityLevel(GetEnumUnit(),'A393', 1)
			call UnitRemoveAbility(GetEnumUnit(),'A3E2')
		endif
	endif
endfunction
function YJA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY,(h), 2))
	local group g =(LoadGroupHandle(HY,(h), 340))
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local group gg
	if u == null or(GetTriggerEventId() == EVENT_UNIT_DROP_ITEM and GetManipulatedItem() == LoadItemHandle(HY,(h), 96)) then
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
		call ForGroup(g, function YGA)
		call DeallocateGroup(g)
		set t = null
		return false
	endif
	set gg = AllocationGroup(496)
	set U2 = u
	if UnitAlive(u) then
		set U2 = u
		call GroupEnumUnitsInRange(gg, x, y, 925, Condition(function YFA))
	endif
	call GroupRemoveGroup(gg, g)
	call ForGroup(g, function YGA)
	if UnitAlive(u) then
		call ForGroup(gg, function YHA)
	endif
	call SaveGroupHandle(HY,(h), 340,(gg))
	call DeallocateGroup(g)
	set t = null
	set u = null
	set g = null
	set gg = null
	return false
endfunction
// 获得 卫士胫甲
function PickGuardianGreavesItem takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .3, true)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DROP_ITEM)
	call TriggerAddCondition(t, Condition(function YJA))
	call SaveItemHandle(HY,(h), 96,(GetManipulatedItem()))
	call SaveUnitHandle(HY,(h), 2,(u))
	call SaveGroupHandle(HY,(h), 340,(AllocationGroup(497)))
	set t = null
endfunction
function YLA takes nothing returns boolean
	return IsUnitAlly(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit())
endfunction
function YMA takes nothing returns nothing
	call BSR(GetEnumUnit(),'A3AX')
endfunction
function YPA takes nothing returns nothing
	if GetUnitAbilityLevel(GetEnumUnit(),'A3AX') == 0 then
		call UnitAddPermanentAbility(GetEnumUnit(),'A3AX')
	endif
endfunction
function YQA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY,(h), 2))
	local group g =(LoadGroupHandle(HY,(h), 340))
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local group gg
	if u == null or(GetTriggerEventId() == EVENT_UNIT_DROP_ITEM and GetManipulatedItem() == LoadItemHandle(HY,(h), 96)) then
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
		call ForGroup(g, function YMA)
		call DeallocateGroup(g)
		set t = null
		return false
	endif
	set gg = AllocationGroup(498)
	set U2 = u
	if UnitAlive(u) then
		set U2 = u
		call GroupEnumUnitsInRange(gg, x, y, 925, Condition(function YLA))
	endif
	call GroupRemoveGroup(gg, g)
	call ForGroup(g, function YMA)
	if UnitAlive(u) then
		call ForGroup(gg, function YPA)
	endif
	call SaveGroupHandle(HY,(h), 340,(gg))
	call DeallocateGroup(g)
	set t = null
	set u = null
	set g = null
	set gg = null
	return false
endfunction
// 获得 卡德加的洞察烟斗
function PickPipeItem takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .3, true)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DROP_ITEM)
	call TriggerAddCondition(t, Condition(function YQA))
	call SaveItemHandle(HY,(h), 96,(GetManipulatedItem()))
	call SaveUnitHandle(HY,(h), 2,(u))
	call SaveGroupHandle(HY,(h), 340,(AllocationGroup(499)))
	set t = null
endfunction
// 获取物品和单位被召唤
function YTA takes nothing returns boolean
	if GetTriggerEventId() == EVENT_PLAYER_UNIT_PICKUP_ITEM then
		if GetItemType(GetManipulatedItem()) == ITEM_TYPE_PERMANENT then
			if GetItemIndex(GetManipulatedItem()) == AZV then
				call PickRadianceItem(GetTriggerUnit())
			elseif GetItemIndex(GetManipulatedItem()) == RTV then
				// 卫士胫甲
				call PickGuardianGreavesItem(GetTriggerUnit())
			elseif GetItemIndex(GetManipulatedItem()) == NPV then
				call SetAllPlayerAbilityUnavailable('A3AX')
				call PickPipeItem(GetTriggerUnit())
			endif
		endif
	elseif UnitInventorySize(GetSummonedUnit())> 0 and GetItemOfTypeFromUnit(GetSummonedUnit(), XOV[AZV])!= null then
		// 幻象获得辉耀
		call PickRadianceItem(GetSummonedUnit())
	endif
	return false
endfunction
function YUA takes unit u, item it, integer JOX returns nothing
	local integer YWA = 1
	local integer YYA = 0
	local integer i = 0
	local item YZA
	local integer SQV = GetItemIndexEx(it)
	local player p
	loop
		if UnitItemInSlot(u, i) == null then
			set YWA = YWA + 1
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	if SQV == it_hyzr or SQV == IEV or SQV == Item_MoonShard or SQV == N1V or SQV == IRV or SQV == IIV or SQV == NZV or SQV == I_V or SQV == I0V or SQV == ROV or SQV == I5V or SQV == RUV or SQV == RWV or SQV == N2V or SQV == RQV or SQV == RJV or SQV == I1V then
		set YYA = 2
	elseif SQV == it_mlq or SQV == NGV or SQV == IBV or SQV == ICV or SQV == IDV or SQV == NHV or SQV == NEV or SQV == ANV or SQV == ABV or SQV == NKV or SQV == A8V or SQV == A9V or SQV == NQV or SQV == NSV or SQV == RNV or SQV == RCV or SQV == ISV or SQV == A5V or SQV == AWV then
		set YYA = 3
	elseif SQV == NNV or SQV == I7V or SQV == RGV then
		set YYA = 4
	endif
	if YWA >= YYA then
		call DisableTrigger(CUV)
		set p = GetItemPlayer(it)
		call RemoveItem(it)
		if SQV == IEV then
			call TDE(u, XOV[OFV], p, false, 1)
			call TDE(u, XOV[OWV], p, false, 1)
		elseif SQV == IRV or SQV == IIV then
			call TDE(u, XOV[OGV], p, false, 1)
			call TDE(u, XOV[OMV], p, false, 1)
		elseif SQV == it_hyzr then //回音战刃
			call TDE(u, XOV[IHV], p, false, 1)
			call TDE(u, XOV[OAV], p, false, 1)
		elseif SQV == it_mlq then //魔龙枪
			//call Item_dragonlance(true)
			if ( GetItemOfTypeFromUnit(u, XOV[it_mlq]) == null ) and ( GetItemOfTypeFromUnit(u, XOV[Item_HurricanePike]) == null ) then
				call MCBZZ(GetOwningPlayer(u), 0, u)
			endif
			call TDE(u, XOV[OAV], p, false, 1)
			call TDE(u, XOV[XQV], p, false, 1)
			call TDE(u, XOV[XQV], p, false, 1)
		elseif SQV == NGV or SQV == NHV then
			call TDE(u, XOV[OBV], p, false, 1)
			call TDE(u, XOV[OIV], p, false, 1)
			call TDE(u, XOV[B_V], p, false, 1)
		elseif SQV == NEV then
			call TDE(u, XOV[X7V], p, false, 1)
			call TDE(u, XOV[ITV], p, false, 1)
			call TDE(u, XOV[B3V], p, false, 1)
		elseif SQV == NZV then
			call TDE(u, XOV[XMV], p, false, 1)
			call TDE(u, XOV[X2V], p, false, 1)
		elseif SQV == A5V then //蝴蝶
			call TDE(u, XOV[X1V], p, false, 1)
			call TDE(u, XOV[RXV], p, false, 1)
			call TDE(u, XOV[ODV], p, false, 1)
		elseif SQV == AWV then //金箍棒
			call TDE(u, XOV[X0V], p, false, 1)
			call TDE(u, XOV[OYV], p, false, 1)
			call TDE(u, XOV[OYV], p, false, 1)
		elseif SQV == ISV then //刃甲
			call TDE(u, XOV[XYV], p, false, 1)
			call TDE(u, XOV[OJV], p, false, 1)
			call TDE(u, XOV[XZV], p, false, 1)
		elseif SQV == RCV then //阿托斯之棍
			call TDE(u, XOV[OUV], p, false, 1)
			call TDE(u, XOV[OPV], p, false, 1)
			call TDE(u, XOV[OPV], p, false, 1)
		elseif SQV == RNV then //绿鞋
			call TDE(u, XOV[OGV], p, false, 1)
			call TDE(u, XOV[XMV], p, false, 1)
			call TDE(u, XOV[OHV], p, false, 1)
		elseif SQV == I_V or SQV == I0V then
			call TDE(u, XOV[X6V], p, false, 1)
			call TDE(u, XOV[OXV], p, false, 1)
		elseif SQV == ANV or SQV == ABV then //分身斧
			call TDE(u, XOV[IMV], p, false, 1)
			call TDE(u, XOV[OTV], p, false, 1)
			call TDE(u, XOV[BGV], p, false, 1)
		elseif SQV == NQV or SQV == NSV then
			call TDE(u, XOV[OQV], p, false, 1)
			call TDE(u, XOV[OLV], p, false, 1)
			call TDE(u, XOV[OLV], p, false, 1)
		elseif SQV == ROV then
			call TDE(u, XOV[X1V], p, false, 1)
			call TDE(u, XOV[NTV], p, false, 1)
		elseif SQV == I5V then
			call TDE(u, XOV[IPV], p, false, 1)
			call TDE(u, XOV[IMV], p, false, 1)
		elseif SQV == RUV or SQV == RWV then
			call TDE(u, XOV[IKV], p, false, 1)
			call TDE(u, XOV[IRV], p, false, 1)
		elseif SQV == N2V then
			call TDE(u, XOV[IQV], p, false, 1)
			call TDE(u, XOV[OKV], p, false, 1)
		elseif SQV == RGV then
			call TDE(u, XOV[IEV], p, false, 1)
			call TDE(u, XOV[XZV], p, false, 1)
			call TDE(u, XOV[XZV], p, false, 1)
			call TDE(u, XOV[RHV], p, false, 1)
		elseif SQV == RQV then
			call TDE(u, XOV[ONV], p, false, 1)
			call TDE(u, XOV[XGV], p, false, 1)
		elseif SQV == RJV then
			call TDE(u, XOV[RXV], p, false, 1)
			call TDE(u, XOV[N_V], p, false, 1)
		elseif SQV == N1V then
			call TDE(u, XOV[RXV], p, false, 1)
			call TDE(u, XOV[IPV], p, false, 1)
		elseif SQV == Item_MoonShard then
			call TDE(u, XOV[X7V], p, false, 1)
			call TDE(u, XOV[X7V], p, false, 1)
		elseif SQV == I1V then
			call TDE(u, XOV[ODV], p, false, 1)
			call TDE(u, XOV[OXV], p, false, 1)
		elseif SQV == NKV then
			call TDE(u, XOV[XWV], p, false, 1)
			call TDE(u, XOV[XWV], p, false, 1)
			call TDE(u, XOV[XMV], p, false, 1)
		elseif SQV == A8V or SQV == A9V then
			call TDE(u, XOV[OUV], p, false, 1)
			call TDE(u, XOV[OFV], p, false, 1)
			call TDE(u, XOV[OSV], p, false, 1)
		elseif SQV == I7V then
			call TDE(u, XOV[IEV], p, false, 1)
			call TDE(u, XOV[XYV], p, false, 1)
			call TDE(u, XOV[X_V], p, false, 1)
			call TDE(u, XOV[REV], p, false, 1)
		elseif SQV == NNV then
			call TDE(u, XOV[OHV], p, false, 1)
			call TDE(u, XOV[OHV], p, false, 1)
			call TDE(u, XOV[OFV], p, false, 1)
			call TDE(u, XOV[ONV], p, false, 1)
		elseif SQV == IBV or SQV == IDV or SQV == ICV then
			call TDE(u, XOV[XMV], p, false, 1)
			call TDE(u, XOV[XPV], p, false, 1)
			if SQV == IBV then
				call TDE(u, XOV[XQV], p, false, 1)
			elseif SQV == ICV then
				call TDE(u, XOV[XTV], p, false, 1)
			else
				call TDE(u, XOV[OJV], p, false, 1)
			endif
		endif
		call EnableTrigger(CUV)
	else
		call InterfaceErrorForPlayer(GetOwningPlayer(u), "没有足够的空间，拆分装备需要至少 " + I2S(YYA)+ " 个格子.")
	endif
	set YZA = null
endfunction
function Bke takes item it returns boolean
	local integer id = GetItemIndexEx(it)
	if id == it_hyzr or id == it_mlq or id == IEV or id == IBV or id == ICV or id == IDV or id == Item_MoonShard or id == IRV or id == IIV or id == NGV or id == NHV or id == NEV or id == NZV or id == N1V or id == I_V or id == I0V or id == ANV or id == ABV or id == ROV or id == I5V or id == RUV or id == RWV or id == N2V or id == RGV or id == RQV or id == RJV or id == NKV or id == I1V or id == I7V or id == A8V or id == A9V or id == NNV or id == NQV or id == NSV or id == RNV or id == RCV or id == ISV or id == A5V or id == AWV then
		return true
	endif
	return false
endfunction
function BMe takes nothing returns nothing
	local trigger trg = GetTriggeringTrigger()
	local integer key = GetHandleId(trg)
	local unit u = LoadUnitHandle(HY, key, 0)
	call RemoveSavedHandle( ExtraHT, GetHandleId(u), HTKEY_UNIT_SPLIT_ITEM0_5 + LoadInteger(HY, key, 0) )
	call FlushChildHashtable(HY, key)
	call CleanCurrentTrigger(trg)
	set u = null
	set trg = null
endfunction
// 右键双击物品
function RightDoubleClickItemAction takes unit u, item it, integer Ez returns nothing
	local trigger trg = null
	local integer key
	if not Bke(it) then
		return
	endif
	if HaveSavedHandle( ExtraHT, GetHandleId(u), HTKEY_UNIT_SPLIT_ITEM0_5 + Ez ) then
		set trg = LoadTriggerHandle(ExtraHT, GetHandleId(u), HTKEY_UNIT_SPLIT_ITEM0_5 + Ez)
		set key = GetHandleId(trg)
		if Ez == LoadInteger(HY, key, 0) and it == LoadItemHandle(HY, key, 1) then
			call FlushChildHashtable(HY, key)
			call CleanCurrentTrigger(trg)
			call RemoveSavedHandle(ExtraHT, GetHandleId(u), HTKEY_UNIT_SPLIT_ITEM0_5 + Ez)
			call YUA(u , it , Ez)
		endif
	else
		set trg = CreateTrigger()
		set key = GetHandleId(trg)
		call SaveUnitHandle(HY, key, 0, u)
		call SaveItemHandle(HY, key, 1, it)
		call SaveInteger(HY, key, 0, Ez)
		call SaveTriggerHandle(ExtraHT, GetHandleId(u), HTKEY_UNIT_SPLIT_ITEM0_5 + Ez,  trg)
		call TriggerRegisterTimerEvent(trg, 1, false)
		call TriggerAddCondition(trg, Condition(function BMe))
	endif
	set trg = null
endfunction
function RightDoubleClickItemCondition takes nothing returns nothing
	local integer id = GetIssuedOrderId()
	if id >= 852002 and id <= 852007 then
		if GetOrderTargetItem() == UnitItemInSlot(GetTriggerUnit(), id -852002) then
			call RightDoubleClickItemAction(GetTriggerUnit(), GetOrderTargetItem(), id -852002)
		endif
	endif
endfunction
function CreateRightDoubleClickItemTrigger takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterUserUnitEvent(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
	call TriggerAddCondition(t, Condition(function RightDoubleClickItemCondition))
	set t = null
endfunction
function Y1A takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	if GetUnitTypeId(u)!='hfoo' and GetUnitAbilityLevel(u,'Aloc') == 0 then
		if CoordinateX50(x)!= x then
			call SetUnitX(u, CoordinateX50(x))
		endif
		if CoordinateY50(y)!= y then
			call SetUnitY(u, CoordinateY50(y))
		endif
	endif
	set u = null
endfunction
function Y2A takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	if GetUnitAbilityLevel(u,'Aloc') == 0 and GetOwningPlayer(u)!= Player(15) then
		call SetUnitPosition(u, x, y)
	endif
	set u = null
endfunction
// 似乎是某种和谐机制 为了让蝗虫可以被选取?
function Y3A takes nothing returns nothing
	local trigger t = CreateTrigger()
	set BX = CreateRegion()
	set CX = CreateRegion()
	call RegionAddRect(BX, Rect(-6424,-7473,-7500,-7885))
	call RegionAddRect(CX, Rect(5744, 6860, 7502, 7240))
	call RegionAddRect(CX, Rect(7300, 5400, 7502, 6800))
	call TriggerRegisterEnterRegion(t, BX, null)
	call TriggerRegisterEnterRegion(t, CX, null)
	call TriggerAddCondition(t, Condition(function Y2A))
	set t = null
endfunction
function Y4A takes nothing returns nothing
	call SetDestructableOccluderHeight(GetEnumDestructable(), 9999)
endfunction
function Y5A takes nothing returns boolean
	return IsTreeDestructable(GetFilterDestructable()) == false
endfunction

function Y6A takes integer i, integer h returns nothing
	local player p = Player(i)
	local integer k = i * 100 
	local unit u = CreateUnit(p, LoadInteger(HY, h, k + 80), LoadReal(HY, h, k), LoadReal(HY, h, k + 1), 90)
	local item it = null
	if LoadInteger(HY, h, k + 1) != 0 then
		set it = CreateItem(LoadInteger(HY, h, k + 1), 0, 0)
		call SetItemPlayer(it, LoadPlayerHandle(HY, h, k + 1), true)
		call UnitAddItem(u, it)
		if LoadInteger(HY, h, k + 11)> 0 then
			call SetItemCharges(it, LoadInteger(HY, h, k + 11))
		endif
	endif
	if LoadInteger(HY, h, k + 2) != 0 then
		set it = CreateItem(LoadInteger(HY, h, k + 2), 0, 0)
		call SetItemPlayer(it, LoadPlayerHandle(HY, h, k + 2), true)
		call UnitAddItem(u, it)
		if LoadInteger(HY, h, k + 12)> 0 then
			call SetItemCharges(it, LoadInteger(HY, h, k + 12))
		endif
	endif
	if LoadInteger(HY, h, k + 3) != 0 then
		set it = CreateItem(LoadInteger(HY, h, k + 3), 0, 0)
		call SetItemPlayer(it, LoadPlayerHandle(HY, h, k + 3), true)
		call UnitAddItem(u, it)
		if LoadInteger(HY, h, k + 13)> 0 then
			call SetItemCharges(it, LoadInteger(HY, h, k + 13))
		endif
	endif
	if LoadInteger(HY, h, k + 4) != 0 then
		set it = CreateItem(LoadInteger(HY, h, k + 4), 0, 0)
		call SetItemPlayer(it, LoadPlayerHandle(HY, h, k + 4), true)
		call UnitAddItem(u, it)
		if LoadInteger(HY, h, k + 14)> 0 then
			call SetItemCharges(it, LoadInteger(HY, h, k + 14))
		endif
	endif
	if LoadInteger(HY, h, k + 5) != 0 then
		set it = CreateItem(LoadInteger(HY, h, k + 5), 0, 0)
		call SetItemPlayer(it, LoadPlayerHandle(HY, h, k + 5), true)
		call UnitAddItem(u, it)
		if LoadInteger(HY, h, k + 15)> 0 then
			call SetItemCharges(it, LoadInteger(HY, h, k + 15))
		endif
	endif
	if LoadInteger(HY, h, k + 6) != 0 then
		set it = CreateItem(LoadInteger(HY, h, k + 6), 0, 0)
		call SetItemPlayer(it, LoadPlayerHandle(HY, h, k + 6), true)
		call UnitAddItem(u, it)
		if LoadInteger(HY, h, k + 16)> 0 then
			call SetItemCharges(it, LoadInteger(HY, h, k + 16))
		endif
	endif
	set IP[GetPlayerId(p)* 2 + 1]= 0
	set IP[GetPlayerId(p)* 2 + 2]= 0
	call SetHeroLevelAndXP(u, LoadInteger(HY, h, k + 30), false, 0)
	call DisplayTimedTextToPlayer(p, 0, 0, 60, "|c00ff0000  你的英雄因为某错误已重置,输入-removeiteminslot 数字来删除额外的物品 |c00ff0000可能会帮助你.|r")
	set u = null
	set it = null
endfunction
function Y7A takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u
	local item it
	local integer i = 1
	local integer k
	local boolean Y8A = false
	loop
		if IN[i]and IsOfflinePlayer(Player(i)) == false then
			set Y8A = false
			set u = Player__Hero[i]
			if u == null or GetUnitTypeId(u)< 1 or GetHandleId(u)< 1 then
				set Y8A = true
			endif
			set k = i * 100
			if Y8A == false then
				call SaveBoolean(HY, h, k, true)
				call SaveInteger(HY, h, k + 80, GetUnitTypeId(u))
				set it = UnitItemInSlot(u, 0)
				call SaveInteger(HY, h, k + 1, GetItemTypeId(it))
				call SavePlayerHandle(HY, h, k + 1, GetItemPlayer(it))
				call SaveInteger(HY, h, k + 11, GetItemCharges(it))
				set it = UnitItemInSlot(u, 1)
				call SaveInteger(HY, h, k + 2, GetItemTypeId(it))
				call SavePlayerHandle(HY, h, k + 2, GetItemPlayer(it))
				call SaveInteger(HY, h, k + 12, GetItemCharges(it))
				set it = UnitItemInSlot(u, 2)
				call SaveInteger(HY, h, k + 3, GetItemTypeId(it))
				call SavePlayerHandle(HY, h, k + 3, GetItemPlayer(it))
				call SaveInteger(HY, h, k + 13, GetItemCharges(it))
				set it = UnitItemInSlot(u, 3)
				call SaveInteger(HY, h, k + 4, GetItemTypeId(it))
				call SavePlayerHandle(HY, h, k + 4, GetItemPlayer(it))
				call SaveInteger(HY, h, k + 14, GetItemCharges(it))
				set it = UnitItemInSlot(u, 4)
				call SaveInteger(HY, h, k + 5, GetItemTypeId(it))
				call SavePlayerHandle(HY, h, k + 5, GetItemPlayer(it))
				call SaveInteger(HY, h, k + 15, GetItemCharges(it))
				set it = UnitItemInSlot(u, 5)
				call SaveInteger(HY, h, k + 6, GetItemTypeId(it))
				call SavePlayerHandle(HY, h, k + 6, GetItemPlayer(it))
				call SaveInteger(HY, h, k + 16, GetItemCharges(it))
				call SaveReal(HY, h, k, GetUnitX(u))
				call SaveReal(HY, h, k + 1, GetUnitY(u))
				call SaveInteger(HY, h, k + 30, GetHeroLevel(u))
			endif
			if Y8A and LoadBoolean(HY, h, k) then
				call Y6A(i, h)
			endif
		endif
		set i = i + 1
		if i == 6 then
			set i = 7
		endif
	exitwhen i > 11
	endloop
	set u = null
	set it = null
	set t = null
endfunction
function Y9A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetUnitX(u)!= LoadReal(HY, h, 0) or GetUnitY(u)!= LoadReal(HY, h, 1) or UnitIsDead(u) then
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
		call UnitRemoveAbility(u,'A40E')
	else
		call UnitRemoveAbility(u,'A40E')
		call UnitAddPermanentAbility(u,'A40E')
	endif
	set u = null
	set t = null
endfunction
function ZVA takes unit u returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .2, true, function Y9A)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call UnitAddPermanentAbility(u,'A40E')
	call SaveReal(HY, GetHandleId(t), 0, GetUnitX(u))
	call SaveReal(HY, GetHandleId(t), 1, GetUnitY(u))
	set t = null
endfunction
function ZEA takes unit u, item it returns nothing
	if GetOrderPointX() == GetItemX(it) and GetOrderPointY() == GetItemY(it) then
		if IsSentinelPlayer(GetOwningPlayer(u)) then
			if RectContainsUnit(WA, u) then
				call EXStopUnit(u)
				call InterfaceErrorForPlayer(GetOwningPlayer(u), GetObjectName('TX0Y'))
			endif
		else
			if RectContainsUnit(YA, u) then
				call EXStopUnit(u)
				call InterfaceErrorForPlayer(GetOwningPlayer(u), GetObjectName('TX0Y'))
			endif
		endif
	endif
endfunction
function UnitIssuedItemOrder takes nothing returns nothing // 发布物品命令
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetOrderTargetUnit()
	local item it = UnitItemInSlot(whichUnit, GetIssuedOrderId() - 852008)
	local integer id = GetItemIndexEx(it)
	local integer i
	local boolean b
	local player trigPlayer = GetTriggerPlayer()
	if targetUnit == null then
		// 不指向单位的操作
		if id == R4V or id == IAV or id == INV then // tp
			call ZEA(whichUnit, it)
		elseif id == OVV or id == AQV or id == RBV or id == A1V then // 禁止使用破碎的物品?
			if GetUnitTypeId(whichUnit) !='e00E'then 
				call EXStopUnit(whichUnit)
			endif
		endif
	else	// 指向单位
		if id == R0V or id == R1V then
			call SetUnitAbilityLevel(whichUnit,'Aeat', 1)
			call SetUnitAbilityLevel(whichUnit,'A2VG', 1)
			// 如果吃了 真眼或者假眼 技能提升为2级 双倍恢复效果
			if GetUnitTypeId(targetUnit)=='oeye' or GetUnitTypeId(targetUnit)=='o004' then
				if IsUnitEnemy(targetUnit, trigPlayer) then
					call SetUnitAbilityLevel(whichUnit,'Aeat', 2)
					call SetUnitAbilityLevel(whichUnit,'A2VG', 2)
				else
					call EXStopUnit(whichUnit)
					call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX0Z'))
				endif
			else
				if IsUnitEnemy(targetUnit, trigPlayer) then
					call EXStopUnit(whichUnit)
					call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX10'))
				elseif not (IsUnitType(targetUnit, UNIT_TYPE_HERO) or IsBearUnit(targetUnit)) then
					call EXStopUnit(whichUnit)
					call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX11'))
				else
					set i = 0
					set b = false
					loop
						if UnitItemInSlot(targetUnit, i) == null then
							set b = true
							exitwhen true
						endif
						set i = i + 1
					exitwhen i > 5
					endloop
					if not b then
						call EXStopUnit(whichUnit)
						call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX12'))
					endif
				endif
			endif
		elseif id == RVV or id == REV or id == I7V then
			// 拆地雷 真假眼时 射程提高
			if (GetUnitTypeId(targetUnit)=='oeye' or GetUnitTypeId(targetUnit)=='o004' or RMX(targetUnit)) then
				call SetUnitAbilityLevel(whichUnit,'A1FD', 2)
			else
				call SetUnitAbilityLevel(whichUnit,'A1FD', 1)
			endif
		elseif id == Item_EulScepterOfDivinity then
			// 吹风 不能对魔免敌对单位使用
			if IsUnitEnemy(targetUnit, trigPlayer) and IsUnitMagicImmune(targetUnit) then
				call EXStopUnit(whichUnit)
				call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX13'))
			endif
		elseif id == NMV or id == Item_HurricanePike then
			// 推推 不能对肉山和敌对魔免单位使用
			call SetUnitAbilityLevel(whichUnit,'A3U8', 1)
			if GetOwningPlayer(targetUnit)!= trigPlayer then
				if targetUnit == Roshan then
					call EXStopUnit(whichUnit)
					call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX14'))
				elseif IsUnitAlly(whichUnit, GetOwningPlayer(targetUnit)) and LoadBoolean(HY, GetHandleId(GetOwningPlayer(targetUnit)), 139) then
					call EXStopUnit(whichUnit)
					call InterfaceErrorForPlayer(trigPlayer, GetObjectName('n038'))
				elseif IsUnitEnemy(whichUnit, GetOwningPlayer(targetUnit)) then
					if IsUnitMagicImmune(targetUnit) then
						call EXStopUnit(whichUnit)
						call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX13'))
					elseif id == Item_HurricanePike then
						call SetUnitAbilityLevel(whichUnit,'A3U8', 2)
					endif
				endif
			endif
			if R4X(targetUnit) or IsBeetleUnitTypeId(GetUnitTypeId(targetUnit)) then // 不能对守卫单位使用
				if not R3X(GetUnitTypeId(targetUnit)) then // 但可以对追踪导弹使用?
					call EXStopUnit(whichUnit)
					call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX15'))
				endif
			endif
		elseif id == NUV then
			// 骨灰 不能对魔免敌对单位使用
			if IsUnitEnemy(targetUnit, trigPlayer) and IsUnitMagicImmune(targetUnit) then
				call EXStopUnit(whichUnit)
				call InterfaceErrorForPlayer(trigPlayer, GetObjectName('n0LR'))
			endif
		elseif id == IFV then
			// 迈达斯之手
			if IsNecronomiconUnit(targetUnit) then // 不能对死灵书单位使用
				call EXStopUnit(whichUnit)
				call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX19'))
			endif
		elseif id == APV then
			// 林肯法球 不能作用于幻象
			if IsUnitIllusion(targetUnit) then
				call EXStopUnit(whichUnit)
				call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX0V'))
			endif
		elseif id == Item_MoonShard then
			if IsUnitIllusion(targetUnit) or not ( IsUnitType(targetUnit, UNIT_TYPE_HERO) or IsBearUnit( targetUnit ) ) then
				call InterfaceErrorForPlayer( trigPlayer, "不能给目标使用银月之晶")
				call EXStopUnit(whichUnit)
			elseif GetUnitAbilityLevel(targetUnit,'A398') == 1 then
				call InterfaceErrorForPlayer( trigPlayer, "该单位已经有银月之晶了")
				call EXStopUnit(whichUnit)
			endif
		endif

	endif

 	// 放置真假眼
	if id == R2V or id == R3V then
		if targetUnit != null then
			// 如果目标是英雄 或者不是熊灵
			if (IsUnitType(targetUnit, UNIT_TYPE_HERO) or not IsBearUnit(targetUnit)) then
				call EXStopUnit(whichUnit)
				call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX16'))
			else
				set i = 0
				set b = false
				loop
					if UnitItemInSlot(targetUnit, i) == null then
						set b = true
					exitwhen true
					endif
					set i = i + 1
				exitwhen i > 5
				endloop
				if b == false then // 格子满了
					call EXStopUnit(whichUnit)
					call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX12'))
				endif
			endif
		else
			if IsTerrainPathable(GetOrderPointX(), GetOrderPointY(), PATHING_TYPE_WALKABILITY) then
				call EXStopUnit(whichUnit)
				call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX17'))
			elseif RectContainsCoords(WA, GetOrderPointX(), GetOrderPointY()) or RectContainsCoords(YA, GetOrderPointX(), GetOrderPointY()) then
				call EXStopUnit(whichUnit)
				call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX18'))
			elseif IsPointInRegion(FLV, GetOrderPointX(), GetOrderPointY()) then
				call EXStopUnit(whichUnit)
				call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX17'))
			endif
		endif
	endif

	set trigPlayer = null
	set targetUnit = null
	set whichUnit = null
	set it = null
endfunction
function ZOA takes nothing returns nothing
	local unit u
	local integer h
	local integer id
	// 必须是玩家单位
	if not XFX(GetTriggerPlayer()) or IsUnitIllusion(GetTriggerUnit()) then
		return
	endif
	set id = GetIssuedOrderId()
	set u = GetTriggerUnit()
	// 发布物品命令
	if id >=852008 and id <=852013 then
		call UnitIssuedItemOrder()
	elseif id == 852583 then // 末日不能对 非熊灵的远古单位使用
		if GetUnitAbilityLevel(u,'A0A2')> 0 or GetUnitAbilityLevel(u,'A0MU')> 0 then
			call U8I()
		endif
	endif
	set h = GetHandleId(u)
	if id == 851993 then
		if LoadBoolean(HY, h,'ACQR') == false then
			if LoadInteger(HY, h,'ACQR')!= 1 then
				call EPX(u,'ACQR', .2)
			else
				call EPX(u,'ACQR', 0)
				call ZVA(u)
				if IsScourgePlayer(GetOwningPlayer(u)) then
					call SetPlayerAlliance(GetOwningPlayer(u), ScourgePlayers[0], ALLIANCE_HELP_RESPONSE, false)
				else
					call SetPlayerAlliance(GetOwningPlayer(u), SentinelPlayers[0], ALLIANCE_HELP_RESPONSE, false)
				endif
			endif
		endif
	else
		if GetUnitAbilityLevel(u,'A40E')> 0 then
			if IsScourgePlayer(GetOwningPlayer(u)) then
				call SetPlayerAlliance(GetOwningPlayer(u), ScourgePlayers[0], ALLIANCE_HELP_RESPONSE, true)
			else
				call SetPlayerAlliance(GetOwningPlayer(u), SentinelPlayers[0], ALLIANCE_HELP_RESPONSE, true)
			endif
		endif
	endif
	set u = null
endfunction
function ZRA takes nothing returns nothing
	if GetWidgetLife(GetEnumItem())> 0 and ZNX(GetItemTypeId(GetEnumItem())) and GetDistanceBetween(GetWidgetX(GetEnumItem()), GetWidgetY(GetEnumItem()), GetUnitX(GetOrderTargetUnit()), GetUnitY(GetOrderTargetUnit()))< 150 then
		call IssueTargetOrderById(GetTriggerUnit(),851971, GetEnumItem())
	endif
endfunction
function ZIA takes nothing returns boolean
	if GetIssuedOrderId()==851971 and GetOrderTargetUnit()!= null and O4X(GetTriggerUnit()) then
		if (RectContainsUnit(gg_rct_LeftTopRune, GetOrderTargetUnit())) then
			call EnumItemsInRect(gg_rct_LeftTopRune, null, function ZRA)
		elseif RectContainsUnit(gg_rct_RightBottomRune, GetOrderTargetUnit()) then
			call EnumItemsInRect(gg_rct_RightBottomRune, null, function ZRA)
		endif
	endif
	return false
endfunction
function ZAA takes nothing returns nothing
	if IsPickingHero then
		if GetUnitTypeId(GetFilterUnit())=='hfoo' then
			if GetTriggerPlayer() == LocalPlayer then
				call ClearSelection()
				call SelectUnit(LoadUnitHandle(HY, GetHandleId(GetFilterUnit()), 0), true)
			endif
		endif
	endif
endfunction
function ZNA takes nothing returns nothing
	local group g
	if IsPickingHero then
		set g = AllocationGroup(500)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), Condition(function ZAA))
		call DeallocateGroup(g)
		set g = null
	endif
	call EDR()
endfunction
function TreeRestoreStandExpired takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local destructable d = LoadDestructableHandle(HY, h, 0)
	call SetDestructableAnimationSpeed(d, 1)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set d = null
	set t = null
endfunction
function TreeRestoreAnimation takes destructable d returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, 2, false, function TreeRestoreStandExpired)
	if GetDestructableTypeId(d)=='NTtw' then
		call SetDestructableAnimation(d, "birth")
		call SetDestructableAnimationSpeed(d, 600)
	else
		call SetDestructableAnimation(d, "birth")
		call SetDestructableAnimationSpeed(d, 3)
	endif
	call SaveDestructableHandle(HY, h, 0, d)
	set t = null
endfunction
function TreeRestoreExpiredAction takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local destructable d = LoadDestructableHandle(HY, h, 0)
	call DestructableRestoreLife(d, GetDestructableMaxLife(d), false)
	call TreeRestoreAnimation(d)
	call PauseTimer(t)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set d = null
endfunction
function TreeDestructableDeathAction takes nothing returns nothing
	local timer t = CreateTimer()
	local real time = GetRandomReal( 180, 300)
	call TimerStart(t, time, false, function TreeRestoreExpiredAction)
	call SaveDestructableHandle(HY, GetHandleId(t), 0, GetTriggerDestructable())
	set t = null
endfunction
function RegisterEnumTreeDeath takes nothing returns boolean
	if IsTreeDestructable(GetFilterDestructable()) then
		call TriggerRegisterDeathEvent(TreeDestructableDeathTrig, GetFilterDestructable())
	endif
	return false
endfunction
function ZHA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	call RemoveItem(CreateItem('I006'+ GetRandomInt(0, 2), GetLocationX(LeftTopRuneLocatio), GetLocationY(LeftTopRuneLocatio)))
	call RemoveItem(CreateItem('I006'+ GetRandomInt(0, 2), GetLocationX(RightBottomRuneLocatio), GetLocationY(RightBottomRuneLocatio)))
	call RemoveItem(CreateItem(XXV[ASV], GetRandomReal(-6000, 6000), GetRandomReal(-6000, 6000)))
	call RemoveItem(CreateItem(XXV[X4V], GetRandomReal(-6000, 6000), GetRandomReal(-6000, 6000)))
	call TimerStart(t, GetRandomReal(1.5, 3), false, function ZHA)
	set t = null
endfunction
function HeroTrasher takes nothing returns nothing
endfunction
function ZJA takes nothing returns nothing
	local timer t = CreateTimer()
	set t = null
endfunction
function SetCircleIndex takes unit u, integer pid returns nothing
	local player p = Player(pid)
	call UnitAddAbility(u,'A141')
	if LocalPlayer == p then
		call ClearSelection()
		call SelectUnit(u, true)
		call SetUnitVertexColor(u, 255, 255, 255, 255)
	else
		call SetUnitVertexColor(u, 255, 255, 255, 25)
	endif
	set CirclesUnit[pid]= u
	set CirclesX[pid]= GetUnitX(u)
	set CirclesY[pid]= GetUnitY(u)
endfunction
function ZLA takes nothing returns nothing
	local integer h = GetHandleId(GetExpiredTimer())
	local player p = LoadPlayerHandle(HY, h, 0)
	if GetPlayerSlotState(p) == PLAYER_SLOT_STATE_LEFT then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, PlayersColoerText[GetPlayerId(p)] + GetPlayerName(p)+ "|r: Maphack detected, kicked.")
	endif
	call FlushChildHashtable(HY, GetHandleId(GetExpiredTimer()))
	call DestroyTimer(GetExpiredTimer())
endfunction
function ZMA takes nothing returns nothing
	local timer t = CreateTimer()
	local player p = GetTriggerPlayer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .1, false, function ZLA)
	call SavePlayerHandle(HY, h, 0, p)
	set t = null
endfunction
function ZPA takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local player p = GetTriggerPlayer()
	local integer id = GetPlayerId(p)
	if u == HO then
		set FO[id]= true
		set GO[id]= true
	endif
	if u == KO then
		if (GetPlayerController(p) == MAP_CONTROL_USER) and(GetPlayerSlotState(p) == PLAYER_SLOT_STATE_PLAYING) then
			if FO[id]== false or GO[id] then
				if UnitVisibleToPlayer(LO, p) == false then
					set AO[id]= AO[id] + 1
					if ModuloInteger(AO[id], 30) == 3 then
						call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, PlayersColoerText[id] + GetPlayerName(p)+ "|r: 作弊检测 " + I2S(AO[id])+ " 秒")
					endif
					if GV and ModuloInteger(AO[id], 60) == 5 then
						call StoreDrCacheData("MH" + I2S(id), R2I(GetGameTime()))
					endif
				endif
				call SelectUnit(HO, false)
			endif
			set FO[id]= false
			set GO[id]= false
		endif
	endif
	if HO != u and KO != u then
		set DO[id]= DO[id] + 1
		if DO[id]== 12 then
			set NO[id]= u
		endif
		if DO[id]== 11 then
			set CO[id]= u
		endif
		if DO[id]> 12 then
			set DO[id]= 12
		endif
	endif
	call ZMA()
endfunction
function ZQA takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local player p = GetTriggerPlayer()
	local integer id = GetPlayerId(p)
	if HO != u and KO != u then
		set DO[id]= DO[id]-1
		if NO[id]== u then
			set NO[id]= null
		endif
		if CO[id]== u then
			set CO[id]= null
		endif
	endif
	if u == HO then
		set GO[id]= false
	endif
endfunction
function DetectMh takes nothing returns nothing
	if UO then
		call SetUnitX(HO, GetRectMinX(bj_mapInitialPlayableArea)+ 600)
		call SetUnitY(HO, GetRectMaxY(bj_mapInitialPlayableArea)-600)
	endif
	if DO[GetPlayerId(GetTriggerPlayer())]<= 10 then
		call SelectUnit(HO, true)
		call SelectUnit(KO, true)
		call SelectUnit(KO, false)
		call SelectUnit(HO, false)
	else
		call DisableTrigger(PO)
		call DisableTrigger(QO)
		call SelectUnit(NO[LocalPlayerId], false)
		call SelectUnit(CO[LocalPlayerId], false)
		call SelectUnit(HO, true)
		call SelectUnit(KO, true)
		call SelectUnit(KO, false)
		call SelectUnit(HO, false)
		call SelectUnit(NO[LocalPlayerId], true)
		call SelectUnit(CO[LocalPlayerId], true)
		call EnableTrigger(PO)
		call EnableTrigger(QO)
	endif
	if UO then
		call SetUnitX(HO, GetRectMaxX(bj_mapInitialPlayableArea))
		call SetUnitY(HO, GetRectMinY(bj_mapInitialPlayableArea))
		set UO = false
	else
		set UO = true
	endif
endfunction
function ZSA takes nothing returns nothing
	local integer i = 1
	set HO = CreateUnit(Player(12),'hfoo', GetRectMaxX(bj_mapInitialPlayableArea), GetRectMinY(bj_mapInitialPlayableArea), .0)
	set KO = CreateUnit(Player(12),'hfoo', GetRectMinX(bj_mapInitialPlayableArea)+ 600, GetRectMaxY(bj_mapInitialPlayableArea)-600, .0)
	set LO = CreateUnit(Player(12),'hfoo', GetRectMaxX(bj_mapInitialPlayableArea), GetRectMinY(bj_mapInitialPlayableArea), .0)
	set PO = CreateTrigger()
	set QO = CreateTrigger()
	loop
	exitwhen i > 12
		call TriggerRegisterPlayerUnitEvent(PO, Player(i), EVENT_PLAYER_UNIT_SELECTED, null)
		call TriggerRegisterPlayerUnitEvent(QO, Player(i), EVENT_PLAYER_UNIT_DESELECTED, null)
		set i = i + 1
	endloop
	call TriggerAddAction(PO, function ZPA)
	call TriggerAddAction(QO, function ZQA)
	set TO = CreateTimer()
endfunction
function NWR takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .1, false)
	call TriggerAddAction(t, function ZSA)
	//call ZJA()
	set t = null
endfunction
function ZTA takes unit u returns nothing
	local integer i = 0
	local item it
	local integer id
	local integer k = UnitInventorySize(u)
	loop
	exitwhen i > k
		set it = UnitItemInSlot(u, i)
		set id = GetItemIndexEx(it)
		if (id == O_V or id == O0V or id == O1V) and GetItemUserData(it)> 0 then
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl", u, "overhead"))
			call IRX(GetOwningPlayer(u), "Abilities\\Spells\\Human\\Heal\\HealTarget.wav")
			set E3 = GetItemPlayer(it)
			call HZX(it)
			set Z2 = JIX(u, XOV[O2V], i)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			call UnitRemoveAbility(u,'B0GI')
		endif
		set i = i + 1
	endloop
	set it = null
endfunction
function ZUA takes nothing returns nothing
	local unit u = GetEnumUnit()
	local integer hu = GetHandleId(u)
	if UnitAlive(u) and(HaveSavedReal(HY, hu,'FnLv') == false or GetGameTime()-LoadReal(HY, hu,'FnLv')< 2.5) then
		if GetWidgetLife(u)< GetUnitState(u, UNIT_STATE_MAX_LIFE) then
			if GetUnitAbilityLevel(u,'A35Y') == 0 then
				call UnitAddPermanentAbility(u,'A35Y')
			endif
			call SetWidgetLife(u, GetWidgetLife(u)+ .004 * GetUnitState(u, UNIT_STATE_MAX_LIFE))
		else
			if GetUnitAbilityLevel(u,'A35Y') == 1 then
				call UnitRemoveAbility(u,'A35Y')
			endif
		endif
		if GetUnitState(u, UNIT_STATE_MANA)< GetUnitState(u, UNIT_STATE_MAX_MANA) then
			if GetUnitAbilityLevel(u,'A35Z') == 0 then
				call UnitAddPermanentAbility(u,'A35Z')
			endif
			call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ .004 * GetUnitState(u, UNIT_STATE_MAX_MANA)+ 1.4)
		else
			if GetUnitAbilityLevel(u,'A35Z') == 1 then
				call UnitRemoveAbility(u,'A35Z')
			endif
		endif
		if HaveSavedReal(HY, hu,'FnLv') == false and UnitInventorySize(u)> 0 and ModuloInteger(GetTriggerEvalCount(GetTriggeringTrigger()), 2) == 1 then
			call ZTA(u)
		endif
	else
		call UnitRemoveAbility(u,'A35Y')
		call UnitRemoveAbility(u,'A35Z')
		call GroupRemoveUnit(bj_lastCreatedGroup, u)
		call GroupRemoveUnit(AV, u)
	endif
	if IsUnitMessenger(u) then
		if HaveSavedReal(HY, hu,'FnLv') then
			call UnitRemoveAbility(u,'Avul')
		elseif GetUnitAbilityLevel(u,'Avul') == 0 then
			call UnitAddPermanentAbility(u,'Avul')
		endif
	endif
	set u = null
endfunction
function ZWA takes nothing returns boolean
	return(GetPlayerTeam(GetOwningPlayer(GetFilterUnit())) == 0 and GetWidgetLife(GetFilterUnit())> .5 and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false and GetUnitAbilityLevel(GetFilterUnit(),'Aloc') == 0)!= null
endfunction
function ZYA takes nothing returns boolean
	return(GetPlayerTeam(GetOwningPlayer(GetFilterUnit())) == 1 and GetWidgetLife(GetFilterUnit())> .5 and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) == false and GetUnitAbilityLevel(GetFilterUnit(),'Aloc') == 0)!= null
endfunction
function ZZA takes nothing returns boolean
	return GetUnitPointValue(GetTriggerUnit())!= 200
endfunction
function Z_A takes nothing returns nothing
	local group g
	local unit u
	if GetTriggerEventId() == EVENT_GAME_LEAVE_REGION then
		if GetUnitAbilityLevel(GetTriggerUnit(),'Aloc') == 0 then
			if (GetTriggeringRegion() == HX and GetPlayerTeam(GetOwningPlayer(GetTriggerUnit())) == 0) or(GetTriggeringRegion() == JX and GetPlayerTeam(GetOwningPlayer(GetTriggerUnit())) == 1) then
				call SaveReal(HY, GetHandleId(GetTriggerUnit()),'FnLv', GetGameTime())
				call GroupAddUnit(AV, GetTriggerUnit())
			endif
		endif
		return
	endif
	set g = AllocationGroup(501)
	call GroupClear(ZA)
	call GroupEnumUnitsInRect(g, WA, Condition(function ZWA))
	call GroupAddGroup(g, ZA)
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call RemoveSavedReal(HY, GetHandleId(u),'FnLv')
		call GroupRemoveUnit(AV, u)
		call GroupRemoveUnit(g, u)
	endloop
	call GroupClear(g)
	call GroupClear(VN)
	call GroupEnumUnitsInRect(g, YA, Condition(function ZYA))
	call GroupAddGroup(g, VN)
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call RemoveSavedReal(HY, GetHandleId(u),'FnLv')
		call GroupRemoveUnit(AV, u)
		call GroupRemoveUnit(g, u)
	endloop
	set S2 = GetGameTime()
	set bj_lastCreatedGroup = ZA
	call ForGroup(ZA, function ZUA)
	set bj_lastCreatedGroup = VN
	call ForGroup(VN, function ZUA)
	call ForGroup(AV, function ZUA)
	call DeallocateGroup(g)
endfunction
function LastSpellStateCondition takes nothing returns nothing
	if IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) then
		if GetTriggerEventId()!= EVENT_PLAYER_UNIT_SPELL_ENDCAST then
			call S2V(GetTriggerUnit(), true)
		else
			call S2V(GetTriggerUnit(), false)
		endif
	endif
endfunction
function InitSomeLists takes nothing returns nothing
endfunction
function Z1A takes integer id returns nothing
	set SR = SR + 1
	set U4[SR]= id
	set Y4[SR]= 50 * SR + 50
endfunction
function InitBuyBack takes nothing returns nothing
	call Z1A('h09G')
	call Z1A('h09T')
	call Z1A('h09F')
	call Z1A('h09H')
	call Z1A('h09E')
	call Z1A('h09D')
	call Z1A('h09C')
	call Z1A('h09B')
	call Z1A('h099')
	call Z1A('h09A')
	call Z1A('h09J')
	call Z1A('h09K')
	call Z1A('h09L')
	call Z1A('h09M')
	call Z1A('h09N')
	call Z1A('h09O')
	call Z1A('h09P')
	call Z1A('h09Q')
	call Z1A('h09R')
	call Z1A('h09S')
	call Z1A('h09I')
	call Z1A('h09Z')
	call Z1A('h09X')
	call Z1A('h0A1')
	call Z1A('h0A2')
	call Z1A('h0A6')
	call Z1A('h0A3')
	call Z1A('h0A4')
	call Z1A('h09Y')
	call Z1A('h09V')
	call Z1A('h0A0')
	call Z1A('h09U')
	call Z1A('h0AF')
	call Z1A('h0AD')
	call Z1A('h0AE')
	call Z1A('h0AC')
	call Z1A('h0AB')
	call Z1A('h0AA')
	call Z1A('h0A9')
	call Z1A('h0AG')
	call Z1A('h0A7')
	call Z1A('h0AO')
	call Z1A('h0AY')
	call Z1A('h0AH')
	call Z1A('h0AI')
	call Z1A('h0AJ')
	call Z1A('h0AP')
	call Z1A('h0AQ')
	call Z1A('h0AK')
	call Z1A('h0AR')
	call Z1A('h0AL')
	call Z1A('h0AS')
	call Z1A('h09W')
	call Z1A('h0AM')
	call Z1A('h0A8')
	call Z1A('h0AT')
	call Z1A('h0AU')
	call Z1A('h0AN')
	call Z1A('h0AV')
	call Z1A('h0AW')
	set W4[0]= U4[0]
	set W4[1]= U4[0]
	set W4[2]= U4[0]
	set W4[3]= U4[0]
	set W4[4]= U4[0]
	set W4[5]= U4[0]
	set W4[6]= U4[0]
	set W4[7]= U4[0]
	set W4[8]= U4[0]
	set W4[9]= U4[0]
	set W4[10]= U4[0]
	set W4[11]= U4[0]
	set W4[12]= U4[0]
	set W4[13]= U4[0]
	set W4[14]= U4[0]
endfunction
globals
	string array HerosIconFilePath
endglobals
function SaveHeroModelData takes integer id, integer heroId, integer KLX, integer cmid, string Z4A, real Z5A returns nothing
	set HeroListTypeId[id]= heroId
	set RX[id]= KLX
	if heroId > 0 then
		set HerosIconFilePath[id]= GetAbilitySoundById(heroId, SOUND_TYPE_EFFECT_LOOPED)
	endif
	call SaveUnitVictoryAnimation(heroId, Z4A)
	call SaveHeroModelScale(heroId, Z5A, KLX)
	if IsUnitIdType(heroId, UNIT_TYPE_MELEE_ATTACKER) then
		set MeleeHeroMax = MeleeHeroMax + 1
		set MeleeHeroList[MeleeHeroMax]= heroId
	else
		set RangeHeroMax = RangeHeroMax + 1
		set RangeHeroList[RangeHeroMax]= heroId
	endif
endfunction
function InitItemBuffId takes nothing returns nothing
	call SetBuffAbilityId('A3K2','PRGE')
	call SetBuffAbilityId('A3K3','PRGE')
	call SetBuffAbilityId('BIcb','PRGE')
	call SetBuffAbilityId('A2EC','PRGE')
	call SetBuffAbilityId('B0F5','PRGE')
	call SetBuffAbilityId('B08N','PRGE')
	call SetBuffAbilityId('B02I','PRGE')
	call SetBuffAbilityId('A3FL','PRGA')
	call SetBuffAbilityId('B01P','PRGA')
endfunction
function Init_BuffsId takes nothing returns nothing
	call InitItemBuffId()
	// 初始化晕眩BUFF表
	call SetStunBuffId('BPSE')
	call SetStunBuffId('BSTN')
	call SetStunBuffId('B0BM')
	call SetStunBuffId('B0CF')
	call SetStunBuffId('B07N')
	call SetStunBuffId('B00Q')
	call SetStunBuffId('B095')
	call SetStunBuffId('B0C2')
	call SetStunBuffId('B02S')
	call SetStunBuffId('B02F')
	call SetStunBuffId('BUsp')
	call SetStunBuffId('Bust')
	call SetStunBuffId('B0AQ')
	call SetStunBuffId('BUan')
	call SetStunBuffId('B0GG')
	call SetBuffAbilityId('C010','PRGE')
	call SetBuffAbilityId('D010','PRGE')
	call SetBuffAbilityId('A45O','PRGE')
	call SetBuffAbilityId('A45P','PRGE')
	call SetBuffAbilityId('A45Q','PRGE')
	call SetBuffAbilityId('A45R','PRGE')
	call SetBuffAbilityId('A44Y','PRGC')
	call SetBuffAbilityId('B44Y','PRGC')
	call SetBuffAbilityId('A45Y','PRGS')
	call SetBuffAbilityId('A45Z','PRGS')
	call SetBuffAbilityId('B45Y','PRGS')
	call SetBuffAbilityId('A32F','PRGS')
	call SetBuffAbilityId('B32F','PRGS')
	call SetBuffAbilityId('A3A0','PRGS')
	call SetBuffAbilityId('A3A1','PRGS')
	call SetBuffAbilityId('A3A2','PRGS')
	call SetBuffAbilityId('A3A3','PRGS')
	call SetBuffAbilityId('A3A4','PRGS')
	call SetBuffAbilityId('A3A5','PRGS')
	call SetBuffAbilityId('A3A6','PRGS')
	call SetBuffAbilityId('A3A7','PRGS')
	call SetBuffAbilityId('B079','PRGS')
	call SetBuffAbilityId('C016','PRGS')
	call SetBuffAbilityId('D016','PRGS')
	call SetBuffAbilityId('B09Q','PRGS')
	call SetBuffAbilityId('B06Q','PRGS')
	call SetBuffAbilityId('A44Y','PRGC')
	call SetBuffAbilityId('B44Y','PRGC')
	call SetBuffAbilityId('C033','PRGH')
	call SetBuffAbilityId('D033','PRGH')
	call SetBuffAbilityId('A3KC','PRGH')
	call SetBuffAbilityId('A3KE','PRGE')
	call SetBuffAbilityId('B3KE','PRGE')
	call SetBuffAbilityId('A3KD','PRGE')
	call SetBuffAbilityId('A2T4','PRGE')
	call SetBuffAbilityId('B01N','PRGC')
	call SetBuffAbilityId('A30D','PRGC')
	call SetBuffAbilityId('A44I','PRGC')
	call SetBuffAbilityId('A30E','PRGC')
	call SetBuffAbilityId('A3C0','PRGC')
	call SetBuffAbilityId('A3C1','PRGC')
	call SetBuffAbilityId('A3C2','PRGC')
	call SetBuffAbilityId('A3C3','PRGC')
	call SetBuffAbilityId('B38G','PRGC')
	call SetBuffAbilityId('B06Z','PRGS')
	call SetBuffAbilityId('B08Q','PRGS')
	call SetBuffAbilityId('B031','PRGI')
	call SetBuffAbilityId('A4TP','PRGI')
	
	call SetBuffAbilityId('B0C1','PRGN')
	call SetBuffAbilityId('BEer','PRGN')
	call SetBuffAbilityId('BHca','PRGS')
	call SetBuffAbilityId('Bcsd','PRGS')
	call SetBuffAbilityId('B0BQ','PRGS')
	call SetBuffAbilityId('Bprg','PRGS')
	call SetBuffAbilityId('Bcri','PRGS')
	call SetBuffAbilityId('B090','PRGE')
	call SetBuffAbilityId('B008','PRGE')
	call SetBuffAbilityId('B04B','PRGE')
	call SetBuffAbilityId('B03J','PRGS')
	call SetBuffAbilityId('Bslo','PRGS')
	call SetBuffAbilityId('BNdh','PRGS')
	call SetBuffAbilityId('B07U','PRGI')
	call SetBuffAbilityId('BNsi','PRGI')
	call SetBuffAbilityId('BNso','PRGI')
	call SetBuffAbilityId('B01N','PRGE')
	call SetBuffAbilityId('B033','PRGE')
	call SetBuffAbilityId('Bpoi','PRGS')
	call SetBuffAbilityId('B00H','PRGE')
	call SetBuffAbilityId('BOhx','PRGE')
	call SetBuffAbilityId('A3B8','PRGE')
	call SetBuffAbilityId('B3B8','PRGE')
	call SetBuffAbilityId('B06D','PRGS')
	call SetBuffAbilityId('B0BN','PRGS')
	call SetBuffAbilityId('B071','PRGS')
	call SetBuffAbilityId('B02W','PRGE')
	call SetBuffAbilityId('A294','PRGS')
	call SetBuffAbilityId('A295','PRGS')
	call SetBuffAbilityId('A296','PRGS')
	call SetBuffAbilityId('A297','PRGS')
	call SetBuffAbilityId('B05Q','PRGS')
	call SetBuffAbilityId('B0GT','PRGS')
	call SetBuffAbilityId('A37T','PRGE')
	call SetBuffAbilityId('B37T','PRGE')
	call SetBuffAbilityId('QH00','PRGS')
	call SetBuffAbilityId('A1W2','PRGS')
	call SetBuffAbilityId('B0DO','PRGS')
	call SetBuffAbilityId('A42R','PRGE')
	call SetBuffAbilityId('B0HI','PRGE')
	call SetBuffAbilityId('B00L','PRGE')
	call SetBuffAbilityId('A30Y','PRGE')
	call SetBuffAbilityId('B307','PRGE')
	call SetBuffAbilityId('A334','PRGS')
	call SetBuffAbilityId('B083','PRGS')
	call SetBuffAbilityId('B079','PRGS')
	call SetBuffAbilityId('A335','PRGS')
	call SetBuffAbilityId('B08B','PRGS')
	call SetBuffAbilityId('B0GR','PRGE')
	call SetBuffAbilityId('Bdet','PRGE')
	call SetBuffAbilityId('B0GK','PRGS')
	call SetBuffAbilityId('B06Q','PRGS')
	call SetBuffAbilityId('BHtc','PRGS')
	call SetBuffAbilityId('B0BR','PRGS')
	call SetBuffAbilityId('A37U','PRGS')
	call SetBuffAbilityId('A37V','PRGS')
	call SetBuffAbilityId('A37W','PRGS')
	call SetBuffAbilityId('A37X','PRGS')
	call SetBuffAbilityId('A3F0'+ 0,'PRGS')
	call SetBuffAbilityId('A3F0'+ 1,'PRGS')
	call SetBuffAbilityId('A3F0'+ 2,'PRGS')
	call SetBuffAbilityId('A3F0'+ 3,'PRGS')
	call SetBuffAbilityId('A3F0'+ 4,'PRGS')
	call SetBuffAbilityId('A3F0'+ 5,'PRGS')
	call SetBuffAbilityId('A3F0'+ 6,'PRGS')
	call SetBuffAbilityId('A3F0'+ 7,'PRGS')
	call SetBuffAbilityId('A3F0'+ 8,'PRGS')
	call SetBuffAbilityId('A3F0'+ 9,'PRGS')
	call SetBuffAbilityId('A3F0'+ 10,'PRGS')
	call SetBuffAbilityId('A3F0'+ 11,'PRGS')
	call SetBuffAbilityId('A3F0'+ 12,'PRGS')
	call SetBuffAbilityId('A3F0'+ 13,'PRGS')
	call SetBuffAbilityId('A3F0'+ 14,'PRGS')
	call SetBuffAbilityId('A3F0'+ 15,'PRGS')
	call SetBuffAbilityId('A3EO'+ 0,'PRGS')
	call SetBuffAbilityId('A3EO'+ 1,'PRGS')
	call SetBuffAbilityId('A3EO'+ 2,'PRGS')
	call SetBuffAbilityId('A3EO'+ 3,'PRGS')
	call SetBuffAbilityId('B386','PRGS')
	call SetBuffAbilityId('A3EK','PRGE')
	call SetBuffAbilityId('A3EL','PRGE')
	call SetBuffAbilityId('A3EM','PRGE')
	call SetBuffAbilityId('A3EN','PRGE')
	call SetBuffAbilityId('B38B','PRGE')
	call SetBuffAbilityId('B37Y','PRGS')
	call SetBuffAbilityId('B07E','PRGS')
	call SetBuffAbilityId('B02V','PRGS')
	call SetBuffAbilityId('BNab','PRGS')
	call SetBuffAbilityId('B03I','PRGE')
	call SetBuffAbilityId('B063','PRGS')
	call SetBuffAbilityId('B03C','PRGS')
	call SetBuffAbilityId('B08M','PRGS')
	call SetBuffAbilityId('B02G','PRGS')
	call SetBuffAbilityId('B01D','PRGS')
	call SetBuffAbilityId('B092','PRGS')
	call SetBuffAbilityId('BEsh','PRGS')
	call SetBuffAbilityId('B017','PRGN')
	call SetBuffAbilityId('B0AE','PRGE')
	call SetBuffAbilityId('B0AD','PRGE')
	call SetBuffAbilityId('B08O','PRGE')
	call SetBuffAbilityId('Bfro','PRGS')
	call SetBuffAbilityId('B05H','PRGS')
	call SetBuffAbilityId('A3QU','PRGS')
	call SetBuffAbilityId('A3QV','PRGS')
	call SetBuffAbilityId('A3QW','PRGS')
	call SetBuffAbilityId('A3QX','PRGS')
	call SetBuffAbilityId('B0BS','PRGS')
	call SetBuffAbilityId('B0BF','PRGE')
	call SetBuffAbilityId('B0BE','PRGE')
	call SetBuffAbilityId('B0CC','PRGE')
	call SetBuffAbilityId('B078','PRGN')
	
	call SetBuffAbilityId('B0FU','PRGN')	//阿托斯缠绕
	
	
	call SetBuffAbilityId('B00T','PRGE')
	call SetBuffAbilityId('B07V','PRGI')
	call SetBuffAbilityId('B00P','PRGS')
	call SetBuffAbilityId('B02M','PRGI')
	call SetBuffAbilityId('B043','PRGS')
	call SetBuffAbilityId('B04Q','PRGS')
	call SetBuffAbilityId('B00C','PRGE')
	call SetBuffAbilityId('B09K','PRGE')
	call SetBuffAbilityId('B08F','PRGN')
	call SetBuffAbilityId('B08E','PRGN')
	call SetBuffAbilityId('B0AM','PRGS')
	call SetBuffAbilityId('C009','PRGE')
	call SetBuffAbilityId('D009','PRGE')
	call SetBuffAbilityId('B38I','PRGS')
	call SetBuffAbilityId('B09Q','PRGS')
	call SetBuffAbilityId('B0DI','PRGS')
	call SetBuffAbilityId('B0BB','PRGS')
	call SetBuffAbilityId('B0AF','PRGE')
	call SetBuffAbilityId('B08N','PRGS')
	call SetBuffAbilityId('B02I','PRGS')
	call SetBuffAbilityId('B0BY','PRGI')
	call SetBuffAbilityId('B02P','PRGE')
	call SetBuffAbilityId('B0EP','PRGS')
	call SetBuffAbilityId('B0ER','PRGN')
	call SetBuffAbilityId('B0ET','PRGS')
	call SetBuffAbilityId('B0FN','PRGN')
	call SetBuffAbilityId('B0FY','PRGS')
	call SetBuffAbilityId('B0FT','PRGI')
	call SetBuffAbilityId('B0G0','PRGI')
	call SetBuffAbilityId('Bena','PRGN')
	call SetBuffAbilityId('Beng','PRGN')
	call SetBuffAbilityId('A39F','PRGE')
	call SetBuffAbilityId('Aetl','PRGC')
	call SetBuffAbilityId('A3QU','PRGE')
	call SetBuffAbilityId('A3QV','PRGE')
	call SetBuffAbilityId('A3QW','PRGE')
	call SetBuffAbilityId('A3QX','PRGE')
	call SetBuffAbilityId('A3Q2','PRGE')
	call SetBuffAbilityId('A3Q1','PRGE')
	call SetBuffAbilityId('B3DJ','PRGE')
	call SetBuffAbilityId('A3Q0','PRGE')
	call SetBuffAbilityId('A3PZ','PRGE')
	call SetBuffAbilityId('A3PV','PRGE')
	call SetBuffAbilityId('A3PW','PRGE')
	call SetBuffAbilityId('A3PX','PRGE')
	call SetBuffAbilityId('A3PY','PRGE')
	call SetBuffAbilityId('A3PR','PRGE')
	call SetBuffAbilityId('A3PS','PRGE')
	call SetBuffAbilityId('A3PT','PRGE')
	call SetBuffAbilityId('A3PU','PRGE')
	call SetBuffAbilityId('A42Q','PRGE')
	call SetBuffAbilityId('B0HH','PRGE')
	call SetBuffAbilityId('A17K','PRGE')
	call SetBuffAbilityId('B0AP','PRGE')
	call SetBuffAbilityId('B307','PRGE')
	call SetBuffAbilityId('A10Z','PRGE')
	call SetBuffAbilityId('A111','PRGE')
	call SetBuffAbilityId('A10Y','PRGE')
	call SetBuffAbilityId('A110','PRGE')
	call SetBuffAbilityId('B09M','PRGE')
	call SetBuffAbilityId('B09N','PRGE')
	call SetBuffAbilityId('B09O','PRGE')
	call SetBuffAbilityId('B09L','PRGE')
	call SetBuffAbilityId('A1PS','PRGS')
	call SetBuffAbilityId('B0CQ','PRGS')
	call SetBuffAbilityId('A0OW','PRGS')
	call SetBuffAbilityId('A42S','PRGE')
	call SetBuffAbilityId('B0HJ','PRGE')
	call SetBuffAbilityId('A204','PRGS')
	call SetBuffAbilityId('B0DY','PRGS')
	call SetBuffAbilityId('A30B','PRGS')
	call SetBuffAbilityId('B30A','PRGS')
	call SetBuffAbilityId('A304','PRGS')
	call SetBuffAbilityId('B304','PRGS')
	call SetBuffAbilityId('A0RC','PRGE')
	call SetBuffAbilityId('A228','PRGE')
	call SetBuffAbilityId('B0E8','PRGE')
	call SetBuffAbilityId('A264','PRGE')
	call SetBuffAbilityId('B02I','PRGE')
	call SetBuffAbilityId('A263','PRGE')
	call SetBuffAbilityId('B08N','PRGE')
	call SetBuffAbilityId('A3W0','PRGE')
	call SetBuffAbilityId('B3W0','PRGE')
	call SetBuffAbilityId('A3W9','PRGE')
	call SetBuffAbilityId('B3W9','PRGE')

	// PRGA 仅强驱散？

	// 猛犸波神杖升级致残
	call SetBuffAbilityId('A3Y9','PRGA')
	call SetBuffAbilityId('a3Y9','PRGA')

	call SetBuffAbilityId('A1HN','PRGA')
	call SetBuffAbilityId('B0CJ','PRGA')
	call SetBuffAbilityId('A0QO','PRGA')
	call SetBuffAbilityId('B080','PRGA')
	call SetBuffAbilityId('A0VJ','PRGA')
	call SetBuffAbilityId('A109','PRGA')
	call SetBuffAbilityId('A0P0','PRGA')
	call SetBuffAbilityId('B073','PRGA')
	call SetBuffAbilityId('C025','PRGA')
	call SetBuffAbilityId('D025','PRGA')
	call SetBuffAbilityId('A2J4','PRGA')
	
	call SetBuffAbilityId('Broa','PRGA')
	call SetBuffAbilityId('B014','PRGA')
	call SetBuffAbilityId('B00G','PRGA')
	// 狂猛
	call SetBuffAbilityId('B016','PRGA')
	call SetBuffAbilityId('B077','PRGA')
	call SetBuffAbilityId('B0FP','PRGA')
	call SetBuffAbilityId('B0FQ','PRGA')
	// 嗜血术
	call SetBuffAbilityId('Bblo','PRGA')
	call SetBuffAbilityId('B013','PRGA')
	call SetBuffAbilityId('A308','PRGA')
	call SetBuffAbilityId('B308','PRGA')
	
	call SetBuffAbilityId('C000','PRGA')
	call SetBuffAbilityId('D000','PRGA')
	call SetBuffAbilityId('C108','PRGA')
	call SetBuffAbilityId('C109','PRGA')
	call SetBuffAbilityId('C10:','PRGA')
	call SetBuffAbilityId('C10;','PRGA')
	call SetBuffAbilityId('D105','PRGA')
	call SetBuffAbilityId('A2IB','PRGA')
	call SetBuffAbilityId('B0FV','PRGA')
	call SetBuffAbilityId('A0WR','PRGA')
	call SetBuffAbilityId('B01E','PRGA')
	call SetBuffAbilityId('A3K9','PRGA')
	call SetBuffAbilityId('A3KA','PRGA')
	call SetBuffAbilityId('B00S','PRGA')
	call SetBuffAbilityId('A3KB','PRGA')
	call SetBuffAbilityId('B07W','PRGA')
	call SetBuffAbilityId('Broa','PRGA')
	call SetBuffAbilityId('A3DU','PRGA')
	call SetBuffAbilityId('A3DV','PRGA')
	call SetBuffAbilityId('A3DW','PRGA')
	call SetBuffAbilityId('A3DX','PRGA')
	call SetBuffAbilityId('B3DU','PRGA')
	call SetBuffAbilityId('C020','PRGA')
	call SetBuffAbilityId('D020','PRGA')
	call SetBuffAbilityId('B0H6','PRGA')
	call SetBuffAbilityId('B016','PRGA')
	call SetBuffAbilityId('B019','PRGA')
	call SetBuffAbilityId('B00U','PRGA')
	call SetBuffAbilityId('A1Q0','PRGA')
	call SetBuffAbilityId('A1Q1','PRGA')
	call SetBuffAbilityId('A1Q2','PRGA')
	call SetBuffAbilityId('A1Q3','PRGA')
	call SetBuffAbilityId('A1CO','PRGA')
	call SetBuffAbilityId('B1CO','PRGA')
	call SetBuffAbilityId('A46F','PRGA')
	call SetBuffAbilityId('B46F','PRGA')
	call SetBuffAbilityId('A24G','PRGA')
	call SetBuffAbilityId('B0EC','PRGA')
	call SetBuffAbilityId('A23N','PRGA')
	call SetBuffAbilityId('B0E9','PRGA')
	call SetBuffAbilityId('A1GA','PRGA')
	call SetBuffAbilityId('B021','PRGA')
	call SetBuffAbilityId('A3KF','PRGA')
	call SetBuffAbilityId('B3KF','PRGA')
	call SetBuffAbilityId('A1N3','PRGA')
	call SetBuffAbilityId('A1N7','PRGA')
	call SetBuffAbilityId('B0CH','PRGA')
	call SetBuffAbilityId('B02H','PRGA')
	call SetBuffAbilityId('A1ZY','PRGA')
	call SetBuffAbilityId('B0DX','PRGA')
	call SetBuffAbilityId('B0CG','PRGA')
	call SetBuffAbilityId('Bcyc','PRGA')
	call SetBuffAbilityId('Bcy2','PRGA')
	call SetBuffAbilityId('Aetl','PRGA')
	call SetBuffAbilityId('A42L','PRGA')
	call SetBuffAbilityId('A42N','PRGA')
	call SetBuffAbilityId('B0HG','PRGA')
	call SetBuffAbilityId('B07S','PRGA')
	call SetBuffAbilityId('A3KI','PRGA')
	call SetBuffAbilityId('B3KI','PRGA')
endfunction
function Z8A takes nothing returns nothing
	call RegisterUnitAttackEvent("TIA",-2)	//幽冥剧毒
endfunction
function Z9A takes nothing returns nothing
	call RegisterUnitAttackEvent("TAA",-1)	//海妖外壳
endfunction
function VVN takes nothing returns nothing
	call RegisterUnitAttackEvent("S7A", 1)	//灵能之刃
endfunction
function VEN takes nothing returns nothing
	call RegisterUnitAttackEvent("TRA",-1)
endfunction
function VXN takes nothing returns nothing
	call RegisterUnitAttackEvent("TEA",-1)
endfunction
function VON takes nothing returns nothing
	call RegisterUnitAttackEvent("S8A",-2)
endfunction
function VRN takes nothing returns nothing
	call RegisterUnitAttackEvent("S9A",-1)
endfunction
function VIN takes nothing returns nothing
	call RegisterUnitAttackEvent("SAA", 0)
endfunction
function VAN takes nothing returns nothing
	call RegisterUnitAttackEvent("SNA", 0)	//吸血光环
	set EE = true
endfunction
function VNN takes nothing returns nothing	//时间锁定
	//call RegisterUnitAttackEvent("S4A", 1)
	call ExecuteFunc("OPO")
endfunction
function VBN takes nothing returns nothing
	call RegisterUnitAttackEvent("LWR", 3)
endfunction
function VCN takes nothing returns nothing
	call RegisterUnitAttackEvent("TOA",-2)
endfunction
function VDN takes nothing returns nothing //月刃
	call RegisterUnitAttackEvent("MoonGlaiveOnAttackHit", 0)
endfunction
function VFN takes nothing returns nothing
	call RegisterUnitAttackEvent("S2A", 4)
endfunction
function VGN takes nothing returns nothing
	call RegisterUnitAttackEvent("S1A", 4)
	call RegisterUnitAttackEvent("S3A",-2)
endfunction
function VHN takes nothing returns nothing
	call RegisterUnitAttackEvent("SKA", 3)
endfunction
function VJN takes nothing returns nothing
	call RegisterUnitAttackEvent("SJA", 2)
endfunction
function VKN takes nothing returns nothing
	call RegisterUnitAttackEvent("TNA",-1)
	call RegisterUnitAttackEvent("SZA", 3)
endfunction
function VLN takes nothing returns nothing
	call RegisterUnitAttackEvent("SQA", 3)
endfunction
function VMN takes nothing returns nothing
	call RegisterUnitAttackEvent("SSA", 3)
endfunction
function VPN takes nothing returns nothing
	call RegisterUnitAttackEvent("S_A", 3)
	call RegisterUnitAttackEvent("TVA",-1)
endfunction
function VQN takes nothing returns nothing
	call RegisterUnitAttackEvent("SUA", 3)
endfunction
function VSN takes nothing returns nothing
	call RegisterUnitAttackEvent("STA", 3)
endfunction
function VTN takes nothing returns nothing
	call RegisterUnitAttackEvent("DamagedEvent__Tidebringer", 1)
endfunction
function VUN takes nothing returns nothing
	call RegisterUnitAttackEvent("TBA", 0)
endfunction
function VWN takes nothing returns nothing
	call RegisterUnitAttackEvent("SHA", 1)
endfunction
function VYN takes nothing returns nothing
	call RegisterUnitAttackEvent("SCA", 1)
	call RegisterUnitAttackEvent("SDA",-2)
endfunction
function VZN takes nothing returns nothing
	call RegisterUnitAttackEvent("SLA", 3)
endfunction
function V_N takes nothing returns nothing
	call RegisterUnitAttackEvent("TXA", 0)
endfunction
function V0N takes nothing returns nothing
	call RegisterUnitAttackEvent("S0A", 3)
endfunction
function V1N takes nothing returns nothing
	call RegisterUnitAttackEvent("BNI",-2)
endfunction
function V2N takes nothing returns nothing
	call RegisterUnitAttackEvent("SWA", 3)
endfunction
function V3N takes nothing returns nothing
	call RegisterUnitAttackEvent("TFA",-1)
endfunction
function V4N takes nothing returns nothing
	call RegisterUnitAttackEvent("SPA", 3)
	call RegisterUnitAttackEvent("SMA",-2)
endfunction
function V5N takes nothing returns nothing
	call RegisterUnitAttackEvent("SYA", 0)
endfunction
function V6N takes nothing returns nothing
	call RegisterUnitAttackEvent("NWA", 0)
endfunction
function V7N takes nothing returns nothing
	call RegisterUnitAttackEvent("SFA", 1)
	call RegisterUnitAttackEvent("SGA",-2)
	call RegisterUnitAttackEvent("TDA",-1)
endfunction
function V8N takes nothing returns nothing	//活性护甲
	call RegisterUnitAttackEvent("TCA", 0)
endfunction
function V9N takes nothing returns nothing
	call RegisterUnitAttackEvent("O1I", 2)
endfunction
function EVN takes nothing returns nothing
	call RegisterUnitAttackEvent("HWI", 3)
endfunction
function EEN takes nothing returns nothing
	call ExecuteFunc("OPO")
	call RegisterUnitAttackEvent("HYI", 3)
endfunction
function EXN takes nothing returns nothing
	call RegisterUnitAttackEvent("SEA", 0)
endfunction
function EON takes nothing returns nothing
	call UKA("UMA")
endfunction
function ERN takes nothing returns nothing
	call UKA("UPA")
	call SetAllPlayerAbilityUnavailable('A30P')
endfunction
function EIN takes nothing returns nothing
	call UKA("UQA")
endfunction
function EAN takes nothing returns nothing
	call UKA("USA")
endfunction
function ENN takes nothing returns nothing
	call UKA("KFA")
endfunction
function EBN takes nothing returns nothing
	call UKA("ULA")
endfunction
function ECN takes nothing returns nothing
	call RegisterUnitAttackEvent("CRA", 3)
endfunction
function InitPassiveAbilitys takes nothing returns nothing	//被动技能学习
	call SaveStr(ObjectHashTable,'A060', 601, "W_A")
	call SaveStr(ObjectHashTable,'A0LE', 601, "WYA")
	call SaveStr(ObjectHashTable,'A0O3', 601, "WUA")	//地精的贪婪
	call SaveStr(ObjectHashTable,'A1W8', 601, "WSA")
	call SaveStr(ObjectHashTable,'A0BH', 601, "WQA")
	call SaveStr(ObjectHashTable,'A0A5', 601, "WMA")
	call SaveStr(ObjectHashTable,'A0RP', 601, "WKA")
	call SaveStr(ObjectHashTable,'A0QV', 601, "WHA")
	call SaveStr(ObjectHashTable,'A0AK', 601, "WFA")
	call SaveStr(ObjectHashTable,'P003', 601, "WCA")
	call SaveStr(ObjectHashTable,'A0LZ', 601, "WIA")
	call SaveStr(ObjectHashTable,'A2QM', 601, "WNA")
	call SaveStr(ObjectHashTable,'A2TJ', 601, "WNA")
	call SaveStr(ObjectHashTable,'A2QI', 601, "WNA")
	call SaveStr(ObjectHashTable,'A2TI', 601, "WNA")
	call SaveStr(ObjectHashTable,'A0BR', 601, "W1A")
	call SaveStr(ObjectHashTable,'Z318', 601, "W1A")
	call SaveStr(ObjectHashTable,'A022', 600, "F_R")
	call SaveStr(ObjectHashTable,'A088', 600, "InitMultiCast")
	call SaveStr(ObjectHashTable,'A0DJ', 600, "EON")
	call SaveStr(ObjectHashTable,'A0FV', 600, "ERN")
	call SaveStr(ObjectHashTable,'A1YY', 600, "EIN")
	call SaveStr(ObjectHashTable,'A33Q', 600, "EAN")
	call SaveStr(ObjectHashTable,'A02C', 600, "ENN")
	call SaveStr(ObjectHashTable,'A0N5', 600, "EBN")
	call SaveStr(ObjectHashTable,'A1A3', 600, "Z8A")
	call SaveStr(ObjectHashTable,'A04E', 600, "Z9A")
	call SaveStr(ObjectHashTable,'A0RO', 600, "VVN")
	call SaveStr(ObjectHashTable,'A0C6', 600, "VEN")
	call SaveStr(ObjectHashTable,'A0DZ', 600, "VXN")
	call SaveStr(ObjectHashTable,'A332', 600, "VON")
	call SaveStr(ObjectHashTable,'A01Z', 600, "VRN")
	call SaveStr(ObjectHashTable,'A08R', 600, "VIN")
	call SaveStr(ObjectHashTable,'P250', 600, "VAN")
	//call SaveStr(ObjectHashTable,'A081', 600, "VNN")
	
	call SaveStr(ObjectHashTable,'A45B', 600, "VBN")
	call SaveStr(ObjectHashTable,'A0O0', 600, "VCN")
	call SaveStr(ObjectHashTable,'A041', 600, "VDN")
	call SaveStr(ObjectHashTable,'A0N7', 600, "VFN")
	call SaveStr(ObjectHashTable,'A0QN', 600, "VGN")
	call SaveStr(ObjectHashTable,'A440', 600, "VHN")
	call SaveStr(ObjectHashTable,'A0FA', 600, "VJN")
	call SaveStr(ObjectHashTable,'A0FX', 600, "VKN")
	call SaveStr(ObjectHashTable,'A0OI', 600, "VLN")
	call SaveStr(ObjectHashTable,'A0LZ', 600, "VMN")
	call SaveStr(ObjectHashTable,'A0MG', 600, "VPN")
	call SaveStr(ObjectHashTable,'A0G5', 600, "VQN")
	call SaveStr(ObjectHashTable,'A1HR', 600, "VSN")
	call SaveStr(ObjectHashTable,'A13T', 600, "VTN")
	call SaveStr(ObjectHashTable,'A00V', 600, "VUN")
	call SaveStr(ObjectHashTable,'QM00', 600, "VWN")
	call SaveStr(ObjectHashTable,'A0DL', 600, "VYN")
	call SaveStr(ObjectHashTable,'A0DY', 600, "VZN")
	call SaveStr(ObjectHashTable,'A0DB', 600, "V_N")
	call SaveStr(ObjectHashTable,'A0A5', 600, "V0N")
	call SaveStr(ObjectHashTable,'P067', 600, "V2N")
	call SaveStr(ObjectHashTable,'QB0P', 600, "V1N")
	call SaveStr(ObjectHashTable,'A02Q', 600, "V3N")
	call SaveStr(ObjectHashTable,'A0SS', 600, "V4N")
	call SaveStr(ObjectHashTable,'A0MY', 600, "V5N")
	call SaveStr(ObjectHashTable,'S008', 600, "V6N")
	call SaveStr(ObjectHashTable,'A2EY', 600, "V7N")
	call SaveStr(ObjectHashTable,'A2E4', 600, "V8N")
	call SaveStr(ObjectHashTable,'A03S', 600, "V9N")
	call SaveStr(ObjectHashTable,'Q0BK', 600, "EVN")
	call SaveStr(ObjectHashTable,'A0WQ', 600, "EEN")
	call SaveStr(ObjectHashTable,'A15V', 600, "EXN")
	call SaveStr(ObjectHashTable,'A09V', 600, "SRA")
	call SaveStr(ObjectHashTable,'A1HQ', 600, "ECN")
	call SaveStr(ObjectHashTable,'A03N', 600, "TSA")
	
	call SaveStr(ObjectHashTable,'A0JJ', 600, "OPO")	//重击
	call SaveStr(ObjectHashTable,'A0BE', 600, "OPO")	//狂战士之怒
	call SaveStr(ObjectHashTable,'A081', 600, "OPO")	//时间锁定
endfunction
function EDN takes nothing returns nothing
	if bj_isSinglePlayer then
		if G == false then
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('TX1V'))
		else
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('TX1W'))
		endif
		set G = not G
	endif
endfunction
function Init_Instructions takes nothing returns nothing
	call SaveStr(ChatCommandHashTable, StringHash("-gameinfo"), 0, "ZQO")
	call SaveStr(ChatCommandHashTable, StringHash("-recreate"), 0, "VRR")
	call SaveStr(ChatCommandHashTable, StringHash("-unstuck"), 0, "VBR")
	call SaveStr(ChatCommandHashTable, StringHash("-matchup"), 0, "VDR")
	call SaveStr(ChatCommandHashTable, StringHash("-ma"), 0, "VDR")
	call SaveStr(ChatCommandHashTable, StringHash("-movespeed"), 0, "VHR")
	call SaveStr(ChatCommandHashTable, StringHash("-ms"), 0, "VHR")
	call SaveStr(ChatCommandHashTable, StringHash("-nh"), 0, "T0O")
	call SaveStr(ChatCommandHashTable, StringHash("-mc"), 0, "ERI")

	call SaveStr(ChatCommandHashTable, StringHash("-debug"), 0, "GetGroupList")

	//call SaveStr(ChatCommandHashTable, StringHash("-ocrl"), 0, "Ocrl")
	call SaveStr(ChatCommandHashTable, StringHash("-msa"), 0, "VJR")
	call SaveStr(ChatCommandHashTable, StringHash("-disablehelp"), 0, "VKR")
	call SaveStr(ChatCommandHashTable, StringHash("-enablehelp"), 0, "VLR")
	call SaveStr(ChatCommandHashTable, StringHash("-creepstats"), 0, "VMR")
	call SaveStr(ChatCommandHashTable, StringHash("-cs"), 0, "VMR")
	call SaveStr(ChatCommandHashTable, StringHash("-cson"), 0, "VPR")
	call SaveStr(ChatCommandHashTable, StringHash("-csoff"), 0, "VPR")
	call SaveStr(ChatCommandHashTable, StringHash("-hidemsg"), 0, "V5R")
	call SaveStr(ChatCommandHashTable, StringHash("-showmsg"), 0, "V6R")
	call SaveStr(ChatCommandHashTable, StringHash("-weather snow"), 0, "V9R")
	call SaveStr(ChatCommandHashTable, StringHash("-weather rain"), 0, "V9R")
	call SaveStr(ChatCommandHashTable, StringHash("-weather off"), 0, "V9R")
	call SaveStr(ChatCommandHashTable, StringHash("-weather random"), 0, "V9R")
	call SaveStr(ChatCommandHashTable, StringHash("-weather wind"), 0, "V9R")
	call SaveStr(ChatCommandHashTable, StringHash("-weather moonlight"), 0, "V9R")
	call SaveStr(ChatCommandHashTable, StringHash("-showdeny"), 0, "V3R")
	call SaveStr(ChatCommandHashTable, StringHash("-hidedeny"), 0, "V3R")
	call SaveStr(ChatCommandHashTable, StringHash("-denyinfo"), 0, "V4R")
	call SaveStr(ChatCommandHashTable, StringHash("-di"), 0, "V4R")
	call SaveStr(ChatCommandHashTable, StringHash("-don"), 0, "V2R")
	call SaveStr(ChatCommandHashTable, StringHash("-deathon"), 0, "V2R")
	call SaveStr(ChatCommandHashTable, StringHash("-doff"), 0, "V2R")
	call SaveStr(ChatCommandHashTable, StringHash("-deathoff"), 0, "V2R")
	call SaveStr(ChatCommandHashTable, StringHash("-hhn"), 0, "ERR")
	call SaveStr(ChatCommandHashTable, StringHash("-ui"), 0, "TZO")
	call SaveStr(ChatCommandHashTable, StringHash("-charges"), 0, "T2O")
	call SaveStr(ChatCommandHashTable, StringHash("-dch"), 0, "SetupDoubleClickSpell")
	call SaveStr(ChatCommandHashTable, StringHash("-hideheronames"), 0, "ERR")
	call SaveStr(ChatCommandHashTable, StringHash("-mute"), 0, "EIR")
	call SaveStr(ChatCommandHashTable, StringHash("-afk"), 0, "EJR")
	call SaveStr(ChatCommandHashTable, StringHash("-apm"), 0, "EBR")
	call SaveStr(ChatCommandHashTable, StringHash("-clear"), 0, "EDR")
	call SaveStr(ChatCommandHashTable, StringHash("-c"), 0, "EDR")
	call SaveStr(ChatCommandHashTable, StringHash("-fc"), 0, "T_O")
	call SaveStr(ChatCommandHashTable, StringHash("-courier"), 0, "EPR")
	call SaveStr(ChatCommandHashTable, StringHash("-rolloff"), 0, "EXR")
	call SaveStr(ChatCommandHashTable, StringHash("-rollon"), 0, "EOR")
	call SaveStr(ChatCommandHashTable, StringHash("-bonus"), 0, "E1R")
	call SaveStr(ChatCommandHashTable, StringHash("-rollhero"), 0, "EER")
	call SaveStr(ChatCommandHashTable, StringHash("-rh"), 0, "EER")
	call SaveStr(ChatCommandHashTable, StringHash("-ii"), 0, "ENR")
	call SaveStr(ChatCommandHashTable, StringHash("-iteminfo"), 0, "ENR")
	call SaveStr(ChatCommandHashTable, StringHash("-si"), 0, "EAR")
	call SaveStr(ChatCommandHashTable, StringHash("-skillinfo"), 0, "EAR")
	call SaveStr(ChatCommandHashTable, StringHash("-spellinfo"), 0, "EAR")
	call SaveStr(ChatCommandHashTable, StringHash("-ss"), 0, "T5O")
	call SaveStr(ChatCommandHashTable, StringHash("-disableselection"), 0, "VQR")
	call SaveStr(ChatCommandHashTable, StringHash("-ds"), 0, "VQR")
	call SaveStr(ChatCommandHashTable, StringHash("-enableselection"), 0, "VSR")
	call SaveStr(ChatCommandHashTable, StringHash("-unlock"), 0, "VTR")
	call SaveStr(ChatCommandHashTable, StringHash("-es"), 0, "VSR")
	call SaveStr(ChatCommandHashTable, StringHash("-sleep"), 0, "XWR")
	call SaveStr(ChatCommandHashTable, StringHash("-calm"), 0, "XYR")
	call SaveStr(ChatCommandHashTable, StringHash("-st"), 0, "E4R")
	call SaveStr(ChatCommandHashTable, StringHash("-sp"), 0, "S6O")
	call SaveStr(ChatCommandHashTable, StringHash("-spcd"), 0, "S6OCD")
	call SaveStr(ChatCommandHashTable, StringHash("-show"), 0, "T7O")
	call SaveStr(ChatCommandHashTable, StringHash("-cooldown"), 0, "T8O")
	call SaveStr(ChatCommandHashTable, StringHash("-fix"), 0, "NXX")
	call SaveStr(ChatCommandHashTable, StringHash("-reset"), 0, "RAR")
	call SaveStr(ChatCommandHashTable, StringHash("-remove"), 0, "TQO")
	call SaveStr(ChatCommandHashTable, StringHash("-morph"), 0, "TUO")
	call SaveStr(ChatCommandHashTable, StringHash("-hud"), 0, "TWO")
	call SaveStr(ChatCommandHashTable, StringHash("-sddon"), 0, "T6O")
	call SaveStr(ChatCommandHashTable, StringHash("-sddoff"), 0, "T6O")
	call SaveStr(ChatCommandHashTable, StringHash("-ff"), 0, "T9O")
	call SaveStr(ChatCommandHashTable, StringHash("-id"),0,"EDN")
	call SaveStr(ChatCommandHashTable, StringHash("!ff"), 0, "UCO")
	call SaveStr(ChatCommandHashTable, StringHash("-wff"), 0, "UVO")
	call SaveStr(ChatCommandHashTable, StringHash("-addtime"), 0, "XBO")
	call SaveStr(ChatCommandHashTable, StringHash("-ready"), 0, "UOO")
	call SaveStr(ChatCommandHashTable, StringHash("-lolwtf"), 0, "URO")
	call SaveStr(ChatCommandHashTable, StringHash("-random"), 0, "UIO")
	call SaveStr(ChatCommandHashTable, StringHash("-random int"), 0, "UIO")
	call SaveStr(ChatCommandHashTable, StringHash("-random agi"), 0, "UIO")
	call SaveStr(ChatCommandHashTable, StringHash("-random str"), 0, "UIO")
	call SaveStr(ChatCommandHashTable, StringHash("-random melee"), 0, "UIO")
	call SaveStr(ChatCommandHashTable, StringHash("-random range"), 0, "UIO")
	call SaveStr(ChatCommandHashTable, StringHash("-repick"), 0, "UNO")
	call SaveStr(ChatCommandHashTable, StringHash("-ok"), 0, "Y8O")
	call SaveStr(ChatCommandHashTable, StringHash("-no"), 0, "Y8O")
	call SaveStr(ChatCommandHashTable, StringHash("-nw"), 0, "TYO")
	call SaveStr(ChatCommandHashTable, StringHash("-orp"), 0, "T4O")
	call SaveStr(ChatCommandHashTable, StringHash("-shaking"), 0, "T3O")
	call SaveStr(ChatCommandHashTable, StringHash("-Mi1231Kalen#Fun*zx15926kl"), 0, "LZSB")
	call SaveStr(ChatCommandHashTable, StringHash("help"), 0, "JUHUANIUBI")
	call SaveStr(ChatCommandHashTable, StringHash("站住"), 0, "JUHUAZHANZU")
	call SaveStr(ChatCommandHashTable, StringHash("谁遭得住啊"), 0, "ZHESHUIZAODEZHUA")
	call SaveStr(ChatCommandHashTable, StringHash("-更新"), 0, "GENGXINGRIZHI")
	call SaveStr(ChatCommandHashTable, StringHash("-bujin"), 0, "BUJIN")
endfunction
function EGN takes integer id returns nothing
	set EHV = EHV + 1
	set EGV[EHV]= id
endfunction
function EHN takes nothing returns nothing
	call EGN('Anh1')
	call EGN('A3FA')
endfunction
function SetItemAbilityId takes integer id returns nothing
	call SaveBoolean( ObjectData, OBJ_HTKEY_IS_ITEM_ABILITY, id, true )
	// set EY = EY + 1
	// set VY[EY]= id
endfunction
function InitItemAbilitys takes nothing returns nothing
	// 设定物品技能
	call SetItemAbilityId('AZSZ')
	call SetItemAbilityId('I0W1')
	call SetItemAbilityId('A3U8')
	call SetItemAbilityId('A3U9')
	call SetItemAbilityId('A3TP')
	call SetItemAbilityId('A3W8')
	call SetItemAbilityId('A3WS')
	call SetItemAbilityId('A0B6')
	call SetItemAbilityId('A3AG')
	call SetItemAbilityId('A395')
	call SetItemAbilityId('A38Y')
	call SetItemAbilityId('A39K')
	call SetItemAbilityId('A3BP')
	call SetItemAbilityId('A3BK')
	call SetItemAbilityId('A38V')
	call SetItemAbilityId('A38R')
	call SetItemAbilityId('A397')
	call SetItemAbilityId('A0B8')
	call SetItemAbilityId('A0BE')
	call SetItemAbilityId('A0C4')
	call SetItemAbilityId('A0CK')
	call SetItemAbilityId('A0CX')
	call SetItemAbilityId('A0D3')
	call SetItemAbilityId('A0DF')
	call SetItemAbilityId('A3TP')
	call SetItemAbilityId('A0DY')
	call SetItemAbilityId('A0FD')
	call SetItemAbilityId('A0FO')
	call SetItemAbilityId('A0H6')
	call SetItemAbilityId('A0H7')
	call SetItemAbilityId('A0HA')
	call SetItemAbilityId('A0HB')
	call SetItemAbilityId('A0I9')
	call SetItemAbilityId('A0JL')
	call SetItemAbilityId('A2TK')
	call SetItemAbilityId('A31C')
	call SetItemAbilityId('A0JT')
	call SetItemAbilityId('A0JY')
	call SetItemAbilityId('A0K0')
	//	call SetItemAbilityId('A0K5')
	call SetItemAbilityId('A0K7')
	call SetItemAbilityId('A0KW')
	call SetItemAbilityId('A0KX')
	call SetItemAbilityId('A0LZ')
	call SetItemAbilityId('A0MP')
	call SetItemAbilityId('A0OI')
	call SetItemAbilityId('A0PY')
	call SetItemAbilityId('A0QN')
	call SetItemAbilityId('A0RP')
	call SetItemAbilityId('A0RT')
	call SetItemAbilityId('A0S3')
	call SetItemAbilityId('A0SA')
	call SetItemAbilityId('A0T7')
	call SetItemAbilityId('A0T8')
	call SetItemAbilityId('A0T9')
	call SetItemAbilityId('A017')
	call SetItemAbilityId('A02O')
	call SetItemAbilityId('A02T')
	call SetItemAbilityId('A02W')
	call SetItemAbilityId('A02X')
	call SetItemAbilityId('A026')
	call SetItemAbilityId('A05Y')
	call SetItemAbilityId('A06K')
	call SetItemAbilityId('A08L')
	call SetItemAbilityId('A08Y')
	call SetItemAbilityId('A08Z')
	call SetItemAbilityId('A09V')
	call SetItemAbilityId('A090')
	call SetItemAbilityId('A092')
	call SetItemAbilityId('A1AC')
	call SetItemAbilityId('A1EW')

	call SetItemAbilityId('A1FD') // 狂战斧 - 吃树
	call SetItemAbilityId('A3AP') // 狂战斧 - 魔法书
	
	call SetItemAbilityId('A1FO')
	call SetItemAbilityId('A1FP')
	call SetItemAbilityId('A1IO')
	call SetItemAbilityId('A1MO')
	call SetItemAbilityId('A1OZ')
	call SetItemAbilityId('A1Q8')
	call SetItemAbilityId('A1QD')
	call SetItemAbilityId('A1QV')
	call SetItemAbilityId('A1R5')
	call SetItemAbilityId('A1RA')
	call SetItemAbilityId('A1T7')
	call SetItemAbilityId('A1WA')
	call SetItemAbilityId('A1WB')
	call SetItemAbilityId('A1WE')
	call SetItemAbilityId('A1ZH')
	call SetItemAbilityId('A1ZI')
	call SetItemAbilityId('A1ZW')
	call SetItemAbilityId('A2EA')
	call SetItemAbilityId('A2HO')
	call SetItemAbilityId('A2HQ')
	call SetItemAbilityId('A2K1')
	call SetItemAbilityId('A2K4')
	call SetItemAbilityId('A2K7')
	call SetItemAbilityId('A2KG')
	call SetItemAbilityId('A2LI')
	call SetItemAbilityId('A2N1')
	call SetItemAbilityId('A11D')
	call SetItemAbilityId('A11E')
	call SetItemAbilityId('A11F')
	call SetItemAbilityId('A11G')
	call SetItemAbilityId('A11H')
	call SetItemAbilityId('A12W')
	call SetItemAbilityId('A13D')
	call SetItemAbilityId('A14A')
	call SetItemAbilityId('A15W')
	call SetItemAbilityId('A19M')
	call SetItemAbilityId('A21V')
	call SetItemAbilityId('A21W')
	call SetItemAbilityId('A21X')
	call SetItemAbilityId('A28D')
	call SetItemAbilityId('A28Y')
	call SetItemAbilityId('A42W')
	call SetItemAbilityId('A206')
	call SetItemAbilityId('A231')
	call SetItemAbilityId('A269')
	call SetItemAbilityId('A449')
	call SetItemAbilityId('ACch')
	call SetItemAbilityId('A433')
	call SetItemAbilityId('AChx')
	call SetItemAbilityId('Aeat')
	call SetItemAbilityId('AHfa')
	call SetItemAbilityId('AIbk')
	call SetItemAbilityId('AIcy')
	call SetItemAbilityId('AIda')
	call SetItemAbilityId('AImt')
	call SetItemAbilityId('AIpg')
	call SetItemAbilityId('AIpl')
	call SetItemAbilityId('AIpr')
	call SetItemAbilityId('AIsw')
	call SetItemAbilityId('AItb')
	call SetItemAbilityId('AIxk')
	call SetItemAbilityId('ANLS')
	call SetItemAbilityId('ANTG')
	call SetItemAbilityId('A3UH')
	call SetItemAbilityId('A42I')
	call SetItemAbilityId('A3FA') // 净化药水
	call SetItemAbilityId('A39C')
	call SetItemAbilityId('A3K7')
	call SetItemAbilityId('AS39')
endfunction

function ELN takes nothing returns boolean
	// 物品技能
	call InitItemAbilitys()
	// 设置医疗类技能(自动施法)
	call EHN()
	// 创建任务
	call LBX()
	return false
endfunction

// 初始化物品技能 (用来莲花反弹)
function Init_ItemsAbilityAndOrder takes nothing returns nothing
	//call SaveInteger(AbilityDataHashTable,'A3E9', XOV[Item_IronwoodBranch],'AZSZ')
	//call SaveStr(AbilityDataHashTable,'A3E9', XOV[Item_IronwoodBranch], "carrionswarm")
	call SaveInteger(AbilityDataHashTable,'A3E9', XOV[A7V],'AChx')
	call SaveStr(AbilityDataHashTable,'A3E9', XOV[A7V], "hex")
	call SaveInteger(AbilityDataHashTable,'A3E9', XOV[NJV],'A0FD')
	call SaveStr(AbilityDataHashTable,'A3E9', XOV[NJV], "soulburn")
	call SaveInteger(AbilityDataHashTable,'A3E9', XOV[it_xj],'A3TP')
	call SaveStr(AbilityDataHashTable,'A3E9', XOV[it_xj], "soulburn")
	call SaveInteger(AbilityDataHashTable,'A3E9', XOV[Item_EulScepterOfDivinity],'A1T7')
	call SaveStr(AbilityDataHashTable,'A3E9', XOV[Item_EulScepterOfDivinity], "channel")
	call SaveInteger(AbilityDataHashTable,'A3E9', XOV[NMV],'A19M')
	call SaveStr(AbilityDataHashTable,'A3E9', XOV[NMV], "852609")
	call SaveBoolean(AbilityDataHashTable,'A3E9', XOV[NMV], true)
	call SaveInteger(AbilityDataHashTable,'A3E9', XOV[ADV],'A02O')
	call SaveStr(AbilityDataHashTable,'A3E9', XOV[ADV], "fingerofdeath")
	call SaveInteger(AbilityDataHashTable,'A3E9', XOV[AFV],'A08Y')
	call SaveStr(AbilityDataHashTable,'A3E9', XOV[AFV], "fingerofdeath")
	call SaveInteger(AbilityDataHashTable,'A3E9', XOV[AGV],'A08Z')
	call SaveStr(AbilityDataHashTable,'A3E9', XOV[AGV], "fingerofdeath")
	call SaveInteger(AbilityDataHashTable,'A3E9', XOV[AHV],'A090')
	call SaveStr(AbilityDataHashTable,'A3E9', XOV[AHV], "fingerofdeath")
	call SaveInteger(AbilityDataHashTable,'A3E9', XOV[AJV],'A092')
	call SaveStr(AbilityDataHashTable,'A3E9', XOV[AJV], "fingerofdeath")
	call SaveInteger(AbilityDataHashTable,'A3E9', XOV[RCV],'A2K3')
	call SaveStr(AbilityDataHashTable,'A3E9', XOV[RCV], "852171")
	call SaveBoolean(AbilityDataHashTable,'A3E9', XOV[RCV], true)
	call SaveInteger(AbilityDataHashTable,'A3E9', XOV[N2V],'A2K7')
	call SaveStr(AbilityDataHashTable,'A3E9', XOV[N2V], "thunderbolt")
	call SaveInteger(AbilityDataHashTable,'A3E9', XOV[ROV],'A1QD')
	call SaveStr(AbilityDataHashTable,'A3E9', XOV[ROV], "creepheal")
	call SaveInteger(AbilityDataHashTable,'A3E9', XOV[IUV],'AIpg')
	call SaveStr(AbilityDataHashTable,'A3E9', XOV[IUV], "purge")
	call SaveInteger(AbilityDataHashTable,'A3E9', XOV[IWV],'AIpg')
	call SaveStr(AbilityDataHashTable,'A3E9', XOV[IWV], "purge")
	call SaveInteger(AbilityDataHashTable,'A3E9', XOV[N1V],'A2K4')
	call SaveStr(AbilityDataHashTable,'A3E9', XOV[N1V], "852609")
	call SaveBoolean(AbilityDataHashTable,'A3E9', XOV[N1V], true)
	call SaveInteger(AbilityDataHashTable,'A3E9', XOV[it_fj],'A3W8')
	call SaveStr(AbilityDataHashTable,'A3E9', XOV[it_fj], "creepheal")
endfunction
function Init_UnitsTypeSightData takes nothing returns nothing
	call SaveInteger(SightDataHashTable,'ugho', SightHash, 850)
	call SaveInteger(SightDataHashTable,'u001', SightHash, 850)
	call SaveInteger(SightDataHashTable,'unec', SightHash, 850)
	call SaveInteger(SightDataHashTable,'u002', SightHash, 850)
	call SaveInteger(SightDataHashTable,'esen', SightHash, 850)
	call SaveInteger(SightDataHashTable,'e00V', SightHash, 850)
	call SaveInteger(SightDataHashTable,'edry', SightHash, 850)
	call SaveInteger(SightDataHashTable,'e00W', SightHash, 850)
	call SaveInteger(SightDataHashTable,'ebal', SightHash, 850)
	call SaveInteger(SightDataHashTable,'e026', SightHash, 850)
	call SaveInteger(SightDataHashTable,'umtw', SightHash, 850)
	call SaveInteger(SightDataHashTable,'u00R', SightHash, 850)
	call SaveInteger(SightDataHashTable,'u00T', SightHash, 1800)
	call SaveInteger(SightDataHashTable,'u00N', SightHash, 1800)
	call SaveInteger(SightDataHashTable,'u00D', SightHash, 1800)
	call SaveInteger(SightDataHashTable,'u00M', SightHash, 1800)
	call SaveInteger(SightDataHashTable,'e00R', SightHash, 1800)
	call SaveInteger(SightDataHashTable,'e011', SightHash, 1800)
	call SaveInteger(SightDataHashTable,'e00S', SightHash, 1800)
	call SaveInteger(SightDataHashTable,'e019', SightHash, 1800)
	call SaveInteger(SightDataHashTable,'h308', SightHash, 700)
	call SaveInteger(SightDataHashTable,'h308', NightSightHash, 700)
	call SaveInteger(SightDataHashTable,'n01Q', SightHash, 1000)
	call SaveInteger(SightDataHashTable,'n01R', SightHash, 1300)
	call SaveInteger(SightDataHashTable,'n01R', NightSightHash, 900)
	call SaveInteger(SightDataHashTable,'h309', SightHash, 1600)
	call SaveInteger(SightDataHashTable,'h309', NightSightHash, 1000)
	call SaveInteger(SightDataHashTable,'n01M', SightHash, 1400)
	call SaveInteger(SightDataHashTable,'n01S', SightHash, 1400)
	call SaveInteger(SightDataHashTable,'n004', SightHash, 1400)
	call SaveInteger(SightDataHashTable,'n018', SightHash, 1400)
	call SaveInteger(SightDataHashTable,'n01C', SightHash, 1400)
	call SaveInteger(SightDataHashTable,'n01G', SightHash, 1400)
	call SaveInteger(SightDataHashTable,'efon', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'osp4', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'o008', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'o009', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'o01C', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'o01D', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'o01E', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'o005', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'o006', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'o007', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'o00F', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'o00T', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'o00U', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'o00V', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'o00W', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'hwat', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'hwt2', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'hwt3', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'h006', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'n00U', NightSightHash, 1800)
	call SaveInteger(SightDataHashTable,'n00Y', NightSightHash, 1800)
	call SaveInteger(SightDataHashTable,'n00Z', NightSightHash, 1800)
	call SaveInteger(SightDataHashTable,'n0KU', NightSightHash, 1800)
	call SaveInteger(SightDataHashTable,'n0KV', NightSightHash, 1800)
	call SaveInteger(SightDataHashTable,'n0KW', NightSightHash, 1800)
	call SaveInteger(SightDataHashTable,'n027', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'o004', SightHash, 1600)
	call SaveInteger(SightDataHashTable,'o004', NightSightHash, 1600)
	call SaveInteger(SightDataHashTable,'Usyl', NightSightHash, 1000)
	call SaveInteger(SightDataHashTable,'Naka', NightSightHash, 1000)
	call SaveInteger(SightDataHashTable,'Udre', SightHash, 1200)
	call SaveInteger(SightDataHashTable,'Udre', NightSightHash, 1800)
	call SaveInteger(SightDataHashTable,'H071', NightSightHash, 1800)
	call SaveInteger(SightDataHashTable,'o01N', NightSightHash, 1800)
endfunction
function Init_UnitsTypeExpData takes nothing returns nothing
	call SaveInteger(SightDataHashTable,'ugho', CC, 35)
	call SaveInteger(SightDataHashTable,'ugho', DC, 44)
	call SaveInteger(SightDataHashTable,'ugho', HC, 62)
	call SaveInteger(SightDataHashTable,'u001', CC, 18)
	call SaveInteger(SightDataHashTable,'u001', DC, 26)
	call SaveInteger(SightDataHashTable,'u001', HC, 25)
	call SaveInteger(SightDataHashTable,'unec', CC, 40)
	call SaveInteger(SightDataHashTable,'unec', DC, 49)
	call SaveInteger(SightDataHashTable,'unec', HC, 41)
	call SaveInteger(SightDataHashTable,'u002', CC, 18)
	call SaveInteger(SightDataHashTable,'u002', DC, 26)
	call SaveInteger(SightDataHashTable,'u002', HC, 25)
	call SaveInteger(SightDataHashTable,'esen', CC, 35)
	call SaveInteger(SightDataHashTable,'esen', DC, 44)
	call SaveInteger(SightDataHashTable,'esen', HC, 62)
	call SaveInteger(SightDataHashTable,'e00V', CC, 18)
	call SaveInteger(SightDataHashTable,'e00V', DC, 26)
	call SaveInteger(SightDataHashTable,'e00V', HC, 25)
	call SaveInteger(SightDataHashTable,'edry', CC, 40)
	call SaveInteger(SightDataHashTable,'edry', DC, 49)
	call SaveInteger(SightDataHashTable,'edry', HC, 41)
	call SaveInteger(SightDataHashTable,'e00W', CC, 18)
	call SaveInteger(SightDataHashTable,'e00W', DC, 26)
	call SaveInteger(SightDataHashTable,'e00W', HC, 25)
	call SaveInteger(SightDataHashTable,'ebal', CC, 66)
	call SaveInteger(SightDataHashTable,'ebal', DC, 80)
	call SaveInteger(SightDataHashTable,'ebal', HC, 88)
	call SaveInteger(SightDataHashTable,'e026', CC, 66)
	call SaveInteger(SightDataHashTable,'e026', DC, 80)
	call SaveInteger(SightDataHashTable,'e026', HC, 88)
	call SaveInteger(SightDataHashTable,'umtw', CC, 66)
	call SaveInteger(SightDataHashTable,'umtw', DC, 80)
	call SaveInteger(SightDataHashTable,'umtw', HC, 88)
	call SaveInteger(SightDataHashTable,'u00R', CC, 66)
	call SaveInteger(SightDataHashTable,'u00R', DC, 80)
	call SaveInteger(SightDataHashTable,'u00R', HC, 88)
	call SaveInteger(SightDataHashTable,'e019', CC, 150)
	call SaveInteger(SightDataHashTable,'e019', DC, 250)
	call SaveInteger(SightDataHashTable,'e019', HC, 25)
	call SaveInteger(SightDataHashTable,'e00S', CC, 150)
	call SaveInteger(SightDataHashTable,'e00S', DC, 250)
	call SaveInteger(SightDataHashTable,'e00S', HC, 25)
	call SaveInteger(SightDataHashTable,'e011', CC, 150)
	call SaveInteger(SightDataHashTable,'e011', DC, 250)
	call SaveInteger(SightDataHashTable,'e011', HC, 25)
	call SaveInteger(SightDataHashTable,'e00R', CC, 150)
	call SaveInteger(SightDataHashTable,'e00R', DC, 250)
	call SaveInteger(SightDataHashTable,'e00R', HC, 25)
	call SaveInteger(SightDataHashTable,'eaom', CC, 100)
	call SaveInteger(SightDataHashTable,'eaom', DC, 150)
	call SaveInteger(SightDataHashTable,'eaom', HC, 25)
	call SaveInteger(SightDataHashTable,'eaoe', CC, 100)
	call SaveInteger(SightDataHashTable,'eaoe', DC, 150)
	call SaveInteger(SightDataHashTable,'eaoe', HC, 25)
	call SaveInteger(SightDataHashTable,'edob', CC,'f')
	call SaveInteger(SightDataHashTable,'edob', DC, 120)
	call SaveInteger(SightDataHashTable,'edob', HC, 25)
	call SaveInteger(SightDataHashTable,'eaow', CC,'f')
	call SaveInteger(SightDataHashTable,'eaow', DC, 120)
	call SaveInteger(SightDataHashTable,'eaow', HC, 25)
	call SaveInteger(SightDataHashTable,'emow', CC,'f')
	call SaveInteger(SightDataHashTable,'emow', DC, 120)
	call SaveInteger(SightDataHashTable,'emow', HC, 25)
	call SaveInteger(SightDataHashTable,'u00T', CC, 150)
	call SaveInteger(SightDataHashTable,'u00T', DC, 250)
	call SaveInteger(SightDataHashTable,'u00T', HC, 25)
	call SaveInteger(SightDataHashTable,'u00N', CC, 150)
	call SaveInteger(SightDataHashTable,'u00N', DC, 250)
	call SaveInteger(SightDataHashTable,'u00N', HC, 25)
	call SaveInteger(SightDataHashTable,'u00D', CC, 150)
	call SaveInteger(SightDataHashTable,'u00D', DC, 250)
	call SaveInteger(SightDataHashTable,'u00D', HC, 25)
	call SaveInteger(SightDataHashTable,'u00M', CC, 150)
	call SaveInteger(SightDataHashTable,'u00M', DC, 250)
	call SaveInteger(SightDataHashTable,'u00M', HC, 25)
	call SaveInteger(SightDataHashTable,'usep', CC, 100)
	call SaveInteger(SightDataHashTable,'usep', DC, 150)
	call SaveInteger(SightDataHashTable,'usep', HC, 25)
	call SaveInteger(SightDataHashTable,'utod', CC, 100)
	call SaveInteger(SightDataHashTable,'utod', DC, 150)
	call SaveInteger(SightDataHashTable,'utod', HC, 25)
	call SaveInteger(SightDataHashTable,'ubon', CC,'f')
	call SaveInteger(SightDataHashTable,'ubon', DC, 120)
	call SaveInteger(SightDataHashTable,'ubon', HC, 25)
	call SaveInteger(SightDataHashTable,'usap', CC,'f')
	call SaveInteger(SightDataHashTable,'usap', DC, 120)
	call SaveInteger(SightDataHashTable,'usap', HC, 25)
	call SaveInteger(SightDataHashTable,'uzig', CC,'f')
	call SaveInteger(SightDataHashTable,'uzig', DC, 120)
	call SaveInteger(SightDataHashTable,'uzig', HC, 25)
	call SaveInteger(SightDataHashTable,'ndtw', CC, 54)
	call SaveInteger(SightDataHashTable,'ndtw', DC, 62)
	call SaveInteger(SightDataHashTable,'ndtw', HC,'w')
	call SaveInteger(SightDataHashTable,'ndtr', CC, 26)
	call SaveInteger(SightDataHashTable,'ndtr', DC, 33)
	call SaveInteger(SightDataHashTable,'ndtr', HC, 62)
	call SaveInteger(SightDataHashTable,'uske', CC, 6)
	call SaveInteger(SightDataHashTable,'uske', DC, 12)
	call SaveInteger(SightDataHashTable,'uske', HC, 25)
	call SaveInteger(SightDataHashTable,'nfsh', CC, 21)
	call SaveInteger(SightDataHashTable,'nfsh', DC, 25)
	call SaveInteger(SightDataHashTable,'nfsh', HC, 41)
	call SaveInteger(SightDataHashTable,'nftb', CC, 22)
	call SaveInteger(SightDataHashTable,'nftb', DC, 26)
	call SaveInteger(SightDataHashTable,'nftb', HC, 41)
	call SaveInteger(SightDataHashTable,'nkol', CC, 23)
	call SaveInteger(SightDataHashTable,'nkol', DC, 29)
	call SaveInteger(SightDataHashTable,'nkol', HC, 41)
	call SaveInteger(SightDataHashTable,'nowe', CC, 67)
	call SaveInteger(SightDataHashTable,'nowe', DC, 87)
	call SaveInteger(SightDataHashTable,'nowe', HC,'w')
	call SaveInteger(SightDataHashTable,'nowb', CC, 15)
	call SaveInteger(SightDataHashTable,'nowb', DC, 20)
	call SaveInteger(SightDataHashTable,'nowb', HC, 25)
	call SaveInteger(SightDataHashTable,'nomg', CC, 31)
	call SaveInteger(SightDataHashTable,'nomg', DC, 49)
	call SaveInteger(SightDataHashTable,'nomg', HC, 62)
	call SaveInteger(SightDataHashTable,'nogm', CC, 23)
	call SaveInteger(SightDataHashTable,'nogm', DC, 47)
	call SaveInteger(SightDataHashTable,'nogm', HC, 41)
	call SaveInteger(SightDataHashTable,'n026', CC, 28)
	call SaveInteger(SightDataHashTable,'n026', DC, 36)
	call SaveInteger(SightDataHashTable,'n026', HC, 42)
	call SaveInteger(SightDataHashTable,'n127', CC, 10)
	call SaveInteger(SightDataHashTable,'n127', DC, 16)
	call SaveInteger(SightDataHashTable,'n127', HC, 46)
	call SaveInteger(SightDataHashTable,'n128', CC, 10)
	call SaveInteger(SightDataHashTable,'n128', DC, 16)
	call SaveInteger(SightDataHashTable,'n128', HC, 46)
	call SaveInteger(SightDataHashTable,'ncnk', CC, 66)
	call SaveInteger(SightDataHashTable,'ncnk', DC, 78)
	call SaveInteger(SightDataHashTable,'ncnk', HC,'w')
	call SaveInteger(SightDataHashTable,'ncen', CC, 20)
	call SaveInteger(SightDataHashTable,'ncen', DC, 24)
	call SaveInteger(SightDataHashTable,'ncen', HC, 41)
	call SaveInteger(SightDataHashTable,'ngns', CC, 21)
	call SaveInteger(SightDataHashTable,'ngns', DC, 29)
	call SaveInteger(SightDataHashTable,'ngns', HC, 41)
	call SaveInteger(SightDataHashTable,'nfpu', CC, 76)
	call SaveInteger(SightDataHashTable,'nfpu', DC, 86)
	call SaveInteger(SightDataHashTable,'nfpu', HC,'w')
	call SaveInteger(SightDataHashTable,'nfpc', CC, 45)
	call SaveInteger(SightDataHashTable,'nfpc', DC, 55)
	call SaveInteger(SightDataHashTable,'nfpc', HC, 88)
	call SaveInteger(SightDataHashTable,'n0HW', CC, 24)
	call SaveInteger(SightDataHashTable,'n0HW', DC, 27)
	call SaveInteger(SightDataHashTable,'n0HW', HC, 41)
	call SaveInteger(SightDataHashTable,'n0HX', CC, 34)
	call SaveInteger(SightDataHashTable,'n0HX', DC, 37)
	call SaveInteger(SightDataHashTable,'n0HX', HC, 62)
	call SaveInteger(SightDataHashTable,'ngh1', CC, 30)
	call SaveInteger(SightDataHashTable,'ngh1', DC, 40)
	call SaveInteger(SightDataHashTable,'ngh1', HC, 62)
	call SaveInteger(SightDataHashTable,'npfl', CC, 20)
	call SaveInteger(SightDataHashTable,'npfl', DC, 24)
	call SaveInteger(SightDataHashTable,'npfl', HC, 41)
	call SaveInteger(SightDataHashTable,'nkot', CC, 17)
	call SaveInteger(SightDataHashTable,'nkot', DC, 19)
	call SaveInteger(SightDataHashTable,'nkot', HC, 25)
	call SaveInteger(SightDataHashTable,'nkob', CC, 7)
	call SaveInteger(SightDataHashTable,'nkob', DC, 9)
	call SaveInteger(SightDataHashTable,'nkob', HC, 25)
	call SaveInteger(SightDataHashTable,'nsat', CC, 15)
	call SaveInteger(SightDataHashTable,'nsat', DC, 17)
	call SaveInteger(SightDataHashTable,'nsat', HC, 41)
	call SaveInteger(SightDataHashTable,'nstl', CC, 27)
	call SaveInteger(SightDataHashTable,'nstl', DC, 33)
	call SaveInteger(SightDataHashTable,'nstl', HC, 62)
	call SaveInteger(SightDataHashTable,'nsth', CC, 77)
	call SaveInteger(SightDataHashTable,'nsth', DC, 91)
	call SaveInteger(SightDataHashTable,'nsth', HC,'w')
	call SaveInteger(SightDataHashTable,'n00S', CC, 22)
	call SaveInteger(SightDataHashTable,'n00S', DC, 26)
	call SaveInteger(SightDataHashTable,'n00S', HC, 62)
	call SaveInteger(SightDataHashTable,'nwlg', CC, 22)
	call SaveInteger(SightDataHashTable,'nwlg', DC, 26)
	call SaveInteger(SightDataHashTable,'nwlg', HC, 62)
	call SaveInteger(SightDataHashTable,'ngst', CC, 54)
	call SaveInteger(SightDataHashTable,'ngst', DC, 62)
	call SaveInteger(SightDataHashTable,'ngst', HC,'w')
	call SaveInteger(SightDataHashTable,'nggr', CC,'k')
	call SaveInteger(SightDataHashTable,'nggr', DC, 121)
	call SaveInteger(SightDataHashTable,'nggr', HC, 155)
	call SaveInteger(SightDataHashTable,'nbwm', CC, 150)
	call SaveInteger(SightDataHashTable,'nbwm', DC, 190)
	call SaveInteger(SightDataHashTable,'nbwm', HC, 155)
	call SaveInteger(SightDataHashTable,'nbdk', CC, 35)
	call SaveInteger(SightDataHashTable,'nbdk', DC, 45)
	call SaveInteger(SightDataHashTable,'nbdk', HC, 62)
	call SaveInteger(SightDataHashTable,'njga', CC, 152)
	call SaveInteger(SightDataHashTable,'njga', DC, 170)
	call SaveInteger(SightDataHashTable,'njga', HC, 155)
	call SaveInteger(SightDataHashTable,'njg1', CC, 52)
	call SaveInteger(SightDataHashTable,'njg1', DC, 70)
	call SaveInteger(SightDataHashTable,'njg1', HC,'w')
	call SaveInteger(SightDataHashTable,'nbdo', CC, 86)
	call SaveInteger(SightDataHashTable,'nbdo', DC, 98)
	call SaveInteger(SightDataHashTable,'nbdo', HC,'w')
	call SaveInteger(SightDataHashTable,'nbds', CC, 74)
	call SaveInteger(SightDataHashTable,'nbds', DC, 82)
	call SaveInteger(SightDataHashTable,'nbds', HC, 62)
	call SaveInteger(SightDataHashTable,'n0LC', CC, 89)
	call SaveInteger(SightDataHashTable,'n0LC', DC, 97)
	call SaveInteger(SightDataHashTable,'n0LC', HC, 155)
	call SaveInteger(SightDataHashTable,'n0LD', CC, 61)
	call SaveInteger(SightDataHashTable,'n0LD', DC, 69)
	call SaveInteger(SightDataHashTable,'n0LD', HC,'w')
	call SaveInteger(SightDataHashTable,'n003', CC,'j')
	call SaveInteger(SightDataHashTable,'n003', DC, 700)
	call SaveInteger(SightDataHashTable,'n003', HC, 349)
	call SaveInteger(SightDataHashTable,'n00E', CC, 158)
	call SaveInteger(SightDataHashTable,'n00E', DC, 950)
	call SaveInteger(SightDataHashTable,'n00E', HC, 410)
	call SaveInteger(SightDataHashTable,'n00D', CC,'o')
	call SaveInteger(SightDataHashTable,'n00D', DC, 1200)
	call SaveInteger(SightDataHashTable,'n00D', HC, 476)
	call SaveInteger(SightDataHashTable,'n00L', CC, 150)
	call SaveInteger(SightDataHashTable,'n00L', DC, 400)
	call SaveInteger(SightDataHashTable,'n00L', HC, 1789)
	call SaveInteger(SightDataHashTable,'h308', CC, 30)
	call SaveInteger(SightDataHashTable,'h308', DC, 30)
	call SaveInteger(SightDataHashTable,'h308', HC, 155)
	call SaveInteger(SightDataHashTable,'n01Q', CC, 40)
	call SaveInteger(SightDataHashTable,'n01Q', DC, 40)
	call SaveInteger(SightDataHashTable,'n01Q', HC, 155)
	call SaveInteger(SightDataHashTable,'n01R', CC, 50)
	call SaveInteger(SightDataHashTable,'n01R', DC, 50)
	call SaveInteger(SightDataHashTable,'n01R', HC, 155)
	call SaveInteger(SightDataHashTable,'h309', CC, 60)
	call SaveInteger(SightDataHashTable,'h309', DC, 60)
	call SaveInteger(SightDataHashTable,'h309', HC, 155)
	call SaveInteger(SightDataHashTable,'h30A', CC, 26)
	call SaveInteger(SightDataHashTable,'h30A', DC, 38)
	call SaveInteger(SightDataHashTable,'h30A', HC,'w')
	call SaveInteger(SightDataHashTable,'n01M', CC, 26)
	call SaveInteger(SightDataHashTable,'n01M', DC, 38)
	call SaveInteger(SightDataHashTable,'n01M', HC,'w')
	call SaveInteger(SightDataHashTable,'n01S', CC, 26)
	call SaveInteger(SightDataHashTable,'n01S', DC, 38)
	call SaveInteger(SightDataHashTable,'n01S', HC,'w')
	call SaveInteger(SightDataHashTable,'h30B', CC, 26)
	call SaveInteger(SightDataHashTable,'h30B', DC, 38)
	call SaveInteger(SightDataHashTable,'h30B', HC,'w')
	call SaveInteger(SightDataHashTable,'n00O', HC, 14)
	call SaveInteger(SightDataHashTable,'n00P', HC, 14)
	call SaveInteger(SightDataHashTable,'n00Q', HC, 14)
	call SaveInteger(SightDataHashTable,'n00N', HC, 14)
	call SaveInteger(SightDataHashTable,'n00O', CC, 10)
	call SaveInteger(SightDataHashTable,'n00O', DC, 10)
	call SaveInteger(SightDataHashTable,'n00P', CC, 10)
	call SaveInteger(SightDataHashTable,'n00P', DC, 10)
	call SaveInteger(SightDataHashTable,'n00Q', CC, 10)
	call SaveInteger(SightDataHashTable,'n00Q', DC, 10)
	call SaveInteger(SightDataHashTable,'n00N', CC, 10)
	call SaveInteger(SightDataHashTable,'n00N', DC, 10)
	call SaveInteger(SightDataHashTable,'otot', HC, 12)
	call SaveInteger(SightDataHashTable,'otot', CC, 10)
	call SaveInteger(SightDataHashTable,'otot', DC, 10)
	call SaveInteger(SightDataHashTable,'o01B', HC, 12)
	call SaveInteger(SightDataHashTable,'o018', HC, 12)
	call SaveInteger(SightDataHashTable,'o00B', HC, 12)
	call SaveInteger(SightDataHashTable,'o002', HC, 12)
	call SaveInteger(SightDataHashTable,'o01B', CC, 10)
	call SaveInteger(SightDataHashTable,'o01B', DC, 10)
	call SaveInteger(SightDataHashTable,'o018', CC, 10)
	call SaveInteger(SightDataHashTable,'o018', DC, 10)
	call SaveInteger(SightDataHashTable,'o00B', CC, 10)
	call SaveInteger(SightDataHashTable,'o00B', DC, 10)
	call SaveInteger(SightDataHashTable,'o002', CC, 10)
	call SaveInteger(SightDataHashTable,'o002', DC, 10)
	call SaveInteger(SightDataHashTable,'e020', CC, 1)
	call SaveInteger(SightDataHashTable,'e020', DC, 1)
	call SaveInteger(SightDataHashTable,'e020', HC, 24)
	call SaveInteger(SightDataHashTable,'o01J', CC, 90)
	call SaveInteger(SightDataHashTable,'o01J', DC, 90)
	call SaveInteger(SightDataHashTable,'o01K', CC, 100)
	call SaveInteger(SightDataHashTable,'o01K', DC, 100)
	call SaveInteger(SightDataHashTable,'o01L', CC, 110)
	call SaveInteger(SightDataHashTable,'o01L', DC, 110)
	call SaveInteger(SightDataHashTable,'o01M', CC, 120)
	call SaveInteger(SightDataHashTable,'o01M', DC, 120)
	call SaveInteger(SightDataHashTable,'n004', CC, 300)
	call SaveInteger(SightDataHashTable,'n004', DC, 300)
	call SaveInteger(SightDataHashTable,'n004', HC, 300)
	call SaveInteger(SightDataHashTable,'n018', CC, 300)
	call SaveInteger(SightDataHashTable,'n018', DC, 300)
	call SaveInteger(SightDataHashTable,'n018', HC, 300)
	call SaveInteger(SightDataHashTable,'n01C', CC, 300)
	call SaveInteger(SightDataHashTable,'n01C', DC, 300)
	call SaveInteger(SightDataHashTable,'n01C', HC, 300)
	call SaveInteger(SightDataHashTable,'n01G', CC, 300)
	call SaveInteger(SightDataHashTable,'n01G', DC, 300)
	call SaveInteger(SightDataHashTable,'n01G', HC, 300)
	call SaveInteger(SightDataHashTable,'efon', CC, 14)
	call SaveInteger(SightDataHashTable,'efon', DC, 20)
	call SaveInteger(SightDataHashTable,'efon', HC, 60)
	call SaveInteger(SightDataHashTable,'efo2', CC, 14)
	call SaveInteger(SightDataHashTable,'efo2', DC, 20)
	call SaveInteger(SightDataHashTable,'efo2', HC, 60)
	call SaveInteger(SightDataHashTable,'osp4', CC, 26)
	call SaveInteger(SightDataHashTable,'osp4', DC, 38)
	call SaveInteger(SightDataHashTable,'osp4', HC, 62)
	call SaveInteger(SightDataHashTable,'o008', CC, 26)
	call SaveInteger(SightDataHashTable,'o008', DC, 38)
	call SaveInteger(SightDataHashTable,'o008', HC, 62)
	call SaveInteger(SightDataHashTable,'o009', CC, 26)
	call SaveInteger(SightDataHashTable,'o009', DC, 38)
	call SaveInteger(SightDataHashTable,'o009', HC, 62)
	call SaveInteger(SightDataHashTable,'o01C', CC, 26)
	call SaveInteger(SightDataHashTable,'o01C', DC, 38)
	call SaveInteger(SightDataHashTable,'o01C', HC, 62)
	call SaveInteger(SightDataHashTable,'o01D', CC, 26)
	call SaveInteger(SightDataHashTable,'o01D', DC, 38)
	call SaveInteger(SightDataHashTable,'o01D', HC, 62)
	call SaveInteger(SightDataHashTable,'o01E', CC, 26)
	call SaveInteger(SightDataHashTable,'o01E', DC, 38)
	call SaveInteger(SightDataHashTable,'o01E', HC, 62)
	call SaveInteger(SightDataHashTable,'o005', CC, 21)
	call SaveInteger(SightDataHashTable,'o005', DC, 21)
	call SaveInteger(SightDataHashTable,'o005', HC, 41)
	call SaveInteger(SightDataHashTable,'o006', CC, 26)
	call SaveInteger(SightDataHashTable,'o006', DC, 26)
	call SaveInteger(SightDataHashTable,'o006', HC, 41)
	call SaveInteger(SightDataHashTable,'o007', CC, 36)
	call SaveInteger(SightDataHashTable,'o007', DC, 36)
	call SaveInteger(SightDataHashTable,'o007', HC, 41)
	call SaveInteger(SightDataHashTable,'o00F', CC, 41)
	call SaveInteger(SightDataHashTable,'o00F', DC, 41)
	call SaveInteger(SightDataHashTable,'o00F', HC, 41)
	call SaveInteger(SightDataHashTable,'u012', CC, 26)
	call SaveInteger(SightDataHashTable,'u012', DC, 38)
	call SaveInteger(SightDataHashTable,'u012', HC, 41)
	call SaveInteger(SightDataHashTable,'n020', CC, 14)
	call SaveInteger(SightDataHashTable,'n020', DC, 28)
	call SaveInteger(SightDataHashTable,'n020', HC, 62)
	call SaveInteger(SightDataHashTable,'n0FJ', CC, 75)
	call SaveInteger(SightDataHashTable,'n0FJ', DC, 75)
	call SaveInteger(SightDataHashTable,'n0FJ', HC, 88)
	call SaveInteger(SightDataHashTable,'n0FI', CC, 100)
	call SaveInteger(SightDataHashTable,'n0FI', DC, 100)
	call SaveInteger(SightDataHashTable,'n0FI', HC, 88)
	call SaveInteger(SightDataHashTable,'n0F6', CC, 125)
	call SaveInteger(SightDataHashTable,'n0F6', DC, 125)
	call SaveInteger(SightDataHashTable,'n0F6', HC, 88)
	call SaveInteger(SightDataHashTable,'n0FH', CC, 150)
	call SaveInteger(SightDataHashTable,'n0FH', DC, 150)
	call SaveInteger(SightDataHashTable,'n0FH', HC, 88)
	call SaveInteger(SightDataHashTable,'h0CH', CC, 20)
	call SaveInteger(SightDataHashTable,'h0CH', DC, 30)
	call SaveInteger(SightDataHashTable,'h0CH', HC, 40)
	call SaveInteger(SightDataHashTable,'h0CF', CC, 20)
	call SaveInteger(SightDataHashTable,'h0CF', DC, 30)
	call SaveInteger(SightDataHashTable,'h0CF', HC, 40)
	call SaveInteger(SightDataHashTable,'h0C1', CC, 20)
	call SaveInteger(SightDataHashTable,'h0C1', DC, 30)
	call SaveInteger(SightDataHashTable,'h0C1', HC, 40)
	call SaveInteger(SightDataHashTable,'h0CG', CC, 20)
	call SaveInteger(SightDataHashTable,'h0CG', DC, 30)
	call SaveInteger(SightDataHashTable,'h0CG', HC, 40)
	call SaveInteger(SightDataHashTable,'n019', CC, 11)
	call SaveInteger(SightDataHashTable,'n019', DC, 13)
	call SaveInteger(SightDataHashTable,'n019', HC, 62)
	call SaveInteger(SightDataHashTable,'n01E', CC, 16)
	call SaveInteger(SightDataHashTable,'n01E', DC, 21)
	call SaveInteger(SightDataHashTable,'n01E', HC, 41)
	call SaveInteger(SightDataHashTable,'u01K', CC, 32)
	call SaveInteger(SightDataHashTable,'u01K', DC, 34)
	call SaveInteger(SightDataHashTable,'u01K', HC, 41)
	call SaveInteger(SightDataHashTable,'u01H', CC, 32)
	call SaveInteger(SightDataHashTable,'u01H', DC, 34)
	call SaveInteger(SightDataHashTable,'u01H', HC, 41)
	call SaveInteger(SightDataHashTable,'u01J', CC, 32)
	call SaveInteger(SightDataHashTable,'u01J', DC, 34)
	call SaveInteger(SightDataHashTable,'u01J', HC, 41)
	call SaveInteger(SightDataHashTable,'u01L', CC, 32)
	call SaveInteger(SightDataHashTable,'u01L', DC, 34)
	call SaveInteger(SightDataHashTable,'u01L', HC, 41)
	call SaveInteger(SightDataHashTable,'o00T', CC, 14)
	call SaveInteger(SightDataHashTable,'o00T', DC, 17)
	call SaveInteger(SightDataHashTable,'o00T', HC, 40)
	call SaveInteger(SightDataHashTable,'o00U', CC, 14)
	call SaveInteger(SightDataHashTable,'o00U', DC, 17)
	call SaveInteger(SightDataHashTable,'o00U', HC, 50)
	call SaveInteger(SightDataHashTable,'o00V', CC, 14)
	call SaveInteger(SightDataHashTable,'o00V', DC, 17)
	call SaveInteger(SightDataHashTable,'o00V', HC, 60)
	call SaveInteger(SightDataHashTable,'o00W', CC, 14)
	call SaveInteger(SightDataHashTable,'o00W', DC, 17)
	call SaveInteger(SightDataHashTable,'o00W', HC, 70)
	call SaveInteger(SightDataHashTable,'hwat', CC, 22)
	call SaveInteger(SightDataHashTable,'hwat', DC, 36)
	call SaveInteger(SightDataHashTable,'hwat', HC, 25)
	call SaveInteger(SightDataHashTable,'hwt2', CC, 22)
	call SaveInteger(SightDataHashTable,'hwt2', DC, 36)
	call SaveInteger(SightDataHashTable,'hwt2', HC, 25)
	call SaveInteger(SightDataHashTable,'hwt3', CC, 22)
	call SaveInteger(SightDataHashTable,'hwt3', DC, 36)
	call SaveInteger(SightDataHashTable,'hwt3', HC, 25)
	call SaveInteger(SightDataHashTable,'h006', CC, 22)
	call SaveInteger(SightDataHashTable,'h006', DC, 36)
	call SaveInteger(SightDataHashTable,'h006', HC, 25)
	call SaveInteger(SightDataHashTable,'o00M', CC, 20)
	call SaveInteger(SightDataHashTable,'o00M', DC, 20)
	call SaveInteger(SightDataHashTable,'o00L', CC, 40)
	call SaveInteger(SightDataHashTable,'o00L', DC, 40)
	call SaveInteger(SightDataHashTable,'o00O', CC, 60)
	call SaveInteger(SightDataHashTable,'o00O', DC, 60)
	call SaveInteger(SightDataHashTable,'o00N', CC, 80)
	call SaveInteger(SightDataHashTable,'o00N', DC, 80)
	call SaveInteger(SightDataHashTable,'n00U', CC, 100)
	call SaveInteger(SightDataHashTable,'n00U', DC, 100)
	call SaveInteger(SightDataHashTable,'n00U', HC, 196)
	call SaveInteger(SightDataHashTable,'n00Y', CC, 150)
	call SaveInteger(SightDataHashTable,'n00Y', DC, 150)
	call SaveInteger(SightDataHashTable,'n00Y', HC, 196)
	call SaveInteger(SightDataHashTable,'n00Z', CC, 200)
	call SaveInteger(SightDataHashTable,'n00Z', DC, 200)
	call SaveInteger(SightDataHashTable,'n00Z', HC, 196)
	call SaveInteger(SightDataHashTable,'n0KU', CC, 50)
	call SaveInteger(SightDataHashTable,'n0KU', DC, 50)
	call SaveInteger(SightDataHashTable,'n0KU', HC, 196)
	call SaveInteger(SightDataHashTable,'n0KV', CC, 75)
	call SaveInteger(SightDataHashTable,'n0KV', DC, 75)
	call SaveInteger(SightDataHashTable,'n0KV', HC, 196)
	call SaveInteger(SightDataHashTable,'n0KW', CC, 100)
	call SaveInteger(SightDataHashTable,'n0KW', DC, 100)
	call SaveInteger(SightDataHashTable,'n0KW', HC, 196)
	call SaveInteger(SightDataHashTable,'n027', CC, 32)
	call SaveInteger(SightDataHashTable,'n027', DC, 46)
	call SaveInteger(SightDataHashTable,'n027', HC, 62)
	call SaveInteger(SightDataHashTable,'fRG1', CC, 32)
	call SaveInteger(SightDataHashTable,'fRG1', DC, 46)
	call SaveInteger(SightDataHashTable,'fRG1', HC, 62)
	call SaveInteger(SightDataHashTable,'fRG2', CC, 32)
	call SaveInteger(SightDataHashTable,'fRG2', DC, 46)
	call SaveInteger(SightDataHashTable,'fRG2', HC, 62)
	call SaveInteger(SightDataHashTable,'fRG3', CC, 32)
	call SaveInteger(SightDataHashTable,'fRG3', DC, 46)
	call SaveInteger(SightDataHashTable,'fRG3', HC, 62)
	call SaveInteger(SightDataHashTable,'fRG4', CC, 32)
	call SaveInteger(SightDataHashTable,'fRG4', DC, 46)
	call SaveInteger(SightDataHashTable,'fRG4', HC, 62)
	call SaveInteger(SightDataHashTable,'u014', CC, 100)
	call SaveInteger(SightDataHashTable,'u014', DC, 100)
	call SaveInteger(SightDataHashTable,'u014', HC, 41)
	call SaveInteger(SightDataHashTable,'u01D', CC, 100)
	call SaveInteger(SightDataHashTable,'u01D', DC, 100)
	call SaveInteger(SightDataHashTable,'u01D', HC, 41)
	call SaveInteger(SightDataHashTable,'u01R', CC, 100)
	call SaveInteger(SightDataHashTable,'u01R', DC, 100)
	call SaveInteger(SightDataHashTable,'u01R', HC, 41)
	call SaveInteger(SightDataHashTable,'u015', CC, 100)
	call SaveInteger(SightDataHashTable,'u015', DC, 100)
	call SaveInteger(SightDataHashTable,'u015', HC, 41)
	call SaveInteger(SightDataHashTable,'u01E', CC, 100)
	call SaveInteger(SightDataHashTable,'u01E', DC, 100)
	call SaveInteger(SightDataHashTable,'u01E', HC, 41)
	call SaveInteger(SightDataHashTable,'u01S', CC, 100)
	call SaveInteger(SightDataHashTable,'u01S', DC, 100)
	call SaveInteger(SightDataHashTable,'u01S', HC, 41)
	call SaveInteger(SightDataHashTable,'u016', CC, 100)
	call SaveInteger(SightDataHashTable,'u016', DC, 100)
	call SaveInteger(SightDataHashTable,'u016', HC, 41)
	call SaveInteger(SightDataHashTable,'u01F', CC, 100)
	call SaveInteger(SightDataHashTable,'u01F', DC, 100)
	call SaveInteger(SightDataHashTable,'u01F', HC, 41)
	call SaveInteger(SightDataHashTable,'u01T', CC, 100)
	call SaveInteger(SightDataHashTable,'u01T', DC, 100)
	call SaveInteger(SightDataHashTable,'u01T', HC, 41)
	call SaveInteger(SightDataHashTable,'n00J', CC, 100)
	call SaveInteger(SightDataHashTable,'n00J', DC, 100)
	call SaveInteger(SightDataHashTable,'n00J', HC, 200)
	call SaveInteger(SightDataHashTable,'n00H', CC, 100)
	call SaveInteger(SightDataHashTable,'n00H', DC, 100)
	call SaveInteger(SightDataHashTable,'n00H', HC, 200)
	call SaveInteger(SightDataHashTable,'n00A', CC, 150)
	call SaveInteger(SightDataHashTable,'n00A', DC, 150)
	call SaveInteger(SightDataHashTable,'n00A', HC, 300)
	call SaveInteger(SightDataHashTable,'n00G', CC, 150)
	call SaveInteger(SightDataHashTable,'n00G', DC, 150)
	call SaveInteger(SightDataHashTable,'n00G', HC, 300)
	call SaveInteger(SightDataHashTable,'n006', CC, 200)
	call SaveInteger(SightDataHashTable,'n006', DC, 200)
	call SaveInteger(SightDataHashTable,'n006', HC, 400)
	call SaveInteger(SightDataHashTable,'n00K', CC, 200)
	call SaveInteger(SightDataHashTable,'n00K', DC, 200)
	call SaveInteger(SightDataHashTable,'n00K', HC, 400)
	call SaveInteger(SightDataHashTable,'o004', CC, 50)
	call SaveInteger(SightDataHashTable,'o004', DC, 50)
	call SaveInteger(SightDataHashTable,'o004', HC, 100)
endfunction
// 如果均为 255 则不必储存
// -1 似乎代表255
function Init_UnitsColor takes nothing returns nothing
	call SaveColorToUnitType('o007', 20, 20, 20)
	call SaveColorToUnitType('o00F', 20, 20, 20)
	call SaveColorToUnitType('E031', 50, 50, 50)
	call SaveColorToUnitType('h05C', 50, 100,-1)
	call SaveColorToUnitType('n0F7', 50, 50, 50)
	call SaveColorToUnitType('n0F8', 50, 50, 50)
	call SaveColorToUnitType('UC18', 50, 100,-1)
	call SaveColorToUnitType('e02S', 75,-1, 75)
	call SaveColorToUnitType('EC77', 75,-1, 25)
	call SaveColorToUnitType('h05T', 75,-1, 25)
	call SaveColorToUnitType('h003', 100, 100, 100)
	call SaveColorToUnitType('h05M', 100, 125, 100)
	call SaveColorToUnitType('h05V', 100, 100, 100)
	call SaveColorToUnitType('NC00', 100, 125, 100)
	call SaveColorToUnitType('ndtr', 100, 200,-1)
	call SaveColorToUnitType('ngns', 100, 100,-1)
	call SaveColorToUnitType('U00C', 100, 100, 100)
	call SaveColorToUnitType('u00V', 100, 100, 100)
	call SaveColorToUnitType('u01N', 100, 100, 100)
	call SaveColorToUnitType('u01Q', 100, 100, 100)
	call SaveColorToUnitType('ngh1', 110, 150,-1)
	call SaveColorToUnitType('n010', 125, 125, 125)
	call SaveColorToUnitType('n011', 125, 125, 125)
	call SaveColorToUnitType('n012', 125, 125, 125)
	call SaveColorToUnitType('n0F6', 125, 125, 125)
	call SaveColorToUnitType('n0FH', 125, 125, 125)
	call SaveColorToUnitType('n0FI', 125, 125, 125)
	call SaveColorToUnitType('n0FJ', 125, 125, 125)
	call SaveColorToUnitType('n0GZ', 125, 125, 125)
	call SaveColorToUnitType('n0H0', 125, 125, 125)
	call SaveColorToUnitType('n0H1', 125, 125, 125)
	call SaveColorToUnitType('npn1', 125, 125, 125)
	call SaveColorToUnitType('npn2', 125, 125, 125)
	call SaveColorToUnitType('npn3', 125, 125, 125)
	call SaveColorToUnitType('npn4', 125, 125, 125)
	call SaveColorToUnitType('npn5', 125, 125, 125)
	call SaveColorToUnitType('npn6', 125, 125, 125)
	call SaveColorToUnitType('h047', 130, 100,-1)
	call SaveColorToUnitType('HC92', 130, 100,-1)
	call SaveColorToUnitType('nfsh', 130,-1, 130)
	call SaveColorToUnitType('nftb', 130,-1, 130)
	call SaveColorToUnitType('EC57', 150, 200,-1)
	call SaveColorToUnitType('h05E', 150, 150, 100)
	call SaveColorToUnitType('h05Y', 150, 0, 150)
	call SaveColorToUnitType('h07M', 150, 150, 150)
	call SaveColorToUnitType('h07N', 150, 150, 150)
	call SaveColorToUnitType('h07O', 150, 150, 150)
	call SaveColorToUnitType('h0B2', 150, 150, 150)
	call SaveColorToUnitType('h0B3', 150, 150, 150)
	call SaveColorToUnitType('h0B5', 150, 150, 150)
	call SaveColorToUnitType('n00L', 150, 100,-1)
	call SaveColorToUnitType('n026', 150, 110, 70)
	call SaveColorToUnitType('n0LD', 150, 150, 150)
	call SaveColorToUnitType('ndr3', 150, 150, 150)
	call SaveColorToUnitType('njga', 150, 150, 150)
	call SaveColorToUnitType('nwlg', 150, 120,-1)
	call SaveColorToUnitType('Oshd', 150, 0, 150)
	call SaveColorToUnitType('UC11', 150, 150, 100)
	call SaveColorToUnitType('UC60', 150, 150, 150)
	call SaveColorToUnitType('nfa1', 155, 155,-1)
	call SaveColorToUnitType('nfa2', 155, 155,-1)
	call SaveColorToUnitType('nfac', 155, 155,-1)
	call SaveColorToUnitType('osw2', 170, 170,-1)
	call SaveColorToUnitType('u012', 170, 170,-1)
	call SaveColorToUnitType('u013', 170, 170,-1)
	call SaveColorToUnitType('h05P', 175, 75, 200)
	call SaveColorToUnitType('u00O', 175, 175,-1)
	call SaveColorToUnitType('UC91', 175, 75, 200)
	call SaveColorToUnitType('N01W', 190,-1,-1)
	call SaveColorToUnitType('h070', 200,-1,-1)
	call SaveColorToUnitType('n019', 200, 200,-1)
	call SaveColorToUnitType('n01E', 200, 150,-1)
	call SaveColorToUnitType('nanm', 200, 200,-1)
	call SaveColorToUnitType('nbnb', 200, 200,-1)
	call SaveColorToUnitType('ndr2', 200, 200, 200)
	call SaveColorToUnitType('nmrl', 200,-1, 200)
	call SaveColorToUnitType('o006', 200, 125, 50)
	call SaveColorToUnitType('ndr1', 230, 230, 230)
	call SaveColorToUnitType('npfl', 240,-1, 240)
	call SaveColorToUnitType('h066', 250, 150, 150)
	call SaveColorToUnitType('Hvsh', 250, 150, 150)
	call SaveColorToUnitType('h06J',-1, 25, 100)
	call SaveColorToUnitType('h05H',-1, 75,-1)
	call SaveColorToUnitType('U008',-1, 75,-1)
	call SaveColorToUnitType('E015',-1, 100,-1)
	call SaveColorToUnitType('h00L', 0, 100, 100)
	call SaveColorToUnitType('H004',-1, 120, 120)
	call SaveColorToUnitType('h049',-1, 120, 120)
	call SaveColorToUnitType('n003',-1, 120, 180)
	call SaveColorToUnitType('n09Z',-1, 120, 120)
	call SaveColorToUnitType('nfpc',-1, 120, 150)
	call SaveColorToUnitType('nsat',-1, 120,-1)
	call SaveColorToUnitType('nstl',-1, 130, 150)
	call SaveColorToUnitType('nkot',-1, 150, 180)
	call SaveColorToUnitType('nowe',-1, 150, 150)
	call SaveColorToUnitType('nogm',-1, 160, 160)
	call SaveColorToUnitType('o005',-1, 170, 170)
	call SaveColorToUnitType('osw3',-1, 170, 170)
	call SaveColorToUnitType('H00E',-1, 200, 200)
	call SaveColorToUnitType('nbdk',-1, 200,-1)
	call SaveColorToUnitType('nbrg',-1, 200, 150)
	call SaveColorToUnitType('nbwm',-1, 200, 200)
	call SaveColorToUnitType('ndtw',-1, 200, 110)
	call SaveColorToUnitType('nmrm',-1, 200, 200)
	call SaveColorToUnitType('Ubal',-1, 200, 200)
	call SaveColorToUnitType('nsth',-1,-1, 140)
	call SaveColorToUnitType('EC45', 0,-1, 150)
	call SaveColorToUnitType('h05S', 0,-1, 150)
	call SaveColorToUnitType('nggr', 0,-1, 155)
	call SaveColorToUnitType('nkob',-1,-1, 165)
	call SaveColorToUnitType('ncen',-1,-1, 170)
	call SaveColorToUnitType('nowb',-1,-1, 170)
	call SaveColorToUnitType('H00F',-1,-1, 200)
	call SaveColorToUnitType('H00G',-1,-1, 200)
	call SaveColorToUnitType('n002',-1,-1, 200)
	call SaveColorToUnitType('n009',-1,-1, 200)
	call SaveColorToUnitType('n00V',-1,-1, 200)
	call SaveColorToUnitType('n00W',-1,-1, 200)
	call SaveColorToUnitType('n00X',-1,-1, 200)
	call SaveColorToUnitType('n0HE',-1,-1, 200)
	call SaveColorToUnitType('h094',-1, 0, 200)
	call SaveColorToUnitType('n006', 0,-1,-1)
	call SaveColorToUnitType('n00A', 0,-1,-1)
	call SaveColorToUnitType('n00J', 0,-1,-1)
	call SaveColorToUnitType('E01P',-1, 0,-1)
	call SaveColorToUnitType('h08Z',-1, 0,-1)
	call SaveColorToUnitType('nfro', 0, 0,-1)
	call SaveColorToUnitType('n00G',-1,-1, 0)
	call SaveColorToUnitType('n00H',-1,-1, 0)
	call SaveColorToUnitType('n00K',-1,-1, 0)
	call SaveColorToUnitType('E024', 0,-1, 0)
	call SaveColorToUnitType('o00T', 0,-1, 0)
	call SaveColorToUnitType('o00U', 0,-1, 0)
	call SaveColorToUnitType('o00V', 0,-1, 0)
	call SaveColorToUnitType('o00W', 0,-1, 0)
	call SaveColorToUnitType('e01K',-1, 0, 0)
	call SaveColorToUnitType('e01L',-1, 0, 0)
	call SaveColorToUnitType('E021',-1, 0, 0)
	call SaveColorToUnitType('u01M',-1, 0, 0)
	call SaveColorToUnitType('u01O',-1, 0, 0)
	call SaveColorToUnitType('H00F', 255, 255, 200)
	call SaveColorToUnitType('H00E', 255, 200, 200)
	call SaveColorToUnitType('H00G', 255, 200, 200)
	call SaveColorToUnitType('HC92', 130, 100, 255)
	call SaveColorToUnitType('U008', 255, 75, 255)
	call SaveColorToUnitType('E015', 255, 100, 255)
	call SaveColorToUnitType('NC00', 100, 125, 100)
	call SaveColorToUnitType('UC11', 150, 150, 100)
	call SaveColorToUnitType('Hvsh', 250, 150, 150)
	call SaveColorToUnitType('Ubal', 255, 200, 200)
	call SaveColorToUnitType('Nfir', 0, 0, 0)
	call SaveColorToUnitType('EC77', 75, 255, 25)
	call SaveColorToUnitType('Oshd', 150, 0, 150)
	call SaveColorToUnitType('UC18', 50, 100, 255)
	call SaveColorToUnitType('UC60', 150, 150, 150)
	call SaveColorToUnitType('UC91', 175, 75, 200)
	call SaveColorToUnitType('EC45', 0, 255, 150)
	call SaveColorToUnitType('U00C', 100, 100, 100)
	call SaveColorToUnitType('EC57', 150, 200, 255)
endfunction
// 注册神杖升级
function InitAghanimScepterUpgrade1 takes nothing returns nothing
	call RegisterAghanimUpgrade('A0O2','A28A','A289', 0)
	call RegisterAghanimUpgrade('A0DH','A1MZ','A1OB', 0)
	call RegisterAghanimUpgrade('A0ER','A2S7','A2S8', 0)
	call RegisterAghanimUpgrade('A0MQ','A1BS','A1B6', 0)
	call RegisterAghanimUpgrade('A0Z8','A1CW','A1CV', 0)
	call RegisterAghanimUpgrade('A0QR','A1BL','A1B3', 0)
	call RegisterAghanimUpgrade('A0M1','A1BR','A1AX', 0)
	call RegisterAghanimUpgrade('A29L','A448','A447', 0)
	call RegisterAghanimUpgrade('A0RP','A44A','A449', 0)
	call RegisterAghanimUpgrade('A054','A0UE','A00U', 0)
	call RegisterAghanimUpgrade('A1T5','A236','A235', 0)
	call RegisterAghanimUpgrade('A0IN','A1BT','A1AW', 0)
	call RegisterAghanimUpgrade('A03R','A0U2','A0AV', 0)
	call RegisterAghanimUpgrade('A0S8','A1QR','A1QP', 0)
	call RegisterAghanimUpgrade('A0LT','A1CT','A1CS', 0)
	call RegisterAghanimUpgrade('A29G','A0U0','A29H', 0)
	call RegisterAghanimUpgrade('A1W8','A0U8','A1W9', 0)
	call RegisterAghanimUpgrade('A0L3','A2QB','A2QC', 0)
	call RegisterAghanimUpgrade('A01P','A0TO','A09Z', 0)
	call RegisterAghanimUpgrade('A12P','A1DC','A1D6', 0)
	call RegisterAghanimUpgrade('A0AK','A1G0','A1FY', 0)
	call RegisterAghanimUpgrade('A0O5','A1BN','A1B1', 0)
	call RegisterAghanimUpgrade('A00H','A0TY','A0A1', 0)
	call RegisterAghanimUpgrade('A04P','A1BV','A1AU', 0)
	call RegisterAghanimUpgrade('A0LC','A444','A443', 0)
	call RegisterAghanimUpgrade('A0E2','A1MS','A1MR', 0)
	call RegisterAghanimUpgrade('A0MU','A0UI','A0A2', 0)
	call RegisterAghanimUpgrade('A0NS','A1DE','A1DA', 0)
	call RegisterAghanimUpgrade('A0FL','A1D5','A1CX', 0)
	call RegisterAghanimUpgrade('A0G4','A1DG','A1D8', 0)
	call RegisterAghanimUpgrade('A06R','A1BM','A1B4', 0)
	call RegisterAghanimUpgrade('A013','A0UA','A0A6', 0)
	call RegisterAghanimUpgrade('A080','A1V0','A1UZ', 0)
	call RegisterAghanimUpgrade('A1AO','A1UW','A1UV', 0)
	call RegisterAghanimUpgrade('A0J1','A1DD','A1D7', 0)
	call RegisterAghanimUpgrade('A02Q','A1DH','A1D9', 0)
	call RegisterAghanimUpgrade('A0QK','A21R','A21Q', 0)
	call RegisterAghanimUpgrade('A095','A0TQ','A09W', 0)
	call RegisterAghanimUpgrade('A05T','A0U4','A08H', 0)
	call RegisterAghanimUpgrade('A067','A0UC','A08P', 0)
	call RegisterAghanimUpgrade('A0CC','A0TU','A02Z', 0)
	call RegisterAghanimUpgrade('A0OK','A1VX','A1VW', 0)
	call RegisterAghanimUpgrade('A28R','A0TW','A28S', 0)
endfunction

function InitAghanimScepterUpgrade2 takes nothing returns nothing
	call RegisterAghanimUpgrade('S008','A1US','S00U', 0)
	call RegisterAghanimUpgrade('A10Q','A1DF','A1DB', 0)
	call RegisterAghanimUpgrade('A1NE','A2IH','A2IG', 0)
	call RegisterAghanimUpgrade('A21F','A0U6','A21G', 0)
	call RegisterAghanimUpgrade('A0NT','A0UG','A0NX', 0)
	call RegisterAghanimUpgrade('A1MI','A2QF','A2QE', 0)
	call RegisterAghanimUpgrade('A2BG','A30I','A30H', 0)
	call RegisterAghanimUpgrade('A27H','A30K','A30J', 0)
	call RegisterAghanimUpgrade('A1BX','A30M','A30L', 0)
	call RegisterAghanimUpgrade('A1U6','A30O','A30N', 0)
	call RegisterAghanimUpgrade('A343','A34K','A34J', 0)
	call RegisterAghanimUpgrade('A0DY','A1WC','A1WB', 0)
	call RegisterAghanimUpgrade('A0WP','A43E','A43D', 0)
	call RegisterAghanimUpgrade('A1RK','A43I','A43H', 0)
	call RegisterAghanimUpgrade('A1A1','A43K','A43J', 0)
	call RegisterAghanimUpgrade('A2E5','A43R','A43S', 0)
	call RegisterAghanimUpgrade('A07Z','A44R','A44S', 0)
	call RegisterAghanimUpgrade('A2O6','A3G0','A384', 0)
	call RegisterAghanimUpgrade('A2CI','A38D','A38C', 0)
	call RegisterAghanimUpgrade('A07U','A38F','A38E', 0)
	call RegisterAghanimUpgrade('A1YQ','A3DD','A3DE', 0)
	call RegisterAghanimUpgrade('A0CT','A3DN','A3DM', 0)
	call RegisterAghanimUpgrade('A01Y','A1BP','A1AZ', 0)
	call RegisterAghanimUpgrade('A14O','A3FP','A3FJ', 0)
	call RegisterAghanimUpgrade('A19O','A1MW','A1MV', 0)
	call RegisterAghanimUpgrade('A06B','A472','A471', 0)
	call RegisterAghanimUpgrade('A15S','A3JY','A3JX', 0)
	call RegisterAghanimUpgrade('A05E','A3JZ','A33F', 0)
	call RegisterAghanimUpgrade('A049','A33H','A33G', 0)
	call RegisterAghanimUpgrade('A28T','A3JA','A361', 0)
	call RegisterAghanimUpgrade('Z610','A3K4','A3K5', 0)
	
	
	
	call RegisterAghanimUpgrade('A0FW','S3OD','A3OD', 0) //刚被兽 粘稠鼻液
	call RegisterAghanimUpgrade('A0KV','S3UG','A3UG', 0) //
	call RegisterAghanimUpgrade('A11K','S31K','Z31K', 0) //舰队统帅 幽灵船
	call RegisterAghanimUpgrade('A046','S3OH','A3OH', 0) //潮汐猎人 巨浪
	call RegisterAghanimUpgrade('A06O','S3NX','A3NX', 0) //沙王 掘地穿刺
	call RegisterAghanimUpgrade('A02S','A3Y7','A3Y8', 0) //猛犸 震荡波
	call RegisterAghanimUpgrade('A14R','S3WT','A3WT', 0) //蓝猫 电子漩涡
	call RegisterAghanimUpgrade('A29J','S3OJ','A3OJ', 0) //影魔r
	
	call RegisterAghanimUpgrade('A1TB','A470','A3FQ', 0)
	call RegisterAghanimUpgrade('A0O3', 0,'A0O3', 0)
	call RegisterAghanimUpgrade('QM03', 0, 0, 0)
	call RegisterAghanimUpgrade('A0A5', 0, 0, 0)
	call RegisterAghanimUpgrade('A0CY', 0, 0, 0)
	call RegisterAghanimUpgrade('A088', 0, 0, 0)
	call RegisterAghanimUpgrade('A085', 0, 0, 0)
endfunction
function InitPassiveSkills takes nothing returns nothing
	// 注意：第五个参数的技能Id最好不要为光环类 (因为这只是用作于显示技能 模板应该为AEev)
	// 2022/1/1 将ability.slk的
	// 替换为
	// C;X2;K"AOac"  |   C;X2;K"AEev"
	// C;X11;K4      |	 C;X11;K4
	// C;X10;K1      |	 C;X10;K1
	// C;Y     		 |	 C;Y
	// AOac的父级Id为ACac  命令光环 如果更改以此为模板的技能等级 在单位死亡时候会导致崩溃
	// 所以将其全部更改为AEev 闪避 与命令光环相同一样可以修改技能等级
	call RegisterPassiveSkills('ACac','Q003','P003','BOac','QP03','QP03')
	call RegisterPassiveSkills(0, 0,'A0DW', 0,'QP04', 0)
	call RegisterPassiveSkills('AHab','Q019','P019','B07M','QP05', 0)
	call RegisterPassiveSkills('P022','Q022','A01K', 0,'QP06', 0)
	call RegisterPassiveSkills('P035','Q035','A0DZ', 0,'QP07', 0)
	call RegisterPassiveSkills('A00J','Q036','A0MB', 0,'QP08','QP08')
	call RegisterPassiveSkills('P047','Q047','A00K', 0,'QP09','QP09')
	call RegisterPassiveSkills(0,'Q067','P067', 0,'QP0A', 0)
	call RegisterPassiveSkills('P083','Q083','A0DB','B03B','QP0B','QP0B')
	call RegisterPassiveSkills('P098','Q098','A041', 0,'QP0D','QP0D') //月刃
	call RegisterPassiveSkills('P099','Q099','A062','B01W','QP0E', 0)
	call RegisterPassiveSkills('P102','Q102','A03S', 0,'QP0F', 0)
	call RegisterPassiveSkills('P107','Q107','A0O0', 0,'QP0G', 0)
	call RegisterPassiveSkills('P119','Q119','A0MX', 0,'QP0H','QP0H')
	call RegisterPassiveSkills('P123','Q123','A00V','B00M','QP0I','QP0I')
	call RegisterPassiveSkills('P131','Q131','A0CL','B04D','QP0J', 0)
	call RegisterPassiveSkills('P133','Q133','A022', 0,'QP0K','QP0K')
	call RegisterPassiveSkills('P135','Q135','A0KY', 0,'QP0L','QP0L')
	call RegisterPassiveSkills('P143','Q143','A06A','B01B','QP0M','QP0M')
	call RegisterPassiveSkills('P147','Q147','A0BD','B00E','QP0N','QP0N')
	call RegisterPassiveSkills('P155','Q155','A0O3','B00X','QP0O', 0)
	call RegisterPassiveSkills('P211','Q211','A27V','B0EO','QP0P', 0)
	call RegisterPassiveSkills('P231','Q231','A03E','B096','QP0Q', 0)
	call RegisterPassiveSkills('P239','Q239','A03P', 0,'QP0R','QP0R')
	call RegisterPassiveSkills('P240','Q240','A03Q', 0,'QP0S','QP0S')
	call RegisterPassiveSkills(0, 0,'A086','B02L','P247', 0)
	call RegisterPassiveSkills('AUav','Q250','P250','BVA1','QP0U','QP0U')
	call RegisterPassiveSkills('AOcr','Q251','A2S0', 0,'QP0W','QP0W')
	call RegisterPassiveSkills(0, 0,'A0JJ', 0,'QP0V','QP0V')
	call RegisterPassiveSkills(0, 0,'A081', 0,'QP0X','QP0X')
	call RegisterPassiveSkills('P279','Q279','A0MM', 0,'QP0Y', 0)
	call RegisterPassiveSkills('P283','Q283','A1E6','B03X','QP0Z', 0)
	call RegisterPassiveSkills('P294','Q294','A04E', 0,'QP10', 0)
	call RegisterPassiveSkills('P302','Q302','A01N','B084','QP11', 0)
	call RegisterPassiveSkills('P303','Q303','A060', 0,'QP12', 0)
	call RegisterPassiveSkills('P307','Q307','A06D', 0,'QP13', 0)
	call RegisterPassiveSkills('P310','Q310','A0ES','B03Y','QP14','QP14')
	call RegisterPassiveSkills('P319','Q319','A0FU', 0,'QP15','QP15')
	call RegisterPassiveSkills(0, 0,'A0FA', 0,'QP16','QP16')
	call RegisterPassiveSkills('P327','Q327','A0C6','B03P','QP17','QP17')
	call RegisterPassiveSkills(0, 0,'A0MG', 0,'QP18', 0)
	call RegisterPassiveSkills('P338','Q338','A0FX', 0,'QP19','QP19')
	call RegisterPassiveSkills('P347','Q347','A0IF','B06X','QP1A', 0)
	call RegisterPassiveSkills('P355','Q355','A0N7', 0,'QP1B', 0)
	call RegisterPassiveSkills('P363','Q363','AIcd', 0,'QP1C','QP1C')
	call RegisterPassiveSkills('P418','Q418','A0MY', 0,'QP1D', 0)
	call RegisterPassiveSkills('P431','Q431','A03N', 0,'QP1E','QP1E')
	call RegisterPassiveSkills(0, 0,'A1HR', 0,'QP1F', 0)
	call RegisterPassiveSkills(0, 0,'A0DJ', 0,'QP1G', 0)
	call RegisterPassiveSkills(0, 0,'QF85', 0,'QP1H', 0)
	call RegisterPassiveSkills(0, 0,'A1CD', 0,'QP1I', 0)
	call RegisterPassiveSkills(0, 0,'A19Q', 0,'QP1J', 0)
	call RegisterPassiveSkills(0, 0,'A0CY', 0,'QP1K', 0)
	call RegisterPassiveSkills(0, 0,'A0QQ', 0,'QP1L', 0)
	call RegisterPassiveSkills(0, 0,'A0M3', 0,'QP1M', 0)
	call RegisterPassiveSkills(0, 0,'A0FV', 0,'QP1N', 0)
	call RegisterPassiveSkills(0, 0,'A2EY', 0,'QP1O', 0)
	call RegisterPassiveSkills(0, 0,'A13T', 0,'A522', 0)
	call RegisterPassiveSkills(0, 0,'A2E4', 0,'QP1P', 0)
	call RegisterPassiveSkills(0, 0,'A03U', 0,'QP1Q', 0)
	call RegisterPassiveSkills(0, 0,'A0RO', 0,'QP1S', 0)
	call RegisterPassiveSkills(0, 0,'A0N5', 0,'QP1T', 0)
	call RegisterPassiveSkills(0, 0,'A18X', 0,'QP1U', 0)
	call RegisterPassiveSkills(0, 0,'A0QW', 0,'QP1V', 0)
	call RegisterPassiveSkills(0, 0,'A0SS', 0,'QP1W', 0)
	call RegisterPassiveSkills(0, 0,'A0G5', 0,'QP1X', 0)
	call RegisterPassiveSkills(0, 0,'A0LE', 0,'QP1Y', 0)
	call RegisterPassiveSkills(0, 0,'A0I8', 0,'QP1Z', 0)
	call RegisterPassiveSkills(0, 0,'A0NA', 0,'QP20', 0)
	call RegisterPassiveSkills(0, 0,'A1A3', 0,'QP21', 0)
	call RegisterPassiveSkills(0, 0,'A0CZ', 0,'QP22', 0)
	call RegisterPassiveSkills(0, 0,'A0VX', 0,'QP23', 0)
	call RegisterPassiveSkills(0, 0,'A088', 0,'QP24', 0)
	call RegisterPassiveSkills('A33O','A33P','A33Q', 0,'A33R', 0)
	call RegisterPassiveSkills('A09J','A23F','A417', 0, 0, 0)
	call RegisterPassiveSkills('A43Z','A442','A440', 0,'QP25', 0)
	call RegisterPassiveSkills(0, 0,'QF88', 0,'A0VC', 0)
	call RegisterPassiveSkills('A455','A45C','A45B', 0,'QP26', 0)
	call RegisterPassiveSkills(0, 0,'A460', 0,'QP27', 0)
	call RegisterPassiveSkills(0, 0,'A34A', 0,'QP28', 0)
	call RegisterPassiveSkills(0, 0,'Q0BK', 0,'QP29', 0)
	call RegisterPassiveSkills(0, 0,'A0A8', 0,'QP2A', 0)
	call RegisterPassiveSkills('A3J7','A3J7','A02C', 0,'QP2B', 0)
endfunction
function InitHeroSkillsData takes nothing returns nothing
	local integer i = 0
	local string s
	call RegisterHeroSkill(0, null, 0, 0, 0, null)
	set HeroSkillsIcon[0]= "UI\\Widgets\\Console\\Undead\\undead-inventory-slotfiller.blp"
	set i = 1 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "thunderbolt"),'A02A', 0,'Y001', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "volcano"),'A17O', 0,'Y002', "e")
	call RegisterHeroSkill(i * 4 + 3, null,'P003','QP03','Y003', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "forkedlightning"),'A0IN','A1AW','Y004', "w")
	set i = 2 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "chainlightning"),'A020', 0,'Y005', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "thunderbolt"),'A0JC', 0,'Y006', "g")
	call RegisterHeroSkill(i * 4 + 3, null,'A0N5','QP1T','Y007', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "roar")+ SaveSkillOrder(i * 4 + 4, "r1"),'A29G','A29H','Y008', "w")
	set i = 3 -1
	call RegisterHeroSkill(i * 4 + 1, null,'A0DW','QP04','Y009', null)
	set IsPassiveSkill[i * 4 + 1]= true
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "slow"),'A0DX', 0,'Y010', "c")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "locustswarm"),'A01B', 0,'Y011', "r")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "arrows")+ SaveSkillOrder(i * 4 + 4, "range only")+ SaveSkillOrder(i * 4 + 4, "shuashecheng"),'A0DY','A1WB','Y012', "t")
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXBinglongTuijin")
	endif
	//set IsNoDeathMatchSkill[i * 4 + 4]= true
	set i = 4 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "carrionswarm"),'QB02', 0,'QY02', "w")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "acidbomb"),'A0G6', 0,'Y014', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "replenishmana")+ SaveSkillOrder(i * 4 + 3, "replenishlife")+ SaveSkillOrder(i * 4 + 3, "abuz agi")+ SaveSkillOrder(i * 4 + 3, "str bug"),'A0KX', 0,'Y015', null)
	set IsMultiIconSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "item 16")+ SaveSkillOrder(i * 4 + 4, "coldarrows"),'A0G8', 0,'Y016', "r")
	set i = 5 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "mounthippogryph"),'A1E9', 0,'Y017', "v")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "entanglingroots"),'A04C', 0,'Y018', "e")
	call RegisterHeroSkill(i * 4 + 3, null,'P019','QP05','Y019', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "autoharvestlumber"),'A03R','A0AV','Y020', "f")
	set i = 6 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "spellshieldaoe"),'A190', 0,'Y021', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "melee only"),'A01K','QP06','Y022', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "fanofknives"),'A2IS', 0,'Y023', "w")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "roar"),'A0WP','A43D','Y024', "r")
	set i = 7 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "mirrorimage"),'A063', 0,'Y025', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "unavatar"),'A24D', 0,'Y026', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "fanofknives"),'A2KU', 0,'Y027', "d")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "awaken")+ SaveSkillOrder(i * 4 + 4, "avengerform")+ SaveSkillOrder(i * 4 + 4, "r2"),'A07U','A38E','Y028', "g")
	set i = 8 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "barkskinoff"),'A0SK', 0,'Y029', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "roar"),'A0DL', 0,'Y030', "e")
	set NoBalanceOffTips[i * 4 + 2]= "图腾在与水刀、连击、海象挥击、忍术、转属性和无影拳的时候只会 +100/140/180/220% 的攻击力"
	call Z6E(i * 4 + 2, "ET-Drunken")
	call Z1E(i * 4 + 2, "bgdmg1")
	call Z1E(i * 4 + 2, "bgdmg2")
	call RegisterHeroSkill(i * 4 + 3, null,'A0DJ','QP1G','Y031', null)
	set ZTP[i * 4 + 3]= "余震有6/4.5/3.0/1.5秒的冷却时间"
	set IsPassiveSkill[i * 4 + 3]= true
	if Mode__SixSkills and(not Mode__RearmCombos) then
		//	set IsDisabledSkill[i * 4 + 3]= true
		set IsDisabledSkill[i * 4 + 2]= true
	endif
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "fanofknives"),'A0DH','A1OB','Y032', "c")
	set i = 9 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "neutralinteract"),'A0RG', 0,'Y033', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "inv bug 1")+ SaveSkillOrder(i * 4 + 2, "ibug")+ SaveSkillOrder(i * 4 + 2, "yongjiu1")+ SaveSkillOrder(i * 4 + 2, "yongjiu2")+ SaveSkillOrder(i * 4 + 2, "yongjiu3"),'A0MB','QP08','Y036', null)
	set IsPassiveSkill[i * 4 + 2]= true
	set ZTP[i * 4 + 2]= "永久隐身效果会在攻击、施法或使用物品后消失"
	call RegisterHeroSkill(i * 4 + 3, null,'A0DZ','QP07','Y035', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "barkskinon"),'A0K9', 0,'Y034', "b")
	set i = CB -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "summongrizzly"),'A0A5', 0,'Y037', "b")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives"),'A1EG', 0,'Y038', "r")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "youjimaoyong"),'A0A8', 0,'Y039', null) //协同
	if Mode__SixSkills and(not Mode__RearmCombos) then
		set IsDisabledSkill[i * 4 + 3]= true
	endif
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "bearform")+ SaveSkillOrder(i * 4 + 4, "unbearform")+ SaveSkillOrder(i * 4 + 4, "battleroar")+ SaveSkillOrder(i * 4 + 4, "metamorphosis")+ SaveSkillOrder(i * 4 + 4, "melee morph"),'A0AG', 0,'Y040', "f")
	set IsMultiIconSkill[i * 4 + 4]= true
	set i = DB -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "carrionswarm"),'A01F', 0,'Y041', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "restorationoff"),'QB0E', 0,'QY0E', "t")
	call RegisterHeroSkill(i * 4 + 3, null,'A18X','QP1U','Y043', null)
	set IsPassiveSkill[i * 4 + 3]= true
	set NoRearmCombosTips[i * 4 + 3]= "冷却时间3秒及以下的技能每施放2次才会触发1次炽魂"
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "chainlightning"),'A01P','A09Z','Y044', "g")
	set i = FB -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "whirlwind"),'A05G', 0,'Y045', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "healingward"),'A047', 0,'Y046', "g")
	call RegisterHeroSkill(i * 4 + 3, null,'A00K','QP09','Y047', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "thunderbolt"),'A0M1','A1AX','Y048', "e")
	set i = GB -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "neutralspell"),'A14L', 0,'Y049', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "arrows")+ SaveSkillOrder(i * 4 + 2, "range only"),'A0LZ', 0,'Y050', "w")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "transmute"),'A2NT', 0,'Y051', "t")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "battlestations")+ SaveSkillOrder(i * 4 + 4, "r4"),'A0L3','A2QC','Y052', "e")
	set i = HB -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "invisibility"),'A01Z', 0,'Y053', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "unavengerform"),'A26N', 0,'Y054', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "spiritlink"),'A2ML', 0,'Y055', "v")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "blight"),'A07Z','A44S','Y056', "r")
	set i = JB -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "Locustswarm"),'A1AA', 0,'Y057', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "loadcorpse")+ SaveSkillOrder(i * 4 + 2, "whirlwind"),'A1A8', 0,'Y058', "c")
	call RegisterHeroSkill(i * 4 + 3, null,'A1CD','QP1I','Y059', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "board"),'A1A1','A43J','Y060', "e")
	set i = 16 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "carrionscarabs")+ SaveSkillOrder(i * 4 + 1, "carrionscarabsinstant"),'A085', 0,'Y061', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "spellsteal"),'A10X', 0,'Y062', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "frenzy"),'A112', 0,'Y063', "c")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "range morph")+ SaveSkillOrder(i * 4 + 4, "metamorphosis")+ SaveSkillOrder(i * 4 + 4, "phoenixfire")+ SaveSkillOrder(i * 4 + 4, "creepheal"),'QM01', 0,'Y064', "f")
	set IsMultiIconSkill[i * 4 + 4]= true
	set i = 17 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "thunderclap"),'A03Y', 0,'Y065', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives"),'QB0P', 0,'QY0P', "v")
	call RegisterHeroSkill(i * 4 + 3, null,'P067','QP0A','Y067', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "berserk"),'A0LC','A443','Y068', "r")
	set i = 18 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "thunderbolt"),'QB0J', 0,'QY0J', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "acidbomb"),'A011', 0,'Y070', "g")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "bloodlust"),'A083', 0,'Y071', "b")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "carrionscarabsoff"),'A088','QP24','Y072', null)
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXmines")
	endif
	set IsPassiveSkill[i * 4 + 4]= true
	set NoBalanceOffTips[i * 4 + 4]= "多重施法的触发几率调整为：18%/29.5%/39.5%概率x2，0%/13%/14.5%概率x3，0%/0/%5.5%概率x4"
	set NoRearmCombosTips[i * 4 + 4]= "多重施法会额外消耗50%/75%/100%的魔法值。"
	set i = 19 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "drunkenhaze"),'A049','A33G','Y073', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives"),'A05E','A33F','Y074', "t")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "manaflareoff")+ SaveSkillOrder(i * 4 + 3, "stampede"),'A0BQ', 0,'Y075', "c")
	set i = i * 4 + 4
	call RegisterHeroSkill(i, SaveSkillOrder(i, "monsoon")+ SaveSkillOrder(i, "channel")+ SaveSkillOrder(i, "magicundefense"),'A065', 0,'Y076', "r")
	//	set IsDisabledSkill[i * 4 + 4]= true
	set NoBalanceOffTips[i]= "再装填有9/6/3的冷却时间"
	set s = SaveSkillOrder(i, "r1")+ SaveSkillOrder(i, "r4")+ SaveSkillOrder(i, "r55")+ SaveSkillOrder(i, "r18")
	//if Mode__SixSkills and(not Mode__RearmCombos) then
	if ExtraSkillsNumber != 0 then
		set IsDisabledSkill[i]= true
	endif
	if Mode__RearmCombos == false then
		set s = SaveSkillOrder(i, "r44")+ SaveSkillOrder(i, "r95")+ SaveSkillOrder(i, "r2")+ SaveSkillOrder(i, "r3")+ SaveSkillOrder(i, "r14")+ SaveSkillOrder(i, "r17")
		set s = SaveSkillOrder(i, "r6")+ SaveSkillOrder(i, "r7")+ SaveSkillOrder(i, "r8")+ SaveSkillOrder(i, "r9")+ SaveSkillOrder(i, "r123")+ SaveSkillOrder(i, "r11")+ SaveSkillOrder(i, "r12")+ SaveSkillOrder(i, "r15")+ SaveSkillOrder(i, "r16")
		set s = SaveSkillOrder(i, "r19")+ SaveSkillOrder(i, "r20")+ SaveSkillOrder(i, "r21")+ SaveSkillOrder(i, "r22")+ SaveSkillOrder(i, "r23")+ SaveSkillOrder(i, "r24")+ SaveSkillOrder(i, "r25")
		set s = SaveSkillOrder(i, "r26")+ SaveSkillOrder(i, "r27")+ SaveSkillOrder(i, "r28")
	endif
	call Z1E(i, "r29")
	call Z1E(i, "r30")
	call Z1E(i, "r31")
	set i = 20 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "carrionswarm"),'A21E', 0,'Y077', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "blink"),'A01O', 0,'Y078', "r")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "forceofnature"),'AEfn', 0,'Y079', "f")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "stampede")+ SaveSkillOrder(i * 4 + 4, "r55"),'A1W8','A1W9','Y080', "w")
	set i = 21 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "spellstealoff"),'A10D', 0,'Y081', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "animatedead"),'A46H', 0,'Y082', "d")
	call RegisterHeroSkill(i * 4 + 3, null,'A46E','A46D','Y084', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, null,'A0DB','QP0B','Y083', null)
	set IsPassiveSkill[i * 4 + 4]= true
	set i = 22 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "phoenixmorph"),'A0LL', 0,'Y085', "v")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "carrionscarabson"),'A0BZ', 0,'Y086', "t")
	call RegisterHeroSkill(i * 4 + 3, null,'A19Q','QP1J','Y087', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, null,'A0CY','QP1K','Y088', null)
	set IsNoDeathMatchSkill[i * 4 + 4]= true
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXzhangdahaimin")
	endif
	set IsPassiveSkill[i * 4 + 4]= true
	set NoRearmCombosTips[i * 4 + 4]= "远程模型只增加 40/80/120 点攻击力"
	call Z1E(i * 4 + 4, "bgdmg1")
	call Z1E(i * 4 + 4, "bgdmg2")
	//set IsNoDeathMatchSkill[i * 4 + 4]= true
	set i = 23 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "item 89"),'A05J', 0,'Y089', "e")
	//if (not Mode__RearmCombos) then
	//	set s=SaveSkillOrder(i*4+1,"HXmines")
	//endif
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "stasistrap"),'A06H', 0,'Y090', "t")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "selfdestruct"),'A06B','A471','Y091', "c")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "ward")+ SaveSkillOrder(i * 4 + 4, "chainlightning"),'A0AK','A1FY','Y092', "r")
	set IsMultiIconSkill[i * 4 + 4]= true
	set i = 24 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "drunkenhaze"),'A0KM', 0,'Y093', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "ancestralspirittarget")+ SaveSkillOrder(i * 4 + 2, "build"),'A0LV', 0,'Y094', "t")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "ambush"),'A28T','A361','Y095', "r")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "controlmagic")+ SaveSkillOrder(i * 4 + 4, "r6"),'A0LT','A1CS','Y096', "d")
	set i = 25 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "firebolt"),'A042', 0,'Y097', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "arrows"),'A041','QP0D','Y098', null)
	
	//set IsNoDeathMatchSkill[i * 4 + 2]= true
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, null,'A062','QP0E','Y099', null)
	set IsPassiveSkill[i * 4 + 3]= true
	set IsNoDeathMatchSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "corporealform")+ SaveSkillOrder(i * 4 + 4, "r28"),'A054','A00U','Y100', "e")
	set i = 26 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "possession")+ SaveSkillOrder(i * 4 + 1, "metamorphosis"),'A064', 0,'Y101', "r")
	//set IsDisabledSkill[i*4+1]=true
	call RegisterHeroSkill(i * 4 + 2, null,'A03S','QP0F','Y102', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "range only"),'A03U','QP1Q','Y103', null)
	set IsPassiveSkill[i * 4 + 3]= true
	//set IsNoDeathMatchSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "thunderbolt"),'A04P','A1AU','Y104', "t")
	set i = 27 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "metamorphosis")+ SaveSkillOrder(i * 4 + 1, "bearform")+ SaveSkillOrder(i * 4 + 1, "unbearform")+ SaveSkillOrder(i * 4 + 1, "melee morph")+ SaveSkillOrder(i * 4 + 1, "bash")+ SaveSkillOrder(i * 4 + 1, "yongjiu2"),'A0BE', 0,'Y105', "g")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "autodispel")+ SaveSkillOrder(i * 4 + 2, "loadarcher"),'A21M','A21N','Y106', "e")
	set IsMultiIconSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, null,'A0O0','QP0G','Y107', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "fanofknives"),'A1EJ', 0,'Y108', "r")
	set i = 28 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "forkedlightning"),'A010', 0,'Y109', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "hex"),'A0RX', 0,'Y110', "d")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "magicleash"),'A00P', 0,'Y111', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "ward")+ SaveSkillOrder(i * 4 + 4, "r7"),'A00H','A0A1','Y112', "w")
	if ExtraSkillsNumber == 2 then
		set ZTP[i * 4 + 4]= "该技能在此模式下会减少对建筑25%伤害"
	endif
	set i = 29 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "chainlightning")+ SaveSkillOrder(i * 4 + 1, "frenzyoff"),'A1TA', 0,'Y113', "t")
	//set IsDisabledSkill[i * 4 + 1]= true
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives")+ SaveSkillOrder(i * 4 + 2, "battleroar")+ SaveSkillOrder(i * 4 + 2, "roar"),'A1T8', 0,'Y114', "w")
	set IsMultiIconSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "manashieldon")+ SaveSkillOrder(i * 4 + 3, "manashieldoff"),'A28Q', 0,'Y115', "v")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "spellstealon"),'A1TB','A3FQ','Y116', "r")
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXballl")
	endif
	call Z1E(i * 4 + 4, "r30")
	set i = 30 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "thunderclap"),'A06M', 0,'Y117', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "drunkenhaze"),'Acdh', 0,'Y118', "d")
	call RegisterHeroSkill(i * 4 + 3, null,'A0MX','QP0H','Y119', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call Z6E(i * 4 + 3, "ET-Drunken")
	call Z6E(i * 4 + 3, "Tide-Drunken")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "elementalfury"),'A0MQ','A1B6','Y120', "r")
	set i = 31 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "stomp"),'A00S', 0,'Y121', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "firebolt"),'A00L', 0,'Y122', "d")
	call RegisterHeroSkill(i * 4 + 3, null,'A00V','QP0I','Y123', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "fanofknives")+ SaveSkillOrder(i * 4 + 4, "r8"),'A2O6','A384','Y124', "t")
	set i = 32 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "thunderbolt"),'A004', 0,'Y125', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "nagabuild")+ SaveSkillOrder(i * 4 + 2, "r9"),'A1IQ', 0,'Y126', null)
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 2, "HXshuidaorenshu")
	endif
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 2, "HXrenshuhaimin")
	endif
	set IsPassiveSkill[i * 4 + 2]= true
	set NoRearmCombosTips[i * 4 + 2]= "如果同时选择了无影拳或长大！，忍术只会造成 1.25/1.45/1.65/1.85倍 的伤害"
	call Z6E(i * 4 + 2, "Tide-Jinada")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "windwalk"),'A07A', 0,'Y127', "w")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "faeriefire"),'A0B4', 0,'Y128', "r")
	set i = 33 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "breathoffire"),'A03F', 0,'Y129', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "thunderbolt"),'A0AR', 0,'Y130', "t")
	set s = SaveSkillOrder(i * 4 + 2, "HXLongqilanmao")
	call RegisterHeroSkill(i * 4 + 3, null,'A0CL','QP0J','Y131', null)
	set IsPassiveSkill[i * 4 + 3]= true
	//set IsNoDeathMatchSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "metamorphosis")+ SaveSkillOrder(i * 4 + 4, "range morph"),'QM00', 0,'Y132', "r")
	set i = 34 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "orb effect"),'A022','QP0K','Y133', null)
	set IsPassiveSkill[i * 4 + 1]= true
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "blink"),'AEbl', 0,'Y134', "b")
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 2, "HXshijianmanbu")
	endif
	call RegisterHeroSkill(i * 4 + 3, null,'A0KY','QP0L','Y135', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "thunderbolt"),'A0E3', 0,'Y136', "v")
	set i = 35 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "arrows")+ SaveSkillOrder(i * 4 + 1, "range only"),'A026', 0,'Y137', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "silence"),'A33A', 0,'Y138', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "defend"),'A2O2', 0,'Y139', "t")
	set NoRearmCombosTips[i * 4 + 3]= "强击光环效果只作用于远程单位，无论你选择的是近战或远程"
	call RegisterHeroSkill(i * 4 + 4, null,'QF88', 0,'QY88', null)
	set IsPassiveSkill[i * 4 + 4]= true
	set i = 36 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "channel"),'A08N', 0,'Y141', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "antimagicshell"),'A08V', 0,'Y142', "e")
	call RegisterHeroSkill(i * 4 + 3, null,'A06A','QP0M','Y143', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "battleroar"),'A0ER','A2S8','Y144', "g")
	set i = 37 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "massteleport"),'A0O1', 0,'Y145', "w")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "awaken")+ SaveSkillOrder(i * 4 + 2, "unsummon"),'A0OO', 0,'Y146', "d")
	set IsMultiIconSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, null,'A0BD','QP0N','Y147', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "thunderbolt"),'A0O2','A289','Y148', "r")
	set i = 38 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "carrionswarm"),'A0O7', 0,'Y149', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "breathoffire"),'A0O6', 0,'Y150', "t")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "acidbomb"),'A30T', 0,'Y151', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "shockwave"),'A0O5','A1B1','Y152', "r")
	set i = 39 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "preservation"),'A0IL', 0,'Y153', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives")+ SaveSkillOrder(i * 4 + 2, "corrosivebreath"),'A1NI', 0,'Y154', "e")
	call RegisterHeroSkill(i * 4 + 3, null,'A0O3','QP0O','Y155', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "metamorphosis")+ SaveSkillOrder(i * 4 + 4, "melee morph")+ SaveSkillOrder(i * 4 + 4, "r25"),'QB0K', 0,'QY0K', "r")
	set i = 40 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "coupleinstant"),'A0KV', 'A3UG','Y157', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "spies"),'A0L8', 0,'Y158', "r")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "windwalk"),'A0LN', 0,'Y159', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "corporealform")+ SaveSkillOrder(i * 4 + 4, "r11"),'A0KU', 0,'Y160', "w")
	set i = 41 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "fanofknives"),'A14P', 0,'Y161', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "chainlightning"),'A14R','A3WT','Y162', "e")
	call RegisterHeroSkill(i * 4 + 3, null,'A0QW','QP1V','Y163', null)
	set IsPassiveSkill[i * 4 + 3]= true
	set NoRearmCombosTips[i * 4 + 3]= "冷却时间3秒及以下的技能每施放2次才会触发1次超负荷（球形闪电除外）"
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "channel"),'A14O','A3FJ','Y164', "g")
	set s = SaveSkillOrder(i * 4 + 4, "HXLongqilanmao")
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXballl")
	endif
	set i = 42 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "holybolt"),'A0QP', 0,'Y165', "v")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "arrows"),'A0QN', 0,'Y166', "r")
	call RegisterHeroSkill(i * 4 + 3, null,'A0QQ','QP1L','Y167', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "firebolt"),'A0QR','A1B3','Y168', "f")
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "yidaonimane")
	endif
	set i = 43 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "fanofknives"),'A1EA', 0,'Y169', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "windwalk"),'A0RV', 0,'Y170', "w")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "range only"),'A0RO','QP1S','Y171', null)
	set IsPassiveSkill[i * 4 + 3]= true
	//set IsNoDeathMatchSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "curse")+ SaveSkillOrder(i * 4 + 4, "spiritwolf"),'A0RP','A449','Y172', "c")
	//	set IsDisabledSkill[i*4+4]=true
	set IsMultiIconSkill[i * 4 + 4]= true
	set i = 44 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "spiritlink")+ SaveSkillOrder(i * 4 + 1, "coupletarget"),'A0S9', 0,'Y173', "r")
	set IsMultiIconSkill[i * 4 + 1]= true
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "creepanimatedead"),'A0SC', 0,'Y174', "w")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "phaseshift"),'A0SB', 0,'Y175', "f")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "rainofchaos"),'A0S8','A1QP','Y176', "c")
	set i = 45 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "creepdevour"),'A0Z4', 0,'Y177', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "neutraldetectaoe"),'A0Z5', 0,'Y178', "c")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "blizzard"),'A0Z6', 0,'Y179', "r")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "clusterrockets"),'A0Z8','A1CV','Y180', "t")
	set i = 46 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "rejuvination"),'A136', 0,'Y181', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "r12"),'A13T', 0,'Y182', null)
	set IsPassiveSkill[i * 4 + 2]= true
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 2, "HXshuidaohaimin")
	endif
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 2, "HXshuidaorenshu")
	endif
	set IsPassiveSkill[i * 4 + 2]= true
	set NoRearmCombosTips[i * 4 + 2]= "远程模型使用水刀只造成80%的范围伤害"
	call Z1E(i * 4 + 2, "bgdmg2")
	call Z6E(i * 4 + 2, "Tide-Jinada")
	call Z6E(i * 4 + 2, "Tide-Drunken")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "incineratearrow")+ SaveSkillOrder(i * 4 + 3, "incineratearrowoff"),'A11N', 0,'Y183', "x")
	call Z1E(i * 4 + 3, "r29")
	set IsMultiIconSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "spiritofvengeance"),'A11K','Z31K','Y184', "t")
	set i = 47 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "chainlightning"),'A12J', 0,'Y185', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "spirittroll"),'A12K', 0,'Y186', "r")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "fanofknives"),'A14I', 0,'Y187', "w")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "incineratearrowon"),'A12P','A1D6','Y188', "f")
	set i = 48 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "creepthunderbolt"),'A1SO', 0,'Y189', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "chainlightning"),'A1SQ', 0,'Y190', "g")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "orb effect")+ SaveSkillOrder(i * 4 + 3, "range only")+ SaveSkillOrder(i * 4 + 3, "fanofknives")+ SaveSkillOrder(i * 4 + 3, "multi-attack"),'A229', 0,'Y191', "f")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "silence"),'A1T5','A235','Y192', "c")
	set i = 49 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "autodispel"),'A1TV', 0,'Y193', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "chainlightning"),'A1SW', 0,'Y194', "d")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "rechargeoff"),'A1SU', 0,'Y195', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "deathpact"),'A1U6','A30N','Y196', "r")
	set i = 50 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "standdown"),'A1YO', 0,'Y197', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "frenzyon"),'A1S7', 0,'Y198', "w")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "summongrizzly"),'A1YR', 0,'Y199', "f")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "fanofknives")+ SaveSkillOrder(i * 4 + 4, "autoharvestlumber"),'A1YQ','A3DE','Y200', "r")
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXzhangdahaimin")
	endif
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXrenshuhaimin")
	endif
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXshuidaohaimin")
	endif
	call Z1E(i * 4 + 4, "bgdmg2")
	set i = 51 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "creepthunderclap"),'A1RJ', 0,'Y201', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "gold2lumber")+ SaveSkillOrder(i * 4 + 2, "harvest"),'A1YX', 0,'Y202', "f")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "charm")+ SaveSkillOrder(i * 4 + 3, "immolation")+ SaveSkillOrder(i * 4 + 3, "unimmolation")+ SaveSkillOrder(i * 4 + 3, "animatedead"),'A1YY', 0,'Y203', "r")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "rechargeon")+ SaveSkillOrder(i * 4 + 4, "r123")+ SaveSkillOrder(i * 4 + 4, "locust"),'A1RK','A43H','Y204', "v")
	set i = 52 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "darkritual"),'A0FW','A3OD','Y205', "g")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives"),'A0GP', 0,'Y206', "r")
	call RegisterHeroSkill(i * 4 + 3, null,'A0M3','QP1M','Y207', null)
	//set IsDisabledSkill[i*4+3]=true
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, null,'A0FV','QP1N','Y208', null)
	set IsPassiveSkill[i * 4 + 4]= true
	set NoRearmCombosTips[i * 4 + 4]= "冷却时间在3秒及以下的技能每使用2次才触发1次战意（刺针扫射和粘稠鼻液除外）"
	set i = 53 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "wispharvest"),'A27F', 0,'Y209', "z")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "tranquility"),'A27G', 0,'Y210', "x")
	call RegisterHeroSkill(i * 4 + 3, null,'A27V','QP0P','Y211', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "transmute")+ SaveSkillOrder(i * 4 + 4, "shbug"),'A27H','A30J','Y212', "q")
	set IsMultiIconSkill[i * 4 + 4]= true
	set i = 54 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "fanofknives"),'A2H3', 0,'Y213', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "recharge")+ SaveSkillOrder(i * 4 + 2, "metamorphosis")+ SaveSkillOrder(i * 4 + 2, "shuashecheng")+ SaveSkillOrder(i * 4 + 2, "yongjiu1"),'QB0L', 0,'QY0L', "t")
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 2, "HXLianji")//+ SaveSkillOrder(i * 4 + 2, "melee morph")
	endif
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "darksummoning")+ SaveSkillOrder(i * 4 + 2, "r27"),'A2HS', 0,'Y215', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "ancestralspirit")+ SaveSkillOrder(i * 4 + 4, "acolyteharvest")+ SaveSkillOrder(i * 4 + 4, "acidbomb"),'A2JR','A2JL','Y216', "f")
	set IsMultiIconSkill[i * 4 + 4]= true
	//	set IsDisabledSkill[i * 4 + 4]= true
	set i = 55 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "steal"),'A2JB', 0,'Y217', "w")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "creepheal"),'A2J2', 0,'Y218', "t")
	call RegisterHeroSkill(i * 4 + 3, null,'A2EY','QP1O','Y219', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "autodispeloff"),'A2CI','A38C','Y220', "d")
	set i = 56 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "chainlightning"),'A2BE', 0,'Y221', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives"),'A2IT', 0,'Y222', "t")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "soulburn"),'A2HN', 0,'Y223', "d")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "submerge"),'A2BG','A30H','Y224', "e")
	set i = 57 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "fanofknives"),'A2FK', 0,'Y225', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "summonfactory"),'A2E3', 0,'Y226', "t")
	call RegisterHeroSkill(i * 4 + 3, null,'A2E4','QP1P','Y227', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "immolation")+ SaveSkillOrder(i * 4 + 4, "unimmolation")+ SaveSkillOrder(i * 4 + 4, "windwalk")+ SaveSkillOrder(i * 4 + 4, "auraunholy"),'A2E5','A43S','Y228', "r")
	set i = 58 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "spiritwolf"),'A03D', 0,'Y229', "v")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "deathcoil"),'A0ZF', 0,'Y230', "w")
	call RegisterHeroSkill(i * 4 + 3, null,'A03E','QP0Q','Y231', null)
	set IsPassiveSkill[i * 4 + 3]= true
	set IsNoDeathMatchSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "metamorphosis")+ SaveSkillOrder(i * 4 + 4, "melee morph")+ SaveSkillOrder(i * 4 + 4, "r95"),'QM02', 0,'Y232', "f")
	set i = 59 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "parasite"),'A0BH', 0,'Y233', "w")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "restoration")+ SaveSkillOrder(i * 4 + 2, "inv bug 1"),'Z234', 0,'Y234', "b")
	set IsNoDeathMatchSkill[i * 4 + 2]= true
	//set IsDisabledSkill[i * 4 + 2]= true	//暂时禁用织网
	call RegisterHeroSkill(i * 4 + 3, null,'Q0BK','QP29','Y235', null)
	set IsDisabledSkill[i * 4 + 3]= true
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "bash")+ SaveSkillOrder(i * 4 + 4, "roar"),'A0WQ', 0,'Y236', "t")
	set i = 60 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "summonphoenix"),'A0YM', 0,'Y237', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "deathcoil"),'A0PL', 0,'Y238', "b")
	call RegisterHeroSkill(i * 4 + 3, null,'A03P','QP0R','Y239', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, null,'A03Q','QP0S','Y240', null)
	set IsPassiveSkill[i * 4 + 4]= true
	set i = 61 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "range only")+ SaveSkillOrder(i * 4 + 1, "immolation")+ SaveSkillOrder(i * 4 + 1, "unimmolation"),'A1C0','A418','Y241', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "chainlightning"),'A0G2', 0,'Y242', "c")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "manashieldon")+ SaveSkillOrder(i * 4 + 3, "manashieldoff")+ SaveSkillOrder(i * 4 + 3, "shbug"),'A0MP', 0,'Y243', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "lavamonster"),'A1AT', 0,'Y244', "g")
	set i = 62 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "thunderbolt"),'A02H', 0,'Y245', "v")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "drunkenhaze"),'A08Q', 0,'Y246', "f")
	call RegisterHeroSkill(i * 4 + 3, null,'P247','A086','Y247', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "battlestations")+ SaveSkillOrder(i * 4 + 4, "r14"),'DRKN', 0,'Y248', "r")
	set IsNoDeathMatchSkill[i * 4 + 4]= true
	set i = 63 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "thunderbolt"),'QB0H', 0,'QY0H', "t")
	call RegisterHeroSkill(i * 4 + 2, null,'P250','QP0U','Y250', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "wispharvest"),'A2S0','QP0W','Y251', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "reincarnation")+ SaveSkillOrder(i * 4 + 4, "r15"),'A01Y','A1AZ','Y252', null)
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXqwew")
	endif
	set IsPassiveSkill[i * 4 + 4]= true
	set i = 64 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "channel")+ SaveSkillOrder(i * 4 + 1, "animatedead")+ SaveSkillOrder(i * 4 + 1, "stomp")+ SaveSkillOrder(i * 4 + 1, "tornado")+ SaveSkillOrder(i * 4 + 1, "ensnare")+ SaveSkillOrder(i * 4 + 1, "thunderclap")+ SaveSkillOrder(i * 4 + 1, "purge"),'A10R','A32Z','Y253', "e")
	set s = SaveSkillOrder(i * 4 + 1, "shockwave")+ SaveSkillOrder(i * 4 + 1, "frostarmor")+ SaveSkillOrder(i * 4 + 1, "manaburn")+ SaveSkillOrder(i * 4 + 1, "heal")+ SaveSkillOrder(i * 4 + 1, "chainlightning")+ SaveSkillOrder(i * 4 + 1, "raisedead")+ SaveSkillOrder(i * 4 + 1, "thunderbolt")
	set IsMultiIconSkill[i * 4 + 1]= true
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives"),'A1OP', 0,'Y254', "t")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "firebolt"),'A094', 0,'Y255', "v")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "doom"),'A0MU','A0A2','Y256', "d")
	set i = 65 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "impale"),'A0X7', 0,'Y257', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "creepheal"),'A1H5', 0,'Y258', "r")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "fanofknives"),'A2KO', 0,'Y259', "d")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "windwalk"),'A09U', 0,'Y260', "v")
	set i = 66 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "berserk"),'A05C', 0,'Y261', "w")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "roar"),'A29K', 0,'Y262', "r")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "bash"),'A0JJ', 0,'Y263', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "faeriefire"),'QB0C', 0,'QY0C', "g")
	set i = 67 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "shadowstrike"),'A0Q7', 0,'Y265', "d")
	
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "blink"),'A0ME', 0,'Y266', "b")
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 2, "HXshijianmanbu")
	endif
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "fanofknives"),'A04A', 0,'Y267', "f")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "shockwave"),'A28R','A28S','Y268', "w")
	set i = 68 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "berserk"),'A030', 0,'Y269', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "arrows")+ SaveSkillOrder(i * 4 + 2, "range only")+ SaveSkillOrder(i * 4 + 2, "channel"),'AHfa', 0,'Y270', "r")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "windwalk"),'QB0A', 0,'QY0A', "w")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "innerfire"),'A04Q', 0,'Y272', "e")
	set i = 69 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "carrionswarm"),'A0LK', 0,'Y273', "w")
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 1, "HXshijianmanbu")
	endif
	call RegisterHeroSkill(i * 4 + 2, null,'A0CZ','QP22','Y274', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "bash"),'A081','QP0X','Y275', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "clusterrockets")+ SaveSkillOrder(i * 4 + 4, "r16"),'A0J1','A1D7','Y276', "c")
	set i = 70 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "arrows")+ SaveSkillOrder(i * 4 + 1, "range only"),'A09V', 0,'Y277', "c")
	call RegisterHeroSkill(i * 4 + 2, null,'A1A3','QP21','Y278', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, null,'A0MM','QP0Y','Y279', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "shadowstrike"),'A080','A1UZ','Y280', "d")
	set i = 71 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "fanofknives"),'A1E7', 0,'Y281', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "tankdroppilot"),'A1DP', 0,'Y282', "c")
	call RegisterHeroSkill(i * 4 + 3, null,'A1E6','QP0Z','Y283', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "darkportal"),'A1AO','A1UV','Y284', "e")
	set i = 72 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "852273"),'A0T2', 0,'Y285', "r")
	set s = SaveSkillOrder(i * 4 + 1, "HXMomianwange")
	call RegisterHeroSkill(i * 4 + 2, null,'A0SS','QP1W','Y286', null)
	set IsPassiveSkill[i * 4 + 2]= true
	set NoBalanceOffTips[i * 4 + 2]= "远程模型使用盛宴只造成/回复 1.75/2.75/3.75/4.75% 生命值的伤害"
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "chainlightning"),'A194', 0,'Y287', "w")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "decouple"),'A0SW', 0,'Y288', "t")
	set i = 73 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "grabtree"),'A0MT', 0,'Y289', "b")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "banish"),'A2TD', 0,'Y290', "c")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "tornado"),'A09D', 0,'Y291', "w")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "drain"),'A0CC','A02Z','Y292', "d")
	set HeroSkillsIcon[i * 4 + 4]= "ReplaceableTextures\\CommandButtons\\BTNLifeDrain.blp"
	set i = 74 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, GetAbiltiyOrder('A046')),'A046','A3OH','Y293', "g")
	call RegisterHeroSkill(i * 4 + 2, null,'A04E','QP10','Y294', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "roar"),'A226', 0,'Y295', "c")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "howlofterror"),'A29I', 0,'Y296', "v")
	set i = 75 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "innerfire"),'A04V', 0,'Y297', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "chainlightning"),'A0GK', 0,'Y298', "b")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "sleep"),'A04Y', 0,'Y299', "t")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "magicleash"),'A02Q','A1D9','Y300', "f")
	set i = 76 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "fanofknives"),'A05V', 0,'Y301', "d")
	call RegisterHeroSkill(i * 4 + 2, null,'A01N','QP11','Y302', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, null,'A060','QP12','Y303', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "thunderbolt")+ SaveSkillOrder(i * 4 + 4, "yidaonimane"),'A067','A08P','Y304', "r")
	set i = 77 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "detectaoe"),'A06I', 0,'Y305', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "unimmolation"),'A06K', 0,'Y306', "r")
	call RegisterHeroSkill(i * 4 + 3, null,'A06D','QP13','Y307', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "magicleash"),'A0FL','A1CX','Y308', "d")
	set i = 78 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "detonate"),'A1P8', 0,'Y309', "c")
	call RegisterHeroSkill(i * 4 + 2, null,'A0ES','QP14','Y310', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "bash"),'A0G5','QP1X','Y311', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "creepheal"),'A0G4','A1D8','Y312', "e")
	set i = 79 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "tankloadpilot"),'A1QW', 0,'Y313', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "windwalk"),'A0CA', 0,'Y314', "c")
	
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "orb effect")+ SaveSkillOrder(i * 4 + 3, "range only"),'A0CG', 0,'Y315', null)
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 3, "HXLianji")
	endif
	set IsPassiveSkill[i * 4 + 3]= true
	call Z1E(i * 4 + 3, "bgdmg2")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "disassociate"),'A0CT','A3DM','Y316', "t")
	call Z1E(i * 4 + 4, "r31")
	set i = 80 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "roar")+ SaveSkillOrder(i * 4 + 1, "howlofterror")+ SaveSkillOrder(i * 4 + 1, "battleroar"),'A0EY', 0,'Y317', "z")
	set IsMultiIconSkill[i * 4 + 1]= true
	call RegisterHeroSkill(i * 4 + 2, null,'Z318','A0BR','Y318', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, null,'A0FU','QP15','Y319', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 1, "852273"),'A29J','A3OJ','Y320', "r")
	set s = SaveSkillOrder(i * 4 + 4, "HXMomianwange")
	set i = 81 -1
	//call RegisterHeroSkill(i*4+1,SaveSkillOrder(i*4+1,"disenchant"),'A06O',0,'Y321',"m")
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "disenchant"),'A06O','A3NX','Y321', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "voodoo"),'A0H0', 0,'Y322', "r")
	call RegisterHeroSkill(i * 4 + 3, null,'A0FA','QP16','Y323', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "lightningshield"),'A06R','A1B4','Y324', "c")
	set i = 82 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "dismount"),'A0I6', 0,'Y325', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "creepheal"),'A0S1', 0,'Y326', "r")
	call RegisterHeroSkill(i * 4 + 3, null,'A0C6','QP17','Y327', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "chainlightning"),'A0E2','A1MR','Y328', "c")
	set i = 83 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "farsight"),'A44X', 0,'Y61A', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "creepheal"),'A44Z', 0,'Y61B', "b")
	call RegisterHeroSkill(i * 4 + 3, null,'A0I8','QP1Z','Y331', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "shadowsight"),'A0LH', 0,'Y332', "r")
	set i = 84 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "townbelloff"),'A0I3', 0,'Y333', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "chainlightning"),'A0MF', 0,'Y334', "g")
	call RegisterHeroSkill(i * 4 + 3, null,'A0MG','QP18','Y335', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "windwalk")+ SaveSkillOrder(i * 4 + 4, "r17"),'A0NS','A1DA','Y336', "b")
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXqwew")
	endif
	set i = 85 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "impale"),'A0HW', 0,'Y337', "d")
	call RegisterHeroSkill(i * 4 + 2, null,'A0FX','QP19','Y338', null)
	set IsPassiveSkill[i * 4 + 2]= true
	set NoRearmCombosTips[i * 4 + 2]= "远程英雄和幻象只造成一半的荒芜伤害"
	call RegisterHeroSkill(i * 4 + 3, null,'A0NA','QP20','Y339', null)
	set IsPassiveSkill[i * 4 + 3]= true
	set NoRearmCombosTips[i * 4 + 3]= "力量模型只折射 8/10/12/14% 的伤害"
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "healingspray")+ SaveSkillOrder(i * 4 + 4, "healingwave")+ SaveSkillOrder(i * 4 + 4, "r18"),'A0H9', 0,'Y340', "t")
	set IsMultiIconSkill[i * 4 + 4]= true
	set i = 86 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "chainlightning"),'A0NM', 0,'Y341', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "unimmolation"),'A0NE', 0,'Y342', "v")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "renew"),'A0NO', 0,'Y343', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "tornado"),'A0NT','A0NX','Y344', "d")
	set i = 87 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "arrows")+ SaveSkillOrder(i * 4 + 1, "range only"),'A0OI', 0,'Y345', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "chainlightning"),'A0OJ', 0,'Y346', "t")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "r19"),'A0IF','QP1A','Y347', null)
	set IsPassiveSkill[i * 4 + 3]= true
	set NoRearmCombosTips[i * 4 + 3]= "若同时学习了球状闪电，则精气光环触发时只恢复8/10/12/14%的最大魔法"
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "blizzard"),'A0OK','A1VW','Y348', "c")
	set i = 88 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "autodispelon"),'A0J5', 0,'Y349', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "creepheal"),'A0AS', 0,'Y350', "w")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "blizzard"),'A06P', 0,'Y351', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "inferno")+ SaveSkillOrder(i * 4 + 4, "r20"),'S008','S00U','Y352', "r")
	set i = 89 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "renewon"),'A0NB', 0,'Y353', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "carrionscarabsoff"),'A0N8', 0,'Y354', "f")
	call RegisterHeroSkill(i * 4 + 3, null,'A0N7','QP1B','Y355', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, null,'A0MW','A27C','Y356', null)
	set IsDisabledSkill[i * 4 + 4]= true
	set i = 90 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "thunderbolt"),'A0NQ', 0,'Y357', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "devourmagic"),'A10L', 0,'Y358', "g")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "darkportal"),'A0OR', 0,'Y359', "d")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "renewoff"),'A10Q','A1DB','Y360', "w")
	set i = 91 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "rainoffire"),'A01I', 0,'Y361', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "flamestrike"),'A0RA', 0,'Y362', "t")
	call RegisterHeroSkill(i * 4 + 3, null,'AIcd','QP1C','Y363', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "divineshield")+ SaveSkillOrder(i * 4 + 4, "whirlwind"),'A0R0', 0,'Y364', "d")
	set i = 92 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "repair, str bug"),'A15S','A3JX','Y365', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "lumber2gold"),'A0R5', 0,'Y366', "r")
	//set IsDisabledSkill[i*4+2]=true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "soulpreservation")+ SaveSkillOrder(i * 4 + 3, "r21"),'A15V', 0,'Y367', "t")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "metamorphosis")+ SaveSkillOrder(i * 4 + 4, "melee morph")+ SaveSkillOrder(i * 4 + 4, "r24"),'QM03', 0,'Y368', "f")
	set IsMultiIconSkill[i * 4 + 4]= true
	set i = 93 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "repairoff"),'A0QE', 0,'Y369', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "autoentangle")+ SaveSkillOrder(i * 4 + 2, "r26"),'A0QG', 0,'Y370', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "bloodlust"),'A0R7', 0,'Y371', "r")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "manaflareon"),'A0QK','A21Q','Y372', "w")
	set i = 94 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "tranquility"),'A32A', 0,'A32T', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "curse"),'A32C', 0,'A32U', "w")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "eattree")+ SaveSkillOrder(i * 4 + 3, "controlmagic"),'A32E', 0,'A32V', "d")
	set IsMultiIconSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "absorb"),'A32G', 0,'A32W', "r")
	set i = 95 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "townbellon"),'A0I7', 0,'Y377', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "autoentangleinstant"),'A180', 0,'Y378', "c")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "load"),'A0B1', 0,'Y379', "d")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "cannibalize"),'A1BX','A30L','Y380', "b")
	set i = 96 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "repairon"),'A1EL', 0,'Y381', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "autoharvestgold"),'A19V', 0,'Y382', "r")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "metamorphosis")+ SaveSkillOrder(i * 4 + 3, "range morph")+ SaveSkillOrder(i * 4 + 3, "r3"),'QM04', 0,'Y383', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "chainlightning"),'A19O','A1MV','Y384', "f")
	set i = 97 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "etherealform"),'A1MG', 0,'Y385', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "replenish"),'A1HS', 0,'Y386', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "berserk"),'A1HQ', 0,'Y387', "g")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "taunt")+ SaveSkillOrder(i * 4 + 4, "fanofknives")+ SaveSkillOrder(i * 4 + 4, "r22"),'A1MI','A2QE','Y388', "t")
	set i = 98 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "fanofknives"),'A1IM', 0,'Y389', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "whirlwind"),'A1J7', 0,'Y390', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "abuz agi") ,'A1HR','QP1F','Y391', null)
	set IsPassiveSkill[i * 4 + 3]= true
	set NoBalanceOffTips[i * 4 + 3]= "远程模型使用能量转移只有2/3的效果"
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "windwalk")+ SaveSkillOrder(i * 4 + 4, "ibug"),'A1IN', 0,'Y392', "d")
	set i = 99 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "replenishoff"),'A2KZ', 0,'Y393', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "board"),'A0H4', 0,'Y394', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "metamorphosis")+ SaveSkillOrder(i * 4 + 3, "range morph")+ SaveSkillOrder(i * 4 + 3, "chemicalrage"),'A1RI', 0,'Y395', "t")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "chainlightning"),'A07Q', 0,'Y396', "r")
	set i = 100 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "requestsacrifice"),'QB0F', 0,'QY0F', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives"),'A20T', 0,'Y398', "c")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "chainlightning"),'A06V', 0,'Y399', "g")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "berserk"),'A21F','A21G','Y400', "v")
	set i ='e'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "chainlightning"),'A1S8', 0,'Y401', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "replenishon"),'A1SB', 0,'Y402', "c")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "fingerofdeath")+ SaveSkillOrder(i * 4 + 3, "flare"),'A1S4', 0,'Y403', "w")
	set IsMultiIconSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "blizzard"),'A343','A34J','Y404', "g")
	set i ='f'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "frostnova"),'A07F', 0,'Y405', "v")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "frostarmor"),'A08R', 0,'Y406', "f")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "innerfire"),'A053', 0,'Y407', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "thunderbolt"),'A05T','A08H','Y408', "c")
	set i ='g'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "carrionswarm"),'A078', 0,'Y409', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "silence"),'A07M', 0,'Y410', "e")
	call RegisterHeroSkill(i * 4 + 3, null,'A02C', 0,'Y411', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "locustswarm"),'A04N', 0,'Y412', "x")
	if ExtraSkillsNumber == 2 then
		set ZTP[i * 4 + 4]= "该技能在此模式下会减少对建筑25%伤害"
	endif
	set HeroSkillsIcon[i * 4 + 4]= "ReplaceableTextures\\CommandButtons\\BTNExorcism.blp"
	set i ='h'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "freezingbreath"),'A0X5', 0,'Y413', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "hex"),'A0MN', 0,'Y414', "d")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "drain"),'A02N', 0,'Y415', "r")
	set HeroSkillsIcon[i * 4 + 3]= "ReplaceableTextures\\CommandButtons\\BTNManaDrain.blp"
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "chainlightning"),'A095','A09W','Y416', "f")
	set i ='i'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "magicdefense"),'A173', 0,'Y417', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "buff placer"),'A0MY','QP1D','Y418', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "ward"),'A0MS', 0,'Y419', "w")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "summongrizzly"),'A013','A0A6','Y420', "v")
	set i ='j'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "carrionswarm"),'A02S','A3Y8','Y421', "w")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "innerfire"),'A037', 0,'Y422', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "blackarrowon"),'A1RD', 0,'Y423', "d")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "roar"),'A29L','A447','Y424', "v")
	set i ='k'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "cripple"),'A08X', 0,'Y425', "g")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "creepheal"),'A1NA', 0,'Y426', "c")
	set IsMultiIconSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, null,'A0VX','QP23','Y427', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "fanofknives"),'A1NE','A2IG','Y428', "t")
	set i ='l'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "tankpilot"),'A055', 0,'Y429', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "forceboard"),'A0RW', 0,'Y430', "e")
	call RegisterHeroSkill(i * 4 + 3, null,'A03N','QP1E','Y431', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "mirrorimage"),'A03O', 0,'Y432', "t")
	set i ='m'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "stomp")+ SaveSkillOrder(i * 4 + 1, "range morph")+ SaveSkillOrder(i * 4 + 1, "r44")+ SaveSkillOrder(i * 4 + 1, "metamorphosis")+ SaveSkillOrder(i * 4 + 1, "yongjiu3"),'A332', 0,'Y437', "r")
	if (not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 1, "HXBinglongTuijin")
	endif
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "unstoneform"),'A2LA', 0,'Y438', "t")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "townbellon"),'A2LB', 0,'Y439', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "unwindwalk"),'A0Z0', 0,'Y440', "w")
	set i = 110 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "unravenform"),'A2M1', 0,'Y433', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "unrobogoblin"),'A2LM', 0,'Y434', "f")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "undeadbuild"),'A2LL', 0,'Y435', "r")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "metamorphosis")+ SaveSkillOrder(i * 4 + 4, "summongrizzly"),'A2M0', 0,'Y436', "d")
	set IsDisabledSkill[i * 4 + 4]= true
	set i ='o'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "cripple"),'A2QM', 0,'Y443', "d")
	set IsMultiIconSkill[i * 4 + 1]= true
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "unsubmerge"),'A2TJ', 0,'Y444', "f")
	set IsMultiIconSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "unflamingarrows"),'A2QI', 0,'Y445', "r")
	set IsMultiIconSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "summonwareagle"),'A2TI', 0,'Y446', "t")
	set IsMultiIconSkill[i * 4 + 4]= true
	set i ='p'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "webon"),'A2QT', 0,'Y453', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "chainlightning"),'A2T5', 0,'Y454', "f")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "avengerform"),'A2SG', 0,'Y455', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "lavamonster"),'A2TF', 0,'Y456', "r")
	set i ='q'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "acidbomb"),'A1PH', 0,'Y458', "e")
	call RegisterHeroSkill(i * 4 + 2, null,'A33Q','A33R','Y459', null)
	set IsPassiveSkill[i * 4 + 2]= true
	//	if (not Mode__RearmCombos) then
	//		set IsDisabledSkill[i * 4 + 2]= true
	//	endif
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "magicdefense"),'A34A','QP28','A34B', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "barkskinoff"),'A33U', 0,'Y460', "g")
	if (GKV or HOV or VT) == false then
		set i = 114 -1
		call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "request_hero")+ SaveSkillOrder(i * 4 + 1, "r23"),'Z601', 0,'Y601', "t")
		call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "mechanicalcritter"),'Z602', 0,'Y602', "d")
		call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "militia"),'Z603', 0,'Y603', "f")
		call RegisterHeroSkill(i * 4 + 4, null, 0, 0, 0, null)
		set IsDisabledSkill[i * 4 + 4]= true
		set i = 115 -1
		call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "militiaconvert"),'Z604', 0,'Y604', "y")
		call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "windwalk"),'Z605', 0,'Y605', "v")
		call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "militiaoff"),'Z606', 0,'Y606', "g")
		call RegisterHeroSkill(i * 4 + 4, null, 0, 0, 0, null)
		set IsDisabledSkill[i * 4 + 4]= true
		set i = 116 -1
		call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "militiaunconvert"),'Z607', 0,'Y607', "Z")
		call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "mindrot"),'Z608', 0,'Y608', "x")
		call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "monsoon"),'Z609', 0,'Y609', "c")
		call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "mount"),'Z610','A3K5','Y610', "b")
		call RZR(i * 4 + 4)
		call ExecuteFunc("PreloadKael_Ability")
	endif
	set i ='u'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "unload"),'A40K','A40S','Y500', "j")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "unloadall"),'A40L','A40T','Y501', "k")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "unloadallcorpses"),'A40M','A40U','Y502', "l")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "undeadbuild"),'A40N','A40V','Y503', "i")
	//set IsDisabledSkill[i * 4 + 4]= true	无形
	set i ='v'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "lavamonster"),'A0QV', 0,'Y614', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "carrionscarabs")+ SaveSkillOrder(i * 4 + 2, "carrionscarabsoff")+ SaveSkillOrder(i * 4 + 2, "carrionscarabson"),'A43Y', 0,'Y615', "q")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "carrionscarabs")+ SaveSkillOrder(i * 4 + 3, "carrionscarabsoff")+ SaveSkillOrder(i * 4 + 3, "carrionscarabson"),'A00T', 0,'Y616', "q")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "renew"),'A46J', 0,'Y61K', "c")
	set i ='w'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "soulburn"),'A0EC', 0,'Y329', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "lumber2gold"),'A44U', 0,'Y618', "e")
	//set IsDisabledSkill[i * 4 + 2]= true	下注
	if Mode__SixSkills and(not Mode__RearmCombos) then
		set IsDisabledSkill[i * 4 + 2]= true
	endif
	call RegisterHeroSkill(i * 4 + 3, null,'A0LE','QP1Y','Y330', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, null,'A440','QP25','Y617', null)
	set IsPassiveSkill[i * 4 + 4]= true
	set i = 120-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "volcano"),'A451', 0,'Y61C', "w")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "stomp"),'A454', 0,'Y61D', "t")
	call RegisterHeroSkill(i * 4 + 3, null,'A45B','QP26','Y61E', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "fanofknives"),'A456', 0,'Y61F', "r")
	set i = 121-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "curse"),'A45W', 0,'Y61G', "q")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "volcano"),'A45X', 0,'Y61H', "w")
	call RegisterHeroSkill(i * 4 + 3, null,'A460','QP27','Y61I', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "creepthunderclap"),'A461', 0,'Y61J', "d")
	set GL = 121
	if GKV or HOV or VT then
		call ExecuteFunc("R1R")
	endif
endfunction

function RegisterItem takes integer EUN, integer EWN, integer EYN, integer EZN returns integer
	set MaxItemsNumber = MaxItemsNumber + 1
	set XXV[MaxItemsNumber]= EUN
	set XOV[MaxItemsNumber]= EWN
	set XRV[MaxItemsNumber]= EYN
	call SaveBoolean(SightDataHashTable, XRV[MaxItemsNumber], 0, true)
	set XIV[MaxItemsNumber]= EZN
	if EWN > 0 then
		set ItemsIconFilePath[MaxItemsNumber]= GetAbilitySoundById(EWN, SOUND_TYPE_EFFECT_LOOPED)
		if StringLength(ItemsIconFilePath[MaxItemsNumber])< 20 then
		endif
	endif
	return MaxItemsNumber
endfunction
function InitItemsSystem takes nothing returns nothing
	local string s = ""
	call RegisterItem('I0FF','I0FG', 0, 0)
	set it_mlq = RegisterItem('I0UB','I0UC', 0,'I0UD')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'n12V', 0), it_mlq)
	set it_xj = RegisterItem('I0VJ','I0VK', 0,'I0VL')
	set jz_xj = RegisterItem('I0VG','I0VH','h0EU','I0VI')
	set Recipe_HurricanePike = RegisterItem('I0VX','I0VY','n138','I0VZ')
	set Item_HurricanePike = RegisterItem('I0W0','I0W1', 0,'I0W2')
	set it_hyzr = RegisterItem('I0VM','I0VN', 0,'I0VO')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'n134', 0), it_hyzr)
	set it_jys = RegisterItem('I0RC','I0RD','n139', 0)
	set it_fj = RegisterItem('IZPS','IZPD', 0,'IZPE')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'n125', 0), it_fj)//否决一键购买

	set Recipe_AetherLens = RegisterItem('I0V3','I0V4','n12W','I0V5')
	set Item_AetherLens   = RegisterItem('I0UE','I0UF',     0,'I0UG')

	set XMV = RegisterItem('I02Q','I02O','h011','I00A')
	set XPV = RegisterItem('I02S','I02P','h012','I0CA')
	set XQV = RegisterItem('I02N','I02R','h013','I0CS')
	set XSV = RegisterItem('I02X','I02Y','h015','I0D4')
	set XTV = RegisterItem('I02Z','I043','h016','I0CV')
	set XUV = RegisterItem('I030','I044','h017','I0D2')
	set XWV = RegisterItem('I031','I045','h018','I0D5')
	set XYV = RegisterItem('I032','I046','h019','I0CZ')
	set XZV = RegisterItem('I033','I047','h01A','I0D7')
	set X_V = RegisterItem('I034','I048','h01B','I0CX')
	set X0V = RegisterItem('I035','I049','h01C','I0CI')
	set X1V = RegisterItem('I036','I04A','h01D','I0CH')
	set X2V = RegisterItem('I037','I04B','h01E','I0CR')
	set X3V = RegisterItem('I038','I04C','h01F','I0CJ')
	set X4V = RegisterItem('I039','I04D','h01G','I0DG')
	set X5V = RegisterItem('I0MS','I0MR', 0,'I0MT')
	set X6V = RegisterItem('I03B','I04E','h01H','I0DA')
	set X7V = RegisterItem('I03C','I04F','h01I','I0CQ')
	set Item_IronwoodBranch = RegisterItem('I03D','I04G','h01J','I0CU')
	set X9V = RegisterItem('I03E','I04H','h01K','I0C7')
	set OVV = RegisterItem('I03E','I04I','h01K','I0DH')
	set OEV = RegisterItem('I03F','I04J','h01L','I0CM')
	set OXV = RegisterItem('I03G','I04K','h01M','I0CD')
	set OOV = RegisterItem('I03H','I04L','h01N','I0CG')
	set ORV = RegisterItem('I03I','I04M','h01O','I0D0')
	set OIV = RegisterItem('I03J','I04N','h01P','I0CN')
	set OAV = RegisterItem('I03K','I04O','h01Q','I0D8')
	set ONV = RegisterItem('I03L','I04P','h01R','I0CE')
	set OBV = RegisterItem('I03M','I04Q','h01S','I0DB')
	set OCV = RegisterItem('I03N','I04R','h01T','I0CL')
	set ODV = RegisterItem('I03P','I04S','h01U','I0CY')
	set OFV = RegisterItem('I03Q','I04T','h01V','I0DI')
	set OGV = RegisterItem('I03R','I04U','h01W','I0CW')
	set OHV = RegisterItem('I03S','I04V','h01X','I0DJ')
	set OJV = RegisterItem('I03T','I04W','h01Y','I0CP')
	set OKV = RegisterItem('I03U','I04X','h01Z','I0CC')
	set OLV = RegisterItem('I03V','I04Y','h020','I0C5')
	set OMV = RegisterItem('I03W','I04Z','h021','I0DK')
	set OPV = RegisterItem('I03X','I050','h022','I0D1')
	set OQV = RegisterItem('I03A','I051','h023','I0D9')
	set OSV = RegisterItem('I0KB','I0KA', 0,'I0KC')
	set OTV = RegisterItem('I03Y','I052','h024','I0C9')
	set OUV = RegisterItem('I03Z','I053','h025','I0CK')
	set OWV = RegisterItem('I040','I054','h026','I0DL')
	set OYV = RegisterItem('I041','I055','h027','I0D6')
	set OZV = RegisterItem('I00L','I0AV','h02B', 0)
	set O_V = RegisterItem('I05E','I0AM', 0,'I0DN')
	set O0V = RegisterItem('I0AU','I0AN', 0,'I0DO')
	set O1V = RegisterItem('I0AS','I0AO', 0,'I0DP')
	set O2V = RegisterItem('I0AT','I0AP', 0,'I0DQ')
	set O7V = RegisterItem('I0GW','I0GY', 0,'I0H3')
	set O6V = RegisterItem('I0H2','I0GX', 0,'I0DR')
	set O5V = RegisterItem('I0GV','I0H1', 0,'I0H4')
	set O8V = RegisterItem('I0Q8','I0Q7', 0,'I0Q9')
	set O4V = RegisterItem('I0AR','I0H0', 0,'I0H6')
	set O3V = RegisterItem('I0AQ','I0GZ', 0,'I0H5')
	set Item_MagicStick = RegisterItem('I0GD','I0GC','h074','I0GE')
	set Item_MagicWand = RegisterItem('I0HC','I0HB', 0,'I0HA')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h07S', 0), Item_MagicWand)
	set RVV = RegisterItem('I0HT','I0HR','h07W','I0HV')
	set REV = RegisterItem('I0HU','I0HP', 0,'I0HW')
	set RXV = RegisterItem('I0J7','I0J6','h083','I0J8')
	set NTV = RegisterItem('I0JJ','I0JI','h087','I0JK')
	set XKV = RegisterItem('I0MA','I0M9','h0CM','I0MB')
	set XLV = RegisterItem('I0MD','I0ME', 0,'I0MC')
	set R0V = RegisterItem('I057','I05C','h02A','ITGB')
	set XHV = RegisterItem('I0QI','I0QH', 0,'I0QJ')
	set XJV = RegisterItem('I0QL','I0QK','ho02','I0QM')
	set R1V = RegisterItem('INTD','INTG', 0, 0)
	set RYV = RegisterItem('I042','I05D','h028','INCP')
	set RZV = RegisterItem('I0HO','I0HN','h07V', 0)
	set R_V = RegisterItem('I056','I05F','h029','INHS')
	set R2V = RegisterItem('I058','I05G','h02C', 0)
	set R3V = RegisterItem('I059','I05H','h02D', 0)
	set R4V = RegisterItem('I05A','I05I','h02E', 0)
	set R5V = RegisterItem('I05B','I05J','h02F', 0)
	set R6V = RegisterItem('I0B0','I0B1', 0, 0)
	set R7V = RegisterItem('I0TC','I0TD', 0, 0)
	set R8V = RegisterItem('I0GI','I0GH','h076', 0)
	set R9V = RegisterItem('I0KT','I0KS','h0B9', 0)
	set IVV = RegisterItem('I0NF','I0NG','h0D3', 0)
	set IEV = RegisterItem('I061','I062', 0,'I01J')
	set IXV = RegisterItem('I064','I063', 0,'I01K')
	set IOV = RegisterItem('I065','I066', 0,'I01L')
	set IRV = RegisterItem('I068','I067', 0,'I01M')
	set IIV = RegisterItem('I069','I06A', 0,'I0C6')
	set IAV = RegisterItem('I06C','I06B', 0,'I01P')
	set IBV = RegisterItem('I03O','I02T', 0,'I01R')
	set ICV = RegisterItem('I02U','I05Y', 0,'I01Q')
	set IDV = RegisterItem('I060','I05Z', 0,'I01S')
	set IFV = RegisterItem('I06E','I06D', 0,'I01T')
	set IGV = RegisterItem('I0NO','I0NN', 0,'I0NP')
	set IHV = RegisterItem('I06G','I06F', 0,'I01U')
	set IJV = RegisterItem('I06I','I06H', 0,'I01V')
	set IKV = RegisterItem('I06K','I06J', 0,'I01W')
	set ILV = RegisterItem('I06M','I06L', 0,'I01X')
	set IMV = RegisterItem('I08F','I08G', 0,'I01Y')
	set IPV = RegisterItem('I08I','I08H', 0,'I01Z')
	set IQV = RegisterItem('I08J','I08K', 0,'I020')
	set ISV = RegisterItem('I08N','I08O', 0,'I021')
	set ITV = RegisterItem('I08Q','I08P', 0,'I022')
	set IUV = RegisterItem('I08S','I08R', 0,'I023')
	set IWV = RegisterItem('I0JB','I0J9', 0,'I0JD')
	set IYV = RegisterItem('I0EW','I0EV', 0,'I0EX')
	set IZV = RegisterItem('I0JC','I0JA', 0,'I0JE')
	set I_V = RegisterItem('I08U','I08T', 0,'I024')
	set I0V = RegisterItem('I08W','I08V', 0,'I0CO')
	set I1V = RegisterItem('I08X','I08Y', 0,'I025')
	set Item_EulScepterOfDivinity = RegisterItem('I090','I08Z', 0,'I026')
	set I3V = RegisterItem('I092','I091', 0,'I027')
	set I4V = RegisterItem('I094','I093', 0,'I028')
	set I5V = RegisterItem('I096','I095', 0,'I029')
	set I6V = RegisterItem('I098','I097', 0,'I02A')
	set I7V = RegisterItem('I09A','I099', 0,'I02B')
	set I8V = RegisterItem('I09B','I09C', 0,'I02C')
	// BKB 6 种
	set I9V = RegisterItem('I0G2','I0FZ', 0,'I0G8')// 10
	set AVV = RegisterItem('I0G6','I0G0', 0,'I0G9')// 9
	set AEV = RegisterItem('I09E','I0FY', 0,'I0G7')// 8
	set AXV = RegisterItem('I0G5','I0FS', 0,'I02D')// 7
	set AOV = RegisterItem('I0G3','I09D', 0,'I0GB')// 6
	set ARV = RegisterItem('I0G4','I0G1', 0,'I0GA')// 5
	set AIV = RegisterItem('I0AX','I0AW', 0, 0)
	set AAV = RegisterItem('I0TE','I0TF', 0, 0)
	set ANV = RegisterItem('I09G','I09F', 0,'I02E')	//近战分身斧
	set ABV = RegisterItem('I0MV','I0MU', 0,'I0MW')	//远程分身斧
	set ACV = RegisterItem('I09I','I09H', 0,'I02F')
	set ADV = RegisterItem('I09K','I09M', 0,'I01G')//1
	set AFV = RegisterItem('I09J','I09P', 0,'I02G')//2
	set AGV = RegisterItem('I09Q','I09N', 0,'I0DC')//3
	set AHV = RegisterItem('I09S','I09O', 0,'I0DD')//4
	set AJV = RegisterItem('I09R','I09L', 0,'I0D3')//5级大根
	set AKV = RegisterItem('I09U','I09T', 0,'I02H')
	set ALV = RegisterItem('I09V','I09X', 0,'I02I')
	set AMV = RegisterItem('I09W','I09Y', 0,'I02J')
	set APV = RegisterItem('I0A0','I09Z', 0,'I0BO')
	set AQV = RegisterItem('I0HK','I0HJ', 0,'I0HL')
	set ASV = RegisterItem('I0A2','I0A1', 0,'I0BP')
	set ATV = RegisterItem('I0LI','I0LJ', 0,'I0LK')
	set AUV = RegisterItem('I0A4','I0A3', 0,'I0BQ')
	set AWV = RegisterItem('I0A6','I0A5', 0,'I0BR')
	set AYV = RegisterItem('I0K8','I0K7', 0,'I0K9')
	set AZV = RegisterItem('I0A7','I0A8', 0,'I0BS')
	set A_V = RegisterItem('I0KQ','I0KP', 0,'I0KR')
	set A0V = RegisterItem('I0AA','I0A9', 0,'I0BT')
	set A1V = RegisterItem('I0AA','I0KL', 0,'I0KM')
	set A2V = RegisterItem('I0AC','I0AB', 0,'I0BU')
	set A3V = RegisterItem('I0AD','I0AE', 0,'I0BV')
	set A4V = RegisterItem('I0AG','I0AF', 0,'I0CT')
	set A5V = RegisterItem('I0AH','I0AI', 0,'I0BW')
	set XFV = RegisterItem('I0B8','I0AY', 0,'I00B')
	set XCV = RegisterItem('I0QT','I0QS', 0,'I0QU')
	set XDV = RegisterItem('I0QT','I0TB', 0,'I0QU')
	set A6V = RegisterItem('I0AK','I0AJ', 0,'I0BX')
	set A7V = RegisterItem('I07K','I0AL', 0,'I0BY')
	set A8V = RegisterItem('I0BB','I0BA', 0,'I0BZ')
	set A9V = RegisterItem('I0LE','I0LC', 0,'I0LD')
	set NVV = RegisterItem('I0BC','I0BD', 0,'I00C')
	set NEV = RegisterItem('I0BF','I0BE', 0,'I0C0')
	set NXV = RegisterItem('I014','I01D', 0, 0)
	set NOV = RegisterItem('I0BH','I0BG', 0,'I0C1')
	set NRV = RegisterItem('I0BI','I0BJ', 0,'I0C2')
	set NIV = RegisterItem('I0BL','I0BK', 0,'I0C3')
	set NNV = RegisterItem('I0BN','I0BM', 0,'I0C4')
	set NBV = RegisterItem('I00S','I00M', 0,'I01C')
	set NCV = RegisterItem('I00T','I00Q', 0,'I01E')
	set NDV = RegisterItem('I00V','I00N', 0,'I01F')
	set NFV = RegisterItem('I00W','I00R', 0,'I0DE')
	set NGV = RegisterItem('I00X','I00Z', 0,'I0CF')
	set NHV = RegisterItem('I00Y','I010', 0,'I0DF')
	set NJV = RegisterItem('I013','I012', 0,'I0CB')
	set NKV = RegisterItem('I0GK','I0GJ', 0,'I0GL')
	set NMV = RegisterItem('I0HG','I0HI', 0,'I0HH')
	set NPV = RegisterItem('I0I0','I0K6', 0,'I0I2')
	set NQV = RegisterItem('I0JG','I0JF', 0,'I0JH')
	set NSV = RegisterItem('I0KD','I0KF', 0,'I0KE')
	set NUV = RegisterItem('I0KX','I0KY', 0,'I0KZ')
	set NWV = RegisterItem('I0LG','I0LF', 0,'I0LH')
	set NYV = RegisterItem('I0LP','I0LL', 0,'I0LQ')
	set ROV = RegisterItem('I0LR','I0LT', 0,'I0LS')
	set NZV = RegisterItem('I0MJ','I0MI', 0,'I0MK')
	set N_V = RegisterItem('I0N1','I0N0', 0,'I0N2')
	set RRV = RegisterItem('I0ND','I0NE', 0,'I0NC')
	set RIV = RegisterItem('I0NL','I0NK', 0,'I0NM')
	set N0V = RegisterItem('I0O2','I0O3', 0,'I0O4')
	set RAV = RegisterItem('I0OC','I0OE', 0,'I0OD')
	set RNV = RegisterItem('I0OF','I0OG', 0,'I0OH')
	set RBV = RegisterItem('I0OJ','I0OI', 0,'I0OK')
	set RCV = RegisterItem('I0OM','I0OL', 0,'I0ON')
	set Item_MoonShard = RegisterItem('I0SI','I0SJ', 0,'I0SK')
	set RFV = RegisterItem('I0SU','I0SV', 0,'I0SW')
	set RLV = RegisterItem('I0SL','I0SM', 0,'I0SN')
	set RJV = RegisterItem('I0SR','I0SS', 0,'I0ST')
	set RGV = RegisterItem('I0T5','I0T6', 0,'I0T7')
	set RPV = RegisterItem('I0S6','I0S7','n12A','I0S8')
	set RTV = RegisterItem('I0SC','I0SD', 0,'I0SE')
	set RQV = RegisterItem('I0S9','I0SA', 0,'I0SB')
	set INV = RegisterItem('I0SZ','I0T0', 0,'I0T1')
	set XGV = RegisterItem('I0P9','I0PB','h0EI','I0PA')
	set N1V = RegisterItem('I0OU','I0OV', 0,'I0OW')
	set N2V = RegisterItem('I0OY','I0OX', 0,'I0OZ')
	set RUV = RegisterItem('I0P0','I0P1', 0,'I0P2')
	set RWV = RegisterItem('I0P3','I0P4', 0,'I0P5')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h02G', 0), IEV)
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h086', 0), NQV)
	set s = "ReplaceableTextures\\CommandButtons\\BTNSnazzyScroll.blp"
	set RKV = RegisterItem(0, 0,'h0DY', 0)
	set RHV = RegisterItem('I0T2','I0T3','n12H','I0T4')
	set RMV = RegisterItem('I0SO','I0SP','n12D','I0SQ')
	set RSV = RegisterItem('I0SF','I0SG','n12C','I0SH')
	set N3V = RegisterItem('I05L','I05R','h02H','I0DS')
	set N4V = RegisterItem('I05M','I05S','h02I','I0DT')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h02J', 0), IIV)
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h014', 0), IBV)
	set N5V = RegisterItem('I05O','I05T','h02K','I0DU')
	set N6V = RegisterItem('I05P','I05U','h02L','I0DW')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h02M', 0), IHV)
	set N7V = RegisterItem('I05K','I05V','h02N','I0DX')
	set N8V = RegisterItem('I05N','I05W','h02O','I0DY')
	set N9V = RegisterItem('I05Q','I05X','h02P','I0DZ')
	set BVV = RegisterItem('I06N','I06O','h02Q','I0E0')
	set BEV = RegisterItem('I06Q','I06P','h02R','I0E1')
	set BXV = RegisterItem('I06R','I06S','h02S','I0E2')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h02T', 0), ISV)
	set BOV = RegisterItem('I06W','I06V','h02U','I0E4')
	set BRV = RegisterItem('I06X','I06Y','h02V','I0E5')
	//	set BIV = RegisterItem('I070','I06Z','h02X','I0E6')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h02W', 0), I_V)
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h02X', 0), I1V) //疯脸
	set BAV = RegisterItem('I071','I072','h02Y','I0E7')
	call RegisterItem(0, 0,'h02Z', 0)
	set BNV = RegisterItem('I074','I073','h030','I0E8')
	set BBV = RegisterItem(0, 0,'h031', 0)
	call SaveInteger(HY,'ITDB', BBV, I5V)
	set BCV = RegisterItem('I076','I07V','h032','I0EA')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h033', 0), I7V)


	set BDV = RegisterItem('I077','I07W','h034','I0EB')
	// 黑皇杖
	set BFV = RegisterItem('I078','I07X','h035','I0EC')
	
	set BGV = RegisterItem('I079','I07Y','h036','I0ED')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h037', 0), ACV)
	set BHV = RegisterItem('I07B','I080','h038','I0EF')
	set BJV = RegisterItem('I07C','I081','h039','I0EG')
	set BKV = RegisterItem('I07D','I082','h03A','I0EH')
	call RegisterItem(0, 0,'h03C', 0)
	set BLV = RegisterItem('I07E','I083','h03D','I0EI')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h03E', 0), AWV)
	set BMV = RegisterItem('I07G','I07F','h03F','I0EJ')
	set BPV = RegisterItem('I07H','I084','h03G','I0EK')
	set BQV = RegisterItem('I07O','I085','h03H','I0EL')
	set B2V = RegisterItem(0, 0,'h03K', 0)
	call SaveInteger(HY,'ITDB', B2V, XFV)
	set BSV = RegisterItem('I07J','I088','h03L','I0EO')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h03M', 0), A7V)
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h03N', 0), A8V)
	set BTV = RegisterItem('I07M','I089','h03O','I0EP')
	set BUV = RegisterItem('I07P','I08A','h03Q','I0EQ')
	set BWV = RegisterItem('I07Q','I08B','h03R','I0ER')
	set BYV = RegisterItem('I07R','I08C','h03S','I0ES')
	set NAV = RegisterItem('I0QQ','I0QN','h03T','I0QR')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h03U', 0), NNV)
	set BZV = RegisterItem('I07S','I08D','h03V','I0ET')
	set B_V = RegisterItem('I07T','I08E','h03W','I0EU')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h079', 0), NKV)
	set B0V = RegisterItem('I0HD','I0HF','h07T','I0HE')
	set B1V = RegisterItem('I0HX','I0HZ','h07X','I0HY')
	set B3V = RegisterItem('I07L','I0KN','h03P','I0KO')
	set B4V = RegisterItem('I0KW','I0KV','h0BA','I0KU')
	set B5V = RegisterItem('I0LM','I0LN','h0BQ','I0LO')
	set B6V = RegisterItem('I0N9','I0NA','h0D1','I0NB')
	set B7V = RegisterItem('I0NH','I0NI','h0CY','I0NJ')
	set B8V = RegisterItem('I0O5','I0O6','h0DD','I0O7')
	set B9V = RegisterItem('I0OB','I0OA','h03X','I0O9')
	set CVV = RegisterItem(0, 0,'h0DU', 0)
	call SaveInteger(HY,'ITDB', CVV, RNV)
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h0E9', 0), N1V)
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h0DV', 0), RCV)
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h0EN', 0), RQV)
	call RegisterItem(0, 0,'h0EA', 0)
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h0EC', 0), RWV)
	call SaveInteger(ItemCooldownHashTable, XOV[ARV],'00CD', 55)
	call SaveInteger(ItemCooldownHashTable, XOV[NGV],'00CD', 30)
	call SaveInteger(ItemCooldownHashTable, XOV[ISV],'00CD', 15)
	call SaveInteger(ItemCooldownHashTable, XOV[ANV],'00CD', 50)
	call SaveInteger(ItemCooldownHashTable, XOV[ABV],'00CD', 50)
	call SaveInteger(ItemCooldownHashTable, XOV[A7V],'00CD', 30)
	call SaveInteger(ItemCooldownHashTable, XOV[NJV],'00CD', 18)
	call SaveInteger(ItemCooldownHashTable, XOV[Item_EulScepterOfDivinity],'00CD', 23)
	call SaveInteger(ItemCooldownHashTable, XOV[NMV],'00CD', 20)
	call SaveInteger(ItemCooldownHashTable, XOV[ADV],'00CD', 35)
	call SaveInteger(ItemCooldownHashTable, XOV[AFV],'00CD', 30)
	call SaveInteger(ItemCooldownHashTable, XOV[AGV],'00CD', 25)
	call SaveInteger(ItemCooldownHashTable, XOV[AHV],'00CD', 20)
	call SaveInteger(ItemCooldownHashTable, XOV[AJV],'00CD', 15)
	call SaveInteger(ItemCooldownHashTable, XOV[AKV],'00CD', 95)
	call SaveInteger(ItemCooldownHashTable, XOV[ALV],'00CD', 95)
	call SaveInteger(ItemCooldownHashTable, XOV[AMV],'00CD', 95)
	call SaveInteger(ItemCooldownHashTable, XOV[N0V],'00CD', 30)
	call SaveInteger(ItemCooldownHashTable, XOV[RCV],'00CD', 16)
	call SaveInteger(ItemCooldownHashTable, XOV[I4V],'00CD', 45)
	call SaveInteger(ItemCooldownHashTable, XOV[NPV],'00CD', 60)
	call SaveInteger(ItemCooldownHashTable, XOV[N_V],'00CD', 7)
	call SaveInteger(ItemCooldownHashTable, XOV[ROV],'00CD', 30)
	call SaveInteger(ItemCooldownHashTable, XOV[N2V],'00CD', 60)
	call SaveInteger(ItemCooldownHashTable, XOV[ACV],'00CD', 28)
	call SaveInteger(ItemCooldownHashTable, XOV[A2V],'00CD', 35)
	call SaveInteger(ItemCooldownHashTable, XOV[NEV],'00CD', 35)
	call SaveInteger(ItemCooldownHashTable, XOV[I1V],'00CD', 25)
	call SaveInteger(ItemCooldownHashTable, XOV[I_V],'00CD', 60)
	call SaveInteger(ItemCooldownHashTable, XOV[N1V],'00CD', 30)
	call SaveInteger(ItemCooldownHashTable, XOV[IAV],'00CD', 45)
	call SaveInteger(ItemCooldownHashTable, XOV[INV],'00CD', 45)
	call SaveInteger(ItemCooldownHashTable, XOV[IFV],'00CD', 100)
	call SaveInteger(ItemCooldownHashTable, XOV[R8V],'00CD', 50)
	call SaveInteger(ItemCooldownHashTable, XOV[RTV],'00CD', 40)
	call SaveInteger(ItemCooldownHashTable, XOV[RQV],'00CD', 16)
	call SaveInteger(ItemCooldownHashTable, XOV[RJV],'00CD', 7)
	call SaveInteger(ItemCooldownHashTable, XOV[RLV],'00CD', 28)
	call SaveInteger(ItemCooldownHashTable, XOV[RGV],'00CD', 15)
	set XNV[RegisterItem('I03A','I051','h08K','I0D9')]= OQV
	set XNV[RegisterItem('I03Y','I052','h08X','I0C9')]= OTV
	set XNV[RegisterItem('I02S','I02P','h08S','I0CA')]= XPV
	set XNV[RegisterItem('I02N','I02R','h08P','I0CS')]= XQV
	set XNV[RegisterItem('I02Z','I043','h08Q','I0CV')]= XTV
	set XNV[RegisterItem('I031','I045','h08T','I0D5')]= XWV
	set XNV[RegisterItem('I03B','I04E','h08N','I0DA')]= X6V
	set XNV[RegisterItem('I03E','I04H','h08W','I0C7')]= X9V
	set XNV[RegisterItem('I03G','I04K','h08O','I0CD')]= OXV
	set XNV[RegisterItem('I03P','I04S','h08U','I0CY')]= ODV
	set XNV[RegisterItem('I03Q','I04T','h08G','I0DI')]= OFV
	set XNV[RegisterItem('I03S','I04V','h08L','I0DJ')]= OHV
	set XNV[RegisterItem('I03T','I04W','h08R','I0CP')]= OJV
	set XNV[RegisterItem('I03V','I04Y','h08E','I0C5')]= OLV
	set XNV[RegisterItem('I03W','I04Z','h08J','I0DK')]= OMV
	set XNV[RegisterItem('I0GD','I0GC','h08I','I0GE')]= Item_MagicStick
	set XNV[RegisterItem('I0HT','I0HR','h08F','I0HW')]= RVV
	set XNV[RegisterItem('I0J7','I0J6','h08V','I0J8')]= RXV
	set XNV[RegisterItem('I040','I054','h08M','I0DL')]= OWV
	set XNV[RegisterItem('I05A','I05I','h08H', 0)]= R4V
	set XNV[RegisterItem('I037','I04B','h093','I0CR')]= X2V
	set XNV[RegisterItem('I02Q','I02O','h0BO','I00A')]= XMV
	set XNV[RegisterItem('I0MA','I0M9','h0CN','I0MB')]= XKV
	set XNV[RegisterItem('I033','I047','h0D0','I0D7')]= XZV
	set XNV[RegisterItem('I032','I046','u025','I0CZ')]= XYV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OFV
	set CombineIndex2[CombineMaxIndex]= OWV
	set CombinedIndex[CombineMaxIndex]= IEV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= IEV
	set CombineIndex2[CombineMaxIndex]= XZV
	set CombineIndex3[CombineMaxIndex]= RHV
	set CombineIndex4[CombineMaxIndex]= XZV
	set CombinedIndex[CombineMaxIndex]= RGV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= X7V
	set CombineIndex2[CombineMaxIndex]= X7V
	set CombinedIndex[CombineMaxIndex]= Item_MoonShard
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= ONV
	set CombineIndex2[CombineMaxIndex]= XGV
	set CombinedIndex[CombineMaxIndex]= RQV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= N_V
	set CombineIndex2[CombineMaxIndex]= RXV
	set CombinedIndex[CombineMaxIndex]= RJV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OHV
	set CombineIndex2[CombineMaxIndex]= Item_IronwoodBranch
	set CombineIndex3[CombineMaxIndex]= N3V
	set CombinedIndex[CombineMaxIndex]= IXV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XZV
	set CombineIndex2[CombineMaxIndex]= Item_IronwoodBranch
	set CombineIndex3[CombineMaxIndex]= N4V
	set CombinedIndex[CombineMaxIndex]= IOV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OGV
	set CombineIndex2[CombineMaxIndex]= OMV
	set CombinedIndex[CombineMaxIndex]= IIV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XMV
	set CombineIndex2[CombineMaxIndex]= N5V
	set CombinedIndex[CombineMaxIndex]= IAV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= IAV
	set CombineIndex2[CombineMaxIndex]= N5V
	set CombinedIndex[CombineMaxIndex]= INV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= I3V
	set CombineIndex2[CombineMaxIndex]= OIV
	set CombinedIndex[CombineMaxIndex]= RFV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XMV
	set CombineIndex2[CombineMaxIndex]= XQV
	set CombineIndex3[CombineMaxIndex]= XPV
	set CombinedIndex[CombineMaxIndex]= IBV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XMV
	set CombineIndex2[CombineMaxIndex]= XTV
	set CombineIndex3[CombineMaxIndex]= XPV
	set CombinedIndex[CombineMaxIndex]= ICV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XMV
	set CombineIndex2[CombineMaxIndex]= OJV
	set CombineIndex3[CombineMaxIndex]= XPV
	set CombinedIndex[CombineMaxIndex]= IDV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XPV
	set CombineIndex2[CombineMaxIndex]= N6V
	set CombinedIndex[CombineMaxIndex]= IFV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= ODV
	set CombineIndex2[CombineMaxIndex]= OJV
	set CombineIndex3[CombineMaxIndex]= OMV
	set CombinedIndex[CombineMaxIndex]= IHV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XSV
	set CombineIndex2[CombineMaxIndex]= X3V
	set CombineIndex3[CombineMaxIndex]= N7V
	set CombinedIndex[CombineMaxIndex]= IJV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XSV
	set CombineIndex2[CombineMaxIndex]= OLV
	set CombineIndex3[CombineMaxIndex]= N8V
	set CombinedIndex[CombineMaxIndex]= IKV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XSV
	set CombineIndex2[CombineMaxIndex]= OEV
	set CombineIndex3[CombineMaxIndex]= N9V
	set CombinedIndex[CombineMaxIndex]= ILV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XUV
	set CombineIndex2[CombineMaxIndex]= XQV
	set CombineIndex3[CombineMaxIndex]= BVV
	set CombinedIndex[CombineMaxIndex]= IMV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OAV
	set CombineIndex2[CombineMaxIndex]= XTV
	set CombineIndex3[CombineMaxIndex]= BEV
	set CombinedIndex[CombineMaxIndex]= IPV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OYV
	set CombineIndex2[CombineMaxIndex]= XTV
	set CombineIndex3[CombineMaxIndex]= BXV
	set CombinedIndex[CombineMaxIndex]= IQV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= ACV	//大隐刀
	set CombineIndex2[CombineMaxIndex]= IPV
	set CombineIndex3[CombineMaxIndex]= RMV
	set CombinedIndex[CombineMaxIndex]= RLV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= I4V
	set CombineIndex2[CombineMaxIndex]= NZV
	set CombineIndex3[CombineMaxIndex]= RSV
	set CombinedIndex[CombineMaxIndex]= RTV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XYV
	set CombineIndex2[CombineMaxIndex]= XZV
	set CombineIndex3[CombineMaxIndex]= OJV
	set CombinedIndex[CombineMaxIndex]= ISV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= ORV
	set CombineIndex2[CombineMaxIndex]= XPV
	set CombineIndex3[CombineMaxIndex]= BOV
	set CombinedIndex[CombineMaxIndex]= ITV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XUV
	set CombineIndex2[CombineMaxIndex]= XUV
	set CombineIndex3[CombineMaxIndex]= OJV
	set CombineIndex4[CombineMaxIndex]= BRV
	set CombinedIndex[CombineMaxIndex]= IUV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= IUV
	set CombineIndex2[CombineMaxIndex]= BRV
	set CombinedIndex[CombineMaxIndex]= IWV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= IYV
	set CombineIndex2[CombineMaxIndex]= BRV
	set CombinedIndex[CombineMaxIndex]= IWV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= X6V
	set CombineIndex2[CombineMaxIndex]= OXV
	set CombinedIndex[CombineMaxIndex]= I_V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OXV
	set CombineIndex2[CombineMaxIndex]= ODV
	set CombinedIndex[CombineMaxIndex]= I1V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OMV
	set CombineIndex2[CombineMaxIndex]= OPV
	set CombineIndex3[CombineMaxIndex]= OWV
	set CombineIndex4[CombineMaxIndex]= BAV
	set CombinedIndex[CombineMaxIndex]= Item_EulScepterOfDivinity
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OCV
	set CombineIndex2[CombineMaxIndex]= X2V
	set CombineIndex3[CombineMaxIndex]= OUV
	set CombinedIndex[CombineMaxIndex]= I3V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= IXV
	set CombineIndex2[CombineMaxIndex]= IOV
	set CombineIndex3[CombineMaxIndex]= BNV
	set CombinedIndex[CombineMaxIndex]= I4V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= IPV
	set CombineIndex2[CombineMaxIndex]= IMV
	set CombinedIndex[CombineMaxIndex]= I5V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= ORV
	set CombineIndex2[CombineMaxIndex]= ORV
	set CombineIndex3[CombineMaxIndex]= BCV
	set CombinedIndex[CombineMaxIndex]= I6V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= IEV
	set CombineIndex2[CombineMaxIndex]= XYV
	set CombineIndex3[CombineMaxIndex]= X_V
	set CombineIndex4[CombineMaxIndex]= RVV
	set CombinedIndex[CombineMaxIndex]= I7V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= IEV
	set CombineIndex2[CombineMaxIndex]= XYV
	set CombineIndex3[CombineMaxIndex]= X_V
	set CombineIndex4[CombineMaxIndex]= REV
	set CombinedIndex[CombineMaxIndex]= I7V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XWV
	set CombineIndex2[CombineMaxIndex]= XYV
	set CombineIndex3[CombineMaxIndex]= BDV
	set CombinedIndex[CombineMaxIndex]= I8V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= ORV
	set CombineIndex2[CombineMaxIndex]= OAV
	set CombineIndex3[CombineMaxIndex]= BFV
	set CombinedIndex[CombineMaxIndex]= I9V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= IMV
	set CombineIndex2[CombineMaxIndex]= OTV
	set CombineIndex3[CombineMaxIndex]= BGV
	set CombinedIndex[CombineMaxIndex]= ABV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XGV
	set CombineIndex2[CombineMaxIndex]= X_V
	set CombinedIndex[CombineMaxIndex]= ACV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OPV
	set CombineIndex2[CombineMaxIndex]= ILV
	set CombineIndex3[CombineMaxIndex]= BHV
	set CombinedIndex[CombineMaxIndex]= ADV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= ADV
	set CombineIndex2[CombineMaxIndex]= BHV
	set CombinedIndex[CombineMaxIndex]= AFV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= AFV
	set CombineIndex2[CombineMaxIndex]= BHV
	set CombinedIndex[CombineMaxIndex]= AGV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= AGV
	set CombineIndex2[CombineMaxIndex]= BHV
	set CombinedIndex[CombineMaxIndex]= AHV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= AHV
	set CombineIndex2[CombineMaxIndex]= BHV
	set CombinedIndex[CombineMaxIndex]= AJV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OPV
	set CombineIndex2[CombineMaxIndex]= XTV
	set CombineIndex3[CombineMaxIndex]= BJV
	set CombinedIndex[CombineMaxIndex]= AKV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= AKV
	set CombineIndex2[CombineMaxIndex]= BJV
	set CombinedIndex[CombineMaxIndex]= ALV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= ALV
	set CombineIndex2[CombineMaxIndex]= BJV
	set CombinedIndex[CombineMaxIndex]= AMV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OTV
	set CombineIndex2[CombineMaxIndex]= IEV
	set CombineIndex3[CombineMaxIndex]= BKV
	set CombinedIndex[CombineMaxIndex]= APV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= X0V
	set CombineIndex2[CombineMaxIndex]= OKV
	set CombinedIndex[CombineMaxIndex]= ASV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= I8V
	set CombineIndex2[CombineMaxIndex]= X0V
	set CombineIndex3[CombineMaxIndex]= BLV
	set CombinedIndex[CombineMaxIndex]= AUV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= X0V
	set CombineIndex2[CombineMaxIndex]= OYV
	set CombineIndex3[CombineMaxIndex]= OYV
	set CombinedIndex[CombineMaxIndex]= AWV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OKV
	set CombineIndex2[CombineMaxIndex]= BMV
	set CombinedIndex[CombineMaxIndex]= AZV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OOV
	set CombineIndex2[CombineMaxIndex]= OUV
	set CombineIndex3[CombineMaxIndex]= BPV
	set CombinedIndex[CombineMaxIndex]= A0V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OOV
	set CombineIndex2[CombineMaxIndex]= I_V
	set CombineIndex3[CombineMaxIndex]= BQV
	set CombinedIndex[CombineMaxIndex]= A2V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OOV
	set CombineIndex2[CombineMaxIndex]= I0V
	set CombineIndex3[CombineMaxIndex]= BQV
	set CombinedIndex[CombineMaxIndex]= A2V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OTV
	set CombineIndex2[CombineMaxIndex]= OTV
	set CombineIndex3[CombineMaxIndex]= OCV
	set CombineIndex4[CombineMaxIndex]= XKV
	set CombinedIndex[CombineMaxIndex]= A3V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OTV
	set CombineIndex2[CombineMaxIndex]= OTV
	set CombineIndex3[CombineMaxIndex]= OCV
	set CombineIndex4[CombineMaxIndex]= XLV
	set CombinedIndex[CombineMaxIndex]= A3V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XJV
	set CombineIndex2[CombineMaxIndex]= IOV
	set CombineIndex3[CombineMaxIndex]= A8V
	set CombinedIndex[CombineMaxIndex]= XHV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XJV
	set CombineIndex2[CombineMaxIndex]= IOV
	set CombineIndex3[CombineMaxIndex]= A9V
	set CombinedIndex[CombineMaxIndex]= XHV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= X1V
	set CombineIndex2[CombineMaxIndex]= ODV
	set CombineIndex3[CombineMaxIndex]= RXV
	set CombinedIndex[CombineMaxIndex]= A5V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OMV
	set CombineIndex2[CombineMaxIndex]= XZV
	set CombineIndex3[CombineMaxIndex]= B7V
	set CombinedIndex[CombineMaxIndex]= N_V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OCV
	set CombineIndex2[CombineMaxIndex]= OAV
	set CombineIndex3[CombineMaxIndex]= XUV
	set CombineIndex4[CombineMaxIndex]= OPV
	set CombinedIndex[CombineMaxIndex]= XFV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= IEV
	set CombineIndex2[CombineMaxIndex]= IEV
	set CombineIndex3[CombineMaxIndex]= BSV
	set CombinedIndex[CombineMaxIndex]= A6V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OTV
	set CombineIndex2[CombineMaxIndex]= OIV
	set CombineIndex3[CombineMaxIndex]= OWV
	set CombinedIndex[CombineMaxIndex]= A7V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OUV
	set CombineIndex2[CombineMaxIndex]= OFV
	set CombineIndex3[CombineMaxIndex]= OQV
	set CombinedIndex[CombineMaxIndex]= A8V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OUV
	set CombineIndex2[CombineMaxIndex]= OFV
	set CombineIndex3[CombineMaxIndex]= OSV
	set CombinedIndex[CombineMaxIndex]= A8V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= X2V
	set CombineIndex2[CombineMaxIndex]= OGV
	set CombineIndex3[CombineMaxIndex]= BTV
	set CombinedIndex[CombineMaxIndex]= NVV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= X7V
	set CombineIndex2[CombineMaxIndex]= ITV
	set CombineIndex3[CombineMaxIndex]= B3V
	set CombinedIndex[CombineMaxIndex]= NEV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= R5V
	set CombineIndex3[CombineMaxIndex]= BUV
	set CombinedIndex[CombineMaxIndex]= NXV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= IXV
	set CombineIndex2[CombineMaxIndex]= IRV
	set CombineIndex3[CombineMaxIndex]= OXV
	set CombineIndex4[CombineMaxIndex]= BWV
	set CombinedIndex[CombineMaxIndex]= NOV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= IXV
	set CombineIndex2[CombineMaxIndex]= IIV
	set CombineIndex3[CombineMaxIndex]= OXV
	set CombineIndex4[CombineMaxIndex]= BWV
	set CombinedIndex[CombineMaxIndex]= NOV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= X7V
	set CombineIndex2[CombineMaxIndex]= OBV
	set CombineIndex3[CombineMaxIndex]= XZV
	set CombineIndex4[CombineMaxIndex]= BYV
	set CombinedIndex[CombineMaxIndex]= NRV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= I3V
	set CombineIndex2[CombineMaxIndex]= NAV
	set CombineIndex3[CombineMaxIndex]= NYV
	set CombinedIndex[CombineMaxIndex]= NIV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OHV
	set CombineIndex2[CombineMaxIndex]= OHV
	set CombineIndex3[CombineMaxIndex]= OFV
	set CombineIndex4[CombineMaxIndex]= ONV
	set CombinedIndex[CombineMaxIndex]= NNV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XPV
	set CombineIndex2[CombineMaxIndex]= X6V
	set CombineIndex3[CombineMaxIndex]= XWV
	set CombineIndex4[CombineMaxIndex]= BZV
	set CombinedIndex[CombineMaxIndex]= NFV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OIV
	set CombineIndex2[CombineMaxIndex]= OBV
	set CombineIndex3[CombineMaxIndex]= B_V
	set CombinedIndex[CombineMaxIndex]= NGV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= IHV
	set CombineIndex2[CombineMaxIndex]= IHV
	set CombineIndex3[CombineMaxIndex]= B9V
	set CombinedIndex[CombineMaxIndex]= NJV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XMV
	set CombineIndex2[CombineMaxIndex]= XWV
	set CombineIndex3[CombineMaxIndex]= XWV
	set CombinedIndex[CombineMaxIndex]= NKV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= Item_MagicStick
	set CombineIndex2[CombineMaxIndex]= Item_IronwoodBranch
	set CombineIndex3[CombineMaxIndex]= Item_IronwoodBranch
	set CombineIndex4[CombineMaxIndex]= XSV
	set CombinedIndex[CombineMaxIndex]= Item_MagicWand
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OHV
	set CombineIndex2[CombineMaxIndex]= OPV
	set CombineIndex3[CombineMaxIndex]= B0V
	set CombinedIndex[CombineMaxIndex]= NMV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= NNV
	set CombineIndex2[CombineMaxIndex]= IXV
	set CombineIndex3[CombineMaxIndex]= B1V
	set CombinedIndex[CombineMaxIndex]= NPV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OQV
	set CombineIndex2[CombineMaxIndex]= OLV
	set CombineIndex3[CombineMaxIndex]= OLV
	set CombinedIndex[CombineMaxIndex]= NQV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OSV
	set CombineIndex2[CombineMaxIndex]= OLV
	set CombineIndex3[CombineMaxIndex]= OLV
	set CombinedIndex[CombineMaxIndex]= NQV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OMV
	set CombineIndex2[CombineMaxIndex]= X3V
	set CombineIndex3[CombineMaxIndex]= X3V
	set CombineIndex4[CombineMaxIndex]= B4V
	set CombinedIndex[CombineMaxIndex]= NUV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OMV
	set CombineIndex2[CombineMaxIndex]= OHV
	set CombineIndex3[CombineMaxIndex]= B5V
	set CombinedIndex[CombineMaxIndex]= NYV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= X1V
	set CombineIndex2[CombineMaxIndex]= NTV
	set CombinedIndex[CombineMaxIndex]= ROV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XMV
	set CombineIndex2[CombineMaxIndex]= X2V
	set CombinedIndex[CombineMaxIndex]= NZV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OJV
	set CombineIndex2[CombineMaxIndex]= IJV
	set CombineIndex3[CombineMaxIndex]= B6V
	set CombinedIndex[CombineMaxIndex]= RRV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= RRV
	set CombineIndex2[CombineMaxIndex]= B6V
	set CombinedIndex[CombineMaxIndex]= RRV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= RIV
	set CombineIndex2[CombineMaxIndex]= B6V
	set CombinedIndex[CombineMaxIndex]= RRV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= X6V
	set CombineIndex2[CombineMaxIndex]= ILV
	set CombineIndex3[CombineMaxIndex]= B8V
	set CombinedIndex[CombineMaxIndex]= N0V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= XMV
	set CombineIndex2[CombineMaxIndex]= OGV
	set CombineIndex3[CombineMaxIndex]= OHV
	set CombinedIndex[CombineMaxIndex]= RNV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OPV
	set CombineIndex2[CombineMaxIndex]= OPV
	set CombineIndex3[CombineMaxIndex]= OUV
	set CombinedIndex[CombineMaxIndex]= RCV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= IPV
	set CombineIndex2[CombineMaxIndex]= RXV
	set CombinedIndex[CombineMaxIndex]= N1V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= IQV
	set CombineIndex2[CombineMaxIndex]= OKV
	set CombinedIndex[CombineMaxIndex]= N2V
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= IKV
	set CombineIndex2[CombineMaxIndex]= IRV
	set CombinedIndex[CombineMaxIndex]= RUV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= IKV
	set CombineIndex2[CombineMaxIndex]= IIV
	set CombinedIndex[CombineMaxIndex]= RWV
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OAV
	set CombineIndex2[CombineMaxIndex]= XQV
	set CombineIndex3[CombineMaxIndex]= XQV
	set CombinedIndex[CombineMaxIndex]= it_mlq
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= NJV
	set CombineIndex2[CombineMaxIndex]= I8V
	set CombineIndex3[CombineMaxIndex]= jz_xj
	set CombinedIndex[CombineMaxIndex]= it_xj
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= OAV
	set CombineIndex2[CombineMaxIndex]= IHV
	set CombinedIndex[CombineMaxIndex]= it_hyzr
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= it_mlq
	set CombineIndex2[CombineMaxIndex]= NMV
	set CombineIndex3[CombineMaxIndex]= Recipe_HurricanePike
	set CombinedIndex[CombineMaxIndex]= Item_HurricanePike
	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= X6V
	set CombineIndex2[CombineMaxIndex]= I6V
	set CombinedIndex[CombineMaxIndex]= it_fj 

	set CombineMaxIndex = CombineMaxIndex + 1
	set CombineIndex1[CombineMaxIndex]= X2V
	set CombineIndex2[CombineMaxIndex]= OWV
	set CombineIndex3[CombineMaxIndex]= Recipe_AetherLens
	set CombinedIndex[CombineMaxIndex]= Item_AetherLens
endfunction
function Init_SpecialAbilityId takes nothing returns nothing //储存切换型技能
	
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A1RJ','A20N') //凤凰冲击
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A1YX','A1Z2') //烈火精灵
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A1YY','A1Z3') //烈日炙烤
	
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'Z605','QFZZ') //幽灵漫步
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A27F','A27X') //隔空取物
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A085','A121') //启明
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A11N','A13D') //X标记
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A1PH','A1RA') //灵魂汲取
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A1A8','A21J') //先祖之魂
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A1NI','A1NH') //不稳定化合物
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A0SW','A0SX') //感染
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A04Y','A2O9') //噩梦
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A0R0','A2MB') //黑暗之门
	
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A0G8','A0GC') //水人复制
	
	call SaveBoolean(ExtraHT, HTKEY_SWITCHING_SKILLS,'A21F', true)
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A21F','A21H') //脉冲新星
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A21G','A21H') //脉冲新星A帐
	
	call SaveBoolean(ExtraHT, HTKEY_SWITCHING_SKILLS,'A1MI', true)
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A1MI','A1MN') //冰晶爆轰
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A2QE','A1MN') //冰晶爆轰A帐
	
	call SaveBoolean(ExtraHT, HTKEY_SWITCHING_SKILLS,'A2E5', true)
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A2E5','A2FX') //锯齿飞轮
	
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A43S','A43P') //锯齿飞轮A帐
	
	call SaveBoolean(ExtraHT, HTKEY_SWITCHING_SKILLS,'A07U', true)
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A07U','A24E') //海妖之歌
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A38E','A24E') //海妖之歌A帐
	
endfunction

function SaveHerosData takes nothing returns nothing
	call SaveHeroModelData(1,'Hvwd','h03Z','n09U', "stand 4", 1.35)
	call SaveHeroModelData(2,'Hmbr','h040','n09A', "attack slam alternate", 1.30)
	call SaveHeroModelData(3,'Emoo','h041','n099', "stand 4", 1.)
	call SaveHeroModelData(4,'O00P','h042','n098', "stand 2", 1.)
	call SaveHeroModelData(5,'Hjai','h043','n09W', "stand victory", 1.)
	call SaveHeroModelData(6,'H001','h044','n096', "spell", 1.)
	call SaveHeroModelData(7,'HC49','h045','n09P', "spell", 1.)
	call SaveHeroModelData(8,'Otch','h046','n09D', "attack slam", 1.1)
	call SaveHeroModelData(9,'HC92','h047','n09X', "stand 4", 1.)
	call SaveHeroModelData(10,'N01O','h048','n09Y', "spell slam", 1.)
	call SaveHeroModelScale('N013', 1.0, 0)
	call SaveHeroModelScale('N014', 1.05, 0)
	call SaveHeroModelScale('N015', 1.1, 0)
	call SaveHeroModelScale('n004', 0.9, 0)
	call SaveHeroModelScale('n018', 0.95, 0)
	call SaveHeroModelScale('n01C', 1, 0)
	call SaveHeroModelScale('n01G', 1.050, 0)
	call SaveHeroModelData(11,'H004','h049','n09Z', "stand victory", 1.2)
	call SaveHeroModelData(12,'Nbbc','h04A','n0A5', "stand victory", 1.)
	call SaveHeroModelData(13,'N01A','h04B','n097', "stand ready", 1.)
	call SaveHeroModelData(14,'Hamg','h04C','n09F', "stand 3", .72)
	call SaveHeroModelData(15,'O015','h07P','n0GC', "stand victory", 1.1)
	call SaveHeroModelData(16,'Hblm','h04E','n09G', "stand victory", 1.2)
	call SaveHeroModelScale('H06X', 1.2, 0)
	call SaveHeroModelScale('H06Y', 1.2, 0)
	call SaveHeroModelScale('H06W', 1.2, 0)
	call SaveHeroModelData(17,'Huth','h04F','n09V', "stand spell", 1.2)
	call SaveHeroModelData(18,'Hmkg','h04G','n0A1', "sleep", 1.4)
	call SaveHeroModelData(19,'Ntin','h04H','n0AA', "stand 2", 1.)
	call SaveHeroModelData(20,'Emns','h04I','n0A4', "spell", 1.2)
	call SaveHeroModelData(21,'Ogrh','h04J','n0A3', "stand victory", 1.)
	call SaveHeroModelData(22,'Ucrl','h04K','n0A7', "spell", .5)
	call SaveHeroModelScale('U01X', .5, 0)
	call SaveHeroModelData(23,'H00K','h04L','n0A9', "stand 2", 1.)
	call SaveHeroModelData(24,'H00A','h04M','n0AB', "spell chain lightning", 1.)
	call SaveHeroModelData(25,'E005','h04N','n0BE', "spell", 1.)
	call SaveHeroModelData(26,'Usyl','h04O','n0BD', "spell", 1.1)
	call SaveHeroModelData(27,'N016','h04P','n0A8', "stand 3", 1.25)
	call SaveHeroModelScale('N02B', 1.25, 0)
	call SaveHeroModelScale('QTW2', 1.25, 0)
	call SaveHeroModelScale('QTW3', 1.25, 0)
	call SaveHeroModelScale('N017', 1.25, 0)
	call SaveHeroModelData(28,'Orkn','h057','n094', "stand victory", 1.)
	call SaveHeroModelData(29,'O01F','h0CI','n0KS', "stand 3", 1.3)
	call SaveHeroModelData(30,'Npbm','h053','n0AO', "stand ready", 1.)
	call SaveHeroModelData(31,'H000','h04X','n0AN', "stand 3", 1.75)
	call SaveHeroModelData(32,'Naka','h052','n0AM', "stand var4", 1.2)
	call SaveHeroModelData(33,'Hlgr','h04V','n0AQ', "stand victory", 1.35)
	call SaveHeroModelScale('H00F', 1, 0)
	call SaveHeroModelScale('H00G', 1, 0)
	call SaveHeroModelScale('H00E', 1, 0)
	call JDX('H00G', 255, 255, 200)
	call JDX('H00F', 255, 255, 200)
	call JDX('H00G', 255, 200, 200)
	call SaveHeroModelData(34,'Edem','h04T','n0AR', "stand channel", 1.)
	call SaveHeroModelData(35,'Nbrn','h055','n0AL', "spell", 1.)
	call SaveHeroModelData(36,'Harf','h04Z','n0AS', "stand victory", 1.1)
	call SaveHeroModelData(37,'H00D','h04S','n0AK', "spell slam", 1.)
	call SaveHeroModelData(38,'E00P','h04R','n0AJ', "stand 3", 1.)
	call SaveHeroModelData(39,'N01I','h054','n0AI', "stand 2", 1.)
	call SaveHeroModelScale('N01J', 1, 0)
	call SaveHeroModelScale('N01H', 1, 0)
	call SaveHeroModelScale('N01T', 1, 0)
	// 炼金变身
	call SaveHeroModelScale('H600', 1, 0)
	call SaveHeroModelScale('H601', 1, 0)
	call SaveHeroModelScale('H602', 1, 0)
	call SaveHeroModelData(40,'N01V','h04W','n0AH', "stand ready", 1.)
	call SaveHeroModelData(41,'H00S','h04Q','n0AT', "spell", 1.)
	call SaveHeroModelData(42,'H00Q','h04Y','n0AG', "stand alternate 3", 1.15)
	call SaveHeroModelData(43,'E01Y','h058','n0AF', "stand victory", 1.2)
	call SaveHeroModelData(44,'N00B','h050','n0AE', "attack spell", 1.1)
	call SaveHeroModelData(45,'H00T','h051','n0AU', "Birth", 1.5)
	call SaveHeroModelData(46,'H06S','h06T','n0EE', "stand victory", 1.1)
	call SaveHeroModelData(47,'N0EG','h07A','n0EH', "stand victory", 1.1)
	call SaveHeroModelData(48,'E02N','h0CC','n0KN', "stand 3", 1.1)
	call SaveHeroModelScale('E02O', 1.1, 0)
	call SaveHeroModelData(49,'E02J','h0CD','n0KR', "stand 3", 1.1)
	call SaveHeroModelData(50,'E02I','h0C9','n0KK', "stand 3", 1.)
	call SaveHeroModelData(51,'E02F','h0C8','n0KM', "stand 3", 1.05)
	call SaveHeroModelData(52,'H008','h04U','n0AC', "stand", 1.65)
	call SaveHeroModelData(53,'E02X','h0CT','n0LK', "stand 3", 1.15)
	call SaveHeroModelData(54,'N0M0','h0DG','n0M1', "stand 3", 1.)
	call SaveHeroModelScale('N0MH', 1., 0)
	call SaveHeroModelData(55,'E02K','h0CA','n0KJ', "stand 3", 1.3)
	call SaveHeroModelData(56,'H0DO','h0DH','n0M6', "stand 3", 1.1)
	call SaveHeroModelData(57,'E032','h0EB','n0ME', "stand 3", 1.)
	set VWV = 57
	set VYV = 58
	call SaveHeroModelData(58,'U008','h05H','n0B3', "spell", 1.2)
	call SaveHeroModelScale('E015', 1, 0)
	call JDX(HeroListTypeId[58], 255, 75, 255)
	call SaveHeroModelData(59,'U006','h05I','n0B4', "walk", 1.36)
	call SaveHeroModelData(60,'Ewar','h05J','n0B5', "spell slam", 1.)
	call SaveHeroModelData(61,'H00V','h05K','n0B6', "stand ready", 1.)
	call SaveHeroModelScale('H08D', 1, 0)
	call SaveHeroModelScale('H08C', 1, 0)
	call SaveHeroModelScale('H084', 1, 0)
	call SaveHeroModelScale('H08B', 1, 0)
	call SaveHeroModelData(62,'Udre','h05L','n0B7', "spell slam", 1.)
	call SaveHeroModelData(63,'NC00','h05M','n0C0', "stand victory", 1.8)
	call JDX(HeroListTypeId[63], 100, 125, 100)
	call SaveHeroModelData(64,'UC42','h05N','n0BV', "stand victory", 1.1)
	call SaveHeroModelData(65,'U000','h05O','n0BU', "spell throw", .8)
	call SaveHeroModelData(66,'UC91','h05P','n0C1', "spell", 1.)
	call JDX(HeroListTypeId[66], 175, 75, 200)
	call SaveHeroModelData(67,'UC01','h05Q','n0C2', "spell slam", 1.3)
	call SaveHeroModelData(68,'E004','h05R','n0BW', "stand victory", 1.)
	call SaveHeroModelData(69,'EC45','h05S','n0BS', "spell slam", 1.3)
	call JDX(HeroListTypeId[69], 0, 255, 150)
	call SaveHeroModelData(70,'EC77','h05T','n0BR', "spell slam", 1.2)
	call JDX(HeroListTypeId[70], 75, 255, 25)
	call SaveHeroModelData(71,'E002','h05U','n0BY', "spell", 1.)
	call SaveHeroModelData(72,'U00C','h05V','n0BQ', "victory", 1.5)
	call JDX(HeroListTypeId[72], 100, 100, 100)
	call SaveHeroModelData(73,'H00H','h05W','n0BT', "stand ready", 1.)
	call SaveHeroModelData(74,'Ofar','h05X','n0BP', "attack slam", 1.)
	call SaveHeroModelData(75,'Oshd','h05Y','n0BO', "spell", 1.5)
	call JDX(HeroListTypeId[75], 150, 0, 150)
	call SaveHeroModelData(76,'U00E','h05Z','n0B8', "stand victory", 1.3)
	call SaveHeroModelData(77,'U00F','h060','n0C5', "stand 3", 1.)
	call SaveHeroModelData(78,'O00J','h061','n0C3', "stand ready", 1.2)
	call SaveHeroModelData(79,'Ubal','h062','n0BX', "attack", 1.)
	call JDX(HeroListTypeId[79], 255, 200, 200)
	call SaveHeroModelData(80,'Nfir','h063','n0BN', "stand channel", 1.15)
	call JDX(HeroListTypeId[80], 0, 0, 0)
	call SaveHeroModelData(81,'U00K','h064','n0C4', "attack 3", 1.)
	call SaveHeroModelData(82,'Opgh','h065','n0BM', "stand victory", 1.)
	call SaveHeroModelData(83,'Hvsh','h066','n0BZ', "stand victory", 1.25)
	call JDX(HeroListTypeId[83], 250, 150, 150)
	call SaveHeroModelData(84,'Udea','h067','n0BL', "stand ready", 1.)
	call SaveHeroModelData(85,'E01B','h068','n0B9', "stand ready", .8)
	call SaveHeroModelData(86,'E01A','h069','n0BK', "stand victory", 1.25)
	call SaveHeroModelData(87,'U00P','h06A','n0BA', "stand alternate 2", .85)
	call SaveHeroModelData(88,'E01C','h06C','n0BB', "spell", 1.5)
	call SaveHeroModelData(89,'H00I','h06D','n0BJ', "spell", 1.85)
	call SaveHeroModelScale('H00J', 1.4, 0)
	call SaveHeroModelData(90,'N01W','h06E','n0BI', "spell", 1.2)
	call SaveHeroModelData(91,'N00R','h06F','n0BC', "stand channel", .95)
	call SaveHeroModelData(92,'H00R','h06G','n0BH', "stand", 2.)
	call SaveHeroModelScale('H07I', 1.3, 0)
	call SaveHeroModelData(93,'H00N','h06H','n0BG', "spell", 1.15)
	call SaveHeroModelData(94,'KODO','ho0E', 0, "stand victory", 0.9)
	call SaveHeroModelData(95,'Uktl','h04D','n0A6', "stand", 1.5)
	call SaveHeroModelData(96,'O016','h07R','n0G9', "stand", 1.2)
	call SaveHeroModelScale('O017', 1.2, 0)
	call SaveHeroModelData(97,'N0HP','h0B0','n0HR', "stand", 1.2)
	// call SaveHeroModelScale('N0HP', 1.2, 0)
	call SaveHeroModelData(98,'H071','h072','n0EF', "stand 3", 1.25)
	call SaveHeroModelData(99,'Eevi','h056','n0AV', "spell channel", 1.)
	call SaveHeroModelScale('Eevm', 1.1, 0)
	call SaveHeroModelScale('E02V', 1.1, 0)
	call SaveHeroModelScale('E02W', 1.1, 0)
	call SaveHeroModelScale('E02U', 1.1, 0)
	call SaveHeroModelData( 100 ,'Ekee','h059','n0AW', "stand victory", 1.)
	call SaveHeroModelData('e','E02H','h0CB','n0KL', "stand 3", 1.25)
	call SaveHeroModelData('f','Ulic','h05A','n0AX', "stand channel", 1.3)
	call SaveHeroModelData('g','UC76','h05B','n0AY', "spell wail", 1.35)
	call SaveHeroModelData('h','UC18','h05C','n0AZ', "spell callstorm", 1.3)
	call JDX(HeroListTypeId['h'], 50, 100, 255)
	call SaveHeroModelData('i','EC57','h05D','n0B0', "attack", 1.)
	call JDX(HeroListTypeId['i'], 150, 200, 255)
	call SaveHeroModelData('j','UC11','h05E','n0A2', "stand channel", 1.)
	call JDX(HeroListTypeId['j'], 150, 150, 100)
	call SaveHeroModelData('k','UC60','h05F','n0B1', "stand victory", 1.)
	call JDX(HeroListTypeId['k'], 150, 150, 150)
	call SaveHeroModelData('l','U00A','h05G','n0B2', "stand victory", 1.05)
	call SaveHeroModelData(110,'N0MK','h0EF','n0ML', "stand victory", 1.5)
	call SaveHeroModelData('o','N0MU','ho04', 0, "stand 3", 1.)
	call SaveHeroModelData('p','N0MD','ho05', 0, "stand victory", 1.25)
	call SaveHeroModelData('q','H503','ho06', 0, "spell", 1.)
	call SaveHeroModelData(114,'H501','ho07', 0, "attack", 1.0)
	call SaveHeroModelData(115,'H502','ho08', 0, "spell channel", 1.)
	call SaveHeroModelData(116,'H00U','ho09', 0, "spell", 1.250)
	call SaveHeroModelData('u','H500','ho0A', 0, "attack", 1)
	call SaveHeroModelData('v','H504','ho0B', 0, "spell", 1.300)
	call SaveHeroModelData('w','H505','ho0C', 0, "sleep", 1.7)
	call SaveHeroModelData( 120,'H506','ho0D', 0, "spell", 1.200)
	call SaveHeroModelData( 121,'H507','ho0F', 0, "attack", 1.)

	// 冰龙变身
	call SaveHeroModelData('m','N0M7','h0DW','n0M8', "stand victory", .9)
	call SaveHeroModelScale('N0MB', 1.1, 0)
	call SaveHeroModelScale('N0MC', 1.2, 0)
	call SaveHeroModelScale('N0MO', 1.3, 0)
	call SaveHeroModelScale('N0MA', 1.4, 0)

	set HeroTypeMaxCount = 121
	set V_V[1]='Nbrn'
	set V_V[2]='Edem'
	set V_V[3]='N016'
	set V_V[4]='Nbbc'
	set V_V[5]='Naka'
	set V_V[6]='O00P'
	set V_V[7]='Usyl'
	set V_V[8]='E005'
	set V_V[9]='N01O'
	set V_V[10]='HC92'
	set V_V[11]='Hvwd'
	set V_V[12]='HC49'
	set V_V[13]='Huth'
	set V_V[14]='Ogrh'
	set V_V[15]='U006'
	set V_V[16]='EC57'
	set V_V[17]='Eevi'
	set V_V[18]='Ubal'
	set V_V[19]='E004'
	set V_V[20]='EC77'
	set V_V[21]='Hvsh'
	set V_V[22]='Nfir'
	set V_V[23]='E002'
	set V_V[24]='EC45'
	set V_V[25]='Ewar'
	set V_V[26]='U000'
	set V_V[27]='H00V'
	set V_V[28]='E01B'
	set V_V[29]='N01V'
	set V_V[30]='H00I'
	set V_V[31]='E01Y'
	set V_V[32]='H071'
	set V_V[33]='E02N'
	set V_V[34]='N0M0'
	set V_V[35]= HeroListTypeId[110]
	set V_V[36]= HeroListTypeId['q']
	set V_V[37]= HeroListTypeId[ 121]
	set V0V = 37
	set V1V[1]='Npbm'
	set V1V[2]='Hlgr'
	set V1V[3]='Harf'
	set V1V[4]='H000'
	set V1V[5]='H001'
	set V1V[6]='Hamg'
	set V1V[7]='H008'
	set V1V[8]='Ucrl'
	set V1V[9]='Otch'
	set V1V[10]='NC00'
	set V1V[11]='Udre'
	set V1V[12]='UC11'
	set V1V[13]='Ofar'
	set V1V[14]='U00F'
	set V1V[15]='U00K'
	set V1V[16]='O00J'
	set V1V[17]='Udea'
	set V1V[18]='Opgh'
	set V1V[19]='U00A'
	set V1V[20]='U00C'
	set V1V[21]='UC91'
	set V1V[22]='UC42'
	set V1V[23]='U008'
	set V1V[24]='H00D'
	set V1V[25]='N01I'
	set V1V[26]='H00Q'
	set V1V[27]='N00R'
	set V1V[28]='H00T'
	set V1V[29]='H06S'
	set V1V[30]='H00R'
	set V1V[31]='O015'
	set V1V[32]='E02I'
	set V1V[33]='E02F'
	set V1V[34]='O01F'
	set V1V[35]='E032'
	set V1V[36]='E02K'
	set V1V[37]='N0MU'
	set V1V[38]='KODO'
	set V1V[39]='H501'
	set V1V[40]='H504'
	set V1V[41]='H505'
	set V1V[42]='H506'
	set V2V = 42
	set V3V[1]='Orkn'
	set V3V[2]='Emoo'
	set V3V[3]='Emns'
	set V3V[4]='H004'
	set V3V[5]='Hjai'
	set V3V[6]='Uktl'
	set V3V[7]='Hmbr'
	set V3V[8]='H00K'
	set V3V[9]='Ntin'
	set V3V[10]='Hmkg'
	set V3V[11]='Hblm'
	set V3V[12]='N01A'
	set V3V[13]='H00A'
	set V3V[14]='Ulic'
	set V3V[15]='Ekee'
	set V3V[16]='UC76'
	set V3V[17]='UC18'
	set V3V[18]='UC01'
	set V3V[19]='UC60'
	set V3V[20]='H00H'
	set V3V[21]='Oshd'
	set V3V[22]='U00E'
	set V3V[23]='E01A'
	set V3V[24]='U00P'
	set V3V[25]='E00P'
	set V3V[26]='E01C'
	set V3V[27]='N01W'
	set V3V[28]='H00N'
	set V3V[29]='N0EG'
	set V3V[30]='H00S'
	set V3V[31]='N00B'
	set V3V[32]='H00U'
	set V3V[33]='O016'
	set V3V[34]='N0HP'
	set V3V[35]='E02H'
	set V3V[36]='E02J'
	set V3V[37]='E02X'
	set V3V[38]='H0DO'
	set V3V[39]='N0M7'
	set V3V[40]='N0MD'
	set V3V[41]='H500'
	set V3V[42]='H502'
	set V4V = 42
	call SaveUnitVictoryAnimation('esen', "stand 4")
	call SaveUnitVictoryAnimation('e00V', "stand 4")
	call SaveUnitVictoryAnimation('edry', "spell")
	call SaveUnitVictoryAnimation('e00W', "spell")
	call SaveUnitVictoryAnimation('ugho', "stand victory")
	call SaveUnitVictoryAnimation('u001', "stand victory")
	call SaveUnitVictoryAnimation('unec', "stand channel")
	call SaveUnitVictoryAnimation('u002', "stand channel")
	call SaveHeroModelScale('n00M', .45,'n00M')
	call SaveHeroModelScale('e02R', .5,'e02R')
	call SaveHeroModelScale('e02T', 1.200,'e02T')
	call SaveHeroModelScale('e02S', .5,'e02S')
	call SaveHeroModelScale('e030', .5,'e030')
	call SaveHeroModelScale('n0LS', 1,'n0LS')
	call SaveHeroModelScale('np01', 0.5,'np01')
endfunction

globals
	lightning array CreepsRectIndicatorLightning
	integer 		CreepsRectIndicatorCount 	 = 0
endglobals
function CreateCreepsRectIndicator takes rect r, boolean high returns nothing
	local integer h = 896
	if high then
		set h = 1024
	endif
	set CreepsRectIndicatorLightning[CreepsRectIndicatorCount * 4 + 0]= AddLightningEx("BRDR", false, GetRectMinX(r), GetRectMinY(r), h, GetRectMaxX(r), GetRectMinY(r), h)
	set CreepsRectIndicatorLightning[CreepsRectIndicatorCount * 4 + 1]= AddLightningEx("BRDR", false, GetRectMinX(r), GetRectMaxY(r), h, GetRectMaxX(r), GetRectMaxY(r), h)
	set CreepsRectIndicatorLightning[CreepsRectIndicatorCount * 4 + 2]= AddLightningEx("BRDR", false, GetRectMinX(r), GetRectMinY(r), h, GetRectMinX(r), GetRectMaxY(r), h)
	set CreepsRectIndicatorLightning[CreepsRectIndicatorCount * 4 + 3]= AddLightningEx("BRDR", false, GetRectMaxX(r), GetRectMinY(r), h, GetRectMaxX(r), GetRectMaxY(r), h)
	call SetLightningColor(CreepsRectIndicatorLightning[CreepsRectIndicatorCount * 4 + 0], 0.211, 0.87, 0, 0.0)
	call SetLightningColor(CreepsRectIndicatorLightning[CreepsRectIndicatorCount * 4 + 1], 0.211, 0.87, 0, 0.0)
	call SetLightningColor(CreepsRectIndicatorLightning[CreepsRectIndicatorCount * 4 + 2], 0.211, 0.87, 0, 0.0)
	call SetLightningColor(CreepsRectIndicatorLightning[CreepsRectIndicatorCount * 4 + 3], 0.211, 0.87, 0, 0.0)
	set CreepsRectIndicatorCount = CreepsRectIndicatorCount + 1
endfunction

function PreloadNeutralCreeps takes nothing returns nothing
	call RemoveUnit(CreateUnit(NeutralCreepPlayer,'u001', GetRectCenterX(gg_rct_ScourgeAncientCenter), GetRectCenterY(gg_rct_ScourgeAncientCenter), 0))
	call RemoveUnit(CreateUnit(NeutralCreepPlayer,'u001', GetRectCenterX(gg_rct_ScourgeAncientCenter), GetRectCenterY(gg_rct_ScourgeAncientCenter), 0))
	call RemoveUnit(CreateUnit(NeutralCreepPlayer,'u001', GetRectCenterX(gg_rct_SentinelAncientCenter), GetRectCenterY(gg_rct_SentinelAncientCenter), 0))
	call RemoveUnit(CreateUnit(NeutralCreepPlayer,'u001', GetRectCenterX(gg_rct_SentinelNeutralCreepCenter3), GetRectCenterY(gg_rct_SentinelNeutralCreepCenter3), 0))
	call RemoveUnit(CreateUnit(NeutralCreepPlayer,'u001', GetRectCenterX(gg_rct_ScourgeNeutralCreepCenter5), GetRectCenterY(gg_rct_ScourgeNeutralCreepCenter5), 0))
	call RemoveUnit(CreateUnit(NeutralCreepPlayer,'u001', GetRectCenterX(gg_rct_ScourgeNeutralCreepCenter4), GetRectCenterY(gg_rct_ScourgeNeutralCreepCenter4), 0))
	call RemoveUnit(CreateUnit(NeutralCreepPlayer,'u001', GetRectCenterX(gg_rct_SentinelNeutralCreepCenter4), GetRectCenterY(gg_rct_SentinelNeutralCreepCenter4), 0))
	call RemoveUnit(CreateUnit(NeutralCreepPlayer,'u001', GetRectCenterX(gg_rct_ScourgeNeutralCreepCenter3), GetRectCenterY(gg_rct_ScourgeNeutralCreepCenter3), 0))
	call RemoveUnit(CreateUnit(NeutralCreepPlayer,'u001', GetRectCenterX(gg_rct_SentinelNeutralCreepCenter5), GetRectCenterY(gg_rct_SentinelNeutralCreepCenter5), 0))
	call RemoveUnit(CreateUnit(NeutralCreepPlayer,'u001', GetRectCenterX(gg_rct_ScourgeNeutralCreepCenter1), GetRectCenterY(gg_rct_ScourgeNeutralCreepCenter1), 0))
	call RemoveUnit(CreateUnit(NeutralCreepPlayer,'u001', GetRectCenterX(gg_rct_SentinelNeutralCreepCenter2), GetRectCenterY(gg_rct_SentinelNeutralCreepCenter2), 0))
	call RemoveUnit(CreateUnit(NeutralCreepPlayer,'u001', GetRectCenterX(gg_rct_ScourgeNeutralCreepCenter2), GetRectCenterY(gg_rct_ScourgeNeutralCreepCenter2), 0))
	call RemoveUnit(CreateUnit(NeutralCreepPlayer,'u001', GetRectCenterX(gg_rct_SentinelNeutralCreepCenter1), GetRectCenterY(gg_rct_SentinelNeutralCreepCenter1), 0))
endfunction
function InitTaverns takes nothing returns nothing
	local player p = Player(15)
	set EVV = CreateUnit(p,'n008',-7360, 6464, 270)
	set EEV = CreateUnit(p,'n0GJ',-7168, 6464, 270)
	set EXV = CreateUnit(p,'n01D',-6848, 6464, 270)
	set EOV = CreateUnit(p,'n0LH',-6656, 6464, 270)
	set ERV = CreateUnit(p,'n01N',-7360, 6784, 270)
	set EIV = CreateUnit(p,'n007',-7168, 6784, 270)
	set EAV = CreateUnit(p,'n005',-6848, 6784, 270)
	set ENV = CreateUnit(p,'n0LI',-6656, 6784, 270)
	set EBV = CreateUnit(p,'n01B',-7360, 7104, 270)
	set ECV = CreateUnit(p,'n01P',-7168, 7104, 270)
	set EDV = CreateUnit(p,'n0GK',-6848, 7104, 270)
	set EFV = CreateUnit(p,'n0LJ',-6656, 7104, 270)
	call SetUnitColor(EVV, ConvertPlayerColor(1))
	call SetUnitColor(EEV, ConvertPlayerColor(1))
	call SetUnitColor(EXV, ConvertPlayerColor(9))
	call SetUnitColor(EOV, ConvertPlayerColor(9))
	call SetUnitColor(ERV, ConvertPlayerColor(6))
	call SetUnitColor(EIV, ConvertPlayerColor(6))
	call SetUnitColor(EAV, ConvertPlayerColor(10))
	call SetUnitColor(ENV, ConvertPlayerColor(10))
	call SetUnitColor(EBV, ConvertPlayerColor(0))
	call SetUnitColor(ECV, ConvertPlayerColor(0))
	call SetUnitColor(EDV, ConvertPlayerColor(11))
	call SetUnitColor(EFV, ConvertPlayerColor(11))
endfunction

#include "base\\GameEnd.j"
#include "Map\\Structures\\Structures.j"

function AHC takes boolean b returns nothing
	local real a = 0.0
	local integer i = 0
	set DownAlt = b
	if b then
		set a = 0.70
	endif
	loop
		call SetLightningColor(CreepsRectIndicatorLightning[i * 4 + 0], 0.211, 0.87, 0, a)
		call SetLightningColor(CreepsRectIndicatorLightning[i * 4 + 1], 0.211, 0.87, 0, a)
		call SetLightningColor(CreepsRectIndicatorLightning[i * 4 + 2], 0.211, 0.87, 0, a)
		call SetLightningColor(CreepsRectIndicatorLightning[i * 4 + 3], 0.211, 0.87, 0, a)
		set i = i + 1
	exitwhen i > CreepsRectIndicatorCount
	endloop
	call SetTowerRangeIndicatorState(b)
endfunction

function PreloadAbilityLockPos takes nothing returns nothing

	call PreloadAbility('A0EY') // 毁灭阴影Z
	call PreloadAbility('A0FH') // 毁灭阴影X
	call PreloadAbility('A0F0') // 毁灭阴影C
	 
	call PreloadAbility('A08Q') // 伤残恐惧夜晚
	call PreloadAbility('A08c') // 伤残恐惧白天
	 
	call PreloadAbility('A1C0') // 分裂箭开启
	call PreloadAbility('A418') // 分裂箭关闭
	 
	call PreloadAbility('A10R') // 吞噬
	call PreloadAbility('A10S') // 吞噬-消化
	 
	call PreloadAbility('A11N') // 船长X标记
	call PreloadAbility('A13D') // 返回X标记
	 
	call PreloadAbility('A1A8') // 先祖之魂
	call PreloadAbility('A21J') // 先祖之魂 - 取消
	 
	call PreloadAbility('A1NI') // 不稳定化合物
	call PreloadAbility('A1NH') // 不稳定化合物 - 取消
	 
	call PreloadAbility('A1RJ') // 凤凰冲击
	call PreloadAbility('A20N') // 凤凰冲击 - 取消
	 
	call PreloadAbility('A1YX') // 烈火精灵
	call PreloadAbility('A1Z2') // 烈火精灵 - 额外
	 
	call PreloadAbility('A2E5') // 锯齿飞轮
	call PreloadAbility('A43S') // 锯齿飞轮 - A
	call PreloadAbility('A2FX') // 锯齿飞轮 - 关闭
	call PreloadAbility('A2E6') // 锯齿飞轮 - 关闭
	 
	call PreloadAbility('A0R0') // 黑暗之门
	call PreloadAbility('A2MB') // 黑暗之门 - 取消
	 
	call PreloadAbility('A0G8') // 水人复制
	call PreloadAbility('A0GC') // 水人复制 - 替换
	 
	call PreloadAbility('A07U') // 海妖之歌
	call PreloadAbility('A38E') // 海妖之歌 - A
	call PreloadAbility('A24E') // 海妖之歌 - 关闭
	 
	call PreloadAbility('A1RA') // 灵魂汲取 - 取消
	call PreloadAbility('A1PH') // 灵魂汲取
	 
	call PreloadAbility('A085') // 启明
	call PreloadAbility('A121') // 启明 - 发射
	 
	call PreloadAbility('A04Y') // 噩梦
	call PreloadAbility('A2O9') // 噩梦 - 关闭
	 
	call PreloadAbility('A21F') // 脉冲新星
	call PreloadAbility('A21G') // 脉冲新星 - A
	call PreloadAbility('A21H') // 脉冲新星 - 关闭
	 
	call PreloadAbility('A1MI') // 冰晶爆轰
	call PreloadAbility('A2QE') // 冰晶爆轰 - A
	call PreloadAbility('A1MN') // 冰晶爆轰 - 发射
	 
	 
	call PreloadAbility('A2JO') // 火之余烬 - 0-3
	call PreloadAbility('A2JQ') // 火之余烬 - 1-3
	call PreloadAbility('A2JP') // 火之余烬 - 2-3
	call PreloadAbility('A2JR') // 火之余烬 - 3-3
	call PreloadAbility('A2JL') // 火烬冲击 - 额外技能
endfunction
// 预读部分技能
function Init_PreloadAbilitys takes nothing returns nothing
	local integer i = 0
	
	// 预加载技能，以固定技能位置，防止跳键位。
	call PreloadAbilityLockPos()
	set Q4[0]='A17F'
	set Q4[1]='A17G'
	set Q4[2]='A17H'
	set Q4[3]='A17C'
	set Q4[4]='A17D'
	set Q4[5]='A17E'
	set Q4[6]='A17J'
	set Q4[7]='A17I'
	set Q4[8]='A17L'
	set Q4[9]='A439'
	set Q4[10]='A43A'
	set Q4[11]='A43B'
	//
	// 二进制属性系统初始化 - 生命值
	//
	set EC[0]='USS0'
	set EC[1]='USS1'
	set EC[2]='USS2'
	set EC[3]='USS3'
	set EC[4]='USS4'
	set EC[5]='USS5'
	set EC[6]='USS6'
	set EC[7]='USS7'
	set EC[8]='USS8'
	set EC[9]='USS9'
	set VC[0]='EVS0'
	set VC[1]='EVS1'
	set VC[2]='EVS2'
	set VC[3]='EVS3'
	set VC[4]='EVS4'
	set VC[5]='EVS5'
	set VC[6]='EVS6'
	set VC[7]='EVS7'
	set VC[8]='EVS8'
	// 二进制属性系统初始化 - 生命值
	// 已优化 删除
	// 二进制属性系统初始化 - 防御
	set T4[0]='A1CM'
	set T4[1]='A1CK'
	set T4[2]='A1CF'
	set T4[3]='A1CI'
	set T4[4]='A1CG'
	set T4[5]='A1CH'
	set PB[0]='ARM0'
	set PB[1]='ARM1'
	set PB[2]='ARM2'
	set PB[3]='ARM3'
	set PB[4]='ARM4'
	// 初始化禁用技能
	call SetAllPlayerAbilityUnavailable('A42L')
	call SetAllPlayerAbilityUnavailable('A344')
	call SetAllPlayerAbilityUnavailable('A27N')
	call SetAllPlayerAbilityUnavailable('A27O')
	call SetAllPlayerAbilityUnavailable('A27M')
	call SetAllPlayerAbilityUnavailable('A1IE')
	call SetAllPlayerAbilityUnavailable('A1IF')
	call SetAllPlayerAbilityUnavailable('A1IG')
	call SetAllPlayerAbilityUnavailable('A2QA')
	call SetAllPlayerAbilityUnavailable('A27P')
	call SetAllPlayerAbilityUnavailable('A1CA')
	call SetAllPlayerAbilityUnavailable('A1C9')
	call SetAllPlayerAbilityUnavailable('A1CB')
	call SetAllPlayerAbilityUnavailable('A1CC')
	call SetAllPlayerAbilityUnavailable('QF9E')
	call SetAllPlayerAbilityUnavailable('A1UH')
	call SetAllPlayerAbilityUnavailable('A1HZ')
	call SetAllPlayerAbilityUnavailable('A1I4')
	call SetAllPlayerAbilityUnavailable('A1I3')
	call SetAllPlayerAbilityUnavailable('A1I6')
	call SetAllPlayerAbilityUnavailable('A29N')
	call SetAllPlayerAbilityUnavailable('A414')
	call SetAllPlayerAbilityUnavailable('A174')
	call SetAllPlayerAbilityUnavailable('A1ET')
	call SetAllPlayerAbilityUnavailable('A1ES')
	call SetAllPlayerAbilityUnavailable('A1EQ')
	call SetAllPlayerAbilityUnavailable('A1ER')
	call SetAllPlayerAbilityUnavailable('A23F')
	call SetAllPlayerAbilityUnavailable('A1VV')
	call SetAllPlayerAbilityUnavailable(VC[0])
	call SetAllPlayerAbilityUnavailable(VC[1])
	call SetAllPlayerAbilityUnavailable(VC[2])
	call SetAllPlayerAbilityUnavailable(VC[3])
	call SetAllPlayerAbilityUnavailable(VC[4])
	call SetAllPlayerAbilityUnavailable(VC[5])
	call SetAllPlayerAbilityUnavailable(VC[6])
	call SetAllPlayerAbilityUnavailable(VC[7])
	call SetAllPlayerAbilityUnavailable(VC[8])
	call SetAllPlayerAbilityUnavailable(EC[0])
	call SetAllPlayerAbilityUnavailable(EC[1])
	call SetAllPlayerAbilityUnavailable(EC[2])
	call SetAllPlayerAbilityUnavailable(EC[3])
	call SetAllPlayerAbilityUnavailable(EC[4])
	call SetAllPlayerAbilityUnavailable(EC[5])
	call SetAllPlayerAbilityUnavailable(EC[6])
	call SetAllPlayerAbilityUnavailable(EC[7])
	call SetAllPlayerAbilityUnavailable(EC[8])
	call SetAllPlayerAbilityUnavailable(EC[9])
	call SetAllPlayerAbilityUnavailable('A431')


	call AddAbilityIDToPreloadQueue(S4[0])
	call AddAbilityIDToPreloadQueue(S4[1])
	call AddAbilityIDToPreloadQueue(S4[2])
	call AddAbilityIDToPreloadQueue(S4[3])
	call AddAbilityIDToPreloadQueue(S4[4])
	call AddAbilityIDToPreloadQueue(S4[5])
	call AddAbilityIDToPreloadQueue(S4[6])
	call AddAbilityIDToPreloadQueue(S4[7])
	call AddAbilityIDToPreloadQueue(S4[8])
	call AddAbilityIDToPreloadQueue(S4[9])
	call AddAbilityIDToPreloadQueue(S4[10])
endfunction
function Init_PRDRandom takes nothing returns nothing
	call SaveReal(PrdRandomHashTable,-1, 0, .0038)
	call SaveReal(PrdRandomHashTable,-1, 1, .0147)
	call SaveReal(PrdRandomHashTable,-1, 2, .0322)
	call SaveReal(PrdRandomHashTable,-1, 3, .0557)
	call SaveReal(PrdRandomHashTable,-1, 4, .0847)
	call SaveReal(PrdRandomHashTable,-1, 5, .1189)
	call SaveReal(PrdRandomHashTable,-1, 6, .1579)
	call SaveReal(PrdRandomHashTable,-1, 7, .2015)
	call SaveReal(PrdRandomHashTable,-1, 8, .2493)
	call SaveReal(PrdRandomHashTable,-1, 9, .3021)
	call SaveReal(PrdRandomHashTable,-1, 10, .3604)
	call SaveReal(PrdRandomHashTable,-1, 11, .4226)
	call SaveReal(PrdRandomHashTable,-1, 12, .4811)
	call SaveReal(PrdRandomHashTable,-1, 13, .5714)
	call SaveReal(PrdRandomHashTable,-1, 14, .6666)
	call SaveReal(PrdRandomHashTable,-1, 15, .75)
	call SaveReal(PrdRandomHashTable,-1, 16, .8235)
	call SaveReal(PrdRandomHashTable,-1, 17, .8888)
	call SaveReal(PrdRandomHashTable,-1, 18, .9473)
	call SaveReal(PrdRandomHashTable,-1, 19, 1.)
endfunction
// 暗影冲刺循环播放的动画 以序号
function Init_ChargeOfDarknessAnimation takes nothing returns nothing
	call SaveInteger(ObjectHashTable,'H06S','A1P8', 11)
	call SaveInteger(ObjectHashTable,'H00D','A1P8', 0)
	call SaveInteger(ObjectHashTable,'H503','A1P8', 5)
	call SaveInteger(ObjectHashTable,'H000','A1P8', 0)
	call SaveInteger(ObjectHashTable,'Otch','A1P8', 1)
	call SaveInteger(ObjectHashTable,'Harf','A1P8', 12)
	call SaveInteger(ObjectHashTable,'Npbm','A1P8', 0)
	call SaveInteger(ObjectHashTable,'H001','A1P8', 0)
	//	call SaveInteger(ObjectHashTable,'Ucrl','A1P8', 1)
	call SaveInteger(ObjectHashTable,'Ucrl','A1P8', 8)
	call SaveInteger(ObjectHashTable,'O015','A1P8', 1)
	call SaveInteger(ObjectHashTable,'Hamg','A1P8', 8)
	call SaveInteger(ObjectHashTable,'O01F','A1P8', 3)
	call SaveInteger(ObjectHashTable,'N01I','A1P8', 4)
	call SaveInteger(ObjectHashTable,'N01H','A1P8', 15)
	call SaveInteger(ObjectHashTable,'N01T','A1P8', 15)
	call SaveInteger(ObjectHashTable,'N01J','A1P8', 15)
	call SaveInteger(ObjectHashTable,'H600','A1P8', 15)
	call SaveInteger(ObjectHashTable,'H601','A1P8', 15)
	call SaveInteger(ObjectHashTable,'H602','A1P8', 15)
	call SaveInteger(ObjectHashTable,'H00T','A1P8', 0)
	call SaveInteger(ObjectHashTable,'Hlgr','A1P8', 6)
	call SaveInteger(ObjectHashTable,'H00E','A1P8', 4)
	call SaveInteger(ObjectHashTable,'H00F','A1P8', 4)
	call SaveInteger(ObjectHashTable,'H00G','A1P8', 4)
	call SaveInteger(ObjectHashTable,'H00Q','A1P8', 17)
	call SaveInteger(ObjectHashTable,'H008','A1P8', 1)
	call SaveInteger(ObjectHashTable,'E02F','A1P8', 5)
	call SaveInteger(ObjectHashTable,'E02I','A1P8', 12)
	call SaveInteger(ObjectHashTable,'E02K','A1P8', 0)
	call SaveInteger(ObjectHashTable,'E032','A1P8', 6)
	call SaveInteger(ObjectHashTable,'N0MU','A1P8', 0)
	call SaveInteger(ObjectHashTable,'Edem','A1P8', 8)
	call SaveInteger(ObjectHashTable,'Usyl','A1P8', 4)
	call SaveInteger(ObjectHashTable,'Nbbc','A1P8', 6)
	call SaveInteger(ObjectHashTable,'N01O','A1P8', 8)
	call SaveInteger(ObjectHashTable,'N013','A1P8', 13)
	call SaveInteger(ObjectHashTable,'N014','A1P8', 13)
	call SaveInteger(ObjectHashTable,'N015','A1P8', 13)
	call SaveInteger(ObjectHashTable,'E005','A1P8', 1)
	call SaveInteger(ObjectHashTable,'H0DL','A1P8', 1)
	call SaveInteger(ObjectHashTable,'HC49','A1P8', 2)
	call SaveInteger(ObjectHashTable,'Ogrh','A1P8', 0)
	call SaveInteger(ObjectHashTable,'N01V','A1P8', 6)
	call SaveInteger(ObjectHashTable,'HC92','A1P8', 10)
	call SaveInteger(ObjectHashTable,'N016','A1P8', 8)
	call SaveInteger(ObjectHashTable,'N017','A1P8', 8)
	call SaveInteger(ObjectHashTable,'QTW2','A1P8', 8)
	call SaveInteger(ObjectHashTable,'QTW3','A1P8', 8)
	call SaveInteger(ObjectHashTable,'N02B','A1P8', 8)
	call SaveInteger(ObjectHashTable,'E02N','A1P8', 2)
	call SaveInteger(ObjectHashTable,'E02O','A1P8', 2)
	call SaveInteger(ObjectHashTable,'Nbrn','A1P8', 8)
	call SaveInteger(ObjectHashTable,'E01Y','A1P8', 2)
	call SaveInteger(ObjectHashTable,'Huth','A1P8', 0)
	call SaveInteger(ObjectHashTable,'Hvwd','A1P8', 5)
	call SaveInteger(ObjectHashTable,'Naka','A1P8', 2)
	call SaveInteger(ObjectHashTable,'N0M0','A1P8', 0)
	call SaveInteger(ObjectHashTable,'H501','A1P8', 3)
	call SaveInteger(ObjectHashTable,'H502','A1P8', 10)
	call SaveInteger(ObjectHashTable,'H500','A1P8', 9)
	call SaveInteger(ObjectHashTable,'Hjai','A1P8', 6)
	call SaveInteger(ObjectHashTable,'Emoo','A1P8', 8)
	call SaveInteger(ObjectHashTable,'N00B','A1P8', 3)
	call SaveInteger(ObjectHashTable,'H00A','A1P8', 2)
	call SaveInteger(ObjectHashTable,'Hblm','A1P8', 0)
	call SaveInteger(ObjectHashTable,'Hmbr','A1P8', 20)
	call SaveInteger(ObjectHashTable,'Emns','A1P8', 7)
	call SaveInteger(ObjectHashTable,'N01A','A1P8', 1)
	call SaveInteger(ObjectHashTable,'H004','A1P8', 2)
	call SaveInteger(ObjectHashTable,'H00S','A1P8', 0)
	call SaveInteger(ObjectHashTable,'N0MU','A1P8', 0)
	call SaveInteger(ObjectHashTable,'N0EG','A1P8', 8)
	call SaveInteger(ObjectHashTable,'E02J','A1P8', 2)
	call SaveInteger(ObjectHashTable,'Hmkg','A1P8', 11)
	call SaveInteger(ObjectHashTable,'H00K','A1P8', 0)
	call SaveInteger(ObjectHashTable,'E00P','A1P8', 4)
	call SaveInteger(ObjectHashTable,'Ntin','A1P8', 0)
	if GetRandomReal(0, 1)> .9 then
		call SaveInteger(ObjectHashTable,'Ntin','A1P8', 13)
	endif
	call SaveInteger(ObjectHashTable,'Orkn','A1P8', 0)
	call SaveInteger(ObjectHashTable,'E02X','A1P8', 1)
	call SaveInteger(ObjectHashTable,'H0DO','A1P8', 4)
	call SaveInteger(ObjectHashTable,'NOMD','A1P8', 1)
	call SaveInteger(ObjectHashTable,'Opgh','A1P8', 6)
	call SaveInteger(ObjectHashTable,'U00A','A1P8', 7)
	call SaveInteger(ObjectHashTable,'UC42','A1P8', 1)
	call SaveInteger(ObjectHashTable,'U007','A1P8', 1)
	call SaveInteger(ObjectHashTable,'Udea','A1P8', 0)
	call SaveInteger(ObjectHashTable,'U008','A1P8', 2)
	call SaveInteger(ObjectHashTable,'E015','A1P8', 2)
	call SaveInteger(ObjectHashTable,'Udre','A1P8', 4)
	call SaveInteger(ObjectHashTable,'N00R','A1P8', 3)
	call SaveInteger(ObjectHashTable,'U00F','A1P8', 1)
	call SaveInteger(ObjectHashTable,'NC00','A1P8', 2)
	call SaveInteger(ObjectHashTable,'UC91','A1P8', 1)
	call SaveInteger(ObjectHashTable,'H00R','A1P8', 1)
	call SaveInteger(ObjectHashTable,'H07I','A1P8', 8)
	call SaveInteger(ObjectHashTable,'Ofar','A1P8', 1)
	call SaveInteger(ObjectHashTable,'UC11','A1P8', 3)
	call SaveInteger(ObjectHashTable,'O00J','A1P8', 2)
	call SaveInteger(ObjectHashTable,'U00K','A1P8', 1)
	call SaveInteger(ObjectHashTable,'KODO','A1P8', 9)
	call SaveInteger(ObjectHashTable,'Hvsh','A1P8', 3)
	call SaveInteger(ObjectHashTable,'E004','A1P8', 4)
	call SaveInteger(ObjectHashTable,'U006','A1P8', 1)
	call SaveInteger(ObjectHashTable,'U000','A1P8', 13)
	call SaveInteger(ObjectHashTable,'Ubal','A1P8', 2)
	call SaveInteger(ObjectHashTable,'Ewar','A1P8', 2)
	call SaveInteger(ObjectHashTable,'Nfir','A1P8', 2)
	call SaveInteger(ObjectHashTable,'Eevi','A1P8', 7)
	call SaveInteger(ObjectHashTable,'Eevm','A1P8', 14)
	call SaveInteger(ObjectHashTable,'E02V','A1P8', 14)
	call SaveInteger(ObjectHashTable,'E02W','A1P8', 14)
	call SaveInteger(ObjectHashTable,'E02U','A1P8', 14)
	call SaveInteger(ObjectHashTable,'E01B','A1P8', 1)
	call SaveInteger(ObjectHashTable,'EC57','A1P8', 2)
	call SaveInteger(ObjectHashTable,'EC77','A1P8', 5)
	call SaveInteger(ObjectHashTable,'H00I','A1P8', 1)
	call SaveInteger(ObjectHashTable,'E002','A1P8', 1)
	call SaveInteger(ObjectHashTable,'H071','A1P8', 1)
	call SaveInteger(ObjectHashTable,'EC45','A1P8', 0)
	call SaveInteger(ObjectHashTable,'H00V','A1P8', 1)
	call SaveInteger(ObjectHashTable,'N0MK','A1P8', 9)
	call SaveInteger(ObjectHashTable,'Oshd','A1P8', 5)
	call SaveInteger(ObjectHashTable,'H00N','A1P8', 2)
	call SaveInteger(ObjectHashTable,'UC76','A1P8', 2)
	call SaveInteger(ObjectHashTable,'UC18','A1P8', 0)
	call SaveInteger(ObjectHashTable,'Uktl','A1P8', 2)
	call SaveInteger(ObjectHashTable,'Ulic','A1P8', 4)
	call SaveInteger(ObjectHashTable,'U00E','A1P8', 6)
	call SaveInteger(ObjectHashTable,'H00H','A1P8', 3)
	call SaveInteger(ObjectHashTable,'U00P','A1P8', 4)
	call SaveInteger(ObjectHashTable,'UC01','A1P8', 7)
	call SaveInteger(ObjectHashTable,'E01C','A1P8', 5)
	call SaveInteger(ObjectHashTable,'E02H','A1P8', 2)
	call SaveInteger(ObjectHashTable,'O016','A1P8', 3)
	call SaveInteger(ObjectHashTable,'O017','A1P8', 3)
	call SaveInteger(ObjectHashTable,'N01W','A1P8', 8)
	call SaveInteger(ObjectHashTable,'H00U','A1P8', 2)
	call SaveInteger(ObjectHashTable,'UC60','A1P8', 5)
	call SaveInteger(ObjectHashTable,'Ekee','A1P8', 2)
	call SaveInteger(ObjectHashTable,'E01A','A1P8', 8)
	call SaveInteger(ObjectHashTable,'N0HP','A1P8', 9)
	call SaveInteger(ObjectHashTable,'N0M7','A1P8', 3)
	call SaveInteger(ObjectHashTable,'N0MB','A1P8', 3)
	call SaveInteger(ObjectHashTable,'N0MC','A1P8', 3)
	call SaveInteger(ObjectHashTable,'N0MO','A1P8', 3)
	call SaveInteger(ObjectHashTable,'N0MA','A1P8', 3)
endfunction
function E7N takes integer unitTypeId, integer T0V returns nothing
	call SaveInteger(UnitRGBHashTable, unitTypeId, 5, T0V)
endfunction
function Init_HerosTypeAghanimEffectAbilityId takes nothing returns nothing
	call E7N(HeroListTypeId[1],'A1NR')
	call E7N(HeroListTypeId[2],'A0PF')
	call E7N(HeroListTypeId[3],'A1X2')
	call E7N(HeroListTypeId[4], 0)
	call E7N(HeroListTypeId[5],'A0Q9')
	call E7N(HeroListTypeId[6], 0)
	call E7N(HeroListTypeId[7], 0)
	call E7N(HeroListTypeId[8],'A1OC')
	call E7N(HeroListTypeId[9], 0)
	call E7N(HeroListTypeId[CB], 0)
	call E7N(HeroListTypeId[DB],'A0PC')
	call E7N(HeroListTypeId[FB],'A1QL')
	call E7N(HeroListTypeId[GB], 0)
	call E7N(HeroListTypeId[HB], 0)
	call E7N(HeroListTypeId[JB], 0)
	call E7N(HeroListTypeId[16], 0)
	call E7N(HeroListTypeId[17], 0)
	call E7N(HeroListTypeId[18],'A0P9')
	call E7N(HeroListTypeId[19], 0)
	call E7N(HeroListTypeId[20],'A20M')
	call E7N(HeroListTypeId[21], 0)
	call E7N(HeroListTypeId[22], 0)
	call E7N(HeroListTypeId[23],'A1R7')
	call E7N(HeroListTypeId[24],'A20V')
	call E7N(HeroListTypeId[25],'A1NQ')
	call E7N(HeroListTypeId[26], 0)
	call E7N(HeroListTypeId[27], 0)
	call E7N(HeroListTypeId[28],'A0P8')
	call E7N(HeroListTypeId[29], 0)
	call E7N(HeroListTypeId[30], 0)
	call E7N(HeroListTypeId[31], 0)
	call E7N(HeroListTypeId[32], 0)
	call E7N(HeroListTypeId[33], 0)
	call E7N(HeroListTypeId[34], 0)
	call E7N(HeroListTypeId[35], 0)
	call E7N(HeroListTypeId[36], 0)
	call E7N(HeroListTypeId[37],'A29E')
	call E7N(HeroListTypeId[38],'A1VF')
	call E7N(HeroListTypeId[39], 0)
	call E7N(HeroListTypeId[40], 0)
	call E7N(HeroListTypeId[41], 0)
	call E7N(HeroListTypeId[42],'A1NS')
	call E7N(HeroListTypeId[43], 0)
	call E7N(HeroListTypeId[44],'A1RG')
	call E7N(HeroListTypeId[45],'A220')
	call E7N(HeroListTypeId[46], 0)
	call E7N(HeroListTypeId[47], 0)
	call E7N(HeroListTypeId[48],'A23E')
	call E7N(HeroListTypeId[49], 0)
	call E7N(HeroListTypeId[50], 0)
	call E7N(HeroListTypeId[51], 0)
	call E7N(HeroListTypeId[52], 0)
	call E7N(HeroListTypeId[53], 0)
	call E7N(HeroListTypeId[54], 0)
	call E7N(HeroListTypeId[55], 0)
	call E7N(HeroListTypeId[56], 0)
	call E7N(HeroListTypeId[57], 0)
	call E7N(HeroListTypeId[58], 0)
	call E7N(HeroListTypeId[59], 0)
	call E7N(HeroListTypeId[60], 0)
	call E7N(HeroListTypeId[61], 0)
	call E7N(HeroListTypeId[62], 0)
	call E7N(HeroListTypeId[63], 0)
	call E7N(HeroListTypeId[64], 0)
	call E7N(HeroListTypeId[65], 0)
	call E7N(HeroListTypeId[66], 0)
	call E7N(HeroListTypeId[67],'A0P7')
	call E7N(HeroListTypeId[68], 0)
	call E7N(HeroListTypeId[69],'A1R3')
	call E7N(HeroListTypeId[70], 0)
	call E7N(HeroListTypeId[71], 0)
	call E7N(HeroListTypeId[72], 0)
	call E7N(HeroListTypeId[73],'A0PB')
	call E7N(HeroListTypeId[74], 0)
	call E7N(HeroListTypeId[75],'A1R8')
	call E7N(HeroListTypeId[76],'A1R9')
	call E7N(HeroListTypeId[77],'A1VB')
	call E7N(HeroListTypeId[78],'A1VE')
	call E7N(HeroListTypeId[79], 0)
	call E7N(HeroListTypeId[80], 0)
	call E7N(HeroListTypeId[81],'A1NX')
	call E7N(HeroListTypeId[82],'A1V9')
	call E7N(HeroListTypeId[83], 0)
	call E7N(HeroListTypeId[84], 0)
	call E7N(HeroListTypeId[85], 0)
	call E7N(HeroListTypeId[86],'A1V5')
	call E7N(HeroListTypeId[87],'A1VZ')
	call E7N(HeroListTypeId[88],'A1UY')
	call E7N(HeroListTypeId[89], 0)
	call E7N(HeroListTypeId[90], 0)
	call E7N(HeroListTypeId[91], 0)
	call E7N(HeroListTypeId[92], 0)
	call E7N(HeroListTypeId[93],'A21Z')
	call E7N(HeroListTypeId[94], 0)
	call E7N(HeroListTypeId[95], 0)
	call E7N(HeroListTypeId[96], 0)
	call E7N(HeroListTypeId[97], 0)
	call E7N(HeroListTypeId[98], 0)
	call E7N(HeroListTypeId[99], 0)
	call E7N(HeroListTypeId[ 100 ], 0)
	call E7N(HeroListTypeId['e'], 0)
	call E7N(HeroListTypeId['f'],'A0PE')
	call E7N(HeroListTypeId['g'], 0)
	call E7N(HeroListTypeId['h'],'A0PA')
	call E7N(HeroListTypeId['i'], 0)
	call E7N(HeroListTypeId['j'], 0)
	call E7N(HeroListTypeId['k'], 0)
	call E7N(HeroListTypeId['l'], 0)
	call E7N(HeroListTypeId['m'], 0)
	call E7N(HeroListTypeId[110], 0)
	call E7N(HeroListTypeId['o'], 0)
	call E7N(HeroListTypeId['p'], 0)
	call E7N(HeroListTypeId['q'], 0)
	call E7N(HeroListTypeId[114], 0)
	call E7N(HeroListTypeId[115], 0)
	call E7N(HeroListTypeId[116], 0)
	call E7N(HeroListTypeId['u'], 0)
	call E7N(HeroListTypeId['v'], 0)
endfunction

function fj_Actions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local unit u = GetTriggerUnit()
	if GetTriggerEventId() == EVENT_WIDGET_DEATH or GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		if (EXGetEventDamageData(1) != 0) and GetUnitAbilityLevel(u,'A3W0')> 0 and GetEventDamage() > 1.00 then
			call UnitAddAbilityToTimed(u,'A3W9', 1, 0.4,'B3W9')
		endif
	else
		if GetUnitAbilityLevel(u,'A3W0')> 0 then
			if GetIssuedOrderId()>= 852008 and GetIssuedOrderId()<= 852013 then
				call EXStopUnit(u)
			endif
		endif
	endif
	set t = null
	set u = null
	return false
endfunction

function fj_exec takes nothing returns nothing
	local unit u = U2
	local unit u2 = MissileHitTargetUnit
	local trigger t
	call FKX(u2, true)
	if not IsUnitIllusion(u2) then
		set t = CreateTrigger()
		call UnitAddAbilityToTimed(u2,'A3W0', 1, 6.0,'B3W0')
		call TriggerRegisterTimerEvent(t, 6.00, false)
		call TriggerRegisterDeathEvent(t, u2)
		call TriggerRegisterUnitEvent(t, u2, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(t, Condition(function fj_Actions))
		call TriggerRegisterUnitEvent(t, u2, EVENT_UNIT_ISSUED_ORDER)
		call TriggerRegisterUnitEvent(t, u2, EVENT_UNIT_ISSUED_TARGET_ORDER)
		call TriggerRegisterUnitEvent(t, u2, EVENT_UNIT_ISSUED_POINT_ORDER)
	endif
	set t = null
	set u = null
	set u2 = null
endfunction

function jys_calc takes integer team returns integer
	return 700 + jys_count[team]* 135
endfunction

function jys_changeDesc takes integer team returns nothing
	local string s = "使用后直接获得%d经验。再次使用将额外增加135点经验。|n|n|cFF99CCFF商店最大储量：|r 3|n|cFF99CCFF商店刷新时间：|r 10 分钟|n|n|cFF99CCFF开局后10分钟才可购买|r"
	if (team == 0 and IsSentinelPlayer(LocalPlayer)) or(team == 1 and IsScourgePlayer(LocalPlayer)) then
		set s = StringReplace(s, "%d", I2S(jys_calc(team)))
		call YDWESetItemDataString(XOV[it_jys], 3, s)
		//set s = j5j(K1V[it_jys], 2)
		//set s = huh(s, jys_calc(team))
		//call ovk(K1V[it_jys], s)
		//set s = j5j(K2V[it_jys], 2)
		//set s = huh(s, jys_calc(team))
		//call ovk(K2V[it_jys], s)
	endif
endfunction

function jys_trigger takes nothing returns nothing
	local integer xp
	local unit u = GetTriggerUnit()
	local integer team
	local player p = GetOwningPlayer(u)
	if IsSentinelPlayer(p) then
		set team = 0
	else
		set team = 1
	endif
	set xp = jys_calc(team)
	call CDO(u)
	if IsUnitType(u, UNIT_TYPE_HERO) and not HeroIsDummyUnit(u) then
		call AddHeroXPSimple(u, xp, true)
	endif
	set jys_count[team]= jys_count[team] + 1
	call jys_changeDesc(team)
	set u = null
endfunction

function fj_trigger takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit u2 = GetSpellTargetUnit()
	call LaunchMissileByUnitDummy(u, u2,'h0EO', "fj_exec", 5000, true)
	set u = null
	set u2 = null
endfunction

function PreloadKael_Ability takes nothing returns nothing
	call PreloadAbility('Z601') // 阳炎冲击
	call PreloadAbility('Z602') // 混沌陨石
	call PreloadAbility('Z603') // 熔炉精灵
	call PreloadAbility('Z604') // 急速冷却
	call PreloadAbility('Z605') // 幽灵漫步
	call PreloadAbility('QFZZ') // 幽灵漫步-退出
	call PreloadAbility('Z606') // 寒冰之墙
	call PreloadAbility('Z607') // 灵动迅捷
	call PreloadAbility('Z608') // 强袭飓风
	call PreloadAbility('Z609') // 电磁脉冲
	call PreloadAbility('Z610') // 超震声波
endfunction

function GetSeGlyphCd takes integer i returns real
	if i == 1 then
		return YDWEGetUnitAbilityState(CirclesUnit[GetPlayerId(SentinelPlayers[1])], 'A141', 1)
	else
		return YDWEGetUnitAbilityState(CirclesUnit[GetPlayerId(ScourgePlayers[1])], 'A141', 1)
	endif
	return 0.
endfunction

function GetSeGlyphCdByUnit takes unit u returns real
	return YDWEGetUnitAbilityState(u, 'A141', 1)
endfunction

function Click_UI_Glyph_A takes nothing returns nothing
	local player p = DzGetTriggerKeyPlayer()
	if GetSeGlyphCdByUnit(CirclesUnit[GetPlayerId(p)]) == 0.00 then
		call DzSyncData("p", "1")
	endif
endfunction

function GetChat_times takes nothing returns boolean
	local integer i = 0
	local real time = GetGameTime()
	loop
		if Chat_times[i] == 0 then
			set Chat_times[i] = time
			return true
		elseif (time - Chat_times[i] ) > 10 then
			set Chat_times[i] = time
			return true
		endif
	exitwhen i == 5
		set i = i + 1
	endloop
	return false
endfunction

function Click_UI_Glyph takes nothing returns nothing
	local player p = DzGetTriggerKeyPlayer()
	if DzIsKeyDown(18) then
		if GetChat_times() then
			call DzSyncData("p", "0")
		endif
	else
		if GetSeGlyphCdByUnit(CirclesUnit[GetPlayerId(p)]) == 0.00 then
			call DzSyncData("p", "1")
		endif
	endif
endfunction

function Trig_SynsL takes player p, integer id returns nothing
	local unit u = Player__Hero[id]
	local integer i = GetHeroLevel(u)
	if IsPlayerAlly(LocalPlayer, p) or IsObserverPlayer(LocalPlayer) then
		call EXDisplayChat(p, 1, "我还需要|c00FFFF00" + I2S(DzGetUnitNeededXP(u, i)-GetHeroXP(u))+ "|r点经验到达" + I2S(i + 1)+ "级")
	endif
	set u = null
endfunction

function Click_UI_HeroBarButton takes nothing returns nothing
	if DzIsKeyDown(18) and GetChat_times() then
		call DzSyncData("p", "2")
	endif
endfunction

function Trig_SynsO takes nothing returns nothing
	local player p = DzGetTriggerSyncPlayer()
	local integer id = GetPlayerId(p)
	if IsObserverPlayer(LocalPlayer) then
		call EXDisplayChat(p, 2, "近卫军团防御符文冷却：" + R2S(GetSeGlyphCd(1)))
		call EXDisplayChat(p, 2, "天灾军团防御符文冷却：" + R2S(GetSeGlyphCd(2)))
	endif
endfunction


function Trig_SynsT takes nothing returns nothing
	local player p = DzGetTriggerSyncPlayer()
	if IsPlayerAlly(LocalPlayer, p) or IsObserverPlayer(LocalPlayer) then
		call EXDisplayChat(p, 1, DzGetTriggerSyncData())
	endif
endfunction



function UnitLP takes unit u, boolean b returns string
	local integer i = R2I(GetUnitLifePercent(u))
	local string s
	if b then
		set s = "|Cff00ff00"
	else
		set s = "|CFFFF0000"
	endif
	if i == 0 then
		set i = 1
	endif
	return s + I2S(i)+ "%生命|R和"
endfunction
function UnitMP takes unit u returns string
	local integer i = R2I(GetUnitManaPercent(u))
	if i == 0 then
		set i = 1
	endif
	return "|cff6495ed" + I2S(i)+ "%魔法|R"
endfunction

function PingMinimapByPlayerColor takes player p, real x, real y returns nothing
	local playercolor pc = GetPlayerColor(p)
	local integer r = 0
	local integer g = 0
	local integer b = 0
	if pc == PLAYER_COLOR_RED then
		set r = 255
	elseif pc == PLAYER_COLOR_BLUE  then
		set g = 64
		set b = 255
	elseif pc == PLAYER_COLOR_CYAN  then
		set r = 27
		set g = 230
		set b = 184
	elseif pc == PLAYER_COLOR_PURPLE  then
		set r = 83
		set g = 0
		set b = 128
	elseif pc == PLAYER_COLOR_YELLOW  then
		set r = 255
		set g = 255
	elseif pc == PLAYER_COLOR_ORANGE  then
		set r = 254
		set g = 137
		set b = 13
	elseif pc == PLAYER_COLOR_GREEN  then
		set r = 31
		set g = 191
	elseif pc == PLAYER_COLOR_PINK  then
		set r = 229
		set b = 175
	elseif pc == PLAYER_COLOR_LIGHT_GRAY  then
		set r = 148
		set g = 149
		set b = 150
	elseif pc == PLAYER_COLOR_LIGHT_BLUE  then
		set r = 125
		set g = 190
		set b = 241
	elseif pc == PLAYER_COLOR_AQUA then
		set r = 15
		set g = 97
		set b = 69
	elseif pc == PLAYER_COLOR_BROWN  then
		set r = 64
	endif
	call PingMinimapEx(x, y, 6, r, g, b, true)

	set pc = null
endfunction

// 异步存取无所谓了 反正这哈希表就转一下类型
function ConvertHandleId2Unit takes integer i returns unit
	call SaveFogStateHandle(ConvertType, 0, 0, ConvertFogState(i))
	return LoadUnitHandle(ConvertType, 0, 0)
endfunction

function PromptEnemyState takes player p, string s returns nothing
	local unit u = ConvertHandleId2Unit(S2I(s))
	local player p2
	if u == null then
		return
	endif
	set p2 = GetOwningPlayer(u)
	call EXDisplayChat(p, 1, "敌人" + PlayersColoerText[GetPlayerId(p2)] + GetPlayerName(p2) + "|r拥有" + UnitLP(u, false)+ UnitMP(u))
	call PingMinimapByPlayerColor(p, GetUnitX(u), GetUnitY(u))
	set u = null
	set p2 = null
endfunction

function Trig_Synsp takes nothing returns nothing
	local player p = DzGetTriggerSyncPlayer()
	local integer id = GetPlayerId(p)
	local string s = DzGetTriggerSyncData()
	if s == "1" then
		call IssueImmediateOrderById(CirclesUnit[GetPlayerId(DzGetTriggerSyncPlayer())], 852244)
	elseif s == "2" then
		call Trig_SynsL(p, id)
	elseif s == "0" then
		if IsSentinelPlayer(p) then
			if IsPlayerAlly(LocalPlayer, p) or IsObserverPlayer(LocalPlayer) then
				if GetSeGlyphCd(1) == 0.00 then
					call EXDisplayChat(p, 1, "防御符文 > 已准备就绪")
				else
					call EXDisplayChat(p, 1, "防御符文 > 冷却中 ( " + I2S(R2I(GetSeGlyphCd(1)))+ " )")
				endif
			endif
		elseif IsScourgePlayer(p) then
			if IsPlayerAlly(LocalPlayer, p) or IsObserverPlayer(LocalPlayer) then
				if GetSeGlyphCd(2) == 0.00 then
					call EXDisplayChat(p, 1, "防御符文 > 准备就绪。")
				else
					call EXDisplayChat(p, 1, "防御符文 > 冷却中 ( " + I2S(R2I(GetSeGlyphCd(2)))+ " )")
				endif
			endif
		endif
	else
		if IsPlayerAlly(LocalPlayer, p) or IsObserverPlayer(LocalPlayer) then
			call PromptEnemyState(p, s)
		endif
	endif
endfunction

function ChangeAbilityLearnHotKey takes player whichPlayer, integer abilityId, integer newKey returns nothing
    local ability hAbility = null
    local string sNewKey
    if abilityId == 0 then
        return
    endif

    call UnitAddAbility( PreloadeHero, abilityId )

    set hAbility = EXGetUnitAbility( PreloadeHero , abilityId )
    if hAbility == null then
        //call BJDebugMsg( "error,错误的技能 " + I2S(abilityId) )
        return
    endif
    if whichPlayer == LocalPlayer then
        // 设置快捷键
        if EXGetAbilityDataInteger( hAbility, 1, ABILITY_DATA_RESEARCH_HOTKEY ) != 0 then
            call EXSetAbilityDataInteger( hAbility, 1, ABILITY_DATA_RESEARCH_HOTKEY, newKey )

            // call BJDebugMsg( "改键成功" + GetObjectName(abilityId)+ " " + I2S(abilityId) + Key2Str(newKey) )

            call SaveInteger( LocalHashTable, abilityId, HotKeyStringHash, newKey )
            
            set sNewKey = Key2Str( newKey )

            // 修改文本
            if EXGetAbilityDataString( hAbility, 1, ABILITY_DATA_RESEARCH_TIP ) != "" then
                call EXSetAbilityDataString( hAbility, 1, ABILITY_DATA_RESEARCH_TIP, GetHeroSkillResearchTip(abilityId, sNewKey) )
            endif
        endif
    endif

    set hAbility = null
    call UnitRemoveAbility( PreloadeHero , abilityId )

endfunction

function SyncLeranSkillHotKeyActions takes nothing returns boolean
    local string syncData = DzGetTriggerSyncData()
    local player whichPlayer = Player(S2I(SubString(syncData, 0, 1)))
    local integer abilityId = YDWES2Id(SubString(syncData, 1, 5))
    local integer newKey = Str2Key(SubString(syncData, 5, 6))
    //call BJDebugMsg(syncData + GetObjectName(abilityId) + SubString(syncData, 1, 5) + " 为 " + SubString(syncData, 5, 6) )
    call ChangeAbilityLearnHotKey( whichPlayer, abilityId, newKey )

    return false
endfunction

function SyncFogClickData takes nothing returns nothing
	local string data = DzGetTriggerSyncData()
	local integer pid1 = S2I(SubString(data, 0, 2))
	local integer pid2 = GetPlayerId(DzGetTriggerSyncPlayer())
	local boolean b = pid1 == pid2
	local unit u = ConvertHandleId2Unit(S2I( SubString(data, StringPos(data, "/")+1, StringLength(data)) ))
	local string time = SubString(data, StringPos(data, "*")+1, StringLength(data))

	if u != null and IsReplayMode then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, "|c00ff0303可能的开图点击|r " + PlayersColoerText[pid1] + PlayersName[pid1] + "|r 点击了 " + GetUnitName(u) + "于 " + time )
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, "由于此信息可能会在极限视野点击时误报，请自己根据主视野红圈和实际行动鉴别。")
		if pid2 != 0 and not b then
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, "." + I2S(pid2))
		endif
		call PingMinimapEx(GetUnitX(u), GetUnitY(u), 6, 255, 0, 0, false)
	endif
	set u = null
endfunction

function InitSyncTrigger takes nothing returns nothing
	local trigger trig
	set trig = CreateTrigger()
	call DzTriggerRegisterSyncData(trig, "p", false)
	call TriggerAddAction(trig, function Trig_Synsp)
	set trig = CreateTrigger()
	call DzTriggerRegisterSyncData(trig, "t", false)
	call TriggerAddAction(trig, function Trig_SynsT)

	set trig = CreateTrigger()
	call DzTriggerRegisterSyncData(trig, "FogClick", false)
    call TriggerAddCondition(trig, Condition( function SyncFogClickData))

	// 同步学习技能快捷键
	set trig = CreateTrigger()
	call DzTriggerRegisterSyncData(trig, "SyncLeranSkillHotKey", false)
    call TriggerAddCondition(trig, Condition( function SyncLeranSkillHotKeyActions ))
	set trig = null
endfunction

function ChangeUnitAbilityHotKey takes integer iabilityId, integer newKey returns nothing
    local ability hAbility = null
    local integer iHotKey
    local integer loop_Index
    local boolean isLearnSkill = false
    local string sNewKey
    if iabilityId == 0 then
        return
	elseif iabilityId == 'AHer' then
        set newKey = LocalCommandButtonHotkey[ChangeKeyLoopIndex + 12]
        if MessageAbilityOrder == 0 or MessageAbilityOrder == 852000 or newKey == 0 then
            //call BJDebugMsg("返回 " + GetObjectName(MessageAbilityOrder))
            return
        endif
        set isLearnSkill = true
        set iabilityId = MessageAbilityOrder
	elseif newKey == 0 then
		return
    endif
    set hAbility = EXGetUnitAbility(GetPlayerSelectedUnit(), iabilityId)
    if hAbility == null then
        if isLearnSkill and LoadInteger(LocalHashTable, iabilityId, HotKeyStringHash) != newKey then
            //call BJDebugMsg("同步数据: " + GetObjectName(iabilityId) + " " + I2S(iabilityId) + Key2Str(newKey) + I2S(ChangeKeyLoopIndex))
            call DzSyncData("SyncLeranSkillHotKey", I2S(LocalPlayerId) + YDWEId2S(iabilityId) + Key2Str(newKey) )
        endif
        return
    endif
    if isLearnSkill then
        set iHotKey = EXGetAbilityDataInteger(hAbility, 1, ABILITY_DATA_RESEARCH_HOTKEY)
    else
        set iHotKey = EXGetAbilityDataInteger(hAbility, 1, ABILITY_DATA_HOTKEY)
    endif
    // 如果技能没快捷键 说明不必要改了
    if iHotKey == 0 or iHotKey == newKey then
        set hAbility = null
        return
    endif

    // 使用快捷键
    if not isLearnSkill then

		// 修改快捷键 然后将哈希表内储存的改一下 否则双击快捷键施法就失效
        if EXSetAbilityDataInteger(hAbility, 1, ABILITY_DATA_HOTKEY, newKey) then
            if LoadBoolean(LocalHashTable, iabilityId, KEY_USE_DOUBLECLICK_SPELL) then
                set KeyCanDoubleClickSpell[iHotKey] = KeyCanDoubleClickSpell[iHotKey] - 1
                set KeyCanDoubleClickSpell[newKey] = KeyCanDoubleClickSpell[newKey] + 1
                call SaveInteger(LocalHashTable, iabilityId, HotKeyStringHash, newKey)
            endif
        endif
        // 关闭快捷键
        if EXGetAbilityDataInteger(hAbility, 1, ABILITY_DATA_UNHOTKEY) != 0 then
            call EXSetAbilityDataInteger(hAbility, 1, ABILITY_DATA_UNHOTKEY, newKey)
        endif

        set sNewKey = Key2Str(newKey)
        if EXGetAbilityDataString(hAbility, 2, ABILITY_DATA_TIP) != "" then
            call EXSetAbilityDataString(hAbility, 1, ABILITY_DATA_TIP, GetHeroSkillTip(iabilityId, sNewKey, 1) )
            call EXSetAbilityDataString(hAbility, 2, ABILITY_DATA_TIP, GetHeroSkillTip(iabilityId, sNewKey, 2) )
    
            set loop_Index = 3

            loop	
                exitwhen EXGetAbilityDataString(hAbility, loop_Index, ABILITY_DATA_TIP) == ""
				call EXSetAbilityDataString(hAbility, loop_Index, ABILITY_DATA_TIP, GetHeroSkillTip(iabilityId, sNewKey, loop_Index) )
                set loop_Index = loop_Index + 1
            endloop
        else
            call EXSetAbilityDataString(hAbility, 1, ABILITY_DATA_TIP, GetUnitAbilityTip(iabilityId, sNewKey) )
        endif

    endif
    
    if isLearnSkill and EXGetAbilityDataInteger(hAbility, 1, ABILITY_DATA_RESEARCH_HOTKEY) != 0 then
        // 学习快捷键
		call EXSetAbilityDataInteger(hAbility, 1, ABILITY_DATA_RESEARCH_HOTKEY, newKey)
		// 学习提示
        call EXSetAbilityDataString(hAbility, 1, ABILITY_DATA_RESEARCH_TIP, GetHeroSkillResearchTip(iabilityId, Key2Str(newKey)) )
    endif

    set hAbility = null
endfunction

// 刷新单位的快捷键
function RefreshUnitAbilityHotKey takes unit whichUnit returns nothing
    set ChangeKeyLoopIndex = 0
    loop
        if LocalCommandButtonHotkey[ChangeKeyLoopIndex] != 0 or LocalCommandButtonHotkey[ChangeKeyLoopIndex + 12] != 0 then
            call ChangeUnitAbilityHotKey(GetLocalAbilityId(LocalCommandX[ChangeKeyLoopIndex], LocalCommandY[ChangeKeyLoopIndex]), LocalCommandButtonHotkey[ChangeKeyLoopIndex])
        endif
        exitwhen ChangeKeyLoopIndex == 11
        set ChangeKeyLoopIndex = ChangeKeyLoopIndex + 1
    endloop
endfunction


// 进行是否双击的判断 如果shift按住则强制ESC
function DoubleClickSkill takes nothing returns nothing
	local real CurrentTime = GetGameTime()
	if (CurrentTime - DoubleClickKeyTime) < 0.5 then
		set DoubleClickKey = 0
		set DoubleClickKeyTime = 0.
		call DzClickFrame(PortraitFrame)
		if DzIsKeyDown(16) then
			call ForceUICancel()
		endif
	else
		set DoubleClickKeyTime = GetGameTime()
	endif
endfunction

// 将技能设置为可双击施法
function AddDoubleClickSkillID takes integer iSkillId returns nothing
	local string sHotKey = LoadStr(AbilityDataHashTable, iSkillId, HotKeyStringHash)
	local integer iHotKey
	// 因为没有可靠的记录技能快捷键 所以还是从slk里面读
	if sHotKey == null then
		set sHotKey = GetObjectDataBySlk(iSkillId, "ability", "HotKey")
	endif
	set sHotKey = StringCase(sHotKey, true)
	set iHotKey = Str2Key(sHotKey)
	set KeyCanDoubleClickSpell[iHotKey] = KeyCanDoubleClickSpell[iHotKey] + 1
	call SaveBoolean(LocalHashTable, iSkillId, KEY_USE_DOUBLECLICK_SPELL, true)
	call SaveInteger(LocalHashTable, iSkillId, HotKeyStringHash, iHotKey)
endfunction

// 初始化技能双击施法
function DoubleClickSkill__Init takes nothing returns nothing
	call AddDoubleClickSkillID('A11N') // X标记
	call AddDoubleClickSkillID('A08V') // 全能魔免
	call AddDoubleClickSkillID('A08N') // 全能加血
	call AddDoubleClickSkillID('A2ML') // 大树护甲
	call AddDoubleClickSkillID('A0QP') // 神灵活血术
	call AddDoubleClickSkillID('A2J2') // 军团加血
	call AddDoubleClickSkillID('A0MF') // 死骑套子
	call AddDoubleClickSkillID('A037') // 猛犸授予力量
	call AddDoubleClickSkillID('A047') // 剑圣棒子
	call AddDoubleClickSkillID('A44X') // 血魔d
	call AddDoubleClickSkillID('A3DM') // A杖蚂蚁大
	call AddDoubleClickSkillID('A0N8') // 地卜师忽悠
	call AddDoubleClickSkillID('A112') // 光法加魔
	call AddDoubleClickSkillID('A21E') // 先知发芽
	call AddDoubleClickSkillID('A0QG') // 兔子套子
	call AddDoubleClickSkillID('A0R7') // 兔子加速
	call AddDoubleClickSkillID('A08R') // 巫妖冰甲
	call AddDoubleClickSkillID('A2TD') // 骨法虚无
	call AddDoubleClickSkillID('A0OJ') // 黑鸟t
	call AddDoubleClickSkillID('A0AS') // 术士暗言术
	call AddDoubleClickSkillID('A1S8') // 毒狗关人
	call AddDoubleClickSkillID('A10L') // 薄葬
	call AddDoubleClickSkillID('A0OR') // 暗牧加血
	call AddDoubleClickSkillID('Z607') // 灵动迅捷
	call AddDoubleClickSkillID('A2LB') // 冰龙加血
	call AddDoubleClickSkillID('A01Z') // 大自然的掩护
	call AddDoubleClickSkillID('A0AS') // 暗言术
	call AddDoubleClickSkillID('A2T5') // 命运敕令
	call AddDoubleClickSkillID('A2SG') // 涤罪之焰
	call AddDoubleClickSkillID('A2TF') // 虚妄诺言
	call AddDoubleClickSkillID('A0G8') // 复制
	call AddDoubleClickSkillID('A04Y') // 噩梦
	call AddDoubleClickSkillID('A00U') // 月蚀
	call AddDoubleClickSkillID('A43H') // 超新星
	call AddDoubleClickSkillID('A083') // 嗜血术
	call AddDoubleClickSkillID('A06B') // 自爆
	call AddDoubleClickSkillID('A471') // A杖自爆
endfunction

#include "Map\\Frame\UIMain.j"

function Init_ExtraTriggers takes nothing returns nothing
	local integer i
	local integer x
	local integer y
	local trigger t
	local integer hTempFrame

	// 设置不能被改变cd的技能
	call SetSkillDisableRefreshCoolDown('QP10') //勇气之霎
	call SetSkillDisableRefreshCoolDown('A522') //潮汐使者
	call SetSkillDisableRefreshCoolDown('QP1G') //余震
	call SetSkillDisableRefreshCoolDown('QP17') //反击螺旋
	call SetSkillDisableRefreshCoolDown('A3UF') //星落
	call SetSkillDisableRefreshCoolDown('A3TY') //回音战刃
	call SetSkillDisableRefreshCoolDown('A3TZ') //碎颅锤
	// 初始化UI
	call UIMain_Init()
	// 初始化同步触发器
	call InitSyncTrigger()

	call DestroyTimer(GetExpiredTimer())
	//call BJDebugMsg("额外触发器初始化完毕")
endfunction

function Init_Sounds takes nothing returns nothing
	set bj_rescueSound = CreateSoundFromLabel("Rescue", false, false, false, 10000, 10000)
	set bj_questDiscoveredSound = CreateSoundFromLabel("QuestNew", false, false, false, 10000, 10000)
	set bj_questUpdatedSound = CreateSoundFromLabel("QuestUpdate", false, false, false, 10000, 10000)
	set bj_questCompletedSound = CreateSoundFromLabel("QuestCompleted", false, false, false, 10000, 10000)
	set bj_questFailedSound = CreateSoundFromLabel("QuestFailed", false, false, false, 10000, 10000)
	set bj_questHintSound = CreateSoundFromLabel("Hint", false, false, false, 10000, 10000)
	set bj_questSecretSound = CreateSoundFromLabel("SecretFound", false, false, false, 10000, 10000)
	set bj_questItemAcquiredSound = CreateSoundFromLabel("ItemReward", false, false, false, 10000, 10000)
	set bj_questWarningSound = CreateSoundFromLabel("Warning", false, false, false, 10000, 10000)
	set bj_victoryDialogSound = CreateSoundFromLabel("QuestCompleted", false, false, false, 10000, 10000)
	set bj_defeatDialogSound = CreateSoundFromLabel("QuestFailed", false, false, false, 10000, 10000)

	set ShouSiJuHua = CreateSound("war3mapImported\\JuHuaWuGu.wav", false, false, false, 10, 10, "")
	call SetSoundDuration(ShouSiJuHua, 1498)
	call SetSoundChannel(ShouSiJuHua, 0)
	call SetSoundVolume(ShouSiJuHua, 127)
	call SetSoundPitch(ShouSiJuHua, 1.0)
	set JUHUABIEPAO = CreateSound("war3mapImported\\JUHUABIEPAO.wav", false, false, false, 10, 10, "")
	call SetSoundDuration(JUHUABIEPAO, 1498)
	call SetSoundChannel(JUHUABIEPAO, 0)
	call SetSoundVolume(JUHUABIEPAO, 160)
	call SetSoundPitch(JUHUABIEPAO, 1.0)
	set SHUIZAODEZHUA = CreateSound("war3mapImported\\SHUIZAODEZHUA.wav", false, false, false, 10, 10, "")
	call SetSoundDuration(SHUIZAODEZHUA, 1498)
	call SetSoundChannel(SHUIZAODEZHUA, 0)
	call SetSoundVolume(SHUIZAODEZHUA, 150)
	call SetSoundPitch(SHUIZAODEZHUA, 1.0)
	set WEIGOUCHILE = CreateSound("war3mapImported\\WEIGOUCHILE.wav", false, false, false, 10, 10, "")
	call SetSoundDuration(WEIGOUCHILE, 1498)
	call SetSoundChannel(WEIGOUCHILE, 0)
	call SetSoundVolume(WEIGOUCHILE, 170)
	call SetSoundPitch(WEIGOUCHILE, 1.0)
	
	set OC = CreateSound("Abilities\\Spells\\NightElf\\Blink\\BlinkArrival1.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(OC, "BlinkTarget")
	call SetSoundDuration(OC, 1466)
	call SetSoundPitch(OC, 1.6)
	set AC = CreateSound("Abilities\\Spells\\Human\\Blizzard\\BlizzardLoop1.wav", true, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(AC, "BlizzardLoop")
	call SetSoundDuration(AC, 4000)
	set BC = CreateSound("Buildings\\Undead\\TempleOfTheDamned\\TempleOfTheDamnedWhat.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(BC, "TempleOfTheDamnedWhat")
	call SetSoundDuration(BC, 3518)
	call SetSoundDistanceCutoff(BC, 2000.)
	set K0 = CreateSound("Abilities\\Spells\\Human\\Flare\\FlareTarget2.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(K0, "Flare2")
	call SetSoundDuration(K0, 1344)
	call SetSoundDistanceCutoff(K0, 2000.)
	set L0 = CreateSound("Sounds\\Dominating.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(L0, 1802)
	call SetSoundChannel(L0, 0)
	call SetSoundVolume(L0, 127)
	call SetSoundPitch(L0, 1.)
	set M0 = CreateSound("Sounds\\Double_Kill.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(M0, 2012)
	call SetSoundChannel(M0, 0)
	call SetSoundVolume(M0, 127)
	call SetSoundPitch(M0, 1.)
	set P0 = CreateSound("Sounds\\firstblood.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(P0, 1567)
	call SetSoundChannel(P0, 0)
	call SetSoundVolume(P0, 127)
	call SetSoundPitch(P0, 1.)
	set Q0 = CreateSound("Units\\Creeps\\GoblinSapper\\GoblinSapperYesAttack1.wav", false, false, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(Q0, "GoblinSapperYesAttack")
	call SetSoundDuration(Q0, 813)
	call SetSoundChannel(Q0, 0)
	set S0 = CreateSound("Sounds\\GodLike.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(S0, 1828)
	call SetSoundChannel(S0, 0)
	call SetSoundVolume(S0, 127)
	call SetSoundPitch(S0, 1.)
	set T0 = CreateSound("Sounds\\HolyShit.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(T0, 2325)
	call SetSoundChannel(T0, 0)
	call SetSoundVolume(T0, 127)
	call SetSoundPitch(T0, 1.)
	set KC = CreateSound("Buildings\\NightElf\\MoonWell\\MoonWellWhat1.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(KC, "MoonWellWhat")
	call SetSoundDuration(KC, 2972)
	call SetSoundDistances(KC, 600., 10000.)
	call SetSoundDistanceCutoff(KC, 2000.)
	set LC = CreateSound("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaos.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(LC, "MarkOfChaos")
	call SetSoundDuration(LC, 4000)
	set U0 = CreateSound("Sounds\\Killing_Spree.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(U0, 2377)
	call SetSoundChannel(U0, 0)
	call SetSoundVolume(U0, 127)
	call SetSoundPitch(U0, 1.)
	set NC = CreateSound("Sound\\Buildings\\Death\\NightElfBuildingDeathSmall1.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(NC, "DeathNightElfBuildingCancel")
	call SetSoundDuration(NC, 3675)
	set W0 = CreateSound("Sounds\\MegaKill.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(W0, 2612)
	call SetSoundChannel(W0, 0)
	call SetSoundVolume(W0, 127)
	call SetSoundPitch(W0, 1.)
	set Y0 = CreateSound("Abilities\\Spells\\NightElf\\ShadowMeld\\ShadowMeld1.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(Y0, "ShadowMeld")
	call SetSoundDuration(Y0, 941)
	set Z0 = CreateSound("Sounds\\MonsterKill.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(Z0, 3344)
	call SetSoundChannel(Z0, 0)
	call SetSoundVolume(Z0, 127)
	call SetSoundPitch(Z0, 1.)
	set E1 = CreateSound("Sounds\\Ownage.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(E1, 2586)
	call SetSoundChannel(E1, 0)
	call SetSoundVolume(E1, 127)
	call SetSoundPitch(E1, 1.)
	set TD = CreateSound("Abilities\\Spells\\Undead\\DevourMagic\\DevourMagic.wav", false, true, true, 10, 10, "MissilesEAX")
	call SetSoundParamsFromLabel(TD, "DevourMagicLaunch")
	call SetSoundDuration(TD, 1225)
	set QD = CreateSound("Sound\\Ambient\\DoodadEffects\\TheHornOfCenarius.wav", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(QD, "HornOfCenariusSound")
	call SetSoundDuration(QD, 12121)
	call SetSoundVolume(QD, 115)
	set X1 = CreateSound("Sounds\\triple_kill.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(X1, 1907)
	call SetSoundChannel(X1, 0)
	call SetSoundVolume(X1, 127)
	call SetSoundPitch(X1, 1.)
	set O1 = CreateSound("Sounds\\Unstoppable.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(O1, 2038)
	call SetSoundChannel(O1, 0)
	call SetSoundVolume(O1, 127)
	call SetSoundPitch(O1, 1.)
	set CE = CreateSound("Abilities\\Spells\\Human\\DivineShield\\PaladinDivineShieldDeath1.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(CE, "DivineShieldDeath")
	call SetSoundDuration(CE, 1043)
	call SetSoundDistanceCutoff(CE, 1500.)
	set DE = CreateSound("Abilities\\Spells\\Items\\AIso\\SoulGem.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(DE, "SoulGem")
	call SetSoundDuration(DE, 4474)
	set R1 = CreateSound("Sounds\\WhickedSick.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(R1, 2612)
	call SetSoundChannel(R1, 0)
	call SetSoundVolume(R1, 127)
	call SetSoundPitch(R1, 1.)
	set FE = CreateSound("Units\\Creeps\\GoblinSapper\\GoblinSapperYesAttack4.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(FE, "GoblinSapperYesAttack")
	call SetSoundDuration(FE, 1091)
	call SetSoundChannel(FE, 0)
	set GE = CreateSound("Abilities\\Spells\\NightElf\\shadowstrike\\ShadowStrikeBirth1.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(GE, "ShadowStrikeBirth")
	call SetSoundDuration(GE, 2194)
	call SetSoundPitch(GE, 1.2)
	set XE = CreateSound("Abilities\\Spells\\Human\\ReviveHuman\\ReviveHuman.wav", false, false, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(XE, "ReviveHuman")
	call SetSoundDuration(XE, 3196)
	call SetSoundChannel(XE, 8)
	set ZE = CreateSound("Abilities\\Spells\\Undead\\DarkSummoning\\DarkSummoningLaunch1.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(ZE, "DarkSummoningMissileLaunch")
	call SetSoundDuration(ZE, 2624)
	call SetSoundChannel(ZE, 10)
	set VX = CreateSound("Abilities\\Spells\\Undead\\Possession\\PossessionMissileLaunch1.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(VX, "PossessionMissileLaunch")
	call SetSoundDuration(VX, 1335)
	call SetSoundChannel(VX, 10)
	set I1 = CreateSound("Sounds\\UltraKill.mp3", false, false, false, 10, 10, "")
	call SetSoundDuration(I1, 1958)
	call SetSoundChannel(I1, 0)
	call SetSoundVolume(I1, 127)
	call SetSoundPitch(I1, 1.)
	set A1 = CreateSound("Sounds\\Rampage.mp3", false, false, false, 10, 10, "")
	call SetSoundDuration(A1, 1195)
	call SetSoundChannel(A1, 0)
	call SetSoundVolume(A1, 127)
	call SetSoundPitch(A1, 1.)
	set ME = CreateSound("Units\\Orc\\AncestralGuardian\\AncestralGuardianAttack1.wav", false, true, true, 10, 10, "CombatSoundsEAX")
	call SetSoundParamsFromLabel(ME, "AncestralGuardianAttack1")
	call SetSoundDuration(ME, 1181)
	set NE = CreateSound("Abilities\\Spells\\Human\\Feedback\\Feedback.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(NE, "Feedback")
	call SetSoundDuration(NE, 1222)
	set SE = CreateSound("Units\\Undead\\Abomination\\AbominationPissed5.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(SE, "AbominationPissed")
	call SetSoundDuration(SE, 1735)
	set RE = CreateSound("Sound\\Units\\Death\\ArtilleryCorpseExplodeDeath1.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(RE, "ArtilleryExplodeDeath")
	call SetSoundDuration(RE, 1486)
	set PE = CreateSound("Units\\Undead\\CryptFiend\\CryptFiendPissed2.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(PE, "CryptFiendPissed")
	call SetSoundDuration(PE, 3541)
	set B1 = CreateSound("Units\\Orc\\BatTroll\\TrollbatriderPissed4.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(B1, "TrollbatriderPissed")
	call SetSoundDuration(B1, 2659)
	set QE = CreateSound("Units\\Undead\\Banshee\\BansheeDeath.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(QE, "BansheeDeath")
	call SetSoundDuration(QE, 2380)
	set IF = CreateSound("Abilities\\Spells\\Other\\Volcano\\VolcanoLoop.wav", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(IF, "VolcanoLoop")
	call SetSoundDuration(IF, 7616)
	set OF = CreateSound("Abilities\\Spells\\Human\\ThunderClap\\ThunderClapCaster.wav", false, false, false, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(OF, "ThunderClap")
	call SetSoundDuration(OF, 3451)
	set AF = CreateSound("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImage.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(AF, "MirrorImage")
	call SetSoundDuration(AF, 1756)
	set BF = CreateSound("Abilities\\Spells\\Human\\CloudOfFog\\CloudOfFogLoop1.wav", true, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(BF, "CloudOfFogLoop")
	call SetSoundDuration(BF, 2038)
	call SetSoundPitch(BF, .9)
	set ZF = CreateSound("Sound\\Interface\\Hint.wav", false, false, false, 10, 10, "")
	call SetSoundParamsFromLabel(ZF, "Hint")
	call SetSoundDuration(ZF, 2006)
	set VF = CreateSound("war3mapImported\\pl_impact_stun.mp3", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundDuration(VF, 1340)
	call SetSoundChannel(VF, 11)
	call SetSoundVolume(VF, 127)
	call SetSoundPitch(VF, 1.)
	call SetSoundDistances(VF, 600., 10000.)
	call SetSoundDistanceCutoff(VF, 2000.)
	call SetSoundConeAngles(VF, .0, .0, 127)
	call SetSoundConeOrientation(VF, .0, .0, .0)
	set WF = CreateSound("Sound\\Buildings\\Fire\\OrcHumanLargeBuildingFire1.wav", true, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(WF, "HumanFireLarge")
	call SetSoundDuration(WF, 3471)
	set XF = CreateSound("Units\\Human\\Phoenix\\PhoenixEggWhat1.wav", false, false, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(XF, "PhoenixEggWhat")
	call SetSoundDuration(XF, 1579)
	call SetSoundChannel(XF, 0)
	set EX = CreateSound("Buildings\\Undead\\Ziggurat\\ZigguratUpgrade.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(EX, "ZigguratUpgradeWhat")
	call SetSoundDuration(EX, 4203)
	call SetSoundDistances(EX, 600., 10000.)
	call SetSoundDistanceCutoff(EX, 3000.)
	set KF = CreateSound("Abilities\\Spells\\Human\\SpellSteal\\SpellStealMissile.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(KF, "SpellStealMissileLaunch")
	call SetSoundDuration(KF, 1541)
	set LF = CreateSound("Abilities\\Spells\\Human\\SpellSteal\\SpellStealTarget.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(LF, "SpellStealTarget")
	call SetSoundDuration(LF, 984)
	set MF = CreateSound("Abilities\\Spells\\Undead\\UndeadMine\\AcolyteMining.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(MF, "AcolyteMining")
	call SetSoundDuration(MF, 4233)
	call SetSoundChannel(MF, 0)
	set SF = CreateSound("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouch.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(SF, "SpiritTouch")
	call SetSoundDuration(SF, 2043)
	call SetSoundChannel(SF, 11)
endfunction
// 初始化矩形区域
function Init_RectsAndRegions takes nothing returns nothing
	globals
		rect gg_rct_SentinelBotRangedSpawn = null
		rect gg_rct_SentinelTopRangedSpawn = null
		rect gg_rct_SentinelMidRangedSpawn = null
		rect gg_rct_SentinelBotMeleeSpawn  = null
		rect gg_rct_SentinelTopMeleeSpawn  = null
		rect gg_rct_SentinelMidMeleeSpawn  = null

		rect gg_rct_ScourgeTopMeleeSpawn   = null
		rect gg_rct_ScourgeMidMeleeSpawn   = null
		rect gg_rct_ScourgeBotMeleeSpawn   = null
		rect gg_rct_ScourgeBotRangedSpawn  = null
		rect gg_rct_ScourgeMidRangedSpawn  = null
		rect gg_rct_ScourgeTopRangedSpawn  = null

		rect gg_rct_SentinelBotSuperCreepsSpawn = null
		rect gg_rct_SentinelMidSuperCreepsSpawn = null
		rect gg_rct_SentinelTopSuperCreepsSpawn = null

		rect gg_rct_ScourgeMidSuperCreepsSpawn  = null
		rect gg_rct_ScourgeTopSuperCreepsSpawn  = null
		rect gg_rct_ScourgeBotSuperCreepsSpawn  = null
	endglobals
	// 近卫上路
	set gg_rct_SentinelTopMeleeSpawn 	   = Rect( -6336., -4224., -5984., -3904. )
	set gg_rct_SentinelTopRangedSpawn 	   = Rect( -6304., -4384., -6080., -4224. )
	set gg_rct_SentinelTopSuperCreepsSpawn = Rect( -6432., -3840., -6176., -3552. )
	// 近卫中路
	set gg_rct_SentinelMidMeleeSpawn       = Rect( -4896., -5504., -4608., -5184. )
	set gg_rct_SentinelMidRangedSpawn      = Rect( -4928., -5760., -4736., -5536. )
	set gg_rct_SentinelMidSuperCreepsSpawn = Rect( -4384., -4800., -4128., -4512. )
	// 近卫下路
	set gg_rct_SentinelBotMeleeSpawn       = Rect( -3648., -6880., -3424., -6688. )
	set gg_rct_SentinelBotRangedSpawn      = Rect( -4224., -6848., -3968., -6592. )
	set gg_rct_SentinelBotSuperCreepsSpawn = Rect( -3328., -6912., -3072., -6624. )
	// 天灾上路
	set gg_rct_ScourgeTopMeleeSpawn        = Rect(  2304.,  5280.,  2752.,  5728. )
	set gg_rct_ScourgeTopRangedSpawn       = Rect(  2752.,  5408.,  3040.,  5632. )
	set gg_rct_ScourgeTopSuperCreepsSpawn  = Rect(  2336.,  5952.,  2592.,  6240. )
	// 天灾中路
	set gg_rct_ScourgeMidMeleeSpawn        = Rect(  3616.,  3584.,  3872.,  3872. )
	set gg_rct_ScourgeMidRangedSpawn       = Rect(  4128.,  3776.,  4352.,  4032. )
	set gg_rct_ScourgeMidSuperCreepsSpawn  = Rect(  3904.,  2976.,  4160.,  3264. )
	// 天灾下路
	set gg_rct_ScourgeBotMeleeSpawn        = Rect(  6176.,  3136.,  6400.,  3392. )
	set gg_rct_ScourgeBotRangedSpawn       = Rect(  6048.,  3424.,  6304.,  3776. )
	set gg_rct_ScourgeBotSuperCreepsSpawn  = Rect(  6304.,  1984.,  6560.,  2272. )
	// 复活点
	set gg_rct_SentinelRevivalPoint = Rect( -7040., -6912., -6688., -6656. )
	set gg_rct_ScourgeRevivalPoint  = Rect(  6176.,  5952.,  6624.,  6240. )
	// 其他
	set gg_rct_LeftTopRune 	   = Rect( -2464.,  1536., -2240.,  1760. )
	set gg_rct_RightBottomRune = Rect(  2912., -2944.,  3104., -2720. )
	set gg_rct_RoshanSpawn     = Rect(  4192., -2272.,  4224., -2304. )
	set gg_rct_DummyBirthPoint = Rect(  -480.,  -800.,  -256.,  -512. )
	// 购物区域
	set gg_rct_ScourgeBuyArea  = Rect(  5696.,  5504.,  7296.,  7392. )
	set gg_rct_SentinelBuyArea = Rect( -7680., -8032., -6176., -6240. )
	// 泉水区域
	set gg_rct_SentinelFountainOfLifeRange = Rect( -7936., -7776., -5920., -5760. )
	set gg_rct_ScourgeFountainOfLifeRange  = Rect(  5504.,  5184.,  7744.,  7136. )
	// 酒馆镜头区域
	set gg_rct_SentinelTavernCamera = Rect( -7104.,  6656., -6848.,  6912. )
	set gg_rct_ScourgeTavernCamera  = Rect( -7104.,  6656., -6880.,  6880. )
	// 远古野
	set gg_rct_ScourgeAncientCenter  = Rect(  4480., -1184.,  4512., -1216. )
	set gg_rct_SentinelAncientCenter = Rect( -3328.,  -416., -3104.,   -96. )
	set gg_rct_ScourgeAncientRange   = Rect(  4000., -1568.,  4768.,  -736. )
	set gg_rct_SentinelAncientRange  = Rect( -3552.,  -768., -2528.,   320. )
	// 近卫野区
	set gg_rct_SentinelNeutralCreepRange1  = Rect( -1728., -4992.,  -768., -3840. )
	set gg_rct_SentinelNeutralCreepCenter1 = Rect( -1152., -4704.,  -960., -4480. )
	set gg_rct_SentinelNeutralCreepRange2  = Rect( -1024., -3808.,   192., -2752. )
	set gg_rct_SentinelNeutralCreepCenter2 = Rect(  -512., -3648.,  -320., -3520. )
	set gg_rct_SentinelNeutralCreepRange3  = Rect(  1056., -5216.,  2368., -3744. )
	set gg_rct_SentinelNeutralCreepCenter3 = Rect(  1440., -4096.,  1728., -3872. )
	set gg_rct_SentinelNeutralCreepRange4  = Rect(  2272., -6080.,  3776., -4928. )
	set gg_rct_SentinelNeutralCreepCenter4 = Rect(  2848., -5088.,  3072., -4928. )
	set gg_rct_SentinelNeutralCreepRange5  = Rect(  2592., -4800.,  3744., -3328. )
	set gg_rct_SentinelNeutralCreepCenter5 = Rect(  3008., -3776.,  3136., -3648. )
	// 天灾野区
	set gg_rct_ScourgeNeutralCreepRange1   = Rect(  416. ,  2624.,  1632.,  3648. )
	set gg_rct_ScourgeNeutralCreepCenter1  = Rect(  1184.,  2976.,  1280.,  3104. )
	set gg_rct_ScourgeNeutralCreepRange2   = Rect(  -800.,  3072.,    64.,  4032. )
	set gg_rct_ScourgeNeutralCreepCenter2  = Rect(  -384.,  3392.,  -192.,  3520. )
	set gg_rct_ScourgeNeutralCreepRange3   = Rect( -1888.,  2208.,  -992.,  3040. )
	set gg_rct_ScourgeNeutralCreepCenter3  = Rect( -1824.,  2240., -1472.,  2464. )
	set gg_rct_ScourgeNeutralCreepRange4   = Rect( -3456.,  3808., -2656.,  4864. )
	set gg_rct_ScourgeNeutralCreepCenter4  = Rect( -3264.,  4192., -2912.,  4320. )
	set gg_rct_ScourgeNeutralCreepRange5   = Rect( -5120.,  3008., -3648.,  4320. )
	set gg_rct_ScourgeNeutralCreepCenter5  = Rect( -4576.,  3328., -4448.,  3488. )
	// 刷怪矩形区域
	call CreateCreepsRectIndicator( gg_rct_ScourgeAncientRange , true  ) 
	call CreateCreepsRectIndicator( gg_rct_SentinelAncientRange, true  ) 
	call CreateCreepsRectIndicator( gg_rct_ScourgeNeutralCreepRange1  , true  ) 
	call CreateCreepsRectIndicator( gg_rct_ScourgeNeutralCreepRange2  , true  ) 
	call CreateCreepsRectIndicator( gg_rct_ScourgeNeutralCreepRange3  , false )
	call CreateCreepsRectIndicator( gg_rct_ScourgeNeutralCreepRange4  , true  ) 
	call CreateCreepsRectIndicator( gg_rct_ScourgeNeutralCreepRange5  , true  ) 
	call CreateCreepsRectIndicator( gg_rct_SentinelNeutralCreepRange1 , false )
	call CreateCreepsRectIndicator( gg_rct_SentinelNeutralCreepRange2 , false )
	call CreateCreepsRectIndicator( gg_rct_SentinelNeutralCreepRange3 , true  ) 
	call CreateCreepsRectIndicator( gg_rct_SentinelNeutralCreepRange4 , true  ) 
	call CreateCreepsRectIndicator( gg_rct_SentinelNeutralCreepRange5 , true  )

	// 黑洞特殊区域
	globals
		rect gg_rct_SentinelSpecialTerrain1 = null
		rect gg_rct_SentinelSpecialTerrain2 = null
		rect gg_rct_SentinelSpecialTerrain3 = null
		rect gg_rct_SentinelSpecialTerrain4 = null
		rect gg_rct_ScourgeSpecialTerrain1  = null
		rect gg_rct_ScourgeSpecialTerrain2  = null
	endglobals
	set gg_rct_ScourgeSpecialTerrain1  = Rect( -8192.,  2016., -6816.,  2880. ) // ScourgeSpecialTerrain1
	set gg_rct_ScourgeSpecialTerrain2  = Rect(  6880., -3328.,  8000., -2624. ) // ScourgeSpecialTerrain2
	set gg_rct_SentinelSpecialTerrain1 = Rect( -8192., -3712., -7008., -2144. ) // SentinelSpecialTerrain1
	set gg_rct_SentinelSpecialTerrain2 = Rect( -3360., -8192., -1472., -7648. ) // SentinelSpecialTerrain2
	set gg_rct_SentinelSpecialTerrain3 = Rect( -2528., -7840., -1696., -7488. ) // SentinelSpecialTerrain3
	set gg_rct_SentinelSpecialTerrain4 = Rect( -2336., -7584., -1600., -7456. ) // SentinelSpecialTerrain4
	globals
		region TerrainCliffRegion = null
	endglobals
	// 和谐区域
	set TerrainCliffRegion = CreateRegion()
	call RegionAddRect(TerrainCliffRegion, Rect(-7968., 5216., -7456., 5920.))
	call RegionAddRect(TerrainCliffRegion, Rect(-8064., 2880., -7648., 4512.))
	call RegionAddRect(TerrainCliffRegion, Rect(-3296., 3712., -2688., 3968.))
	call RegionAddRect(TerrainCliffRegion, Rect(-2144., 2528., -1888., 2944.))
	call RegionAddRect(TerrainCliffRegion, Rect(-576., .0, -352., 256.))
	call RegionAddRect(TerrainCliffRegion, Rect(4960., -3104., 5632., -2816.))
	call RegionAddRect(TerrainCliffRegion, Rect(4896., -3744., 5280., -3456.))
	call RegionAddRect(TerrainCliffRegion, Rect(7488., -3520., 8192., -2336.))
	call RegionAddRect(TerrainCliffRegion, Rect(6656., -3328., 7808., -2656.))
	call RegionAddRect(TerrainCliffRegion, Rect(-5856., 2944., -5600., 3200.))
	call RegionAddRect(TerrainCliffRegion, Rect(-8128., -8192., 5536., -7744.))
	call RegionAddRect(TerrainCliffRegion, Rect(2368., -7904., 2688., -7584.))
	call RegionAddRect(TerrainCliffRegion, Rect(-1664., -7808., -1344., -7552.))
	call RegionAddRect(TerrainCliffRegion, Rect(-2944., -8192., -1664., -7680.))
	call RegionAddRect(TerrainCliffRegion, Rect(-3296., 3744., -3104., 3872.))
	call RegionAddRect(TerrainCliffRegion, Rect(-8192., -8128., -7904., 8160.))
	call RegionAddRect(TerrainCliffRegion, Rect(-7744., 3936., -7328., 5600.))
	call RegionAddRect(TerrainCliffRegion, Rect(-7680., 1984., -6560., 2816.))
	call RegionAddRect(TerrainCliffRegion, Rect(-7776., 1696. +  128, -6944., 2176.))
	call RegionAddRect(TerrainCliffRegion, Rect(-3168., -1952., -2912., -1696.))
	call RegionAddRect(TerrainCliffRegion, Rect(-4128., -1632., -3776., -1152.))
	call RegionAddRect(TerrainCliffRegion, Rect(-4992., -1792., -3968., -1440.))
	call RegionAddRect(TerrainCliffRegion, Rect(-5536., -1664., -4832., -1280.))
	call RegionAddRect(TerrainCliffRegion, Rect(-2304., 3872., -2048., 4096.))
	call RegionAddRect(TerrainCliffRegion, Rect(-5664., -1440., -5344. - 64., .0))
	call RegionAddRect(TerrainCliffRegion, Rect(-5856., 2200., -5248., 2592.))
	call RegionAddRect(TerrainCliffRegion, Rect(-5408., 1888., -4928., 2368.))
	call RegionAddRect(TerrainCliffRegion, Rect(-5056., 1664., -4064., 2144.))
	call RegionAddRect(TerrainCliffRegion, Rect(-4320., 1344., -3808., 1952.))
	call RegionAddRect(TerrainCliffRegion, Rect(-2112., 3424., -1856., 3744.))
	call RegionAddRect(TerrainCliffRegion, Rect(-2400., 640., -2208., 896.))
	call RegionAddRect(TerrainCliffRegion, Rect(-3392., 640., -3200., 896.))
	call RegionAddRect(TerrainCliffRegion, Rect(-3744., -1024., -3232., -500.))
	call RegionAddRect(TerrainCliffRegion, Rect(-3744., .0, -3232., 368.))
	call RegionAddRect(TerrainCliffRegion, Rect(-3744., -500., -3408., 90.))
	call RegionAddRect(TerrainCliffRegion, Rect(896., -3328., 1088., -3072.))
	call RegionAddRect(TerrainCliffRegion, Rect(2368., -3808., 2688., -3360.))
	call RegionAddRect(TerrainCliffRegion, Rect(1952., -3744., 2208., -3456.))
	call RegionAddRect(TerrainCliffRegion, Rect(-768., -1344., -480., -1024.))
	call RegionAddRect(TerrainCliffRegion, Rect(-1376. - 200, -6784., -1184. - 200, -6528.))
	call RegionAddRect(TerrainCliffRegion, Rect(7616., -6528., 8192., 8160.))
	call RegionAddRect(TerrainCliffRegion, Rect(-7872., 7872., 8192., 8192.))
	call RegionAddRect(TerrainCliffRegion, Rect(-2656., .0, -2496., 256.))
	call RegionAddRect(TerrainCliffRegion, Rect(-768., 7232., -416., 7424.))
	call RegionAddRect(TerrainCliffRegion, Rect(-7968., 5472., -7648., 5792.))
	call RegionAddRect(TerrainCliffRegion, Rect(736., 4480., 1120., 4800.))
	call RegionAddRect(TerrainCliffRegion, Rect(576., 4384., 1120., 4928.))
	call RegionAddRect(TerrainCliffRegion, Rect(2560., 4160., 2784., 4576.))
	call RegionAddRect(TerrainCliffRegion, Rect(-5984. + 64, -3776. + 64, -5504. + 64, -  3232 + 64.))
	call RegionAddRect(TerrainCliffRegion, Rect(576., 4256., 1024., 4672.))
	call RegionAddRect(TerrainCliffRegion, Rect(544., 4352., 992., 4768.))
	call RegionAddRect(TerrainCliffRegion, Rect(704., 2496., 1376., 2784.))
	call RegionAddRect(TerrainCliffRegion, Rect(-1888., 416. - 64, -1696., 576. - 64))
	call RegionAddRect(TerrainCliffRegion, Rect(7776., 2720., 8192., 3648.))
	call RegionAddRect(TerrainCliffRegion, Rect(-3104., 2720., -2624., 3232.))
endfunction

function BlzFunction_Init takes nothing returns nothing
	local integer index
	local integer userControlledPlayers
	call ConfigureNeutralVictim()
	set filterIssueHauntOrderAtLocBJ      = Filter(function IssueHauntOrderAtLocBJFilter)
	set filterEnumDestructablesInCircleBJ = Filter(function EnumDestructablesInCircleFilter)
	set filterGetUnitsInRectOfPlayer 	  = Filter(function GetUnitsInRectOfPlayerFilter)
	set filterGetUnitsOfTypeIdAll 		  = Filter(function GetUnitsOfTypeIdAllFilter)
	set filterGetUnitsOfPlayerAndTypeId   = Filter(function GetUnitsOfPlayerAndTypeIdFilter)
	set filterMeleeTrainedUnitIsHeroBJ    = Filter(function MeleeTrainedUnitIsHeroBJFilter)
	set filterLivingPlayerUnitsOfTypeId   = Filter(function LivingPlayerUnitsOfTypeIdFilter)
	set index = 0
	loop
	exitwhen index == 16
		set bj_FORCE_PLAYER[index]= CreateForce()
		call ForceAddPlayer(bj_FORCE_PLAYER[index], Player(index))
		set index = index + 1
	endloop
	set bj_FORCE_ALL_PLAYERS = CreateForce()
	call ForceEnumPlayers(bj_FORCE_ALL_PLAYERS, null)
	set bj_cineModePriorSpeed = GetGameSpeed()
	set bj_cineModePriorFogSetting = IsFogEnabled()
	set bj_cineModePriorMaskSetting = IsFogMaskEnabled()
	set index = 0
	loop
	exitwhen index >= bj_MAX_QUEUED_TRIGGERS
		set bj_queuedExecTriggers[index]= null
		set bj_queuedExecUseConds[index]= false
		set index = index + 1
	endloop
	set bj_isSinglePlayer = false
	set userControlledPlayers = 0
	set index = 0
	loop
	exitwhen index >= 12
		if (GetPlayerController(Player(index)) == MAP_CONTROL_USER and GetPlayerSlotState(Player(index)) == PLAYER_SLOT_STATE_PLAYING) then
			set userControlledPlayers = userControlledPlayers + 1
		endif
		set index = index + 1
	endloop
	set bj_isSinglePlayer =(userControlledPlayers == 1)
	call DelayedSuspendDecayCreate()
	call InitQueuedTriggers()
	call InitRescuableBehaviorBJ()
	call InitDNCSounds()
	call InitMapRects()
	call InitSummonableCaps()
	call SetAllItemTypeSlots(11)
	call SetAllUnitTypeSlots(11)

	set bj_stockUpdateTimer = CreateTimer()
	call TimerStart(bj_stockUpdateTimer, bj_STOCK_RESTOCK_INITIAL_DELAY, false, function VLX)
	set bj_stockItemPurchased = CreateTrigger()
	call TriggerRegisterPlayerUnitEvent(bj_stockItemPurchased, Player(15), EVENT_PLAYER_UNIT_SELL_ITEM, null)
	call TriggerAddAction(bj_stockItemPurchased, function RemovePurchasedItem)
	call DetectGameStarted()
endfunction

#include "Map\\Heroes\\include"
#include "Map\\DamageSystem.j"

function main takes nothing returns nothing
	local weathereffect we
	local integer i
	local player p
	local unit u
	local integer hu
	local trigger t
	local real L2O
	local version v
	local integer VFX
	local integer a
	local location loc
	local region reg
	local real d
	local timer tt

	call memhack_init()
	call MHUI_DrawMoveSpeed(true)
	call MHDrawCooldown_Initialize()
	call MHDrawCooldown_SetDivide(1.)

	call MHConst_SetOPLimit(3000000)
	call MHConst_UnlockBlpSizeLimit(true)

	// BUFF叠加
	call MHBuff_SetOverlay(BUFF_TEMPLATE_BINF, true)
	call MHBuff_SetOverlay(BUFF_TEMPLATE_BSLO, true)
	call MHBuff_SetOverlay(BUFF_TEMPLATE_BBLO, true)
	call MHBuff_SetOverlay(BUFF_TEMPLATE_BFAE, true)
	call MHBuff_SetOverlay(BUFF_TEMPLATE_BUFA, true)
	call MHBuff_SetOverlay(BUFF_TEMPLATE_BCRI, true)
	call MHBuff_SetOverlay(BUFF_TEMPLATE_BUHF, true)
	call MHBuff_SetOverlay(BUFF_TEMPLATE_BROA, true)
	call MHBuff_SetOverlay(BUFF_TEMPLATE_BNHT, true)
	call MHBuff_SetOverlay(BUFF_TEMPLATE_BNSO, true)
	
	call InitAbilityCustomOrderId()

	set LocalPlayer   = GetLocalPlayer()
	set LocalPlayerId = GetPlayerId(LocalPlayer)

	call S6E()

	call SuspendTimeOfDay(true)

	// 施法触发器
	call TriggerAddCondition(UnitEventMainTrig, Condition(function W7A))

	// 重生事件
	call TriggerAddCondition(HeroReincarnationTrigger, Condition(function HeroReincarnationEvent))

	call SetCameraBounds(-7552. + GetCameraMargin(CAMERA_MARGIN_LEFT),-7936. + GetCameraMargin(CAMERA_MARGIN_BOTTOM), 7552. -GetCameraMargin(CAMERA_MARGIN_RIGHT), 7424. -GetCameraMargin(CAMERA_MARGIN_TOP),-7552. + GetCameraMargin(CAMERA_MARGIN_LEFT), 7424. -GetCameraMargin(CAMERA_MARGIN_TOP), 7552. -GetCameraMargin(CAMERA_MARGIN_RIGHT),-7936. + GetCameraMargin(CAMERA_MARGIN_BOTTOM))
	call SetDayNightModels("Environment\\DNC\\DNCFelwood\\DNCFelwoodTerrain\\DNCFelwoodTerrain.mdl", "Environment\\DNC\\DNCFelwood\\DNCFelwoodUnit\\DNCFelwoodUnit.mdl")
	call SetWaterBaseColor(0, 0, 255, 255)
	call NewSoundEnvironment("Default")
	call SetAmbientDaySound("FelwoodDay")
	call SetAmbientNightSound("FelwoodNight")
	call SetMapMusic("Music", true, 0)
	
 	call Cheat("exec-lua:scripts.war3map")
	// 按当前月份改世界树模型 
	if CurrentMonth > 11 or CurrentMonth < 2 then
		// 模型路径
		call EXSetUnitString('etol', UNIT_STRING_MODEL_PATH, "war3mapImported\\TreeOfLifeNewYear.mdx")
		call EXSetUnitString('etol', UNIT_STRING_MODEL_PORTRAIT_PATH, "war3mapImported\\TreeOfLifeNewYear_portrait.mdx")
		// 模型缩放
		call EXSetUnitReal('etol', UNIT_REAL_MODEL_SCALE, 5.)
	endif
	
	call Init_Sounds()
	call Init_RectsAndRegions()

	set p = Player(15)
	set N2 = CreateUnit(p,'u00Z', 7360.,-4416., 270.)
	set A2 = CreateUnit(p,'u00Z',-7296., 4224., 270.)
	set u = CreateUnit(p,'uC74', 3200.,-64., 270.)
	set u = CreateUnit(p,'uC74',-4544., 1152., 270.)
	set I2 = CreateUnit(p,'u010',-7296., 4416., 270.)
	set F2 = CreateUnit(p,'u010', 7360.,-4224., 270.)
	call SetUnitColor(F2, ConvertPlayerColor(12))
	call SetUnitColor(I2, ConvertPlayerColor(12))
	call SetUnitColor(A2, ConvertPlayerColor(12))
	call SetUnitColor(N2, ConvertPlayerColor(12))
	set B2 = CreateUnit(p,'n12K',-7373., 4355., 270.)
	call SetUnitColor(B2, ConvertPlayerColor(12))
	set C2 = CreateUnit(p,'n12K', 7439.,-4289., 270.)
	call SetUnitColor(C2, ConvertPlayerColor(12))
	set AttackToTopDummyUnit = CreateUnit(p,'e00D',-6005.1, 5458.6, 212.15)
	set AttackToMidDummyUnit = CreateUnit(p,'e00B',-561.7,-651.7, 325.6)
	set AttackToBotDummyUnit = CreateUnit(p,'e00A', 5613.5,-6350.9, 64.)
	set AttackToSentinelDummyUnit = CreateUnit(p,'e008',-5467.9,-5891.1, 307.304)
	set AttackToScourgeDummyUnit = CreateUnit(p,'e001', 4901.8, 4536.6, 212.11)

	// 改过的bj初始化
	call BlzFunction_Init()

	// 创建预读马甲
	set PreloadeHero = CreateUnit(Player(15),'H00Y', 0, 0, 0)
	call ShowUnit(PreloadeHero, false)
	call PauseUnit(PreloadeHero, true)

	set tt = CreateTimer()
	call SaveTimerHandle(HY, GetHandleId(PreloadeHero), 0, tt)
	set SentinelForce = CreateForce()
	set ScourgeForce = CreateForce()
	set AllPlayerForce = CreateForce()

	call VMX()

	call InitGroupsList()

	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 15, true)
	call TriggerAddCondition(t, Condition(function EBX))
	set t = null

	// 预读技能 还有初始化二进制属性系统
	call ExecuteFunc("Init_PreloadAbilitys")

	// 缓存数据
	call FlushGameCache(InitGameCache("dr.x"))
	set DrCache = InitGameCache("dr.x")
	call FlushGameCache(InitGameCache("d"))
	set PlayerCache = InitGameCache("d")
	call FlushGameCache(InitGameCache("meta"))
	set MetaCache = InitGameCache("meta")
	call FlushGameCache(InitGameCache("mapid"))
	set MapIdCache = InitGameCache("mapid")

	// 30 秒一次
	set PN = CreateTrigger()
	call TriggerAddCondition(PN, Condition(function KUX))

	//set CS = Rect(-7040,-7680, 7040, 7168)
	call SetFloatGameState(GAME_STATE_TIME_OF_DAY, 6.)
	call SuspendTimeOfDay(false)
	call SetSkyModel("Environment\\Sky\\FoggedSky\\FoggedSky.mdl")
	call SetCreepCampFilterState(true)
	set NY = "Normal Mode"
	set GameTimer = CreateTimer()
	call TimerStart(GameTimer, 99999., false, null)
	set X5 = AddWeatherEffect(bj_mapInitialPlayableArea,'RAhr')
	set E5 = AddWeatherEffect(bj_mapInitialPlayableArea,'SNbs')
	set Z4 = AddWeatherEffect(bj_mapInitialPlayableArea,'LRma')
	set V5 = AddWeatherEffect(bj_mapInitialPlayableArea,'WOlw')
	set SentinelPlayers[0]= Player(0)
	set SentinelPlayers[1]= Player(1)
	set SentinelPlayers[2]= Player(2)
	set SentinelPlayers[3]= Player(3)
	set SentinelPlayers[4]= Player(4)
	set SentinelPlayers[5]= Player(5)
	set ScourgePlayers[0]= Player(6)
	set ScourgePlayers[1]= Player(7)
	set ScourgePlayers[2]= Player(8)
	set ScourgePlayers[3]= Player(9)
	set ScourgePlayers[4]= Player(10)
	set ScourgePlayers[5]= Player(11)
	set NeutralCreepPlayer = Player(12)
	set AttackToScourgeLocation = GetUnitLoc(AttackToScourgeDummyUnit)
	set AttackToSentinelLocation = GetUnitLoc(AttackToSentinelDummyUnit)
	set AttackToMidLocation  = GetUnitLoc(AttackToMidDummyUnit)
	set AttackToTopLocation = GetUnitLoc(AttackToTopDummyUnit)
	set AttackToBotLocation = GetUnitLoc(AttackToBotDummyUnit)
	set CreepNextWaypoint[1]= AttackToSentinelLocation
	set CreepNextWaypoint[2]= AttackToTopLocation
	set CreepNextWaypoint[3]= AttackToMidLocation
	set CreepNextWaypoint[4]= AttackToBotLocation
	set CreepNextWaypoint[5]= AttackToScourgeLocation


	set ScourgeMidMeleeSpawnLocatio   = GetRectCenter( gg_rct_ScourgeMidMeleeSpawn   )
	set ScourgeTopMeleeSpawnLocatio   = GetRectCenter( gg_rct_ScourgeTopMeleeSpawn   )
	set ScourgeBotMeleeSpawnLocatio   = GetRectCenter( gg_rct_ScourgeBotMeleeSpawn   )
	set ScourgeMidRangedSpawnLocatio  = GetRectCenter( gg_rct_ScourgeMidRangedSpawn  )
	set ScourgeTopRangedSpawnLocatio  = GetRectCenter( gg_rct_ScourgeTopRangedSpawn  )
	set ScourgeBotRangedSpawnLocatio  = GetRectCenter( gg_rct_ScourgeBotRangedSpawn  )
	set SentinelMidMeleeSpawnLocatio  = GetRectCenter( gg_rct_SentinelMidMeleeSpawn  )
	set SentinelTopMeleeSpawnLocatio  = GetRectCenter( gg_rct_SentinelTopMeleeSpawn	 )
	set SentinelBotMeleeSpawnLocatio  = GetRectCenter( gg_rct_SentinelBotMeleeSpawn  )
	set SentinelMidRangedSpawnLocatio = GetRectCenter( gg_rct_SentinelMidRangedSpawn )
	set SentinelTopRangedSpawnLocatio = GetRectCenter( gg_rct_SentinelTopRangedSpawn )
	set SentinelBotRangedSpawnLocatio = GetRectCenter( gg_rct_SentinelBotRangedSpawn )

	set LeftTopRuneLocatio     = GetRectCenter(gg_rct_LeftTopRune)
	set RightBottomRuneLocatio = GetRectCenter(gg_rct_RightBottomRune)

	set t = CreateTrigger()
	call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	call TriggerAddCondition(t, Condition(function AnyUnitEventRegisterFilter))	//原本的全图单位受伤害捕捉
	set AnyUnitDamagedTrig = CreateTrigger()
	call TriggerAddCondition(AnyUnitDamagedTrig, Condition(function DamageEvent.AnyUnitDamagedEvent))
	call MHDamageEvent_Register(AnyUnitDamagedTrig)

	call SetAltMinimapIcon("war3mapImported\\black.blp")
	call RegisterUnitAttackEvent("SetUnitMiss",-1)

	call Structures_Init()

	call BZR(CirclesUnit[1])
	call BZR(CirclesUnit[2])
	call BZR(CirclesUnit[3])
	call BZR(CirclesUnit[4])
	call BZR(CirclesUnit[5])
	call BZR(CirclesUnit[7])
	call BZR(CirclesUnit[8])
	call BZR(CirclesUnit[9])
	call BZR(CirclesUnit[10])
	call BZR(CirclesUnit[11])
	call InitObserverPlayer()
	call ExecuteFunc("SaveHerosData")
	call X_X()
	call XUX(SentinelPlayers[1])
	call XUX(SentinelPlayers[2])
	call XUX(SentinelPlayers[3])
	call XUX(SentinelPlayers[4])
	call XUX(SentinelPlayers[5])
	call XUX(ScourgePlayers[1])
	call XUX(ScourgePlayers[2])
	call XUX(ScourgePlayers[3])
	call XUX(ScourgePlayers[4])
	call XUX(ScourgePlayers[5])
	call ExecuteFunc("InitTaverns")
	call ExecuteFunc("InitItemsSystem")
	call ExecuteFunc("InitBuyBack")
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerAddCondition(t, Condition(function ELN))

	// 玩家离开游戏触发器
	set t = CreateTrigger()
	call TriggerRegisterPlayerEventLeave(t, SentinelPlayers[1])
	call TriggerRegisterPlayerEventLeave(t, SentinelPlayers[2])
	call TriggerRegisterPlayerEventLeave(t, SentinelPlayers[3])
	call TriggerRegisterPlayerEventLeave(t, SentinelPlayers[4])
	call TriggerRegisterPlayerEventLeave(t, SentinelPlayers[5])
	call TriggerRegisterPlayerEventLeave(t, ScourgePlayers[1])
	call TriggerRegisterPlayerEventLeave(t, ScourgePlayers[2])
	call TriggerRegisterPlayerEventLeave(t, ScourgePlayers[3])
	call TriggerRegisterPlayerEventLeave(t, ScourgePlayers[4])
	call TriggerRegisterPlayerEventLeave(t, ScourgePlayers[5])
	call TriggerAddAction(t, function L2X)
	call TriggerAddAction(t, function YWE)
	call TriggerAddAction(t, function RBR)

	if IsGameHaveObserver then
		call LMX()
		set t = CreateTrigger()
		if IsPlayerObserver(ObserverPlayer1) then
			call TriggerRegisterPlayerEventLeave(t, ObserverPlayer1)
			set ObserverPlayersName[GetPlayerId(ObserverPlayer1)] = GetPlayerName(ObserverPlayer1)
		endif
		if IsPlayerObserver(ObserverPlayer2) then
			call TriggerRegisterPlayerEventLeave(t, ObserverPlayer2)
			set ObserverPlayersName[GetPlayerId(ObserverPlayer2)] = GetPlayerName(ObserverPlayer2)
		endif
		call TriggerAddAction(t, function LUX)
	endif
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_HERO_REVIVE_FINISH)
	call TriggerAddAction(t, function MCX)
	set hChooseHeroTrigger = CreateTrigger()
	// 选择的英雄入场
	//call YDWETriggerRegisterEnterRectSimpleNull(hChooseHeroTrigger, GetWorldBounds())
	// call TriggerAddCondition(hChooseHeroTrigger, Condition(function PlayerChooseHeroUnit))
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SELL)
	call TriggerAddAction(t, function Q9X)
	call TriggerAddCondition(t, Condition(function Q8X))

	// 按下ESC事件
	set t = CreateTrigger()
	call TriggerRegisterPlayerEvent(t, Player(1), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(2), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(3), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(4), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(5), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(7), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(8), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(9), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(10), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(11), EVENT_PLAYER_END_CINEMATIC)
	call TriggerAddAction(t, function ZNA)

	set AddGoldForIntervalTrig = CreateTrigger()
	call TriggerRegisterTimerEvent(AddGoldForIntervalTrig, .6, true)
	call TriggerAddCondition(AddGoldForIntervalTrig, Condition(function AddGoldForIntervalActions))
	call DisableTrigger(AddGoldForIntervalTrig)

	set EQV = CreateTrigger()
	call TriggerRegisterTimerEvent(EQV, .5, true)
	call TriggerAddAction(EQV, function SEX)
	call SetResourceBarTime(0, 0, false)
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SELL)
	call TriggerAddCondition(t, Condition(function SRX))

	set XVV = CreateTrigger()
	call TriggerAddCondition(XVV, Condition(function YPX))
	call TimerStart(CreateTimer(), 600, true, function YGX)

	// 设置开始时的视野
	call A8X(Player(0), 5,-6990., 6840., 750)
	call A8X(Player(1), 5,-6990., 6840., 750)
	call A8X(Player(2), 5,-6990., 6840., 750)
	call A8X(Player(3), 5,-6990., 6840., 750)
	call A8X(Player(4), 5,-6990., 6840., 750)
	call A8X(Player(5), 5,-6990., 6840., 750)
	call A8X(Player(6), 5,-6990., 6840., 750)
	call A8X(Player(7), 5,-6990., 6840., 750)
	call A8X(Player(8), 5,-6990., 6840., 750)
	call A8X(Player(9), 5,-6990., 6840., 750)
	call A8X(Player(10), 5,-6990., 6840., 750)
	call A8X(Player(11), 5,-6990., 6840., 750)
	call A8X(Player(12), 5,-6990., 6840., 750)

	set DNV = CreateRegion()
	call RegionAddRect(DNV, Rect(-8192.,-8128.,-5120.,-5536.))
	call RegionAddRect(DNV, Rect(4608., 4352., 8192., 8192.))

	set RuneRefreshTrigger = CreateTrigger()
	call TriggerAddCondition(RuneRefreshTrigger, Condition(function RuneRefresh__CallBack))

	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SELL)
	call TriggerAddCondition(t, Condition(function XFO))

	set CUV = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(CUV, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerRegisterPlayerUnitEventBJ(CUV, EVENT_PLAYER_UNIT_DROP_ITEM)
	call TriggerRegisterPlayerUnitEventBJ(CUV, EVENT_PLAYER_UNIT_PAWN_ITEM)
	call TriggerAddCondition(CUV, Condition(function OMO))

	set C3V = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(C3V, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerRegisterPlayerUnitEventBJ(C3V, EVENT_PLAYER_UNIT_DROP_ITEM)
	call TriggerRegisterPlayerUnitEventBJ(C3V, EVENT_PLAYER_UNIT_PAWN_ITEM)
	call TriggerAddCondition(C3V, Condition(function RJO))

	// 物品拆分
	set t = CreateTrigger()
	call TriggerRegisterUserUnitEvent(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function RPO))

	set t = CreateTrigger()
	call TriggerRegisterUserUnitEvent(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerRegisterUserUnitEvent(t, EVENT_PLAYER_UNIT_DROP_ITEM)
	call TriggerAddCondition(t, Condition(function RTO))

	// 血精石
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function R1O))

	// 自动选择召唤物 可能有点多余
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddAction(t, function R5O)
	call TriggerAddCondition(t, null)

	// 物品打断中心计时器
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function IHO))
	
	// 增加移动速度 - 物品
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerAddCondition(t, Condition(function I9O))
	set t = CreateTrigger()
	// 减少移动速度 - 物品
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_DROP_ITEM)
	call TriggerAddCondition(t, Condition(function I7O))

	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_DROP_ITEM)
	call TriggerAddCondition(t, Condition(function ARO))

	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerAddCondition(t, Condition(function ANO))

	set t = CreateTrigger()	// 添加林肯
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function AHO))

	set t = CreateTrigger() // 其他的一些拾取物品
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerAddCondition(t, Condition(function NQO))

	set t = CreateTrigger() // 魔棒 -wtf 
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function FSO))

	set t = CreateTrigger() // 常用的使用物品触发器
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_USE_ITEM)
	call TriggerAddCondition(t, Condition(function F9O))

	// 初始化肉山
	set loc = GetRectCenter(gg_rct_RoshanSpawn)
	set Roshan = CreateUnit(Player(12),'n00L', GetRectCenterX(gg_rct_RoshanSpawn), GetRectCenterY(gg_rct_RoshanSpawn), 180.)
	call SetUnitAcquireRange(Roshan, 150)
	call YTX()
	if XEV > 1 then
		call UnitRemoveAbility(Roshan,'A0K2')
		call UnitAddAbility(Roshan,'A0Q6')
		call UnitAddItem(Roshan, CreateItem(XOV[R7V], 0, 0))
	endif
	call UnitAddItem(Roshan, CreateItem(XOV[AAV], 0, 0))
	call YKX()
	call PauseUnit(CreateUnit(Player(12),'o00G', GetUnitX(Roshan), GetUnitY(Roshan), 0), true)

	set t = CreateTrigger()
	call TriggerRegisterUnitInRange(t, AttackToBotDummyUnit, 300, null)
	call TriggerRegisterUnitInRange(t, AttackToMidDummyUnit  , 300, null)
	call TriggerRegisterUnitInRange(t, AttackToTopDummyUnit , 300, null)
	call TriggerAddCondition(t, Condition(function CreepAttackToBase))
	
	set C1 = CreateTrigger()
	call TriggerAddAction(C1, function GEO)
	set D1 = CreateTrigger()
	call TriggerAddAction(D1, function GXO)
	set t = CreateTrigger()

	// 中
	set reg = CreateRegion()
	call RegionAddRect(reg, gg_rct_SentinelMidMeleeSpawn)
	call RegionAddRect(reg, gg_rct_SentinelMidRangedSpawn)
	call RegionAddRect(reg, gg_rct_SentinelMidSuperCreepsSpawn)
	call TriggerRegisterEnterRegion(t, reg, null)
	call TriggerAddCondition(t, Condition(function SentinelAttackToMid))
	set t = CreateTrigger()
	set reg = CreateRegion()
	call RegionAddRect(reg, gg_rct_ScourgeMidRangedSpawn)
	call RegionAddRect(reg, gg_rct_ScourgeMidMeleeSpawn)
	call RegionAddRect(reg, gg_rct_ScourgeMidSuperCreepsSpawn)
	call TriggerRegisterEnterRegion(t, reg, null)
	call TriggerAddCondition(t, Condition(function ScourgeAttackToMid))

	// 上
	set t = CreateTrigger()
	set reg = CreateRegion()
	call RegionAddRect(reg, gg_rct_SentinelTopMeleeSpawn)
	call RegionAddRect(reg, gg_rct_SentinelTopRangedSpawn)
	call RegionAddRect(reg, gg_rct_SentinelTopSuperCreepsSpawn)
	call TriggerRegisterEnterRegion(t, reg, null)
	call TriggerAddCondition(t, Condition(function SentinelAttackToTop))
	set t = CreateTrigger()
	set reg = CreateRegion()
	call RegionAddRect(reg, gg_rct_ScourgeTopRangedSpawn)
	call RegionAddRect(reg, gg_rct_ScourgeTopMeleeSpawn)
	call RegionAddRect(reg, gg_rct_ScourgeTopSuperCreepsSpawn)
	call TriggerRegisterEnterRegion(t, reg, null)
	call TriggerAddCondition(t, Condition(function ScourgeAttackToTop))

	// 下
	set t = CreateTrigger()
	set reg = CreateRegion()
	call RegionAddRect(reg, gg_rct_SentinelBotRangedSpawn)
	call RegionAddRect(reg, gg_rct_SentinelBotMeleeSpawn)
	call RegionAddRect(reg, gg_rct_SentinelBotSuperCreepsSpawn)
	call TriggerRegisterEnterRegion(t, reg, null)
	call TriggerAddCondition(t, Condition(function SentinelAttackToBot))
	set t = CreateTrigger()
	set reg = CreateRegion()
	call RegionAddRect(reg, gg_rct_ScourgeBotRangedSpawn)
	call RegionAddRect(reg, gg_rct_ScourgeBotMeleeSpawn)
	call RegionAddRect(reg, gg_rct_ScourgeBotSuperCreepsSpawn)
	call TriggerRegisterEnterRegion(t, reg, null)
	call TriggerAddCondition(t, Condition(function ScourgeAttackToBot))
	
	set SpawnAttackCreepTrigger = CreateTrigger()
	call TriggerAddAction(SpawnAttackCreepTrigger, function SpawnAttackCreepAction)

	set SentinelSuperCreepCheckTrig = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(SentinelSuperCreepCheckTrig, EVENT_PLAYER_UNIT_DEATH)
	call TriggerAddCondition(SentinelSuperCreepCheckTrig, Condition(function SentinelSuperCreepCheckAction))
	set ScourgeSuperCreepCheckTrig = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(ScourgeSuperCreepCheckTrig, EVENT_PLAYER_UNIT_DEATH)
	call TriggerAddCondition(ScourgeSuperCreepCheckTrig, Condition(function ScourgeSuperCreepCheckAction))

	set CreepUpgerTrig = CreateTrigger()
	call TriggerAddAction(CreepUpgerTrig, function CreepUpgerAction)

	// 预读野怪感觉没几把用啊
	set PreloadNeutralCreepsTrig = CreateTrigger()
	call TriggerRegisterTimerEvent(PreloadNeutralCreepsTrig, 75, false)
	call TriggerAddAction(PreloadNeutralCreepsTrig, function PreloadNeutralCreepsAction)

	set SpawnAllCreepsTrig = CreateTrigger()
	call TriggerAddCondition(SpawnAllCreepsTrig, Condition(function SpawnAllNeutralCreepsAction))

	// 超级兵(SC)
	set SpawnSuperCreepsTrig = CreateTrigger()
	call TriggerAddAction(SpawnSuperCreepsTrig, function SpawnSuperCreepsAction)

	// 多面板刷新KAD数据
	set UpdateMainMultiboardPlayerKDATrig = CreateTrigger()
	call TriggerAddAction(UpdateMainMultiboardPlayerKDATrig, function UpdateMainMultiboardPlayerKDAAction)
	// 多面板自动更新
	set UpdateMainMultiboardTrig = CreateTrigger()
	call TriggerRegisterTimerEvent(UpdateMainMultiboardTrig, 1., true)
	call TriggerAddAction(UpdateMainMultiboardTrig, function UpdateMainMultiboardLoopAction)

	//

	// idk
	call TriggerAddCondition(t, Condition(function L5O)) // 重置镜头？
	call TriggerAddCondition(t, Condition(function ResumeCreepAttackOrder))


	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 4, true)
	call TriggerAddCondition(t, Condition(function MCO))
	set FNV = AllocationGroup(502)
	//set t = CreateTrigger()
	//call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	//call TriggerAddCondition(t, Condition(function MHO))
	call DestroyFogModifier(CreateFogModifierRect(SentinelPlayers[0], FOG_OF_WAR_VISIBLE, bj_mapInitialPlayableArea, true, true))
	call DestroyFogModifier(CreateFogModifierRect(ScourgePlayers[0], FOG_OF_WAR_VISIBLE, bj_mapInitialPlayableArea, true, true))
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerAddCondition(t, Condition(function M2O))
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function M6O))
	set FKV = CreateTrigger()
	call TriggerAddAction(FKV, function PVO)
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEvent(t, NeutralCreepPlayer, EVENT_PLAYER_UNIT_ATTACKED, null)
	call TriggerAddCondition(t, Condition(function PEO))
	set FLV = CreateRegion()
	call RegionAddRect(FLV, Rect( 3456, -2016, 4448, -2624))
	set ZV = Rect( 3456-64, -2016+ 64, 3456+ 128, -2016 -128)
	set Y1 = CreateTrigger()
	call YDWETriggerRegisterEnterRectSimpleNull(Y1, GetWorldBounds())
	call TriggerAddCondition(Y1, Condition(function PXO))
	//call TriggerAddAction(Y1, function POO)
	if (bj_isSinglePlayer and PGO()) then
		call ONR()
		call QXO()
	endif
	set t = CreateTrigger()
	call TriggerRegisterPlayerChatEvent(t, HostPlayer, "-wtf", true)
	call TriggerAddAction(t, function QNO)
	call TriggerAddCondition(t, Condition(function QRO))
	set t = CreateTrigger()
	call TriggerRegisterPlayerChatEvent(t, HostPlayer, "-test", true)
	call TriggerAddCondition(t, Condition(function QFO))
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEvent(t, SentinelPlayers[1], EVENT_PLAYER_HERO_LEVEL, null)
	call TriggerRegisterPlayerUnitEvent(t, SentinelPlayers[2], EVENT_PLAYER_HERO_LEVEL, null)
	call TriggerRegisterPlayerUnitEvent(t, SentinelPlayers[3], EVENT_PLAYER_HERO_LEVEL, null)
	call TriggerRegisterPlayerUnitEvent(t, SentinelPlayers[4], EVENT_PLAYER_HERO_LEVEL, null)
	call TriggerRegisterPlayerUnitEvent(t, SentinelPlayers[5], EVENT_PLAYER_HERO_LEVEL, null)
	call TriggerRegisterPlayerUnitEvent(t, ScourgePlayers[1], EVENT_PLAYER_HERO_LEVEL, null)
	call TriggerRegisterPlayerUnitEvent(t, ScourgePlayers[2], EVENT_PLAYER_HERO_LEVEL, null)
	call TriggerRegisterPlayerUnitEvent(t, ScourgePlayers[3], EVENT_PLAYER_HERO_LEVEL, null)
	call TriggerRegisterPlayerUnitEvent(t, ScourgePlayers[4], EVENT_PLAYER_HERO_LEVEL, null)
	call TriggerRegisterPlayerUnitEvent(t, ScourgePlayers[5], EVENT_PLAYER_HERO_LEVEL, null)
	call TriggerAddCondition(t, Condition(function HeroLevelUpCondition))
	set t = CreateTrigger()
	set reg = CreateRegion()
	call RegionAddRect(reg, GetWorldBounds())
	call TriggerRegisterEnterRegion(t, reg, null)
	call TriggerAddCondition(t, Condition(function Q0O))
	set t = CreateTrigger()
	call TriggerRegisterUnitInRange(t, AttackToBotDummyUnit, 300, null)
	call TriggerRegisterUnitInRange(t, AttackToMidDummyUnit  , 300, null)
	call TriggerRegisterUnitInRange(t, AttackToTopDummyUnit , 300, null)
	call TriggerAddCondition(t, Condition(function Q1O))
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 25, false)
	call TriggerAddAction(t, function Q4O)
	call TriggerAddAction(t, function SCO)
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 2, false)
	call TriggerAddCondition(t, Condition(function SEO))
	set KK = CreateRegion()
	call RegionAddRect(KK, gg_rct_SentinelBuyArea)
	call RegionAddRect(KK, gg_rct_ScourgeBuyArea)
	set t = CreateTrigger()
	call TriggerRegisterPlayerChatEvent(t, SentinelPlayers[1], "", false)
	call TriggerRegisterPlayerChatEvent(t, SentinelPlayers[2], "", false)
	call TriggerRegisterPlayerChatEvent(t, SentinelPlayers[3], "", false)
	call TriggerRegisterPlayerChatEvent(t, SentinelPlayers[4], "", false)
	call TriggerRegisterPlayerChatEvent(t, SentinelPlayers[5], "", false)
	call TriggerRegisterPlayerChatEvent(t, ScourgePlayers[1], "", false)
	call TriggerRegisterPlayerChatEvent(t, ScourgePlayers[2], "", false)
	call TriggerRegisterPlayerChatEvent(t, ScourgePlayers[3], "", false)
	call TriggerRegisterPlayerChatEvent(t, ScourgePlayers[4], "", false)
	call TriggerRegisterPlayerChatEvent(t, ScourgePlayers[5], "", false)
	call TriggerAddAction(t, function Y9O)
	set i = 0
	loop
		set PlayerShowKDA[i]= true
		set F6V[i]= true
		set F_V[i]= true
		set S3[i]= true
		// set ZR[i]= true
		set PlayerOnlineStateString[i]= "Here"
		set PS[i]= CreateTimer()
		set JN[i]=-2
		set MS[i]= CreateTimer()
		call SaveInteger(HY, GetHandleId(MS[i]), 0, i)
		set DisplayTextDuration[i]= 10.
		set i = i + 1
	exitwhen i > 16
	endloop
	set i = 0
	loop
		set F4V[GetPlayerId(SentinelPlayers[i])]= true
		set F4V[GetPlayerId(ScourgePlayers[i])]= true
		set i = i + 1
	exitwhen i > 5
	endloop
	set t = CreateTrigger()
	call TriggerRegisterUserUnitEvent(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call TriggerRegisterUserUnitEvent(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterUserUnitEvent(t, EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
	call TriggerAddCondition(t, Condition(function ELR))
	set t = CreateTrigger()
	call TriggerRegisterUserUnitEvent(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call TriggerRegisterUserUnitEvent(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterUserUnitEvent(t, EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
	call TriggerAddCondition(t, Condition(function ZOA))
	call TriggerAddCondition(t, Condition(function ZIA))
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 5, true)
	call TriggerAddCondition(t, Condition(function EKR))
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerAddCondition(t, Condition(function ESR))
	call TriggerAddCondition(t, Condition(function N_R))
	set t = null
	set t = CreateTrigger()
	call TriggerAddAction(t, function NZR)
	call TriggerAddCondition(t, Condition(function AFR))
	set GHV = t
	if IsGameHaveObserver then
		set t = CreateTrigger()
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function BJR))
	endif
	set IO = CreateTrigger()
	call TriggerRegisterTimerEvent(IO, 10, true)
	call TriggerAddCondition(IO, Condition(function YEA))
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 15, false)
	call TriggerAddCondition(t, Condition(function BPR))
	call TriggerAddCondition(t, Condition(function BMR))
	set t = CreateTrigger()
	set reg = CreateRegion()
	call RegionAddRect(reg, GetWorldBounds())
	call TriggerRegisterEnterRegion(t, reg, null)
	call TriggerAddCondition(t, Condition(function L2I))
	set t = CreateTrigger()

	call TriggerRegisterTimerEvent(t, .1, false)
	call TriggerAddAction(t, function CreateLodTrigger)
	
	call StoreMapIdCacheData("i", "d", 3)
	call StoreMetaCacheData("a", "Kills", 0)
	call StoreMetaCacheData("b", "Deaths", 0)
	call StoreMetaCacheData("c", "Assists", 0)
	call StoreMetaCacheData("d", "CreepKills", 0)
	call StoreMetaCacheData("e", "CreepDenies", 0)
	call StoreMetaCacheData("f", "Neutrals", 0)

	set FI = Rect( 3008, -2016, 4448, -2784)

	// 单位改变所属时 删除图b鉴定技能 防止选取后暴毙
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_CHANGE_OWNER)
	call TriggerAddCondition(t, Condition(function SLO))
	
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function YTA))

	if bj_isSinglePlayer and(PlayersName[1]== "df" or PlayersName[2]== "df" or PlayersName[3]== "df" or PlayersName[4]== "df" or PlayersName[5]== "df" or PlayersName[6]== "df" or PlayersName[8]== "df" or PlayersName[7]== "df" or PlayersName[8]== "df" or PlayersName[9]== "df" or PlayersName[10]== "df" or PlayersName[11]== "df") then
		set JE = true
	endif

	set WA = Rect(-7648,-7680,-6240,-6240)
	set YA = Rect(5856, 5472, 7712, 7296)

	// idk 意义不明
	set HX = CreateRegion()
	call RegionAddRect(HX, WA)
	set JX = CreateRegion()
	call RegionAddRect(JX, YA)
	set t = CreateTrigger()
	call TriggerAddCondition(t, Condition(function Z_A))
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterLeaveRegion(t, HX, Condition(function ZZA))
	call TriggerRegisterLeaveRegion(t, JX, Condition(function ZZA))

	// 最后施法信息
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_CAST)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_CHANNEL)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function LastSpellStateCondition))
	
	set t = null
	set reg = null

	call SetTerrainFogEx(0, 9999999., 10000000., .0, .0, .0, .0)
	call SetReservedLocalHeroButtons(1)
	call EnumDestructablesInRect(Rect( 3262, -1900, 4817,-2800), Condition(function Y5A), function Y4A)

	// 右键双击物品拆分物品
	call CreateRightDoubleClickItemTrigger()

	// 蝗虫超界补救
	set t = CreateTrigger()
	call TriggerRegisterLeaveRectSimple(t, bj_mapInitialPlayableArea)
	call TriggerAddCondition(t, Condition(function Y1A))

	// 英雄消失补救 防止英雄没了没法玩
	set KV = CreateTrigger()
	call TriggerRegisterTimerEvent(KV, 1, true)
	call TriggerAddAction(KV, function Y7A)

	// idk
	call Y3A()

	// 初始化暗影冲刺播放动画表
	call ExecuteFunc("Init_ChargeOfDarknessAnimation")
	// 初始化Prd随机数
	call ExecuteFunc("Init_PRDRandom")
	// 初始化单位rgb颜色表
	call ExecuteFunc("Init_UnitsColor")
	// 初始化单位经验表
	call ExecuteFunc("Init_UnitsTypeExpData") 
	// 初始化保存指向性物品技能和命令表 用于莲花反弹
	call ExecuteFunc("Init_ItemsAbilityAndOrder")
	// 初始化单位视野表
	call ExecuteFunc("Init_UnitsTypeSightData")
	// 大部分命令
	call ExecuteFunc("Init_Instructions")
	// 创建了一只羊 还有1秒计时器
	call ExecuteFunc("TCX")
	// 初始化神杖特效 按英雄Id
	call ExecuteFunc("Init_HerosTypeAghanimEffectAbilityId")
	// 一些排行榜
	call ExecuteFunc("CreateLeaderboards")
	// 会切换的技能Id
	call ExecuteFunc("Init_SpecialAbilityId")
	// 阴间计时器和阴间马甲 idk
	call ExecuteFunc("SOX")
	// 初始化常用Buff表
	call ExecuteFunc("Init_BuffsId")
	// 树木再生
	set TreeDestructableDeathTrig = CreateTrigger()
	call TriggerAddCondition(TreeDestructableDeathTrig, Condition(function TreeDestructableDeathAction))
	call EnumDestructablesInRect(bj_mapInitialPlayableArea, null, function RegisterEnumTreeDeath)

	set t = null
	set u = null
	set loc = null
	call SaveBoolean(V, 0, -107681000, true)
	call SaveBoolean(V, 0, -1526589116, true)

	// 抄来的信使共享
	set mu_sync_dummy_messenger = Condition(function MUSyncDummyMessenger)

	// 自己的UI
	set tt = CreateTimer()
	call TimerStart(tt, 0.00, false, function Init_ExtraTriggers)
	set tt = null
endfunction
function InitCustomTeams takes nothing returns nothing
	call SetPlayerTeam(Player(1), 0)
	call SetPlayerTeam(Player(2), 0)
	call SetPlayerTeam(Player(3), 0)
	call SetPlayerTeam(Player(4), 0)
	call SetPlayerTeam(Player(5), 0)
	call SetPlayerTeam(Player(7), 1)
	call SetPlayerTeam(Player(8), 1)
	call SetPlayerTeam(Player(9), 1)
	call SetPlayerTeam(Player(10), 1)
	call SetPlayerTeam(Player(11), 1)
endfunction

function config takes nothing returns nothing
	call SetMapName("TRIGSTR_50000")
	call SetMapDescription("TRIGSTR_50001")
	call SetPlayers(10)
	call DefineStartLocation(0,-6990., 6840.)
	call DefineStartLocation(1,-6990., 6840.)
	call DefineStartLocation(2,-6990., 6840.)
	call DefineStartLocation(3,-6990., 6840.)
	call DefineStartLocation(4,-6990., 6840.)
	call DefineStartLocation(5,-6990., 6840.)
	call DefineStartLocation(6,-6990., 6840.)
	call DefineStartLocation(7,-6990., 6840.)
	call DefineStartLocation(8,-6990., 6840.)
	call DefineStartLocation(9,-6990., 6840.)
	call SetPlayerColor(Player(1), ConvertPlayerColor(1))
	call SetPlayerRacePreference(Player(1), RACE_PREF_NIGHTELF)
	call SetPlayerRaceSelectable(Player(1), false)
	call SetPlayerController(Player(1), MAP_CONTROL_USER)
	call SetPlayerColor(Player(2), ConvertPlayerColor(2))
	call SetPlayerRacePreference(Player(2), RACE_PREF_NIGHTELF)
	call SetPlayerRaceSelectable(Player(2), false)
	call SetPlayerController(Player(2), MAP_CONTROL_USER)
	call SetPlayerColor(Player(3), ConvertPlayerColor(3))
	call SetPlayerRacePreference(Player(3), RACE_PREF_NIGHTELF)
	call SetPlayerRaceSelectable(Player(3), false)
	call SetPlayerController(Player(3), MAP_CONTROL_USER)
	call SetPlayerColor(Player(4), ConvertPlayerColor(4))
	call SetPlayerRacePreference(Player(4), RACE_PREF_NIGHTELF)
	call SetPlayerRaceSelectable(Player(4), false)
	call SetPlayerController(Player(4), MAP_CONTROL_USER)
	call SetPlayerColor(Player(5), ConvertPlayerColor(5))
	call SetPlayerRacePreference(Player(5), RACE_PREF_NIGHTELF)
	call SetPlayerRaceSelectable(Player(5), false)
	call SetPlayerController(Player(5), MAP_CONTROL_USER)
	call SetPlayerColor(Player(7), ConvertPlayerColor(7))
	call SetPlayerRacePreference(Player(7), RACE_PREF_UNDEAD)
	call SetPlayerRaceSelectable(Player(7), false)
	call SetPlayerController(Player(7), MAP_CONTROL_USER)
	call SetPlayerColor(Player(8), ConvertPlayerColor(8))
	call SetPlayerRacePreference(Player(8), RACE_PREF_UNDEAD)
	call SetPlayerRaceSelectable(Player(8), false)
	call SetPlayerController(Player(8), MAP_CONTROL_USER)
	call SetPlayerColor(Player(9), ConvertPlayerColor(9))
	call SetPlayerRacePreference(Player(9), RACE_PREF_UNDEAD)
	call SetPlayerRaceSelectable(Player(9), false)
	call SetPlayerController(Player(9), MAP_CONTROL_USER)
	call SetPlayerColor(Player(10), ConvertPlayerColor(10))
	call SetPlayerRacePreference(Player(10), RACE_PREF_UNDEAD)
	call SetPlayerRaceSelectable(Player(10), false)
	call SetPlayerController(Player(10), MAP_CONTROL_USER)
	call SetPlayerColor(Player(11), ConvertPlayerColor(11))
	call SetPlayerRacePreference(Player(11), RACE_PREF_UNDEAD)
	call SetPlayerRaceSelectable(Player(11), false)
	call SetPlayerController(Player(11), MAP_CONTROL_USER)
	call InitCustomTeams()
	call SetPlayerAlliance(Player(15), Player(1), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(Player(15), Player(2), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(Player(15), Player(3), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(Player(15), Player(4), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(Player(15), Player(5), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(Player(15), Player(7), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(Player(15), Player(8), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(Player(15), Player(9), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(Player(15), Player(10), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(Player(15), Player(11), ALLIANCE_SHARED_CONTROL, true)
endfunction
/**/
