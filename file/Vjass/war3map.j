
 //! import "Vjass\base.j"
 //! import "Vjass\MissileSystem.j"
 //! import "Vjass\CustomBuffSystem.j"
 //! import "Vjass\Line Segment Enumeration.j"
 //! import "Vjass\Invisible.j"
 
globals

	// Japi常量

	// 模型路径
	constant integer UNIT_STRING_MODEL_PATH = 13
	// 大头像模型路径
	constant integer UNIT_STRING_MODEL_PORTRAIT_PATH = 14
	// 模型缩放
	constant integer UNIT_REAL_MODEL_SCALE = 0x2c

	// abilitys
	constant integer ABILITY_DATA_TARGS             = 100 // integer
	constant integer ABILITY_DATA_CAST              = 101 // real
	constant integer ABILITY_DATA_DUR               = 102 // real
	constant integer ABILITY_DATA_HERODUR           = 103 // real
	constant integer ABILITY_DATA_COST              = 104 // integer
	constant integer ABILITY_DATA_COOL              = 105 // real
	constant integer ABILITY_DATA_AREA              = 106 // real
	constant integer ABILITY_DATA_RNG               = 107 // real
	constant integer ABILITY_DATA_DATA_A            = 108 // real
	constant integer ABILITY_DATA_DATA_B            = 109 // real
	constant integer ABILITY_DATA_DATA_C            = 110 // real
	constant integer ABILITY_DATA_DATA_D            = 111 // real
	constant integer ABILITY_DATA_DATA_E            = 112 // real
	constant integer ABILITY_DATA_DATA_F            = 113 // real
	constant integer ABILITY_DATA_DATA_G            = 114 // real
	constant integer ABILITY_DATA_DATA_H            = 115 // real
	constant integer ABILITY_DATA_DATA_I            = 116 // real
	constant integer ABILITY_DATA_UNITID            = 117 // integer

	constant integer ABILITY_DATA_HOTKEY = 200 // integer
    constant integer ABILITY_DATA_UNHOTKEY = 201 // integer
    constant integer ABILITY_DATA_RESEARCH_HOTKEY = 202 // integer
    constant integer ABILITY_DATA_RESEARCH_TIP      = 214 // string
    constant integer ABILITY_DATA_TIP = 215 // string

    //------------单位数据类型--------------
    // 攻击1 伤害骰子数量
    constant unitstate UNIT_STATE_ATTACK1_DAMAGE_DICE = ConvertUnitState(0x10)
    
    // 攻击1 伤害骰子面数
    constant unitstate UNIT_STATE_ATTACK1_DAMAGE_SIDE = ConvertUnitState(0x11)
    
    // 攻击1 基础伤害
    constant unitstate UNIT_STATE_ATTACK1_DAMAGE_BASE = ConvertUnitState(0x12)
    
    // 攻击1 升级奖励
    constant unitstate UNIT_STATE_ATTACK1_DAMAGE_BONUS = ConvertUnitState(0x13)
    
    // 攻击1 最小伤害
    constant unitstate UNIT_STATE_ATTACK1_DAMAGE_MIN = ConvertUnitState(0x14)
    
    // 攻击1 最大伤害
    constant unitstate UNIT_STATE_ATTACK1_DAMAGE_MAX = ConvertUnitState(0x15)
    
    // 攻击1 全伤害范围
    constant unitstate UNIT_STATE_ATTACK1_RANGE = ConvertUnitState(0x16)
    
    // 装甲
    constant unitstate UNIT_STATE_ARMOR = ConvertUnitState(0x20)
    
    // attack 1 attribute adds
    // 攻击1 伤害衰减参数
    constant unitstate UNIT_STATE_ATTACK1_DAMAGE_LOSS_FACTOR = ConvertUnitState(0x21)
    
    // 攻击1 武器声音
    constant unitstate UNIT_STATE_ATTACK1_WEAPON_SOUND = ConvertUnitState(0x22)
    
    // 攻击1 攻击类型
    constant unitstate UNIT_STATE_ATTACK1_ATTACK_TYPE = ConvertUnitState(0x23)
    
    // 攻击1 最大目标数
    constant unitstate UNIT_STATE_ATTACK1_MAX_TARGETS = ConvertUnitState(0x24)
    
    // 攻击1 攻击间隔
    constant unitstate UNIT_STATE_ATTACK1_INTERVAL = ConvertUnitState(0x25)
    
    // 攻击1 攻击延迟/summary>
    constant unitstate UNIT_STATE_ATTACK1_INITIAL_DELAY = ConvertUnitState(0x26)
    
    // 攻击1 弹射弧度
    constant unitstate UNIT_STATE_ATTACK1_BACK_SWING = ConvertUnitState(0x28)
    
    // 攻击1 攻击范围缓冲
    constant unitstate UNIT_STATE_ATTACK1_RANGE_BUFFER = ConvertUnitState(0x27)
    
    // 攻击1 目标允许
    constant unitstate UNIT_STATE_ATTACK1_TARGET_TYPES = ConvertUnitState(0x29)
    
    // 攻击1 溅出区域
    constant unitstate UNIT_STATE_ATTACK1_SPILL_DIST = ConvertUnitState(0x56)
    
    // 攻击1 溅出半径
    constant unitstate UNIT_STATE_ATTACK1_SPILL_RADIUS = ConvertUnitState(0x57)
    
    // 攻击1 武器类型
    constant unitstate UNIT_STATE_ATTACK1_WEAPON_TYPE = ConvertUnitState(0x58)
    
    // attack 2 attributes (sorted in a sequencial order based on memory address)
    // 攻击2 伤害骰子数量
    constant unitstate UNIT_STATE_ATTACK2_DAMAGE_DICE = ConvertUnitState(0x30)
    
    // 攻击2 伤害骰子面数
    constant unitstate UNIT_STATE_ATTACK2_DAMAGE_SIDE = ConvertUnitState(0x31)
    
    // 攻击2 基础伤害
    constant unitstate UNIT_STATE_ATTACK2_DAMAGE_BASE = ConvertUnitState(0x32)
    
    // 攻击2 升级奖励
    constant unitstate UNIT_STATE_ATTACK2_DAMAGE_BONUS = ConvertUnitState(0x33)
    
    // 攻击2 伤害衰减参数
    constant unitstate UNIT_STATE_ATTACK2_DAMAGE_LOSS_FACTOR = ConvertUnitState(0x34)
    
    // 攻击2 武器声音
    constant unitstate UNIT_STATE_ATTACK2_WEAPON_SOUND = ConvertUnitState(0x35)
    
    // 攻击2 攻击类型
    constant unitstate UNIT_STATE_ATTACK2_ATTACK_TYPE = ConvertUnitState(0x36)
    
    // 攻击2 最大目标数
    constant unitstate UNIT_STATE_ATTACK2_MAX_TARGETS = ConvertUnitState(0x37)
    
    // 攻击2 攻击间隔
    constant unitstate UNIT_STATE_ATTACK2_INTERVAL = ConvertUnitState(0x38)
    
    // 攻击2 攻击延迟
    constant unitstate UNIT_STATE_ATTACK2_INITIAL_DELAY = ConvertUnitState(0x39)
    
    // 攻击2 攻击范围
    constant unitstate UNIT_STATE_ATTACK2_RANGE = ConvertUnitState(0x40)
    
    // 攻击2 攻击缓冲
    constant unitstate UNIT_STATE_ATTACK2_RANGE_BUFFER = ConvertUnitState(0x41)
    
    // 攻击2 最小伤害
    constant unitstate UNIT_STATE_ATTACK2_DAMAGE_MIN = ConvertUnitState(0x42)
    
    // 攻击2 最大伤害
    constant unitstate UNIT_STATE_ATTACK2_DAMAGE_MAX = ConvertUnitState(0x43)
    
    // 攻击2 弹射弧度
    constant unitstate UNIT_STATE_ATTACK2_BACK_SWING = ConvertUnitState(0x44)
    
    // 攻击2 目标允许类型
    constant unitstate UNIT_STATE_ATTACK2_TARGET_TYPES = ConvertUnitState(0x45)
    
    // 攻击2 溅出区域
    constant unitstate UNIT_STATE_ATTACK2_SPILL_DIST = ConvertUnitState(0x46)
    
    // 攻击2 溅出半径
    constant unitstate UNIT_STATE_ATTACK2_SPILL_RADIUS = ConvertUnitState(0x47)
    
    // 攻击2 武器类型
    constant unitstate UNIT_STATE_ATTACK2_WEAPON_TYPE = ConvertUnitState(0x59)
    
    // 装甲类型
    constant unitstate UNIT_STATE_ARMOR_TYPE = ConvertUnitState(0x50)
    
    // 攻速 取百分比
    constant unitstate UNIT_STATE_RATE_OF_FIRE = ConvertUnitState(0x51) // global attack rate of unit, work on both attacks
    // 寻敌 原生cj也有
    constant unitstate UNIT_STATE_ACQUISITION_RANGE = ConvertUnitState(0x52) // how far the unit will automatically look for targets
        
    // 生命恢复 当恢复类型为总是时 不知道如何使其刷新
    constant unitstate UNIT_STATE_LIFE_REGEN = ConvertUnitState(0x53)
    // 魔法恢复  
    constant unitstate UNIT_STATE_MANA_REGEN = ConvertUnitState(0x54)
    
    // 最小射程
    constant unitstate UNIT_STATE_MIN_RANGE = ConvertUnitState(0x55)
    
    // 目标类型
    constant unitstate UNIT_STATE_AS_TARGET_TYPE = ConvertUnitState(0x60)
    
    // 作为目标类型
    constant unitstate UNIT_STATE_TYPE = ConvertUnitState(0x61)

 	// movetype EXSetUnitMoveType
	constant integer MOVE_TYPE_UNKNOWN               = 0x20 // 未知
	constant integer MOVE_TYPE_FOOT                  = 0x02 // 步行
	constant integer MOVE_TYPE_FLY                   = 0x04 // 飞行
	constant integer MOVE_TYPE_MINES			     = 0x08 // 地雷 
	constant integer MOVE_TYPE_WINDWALK				 = 0x10	// 疾风步

	//constant integer MOVE_TYPE_HORSE                 = ConvertMoveType(4)
	//constant integer MOVE_TYPE_HOVER                 = ConvertMoveType(8)
	constant integer MOVE_TYPE_FLOAT                 = 0x40	// 漂浮(水)
	constant integer MOVE_TYPE_AMPHIBIOUS            = 0x80 // 两栖
	//constant integer MOVE_TYPE_UNBUILDABLE           = ConvertMoveType(64)

	// collisiontype EXSetUnitCollisionType
	constant integer COLLISION_TYPE_UNIT			 = 1
	constant integer COLLISION_TYPE_STRUCTURE		 = 3
	// =======================================================================
	// YDWE的修正BJ
    region yd_NullTempRegion



	// =======================================================================
	// 用来类型转换的哈希表
	hashtable ConvertType 			= InitHashtable() 
	hashtable AttackDefense 		= InitHashtable() 

	integer     array    	NEGATIVE_ARMOR

	// =======================================================================
	// 属性奖励系统的Key
	constant integer STATE_SYSTEM_DAMAGE 		= 'AIat'
	constant integer STATE_SYSTEM_ATTACK 		= 'AIsx'
	constant integer STATE_SYSTEM_ARMOUR 		= 'AId1'
	constant integer STATE_SYSTEM_REGEN 		= 'Arel'
	
	constant integer STATE_SYSTEM_PERCENT_MOVE  = 'Aspm'
	
	// =======================================================================
	// 伤害系统
	string  	array      Attack_System_Func
	integer     array      Attack_System_MaxFuncNumber



	constant integer AE_ATTACKED				 		= 10

	constant integer AE_END_ATTACKED				    = 11

	// 物理攻击特效 每一个都继承上一个的需求
	// 无要求, 只要是物理攻击特效
	constant integer DE_NONE						= 0
	// 来源是英雄或熊灵
	constant integer DE_SH							= 1
	// 攻击目标非建筑非守卫
	constant integer DE_SH_T_NS_NW					= 2
	// 攻击目标是敌人
	constant integer DE_SH_TE_NS_NW					= 3
	// 目标不是魔法免疫
	constant integer DE_SH_TE_NM_NS_NW				= 4

	// 物理攻击特效
	//constant integer PHYSICAL_ATTACK_EFFECT 					= 4


	
	constant integer DE_ATTACK_READY_LAUNCHING 		= 5

	// =======================================================================

	boolean					IsReplayMode		= false
	unit 		array  		EnumUnits
	integer                 EnumUnitMaximum
	constant real MAX_UNIT_COLLISION = 64.

	real InterfaceErrorHideTime = 0.
	integer InterfaceErrorTextAlpha = 0
	//
	// UI
	integer UIFrame__TargetingError
	integer UIText__TargetingError
	// 更新日志
	integer UIFrame__UpdateLog
	integer UIButton__UpdateLogOK
	// 更新内容
	string UpdateLogStr = null
	boolean UpdateLogIsShow = false

	// 当前月份
	integer CurrentMonth = 0

	boolean UseChangeHotKeySystem = false
	// 改键仅限英雄
	boolean ChangeHotkeyHeroOnly = true
	// 本地命令按钮快捷键
	integer array LocalCommandButtonHotKey
	integer array LocalCommandX
	integer array LocalCommandY
	integer ChangeKeyLoopIndex
    integer LocalPlayerSelectUnitId = 0    

    integer UpdateCallbackCount = 0

	// 禁止刷新的技能Id
	integer array DisableRefreshCoolDownSkillId

	// 冷却
	unit lastSummonedIllusionUnit = null
	integer array Temp__ArrayInt
	real array Temp__ArrayReal
	unit array Temp__ArrayUnit
	location Temp__Location = Location(0, 0) // 
	//Temp
	integer Temp__Int
	player Temp__Player = null
	player array Temp__ArrayPlayer

	string bj_AllString = ".................................!.#$%&'()*+,-./0123456789:;<=>.@ABCDEFGHIJKLMNOPQRSTUVWXYZ[.]^_`abcdefghijklmnopqrstuvwxyz{|}~................................................................................................................................"
	trigger yd_DamageEventTrigger = null
	string tip_string = ""
	boolexpr mu_sync_dummy_messenger 	= null
	boolean mu_has_init_dummy_player 	= false

	boolean	PointHaveTree 				= false

	integer JinadaCount					= 0
	integer	MeldCount					= 0
	boolean	HaveBackstab				= false
	boolean HaveMortalWounds			= false
	boolean	HavePsiBlades				= false
	boolean	HaveDeathFraud				= false
	boolean HaveGrow					= false
	boolean HaveSpellLifesteal 			= false
	boolean HaveBear 					= false
	boolean HaveDisableItem 			= false
	// 有人选了维萨吉
	boolean HaveSoulAssumption 			= false
	boolean	HaveGravekeeperCloak        = false
	// 有人学了回到过去
	boolean HaveBacktrack 				= false
	boolean HaveDispersion 				= false
	boolean HaveManaShield				= false
	boolean HaveTidebringer 			= false
	boolean HaveSplitShot 				= false
	boolean HaveElderDragonForm 		= false
	boolean HaveFurySwipes 				= false
	boolean HaveMassSerpentWard			= false
	boolean HaveManaBreak				= false
	boolean HaveMoonGlaive              = false
	boolean HaveHeadshot				= false
	boolean HaveDiffusalBlade           = false
	boolean HavePassiveStun				= false

	unit SentinelsShop_PigKing = null
	unit shop_2 = null
	unit array Tp_Dummy
	
	unit Wave_Sou = null
	unit Wave_U = null
	integer Wave_LV

	integer array a_fx
	boolean array a_fx_b
	timer PlayerBuyback_Timer

	// 与lua交互的字符串
	string SlkType = null
	string SlkdataType = null



	boolean IsEnableDoubleClickSystem = false

	// 单位大头像
	integer PortraitFrame
	// 按键是否已按下
	boolean array KeyIsDown
	integer MessageAbilityOrder = 0

	// > 0 代表这个键可以双击施法
	integer array KeyCanDoubleClickSpell
	//

	// 新UI
	boolean bMenuMainPanelIsEnable = false
	boolean bMenuGameplayPanelIsEnable = false
	integer TopMsgTimerC = 1
	trigger array TopMessageTextTrg
	string array TopMessageText //顶部消息栏 用于显示一些重要信息
	boolean DownAlt = false
	integer GlyphFrame = 0
	//integer GlyphFrame_tip = 0
	//integer GlyphFrame_tip_text = 0
	multiboard BJ_Multiboard = null //按Tab键会打开的多面板

	integer CommandBarButtonIndex = - 1
	integer FirstCommandBarButton
	integer ButtonInterval
	//======================================================================
	// 工具提示
	// 工具提示背景
	integer UIFrame__ToolTip
	integer UIBackDrop__ToolTip
	integer UIText__ToolTip
	// 扩展提示
	integer UIText__ToolUberTip
	//======================================================================
	// 本地玩家,游戏开始时Set,无需后面一直LocalPlayer
	player LocalPlayer = null
	boolean IsObserver = false
	integer LocalId

	//======================================================================
	// 任意单位受伤事件 的temp变量
	// 受伤单位的玩家
	

	//======================================================================


	// 声音的哈希表 因为音效不能在播放时间内重复播放
	//hashtable SoundHT = InitHashtable()
	// Error.wav 0.614
	//constant integer SOUNDHTKEY_ERROR_SOUND = 0

	//======================================================================
	hashtable V = InitHashtable()
	unit array E
	boolean array IsEffectEnabled
	timer array O
	boolean IsDodgeAttack = false
	constant integer I =$A
	constant integer A =$B
	constant integer N = 12
	constant integer B =$D
	constant integer C = 14
	constant integer D =$F
	integer F = 0
	boolean G = false
	unit H = null
	boolean WTF__Status = false
	

	integer UIFrame__DebugLog = 0
	string GourpListStr = null
	integer array GroupsId
	integer GroupsDebugCount = 0
	lightning array NeutralsPosTipLightning
	integer NeutralsPosTipNumber = 0
	real array Chat_times
	effect array tower_rangeeff
	integer tower_rangeint = 0
	
	integer it_jys
	integer fakeJys
	integer array jys_count
	// 哈希表
	hashtable K = InitHashtable()
	hashtable L = InitHashtable()
	hashtable M = InitHashtable()
	hashtable P = InitHashtable()
	hashtable HY = InitHashtable()
	hashtable Q = InitHashtable()
	hashtable T = InitHashtable()
	hashtable U = InitHashtable()
	hashtable W = InitHashtable()
	hashtable Y = InitHashtable()
	hashtable Z = InitHashtable()
	hashtable VV = InitHashtable()

	// 异步哈希表
	hashtable LocalHashTable = InitHashtable()
	integer DoubleClickKey = 0
	real DoubleClickKeyTime = 0.
	// 哈希表的Key值
	constant integer KEY_USE_DOUBLECLICK_SPELL = 1

	// 哈希表KEY UI的提示字符
	constant key HTKEY_UI_TOOLTIP_STR
	// 哈希表KEY UI的扩展提示字符
	constant key HTKEY_UI_TOOLTIP_UBERSTR

	// 额外哈希表
	hashtable ExtraHT = InitHashtable()

	// 这里的Key一般为子Key 父Key为单位的HandleId

	// 也可以以'A000'之类的 4字ASCII码 物体Id作为子索引

	// 如果是浸毒武器类技能, 来源单位HandleId为父Id, 子Id为 目标单位的HandleId + '技能Id'


	// 哈希表KEY 单位原生ID
	constant key HTKEY_UNIT_ORIGIN_TYPEID
	// 哈希表KEY 切换型技能
	constant key HTKEY_SWITCHING_SKILLS
	// 哈希表KEY 塔攻击范围特效 Tower attack range 
	constant key HTKEY_TOWER_ATTACK_RANGE_EFFECT
	// 哈希表KEY 拆分物品
	constant key HTKEY_UNIT_SPLIT_ITEM0
	constant key HTKEY_UNIT_SPLIT_ITEM1
	constant key HTKEY_UNIT_SPLIT_ITEM2
	constant key HTKEY_UNIT_SPLIT_ITEM3
	constant key HTKEY_UNIT_SPLIT_ITEM4
	constant key HTKEY_UNIT_SPLIT_ITEM5

	// 哈希表KEY 单位当前百分比缩放
	constant key HTKEY_UNIT_CURRENT_PERCENT_SCALE
	// 哈希表KEY 单位当前增加的缩放
	constant key HTKEY_UNIT_CURRENT_ADDSCALE
	// 哈希表KEY 嗜血术缩放
	constant key HTKEY_SCALE_BLOODLUST_TRIGGER
	// 哈希表KEY 狂猛缩放
	constant key HTKEY_SCALE_RABID_TRIGGER
	// 哈希表KEY 黑皇杖缩放 Black King Bar
	constant key HTKEY_SCALE_BLACK_KING_BAR

	// 哈希表KEY 过载 Overcharge
	constant key HTKEY_DAMAGE_OVERCHARGE

	// 哈希表KEY 潮汐使者特效 Tidebringer // handle / boolean
	constant key HTKEY_SKILL_TIDEBRINGER

	// 哈希表KEY 潮汐使者特效 Tidebringer // effect
	constant key HTKEY_TIDEBRINGER_EFFECT

	// 哈希表KEY 回光返照特效 BorrowedTime // effect
	constant key HTKEY_HAS_BORROWEDTIME

	// 射程奖励 - 仅限远程
	constant key HTKEY_RANGEN1_ONLY_RANGED_ATTACKER_BONUS

	// 通用射程奖励
	constant key HTKEY_CURRENCY_RANGEN1_BONUS

	// 获取攻击出手 AttackReady
	constant key HTKEY_GET_ATTACK_READY_TRIGGER

	// 哈希表KEY 飓风推进 次数 HurricaneThrustAttackEffect //
	constant key HTKEY_HURRICANE_THRUST_COUNT
	// real 结束时间 key 攻击计数 handle 攻击目标 boolean 是否增加攻击距离

	// 无碰撞 计数
	constant key HTKEY_UNIT_PATHING_COUINT

	// 相位移动 计数 PhaseMove
	constant key HTKEY_UNIT_PHASE_MOVE_COUINT

	// 单位无敌 计数
	constant key HTKEY_UNIT_INVELNERABLE_COUINT

	// 单位苦工类别 计数
	constant key HTKEY_UNIT_PEON_COUINT

	// 单位100%魔抗 计数 ImmunityMagicDamage
	constant key HTKEY_UNIT_IMMUNITY_MAGIC_DAMAGE

	// 人马A杖升级 ScepterUpgrade
	constant key HTKEY_HAS_STAMPDE_UPGRADE_BUFF
	// boolean 拥有 key 计数
	// 人马A杖升级 ScepterUpgrade
	constant key HTKEY_STAMPDE_BUFF_COUNT
	
	// 单位沉默 计数 SilenceUnit
	constant key HTKEY_UNIT_SILENCE_COUINT

	// 单位被缴械 计数 disarmed
	constant key HTKEY_UNIT_DISARMED_COUINT

	// 单位被破坏 Break
	constant key HTKEY_UNIT_BREAK

	// 醉拳爆击 Drunken Brawler Critical Strike
	constant key HTKEY_UNIT_DRUNKEN_BRAWLER_CS
	
	// 醉拳爆击 Drunken Brawler Miss
	constant key HTKEY_UNIT_DRUNKEN_BRAWLER_MS

	// 暴击数值 Critical Strike Value
	constant key HTKEY_UNIT_CS_VALUE

	// 暴击数值 Critical Strike AbilityId
	constant key HTKEY_UNIT_CS_ID

	// 破隐一击
	constant key HTKEY_UNIT_BS_ID

	// 背刺数值 EFFECT_KEY_BACKSTAB
	constant key HTKEY_UNIT_BACKSTAB_VALUE

	constant integer ImageAbility = 'AIil'
	// 幻象单位
	constant key IMAGO_UNIT_IS_SUMMONING_ILLUSIONS
	constant key SUMMONING_SOURCE_UNIT
	constant key IMAGO_TARGET_UNIT

	constant key IllusionUnitDataB
	constant key IllusionUnitDataC 
	constant key IllusionUnitDataId

	constant key HTKEY_UNIT_EMPOWER_LEVEL

	constant key HTKEY_UNIT_BONUS_MAGIC_RESISTANCE

	constant key HTKEY_UNIT_BASE_MAGIC_RESISTANCE

	constant key HTKEY_UNIT_ACTULA_MAGIC_RESISTANCE

	// 哈希表KEY 锁闭 Locked // effect
	constant key HTKEY_LOCKED_BUFF_TRIGGER




	constant key HTKEY_ATTACK_LAUNCHING_COUNT


	// Buff表 Key

	// 缴械 Disarm
	constant integer BUFF_TYPE_DISARM = 'PRGH'
	
	// 一定时间内开启的特效 Black Hole
	constant key EFFECT_KEY_STATICSTORM
	constant key EFFECT_KEY_BLACKHOLE

	// EnableEffectByTime 
	// Backstab
	constant integer EFFECT_KEY_CRYSTALYS 				= 40
	constant integer EFFECT_KEY_BURIZA_DO_KYANON 		= 41
	constant integer EFFECT_KEY_CRIMSON_GUARD 			= 42
	constant integer EFFECT_KEY_EMPOWER 				= 43
	// Living Armor
	constant integer EFFECT_KEY_LIVING_ARMOR  			= 44
	// BreatheFire
	constant integer EFFECT_KEY_BREATHE_FIRE  			= 45
	// FocusFire
	constant integer EFFECT_KEY_FOCUS_FIRE  			= 46
	// Penitence
	constant integer EFFECT_KEY_PENITENCE  				= 47
	// Bloodrage
	constant integer EFFECT_KEY_BLOODRAGE  				= 48
	// Soul Catcher
	constant integer EFFECT_KEY_SOUL_CATCHER  			= 49
	// Fate's Edict
	constant integer EFFECT_KEY_FATE_EDICT  			= 50
	// Fatal Bonds
	constant integer EFFECT_KEY_FATAL_BONDS  			= 51

	constant integer EFFECT_KEY_STONE_GAZE				= 52
	// Insatiable Hunger
	constant integer EFFECT_KEY_INSATIABLE_HUNGER	    = 53
	// MomentOfCourage
	constant integer EFFECT_MOMENT_OF_COURAGE		    = 54
	
	// 物体数据哈希表
	hashtable ObjectData = InitHashtable()

	// 物体数据的Key一般为父Key 子Key为ObjectId
	// 哈希表KEY 技能需求等级
	constant key OBJ_ITEM_INDEX

	// 哈希表KEY 技能需求等级
	constant key OBJ_HTKEY_ABILITY_REQLEVEL

	constant key OBJ_HTKEY_IS_ONOFF_ORDERID

	// 固有魔法抗性
	constant key OBJ_HTKEY_BASE_MAGIC_RESISTANCE

	// 哈希表KEY 单位的原生缩放
	constant key OBJ_HTKEY_UNIT_ORIGIN_SCALE
	// 哈希表KEY 单位的原生射程N1
	constant key OBJ_HTKEY_UNIT_ORIGIN_RANGEN1

	// 哈希表KEY launchX
	constant key OBJ_HTKEY_UNIT_ORIGIN_LAUNCH_X
	// 哈希表KEY launchY
	constant key OBJ_HTKEY_UNIT_ORIGIN_LAUNCH_Y
	// 哈希表KEY launchZ
	constant key OBJ_HTKEY_UNIT_ORIGIN_LAUNCH_Z
	// 哈希表KEY impactZ
	constant key OBJ_HTKEY_UNIT_ORIGIN_IMPACT_Z

	// 单位 攻击1 前摇
	constant key OBJ_HTKEY_UNIT_ORIGIN_DMAGE_POINT1

	// 英雄主属性
	constant key OBJ_HTKEY_HERO_PRIMARY

	// 哈希表KEY 技能是否是物品技能
	constant key OBJ_HTKEY_IS_ITEM_ABILITY

	// 哈希表KEY 隐身施法不显行
	constant key OBJ_HTKEY_IS_NOT_SHOW_ABILITY
	

	// 英雄重生 (实际上为物体死亡 但用条件判断了是否为重生)
	trigger HeroReincarnationTrigger = CreateTrigger()

	integer array XV
	group AllHerosGroup = CreateGroup()
	group IV = CreateGroup()
	group AV = CreateGroup()
	boolean NV = true
	boolean BV = false
	boolean CV = false
	boolean DV = false
	boolean FV = true
	boolean GV = false
	real HV
	trigger KV = null
	integer LV = 0
	trigger MV = null

	boolean QV = false
	unit SV = null
	unit TV = null
	boolean UV = true
	integer WV = 0
	// lod的Debug变量
	constant boolean LOD_DEBUGMODE = true

	boolean GAY_TEST_MODE = true
	constant boolean GAY_BETA_VERSION = true
	
	rect RectDummy = Rect(0, 0, 0, 0)
	rect ZV
	boolean VE = false
	boolean HaveVampiricAura 		= false
	boolean HaveVladmirOffering 	= false
	boolean BE = false
	boolean HE = false
	boolean JE = false
	real array KE
	real array LE
	timer TE = null
	boolean UE = false
	integer WE = 0

	sound ZE
	sound VX
	sound ZigguratUpgradeSound
	integer array XX
	group OX = CreateGroup()
	integer array RX
	boolean IX = false
	boolean AX = false
	// 任意单位受伤的触发器
	trigger AnyUnitDamagedTrigger
	region BX = null
	region CX = null
	integer DX = 0
	//integer GX = 0
	region HX
	region JX
	group KX = CreateGroup()
	integer LX = 0
	boolean MX = false
	boolean PX = false
	boolean UX = false

	rect XO
	trigger IO
	integer array AO
	unit array NO
	unit array CO
	integer array DO
	boolean array FO
	boolean array GO
	unit HO
	trigger JO = null
	unit KO
	unit LO
	trigger PO
	trigger QO
	timer TO
	boolean UO = true
	player ZO
	real ER
	constant integer HotKeyStringHash = StringHash("hotkey")
	unit PreloadeHero
	integer RR = 0
	unit IR
	integer array BR
	real array CR
	integer array DR
	boolean array GR
	unit HR
	unit JR
	unit KR
	unit LR
	boolean PR = false
	constant integer QR = StringHash("tempest")
	integer SR =-1
	group UR
	trigger YR
	boolean array ZR
	integer VI
	boolean EI = false
	boolean array XI
	integer array RI
	timer II
	rect NI
	unit BI
	trigger CI
	integer array DI
	rect FI
	group GI
	integer MaxHeroSkillsNumber = 0
	boolean array JI
	integer KI
	integer LI
	integer PI
	integer QI
	integer array SI
	integer TI
	unit UI
	unit WI
	integer YI
	real ZI
	real VA
	boolean array XA
	boolean array FA
	unit GA
	real HA
	unit JA
	integer KA = 0
	real LA
	unit MA
	real QA
	integer SA
	unit TA
	unit UA
	rect WA
	rect YA
	group ZA = CreateGroup()
	group VN = CreateGroup()
	unit EN = null
	real XN
	real ON
	group RN
	boolean array IN
	sound AN
	real BN
	real CN
	boolean DN = false
	integer GN = 0
	real array HN
	real array JN
	boolean KN
	real LN =$F423F
	unit MN = null
	unit QN = null
	integer SN = 0
	integer TN = 0
	unit UN
	boolean WN = false
	real YN = .015
	unit array VB
	real Local__TextTagzOffset = .0
	unit XB
	boolean OB = false
	integer array RB
	integer IB = 0
	constant integer CB =$A
	constant integer DB =$B
	constant integer FB =$C
	constant integer GB =$D
	constant integer HB =$E
	constant integer JB =$F
	boolean KB = false
	group LB
	boolean MB = true
	integer array PB
	constant integer QB = 1325
	unit SB = null
	integer WB
	boolean YB = false
	integer array ZB
	integer array VC
	integer array EC
	constant integer IC = StringHash("color")
	constant integer CC = StringHash("bounty_lowest")
	constant integer DC = StringHash("bounty_highest")
	constant integer FC = StringHash("sight")
	constant integer GC = StringHash("nsight")
	constant integer HC = StringHash("expirience")
	real MC
	integer PC = 5
	integer TC
	integer WC
	timer ZC = CreateTimer()
	boolean array XD
	integer AD = 0
	boolean	array PassiveSkills_IllusionInherit
	integer array PassiveSkills_Real
	integer array PassiveSkills_SpellBook
	integer array PassiveSkills_Learned
	integer array PassiveSkills_Buff
	integer array PassiveSkills_Show
	integer array PassiveSkills_illusion
	integer MaxPassiveSkillsNum = 0
	integer array RF
	integer array NF
	integer array CF
	integer array HF
	integer AghanimUpgradeMaxIndex = 1
	real PF
	unit QF
	integer array TF
	boolean array UF
	group YF = CreateGroup()
	unit VG = null
	player EG = null
	integer XG
	boolean OG = false
	unit RG
	unit IG
	integer BG
	integer array CG
	unit DG
	trigger FG
	unit GG
	group HG
	unit PG
	unit UG
	unit WG
	unit YG
	unit ZG
	trigger VH
	integer EH
	integer XH
	unit RH
	group NH
	real BH
	real CH
	integer DH
	boolean FH
	integer GH
	real HH
	group KH
	unit LH
	unit MH
	unit PH
	unit QH
	unit TH
	unit UH
	unit WH
	unit YH
	boolean array SPCDB
	group ZH
	integer VJ
	integer XJ
	real OJ
	real NJ
	trigger JJ = CreateTrigger()
	trigger KJ = CreateTrigger()




	integer array XK
	boolean OK = false

	group IK = null
	group AK = CreateGroup()
	group BK = CreateGroup()
	integer array CK
	boolean FK = true
	boolean HK = false
	trigger QK
	unit TK = null
	integer UK
	unit ZK = null
	integer VL
	// 玩家的英雄类型
	integer array PlayerHeroTypeId
	boolean array RL
	unit IL
	unit AL
	unit NL
	real CL
	unit DL = null
	group FL = null
	integer GL ='w'
	integer HL = 6
	integer JL = 90
	integer KL =$96
	integer LL =$96
	integer ML =$F0
	constant integer QL = StringHash("essenceshift")
	integer TL = 25
	// 显示伤害值
	boolean array EnableMapSetUp__ShowDamageTextTag
	integer array ZL
	boolean array RM
	boolean SM = false
	string TM = "		"
	boolean InHeroSelection = true
	// 主要模式名
	string MainModeName = ""
	string EP
	integer array XP
	integer OP =1000
	integer ExtraAbilitiesNum  = 0
	integer array IP
	integer BP = 0
	boolean array DP
	boolean array FP
	boolean GP = false
	multiboard JP = null
	unit array KP
	boolean array LP
	integer array MP
	integer array PP
	integer array QP
	string array HeroSkillsIcon
	integer array PlayerSkillIndex
	integer array HeroCommonSkills
	integer array HeroUpgradeSkills
	integer array HeroChangeAbilitySkills
	string array NoBalanceOffTips
	string array NoRearmCombosTips
	string array ZTP
	boolean array IsPassiveSkill
	boolean array IsMultiIconSkill
	boolean array IsNoDeathMatchSkill
	boolean array IsDisabledSkill
	integer array RQ
	integer array IQ
	integer array AQ
	integer array NQ
	integer array BQ
	integer array CQ
	integer array DQ
	integer array FQ
	integer array GQ
	integer array HQ
	integer array JQ
	integer array KQ
	integer array LQ
	integer array MQ
	integer array PQ
	integer array QQ
	integer array SQ
	real array TQ
	timer GameTimer = null
	real WQ = 0
	boolean array YQ
	boolean array ZQ
	integer array XS
	integer array IS
	integer array FS
	boolean GS = false
	string array JS
	boolean array KS
	timer array MS
	timer array PS
	integer QS = 0
	integer TS = 0

	// 用于死亡竞赛 队伍用的生命值
	integer array TeamHeroUseLivesCount
	integer array TeamHeroKillsCount
	boolean Mode__DeathMatch = false
	// 死亡竞赛 最大生命数
	integer DeathMatch__MaxLives 

	boolean YS = false
	boolean VT = false
	boolean ET = false
	integer XT =$E
	boolean OT = false
	boolean RT = false
	boolean Mode__ItemDrop = false
	boolean Mode__AntiHack = false
	multiboard BT = null
	unit RoShan = null
	boolean array FT
	integer GT =$96
	boolean Mode__HolyShitLimit = false
	boolean Mode__EasyMode = false
	boolean Mode__NoPowerups = false
	boolean Mode__SuperCreeps = false
	location LT = null
	location MT = null
	location PT = null
	location QT = null
	location TT = null
	boolean UT = true
	boolean WT = true
	boolean YT = true
	boolean ZT = true
	boolean VU = true
	boolean EU = true
	boolean XU = true
	boolean OU = true
	boolean RU = true
	boolean IU = true
	boolean AU = true
	boolean NU = true
	integer BU = 3
	integer CU = 1
	location FU = null
	location GU = null
	location HU = null
	location JU = null
	location KU = null
	location LU = null
	location MU = null
	location PU = null
	location QU = null
	location SU = null
	location TU = null
	location UU = null
	location WU = null
	location YU = null
	unit array Player__Hero
	integer IM1 = 0
	integer N1 = 0
	player array VW
	player array EW

	unit array OW
	// 用于死亡竞赛 玩家的复活次数
	integer array PlayerHeroReincarnCount
	force RW = null
	force IW = null
	// 近卫
	player array Sentinels
	// 天灾
	player array Scourges
	
	player BW = null
	// 中立被动玩家
	constant player NeutralPassivePlayer = Player(15)
	boolean DW = false
	integer VO = 0
	integer array WO

	// 主机
	player HostPlayer = null
	unit lastRealityUnit = null
	unit GW = null
	integer HW = 0
	real JW = 0
	location array KW
	group LW = null
	boolean MW = false
	boolean PW = false
	boolean QW = false
	boolean SW = false
	boolean TW = false
	string UW = ""
	// 相同英雄
	boolean Mode__SameHero = false
	boolean YW = true
	player ZW = null
	integer array VY
	integer EY = 0
	force XY = null
	boolean OY = false
	boolean RY = true
	boolean IY = true
	boolean array AY
	string NY = ""
	boolean array G3
	boolean Z3 = false
	string K3 = ""
	string array BY
	rect CY = null
	rect DY = null
	rect FY = null
	rect GY = null
	rect PY = null
	rect SY = null
	rect TY = null
	rect WY = null
	rect YY = null
	rect ZY = null
	rect VZ = null
	rect EZ = null
	rect XZ = null
	rect OZ = null
	rect RZ = null
	rect F4 = null
	rect G4 = null
	rect IZ = null
	rect AZ = null
	rect NZ = null
	rect BZ = null
	rect CZ = null
	rect DZ = null
	rect FZ = null
	rect GZ = null
	rect HZ = null
	rect JZ = null
	rect KZ = null
	rect LZ = null
	rect MZ = null
	rect PZ = null
	rect QZ = null
	rect SZ = null
	rect TZ = null
	rect UZ = null
	rect WZ = null
	rect YZ = null
	rect ZZ = null
	rect V0 = null
	rect E0 = null
	rect X0 = null
	rect O0 = null
	rect R0 = null
	rect I0 = null
	rect A0 = null
	rect N0 = null
	rect B0 = null
	rect J5 = null
	rect IA = null
	rect OA = null
	rect BA = null
	rect CA = null
	rect DA = null
	rect EA = null
	rect C0 = null
	rect D0 = null
	rect F0 = null
	rect G0 = null
	rect H0 = null
	rect J0 = null
	boolean ShouSiJuHuaB = true
	boolean JUHUABIEPAOB = true
	boolean SHUIZAODEZHUAB = true
	boolean WEIGOUCHILEB = true
	sound WEIGOUCHILE = null
	sound SHUIZAODEZHUA = null
	sound JUHUABIEPAO = null
	sound ShouSiJuHua = null
	sound OC = null
	sound AC = null
	sound BC = null
	sound K0 = null
	sound L0 = null
	sound M0 = null
	sound P0 = null
	sound Q0 = null
	sound S0 = null
	sound T0 = null
	sound KC = null
	sound LC = null
	sound U0 = null
	sound NC = null
	sound W0 = null
	sound MeldSound = null
	sound Z0 = null
	string XC = "Sound\\Music\\mp3Music\\Human1.mp3"
	string YC = "Sound\\Music\\mp3Music\\Human2.mp3"
	string JC = "Sound\\Music\\mp3Music\\Human3.mp3"
	string QC = "Sound\\Music\\mp3Music\\NightElf1.mp3"
	string UC = "Sound\\Music\\mp3Music\\NightElf2.mp3"
	string V1 = "Sound\\Music\\mp3Music\\NightElf3.mp3"
	string BD = "Sound\\Music\\mp3Music\\Orc1.mp3"
	string DD = "Sound\\Music\\mp3Music\\Orc2.mp3"
	string ED = "Sound\\Music\\mp3Music\\Orc3.mp3"
	string FD = "Sound\\Music\\mp3Music\\BloodElfTheme.mp3"
	string GD = "Sound\\Music\\mp3Music\\DarkAgents.mp3"
	string HD = "Sound\\Music\\mp3Music\\TragicConfrontation.mp3"
	string ZD = "Sound\\Music\\mp3Music\\SadMystery.mp3"
	string VD = "Sound\\Music\\mp3Music\\IllidansTheme.mp3"
	string IE = "Sound\\Music\\mp3Music\\Undead1.mp3"
	string OE = "Sound\\Music\\mp3Music\\Undead2.mp3"
	string AE = "Sound\\Music\\mp3Music\\Undead3.mp3"
	string DF = "Sound\\Music\\mp3Music\\Tension.mp3"
	string EF = "Sound\\Music\\mp3Music\\ArthasTheme.mp3"
	string FF = "Sound\\Music\\mp3Music\\NightElfDefeat.mp3"
	string GF = "Sound\\Music\\mp3Music\\NightElfVictory.mp3"
	sound E1 = null
	sound DevourMagicSound = null
	sound QD = null
	sound X1 = null
	sound O1 = null
	sound CE = null
	sound WallOfReplicaSound = null
	sound R1 = null
	sound FE = null
	sound GE = null
	sound XE = null
	sound I1 = null
	sound A1 = null
	sound ME = null
	sound NE = null
	sound SE = null
	sound RE = null
	sound PE = null
	sound B1 = null
	sound QE = null
	sound IF = null
	sound OF = null
	sound MirrorImageSound = null
	sound StaticStormTargetSound = null
	sound HintSound = null
	sound WalrusPunchSound = null
	sound WF = null
	sound XF = null
	sound KF = null
	sound LF = null
	sound MF = null
	sound SF = null
	trigger C1 = null
	trigger D1 = null
	trigger AG = null
	trigger F1 = null
	trigger G1 = null
	trigger H1 = null
	trigger J1 = null
	trigger K1 = null
	trigger L1 = null
	trigger P1 = null
	trigger Q1 = null
	trigger S1 = null
	trigger T1 = null
	trigger U1 = null
	trigger W1 = null
	trigger JG = null
	trigger KG = null
	trigger LG = null
	trigger MG = null
	trigger NeutralCreaturesRefreshTrig = null
	trigger SG = null
	trigger TG = null
	trigger QG = null
	trigger Y1 = null
	trigger IH = null
	trigger OH = null
	unit Z1 = null
	unit V2 = null
	unit X2 = null
	unit O2 = null
	unit R2 = null
	unit I2 = null
	unit A2 = null
	unit N2 = null
	unit B2 = null
	unit C2 = null
	unit F2 = null
	string G2 = ""
	destructable array JY
	destructable array KY
	destructable array LY
	integer MY = 0
	group array H2
	boolean array J2
	integer K2
	integer L2 = 0
	trigger array QY
	real array UY
	integer IJ = 0
	boolean array M2
	real array AJ
	integer array BJ
	integer array CJ
	integer DJ = 0
	string array EJ
	integer array FJ
	integer GJ = 0
	string HJ
	real ZJ
	integer P2 = 0
	sound WJ
	integer Q2 = 0
	integer Q22 = 0
	real S2
	real T2
	integer T22
	real TJ
	real RJ
	unit U2
	unit W2
	unit Y2
	item Z2 = null
	trigger V3
	group DK
	group EK
	player E3
	boolean X3 = false
	image R3 = null
	unit VK = null
	integer WK
	boolean IsNoHeroLimit = true
	trigger YK
	trigger JK
	region KK
	integer LK = 1
	boolean MK = false
	timer NK
	boolean A3 = false
	integer N3 = 90
	boolean B3 = false
	boolean PK = false
	string C3 = "No Mode"
	boolean Mode__NoRepick = false
	boolean Mode__NoSwap = false
	boolean Mode__PoolMode = false
	boolean BL = false
	boolean M3 = false

	integer array SL
	integer array Q3
	boolean array S3
	boolean array T3
	boolean array U3
	boolean array W3
	unit IM = null
	unit AM = null
	boolean BM = false
	player FM = null
	player GM = null
	boolean array HM
	integer VM
	player WM
	trigger XM = null
	boolean YM = false
	integer JM
	integer KM
	boolean V4 = false
	trigger hChooseHeroTrigger
	boolean IsChooseHeroEnd = false
	boolean X4 = false
	integer array O4
	region R4
	constant real ZN = 150
	integer array I4
	integer A4 = 0
	integer array N4
	integer array B4
	integer array C4
	integer array H4
	integer J4 = 0
	gamecache K4
	gamecache L4
	gamecache M4
	gamecache P4
	integer array Q4
	trigger PN
	integer array U4
	integer array W4
	integer array Y4
	weathereffect Z4 = null
	weathereffect V5 = null
	weathereffect E5 = null
	weathereffect X5 = null
	rect CS
	constant playercolor O5 = ConvertPlayerColor(0)
	constant playercolor R5 = ConvertPlayerColor(6)
	constant playercolor NeutralPassiveColor = ConvertPlayerColor($C)
	constant real HS =-7232
	constant real ZS =-7136
	unit SentinelsBuilding_FountainOfLife
	unit SentinelsShop_BlackMarket1
	unit SentinelsShop_BlackMarket2
	unit SentinelsShop_CacheOfTheQuelthelan
	unit SentinelsShop_WeaponsDealer
	unit SentinelsShop_GrylaTheAccessorizer
	unit SentinelsShop_AncientOfWonders
	unit SentinelsShop_ArcaneSanctum
	unit SentinelsShop_AncientWeaponry
	unit SentinelsShop_SupportiveVestments
	unit SentinelsShop_EnchantedArtifacts
	unit SentinelsShop_GatewayRelics
	unit SentinelsShop_Protectorate
	unit SentinelsBuilding_TheWorldTree
	unit SentinelsBuilding_AP_L1_TOP
	unit SentinelsBuilding_AP_L1_MID
	unit SentinelsBuilding_AP_L1_BOT
	unit SentinelsBuilding_AP_L2_TOP
	unit X6
	unit O6
	unit R6
	unit I6
	unit N6
	unit B6
	unit C6
	unit D6
	unit F6
	unit G6
	unit H6
	unit J6
	unit K6
	unit L6
	unit M6
	unit P6
	unit Q6
	unit T6
	unit U6
	unit W6
	unit Y6
	unit Z6
	unit V7
	unit E7
	unit X7
	unit O7
	unit R7
	unit I7
	constant real A7 = 6784
	constant real N7 = 6368
	unit B7
	unit C7
	unit D7
	unit F7
	unit G7
	unit H7
	unit J7
	unit K7
	unit L7
	unit M7
	unit P7
	unit Q7
	unit S7
	unit T7
	unit U7
	unit W7
	unit Y7
	unit Z7
	unit V8
	unit E8
	unit X8
	unit O8
	unit R8
	unit I8
	unit A8
	unit N8
	unit B8
	unit C8
	unit D8
	unit F8
	unit G8
	unit H8
	unit J8
	unit K8
	unit L8
	unit M8
	unit P8
	unit Q8
	unit S8
	unit T8
	unit U8
	unit W8
	unit Y8
	unit Z8
	unit VVV
	unit VEV
	unit VXV
	unit VOV
	unit VRV
	unit VIV
	unit VAV
	unit VNV
	unit VBV
	unit VCV
	unit VDV
	unit VFV
	unit array Circle
	real array VHV
	real array VJV
	player VKV
	player VLV
	string array VMV
	string array ObserverPlayersName
	integer array VPV
	integer array VQV
	integer array VSV
	integer array VTV
	integer array VUV
	integer VWV
	integer VYV
	integer VZV
	integer array V_V
	integer V0V
	integer array V1V
	integer V2V
	integer array V3V
	integer V4V
	integer array V5V
	integer V6V = 0
	integer array V7V
	integer V8V = 0
	string array V9V
	unit EVV
	unit EEV
	unit EXV
	unit EOV
	unit ERV
	unit EIV
	unit EAV
	unit ENV
	unit EBV
	unit ECV
	unit EDV
	unit EFV
	integer array EGV
	integer EHV = 0
	boolean array EJV
	integer EKV = 0
	integer ELV
	player EMV
	trigger AddGoldForIntervalTrig
	trigger EQV
	timer array ESV
	timer array ETV
	integer array EUV
	real array AssistTime
	integer array EYV
	integer array EZV
	integer AssistListCurrentMaxNumber = 1
	constant real E0V = 18
	player array E1V
	unit E2V
	unit E3V
	integer E4V
	integer array E5V
	integer array E6V
	unit E7V = null
	boolean E8V = true
	integer E9V = 1
	trigger XVV
	integer XEV = 0
	integer array PowerUpItemTypeId
	integer array RealItemTypeId
	integer array SellItemTypeId
	integer array InvalidItemTypeId
	string array itemIconPath
	integer array XNV
	integer ItemMaxNum = 0
	integer XCV
	integer XDV
	integer XFV
	integer XGV
	integer XHV
	integer XJV
	integer XKV
	integer XLV
	integer XMV
	integer it_hyzr
	integer it_fj
	integer Item_DragonLance
	integer it_xj
	integer jz_xj
	integer Item_HurricanePike
	integer Recipe_HurricanePike
	integer XPV
	integer XQV
	integer XSV
	integer XTV
	integer XUV
	integer XWV
	integer XYV
	integer XZV
	integer X_V
	integer X0V
	integer X1V
	integer X2V
	integer X3V
	integer X4V
	integer X5V
	integer X6V
	integer X7V
	integer Item_IronwoodBranch
	integer X9V
	integer OVV
	integer OEV
	integer OXV
	integer OOV
	integer ORV
	integer OIV
	integer OAV
	integer Item_PlaneswalkerCloak
	integer OBV
	integer OCV
	integer ODV
	integer OFV
	integer OGV
	integer OHV
	integer OJV
	integer OKV
	integer OLV
	integer OMV
	integer OPV
	integer StoutShield_melee
	integer StoutShield_ranged
	integer OTV
	integer OUV
	integer OWV
	integer Item_Javelin
	integer OZV
	integer O_V
	integer O0V
	integer O1V
	integer O2V
	integer O3V
	integer O4V
	integer O5V
	integer O6V
	integer O7V
	integer O8V
	integer Item_MagicStick
	integer QuellingBlade_Melee
	integer QuellingBlade_Ranged
	integer RXV
	integer ROV
	integer RRV
	integer RIV
	integer RAV
	integer RNV
	integer RBV
	integer RCV
	integer Item_MoonShard
	integer RFV
	integer RGV
	integer RHV
	integer RJV
	integer RKV
	integer Item_SilverEdge
	integer RMV
	integer RPV
	integer Item_GlimmerCape
	integer RSV
	integer RTV
	integer RUV
	integer RWV
	integer RYV
	integer RZV
	integer R_V
	integer R0V
	integer R1V
	integer R2V
	integer R3V
	integer R4V
	integer R5V
	integer R6V
	integer R7V
	integer R8V
	integer R9V
	integer IVV
	integer IEV
	integer IXV
	integer IOV
	integer IRV
	integer IIV
	integer IAV
	integer INV
	integer IBV
	integer ICV
	integer IDV
	integer IFV
	integer IGV
	integer IHV
	integer IJV
	integer IKV
	integer ILV
	integer IMV
	integer Item_Sange
	integer IQV
	integer ISV
	integer ITV
	integer Item_DiffusalBladeLevel1
	integer Item_DiffusalBladeLevel2
	integer Item_DiffusalBladeLevel1_Empty
	integer IZV
	integer I_V
	integer I0V
	integer I1V
	integer Item_EulScepterOfDivinity
	integer I3V
	integer I4V
	integer Item_SangeAndYasha
	unit array I5VV
	integer Item_StygianDesolator
	integer Item_BattleFury
	integer I8V
	integer I9V
	integer AVV
	integer AEV
	integer AXV
	integer AOV
	integer ARV
	integer AIV
	integer AAV
	integer ANV
	integer ABV
	integer ACV
	integer ADV
	integer AFV
	integer AGV
	integer AHV
	integer AJV
	integer AKV
	integer ALV
	integer AMV
	integer APV
	integer AQV
	integer ASV
	integer ATV
	integer AUV
	integer Item_MonkeyKingBar
	integer AYV
	integer AZV
	integer A_V
	integer A0V
	integer A1V
	integer A2V
	integer A3V
	integer A4V
	integer A5V
	integer A6V
	integer A7V
	integer Vanguard_melee
	integer Vanguard_ranged
	integer NVV
	integer NEV
	integer NXV
	integer NOV
	integer NRV
	integer NIV
	integer NAV
	integer Item_HoodOfDefiance
	integer NBV
	integer NCV
	integer NDV
	integer NFV
	integer NGV
	integer NHV
	integer NJV
	integer NKV
	integer Item_MagicWand
	integer NMV
	integer Item_KhadgarPipeOfInsight
	integer NQV
	integer NSV
	integer Item_GhostScepter
	integer NUV
	integer NWV
	integer NYV
	integer NZV
	integer N_V
	integer N0V
	integer Item_HeavenHalberd
	integer N2V
	integer N3V
	integer N4V
	integer N5V
	integer N6V
	integer N7V
	integer N8V
	integer N9V
	integer BVV
	integer BEV
	integer BXV
	integer BOV
	integer BRV
	integer BIV
	integer BAV
	integer BNV
	integer BBV
	integer BCV
	integer BDV
	integer BFV
	integer BGV
	integer BHV
	integer BJV
	integer BKV
	integer BLV
	integer BMV
	integer BPV
	integer BQV
	integer BSV
	integer BTV
	integer BUV
	integer BWV
	integer BYV
	integer BZV
	integer B_V
	integer B0V
	integer B1V
	integer B2V
	integer B3V
	integer B4V
	integer B5V
	integer B6V
	integer B7V
	integer B8V
	integer B9V
	integer CVV
	trigger RuneRefreshTrigger
	integer CXV = 0
	integer array COV
	integer array CRV
	integer array CIV
	integer array CAV
	integer array CNV
	integer array CBV
	integer CCV = 0
	integer array CDV
	integer array CFV
	integer array CGV
	integer array CHV
	integer array CJV
	integer array CKV
	integer array CLV
	player CMV
	unit CPV
	group array CPVV
	unit CQV
	boolean array CQVV
	integer CSV
	unit CTV
	integer CTVV
	trigger CUV
	integer CWV = 0
	integer HaveBlinkDaggerCount 			= 0
	integer CZV = 0
	integer HaveHeartofTarrasqueCount 		= 0
	integer HaveTranquilBootsCount 			= 0
	integer QuellItemCount 					= 0
	integer StoutShieldCount				= 0
	integer VanguardCount					= 0
	integer BattleFuryCount					= 0
	integer StygianDesolatorCount			= 0
	integer	array ItemsCount
	
	boolean C2V = false
	trigger C3V
	unit C4V = null
	real array C5V
	player C5VV
	real array C6V
	integer array C7V
	integer array C8V
	real array C9V
	real array DVV
	player array DEV
	real array DXV
	real array DOV
	real array DRV
	integer DIV =-1
	constant real ScrollOfTownPortal_Max_Range = 525
	region DNV

	// BKB魔免的魔法书
	integer DBV ='A0FY'
	unit DCV
	unit DDV
	group DFV
	unit DGV
	unit DHV
	player DJV
	boolean DKV = false
	boolean DLV = false
	boolean DMV = false
	boolean array DPV
	player DQV
	boolean DSV = false
	boolean DTV = false
	boolean DUV = false
	boolean DWV = false
	boolean DYV = false
	boolean DZV = false
	boolean D_V = false
	boolean D0V = false
	integer array D1V
	integer array D2V
	integer D3V = 0
	integer D4V = 0
	integer D5V = 0
	multiboard D6V
	integer array D7V
	integer array D8V
	player array D9V
	integer FVV = 0
	multiboard FEV
	trigger FXV
	constant real FOV = 90
	boolean FRV = false
	unit FIV = null
	unit FAV = null
	group FNV
	//integer FBV = 0
	//string array FCV
	integer FDV
	player FFV
	integer FGV
	integer FHV ='A0HU'
	integer FJV ='A0HX'
	trigger FKV
	region FLV
	boolean FMV = false
	boolean FPV = false
	boolean FQV = false
	unit array FSV
	group FTV
	unit FUV
	integer FWV
	integer FYV = 0
	integer array FZV
	boolean array F_V
	boolean array F0V
	boolean F1V = true
	boolean array F2V
	real F3V =-$C8
	boolean array F4V
	leaderboard array F5V
	boolean array F6V
	boolean F7V = true
	weathereffect F8V
	boolean array F9V
	boolean array NeedHideHeroNames
	boolean array GEV
	boolean array GXV
	boolean GOV = true
	boolean array GRV
	string array GIV
	integer GAV = 0
	string GNV = "Sound\\Music\\mp3Music\\PH1.mp3"
	boolean array GBV
	integer GCV
	integer GDV
	integer GFV
	boolean GGV = false
	trigger GHV
	boolean GJV = false
	boolean GKV = false
	boolean GLV = false
	boolean GMV = false
	boolean Mode__OnlyMid = false
	boolean Mode__NoBot = false
	boolean Mode__NoMid = false
	boolean Mode__NoTop = false
	boolean GUV = false
	boolean Mode__ObserverInfo = false
	boolean Mode__FastRespawn = false
	boolean Mode__ZoomMode = false
	camerasetup G_V = null
	boolean Mode__UnlimitedLevel = false
	boolean Mode__SeeSkills = false
	boolean Mode__AntiBackdoor = false
	boolean Mode__FiveSkills = false
	boolean Mode__SixSkills = false
	// 小模式 - 立即刷野
	boolean Mode__FastNeutrals = false
	boolean Mode__Draft20 = false
	boolean Mode__Draft30 = false
	boolean Mode__Draft40 = false
	boolean Mode__Draft50 = false
	boolean Mode__OneSkill = false
	// 小模式 - 关闭平衡
	boolean Mode__BalanceOff = false
	boolean Mode__RearmCombos = false
	boolean Mode__MirrorDraft = false
	boolean Mode__RandomExtraAbilities = false
	boolean Mode__LimitSkills3 = false
	boolean Mode__LimitSkills2 = false
	// 小模式 - 快速结束
	boolean Mode__FastFinish = false
	// 小模式 - 无野怪
	boolean Mode__NoNeutrals = false
	group HCV
	unit HDV
	integer HFV
	integer HGV = 0
	integer array HHV
	real HJV
	unit HKV
	integer HLV
	unit HMV
	integer HPV
	unit HQV
	real HSV
	unit HTV
	real HUV
	integer HWV
	integer HYV
	unit HZV
	real H_V
	unit array H0V
	integer H1V
	integer H2V
	real H3V
	unit H4V
	unit array H5V
	real H6V
	real H7V
	integer H8V
	integer H9V
	unit JVV
	real JEV
	real JXV
	real JOV
	unit JRV
	unit array JIV
	unit JAV
	integer JNV
	unit JBV
	real JCV
	real JDV
	real JFV
	integer JGV = 0
	real JHV
	real JJV
	integer JKV
	real JLV
	unit JMV
	unit JPV
	group JQV
	group JSV
	group JTV
	unit JUV
	unit JWV
	real JYV
	integer array JZV
	unit J_V
	integer J0V
	unit J1V
	unit J2V
	real J3V
	real J4V
	real J5V
	real J6V
	boolean J7V = false
	boolean J8V = false
	unit J9V
	real KVV
	unit KEV
	unit KXV
	real KOV
	integer KRV
	unit KIV
	unit KAV
	group KNV
	integer KBV
	group KCV
	unit KDV
	real KFV
	destructable KGV = null
	unit KHV = null
	real KJV = 0
	constant real KKV = 26
	constant real KLV = 500
	real KMV
	real KPV
	group KQV
	unit KSV
	real KTV
	integer KUV
	integer KWV
	unit KYV
	unit KZV
	integer K_V
	boolean K0V = false
	unit K1V
	integer array K2V
	integer array K3V
	integer array K4V
	integer array K5V
	unit K6V
	integer K7V
	real K8V
	real K9V
	unit LVV
	boolean LEV = false
	integer LXV
	unit LOV
	unit LRV
	real LIV
	real LAV
	unit LNV
	unit LBV
	unit LCV
	real LDV
	real LFV
	real LGV
	integer LHV

	unit LMV
	integer LPV
	group SoulRipTempGroup

	player LWV
	integer LYV
	unit array LZV
	group L_V
	integer L0V
	real L1V
	unit L2V
	trigger L3V
	trigger L4V
	integer L5V = 0
	unit L6V
	real L7V
	real L8V
	real L9V
	unit MVV
	unit MEV
	unit MXV
	group MOV
	real MRV
	unit MIV
	integer MAV
	unit MNV
	integer MBV
	unit MCV
	group MDV
	integer MFV
	unit MGV
	real MHV
	unit MJV
	real MKV
	integer MLV
	unit array MMV
	unit MPV
	unit MQV
	real MSV
	unit MTV
	unit MUV
	unit MWV
	integer MYV
	unit array MZV
	boolean M_V = false
	unit M0V
	integer M1V
	real array M2V
	real array M3V
	unit array M4V
	integer array M5V
	integer array M6V
	integer M7V
	integer M8V
	unit M9V
	group PVV
	integer PEV
	unit PXV
	unit POV
	integer PRV
	unit PIV
	group PAV
	unit PNV
	real PBV
	real PCV
	real PDV
	real PFV
	constant real PGV = 325
	unit PHV
	unit PJV
	integer PKV
	real PLV
	unit PMV
	boolean PPV = false
	unit PQV
	real PSV
	unit PTV
	integer PUV
	integer PWV
	group PYV
	integer PZV
	region P_V
	region P0V
	unit P1V
	integer P2V
	group P3V
	group P4V
	unit P5V
	unit P6V
	unit P7V
	integer P8V
	real P9V
	real QVV
	unit QEV
	unit QXV
	unit QOV
	group QRV
	real QIV
	integer array QAV
	integer QNV = 0
	integer QBV
	unit QCV
	integer QDV
	integer QFV
	unit QGV
	real QHV
	real QJV
	real QKV
	unit QLV
	integer array QMV
	integer array QPV
	integer QQV
	integer QSV
	integer QTV
	sound QUV = null
	integer QWV
	integer QYV
	group QZV
	unit Q_V
	integer Q0V
	force Q1V = null
	boolexpr Q2V = null

	conditionfunc TrueBoolexprCondition = null
	
	boolean array Q3V
	trigger Q4V
	unit Q5V
	unit Q6V
	group Q7V = CreateGroup()
	boolean Q8V = false
	
endglobals

native UnitAlive takes unit u returns boolean
// 保存值
native DzAPI_Map_SaveServerValue        takes player whichPlayer, string key, string value returns boolean
// 获取值
native DzAPI_Map_GetServerValue         takes player whichPlayer, string key returns string
// 当前模式
native DzAPI_Map_GetMatchType      		takes nothing returns integer

library BlzAPI
	globals
		// BlzApi UIEvent 的一些常量
	
		// 按下事件
		constant integer FRAME_EVENT_PRESSED = 1
		// 鼠标进入
		constant integer FRAME_MOUSE_ENTER = 2
		// 鼠标离开
		constant integer FRAME_MOUSE_LEAVE = 3
		// 鼠标按下
		constant integer FRAME_MOUSE_UP = 4
		// 鼠标弹起
		constant integer FRAME_MOUSE_DOWN = 5
		// 鼠标滚轮
		constant integer FRAME_MOUSE_WHEEL = 6
		// 激活焦点
		constant integer FRAME_FOCUS_ENTER = FRAME_MOUSE_ENTER
		// 取消焦点
		constant integer FRAME_FOCUS_LEAVE = FRAME_MOUSE_LEAVE
		// 激活复选框
		constant integer FRAME_CHECKBOX_CHECKED = 7
		// 取消复选框
		constant integer FRAME_CHECKBOX_UNCHECKED = 8
		// 对话框文字改变
		constant integer FRAME_EDITBOX_TEXT_CHANGED = 9
		// 开始弹出菜单项目 (POPUPMENU类似于大厅选种族)
		constant integer FRAME_POPUPMENU_ITEM_CHANGE_START = 10
		// 弹出的菜单项目被更改
		constant integer FRAME_POPUPMENU_ITEM_CHANGED = 11
		// 鼠标双击 但没找到能响应双击事件的UI
		constant integer FRAME_MOUSE_DOUBLECLICK = 12
		// 模型动画更新
		constant integer FRAME_SPRITE_ANIM_UPDATE = 13
	
		// UI Positions framepointtype
	
		// 左上
		constant integer FRAMEPOINT_TOPLEFT = 0
		// 上
		constant integer FRAMEPOINT_TOP = 1
		// 右上
		constant integer FRAMEPOINT_TOPRIGHT = 2
		// 左
		constant integer FRAMEPOINT_LEFT = 3
		// 中间
		constant integer FRAMEPOINT_CENTER = 4
		// 右
		constant integer FRAMEPOINT_RIGHT = 5
		// 左下
		constant integer FRAMEPOINT_BOTTOMLEFT = 6
		// 下
		constant integer FRAMEPOINT_BOTTOM = 7
		// 右下
		constant integer FRAMEPOINT_BOTTOMRIGHT = 8
		
	endglobals

	// 获取鼠标在游戏内的坐标X
	native DzGetMouseTerrainX takes nothing returns real
	// 获取鼠标在游戏内的坐标Y
	native DzGetMouseTerrainY takes nothing returns real
	// 获取鼠标在游戏内的坐标Z
	native DzGetMouseTerrainZ takes nothing returns real
	// 鼠标是否在游戏内
	native DzIsMouseOverUI takes nothing returns boolean
	// 获取鼠标屏幕坐标X
	native DzGetMouseX takes nothing returns integer
	// 获取鼠标屏幕坐标Y
	native DzGetMouseY takes nothing returns integer
	// 获取鼠标游戏窗口坐标X
	native DzGetMouseXRelative takes nothing returns integer
	// 获取鼠标游戏窗口坐标Y
	native DzGetMouseYRelative takes nothing returns integer
	// 设置鼠标位置
	native DzSetMousePos takes integer x, integer y returns nothing
	// 注册鼠标点击触发（sync为true时，调用TriggerExecute。为false时，直接运行action函数，可以异步不掉线，action里不要有同步操作）
	native DzTriggerRegisterMouseEvent takes trigger trig, integer btn, integer status, boolean sync, string func returns nothing
	// 注册鼠标点击触发（sync为true时，调用TriggerExecute。为false时，直接运行action函数，可以异步不掉线，action里不要有同步操作）
	native DzTriggerRegisterMouseEventByCode takes trigger trig, integer btn, integer status, boolean sync, code funcHandle returns nothing
	// 注册键盘点击触发
	native DzTriggerRegisterKeyEvent takes trigger trig, integer key, integer status, boolean sync, string func returns nothing
	// 注册键盘点击触发
	native DzTriggerRegisterKeyEventByCode takes trigger trig, integer key, integer status, boolean sync, code funcHandle returns nothing
	// 注册鼠标滚轮触发
	native DzTriggerRegisterMouseWheelEvent takes trigger trig, boolean sync, string func returns nothing
	// 注册鼠标滚轮触发
	native DzTriggerRegisterMouseWheelEventByCode takes trigger trig, boolean sync, code funcHandle returns nothing
	// 注册鼠标移动触发
	native DzTriggerRegisterMouseMoveEvent takes trigger trig, boolean sync, string func returns nothing
	// 注册鼠标移动触发
	native DzTriggerRegisterMouseMoveEventByCode takes trigger trig, boolean sync, code funcHandle returns nothing
	// 获取触发器的按键码
	native DzGetTriggerKey takes nothing returns integer
	// 获取滚轮delta
	native DzGetWheelDelta takes nothing returns integer
	// 判断按键是否按下
	native DzIsKeyDown takes integer iKey returns boolean
	// 获取触发key的玩家
	native DzGetTriggerKeyPlayer takes nothing returns player
	// 获取war3窗口宽度
	native DzGetWindowWidth takes nothing returns integer
	// 获取war3窗口高度
	native DzGetWindowHeight takes nothing returns integer
	// 获取war3客户窗口宽度
	native DzGetClientWidth takes nothing returns integer
	// 获取war3客户窗口高度
	native DzGetClientHeight takes nothing returns integer
	// 获取war3窗口X坐标
	native DzGetWindowX takes nothing returns integer
	// 获取war3窗口Y坐标
	native DzGetWindowY takes nothing returns integer
	// 注册war3窗口大小变化事件
	native DzTriggerRegisterWindowResizeEvent takes trigger trig, boolean sync, string func returns nothing
	// 注册war3窗口大小变化事件
	native DzTriggerRegisterWindowResizeEventByCode takes trigger trig, boolean sync, code funcHandle returns nothing
	// 判断窗口是否激活
	native DzIsWindowActive takes nothing returns boolean
	// 设置可摧毁物位置
	native DzDestructablePosition takes destructable d, real x, real y returns nothing
	// 设置单位位置-本地调用
	native DzSetUnitPosition takes unit whichUnit, real x, real y returns nothing
	// 异步执行函数
	native DzExecuteFunc takes string funcName returns nothing
	// 取鼠标指向的单位
	native DzGetUnitUnderMouse takes nothing returns unit
	// 设置单位的贴图
	native DzSetUnitTexture takes unit whichUnit, string path, integer texId returns nothing
	//  设置内存数值
	native DzSetMemory takes integer address, real value returns nothing
	//  替换单位类型 [BZAPI]
	native DzSetUnitID takes unit whichUnit, integer id returns nothing
	//  替换单位模型 [BZAPI]
	native DzSetUnitModel takes unit whichUnit, string path returns nothing
	// 获取本地语言
	native DzGetLocale takes nothing returns string
	// 获取单位升级需要剩余经验值
	native DzGetUnitNeededXP takes unit whichUnit, integer level returns integer
	//  原生 - 设置小地图背景贴图
	native DzSetWar3MapMap takes string map returns nothing
	// 注册数据同步触发器
	native DzTriggerRegisterSyncData takes trigger trig, string prefix, boolean server returns nothing
	// 同步游戏数据
	native DzSyncData takes string prefix, string data returns nothing
	// 获取同步的数据
	native DzGetTriggerSyncData takes nothing returns string
	// 获取同步数据的玩家
	native DzGetTriggerSyncPlayer takes nothing returns player
	// 隐藏界面元素
	native DzFrameHideInterface takes nothing returns nothing
	// 修改游戏世界窗口位置
	native DzFrameEditBlackBorders takes real upperHeight, real bottomHeight returns nothing
	// 头像
	native DzFrameGetPortrait takes nothing returns integer
	// 小地图
	native DzFrameGetMinimap takes nothing returns integer
	// 技能按钮
	native DzFrameGetCommandBarButton takes integer row, integer column returns integer
	// 英雄按钮
	native DzFrameGetHeroBarButton takes integer buttonId returns integer
	// 英雄血条
	native DzFrameGetHeroHPBar takes integer buttonId returns integer
	// 英雄蓝条
	native DzFrameGetHeroManaBar takes integer buttonId returns integer
	// 道具按钮
	native DzFrameGetItemBarButton takes integer buttonId returns integer
	// 小地图按钮
	native DzFrameGetMinimapButton takes integer buttonId returns integer
	// 左上菜单按钮
	native DzFrameGetUpperButtonBarButton takes integer buttonId returns integer
	// 鼠标提示
	native DzFrameGetTooltip takes nothing returns integer
	// 聊天信息
	native DzFrameGetChatMessage takes nothing returns integer
	// 单位信息
	native DzFrameGetUnitMessage takes nothing returns integer
	// 获取最上的信息
	native DzFrameGetTopMessage takes nothing returns integer
	// 取rgba色值
	native DzGetColor takes integer r, integer g, integer b, integer a returns integer
	// 设置界面更新回调（非同步）
	native DzFrameSetUpdateCallback takes string func returns nothing
	// 界面更新回调
	native DzFrameSetUpdateCallbackByCode takes code funcHandle returns nothing
	// 显示/隐藏窗体
	native DzFrameShow takes integer frame, boolean enable returns nothing
	// 创建窗体
	native DzCreateFrame takes string frame, integer parent, integer id returns integer
	// 创建简单的窗体
	native DzCreateSimpleFrame takes string frame, integer parent, integer id returns integer
	// 销毁窗体
	native DzDestroyFrame takes integer frame returns nothing
	// 加载内容目录 (Toc table of contents)
	native DzLoadToc takes string fileName returns nothing
	// 设置窗体相对位置 [0:左上|1:上|2:右上|3:左|4:中|5:右|6:左下|7:下|8:右下]
	native DzFrameSetPoint takes integer frame, integer point, integer relativeFrame, integer relativePoint, real x, real y returns nothing
	// 设置窗体绝对位置
	native DzFrameSetAbsolutePoint takes integer frame, integer point, real x, real y returns nothing
	// 清空窗体锚点
	native DzFrameClearAllPoints takes integer frame returns nothing
	// 设置窗体禁用/启用
	native DzFrameSetEnable takes integer name, boolean enable returns nothing
	// 注册用户界面事件回调
	native DzFrameSetScript takes integer frame, integer eventId, string func, boolean sync returns nothing
	//  注册UI事件回调(func handle)
	native DzFrameSetScriptByCode takes integer frame, integer eventId, code funcHandle, boolean sync returns nothing
	// 获取触发用户界面事件的玩家
	native DzGetTriggerUIEventPlayer takes nothing returns player
	// 获取触发用户界面事件的窗体
	native DzGetTriggerUIEventFrame takes nothing returns integer
	// 通过名称查找窗体
	native DzFrameFindByName takes string name, integer id returns integer
	// 通过名称查找普通窗体
	native DzSimpleFrameFindByName takes string name, integer id returns integer
	// 查找字符串
	native DzSimpleFontStringFindByName takes string name, integer id returns integer
	// 查找BACKDROP frame
	native DzSimpleTextureFindByName takes string name, integer id returns integer
	// 获取游戏用户界面
	native DzGetGameUI takes nothing returns integer
	// 点击窗体
	native DzClickFrame takes integer frame returns nothing
	// 自定义屏幕比例
	native DzSetCustomFovFix takes real value returns nothing
	// 使用宽屏模式
	native DzEnableWideScreen takes boolean enable returns nothing
	// 设置文字（支持EditBox, TextFrame, TextArea, SimpleFontString、GlueEditBoxWar3、SlashChatBox、TimerTextFrame、TextButtonFrame、GlueTextButton）
	native DzFrameSetText takes integer frame, string text returns nothing
	// 获取文字（支持EditBox, TextFrame, TextArea, SimpleFontString）
	native DzFrameGetText takes integer frame returns string
	// 设置字数限制（支持EditBox）
	native DzFrameSetTextSizeLimit takes integer frame, integer size returns nothing
	// 获取字数限制（支持EditBox）
	native DzFrameGetTextSizeLimit takes integer frame returns integer
	// 设置文字颜色（支持TextFrame, EditBox）
	native DzFrameSetTextColor takes integer frame, integer color returns nothing
	// 获取鼠标所在位置的用户界面控件指针
	native DzGetMouseFocus takes nothing returns integer
	// 设置所有锚点到目标窗体上
	native DzFrameSetAllPoints takes integer frame, integer relativeFrame returns boolean
	// 设置焦点
	native DzFrameSetFocus takes integer frame, boolean enable returns boolean
	// 设置模型（支持Sprite、Model、StatusBar）
	native DzFrameSetModel takes integer frame, string modelFile, integer modelType, integer flag returns nothing
	// 获取控件是否启用
	native DzFrameGetEnable takes integer frame returns boolean
	// 设置透明度（0-255）
	native DzFrameSetAlpha takes integer frame, integer alpha returns nothing
	// 获取透明度（0-255）
	native DzFrameGetAlpha takes integer frame returns integer
	// 设置动画
	native DzFrameSetAnimate takes integer frame, integer animId, boolean autocast returns nothing
	// 设置动画进度（autocast为false是可用）
	native DzFrameSetAnimateOffset takes integer frame, real offset returns nothing
	// 设置texture（支持Backdrop、SimpleStatusBar）
	native DzFrameSetTexture takes integer frame, string texture, integer flag returns nothing
	// 设置缩放
	native DzFrameSetScale takes integer frame, real scale returns nothing
	// 设置提示
	native DzFrameSetTooltip takes integer frame, integer tooltip returns nothing
	// 鼠标限制在用户界面内
	native DzFrameCageMouse takes integer frame, boolean enable returns nothing
	// 获取当前值（支持Slider、SimpleStatusBar、StatusBar）
	native DzFrameGetValue takes integer frame returns real
	// 设置最大最小值（支持Slider、SimpleStatusBar、StatusBar）
	native DzFrameSetMinMaxValue takes integer frame, real minValue, real maxValue returns nothing
	// 设置Step值（支持Slider）
	native DzFrameSetStepValue takes integer frame, real step returns nothing
	// 设置当前值（支持Slider、SimpleStatusBar、StatusBar）
	native DzFrameSetValue takes integer frame, real value returns nothing
	// 设置窗体大小
	native DzFrameSetSize takes integer frame, real w, real h returns nothing
	// 根据tag创建窗体
	native DzCreateFrameByTagName takes string frameType, string name, integer parent, string template, integer id returns integer
	// 设置颜色（支持SimpleStatusBar）
	native DzFrameSetVertexColor takes integer frame, integer color returns nothing
	// 不明觉厉
	native DzOriginalUIAutoResetPoint takes boolean enable returns nothing
	//  设置优先级 [NEW]
	native DzFrameSetPriority takes integer frame, integer priority returns nothing
	//  设置父窗口 [NEW]
	native DzFrameSetParent takes integer frame, integer parent returns nothing
	//  设置字体 [NEW]
	native DzFrameSetFont takes integer frame, string fileName, real height, integer flag returns nothing
	//  获取 Frame 的 高度 [NEW]
	native DzFrameGetHeight takes integer frame returns real
	//  设置对齐方式 [NEW]
	native DzFrameSetTextAlignment takes integer frame, integer align returns nothing
	//  获取 Frame 的 Parent [NEW]
	native DzFrameGetParent takes integer frame returns integer

	native DzUnitDisableInventory takes unit u, boolean b returns nothing
	native DzUnitDisableAttack takes unit u, boolean b returns nothing
	native DzUnitSilence takes unit u, boolean b returns nothing
		
endlibrary
		
	

native EXGetUnitReal takes integer unitcode, integer Type returns real
native EXSetUnitReal takes integer unitcode,integer Type,real value returns boolean
native EXGetUnitString takes integer unitcode, integer Type returns string
native EXSetUnitString takes integer unitcode,integer Type,string value returns boolean
native EXGetUnitAbility takes unit u, integer abilcode returns ability
native EXGetUnitAbilityByIndex takes unit u, integer index returns ability
native EXGetAbilityId takes ability abil returns integer
native EXGetAbilityState takes ability abil, integer state_type returns real
native EXSetAbilityState takes ability abil, integer state_type, real value returns boolean
native EXGetAbilityDataReal takes ability abil, integer level, integer data_type returns real
native EXSetAbilityDataReal takes ability abil, integer level, integer data_type, real value returns boolean
native EXGetAbilityDataInteger takes ability abil, integer level, integer data_type returns integer
native EXSetAbilityDataInteger takes ability abil, integer level, integer data_type, integer value returns boolean
native EXGetAbilityDataString takes ability abil, integer level, integer data_type returns string
native EXSetAbilityDataString takes ability abil, integer level, integer data_type, string value returns boolean
native EXSetAbilityAEmeDataA takes ability abil, integer unitid returns boolean
native EXDisplayChat takes player p, integer chat_recipient, string message returns nothing
native EXGetEventDamageData takes integer edd_type returns integer
native EXSetEventDamage takes real amount returns boolean
native EXSetUnitFacing takes unit u, real angle returns nothing
native EXPauseUnit takes unit u, boolean flag returns nothing
native EXSetUnitCollisionType takes boolean enable, unit u, integer t returns nothing
native EXSetUnitMoveType takes unit u, integer t returns nothing
native EXGetItemDataString takes integer itemcode, integer data_type returns string
native EXSetItemDataString takes integer itemcode, integer data_type, string value returns boolean
native EXGetEffectX takes effect e returns real
native EXGetEffectY takes effect e returns real
native EXGetEffectZ takes effect e returns real
native EXSetEffectXY takes effect e, real x, real y returns nothing
native EXSetEffectZ takes effect e, real z returns nothing
native EXGetEffectSize takes effect e returns real
native EXSetEffectSize takes effect e, real size returns nothing
native EXEffectMatRotateX takes effect e, real angle returns nothing
native EXEffectMatRotateY takes effect e, real angle returns nothing
native EXEffectMatRotateZ takes effect e, real angle returns nothing
native EXEffectMatScale takes effect e, real x, real y, real z returns nothing
native EXEffectMatReset takes effect e returns nothing
native EXSetEffectSpeed takes effect e, real speed returns nothing
native EXExecuteScript takes string script returns string


//单位添加眩晕
function YDWEUnitAddStun takes unit u returns nothing
	call EXPauseUnit(u , true)
endfunction

//单位删除眩晕
function YDWEUnitRemoveStun takes unit u returns nothing
	call EXPauseUnit(u , false)
endfunction

//判断是否是物理伤害
function YDWEIsEventPhysicalDamage takes nothing returns boolean
	return 0 != EXGetEventDamageData(1)
endfunction
//判断是否是攻击伤害
function YDWEIsEventAttackDamage takes nothing returns boolean
	return 0 != EXGetEventDamageData(2)
endfunction

//判断是否是范围伤害
function YDWEIsEventRangedDamage takes nothing returns boolean
	return 0 != EXGetEventDamageData(3)
endfunction

//判断伤害类型
function YDWEIsEventDamageType takes damagetype damageType returns boolean
	return damageType == ConvertDamageType(EXGetEventDamageData(4))
endfunction

//判断武器类型
function YDWEIsEventWeaponType takes weapontype weaponType returns boolean
	return weaponType == ConvertWeaponType(EXGetEventDamageData(5))
endfunction

//判断攻击类型
function YDWEIsEventAttackType takes attacktype attackType returns boolean
	return attackType == ConvertAttackType(EXGetEventDamageData(6))
endfunction
//设置伤害
function YDWESetEventDamage takes real amount returns boolean
	return EXSetEventDamage(amount)
endfunction

// 物品----------------------------------------------------

///<summary>设置物品数据 (字符串) [JAPI]</summary>
function YDWESetItemDataString takes integer itemcode, integer data_type, string value returns boolean
	return EXSetItemDataString(itemcode, data_type, value)
endfunction
///<summary>获取物品数据 (字符串) [JAPI]</summary>
function YDWEGetItemDataString takes integer itemcode, integer data_type returns string
	return EXGetItemDataString(itemcode, data_type)
endfunction

//获取玩家当前选择的单位
function GetPlayerSelectedUnit takes nothing returns unit
	return GetDetectedUnit() // lua hook了此函数 返回的是message.selection()
endfunction

// 获取玩家技能栏里的技能
function GetLocalAbilityId takes integer x, integer y returns integer
    return GetStartLocPrioSlot(x, y) // lua hook了此函数 返回的是message.button(x, y)
endfunction



// 修正单位的技能 变身会导致单位非法拥有被动技能
function FixUnitSkillsBug takes unit u returns nothing
	local integer i = 1
	local integer lv
	return 
	loop
		set lv = GetUnitAbilityLevel(u, PassiveSkills_Learned[i])
		if lv == 0 and(GetUnitAbilityLevel(u, PassiveSkills_Real[i])> 0 or GetUnitAbilityLevel(u, PassiveSkills_SpellBook[i])> 0 or GetUnitAbilityLevel(u, PassiveSkills_Buff[i])> 0) then
			call UnitRemoveAbility(u, PassiveSkills_Real[i])
			call UnitRemoveAbility(u, PassiveSkills_SpellBook[i])
			call UnitRemoveAbility(u, PassiveSkills_Buff[i])
			call UnitRemoveAbility(u, PassiveSkills_Show[i])
		endif
		set i = i + 1
	exitwhen i > MaxPassiveSkillsNum
	endloop
endfunction

// 单位逆变身
function YDWEUnitTransform takes unit whichUnit, integer targetid returns nothing
	if GetUnitTypeId(whichUnit) != targetid then
		call UnitAddAbility(whichUnit, 'M000')
		call YDWESetUnitAbilityDataInteger(whichUnit, 'M000', 1, 117, GetUnitTypeId(whichUnit))
		call EXSetAbilityAEmeDataA(EXGetUnitAbility(whichUnit, 'M000'), GetUnitTypeId(whichUnit))
		call UnitRemoveAbility(whichUnit, 'M000')
		call UnitAddAbility(whichUnit, 'M000')
		call EXSetAbilityAEmeDataA(EXGetUnitAbility(whichUnit, 'M000'), targetid)
		call UnitRemoveAbility(whichUnit, 'M000')
		// 修正单位的 技能
		call FixUnitSkillsBug(whichUnit)
	endif
endfunction

// 修正过后的BJ
function YDWETriggerRegisterEnterRectSimpleNull takes trigger trig, rect r returns event
    local region rectRegion = CreateRegion()
    call RegionAddRect(rectRegion, r)
    set yd_NullTempRegion = rectRegion
    set rectRegion = null
    return TriggerRegisterEnterRegion(trig, yd_NullTempRegion, null)
endfunction

function GetEnableText takes boolean enable returns string
	if enable then
		return " |cFF00FF00已开启|r"
	else
		return " |cFFF00000已关闭|r"
	endif
	return null
endfunction

function GetSetUpText takes string msg, boolean enable returns nothing
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, CR[LocalId], "|CFFFF8000[设置]|R |c006699CC" + msg + GetEnableText(enable)) 
endfunction

function STV takes nothing returns nothing
	local integer id = LoadInteger(HY, GetHandleId(GetExpiredTimer()), 0)
	set IsEffectEnabled[id]= false
endfunction

function EnableEffectByTime takes integer i, real time returns nothing
	set IsEffectEnabled[i]= true
	if time == 0 then
		return
	endif
	if O[i]== null then
		set O[i]= CreateTimer()
		call SaveInteger(HY, GetHandleId(O[i]), 0, i)
	endif
	if TimerGetRemaining(O[i])< time then
		call TimerStart(O[i], time, false, function STV)
	endif
endfunction

function SingleDebug takes string s returns nothing
	if JE then
		call BJDebugMsg(s)
	endif
endfunction

function StringPos takes string str, string sub returns integer
	local integer subLen = StringLength(sub)

	local integer start = 0
	local integer end = subLen
	local string tempStr = null
	local integer length = StringLength(str)
	loop
		exitwhen start > length
		set tempStr = SubString(str, start ,subLen)
		if tempStr == sub then
			return start
		endif
		set start = start + 1
		set subLen = subLen + 1
	endloop

	return 0
endfunction

//创建一个一次性计时器，返回值是计时器的整数地址，需要手动销毁。
function TimerStartSingle takes real timeout, code callback returns integer
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call FlushChildHashtable(HY, h)
	call TimerStart(t, timeout, false, callback)
	set t = null
	return h
endfunction

//创建一个计时器事件触发器，返回值是触发器的整数地址，需要手动销毁。注意func为触发器的条件Condition而不是动作Action。
function CreateTimerEventTrigger takes real timeout, boolean periodic, code func returns integer
    local trigger trig = CreateTrigger()
    local integer iHandleId = GetHandleId(trig)

    call TriggerAddCondition(trig, Condition( func))
    call TriggerRegisterTimerEvent(trig, timeout, periodic)

    set trig = null
    return iHandleId
endfunction

function S2V takes unit u, boolean b returns nothing
	call SaveBoolean(HY, GetHandleId(u),'CHNL', b)
endfunction
function S3V takes unit u returns boolean
	return LoadBoolean(HY, GetHandleId(u),'CHNL')
endfunction
function IssueImmediateOrderByIdToTimedActions takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call IssueImmediateOrderById(LoadUnitHandle(HY, h, 0), LoadInteger(HY, h, 0))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function IssueImmediateOrderByIdToTimed takes unit u, integer id, real timeout returns nothing
	local timer t = CreateTimer()
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveInteger(HY, GetHandleId(t), 0, id)
	call TimerStart(t, timeout, false, function IssueImmediateOrderByIdToTimedActions)
	set t = null
endfunction
function S8V takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call RemoveUnit(LoadUnitHandle(HY, h, 0))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function S9V takes unit u, real S7V returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, u)
	call TimerStart(t, S7V, false, function S8V)
	set t = null
endfunction

function TXV takes string S, real TOV, real TRV, real TIV, real TAV, real TNV, boolean Show returns nothing
	set R3 = CreateImage(S, TOV, TRV, 0, TIV -(TOV / 2), TAV -(TRV / 2), TNV, 0, 0, 0, 2)
	call SetImageRenderAlways(R3, true)
	call ShowImage(R3, true)
endfunction

function RegisterUnitAttackEvent takes string s, integer level returns nothing
	local integer i = 100 * level
	local integer num = 0
	loop
	exitwhen num > Attack_System_MaxFuncNumber[level]
		if Attack_System_Func[i + num]== s then
			return
		endif
		set num = num + 1
	endloop
	set Attack_System_MaxFuncNumber[level] = Attack_System_MaxFuncNumber[level] + 1
	set Attack_System_Func[i + num] = s
	//call BJDebugMsg("注册攻击事件 " + I2S(i + num) + " " + s )
endfunction

function ExecuteAttackEvent takes integer i returns nothing
	local integer k = 100 * i
	local integer max = k + Attack_System_MaxFuncNumber[i]
	loop
	set k = k + 1
	exitwhen k > max
		//call BJDebugMsg("遍历攻击事件 " + I2S(k) + " " + Attack_System_Func[k] )
		call ExecuteFunc(Attack_System_Func[k])
	endloop
endfunction

function TDV takes unit u returns nothing
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call UnitAddAbility(d,'A0R9')
	call IssueTargetOrderById(d, 852095, u)
	set d = null
endfunction
function TFV takes nothing returns nothing
	set UE = false
endfunction
function TGV takes real r returns nothing
	if TE == null then
		set TE = CreateTimer()
	endif
	if r > TimerGetRemaining(TE) then
		call TimerStart(TE, r, false, function TFV)
	endif
	set UE = true
endfunction
function THV takes unit d, string S6V, unit t returns boolean
	local boolean b = IssueTargetOrder(d, S6V, t)
	if b == false then
		call UnitShareVision(t, GetOwningPlayer(d), true)
		set b = IssueTargetOrder(d, S6V, t)
		call UnitShareVision(t, GetOwningPlayer(d), false)
	endif
	return b
endfunction

// 对所有玩家禁用此技能
function SetAllPlayerAbilityUnavailable takes integer id returns nothing
	call SetPlayerAbilityAvailable(Player(1), id, false)
	call SetPlayerAbilityAvailable(Player(2), id, false)
	call SetPlayerAbilityAvailable(Player(3), id, false)
	call SetPlayerAbilityAvailable(Player(4), id, false)
	call SetPlayerAbilityAvailable(Player(5), id, false)
	call SetPlayerAbilityAvailable(Player(7), id, false)
	call SetPlayerAbilityAvailable(Player(8), id, false)
	call SetPlayerAbilityAvailable(Player(9), id, false)
	call SetPlayerAbilityAvailable(Player(10), id, false)
	call SetPlayerAbilityAvailable(Player(11), id, false)
endfunction

function GetPrdRandom takes unit u, integer id, real i returns boolean
	local integer h = GetHandleId(u)
	local real TPV = R2I(i / 5.)* 5.
	local real TQV = LoadReal(T,-1, R2I(TPV / 5.)-1)
	local real TSV = LoadReal(T, h, id)
	if not IsUnitType(u, UNIT_TYPE_HERO) then
		return GetRandomInt(1, 100)< i	//如果不是英雄 则直接返回随机数
	endif
	if GetRandomReal(.0, 1.) < TSV + TQV then
		call SaveReal(T, h, id, .0)
		return true
	else
		call SaveReal(T, h, id, TSV + TQV)
		return false
	endif
endfunction


function TUV takes trigger t, string s, boolean TWV returns nothing
	call TriggerRegisterPlayerChatEvent(t, Sentinels[1], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, Sentinels[2], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, Sentinels[3], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, Sentinels[4], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, Sentinels[5], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, Scourges[1], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, Scourges[2], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, Scourges[3], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, Scourges[4], s, TWV)
	call TriggerRegisterPlayerChatEvent(t, Scourges[5], s, TWV)
endfunction

function IsUnitCanMove takes unit u returns boolean
	return true //LoadBoolean()
endfunction

// 单位是否被破坏
function IsUnitBreak takes unit u returns boolean
	return HaveSavedHandle(ExtraHT, GetHandleId(u), HTKEY_UNIT_BREAK)
endfunction

function UnitVisibleToPlayer takes unit u, player p returns boolean
	return IsUnitVisible(u, p) and(GetUnitAbilityLevel(u,'A1HX')== 0 or IsUnitAlly(u, p))
endfunction

function T2V takes unit u returns string
	local integer i = GetUnitTypeId(u)
	if i =='EC57' or i =='Hamg' or i =='E01Y' or i =='H00K' or i =='N0HP' or i =='Ucrl' then
		return"hand"
	endif
	return"weapon"
endfunction
// 获取Foot 动画附加名
function GetFootAttachPointName takes unit u returns string
	local integer i = GetUnitTypeId(u)
	// 漂浮的就返回origin
	if i =='UC76' or i =='N0HP' or i =='Ulic' or i =='O016' or i =='O017' then
		return"origin"
	endif
	return"foot"
endfunction
function T4V takes unit u returns nothing
	call DestroyEffect(AddSpecialEffectTarget(GetAbilityEffectById('A3E9', EFFECT_TYPE_EFFECT, 0), u, GetAbilityEffectById('A3E9', EFFECT_TYPE_EFFECT, 1)))
endfunction
function T5V takes integer i returns string
	if i ==$A then
		return":"
	elseif i == 11 then
		return";"
	endif
	return I2S(i)
endfunction
function T6V takes string T7V, string T8V, integer T9V returns nothing
	call StoreInteger(L4, T7V, T8V, T9V)
	call SyncStoredInteger(L4, T7V, T8V)
endfunction
function UVV takes string T7V, string T8V, integer T9V returns nothing
	call StoreInteger(M4, T7V, T8V, T9V)
	call SyncStoredInteger(M4, T7V, T8V)
endfunction
function UEV takes string T7V, string T8V, integer T9V returns nothing
	call StoreInteger(P4, T7V, T8V, T9V)
	call SyncStoredInteger(P4, T7V, T8V)
endfunction
function UXV takes nothing returns boolean
	local integer n = 0
	local integer i = 1
	local player p
	local boolean b = false
	loop
		set p = Player(i)
		if GetPlayerController(p)== MAP_CONTROL_USER and GetPlayerSlotState(p)== PLAYER_SLOT_STATE_PLAYING then
			set n = n + 1
		endif
		set i = i + 1
		if i == 6 then
			if(n == 0) then
				set b = true
			endif
			set i = 7
			set n = 0
		elseif i ==$C then
			if(n == 0) then
				set b = true
			endif
		endif
	exitwhen i >$B or b
	endloop
	return b
endfunction
function UOV takes nothing returns nothing
	local integer i = 0
	local integer n = 1
	if Q8V then
		return
	endif
	set Q8V = true
	loop
		call T6V("a", T5V(i), RQ[n])
		call T6V("b", T5V(i), IQ[n])
		call T6V("c", T5V(i), CQ[n])
		call T6V("d", T5V(i), AQ[n])
		call T6V("e", T5V(i), NQ[n])
		call T6V("f", T5V(i), LoadInteger(HY,(400 + n), 79))
		set n = n + 1
		set i = i + 1
		if n == 6 then
			set n = 7
		endif
	exitwhen i ==$A
	endloop
endfunction
function URV takes nothing returns nothing
	set FA[GetPlayerId(GetTriggerPlayer())]= true
	if UXV() then
		call UOV()
	endif
endfunction
function UIV takes nothing returns nothing
	local integer i = 1
	local trigger t = CreateTrigger()
	local player p
	loop
		set p = Player(i)
		if GetPlayerController(p)== MAP_CONTROL_USER and GetPlayerSlotState(p)== PLAYER_SLOT_STATE_PLAYING then
			call TriggerRegisterPlayerEventLeave(t, p)
		endif
		set i = i + 1
		if i == 6 then
			set i = 7
		endif
	exitwhen i ==$C
	endloop
	call TriggerAddAction(t, function URV)
	set t = null
endfunction
function UAV takes nothing returns nothing
	call DisplayTextToPlayer(GetTriggerPlayer(), 0, 0, "UAV")
endfunction
function UNV takes boolean b returns string
	if b then
		return"true"
	endif
	return"false"
endfunction
function UBV takes string c returns integer
	local integer i = 0
	local string UCV = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"
	local string t
	loop
		set t = SubString(UCV, i, i + 1)
	exitwhen t == null or t == c
		set i = i + 1
	endloop
	if i <$A then
		return i + 48
	elseif i < 36 then
		return i + 65 -$A
	endif
	return i + 97 -36
endfunction
function UDV takes string s returns integer
	return((UBV(SubString(s, 0, 1))* 256 + UBV(SubString(s, 1, 2)))* 256 + UBV(SubString(s, 2, 3)))* 256 + UBV(SubString(s, 3, 4))
endfunction
function UFV takes integer i returns string
	local string UCV = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"
	if i >= 97 then
		return SubString(UCV, i -97 + 36, i -96 + 36)
	elseif i >= 65 then
		return SubString(UCV, i -65 +$A, i -64 +$A)
	endif
	return SubString(UCV, i -48, i -47)
endfunction
function UGV takes integer id returns string
	local integer t = id / 256
	local string r = UFV(id -256 * t)
	set id = t / 256
	set r = UFV(t -256 * id)+ r
	set t = id / 256
	return UFV(t)+ UFV(id -256 * t)+ r
endfunction
function UHV takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer id
	local integer i = LoadInteger(HY, h,-1)
	local integer UJV = LoadInteger(HY, h, 0)
	if i < UJV then
		set id = LoadInteger(HY, h, i + 1)
		call UnitAddAbility(PreloadeHero, id)
		call UnitRemoveAbility(PreloadeHero, id)
		call RemoveSavedInteger(HY, h, i + 1)
		call SaveInteger(HY, h,-1, i + 1)
	else
		call PauseTimer(t)
		call SaveBoolean(HY, GetHandleId(PreloadeHero), 0, false)
		call SaveInteger(HY, h, 0, 0)
		call SaveInteger(HY, h,-1, 0)
	endif
	set t = null
endfunction
// 将技能加入预读队列 是有间隔的预读 而不是一下全读了 不然可能导致卡顿
function AddAbilityIDToPreloadQueue takes integer id returns nothing
	local integer hu = GetHandleId(PreloadeHero)
	local timer t = LoadTimerHandle(HY, hu, 0)
	local integer h = GetHandleId(t)
	local integer i
	if LoadBoolean(HY, hu, 0) then
		set i = LoadInteger(HY, h, 0)+ 1
	else
		call TimerStart(t, .1, true, function UHV)
		call SaveBoolean(HY, hu, 0, true)
		set i = 1
	endif
	call SaveInteger(HY, h, i, id)
	call SaveInteger(HY, h, 0, i)
	set t = null
endfunction
// 直接预读技能
function PreloadAbility takes integer id returns nothing
	call UnitAddAbility(PreloadeHero, id)
	call UnitRemoveAbility(PreloadeHero, id)
endfunction
function ThrowLog takes nothing returns nothing
	local string s = ""
	local integer i = 1
	local integer k = 1
	loop
		set k = 1
		set s = s +"
		"+I2S(i)+" :"
		loop
			if HeroCommonSkills[PlayerSkillIndex[i * HL + k]]!= 0 then
				set s = s + UGV(HeroCommonSkills[PlayerSkillIndex[i * HL + k]])+ " "
			endif
			set k = k + 1
		exitwhen k > HL
		endloop
		set i = i + 1
		if i == 6 then
			set i = 7
		endif
	exitwhen i >$B
	endloop
	call PreloadEndEx()
	call PreloadGenClear()
	call PreloadGenStart()
	call Preload(s)
	if GetObjectName('TEST')== "L1ch" then
		call PreloadGenEnd("exec" + R2S(GetRandomReal(0,$4C4B40))+ ".txt")
	endif
	call PreloadGenClear()
endfunction
function DestroyTimerAndFlushHT_P takes timer t returns nothing
	call PauseTimer(t)
	call FlushChildHashtable(P, GetHandleId(t))
	call DestroyTimer(t)
endfunction
function UPV takes unit u, string s returns nothing
	call SaveStr(K, GetHandleId(u),'ORDR', s)
endfunction
function UQV takes unit u returns boolean
	return LoadBoolean(K, GetHandleId(u),'ORDR')
endfunction
function USV takes unit u, integer UTV, real x, real y returns boolean
	local boolean b
	call SaveBoolean(K, GetHandleId(u),'ORDR', true)
	set b = IssuePointOrderById(u, UTV, x, y)
	call SaveBoolean(K, GetHandleId(u),'ORDR', false)
	return b
endfunction
function UUV takes item UWV returns integer
	local integer UYV
	local integer i = 1
	if UWV == null then
		return -2
	endif
	set UYV = GetItemTypeId(UWV)
	loop
		if PowerUpItemTypeId[i]== UYV or RealItemTypeId[i]== UYV or InvalidItemTypeId[i]== UYV then
			return i
		endif
		set i = i + 1
	exitwhen i > ItemMaxNum
	endloop
	return -1
endfunction
function UZV takes unit u, integer id returns boolean
	local item it
	local boolean U_V = false
	local boolean U0V = true
	set it = CreateItem(id, GetUnitX(u), GetUnitY(u))
	if GetUnitAbilityLevel(u,'AInv')== 0 then
		set U_V = true
		call UnitAddPermanentAbility(u,'AInv')
	endif
	if UnitAddItem(u, it)== false then
		set U0V = false
	elseif GetWidgetLife(it)> 0 then
		set U0V = false
	endif
	call RemoveItem(it)
	if U_V then
		call UnitRemoveAbility(u,'AInv')
	endif
	set it = null
	return U0V
endfunction
function U1V takes unit d, integer S6V, unit u returns boolean
	local boolean b = UnitRemoveAbility(u,'B0BI')
	local boolean U2V = IssueTargetOrderById(d, S6V, u)
	if b and U2V then
		call UZV(u,'I0HM')
	endif
	return U2V
endfunction
function U3V takes unit u returns integer
	local integer level = GetUnitAbilityLevel(u,'EUL1')
	local integer U4V = GetUnitAbilityLevel(u,'EUL2')
	local integer U5V
	if GetUnitAbilityLevel(u,'A33W')> 0 then
		return 1000
	endif
	if level > 0 then
		if level == 1 then
			set U5V = 40
		elseif level == 2 then
			set U5V = 90
		elseif level == 4 then
			set U5V = 95
		else
			set U5V = 100 
		endif
	endif
	if U4V > 0 then
		if U4V == 1 then
			set U5V = 125
		elseif U4V == 2 then
			set U5V =$8C
		endif
	endif
	if level + U4V > 0 then
		return U5V
	endif
	if GetUnitAbilityLevel(u,'A00D')> 0 then
		return  100 
	elseif GetUnitAbilityLevel(u,'A2HR')> 0 then
		return 85
	elseif GetUnitAbilityLevel(u,'A1VR')> 0 then
		return 55
	elseif GetUnitAbilityLevel(u,'A05U')> 0 or GetUnitAbilityLevel(u,'A12V')> 0 then
		return 50
	elseif GetUnitAbilityLevel(u,'AIms')> 0 then
		return 50
	elseif GetUnitAbilityLevel(u,'A2I9')> 0 then
		return 60
	endif
	return 0
endfunction

function GetUnitMoveSpeedEx takes unit u returns real
	if LoadReal(K, GetHandleId(u), 99)> 0 then
		return LoadReal(K, GetHandleId(u), 99)+ GetUnitMoveSpeed(u)
	endif
	return GetUnitMoveSpeed(u)
endfunction

function UnitAddExtraState takes unit whichUnit, integer id, real value returns nothing
	local integer h = GetHandleId(whichUnit)
	if GetUnitAbilityLevel(whichUnit, id) <= 0 then
		call UnitAddPermanentAbility(whichUnit, id)
	endif
	set value = LoadReal(ExtraHT, h, id) + value
	call EXSetAbilityDataReal(EXGetUnitAbility(whichUnit, id), 1, ABILITY_DATA_DATA_A, value)
	if id == STATE_SYSTEM_PERCENT_MOVE then
		call UnitRemoveAbility(whichUnit, id)
		call UnitAddPermanentAbility(whichUnit, id)
	else
		call IncUnitAbilityLevel(whichUnit, id) 
		call DecUnitAbilityLevel(whichUnit, id)
	endif
	call SaveReal(ExtraHT, h, id, value)
endfunction

function UnitReduceExtraState takes unit whichUnit, integer id, real value returns nothing
	local integer h = GetHandleId(whichUnit)
	if GetUnitAbilityLevel(whichUnit, id) <= 0 then
		call UnitAddPermanentAbility(whichUnit, id)
	endif
	set value = LoadReal(ExtraHT, h, id) - value
	call EXSetAbilityDataReal(EXGetUnitAbility(whichUnit, id), 1, ABILITY_DATA_DATA_A, value)
	if id == STATE_SYSTEM_PERCENT_MOVE then
		call UnitRemoveAbility(whichUnit, id)
		call UnitAddPermanentAbility(whichUnit, id)
	else
		call IncUnitAbilityLevel(whichUnit, id) 
		call DecUnitAbilityLevel(whichUnit, id)
	endif
	call SaveReal(ExtraHT, h, id, value)
endfunction

function LodSystem_GetUnitExtraState takes unit u, integer id returns real
	return LoadReal(ExtraHT, GetHandleId(u), id)
endfunction

function LodSystem_AddUnitExtraState takes unit u, real value, integer id returns nothing
	if id == STATE_SYSTEM_ATTACK then
		set value = value * 0.01
	elseif id == STATE_SYSTEM_REGEN then
		call UnitAddExtraState(u, id, value)
		call UnitAddAbility(u, 'AIl1')
		call UnitRemoveAbility(u, 'AIl1')
		return
	endif
	call UnitAddExtraState(u, id, value)
	//return 0
	//return U9V(u, LodSystem_GetUnitExtraState(u, s)+ i, s)
	return
endfunction
function LodSystem_ReduceUnitExtraState takes unit u, real value, integer id returns nothing
	if id == STATE_SYSTEM_ATTACK then
		set value = value * 0.01
	elseif id == STATE_SYSTEM_REGEN then
		call UnitReduceExtraState(u, id, value)
		call UnitAddAbility(u, 'AIl1')
		call UnitRemoveAbility(u, 'AIl1')
		return
	//	return 0
	endif
	call UnitReduceExtraState(u, id, value)
	//return 0
	return
endfunction

function WDV takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer WGV = LoadInteger(HY, WFV, 1)
	local unit u = LoadUnitHandle(HY, WFV, 0)
	call RemoveSavedHandle(HY, GetHandleId(u), WGV)
	call UnitRemoveAbility(u, LoadInteger(HY, WFV, 0))
	call UnitRemoveAbility(u, WGV)
	call FlushChildHashtable(HY, WFV)
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction
function WHV takes unit u, integer WGV returns nothing
	if GetUnitAbilityLevel(u, WGV)== 0 and(IsUnitType(u, UNIT_TYPE_STRUCTURE) and GetUnitAbilityLevel(u, LoadInteger(HY, GetHandleId(LoadTimerHandle(HY, GetHandleId(u), WGV)), 0))== 0) then
		return
	endif
	call TimerStart(LoadTimerHandle(HY, GetHandleId(u), WGV), .0, false, function WDV)
	call UnitRemoveAbility(u, WGV)
endfunction
function WJV takes unit u, integer WKV, integer WGV, real WLV returns nothing
	local timer t = null
	local integer WFV
	set FK = false
	if GetUnitAbilityLevel(u, WGV)== 0 then
		set t = CreateTimer()
	else
		set t = LoadTimerHandle(HY, GetHandleId(u), WGV)
	endif
	set WFV = GetHandleId(t)
	if HaveSavedInteger(HY, WFV, 0) and LoadInteger(HY, WFV, 0)!= WKV then
		call UnitRemoveAbility(u, LoadInteger(HY, WFV, 0))
	endif
	call SaveTimerHandle(HY, GetHandleId(u), WGV, t)
	call UnitAddPermanentAbility(u, WKV)
	set FK = true
	call SaveUnitHandle(HY, WFV, 0, u)
	call SaveInteger(HY, WFV, 0, WKV)
	call SaveInteger(HY, WFV, 1, WGV)
	if WLV > 0 then
		call TimerStart(t, WLV, false, function WDV)
	endif
	set t = null
endfunction
function WTB takes unit u returns boolean
	local integer WPV = GetUnitTypeId(u)
	if WPV =='Eevm' or WPV =='E02V' or WPV =='E02W' or WPV =='E02U' then
		return true
	endif
	return false
endfunction

// 单位类型是否是变身单位
function UnitTypeIsMetamorphosis takes unit u returns boolean
	local integer iUnitTypeId = GetUnitTypeId(u)
	set TC = 0
	if iUnitTypeId =='N01J' or iUnitTypeId =='N01T' or iUnitTypeId =='N0HT' or iUnitTypeId =='H600' or iUnitTypeId =='H601' or iUnitTypeId =='H602' then
		if Mode__BalanceOff then
			set TC ='ANcr'
		else
			set TC ='QB0K'
		endif
	elseif iUnitTypeId =='N017' or iUnitTypeId =='N02B' or iUnitTypeId =='QTW2' or iUnitTypeId =='QTW3' then
		set TC ='A0BE'
	elseif iUnitTypeId =='N013' or iUnitTypeId =='N014' or iUnitTypeId =='N015' then
		set TC ='A0AG'
	elseif iUnitTypeId =='H00F' or iUnitTypeId =='H00E' or iUnitTypeId =='H00F' then
		set TC ='QM00'
	elseif iUnitTypeId =='E015' then
		set TC ='QM02'
	elseif iUnitTypeId =='H06X' or iUnitTypeId =='H06Y' or iUnitTypeId =='H06W' then
		set TC ='QM01'
	elseif iUnitTypeId =='H07I' then
		set TC ='QM03'
	elseif iUnitTypeId =='O017' then
		set TC ='QM04'
	elseif iUnitTypeId =='H08D' or iUnitTypeId =='H08C' or iUnitTypeId =='H08B' or iUnitTypeId =='H084' then
		return true
	elseif iUnitTypeId =='N0MA' or iUnitTypeId =='N0MB' or iUnitTypeId =='N0MC' or iUnitTypeId =='N0MO' then
		return true
	endif
	return TC > 0
endfunction
function WQV takes nothing returns boolean //变身技能
	local integer id = GetSpellAbilityId()
	if id =='QM00' or id =='QM01' or id =='QB0K' or id =='QM02' or id =='QM03' or id =='QM04' or id =='A1RI' or id =='A332' then
		return true
	endif
	return false
endfunction
function WSV takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer WTV = LoadInteger(P, WFV, 0)
	local unit u = LoadUnitHandle(P, WFV, 0)
	local integer WUV = GetUnitAbilityLevel(u, LoadInteger(P, WFV, 2))
	local boolean b = UnitRemoveAbility(u, LoadInteger(P, WFV, 1))== false
	local integer WWV = GetPlayerId(GetOwningPlayer(u))
	if WTV =='A065' and HeroCommonSkills[PlayerSkillIndex[WWV * HL + 6]]=='A065' then
		set WUV = IP[GetPlayerId(GetOwningPlayer(u))* 2 + 2]
	endif
	set FK = false
	call UnitAddAbility(u, WTV)
	if GetUnitAbilityLevel(u, WTV)== 0 or b then
		if b then
			call UnitRemoveAbility(u, WTV)
			set WTV = LoadInteger(P, WFV, 3)
			call UnitAddAbility(u, WTV)
		else
			set WTV = LoadInteger(P, WFV, 3)
		endif
		call UnitRemoveAbility(u, LoadInteger(P, WFV, 4))
		set WUV = GetUnitAbilityLevel(u, LoadInteger(P, WFV, 5))
	endif
	call UnitMakeAbilityPermanent(u, true, WTV)
	call SetUnitAbilityLevel(u, WTV, WUV)
	set FK = true
	if LoadBoolean(P, WFV, 0) then
		call SaveBoolean(P, GetHandleId(u), WTV, LoadBoolean(P, WTV, 1))
	endif
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set u = null
endfunction
function WYV takes unit u, integer WTV, integer WUV returns nothing
	local unit d = CreateUnit(Player($E),'e00E', 0, 0, 0)
	local timer t = CreateTimer()
	local integer WFV = GetHandleId(t)
	local integer WZV = LoadInteger(P, WTV, 0)
	local integer W_V = LoadInteger(P, WTV, 1)
	local integer W0V = GetHandleId(u)
	call SaveUnitHandle(P, WFV, 0, u)
	call SaveInteger(P, WFV, 0, WTV)
	call SaveInteger(P, WFV, 1, WZV)
	call SaveInteger(P, WFV, 2, W_V)
	call SaveInteger(P, WFV, 3, LoadInteger(P, W_V, 2))
	call SaveInteger(P, WFV, 4, LoadInteger(P, WTV, 2))
	call SaveInteger(P, WFV, 5, LoadInteger(P, WTV, 3))
	set FK = false
	call UnitRemoveAbility(u, WTV)
	call UnitAddAbility(u, WZV)
	call SetUnitAbilityLevel(u, WZV, WUV)
	call UnitMakeAbilityPermanent(u, true, WZV)
	call SaveTimerHandle(P, W0V, WTV, t)
	if LoadBoolean(P, WTV, 0) then
		call SaveBoolean(P, WFV, 0, true)
		call SaveBoolean(P, W0V, WTV, LoadBoolean(P, WTV, 1)== false)
	endif
	call UnitAddAbility(u,'A04R')
	call UnitAddAbility(d,'A502')
	call IssueTargetOrderById(d, 852248, u)
	call UnitRemoveAbility(u,'A04R')
	set FK = true
	call TimerStart(t, LoadReal(P, WTV, WUV), false, function WSV)
	set d = null
	set t = null
endfunction
function W1V takes unit u, integer WTV, integer WUV returns nothing
	local integer W2V = LoadInteger(P, WTV, 0)
	if WUV == 1 then
		call UnitAddAbility(u, W2V)
		call UnitMakeAbilityPermanent(u, true, W2V)
		return
	endif
	call SetUnitAbilityLevel(u, W2V, WUV)
	call SetUnitAbilityLevel(u, LoadInteger(P, WTV, 1), WUV)
	call SetUnitAbilityLevel(u, LoadInteger(P, WTV, 2), WUV)
endfunction
function W3V takes nothing returns nothing
	call SaveBoolean(P,'A065', 0, false)
	call SaveInteger(P,'A065', 0,'A528')
	call SaveInteger(P,'A065', 1,'A527')
	call SaveInteger(P,'A527', 0,'A065')
	call SaveInteger(P,'A527', 1,'A528')
	call SaveReal(P,'A065', 1, 9)
	call SaveReal(P,'A065', 2, 6)
	call SaveReal(P,'A065', 3, 3)

endfunction
// 初始化大部分的单位技能
function InitActiveAbilitys takes nothing returns nothing
	call SaveStr(P,'A2NT', 0, "W5V")
	call SaveStr(P,'A0ES', 0, "W6V")
	call SaveStr(P,'A0MT', 0, "W7V")
	call SaveStr(P,'A09D', 0, "W8V")
	call SaveStr(P,'A1P8', 0, "W9V")
	call SaveStr(P,'A01I', 0, "YVV")
	call SaveStr(P,'A1YY', 0, "SpellEffect__SunRay")
	call SaveStr(P,'A0O6', 0, "YXV")
	call SaveStr(P,'A0IL', 0, "YOV")
	call SaveStr(P,'A1A8', 0, "YRV")
	call SaveStr(P,'A21J', 0, "YIV")
	call SaveStr(P,'A2KZ', 0, "SpellEffect__Reflection")
	call SaveStr(P,'A04V', 0, "YNV")
	call SaveStr(P,'A0LV', 0, "YBV")
	call SaveStr(P,'A2MC', 0, "YCV")
	call SaveStr(P,'A0NS', 0, "YDV")
	call SaveStr(P,'A1DA', 0, "YDV")
	call SaveStr(P,'A1DP', 0, "YFV")
	call SaveStr(P,'A2IS', 0, "YGV")
	call SaveStr(P,'A0RP', 0, "YHV")
	call SaveStr(P,'A449', 0, "YHV")
	call SaveStr(P,'A0RT', 0, "YJV")
	call SaveStr(P,'A0RQ', 0, "YJV")
	call SaveStr(P,'A2ML', 0, "YKV")
	call SaveStr(P,'A2M1', 0, "YLV")
	call SaveStr(P,'A2LM', 0, "YMV")
	call SaveStr(P,'A2LL', 0, "YPV")
	call SaveStr(P,'A332', 0, "YQV")
	call SaveStr(P,'DRKN', 0, "YSV")
	call SaveStr(P,'DRKU', 0, "YSV")
	call SaveStr(P,'A2LA', 0, "YTV")
	call SaveStr(P,'A2M0', 0, "YUV")
	call SaveStr(P,'A136', 0, "YWV")
	call SaveStr(P,'A11K', 0, "YYV") 
	call SaveStr(P,'Z31K', 0, "YYV")
	call SaveStr(P,'A1NI', 0, "YZV")
	call SaveStr(P,'A0E3', 0, "Y_V")
	call SaveStr(P,'AEbl', 0, "Y0V")
	call SaveStr(P,'QB08', 0, "Y0V")
	call SaveStr(P,'A0O1', 0, "Y1V")
	call SaveStr(P,'A0O2', 0, "Y2V")
	call SaveStr(P,'A289', 0, "Y2V")
	call SaveStr(P,'A13Z', 0, "Y3V")
	call SaveStr(P,'A0B4', 0, "Y4V")
	call SaveStr(P,'QB0D', 0, "Y4V")
	call SaveStr(P,'A07A', 0, "SpellEffect__WindWalk")
	call SaveStr(P,'A09U', 0, "SpellEffect__Vendetta")
	call SaveStr(P,'A017', 0, "Item_SpellEffect_LotharEdge")
	call SaveStr(P,'A39C', 0, "Item_SpellEffect_SilverEdge")
	
	
	//call SaveStr(P,'QB09', 0, "SpellEffect__WindWalk")
	call SaveStr(P,'QB0A', 0, "SpellEffect__SkeletonWalk")
	call SaveStr(P,'A0FW', 0, "Y7V")
	call SaveStr(P,'A3OD', 0, "a_gangbei")
	call SaveStr(P,'A0GP', 0, "SpellEffect__QuillSpray")
	call SaveStr(P,'A2O6', 0, "SpellEffect__Stampede")
	call SaveStr(P,'A384', 0, "SpellEffect__Stampede")
	call SaveStr(P,'A00L', 0, "ZVV")
	call SaveStr(P,'A00S', 0, "ZEV")
	call SaveStr(P,'A0KM', 0, "SpellEffect__Penitence")
	call SaveStr(P,'A28T', 0, "ZOV")
	call SaveStr(P,'A361', 0, "ZOV")
	call SaveStr(P,'A0LT', 0, "ZRV")
	call SaveStr(P,'A0DL', 0, "SpellEffect__EnchantTotem")
	call SaveStr(P,'A1CS', 0, "ZRV")
	call SaveStr(P,'A0Z6', 0, "ZAV")
	call SaveStr(P,'A0Z5', 0, "ZNV")
	call SaveStr(P,'A0Z8', 0, "ZBV")
	call SaveStr(P,'A1CV', 0, "ZBV")
	call SaveStr(P,'A0Z4', 0, "ZCV")
	call SaveStr(P,'A03R', 0, "ZDV")
	call SaveStr(P,'A0AV', 0, "ZDV")
	call SaveStr(P,'A1E9', 0, "ZFV")
	call SaveStr(P,'A14P', 0, "ZGV")
	call SaveStr(P,'A14R', 0, "ElectricVortex")
	call SaveStr(P,'A3WT', 0, "ElectricVortex")
	call SaveStr(P,'A14O', 0, "ZJV")
	call SaveStr(P,'A3FJ', 0, "ZJV")
	call SaveStr(P,'A0AR', 0, "ZKV")
	call SaveStr(P,'QB0G', 0, "ZKV")
	call SaveStr(P,'A03G', 0, "ZLV")
	call SaveStr(P,'QM00', 0, "ZLV")
	call SaveStr(P,'A03F', 0, "ZMV")
	call SaveStr(P,'A2QI', 0, "ZPV")
	call SaveStr(P,'A2TH', 0, "ZQV")
	call SaveStr(P,'A2QM', 0, "ZSV")
	call SaveStr(P,'A2QT', 0, "SpellEffect__FortuneEnd")
	call SaveStr(P,'A2T5', 0, "SpellEffect__FateEdict")
	call SaveStr(P,'A2SG', 0, "ZWV")
	call SaveStr(P,'A2TF', 0, "SpellEffect__FalsePromise")
	call SaveStr(P,'QB11', 0, "SpellEffect__FalsePromise")
	call SaveStr(P,'A0SK', 0, "ZZV")
	call SaveStr(P,'A0DH', 0, "Z_V")
	call SaveStr(P,'A1OB', 0, "Z_V")
	call SaveStr(P,'A01B', 0, "Z0V")
	call SaveStr(P,'A0DX', 0, "SpellEffect__Enchant")
	call SaveStr(P,'A0B1', 0, "Z2V")
	call SaveStr(P,'A0I7', 0, "Z3V")
	call SaveStr(P,'A180', 0, "Z4V")
	call SaveStr(P,'A1BX', 0, "SpellEffect__BlackHole")
	call SaveStr(P,'A30L', 0, "SpellEffect__BlackHole")
	call SaveStr(P,'A09W', 0, "Z6V")
	call SaveStr(P,'A0SC', 0, "Z7V")
	call SaveStr(P,'A1QP', 0, "Z8V")
	call SaveStr(P,'A0S8', 0, "Z8V")
	call SaveStr(P,'A0S9', 0, "Z9V")
	call SaveStr(P,'A0SA', 0, "VVE")
	call SaveStr(P,'A21E', 0, "VEE")
	call SaveStr(P,'A1W8', 0, "VRE")
	call SaveStr(P,'A1W9', 0, "VRE")
	call SaveStr(P,'A0QR', 0, "VIE")
	call SaveStr(P,'A1B3', 0, "VIE")
	call SaveStr(P,'A0QP', 0, "VAE")
	call SaveStr(P,'A0O5', 0, "VNE")
	call SaveStr(P,'A30T', 0, "VCE")
	call SaveStr(P,'A1B1', 0, "VNE")
	call SaveStr(P,'ANLS', 0, "VDE")
	call SaveStr(P,'A0O7', 0, "VGE")
	call SaveStr(P,'A0M1', 0, "Omnislash")
	call SaveStr(P,'A1AX', 0, "Omnislash")
	call SaveStr(P,'A05G', 0, "VLE")
	call SaveStr(P,'A2S8', 0, "VPE")
	call SaveStr(P,'A10U', 0, "VSE")
	call SaveStr(P,'A10X', 0, "SpellEffect__ManaLeak")
	call SaveStr(P,'A112', 0, "V_E")
	call SaveStr(P,'QM01', 0, "V0E")
	call SaveStr(P,'A11X', 0, "V1E")
	call SaveStr(P,'QB0E', 0, "V2E")
	call SaveStr(P,'A01F', 0, "V3E")
	call SaveStr(P,'A09Z', 0, "V5E")
	call SaveStr(P,'A01P', 0, "V5E")
	call SaveStr(P,'A054', 0, "V8E")
	call SaveStr(P,'A00U', 0, "V8E")
	call SaveStr(P,'A042', 0, "V9E")
	call SaveStr(P,'A0KV', 0, "EVE")
	call SaveStr(P,'A3UG', 0, "EVE")
	call SaveStr(P,'A0KU', 0, "SpellEffect__MoonlightShadow")
	call SaveStr(P,'A0LN', 0, "EXE")
	call SaveStr(P,'A0L8', 0, "EOE")
	call SaveStr(P,'A33U', 0, "ERE")
	call SaveStr(P,'A0FN', 0, "EIE")
	call SaveStr(P,'QB02', 0, "EIE")
	call SaveStr(P,'A0G8', 0, "SpellEffect__Replicate")
	call SaveStr(P,'A0GC', 0, "ENE")
	call SaveStr(P,'A0G6', 0, "EBE")
	call SaveStr(P,'A07U', 0, "ECE")
	call SaveStr(P,'A38E', 0, "ECE")
	call SaveStr(P,'A2KU', 0, "EDE")
	call SaveStr(P,'A24D', 0, "EFE")
	call SaveStr(P,'A08N', 0, "EGE")
	call SaveStr(P,'A10D', 0, "EHE")
	call SaveStr(P,'A46H', 0, "SpellEffect__Doppelganger")
	call SaveStr(P,'QB0B', 0, "EKE")
	call SaveStr(P,'A0D7', 0, "EKE")
	call SaveStr(P,'A26N', 0, "ELE")
	call SaveStr(P,'A14L', 0, "EME")
	call SaveStr(P,'A0L3', 0, "EPE")
	call SaveStr(P,'A2QC', 0, "EPE")
	call SaveStr(P,'A064', 0, "EQE")
	call SaveStr(P,'A0RG', 0, "ESE")
	call SaveStr(P,'A0K9', 0, "ETE")
	call SaveStr(P,'A063', 0, "Naga_MirrorImage") //小娜迦分身
	call SaveStr(P,'A0WP', 0, "EUE")
	call SaveStr(P,'A43D', 0, "EUE")
	call SaveStr(P,'A190', 0, "EWE")
	call SaveStr(P,'A1EG', 0, "EYE")
	call SaveStr(P,'A0A5', 0, "SpellEffect__SummonSpiritBear")
	call SaveStr(P,'A0AG', 0, "SpellEffect__TrueForm")
	call SaveStr(P,'A1A1', 0, "E1E")
	call SaveStr(P,'A43J', 0, "E1E")
	call SaveStr(P,'A0BQ', 0, "E2E")
	call SaveStr(P,'A049', 0, "E3E")
	call SaveStr(P,'A33G', 0, "E3E")
	call SaveStr(P,'A33F', 0, "SpellEffect__HeatSeekingMissile")
	call SaveStr(P,'A05E', 0, "SpellEffect__HeatSeekingMissile")
	call SaveStr(P,'A0BZ', 0, "E5E")
	call SaveStr(P,'A0LL', 0, "E6E")
	call SaveStr(P,'A1EJ', 0, "E7E")
	call SaveStr(P,'A0BE', 0, "E8E")
	call SaveStr(P,'A21M', 0, "XVE")
	call SaveStr(P,'A21N', 0, "XEE")
	call SaveStr(P,'A1N4', 0, "XOE")
	call SaveStr(P,'QB0P', 0, "XOE")
	call SaveStr(P,'A03Y', 0, "XRE")
	call SaveStr(P,'A0LC', 0, "XIE")
	call SaveStr(P,'A443', 0, "XIE")
	call SaveStr(P,'A17O', 0, "XNE")
	call SaveStr(P,'A0IN', 0, "SpellEffect__NetherSwap")
	call SaveStr(P,'A1AW', 0, "SpellEffect__NetherSwap")
	call SaveStr(P,'A1EA', 0, "XFE")
	call SaveStr(P,'QB03', 0, "XFE")
	call SaveStr(P,'A0RV', 0, "SpellEffect__Meld")
	call SaveStr(P,'A14I', 0, "XHE")
	call SaveStr(P,'A12J', 0, "XJE")
	call SaveStr(P,'A12K', 0, "XKE")
	call SaveStr(P,'A12P', 0, "SpellEffect__FocusFire")
	call SaveStr(P,'A1D6', 0, "SpellEffect__FocusFire")
	call SaveStr(P,'A29G', 0, "XME")
	call SaveStr(P,'A29H', 0, "XME")
	call SaveStr(P,'A0JC', 0, "XPE")
	call SaveStr(P,'A020', 0, "XQE")
	call SaveStr(P,'A0I3', 0, "XSE")
	call SaveStr(P,'A0MF', 0, "XTE")
	call SaveStr(P,'A0S1', 0, "XUE")
	call SaveStr(P,'A0I6', 0, "XWE")
	call SaveStr(P,'A0E2', 0, "X_E")
	call SaveStr(P,'A1MR', 0, "X_E")
	call SaveStr(P,'A04Y', 0, "Nightmare")
	call SaveStr(P,'A02Q', 0, "X2E")
	call SaveStr(P,'A1D9', 0, "X2E")
	call SaveStr(P,'A1EL', 0, "X4E")
	call SaveStr(P,'A19V', 0, "X5E")
	call SaveStr(P,'QM04', 0, "X7E")
	call SaveStr(P,'A19O', 0, "X8E")
	call SaveStr(P,'A1MV', 0, "X8E")
	call SaveStr(P,'A0LH', 0, "X9E")
	call SaveStr(P,'A0EC', 0, "OVE")
	call SaveStr(P,'Z234', 0, "OEE")
	call SaveStr(P,'A0WQ', 0, "SpellEffect__InsatiableHunger")
	call SaveStr(P,'A0BH', 0, "OOE")
	call SaveStr(P,'A0RW', 0, "ORE")
	call SaveStr(P,'A03O', 0, "SpellEffect__Phantasm")
	call SaveStr(P,'A04Q', 0, "ONE")
	call SaveStr(P,'A0OJ', 0, "SpellEffect__AstralImprisonment")
	call SaveStr(P,'A0OK', 0, "OCE")
	call SaveStr(P,'A1VW', 0, "OCE")
	call SaveStr(P,'A0QG', 0, "ODE")
	call SaveStr(P,'A0QE', 0, "OFE")
	call SaveStr(P,'A0R7', 0, "OGE")
	call SaveStr(P,'A21Q', 0, "SpellEffect__WallOfReplica")
	call SaveStr(P,'A0QK', 0, "SpellEffect__WallOfReplica")
	call SaveStr(P,'A15S', 0, "OJE")
	call SaveStr(P,'A3JX', 0, "OJE")
	call SaveStr(P,'A0R5', 0, "SpellEffect__SoulRip")
	call SaveStr(P,'A15V', 0, "OME")
	call SaveStr(P,'QM03', 0, "SpellEffect__FleshGolem")
	call SaveStr(P,'A0LK', 0, "OQE")
	call SaveStr(P,'A0J1', 0, "OSE")
	call SaveStr(P,'A1D7', 0, "OSE")
	call SaveStr(P,'A333', 0, "OTE")
	call SaveStr(P,'Z610', 0, "OUE")
	call SaveStr(P,'A3K5', 0, "OUE")
	call SaveStr(P,'Z609', 0, "OWE")
	call SaveStr(P,'Z608', 0, "OYE")
	call SaveStr(P,'Z607', 0, "O_E")
	call SaveStr(P,'Z606', 0, "O0E")
	call SaveStr(P,'Z605', 0, "SpellEffect__GhostWalk")
	call SaveStr(P,'Z604', 0, "O2E")
	call SaveStr(P,'Z603', 0, "O4E")
	call SaveStr(P,'Z602', 0, "O5E")
	call SaveStr(P,'Z601', 0, "O6E")
	call SaveStr(P,'A33A', 0, "O7E")
	call SaveStr(P,'AHtb', 0, "O8E")
	call SaveStr(P,'QB0H', 0, "O8E")
	call SaveStr(P,'A2S0', 0, "O9E")
	call SaveStr(P,'A0N8', 0, "RXE")
	call SaveStr(P,'A0NB', 0, "RAE")
	call SaveStr(P,'Z397', 0, "RNE")
	call SaveStr(P,'QB0F', 0, "RNE")
	call SaveStr(P,'A06V', 0, "RBE")
	call SaveStr(P,'A20T', 0, "RCE")
	call SaveStr(P,'A21G', 0, "RQE")
	call SaveStr(P,'A21F', 0, "RQE")
	call SaveStr(P,'A05T', 0, "RTE")
	call SaveStr(P,'A08H', 0, "RTE")
	call SaveStr(P,'A0X5', 0, "RUE")
	call SaveStr(P,'A0MN', 0, "SpellEffect__Voodoo") // 妖术
	
	call SaveStr(P,'A053', 0, "R_E")
	call SaveStr(P,'QM02', 0, "SpellEffect__Shapeshift")
	call SaveStr(P,'A03D', 0, "R3E")
	call SaveStr(P,'A0ZF', 0, "IVE")
	call SaveStr(P,'A094', 0, "IXE")
	call SaveStr(P,'A10R', 0, "IOE")
	call SaveStr(P,'A1OP', 0, "IRE")
	call SaveStr(P,'A0A2', 0, "IAE")
	call SaveStr(P,'A0MU', 0, "IBE")
	call SaveStr(P,'A29L', 0, "ICE")
	call SaveStr(P,'A447', 0, "ICE")
	call SaveStr(P,'A037', 0, "SpellEffect__Empower")
	call SaveStr(P,'A1RD', 0, "SpellEffect__Skewer")
	call SaveStr(P,'A02S', 0, "IME")
	call SaveStr(P,'A3Y8', 0, "amengmaw")
	call SaveStr(P,'A0G2', 0, "IPE")
	call SaveStr(P,'A1C0', 0, "EnableSplitShot")	//分裂箭开启
	call SaveStr(P,'A418', 0, "CancelSplitShot")	//分裂箭关闭
	call SaveStr(P,'A1AT', 0, "SpellEffect__StoneGaze")
	call SaveStr(P,'QB10', 0, "SpellEffect__StoneGaze")
	call SaveStr(P,'A194', 0, "SpellEffect__OpenWounds")
	call SaveStr(P,'A0SW', 0, "Infest")	//感染
	call SaveStr(P,'A0T2', 0, "IYE")
	call SaveStr(P,'A05V', 0, "IZE")
	call SaveStr(P,'A067', 0, "I_E")
	call SaveStr(P,'A08P', 0, "I_E")
	call SaveStr(P,'A0X7', 0, "I0E")
	call SaveStr(P,'A1H5', 0, "I1E")
	call SaveStr(P,'A2KO', 0, "SpellEffect__SpikedCarapace")
	
	call SaveStr(P,'A0FH', 0, "I3E")
	call SaveStr(P,'A0F0', 0, "I3E")
	call SaveStr(P,'A0EY', 0, "I3E")
	
	call SaveStr(P,'A344', 0, "I4E")
	call SaveStr(P,'A34C', 0, "I4E")
	call SaveStr(P,'A02H', 0, "I5E")
	call SaveStr(P,'A0YM', 0, "SpellEffect__StiflingDagger")
	call SaveStr(P,'A0PL', 0, "I7E")
	call SaveStr(P,'A0RA', 0, "I8E")
	call SaveStr(P,'A06I', 0, "I9E")
	call SaveStr(P,'A1CX', 0, "Dismember_Upgraded")
	call SaveStr(P,'A0FL', 0, "Dismember")
	call SaveStr(P,'A2TD', 0, "SpellEffect__Decrepify")
	call SaveStr(P,'A1E7', 0, "ABE")
	call SaveStr(P,'A1AO', 0, "AME")
	call SaveStr(P,'A1UV', 0, "AME")
	call SaveStr(P,'A06O', 0, "APE")
	call SaveStr(P,'A3NX', 0, "APE")
	call SaveStr(P,'A0H0', 0, "AQE")
	call SaveStr(P,'A05C', 0, "ASE")
	call SaveStr(P,'A29K', 0, "ATE")
	call SaveStr(P,'QB0I', 0, "ATE")
	call SaveStr(P,'A0HW', 0, "AUE")
	call SaveStr(P,'A0H9', 0, "SpellEffect__Haunt")
	call SaveStr(P,'A0HA', 0, "SpellEffect__Reality")
	call SaveStr(P,'A0G4', 0, "AZE")
	call SaveStr(P,'A1D8', 0, "AZE")
	call SaveStr(P,'A07Q', 0, "ATB")
	call SaveStr(P,'A0H4', 0, "SpellEffect__ConjureImage")
	call SaveStr(P,'A046', 0, "NXE")
	call SaveStr(P,'A3OH', 0, "a_chaoxi")
	
	call SaveStr(P,'A29I', 0, "NNE")
	call SaveStr(P,'A226', 0, "NCE")
	call SaveStr(P,'A0OR', 0, "NFE")
	call SaveStr(P,'A0NQ', 0, "NGE")
	call SaveStr(P,'A10Q', 0, "SpellEffect__Weave")
	call SaveStr(P,'A1DB', 0, "SpellEffect__Weave")
	call SaveStr(P,'A10L', 0, "NKE")
	call SaveStr(P,'A173', 0, "NLE")
	call SaveStr(P,'A013', 0, "NPE")
	call SaveStr(P,'A0A6', 0, "NPE")
	call SaveStr(P,'A1UZ', 0, "NQE")
	call SaveStr(P,'A080', 0, "NYE")
	call SaveStr(P,'A08X', 0, "N_E")
	call SaveStr(P,'A1NE', 0, "N0E")
	call SaveStr(P,'A2IG', 0, "N0E")
	call SaveStr(P,'A1NA', 0, "N1E")
	call SaveStr(P,'A06P', 0, "SpellEffect__Upheaval")
	call SaveStr(P,'A0J5', 0, "SpellEffect__FatalBonds")
	call SaveStr(P,'A0AS', 0, "N5E")
	call SaveStr(P,'S00U', 0, "SpellEffect__RainOfChaos")
	call SaveStr(P,'A0CT', 0, "N7E")
	call SaveStr(P,'A3DM', 0, "N7E")
	call SaveStr(P,'A1QW', 0, "N8E")
	call SaveStr(P,'A0NM', 0, "N9E")
	call SaveStr(P,'A0NE', 0, "BEE")
	call SaveStr(P,'A0NO', 0, "BRE")
	call SaveStr(P,'A0NT', 0, "BIE")
	call SaveStr(P,'A0NX', 0, "BIE")
	call SaveStr(P,'A1HS', 0, "SpellEffect__IceVortex")
	call SaveStr(P,'A1MG', 0, "BCE")
	call SaveStr(P,'A1MI', 0, "BDE")
	call SaveStr(P,'A2QE', 0, "BDE")
	call SaveStr(P,'A1HQ', 0, "BFE")
	call SaveStr(P,'A1IM', 0, "BJE")
	call SaveStr(P,'A1IN', 0, "BKE")
	call SaveStr(P,'A1J7', 0, "BLE")
	call SaveStr(P,'A04A', 0, "BPE")
	call SaveStr(P,'A28R', 0, "BQE")
	call SaveStr(P,'A28S', 0, "BSE")
	call SaveStr(P,'A45W', 0, "B_E")
	call SaveStr(P,'A45X', 0, "B0E")
	call SaveStr(P,'A3FA', 0, "B1E")
	call SaveStr(P,'A00P', 0, "B3E")
	call SaveStr(P,'A010', 0, "B4E")
	call SaveStr(P,'A1RJ', 0, "B6E")
	call SaveStr(P,'A461', 0, "B7E")
	call SaveStr(P,'A1RK', 0, "SpellEffect__Supernova")
	call SaveStr(P,'A43H', 0, "SpellEffect__Supernova")
	call SaveStr(P,'A1YX', 0, "CFE")
	call SaveStr(P,'A1S4', 0, "CGE")
	call SaveStr(P,'A1S8', 0, "SpellEffect__Disruption")
	call SaveStr(P,'A1SB', 0, "SpellEffect__SoulCatcher")
	call SaveStr(P,'A343', 0, "CUE")
	call SaveStr(P,'A34J', 0, "hystr_demonic_purge")
	call SaveStr(P,'A1SO', 0, "C_E")
	call SaveStr(P,'A1SQ', 0, "C1E")
	call SaveStr(P,'A1T5', 0, "C3E")
	call SaveStr(P,'A235', 0, "C3E")
	call SaveStr(P,'A229', 0, "SpellEffect__FlakCannon")
	call SaveStr(P,'A1SU', 0, "C9E")
	call SaveStr(P,'A1SW', 0, "DVE")
	call SaveStr(P,'A1TV', 0, "DEE")
	call SaveStr(P,'A1U6', 0, "SpellEffect__StaticStorm")
	call SaveStr(P,'A30N', 0, "SpellEffect__StaticStorm")
	call SaveStr(P,'A2KQ', 0, "DOE")
	call SaveStr(P,'A1PH', 0, "DRE")
	call SaveStr(P,'A1T8', 0, "DIE")
	call SaveStr(P,'A1TA', 0, "DAE")
	call SaveStr(P,'A1TB', 0, "DNE")
	call SaveStr(P,'A3FQ', 0, "DNE")
	call SaveStr(P,'A1YO', 0, "DBE")
	call SaveStr(P,'A1YQ', 0, "SpellEffect__WalrusPunch")
	call SaveStr(P,'A3DF', 0, "DDE")
	call SaveStr(P,'A3DE', 0, "SpellEffect__WalrusPunch")
	call SaveStr(P,'A1S7', 0, "DFE")
	call SaveStr(P,'A27F', 0, "DGE")
	call SaveStr(P,'A27G', 0, "DHE")
	call SaveStr(P,'A27H', 0, "DJE")
	call SaveStr(P,'A30J', 0, "DJE")
	call SaveStr(P,'QB06', 0, "DKE")
	call SaveStr(P,'A078', 0, "DKE")
	call SaveStr(P,'A04N', 0, "DLE")
	call SaveStr(P,'A2HS', 0, "DME")
	call SaveStr(P,'A2H0', 0, "SleightOfFist")
	call SaveStr(P,'QB0L', 0, "SleightOfFist")
	call SaveStr(P,'A2H3', 0, "DQE")
	call SaveStr(P,'A2JO', 0, "DSE")
	call SaveStr(P,'A2JQ', 0, "DSE")
	call SaveStr(P,'A2JP', 0, "DSE")
	call SaveStr(P,'A2JR', 0, "DSE")
	call SaveStr(P,'A2JL', 0, "DTE")
	call SaveStr(P,'A2CI', 0, "SpellEffect__Duel")
	call SaveStr(P,'A38C', 0, "SpellEffect__Duel")
	call SaveStr(P,'A2J2', 0, "DWE")
	call SaveStr(P,'A2JB', 0, "DYE")
	call SaveStr(P,'A2BG', 0, "DZE")
	call SaveStr(P,'A30H', 0, "DZE")
	call SaveStr(P,'A2BE', 0, "D_E")
	call SaveStr(P,'A2HN', 0, "SpellEffect__AncientSeal")
	call SaveStr(P,'A2IT', 0, "D1E")
	call SaveStr(P,'A2FK', 0, "D2E")
	call SaveStr(P,'A2E3', 0, "D3E")
	call SaveStr(P,'A2E5', 0, "D4E")
	call SaveStr(P,'A43Q', 0, "D4E")
	call SaveStr(P,'A43S', 0, "D4E")
	call SaveStr(P,'A11N', 0, "D5E")
	call SaveStr(P,'A300', 0, "D6E")
	call SaveStr(P,'A301', 0, "D7E")
	call SaveStr(P,'A07F', 0, "D8E")
	call SaveStr(P,'A0CC', 0, "D9E")
	call SaveStr(P,'A02Z', 0, "D9E")
	call SaveStr(P,'A32A', 0, "FVE")
	call SaveStr(P,'A32C', 0, "FEE")
	call SaveStr(P,'A32E', 0, "FXE")
	call SaveStr(P,'A32D', 0, "FOE")
	call SaveStr(P,'A32G', 0, "FRE")
	call SaveStr(P,'A004', 0, "FIE")
	call SaveStr(P,'A0GK', 0, "FAE")
	call SaveStr(P,'A0R0', 0, "DarkRift")
	call SaveStr(P,'A04C', 0, "FBE")
	call SaveStr(P,'A44U', 0, "FCE")
	call SaveStr(P,'A44X', 0, "SpellEffect__Bloodrage")
	call SaveStr(P,'A44Z', 0, "FFE")
	call SaveStr(P,'A451', 0, "FGE")
	call SaveStr(P,'A456', 0, "FHE")
	call SaveStr(P,'A454', 0, "FJE")
	call SaveStr(P,'A06B', 0, "FKE")
	call SaveStr(P,'A471', 0, "FKE")
	call SaveStr(P,'A2LB', 0, "FLE")
	call SaveStr(P,'A0Z0', 0, "FME")
	call SaveStr(P,'A01Z', 0, "SpellEffect__NatureGuise")
	call SaveStr(P,'A0CA', 0, "SpellEffect__Shukuchi")
	call SaveStr(P,'A2N1', 0, "Item_SpellEffect_ShadowAmulet")
	call SaveStr(P,'A055', 0, "FTE")
	call SaveStr(P,'A085', 0, "FUE")
	call SaveStr(P,'A121', 0, "FWE")
	call SaveStr(P,'A07Z', 0, "FYE")
	call SaveStr(P,'A44S', 0, "FYE")
	call SaveStr(P,'A01V', 0, "FZE")
	call SaveStr(P,'A1HH', 0, "F_E")
	call SaveStr(P,'QB00', 0, "FTE")
	call SaveStr(P,'QB01', 0, "SpellEffect__Shukuchi")
	call SaveStr(P,'QB04', 0, "W5V")
	call SaveStr(P,'A2O2', 0, "F0E")
	call SaveStr(P,'A34A', 0, "F1E")
	call SaveStr(P,'A40K', 0, "F2E")
	call SaveStr(P,'A40L', 0, "F2E")
	call SaveStr(P,'A40M', 0, "F2E")
	call SaveStr(P,'A40N', 0, "F2E")
	call SaveStr(P,'A2TI', 0, "F3E")
	call SaveStr(P,'A29J', 0, "F4E")
	call SaveStr(P,'A3OJ', 0, "F4E")
	call SaveStr(P,'A02A', 0, "F5E")
	call SaveStr(P,'A06M', 0, "F6E")
	call SaveStr(P,'A08V', 0, "F7E")
	call SaveStr(P,'A1AU', 0, "F8E")
	call SaveStr(P,'QB0J', 0, "F9E")
	call SaveStr(P,'A04W', 0, "F9E")
	call SaveStr(P,'A011', 0, "GVE")
	call SaveStr(P,'A44V', 0, "GEE")
	call SaveStr(P,'A46J', 0, "GXE")
	call SaveStr(P,'A42I', 0, "GOE")
	call SaveStr(P,'A38R', 0, "GAE")
	call SaveStr(P,'A38V', 0, "GNE")
	call SaveStr(P,'A3BP', 0, "GBE")
	//call SaveStr(P,'A39K', 0, "GCE")
	call SaveStr(P,'A395', 0, "GDE")
	call SaveStr(P,'A2K4', 0, "GGE")

	call SaveStr(P,'A083', 0, "SpellEffect__Bloodlust")

	
	call SaveStr(P,'A3W8', 0, "fj_trigger")
	call SaveStr(P,'A3UH', 0, "jys_trigger")
	
	// 马甲的技能 或者 物品
	call SaveStr(P,'A0AE', 12, "SpellEffect__Rabid")
	call SaveStr(P,'A02X', 12, "GHE")
	call SaveStr(P,'AIsw', 12, "GHE")
	call SaveStr(P,'A0H6', 12, "GLE")
	call SaveStr(P,'A0B6', 12, "GME")
	call SaveStr(P,'A0JT', 12, "GPE")
	call SaveStr(P,'A0OT', 12, "GQE")
	call SaveStr(P,'Aeat', 12, "GSE")
	call SaveStr(P,'ANTG', 12, "GSE")
	call SaveStr(P,'A231', 12, "SpellEffect__TownPortal")
	call SaveStr(P,'A3AG', 12, "SpellEffect__TownPortal")
	call SaveStr(P,'A1R5', 12, "SpellEffect__TownPortal")
	call SaveStr(P,'A0HB', 12, "GUE")
	call SaveStr(P,'A0D3', 12, "GUE")
	call SaveStr(P,'A0DF', 12, "GUE")
	call SaveStr(P,'ACch', 12, "GWE")
	call SaveStr(P,'A11F', 12, "GYE")
	call SaveStr(P,'A11E', 12, "GYE")
	call SaveStr(P,'A0S3', 12, "GYE")
	call SaveStr(P,'A11D', 12, "GYE")
	call SaveStr(P,'A11G', 12, "GYE")
	call SaveStr(P,'A11H', 12, "GYE")
	call SaveStr(P,'A0CK', 12, "GZE")
	call SaveStr(P,'A1FP', 12, "G_E")
	call SaveStr(P,'A02W', 12, "Item_SpellEffect_RefresherOrb")
	call SaveStr(P,'A397', 12, "Item_SpellEffect_MoonShard")
	call SaveStr(P,'AZSZ', 12, "Item_SpellEffect_IronwoodBranch")
	call SaveStr(P,'A0FD', 12, "G1E")
	call SaveStr(P,'A3TP', 12, "G1E")
	call SaveStr(P,'A0JL', 12, "G2E")
	call SaveStr(P,'A0T9', 12, "G3E")
	call SaveStr(P,'A0VR', 12, "G4E")
	call SaveStr(P,'A0JY', 12, "G5E")
	call SaveStr(P,'A138', 12, "G6E")
	call SaveStr(P,'A14C', 12, "G6E")
	call SaveStr(P,'A14D', 12, "G7E")
	//call SaveStr(P,'A35F', 12, "GameOptions")
	call SaveStr(P,'AU02', 12, "MUSpellEffect")
	call SaveStr(P,'A141', 12, "G8E")
	call SaveStr(P,'A1WI', 12, "G8E")
	call SaveStr(P,'A12W', 12, "G9E")
	call SaveStr(P,'A15W', 12, "Item_SpellEffect_BladeMail")
	call SaveStr(P,'A19M', 12, "Item_SpellEffect_ForceStaff")
	call SaveStr(P,'A3U8', 12, "Item_SpellEffect_HurricanePike")
	call SaveStr(P,'AIpg', 12, "HOE")
	call SaveStr(P,'A1AC', 12, "HRE")
	call SaveStr(P,'A1AS', 12, "HIE")
	call SaveStr(P,'A2KS', 12, "HNE")
	call SaveStr(P,'A0GD', 12, "HDE")
	call SaveStr(P,'A1EW', 12, "HFE")
	call SaveStr(P,'A0B8', 12, "HGE")
	call SaveStr(P,'A1WE', 12, "HGE")
	call SaveStr(P,'A1MO', 12, "HHE")
	call SaveStr(P,'A1Q8', 12, "HJE")
	call SaveStr(P,'A1QD', 12, "HKE")
	call SaveStr(P,'A1T7', 12, "HME")
	call SaveStr(P,'A0K7', 12, "HPE")
	call SaveStr(P,'A28Y', 12, "HQE")
	call SaveStr(P,'A1ZI', 12, "HSE")
	call SaveStr(P,'A1ZW', 12, "HTE")
	call SaveStr(P,'A206', 12, "HUE")
	call SaveStr(P,'A28D', 12, "SpellEffect__VeilOfDiscord")
	call SaveStr(P,'A2EA', 12, "H_E")
	call SaveStr(P,'A2HQ', 12, "H2E")
	call SaveStr(P,'A02O', 12, "H4E")
	call SaveStr(P,'A08Y', 12, "H4E")
	call SaveStr(P,'A08Z', 12, "H4E")
	call SaveStr(P,'A090', 12, "H4E")
	call SaveStr(P,'A092', 12, "H4E")
	call SaveStr(P,'A3K7', 12, "H5E")
	call SaveStr(P,'A2TK', 12, "H7E") //血精石
	call SaveStr(P,'AItb', 12, "H8E")
	call SaveStr(P,'A1FD', 12, "H9E")
	call SaveStr(P,'A0JZ', 12, "JVE")
	call SaveStr(P,'A2K7', 12, "AbyssalBlade_Overwhelm") // 深渊之刃
	

	call SaveStr(P,'Adsm', 0, "JXE")
	call SaveStr(P,'Acdh', 0, "JOE")
	call SaveStr(P,'A1P8', 1, "JRE")
	call SaveStr(P,'A085', 1, "JNE")
	call SaveStr(P,'A2QT', 1, "JFE")
	call SaveStr(P,'A1AA', 2, "JGE")	//回音重踏1
	call SaveStr(P,'A2LK', 2, "JGE")
	call SaveStr(P,'A065', 2, "JHE")
	call SaveStr(P,'A0BE', 2, "E8E")
	call SaveStr(P,'A064', 3, "JPE")
	call SaveStr(P,'A0AM', 3, "JQE")
	call SaveStr(P,'A0A3', 3, "JQE")
	call SaveStr(P,'A0A4', 3, "JQE")
	call SaveStr(P,'A1FZ', 3, "JQE")
	call SaveStr(P,'A1WF', 3, "JTE")
	call SaveStr(P,'A451', 3, "JUE")
	call SaveStr(P,'A0AS', 3, "JWE")
	call SaveStr(P,'A0SW', 3, "JYE")
	call SaveStr(P,'A0EC', 3, "JZE")
	call SaveStr(P,'A2QM', 3, "J_E")
	call SaveStr(P,'A04Y', 3, "J4E")
	call SaveStr(P,'A34A', 3, "J7E")
	call SaveStr(P,'A34J', 3, "demonic_purge_charges0") //无充能邪恶净化
	call SaveStr(P,'A1AA', 3, "KVE")	//回音重踏 前摇
	call SaveStr(P,'A3DM', 3, "KXE")	//时光倒流
	call SaveStr(P,'A2LK', 3, "KVE")
	call SaveStr(P,'A11N', 3, "KOE")
	call SaveStr(P,'AEbl', 3, "KRE")
	call SaveStr(P,'QB08', 3, "KRE")
	call SaveStr(P,'A3DF', 3, "KNE")
	call SaveStr(P,'A00L', 3, "KBE")
	call SaveStr(P,'A361', 3, "KCE")
	call SaveStr(P,'A14O', 3, "KDE")
	call SaveStr(P,'A3FJ', 3, "KDE")
	call SaveStr(P,'A2QI', 3, "KHE")
	call SaveStr(P,'A2QT', 3, "KJE")
	call SaveStr(P,'A180', 3, "KLE")
	call SaveStr(P,'A1BX', 3, "KME")
	call SaveStr(P,'A30L', 3, "KME")
	call SaveStr(P,'A21E', 3, "KPE")
	call SaveStr(P,'A0M1', 3, "KQE")
	call SaveStr(P,'A1AX', 3, "KQE")
	call SaveStr(P,'A10U', 3, "KSE")
	call SaveStr(P,'A01P', 3, "KTE")
	call SaveStr(P,'A24D', 3, "KUE")
	call SaveStr(P,'A10D', 3, "KWE")
	call SaveStr(P,'A0K9', 3, "KYE")
	call SaveStr(P,'A190', 3, "KZE")
	call SaveStr(P,'A0BZ', 3, "K_E")
	call SaveStr(P,'A0IN', 3, "K0E")
	call SaveStr(P,'A1AW', 3, "K0E")
	call SaveStr(P,'A02A', 3, "K2E")
	call SaveStr(P,'A0RW', 3, "K3E")
	call SaveStr(P,'A0OJ', 3, "K4E")
	call SaveStr(P,'A0QE', 3, "K5E")
	call SaveStr(P,'AHtb', 3, "K6E")
	call SaveStr(P,'QB0H', 3, "K6E")
	call SaveStr(P,'A0R0', 3, "K7E")
	call SaveStr(P,'A226', 3, "K9E")
	call SaveStr(P,'A32D', 3, "LEE")
	call SaveStr(P,'A08Q', 3, "LXE")
	call SaveStr(P,'A08c', 3, "bsckj")
	call SaveStr(P,'A2TD', 3, "LOE")
	call SaveStr(P,'A095', 3, "LRE")
	call SaveStr(P,'A09W', 3, "LRE")
	call SaveStr(P,'A12K', 3, "LIE")
	call SaveStr(P,'A1S8', 3, "LNE")
	call SaveStr(P,'A1TB', 3, "LBE")
	call SaveStr(P,'A3FQ', 3, "LBE")
	call SaveStr(P,'QB0L', 3, "LCE")
	call SaveStr(P,'A2H0', 3, "LCE")
	call SaveStr(P,'A0B1', 3, "LFE")
	call SaveStr(P,'A064', 4, "LHE")
	call SaveStr(P,'A1P8', 4, "LKE")
	call SaveStr(P,'A21L', 4, "LLE")
	call SaveStr(P,'A0I8', 4, "LME")
	call SaveStr(P,'A0CZ', 4, "LPE")
	call SaveStr(P,'A0AK', 4, "LQE")
	call SaveStr(P,'A1FY', 4, "LQE")
	call SaveStr(P,'A0S1', 4, "LSE")
	call SaveStr(P,'A0MB', 4, "LearnSkill__PermanentInvisibility")
	call SaveStr(P,'A0MB', 5, "LearnSkill__PermanentInvisibility")
	call SaveStr(P,'A0MX', 4, "LearnSkill__DrunkenBrawler")
	call SaveStr(P,'A34J', 4, "LZE")
	call SaveStr(P,'A32G', 4, "L_E")
	call SaveStr(P,'AIcd', 4, "L0E")
	call SaveStr(P,'A0NS', 4, "LearnSkill__BorrowedTime")
	call SaveStr(P,'A1DA', 4, "LearnSkill__BorrowedTime")
	call SaveStr(P,'A517', 4, "LearnSkill__BorrowedTime")
	call SaveStr(P,'A518', 4, "LearnSkill__BorrowedTime")
	call SaveStr(P,'A0RP', 4, "L2E")
	call SaveStr(P,'A449', 4, "L2E")
	call SaveStr(P,'A34A', 4, "LearnLevel1Skill_DeathFraud")
	call SaveStr(P,'A2O2', 4, "L4E")
	call SaveStr(P,'QF88', 4, "L5E")
	call SaveStr(P,'A0VC', 4, "L5E")
	call SaveStr(P,'A062', 4, "L6E")
	call SaveStr(P,'A0M3', 4, "MXE")
	call SaveStr(P,'A06B', 4, "MOE")
	call SaveStr(P,'A471', 4, "MOE")
	call SaveStr(P,'A01N', 4, "MAE")
	call SaveStr(P,'A0BR', 4, "MNE")
	call SaveStr(P,'A03P', 4, "MBE")
	call SaveStr(P,'A04E', 4, "MDE")
	call SaveStr(P,'A1NA', 4, "LearnLevel1Skill_SoulAssumption")
	call SaveStr(P,'A0H9', 4, "MPE")
	call SaveStr(P,'A1E6', 4, "MWE")
	call SaveStr(P,'A0QQ', 4, "LearnLevel1Skill_BerserkerBlood")

	call SaveStr(P,'A0MP', 4, "LearnLevel1Skill_ManaShield")
	

	call SaveStr(P,'A0QW', 4, "MZE")
	call SaveStr(P,'A1EA', 4, "M_E")
	call SaveStr(P,'QB03', 4, "M_E")
	call SaveStr(P,'A01Y', 4, "SKill_Learn_Reincarnation")
	call SaveStr(P,'A1AZ', 4, "SKill_Learn_Reincarnation")
	
	call SaveStr(P,'A0DJ', 4, "Learn_HaveCoolDownSkill") //余震
	call SaveStr(P,'A0C6', 4, "Learn_HaveCoolDownSkill") //反击螺旋
	call SaveStr(P,'A2EY', 4, "Learn_HaveCoolDownSkill") //勇气之霎
	//	call SaveStr(P,'A522', 4, "Learn_HaveCoolDownSkill") //水刀
	//学习
	
	call SaveStr(P,'A18X', 4, "M4E")
	call SaveStr(P,'A1CD', 4, "GetSkill_NaturalOrder")
	call SaveStr(P,'A1IN', 4, "M9E")
	call SaveStr(P,'A28Q', 4, "PVE")
	call SaveStr(P,'A27V', 4, "GetSkill_NullField")
	call SaveStr(P,'A064', 1000, "LHE")
	call SaveStr(P,'A0K9', 1000, "PXE")
	call SaveStr(P,'A46E', 1000, "POE")
	call SaveStr(P,'A0CG', 1000, "LearnSkill__GeminateAttack")
	call SaveStr(P,'A086', 1000, "PNE")
	call SaveStr(P,'A43S', 1000, "PBE")
	call SaveStr(P,'A0BR', 1000, "MNE")
	call SaveStr(P,'A0EY', 1000, "PDE")
	call SaveStr(P,'A03E', 1000, "PFE")
	call SaveStr(P,'A32G', 1000, "L_E")
	call SaveStr(P,'A0MX', 1000, "LearnSkill__DrunkenBrawler")
	call SaveStr(P,'A21M', 1000, "LLE")
	call SaveStr(P,'A34A', 1000, "LearnLevel1Skill_DeathFraud")
	call SaveStr(P,'A40B', 1000, "PGE")
	call SaveStr(P,'A2O2', 1000, "L4E")
	call SaveStr(P,'A34J', 1000, "LZE")
	call SaveStr(P,'A0MB', 1000, "LearnSkill__PermanentInvisibility")
	call SaveStr(P,'A0MB', 1001, "LearnSkill__PermanentInvisibility")
	call SaveStr(P,'P019', 1000, "PHE")
	call SaveStr(P,'A1P8', 1000, "LKE")
	call SaveStr(P,'A0RP', 1000, "L2E")
	call SaveStr(P,'A449', 1000, "L2E")
	call SaveStr(P,'AIcd', 1000, "L0E")
	call SaveStr(P,'A0VC', 1000, "L5E")
	call SaveStr(P,'QF88', 1000, "L5E")
	call SaveStr(P,'A1IN', 1000, "M9E")
	call SaveStr(P,'A13T', 1000, "LearnSkill__Tidebringer")
	//call SaveStr(P,'A522', 1000, "LearnSkill__Tidebringer")
	call SaveStr(P,'A19Q', 1000, "PPE")
	call SaveStr(P,'A0CY', 1000, "LearnSkill__Grow")
	call SaveStr(P,'A1CD', 1000, "GetSkill_NaturalOrder")
	call SaveStr(P,'A0QQ', 1000, "LearnLevel1Skill_BerserkerBlood")
	call SaveStr(P,'A0M3', 1000, "PSE")
	call SaveStr(P,'A03U', 1000, "PTE")
	call SaveStr(P,'A062', 1000, "L6E")
	call SaveStr(P,'A0KX', 1000, "PUE")
	call SaveStr(P,'A0A5', 1000, "PYE")
	call SaveStr(P,'A27V', 1000, "GetSkill_NullField")
	call SaveStr(P,'A28Q', 1000, "PVE")
	call SaveStr(P,'A18X', 1000, "M4E")
	call SaveStr(P,'A11N', 1000, "PZE")
	call SaveStr(P,'A01Y', 1000, "SKill_Learn_Reincarnation")
	call SaveStr(P,'A1AZ', 1000, "SKill_Learn_Reincarnation")
	//被动学习技能
	call SaveStr(P,'A0DJ', 1000, "Learn_HaveCoolDownSkill") //余震
	//	call SaveStr(P,'A522',1000, "Learn_HaveCoolDownSkill") //水刀
	call SaveStr(P,'A0C6', 1000, "Learn_HaveCoolDownSkill") //反击螺旋
	call SaveStr(P,'A2EY', 1000, "Learn_HaveCoolDownSkill") //勇气之霎
	
	call SaveStr(P,'A0RO', 1000, "P_E")
	call SaveStr(P,'A0QW', 1000, "MZE")
	call SaveStr(P,'A1E6', 1000, "MWE")

	call SaveStr(P,'A0NS', 1000, "LearnSkill__BorrowedTime")
	call SaveStr(P,'A0VX', 1000, "LearnSkill__GravekeeperCloak")
	call SaveStr(P,'A1NA', 1000, "LearnLevel1Skill_SoulAssumption")
	call SaveStr(P,'A04E', 1000, "MDE")
	call SaveStr(P,'A06D', 5, "LearnSkill__FleshHeap")
	call SaveStr(P,'A06D', 1000, "LearnSkill__FleshHeap")
	call SaveStr(P,'A06D', 1001, "LearnSkill__FleshHeap")
	call SaveStr(P,'A03P', 1000, "MBE")
	call SaveStr(P,'A01N', 1000, "MAE")
	call SaveStr(P,'A0I8', 1000, "LME")
	call SaveStr(P,'A06B', 1000, "MOE")
	call SaveStr(P,'A524', 4, "LearnSkill__Jinada")
	call SaveStr(P,'A524', 1000, "LearnSkill__Jinada")
	call SaveStr(P,'A0IF', 1000, "P5E")
	call SaveStr(P,'A1EA', 1000, "M_E")
	call SaveStr(P,'QB03', 1000, "M_E")
	call SaveStr(P,'A0AK', 1000, "LQE")
	call SaveStr(P,'A0LV', 1000, "P7E")
	call SaveStr(P,'A2AI', 1000, "P8E")
	call SaveStr(P,'A0CZ', 1000, "LPE")
	//call SaveStr(P,'A2S0', 1000, "P9E")
	call SaveStr(P,'A0MM', 5, "LearnSkill__CorrosiveSkin")
	call SaveStr(P,'A0MM', 1000, "LearnSkill__CorrosiveSkin")
	call SaveStr(P,'A0MM', 1001, "LearnSkill__CorrosiveSkin")
	call SaveStr(P,'A0CL', 1000, "Q_E")
	call SaveStr(P,'A0OO', 1000, "Q1E")
	call SaveStr(P,'A303', 1000, "Q2E")
	call SaveStr(P,'A0H4', 1000, "Q5E")
	call SaveStr(P,'Q0BK', 1000, "SXE")
	call SaveStr(P,'A2JK', 1000, "SAE")

	call SaveStr(P,'A440', 1000, "SCE")
	call SaveStr(P,'A0A8', 1000, "SLE")
	call SaveStr(P,'A0K9', 5, "PXE")
	call SaveStr(P,'A46E', 5, "POE")
	call SaveStr(P,'A43S', 5, "PBE")
	call SaveStr(P,'A440', 5, "SCE")
	call SaveStr(P,'A2E5', 5, "PBE")
	call SaveStr(P,'Q0BK', 5, "SXE")
	call SaveStr(P,'A2JK', 5, "SAE")

	call SaveStr(P,'A1C0', 5, "Learn__SplitShot")
	call SaveStr(P,'A1C0', 1000, "Learn__SplitShot")
	call SaveStr(P,'A1C0', 1001, "Learn__SplitShot")

	//call SaveStr(P,'A2S0', 5, "P9E")
	call SaveStr(P,'A11N', 5, "PZE")
	call SaveStr(P,'A2AI', 5, "P8E")
	call SaveStr(P,'A03E', 5, "PFE")
	call SaveStr(P,'A0VX', 5, "LearnSkill__GravekeeperCloak")
	call SaveStr(P,'A0IF', 5, "P5E")



	call SaveStr(P,'A0KY', 5, "Learn__SpellShield")
	call SaveStr(P,'A0KY', 1000, "Learn__SpellShield")
	call SaveStr(P,'A0KY', 1001, "Learn__SpellShield")
	
	call SaveStr(P,'A086', 5, "PNE")
	call SaveStr(P,'A08E', 5, "SME")
	call SaveStr(P,'A0A5', 5, "PYE")
	call SaveStr(P,'A0CY', 5, "LearnSkill__Grow")
	call SaveStr(P,'A19Q', 5, "PPE")
	call SaveStr(P,'A0EY', 5, "PDE")
	call SaveStr(P,'A0KX', 5, "PUE")
	call SaveStr(P,'A0CG', 5, "LearnSkill__GeminateAttack")
	call SaveStr(P,'A0OO', 5, "Q1E")
	call SaveStr(P,'A03U', 5, "PTE")
	call SaveStr(P,'P019', 5, "PHE")
	call SaveStr(P,'A0H4', 5, "Q5E")
	call SaveStr(P,'A0CL', 5, "Q_E")
	call SaveStr(P,'A0RO', 5, "P_E")
	call SaveStr(P,'A40B', 5, "PGE")
	call SaveStr(P,'A13T', 5, "LearnSkill__Tidebringer")
	//call SaveStr(P,'A522', 5, "LearnSkill__Tidebringer")
	call SaveStr(P,'A0LV', 5, "P7E")
	call SaveStr(P,'A32Y', 5, "SQE")
	call SaveStr(P,'A32Z', 5, "SWE")
	call SaveStr(P,'A331', 5, "SYE")
	call SaveStr(P,'A303', 5, "Q2E")
	call SaveStr(P,'A0A8', 5, "SLE")
	call SaveStr(P,'A440',1001, "SCE")
	call SaveStr(P,'A0K9',1001, "PXE")
	call SaveStr(P,'A46E',1001, "POE")
	call SaveStr(P,'A0CG',1001, "LearnSkill__GeminateAttack")
	call SaveStr(P,'A2E5',1001, "PBE")

	call SaveStr(P,'A2JK',1001, "SAE")
	call SaveStr(P,'A11N',1001, "PZE")
	call SaveStr(P,'A086',1001, "PNE")
	call SaveStr(P,'A0EY',1001, "PDE")
	call SaveStr(P,'A331',1001, "SYE")
	call SaveStr(P,'A40B',1001, "PGE")
	call SaveStr(P,'A0H4',1001, "Q5E")
	call SaveStr(P,'A32Z',1001, "SWE")
	call SaveStr(P,'A0KX',1001, "PUE")
	call SaveStr(P,'A32Y',1001, "SQE")
	call SaveStr(P,'Q0BK',1001, "SXE")
	call SaveStr(P,'A303',1001, "Q2E")
	call SaveStr(P,'P019',1001, "PHE")
	call SaveStr(P,'A0OO',1001, "Q1E")
	//call SaveStr(P,'A2S0',1001, "P9E")
	call SaveStr(P,'A0LV',1001, "P7E")
	call SaveStr(P,'A0RO',1001, "P_E")
	call SaveStr(P,'A13T',1001, "LearnSkill__Tidebringer")
	//call SaveStr(P,'A522',1001, "LearnSkill__Tidebringer")
	call SaveStr(P,'A19Q',1001, "SZE")
	call SaveStr(P,'A03U',1001, "PTE")
	call SaveStr(P,'A0A5',1001, "PYE")
	call SaveStr(P,'A03E',1001, "PFE")
	call SaveStr(P,'A0VX',1001, "LearnSkill__GravekeeperCloak")
	call SaveStr(P,'A2AI',1001, "P8E")
	call SaveStr(P,'A0CY',1001, "LearnSkill__Grow")
	call SaveStr(P,'A0IF',1001, "P5E")
	call SaveStr(P,'A0CL',1001, "Q_E")
	call SaveStr(P,'A0A8',1001, "SLE")
	call SaveStr(P,'A01O', 7, "S_E")
	call SaveStr(P,'A04P', 7, "S0E")
	call SaveStr(P,'A1AU', 7, "S0E")
	call SaveStr(P,'A454', 7, "S1E")
	call SaveStr(P, StringHash("-display"), 10, "S3E")
endfunction
function S5E takes nothing returns nothing
	call SaveBoolean(P, 1,'A1FP', true)
	call SaveInteger(P, 2,'A1FP','I0AB')
	call SaveInteger(P, 1,'I0AB','J000')
	call SaveReal(P, 0,'I0AB', 35)
	call SaveInteger(P, 0,'J000','I0AB')
	call SaveBoolean(P, 1,'A0B8', true)
	call SaveInteger(P, 2,'A0B8','I09F')
	call SaveInteger(P, 1,'I09F','J001')
	call SaveReal(P, 0,'I09F', 35)
	call SaveReal(P, 0,'J001', 35)
	call SaveInteger(P, 0,'J001','I09F')
	call SaveBoolean(P, 1,'A1WE', true)
	call SaveInteger(P, 2,'A1WE','I0MU')
	call SaveInteger(P, 1,'I0MU','J002')
	call SaveReal(P, 0,'I09F', 50)
	call SaveReal(P, 0,'J002', 50)
	call SaveInteger(P, 0,'J002','I0MU')
	call SaveInteger(P, 0,'I09F','A0B8')
	call SaveInteger(P, 0,'I0MU','A1WE')
	call SaveInteger(P, 0,'I00Z','A0T9')
	call SaveInteger(P, 0,'I0AL','AChx')
	call SaveInteger(P, 0,'I012','A0FD')
	call SaveInteger(P, 0,'I08O','A15W')
	call SaveInteger(P, 0,'I08Z','A1T7')
	call SaveInteger(P, 0,'I0HI','A19M')
	call SaveInteger(P, 0,'I09M','A02O')
	call SaveInteger(P, 0,'I09P','A08Y')
	call SaveInteger(P, 0,'I09N','A08Z')
	call SaveInteger(P, 0,'I09O','A090')
	call SaveInteger(P, 0,'I09L','A092')
	call SaveInteger(P, 0,'I0O3','A28D')
	call SaveInteger(P, 0,'I0OL','A2EA')
	call SaveInteger(P, 0,'I093','A0CK')
	call SaveInteger(P, 0,'I066','AIda')
	call SaveInteger(P, 0,'I0K6','A1EW')
	call SaveInteger(P, 0,'I0KY','A1MO')
	call SaveInteger(P, 0,'I0N0','A1ZI')
	call SaveInteger(P, 0,'I0NE','A1ZW')
	call SaveInteger(P, 0,'I0OX','A2K7')
	call SaveInteger(P, 0,'I09H','A017')
	call SaveInteger(P, 0,'I0JI','A1AC')
	call SaveInteger(P, 0,'I0LT','A1QD')
	call SaveInteger(P, 0,'I0BE','A0JL')
	call SaveInteger(P, 0,'I08Y','AIxk')
	call SaveInteger(P, 0,'I08R','AIpg')
	call SaveInteger(P, 0,'I0J9','AIpg')
	call SaveInteger(P, 0,'I0OV','A2K4')
	call SaveInteger(P, 0,'I06B','A231')
	call SaveInteger(P, 0,'I0GJ','A12W')
	call SaveInteger(P, 0,'I0LL','A1Q8')
	call SaveInteger(P, 0,'I0GC','A0JY')
	call SaveInteger(P, 0,'I0HB','A0JY')
endfunction
function S6E takes nothing returns nothing
	local player p
	local integer WVV = 0
	set CK[0]= 2
	set CK[1]= 2
	call UIV() // 玩家退出
	call InitActiveAbilitys() // 初始化大部分技能
	call S5E()
	call W3V() // 再装填和潮汐使者
	call SetAllPlayerAbilityUnavailable('A509')
	call SetAllPlayerAbilityUnavailable('A515')
	//call SetAllPlayerAbilityUnavailable('A521')
	//call SetAllPlayerAbilityUnavailable('A147')
	call SetAllPlayerAbilityUnavailable('A228')
	call SetAllPlayerAbilityUnavailable('A0B8')
	call SetAllPlayerAbilityUnavailable('A1WE')
	call ExecuteFunc("InitPassiveAbilitys")
	loop
		set p = Player(WVV)
		call TriggerRegisterPlayerUnitEvent(JJ, p, EVENT_PLAYER_UNIT_ATTACKED, null)
		call TriggerRegisterPlayerUnitEvent(JJ, p, EVENT_PLAYER_UNIT_DEATH, null)
		set WVV = WVV + 1
	exitwhen WVV ==$F
	endloop
	set p = null
endfunction
function S9E takes player p, integer WTV, boolean b returns nothing
	call SaveBoolean(P, GetHandleId(p), WTV, b == false)
	call SetPlayerAbilityAvailable(p, WTV, b)
endfunction
function TVE takes integer id returns integer
	local integer i = 0
	loop
		if VUV[i]== id then
			return i
		endif
		set i = i + 1
	endloop
	return -1
endfunction
function TEE takes integer TXE, integer TOE, string TIE, string TNE returns boolean
	local integer i
	local integer k
	local string array s1
	local string array s2
	local integer j
	local integer o
	if TOE >-1 then
		if HaveSavedString(Q, TXE, 0)== false or HaveSavedString(Q, TOE, 0)== false then
			return false
		endif
		set i = 0
		loop
		exitwhen HaveSavedString(Q, TXE, i)== false
			set s1[i]= LoadStr(Q, TXE, i)
			set i = i + 1
		endloop
		set k = 0
		loop
		exitwhen HaveSavedString(Q, TOE, k)== false
			set s2[k]= LoadStr(Q, TOE, k)
			set k = k + 1
		endloop
		if i == 0 or k == 0 then
			return false
		endif
		set j = 0
		loop
			set o = 0
		exitwhen j >= i
			loop
			exitwhen o >= k
				if s1[j]== s2[o]and s1[j]!= TNE then
					return true
				endif
				set o = o + 1
			endloop
			set j = j + 1
		endloop
		return false
	else
		set i = 0
		loop
		exitwhen HaveSavedString(Q, TXE, i)== false
			if LoadStr(Q, TXE, i)== TIE then
				return true
			endif
			set i = i + 1
		endloop
		return false
	endif
	return true
endfunction
function TBE takes integer id returns integer
	local integer i = 1
	loop
		if NF[i]== id then
			return i
		endif
		set i = i + 1
	exitwhen i > AghanimUpgradeMaxIndex
	endloop
	return -1
endfunction
// 获取物品的索引
function GetItemIndex takes item it returns integer
	local integer id
	local integer i = 1
	if it == null then
		return -2
	endif
	set id = GetItemTypeId(it)
	if HaveSavedInteger(ObjectData, OBJ_ITEM_INDEX, id) then
		return LoadInteger(ObjectData, OBJ_ITEM_INDEX, id)
	endif
	return -1
endfunction
function TDE takes unit u, integer id, player p, boolean b, integer i returns nothing
	local item it = UnitAddItemById(u, id)
	call SetItemPlayer(it, p, b)
	call SetItemUserData(it, i)
	set it = null
endfunction

// 使得该技能不会受到重置单位所有冷却的影响
function SetSkillDisableRefreshCoolDown takes integer skillId returns nothing
	set DisableRefreshCoolDownSkillId[0] = DisableRefreshCoolDownSkillId[0] + 1
	set DisableRefreshCoolDownSkillId[DisableRefreshCoolDownSkillId[0]] = skillId
endfunction
function AddJinadaEffectActions takes unit u returns nothing
	call UnitAddPermanentAbility(u,'A1IS')
	set JinadaCount = JinadaCount + 1
endfunction
// 重置单位技能 但有一些技能是不会被重置的
function EXUnitResetCooldown takes unit whichUnit returns nothing
	local integer i = 0
	loop
	exitwhen i > DisableRefreshCoolDownSkillId[0]
		if GetUnitAbilityLevel(whichUnit, DisableRefreshCoolDownSkillId[i]) > 0 then
			set Temp__ArrayReal[i] = YDWEGetUnitAbilityState(whichUnit, DisableRefreshCoolDownSkillId[i], 1)
		endif
		set i = i + 1
	endloop
	if YDWEGetUnitAbilityState(whichUnit, 'A1IQ', 1) != 0. then
		call AddJinadaEffectActions(whichUnit)
	endif
	call UnitResetCooldown(whichUnit)
	set i = 0
	loop
	exitwhen i > DisableRefreshCoolDownSkillId[0]
		if Temp__ArrayReal[i] > 0 then
			call YDWESetUnitAbilityState(whichUnit, DisableRefreshCoolDownSkillId[i], 1, Temp__ArrayReal[i])
		endif
		set i = i + 1
	endloop
endfunction

function TFE takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	local integer i = 0
	local integer k = 5
	local integer array TGE
	local player array THE
	local integer id
	local item it
	set TGE[0]= 0
	set TGE[1]= 0
	set TGE[2]= 0
	set TGE[3]= 0
	set TGE[4]= 0
	set TGE[5]= 0
	call DisableTrigger(CUV)
	loop
		set it = UnitItemInSlot(u, i)
		set id = GetItemIndex(it)
		if id == I9V or id == AVV or id == AEV or id == AXV or id == AOV or id == ARV or id == I_V or id == AKV or id == ALV or id == AMV or id == IFV or id == A6V or id == NVV or id == NZV then
			set TGE[i]= GetItemTypeId(it)
			set THE[i]= GetItemPlayer(it)
			call RemoveItem(it)
		endif
		set i = i + 1
	exitwhen i > k
	endloop
	call EXUnitResetCooldown(u)
	call TimerStart(ESV[GetPlayerId(p)], 0, false, null)
	call TimerStart(ETV[GetPlayerId(p)], 0, false, null)
	call FlushChildHashtable(W, GetHandleId(u))
	set i = 0
	set k = 5
	loop
		if TGE[i]> 0 then
			set it = CreateItem(TGE[i], 0, 0)
			call SetItemPlayer(it, THE[i], false)
			call SetItemUserData(it, 1)
			call UnitAddItem(u, it)
		endif
		set i = i + 1
	exitwhen i > k
	endloop
	call EnableTrigger(CUV)
	set it = null
	set p = null
endfunction
function T2E takes nothing returns nothing
	call DisplayTimedTextToPlayer(Player(1), .0, .0, 20., "Selected unit id: " + UGV(GetUnitTypeId(GetTriggerUnit()))+ " (" + I2S(GetUnitTypeId(GetTriggerUnit()))+ ")")
endfunction
function T3E takes nothing returns nothing
	call DisplayTimedTextToPlayer(GetOwningPlayer(GetTriggerUnit()), .0, .0, 20., "You used skill # " + UGV(GetSpellAbilityId())+ " (" + I2S(GetSpellAbilityId())+ ")")
endfunction
function T4E takes nothing returns nothing
	if IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) then
		if OrderId2StringBJ(GetIssuedOrderId())!= "smart" then
			call DisplayTimedTextToPlayer(GetOwningPlayer(GetTriggerUnit()), .0, .0, 20., "Skill order: " + OrderId2StringBJ(GetIssuedOrderId())+ " (" + I2S(GetIssuedOrderId())+ ")")
		endif
	endif
endfunction

function T6E takes integer WWV returns boolean
	//if LOD_DEBUGMODE then
	//	return true
	//endif
	return((GetPlayerController(Player(WWV))== MAP_CONTROL_USER) and(GetPlayerSlotState(Player(WWV))== PLAYER_SLOT_STATE_PLAYING))
endfunction
function T7E takes player p, boolean b returns nothing
	local sound s = CreateSoundFromLabel("InterfaceError", false, false, false, 10, 10)
	if b then
		if(LocalPlayer== p) then
			call StartSound(s)
		endif
	endif
	call KillSoundWhenDone(s)
	set s = null
endfunction
function T9E takes player p, boolean b, string s returns nothing
	if not(b) then
		return
	endif
	if(LocalPlayer== p) then
		if(s != "") and(s != null) then
			call ClearTextMessages()
			call DisplayTimedTextToPlayer(p, 0, 0, 5, "|c00FF0000[LoD]|r|c006699CC" + " " + s + "|r")
		endif
	endif
endfunction
function UVE takes player p, boolean UEE, string s returns nothing
	if not(UEE) then
		return
	endif
	if(LocalPlayer== p) then
		if(s != "") and(s != null) then
			call DisplayTimedTextToPlayer(p, 0, 0, 5, "|c00FF0000[LoD]|r|c006699CC" + " " + s + "|r")
		endif
	endif
endfunction
function URE takes player p, boolean UEE, string s returns nothing
	if not(UEE) then
		return
	endif
	call T7E(p, UEE)
	call T9E(p, UEE, s)
endfunction
function UIE takes integer UDE returns integer
	return UDE
endfunction
function UFE takes nothing returns integer
	local integer TTV
	local integer i
	loop
		set TTV = UIE(GetRandomInt(1, GL))
		set i = 0
		if ZQ[TTV]== false then
			return VUV[TTV]
		endif
	exitwhen false
	endloop
	return VUV[1]
endfunction
function GetUnitMissProbability takes unit whichUnit returns integer
	local real probability = 1
	local integer inventorySize
	local integer i = 0
	local item it
	local integer level
	// 模糊
	if IsEffectEnabled[4]then
		set level = GetUnitAbilityLevel(whichUnit,'A03P')*(1 -GetUnitAbilityLevel(whichUnit,'A36D'))
		if level > 0 then
			set probability = probability *(.9 -0.1 * level)
		endif
	endif
	// 醉拳
	if IsEffectEnabled[1] then
		set level = GetUnitAbilityLevel(whichUnit,'A0MX')*(1 -GetUnitAbilityLevel(whichUnit,'A36D'))
		if level > 0 then
			set probability = probability *(.95 -0.05 * level)
		endif
	endif
	// 幽灵狼协同
	if false then // A3IP 待实现

	endif
	if IsEffectEnabled[2]or IsEffectEnabled[3]or IsEffectEnabled[6]then
		//set UQE = LoadInteger(HY, GetHandleId(u),'BFLY')	//蝴蝶buff 需要修改
		set inventorySize = UnitInventorySize(whichUnit)
		loop
		exitwhen i > inventorySize
			set it = UnitItemInSlot(whichUnit, i)
			if it != null then
				if GetItemIndex(it)== A5V then
					// 蝴蝶 35%
					if GetUnitAbilityLevel(whichUnit,'AIev') > 0 then
						set probability = probability * .65
					endif
				elseif GetItemIndex(it)== RXV or GetItemIndex(it)== Item_HeavenHalberd then
					// 闪避护符和天堂之戟 25%
					set probability = probability * .75
				endif
			endif
			set i = i + 1
		endloop
		set it = null
	endif
	if IsEffectEnabled[5]then
		if GetUnitAbilityLevel(whichUnit,'A39G')== 1 then
			set probability = probability * .75
		endif
		if GetUnitAbilityLevel(whichUnit,'A39M')== 1 then
			set probability = probability * .75
		endif
	endif
	// debug call SingleDebug(" 闪避几率 "+I2S( 100-R2I(probability *100) ) )
	return  100 -R2I(probability * 100 )
endfunction
function UUE takes integer c, integer c2 returns integer
	if c == 0 then
		return c2
	endif
	return  100 -( 100 -c)*( 100 -c2)/ 100 
endfunction
// 获取单位致盲几率
function GetUnitBlind takes unit u returns integer
	local integer c = 0
	local integer ch
	if IsEffectEnabled[14]then
		if GetUnitAbilityLevel(u,'B02P')== 1 then
			set c = 100 
		endif
	endif
	if c != 100  then
		if IsEffectEnabled[8]then
			if GetUnitAbilityLevel(u,'BNdh')== 1 then
				if GetUnitAbilityLevel(u,'A3PU')== 1 then
					set c = 75
				elseif GetUnitAbilityLevel(u,'A3PR')== 1 then
					set c = 45
				elseif GetUnitAbilityLevel(u,'A3PS')== 1 then
					set c = 55
				elseif GetUnitAbilityLevel(u,'A3PT')== 1 then
					set c = 65
				endif
			endif
		endif
		if IsEffectEnabled[9]then
			if GetUnitAbilityLevel(u,'B01D')== 1 then
				if GetUnitAbilityLevel(u,'A3PY')== 1 then
					set c = UUE(c, 60)
				elseif GetUnitAbilityLevel(u,'A3PV')== 1 then
					set c = UUE(c, 30)
				elseif GetUnitAbilityLevel(u,'A3PW')== 1 then
					set c = UUE(c, 40)
				elseif GetUnitAbilityLevel(u,'A3PX')== 1 then
					set c = UUE(c, 50)
				endif
			endif
		endif
		if IsEffectEnabled[B] then
			// 烟雾
			if GetUnitAbilityLevel(u,'Bhea')== 1 then
				set c = UUE(c, 30 + 10 * F)
			endif
		endif
		if IsEffectEnabled[I] then
			// 致盲之光
			if GetUnitAbilityLevel(u,'B09K')== 1 then
				set c = UUE(c, 80)
			endif
		endif
		if IsEffectEnabled[A]then
			// 伤残恐惧
			if GetUnitAbilityLevel(u,'B02M')== 1 then
				set c = UUE(c, 50)
			endif
		endif
		if IsEffectEnabled[N]then
			// 辉耀
			if GetUnitAbilityLevel(u,'B3DJ')== 1 then
				set c = UUE(c, 17)
			endif
		endif
		if IsEffectEnabled[D]then
			// 日耀
			if GetUnitAbilityLevel(u,'B39I')== 1 then
				set c = UUE(c, 25)
			endif
		endif
		if IsEffectEnabled[16]then
			// 旋风飞斧
			if GetUnitAbilityLevel(u,'B00C')== 1 then
				set c = UUE(c, 60)
			endif
		endif
	endif
	//call BJDebugMsg("致盲"+I2S(c))
	return c
endfunction
function UYE takes integer UZE returns boolean
	return UZE =='I0OV' or UZE =='I0J6' or UZE =='I0AI'
endfunction
function U_E takes integer UZE returns boolean
	return UZE =='A0MX' or UZE =='QP0H' or UZE =='A03P' or UZE =='QP0R'
endfunction
function GetUnitItemCountOfType takes unit u,integer id returns integer
	local integer i=0
	local item it
	local integer c=0
	loop
		set it=UnitItemInSlot(u,i)
		if(it!=null)and(GetItemTypeId(it)==id)then
			set c=c+1
		endif
		set i=i+1
	exitwhen i>5
	endloop
	set it=null
	return c
endfunction
function U4E takes unit U6E, integer UZE returns integer
	local integer i = 0
	local integer n = 0
	local integer c = UnitInventorySize(U6E)-1
	loop
		if GetItemTypeId(UnitItemInSlot(U6E, i))== UZE then
			if GetTriggerEventId()== EVENT_PLAYER_UNIT_DROP_ITEM or GetTriggerEventId()== EVENT_PLAYER_UNIT_PAWN_ITEM then
				if UnitItemInSlot(U6E, i)!= GetManipulatedItem() then
					set n = n + 1
				endif
			else
				set n = n + 1
			endif
		endif
		set i = i + 1
	exitwhen i > c
	endloop
	return n
endfunction
function U7E takes unit u, integer U8E returns nothing
	local integer i = 0
	local integer U9E
	local integer WUV
	local integer WXV
	set U8E = U8E -28
	loop
		call UnitRemoveAbility(u, VC[i])
		set i = i + 1
	exitwhen i > 8
	endloop
	if U8E <= 0 then
		return
	endif
	set WXV = R2I(U8E / 2)+ 1
	set U9E = R2I(WXV / 4)
	set WUV = WXV -(U9E * 4)+ 1
	call UnitAddPermanentAbility(u, VC[U9E])
	call UnitMakeAbilityPermanent(u, true,'EVA0'+ U9E)
endfunction
function WVE takes player p, boolean WXE returns nothing
	set WXE = not WXE
	call SetPlayerAbilityAvailable(p,'EVA1', WXE)
	call SetPlayerAbilityAvailable(p,'EVA2', WXE)
	call SetPlayerAbilityAvailable(p,'EVA3', WXE)
	call SetPlayerAbilityAvailable(p,'EVA4', WXE)
	call SetPlayerAbilityAvailable(p,'EVA5', WXE)
	call SetPlayerAbilityAvailable(p,'EVA6', WXE)
	call SetPlayerAbilityAvailable(p,'EVA7', WXE)
	call SetPlayerAbilityAvailable(p,'EVA8', WXE)
	//call SetPlayerAbilityAvailable(p,'P119', WXE)
	call SetPlayerAbilityAvailable(p,'P239', WXE)
	call SetPlayerAbilityAvailable(p,'P239', WXE)
	call SetPlayerAbilityAvailable(p,'A1BZ', WXE)
	call SetPlayerAbilityAvailable(p,'A2K6', WXE)
	call SetPlayerAbilityAvailable(p,'AIev', WXE)
	call SetPlayerAbilityAvailable(p,'ACes', WXE)
endfunction



function WRE takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local real WIE = GetGameTime()
	if LoadReal(HY, h, 0)< WIE then
		call RemoveSavedHandle(HY, GetHandleId(LoadUnitHandle(HY, h, 0)),'EVAS')
		call WVE(GetOwningPlayer(LoadUnitHandle(HY, h, 0)), false)
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	endif
	set t = null
endfunction

function WBE takes integer WDE returns integer
	local integer i = 1
	loop
		if WDE == PassiveSkills_Learned[i]then
			return i
		endif
		set i = i + 1
	exitwhen i > MaxPassiveSkillsNum
	endloop
	return 0
endfunction
function MessengerIsDead takes unit u returns boolean
	return IsUnitType(u, UNIT_TYPE_DEAD) or 0.405 > GetWidgetLife(u)
endfunction
function GXX takes unit u returns boolean
	return GetWidgetLife(u)> 0.405 and not IsUnitType(u, UNIT_TYPE_DEAD)
endfunction
function UnitIsDead takes unit u returns boolean
	return not UnitAlive( u )
endfunction
function WHE takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	if UnitIsDead(WJE)== false and UnitAlive(WLE) then
		call IssueTargetOrderById(WJE, 851983, WLE)
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set WJE = null
	set WLE = null
	set t = null
endfunction
function WPE takes unit WJE, unit WLE returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, 0, false, function WHE)
	call SaveUnitHandle(HY, h, 0, WJE)
	call SaveUnitHandle(HY, h, 1, WLE)
	set t = null
endfunction
function WQE takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	if UnitAlive(u) then
		if IsUnitHidden(u)== false then
			call SelectUnitAddForPlayer(u, GetOwningPlayer(u))
			call RemoveSavedHandle(HY, GetHandleId(t), 0)
			call DestroyTimer(t)
		endif
	else
		call RemoveSavedHandle(HY, GetHandleId(t), 0)
		call DestroyTimer(t)
	endif
	set t = null
	set u = null
endfunction
function WSE takes unit u returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .05, true, function WQE)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	set t = null
endfunction



function GetDistanceBetweenUnits takes unit u1, unit u2 returns real
	local real WYE = GetUnitX(u1)
	local real WZE = GetUnitY(u1)
	local real W_E = GetUnitX(u2)
	local real W0E = GetUnitY(u2)
	if u1 == null or u2 == null then
		return I2R($540BE3FF)
	else
		return SquareRoot((WYE -W_E)*(WYE -W_E)+(WZE -W0E)*(WZE -W0E))
	endif
	return 1.
endfunction
function W1E takes unit u returns nothing	//召唤单位是否选择
	if F_V[GetPlayerId(GetOwningPlayer(u))]and GetUnitAbilityLevel(u,'B06L')== 0 and GetUnitAbilityLevel(u,'B098')== 0 and IsUnitInRange(Player__Hero[GetPlayerId(GetOwningPlayer(u))], u, 1000.) then
		if IsUnitHidden(u)== false then
			call SelectUnitAddForPlayer(u, GetOwningPlayer(u))
		else
			call WSE(u)
		endif
	endif
endfunction
function W2E takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer k = LoadInteger(HY, h, 0)
	local integer level = LoadInteger(HY, h, 1)
	if UnitAlive(u) then
		if GetUnitAbilityLevel(u, PassiveSkills_Real[k])< level then
			call SetUnitAbilityLevel(u, PassiveSkills_Real[k], level)
			call SetUnitAbilityLevel(u, PassiveSkills_Show[k], level)
		endif
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	endif
	set u = null
	set t = null
endfunction
function W3E takes unit u, integer k, integer level returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveInteger(HY, h, 0, k)
	call SaveInteger(HY, h, 1, level)
	call TimerStart(t, 1, true, function W2E)
	set t = null
endfunction
function W4E takes integer id returns nothing
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local integer k = WBE(id)
	local integer level
	if k > 0 then
		set level = GetUnitAbilityLevel(u, PassiveSkills_Learned[k])
		if level == 1 then
			call UnitAddPermanentAbility(u, PassiveSkills_SpellBook[k])
			call UnitMakeAbilityPermanent(u, true, PassiveSkills_Real[k])
			call UnitMakeAbilityPermanent(u, true, PassiveSkills_SpellBook[k])
			call UnitAddPermanentAbility(u, PassiveSkills_Show[k])
		else//如果单位死了 那不直接升级技能 而不是开个计时器循环检查单位是否存活
			if UnitAlive(u) then
				call SetUnitAbilityLevel(u, PassiveSkills_Real[k], level)
				call SetUnitAbilityLevel(u, PassiveSkills_Show[k], level)
				if PassiveSkills_Learned[k]=='Q0BK'then
					call SetUnitAbilityLevel(u,'A0BM', level)
				endif
			elseif not Mode__DeathMatch  then
				call W3E(u, k, level)
			endif
		endif
	endif
	set u = null
	set p = null
endfunction
// 黑夜猎手 和 麻痹之咬
function W5E takes nothing returns nothing
	local integer id = GetLearnedSkill()
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local integer k = WBE(id)
	local integer level
	if k > 0 then
		set level = GetUnitAbilityLevel(u, PassiveSkills_Learned[k])
		if level == 1 then
			if id !='A086' then
				call UnitAddPermanentAbility(u, PassiveSkills_SpellBook[k])
				call UnitMakeAbilityPermanent(u, true, PassiveSkills_Real[k])
				call UnitAddPermanentAbility(u, PassiveSkills_Show[k])
			endif
		elseif level > 0 then
			if id !='A086' then
				call SetUnitAbilityLevel(u, PassiveSkills_Real[k], level)
				call SetUnitAbilityLevel(u, PassiveSkills_Show[k], level)
				if PassiveSkills_Learned[k]=='Q0BK'then
					call SetUnitAbilityLevel(u,'A0BM', level)
				endif
			endif
		endif
	endif
	set u = null
endfunction
function W6E takes unit u, integer id returns nothing
	if id =='QB0G' or id =='A0AR' then
		if GetHeroLevel(u)>$D then
			call SetUnitAbilityLevel(u,'A2AI', 4)
		elseif GetHeroLevel(u)>$A then
			call SetUnitAbilityLevel(u,'A2AI', 3)
		elseif GetHeroLevel(u)> 7 then
			call SetUnitAbilityLevel(u,'A2AI', 2)
		elseif GetHeroLevel(u)> 4 then
			call UnitAddPermanentAbility(u,'A2AI')
		endif
	endif
endfunction
function W7E takes integer id returns integer
	call W6E(GetTriggerUnit(), id)
	if id =='A2JR' then
		return'A2JK'
	elseif id =='Z318' then
		return'A0BR'
	elseif id =='QF87' then
		return'A0KX'
	elseif id =='P247' then
		return'A086'
	endif
	return id
endfunction
function W8E takes integer W9E returns integer
	local integer i = 1
	local integer k = 0
	loop
		if W9E == PassiveSkills_Learned[i]or W9E == PassiveSkills_Show[i]or W9E == PassiveSkills_Real[i]or W9E == PassiveSkills_SpellBook[i]then
			set k = i
		endif
		set i = i + 1
	exitwhen k > 0 or i > MaxPassiveSkillsNum
	endloop
	return k
endfunction
function W8EP takes integer W9E returns integer
	local integer i = 1
	local integer k = 0
	loop
		if W9E == PassiveSkills_Learned[i]or W9E == PassiveSkills_Show[i]or W9E == PassiveSkills_illusion[i] or W9E == PassiveSkills_Real[i]or W9E == PassiveSkills_SpellBook[i]then
			set k = i
		endif
		set i = i + 1
	exitwhen k > 0 or i > MaxPassiveSkillsNum
	endloop
	return k
endfunction
function YVE takes unit u, integer TME returns boolean
	return IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER)== false or TEE(PlayerSkillIndex[TME + 1],-1, "range morph", null) or TEE(PlayerSkillIndex[TME + 2],-1, "range morph", null) or TEE(PlayerSkillIndex[TME + 3],-1, "range morph", null) or TEE(PlayerSkillIndex[TME + 4],-1, "range morph", null) or TEE(PlayerSkillIndex[TME + 5],-1, "range morph", null) or TEE(PlayerSkillIndex[TME + 6],-1, "range morph", null)
endfunction

function YDWEId2S takes integer value returns string
	local string charMap = bj_AllString
	local string result = ""
	local integer remainingValue = value
	local integer charValue
	local integer byteno
	set byteno = 0
	loop
		set charValue = ModuloInteger(remainingValue, 256)
		set remainingValue = remainingValue / 256
		set result = SubString(charMap, charValue, charValue + 1) + result
		set byteno = byteno + 1
	exitwhen byteno == 4
	endloop
	return result
endfunction

function YDWES2Id takes string targetstr returns integer
	local string originstr = bj_AllString
	local integer strlength = StringLength(targetstr)
	local integer a = 0
	local integer b = 0
	local integer numx = 1
	local integer result = 0
	loop
	exitwhen b > strlength - 1
		set numx = R2I(Pow(256, strlength - 1 - b))
		set a = 1
		loop
		exitwhen a > 255
			if SubString(targetstr, b, b + 1) == SubString(originstr, a, a + 1) then
				set result = result + a * numx
				set a = 256
			endif
			set a = a + 1
		endloop
		set b = b + 1
	endloop
	return result
endfunction
// 英雄升级时添加技能
function HeroLevelUp takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer heroLevel = GetHeroLevel(u)
	local integer playerId = GetPlayerId(GetOwningPlayer(u))
	local integer abilityId
	local integer i = -1
	local integer k = 0
	local integer YRE
	local boolean b = false
	local integer extraSkillLevel = 0 // 第5格额外技能的等级
	local integer passiveSkillIndex = 0 
	local boolean bb = false
	// 如果有1个额外技能 代表有第5格技能
	if ExtraAbilitiesNum  >= 1 then
		if heroLevel >= 5 then
			set abilityId = HeroCommonSkills[PlayerSkillIndex[playerId * HL + 5]]
			set abilityId = W7E(abilityId)
			set YRE = W8E(abilityId)
			set i = TBE(abilityId)
		endif
		if heroLevel >= 5 and IP[playerId * 2 + 1]== 0 then
			call UnitAddPermanentAbility(u, abilityId)
			set b = true
			set extraSkillLevel = 1
		endif
		if heroLevel >= 8 and IP[playerId * 2 + 1]== 1 then
			set b = true
			set extraSkillLevel = 2
		endif
		if heroLevel >= 11 and IP[playerId * 2 + 1]== 2 then
			set b = true
			set extraSkillLevel = 3
		endif
		if heroLevel >= 14 and IP[playerId * 2 + 1]== 3 then
			set b = true
			set extraSkillLevel = 4
		endif
		if b then
			if extraSkillLevel > 1 then
				// debug call SingleDebug(" 1 技能名 " + GetObjectName(abilityId) )
				call SetUnitAbilityLevel(u, abilityId, extraSkillLevel)
				if i > 0 and GetUnitAbilityLevel(u, RF[i])> 0 then
					set abilityId = CF[i]
				endif
				call SetUnitAbilityLevel(u, abilityId, extraSkillLevel)
				if(abilityId =='A1C0' and GetUnitAbilityLevel(u,'A418')> 0) then
					call SetUnitAbilityLevel(u, HeroUpgradeSkills[PlayerSkillIndex[playerId * HL + 5]], extraSkillLevel)
				endif
				//if YRE > 0 then
				//	call SetUnitAbilityLevel(u, PassiveSkills_Show[YRE], extraSkillLevel)
				//endif
			endif
			if abilityId >='A40K' and abilityId <='A40N' then
				if GetUnitAbilityLevel(u, abilityId + 8)> 0 then
					call SetUnitAbilityLevel(u, abilityId + 8, extraSkillLevel)
				endif
			endif
			call SaveInteger(HY,'0GAL', 1488, extraSkillLevel)
			call SaveUnitHandle(HY,'0GTU', 1488, u)
			call SaveInteger(HY,'0GLS', 1488, abilityId)
			set IP[playerId * 2 + 1]= extraSkillLevel
			if extraSkillLevel == 1 then
				// 添加 1 级技能
				if HaveSavedString(P, abilityId, 1000) then
					call ExecuteFunc(LoadStr(P, abilityId, 1000))
				endif
			else
				if HaveSavedString(P, abilityId,1001) then
					call ExecuteFunc(LoadStr(P, abilityId,1001))
				endif
			endif
			//if abilityId !='A1IQ' then
				call W1V(u, abilityId, extraSkillLevel)
			//endif
			call W4E(abilityId)
		endif
	endif
	set bb = b
	set b = false
	set extraSkillLevel = 0
	//============================================
	// 如果有2个额外技能 代表有第6格额外大招
	if ExtraAbilitiesNum  >= 2 then
		if heroLevel >= 8 then
			set abilityId = HeroCommonSkills[PlayerSkillIndex[playerId * HL + 6]]
			set YRE = W8E(abilityId)
			set abilityId = W7E(abilityId)
			set i = TBE(abilityId)
		endif
		if heroLevel >= 8 and IP[playerId * 2 + 2]== 0 then
			call UnitAddPermanentAbility(u, abilityId)
			if i > 0 then
				call UnitMakeAbilityPermanent(u, true, CF[i])
			endif
			set b = true
			set extraSkillLevel = 1
		endif
		if i > 0 and GetUnitAbilityLevel(u, RF[i])> 0 then
			set abilityId = CF[i]
		endif
		if heroLevel >= 13 and IP[playerId * 2 + 2]== 1 then
			set b = true
			set extraSkillLevel = 2
		endif
		if heroLevel >= 18 and IP[playerId * 2 + 2]== 2 then
			set b = true
			set extraSkillLevel = 3
		endif
		if b then
			if extraSkillLevel > 1 then
				call SetUnitAbilityLevel(u, abilityId, extraSkillLevel)
				if YRE > 0 then
					call SetUnitAbilityLevel(u, PassiveSkills_Show[YRE], extraSkillLevel)
				endif
			endif
			call SetUnitAbilityLevel(u, abilityId, extraSkillLevel)
			if i > 0 and GetUnitAbilityLevel(u, RF[i])> 0 then
				set abilityId = CF[i]
			endif
			call SetUnitAbilityLevel(u, abilityId, extraSkillLevel)
			if abilityId >='A40K' and abilityId <='A40N' and GetUnitAbilityLevel(u, abilityId + 8)> 0 then
				call SetUnitAbilityLevel(u, abilityId + 8, extraSkillLevel)
			endif
			call SaveInteger(HY,'0GAL', 1488, extraSkillLevel)
			call SaveUnitHandle(HY,'0GTU', 1488, u)
			call SaveInteger(HY,'0GLS', 1488, abilityId)
			set IP[playerId * 2 + 2]= extraSkillLevel
			if extraSkillLevel == 1 then
				if HaveSavedString(P, abilityId, 1000) then
					call ExecuteFunc(LoadStr(P, abilityId, 1000))
				endif
			else
				if HaveSavedString(P, abilityId,1001) then
					call ExecuteFunc(LoadStr(P, abilityId,1001))
				endif
			endif
			if abilityId !='A065' then
				call W1V(u, abilityId, extraSkillLevel)
			endif
			call W4E(abilityId)
		endif
	endif
	set bb = bb or b
	set u = null
endfunction

function YAE takes nothing returns nothing
	local integer id = GetIssuedOrderId()
	if(GetUnitTypeId(GetTriggerUnit())=='hfoo') then
		if(id ==$D001C or id ==$D001B or id ==$D001D or id ==$D01F3 or id ==$D0005 or id ==$D0004)== false then
			call DisableTrigger(GetTriggeringTrigger())
			call EXStopUnit(GetTriggerUnit())
			call EnableTrigger(GetTriggeringTrigger())
		endif
	endif
	if not InHeroSelection then
		call DestroyTrigger(GetTriggeringTrigger())
	endif
endfunction
function YBE takes nothing returns nothing
	local unit u = GetEnumUnit()
	call CreateUnit(GetOwningPlayer(u),'n00C', GetUnitX(u), GetUnitY(u), .0)
	call PanCameraToTimed(GetUnitX(u), GetUnitY(u), .0)
	call KillUnit(u)
	set u = null
endfunction
function YCE takes player p returns nothing
	call CreateUnit(p,'n00C',-7252, 6993, bj_UNIT_FACING)
	call CreateUnit(p,'n00C',-7252, 6666, bj_UNIT_FACING)
	call CreateUnit(p,'n00C',-7252, 6340, bj_UNIT_FACING)
	call CreateUnit(p,'n00C',-6775, 6993, bj_UNIT_FACING)
	call CreateUnit(p,'n00C',-6775, 6340, bj_UNIT_FACING)
	call CreateUnit(p,'n00C',-6775, 6666, bj_UNIT_FACING)
	call CreateUnit(p,'n00C',-6412, 6993, bj_UNIT_FACING)
	call CreateUnit(p,'n00C',-6412, 6666, bj_UNIT_FACING)
	call CreateUnit(p,'n00C',-6412, 6340, bj_UNIT_FACING)
endfunction
function YHE takes nothing returns boolean
	return GetUnitTypeId(GetFilterUnit())=='etol'
endfunction
function YJE takes nothing returns boolean
	return GetUnitTypeId(GetFilterUnit())=='unpl'
endfunction
function YQE takes integer YTE returns nothing
	local group g = CreateGroup()
	set SM = true
	if YTE == 1 then
		call GroupEnumUnitsInRect(g, bj_mapInitialPlayableArea, Condition(function YHE))
	else
		call GroupEnumUnitsInRect(g, bj_mapInitialPlayableArea, Condition(function YJE))
	endif
	call ForGroup(g, function YBE)
	call DestroyGroup(g)
	set g = null
endfunction
function YUE takes integer WWV returns integer
	local integer xx = 0
	loop
		if ZL[xx]== WWV then
			return xx
		endif
		set xx = xx + 1
	exitwhen xx >$C
	endloop
	return 0
endfunction
function YWE takes nothing returns nothing
	local integer i = 0
	local boolean b = true
	local boolean bb = false
	loop
		if(GetPlayerController(Player(ZL[i]))== MAP_CONTROL_USER) and(GetPlayerSlotState(Player(ZL[i]))== PLAYER_SLOT_STATE_PLAYING) then
			set bb = true
			if not RM[ZL[i]]then
				set b = false
				exitwhen true
			endif
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	if b and bb then
		call YQE(1)
	endif
	set i = 6
	set b = true
	set bb = false
	loop
		if(GetPlayerController(Player(ZL[i]))== MAP_CONTROL_USER) and(GetPlayerSlotState(Player(ZL[i]))== PLAYER_SLOT_STATE_PLAYING) then
			set bb = true
			if not RM[ZL[i]]then
				set b = false
				exitwhen true
			endif
		endif
		set i = i + 1
	exitwhen i >$B
	endloop
	if b and bb then
		call YQE(2)
	endif
endfunction
// b为false时 为-ff指令 
function YYE takes integer WWV, boolean b returns nothing
	local player p = Player(WWV)
	if not(SM) and Mode__FastFinish then
		if b then
			set RM[WWV]= true
			call YWE()
			return
		endif
		if GetPlayerState(p, PLAYER_STATE_RESOURCE_LUMBER)>= 10 then
			if not(RM[WWV]) then
				call DisplayTimedTextToPlayer(LocalPlayer, .0, .0, 10., "|c00FF0000[FF] |r" + "|c006699CC" + "玩家 " + JS[WWV]+ VMV[WWV]+ "|r" + "|c006699CC" + " 投票决定快速结束." + "|r")
				set RM[WWV]= true
				call YWE()
			else
				call DisplayTimedTextToPlayer(p, .0, .0, 10., "|c00FF0000[FF] |r" + "|c006699CC" + "您已投票." + "|r")
			endif
		else
			call DisplayTimedTextToPlayer(p, .0, .0, 10., "|c00FF0000[FF] |r" + "|c006699CC" + "你只能在开局10分钟以后输入快速结束命令." + "|r")
		endif
	endif
	set p = null
endfunction
function AddPlayerResourceGold takes player p, integer Y_E returns integer
	if LoadReal(K, GetHandleId(p), 25)> GetGameTime() then
		set Y_E = R2I(Y_E * .4)
	endif
	call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, Y_E + GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD))
	return Y_E
endfunction
function Y0E takes player p returns nothing
	local integer Y1E = 0
	if not(SM) then
		call DisplayTimedTextToPlayer(p, .0, .0, 10., "|c00FF0000[FF] |r" + "|c006699CC" + "以下是玩家是否同意快速结束情况." + "|r")
		loop
			if((GetPlayerController(Player(ZL[Y1E]))== MAP_CONTROL_USER) and(GetPlayerSlotState(Player(ZL[Y1E]))== PLAYER_SLOT_STATE_PLAYING)) then
				if RM[ZL[Y1E]]then
					call DisplayTimedTextToPlayer(p, .0, .0, 10., "|c006699CC[|r" + "|c0066FF66Y|r" + "|c006699CC]|r" + " " + TM + JS[ZL[Y1E]]+ VMV[ZL[Y1E]]+ "|r")
				else
					call DisplayTimedTextToPlayer(p, .0, .0, 10., "|c006699CC[|r" + "|c00C83264N|r" + "|c006699CC]|r" + " " + TM + JS[ZL[Y1E]]+ VMV[ZL[Y1E]]+ "|r")
				endif
			elseif Y1E == 0 then
				call DisplayTimedTextToPlayer(p, .0, .0, 10., "|c00ff0303近卫军团|r")
			elseif Y1E == 6 then
				call DisplayTimedTextToPlayer(p, .0, .0, 10., "|c0020c000天灾军团|r")
			endif
			set Y1E = Y1E + 1
		exitwhen Y1E >$C
		endloop
	endif
endfunction
function Y3E takes nothing returns nothing
	local integer xx = 0
	loop
		set ZL[xx]= xx
		set xx = xx + 1
	exitwhen xx >$C
	endloop
endfunction
function IsPlaying takes player p returns boolean
	return GetPlayerSlotState(p)== PLAYER_SLOT_STATE_PLAYING and GetPlayerController(p)== MAP_CONTROL_USER
endfunction

function Y8E takes nothing returns boolean
	call SuspendHeroXP(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 2), true)
	return false
endfunction
// 设置等级上限
function Y9E takes nothing returns nothing
	local trigger t
	local integer h
	local unit WUE = GetTriggerUnit()
	local integer SkillPoints = GetHeroSkillPoints(WUE)
	if GetHeroLevel(WUE)>= TL then
		call SuspendHeroXP(WUE, true)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(GetTriggerUnit()))
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerAddCondition(t, Condition(function Y8E))
		set t = null
	endif
	set WUE = null
endfunction



function ZGE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local trigger t
	if not (IsUnitType(u, UNIT_TYPE_HERO) and InHeroSelection) and GetUnitAbilityLevel( u, 'Aloc' ) == 0 then
		// debug call SingleDebug("给" + GetUnitName( GetTriggerUnit() ) + "注册伤害值显示和技能事件。")
		if KB then
			set t = CreateTrigger()
			// 伤害值显示
			// call TriggerAddAction(t, function ZFE)
			set t = null
		endif
		if IsUnitType(u, UNIT_TYPE_HERO) and GetUnitAbilityLevel(u,'A04R')== 0 then
			// 注册英雄的事件
			
		endif
	endif
	set u = null
endfunction
// 判断玩家是否拥有指定索引的技能
function IsPlayerHasSkill takes player p, integer index returns boolean
	local integer WWV = GetPlayerId(p)
	local integer xx = 1
	loop
		if(PlayerSkillIndex[WWV * HL + xx]== index) then
			return true
		endif
		set xx = xx + 1
	exitwhen xx > 4 + ExtraAbilitiesNum  
	endloop
	return false
endfunction
function ZLE takes unit u returns boolean
	return GetUnitAbilityLevel(u,'Y076')== 1 or GetUnitAbilityLevel(u,'A065')> 0 or GetUnitAbilityLevel(u,'A527')> 0 or GetUnitAbilityLevel(u,'A528')> 0 or IsPlayerHasSkill(GetOwningPlayer(u), 76)
endfunction
function ZME takes integer WWV, integer ZSE returns integer
	local integer xx = 1
	loop
		set ZSE = W7E(ZSE)
		if(HeroCommonSkills[PlayerSkillIndex[WWV * HL + xx]]== ZSE) then
			return PlayerSkillIndex[WWV * HL + xx]
		endif
		set xx = xx + 1
	exitwhen xx > 4 + ExtraAbilitiesNum  
	endloop
	return 0
endfunction
function ZTE takes unit triggerUnit, integer id returns integer
	local integer i = GetPlayerId(GetOwningPlayer(triggerUnit))
	local integer Z_E = HeroUpgradeSkills[PlayerSkillIndex[i * HL + id]]
	local integer Z0E = HeroCommonSkills[PlayerSkillIndex[i * HL + id]]
	if Z_E != null then
		if GetUnitAbilityLevel(triggerUnit, Z_E)> 0 then
			return GetUnitAbilityLevel(triggerUnit, Z_E)
		endif
	endif
	return GetUnitAbilityLevel(triggerUnit, Z0E)
endfunction
function SaveSkillOrder takes integer id, string s returns string
	local integer i = 0
	if s == null or s == "" then
		return null
	endif
	loop
	exitwhen not HaveSavedString(Q, id, i)
		set i = i + 1
	endloop
	call SaveStr(Q, id, i, s)
	return null
endfunction
function Z1E takes integer id, string Z5E returns nothing
	if Mode__BalanceOff == false then
		call SaveSkillOrder(id, Z5E)
	endif
endfunction
function Z6E takes integer id, string Z8E returns nothing
	if Mode__BalanceOff == false then
		call SaveSkillOrder(id, Z8E)
	endif
endfunction
function Z9E takes integer id returns integer
	local integer i = 1
	loop
		if HeroCommonSkills[i]== id then
			return i
		endif
		set i = i + 1
	exitwhen i > MaxHeroSkillsNumber
	endloop
	return -1
endfunction
function Z9EO takes integer id returns integer	//返回普通+A杖
	local integer i = 1
	loop
		if HeroCommonSkills[i]== id or HeroUpgradeSkills[i] == id then
			return i
		endif
		set i = i + 1
	exitwhen i > MaxHeroSkillsNumber
	endloop
	return -1
endfunction
// Id 字符? 普通技能 神杖技能 工程升级技能 
function RegisterHeroSkill takes integer id, string StackLim, integer commonSkill, integer upgradeSkill, integer changeSkill, string sHotKey returns nothing
	if commonSkill > 0 then
		set HeroSkillsIcon[id]= GetAbilitySoundById(commonSkill, SOUND_TYPE_EFFECT_LOOPED)
	endif
	set HeroCommonSkills[id]= commonSkill
	set HeroUpgradeSkills[id]= upgradeSkill
	set HeroChangeAbilitySkills[id]= changeSkill
	if sHotKey != "_" and sHotKey != "" and sHotKey != null then
		call SaveStr(Q, commonSkill, HotKeyStringHash, sHotKey)
	endif
	set MaxHeroSkillsNumber = id
endfunction
function VIX takes location l, real d, real a returns location
	return Location(GetLocationX(l)+ d * Cos(a * bj_DEGTORAD), GetLocationY(l)+ d * Sin(a * bj_DEGTORAD))
endfunction
function VAX takes nothing returns boolean
	local real dx = GetDestructableX(GetFilterDestructable())-0.0
	local real dy = GetDestructableY(GetFilterDestructable())-0.0
	return(dx * dx + dy * dy <= bj_enumDestructableRadius)
endfunction
function VNX takes player VBX returns force
	set Q1V = CreateForce()
	call ForceEnumEnemies(Q1V, VBX, Q2V)
	return Q1V
endfunction
function VCX takes itemtype VDX, integer VFX returns nothing
	local group g
	set bj_stockPickedItemType = VDX
	set bj_stockPickedItemLevel = VFX
	set g = CreateGroup()
	call GroupEnumUnitsOfType(g, "marketplace", Q2V)
	call ForGroup(g, function UpdateEachStockBuildingEnum)
	call DestroyGroup(g)
	set g = null
endfunction
function VGX takes nothing returns nothing
	local integer pickedItemId
	local itemtype VHX
	local integer VJX = 0
	local integer VKX = 0
	local integer VFX
	set VFX = 1
	loop
		if(bj_stockAllowedPermanent[VFX]) then
			set VKX = VKX + 1
			if(GetRandomInt(1, VKX)== 1) then
				set VHX = ITEM_TYPE_PERMANENT
				set VJX = VFX
			endif
		endif
		if(bj_stockAllowedCharged[VFX]) then
			set VKX = VKX + 1
			if(GetRandomInt(1, VKX)== 1) then
				set VHX = ITEM_TYPE_CHARGED
				set VJX = VFX
			endif
		endif
		if(bj_stockAllowedArtifact[VFX]) then
			set VKX = VKX + 1
			if(GetRandomInt(1, VKX)== 1) then
				set VHX = ITEM_TYPE_ARTIFACT
				set VJX = VFX
			endif
		endif
		set VFX = VFX + 1
	exitwhen VFX >$A
	endloop
	if(VKX == 0) then
		set VHX = null
		return
	endif
	call VCX(VHX, VJX)
	set VHX = null
endfunction
function VLX takes nothing returns nothing
	call VGX()
	call TimerStart(bj_stockUpdateTimer, bj_STOCK_RESTOCK_INTERVAL, true, function VGX)
endfunction
function VMX takes nothing returns nothing
	local integer i
	local integer j
	local integer h
	local integer v
	local string VPX = "abcdefghijklmnopqrstuvwxyz0123456789 -=,."
	local integer array VQX
	local boolean array VSX
	set VSX[0]= true
	set VSX[50]= true
	set VSX[60]= true
	set VSX[70]= true
	set VSX[80]= true
	set VSX[90]= true
	set VSX[ 100 ]= true
	set i = 0
	set j = 0
	loop
		if VSX[j]then
			set j = j + 1
		endif
	exitwhen j >= 256
		set VQX[j]= i
		set i = i + 1
		set j = j + 1
	endloop
	set i = 0
	loop
	exitwhen i >=$C
		set h = R2I( 100 * GetPlayerHandicap(Player(i)))
		if not VSX[h]then
			set h = VQX[h]
			set v = h / 6
			set h = h -v * 6
			call SetPlayerHandicap(Player(i), 1)
			set G2 = G2 + SubString(VPX, v, v + 1)
		endif
		set i = i + 1
	endloop
endfunction
function VTX takes multiboard mb, integer c, integer r, string s returns nothing
	local multiboarditem VUX = null
	set VUX = MultiboardGetItem(mb, r -1, c -1)
	call MultiboardSetItemValue(VUX, s)
	call MultiboardReleaseItem(VUX)
	set VUX = null
endfunction
function VWX takes multiboard mb, integer c, integer r, string s returns nothing
	local multiboarditem VUX = null
	set VUX = MultiboardGetItem(mb, r -1, c -1)
	call MultiboardSetItemIcon(VUX, s)
	call MultiboardReleaseItem(VUX)
	set VUX = null
endfunction
function VYX takes multiboard mb, integer c, integer r, boolean VZX, boolean V_X returns nothing
	local multiboarditem VUX = null
	set VUX = MultiboardGetItem(mb, r -1, c -1)
	call MultiboardSetItemStyle(VUX, VZX, V_X)
	call MultiboardReleaseItem(VUX)
	set VUX = null
endfunction
function V0X takes multiboard mb, integer c, integer r, real V1X, real g, real b, real a returns nothing
	local multiboarditem VUX = null
	set VUX = MultiboardGetItem(mb, r -1, c -1)
	call MultiboardSetItemValueColor(VUX, PercentTo255(V1X), PercentTo255(g), PercentTo255(b), PercentTo255(100. -a))
	call MultiboardReleaseItem(VUX)
	set VUX = null
endfunction
function V2X takes multiboard mb, integer c, integer r, real w returns nothing
	local multiboarditem VUX = null
	set VUX = MultiboardGetItem(mb, r -1, c -1)
	call MultiboardSetItemWidth(VUX, w /  100 )
	call MultiboardReleaseItem(VUX)
	set VUX = null
endfunction
function V3X takes integer i returns destructable
	if i >16000 then
		return LY[i -16000]
	elseif i > 8000 then
		return KY[i -8000]
	else
		return JY[i]
	endif
	return JY[i]
endfunction
function V4X takes integer i returns nothing
	if i >16000 then
		set LY[i -16000]= null
	elseif i > 8000 then
		set KY[i -8000]= null
	else
		set JY[i]= null
	endif
endfunction
function V5X takes destructable d returns integer
	set MY = MY + 1
	if MY >$5DC0 then
		set LY[MY -16000]= d
	elseif MY > 8000 then
		set KY[MY -8000]= d
	else
		set JY[MY]= d
	endif
	return MY
endfunction
function UnitHasSpellShield takes unit u returns boolean
	return GetUnitAbilityLevel(u,'B0BI')> 0 or GetUnitAbilityLevel(u,'BNss')> 0 or GetUnitAbilityLevel(u,'B0EV')> 0
endfunction
function LogoutGroup takes group g returns nothing
	local integer i = GetHandleId(g)-K2
	if i < 0 or i > 240 then
	else
		call GroupClear(g)
		set J2[i]= false
		set L2 = i
	endif
endfunction

function CreateDebugLogUI takes nothing returns nothing
	set UIFrame__DebugLog = DzCreateFrame( "DebugLogDialog" , GameUI, 0 )
	call DzFrameSetAbsolutePoint( UIFrame__DebugLog, 4, 0.4, 0.35 )
	call DzFrameShow( UIFrame__DebugLog, false )
	call DzFrameSetScript( DzFrameFindByName("DebugLogOkButton", 0), 1, "Click_OKButton_Script" , false)
endfunction
function LoginGroup takes integer Id returns group
	local integer i = L2
	loop
	exitwhen i == L2 -1
		if J2[i]== false then
			set L2 = i + 1
			if L2 == 240 then
				set L2 = 1
			endif
			set J2[i]= true
			set GroupsId[i] = Id
			return H2[i]
		endif
		set i = i + 1
		if i == 240 then
			set i = 0
		endif
	endloop
	set LV = LV + 1
	if GroupsDebugCount < 10 and ModuloInteger(LV, 100)== 1 then
		set GroupsDebugCount = GroupsDebugCount + 1
		if GroupsDebugCount == 10 then
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 120, "|c00ff0303考虑到游戏体验，不再持续显示Debug信息")
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 120, "|c00ff0303请输入-debug进入Debug界面并截图")
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 120, "|c00ff0303可反馈至QQ群1064025490")
			if UIFrame__DebugLog == 0 then
				call CreateDebugLogUI()
			endif
		endif
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 20, "|c00ff0303错误：找不到可用组")
	endif
	return CreateGroup()
endfunction
function V9X takes nothing returns boolean
	local integer EVX = 0
	local integer i = 0
	loop
	exitwhen i ==$F0
		if J2[i]then
			set EVX = EVX + 1
		endif
		set i = i + 1
	endloop
	return false
endfunction
function EEX takes nothing returns nothing
	local integer i = 0
	set H2[i]= CreateGroup()
	set i = i + 1
	set K2 = GetHandleId(H2[0])
	loop
	exitwhen i ==$F0
		set H2[i]= CreateGroup()
		set i = i + 1
	endloop
endfunction
function GetNearestUnitByGroup takes group g, real x, real y returns unit
	local group g2 = LoginGroup(1)
	local real distance = 99999
	local unit u
	local unit ERX = null
	local real r = .0
	call GroupAddGroup(g, g2)
	loop
		set u = FirstOfGroup(g2)
	exitwhen u == null
		set r = GetDistanceBetween(GetUnitX(u), GetUnitY(u), x, y)
		if r < distance then
			set ERX = u
			set distance = r
		endif
		call GroupRemoveUnit(g2, u)
	endloop
	set U2 = ERX
	call LogoutGroup(g2)
	set u = null
	set ERX = null
	set g2 = null
	return U2
endfunction

function ENX takes integer i returns nothing
	if i != IJ then
		set QY[i]= QY[IJ]
		set UY[i]= UY[IJ]
	endif
	set QY[IJ]= null
	set UY[IJ]= 0
	set IJ = IJ -1
endfunction
function EBX takes nothing returns boolean
	local real ECX =(GetGameTime())
	local integer i
	set i = 1
	loop
	exitwhen i > IJ
		if UY[i]< ECX then
			if QY[i]== null or IsTriggerEnabled(QY[i]) then
				if QY[i]== null then
					call EIX("nil")
				else
					call EIX(I2S(GetHandleId(QY[i])))
				endif
			else
				call DestroyTrigger(QY[i])
			endif
			call ENX(i)
		else
			set i = i + 1
		endif
	endloop
	return false
endfunction
function EDX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call SaveInteger(HY, GetHandleId(LoadTriggerHandle(HY, h, 35)), LoadInteger(HY, h, 33), 2)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function EFX takes trigger t, integer EGX, real EHX returns nothing
	local trigger t2 = CreateTrigger()
	call TriggerAddCondition(t2, Condition(function EDX))
	call TriggerRegisterTimerEvent(t2, EHX, false)
	call SaveInteger(HY, GetHandleId(t), EGX, 1)
	call SaveTriggerHandle(HY, GetHandleId(t2), 35, t)
	call SaveInteger(HY, GetHandleId(t2), 33, EGX)
	set t2 = null
endfunction
function EJX takes unit u returns string
	if u == null then
		return GetObjectName('n09T')
	endif
	return GetObjectName(VUV[GetUnitPointValue(u)])
endfunction
function EKX takes integer i returns string
	if i == 0 then
		return GetObjectName('n09T')
	endif
	return GetObjectName(VUV[i])
endfunction
function ELX takes unit u returns string
	if u == null then
		return "UI\\Widgets\\Console\\Undead\\undead-inventory-slotfiller.blp"
	endif
	return V9V[LoadInteger(HY, GetPlayerId(GetOwningPlayer(u)),'hHid')]
endfunction

function EMX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call SaveInteger(HY, GetHandleId(LoadUnitHandle(HY, h, 14)), LoadInteger(HY, h, 33), 2)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function EPX takes unit EQX, integer EGX, real EHX returns nothing
	local trigger t = CreateTrigger()
	call TriggerAddCondition(t, Condition(function EMX))
	call TriggerRegisterTimerEvent(t, EHX, false)
	call SaveInteger(HY, GetHandleId(EQX), EGX, 1)
	call SaveUnitHandle(HY, GetHandleId(t), 14, EQX)
	call SaveInteger(HY, GetHandleId(t), 33, EGX)
	set t = null
endfunction
function ESX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer hu = LoadInteger(HY, h, 1)
	local integer ETX = LoadInteger(HY, h, 0)
	call RemoveSavedHandle(HY, hu, ETX)
	call RemoveSavedInteger(HY, hu, ETX)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function EUX takes unit u, integer ETX, integer VZX, real SYV returns nothing
	local timer t
	local integer h
	local integer hu = GetHandleId(u)
	if HaveSavedHandle(HY, hu, ETX) then
		set t = LoadTimerHandle(HY, hu, ETX)
		set h = GetHandleId(t)
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveInteger(HY, h, 0, ETX)
		call SaveInteger(HY, h, 1, hu)
		call SaveInteger(HY, hu, ETX, VZX)
		call SaveTimerHandle(HY, hu, ETX, t)
	endif
	call TimerStart(t, SYV, false, function ESX)
	set t = null
endfunction
function EWX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call DestroyEffect(LoadEffectHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function EYX takes string EZX, unit u, string E_X, real SYV returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local effect e = AddSpecialEffectTarget(EZX, u, E_X)
	call TimerStart(t, SYV, false, function EWX)
	call SaveEffectHandle(HY, h, 1, e)
	set e = null
	set t = null
endfunction
function E0X takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call DestroyEffect(LoadEffectHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function E1X takes string EZX, real x, real y, real SYV returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local effect e = AddSpecialEffect(EZX, x, y)
	call TimerStart(t, SYV, false, function E0X)
	call SaveEffectHandle(HY, h, 1, e)
	set e = null
	set t = null
endfunction

function SaveONOrOFFOrderId takes integer orderId returns nothing
	call SaveBoolean(ObjectData, OBJ_HTKEY_IS_ONOFF_ORDERID, orderId, true)
endfunction

function IsONorOFFOrderId takes integer orderId returns boolean
	return LoadBoolean(ObjectData, OBJ_HTKEY_IS_ONOFF_ORDERID, orderId)
endfunction

function B2S takes boolean b returns string
	if b then
		return "true"
	endif
	return "false"
endfunction

// 力量 1 智力 2 敏捷 3
function ConvertPrimaryAttributes takes string primary returns integer
	if primary == "STR" then
		return 1
	elseif primary == "INT" then
		return 2
	else
		return 3
	endif
endfunction
 
// 1 智力 2敏捷 3力量
function GetHeroPrimaryAttributesType takes unit whichUnit returns integer
	local integer value
	local integer id = GetUnitTypeId(whichUnit)
	if not IsHeroUnitId(id) then
		return 0
	endif
	// 如果是正常英雄 可能会有变身之类的导致误判 获取原生ID就不会误判
	if HaveSavedInteger(ExtraHT, GetHandleId(whichUnit), HTKEY_UNIT_ORIGIN_TYPEID) then
		set id = LoadInteger(ExtraHT, GetHandleId(whichUnit), HTKEY_UNIT_ORIGIN_TYPEID)
	endif
	if not HaveSavedInteger(ObjectData, OBJ_HTKEY_HERO_PRIMARY, id) then
		set value = ConvertPrimaryAttributes(GetObjectDataBySlk( id, "unit", "Primary" ))
		call SaveInteger(ObjectData, OBJ_HTKEY_HERO_PRIMARY, id, value)
		return value
	else
		return LoadInteger(ObjectData, OBJ_HTKEY_HERO_PRIMARY, id)
	endif
	return 0
endfunction

function E3X takes unit u returns integer
	local integer E4X = GetHeroInt(u, true)
	local integer E5X = GetHeroAgi(u, true)
	local integer E6X = GetHeroStr(u, true)
	return IMaxBJ(IMaxBJ(E6X, E4X), E5X)
endfunction
function GerHeroMainAttributesValue takes unit u returns integer
	local integer i = GetHeroPrimaryAttributesType(u)
	if i == 2 then
		return GetHeroInt(u, true)
	elseif i == 3 then
		return GetHeroAgi(u, true)
	elseif i == 1 then
		return GetHeroStr(u, true)
	endif
	return 0
endfunction

function E8X takes unit whichUnit returns boolean
	return GetWidgetLife(whichUnit)< 1 or M2[GetPlayerId(GetOwningPlayer(whichUnit))]
endfunction

function SaveHeroModelScale takes integer heroTypeId, real scaleData, integer unitTypeId returns nothing
	//set DJ = DJ + 1
	call SaveReal( ObjectData, OBJ_HTKEY_UNIT_ORIGIN_SCALE, heroTypeId, scaleData )
	if unitTypeId != 0 and unitTypeId != heroTypeId then
		call SaveReal( ObjectData, OBJ_HTKEY_UNIT_ORIGIN_SCALE, unitTypeId, scaleData )
	endif
	//set AJ[DJ]= XEX
	//set BJ[DJ]= XVX
	//set CJ[DJ]= XXX
endfunction

function XRX takes integer XIX, string XAX returns nothing
	set GJ = GJ + 1
	set EJ[GJ]= XAX
	set FJ[GJ]= XIX
endfunction
function XNX takes unit u returns string
	local integer XIX = GetUnitTypeId(u)
	local integer i = 1
	loop
	exitwhen i > GJ
		if FJ[i]== XIX then
			return EJ[i]
		endif
		set i = i + 1
	endloop
	return"stand"
endfunction
function XBX takes unit u returns nothing
	if GetUnitTypeId(u)=='N01I' then
		call SetUnitAnimationByIndex(u, 6)
	else
		call SetUnitAnimation(u, XNX(u))
	endif
endfunction
function IsSentinelsPlayer takes player p returns boolean
	return(p == Sentinels[0]) or(p == Sentinels[1]) or(p == Sentinels[2]) or(p == Sentinels[3]) or(p == Sentinels[4]) or(p == Sentinels[5])
endfunction
function IsScourgesPlayer takes player p returns boolean
	return(p == Scourges[0]) or(p == Scourges[1]) or(p == Scourges[2]) or(p == Scourges[3]) or(p == Scourges[4]) or(p == Scourges[5])
endfunction
function XFX takes player p returns boolean
	return p == Sentinels[1]or p == Sentinels[2]or p == Sentinels[3]or p == Sentinels[4]or p == Sentinels[5]or p == Scourges[1]or p == Scourges[2]or p == Scourges[3]or p == Scourges[4]or p == Scourges[5]
endfunction
function XGX takes player p returns boolean
	return((GetPlayerSlotState(p)== PLAYER_SLOT_STATE_PLAYING or GetPlayerSlotState(p)== PLAYER_SLOT_STATE_LEFT) and GetPlayerController(p)== MAP_CONTROL_USER) or(LOD_DEBUGMODE and p != Sentinels[0]and p != Scourges[0])
endfunction
function XHX takes player p returns boolean
	return GetPlayerSlotState(p)== PLAYER_SLOT_STATE_LEFT and GetPlayerController(p)== MAP_CONTROL_USER
endfunction
function XJX takes nothing returns nothing
	if(IsPlaying(GetEnumPlayer())) then
		set bj_forceCountPlayers = bj_forceCountPlayers + 1
	endif
endfunction
function XKX takes force f returns integer
	set bj_forceCountPlayers = 0
	call ForForce(f, function XJX)
	return bj_forceCountPlayers
endfunction
function XLX takes nothing returns nothing
	if GetPlayerSlotState(GetEnumPlayer())== PLAYER_SLOT_STATE_PLAYING then
		if GetEnumPlayer()!= Player($D) and GetEnumPlayer()!= Player($E) then
			set bj_forceCountPlayers = bj_forceCountPlayers + 1
		endif
	endif
endfunction
function XMX takes force f returns integer
	set bj_forceCountPlayers = 0
	call ForForce(f, function XLX)
	return bj_forceCountPlayers
endfunction
function XPX takes integer XQX, player p returns nothing
	if IsNoHeroLimit then
		call SetPlayerTechMaxAllowed(p, XQX, 0)
		set YQ[GetUnitPointValueByType(XQX)]= true
	endif
endfunction
function XSX takes integer XQX returns nothing
	call XPX(XQX, Sentinels[1])
	call XPX(XQX, Sentinels[2])
	call XPX(XQX, Sentinels[3])
	call XPX(XQX, Sentinels[4])
	call XPX(XQX, Sentinels[5])
	call XPX(XQX, Scourges[1])
	call XPX(XQX, Scourges[2])
	call XPX(XQX, Scourges[3])
	call XPX(XQX, Scourges[4])
	call XPX(XQX, Scourges[5])
endfunction
function XTX takes integer XQX returns nothing
	if IsNoHeroLimit then
		call SetPlayerTechMaxAllowed(Sentinels[1], XQX, 0)
		call SetPlayerTechMaxAllowed(Sentinels[2], XQX, 0)
		call SetPlayerTechMaxAllowed(Sentinels[3], XQX, 0)
		call SetPlayerTechMaxAllowed(Sentinels[4], XQX, 0)
		call SetPlayerTechMaxAllowed(Sentinels[5], XQX, 0)
		call SetPlayerTechMaxAllowed(Scourges[1], XQX, 0)
		call SetPlayerTechMaxAllowed(Scourges[2], XQX, 0)
		call SetPlayerTechMaxAllowed(Scourges[3], XQX, 0)
		call SetPlayerTechMaxAllowed(Scourges[4], XQX, 0)
		call SetPlayerTechMaxAllowed(Scourges[5], XQX, 0)
	endif
endfunction
function XUX takes player p returns nothing
	local integer i = 1
	local integer k = VWV
	if IsNoHeroLimit then
		loop
		exitwhen i > k
			call SetPlayerTechMaxAllowed(p, VUV[i], 0)
			set i = i + 1
		endloop
		set i = VYV
		set k = VZV
		loop
		exitwhen i > k
			call SetPlayerTechMaxAllowed(p, VUV[i], 0)
			set i = i + 1
		endloop
	endif
endfunction
function XWX takes nothing returns nothing
	call XUX(Sentinels[1])
	call XUX(Sentinels[2])
	call XUX(Sentinels[3])
	call XUX(Sentinels[4])
	call XUX(Sentinels[5])
	call XUX(Scourges[1])
	call XUX(Scourges[2])
	call XUX(Scourges[3])
	call XUX(Scourges[4])
	call XUX(Scourges[5])
endfunction
function XYX takes player p returns nothing
	local integer i = 1
	local integer k = VWV
	if IsNoHeroLimit then
		loop
		exitwhen i > k
			call SetPlayerTechMaxAllowed(p, VUV[i], 999)
			set i = i + 1
		endloop
		set i = VYV
		set k = VZV
		loop
		exitwhen i > k
			call SetPlayerTechMaxAllowed(p, VUV[i], 999)
			set i = i + 1
		endloop
	endif
endfunction
function XZX takes nothing returns nothing
	call XYX(Sentinels[1])
	call XYX(Sentinels[2])
	call XYX(Sentinels[3])
	call XYX(Sentinels[4])
	call XYX(Sentinels[5])
	call XYX(Scourges[1])
	call XYX(Scourges[2])
	call XYX(Scourges[3])
	call XYX(Scourges[4])
	call XYX(Scourges[5])
endfunction
function X_X takes nothing returns nothing
	local integer i
	local integer k
	local integer a = 0
	set i = 1
	set k = VWV
	loop
	exitwhen i > k
		set a = a + 1
		set WO[a]= i
		set i = i + 1
	endloop
	set i = VYV
	set k = VZV
	loop
	exitwhen i > k
		set a = a + 1
		set WO[a]= i
		set i = i + 1
	endloop
	set VO = a
endfunction
function X0X takes nothing returns integer
	local integer X1X = GetRandomInt(1, VO)
	local integer X2X = WO[X1X]
	set X2X = WO[X1X]
	if(1 == VO) then
		set WO[X1X]= 0
		return X2X
	endif
	if(X1X == VO) then
		set VO = VO -1
		return X2X
	endif
	set WO[X1X]= WO[VO]
	set VO = VO -1
	return X2X
endfunction
function X3X takes unit u returns boolean
	return GetUnitAbilityLevel(u,'B01T')> 0 or GetUnitAbilityLevel(u,'BNsi')> 0 or GetUnitAbilityLevel(u,'B01X')> 0 or GetUnitAbilityLevel(u,'BNdo')> 0 or GetUnitAbilityLevel(u,'B02M')> 0 or GetUnitAbilityLevel(u,'Bhea')> 0 or GetUnitAbilityLevel(u,'B07V')> 0 or GetUnitAbilityLevel(u,'B0BY')> 0 or GetUnitAbilityLevel(u,'B08O')> 0 or GetUnitAbilityLevel(u,'B07U')> 0 or GetUnitAbilityLevel(u,'B0DL')> 0 or GetUnitAbilityLevel(u,'B08V')> 0 or GetUnitAbilityLevel(u,'B031')> 0 or GetUnitAbilityLevel(u,'B0FT')> 0 or GetUnitAbilityLevel(u,'B0FG')> 0 or GetUnitAbilityLevel(u,'B450')> 0 or GetUnitAbilityLevel(u,'B463')> 0
endfunction
function X4X takes unit u returns boolean
	return IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER)== false and(GetUnitAbilityLevel(u,'A1N3')> 0 or GetUnitAbilityLevel(u,'A12Q')== 1 or LodSystem_GetUnitExtraState(u, STATE_SYSTEM_ATTACK)>$C8)
endfunction
function X5X takes string s returns integer
	if s == "a"then
		return $A
	elseif s == "b"then
		return $B
	elseif s == "c"then
		return $C
	elseif s == "d"then
		return $D
	elseif s == "e"then
		return $E
	elseif s == "f"then
		return $F
	else
		return S2I(s)
	endif
endfunction
function X6X takes string s returns integer
	return X5X(SubString(s, 0, 1))* 16 + X5X(SubString(s, 1, 2))
endfunction

function X8X takes unit X9X returns integer
	local integer OVX = GetUnitTypeId(X9X)
	if OVX =='e00R' or OVX =='u00M' then
		return 1
	elseif OVX =='e011' or OVX =='u00D' then
		return 2
	elseif OVX =='e00S' or OVX =='u00N' then
		return 3
	elseif OVX =='e019' or OVX =='u00T' then
		return 4
	endif
	return 0
endfunction
// 技能Id是攻击特效
function IsAttackSpecialEffectsId takes integer id returns boolean
	return id =='A0DY' or id =='A1WB' or id =='A026' or id =='A09V' or id =='AHfa' or id =='A0LZ' or id =='A0OI'
endfunction

function OOX takes player VBX, integer Y_E returns nothing
	local texttag t
	if Y_E > 0 then
		set Y_E = AddPlayerResourceGold(VBX, Y_E)
		set t = CreateTextTag()
		call SetTextTagText(t, "+" + I2S(Y_E), .025)
		call SetTextTagPosUnit(t, Player__Hero[GetPlayerId(VBX)], 0)
		call SetTextTagColor(t, 255,$DC, 0, 255)
		call SetTextTagVelocity(t, 0, .03)
		call SetTextTagVisibility(t, LocalPlayer== VBX)
		call SetTextTagFadepoint(t, 2)
		call SetTextTagLifespan(t, 3)
		call SetTextTagPermanent(t, false)
		set t = null
	endif
endfunction
function ORX takes player p, integer Y_E returns nothing
	call OOX(p, Y_E)
	set EUV[GetPlayerId(p)]= EUV[GetPlayerId(p)]+ Y_E
endfunction
function OIX takes integer OAX, integer Y_E returns nothing
	if OAX == 0 then
		call ORX(Sentinels[1], Y_E)
		call ORX(Sentinels[2], Y_E)
		call ORX(Sentinels[3], Y_E)
		call ORX(Sentinels[4], Y_E)
		call ORX(Sentinels[5], Y_E)
	else
		call ORX(Scourges[1], Y_E)
		call ORX(Scourges[2], Y_E)
		call ORX(Scourges[3], Y_E)
		call ORX(Scourges[4], Y_E)
		call ORX(Scourges[5], Y_E)
	endif
endfunction
function ONX takes unit u, boolean OBX returns nothing
	local integer Y_E
	if OBX then
		set Y_E =$E1
	else
		set Y_E = 275
	endif
	if IsUnitAlly(GetDyingUnit(), GetOwningPlayer(u)) then
		set Y_E = Y_E / 2
	endif
	if GetOwningPlayer(GetDyingUnit())== Scourges[0]then
		call OIX(0, Y_E)
	else
		call OIX(1, Y_E)
	endif
endfunction
function OCX takes unit U6E, integer level returns nothing
	local integer Y_E
	set Y_E = 120+ 40 * level
	call UnitAddAbility(GetDyingUnit(),'A3C9')
	if IsUnitAlly(GetDyingUnit(), GetOwningPlayer(U6E)) then
		set Y_E = Y_E / 2
	endif
	if GetOwningPlayer(GetDyingUnit())== Scourges[0]then
		call OIX(0, Y_E)
	else
		call OIX(1, Y_E)
	endif
endfunction
function OFX takes player p, integer at returns nothing
	local integer i
	local integer k
	local location OGX
	local integer TTV
	local integer TME = GetPlayerId(p)
	local boolean E4X = at == 1
	local boolean E5X = at == 2
	local boolean E6X = at == 3
	set FT[TME]= true
	if IsSentinelsPlayer(p) then
		set OGX = GetRectCenter(VZ)
	else
		set OGX = GetRectCenter(GY)
	endif
	loop
		if E4X then
			set TTV = TVE(V3V[GetRandomInt(1, V4V)])
		elseif E5X then
			set TTV = TVE(V_V[GetRandomInt(1, V0V)])
		elseif E6X then
			set TTV = TVE(V1V[GetRandomInt(1, V2V)])
		endif
	exitwhen ZQ[TTV]== false and(PP[TME]== 0 or(IsUnitIdType(VUV[TTV], UNIT_TYPE_RANGED_ATTACKER) and PP[TME]== 2) or(IsUnitIdType(VUV[TTV], UNIT_TYPE_MELEE_ATTACKER) and PP[TME]== 1))
	endloop
	if PW == false then
		call XTX(VUV[TTV])
		set YQ[TTV]= true
		set ZQ[TTV]= true
	endif
	call CreateUnitAtLoc(p, VUV[TTV], OGX, 0)
	call RemoveLocation(OGX)
	set OGX = null
endfunction
function OHX takes player p, integer OJX returns nothing
	local integer i
	local integer k
	local location OGX
	local integer TTV = 0
	local integer j = 0
	set FT[GetPlayerId(p)]= true
	if IsSentinelsPlayer(p) then
		set OGX = GetRectCenter(VZ)
	else
		set OGX = GetRectCenter(GY)
	endif
	loop
		if OJX == 1 then
			set TTV = TVE(V7V[GetRandomInt(1, V8V)])
		elseif OJX == 2 then
			set TTV = TVE(V5V[GetRandomInt(1, V6V)])
		endif
	exitwhen ZQ[TTV]== false or j > 400
		set j = j + 1
	endloop
	if j > 400 and ZQ[TTV]then
		if OJX == 1 then
			call DisplayTimedTextToPlayer(p, 0, 0, 10, "没有剩余的近战英雄.")
		elseif OJX == 2 then
			call DisplayTimedTextToPlayer(p, 0, 0, 10, "没有剩余的远程英雄.")
		endif
		call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)+$96)
		set FT[GetPlayerId(p)]= false
	else
		if PW == false then
			call XTX(VUV[TTV])
			set YQ[TTV]= true
			set ZQ[TTV]= true
		endif
		call CreateUnitAtLoc(p, VUV[TTV], OGX, 0)
	endif
	call RemoveLocation(OGX)
	set OGX = null
endfunction
function OKX takes player p returns nothing
	local integer i
	local integer k
	local location OGX
	local integer TTV
	local integer TME = GetPlayerId(p)
	set FT[GetPlayerId(p)]= true
	if IsSentinelsPlayer(p) then
		set OGX = GetRectCenter(VZ)
	else
		set OGX = GetRectCenter(GY)
	endif
	loop
		set TTV = GetRandomInt(1, VZV)
	exitwhen ZQ[TTV]== false and(PP[TME]== 0 or(IsUnitIdType(VUV[TTV], UNIT_TYPE_RANGED_ATTACKER) and PP[TME]== 2) or(IsUnitIdType(VUV[TTV], UNIT_TYPE_MELEE_ATTACKER) and PP[TME]== 1))
	endloop
	if PW == false then
		call XTX(VUV[TTV])
		set YQ[TTV]= true
		set ZQ[TTV]= true
	endif
	call CreateUnitAtLoc(p, VUV[TTV], OGX, 0)
	call RemoveLocation(OGX)
	set OGX = null
endfunction
function OLX takes player p returns boolean
	return LoadBoolean(V, 0, VPV[GetPlayerId(p)])
endfunction
function OMX takes integer i returns boolean
	return i =='np00' or i =='n00I' or i =='n022' or i =='n021' or i =='n0KY' or i =='n0KZ' or i =='n0LE' or i =='n023' or i =='n024' or i =='n025' or i =='n0L0' or i =='n0L1' or i =='n0M4' or i =='n00M' or i =='n0HV' or i =='n0LS'
endfunction
function OPX takes unit u returns boolean
	return OMX(GetUnitTypeId(u))
endfunction
function OQX takes integer i returns boolean
	return i =='np01' or i =='e01H' or i =='e01Z' or i =='e02R' or i =='e02T' or i =='e02S' or i =='e030'
endfunction
function OSX takes unit u returns boolean
	return OQX(GetUnitTypeId(u))
endfunction
// 是信使单位
function IsMessengerUnit takes unit u returns boolean
	return OPX(u) or OSX(u)
endfunction


function IsTreeDestructable takes destructable d returns boolean
	return GetDestructableTypeId(d)=='CTtr' or GetDestructableTypeId(d)=='NTtc' or GetDestructableTypeId(d)=='NTtw' or GetDestructableTypeId(d)=='ATtr' or GetDestructableTypeId(d)=='B002' or GetDestructableTypeId(d)=='B003' or GetDestructableTypeId(d)=='B005' or GetDestructableTypeId(d)=='ITtw' or GetDestructableTypeId(d)=='CTtr'
endfunction

function IsTreeTypeId takes integer id returns boolean
	return id=='CTtr' or id=='NTtc' or id=='NTtw' or id=='ATtr' or id=='B002' or id=='B003' or id=='B005' or id=='ITtw' or id=='CTtr'
endfunction

// 是魔法免疫单位
function IsMagicImmuneUnit takes unit u returns boolean
	return IsUnitType(u, UNIT_TYPE_MAGIC_IMMUNE) or LoadInteger(HY, GetHandleId(u), 4252)== 1
endfunction
function OYX takes unit u returns boolean
	return HaveSavedHandle(HY, GetHandleId(u),'FRZH')
endfunction
function OZX takes unit O_X returns boolean
	return GetUnitAbilityLevel(O_X,'A04R')> 0 and XFX(GetOwningPlayer(O_X))
endfunction
function O0X takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return i =='H00F' or i =='H00E' or i =='H00G' or i =='O017' or i =='N0MA' or i =='N0MB' or i =='N0MC' or i =='N0MO'
endfunction
function IsEffectiveDamage takes real d returns boolean
	return 2 < d and d < 3000
endfunction
function O2X takes nothing returns nothing
	local integer O3X = 1
	set HostPlayer = Sentinels[1]
	loop
	exitwhen IsPlaying(HostPlayer) or O3X > 5
		set O3X = O3X + 1
		set HostPlayer = Sentinels[O3X]
	endloop
	if IsPlaying(HostPlayer)== false then
		set HostPlayer = Scourges[1]
		set O3X = 1
		loop
		exitwhen IsPlaying(HostPlayer) or O3X > 5
			set O3X = O3X + 1
			set HostPlayer = Scourges[O3X]
		endloop
	endif
endfunction
function O4X takes unit u returns boolean
	return IsUnitType(u, UNIT_TYPE_HERO) and IsUnitIllusion(u)== false and GetUnitTypeId(u)!='H00M' and GetUnitTypeId(u)!='H00Y' and GetUnitTypeId(u)!='H07G' and GetUnitTypeId(u)!='H0B8' and GetUnitTypeId(Player__Hero[GetPlayerId(GetOwningPlayer(u))])!= GetUnitTypeId(u)
endfunction
function O5X takes integer XVX returns integer
	local integer i = 1
	loop
	exitwhen i > VZV
		if XVX == VUV[i]then
			return i
		endif
		set i = i + 1
	endloop
	return 0
endfunction

function IsDayTime takes nothing returns boolean
	return GetTimeOfDay()> 6. and GetTimeOfDay()< 18.
endfunction

function IsAttackOrdersId takes integer id returns boolean
	return id == 851983 or id == 851984 or id == 851985 or id == 851971
endfunction

// 最大 5. 魔兽的最大攻击速度加成为500% 最小0.2%
function GetUnitAttackSpeed takes unit whichUnit returns real 
	return RMaxBJ( RMinBJ( GetUnitState(whichUnit, UNIT_STATE_RATE_OF_FIRE) , 5.), 0.2 )
endfunction

function GetUnitPhysicalResistance takes unit whichUnit returns real 
	local real tempReal = GetUnitState(whichUnit, UNIT_STATE_ARMOR)
	if tempReal >= 0. then
		set tempReal = 1. / ( 1. + tempReal * 0.06 )
	else
		set tempReal = 2. - Pow( 1. - 0.06, RMinBJ(20., 0. - tempReal))
	endif
	return tempReal 
endfunction



function FixOrderActions takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local integer currentOrderId = GetUnitCurrentOrder(whichUnit)
	if IsAttackOrdersId(currentOrderId) then
		call EXPauseUnit(whichUnit, true)
		call EXPauseUnit(whichUnit, false)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(trig)
	set whichUnit = null
	set trig = null
	return false
endfunction

function FixUnitOrder takes unit whichUnit returns nothing
	local integer h = CreateTimerEventTrigger(0., false, function FixOrderActions)
	call SaveUnitHandle(HY, h, 0, whichUnit)
endfunction

function AddUnitState takes unit whichUnit, unitstate whichUnitState, real addVal returns nothing
	call SetUnitState(whichUnit, whichUnitState, GetUnitState(whichUnit, whichUnitState) + addVal )
endfunction

function SetUnitAttack1Range takes unit whichUnit, real r returns nothing
	call SetUnitState(whichUnit, UNIT_STATE_ATTACK1_RANGE, r)
	// 如果单位正在攻击 暂停再恢复会立即修正攻击射程 不会打断shift队列
	// 攻击 攻击一次 攻击地面 右键
	call FixUnitOrder(whichUnit)
endfunction

function SetUnitAttack1RangeBonus takes unit whichUnit, real bonusValue returns nothing
	local real defaultRangeN1 = GetUnitDefaultRangeN1(whichUnit)
	call SetUnitAttack1Range(whichUnit, defaultRangeN1 + bonusValue)
	call SetUnitAcquireRange(whichUnit, GetUnitDefaultAcquireRange(whichUnit) + bonusValue)
endfunction

// 以来源单位为标准 同步目标单位的射程数据
// 如果两个参数一致 就是刷新单位射程数据 因为单位变身可能会改变
function FixUnitRange takes unit sourceUnit, unit targetUnit returns nothing
	local integer h = GetHandleId(sourceUnit)
	local real onlyRangeAttackerRangeN1Bonus
	local real currencyRangeN1Bonus = LoadReal(ExtraHT, h, HTKEY_CURRENCY_RANGEN1_BONUS)
	if IsUnitType(targetUnit, UNIT_TYPE_RANGED_ATTACKER) then
		set onlyRangeAttackerRangeN1Bonus = LoadReal(ExtraHT, h, HTKEY_RANGEN1_ONLY_RANGED_ATTACKER_BONUS)
		call SetUnitAttack1RangeBonus(targetUnit, onlyRangeAttackerRangeN1Bonus + currencyRangeN1Bonus)
	else
		call SetUnitAttack1RangeBonus(targetUnit, currencyRangeN1Bonus)
	endif
endfunction

// 添加 通用 射程奖励
function AddUnitAttack1RangeCurrencyBonus takes unit whichUnit, real bonusValue returns nothing
	local integer h = GetHandleId(whichUnit)
	local real range = LoadReal(ExtraHT, h, HTKEY_CURRENCY_RANGEN1_BONUS) + bonusValue
	call SaveReal(ExtraHT, h, HTKEY_CURRENCY_RANGEN1_BONUS, range)
	call FixUnitRange(whichUnit, whichUnit)
endfunction

// 添加 仅限远程 射程奖励
function AddUnitAttack1RangeBonus_OnlyRangeAttacker takes unit whichUnit, real bonusValue returns nothing
	local integer h = GetHandleId(whichUnit)
	local real range = LoadReal(ExtraHT, h, HTKEY_RANGEN1_ONLY_RANGED_ATTACKER_BONUS) + bonusValue
	call SaveReal(ExtraHT, h, HTKEY_RANGEN1_ONLY_RANGED_ATTACKER_BONUS, range)
	call FixUnitRange(whichUnit, whichUnit)
endfunction





function SetUnitFrostVertexColor takes unit u returns nothing
	local integer WPV = GetUnitTypeId(u)
	local integer h = GetHandleId(u)
	local integer a = 255
	if HaveSavedInteger(P, h,'ALPH') then
		set a = LoadInteger(P, h,'ALPH')
	endif
	call SetUnitVertexColor(u, 128, 192, 192, a)
	call SaveInteger(P, h, IC + 0, 128)
	call SaveInteger(P, h, IC + 1, 192)
	call SaveInteger(P, h, IC + 2, 192)
	call SaveInteger(P, h,'ALPH', a)
endfunction
// 恢复单位的RGB
function ResetUnitVertexColor takes unit u returns nothing
	local integer WPV = GetUnitTypeId(u)
	local integer r = 255
	local integer g = 255
	local integer b = 255
	local integer a = 255
	if HaveSavedInteger(L, WPV, 0) then
		set r = LoadInteger(L, WPV, 0)
	endif
	if HaveSavedInteger(L, WPV, 1) then
		set g = LoadInteger(L, WPV, 1)
	endif
	if HaveSavedInteger(L, WPV, 2) then
		set b = LoadInteger(L, WPV, 2)
	endif
	if HaveSavedInteger(P, GetHandleId(u),'ALPH') then
		set a = LoadInteger(P, GetHandleId(u),'ALPH')
	endif
	call SetUnitVertexColor(u, r, g, b, a)
	call SaveInteger(P, GetHandleId(u), IC + 0, r)
	call SaveInteger(P, GetHandleId(u), IC + 1, g)
	call SaveInteger(P, GetHandleId(u), IC + 2, b)
	call SaveInteger(P, GetHandleId(u),'ALPH', a)
endfunction
function SetUnitVertexColorEx takes unit u, integer r, integer g, integer b, integer a returns nothing
	local integer WPV = GetUnitTypeId(u)
	local integer h = GetHandleId(u)
	if r ==-1 then
		if HaveSavedInteger(P, h, IC + 0) then
			set r = LoadInteger(P, h, IC + 0)
		elseif HaveSavedInteger(L, WPV, 0) then
			set r = LoadInteger(L, WPV, 0)
		else
			set r = 255
		endif
	endif
	if g ==-1 then
		if HaveSavedInteger(P, h, IC + 1) then
			set g = LoadInteger(P, h, IC + 1)
		elseif HaveSavedInteger(L, WPV, 1) then
			set g = LoadInteger(L, WPV, 1)
		else
			set g = 255
		endif
	endif
	if b ==-1 then
		if HaveSavedInteger(P, h, IC + 2) then
			set b = LoadInteger(P, h, IC + 2)
		elseif HaveSavedInteger(L, WPV, 2) then
			set b = LoadInteger(L, WPV, 2)
		else
			set b = 255
		endif
	endif
	if a ==-1 then
		if HaveSavedInteger(P, h,'ALPH') then
			set a = LoadInteger(P, h,'ALPH')
		else
			set a = 255
		endif
	endif
	call SetUnitVertexColor(u, r, g, b, a)
	call SaveInteger(P, h, IC + 0, r)
	call SaveInteger(P, h, IC + 1, g)
	call SaveInteger(P, h, IC + 2, b)
	call SaveInteger(P, h,'ALPH', a)
endfunction


function InterfaceErrorForPlayer takes player p, string str returns nothing
	local sound s = CreateSoundFromLabel("InterfaceError", false, false, false, 10, 10)
	if (str != "") and(str != null) then
		if (LocalPlayer== p) then
			//call ClearTextMessages()
			//call DisplayTimedTextToPlayer(p, .5,-1., 2., "|cffffcc00" + str + "|r")
			set InterfaceErrorHideTime = GetGameTime( ) + 10.
			call DzFrameSetAlpha( UIText__TargetingError, 255 )
			call DzFrameSetText( UIText__TargetingError, "|cffffcc00" + str )
			call DzFrameShow( UIFrame__TargetingError , true )
		endif
	endif
	// debug call SingleDebug("ErrorTip" + "|cffffcc00" + str + "|r")
	if (LocalPlayer== p) then
		call StartSound(s)
	endif
	call KillSoundWhenDone(s)
	set s = null
endfunction



function UnitRestoreHidden takes unit whichUnit returns nothing


endfunction

// 隐藏单位
function EXHideUnit takes unit whichUnit returns nothing


endfunction

function UnitRemoveLocked takes unit whichUnit, integer abilityId, integer buffId returns nothing
	local integer uHandleId = GetHandleId( whichUnit )
	local trigger trig = LoadTriggerHandle( ExtraHT, uHandleId, HTKEY_LOCKED_BUFF_TRIGGER )
	local integer tHandleId = GetHandleId( trig )
	local integer maxCount = LoadInteger( HY, tHandleId, 0 )
	local integer buffCount = 0
	local integer i = 1
	local integer buffPos
	if trig != null then
		
		loop
			exitwhen i > maxCount
			// 遍历所有锁闭Buff
			if LoadInteger(HY, tHandleId, i) == abilityId then
				// 如果有锁闭Buff等于要删除的Buff
				set buffCount = buffCount + 1
				set buffPos = i
			endif
			set i = i + 1
		endloop
		if buffCount == 0 then // 如果没有查找到需要删除的Buff 说明不需要删除 返回
			set trig = null
			return
		endif
		if maxCount == 1 then
			// 最大计数 = 1 要移除锁闭效果
			call RemoveSavedHandle( ExtraHT, uHandleId, HTKEY_LOCKED_BUFF_TRIGGER )
			call RemoveSavedBoolean( ExtraHT, uHandleId, HTKEY_LOCKED_BUFF_TRIGGER )
			call UnitRemoveAbility(whichUnit, abilityId)
			call UnitRemoveAbility(whichUnit, buffId)
			call FlushChildHashtable( HY, tHandleId )
			call CleanCurrentTrigger( trig )
		else
			if buffCount == 1 then
				call UnitRemoveAbility(whichUnit, abilityId)
				call UnitRemoveAbility(whichUnit, buffId)
				if maxCount > 1 then // 大于0 将最大的锁闭Buff移动至此
					set abilityId = LoadInteger( HY, tHandleId, maxCount )
					set buffId = LoadInteger( HY, tHandleId, - maxCount )
					call SaveInteger( HY, tHandleId, buffPos, abilityId)
					call SaveInteger( HY, tHandleId, - buffPos, buffId)
				endif
			endif
			set maxCount = maxCount - 1
			call SaveInteger( HY, tHandleId, 0, maxCount )
		endif
	endif
	set trig = null
endfunction

// 给单位添加锁闭效果 有一个计数 当计数 = 0 时 结束锁闭效果
// trig 仅仅是作为一个储存数据的作用 数据存在以trig的handle为父key HY的哈希表上
function UnitAddLocked takes unit whichUnit, integer abilityId, integer buffId returns nothing
	local integer uHandleId = GetHandleId( whichUnit )
	local trigger trig = LoadTriggerHandle( ExtraHT, uHandleId, HTKEY_LOCKED_BUFF_TRIGGER )
	local integer tHandleId
	local integer count 
	if trig == null then
		set trig = CreateTrigger()
		set tHandleId = GetHandleId( trig )
		call SaveTriggerHandle(ExtraHT, uHandleId, HTKEY_LOCKED_BUFF_TRIGGER, trig)
		call SaveBoolean( ExtraHT, uHandleId, HTKEY_LOCKED_BUFF_TRIGGER, true )
		set count = 1
		call SaveUnitHandle( HY, tHandleId, 0, whichUnit )
		call SaveInteger( HY, tHandleId, 0, 1 ) // count
		call SaveInteger( HY, tHandleId, count, abilityId)
		call SaveInteger( HY, tHandleId, - count, buffId)
		call UnitAddPermanentAbility(whichUnit, abilityId)

	else
		set tHandleId = GetHandleId( trig )
		set count = LoadInteger( HY, tHandleId, 0 ) + 1
		call SaveInteger( HY, tHandleId, 0, count ) // count ++
		call SaveInteger( HY, tHandleId, count, abilityId)
		call SaveInteger( HY, tHandleId, - count, buffId)
		call UnitAddPermanentAbility(whichUnit, abilityId)
	endif
	set trig = null
endfunction

// 无法驱散的沉默
function SilenceUnit takes unit whichUnit, boolean flag returns nothing
	local unit d
	local integer h = GetHandleId(whichUnit)
	local integer count = LoadInteger(ExtraHT, h, HTKEY_UNIT_SILENCE_COUINT)
	if flag then
		set count = count + 1
	else
		set count = count - 1
	endif
	call SaveInteger(ExtraHT, h, HTKEY_UNIT_SILENCE_COUINT, count)
	if count == 1 then
		call DzUnitSilence(whichUnit, flag)
	elseif count == 0 then
		call DzUnitSilence(whichUnit, flag)
	endif
endfunction

// 添加沉默 和锁闭
function UnitAddSilenceAndLocked takes unit whichUnit, integer abilityId, integer buffId returns nothing
	call SilenceUnit(whichUnit, true)
	call UnitAddLocked(whichUnit, abilityId, buffId)
endfunction

// 移除沉默 和锁闭
function UnitRemoveSilenceAndLocked takes unit whichUnit, integer abilityId, integer buffId returns nothing
	call SilenceUnit(whichUnit, false)
	call UnitRemoveLocked(whichUnit, abilityId, buffId)
endfunction

// 缴械 按Buff类型来算
// (伐木机缴械 凤凰激光缴械 燃烧枷锁) 会被军团决斗驱散
// (超震声波缴械 命运敕令缴械) 可驱散
// 天堂缴械 无法驱散
// 缴械效果均为以新代旧
function DisarmUnit takes unit whichUnit, boolean flag, integer disarmId, integer abilityId, integer buffId returns nothing
	local integer h = GetHandleId(whichUnit)
	local integer count = LoadInteger(ExtraHT, h, disarmId)
	if flag then
		set count = count + 1
	else
		set count = count - 1
	endif
	call SaveInteger(ExtraHT, h, disarmId, count)
	if count == 1 then
		call UnitAddPermanentAbility(whichUnit, disarmId)
		call UnitAddPermanentAbility(whichUnit, abilityId)
	elseif count == 0 then
		call RemoveSavedInteger(ExtraHT, h, disarmId)
		call UnitRemoveAbility(whichUnit, disarmId)
		call UnitRemoveAbility(whichUnit, abilityId)
		call UnitRemoveAbility(whichUnit, buffId)
	endif
endfunction

function DisarmUnitToTimedExpireActions takes nothing returns nothing
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local integer disarmId = LoadInteger(HY, h, 1)

	call DisarmUnit(whichUnit, false, disarmId, LoadInteger(HY, h, 2), LoadInteger(HY, h, 3))

	call RemoveSavedHandle(ExtraHT, GetHandleId(whichUnit), disarmId)
	call DestroyTimer(LoadTimerHandle(HY, h, 1))

	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(trig)

	set whichUnit = null
	set trig = null
endfunction

function UnitRemoveDisarm takes unit whichUnit, integer disarmId returns nothing
	local integer h = GetHandleId(whichUnit)
	local trigger trig = null
	local integer abilityId
	local integer buffId
	// 是否有对应的缴械触发器?
	if HaveSavedHandle(ExtraHT, h, disarmId) then
		set trig = LoadTriggerHandle(ExtraHT, h, disarmId)
		call RemoveSavedHandle(ExtraHT, h, disarmId)
		set h = GetHandleId(trig)
		set abilityId = LoadInteger(HY, h, 2)
		set buffId = LoadInteger(HY, h, 3)
		call DisarmUnit(whichUnit, false, disarmId, abilityId, buffId)

		call DestroyTimer(LoadTimerHandle(HY, h, 1))

		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(trig)
		set trig = null
	endif
endfunction

// 在指定时间内添加缴械, 死亡时清除
// 以新代旧
function DisarmUnitToTimed takes unit whichUnit, integer disarmId, integer abilityId, integer buffId, real time returns nothing
	local trigger trig 
	local timer timr
	local integer h = GetHandleId(whichUnit)
	// 是否有对应的缴械触发器?
	if HaveSavedHandle(ExtraHT, h, disarmId) then
		set trig = LoadTriggerHandle(ExtraHT, h, disarmId)
		set h = GetHandleId(trig)
		set timr = LoadTimerHandle(HY, h, 1)
	else
		set trig = CreateTrigger()
		call SaveTriggerHandle(ExtraHT, h, disarmId, trig)
		set h = GetHandleId(trig)
		set timr = CreateTimer()
		call TriggerAddCondition(trig, Condition( function DisarmUnitToTimedExpireActions))
		call TriggerRegisterTimerExpireEvent(trig, timr)
		call TriggerRegisterDeathEvent(trig, whichUnit)
		call SaveUnitHandle(HY, h, 0, whichUnit)
		call SaveInteger(HY, h, 1, disarmId)
		call SaveInteger(HY, h, 2, abilityId)
		call SaveInteger(HY, h, 3, buffId)
		call SaveTimerHandle(HY, h, 1, timr)
		call DisarmUnit(whichUnit, true, disarmId, abilityId, buffId)
	endif
	call TimerStart(timr, time, false, null) // 以新代旧

	set timr = null
	set trig = null
endfunction


function O8X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer i = 1
	local integer iSkillLevel
	if UnitAlive(u) then
		// call BJDebugMsg("删除技能"+R2S(GetGameTime()))
		loop
			set iSkillLevel = GetUnitAbilityLevel(u, PassiveSkills_Learned[i])
			if iSkillLevel == 0 and(GetUnitAbilityLevel(u, PassiveSkills_Real[i])> 0 or GetUnitAbilityLevel(u, PassiveSkills_SpellBook[i])> 0 or GetUnitAbilityLevel(u, PassiveSkills_Buff[i])> 0) then
				call UnitRemoveAbility(u, PassiveSkills_Real[i])
				call UnitRemoveAbility(u, PassiveSkills_SpellBook[i])
				call UnitRemoveAbility(u, PassiveSkills_Buff[i])
				call UnitRemoveAbility(u, PassiveSkills_Show[i])
			endif
			set i = i + 1
		exitwhen i > MaxPassiveSkillsNum
		endloop
	endif

	// 刷新单位相位移动状态
	call RefreshUnitPhaseMove(u)

	if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
		if GetUnitAbilityLevel(u,'A1WE')> 0 then
			call UnitRemoveAbility(u,'A3FH')
		endif
		if GetUnitAbilityLevel(u,'A1WE')> 0 then
			call UnitAddPermanentAbility(u,'A3FH')
			call SetAllPlayerAbilityUnavailable('A3FH')
		endif
	else
		if GetUnitAbilityLevel(u,'A0B8')> 0 then
			call UnitRemoveAbility(u,'A3FI')
		endif
		if GetUnitAbilityLevel(u,'A0B8')> 0 then
			call UnitAddPermanentAbility(u,'A3FI')
			call SetAllPlayerAbilityUnavailable('A3FI')
		endif
	endif
	// 修正高度
	call SetUnitFlyHeight(u, GetUnitDefaultFlyHeight(u), 0)
	// 修正射程
	call FixUnitRange(u, u)
	// 修正缩放
	call SetUnitCurrentScaleEx(u, GetUnitCurrentScale(u))
	// 修正颜色
	//call SetUnitVertexColorEx(u, -1, -1, -1, -1)
	call ResetUnitVertexColor(u)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call TriggerEvaluate(IO)

	call FixUnitOrder(u)
	//endif
	set Q5V = u
	set t = null
	set u = null
	return false
endfunction

// 判断技能Id是否为变身技能
function IsMetamorphosisSkill takes integer id returns boolean
	return id =='A0AG' or id =='QM01' or id =='A0BE' or id =='QM00' or id =='QB0K' or id =='ANcr' or id =='QB0L' or id =='A2H0' or id =='QM02' or id =='QM03' or id =='QM04' or id =='A1RI' or id =='A332' or id =='A2M0' or id =='A2H1'
endfunction

// 单位变身事件
function RVX takes nothing returns nothing
	local integer iTrigHandleId
	local unit hTriggerUnit
	local trigger hTrig
	local integer iNewTrigHandleId
	local real rDur
	local integer id = GetSpellAbilityId()
	if IsMetamorphosisSkill(id) then
		set iTrigHandleId = GetHandleId(GetTriggeringTrigger())
		set hTrig = CreateTrigger()
		set iNewTrigHandleId = GetHandleId(hTrig)
		set hTriggerUnit = LoadUnitHandle(HY, iTrigHandleId, 0)
		call SaveUnitHandle(HY, iNewTrigHandleId, 0, hTriggerUnit)
		call SaveInteger(HY, iNewTrigHandleId, 0, id)
		// 保存单位是否为变身单位布尔
		call SaveBoolean(HY, iNewTrigHandleId, 3, UnitTypeIsMetamorphosis(hTriggerUnit))
		set rDur = YDWEGetUnitAbilityDataReal(hTriggerUnit, id, GetUnitAbilityLevel(hTriggerUnit, id), 102)
		// GetTriggerEventId()!= EVENT_UNIT_SPELL_ENDCAST
		// call BJDebugMsg("触发器运行"+R2S(GetGameTime()))
		// call BJDebugMsg("变身时间"+ R2S( rDur ) )
		// 需要 + 0.001 而不是0.0001 否则还会全光环
		call TriggerRegisterTimerEvent(hTrig, rDur + 0.001, false) // 
		call TriggerAddCondition(hTrig, Condition(function O8X))
		//call SaveBoolean(HY, iNewTrigHandleId, 0, GetTriggerEventId()== EVENT_UNIT_SPELL_ENDCAST)
		set hTrig = null
		set hTriggerUnit = null
	endif
endfunction

function REX takes integer RXX returns integer
	local integer id = O5X(RXX)
	local string ROX = I2S(2 * id -2)
	local integer l = StringLength(ROX)
	if RXX =='N01H' or RXX =='H600' then
		return'M500'
	elseif RXX =='N01T' or RXX =='H601' then
		return'M502'
	elseif RXX =='N01J' or RXX =='H602' then
		return'M504'
	elseif RXX =='H00F' then
		return'M506'
	elseif RXX =='H00E' then
		return'M508'
	elseif RXX =='H00G' then
		return'M510'
	elseif RXX =='O017' then
		return'M512'
	elseif RXX =='H06X' then
		return'M514'
	elseif RXX =='H06Y' then
		return'M516'
	elseif RXX =='H06W' then
		return'M518'
	elseif RXX =='N013' then
		return'M520'
	elseif RXX =='N014' then
		return'M522'
	elseif RXX =='N015' then
		return'M524'
	elseif RXX =='E015' then
		return'M526'
	elseif RXX =='H07I' then
		return'M528'
	elseif RXX =='Eevm' then
		return'M530'
	elseif RXX =='E02V' then
		return'M532'
	elseif RXX =='E02W' then
		return'M534'
	elseif RXX =='E02U' then
		return'M536'
	elseif RXX =='H08D' then
		return'M538'
	elseif RXX =='H08C' then
		return'M540'
	elseif RXX =='H084' then
		return'M542'
	elseif RXX =='H08B' then
		return'M544'
	elseif RXX =='N017' then
		return'M546'
	elseif RXX =='N02B' then
		return'M548'
	elseif RXX =='N0MB' then
		return'M550'
	elseif RXX =='N0MC' then
		return'M552'
	elseif RXX =='N0MO' then
		return'M554'
	elseif RXX =='N0MA' then
		return'M556'
	elseif RXX =='U01X' then
		return'M558'
	elseif RXX =='QTW2' then
		return'M562'
	elseif RXX =='QTW3' then
		return'M564'
	elseif RXX =='KODO' then
		return'M566'
	elseif RXX =='H00U' then
		return'M186'
	elseif RXX =='H500' then
		return'M568'
	elseif RXX =='H501' then
		return'M570'
	elseif RXX =='H502' then
		return'M572'
	elseif RXX =='H503' then
		return'M574'
	elseif RXX =='H504' then
		return'M576'
	elseif RXX =='H505' then
		return'M578'
	elseif RXX =='H506' then
		return'M57A'
	elseif RXX =='H507' then
		return'M57C'
	endif
	if id == 0 then
		return 0
	endif
	if l == 1 then
		set ROX = "M00" + ROX
	elseif l == 2 then
		set ROX = "M0" + ROX
	elseif l == 3 then
		set ROX = "M" + ROX
	else
		return 0
	endif
	return UDV(ROX)
endfunction
function RRX takes unit u returns integer
	local integer RIX = REX(GetUnitTypeId(u))
	if RIX !='M106'then
		call UnitAddAbility(u,'A04R')
		call UnitAddAbility(u, RIX)
		call UnitRemoveAbility(u, RIX)
		call UnitRemoveAbility(u,'A04R')
	endif
	call FixUnitSkillsBug(u)
	return RIX
endfunction
function RAX takes unit u, integer RIX returns nothing
	if RIX !='M107'then
		call UnitAddAbility(u,'A04R')
		call UnitAddAbility(u, RIX)
		call UnitRemoveAbility(u, RIX)
		call UnitRemoveAbility(u,'A04R')
	endif
	call FixUnitSkillsBug(u)
endfunction
function RNX takes unit triggerUnit returns integer
	local integer level = GetHeroLevel(triggerUnit)
	if level == 1 then
		return  100 
	elseif level == 2 then
		return  120
	elseif level == 3 then
		return $8C
	elseif level == 4 then
		return $A0
	elseif level == 5 then
		return $B4
	else
		return  100 * level -320
	endif
	return 0
endfunction
function IsObserverPlayer takes player p returns boolean
	return MW and(VKV == p or VLV == p)
endfunction

function RGX takes unit u, integer level returns nothing
	call SetUnitAbilityLevel(u,'A1NB', level)
	call SetUnitAbilityLevel(u,'A1NC', level)
	call SetUnitAbilityLevel(u,'A1ND', level)
	call SetUnitAbilityLevel(u,'A1NL', level)
	call SetUnitAbilityLevel(u,'A1NN', level)
	call SetUnitAbilityLevel(u,'A1NM', level)
	call SetUnitAbilityLevel(u,'A2IZ', level)
	call SetUnitAbilityLevel(u,'A2J0', level)
	call SetUnitAbilityLevel(u,'A2J1', level)
endfunction
function IsFamiliarsTypeId takes integer id returns boolean
	return id =='u014' or id =='u015' or id =='u016' or id =='u01D' or id =='u01E' or id =='u01F' or id =='u01R' or id =='u01S' or id =='u01T' or id =='u017' or id =='u019' or id =='u018' or id =='u01A' or id =='u01B' or id =='u01C' or id =='u01U' or id =='u01V' or id =='u01W'
endfunction
function IsTombstoneTypeId takes integer id returns boolean
	return id =='n0FJ' or id =='n0FI' or id =='n0F6' or id =='n0FH'
endfunction
function IsTombstoneUnit takes unit u returns boolean
	return IsTombstoneTypeId(GetUnitTypeId(u))
endfunction
function RLX takes unit u returns boolean
	local integer id = GetUnitTypeId(u)
	return id =='o018' or id =='o002' or id =='o00B' or id =='o01B'
endfunction
function RMX takes unit u returns boolean
	local integer id = GetUnitTypeId(u)
	return id =='n00Q' or id =='n00O' or id =='n00P' or id =='n00N'
endfunction
function RPX takes unit u returns boolean
	local integer id = GetUnitTypeId(u)
	return RLX(u) or RMX(u) or id =='otot'
endfunction
function RQX takes integer id returns boolean
	return id =='o00L' or id =='o00M' or id =='o00N' or id =='o00O'
endfunction
function RSX takes unit u returns boolean
	return RQX(GetUnitTypeId(u))
endfunction
function IsPhoenixSunTypeId takes integer id returns boolean
	return id =='h0CV' or id =='h0CX' or id =='h0CW'
endfunction
function RUX takes unit u returns boolean
	local integer id = GetUnitTypeId(u)
	return id =='o00V' or id =='o00T' or id =='o00W' or id =='o00U'
endfunction
function RWX takes unit u returns boolean
	local integer id = GetUnitTypeId(u)
	return id =='o000' or id =='o001' or id =='o00A' or id =='o00X' or id =='n12O'
endfunction
function RYX takes unit u returns boolean
	local integer id = GetUnitTypeId(u)
	return id =='o01C' or id =='o01D' or id =='o01E' or id =='osp4' or id =='o008' or id =='o009'
endfunction

function R_X takes unit u returns boolean
	return RSX(u) or RUX(u) or RWX(u) or RYX(u) or RPX(u)
endfunction
function R0X takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return i =='O017' or i =='QTW8' or i =='N0MA' or i =='N0MB' or i =='N0MC' or i =='N0MO' or IsFamiliarsTypeId(i) or OSX(u)
endfunction
function R1X takes integer i returns boolean
	return i =='u00S'
endfunction
function IsBeetleUnitTypeId takes integer i returns boolean
	return i =='u01K' or i =='u01H' or i =='u01J' or i =='u01L'
endfunction
function R3X takes integer i returns boolean
	return i =='h0CH' or i =='h0CF' or i =='h0C1' or i =='h0CG'
endfunction
function R4X takes unit u returns boolean
	return IsUnitType(u, UNIT_TYPE_SUMMONED) and IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER)== false and IsUnitType(u, UNIT_TYPE_RANGED_ATTACKER)== false
endfunction
function R5X takes unit u returns boolean
	return GetUnitAbilityLevel(u,'BOhx')> 0 or GetUnitAbilityLevel(u,'B00H')> 0
endfunction

// 获取技能的需求等级
function GetAbilityreqLevel takes integer id returns integer
	local integer i = 0
	if HaveSavedInteger(ObjectData, OBJ_HTKEY_ABILITY_REQLEVEL, id) then
		return LoadInteger(ObjectData, OBJ_HTKEY_ABILITY_REQLEVEL, id)
	else
		set i = S2I( GetObjectDataBySlk( id, "ability", "reqLevel" ) )
		call SaveInteger(ObjectData, OBJ_HTKEY_ABILITY_REQLEVEL, id, i)
		if i == null or i <= 0 then
			return 0
		endif
		return i
	endif
endfunction

function IsNotItemAbility takes integer abilityId returns boolean
	//local integer i = 1
	//loop
	//exitwhen i > EY
		//if T0V == VY[i]then
		return not LoadBoolean( ObjectData, OBJ_HTKEY_IS_ITEM_ABILITY, abilityId )	
		//	return false
		//endif
	//	set i = i + 1
	//endloop
	//return true
endfunction

// 是终极技能
function IsUltimateSkill takes integer id returns boolean
	if not IsNotItemAbility(id) then
		return false
	endif
	return GetAbilityreqLevel(id)== 6
endfunction

function GetAbilityTimerNumber takes unit u, integer id returns integer
	local integer abbb
	if not IsNotItemAbility(id) then
		return 0
	endif
	set abbb = PlayerSkillIndex[GetPlayerId(GetOwningPlayer(u))* 6 + 4]
	if not Mode__SixSkills then
		return 1
	else
		if id == HeroCommonSkills[abbb] then
			return 1
		elseif id == HeroUpgradeSkills[abbb] then
			return 2
		endif
	endif
	return 0
endfunction

function RefreshUnitAbilityCoolDownTimer takes unit u, integer id, real cd returns nothing
	if GetAbilityTimerNumber(u, id)== 1 then
		call TimerStart(ESV[GetPlayerId(GetOwningPlayer(u))], cd, false, null)
	elseif GetAbilityTimerNumber(u, id)== 2 then
		call TimerStart(ETV[GetPlayerId(GetOwningPlayer(u))], cd, false, null)
	endif
endfunction

//设置技能冷却
function Japi_SetUnitAbilityCoolDown1 takes unit u, integer id, real cd returns nothing
	if GetUnitAbilityLevel(u, id)== 0 or cd == 0.00 then
		return
	endif
	call YDWESetUnitAbilityState(u, id, 1, cd)
endfunction

//刷新技能冷却 直接为0
function Japi_ResetUnitAbilityCoolDownActions takes unit u, integer id returns nothing
	if id > 0 then
		call YDWESetUnitAbilityState(u, id, 1, 0)
		//if IsUltimateSkill(id) then
		//	call RefreshUnitAbilityCoolDownTimer(u, id, 0.00)
		//endif
	endif
endfunction

//刷新技能冷却为0 前置判断
function Japi_ResetUnitAbilityCoolDown takes unit u, integer id returns nothing
	local integer lv = GetUnitAbilityLevel(u, id)
	if lv > 0 then
		call Japi_ResetUnitAbilityCoolDownActions(u, id)
		if(id =='A0SB') and HaveSavedInteger(HY, GetHandleId(u), 4266) then
			call RemoveSavedInteger(HY, GetHandleId(u), 4266)
		endif
	endif
endfunction

function Japi_ReduceUnitAbilityCoolDownActions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer id = LoadInteger(HY, h, 1)
	local unit u = LoadUnitHandle(HY, h, 10)
	local real cd = YDWEGetUnitAbilityState(u, id, 1)
	local real reduce = LoadReal(HY, h, 2)
	if cd - reduce > 0 then
		call YDWESetUnitAbilityState(u, id, 1, cd - reduce)
		//call RefreshUnitAbilityCoolDownTimer(u, id, cd - reduce)
	else
		call YDWESetUnitAbilityState(u, id, 1, 0.00)
		//call RefreshUnitAbilityCoolDownTimer(u, id, 0.00)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set u = null
	return false
endfunction

//冷却时间减少 用于重生
function Japi_ReduceUnitAbilityCoolDown takes unit u, integer id, real reduce returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveInteger(HY, h, 1, id)
	call SaveReal(HY, h, 2, reduce)
	call SaveUnitHandle(HY, h, 10, u)
	call TriggerRegisterTimerEvent(t, 0.0, false)
	call TriggerAddCondition(t, Condition(function Japi_ReduceUnitAbilityCoolDownActions))
	set t = null
endfunction

//冷却时间缩减	会直接跳图标
function Japi_SetUnitAbilityCoolDown2 takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer id = LoadInteger(HY, h, 1)
	local integer lv = LoadInteger(HY, h, 2)
	local unit u = LoadUnitHandle(HY, h, 10)
	local real cd = LoadReal(W, id, lv)
	call YDWESetUnitAbilityDataReal(u, id, lv, 105, cd)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set u = null
	return false
endfunction

function Japi_SetUnitAbilityCoolDownReduceAction takes unit u, integer id, real cd returns nothing
	local trigger t
	local integer h
	local integer lv = GetUnitAbilityLevel(u, id)
	if cd > 0 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		//call RefreshUnitAbilityCoolDownTimer(u, id, cd) //刷新显示计时器cd
		call YDWESetUnitAbilityDataReal(u, id, lv, 105, cd)
		call SaveInteger(HY, h, 1, id)
		call SaveInteger(HY, h, 2, lv)
		call SaveUnitHandle(HY, h, 10, u)
		call TriggerRegisterTimerEvent(t, 0.0, false)
		call TriggerAddCondition(t, Condition(function Japi_SetUnitAbilityCoolDown2))
	endif
	set t = null
endfunction

//转图标正常
function Japi_SetUnitAbilityCoolDownReduce takes unit u, integer id, real reduce returns nothing
	local real cd
	local integer lv = GetUnitAbilityLevel(u, id)
	if HaveSavedReal(W, id, lv) then
		set cd = LoadReal(W, id, lv)
	else
		set cd = S2R(EXExecuteScript("(require'jass.slk').ability[" + I2S(id) + "].Cool" + I2S(lv) + " or 0"))
		call SaveReal(W, id, lv, cd)
	endif
	if cd > 0 then
		call Japi_SetUnitAbilityCoolDownReduceAction(u, id, cd * reduce)
	endif
endfunction

function TWE takes unit u, boolean TYE returns nothing
	local integer TPE
	local integer level
	local integer TZE
	local integer TME
	local integer xx
	local integer i
	set TME = GetPlayerId(GetOwningPlayer(u))
	set xx = 1
	if TYE then
		call TFE(u)
		return
	endif
	loop
		set TZE = PlayerSkillIndex[TME * HL + xx]
		set TPE = HeroCommonSkills[TZE]
		set i = TBE(TPE)
		if i > 0 and GetUnitAbilityLevel(u, RF[i])> 0 then
			set TPE = CF[i]
		endif
		if IsPassiveSkill[TZE]== false and LoadBoolean(P, 0, TPE)== false and TPE !='A1RK' and TPE !='A43H' and TPE !='A065' then
			call Japi_ResetUnitAbilityCoolDown(u, TPE)
		endif
		if TPE =='A0OO' then
			call Japi_ResetUnitAbilityCoolDown(u,'A300')
			call Japi_ResetUnitAbilityCoolDown(u,'A301')
		elseif TPE =='A0EY'then
			call Japi_ResetUnitAbilityCoolDown(u,'A0F0')
			call Japi_ResetUnitAbilityCoolDown(u,'A0FH')
		elseif TPE =='A21M'then
			call Japi_ResetUnitAbilityCoolDown(u,'A21N')
		elseif TPE =='A088'then
			call Japi_ResetUnitAbilityCoolDown(u,'A2KQ')
		endif
		set xx = xx + 1
	exitwhen xx > HL
	endloop
	if LoadInteger(K, GetHandleId(u),'DEVR')!= 0 then
		set U2 = u
		call ExecuteFunc("T_E")
	endif
	set u = null
endfunction

function IVX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local integer IEX = LoadInteger(HY, h, 36)
	local real IXX = LoadReal(HY, h, 20)
	call UnitDamageTargetEx(WUE, targetUnit, IEX, IXX)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function IOX takes unit WUE, unit targetUnit, integer DT, real IXX, real S7V returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 30,(targetUnit))
	call SaveInteger(HY, h, 36, DT)
	call SaveReal(HY, h, 20, IXX * 1.)
	call TriggerRegisterTimerEvent(t, S7V, false)
	call TriggerAddCondition(t, Condition(function IVX))
	set t = null
endfunction
function IRX takes player VBX, string EZX returns nothing
	local sound s = CreateSound(EZX, false, false, false, 10, 10, "DefaultEAXON")
	if(LocalPlayer== VBX) then
		call StartSound(s)
	endif
	call KillSoundWhenDone(s)
	set s = null
endfunction

function INX takes string f, boolean b returns nothing
	if b and f != "" and f != null then
		call ExecuteFunc(f)
	endif
endfunction

function EXRemoveHero takes unit whichUnit returns nothing
	call SaveBoolean(HY,(GetHandleId(whichUnit)), 38,(false))
	call FlushChildHashtable(HY,(GetHandleId(whichUnit)))
	call RemoveUnit(whichUnit)
endfunction
function IHX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(GetExpiredTimer())
	local unit u = LoadUnitHandle(HY, h, 26)
	call SetWidgetLife(u, GetWidgetLife(u)+ LoadReal(HY, h, 20))
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set u = null
	set t = null
endfunction
// 延迟0.秒再减免伤害
function UnitToDelaySetLife takes unit whichUnit, real IXX returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveReal(HY, h, 20, IXX * 1.)
	call SaveUnitHandle(HY, h, 26, whichUnit)
	call TimerStart(t, 0, false, function IHX)
	set t = null
endfunction

// 暴击漂浮文字 只会出现一次
function CriticalStrikeTextTag takes unit whichUnit, real damage returns nothing
	local texttag t = CreateTextTag()
	call SetTextTagText(t, I2S(R2I(damage)) + "!", 0.025)	//文字 字体大小
	call SetTextTagPos(t, GetUnitX(whichUnit), GetUnitY(whichUnit), GetUnitFlyHeight(whichUnit))	//高度偏移
	call SetTextTagColor(t, 255, 0, 0, 255)
	call SetTextTagVelocity(t, 0, .04)
	call SetTextTagFadepoint(t, 2) //淡入时间
	call SetTextTagPermanent(t, false)	//永久性
	call SetTextTagLifespan(t, 5) //生命周期
	call SetTextTagVisibility(t, UnitVisibleToPlayer(whichUnit, LocalPlayer))
	set t = null
endfunction

function ReduceDamageTextTag takes string s, real SYV, unit u, real ILX, real IMX, integer r, integer g, integer b, integer a returns nothing
	local texttag tt = CreateTextTag()
	call SetTextTagText(tt, s, ILX)
	call SetTextTagPosUnit(tt, u, IMX)
	call SetTextTagColor(tt, r, g, b, a)
	call SetTextTagVelocity(tt, 0, .0355)
	call SetTextTagFadepoint(tt, 2)
	call SetTextTagPermanent(tt, false)
	call SetTextTagLifespan(tt, SYV)
	if IsObserver then
		call SetTextTagVisibility(tt, true)
	else
		call SetTextTagVisibility(tt, false)
	endif
	set tt = null
endfunction
// 设置单位减免伤害值
function SetUnitToReduceDamage takes unit whichUnit, real reduceValue returns nothing
	local real maxLife = GetUnitState(whichUnit, UNIT_STATE_MAX_LIFE)
	local real currentLife = GetWidgetLife(whichUnit)
	if reduceValue < 0.1 then
		return
	endif
	if (GetWidgetLife(whichUnit)> .5) then
		if reduceValue > (maxLife - currentLife) then
			if reduceValue >= currentLife then
				call SetWidgetLife(whichUnit, maxLife)
				call UnitToDelaySetLife(whichUnit, reduceValue - (maxLife -currentLife) )
			else
				call UnitToDelaySetLife(whichUnit, reduceValue)
			endif
		else
			call SetWidgetLife(whichUnit, GetWidgetLife(whichUnit) + reduceValue)
		endif
	endif
	// call BJDebugMsg( "原伤害" +R2S(GetEventDamage())+" "+ GetUnitName(whichUnit) + "减免伤害:" + R2S(reduceValue))
	if MW then
		call ReduceDamageTextTag("+" + I2S(R2I(reduceValue)), 4, whichUnit, .028, 128, 0,$D8, 0,$D8)
	endif
endfunction
function ITX takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer hu = LoadInteger(HY, h, 0)
	call RemoveSavedHandle(HY, hu,'DmgD')
	call RemoveSavedInteger(HY, h, 0)
	call DestroyTrigger(t)
	set t = null
endfunction
function IUX takes unit u returns unit
	local trigger t = null
	local integer h
	local unit d = null
	set U2 = null
	if not IsUnitType(u, UNIT_TYPE_HERO) then
		if Player__Hero[GetPlayerId(GetOwningPlayer(u))] != null then
			set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
		else
			return CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
		endif
	endif
	if HaveSavedHandle(HY, GetHandleId(u),'DmgD') then
		call SetUnitX(LoadUnitHandle(HY, GetHandleId(u),'DmgD'), GetUnitX(u))
		call SetUnitY(LoadUnitHandle(HY, GetHandleId(u),'DmgD'), GetUnitY(u))
		return LoadUnitHandle(HY, GetHandleId(u),'DmgD')
	else
		set d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
		call UnitPauseTimedLife(d, true)
		call SaveUnitHandle(HY, GetHandleId(u),'DmgD', d)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterUnitEvent(t, d, EVENT_UNIT_DEATH)
		call TriggerAddCondition(t, Condition(function ITX))
		call SaveInteger(HY, h, 0, GetHandleId(u))
		set U2 = d
		set d = null
		set t = null
	endif
	return U2
endfunction
function IWX takes integer i returns unit
	call DisableTrigger(Y1)
	set E[i]= CreateUnit(Player(i),'e00E', 0, 0, 0)
	call EnableTrigger(Y1)
	return E[i]
endfunction
function IYX takes unit IZX returns unit
	local integer TME = GetPlayerId(GetOwningPlayer(IZX))
	if GetWidgetLife(E[TME])> 1 then
		return E[TME]
	endif
	return IWX(TME)
endfunction
function I_X takes unit u returns unit
	return IUX(u)
endfunction
function I0X takes unit WUE, location targetUnit returns real
	local real WYE = GetUnitX(WUE)
	local real WZE = GetUnitY(WUE)
	local real W_E = GetLocationX(targetUnit)
	local real W0E = GetLocationY(targetUnit)
	if WUE == null then
		return I2R($540BE3FF)
	else
		return SquareRoot((WYE -W_E)*(WYE -W_E)+(WZE -W0E)*(WZE -W0E))
	endif
	return 1.
endfunction
function I1X takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local real I2X = I2R(LoadInteger(HY, h, 0))
	local integer WOV = LoadInteger(HY, h, 1)
	local real x
	local real y
	local real dx
	local real dy
	local real radian
	local real ms
	local real d
	local real I4X = GetUnitDefaultMoveSpeed(u)+ I2R(U3V(u))
	local real I5X
	local integer I6X
	local integer c = LoadInteger(HY, h,-1)+ 1
	if WOV == 0 then
		set WOV = 9999
	endif
	set I5X = RMinBJ(I4X *(100. + I2X)/ 100., WOV)-GetUnitMoveSpeed(u)
	call SaveInteger(HY, h,-1, c)
	call SaveReal(K, GetHandleId(u), 99, R2I(I5X))
	if I5X > 0 and UnitAlive(u) then
		set x = GetUnitX(u)
		set y = GetUnitY(u)
		set dx = LoadReal(HY, h, 10)
		set dy = LoadReal(HY, h, 11)
		set d = GetDistanceBetween(dx, dy, x, y)
		if LoadBoolean(K, GetHandleId(u), 99)== false then
			set I6X = GetUnitCurrentOrder(u)
			if(d < 100  and d > 1) and I6X !=$D0019 and I6X !=$D0004 and I6X !=$D0005 then
				set radian = Atan2(y -dy, x -dx)
				set ms = I5X * YN
				call SaveReal(K, GetHandleId(u), 99, R2I(ms / YN))
				call SetUnitX(u, CoordinateX50(x + ms * Cos(radian)))
				call SetUnitY(u, CoordinateY50(y + ms * Sin(radian)))
			endif
		else
			call SaveBoolean(K, GetHandleId(u), 99, false)
		endif
		call SaveReal(HY, h, 10, GetUnitX(u))
		call SaveReal(HY, h, 11, GetUnitY(u))
	endif
	set t = null
	set u = null
endfunction
// 模拟移动 可突破522
function SetUnitImitateMoveSpeed takes unit u, integer I2X, integer WOV returns nothing
	local timer t
	local integer h
	if HaveSavedHandle(K, GetHandleId(u),'MVSP')== false then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, YN, true, function I1X)
		set RR = RR + 1
		call SaveUnitHandle(HY, h, 0, u)
		call SaveReal(HY, h, 10, GetUnitX(u))
		call SaveReal(HY, h, 11, GetUnitY(u))
		call SaveBoolean(HY, h, 100, true)
		call SaveTimerHandle(K, GetHandleId(u),'MVSP', t)
	else
		set t = LoadTimerHandle(K, GetHandleId(u),'MVSP')
		set h = GetHandleId(t)
	endif
	if I2X == LoadInteger(HY, h, 0) and WOV == LoadInteger(HY, h, 1) then
		set t = null
		return
	endif
	call SaveInteger(HY, h, 1, WOV)
	call SaveInteger(HY, h, 0, I2X)
	if I2X == 0 then
		call PauseTimer(t)
		set RR = RR -1
		call SaveReal(K, GetHandleId(u), 99, 0)
		call SaveBoolean(HY, h, 100, false)
	elseif LoadBoolean(HY, h, 100)== false then
		call TimerStart(t, YN, true, function I1X)
		set RR = RR + 1
		call SaveBoolean(HY, h, 100, true)
	endif
	set t = null
endfunction
function I8X takes unit u returns nothing
	call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MAX_MANA))
endfunction
function I9X takes nothing returns nothing
	call DisplayTimedTextToPlayer(GetEnumPlayer(), 0, 0, ZJ, HJ)
endfunction
function DisplayTimedTextToAllPlayer takes force AEX, real EHX, string AXX returns nothing
	if AEX == XY or AEX == bj_FORCE_ALL_PLAYERS then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, EHX, AXX)
		return
	endif
	set HJ = AXX
	set ZJ = EHX
	call ForForce(AEX, function I9X)
endfunction
function Y68 takes nothing returns nothing
	if S3[GetPlayerId(GetEnumPlayer())]then
		call DisplayTimedTextToPlayer(GetEnumPlayer(), 0, 0, ZJ, HJ)
	endif
endfunction
function AOX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call DestroyEffect((LoadEffectHandle(HY, h, 32)))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger((t))
	set t = null
	return false
endfunction
function AddSpecialEffectTargetToTimed takes string AIX, unit U6E, string AAX, real EHX returns nothing
	local effect fx = AddSpecialEffectTarget(AIX, U6E, AAX)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveEffectHandle(HY, h, 32,(fx))
	call TriggerRegisterDeathEvent(t, U6E)
	call TriggerRegisterTimerEvent(t, EHX, false)
	call TriggerAddCondition(t, Condition(function AOX))
	set fx = null
	set t = null
endfunction
function ANX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call DestroyEffect((LoadEffectHandle(HY, h, 32)))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger((t))
	set t = null
	return false
endfunction
function ABX takes string AIX, real x, real y, real EHX returns nothing
	local effect fx = AddSpecialEffect(AIX, x, y)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveEffectHandle(HY, h, 32,(fx))
	call TriggerRegisterTimerEvent(t, EHX, false)
	call TriggerAddCondition(t, Condition(function ANX))
	set fx = null
	set t = null
endfunction
function ACX takes unit U6E, integer UYV returns item
	local integer ADX = 0
	local item AFX
	loop
	exitwhen ADX == 6
		set AFX = UnitItemInSlot(U6E, ADX)
		if AFX != null and GetItemTypeId(AFX)== UYV then
			return AFX
		endif
		set ADX = ADX + 1
	endloop
	set AFX = null
	return null
endfunction
function DestroyTimerAndFlushHT_HY takes timer t returns nothing
	call PauseTimer(t)
	call FlushChildHashtable(HY,(GetHandleId(t)))
	call DestroyTimer(t)
endfunction

function AKX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	call DestroyLightning((LoadLightningHandle(HY, GetHandleId(t), 41)))
	call DestroyTimerAndFlushHT_HY(t)
	set t = null
endfunction
function AddLightningToTimed takes string AMX, real x1, real y1, real x2, real y2, real r, real g, real b, real a, real EHX returns nothing
	local timer t = CreateTimer()
	local lightning APX = AddLightning(AMX, true, x1, y1, x2, y2)
	call SetLightningColor(APX, r, g, b, a)
	call SaveLightningHandle(HY,(GetHandleId(t)), 41,(APX))
	call TimerStart(t, EHX, false, function AKX)
	set t = null
	set APX = null
endfunction
function AQX takes string s, real SYV, unit u, real ILX, real IMX, integer r, integer g, integer b, integer a returns nothing
	local texttag tt = CreateTextTag()
	call SetTextTagText(tt, s, ILX)
	call SetTextTagPosUnit(tt, u, IMX)
	call SetTextTagColor(tt, r, g, b, a)
	call SetTextTagVelocity(tt, 0, .0355)
	call SetTextTagFadepoint(tt, 2)
	call SetTextTagPermanent(tt, false)
	call SetTextTagLifespan(tt, SYV)
	if IsObserver then
		call SetTextTagVisibility(tt, true)
	else
		call SetTextTagVisibility(tt, false)
	endif
	set tt = null
endfunction
function CommonTextTag takes string ATX, real EHX, unit AUX, real AWX, integer r, integer g, integer b, integer a returns nothing
	local texttag tt = CreateTextTag()
	call SetTextTagText(tt, ATX, AWX)
	call SetTextTagPosUnit(tt, AUX, 64)
	call SetTextTagColor(tt, r, g, b, a)
	call SetTextTagVelocity(tt, 0, .0355)
	call SetTextTagFadepoint(tt, 2)
	call SetTextTagPermanent(tt, false)
	call SetTextTagLifespan(tt, EHX)
	call SetTextTagVisibility(tt, UnitVisibleToPlayer(AUX, LocalPlayer) or IsObserver)
	set tt = null
endfunction
function AYX takes player p, string ATX, real EHX, unit AUX, real AWX, integer r, integer g, integer b, integer a returns nothing
	local texttag tt = CreateTextTag()
	call SetTextTagText(tt, ATX, AWX)
	call SetTextTagPosUnit(tt, AUX, 64)
	call SetTextTagColor(tt, r, g, b, a)
	call SetTextTagVelocity(tt, 0, .0355)
	call SetTextTagFadepoint(tt, 2)
	call SetTextTagPermanent(tt, false)
	call SetTextTagLifespan(tt, EHX)
	call SetTextTagVisibility(tt, IsPlayerAlly(LocalPlayer, p) or IsObserver)
	set tt = null
endfunction
// 似乎是因为在1.24c之前直接写null会导致泄露
function TrueBoolexpr takes nothing returns boolean
	return true
endfunction
function TriggerRegisterPlayerUnitEventBJ takes trigger t, playerunitevent whichEvent returns nothing
	local integer i = 0
	loop
		call TriggerRegisterPlayerUnitEvent(t, Player(i), whichEvent, TrueBoolexprCondition)
		set i = i + 1
	exitwhen i == 16
	endloop
endfunction  
function A1X takes trigger t, playerunitevent whichEvent returns nothing
	local integer i = 1
	loop
	exitwhen i > 5
		call TriggerRegisterPlayerUnitEvent(t, Sentinels[i], whichEvent, TrueBoolexprCondition)
		call TriggerRegisterPlayerUnitEvent(t, Scourges[i], whichEvent, TrueBoolexprCondition)
		set i = i + 1
	endloop
endfunction
function A2X takes nothing returns nothing
	local destructable d = GetEnumDestructable()
	if IsTreeTypeId(GetDestructableTypeId(d)) and GetDestructableLife(d) > 0. then
		set P2 = P2 + 1
		call KillDestructable(d)
	endif
	set d = null
endfunction
function KillDestructablesInCircle takes real x, real y, real d returns integer
	call SetRect(RectDummy, x - d, y - d, x + d, y + d)
	set P2 = 0
	call EnumDestructablesInRect(RectDummy, null, function A2X)
	return P2
endfunction
function A4X takes real x, real y returns boolean
	return(not(IsTerrainPathable(x, y, PATHING_TYPE_WALKABILITY)))
endfunction
function PlaySoundAtPoint takes sound soundHandle, real x, real y returns nothing
	call SetSoundPosition(soundHandle, x, y, 0)
	call SetSoundVolume(soundHandle, 127)
	set bj_lastPlayedSound = soundHandle
	if(soundHandle != null) then
		call StartSound(soundHandle)
	endif
endfunction
function A7X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local fogmodifier f =(LoadFogModifierHandle(HY, h, 42))
	call FogModifierStop(f)
	call DestroyFogModifier(f)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set f = null
	return false
endfunction
function A8X takes player p, real EHX, real x, real y, real r returns nothing
	local trigger t = CreateTrigger()
	local fogmodifier fm = CreateFogModifierRadius(p, FOG_OF_WAR_VISIBLE, x, y, r, true, true)
	call FogModifierStart(fm)
	call SaveFogModifierHandle(HY,(GetHandleId(t)), 42,(fm))
	call TriggerRegisterTimerEvent(t, EHX, false)
	call TriggerAddCondition(t, Condition(function A7X))
	set fm = null
	set t = null
endfunction
function A9X takes nothing returns nothing
	call PauseUnit(GetEnumUnit(), true)
endfunction
function NVX takes nothing returns boolean
	local group g = LoginGroup(2)
	call GroupEnumUnitsInRange(g, 0, 0, 16000, TrueBoolexprCondition)
	call ForGroup(g, function A9X)
	call LogoutGroup(g)
	set g = null
	return false
endfunction
function NEX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function NVX))
	call TriggerEvaluate(t)
	set t = null
endfunction
function NXX takes nothing returns nothing
	local integer TME = GetPlayerId(GetTriggerPlayer())
	local integer i = 1
	local integer level
	local unit u = Player__Hero[TME]
	if u != null and UnitAlive(u) then
		loop
			set level = GetUnitAbilityLevel(u, PassiveSkills_Learned[i])
			if level == 0 then
				set level = GetUnitAbilityLevel(u, PassiveSkills_Show[i])
			endif
			if level == 0 and(GetUnitAbilityLevel(u, PassiveSkills_Real[i])> 0 or GetUnitAbilityLevel(u, PassiveSkills_SpellBook[i])> 0) then
				call UnitRemoveAbility(u, PassiveSkills_Real[i])
				call UnitRemoveAbility(u, PassiveSkills_SpellBook[i])
				call UnitRemoveAbility(u, PassiveSkills_Buff[i])
				call UnitRemoveAbility(u, PassiveSkills_Show[i])
			endif
			set i = i + 1
		exitwhen i > MaxPassiveSkillsNum
		endloop
	endif
	set u = null
endfunction



function NOX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit
	local unit WUE
	local real NRX
	local unit NIX
	local real x
	local real y
	local real W_E
	local real W0E
	local real NAX
	local real NNX
	local real NBX
	local real NCX
	local boolean NDX
	local real NFX
	local real NGX
	if GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT then
		if IsBlinkAbilityId(GetSpellAbilityId()) then
			call SaveBoolean(HY, h,-1, true)
			call SaveReal(HY, h,-1, GetUnitX(GetTriggerUnit()))
			call SaveReal(HY, h,-2, GetUnitY(GetTriggerUnit()))
		endif
	else
		set targetUnit = LoadUnitHandle(HY, h, 30)
		set WUE = LoadUnitHandle(HY, h, 43)
		set NRX =(LoadReal(HY, h, 44))
		set NIX =(LoadUnitHandle(HY, h, 45))
		set x = GetUnitX(NIX)
		set y = GetUnitY(NIX)
		set W_E = GetUnitX(targetUnit)
		set W0E = GetUnitY(targetUnit)
		set NAX = NRX * .03
		if(LoadBoolean(HY, h,-1)) then
			set W_E = LoadReal(HY, h,-1)
			set W0E = LoadReal(HY, h,-2)
		endif
		set NNX = AngleBetweenXY(x, y, W_E, W0E)
		set NBX = x + NAX * Cos(NNX * bj_DEGTORAD)
		set NCX = y + NAX * Sin(NNX * bj_DEGTORAD)
		call SetUnitX(NIX, NBX)
		call SetUnitY(NIX, NCX)
		call EXSetUnitFacing(NIX, NNX)
		if UnitIsDead(targetUnit) then
			call KillUnit(NIX)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		elseif GetDistanceBetween(W_E, W0E, NBX, NCX)<= NAX then
			call KillUnit(NIX)
			set U2 = WUE
			set W2 = targetUnit
			if LoadBoolean(HY, h,-1)== false then
				if HaveSavedString(HY, h, 46) then
					call ExecuteFunc(LoadStr(HY, h, 46))
				endif
			endif
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set targetUnit = null
	set WUE = null
	set NIX = null
	return false
endfunction
function NHX takes unit WUE, unit targetUnit, integer NJX, string NKX, real NRX, boolean NLX returns trigger
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real WYE = GetUnitX(WUE)
	local real WZE = GetUnitY(WUE)
	local real NMX = GetUnitFacing(WUE)
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function NOX))
	call SaveReal(HY, h, 44,((NRX)* 1.))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))
	call SaveStr(HY, h, 46,(NKX))
	call SaveUnitHandle(HY, h, 43,((WUE)))
	call SaveBoolean(HY, h,-1, false)
	if NLX then
		call SaveReal(HY, h,-1, 0)
		call SaveReal(HY, h,-2, 0)
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_SPELL_EFFECT)
	endif
	if IsUnitOwnedByPlayer(WUE, BW) then
		call SaveUnitHandle(HY, h, 45,(CreateUnit(GetOwningPlayer(WUE), NJX, WYE, WZE, NMX)))
	else
		call SaveUnitHandle(HY, h, 45,(CreateUnit(GetOwningPlayer(targetUnit), NJX, WYE, WZE, NMX)))
	endif
	set V3 = t
	set t = null
	return V3
endfunction

// 暂不考虑抛物线 仅做平面位移
function EffectMissileMoveCallBack takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId( trig )
	local unit targetUnit = LoadUnitHandle( HY, h, 1 )
	local effect missileEffect = LoadEffectHandle( HY, h, 10 )
	local real targetX = GetUnitX( targetUnit )
	local real targetY = GetUnitY( targetUnit )
	local real missileX = EXGetEffectX( missileEffect )
	local real missileY = EXGetEffectY( missileEffect )
	local real radian = RadianBetweenXY( missileX, missileY, targetX, targetY )
	local real angle = radian * bj_RADTODEG
	local real speed = LoadReal( HY, h , 20 )

	// 通过移动点来获取目标点Z轴

	if IsUnitInRangeXY( targetUnit, missileX, missileY, speed ) or not UnitAlive(targetUnit) then
		call EXEffectMatReset( missileEffect )
		call EXEffectMatRotateZ( missileEffect, angle )
		call MoveLocation( Temp__Location, targetX, targetY )
		call EXSetEffectZ( missileEffect, LoadReal( HY, h, 22 ) + GetLocationZ( Temp__Location ) )
		call EXSetEffectXY( missileEffect, targetX, targetY )
		call DestroyEffect( missileEffect )
		if LoadStr( HY, h, 30 ) != null then
			set Temp__ArrayUnit[0] = LoadUnitHandle( HY, h, 0 )
			set Temp__ArrayUnit[1] = targetUnit
			call ExecuteFunc( LoadStr( HY, h, 30 ) )
		endif
		call FlushChildHashtable( HY, h )
		call CleanCurrentTrigger( trig )
	else
		set missileX = CoordinateX75( missileX + speed * Cos( radian ) )
		set missileY = CoordinateY75( missileY + speed * Sin( radian ) )
		call MoveLocation( Temp__Location, missileX, missileY )
		// 移动过远重置特效 特效如果超出镜头中心 则不会渲染
		if GetDistanceBetween( LoadReal( HY, h, 40 ), LoadReal( HY, h, 41 ), missileX, missileY ) > 400 then
			call EXSetEffectZ( missileEffect, -9999 )
			call DestroyEffect( missileEffect )
			set missileEffect = AddSpecialEffect( LoadStr( HY, h, 23) , missileX, missileY )
			call SaveEffectHandle( HY, h, 10, missileEffect )
			call SaveReal( HY, h, 40, missileX )
			call SaveReal( HY, h, 41, missileY )
		else
			call EXEffectMatReset( missileEffect )
			call EXEffectMatRotateZ( missileEffect, angle )
			call EXSetEffectXY( missileEffect, missileX, missileY ) 
		endif
		call EXSetEffectZ( missileEffect, LoadReal( HY, h, 22 ) + GetLocationZ( Temp__Location ) )

	endif

	set missileEffect = null
	set targetUnit = null
	set trig = null
	return false
endfunction

// 发射一个特效
function UnitLaunchesMissileToTarget takes unit whichUnit, unit targetUnit, string modelName, real speed, real arc, real height, string callback returns nothing
	local integer h = CreateTimerEventTrigger( 0.02, true, function EffectMissileMoveCallBack )
	local real startX = GetUnitX( whichUnit )
	local real startY = GetUnitY( whichUnit )
	local effect missileEffect = AddSpecialEffect( modelName, startX, startY )
	local real angle = AngleBetweenXY( startX, startY, GetUnitX( targetUnit ), GetUnitY( targetUnit ) )
	call SaveUnitHandle( HY, h, 0, whichUnit )
	call SaveUnitHandle( HY, h, 1, targetUnit )
	call SaveEffectHandle( HY, h, 10, missileEffect )

	call SaveReal( HY, h, 20, speed * 0.02 )
	call SaveReal( HY, h, 21, arc )
	call SaveReal( HY, h, 22, height )
	call SaveStr( HY, h, 23, modelName )
	call SaveStr( HY, h, 30, callback )

	call SaveReal( HY, h, 40, startX )
	call SaveReal( HY, h, 41, startY )

	call EXEffectMatRotateZ( missileEffect, angle )
	call EXSetEffectZ( missileEffect, height + EXGetEffectZ( missileEffect ) )
	set missileEffect = null
endfunction

// 模型缩放时间到期 删除Buff
function SetUnitModelScaleByDuration__Remove takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local unit whichUnit = LoadUnitHandle(HY, h, 1)
	local real fixScale
	local trigger addTrig = null
	local trigger reduceTrig = null
	local timer tempTimer = null
	// 缩放触发器
	set addTrig = LoadTriggerHandle( HY, h, 30 )
	set reduceTrig = LoadTriggerHandle( HY, h, 31 )
	if addTrig == null and reduceTrig == null then
		// 常规状态, 清空缩放和计时器
		set fixScale = LoadReal( HY, h, 20 )
		call SetUnitCurrentScaleEx( whichUnit, GetUnitCurrentScale(whichUnit) - fixScale )
		set tempTimer = LoadTimerHandle( HY, h, 41 )
		call FlushChildHashtable( HY, GetHandleId( tempTimer ) )
		call DestroyTimer( tempTimer )
	endif
	if addTrig != null then
		// 放大状态
		set fixScale = LoadReal( HY, GetHandleId( addTrig ), 0 )
		call SetUnitCurrentScaleEx( whichUnit, GetUnitCurrentScale(whichUnit) - fixScale )
		// 修正缩放 然后删除放大触发
		set tempTimer = LoadTimerHandle( HY, h, 41 )
		call FlushChildHashtable( HY, GetHandleId( tempTimer ) )
		call DestroyTimer( tempTimer )
		set tempTimer = null
		call FlushChildHashtable( HY, GetHandleId( addTrig ) )
		call CleanCurrentTrigger( addTrig )
		set addTrig = null
	endif
	if reduceTrig != null then
		// 缩小状态
		set fixScale = LoadReal( HY, GetHandleId( reduceTrig ), 0 )
		call SetUnitCurrentScaleEx( whichUnit, GetUnitCurrentScale(whichUnit) - fixScale )
		// 修正缩放 然后删除缩小触发
		call FlushChildHashtable( HY, GetHandleId( reduceTrig ) )
		call CleanCurrentTrigger( reduceTrig )
		set reduceTrig = null
	endif
	call DestroyTimer( LoadTimerHandle( HY, h, 40 ) ) // 持续时间计时器
	// 清除key
	call RemoveSavedHandle( ExtraHT, GetHandleId( whichUnit ), LoadInteger( HY, h, 10 ) )
	// debug call SingleDebug( "移除Buff 当前缩放" + R2S( GetUnitCurrentScale(whichUnit) ) + " key " + I2S( LoadInteger( HY, h, 10 ) ) + GetUnitName( whichUnit ) )
	call FlushChildHashtable( HY, h )
	call CleanCurrentTrigger( trig )

	set trig = null
	set whichUnit = null

	return false
endfunction

// 减少模型大小
function SetUnitModelScaleReduce__CallBack takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer iEvalCount = GetTriggerEvalCount(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 1)
	local real addScale = LoadReal( HY, h, 20 )
	local real currentScale = LoadReal(HY, h, 0 )
	if iEvalCount > 40 then
		call SetUnitCurrentScaleEx( whichUnit, GetUnitCurrentScale(whichUnit) )
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set currentScale = currentScale - addScale
		call SaveReal( HY, h, 0, currentScale )
		call SetUnitCurrentScaleEx(whichUnit, GetUnitCurrentScale(whichUnit) - addScale)
	endif
	set t = null
	set whichUnit = null
	return false
endfunction

function SetUnitModelScaleReduce takes nothing returns nothing
	local timer expiredTimer = GetExpiredTimer()
	local integer h = GetHandleId( expiredTimer )
	local trigger reduceTrig = CreateTrigger()
	local real addScale = LoadReal( HY, h, 20 )
	local integer removeTrigId = LoadInteger( HY, h, 10 )
	local unit whichUnit = LoadUnitHandle( HY, h, 1 )

	call RemoveSavedHandle( HY, removeTrigId, 41 )
	call SaveTriggerHandle( HY, removeTrigId, 31, reduceTrig )
	call FlushChildHashtable( HY, h )
	call DestroyTimer( expiredTimer )
	set expiredTimer = null

	set h = GetHandleId( reduceTrig )
	call TriggerRegisterTimerEvent( reduceTrig, .025, true )
	call TriggerAddCondition( reduceTrig, Condition(function SetUnitModelScaleReduce__CallBack) )
	call SaveReal( HY, h, 20, addScale )
	call SaveReal( HY, h, 0, addScale * 40 )
	call SaveUnitHandle( HY, h, 1, whichUnit )

	set whichUnit = null
	set reduceTrig = null

endfunction

// 增加模型大小
function SetUnitModelScaleAdd__CallBack takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId( trig )
	local integer iEvalCount = GetTriggerEvalCount( trig )
	local unit whichUnit = LoadUnitHandle( HY, h, 1 ) 
	local real addScale = LoadReal( HY, h, 20 )
	local real currentScale = LoadReal( HY, h, 0 )
	local timer durationTimer = null
	// 0.025 * 40   1秒内完成缩放
	if iEvalCount > 40 then
		// 缩放结束
		set durationTimer = CreateTimer()
		call TimerStart( durationTimer, LoadReal( HY, h, 21 ) - 2, false, function SetUnitModelScaleReduce )
		call SaveTimerHandle( HY, LoadInteger( HY, h, 10 ), 41, durationTimer ) // 将计时器存入移除触发器
		call RemoveSavedHandle( HY, LoadInteger( HY, h, 10 ), 30 )
		call SaveReal( HY, GetHandleId( durationTimer ), 20, LoadReal( HY, h, 20 ) ) // 存入变大缩放值
		call SaveInteger( HY, GetHandleId( durationTimer ), 10, LoadInteger( HY, h, 10 ) ) // 存入移除触发器句柄
		call SaveUnitHandle( HY, GetHandleId( durationTimer ), 1, whichUnit ) // 存入单位

		call SetUnitCurrentScaleEx( whichUnit, GetUnitCurrentScale(whichUnit) )
		call FlushChildHashtable( HY, h )
		call CleanCurrentTrigger( trig )
		set durationTimer = null
	else
		set currentScale = currentScale + addScale
		call SaveReal( HY, h, 0, currentScale )
		call SetUnitCurrentScaleEx( whichUnit, GetUnitCurrentScale(whichUnit) + addScale )
	endif
	set trig = null
	set whichUnit = null
	return false
endfunction

// 缩放单位模型
// 添加Buff - 增大缩放 - 结束前1秒减小缩放 - 移除Buff
// 死亡或驱散 - 触发移除Buff触发器 
function AddUnitModelScalePercentByDuration takes unit whichUnit, real duration, real addScale, integer buffId, integer key returns nothing
	local trigger addTrig = null
	local integer h
	local real realScale = addScale * GetUnitModelScale(whichUnit)
	local real targetTime = duration + GetGameTime()
	local timer durationTimer = null
	local trigger removeTrig = null

	local real addValue = addScale * 0.025 // 计时器每次增加的数值
	// 是以基础模型大小的倍数增加
	if not HaveSavedHandle( ExtraHT, GetHandleId(whichUnit), key ) then
		// 没存触发器 添加效果

		set durationTimer = CreateTimer()
		set removeTrig = CreateTrigger()
		if duration > 3 then
			set addTrig = CreateTrigger()
			// 40 * 0.025 为 1秒缩放时间
			call TriggerRegisterTimerEvent( addTrig, .025, true )
			call TriggerAddCondition(addTrig, Condition(function SetUnitModelScaleAdd__CallBack))
			set h = GetHandleId( addTrig )
			call SaveInteger( HY, h, 10, GetHandleId( removeTrig ) ) // 存入移除触发器
			call SaveInteger( HY, h, 11, buffId )
			call SaveUnitHandle( HY, h, 1, whichUnit )
			call SaveReal( HY, h, 20, addValue * 1. ) // 计时器每次增加的缩放大小
			call SaveReal( HY, h, 21, duration ) // 持续时间
		else // 如果时间太短来不及变大变小, 那就直接瞬间改变
			call SetUnitScale(whichUnit, realScale, realScale, realScale)
		endif

		call TimerStart( durationTimer, duration, false, null )
		call TriggerRegisterTimerExpireEvent( removeTrig, durationTimer )
		call TriggerRegisterDeathEvent( removeTrig, whichUnit )
		call TriggerAddCondition( removeTrig, Condition(function SetUnitModelScaleByDuration__Remove) )

		// 传参
		set h = GetHandleId( removeTrig )
		call SaveUnitHandle( HY, h, 1, whichUnit )
		call SaveInteger( HY, h, 10, key )
		call SaveInteger( HY, h, 11, buffId )
		call SaveReal( HY, h, 20, addScale * 1. )
		//call SaveReal( HY, h, 21, targetTime )

		// ========================================
		call SaveTriggerHandle( HY, h, 30, addTrig )
		call SaveTimerHandle( HY, h, 40, durationTimer )

		// 将触发器绑定在单位身上
		call SaveTriggerHandle( ExtraHT, GetHandleId( whichUnit ), key, removeTrig )

		// debug call SingleDebug( "添加Buff 持续时间" + R2S( duration ) )
	else
		// 这个覆盖或者叠加之类的机制对缩放更改来说很尴尬
		// 想了一堆办法 最后决定还是不管缩放只管持续时间 毕竟暴雪原版嗜血也是这个尿性
		// debug call SingleDebug( "覆盖Buff 持续时间" + R2S( duration ) )
		set removeTrig = LoadTriggerHandle( ExtraHT, GetHandleId(whichUnit), key )
		set h = GetHandleId( removeTrig )
		set durationTimer = LoadTimerHandle( HY, h, 40 )
		if TimerGetRemaining( durationTimer ) < duration then
			// 如果buff的剩余时间 小于此次buff持续时间 就重置持续时间
			call TimerStart( durationTimer, duration, false, null )
			if HaveSavedHandle( HY, h, 41 ) then
				call TimerStart( LoadTimerHandle( HY, h, 41 ), duration - 2, false, function SetUnitModelScaleReduce )
			endif
		endif
	endif
	set removeTrig = null
	set durationTimer = null
endfunction

function N_X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 14))
	local integer id =(LoadInteger(HY, h, 52))
	if u != null then
		call UnitRemoveAbility(u, id)
		call UnitRemoveAbility(u, 'B041')
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set u = null
	return false
endfunction
function N1X takes unit u, integer id, real time returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call UnitAddPermanentAbility(u, id)
	call TriggerRegisterTimerEvent(t, time, false)
	call TriggerAddCondition(t, Condition(function N_X))
	call SaveUnitHandle(HY, h, 14,(u))
	call SaveInteger(HY, h, 52,(id))
	set t = null
endfunction
function N2X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WLE = LoadUnitHandle(HY, h, 30)
	local unit WJE = LoadUnitHandle(HY, h, 43)
	local real N3X = LoadReal(HY, h, 44)
	local unit N4X = LoadUnitHandle(HY, h, 45)
	local real xp = GetUnitX(N4X)
	local real yp = GetUnitY(N4X)
	local real xt = GetUnitX(WLE)
	local real yt = GetUnitY(WLE)
	local real N5X = N3X * .03
	local real radian = AngleBetweenXY(xp, yp, xt, yt)
	local real dx = xp + N5X * Cos(radian * bj_DEGTORAD)
	local real dy = yp + N5X * Sin(radian * bj_DEGTORAD)
	call SetUnitX(N4X, dx)
	call SetUnitY(N4X, dy)
	call SetUnitFacing(N4X, radian)
	if UnitIsDead(WLE) then
		call KillUnit(N4X)
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	elseif GetDistanceBetween(xt, yt, dx, dy)<= N5X then
		call KillUnit(N4X)
		set YG = WJE
		set ZG = WLE
		call ExecuteFunc(LoadStr(HY, h, 46))
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	endif
	set t = null
	set WLE = null
	set N4X = null
	set WJE = null
	return false
endfunction
function N6X takes unit WJE, unit WLE, integer N4X, string N7X, real N3X returns trigger
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x = GetUnitX(WJE)
	local real y = GetUnitY(WJE)
	local real angle = GetUnitFacing(WJE)
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function N2X))
	call SaveReal(HY, h, 44, N3X)
	call SaveUnitHandle(HY, h, 30, WLE)
	call SaveStr(HY, h, 46, N7X)
	call SaveUnitHandle(HY, h, 43, WJE)
	call SaveUnitHandle(HY, h, 45, CreateUnit(GetOwningPlayer(WJE), N4X, x, y, angle))
	set VH = t
	set t = null
	return VH
endfunction
function N9X takes nothing returns nothing
	set bj_groupCountUnits = bj_groupCountUnits + 1
endfunction
function BVX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local fogmodifier fm =(LoadFogModifierHandle(HY, h, 42))
	call FogModifierStop(fm)
	call DestroyFogModifier(fm)
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
	set fm = null
endfunction
function BEX takes fogmodifier fm, real EHX returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call FogModifierStart(fm)
	call SaveFogModifierHandle(HY, h, 42, fm)
	call TimerStart(t, EHX, false, function BVX)
	set t = null
endfunction
function BXX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer BOX = LoadInteger(HY, h, 55)
	local destructable d = V3X(BOX)
	if d != null then
		call RemoveDestructable(d)
	endif
	call V4X(BOX)
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set d = null
	set t = null
endfunction
function BRX takes destructable d, real S7V returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, S7V, false, function BXX)
	call SaveInteger(HY, h, 55, V5X(d))
	set t = null
endfunction
function BIX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call SetUnitAnimation(LoadUnitHandle(HY, h, 53), "stand")
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
endfunction
function BAX takes unit u, real EHX returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 53, u)
	call TimerStart(t, EHX, false, function BIX)
	set t = null
endfunction
function BNX takes real EHX, boolean BBX, real x, real y, real BCX, real BDX, real BFX, real BGX, real BHX returns nothing
	local real BJX
	local real BKX
	local real BLX
	if(BDX <= 0 or BHX <= 0 or BGX <= 0) then
		return
	endif
	set BKX = 2. * EHX / BGX
	set BJX = 2. * BDX / BHX
	set BLX = BCX / BDX
	call TerrainDeformRipple(x, y, BDX, BFX, R2I(EHX *1000), 1, BJX, BKX, BLX, BBX)
endfunction
function BMX takes player p, unit u, integer g returns nothing
	local texttag t
	local string s = ""
	local boolean b = LocalPlayer== p
	local boolean bb = IsObserver
	set g = AddPlayerResourceGold(p, g)
	set t = CreateTextTag()
	if GetHandleId(t)> 0 then
		call SetTextTagText(t, "+" + I2S(g), .025)
		call SetTextTagPosUnit(t, u,-0.4)
		if bb then
			call SetTextTagColorBJ(t, VQV[GetPlayerId(p)], VSV[GetPlayerId(p)], VTV[GetPlayerId(p)], 15)
		else
			call SetTextTagColor(t, 255,$DC, 0, 255)
		endif
		call SetTextTagVelocity(t, 0, .03)
		call SetTextTagVisibility(t, b)
		call SetTextTagFadepoint(t, 2)
		call SetTextTagLifespan(t, 3)
		call SetTextTagPermanent(t, false)
	else
		call DestroyTextTag(t)
	endif
	if b or bb then
		set s = "UI\\Feedback\\GoldCredit\\GoldCredit.mdl"
	endif
	call DestroyEffect(AddSpecialEffectTarget(s, u, "overhead"))
	set t = null
endfunction
function BPX takes nothing returns boolean
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call FlushChildHashtable(HY,(GetHandleId((LoadUnitHandle(HY, h, 26)))))
	call ShowUnit(LoadUnitHandle(HY, h, 26), false)
	call RemoveUnit(LoadUnitHandle(HY, h, 26))
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
	return false
endfunction
function BQX takes unit u, real d returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, d, false, function BPX)
	call SaveUnitHandle(HY, h, 26, u)
	set t = null
endfunction
function BSX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call RemoveUnit((LoadUnitHandle(HY, h, 26)))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function BTX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call KillUnit((LoadUnitHandle(HY, h, 26)))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function BUX takes unit u, real d returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, d, false)
	call TriggerAddCondition(t, Condition(function BTX))
	call SaveUnitHandle(HY, h, 26,(u))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, d + .01, false)
	call TriggerAddCondition(t, Condition(function BSX))
	call SaveUnitHandle(HY, h, 26,(u))
	set t = null
endfunction
function BWX takes sound A6X returns nothing
	if A6X != null then
		if T3[LocalId]== false then
			call StartSound(A6X)
		endif
	endif
endfunction
function BYX takes sound A6X, player BZX returns nothing
	if LocalPlayer== BZX and T3[GetPlayerId(BZX)]== false then
		call StartSound(A6X)
	endif
endfunction
function B_X takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit()))== false))
endfunction
function B0X takes nothing returns nothing
	call BYX(WJ, GetOwningPlayer(GetEnumUnit()))
endfunction
function B1X takes unit WUE, sound A6X, real x, real y, real r returns nothing
	local group g = LoginGroup(3)
	set U2 = WUE
	set WJ = A6X
	call GroupEnumUnitsInRange(g, x, y, r, Condition(function B_X))
	call GroupRemoveUnit(g, WUE)
	call ForGroup(g, function B0X)
	call LogoutGroup(g)
	set g = null
endfunction
function B2X takes unit U6E, item UWV returns integer
	local integer i = 0
	loop
	exitwhen i > 5
		if UnitItemInSlot(U6E, i)== UWV then
			return i
		endif
		set i = i + 1
	endloop
	return -1
endfunction
function B3X takes real n1, real n2 returns integer
	if n1 / n2 -R2I(n1 / n2)>= .5 then
		return R2I(n1 / n2)+ 1
	endif
	return R2I(n1 / n2)
endfunction
function B4X takes player p returns nothing //esc清屏
	if LocalPlayer== p then
		call ClearTextMessages()
		//call DzFrameShow( UIFrame__Text[1], false )
	endif
endfunction
function NotLethalLifeRemoved takes unit u, real d returns nothing
	call SetWidgetLife(u, RMaxBJ(GetWidgetLife(u)-d, 1))
endfunction
function B6X takes integer B7X returns nothing
	call RemoveUnit(CreateUnit(NeutralPassivePlayer, B7X, 0, 0, 0))
endfunction
function B8X takes player p, integer Y_E, unit u returns nothing
	local texttag t = CreateTextTag()
	local string s = "UI\\Feedback\\GoldCredit\\GoldCredit.mdl"
	set Y_E = AddPlayerResourceGold(p, Y_E)
	call SetTextTagText(t, "+" + I2S(Y_E), .025)
	call SetTextTagPosUnit(t, u, 0)
	call SetTextTagColor(t, 255,$DC, 0, 255)
	call SetTextTagVelocity(t, 0, .03)
	if LocalPlayer!= p then
		set s = ""
	endif
	call SetTextTagVisibility(t, LocalPlayer== p)
	if GetWidgetLife(u)> .5 then
		call DestroyEffect(AddSpecialEffectTarget(s, u, "overhead"))
	endif
	call SetTextTagFadepoint(t, 2)
	call SetTextTagLifespan(t, 3)
	call SetTextTagPermanent(t, false)
	set t = null
endfunction
function B9X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer CVX =(LoadInteger(HY, h, 59))
	if UnitRemoveAbility(targetUnit, CVX) or GetUnitAbilityLevel(targetUnit, CVX)== 0 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function CEX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer CVX =(LoadInteger(HY, h, 59))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	if UnitRemoveAbility(targetUnit, CVX)== false then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DEATH)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function B9X))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SaveInteger(HY, h, 59,(CVX))
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function CXX takes unit targetUnit, integer CVX, integer level, real EHX returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call UnitAddPermanentAbility(targetUnit, CVX)
	call SetUnitAbilityLevel(targetUnit, CVX, level)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterTimerEvent(t, EHX, false)
	call TriggerAddCondition(t, Condition(function CEX))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 59,(CVX))
	set t = null
endfunction
function COX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer CVX =(LoadInteger(HY, h, 59))
	local integer CRX =(LoadInteger(HY, h, 59))
	call UnitRemoveAbility(targetUnit, CRX)
	if UnitRemoveAbility(targetUnit, CVX) or GetUnitAbilityLevel(targetUnit, CVX)== 0 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function CIX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer T0V =(LoadInteger(HY, h, 59))
	local integer CAX =(LoadInteger(HY, h, 60))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call UnitRemoveAbility(targetUnit, CAX)
	if UnitRemoveAbility(targetUnit, T0V)== false then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DEATH)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function COX))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SaveInteger(HY, h, 59,(T0V))
		call SaveInteger(HY, h, 60,(CAX))
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function CNX takes unit targetUnit, integer T0V, integer level, real SYV, integer CAX returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call UnitAddPermanentAbility(targetUnit, T0V)
	call SetUnitAbilityLevel(targetUnit, T0V, level)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterTimerEvent(t, SYV, false)
	call TriggerAddCondition(t, Condition(function CIX))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 59,(T0V))
	call SaveInteger(HY, h, 60,(CAX))
	set t = null
endfunction
function UnitAddAbilityTimedEx_RemoveFix takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 17)
	local integer CAX = LoadInteger(HY, h, 60)
	local integer T0V = LoadInteger(HY, h, 59)
	call UnitRemoveAbility(u, T0V)
	if UnitRemoveAbility(u, CAX) or GetUnitAbilityLevel(u, CAX)== 0 then
		call RemoveSavedHandle(P, GetHandleId(u), 0 -T0V)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	return false
endfunction
function CBX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 17)
	local integer T0V = LoadInteger(HY, h, 59)
	local integer CAX = LoadInteger(HY, h, 60)
	local timer tt = LoadTimerHandle(HY, h, 10)
	call SaveBoolean(HY, h, 0, true)
	call UnitRemoveAbility(u, CAX)
	call UnitRemoveAbility(u, T0V)
	if GetUnitAbilityLevel(u, T0V)== 0 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call DestroyTimer(tt)
		call RemoveSavedHandle(P, GetHandleId(u), 0 -T0V)
	else
		call TimerStart(tt, 1, true, null)
	endif
	set u = null
	set t = null
	return false
endfunction
function AddAbilityToTimed takes unit u, integer T0V, integer level, real SYV, integer CAX returns nothing
	local trigger t
	local integer h
	local real CDX
	//local real ndur = GetGameTime()+ SYV
	local timer tt
	if not UnitAlive(u) then
		return
	endif
	if HaveSavedHandle(P, GetHandleId(u), 0 -T0V) then
		set t = LoadTriggerHandle(P, GetHandleId(u), 0 -T0V)
		set h = GetHandleId(t)
		set tt = LoadTimerHandle(HY, h, 10)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		set tt = CreateTimer()
		call FlushChildHashtable(HY, h)
		call SaveUnitHandle(HY, h, 17, u)
		call SaveInteger(HY, h, 59, T0V)
		call SaveInteger(HY, h, 60, CAX)
		call SaveReal(HY, h, 0, 0)
		call TriggerRegisterDeathEvent(t, u)
		call SaveTimerHandle(HY, h, 10, tt)
		call TriggerRegisterTimerExpireEvent(t, tt)
		call TriggerAddCondition(t, Condition(function CBX))
		call SaveTriggerHandle(P, GetHandleId(u), 0 -T0V, t)
	endif
	call RemoveSavedBoolean(HY, h, 0)
	set CDX = TimerGetRemaining(tt)
	if CDX < SYV then
		call TimerStart(tt, SYV, false, null)
	endif
	set t = null
	set tt = null
	call UnitAddPermanentAbilitySetLevel(u, T0V, level)
endfunction

function PasSkillCoolDownTimer takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local player p = LoadPlayerHandle(HY, h, 1)
	if not SPCDB[GetPlayerId(p)] then
		call SetPlayerAbilityAvailable(p, 'QP1G', true)
		call SetPlayerAbilityAvailable(p, 'A522', true)
		call SetPlayerAbilityAvailable(p, 'QP17', true)
		call SetPlayerAbilityAvailable(p, 'QP1O', true)
		call SetPlayerAbilityAvailable(p, 'A3UF', true)
		call SetPlayerAbilityAvailable(p, 'A0CG', true)
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set p = null
endfunction

function PasSkillCoolDownActions takes nothing returns boolean
	local trigger tri = GetTriggeringTrigger()
	local timer t = CreateTimer()
	local integer tri_h = GetHandleId(tri)
	local integer h = GetHandleId(t)
	local player p = LoadPlayerHandle(HY, tri_h, 1)
	call SetPlayerAbilityAvailable(p, 'QP1G', false)
	call SetPlayerAbilityAvailable(p, 'A522', false)
	call SetPlayerAbilityAvailable(p, 'QP17', false)
	call SetPlayerAbilityAvailable(p, 'QP1O', false)
	call SetPlayerAbilityAvailable(p, 'A3UF', false)
	call SetPlayerAbilityAvailable(p, 'A0CG', false)
	
	call SavePlayerHandle(HY, h, 1, p)
	call TimerStart(t, 0.00, false, function PasSkillCoolDownTimer)
	set p = null
	set t = null
	set tri = null
	return false
endfunction

function PasSkillCoolDownTrigger takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	
	call SavePlayerHandle(HY, h, 1, GetOwningPlayer(u))
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function PasSkillCoolDownActions))
	call SaveTriggerHandle(W, GetHandleId(u),'PACD', t)
	set t = null
endfunction

function Learn_HaveCoolDownSkill takes nothing returns nothing
	if not HaveSavedHandle(W, GetHandleId(GetTriggerUnit()),'PACD') then
		call PasSkillCoolDownTrigger(GetTriggerUnit())
	endif
endfunction

function CFX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if UnitAlive(u) then
		call SetUnitAnimationByIndex(u, LoadInteger(HY, h, 0))
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction
function CGX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u1 = LoadUnitHandle(HY, h, 61)
	local unit u2 = LoadUnitHandle(HY, h, 62)
	local real EHX =(LoadReal(HY, h, 57))
	local lightning APX =(LoadLightningHandle(HY, h, 41))
	if I2R(GetTriggerEvalCount(t))* .025 > EHX then
		call DestroyLightning(APX)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call MoveLightning(APX, true, GetUnitX(u1), GetUnitY(u1), GetUnitX(u2), GetUnitY(u2))
	endif
	set t = null
	set u1 = null
	set u2 = null
	set APX = null
	return false
endfunction
function CHX takes string AMX, unit u1, unit u2, real r, real g, real b, real a, real EHX returns nothing
	local real x1 = GetUnitX(u1)
	local real y1 = GetUnitY(u1)
	local real x2 = GetUnitX(u2)
	local real y2 = GetUnitY(u2)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local lightning APX = AddLightning(AMX, true, x1, y1, x2, y2)
	call SetLightningColor(APX, r, g, b, a)
	call SaveLightningHandle(HY, h, 41,(APX))
	call SaveUnitHandle(HY, h, 61,((u1)))
	call SaveUnitHandle(HY, h, 62,((u2)))
	call SaveReal(HY, h, 57,((EHX)* 1.))
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function CGX))
	set t = null
	set APX = null
endfunction
function CJX takes string CKX returns nothing
	local sound CLX = CreateSound(CKX, false, false, false, 10, 10, "")
	call SetSoundVolume(CLX, 0)
	call StartSound(CLX)
	call KillSoundWhenDone(CLX)
	set CLX = null
endfunction
function CMX takes integer i returns boolean
	return i =='o01J' or i =='o01K' or i =='o01L' or i =='o01M'
endfunction
function IsNecronomiconUnit takes unit u returns boolean
	local integer id = GetUnitTypeId(u)
	return id =='n00J' or id =='n00H' or id =='n00A' or id =='n00G' or id =='n006' or id =='n00K'
endfunction
function IsBearUnit takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return i =='n004' or i =='n018' or i =='n01C' or i =='n01G'
endfunction

function IsHeroOrBearUnit takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return IsUnitType(u, UNIT_TYPE_HERO) or i =='n004' or i =='n018' or i =='n01C' or i =='n01G'
endfunction

function IsInfernalUnit takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return i =='n00U' or i =='n0KU' or i =='n00Y' or i =='n0KV' or i =='n00Z' or i =='n0KW'
endfunction
function IsPrimalEarthTypeId takes integer i returns boolean
	return i =='npn3' or i =='npn6' or i =='n010' or i =='n0GZ'
endfunction
function IsPrimalStormTypeId takes integer i returns boolean
	return i =='npn2' or i =='npn5' or i =='n012' or i =='n0H1'
endfunction
function IsPrimalFireTypeId takes integer i returns boolean
	return i =='npn1' or i =='npn4' or i =='n011' or i =='n0H0'
endfunction
function IsPrimalUnit takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return IsPrimalEarthTypeId(i) or IsPrimalStormTypeId(i) or IsPrimalFireTypeId(i)
endfunction
function IsPrimalTypeId takes integer i returns boolean
	return IsPrimalFireTypeId(i) or IsPrimalStormTypeId(i) or IsPrimalEarthTypeId(i)
endfunction
function IsHeroLevelNormalUnit takes unit u returns boolean
	return IsBearUnit(u) or IsInfernalUnit(u) or IsPrimalUnit(u) or IsFamiliarsTypeId(GetUnitTypeId(u)) or u == RoShan 
endfunction
function C0X takes player p returns nothing
	local unit triggerUnit = Player__Hero[GetPlayerId(p)]
	local integer i = 0
	local item C1X
	loop
	exitwhen i > 5
		set C1X = UnitItemInSlot(triggerUnit, i)
		call SetItemDroppable(C1X, false)
		set i = i + 1
	endloop
	set triggerUnit = null
	set C1X = null
endfunction
function C2X takes player p returns nothing
	local unit triggerUnit = Player__Hero[GetPlayerId(p)]
	local integer i = 0
	local item C1X
	loop
	exitwhen i > 5
		set C1X = UnitItemInSlot(triggerUnit, i)
		call SetItemDroppable(C1X, true)
		set i = i + 1
	endloop
	set triggerUnit = null
	set C1X = null
endfunction
function C3X takes unit u returns boolean
	return GetUnitAbilityLevel(u,'Aetl')> 0 or GetUnitAbilityLevel(u,'Bcyc')> 0 or GetUnitAbilityLevel(u,'Bcy2')> 0 or GetUnitAbilityLevel(u,'B01N')> 0
endfunction
function C4X takes unit u returns boolean
	return GetUnitAbilityLevel(u,'B0C1')> 0 or GetUnitAbilityLevel(u,'BEer')> 0 or GetUnitAbilityLevel(u,'Beng')> 0 or GetUnitAbilityLevel(u,'Bena')> 0 or GetUnitAbilityLevel(u,'B017')> 0 or GetUnitAbilityLevel(u,'B078')> 0 or GetUnitAbilityLevel(u,'B08F')> 0 or GetUnitAbilityLevel(u,'B08E')> 0 or GetUnitAbilityLevel(u,'B0ER')> 0 or GetUnitAbilityLevel(u,'B0FN')> 0
endfunction
function C5X takes unit u returns boolean
	return GetUnitAbilityLevel(u,'B00H')> 0 or GetUnitAbilityLevel(u,'BOhx')> 0 or GetUnitAbilityLevel(u,'BPSE')> 0 or GetUnitAbilityLevel(u,'B099')> 0 or GetUnitAbilityLevel(u,'BSTN')> 0 or GetUnitAbilityLevel(u,'B0CF')> 0 or GetUnitAbilityLevel(u,'B0BM')> 0 or GetUnitAbilityLevel(u,'B07N')> 0 or GetUnitAbilityLevel(u,'B08S')> 0 or GetUnitAbilityLevel(u,'B00Q')> 0 or GetUnitAbilityLevel(u,'B04V')> 0 or GetUnitAbilityLevel(u,'B072')> 0 or GetUnitAbilityLevel(u,'BUan')> 0 or GetUnitAbilityLevel(u,'B095')> 0 or GetUnitAbilityLevel(u,'B03I')> 0 or GetUnitAbilityLevel(u,'B0AD')> 0 or GetUnitAbilityLevel(u,'B0AE')> 0 or GetUnitAbilityLevel(u,'B0BE')> 0 or GetUnitAbilityLevel(u,'B0BF')> 0 or GetUnitAbilityLevel(u,'B008')> 0 or GetUnitAbilityLevel(u,'B04B')> 0 or GetUnitAbilityLevel(u,'B02F')> 0 or GetUnitAbilityLevel(u,'BUsp')> 0 or GetUnitAbilityLevel(u,'BUst')> 0 or GetUnitAbilityLevel(u,'B0DD')> 0 or GetUnitAbilityLevel(u,'B0C2')> 0 or GetUnitAbilityLevel(u,'B06S')> 0 or GetUnitAbilityLevel(u,'B02S')> 0 or GetUnitAbilityLevel(u,'B00Q')> 0 or LoadInteger(HY, GetHandleId(u), 4293)== 1 or LoadInteger(HY, GetHandleId(u), 4303)== 1
endfunction
function C6X takes unit u returns boolean
	return C5X(u) or C4X(u) or IsUnitPaused(u) or RCX(u)
endfunction
function SetResourceBarTime takes integer C8X, integer C9X, boolean extraColor returns nothing
	local integer x = 0
	loop
	exitwhen x > 15
		call SetPlayerState(Player(x), PLAYER_STATE_RESOURCE_LUMBER, C8X)
		call SetPlayerState(Player(x), PLAYER_STATE_RESOURCE_FOOD_USED, C9X)
		set x = x + 1
	endloop
endfunction
function DVX takes unit u returns boolean
	return false
endfunction
function DEX takes real x, real y returns location
	local real NBX
	local real NCX
	local integer i = 0
	loop
	exitwhen i > 40
		set NBX = x + i * 20
		set NCX = y + i * 20
		if IsPointInRegion(R4, NBX, NCX)== false then
			return Location(NBX, NCX)
		endif
		set NBX = x + i * 20
		set NCX = y -i * 20
		if IsPointInRegion(R4, NBX, NCX)== false then
			return Location(NBX, NCX)
		endif
		set NBX = x -i * 20
		set NCX = y + i * 20
		if IsPointInRegion(R4, NBX, NCX)== false then
			return Location(NBX, NCX)
		endif
		set NBX = x -i * 20
		set NCX = y -i * 20
		if IsPointInRegion(R4, NBX, NCX)== false then
			return Location(NBX, NCX)
		endif
		set i = i + 1
	endloop
	return Location(x, y)
endfunction
function DXX takes unit u returns boolean
	return IsUnitVisible(u, BW)== false
endfunction
function DOX takes unit u returns boolean
	return GetUnitAbilityLevel(u,'B068')> 0 or GetUnitAbilityLevel(u,'B07T')> 0 or GetUnitAbilityLevel(u,'B076')> 0 or GetUnitAbilityLevel(u,'BOwk')> 0 or GetUnitAbilityLevel(u,'B04R')> 0 or GetUnitAbilityLevel(u,'B0A5')> 0 or GetUnitAbilityLevel(u,'B01Q')> 0 or GetUnitAbilityLevel(u,'B006')> 0 or GetUnitAbilityLevel(u,'Binv')> 0 or GetUnitAbilityLevel(u,'Apiv')> 0 or GetUnitAbilityLevel(u,'A021')> 0 or GetUnitAbilityLevel(u,'A0K4')> 0 or GetUnitAbilityLevel(u,'A0XB')> 0 or GetUnitAbilityLevel(u,'A0Z2')> 0 or GetUnitAbilityLevel(u,'A1GA')> 0 or GetUnitAbilityLevel(u,'A1HW')> 0 or GetUnitAbilityLevel(u,'A1HX')> 0 or GetUnitAbilityLevel(u,'A00J')> 0 or GetUnitAbilityLevel(u,'B08K')> 0 or GetUnitAbilityLevel(u,'B08X')> 0 or GetUnitAbilityLevel(u,'B039')> 0 or GetUnitAbilityLevel(u,'B00K')> 0 or GetUnitAbilityLevel(u,'BHfs')> 0 or GetUnitAbilityLevel(u,'A140')> 0 or GetUnitAbilityLevel(u,'B021')> 0 or GetUnitAbilityLevel(u,'A0ZD')> 0 or GetUnitAbilityLevel(u,'A0KT')> 0
endfunction

function GEXX takes unit u returns boolean
	return IsUnitType(u, UNIT_TYPE_DEAD) or 0.405 > GetWidgetLife(u)
endfunction

function IsNotRoshan takes unit whichUnit returns boolean
	return whichUnit != RoShan
endfunction
// IsAliveNotStrucNotWard

function IsHeroLevelUnit takes unit whichUnit returns boolean
	return IsHeroUnitId(GetUnitTypeId(whichUnit)) or IsHeroLevelNormalUnit(whichUnit)
endfunction
// 存活 非建筑 非 守卫
function IsAliveNotStrucNotWard takes unit u returns boolean
	return UnitAlive(u) and not IsUnitType(u, UNIT_TYPE_STRUCTURE) and GetUnitAbilityLevel(u,'A04R')== 0
endfunction

// 该单位是否能注册单位事件
function UnitIsCanRegisterUnitEvent takes unit whichUnit returns boolean
	local integer typeId = GetUnitTypeId(whichUnit)
	//  i!='H00M' and i!='H07G' and i!='H00Y' and i!='H00J' and i!='H0B8'
	// 不是能量圈(ncop) 不是巨石(o01X) 不是区域指示器(n00C) 不是酒馆马甲(hfoo) 不是森林之眼 不是冰晶爆轰 不是蓝猫马甲 不是中立被动单位
	return typeId != 'ncop' and typeId != 'o01X' and typeId != 'hfoo' and typeId != 'n00C' and typeId != 'ewsp' and typeId != 'H0B8' and typeId != 'H07G' and GetOwningPlayer(whichUnit)!= NeutralPassivePlayer 
endfunction

function DNX takes nothing returns boolean
	return IsAliveNotStrucNotWard(GetFilterUnit())
endfunction
// 不是远古 但可以是熊灵
function IsNoAncientOrBear takes unit u returns boolean
	return not IsUnitType(u, UNIT_TYPE_ANCIENT) or IsBearUnit(u)
endfunction
function DCX takes nothing returns boolean
	return(IsMagicImmuneUnit(GetFilterUnit())== false and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and UnitIsDead(GetFilterUnit())== false) and IsNoAncientOrBear(GetFilterUnit()))!= null
endfunction
function DDX takes nothing returns boolean
	return(IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit()))!= null
endfunction
function DFX takes nothing returns boolean
	return(IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())))!= null
endfunction
function DGX takes nothing returns boolean
	return(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)))!= null
endfunction
	// 敌对, 存活, 非建筑, 非守卫, 非无敌
function IsEnemyAliveNotStrucNotWardNotInvulnerable takes nothing returns boolean
	return IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()) and not IsUnitInvulnerable(GetFilterUnit())
endfunction
function IsAliveNotStrucNotWardNotInvulnerable takes unit u returns boolean
	return IsAliveNotStrucNotWard(u) and not IsUnitInvulnerable(u)
endfunction
function DJX takes nothing returns boolean
	return IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()) and IsMagicImmuneUnit(GetFilterUnit())== false
endfunction
function DKX takes nothing returns boolean
	return IsEnemyAliveNotStrucNotWardNotInvulnerable() and IsNoAncientOrBear(GetFilterUnit())
endfunction
function DLX takes nothing returns boolean
	return((((IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit())) and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO))))
endfunction
function DMX takes nothing returns boolean
	return((IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit())))!= null
endfunction
function DPX takes nothing returns boolean
	return IsMagicImmuneUnit(GetFilterUnit())== false and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit()))
endfunction
function DQX takes nothing returns boolean
	return DPX() and IsNoAncientOrBear(GetFilterUnit()) and not IsUnitInvulnerable(GetFilterUnit())
endfunction
function DSX takes nothing returns boolean
	return(IsMagicImmuneUnit(GetFilterUnit())== false and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit()))!= null
endfunction
function DTX takes nothing returns boolean
	return(UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())))!= null
endfunction
function DUX takes nothing returns boolean
	return(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())))!= null
endfunction
function DWX takes nothing returns boolean
	return(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and UnitIsDead(GetFilterUnit())== false) and IsNoAncientOrBear(GetFilterUnit()))!= null
endfunction
function DYX takes nothing returns boolean
	return(((IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and UnitIsDead(GetFilterUnit())== false) and IsNoAncientOrBear(GetFilterUnit())) and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO)== false))
endfunction
function DZX takes nothing returns boolean
	return(IsMagicImmuneUnit(GetFilterUnit())== false and(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and UnitIsDead(GetFilterUnit())== false) and IsNoAncientOrBear(GetFilterUnit())))!= null
endfunction
function D_X takes nothing returns boolean
	return(IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit()))== false and(IsAliveNotStrucNotWard(GetFilterUnit())))!= null
endfunction
function D0X takes nothing returns boolean
	return(IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit()))== false and XFX(GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())))!= null
endfunction
function D1X takes nothing returns boolean
	return(IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit()))== false and(IsAliveNotStrucNotWard(GetFilterUnit())))!= null
endfunction
function D2X takes nothing returns boolean
	return(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit()))== false and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit()))!= null
endfunction
function D3X takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit()))== false and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit())))
endfunction
function D4X takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit()))== false and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit())))
endfunction
function D5X takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit())))
endfunction
function D6X takes nothing returns boolean
	return(((DOX(GetFilterUnit())== false or UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2))) and(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit()))))
endfunction
function D7X takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit())))
endfunction
function D8X takes nothing returns boolean
	return((IsMagicImmuneUnit(GetFilterUnit())== false and(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit()))))
endfunction
function D9X takes nothing returns boolean
	return(((IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit())))!= null
endfunction
function FVX takes nothing returns boolean
	return(IsAliveNotStrucNotWard(GetFilterUnit()))!= null
endfunction
function FEX takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit())))
endfunction
function FXX takes nothing returns boolean
	return IsEnemyAliveNotStrucNotWardNotInvulnerable() and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and GetUnitTypeId(GetFilterUnit())!='n0F5'
endfunction
function FOX takes nothing returns boolean
	return(IsMagicImmuneUnit(GetFilterUnit())== false and((IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit())) and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)))!= null
endfunction
function FRX takes nothing returns boolean
	return IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(U2)) and X8X(GetFilterUnit())> 0
endfunction
function FIX takes unit u returns nothing
	if LoadReal(HY, GetHandleId(u),'AItb')+12 < GetGameTime() then
		call UnitRemoveAbility(u,'Bdet')
	endif
endfunction
function FAX takes unit WJE, unit WLE returns nothing
	local unit d = CreateUnit(GetOwningPlayer(WJE),'e00E', GetUnitX(WLE), GetUnitY(WLE), 0)
	call UnitAddAbility(d,'A2VW')
	call IssueImmediateOrderById(d,$D0291)
	call KillUnit(d)
	set d = null
endfunction
function FNX takes unit WUE, integer level, integer FBX returns nothing
	local integer i
	if K2V[1]== 0 then
		return
	endif
	set i = 1
	loop
	exitwhen i >$A
		call UnitRemoveAbility(WUE, K2V[i])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i >$A
		call UnitRemoveAbility(WUE, K3V[i])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i >$A
		call UnitRemoveAbility(WUE, K4V[i])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i >$A
		call UnitRemoveAbility(WUE, K5V[i])
		set i = i + 1
	endloop
	call UnitRemoveAbility(WUE,'B0BS')
	if level == 0 and FBX == 0 then
		call SaveInteger(HY, GetHandleId(WUE), 281, 0)
	endif
	if level == 1 then
		call UnitAddAbility(WUE, K2V[FBX])
	elseif level == 2 then
		call UnitAddAbility(WUE, K3V[FBX])
	elseif level == 3 then
		call UnitAddAbility(WUE, K4V[FBX])
	elseif level == 4 then
		call UnitAddAbility(WUE, K5V[FBX])
	endif
endfunction
function FCX takes integer id returns boolean
	return id =='A0XK' or id =='A3G5' or id =='A13V' or id =='A3G2' or id =='A2TN'
endfunction
function FDX takes integer id returns boolean
	return FCX(id) or id =='AIpg' or id =='A1SA' or id =='A594' or id =='A595' or id =='A02V' or id =='ACpu' or id =='A18D' or id =='A1OU'
endfunction

// 注册一个Buff 
function RegisterBuffAbility takes integer id, integer buffType returns nothing
	call SaveInteger(Q, buffType, LoadInteger(Q, buffType, 0)+ 1, id)
	call SaveInteger(Q, buffType, 0, LoadInteger(Q, buffType, 0)+ 1)
endfunction

// 注册物理Buff
function RegisterPhysicalBuffAbility takes integer id returns nothing
	set A4 = A4 + 1
	set I4[A4]= id
endfunction

function FHX takes unit u returns nothing
	local integer i = 1
	loop
	exitwhen HaveSavedInteger(Q,'PRGN', i)== false
		call UnitRemoveAbility(u, LoadInteger(Q,'PRGN', i))
		set i = i + 1
	endloop
endfunction

// 技能免疫驱散
function SkillImmunityDispel takes unit whichUnit returns nothing
	// 梦境缠绕 超震声波 突袭
	//local integer i = 1
	//loop
	//exitwhen not HaveSavedInteger(Q,BUFF_TYPE_DISARM, i)
	//	call UnitRemoveDisarm(u, LoadInteger(Q,BUFF_TYPE_DISARM, i))
	//	set i = i + 1
	//endloop
	if UnitRemoveAbility(whichUnit, 'A0VT') then // 超震声波缴械
		call UnitRemoveDisarm(whichUnit, 'A0VT')
	endif
endfunction
// 驱散Buff
// EXGetAbilityId( EXGetUnitAbilityByIndex( whichUnit, Index ) )
// 可以通过这个来遍历单位所有技能查询Buff 而不必遍历Buff表
// 效率是按单位的技能数量来比 不过即使是60个技能也比正常的遍历Buff表快2倍
// 写法可再优化 减少If
function RemoveUnitBuff takes unit u, boolean removePositive returns nothing
	local integer abilityId = 0
	local integer loop__Index = 0
	loop
		set abilityId = EXGetAbilityId( EXGetUnitAbilityByIndex( u, loop__Index ) )
		exitwhen abilityId == 0

		//call SingleDebug( I2S( loop__Index ) + " 号技能为 " + GetObjectName(abilityId) + " " + YDWEId2S( abilityId ) )
		if LoadInteger(Q,'PRGC', abilityId) != 0 then
			call UnitRemoveAbility(u, abilityId)
		endif
		if removePositive then
			if LoadInteger(Q,'PRGA', abilityId) != 0 then
				if UnitRemoveAbility(u, abilityId) then
					set loop__Index = loop__Index - 1
				endif
			endif
		else
			if LoadInteger(Q,'PRGE', abilityId) != 0 then
				call UnitRemoveAbility(u, abilityId)
				set loop__Index = loop__Index - 1
			endif
			if LoadInteger(Q,'PRGI', abilityId) != 0 then
				call UnitRemoveAbility(u, abilityId)
				set loop__Index = loop__Index - 1
			endif
			if LoadInteger(Q,'PRGS', abilityId) != 0 then
				call UnitRemoveAbility(u, abilityId)
				set loop__Index = loop__Index - 1
			endif
			if LoadInteger(Q,'PRGN', abilityId) != 0 then
				call UnitRemoveAbility(u, abilityId)
				set loop__Index = loop__Index - 1
			endif
		endif

		set loop__Index = loop__Index + 1
	endloop

	call FNX(u, 0, 0)
	call RemoveSavedReal(HY, GetHandleId(u),'AItb')
	if LoadInteger(HY, GetHandleId(u), 627)> 0 then
		call SaveInteger(HY, GetHandleId(u), 627, 0)
	endif

	if UnitRemoveAbility(u, 'A3KD') then
		call UnitRemoveDisarm(u, 'A3KD')
	endif
	
	call UnitRemoveAbility(u, 'Bblo')
	call UnitRemoveAbility(u, 'B016')
	// 嗜血Buff删除
	if HaveSavedHandle( ExtraHT, GetHandleId(u), HTKEY_SCALE_BLOODLUST_TRIGGER ) then
		call TriggerEvaluate( LoadTriggerHandle( ExtraHT, GetHandleId(u), HTKEY_SCALE_BLOODLUST_TRIGGER ) )
	endif
	// 狂猛Buff删除
	if HaveSavedHandle( ExtraHT, GetHandleId(u), HTKEY_SCALE_RABID_TRIGGER ) then
		call TriggerEvaluate( LoadTriggerHandle( ExtraHT , GetHandleId(u) , HTKEY_SCALE_RABID_TRIGGER ) )
	endif
endfunction

function GetBashlv takes real s returns integer
	set s = s * 1.
	if s < .5 then
		return R2I(s * 10)
	elseif s < .9 then
		return R2I((s -0.4)* 10)
	elseif s < 1.3 then
		return R2I((s -0.8)* 10)
	elseif s < 1.7 then
		return R2I((s -1.2)* 10)
	elseif s < 2.1 then
		return R2I((s -1.6)* 10)
	elseif s < 2.5 then
		return R2I((s -2.)* 10)
	elseif s < 2.9 then
		return R2I((s -2.4)* 10)
	elseif s < 3.3 then
		return R2I((s -2.8)* 10)
	elseif s < 3.7 then
		return R2I((s -3.2)* 10)
	elseif s < 4.1 then
		return R2I((s -3.6)* 10)
	elseif s < 4.5 then
		return R2I((s -4.)* 10)
	elseif s < 4.9 then
		return R2I((s -4.4)* 10)
	elseif s < 5.3 then
		return R2I((s -4.8)* 10)
	endif
	return 0
endfunction
function FQX takes unit u, real dur returns real
	local integer h
	local real FSX
	local integer c
	local real FTX
	if Mode__BalanceOff or not IsUnitType(u, UNIT_TYPE_HERO) then
		return dur
	endif
	set h = GetHandleId(u)
	set c = LoadInteger(K, h, 32)
	set FTX = 1
	if GetGameTime()-LoadReal(K, h, 32)< 6 and LoadReal(K, h, 32)!= 0 then
		if c == 1 then
			set FTX = .75
		elseif c == 2 then
			set FTX = .5
		else
			set FTX = .25
		endif
		call SaveInteger(K, h, 32, c + 1)
		// debug call SingleDebug(" 晕眩限制 "+ R2S(c) )
	else
		call SaveInteger(K, h, 32, 1)
	endif
	call SaveReal(K, h, 32, GetGameTime())
	set FSX = RMaxBJ(R2I(dur * 1. * FTX * 10)* 1. / 10, .01)
	return FSX
endfunction
// 晕眩单位 单位 持续时间 是否无视魔免
function CommonUnitAddStun takes unit whichUnit, real s, boolean isIgnoresMagicImmunity returns real
	local unit dummyUnit = null
	local real dur = 0
	if not isIgnoresMagicImmunity and IsUnitType(whichUnit, UNIT_TYPE_MAGIC_IMMUNE) then//检查是否魔免
		return 0.
	endif
	set dur = FQX(whichUnit, s)
	if dur > 0 then
		set dummyUnit = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
		call UnitAddAbility(dummyUnit, 'A420')
		call YDWESetUnitAbilityDataReal(dummyUnit,'A420', 1, 102, dur)
		call YDWESetUnitAbilityDataReal(dummyUnit,'A420', 1, 103, dur)
		// call SetUnitAbilityLevel(d, id, lv)
		call IssueTargetOrderById(dummyUnit, 852095, whichUnit)
		set dummyUnit = null
	endif
	// debug call SingleDebug(" 晕眩时间 "+ R2S(dur) )
	return dur
endfunction

function EXUnitAddStunCallBack takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	
	call YDWEUnitAddStun( LoadUnitHandle( HY, h, 0 ) )

	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(trig)
	set trig = null
	return false
endfunction

function EXUnitAddStunWait0s takes unit whichUnit returns nothing
	local integer h = CreateTimerEventTrigger( 0., false, function EXUnitAddStunCallBack )
	call SaveUnitHandle( HY, h, 0, whichUnit )
endfunction

function EXUnitAddPauseCallBack takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	
	call PauseUnit( LoadUnitHandle( HY, h, 0 ), true )

	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(trig)
	set trig = null
	return false
endfunction

function EXUnitAddPauseWait0s takes unit whichUnit returns nothing
	local integer h = CreateTimerEventTrigger( 0., false, function EXUnitAddPauseCallBack )
	call SaveUnitHandle( HY, h, 0, whichUnit )
endfunction

// 对魔免单位生效
function FYX takes unit u, real dur returns real	//japi修改锤子持续时间
	local unit d
	if not UnitAlive(u) then
		return .0
	endif
	if dur > 0 then
		set d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
		call UnitAddAbility(d,'A3L0')
		call YDWESetUnitAbilityDataReal(d,'A3L0', 1, 102, dur)
		call YDWESetUnitAbilityDataReal(d,'A3L0', 1, 103, dur)
		call IssueTargetOrderById(d, 852095, u)
		set d = null
	endif
	return dur
endfunction



//=================================
//*
//* 镜像
//*
//================================

// 设置单位高度来到达隐藏单位，并同时隐藏单位阴影(需要用逆变身来刷新)。
function ImageShowUnit takes unit whichUnit, boolean bIsShow returns nothing
	if ( bIsShow ) then
		call SetUnitInvulnerableEx( whichUnit, false )
		call PauseUnit( whichUnit, false )
		call SetUnitX( whichUnit, GetUnitX( whichUnit ) )
	else
		call SetUnitInvulnerableEx( whichUnit, true )
		call PauseUnit( whichUnit, true )
		//call EXUnitAddPauseWait0s(whichUnit)
		call EXSetUnitCollisionType( true, whichUnit, COLLISION_TYPE_UNIT )
		call SetUnitX( whichUnit, GetUnitX( whichUnit ) )
		call EXSetUnitCollisionType( false, whichUnit, COLLISION_TYPE_UNIT )
	endif
endfunction

globals
	constant key HTKEY_UNIT_IMPRISONED
endglobals

// 给单位躲避弹道
function EXShowHideUnit takes unit u returns nothing
	local boolean b = GetPlayerSelectedUnit() == u
	call ShowUnit(u, false)
	call ShowUnit(u, true)
	if b then
		call SelectUnit(u, true)
	endif
endfunction


// 禁锢单位, 崩裂禁锢, 星体禁锢
function ImprisonedUnit takes unit whichUnit, boolean isImprisoned returns nothing
	local integer h = GetHandleId(whichUnit)
	if ( isImprisoned ) then

		call SetUnitInvulnerableEx( whichUnit, true )
		call EXPauseUnit( whichUnit, true )
		call EXSetUnitCollisionType( true, whichUnit, COLLISION_TYPE_UNIT )
		call SetUnitX( whichUnit, GetUnitX( whichUnit ) )
		call EXSetUnitCollisionType( false, whichUnit, COLLISION_TYPE_UNIT )

		call SetUnitState(whichUnit, UNIT_STATE_LIFE, GetUnitState(whichUnit, UNIT_STATE_LIFE))
		//call EXShowHideUnit(whichUnit)
	else
		call SetUnitInvulnerableEx( whichUnit, false )
		call EXPauseUnit( whichUnit, false )
		call SetUnitX( whichUnit, GetUnitX( whichUnit ) )
	endif
	call SaveBoolean(ExtraHT, h, HTKEY_UNIT_IMPRISONED, isImprisoned)
endfunction

function Wait0SSuperShowUnitActions takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	
	call ImageShowUnit(LoadUnitHandle(HY, h, 0), LoadBoolean(HY, h, 0))

	call CleanCurrentTrigger(GetTriggeringTrigger())
endfunction

function SuperShowUnitWait0S takes unit whichUnit, boolean flag returns nothing
	local integer h = CreateTimerEventTrigger(0., false, function Wait0SSuperShowUnitActions)
	call SaveBoolean(HY, h, 0, flag)
	call SaveUnitHandle(HY, h, 0, whichUnit)
endfunction

function SummonIllusion takes unit whichUnit, unit onwerUnit, real dur, real dataB, real dataC, real area, string targetArt returns unit
	local real x = GetUnitX(whichUnit)
	local real y = GetUnitY(whichUnit)
	local real radian = GetUnitFacing(whichUnit) * bj_DEGTORAD
	local unit dummyUnit = CreateUnit(GetOwningPlayer(whichUnit), 'e00E', x, y, 0)
	local ability hAbilityAIil
	
	call UnitAddAbility(dummyUnit, ImageAbility)
	set hAbilityAIil = EXGetUnitAbility(dummyUnit, ImageAbility)
	call EXSetAbilityDataReal(hAbilityAIil, 1, ABILITY_DATA_DUR, dur)
	call EXSetAbilityDataReal(hAbilityAIil, 1, ABILITY_DATA_HERODUR, dur)
	set hAbilityAIil = null

	if targetArt != null then
		call DestroyEffect(AddSpecialEffectTarget(targetArt, whichUnit, "origrin"))
	endif

	call SaveBoolean(ExtraHT, GetHandleId(whichUnit), IMAGO_UNIT_IS_SUMMONING_ILLUSIONS, true)
	set Temp__ArrayReal['B'] = dataB
	set Temp__ArrayReal['C'] = dataC
	set Temp__ArrayInt['I'] = 0
	set Temp__ArrayReal['X'] = CoordinateX50(x + area * Cos(radian))
	set Temp__ArrayReal['Y'] = CoordinateY50(y + area * Sin(radian))
	if IsUnitIllusion(onwerUnit) then
		call SaveUnitHandle(ExtraHT, GetHandleId(dummyUnit), SUMMONING_SOURCE_UNIT, GetSummonSourceUnit(onwerUnit))
	else
		call SaveUnitHandle(ExtraHT, GetHandleId(dummyUnit), SUMMONING_SOURCE_UNIT, onwerUnit)
	endif
	call SaveUnitHandle(ExtraHT, GetHandleId(dummyUnit), IMAGO_TARGET_UNIT, whichUnit)
	// 如果失败, 也许是正在复制倒影的幻象, 将倒影的蝗虫删除再添加, 如果还不能那就是有未知BUG.
	if not IssueTargetOrderById(dummyUnit, 852274, whichUnit) then
		if GetUnitAbilityLevel(whichUnit, 'Aloc') > 0 then
			call UnitRemoveAbility(whichUnit, 'Aloc')
			if not IssueTargetOrderById(dummyUnit, 852274, whichUnit) then
				call UnitAddAbility(whichUnit, 'Aloc')
				set dummyUnit = null
				return null
			endif
			call UnitAddAbility(whichUnit, 'Aloc')
		endif
	endif

	call RemoveSavedBoolean(ExtraHT, GetHandleId(whichUnit), IMAGO_UNIT_IS_SUMMONING_ILLUSIONS)

	set dummyUnit = null
	return lastSummonedIllusionUnit
endfunction

function CreateIllusionUnit takes integer iHandleId, integer iMaxAmount, integer id returns nothing
	local trigger trig = LoadTriggerHandle(HY, iHandleId, 0)
	local integer iHandleId2 = GetHandleId(trig)
	local unit whichUnit = LoadUnitHandle(HY, iHandleId2, 0)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(whichUnit), 'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	local integer realUnitIndex = GetRandomInt(1, iMaxAmount)
	local real dataB = LoadReal(HY, iHandleId2, 'B')
	local real dataC = LoadReal(HY, iHandleId2, 'C')
	local real rDur = LoadReal(HY, iHandleId2, 0)
	local integer loop__i = 1
	local effect eImageMissileEff
	local ability hAbilityAIil
	local fogmodifier hImageFog = null
	// call SaveUnitHandle(HY, GetHandleId(dummyUnit), KEY_MASTERUNIT, whichUnit)
	call UnitAddAbility(dummyUnit, ImageAbility)
	set hAbilityAIil = EXGetUnitAbility(dummyUnit, ImageAbility)
	call EXSetAbilityDataReal(hAbilityAIil, 1, ABILITY_DATA_DUR, rDur)
	call EXSetAbilityDataReal(hAbilityAIil, 1, ABILITY_DATA_HERODUR, rDur)
	set hAbilityAIil = null
	// 给召唤者标识一下
	call SaveBoolean(ExtraHT, GetHandleId(whichUnit), IMAGO_UNIT_IS_SUMMONING_ILLUSIONS, true)
	set Temp__ArrayReal['B'] = dataB
	set Temp__ArrayReal['C'] = dataC
	set Temp__ArrayInt['I'] = id
	call ImageShowUnit(whichUnit, true)
	loop
		set eImageMissileEff = LoadEffectHandle(HY, iHandleId, loop__i)
		if loop__i != realUnitIndex then
			set Temp__ArrayReal['X'] = EXGetEffectX(eImageMissileEff)
			set Temp__ArrayReal['Y'] = EXGetEffectY(eImageMissileEff)
			call SaveUnitHandle(ExtraHT, GetHandleId(dummyUnit), SUMMONING_SOURCE_UNIT, whichUnit)
			call IssueTargetOrderById(dummyUnit, 852274, whichUnit)
		else
			call SetUnitX(whichUnit, EXGetEffectX(eImageMissileEff))
			call SetUnitY(whichUnit, EXGetEffectY(eImageMissileEff))
		endif
		call EXSetEffectZ( eImageMissileEff, -9999 )
		call DestroyEffect(eImageMissileEff)
		exitwhen loop__i == iMaxAmount
		set loop__i = loop__i + 1
	endloop
	call RemoveSavedBoolean(ExtraHT, GetHandleId(whichUnit), IMAGO_UNIT_IS_SUMMONING_ILLUSIONS)

	set hImageFog = LoadFogModifierHandle(HY, iHandleId2, 'F')
	if hImageFog != null then
		call FogModifierStop(hImageFog)
		call DestroyFogModifier(hImageFog)
	endif
	call IssueImmediateOrderById(whichUnit,$D0004)

	call FlushChildHashtable(HY, iHandleId2)
	call CleanCurrentTrigger(trig)
	set trig = null
	set eImageMissileEff = null
	set whichUnit = null
	set dummyUnit = null
endfunction

function ImageMissileMovement takes nothing returns boolean
	local integer iHandleId = GetHandleId(GetTriggeringTrigger())
	local integer iMaxAmount = LoadInteger(HY, iHandleId, 'A')
	local real rMissileSpeed = LoadReal(HY, iHandleId, 'S')
	local effect eImageMissileEff = null
	local integer loop__i = 1
	local real radian
	local real rTargetX
	local real rTargetY
	local integer iCount = LoadInteger(HY, iHandleId, 'C')
	local integer id = LoadInteger(HY, iHandleId, 'I')

	set iCount = iCount - 1
	if iCount > 0 then
		call SaveInteger(HY, iHandleId, 'C', iCount )
		loop
			set radian = ( loop__i * 360 / iMaxAmount ) * bj_DEGTORAD
			//call BJDebugMsg( R2S( radian ) +" 角度" + R2S( ( loop__i * 360 / iMaxAmount ) ))
			set eImageMissileEff = LoadEffectHandle(HY, iHandleId, loop__i)
			set rTargetX = CoordinateX50(EXGetEffectX(eImageMissileEff) + rMissileSpeed * Cos(radian))
			set rTargetY = CoordinateY50(EXGetEffectY(eImageMissileEff) + rMissileSpeed * Sin(radian))
			call EXSetEffectXY(eImageMissileEff, rTargetX, rTargetY)
			exitwhen loop__i == iMaxAmount
			set loop__i = loop__i + 1
		endloop
	else
		call CreateIllusionUnit(iHandleId, iMaxAmount, id)
		call FlushChildHashtable(HY, iHandleId)
		call CleanCurrentTrigger(GetTriggeringTrigger())
	endif
	set eImageMissileEff = null

	return false
endfunction

// 创建镜像的投射物
function CreateImageMissile takes nothing returns boolean
	// 镜像的机制 如果镜像数量＜2 则取随机±180角度
	local integer iHandleId = GetHandleId(GetTriggeringTrigger())
	local unit whichUnit = LoadUnitHandle(HY, iHandleId, 0)
	local real rStartX = GetUnitX(whichUnit)
	local real rStartY = GetUnitY(whichUnit)
	// 投射物数量 = 幻象数量 + 1 因为本体也要有一个投射物
	local integer iMaxAmount = LoadInteger(HY, iHandleId, 'A') + 1
	local real rRng = LoadReal(HY, iHandleId, 'R')
	local real rMissileSpeed = LoadReal(HY, iHandleId, 'S') * 0.03
	local integer abilityId = LoadInteger(HY, iHandleId, 'I')
	local string sMissileArt = LoadStr(HY, iHandleId, 10)
	local real rFace = GetUnitFacing(whichUnit)
	local effect eImageMissileEff
	local integer loop__i
	local real size = GetUnitCurrentScale(whichUnit)
	local fogmodifier hImageFog = LoadFogModifierHandle(HY, iHandleId, 'F')
	// 对于上个触发器的参数读取应该在这条注释上面
	//call BJDebugMsg( "Str" )
	//call BJDebugMsg(I2S(iMaxAmount)+ "iMaxAmount" + GetUnitName( whichUnit ))
	//call BJDebugMsg( "End" )
	if HaveSavedHandle(HY, iHandleId, 100) then
		call DestroyEffect(LoadEffectHandle(HY, iHandleId, 100))
	endif
	set iHandleId = CreateTimerEventTrigger(0.03, true, function ImageMissileMovement)
	// 继续传参
	call SaveInteger(HY, iHandleId, 'A', iMaxAmount)
	call SaveReal(HY, iHandleId, 'R', rRng)
	call SaveReal(HY, iHandleId, 'S', rMissileSpeed)
	call SaveReal(HY, iHandleId, 'S', rMissileSpeed)
	call SaveInteger(HY, iHandleId, 'I', abilityId)
	if hImageFog != null then
		call SaveFogModifierHandle(HY, iHandleId, 'F', hImageFog)
		set hImageFog = null
	endif
	
	// 触发器的最大运行次数
	call SaveInteger(HY, iHandleId, 'C', R2I(rRng / rMissileSpeed) )

	//call BJDebugMsg( "X:" + R2S( rStartX ) + " Y:" + R2S( rStartY ) )
	set loop__i = 1
	loop
		set eImageMissileEff = AddSpecialEffect(sMissileArt, rStartX, rStartY)
		call EXSetEffectSize(eImageMissileEff, size)
		call SaveEffectHandle(HY, iHandleId, loop__i, eImageMissileEff)
		exitwhen loop__i == iMaxAmount
		set loop__i = loop__i + 1
	endloop
	set eImageMissileEff = null

	call SaveTriggerHandle(HY, iHandleId, 0, GetTriggeringTrigger())

	set whichUnit = null
	return false
endfunction

// 单位释放分身 (剑圣分身)
// DataA分身数量,DataB伤害比例,DataC受伤比例,DataD技能延迟,Rng施法距离(位移距离),Area作用范围(施法时提供的视野)
function UnitSpellImage takes unit whichUnit, integer abilityId, real rDataA, real rDataB, real rDataC, real rDataD, real rDur, string sSpecialArt, string sMissileArt, real rMissileSpeed, real rRng, real rArea returns nothing
	local integer iHandleId = CreateTimerEventTrigger(rDataD, false, function CreateImageMissile)
	local real rUnitX = GetUnitX(whichUnit)
	local real rUnitY = GetUnitY(whichUnit)
	local fogmodifier hImageFog = null
	
	local group enumGroup = null
	local unit firstUnit = null
	local effect sSpecialEffect = null

	if rArea > 0. then
		set hImageFog = CreateFogModifierRadius(GetOwningPlayer(whichUnit), FOG_OF_WAR_VISIBLE, rUnitX, rUnitY, rArea, true, false)
		call FogModifierStart(hImageFog)
		call SaveFogModifierHandle(HY, iHandleId, 'F', hImageFog)
		set hImageFog = null
	endif

	if sSpecialArt != null then
		set sSpecialEffect = AddSpecialEffect(sSpecialArt, rUnitX, rUnitY)
		call EXEffectMatRotateZ(sSpecialEffect, GetUnitFacing(whichUnit))
		call EXSetEffectSize(sSpecialEffect, GetUnitCurrentScale(whichUnit))
		call SaveEffectHandle(HY, iHandleId, 100, sSpecialEffect) 
		set sSpecialEffect = null
	endif

	call SuperShowUnitWait0S(whichUnit, false)
	// 这里应该清除一下魔法效果
	//call ImageShowUnit(whichUnit, false) // 
	call EXShowHideUnit(whichUnit)
	//call IssueImmediateOrderByIdToTimed(whichUnit,$D0004, 0.)
	// call IssueImmediateOrderById(whichUnit,$D0004)
	call RemoveUnitBuff(whichUnit, false)
	//call ImageShowUnit(whichUnit, false)

	// call SavePlayerHandle(HY, iHandleId, 'P', GetOwningPlayer(whichUnit))
	call SaveUnitHandle(HY, iHandleId, 0, whichUnit)
	call SaveInteger(HY, iHandleId, 'A', R2I(rDataA))
	call SaveReal(HY, iHandleId, 'B', rDataB)
	call SaveReal(HY, iHandleId, 'C', rDataC)
	call SaveReal(HY, iHandleId, 'D', rDataD)
	call SaveReal(HY, iHandleId, 'R', rRng)
	call SaveReal(HY, iHandleId, 'S', rMissileSpeed)
	call SaveInteger(HY, iHandleId, 'I',abilityId)
	call SaveReal(HY, iHandleId, 0, rDur)
	call SaveStr(HY, iHandleId, 10, sMissileArt)


	set enumGroup = LoginGroup(555)
	call GroupEnumUnitsOfPlayer(enumGroup, GetOwningPlayer(whichUnit), null)

	loop
		set firstUnit = FirstOfGroup(enumGroup)
		exitwhen firstUnit == null
		call GroupRemoveUnit(enumGroup, firstUnit)
		if IsUnitIllusion(firstUnit) and LoadInteger(ExtraHT, GetHandleId(firstUnit), IllusionUnitDataId) == abilityId then
			call KillUnit(firstUnit)
		endif
	endloop
	
	call LogoutGroup(enumGroup)

	set firstUnit = null
	set hImageFog = null
endfunction

//=================================





function impale_fly takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit target = LoadUnitHandle(HY, h, 73)
	local integer c = GetTriggerEvalCount(t)
	if c < 26 then
		if O0X(target)== false then
			call SetUnitFlyHeight(target, 375 - (c -13)*(c -13) , 0)
		endif
	else
		call PauseUnit(target, false)
		if O0X(target)== false then
			call SetUnitFlyHeight(target, GetUnitDefaultFlyHeight(target), 0)
		endif
		call UnitDamageTargetEx((LoadUnitHandle(HY, h, 2)), target, 1,(LoadReal(HY, h, 20)))
		call CommonUnitAddStun(target,(LoadReal(HY, h, 57)), false)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set target = null
	return false
endfunction
function impale_actions takes unit target, unit u, real dur, real d, real r returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call PauseUnit(target, true)
	if O0X(target)== false then
		call UnitAddAbility(target,'Amrf')
		call UnitRemoveAbility(target,'Amrf')
	endif
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\Impale\\ImpaleHitTarget.mdl", GetUnitX(target), GetUnitY(target)))
	call SaveUnitHandle(HY, h, 73,((target)))
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveReal(HY, h, 20,((d)* 1.))
	call SaveReal(HY, h, 57,((dur)* 1.))
	call TriggerRegisterTimerEvent(t, .02 / .52 * r, true)
	call TriggerAddCondition(t, Condition(function impale_fly))
	set t = null
endfunction

function impale_enumunit takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real x1 =(LoadReal(HY, h, 64))
	local real y1 =(LoadReal(HY, h, 65))
	local real x2 =(LoadReal(HY, h, 66))
	local real y2 =(LoadReal(HY, h, 67))
	local real w =(LoadReal(HY, h, 68))
	local real speed =(LoadReal(HY, h, 44))
	local real a = Atan2(y2 -y1, x2 -x1)
	local group g1 = LoadGroupHandle(HY, h, 22)
	local group g2 = LoginGroup(4)
	local real IMX = speed * .0625
	local real F6X =(LoadReal(HY, h, 71))
	local real F7X =(LoadReal(HY, h, 72))
	local real F8X =(LoadReal(HY, h, 70))
	local unit firstUnit
	if IMX > GetDistanceBetween(x1, y1, x2, y2) then
		set x1 = x2
		set y1 = y2
	else
		set x1 = x1 + IMX * Cos(a)
		set y1 = y1 + IMX * Sin(a)
	endif
	set U2 = LoadUnitHandle(HY, h, 2)
	set S2 = LoadReal(HY, h, 20)
	set TJ = LoadReal(HY, h, 57)
	set RJ = LoadReal(HY, h, 63)
	set DK = g1
	call GroupEnumUnitsInRange(g2, x1, y1, w, null)
	loop
		set firstUnit = FirstOfGroup(g2)
		exitwhen firstUnit == null
		call GroupRemoveUnit(g2, firstUnit)
		// 存活 非建筑 非守卫 敌对
		if not IsMagicImmuneUnit(firstUnit) and IsUnitEnemy(U2, GetOwningPlayer(firstUnit)) and IsAliveNotStrucNotWard(firstUnit) then
			if not IsUnitInGroup(firstUnit, DK) and LoadInteger(HY, GetHandleId(firstUnit), 4253)!= 1 then
				call GroupAddUnit(DK, firstUnit)
				call impale_actions(firstUnit, U2, TJ, S2, RJ)
			endif
		endif
	endloop
	set firstUnit = null
	call LogoutGroup(g2)
	if GetDistanceBetween(x1, y1, F6X, F7X)>= F8X then
		call SaveReal(HY, h, 71,((x1)* 1.))
		call SaveReal(HY, h, 72,((y1)* 1.))
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\Impale\\ImpaleMissTarget.mdl", x1, y1))
	endif
	call SaveReal(HY, h, 64,((x1)* 1.))
	call SaveReal(HY, h, 65,((y1)* 1.))
	if x1 == x2 and y1 == y2 then
		if(LoadBoolean(HY, h, 69)) then
			call LogoutGroup(g1)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set g1 = null
	set g2 = null
	set t = null
	return false
endfunction
//穿刺效果，所有穿刺都会调用此函数。
//u == 技能施法者
//target == 技能施法目标，可能为空值
//d == 技能造成伤害(damage)
//dur == 眩晕持续时间(此函数调用的穿刺效果眩晕均计算魔免)
//gx == 未知参数，会在后面函数进行一个计算(.02 / .52 *gx) = 0.02 所有穿刺效果此值均填0.52，用意未知
//x1,y1 == 技能施法者(u)的坐标
//x2,y2 == 技能施法目标(target)的坐标 Or 技能施法点的坐标(因为target可能是空值)
//w == 穿刺效果的选取范围
//g1 == 事先申请的一个单位组，不过如果填null的话会在此函数内申请单位组，并且b的值需要填true(‘毁灭’此项不为null)
//b == 用于判断是否要清空单位组，如果此项填false，则需要g1不为null，否则将会占用单位组(‘毁灭’此项为false)
//speed == 弹道速率，即穿刺的前进速度
function UnitSpellEffectImpale takes unit u, unit target, real d, real dur, real gx, real x1, real y1, real x2, real y2, real w, group g1, boolean b, real speed returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real distance = GetDistanceBetween(x1, y1, x2, y2)
	local real r = distance / B3X(distance, ZN)
	local group g2 = null
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveReal(HY, h, 20,((d)* 1.))
	call SaveReal(HY, h, 57,((dur) * 1.))
	call SaveReal(HY, h, 63,((gx)* 1.))
	call SaveReal(HY, h, 64,((x1)* 1.))
	call SaveReal(HY, h, 65,((y1)* 1.))
	call SaveReal(HY, h, 66,((x2)* 1.))
	call SaveReal(HY, h, 67,((y2)* 1.))
	call SaveReal(HY, h, 68,((w)* 1.))
	call SaveReal(HY, h, 44,((speed)* 1.))
	if g1 == null then
		set g2 = LoginGroup(5)
		if target != null and not IsUnitIllusion(target) then
			call GroupAddUnit(g2, target)
		endif
		call SaveGroupHandle(HY, h, 22,(g2))
		call SaveBoolean(HY, h, 69,(b))
		set g2 = null
	else
		call SaveGroupHandle(HY, h, 22,(g1))
		call SaveBoolean(HY, h, 69,(b))
	endif
	call SaveReal(HY, h, 70,((r)* 1.))
	call SaveReal(HY, h, 71,((x1)* 1.))
	call SaveReal(HY, h, 72,((y1)* 1.))
	call TriggerRegisterTimerEvent(t, .0625, true)
	call TriggerAddCondition(t, Condition(function impale_enumunit))
	set t = null
	set g2 = null
endfunction

function AddUnitMagicResistance takes unit whichUnit, real addValue returns nothing
	local integer typeId = GetUnitTypeId(whichUnit)
	local integer h = GetHandleId(whichUnit)
	local real oldValue = LoadReal(ExtraHT, h, HTKEY_UNIT_BONUS_MAGIC_RESISTANCE)
	local real baseFixValue = LoadReal(ExtraHT, h, HTKEY_UNIT_BASE_MAGIC_RESISTANCE)
	local real actulaValue = LoadReal(ExtraHT, h, HTKEY_UNIT_ACTULA_MAGIC_RESISTANCE)
	local real value 
	local real base
	local real actual = 0.
	// 基础魔法抗性修正 如果没选大牛光环就不计算

	if IsHeroUnitId(typeId) then // 英雄单位类型, 基础魔抗为0.25
		set base = 0.75
	else
		set base = LoadReal(ObjectData, OBJ_HTKEY_BASE_MAGIC_RESISTANCE, typeId)
	endif

	set base = 1 - ( ( 1 - base ) * ( 1. + baseFixValue) )

	if oldValue == 0. then
		set value = 1. - ( 1. - addValue ) 
	else
		set value = 1. - ( ( 1. - oldValue ) * ( 1. - addValue ) )
	endif
	call SaveReal(ExtraHT, h, HTKEY_UNIT_BONUS_MAGIC_RESISTANCE, value)
	//call BJDebugMsg("value" + R2SW(value, 2, 5))
	set actual = base * ( 1. - value )
	if actulaValue != 1. then
		call SaveReal(ExtraHT, h, HTKEY_UNIT_ACTULA_MAGIC_RESISTANCE, actual)
	endif
	//call BJDebugMsg("当前受到魔法伤害比例" + R2SW(actual, 2, 5))
endfunction

function ReduceUnitMagicResistance takes unit whichUnit, real addValue returns nothing
	local integer typeId = GetUnitTypeId(whichUnit)
	local integer h = GetHandleId(whichUnit)
	local real oldValue = LoadReal(ExtraHT, h, HTKEY_UNIT_BONUS_MAGIC_RESISTANCE)
	local real baseFixValue = LoadReal(ExtraHT, h, HTKEY_UNIT_BASE_MAGIC_RESISTANCE)
	local real value 
	local real base
	local real actual = 0.
	local real actulaValue = LoadReal(ExtraHT, h, HTKEY_UNIT_ACTULA_MAGIC_RESISTANCE)
	// 基础魔法抗性修正 如果没选大牛光环就不计算
	if IsHeroUnitId(typeId) then // 英雄单位类型, 基础魔抗为0.25
		set base = 0.75
	else
		set base = LoadReal(ObjectData, OBJ_HTKEY_BASE_MAGIC_RESISTANCE, typeId)
	endif
	
	set base = 1 - ( ( 1 - base ) * ( 1. + baseFixValue) )

	if oldValue == 0. then
		set value = 1. - ( 1. + addValue ) 
	else
		set value = 1. - ( ( 1. - oldValue ) / ( 1. - addValue ) )
	endif
	call SaveReal(ExtraHT, h, HTKEY_UNIT_BONUS_MAGIC_RESISTANCE, value)
	set actual = base * ( 1. - value )
	if actulaValue != 1. then
		call SaveReal(ExtraHT, h, HTKEY_UNIT_ACTULA_MAGIC_RESISTANCE, actual)
	endif
	//call BJDebugMsg("当前受到魔法伤害比例" + R2SW(actual, 2, 5))
endfunction

function SetUnitImmunityMagicDamage takes unit whichUnit, boolean flag returns nothing
	local integer h = GetHandleId(whichUnit)
	local integer count = LoadInteger(ExtraHT, h, HTKEY_UNIT_IMMUNITY_MAGIC_DAMAGE)
	if flag then
		set count = count + 1
	else
		set count = count - 1
	endif
	call SaveInteger(ExtraHT, h, HTKEY_UNIT_IMMUNITY_MAGIC_DAMAGE, count)
	if count > 0 then
		call SaveReal(ExtraHT, h, HTKEY_UNIT_ACTULA_MAGIC_RESISTANCE, 1.)
	elseif count == 0 then
		call RemoveSavedReal(ExtraHT, h, HTKEY_UNIT_ACTULA_MAGIC_RESISTANCE)
		call AddUnitMagicResistance(whichUnit, 0.)
	endif
endfunction

function RestoreUnitBaseResistance takes unit whichUnit returns nothing
	local integer typeId = GetUnitTypeId(whichUnit)
	local integer h = GetHandleId(whichUnit)
	local real oldValue = LoadReal(ExtraHT, h, HTKEY_UNIT_BONUS_MAGIC_RESISTANCE)
	local real baseFixValue = 0.
	local real base
	local real actual = 0.
	// 基础魔法抗性修正 如果没选大牛光环就不计算
	if IsHeroUnitId(typeId) then // 英雄单位类型, 基础魔抗为0.25
		set base = 0.75
	else
		set base = LoadReal(ObjectData, OBJ_HTKEY_BASE_MAGIC_RESISTANCE, typeId)
	endif
	call SaveReal(ExtraHT, h, HTKEY_UNIT_BASE_MAGIC_RESISTANCE, 0.)
	set base = 1 - ( ( 1 - base ) * ( 1. + baseFixValue) )

	call SaveReal(ExtraHT, h, HTKEY_UNIT_BONUS_MAGIC_RESISTANCE, oldValue)
	set actual = base * ( 1. - oldValue )
	call SaveReal(ExtraHT, h, HTKEY_UNIT_ACTULA_MAGIC_RESISTANCE, actual)
	//call BJDebugMsg("当前受到魔法伤害比例" + R2SW(actual, 2, 5))
endfunction

// 降低基础魔法抗性
function ReduceUnitBaseResistance takes unit whichUnit, real reduceValue returns nothing
	local integer typeId = GetUnitTypeId(whichUnit)
	local integer h = GetHandleId(whichUnit)
	local real oldValue = LoadReal(ExtraHT, h, HTKEY_UNIT_BONUS_MAGIC_RESISTANCE)
	local real baseFixValue = LoadReal(ExtraHT, h, HTKEY_UNIT_BASE_MAGIC_RESISTANCE)
	local real base
	local real actual = 0.
	// 基础魔法抗性修正 如果没选大牛光环就不计算
	if IsHeroUnitId(typeId) then // 英雄单位类型, 基础魔抗为0.25
		set base = 0.75
	else
		set base = LoadReal(ObjectData, OBJ_HTKEY_BASE_MAGIC_RESISTANCE, typeId)
	endif
	call SaveReal(ExtraHT, h, HTKEY_UNIT_BASE_MAGIC_RESISTANCE, reduceValue)
	set base = 1 - ( ( 1 - base ) * ( 1. + reduceValue) )

	call SaveReal(ExtraHT, h, HTKEY_UNIT_BONUS_MAGIC_RESISTANCE, oldValue)
	set actual = base * ( 1. - oldValue )
	call SaveReal(ExtraHT, h, HTKEY_UNIT_ACTULA_MAGIC_RESISTANCE, actual)
	//call BJDebugMsg("当前受到魔法伤害比例" + R2SW(actual, 2, 5))
endfunction

function GetUnitMagicResistance takes unit whichUnit returns real
	return LoadReal(ExtraHT, GetHandleId(whichUnit), HTKEY_UNIT_ACTULA_MAGIC_RESISTANCE)
endfunction

// 储存的值是受到的魔法伤害 而不是魔法抗性
// 例如英雄单位, 是0.75
function SaveUnitTypeMagicResistance takes integer typeId, real value returns nothing
	call SaveReal(ObjectData, OBJ_HTKEY_BASE_MAGIC_RESISTANCE, typeId, 1. - value)
endfunction

function GetUnitBaseMagicResistanceByType takes integer typeId returns real
	return LoadReal(ObjectData, OBJ_HTKEY_BASE_MAGIC_RESISTANCE, typeId)
endfunction

function GBX takes unit u returns nothing
	local integer i = 1
	loop
	exitwhen i > A4
		call UnitRemoveAbility(u, I4[i])
		set i = i + 1
	endloop
	call RemoveUnitBuff(u, false)
endfunction
function GCX takes unit u returns nothing
	call RemoveUnitBuff(u, true)
endfunction
function GDX takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer GFX = LoadInteger(HY, h, 0)
	local player p = LoadPlayerHandle(HY, h, 1)
	local boolean GGX = LoadBoolean(HY, h,'0NEW')
	local player np = LoadPlayerHandle(HY, h,'0NEW')
	local unit W_V = LoadUnitHandle(HY, h,'DUMM')
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		call RemoveUnit(W_V)
		call UnitShareVision(u, p, false)
		call FlushChildHashtable(HY, h)
		call RemoveSavedHandle(P, GetHandleId(u), GFX)
		call CleanCurrentTrigger(t)
	else
		if GetUnitAbilityLevel(u, GFX)> 0 then
			if GGX then
				call UnitShareVision(u, p, false)
				call SetUnitOwner(W_V, np, false)
				set p = np
				call SavePlayerHandle(HY, h, 0, p)
				call SaveBoolean(HY, h,'0NEW', false)
			endif
			if GetUnitAbilityLevel(u,'A1HX')== 0 then
				call UnitShareVision(u, p, true)
				call SetUnitPosition(W_V, GetUnitX(u), GetUnitY(u))
			else
				call UnitShareVision(u, p, false)
			endif
		else
			call RemoveUnit(W_V)
			call UnitShareVision(u, p, false)
			call FlushChildHashtable(HY, h)
			call RemoveSavedHandle(P, GetHandleId(u), GFX)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set u = null
	set W_V = null
endfunction
function GHX takes unit u, unit GJX, integer GKX returns nothing
	local trigger t = LoadTriggerHandle(P, GetHandleId(u), GKX)
	local integer hu = GetHandleId(u)
	local integer h
	local unit W_V
	if t == null then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .02, true)
		call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
		call TriggerAddCondition(t, Condition(function GDX))
		call SaveUnitHandle(HY, h, 0, u)
		call SavePlayerHandle(HY, h, 1, GetOwningPlayer(GJX))
		call SaveInteger(HY, h, 0, GKX)
		call SaveTriggerHandle(P, hu, GKX, t)
		set W_V = CreateUnit(GetOwningPlayer(GJX),'hFFD', GetUnitX(u), GetUnitY(u), 0)
		call SaveUnitHandle(HY, h,'DUMM', W_V)
		call UnitAddAbility(W_V,'A30X')
		set W_V = null
	else
		set h = GetHandleId(t)
		if IsPlayerEnemy(GetOwningPlayer(GJX), LoadPlayerHandle(HY, h, 1)) then
			call SaveBoolean(HY, h,'0NEW', true)
			call SavePlayerHandle(HY, h,'0NEW', GetOwningPlayer(GJX))
		endif
	endif
	set t = null
endfunction
function GLX takes integer id returns boolean
	return id =='A1WE' or id =='A0B8' or id =='A063' or id =='A03O' or id =='A0T2' or id =='QB0Q' or id =='A0MQ' or id =='A1B6' or id =='A11F' or id =='A11E' or id =='A0S3' or id =='A11D' or id =='A11G' or id =='A11H' or id =='A2LI' or id =='A0NS' or id =='A1DA'
endfunction
function GMX takes integer id returns boolean
	return id =='A08V' or id =='QB05' or id =='A2TF' or id =='QB11' or id =='A0MF' or id =='Aprg' or id =='ACpu' or id =='AIpg' or id =='A02E' or id =='A02V' or id =='A0QH' or id =='A0QX' or id =='A18D' or id =='A1OU' or id =='A1SA' or id =='A594' or id =='A595' or id =='A2TN' or id =='Acyc' or id =='ACcy' or id =='AIcy' or id =='A0XK' or id =='A12L' or id =='A13V' or id =='A1RL'
endfunction
function GPX takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer id = LoadInteger(HY, h, 0)
	local integer GFX = LoadInteger(HY, h, 1)
	local integer TPE
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		call UnitRemoveAbility(u, id)
		call UnitRemoveAbility(u, GFX)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_PLAYER_UNIT_SPELL_EFFECT then
		if GetUnitAbilityLevel(u, id)== 0 then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			set TPE = GetSpellAbilityId()
			if GetTriggerUnit()== u then
				if GLX(TPE) then
					call UnitRemoveAbility(u, id)
					call UnitRemoveAbility(u, GFX)
					call FlushChildHashtable(HY, h)
					call CleanCurrentTrigger(t)
				endif
			else
				if GetSpellTargetUnit()== u and(IsPlayerAlly(GetOwningPlayer(GetTriggerUnit()), GetOwningPlayer(u)) or UnitHasSpellShield(u)== false) and GMX(TPE) then
					call UnitRemoveAbility(u, id)
					call UnitRemoveAbility(u, GFX)
					call FlushChildHashtable(HY, h)
					call CleanCurrentTrigger(t)
				endif
			endif
		endif
	endif
	set t = null
	set u = null
endfunction
function GQX takes unit u, integer id, integer GFX returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function GPX))
	call SaveUnitHandle(HY, h, 0, u)
	call SaveInteger(HY, h, 0, id)
	call SaveInteger(HY, h, 1, GFX)
	set t = null
endfunction
function GSX takes integer GTX returns integer
	if XNV[GTX]== 0 then
		return GTX
	else
		return XNV[GTX]
	endif
endfunction
function GUX takes integer id returns boolean
	return id == O7V or id == O5V or id == O4V or id == O6V or id == O3V or id == O8V
endfunction
function GWX takes integer id returns integer
	if id == O7V then
		return'I007'
	elseif id == O5V then
		return'I006'
	elseif id == O4V then
		return'I00K'
	elseif id == O6V then
		return'I008'
	elseif id == O3V then
		return'I00J'
	elseif id == O8V then
		return'I0QA'
	endif
	return -1
endfunction
function GYX takes unit u, integer id returns boolean
	local integer i
	local item it
	set i = 0
	loop
	exitwhen i > 5
		set it = UnitItemInSlot(u, i)
		if it != null and GetItemTypeId(it)== id then
			set it = null
			return true
		endif
		set i = i + 1
	endloop
	set it = null
	return false
endfunction
function GZX takes unit u, integer id, item it returns item
	local integer i
	local item G_X
	set i = 0
	loop
	exitwhen i > 5
		set G_X = UnitItemInSlot(u, i)
		if G_X != null and G_X != it and GetItemTypeId(G_X)== id then
			set G_X = null
			return UnitItemInSlot(u, i)
		endif
		set i = i + 1
	endloop
	set G_X = null
	return null
endfunction
// 按类型 从单位身上获取物品
function GetItemOfTypeFromUnit takes unit u, integer id returns item
	local integer i
	local item it
	set i = 0
	loop
	exitwhen i > 5
		set it = UnitItemInSlot(u, i)
		if it != null and GetItemTypeId(it)== id then
			set it = null
			return UnitItemInSlot(u, i)
		endif
		set i = i + 1
	endloop
	set it = null
	return null
endfunction
function G1X takes player p, unit u, integer GTX, item G_X returns item
	local integer i
	local item it
	set i = 0
	loop
	exitwhen i > 5
		set it = UnitItemInSlot(u, i)
		if it != null and it != G_X and UUV(it)== GTX and(GetItemPlayer(it)== p or GTX == R2V or GTX == R3V) then
			set it = null
			return UnitItemInSlot(u, i)
		endif
		set i = i + 1
	endloop
	set it = null
	return null
endfunction
function G2X takes player p, unit u, integer GTX returns item
	local integer i
	local item it
	set i = 0
	loop
	exitwhen i > 5
		set it = UnitItemInSlot(u, i)
		if(it != null) and UUV(it)== GTX and(GetItemPlayer(it)== p or GTX == R2V or GTX == R3V) then
			set it = null
			return UnitItemInSlot(u, i)
		endif
		set i = i + 1
	endloop
	set it = null
	return null
endfunction
function G3X takes unit u returns boolean
	local item it
	local integer i = 0
	local integer id
	if GetUnitAbilityLevel(u,'A3E7')== 1 then
		set it = null
		return true
	endif
	loop
		set it = UnitItemInSlot(u, i)
		if it != null then
			set id = GetItemIndex(it)
			if(id == XFV or id == XCV or id == XDV) and GetItemUserData(it)!=-2 then
				set it = null
				return true
			endif
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	set it = null
	return false
endfunction
function G4X takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local player p = LoadPlayerHandle(HY, h, 0)
	local integer Y_E = LoadInteger(HY, h, 0)
	if GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)-Y_E >=$834 then
		call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)-$834)
	endif
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
endfunction
function G5X takes integer id, unit u, boolean G6X returns nothing
	local item it
	if G6X == false then
		if id =='A0CY' then
			// 分裂和拆建筑加成
			call UnitAddPermanentAbility(u,'A2KK')
			//call UnitMakeAbilityPermanent(u, true,'A1W0')
			//call UnitMakeAbilityPermanent(u, true,'A1W4')
			//call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A2KK', false)
		elseif id =='A0DY' then
		endif
	else
		if G3X(u)== false then
		endif
	endif
	if id =='A0CY' and GetUnitTypeId(u)=='Ucrl' then
		//		set PlayerHeroTypeId[GetPlayerId(GetOwningPlayer(u))]='U01X'
		call AddUnitAnimationProperties(u, "upgrade", not G6X)
	endif
endfunction

function G7X takes integer k, unit u, integer G8X returns boolean
	local player p = GetOwningPlayer(u)
	if Mode__RearmCombos == false then
		if(RF[k]=='A2S7' or RF[k]=='A236') then
			if ZLE(u) then
				return false
			endif
		endif
	else
		if RF[k]=='A236' then
			if ZLE(u) then
				return false
			endif
		endif
	endif
	
	if NF[k]=='A343'then
		set U2 = u
		call ExecuteFunc("G9X")
	elseif NF[k]=='A088' then
		set U2 = u
		call ExecuteFunc("HVX")
	elseif NF[k]=='A2E5' then
		set U2 = u
		call ExecuteFunc("HEX")
	elseif NF[k]=='A0KV' then
		set U2 = u
		call ExecuteFunc("addXL")
	elseif NF[k]=='A07Z' then
		set U2 = u
		call ExecuteFunc("HXX")
	elseif NF[k]=='A1YQ' then
		set U2 = u
		call ExecuteFunc("HOX")
	elseif NF[k]=='A01Y' then
		// 骷髅王获得A杖
		set U2 = u
		call ExecuteFunc("HRX")
		
	elseif NF[k]=='A0DY' then
		if LoadBoolean(HY, GetHandleId(GetOwningPlayer(u)),'R00J')== false then
			call AddUnitAttack1RangeBonus_OnlyRangeAttacker(u, 190.)
			call SaveBoolean(HY, GetHandleId(GetOwningPlayer(u)),'R00J', true)
		endif
	elseif NF[k]=='A0CY' then
		if LoadBoolean(HY, GetHandleId(GetOwningPlayer(u)),'R0L3')== false then
			call AddUnitAttack1RangeCurrencyBonus(u, 107.)
			call SaveBoolean(HY, GetHandleId(GetOwningPlayer(u)),'R0L3', true)
			call UnitAddPermanentAbility(u,'A2KK')
			//call UnitMakeAbilityPermanent(u, true,'A1W0')
			//call UnitMakeAbilityPermanent(u, true,'A1W4')
			//call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A2KK', false)
		endif
	endif
	if RF[k]> 0 then
		call UnitAddPermanentAbility(u, RF[k])
		call UnitMakeAbilityPermanent(u, true, CF[k])
	endif
	call SaveInteger(K, GetHandleId(u),'AGH0'+ G8X, NF[k])
	return true
endfunction
function HIX takes integer k, unit u, integer G8X returns nothing
	local player p = GetOwningPlayer(u)
	if G3X(u) then
		return
	endif
	if NF[k]=='A088' then
		set U2 = u
		call ExecuteFunc("HAX")
	elseif NF[k]=='A2E5' then
		set U2 = u
		call ExecuteFunc("HNX")
	elseif NF[k]=='A0KV' then
		set U2 = u
		call ExecuteFunc("delXL")
	elseif NF[k]=='A07Z' then
		set U2 = u
		call ExecuteFunc("HBX")
	elseif NF[k]=='A1YQ' then
		set U2 = u
		call ExecuteFunc("HCX")
	elseif NF[k]=='A0DY' then
		if LoadBoolean(HY, GetHandleId(GetOwningPlayer(u)),'R00J') then
			call AddUnitAttack1RangeBonus_OnlyRangeAttacker(u, -190.)
			call SaveBoolean(HY, GetHandleId(GetOwningPlayer(u)),'R00J', false)
		endif
	elseif NF[k]=='A0CY' then
		if LoadBoolean(HY, GetHandleId(GetOwningPlayer(u)),'R0L3') then
			call AddUnitAttack1RangeCurrencyBonus(u, -107.)
			call SaveBoolean(HY, GetHandleId(GetOwningPlayer(u)),'R0L3', false)
			call UnitRemoveAbility(u,'A2KK')
		endif
	endif
	call UnitRemoveAbility(u, RF[k])
	if CF[k]!= NF[k]then
		call UnitRemoveAbility(u, CF[k])
	endif
	call SaveInteger(K, GetHandleId(u),'AGH0'+ G8X, 0)
endfunction


function get_a_fx takes integer skill returns integer //移植A杖特效
	if skill == 0 then
		return 0
	elseif skill =='A0NS' then
		return 'A3I4' //死骑
	elseif skill =='A095' then
		return 'A0PA' //莱恩
	elseif skill =='A03R' then
		return 'A0Q8'	//冰女
	elseif skill =='A05T' then
		return 'A0PE' //巫妖
	elseif skill =='A28R' then
		return 'A0P7' //女王
	elseif skill =='A00H' then
		return 'A0P8' //小Y
	elseif skill =='A088' then
		return 'A0P9' //蓝胖
	elseif skill =='A0CC' then
		return 'A0PB' //骨法
	elseif skill =='A01P' then
		return 'A0PC' //火女
	elseif skill =='QM01' then
		return 'A0PD'	//光法
	elseif skill =='A29G' then
		return 'A0PF'	//宙斯
	elseif skill =='A054' then
		return 'A1NQ'	//露娜
	elseif skill =='A0IN' then
		return 'A1V3' //VS
	elseif skill =='A0QR' then
		return 'A1NS' //神灵
	elseif skill =='A21F' then
		return 'A1NW' //老鹿
	elseif skill =='A06R' then
		return 'A1VD' //沙王
	elseif skill =='A0DH' then
		return 'A1VC' //神牛
	elseif skill =='A0M1' then
		return 'A1QL' //剑圣
	elseif skill =='A0J1' then
		return 'A1R3' //虚空
	elseif skill =='A1AO' then
		return 'A1UX' //电棍
	elseif skill =='S008' then
		return 'A1UY' //术士
	elseif skill =='A0NT' then
		return 'A1V5' //巫医
	elseif skill =='A0OK' then
		return 'A1VZ' //黑鸟
	elseif skill =='A0DY' then
		return 'A1X2' //小鹿
	elseif skill =='A0LT' then
		return 'A208' //陈
	elseif skill =='A0QK' then
		return 'A21Z' //兔子
	elseif skill =='A1CV' then
		return 'A220' //发条
	elseif skill =='A1T5' then
		return 'A23E' //飞机
	elseif skill =='A0E2' then
		return 'A1V9' //斧王
	elseif skill =='A0FL' then
		return 'A1VB' //屠夫
	elseif skill =='A0G4' then
		return 'A1VE' //白牛
	elseif skill =='A0O5' then
		return 'A1VF' //双头龙
	elseif skill =='A1W8' then
		return 'A20M' //先知
	elseif skill =='A0O2' then
		return 'A29E' //兽王
	endif
	return 0
endfunction
function get_a_c takes unit u returns integer
	local integer id = GetPlayerId(GetOwningPlayer(u))
	local integer ret = 0
	set ret = get_a_fx(HeroCommonSkills[PlayerSkillIndex[id * 6 + 4]])
	if ret == 0 then
		set ret = get_a_fx(HeroCommonSkills[PlayerSkillIndex[id * 6 + 6]])
	endif
	return ret
endfunction

function HDX takes unit u, boolean G6X returns boolean
	local integer TME = GetPlayerId(GetOwningPlayer(u))
	local integer k
	local integer z
	local boolean b = false
	local integer i = 1
	if not IsUnitType(u, UNIT_TYPE_HERO) or(G6X and G3X(u)) then
		return false
	endif
	//call BJDebugMsg("添加神杖")
	// 给单位添加A杖效果技能
	if a_fx[TME] == 0 then
		set k = get_a_c(u)
		set a_fx[TME]= k
	// 如果死亡竞赛或者全部随机 会重新检测A杖技能
	elseif Mode__DeathMatch or MainModeName =="ar" then
		set k = get_a_c(u)
	else
		set k = a_fx[TME]
	endif
	set a_fx_b[TME] = not G6X
	if k != 0 then
		if G6X then
			call UnitRemoveAbility(u, k)
		else
			call UnitAddPermanentAbility(u, k)
		endif
	endif
	loop
		if HeroCommonSkills[PlayerSkillIndex[TME * HL + i]] == 'QF88' then
			if G6X then
				set U2 = u
				call UnitRemoveAbility(u,'S3UR')	//小黑A杖
			else
				call UnitAddPermanentAbility(u,'S3UR')
			endif
		endif
		set k = TBE(HeroCommonSkills[PlayerSkillIndex[TME * HL + i]])
		if k > 0 then
			if G6X then
				call HIX(k, u, 1)
			else
				set b = G7X(k, u, 1) or b
			endif
			call G5X(HeroCommonSkills[PlayerSkillIndex[TME * HL + i]], u, G6X)
		endif
		set i = i + 1
	exitwhen i > 4 + ExtraAbilitiesNum  
	endloop
	return b
endfunction
function HFX takes item it returns boolean
	local integer i = UUV(it)
	local integer id = GetItemTypeId(it)
	if id == RealItemTypeId[XCV]or id == RealItemTypeId[XFV]or id == RealItemTypeId[XDV]then
		return true
	endif
	return false
endfunction
function HGX takes integer GTX returns boolean
	return GTX == NXV or GTX == R6V or GTX == R8V or GTX == RYV or GTX == R_V or GTX == R0V or GTX == R2V or GTX == R3V or GTX == R4V or GTX == RZV or GTX == R9V or GTX == IVV or GTX == it_jys
endfunction
function HHX takes integer GTX returns boolean
	return(GTX)== NUV or GTX == RRV or(GTX)== Item_DiffusalBladeLevel1 or(GTX)== Item_DiffusalBladeLevel2 or GTX == NIV or GTX == AIV or(GTX)== Item_MagicStick or(GTX)== Item_MagicWand or GTX == RAV
endfunction
function HJX takes player p returns unit
	local unit u
	local group g = LoginGroup(6)
	local unit HKX = null
	local boolean HLX = false
	call GroupAddGroup(KX, g)
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if OPX(u) and UnitAlive(u) then
			if GetOwningPlayer(u)== p then
				set HKX = u
			exitwhen true
			elseif GetPlayerAlliance(GetOwningPlayer(u), p, ALLIANCE_SHARED_CONTROL) then
				if HKX == null or HLX then
					set HKX = u
				endif
			elseif IsUnitAlly(u, p) then
				if HKX == null then
					set HKX = u
					set HLX = true
				endif
			endif
		endif
		call GroupRemoveUnit(g, u)
	endloop
	set u = null
	call LogoutGroup(g)
	set U2 = HKX
	set HKX = null
	return U2
endfunction
function HMX takes item it, player p returns nothing
	local unit u = HJX(p)
	if u == null then
		return
	endif
	if UnitItemInSlot(u, 0)== null or UnitItemInSlot(u, 1)== null or UnitItemInSlot(u, 2)== null or UnitItemInSlot(u, 3)== null or UnitItemInSlot(u, 4)== null or UnitItemInSlot(u, 5)== null then
		call UnitAddItem(u, it)
	else
		set U2 = u
		call RemoveItem(it)
		call ExecuteFunc("HPX")
	endif
	set u = null
endfunction
function HQX takes item UWV returns boolean
	return UUV(UWV)== ASV or UUV(UWV)== ATV or UUV(UWV)== X4V or UUV(UWV)== X5V
endfunction
function HSX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer UYV =(LoadInteger(HY, h, 74))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local player p =(LoadPlayerHandle(HY, h, 54))
	local boolean HTX =(LoadBoolean(HY, h, 75))
	local integer HUX =(LoadInteger(HY, h, 76))
	local item HWX = CreateItem(UYV, x, y)
	call SetItemPlayer(HWX, p, true)
	call SetItemUserData(HWX, 0)
	if HQX(HWX) then
		call SetItemInvulnerable(HWX, true)
	endif
	if HTX then
		call SetItemCharges(HWX, HUX)
	endif
	if UYV == PowerUpItemTypeId[BUV]then
		call HMX(HWX, p)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set p = null
	set HWX = null
	return false
endfunction
function HYX takes integer UYV, real x, real y, player p, boolean HTX, integer HUX returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveInteger(HY, h, 74,(UYV))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call SavePlayerHandle(HY, h, 54,(p))
	call SaveBoolean(HY, h, 75,(HTX))
	call SaveInteger(HY, h, 76,(HUX))
	call TriggerAddCondition(t, Condition(function HSX))
	call TriggerRegisterTimerEvent(t, 0, false)
	set t = null
endfunction
function HZX takes item UWV returns nothing
	call DisableTrigger(CUV)
	call RemoveItem(UWV)
	call EnableTrigger(CUV)
endfunction
function H_X takes unit U6E returns integer
	local integer i = 0
	local integer n = 0
	local integer H0X = UnitInventorySize(U6E)-1
	loop
	exitwhen i > H0X
		if UnitItemInSlot(U6E, i)== null then
			set n = n + 1
		endif
		set i = i + 1
	endloop
	return n
endfunction
function H1X takes item UWV returns integer
	local integer UYV
	local integer i = 1
	if UWV == null then
		return -2
	endif
	set UYV = GetItemTypeId(UWV)
	loop
	exitwhen i > ItemMaxNum
		if InvalidItemTypeId[i]== UYV then
			return i
		endif
		set i = i + 1
	endloop
	return -1
endfunction
function H2X takes item UWV returns integer
	local integer UYV
	local integer i = 1
	if UWV == null then
		return -2
	endif
	set UYV = GetItemTypeId(UWV)
	loop
	exitwhen i > ItemMaxNum
		if InvalidItemTypeId[i]== UYV then
			return RealItemTypeId[i]
		endif
		set i = i + 1
	endloop
	return -1
endfunction
function H3X takes unit U6E returns integer
	local integer H4X
	local integer i = 0
	if U6E == null then
		return -2
	endif
	set H4X = GetUnitTypeId(U6E)
	loop
	exitwhen i > ItemMaxNum
		if SellItemTypeId[i]== H4X then
			return i
		endif
		set i = i + 1
	endloop
	return -1
endfunction
function H5X takes item H6X returns string
	if H6X == null then
		return "UI\\Widgets\\Console\\Undead\\undead-inventory-slotfiller.blp"
	endif
	return itemIconPath[UUV(H6X)]
endfunction
function H7X takes integer GTX returns integer
	if R0V == GTX then
		return 4
	endif
	if R3V == GTX or R8V == GTX then
		return 2
	endif
	return 1
endfunction
function H8X takes item UWV returns boolean
	return GetItemType(UWV)== ITEM_TYPE_POWERUP or GetItemType(UWV)== ITEM_TYPE_PURCHASABLE or GetItemType(UWV)== ITEM_TYPE_MISCELLANEOUS
endfunction
function H9X takes unit triggerUnit returns real
	local real JVX
	if IsSentinelsPlayer(GetOwningPlayer(triggerUnit)) then
		set JVX = GetRectCenterX(VZ)
	else
		set JVX = GetRectCenterX(GY)
	endif
	return JVX
endfunction
function JEX takes unit triggerUnit returns real
	local real JVX
	if IsSentinelsPlayer(GetOwningPlayer(triggerUnit)) then
		set JVX = GetRectCenterY(VZ)
	else
		set JVX = GetRectCenterY(GY)
	endif
	return JVX
endfunction
function JXX takes unit triggerUnit, item C1X, integer JOX returns nothing
	local real x = H9X(triggerUnit)
	local real y = JEX(triggerUnit)
	local integer i = 0
	local boolean array b
	local item JRX
	call DisableTrigger(CUV)
	loop
	exitwhen i >(UnitInventorySize(triggerUnit)-1)
		if UnitItemInSlot(triggerUnit, i)== null and i != JOX then
			set JRX = CreateItem('I02M', x, y)
			call UnitAddItem(triggerUnit, JRX)
			set b[i]= true
		else
			set b[i]= false
		endif
		if i == JOX then
			call EnableTrigger(CUV)
			call UnitAddItem(triggerUnit, C1X)
			call DisableTrigger(CUV)
		endif
		set i = i + 1
	endloop
	set i = 0
	loop
	exitwhen i > 5
		if b[i]then
			call RemoveItem(UnitItemInSlot(triggerUnit, i))
		endif
		set i = i + 1
	endloop
	call EnableTrigger(CUV)
	set Z2 = C1X
	set C1X = null
	set JRX = null
endfunction
function JIX takes unit triggerUnit, integer JAX, integer JNX returns item
	local real x = H9X(triggerUnit)
	local real y = JEX(triggerUnit)
	local item C1X = CreateItem(JAX, x, y)
	local integer i = 0
	local boolean array JBX
	local item JCX
	call DisableTrigger(CUV)
	if JAX > 0 then
		loop
		exitwhen i >(UnitInventorySize(triggerUnit)-1)
			if UnitItemInSlot(triggerUnit, i)== null and i != JNX then
				set JCX = CreateItem('I02M', x, y)
				call UnitAddItem(triggerUnit, JCX)
				set JBX[i]= true
			else
				set JBX[i]= false
			endif
			if i == JNX then
				call EnableTrigger(CUV)
				call UnitAddItem(triggerUnit, C1X)
				call DisableTrigger(CUV)
			endif
			set i = i + 1
		endloop
		set i = 0
		loop
		exitwhen i > 5
			if JBX[i]then
				call RemoveItem(UnitItemInSlot(triggerUnit, i))
			endif
			set i = i + 1
		endloop
	endif
	call EnableTrigger(CUV)
	set Z2 = C1X
	set C1X = null
	set JCX = null
	return Z2
endfunction
// 储存单位的RGB
function JDX takes integer XIX, integer r, integer g, integer b returns nothing
	set J4 = J4 + 1
	set N4[J4]= r
	set B4[J4]= g
	set C4[J4]= b
	set H4[J4]= XIX
endfunction
function SaveColorToUnitType takes integer whichTypeId, integer r, integer g, integer b returns nothing
	if r >-1 and r < 256 then
		call SaveInteger(L, whichTypeId, 0, r)
	endif
	if g >-1 and g < 256 then
		call SaveInteger(L, whichTypeId, 1, g)
	endif
	if b >-1 and b < 256 then
		call SaveInteger(L, whichTypeId, 2, b)
	endif
endfunction
function JKX takes unit u returns nothing
	local integer id = GetUnitTypeId(u)
	local integer i = 1
	local integer a = 255
	local boolean JLX = false
	if id =='Ewar' then
		set a = R2I(2.55 *( 100 -18 + 20 * GetUnitAbilityLevel(u,'P239')))
	endif
	loop
	exitwhen i > J4 or JLX
		if H4[i]== id then
			set JLX = true
			call SetUnitVertexColor(u, N4[i], B4[i], C4[i], a)
		endif
		set i = i + 1
	endloop
	if JLX == false then
		call SetUnitVertexColor(u, 255, 255, 255, 255)
	endif
endfunction
function JMX takes player p, string JPX, integer JQX returns nothing
	local string id = I2S(GetPlayerId(p))
	call StoreInteger(K4, id, JPX, JQX)
	if IsPlaying(HostPlayer)== false then
		call O2X()
	endif
	if LocalPlayer== HostPlayer then
		call SyncStoredInteger(K4, id, JPX)
	endif
endfunction
function JSX takes string JTX, integer JQX returns nothing
	call StoreInteger(K4, "Data", JTX, JQX)
	if IsPlaying(HostPlayer)== false then
		call O2X()
	endif
	if LocalPlayer== HostPlayer then
		call SyncStoredInteger(K4, "Data", JTX)
	endif
endfunction
function JUX takes string s, string JWX, string JYX returns string
	local string JZX = ""
	local integer i = 0
	local integer J_X = StringLength(s)
	local string J0X
	local integer J1X = StringLength(JWX)
	local boolean JLX = false
	loop
	exitwhen i + 1 > J_X
		set J0X = SubString(s, i, i + J1X)
		if J0X != JWX or JLX then
			set JZX = JZX + SubString(s, i, i + 1)
			set i = i + 1
		else
			set JZX = JZX + JYX
			set i = i + J1X
			set JLX = true
		endif
	endloop
	return JZX
endfunction
function J2X takes player J3X, player J4X returns string
	local string s = GetObjectName('n0C8')
	set s = JUX(s, "$dead", JS[GetPlayerId(J3X)]+(VMV[GetPlayerId((J3X))])+ "|r")
	set s = JUX(s, "$killer", JS[GetPlayerId(J4X)]+(VMV[GetPlayerId((J4X))])+ "|r")
	return s
endfunction

function J6X takes unit u, integer d returns nothing
	local integer h = GetHandleId(u)
	local integer J7X = LoadInteger(P, h,'MSPC')
	if IsUnitType(u, UNIT_TYPE_HERO) then
		call LodSystem_AddUnitExtraState(u, d * 0.01, STATE_SYSTEM_PERCENT_MOVE)
		call SaveInteger(P, h,'MSPC', d + J7X)
	endif
endfunction
function J8X takes unit u, integer d returns nothing
	local integer h = GetHandleId(u)
	local integer J7X = LoadInteger(P, h,'MSPC')
	if IsUnitType(u, UNIT_TYPE_HERO) then
		call LodSystem_AddUnitExtraState(u, -d * 0.01, STATE_SYSTEM_PERCENT_MOVE)
		call SaveInteger(P, h,'MSPC', J7X -d)
	endif
endfunction
function J9X takes unit u, integer d returns nothing
	local integer array b
	local integer a = d
	local integer c = 1
	local integer i = 0
	local integer k
	if d < 1 then
		call UnitRemoveAbility(u, Q4[0])
		call UnitRemoveAbility(u, Q4[1])
		call UnitRemoveAbility(u, Q4[2])
		call UnitRemoveAbility(u, Q4[3])
		call UnitRemoveAbility(u, Q4[4])
		call UnitRemoveAbility(u, Q4[5])
		call UnitRemoveAbility(u, Q4[6])
		call UnitRemoveAbility(u, Q4[7])
		call UnitRemoveAbility(u, Q4[8])
		call UnitRemoveAbility(u, Q4[9])
		call UnitRemoveAbility(u, Q4[10])
		call UnitRemoveAbility(u, Q4[11])
		return
	endif
	loop
	exitwhen c == 0
		set c = a / 2
		set b[i]= a -c * 2
		set a = c
		set i = i + 1
	endloop
	set k =$B
	set i = 0
	loop
	exitwhen i > k
		if b[i]== 1 then
			call UnitAddPermanentAbility(u, Q4[i])
		else
			call UnitRemoveAbility(u, Q4[i])
		endif
		set i = i + 1
	endloop
endfunction
function KVX takes unit u returns nothing
	local integer h = GetHandleId(u)
	local integer i = 0
	set i = i + LoadInteger(HY, h,'a068')
	set i = i + LoadInteger(HY, h,'a272')
	set i = i + LoadInteger(HY, h,'a430')
	set i = i + LoadInteger(HY, h,'axxx')
	set i = i + LoadInteger(K, GetHandleId(GetOwningPlayer(u)),'DDUE')
	call J9X(u, i)
endfunction

// 二进制属性系统增加生命值
// 优化为 设置单位最大生命值 会按当前比例改变
function UnitAddMaxLife takes unit whichUnit, real value returns nothing
    local real currenMaxlife = GetUnitState( whichUnit, UNIT_STATE_MAX_LIFE )
	local real currentLife = GetWidgetLife( whichUnit )
	local real addMaxLife
	set addMaxLife = currenMaxlife + value
	call SetUnitState(whichUnit, UNIT_STATE_MAX_LIFE, addMaxLife)
	// debug call SingleDebug( GetUnitName(whichUnit) + " 增加生命值 " + R2S(value) + " 当前生命值" + R2S( GetWidgetLife(whichUnit) ) )
	// 存活 才会改变生命值 并且如果 减少生命值时 如果满血不会再减
	if UnitAlive(whichUnit) and ( currentLife != addMaxLife ) then
		// debug call SingleDebug( GetUnitName(whichUnit) + " 设置生命值 " + R2S(currentLife * (addMaxLife / currenMaxlife) ) )
		call SetWidgetLife(whichUnit, currentLife * (addMaxLife / currenMaxlife) )
	endif
endfunction

// 设置单位最大魔法值 会按当前比例改变
function UnitAddMaxMana takes unit whichUnit, real value returns nothing
local real maxmana = GetUnitState(whichUnit, UNIT_STATE_MAX_MANA)
local real mana = GetUnitState(whichUnit, UNIT_STATE_MANA)
set value = maxmana + value
call SetUnitState(whichUnit, UNIT_STATE_MAX_MANA, value)
if UnitAlive(whichUnit) then
	if maxmana == mana then
		call SetUnitState(whichUnit, UNIT_STATE_MANA, value)
	else
		call SetUnitState(whichUnit, UNIT_STATE_MANA, GetUnitState(whichUnit, UNIT_STATE_MANA) * (value / maxmana) )
	endif
endif
endfunction

function KIX takes unit WUE returns integer
	local integer OVX = GetUnitTypeId(WUE)
	local integer KAX ='o01P'
	if OVX =='Udre' or OVX =='H071' then
		set KAX ='o01N'
	endif
	return KAX
endfunction
function KNX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		call KillUnit(dummyUnit)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SetUnitX(dummyUnit, GetUnitX(WUE))
		call SetUnitY(dummyUnit, GetUnitY(WUE))
	endif
	set t = null
	set WUE = null
	set dummyUnit = null
	return false
endfunction
function KCX takes unit WUE returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE), KIX(WUE), GetUnitX(WUE), GetUnitY(WUE), 0)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function KNX))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	set t = null
	set dummyUnit = null
endfunction
function KDX takes integer H4X returns boolean
	local integer i = 0
	loop
	exitwhen i > 59
		if H4X == U4[i]then
			return true
		endif
		set i = i + 1
	endloop
	return false
endfunction
function KFX takes integer level returns integer
	local real KGX = GetGameTime()-WQ
	local real C8X =(R2I(KGX)/ 60)-(1 / 2)
	local real KHX = 100 + level * level * 1.5 + C8X *$F
	local integer ADX
	set ADX = R2I(KHX / 50)
	set ADX = IMinBJ(ADX, 59)
	set ADX = IMaxBJ(ADX, 0)
	return ADX
endfunction
function KJX takes unit KKX returns integer
	local integer WPV = GetUnitTypeId(KKX)
	local integer KLX ='o01P'
	if WPV =='Udre' or WPV =='H071' then
		set KLX ='o01N'
	endif
	return KLX
endfunction
function KMX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit KKX =(LoadUnitHandle(HY, h, 2))
	local unit W_V =(LoadUnitHandle(HY, h, 19))
	if GetTriggerEventId()== EVENT_UNIT_DEATH or KKX == null then
		call KillUnit(W_V)
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	else
		call SetUnitX(W_V, GetUnitX(KKX))
		call SetUnitY(W_V, GetUnitY(KKX))
	endif
	set t = null
	set KKX = null
	set W_V = null
	return false
endfunction
// 创建死亡时的视野马甲
function KPX takes unit u returns nothing
	local trigger t
	local integer h
	local unit d = null
	if UnitAlive(LoadUnitHandle(HY, GetHandleId(u),'VisD')) then
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	set d = CreateUnit(GetOwningPlayer(u), KJX(u), GetUnitX(u), GetUnitY(u), 0)
	call TriggerRegisterTimerEvent(t, .1, true)
	call SaveUnitHandle(HY, GetHandleId(u),'VisD', d)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function KMX))
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveUnitHandle(HY, h, 19,(d))
	set t = null
	set d = null
endfunction
function KQX takes player p returns nothing
	local integer id = GetPlayerId(p)
	local unit KSX = Circle[id]
	local unit triggerUnit = Player__Hero[id]
	local integer level = GetHeroLevel(triggerUnit)
	local integer i = 0
	call KPX(triggerUnit)
	loop
	exitwhen i > 59
		call RemoveUnitFromStock(KSX, U4[i])
		set i = i + 1
	endloop
	if Mode__DeathMatch then
		return
	endif
	if FRV == false then
		set KSX = null
		set triggerUnit = null
		return
	endif
	call AddUnitToStock(KSX, U4[KFX(level)], 1, 1)
	set W4[id]= U4[KFX(level)]
	set triggerUnit = null
	set KSX = null
endfunction
function KTX takes player p returns nothing
	local integer id = GetPlayerId(p)
	local unit c = Circle[id]
	local unit triggerUnit = Player__Hero[id]
	local integer level = GetHeroLevel(triggerUnit)
	local integer i = 0
	if Mode__DeathMatch then
		set c = null
		set triggerUnit = null
		return
	endif
	if FRV == false then
		set c = null
		set triggerUnit = null
		return
	endif
	if W4[id]=='h0D4' then
		set c = null
		set triggerUnit = null
		return
	endif
	if W4[id]!= 0 then
		call RemoveUnitFromStock(c, W4[id])
	endif
	call AddUnitToStock(c, U4[KFX(level)], 1, 1)
	set W4[id]= U4[KFX(level)]
	set triggerUnit = null
	set c = null
endfunction
function KUX takes nothing returns boolean
	if Mode__DeathMatch then
		return false
	endif
	call KTX(Sentinels[1])
	call KTX(Sentinels[2])
	call KTX(Sentinels[3])
	call KTX(Sentinels[4])
	call KTX(Sentinels[5])
	call KTX(Scourges[1])
	call KTX(Scourges[2])
	call KTX(Scourges[3])
	call KTX(Scourges[4])
	call KTX(Scourges[5])
	return false
endfunction
function KWX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer id =(LoadInteger(HY, h, 34))
	local unit KSX = Circle[id]
	local unit triggerUnit = Player__Hero[id]
	local integer level = GetHeroLevel(triggerUnit)
	local integer i = 0
	call RemoveUnitFromStock(KSX, 'h0D4')
	//call UnitRemoveAbility(KSX,'A20U')
	call AddUnitToStock(KSX, U4[KFX(level)], 1, 1)
	set W4[id]= U4[KFX(level)]
	call DestroyTimerAndFlushHT_HY(t) 
	set t = null
	set KSX = null
	set triggerUnit = null
endfunction
//function KYX takes player p returns nothing
//	local integer id = GetPlayerId(p)
//	local unit KSX = Circle[id]
//	local unit triggerUnit = Player__Hero[id]
//	local integer level = GetHeroLevel(triggerUnit)
//	local integer i = 0
//	local trigger t = CreateTrigger()
//	local integer h = GetHandleId(t)
//	call KCX(triggerUnit)
//	loop
//	exitwhen i > 59
//		call RemoveUnitFromStock(KSX, U4[i])
//		set i = i + 1
//	endloop
//	call TriggerAddCondition(t, Condition(function KWX))
//	call TriggerRegisterTimerEvent(t, 420, false)
//	call SaveInteger(HY, h, 34,(id))
//	set W4[id]='h0D4'
//	call RemoveUnitFromStock(KSX, 'h0D4')
//	call AddUnitToStock(KSX, 'h0D4', 0, 1)
//	//call UnitAddAbility(KSX,'A20U')
//	//call IssueImmediateOrderById(KSX,852526)
//	set triggerUnit = null
//	set KSX = null
//	set t = null
//endfunction
//改成timer 可以得知还需要多久买活冷却结束
function KYX takes player p returns nothing
	local integer id = GetPlayerId(p)
	local unit KSX = Circle[id]
	local unit triggerUnit = Player__Hero[id]
	local integer level = GetHeroLevel(triggerUnit)
	local integer i = 0
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call KCX(triggerUnit)
	loop
	exitwhen i > 59
		call RemoveUnitFromStock(KSX, U4[i])
		set i = i + 1
	endloop
	if LocalPlayer == GetOwningPlayer(triggerUnit) then
		set PlayerBuyback_Timer = t
	endif
	call TimerStart(t, 420., false, function KWX)
	call SaveInteger(HY, h, 34,(id))
	set W4[id]='h0D4'
	call RemoveUnitFromStock(KSX, 'h0D4')
	call AddUnitToStock(KSX, 'h0D4', 0, 1)
	//call UnitAddAbility(KSX,'A20U')
	//call IssueImmediateOrderById(KSX,852526)
	set triggerUnit = null
	set KSX = null
	set t = null
endfunction
function KZX takes nothing returns nothing
	set VQV[GetPlayerId(Sentinels[1])]= 0
	set VSV[GetPlayerId(Sentinels[1])]= 66
	set VTV[GetPlayerId(Sentinels[1])]= 255
	set VQV[GetPlayerId(Sentinels[2])]= 48
	set VSV[GetPlayerId(Sentinels[2])]=$E6
	set VTV[GetPlayerId(Sentinels[2])]=$B9
	set VQV[GetPlayerId(Sentinels[3])]= 50
	set VSV[GetPlayerId(Sentinels[3])]= 0
	set VTV[GetPlayerId(Sentinels[3])]=$81
	set VQV[GetPlayerId(Sentinels[4])]= 255
	set VSV[GetPlayerId(Sentinels[4])]=$FC
	set VTV[GetPlayerId(Sentinels[4])]= 1
	set VQV[GetPlayerId(Sentinels[5])]= 255
	set VSV[GetPlayerId(Sentinels[5])]= 50
	set VTV[GetPlayerId(Sentinels[5])]= 0
	set VQV[GetPlayerId(Scourges[1])]=$DC
	set VSV[GetPlayerId(Scourges[1])]= 50
	set VTV[GetPlayerId(Scourges[1])]= 50
	set VQV[GetPlayerId(Scourges[2])]= 50
	set VSV[GetPlayerId(Scourges[2])]= 50
	set VTV[GetPlayerId(Scourges[2])]= 50
	set VQV[GetPlayerId(Scourges[3])]= 75
	set VSV[GetPlayerId(Scourges[3])]=$96
	set VTV[GetPlayerId(Scourges[3])]=$BE
	set VQV[GetPlayerId(Scourges[4])]= 16
	set VSV[GetPlayerId(Scourges[4])]= 60
	set VTV[GetPlayerId(Scourges[4])]= 18
	set VQV[GetPlayerId(Scourges[5])]= 68
	set VSV[GetPlayerId(Scourges[5])]= 42
	set VTV[GetPlayerId(Scourges[5])]= 4
endfunction
function K_X takes nothing returns nothing
	local integer O3X
	local integer K0X
	local integer i
	set JS[GetPlayerId(Sentinels[0])]= "|c00ff0303"
	set JS[GetPlayerId(Sentinels[1])]= "|c000042ff"
	set JS[GetPlayerId(Sentinels[2])]= "|c001ce6b9"
	set JS[GetPlayerId(Sentinels[3])]= "|c00540081"
	set JS[GetPlayerId(Sentinels[4])]= "|c00fffc01"
	set JS[GetPlayerId(Sentinels[5])]= "|c00ff8000"
	set JS[GetPlayerId(Scourges[0])]= "|c0020c000"
	set JS[GetPlayerId(Scourges[1])]= "|c00e55bb0"
	set JS[GetPlayerId(Scourges[2])]= "|c00959697"
	set JS[GetPlayerId(Scourges[3])]= "|c007ebff1"
	set JS[GetPlayerId(Scourges[4])]= "|c00106246"
	set JS[GetPlayerId(Scourges[5])]= "|c004e2a04"
	call SetPlayerColor(Sentinels[0], PLAYER_COLOR_RED)
	call SetPlayerColor(Sentinels[1], PLAYER_COLOR_BLUE)
	call SetPlayerColor(Sentinels[2], PLAYER_COLOR_CYAN)
	call SetPlayerColor(Sentinels[3], PLAYER_COLOR_PURPLE)
	call SetPlayerColor(Sentinels[4], PLAYER_COLOR_YELLOW)
	call SetPlayerColor(Sentinels[5], PLAYER_COLOR_ORANGE)
	call SetPlayerColor(Scourges[0], PLAYER_COLOR_GREEN)
	call SetPlayerColor(Scourges[1], PLAYER_COLOR_PINK)
	call SetPlayerColor(Scourges[2], PLAYER_COLOR_LIGHT_GRAY)
	call SetPlayerColor(Scourges[3], PLAYER_COLOR_LIGHT_BLUE)
	call SetPlayerColor(Scourges[4], PLAYER_COLOR_AQUA)
	call SetPlayerColor(Scourges[5], PLAYER_COLOR_BROWN)
	set O3X = 1
	set K0X = 5
	loop
		if GetPlayerSlotState(Sentinels[O3X])== PLAYER_SLOT_STATE_EMPTY then
			call SetPlayerName(Sentinels[O3X], GetObjectName('n0DH')+ " " + I2S(O3X))
		endif
		if GetPlayerSlotState(Scourges[O3X])== PLAYER_SLOT_STATE_EMPTY then
			call SetPlayerName(Scourges[O3X], GetObjectName('n0DH')+ " " + I2S(5 + O3X))
		endif
		set O3X = O3X + 1
	exitwhen O3X > K0X
	endloop
endfunction
function K1X takes nothing returns nothing
	local integer i
	local integer k
	local integer K2X = 125
	call SetUnitOwner(VXV, Sentinels[1], false)
	call SetUnitOwner(VOV, Sentinels[2], false)
	call SetUnitOwner(VRV, Sentinels[3], false)
	call SetUnitOwner(VIV, Sentinels[4], false)
	call SetUnitOwner(VAV, Sentinels[5], false)
	call SetUnitOwner(VNV, Scourges[1], false)
	call SetUnitOwner(VBV, Scourges[2], false)
	call SetUnitOwner(VCV, Scourges[3], false)
	call SetUnitOwner(VDV, Scourges[4], false)
	call SetUnitOwner(VFV, Scourges[5], false)
	set Circle[GetPlayerId(Sentinels[1])]= VXV
	set Circle[GetPlayerId(Sentinels[2])]= VOV
	set Circle[GetPlayerId(Sentinels[3])]= VRV
	set Circle[GetPlayerId(Sentinels[4])]= VIV
	set Circle[GetPlayerId(Sentinels[5])]= VAV
	set Circle[GetPlayerId(Scourges[1])]= VNV
	set Circle[GetPlayerId(Scourges[2])]= VBV
	set Circle[GetPlayerId(Scourges[3])]= VCV
	set Circle[GetPlayerId(Scourges[4])]= VDV
	set Circle[GetPlayerId(Scourges[5])]= VFV
	set i = 1
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 2
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 3
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 4
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 5
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 7
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 8
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 9
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i =$A
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i =$B
	if LocalPlayer== Player(i) then
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, 255)
	else
		call SetUnitVertexColor(Circle[GetPlayerId(Player(i))], 255, 255, 255, K2X)
	endif
	set i = 1
	loop
		set k = GetPlayerId(Sentinels[i])
		set VHV[k]= GetUnitX(Circle[k])
		set VJV[k]= GetUnitY(Circle[k])
		set k = GetPlayerId(Scourges[i])
		set VHV[k]= GetUnitX(Circle[k])
		set VJV[k]= GetUnitY(Circle[k])
		set i = i + 1
	exitwhen i > 5
	endloop
endfunction
function K3X takes unit K4X returns boolean
	local integer ID = GetUnitTypeId(K4X)
	if ID =='n00V' or ID =='n00W' or ID =='n002' or ID =='n00X' or ID =='nC38' or ID =='n01K' or ID =='n009' then
		return true
	endif
	return false
endfunction
function K5X takes nothing returns nothing
	if(GetOwningPlayer(GetEnumUnit())== Player(0)) then
		call SetUnitOwner(GetEnumUnit(), Sentinels[0], false)
		if K3X(GetEnumUnit())== false then
			call SetUnitColor(GetEnumUnit(), ConvertPlayerColor(0))
		endif
	else
		call SetUnitOwner(GetEnumUnit(), Scourges[0], false)
		if K3X(GetEnumUnit())== false then
			call SetUnitColor(GetEnumUnit(), ConvertPlayerColor(6))
		endif
	endif
endfunction
function K6X takes nothing returns nothing
	local group g = LoginGroup(7)
	call GroupEnumUnitsOfPlayer(g, Player(0), TrueBoolexprCondition)
	call ForGroup(g, function K5X)
	call GroupClear(g)
	call GroupEnumUnitsOfPlayer(g, Player(6), TrueBoolexprCondition)
	call ForGroup(g, function K5X)
	call LogoutGroup(g)
	set g = null
endfunction
function K7X takes player p returns nothing
	local integer i = 0
	local string K8X = GetPlayerName(p)
	local integer J_X = StringLength(K8X)
	local integer K9X = J_X
	loop
	exitwhen i == J_X
		if SubString(K8X, i, i + 1)== "("and SubString(K8X, i -1, i)== " "then
			set K9X = i -1
			call SetPlayerName(p, SubString(K8X, 0, K9X))
			set i = J_X
		else
			set i = i + 1
		endif
	endloop
endfunction
function LVX takes string s returns string
	local integer i = 0
	local integer LEX = StringLength(s)
	local string ss = ""
	local string p
	loop
	exitwhen i == LEX
		set p = SubString(s, i, i + 1)
		if i + 1 == LEX and p == "|" then
			set ss = ss + "||"
		else
			set ss = ss + p
		endif
		set i = i + 1
	endloop
	return ss
endfunction

// 初始化OB
function InitObserverPlayer takes nothing returns nothing	//OB是否存在 MW来判断
	local integer LOX
	local integer LRX
	local integer O3X
	local integer K0X
	local integer x = 0
	local integer y = 0
	local integer i
	local trigger t = null
	local location LIX = GetRectCenter(LZ)
	local location LAX = GetRectCenter(MZ)
	if GetPlayerState(Sentinels[0], PLAYER_STATE_OBSERVER)!= 0 or GetPlayerState(Scourges[0], PLAYER_STATE_OBSERVER)!= 0 then
		set MW = true
		set Sentinels[0]= Player($D)
		set Scourges[0]= Player($E)
		set VKV = Player(0)
		set VLV = Player(6)
		set GV = GetPlayerName(VKV)== "ohsystem.net"
		call SetAllyColorFilterState(0)
		loop
		exitwhen x > 5
			call SetPlayerAlliance(Player(0), Sentinels[x], ALLIANCE_PASSIVE, true)
			call SetPlayerAlliance(Player(0), Sentinels[x], ALLIANCE_SHARED_SPELLS, true)
			call SetPlayerAlliance(Player(0), Scourges[x], ALLIANCE_PASSIVE, false)
			call SetPlayerAlliance(Player(0), Scourges[x], ALLIANCE_SHARED_SPELLS, false)
			set x = x + 1
		endloop
	endif
	call ForceAddPlayer(RW, Sentinels[0])
	call ForceAddPlayer(RW, Sentinels[1])
	call ForceAddPlayer(RW, Sentinels[2])
	call ForceAddPlayer(RW, Sentinels[3])
	call ForceAddPlayer(RW, Sentinels[4])
	call ForceAddPlayer(RW, Sentinels[5])
	call ForceAddPlayer(IW, Scourges[0])
	call ForceAddPlayer(IW, Scourges[1])
	call ForceAddPlayer(IW, Scourges[2])
	call ForceAddPlayer(IW, Scourges[3])
	call ForceAddPlayer(IW, Scourges[4])
	call ForceAddPlayer(IW, Scourges[5])
	call ForceAddPlayer(XY, Sentinels[1])
	call ForceAddPlayer(XY, Sentinels[2])
	call ForceAddPlayer(XY, Sentinels[3])
	call ForceAddPlayer(XY, Sentinels[4])
	call ForceAddPlayer(XY, Sentinels[5])
	call ForceAddPlayer(XY, Scourges[1])
	call ForceAddPlayer(XY, Scourges[2])
	call ForceAddPlayer(XY, Scourges[3])
	call ForceAddPlayer(XY, Scourges[4])
	call ForceAddPlayer(XY, Scourges[5])
	if MW then
		call ForceAddPlayer(XY, Player(0))
		call ForceAddPlayer(XY, Player(6))
	endif
	set x = 0
	set y = 0
	loop
	exitwhen x > 5
		loop
		exitwhen y > 5
			if(x != y) then
				call SetPlayerAlliance(Sentinels[x], Sentinels[y], ALLIANCE_PASSIVE, true)
				call SetPlayerAlliance(Sentinels[x], Sentinels[y], ALLIANCE_HELP_REQUEST, true)
				call SetPlayerAlliance(Sentinels[x], Sentinels[y], ALLIANCE_HELP_RESPONSE, true)
				call SetPlayerAlliance(Sentinels[x], Sentinels[y], ALLIANCE_SHARED_XP, true)
				call SetPlayerAlliance(Sentinels[x], Sentinels[y], ALLIANCE_SHARED_SPELLS, true)
				call SetPlayerAlliance(Sentinels[x], Sentinels[y], ALLIANCE_SHARED_VISION, true)
				call SetPlayerAlliance(Sentinels[x], Sentinels[y], ALLIANCE_SHARED_CONTROL, false)
				call SetPlayerAlliance(Sentinels[x], Sentinels[y], ALLIANCE_SHARED_ADVANCED_CONTROL, false)
				call SetPlayerAlliance(Scourges[x], Scourges[y], ALLIANCE_PASSIVE, true)
				call SetPlayerAlliance(Scourges[x], Scourges[y], ALLIANCE_HELP_REQUEST, true)
				call SetPlayerAlliance(Scourges[x], Scourges[y], ALLIANCE_HELP_RESPONSE, true)
				call SetPlayerAlliance(Scourges[x], Scourges[y], ALLIANCE_SHARED_XP, true)
				call SetPlayerAlliance(Scourges[x], Scourges[y], ALLIANCE_SHARED_SPELLS, true)
				call SetPlayerAlliance(Scourges[x], Scourges[y], ALLIANCE_SHARED_VISION, true)
				call SetPlayerAlliance(Scourges[x], Scourges[y], ALLIANCE_SHARED_CONTROL, false)
				call SetPlayerAlliance(Scourges[x], Scourges[y], ALLIANCE_SHARED_ADVANCED_CONTROL, false)
				call SetPlayerAlliance(Sentinels[x], Scourges[y], ALLIANCE_PASSIVE, false)
				call SetPlayerAlliance(Sentinels[x], Scourges[y], ALLIANCE_HELP_REQUEST, false)
				call SetPlayerAlliance(Sentinels[x], Scourges[y], ALLIANCE_HELP_RESPONSE, false)
				call SetPlayerAlliance(Sentinels[x], Scourges[y], ALLIANCE_SHARED_XP, false)
				call SetPlayerAlliance(Sentinels[x], Scourges[y], ALLIANCE_SHARED_SPELLS, false)
				call SetPlayerAlliance(Sentinels[x], Scourges[y], ALLIANCE_SHARED_VISION, false)
				call SetPlayerAlliance(Sentinels[x], Scourges[y], ALLIANCE_SHARED_CONTROL, false)
				call SetPlayerAlliance(Sentinels[x], Scourges[y], ALLIANCE_SHARED_ADVANCED_CONTROL, false)
				call SetPlayerAlliance(Scourges[x], Sentinels[y], ALLIANCE_PASSIVE, false)
				call SetPlayerAlliance(Scourges[x], Sentinels[y], ALLIANCE_HELP_REQUEST, false)
				call SetPlayerAlliance(Scourges[x], Sentinels[y], ALLIANCE_HELP_RESPONSE, false)
				call SetPlayerAlliance(Scourges[x], Sentinels[y], ALLIANCE_SHARED_XP, false)
				call SetPlayerAlliance(Scourges[x], Sentinels[y], ALLIANCE_SHARED_SPELLS, false)
				call SetPlayerAlliance(Scourges[x], Sentinels[y], ALLIANCE_SHARED_VISION, false)
				call SetPlayerAlliance(Scourges[x], Sentinels[y], ALLIANCE_SHARED_CONTROL, false)
				call SetPlayerAlliance(Scourges[x], Sentinels[y], ALLIANCE_SHARED_ADVANCED_CONTROL, false)
			endif
			set y = y + 1
		endloop
		set y = 0
		set x = x + 1
	endloop
	call SetPlayerTeam(Sentinels[0], 0)
	call SetPlayerTeam(Sentinels[1], 0)
	call SetPlayerTeam(Sentinels[2], 0)
	call SetPlayerTeam(Sentinels[3], 0)
	call SetPlayerTeam(Sentinels[4], 0)
	call SetPlayerTeam(Sentinels[5], 0)
	call SetPlayerTeam(Scourges[0], 1)
	call SetPlayerTeam(Scourges[1], 1)
	call SetPlayerTeam(Scourges[2], 1)
	call SetPlayerTeam(Scourges[3], 1)
	call SetPlayerTeam(Scourges[4], 1)
	call SetPlayerTeam(Scourges[5], 1)
	call SetPlayerName(Sentinels[0], GetObjectName('n03N'))
	call SetPlayerName(Scourges[0], GetObjectName('n03O'))
	call SetPlayerName(BW, GetObjectName('n0E8'))
	call K1X()
	if(Sentinels[0]!= Player(0) or Scourges[0]!= Player(6)) then
		call K6X()
	endif
	call K_X()
	set LRX = XMX(RW)
	set LOX = XMX(IW)
	set O3X = 1
	set K0X = 5
	loop
	exitwhen O3X > K0X
		if(IsPlaying(Sentinels[O3X])) then
			call SetPlayerState(Sentinels[O3X], PLAYER_STATE_RESOURCE_GOLD,(4375 / LRX))
			call SetPlayerState(Sentinels[O3X], PLAYER_STATE_RESOURCE_LUMBER, 0)
		endif
		if(IsPlaying(Scourges[O3X])) then
			call SetPlayerState(Scourges[O3X], PLAYER_STATE_RESOURCE_GOLD,(4375 / LOX))
			call SetPlayerState(Scourges[O3X], PLAYER_STATE_RESOURCE_LUMBER, 0)
		endif
		set O3X = O3X + 1
	endloop
	call SetPlayerHandicapXP(Sentinels[1], 1)
	call SetPlayerHandicapXP(Sentinels[2], 1)
	call SetPlayerHandicapXP(Sentinels[3], 1)
	call SetPlayerHandicapXP(Sentinels[4], 1)
	call SetPlayerHandicapXP(Sentinels[5], 1)
	call SetPlayerHandicapXP(Scourges[1], 1)
	call SetPlayerHandicapXP(Scourges[2], 1)
	call SetPlayerHandicapXP(Scourges[3], 1)
	call SetPlayerHandicapXP(Scourges[4], 1)
	call SetPlayerHandicapXP(Scourges[5], 1)
	call SetPlayerState(Sentinels[0], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(Sentinels[1], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(Sentinels[2], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(Sentinels[3], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(Sentinels[4], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(Sentinels[5], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(Scourges[0], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(Scourges[1], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(Scourges[2], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(Scourges[3], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(Scourges[4], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(Scourges[5], PLAYER_STATE_GIVES_BOUNTY, 0)
	call SetPlayerState(BW, PLAYER_STATE_GIVES_BOUNTY, 0)
	call O2X()
	call KZX()
	call K7X(Sentinels[1])
	call K7X(Sentinels[2])
	call K7X(Sentinels[3])
	call K7X(Sentinels[4])
	call K7X(Sentinels[5])
	call K7X(Scourges[1])
	call K7X(Scourges[2])
	call K7X(Scourges[3])
	call K7X(Scourges[4])
	call K7X(Scourges[5])
	set x = 1
	loop
	exitwhen x > 5
		if IsPlaying(Sentinels[x]) then
			call YCE(Sentinels[x])
		endif
		if IsPlaying(Scourges[x]) then
			call YCE(Scourges[x])
		endif
		set x = x + 1
	endloop
	call RemoveLocation(LIX)
	call RemoveLocation(LAX)
	set i = 0
	loop
		set VMV[i]= LVX(GetPlayerName(Player(i)))
		set VPV[i]= StringHash(VMV[i])
		set i = i + 1
	exitwhen i == 16
	endloop
	set t = null
	set LIX = null
	set LAX = null
endfunction
function LNX takes integer id returns boolean
	return id =='A0ES' or id =='A43P' or id =='A0QN' or id =='A2TH' or id =='A21F' or id =='A21G' or id =='A21H' or id =='A1S9' or id =='A24A' or id =='A24B' or id =='A1S9' or id =='A06K' or id =='A1VG' or id =='A28Q' or id =='A1WF' or id =='A0T8' or id =='A0T7' or id =='A20N' or id =='A1Z2' or id =='A1Z3' or id =='A205' or id =='A14A' or id =='A269' or id =='A2KG' or id =='A21J' or id =='A27X' or id =='A28Y' or id =='A24E' or id =='A1ZH' or id =='A1WO' or id =='A1FQ' or id =='A0TE' or id =='A2JO' or id =='A2FX' or id =='A0MP' or id =='A2KE' or id =='A2KH' or id =='A2K9' or id =='A2JL' or id =='A2O2' or id =='A2MB' or id =='A21J' or id =='A2MC' or id =='A1NH' or id =='A2LI' or id =='A2TK' or id =='A1MO' or id =='A527' or id =='A528'
endfunction
function LBX takes nothing returns nothing
	call CreateQuestBJ(0, "TRIGSTR_50004", "TRIGSTR_50005", "ReplaceableTextures\\CommandButtons\\BTNSpy.blp")
	call CreateQuestBJ(0, "TRIGSTR_50006", "TRIGSTR_50007", "ReplaceableTextures\\CommandButtons\\BTNTome.blp")
	call CreateQuestBJ(0, "TRIGSTR_50008", "TRIGSTR_50009", "ReplaceableTextures\\CommandButtons\\BTNAmbush.blp")
endfunction

function LLX takes nothing returns boolean
	local string s
	if not IsUnitIllusion(GetTriggerUnit()) and GetUnitTypeId(GetTriggerUnit())!='H00J' then
		set s = GetUnitName(GetTriggerUnit())+ " " + GetObjectName('n0HB')+ " " + GetObjectName(GetLearnedSkill())+ " (" + GetObjectName('n0HC')+ " " + I2S(GetLearnedSkillLevel())+ ")"
		call DisplayTimedTextToPlayer(VKV, 0, 0, 3, s)
		call DisplayTimedTextToPlayer(VLV, 0, 0, 3, s)
	endif
	return false
endfunction
function LMX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_HERO_SKILL)
	call TriggerAddCondition(t, Condition(function LLX))
	set t = null
endfunction
// 裁判离开游戏
function LUX takes nothing returns nothing
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 25.,(ObserverPlayersName[GetPlayerId((GetTriggerPlayer()))])+ "|c00ff0303 " + GetObjectName('n02D')+ "|r")
endfunction
function LWX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player LYX =(LoadPlayerHandle(HY, h, 78))
	local integer O3X = 1
	local integer LZX
	local integer L_X = GetPlayerState(LYX, PLAYER_STATE_RESOURCE_GOLD)
	if F0V[GetPlayerId(LYX)]== false and YS then
		if GetTriggerEvalCount(t)== 1 then
			if IsPlayerAlly(LocalPlayer, LYX) then
				call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 6, GetObjectName('n0J3'))
				call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 6, GetObjectName('n0JG'))
			endif
		endif
		return false
	endif
	if L_X > 20 then
		call SetPlayerState(LYX, PLAYER_STATE_RESOURCE_GOLD, 0)
		set EUV[GetPlayerId(LYX)]= 0
		if IsSentinelsPlayer(LYX) then
			set LZX = XKX(RW)
		else
			set LZX = XKX(IW)
		endif
		if IsSentinelsPlayer(LYX) then
			loop
			exitwhen O3X > 5
				if IsPlaying(Sentinels[O3X]) then
					call SetPlayerState(Sentinels[O3X], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Sentinels[O3X], PLAYER_STATE_RESOURCE_GOLD)+ L_X / LZX)
				endif
				set O3X = O3X + 1
			endloop
		else
			loop
			exitwhen O3X > 5
				if IsPlaying(Scourges[O3X]) then
					call SetPlayerState(Scourges[O3X], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Scourges[O3X], PLAYER_STATE_RESOURCE_GOLD)+ L_X / LZX)
				endif
				set O3X = O3X + 1
			endloop
		endif
	endif
	set t = null
	return false
endfunction
function L0X takes player LYX returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SavePlayerHandle(HY, h, 78,(LYX))
	call TriggerRegisterTimerEvent(t, 2, true)
	call TriggerAddCondition(t, Condition(function LWX))
	set t = null
endfunction
function L1X takes player p returns nothing
	local multiboarditem VUX = MultiboardGetItem(BT, D2V[GetPlayerId(p)], D1V[GetPlayerId(p)])
	call MultiboardSetItemValue(VUX, "|c00333333" +(VMV[GetPlayerId((p))])+ "|r")
	call MultiboardReleaseItem(VUX)
	set VUX = null
endfunction

// 退出游戏
function L2X takes nothing returns nothing
	local integer LRX = XKX(RW)
	local integer LOX = XKX(IW)
	local integer O3X
	local integer K0X
	local string KGX
	local string L3X
	local unit hPlayerHeroUnit = Player__Hero[GetPlayerId(GetTriggerPlayer())]
	if hPlayerHeroUnit == null then
		set L3X = GetObjectName('n0EW')
	else
		set L3X = GetUnitName(hPlayerHeroUnit)
	endif
	if(TS <$A) then
		set KGX = I2S(QS)+ ":0" + I2S(TS)
	else
		set KGX = I2S(QS)+ ":" + I2S(TS)
	endif
	if not OY then
		set BY[GetPlayerId(GetTriggerPlayer())]= "|c00555555" + KGX + "|r"
		call YYE(GetPlayerId(GetTriggerPlayer()), true)
		call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 25., JS[GetPlayerId(GetTriggerPlayer())]+(VMV[GetPlayerId((GetTriggerPlayer()))])+ " (" + L3X + ")|r|c00ff0303 " + GetObjectName('n02D')+ "|r")
		if(IsSentinelsPlayer(GetTriggerPlayer())) then
			set O3X = 1
			set K0X = 5
			loop
			exitwhen O3X > K0X
				if(Sentinels[O3X]!= GetTriggerPlayer()) then
					if(IsPlaying(Sentinels[O3X])) then
						call SetPlayerAllianceStateBJ(GetTriggerPlayer(), Sentinels[O3X], 4)
					endif
				endif
				set O3X = O3X + 1
			endloop
		else
			set O3X = 1
			set K0X = 5
			loop
			exitwhen O3X > K0X
				if(Scourges[O3X]!= GetTriggerPlayer()) then
					if(IsPlaying(Scourges[O3X])) then
						call SetPlayerAllianceStateBJ(GetTriggerPlayer(), Scourges[O3X], 4)
					endif
				endif
				set O3X = O3X + 1
			endloop
		endif
		if IsSentinelsPlayer(GetTriggerPlayer()) or IsScourgesPlayer(GetTriggerPlayer()) then
			set EKV = EKV + 1
		endif
		call JSX("C" + "K" + I2S(AQ[GetPlayerId(GetTriggerPlayer())])+ "D" + I2S(NQ[GetPlayerId(GetTriggerPlayer())])+ "N" + I2S((LoadInteger(HY,(400 + GetPlayerId(GetTriggerPlayer())), 79))), GetPlayerId(GetTriggerPlayer()))
		set FFV = GetTriggerPlayer()
		call ExecuteFunc("L4X")
		if YS then
			call C0X(GetTriggerPlayer())
		endif
		set EJV[GetPlayerId(GetTriggerPlayer())]= true
		call L1X(GetTriggerPlayer())
		call L0X(GetTriggerPlayer())
		if EKV == 2 and MW == false and BL then
			call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 60, " ")
			call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 60, " ")
			call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 60, "|c006699CC" + GetObjectName('n0FW')+ "|r")
		endif
	else
		set BY[GetPlayerId(GetTriggerPlayer())]= "|c00555555End|r"
		call ExecuteFunc("L5X")
	endif
	set hPlayerHeroUnit = null
endfunction
function L6X takes unit u returns nothing
	if GetUnitAbilityLevel(u,'A40E')== 1 then
		call UnitRemoveAbility(u,'A40E')
	endif
	//if GetUnitAbilityLevel(u,'B09Y')== 1 then
	//	call UnitRemoveAbility(u,'B09Y')
	//endif
	//if GetUnitAbilityLevel(u,'B3JQ')== 1 then
	//	call UnitRemoveAbility(u,'B3JQ')
	//endif
endfunction
function L7X takes unit u returns nothing
	local integer i
	if IsSentinelsPlayer(GetOwningPlayer(u)) then
		call IssueTargetOrderById(u, 851986, SentinelsBuilding_FountainOfLife)
	else
		call IssueTargetOrderById(u, 851986, B7)
	endif
	call IssueImmediateOrderById(u,$D0004)
	if GetUnitCurrentOrder(u)== 851986 then
		call TriggerExecute(KV)
		call RemoveUnit(u)
	endif
endfunction
// 复活英雄单位
function L8X takes unit u returns nothing
	local integer h = GetHandleId(u)
	call L7X(u)
	call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A11X', false)
	call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A10U', false)
	call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A344', false)
	if GetOwningPlayer(u)== LocalPlayer then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 1, " ")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 1, "|c006699CC" + GetObjectName('n0GR'))
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 1, " ")
	endif
	if LoadBoolean(HY, h,'suic') then
		call RemoveSavedBoolean(HY, h,'suic')
	endif
	call BYX(XE, GetOwningPlayer(u))
	call SetUnitState(u, UNIT_STATE_MANA,$F423F)
	if G3X(u) then
		call HDX(u, false)
	endif
	call SetUnitInvulnerable(u, false)
	call SetUnitPathing(u, true)
	call PauseUnit(u, false)
	call SetUnitFlyHeight(u, GetUnitDefaultFlyHeight(u), 0)
	//call SetUnitScale(u, GetUnitModelScale(u), GetUnitModelScale(u), GetUnitModelScale(u))
	// 修正模型缩放
	call SetUnitCurrentScaleEx(u, GetUnitCurrentScale(u))
	call GBX(u)
	call RemoveUnitBuff(u, true)
	if LoadInteger(P, GetHandleId(u),'A32D')> 0 then
		call SaveInteger(P, GetHandleId(u),'A32D', 0)
		call SaveBoolean(P, GetHandleId(u),'A32D', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A32D', false)
	endif
	// 死亡驱散的一些Buff和技能
	call UnitRemoveAbility(u,'A3B2')
	call UnitRemoveAbility(u,'B3B2')
	call UnitRemoveAbility(u,'A40F')
	call UnitRemoveAbility(u,'A43N')
	call UnitRemoveAbility(u,'A43O')
	call UnitRemoveAbility(u,'A40E')
	call UnitRemoveAbility(u,'A349')
	call UnitRemoveAbility(u,'A348')
	call UnitRemoveAbility(u,'B03F')
	call UnitRemoveAbility(u,'A347')
	call UnitRemoveAbility(u,'A32H')
	call UnitRemoveAbility(u,'A32I')
	call UnitRemoveAbility(u,'A32J')
	call UnitRemoveAbility(u,'A32K')
	call UnitRemoveAbility(u,'A32L')
	call UnitRemoveAbility(u,'A32M')
	call UnitRemoveAbility(u,'A32N')
	call UnitRemoveAbility(u,'A32O')
	call UnitRemoveAbility(u,'A32P')
	call UnitRemoveAbility(u,'A32Q')
	call UnitRemoveAbility(u,'A32R')
	call UnitRemoveAbility(u,'A32S')
	call UnitRemoveAbility(u,'A021')
	call UnitRemoveAbility(u,'QINV')
	call UnitRemoveAbility(u,'A313')
	call UnitRemoveAbility(u,'A314')
	call UnitRemoveAbility(u,'A315')
	call UnitRemoveAbility(u,'A0AZ')
	call UnitRemoveAbility(u,'A21I')
	call UnitRemoveAbility(u,'A0PV')
	call UnitRemoveAbility(u,'A0RF')
	call UnitRemoveAbility(u, DBV)
	call UnitRemoveAbility(u,'A0I5')
	call UnitRemoveAbility(u,'A0IH')
	call UnitRemoveAbility(u,'B08L')
	call UnitRemoveAbility(u,'A0SR')
	call UnitRemoveAbility(u,'A0WO')
	call UnitRemoveAbility(u,'A0WR')
	call UnitRemoveAbility(u,'A1CN')
	call UnitRemoveAbility(u,'A147')
	call UnitRemoveAbility(u,'A121')
	call UnitRemoveAbility(u,'A12D')
	call UnitRemoveAbility(u,'A179')
	call UnitRemoveAbility(u,'Aetl')
	call UnitRemoveAbility(u, O4[0])
	call UnitRemoveAbility(u, O4[1])
	call UnitRemoveAbility(u, O4[2])
	call UnitRemoveAbility(u, O4[3])
	call UnitRemoveAbility(u, O4[4])
	call UnitRemoveAbility(u, O4[5])
	call SaveBoolean(HY,(GetHandleId(u)), 80,(false))
	call UnitRemoveAbility(u,'A1CA')
	call UnitRemoveAbility(u,'A1C9')
	call UnitRemoveAbility(u,'A1CB')
	call UnitRemoveAbility(u,'A1CC')
	call UnitRemoveAbility(u,'A1GA')
	call UnitRemoveAbility(u,'A1UH')
	call UnitRemoveAbility(u,'A23O')
	call UnitRemoveAbility(u,'B0E9')
	//call KRX(u, 0)
	if GetUnitTypeId(u) == 'N0MH' then
		call YDWEUnitTransform( u, LoadInteger(ExtraHT, GetHandleId(u), HTKEY_UNIT_ORIGIN_TYPEID ) )
	endif
	set U2 = u
	call ExecuteFunc("L9X")
	if LoadBoolean(P, GetHandleId(u), StringHash("morphedburn")) then
		call RAX(u, LoadInteger(P, GetHandleId(u), StringHash("second")))
		call RAX(u, LoadInteger(P, GetHandleId(u), StringHash("first")))
		call SaveBoolean(P, GetHandleId(u), StringHash("morphedburn"), false)
	endif
endfunction
function MVX takes nothing returns boolean
	if GetPlayerAlliance(GetOwningPlayer(GetFilterUnit()), EMV, ALLIANCE_SHARED_CONTROL) and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false then
		set ELV = ELV + 1
	endif
	return false
endfunction
function MEX takes unit u, player p, real x, real y, boolean MXX returns nothing
	local group g = LoginGroup(8)
	set ELV = 0
	set EMV = p
	call GroupEnumUnitsSelected(g, p, Condition(function MVX))
	if ELV == 0 and LocalPlayer== p then
		if MXX == false then
			call ClearSelection()
			call SelectUnit(u, true)
		endif
		call PanCameraToTimed(x, y, 0)
	endif
	set ELV = 0
	call LogoutGroup(g)
	set g = null
endfunction
function MOX takes integer i returns boolean
	return i =='H00J' or i =='N0MM'
endfunction
function HeroIsDummyUnit takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return MOX(i) or i =='H07G' or i =='H00M' or i =='H0B8' or i =='H0DL' or i =='H00Y'
endfunction
function P9X takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return i!='H00M' and i!='H07G' and i!='H00Y' and i!='H00J' and i!='H0B8'
endfunction
function MIX takes unit whichUnit returns nothing
	local integer charges
	if GetItemOfTypeFromUnit(whichUnit, RealItemTypeId[NIV])!= null and GetUnitTypeId(whichUnit)!='H00J' then
		set charges = R2I(GetItemCharges(GetItemOfTypeFromUnit(whichUnit, RealItemTypeId[NIV]))* .67)
		if GetItemCharges(GetItemOfTypeFromUnit(whichUnit, RealItemTypeId[NIV]))== 1 then
			set charges = 0
		endif
	endif
endfunction

// 英雄单位完成复活
function MCX takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local real x
	local real y
	local integer c
	local integer level
	set UF[GetPlayerId(GetOwningPlayer(u))]= false
	set M2[GetPlayerId(GetOwningPlayer(u))]= false
	if IsSentinelsPlayer(GetOwningPlayer(u)) then
		set x = GetRectCenterX(VZ)
		set y = GetRectCenterY(VZ)
	else
		set x = GetRectCenterX(GY)
		set y = GetRectCenterY(GY)
	endif
	if GV then
		if TimerGetRemaining(PS[GetPlayerId(p)])> 2 then
			call JSX("LoD_HeroResp_" + I2S(GetPlayerId(p)), 1)
		else
			call JSX("LoD_HeroResp_" + I2S(GetPlayerId(p)), 0)
		endif
	endif
	call TimerStart(PS[GetPlayerId(p)], .0, false, null)
	call MEX(u, p, x, y, false)
	call SetUnitX(u, x)
	call SetUnitY(u, y)
	call L8X(u)
	if GetItemOfTypeFromUnit(u, RealItemTypeId[NIV])!= null and GetUnitTypeId(u)!='H00J' then
		set c = R2I(GetItemCharges(GetItemOfTypeFromUnit(u, RealItemTypeId[NIV]))* .67 * 1.)
		if GetItemCharges(GetItemOfTypeFromUnit(u, RealItemTypeId[NIV]))== 1 then
			set c = 0
		endif
		call SetItemCharges(GetItemOfTypeFromUnit(u, RealItemTypeId[NIV]), c)
	endif
	if GetUnitAbilityLevel(u,'A2AI')> 0 then
		call UnitRemoveAbility(u,'QF0O')
		call SetUnitAbilityLevel(u,'QB0G', GetUnitAbilityLevel(u,'A2AI'))
	endif
	//call U9V(u, 0, "armourneg")
	call FixUnitSkillsBug(u)
	call FixUnitRange(u, u)
	set u = null
endfunction

// 字体淡出 持续一秒
function SetTopMessageText_FadeOut takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer c = GetTriggerEvalCount(t)
	local integer frame = LoadInteger(HY, h, 0)
	if c > 40 then
		call TriggerEvaluate(LoadTriggerHandle(HY, h, 0)) //结束后运行一次父级触发器
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call DzFrameSetAlpha(frame, 255 - R2I(6.375 * c)) //淡出
	endif
	set t = null
	return false
endfunction

function SetTopMessageText_CallBack takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer frame = LoadInteger(HY, h, 0)
	local trigger newtrg
	if not HaveSavedHandle(HY, h, 0) then 
	    set newtrg = CreateTrigger() //淡出触发器
    	call SaveTriggerHandle(HY, h, 0, newtrg) //存入父级触发器淡出结束后会运行本触发
    	set h = GetHandleId(newtrg)
    	call SaveInteger(HY, h, 0, frame) //frame
    	call SaveTriggerHandle(HY, h, 0, t) //存入触发器
    	call TriggerRegisterTimerEvent(newtrg, 0.025, true) //一秒回调40次
		call TriggerAddCondition(newtrg, Condition( function SetTopMessageText_FadeOut))
		set newtrg = null
	else
	 	//清除数据并隐藏Frame
    	call DzFrameSetText(frame, "" )
    	call DzFrameShow(frame, false)
    	call DzFrameSetAlpha(frame, 255)
		set TopMessageTextTrg[LoadInteger(HY, h, 1)] = null
    	call FlushChildHashtable(HY, h)
    	call CleanCurrentTrigger(t)
	endif
	set t = null
	return false
endfunction

function SetTopMessageTextById takes string s, real time, integer i returns nothing
	local integer h
	set TopMessageTextTrg[i] = CreateTrigger()
	set h = GetHandleId(TopMessageTextTrg[i])
	call SaveInteger(HY, h, 0, UIFrame__Text[i])
	call SaveInteger(HY, h, 1, i)
	call DzFrameShow(UIFrame__Text[i], true)
	call DzFrameSetAlpha(UIFrame__Text[i], 255)
	call DzFrameSetText(UIFrame__Text[i], s )
	call TriggerRegisterTimerEvent(TopMessageTextTrg[i], time - 1, false) //-1 后的时间是淡化开始
	call TriggerAddCondition(TopMessageTextTrg[i], Condition( function SetTopMessageText_CallBack))
endfunction

function RemoveTopMsgTriggerByIndex takes integer i returns nothing
	local trigger t = TopMessageTextTrg[i]
	local integer h = GetHandleId(t)
	local integer frame = UIFrame__Text[i]
	local trigger newtrg
	if HaveSavedHandle(HY, h, 0) then
		set newtrg = LoadTriggerHandle(HY, h, 0)
		call FlushChildHashtable(HY, GetHandleId(newtrg))
		call CleanCurrentTrigger(newtrg)
		set newtrg = null
	endif
	call DzFrameSetText(frame, "" )
	call DzFrameShow(frame, false)
	call DzFrameSetAlpha(frame, 255)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set TopMessageTextTrg[i] = null
	set t = null
endfunction

//将其从队列中移除
function QueuedTopMsgRemoveByIndex takes integer i returns nothing
	local integer h 
	local integer frame
	local trigger newtrg
	local integer k = i + 1
	call RemoveTopMsgTriggerByIndex(i)
	loop
		set TopMessageTextTrg[i] = TopMessageTextTrg[k]
		//call BJDebugMsg(I2S(k)+"移动至"+I2S(i))
		if TopMessageTextTrg[i] != null then
			set h = GetHandleId(TopMessageTextTrg[i])
			call SaveInteger(HY, h, 0, UIFrame__Text[k])
			call SaveInteger(HY, h, 1, i)
			if HaveSavedHandle(HY, h, 0) then
				set newtrg = LoadTriggerHandle(HY, h, 0)
				call SaveInteger(HY, GetHandleId(newtrg), 0, UIFrame__Text[k])
			endif
		endif
		if TopMessageTextTrg[k] == null then
			call DzFrameSetText(UIFrame__Text[i], "" )
			call DzFrameSetAlpha(UIFrame__Text[i], 255)
			//call DzFrameShow(UIFrame__Text[i], false)
		else
			call DzFrameSetText(UIFrame__Text[i], DzFrameGetText(UIFrame__Text[k]) )
			call DzFrameSetAlpha(UIFrame__Text[i], DzFrameGetAlpha(UIFrame__Text[k]))
		endif
		set TopMessageTextTrg[k] = null
		exitwhen i == 5
		set i = i + 1
		set k = i + 1
	endloop
	set TopMessageTextTrg[k] = null
	set newtrg = null
endfunction

//设置顶部消息
function SetTopMessageText takes string s, real time returns nothing
	local integer i = 5
	if TopMessageTextTrg[6] != null then
		call QueuedTopMsgRemoveByIndex(1)
		call SetTopMessageTextById(s, time, 6)
		//call BJDebugMsg("将一移除队列并设置第六个")
		return
	endif
	loop
		if TopMessageTextTrg[i] != null and i != 6 then
			call SetTopMessageTextById(s, time, i + 1)
			return
		endif
		set i = i - 1
	exitwhen i == 0
	endloop
	call SetTopMessageTextById(s, time, 1)
	//call BJDebugMsg("设置第一个")
endfunction

function MDX takes integer i, integer k returns nothing
	if(i == 34) then
		call B6X('h06K')
	elseif i =='u' then
		call SetAllPlayerAbilityUnavailable('A40O')
		call SetAllPlayerAbilityUnavailable('A40P')
		call SetAllPlayerAbilityUnavailable('A40Q')
		call SetAllPlayerAbilityUnavailable('A40R')
	elseif i == 16 then
		call SetAllPlayerAbilityUnavailable('A10U')
		call SetAllPlayerAbilityUnavailable('A11X')
	elseif i == 62 then
		call ExecuteFunc("MFX")
	elseif i == 83 then
		set IX = true
	elseif i =='o' then
		call ExecuteFunc("MGX")
	elseif(i == 38) then
		call ExecuteFunc("MHX")
	elseif(i == 31) then
		call ExecuteFunc("MJX")
	elseif(i == 8) then
		call ExecuteFunc("MKX")
		//call ExecuteFunc("MLX")
	elseif(i == 3) then
		call ExecuteFunc("MMX")
	elseif(i == 95) then
		call ExecuteFunc("MPX")
	elseif(i == FB) then
		call ExecuteFunc("MQX")
	elseif i == 52 then
		call SetAllPlayerAbilityUnavailable('A30P')
	elseif i == 61 then
		call SetAllPlayerAbilityUnavailable('A419')
	elseif(i == 4) then
		// 变体精灵的变颜色
		// call ExecuteFunc("MSX")
	elseif(i == 18) then
		call ExecuteFunc("MUX")
		call ExecuteFunc("MWX")
	elseif i == 73 then
		//call SetAllPlayerAbilityUnavailable('A30D')
		call SetAllPlayerAbilityUnavailable('A30E')
	elseif(i == 21) then
		// 神出鬼没
		call ExecuteFunc("MYX")
		// 预读技能
		call ExecuteFunc("MZX")
		call ExecuteFunc("RegisterPhantomLancerTrigger")
	elseif(i == 26) then
		call ExecuteFunc("M0X")
	elseif(i == 10) then
		call ExecuteFunc("M1X")
	elseif(i == 23) then
		// 地精工程师
		call ExecuteFunc("M2X")
		call ExecuteFunc("M3X")
	elseif(i == 75) then
		call ExecuteFunc("M4X")
	elseif(i == 59) then
		call ExecuteFunc("M5X")
		// 蜘蛛网
		call ExecuteFunc("M6X")
	elseif(i == 77) then
		call ExecuteFunc("M7X")
	elseif(i == 81) then
		call ExecuteFunc("M8X")
	elseif(i =='i') then
		call ExecuteFunc("M9X")
	elseif(i =='k') then
		call RegisterUnitAttackEvent("Familiars_DE", 0)
		call ExecuteFunc("PEX")
		// 灵魂超度
		set HaveSoulAssumption = true
		// call ExecuteFunc("PXX")
	elseif(i == 79) then
		call ExecuteFunc("PRX")
	elseif(i == 85) then
		call ExecuteFunc("PreloadSpectralDagger")
		call ExecuteFunc("PreloadSpectralHaunt")
	elseif(i == 86) then
		call ExecuteFunc("PNX")
	elseif(i == 33) then
		call ExecuteFunc("PickDragonKnight")
	elseif(i == 88) then
		// 术士
		call ExecuteFunc("PCX")
		call ExecuteFunc("PDX")
		// 地狱火
		call ExecuteFunc("PFX")
	elseif i == 90 then
		call ExecuteFunc("PGX")
	elseif i == 71 then
		call ExecuteFunc("PHX")
	elseif i == 91 then
		call ExecuteFunc("PJX")
	elseif i == 44 then
		call ExecuteFunc("PKX")
	elseif i == 121 then
		set AX = true
		//elseif i == 98 then
		//	call ExecuteFunc("PLX")
	elseif i == 78 then
		call ExecuteFunc("PMX")
	elseif i == 72 then
		call ExecuteFunc("PPX")
	elseif i == 46 then
		call ExecuteFunc("PQX")
	elseif i == 47 then
		call ExecuteFunc("PSX")
	elseif i == 96 then
		call ExecuteFunc("PTX")
	elseif i == 97 then
		call ExecuteFunc("PUX")
	elseif i == 51 then
		call ExecuteFunc("PWX")
	elseif i == 49 then
		call ExecuteFunc("PYX")
	elseif i == 29 then
		call ExecuteFunc("PZX")
	elseif i == 50 then
		call ExecuteFunc("P_X")
	elseif i == 30 then
		call ExecuteFunc("P0X")
	elseif i == 53 then
		call ExecuteFunc("P1X")
		call ExecuteFunc("P2X")
	elseif i == 54 then
		//	call ExecuteFunc("P3X")
		call ExecuteFunc("P4X")
	elseif i == 55 then
	elseif i == 56 then
		call ExecuteFunc("P5X")
	elseif i == 57 then
		call ExecuteFunc("P6X")
	endif
endfunction
function P7X takes player VBX, string AXX returns nothing
	if IsPlayerInForce(LocalPlayer, VNX(VBX)) then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 40, JS[GetPlayerId(VBX)]+(VMV[GetPlayerId((VBX))])+ "|r " + AXX)
	endif
endfunction
function P8X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	set IsChooseHeroEnd = true
	call CleanCurrentTrigger(t)
	call DestroyFogModifier(CreateFogModifierRadius(Sentinels[0], FOG_OF_WAR_MASKED,-6950, 6750, 700, false, false))
	call DestroyFogModifier(CreateFogModifierRadius(Scourges[0], FOG_OF_WAR_MASKED,-6950, 6750, 700, false, false))
	set t = null
	return false
endfunction


function QEX takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='n00C' then
		call KillUnit(GetFilterUnit())
	endif
	return false
endfunction
function KillPlayerAllZoneIndicator takes player p returns nothing
	local group g = LoginGroup(9)
	call GroupEnumUnitsOfPlayer(g, p, Condition(function QEX))
	call LogoutGroup(g)
	set g = null
endfunction
function QOX takes nothing returns boolean
	return GetUnitTypeId(GetFilterUnit())=='ncop'
endfunction
function QRX takes nothing returns nothing
	if GKV then
		call UnitRemoveAbility(Circle[GetPlayerId(GetOwningPlayer(GetEnumUnit()))],'A14F')
		call UnitRemoveAbility(Circle[GetPlayerId(GetOwningPlayer(GetEnumUnit()))],'A14E')
		//call UnitRemoveAbility(Circle[GetPlayerId(GetOwningPlayer(GetEnumUnit()))],'A14H')
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A0I4')== 0 then
		call UnitAddAbility(GetEnumUnit(),'A0I4')
	endif
endfunction
function EnableCircle takes player p returns nothing
	local group g = LoginGroup(10)
	call GroupEnumUnitsOfPlayer(g, p, Condition(function QOX))
	call ForGroup(g, function QRX)
	call LogoutGroup(g)
	set g = null
endfunction
function QAX takes nothing returns nothing
	local integer i = 0
	local integer d = 0
	local multiboarditem mi
	local integer TQV = 0
	local string s = ""
	local real QNX = .12
	if D4V != 0 then
		set i = 4 + ExtraAbilitiesNum  
		set d = 1
		loop
			set mi = MultiboardGetItem(JP, d, i)
			call MultiboardSetItemValue(mi, TM + JS[GetPlayerId(VW[d])]+ VMV[GetPlayerId(VW[d])]+ "|r")
			call MultiboardReleaseItem(mi)
			set d = d + 1
		exitwhen d == D4V + 1
		endloop
	endif
	if D5V != 0 then
		set i = 4 + ExtraAbilitiesNum  
		set d = 2 + D4V
		loop
			set mi = MultiboardGetItem(JP, d, i)
			call MultiboardSetItemValue(mi, TM + JS[GetPlayerId(EW[d -1 -D4V])]+ VMV[GetPlayerId(EW[d -1 -D4V])]+ "|r")
			set d = d + 1
			call MultiboardReleaseItem(mi)
		exitwhen d == D4V + D5V + 2
		endloop
	endif
	set mi = null
endfunction
function QBX takes nothing returns nothing
	local integer i = 0
	local integer d = 0
	local multiboarditem mi
	local integer TQV = 0
	local string s = ""
	local real QNX = .12
	set JP = CreateMultiboard()
	set BJ_Multiboard = JP
	if LOD_DEBUGMODE then
		set D4V = 5
		set D5V = 5
	endif
	call MultiboardSetRowCount(JP, 2 + D4V + D5V)
	call MultiboardSetColumnCount(JP, 5 + ExtraAbilitiesNum  )
	call MultiboardSetItemsWidth(JP, .015)
	call MultiboardSetTitleText(JP, "-" + StringCase(EP, true))
	call MultiboardSetItemsStyle(JP, false, true)
	loop
		set mi = MultiboardGetItem(JP, 0, i)
		call MultiboardSetItemStyle(mi, true, false)
		if i == 0 then
			call MultiboardSetItemWidth(mi, QNX)
			call MultiboardSetItemValue(mi, "|c00ff0303近卫军团|r")
		endif
		call MultiboardReleaseItem(mi)
		set i = i + 1
	exitwhen i == MultiboardGetColumnCount(JP)
	endloop
	set i = 0
	loop
		set mi = MultiboardGetItem(JP, 1 + D4V, i)
		call MultiboardSetItemStyle(mi, true, false)
		if i == 0 then
			call MultiboardSetItemWidth(mi, QNX)
			call MultiboardSetItemValue(mi, "|c0020c000天灾军团|r")
		endif
		call MultiboardReleaseItem(mi)
		set i = i + 1
	exitwhen i == MultiboardGetColumnCount(JP)
	endloop
	if D4V != 0 then
		set i = 0
		set d = 1
		loop
			set mi = MultiboardGetItem(JP, d, i)
			if i ==(4 + ExtraAbilitiesNum  ) then
				call MultiboardSetItemStyle(mi, true, false)
				call MultiboardSetItemWidth(mi, QNX)
				call MultiboardSetItemValue(mi, TM + JS[GetPlayerId((VW[d]))]+ VMV[GetPlayerId((VW[d]))]+ "|r")
			else
				call MultiboardSetItemStyle(mi, false, true)
				call MultiboardSetItemIcon(mi, HeroSkillsIcon[0])
			endif
			set i = i + 1
			if i >(5 + ExtraAbilitiesNum  ) then
				set d = d + 1
				set i = 0
			endif
			call MultiboardReleaseItem(mi)
		exitwhen d == D4V + 1
		endloop
	endif
	if D5V != 0 then
		set i = 0
		set d = 2 + D4V
		loop
			set mi = MultiboardGetItem(JP, d, i)
			if i == 4 + ExtraAbilitiesNum  then
				call MultiboardSetItemStyle(mi, true, false)
				call MultiboardSetItemWidth(mi, QNX)
				call MultiboardSetItemValue(mi, TM + JS[GetPlayerId((EW[d -1 -D4V]))]+ VMV[GetPlayerId((EW[d -1 -D4V]))]+ "|r")
			else
				call MultiboardSetItemStyle(mi, false, true)
				call MultiboardSetItemIcon(mi, HeroSkillsIcon[0])
			endif
			set i = i + 1
			if i >(5 + ExtraAbilitiesNum  ) then
				set d = d + 1
				set i = 0
			endif
			call MultiboardReleaseItem(mi)
		exitwhen d == D4V + D5V + 2
		endloop
	endif
	call MultiboardMinimize(JP, false)
	call MultiboardDisplay(JP, true)
	set mi = null
endfunction
function AddHeroSkills takes unit u, player p returns nothing
	local integer WWV = GetPlayerId(p)
	local integer xx = 0
	local integer QDX
	local integer QFX
	local integer id
	set xx = 1
	loop
		if PlayerSkillIndex[WWV * HL + xx]!= 0 then
			set QFX = PlayerSkillIndex[WWV * HL + xx]
			set id = HeroCommonSkills[QFX]
			set QDX = HeroChangeAbilitySkills[QFX]
			call UnitAddPermanentAbility(u, QDX)
			call SetPlayerAbilityAvailable(p, QDX, false)
		endif
		set xx = xx + 1
	exitwhen xx > 4
	endloop
endfunction
function QGX takes integer id returns integer
	local integer k
	if id =='A343' then
		call PreloadAbility('A0Z6')
	endif
	if id =='A40B' then
		return'A083'
	endif
	if id =='A0FU' then
		return'QF00'
	endif
	if id =='A0KX' then
		return'QF87'
	endif
	if id =='A0OO' then
		return'A302'
	endif
	if id =='A0LV' then
		return'A46A'
	endif
	if id =='Q0BK' then
		return'QP29'
	endif
	if id =='QF88'then
		return'A0VC'
	endif
	if id =='A46E' then
		return'A46D'
	endif
	set k = WBE(id)
	if k > 0 and PassiveSkills_Show[k]> 0 then
		return PassiveSkills_Show[k]
	endif
	return id
endfunction
function QHX takes integer i returns string
	if i == 1 then
		return"|c000042FFblue"
	elseif i == 2 then
		return"|c001ce6b9teal"
	elseif i == 3 then
		return"|c00540081purple"
	elseif i == 4 then
		return"|c00fffc01yellow"
	elseif i == 5 then
		return"|c00ff8000orange"
	elseif i == 7 then
		return"|c00e55bb0pink"
	elseif i == 8 then
		return"|c00959697gray"
	elseif i == 9 then
		return"|c007ebff1lightblue"
	elseif i ==$A then
		return"|c00106246darkgreen"
	elseif i == 11 then
		return"|c004e2a04brown"
	endif
	return""
endfunction

function SetAbilityStringByMode takes unit u, integer id returns nothing
	if id == 'QP24' then
		if Mode__BalanceOff and Mode__RearmCombos then
			call YDWESetUnitAbilityDataString(u, id, 1, 218, "有25%的概率连续施展两次法术|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call YDWESetUnitAbilityDataString(u, id, 2, 218, "有40%的概率连续施展两次法术；有20%的概率连续施展三次法术|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call YDWESetUnitAbilityDataString(u, id, 3, 218, "有50%的概率连续施展两次法术；有25%的概率连续施展三次法术；有12.5%的概率连续施展四次法术|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			set id = 'A088'
			call UnitAddAbility(u, id)
			call YDWESetUnitAbilityDataString(u, id, 1, 217, "狗运让菊花能更快更有效地使用技能。|n|n|cffffcc00等级 1|r - 25%概率x2|n|cffffcc00等级 2|r - 40%概率x2，20%概率x3|n|cffffcc00等级 3|r - 50%概率x2，25%概率x3，12.5%概率x4|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call UnitRemoveAbility(u, id)
		elseif Mode__BalanceOff and not Mode__RearmCombos then
			call YDWESetUnitAbilityDataString(u, id, 1, 218, "有25%的概率连续施展两次法术|n|n成功狗运时，魔法会额外消耗|cffff0303 50% |r|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call YDWESetUnitAbilityDataString(u, id, 2, 218, "有40%的概率连续施展两次法术；有20%的概率连续施展三次法术|n|n成功狗运时，魔法会额外消耗|cffff0303 75% |r|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call YDWESetUnitAbilityDataString(u, id, 3, 218, "有50%的概率连续施展两次法术；有25%的概率连续施展三次法术；有12.5%的概率连续施展四次法术|n|n成功狗运时，魔法会额外消耗|cffff0303 100% |r|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			set id = 'A088'
			call UnitAddAbility(u, id)
			call YDWESetUnitAbilityDataString(u, id, 1, 217, "狗运让菊花能更快更有效地使用技能。|n|n成功狗运时，魔法会额外消耗|cffff0303 50%/75%/100%|r|n|n|cffffcc00等级 1|r - 25%概率x2|n|cffffcc00等级 2|r - 40%概率x2，20%概率x3|n|cffffcc00等级 3|r - 50%概率x2，25%概率x3，12.5%概率x4|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call UnitRemoveAbility(u, id)
		elseif not Mode__BalanceOff and Mode__RearmCombos then
			call YDWESetUnitAbilityDataString(u, id, 1, 218, "有18%的概率连续施展两次法术|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call YDWESetUnitAbilityDataString(u, id, 2, 218, "有29.5%的概率连续施展两次法术；有13%的概率连续施展三次法术|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call YDWESetUnitAbilityDataString(u, id, 3, 218, "有39.5%的概率连续施展两次法术；有14.5%的概率连续施展三次法术；有5.5%的概率连续施展四次法术|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			set id = 'A088'
			call UnitAddAbility(u, id)
			call YDWESetUnitAbilityDataString(u, id, 1, 217, "狗运让菊花能更快更有效地使用技能。|n|n|cffffcc00等级 1|r - 18%概率x2|n|cffffcc00等级 2|r - 29.5%概率x2，13%概率x3|n|cffffcc00等级 3|r - 39.5%概率x2，14.5%概率x3，5.5%概率x4|n|n输入|c00ff0505-mc|r 以查看自身能触发狗运的技能|n|n|c00fffc01神杖升级：让你另一个脑袋施放火焰爆轰。")
			call UnitRemoveAbility(u, id)
		endif
	endif
endfunction

function PlayerPickHero takes unit u, integer playerId, unit QKX returns nothing//酒馆英雄添加技能时
	local integer heroIndex =(GetUnitPointValue(u)* 4)-4
	local integer xx = 0
	local integer teamId
	local integer TXE = heroIndex + 1
	local integer TOE = heroIndex + 2
	local integer QMX = heroIndex + 3
	local integer QPX = heroIndex + 4
	local integer tempAbilityId = 0
	local integer array QSX
	local boolean QTX = true
	local integer unitTypeId = GetUnitTypeId(u)
	local player whichPlayer = Player(playerId)
	set QSX[1]= heroIndex + 1
	set QSX[2]= heroIndex + 2
	set QSX[3]= heroIndex + 3
	set QSX[4]= heroIndex + 4
	set MP[playerId]= GetUnitPointValue(u)
	call RemoveUnit(u)
	call SetPlayerState( whichPlayer , PLAYER_STATE_RESOURCE_GOLD, GetPlayerState( whichPlayer , PLAYER_STATE_RESOURCE_GOLD)+ 250 )
	if GKV or Mode__MirrorDraft then
		set QTX = LoadBoolean(HY, GetHandleId( whichPlayer ), unitTypeId)
		if not QTX then
			call UVE( whichPlayer , true, "这些是你友军的技能，你无法选择他们。你的技能在 " + QHX(playerId)+ "|c006699CC 酒馆|r")
		endif
	endif
	call FlushChildHashtable(HY, GetHandleId(KP[playerId]))
	call RemoveUnit(KP[playerId])
	set KP[playerId]= CreateUnit(whichPlayer ,'hfoo', GetRectMaxX(bj_mapInitialPlayableArea), GetRectMinY(bj_mapInitialPlayableArea), .0)
	call SaveUnitHandle(HY, GetHandleId(KP[playerId]), 0, QKX)
	if LOD_DEBUGMODE then
		call DisplayTimedTextToPlayer(LocalPlayer, .0, .0, 20., "Hero Number: " + I2S(GetUnitPointValue(u)))
		call DisplayTimedTextToPlayer(LocalPlayer, .0, .0, 20., "Skill #1 number: " + I2S(TXE))
		call DisplayTimedTextToPlayer(LocalPlayer, .0, .0, 20., "Skill #2 number: " + I2S(TOE))
		call DisplayTimedTextToPlayer(LocalPlayer, .0, .0, 20., "Skill #3 number: " + I2S(QMX))
		call DisplayTimedTextToPlayer(LocalPlayer, .0, .0, 20., "Skill #4 number: " + I2S(QPX))
	endif
	if IsSentinelsPlayer( whichPlayer ) then
		set teamId = 1
	else
		set teamId = 2
	endif
	set xx = 1
	loop
		if IsDisabledSkill[heroIndex + xx]== false then
			set tempAbilityId = HeroCommonSkills[heroIndex + xx]
			set tempAbilityId = QGX(tempAbilityId)
			call UnitAddAbility(KP[playerId], tempAbilityId)
			if not IsPassiveSkill[heroIndex + xx] and HeroUpgradeSkills[heroIndex + xx] != 0 then
				// 预读神杖技能
				call UnitAddAbility(KP[playerId], HeroUpgradeSkills[heroIndex + xx])
				call UnitRemoveAbility(KP[playerId], HeroUpgradeSkills[heroIndex + xx])
				//call SingleDebug( "预读 " + I2S(xx) + " 号神杖升级技能 " + GetObjectName( HeroUpgradeSkills[heroIndex + xx] ) )
			endif
			//if not Mode__RearmCombos then
			call SetAbilityStringByMode(KP[playerId], tempAbilityId) 	//根据模式更改技能文本
			//endif
			call SetUnitAbilityLevel(KP[playerId], tempAbilityId, 4)
			if TEE(heroIndex + xx,-1, "melee only", null) then
				call UnitAddAbility(KP[playerId],'Z020'+ xx -1)
			elseif TEE(heroIndex + xx,-1, "range only", null) then
				call UnitAddAbility(KP[playerId],'Z024'+ xx -1)
			elseif TEE(heroIndex + xx,-1, "melee morph", null) then
				call UnitAddAbility(KP[playerId],'Z030'+ xx -1)
			elseif TEE(heroIndex + xx,-1, "range morph", null) then
				call UnitAddAbility(KP[playerId],'Z034'+ xx -1)
			endif
			if QTX then
				if ( not IsPlayerHasSkill( whichPlayer , QSX[xx]) ) then
					if Mode__OneSkill then
						if XP[teamId * OP + QSX[xx]]== 0 then
							call UnitAddAbility(KP[playerId],'Z000'+ xx -1)
						else
							call UnitAddAbility(KP[playerId],'Z010'+ xx -1)
						endif
					else
						call UnitAddAbility(KP[playerId],'Z000'+ xx -1)
					endif
				else
					call UnitAddAbility(KP[playerId],'Z004'+ xx -1)
				endif
			else
				call UnitAddAbility(KP[playerId],'Z01A'+ xx -1)
			endif
		else
			if QTX then
				call UnitRemoveAbility(KP[playerId],'Z000'-1 + xx)
				call UnitAddAbility(KP[playerId],'Z014'-1 + xx)
			endif
		endif
		set xx = xx + 1
	exitwhen xx > 4
	endloop
	call ClearSelectionForPlayer( whichPlayer )
	call SelectUnitAddForPlayer(KP[playerId],  whichPlayer )
endfunction
function QUX takes nothing returns nothing
	call MultiboardDisplay(BT, false)
	call QBX()
	call SuspendTimeOfDay(true)
	call DisableTrigger(hChooseHeroTrigger)
endfunction

// 封装的添加经验
function AddHeroXPSimple takes unit whichHero, integer xpToAdd, boolean showEyeCandy returns nothing
	if Mode__EasyMode then
		set xpToAdd = R2I(xpToAdd * 1.5)
	endif
	call AddHeroXP(whichHero, xpToAdd, showEyeCandy )
endfunction

function QWX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	local integer level = LoadInteger(HY, GetHandleId(t), 0)
	if level > 0 then
		call SetHeroLevel(u, GetHeroLevel(u)+ 1, LoadBoolean(HY, GetHandleId(t), 0))
		call SaveInteger(HY, GetHandleId(t), 0, level -1)
	else
		call AddHeroXP(u, IMaxBJ(LoadInteger(HY, GetHandleId(t), 1)-GetHeroXP(u), 0), LoadBoolean(HY, GetHandleId(t), 0))
		call DestroyTimerAndFlushHT_HY(t)
	endif
	set u = null
	set t = null
endfunction

// 设置到某个等级后还再设置一次经验值
function SetHeroLevelAndXP takes unit u, integer level, boolean QZX, integer xp returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .01, true, function QWX)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveInteger(HY, GetHandleId(t), 0, level)
	call SaveInteger(HY, GetHandleId(t), 1, xp)
	call SaveBoolean(HY, GetHandleId(t), 0, QZX)
	set t = null
endfunction

function Click_CheckBox_Nothing takes player p, integer i returns nothing
	if LocalPlayer == p then
		set UIFrame__IsCheckBoxEnable[i] = not UIFrame__IsCheckBoxEnable[i]
		call DzFrameShow(UIFrame__HighLight[i], UIFrame__IsCheckBoxEnable[i])
	endif
endfunction

function Set_CheckBox_Nothing takes player p, integer i , boolean b returns nothing
	if LocalPlayer == p then
		set UIFrame__IsCheckBoxEnable[i] = b
		call DzFrameShow(UIFrame__HighLight[i], UIFrame__IsCheckBoxEnable[i])
	endif
endfunction


function ShowAbilityCd_Actions takes player p, boolean isOrder returns nothing
	local integer i = GetPlayerId(p)
	local boolean b
	if not isOrder then
		set b = SPCDB[i]
		set SPCDB[i] = not b
	else
		set b = not SPCDB[i]
	endif
	if not isOrder then
		if p == LocalPlayer then
			call GetSetUpText("隐藏有冷却被动技能", not b)
		endif
	endif
	if InHeroSelection then
		return
	endif
	call SetPlayerAbilityAvailable(p,'QP17', b)	//反击螺旋
	
	call SetPlayerAbilityAvailable(p,'A522', b) //水刀
	
	call SetPlayerAbilityAvailable(p,'QP1G', b) //余震
	
	call SetPlayerAbilityAvailable(p,'QP1O', b) //勇气之霎
	
	call SetPlayerAbilityAvailable(p,'A3UF', b) //天幕坠落

	call SetPlayerAbilityAvailable(p,'A0CG', b) //连击
endfunction

function Q_X takes player p, boolean isOrder returns nothing
	local integer i = 1
	local integer k
	local boolean b
	if not isOrder then
		set b = XD[GetPlayerId(p)]
		set XD[GetPlayerId(p)] = not b
	else
		set b = not XD[GetPlayerId(p)]
	endif
	if not isOrder then
		if p == LocalPlayer then
			call GetSetUpText("隐藏被动技能", not b)
		endif
	endif
	if InHeroSelection then
		return
	endif
	loop
		call SetPlayerAbilityAvailable(p, PassiveSkills_Show[i], b)
		set i = i + 1
	exitwhen i > MaxPassiveSkillsNum
	endloop
	if SPCDB[GetPlayerId(p)] then
		call SetPlayerAbilityAvailable(p,'QP1O', false)
		call SetPlayerAbilityAvailable(p,'QP17', false)
		call SetPlayerAbilityAvailable(p,'QP1G', false)
	else
		call SetPlayerAbilityAvailable(p,'QP1O', true)
		call SetPlayerAbilityAvailable(p,'QP17', true)
		call SetPlayerAbilityAvailable(p,'QP1G', true)
	endif
	
	//	call SetPlayerAbilityAvailable(p,'A10S', b)
	
	call SetPlayerAbilityAvailable(p,'A0CQ', b)
	call SetPlayerAbilityAvailable(p,'A1IQ', b)
	call SetPlayerAbilityAvailable(p,'A0BM', b)
	call SetPlayerAbilityAvailable(p,'A46D', b)
	call SetPlayerAbilityAvailable(p,'A1O8', b)
	call SetPlayerAbilityAvailable(p,'A1O7', b)
	call SetPlayerAbilityAvailable(p,'A1O6', b)
	call SetPlayerAbilityAvailable(p,'A1O3', b)
	call SetPlayerAbilityAvailable(p,'A1O2', b)
	call SetPlayerAbilityAvailable(p,'A1O1', b)
	call SetPlayerAbilityAvailable(p,'A1O0', b)
	call SetPlayerAbilityAvailable(p,'A1NZ', b)
	call SetPlayerAbilityAvailable(p,'A1NY', b)
	call SetPlayerAbilityAvailable(p,'A1N9', b)
endfunction
function Q1X takes nothing returns nothing
	if GetUnitTypeId(GetFilterUnit())=='ntav' then
		if IsSentinelsPlayer(GetOwningPlayer(GetFilterUnit())) then
			call A8X(Scourges[0], 1, GetUnitX(GetFilterUnit()), GetUnitY(GetFilterUnit()), 400)
		else
			call A8X(Sentinels[0], 1, GetUnitX(GetFilterUnit()), GetUnitY(GetFilterUnit()), 400)
		endif
		call UnitRemoveAbility(GetFilterUnit(),'A1HX')
		call ShowUnit(GetFilterUnit(), false)
	elseif GetUnitTypeId(GetFilterUnit())=='n12C' then
		if LocalPlayer== GetOwningPlayer(GetFilterUnit()) then
			call SetUnitVertexColor(GetFilterUnit(), 255, 255, 255, 0)
		endif
	endif
endfunction
function HidePlayerTavern takes player p returns nothing
	local group g = LoginGroup(11)
	call GroupEnumUnitsOfPlayer(g, p, Condition(function Q1X))
	call LogoutGroup(g)
	set g = null
endfunction
function SyncHeroItems takes unit source, unit to returns nothing
	call UnitAddItem(to, UnitItemInSlot(source, 0))
	call UnitAddItem(to, UnitItemInSlot(source, 1))
	call UnitAddItem(to, UnitItemInSlot(source, 2))
	call UnitAddItem(to, UnitItemInSlot(source, 3))
	call UnitAddItem(to, UnitItemInSlot(source, 4))
	call UnitAddItem(to, UnitItemInSlot(source, 5))
endfunction
// 选择了一个英雄
function PlayerChooseHeroUnit takes unit whichUnit returns boolean
	local player whichPlayer = GetOwningPlayer(whichUnit)
	local real x
	local real y
	local region r = null
	local trigger t
	local integer loop_i
	local integer playerId = GetPlayerId(whichPlayer)
	local integer id
	local string message = ""
	set r = CreateRegion()
	if LOD_DEBUGMODE then // 如果是debug模式 就满级满钱
		//call SetHeroLevel(whichUnit, 25, false)
		call SetHeroLevelAndXP(whichUnit, 25, false, 0)
		call SetPlayerState(whichPlayer, PLAYER_STATE_RESOURCE_GOLD, 100000)
	endif
	// debug call SingleDebug( GetUnitName( whichUnit ) + " 已入场" )
	// 禁用两个光法的技能和战争咆哮
	call SetPlayerAbilityAvailable(whichPlayer,'A11X', false)
	call SetPlayerAbilityAvailable(whichPlayer,'A10U', false)
	call SetPlayerAbilityAvailable(whichPlayer,'A34C', false)
	call SetPlayerAbilityAvailable(whichPlayer,'A344', false)
	//========================================================================
	// 似乎是添加工程升级技能 让其可以学习?
	if MainModeName =="ap" then
		call AddHeroSkills(whichUnit, whichPlayer)
	elseif MainModeName =="sd" then
		call AddHeroSkills(whichUnit, whichPlayer)
	elseif MainModeName =="md" then
		call AddHeroSkills(whichUnit, whichPlayer)
	elseif MainModeName =="ar" then // 全部随机 特殊处理
		call SaveUnitHandle(HY,'hRUT', 1, whichUnit)
		call ExecuteFunc("Q7X")
		call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 15, "|cff99ccff你的技能:|r")
		set loop_i = 1
		set message = GetPlayerName(whichPlayer)+ ": "
		loop
			set id = PlayerSkillIndex[playerId * HL + loop_i]
			if id > 600 then
				call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 15, "	" + GetObjectName(HeroCommonSkills[id])+ "|cffffcc00 (Invoker)|r")
			else
				if loop_i == 4 or loop_i == 6 then
					call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 15, "	" + "|c00ff0303" + GetObjectName(HeroCommonSkills[id])+ "|r" + "|cffffcc00" + " (" + GetObjectName(VUV[(id + 3)/ 4])+ ")" + "|r")
					set message = message + GetObjectName(HeroCommonSkills[id])+ ", "
				else
					call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 15, "	" + GetObjectName(HeroCommonSkills[id])+ "|cffffcc00" + " (" + GetObjectName(VUV[(id + 3)/ 4])+ ")" + "|r")
					set message = message + GetObjectName(HeroCommonSkills[id])+ ", "
				endif
			endif
			set loop_i = loop_i + 1
		exitwhen loop_i > 4 + ExtraAbilitiesNum  
		endloop
	elseif MainModeName =="rd"then // 随机征召 rd ? 憨批模式罢了 不好维护
		call AddHeroSkills(whichUnit, whichPlayer)
		call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 15, "|cff99ccff你的技能:|r")
		set loop_i = 1
		loop
			set id = PlayerSkillIndex[playerId * HL + loop_i]
			if loop_i == 4 or loop_i == 6 then
				call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 15, "	" + "|c00ff0303" + GetObjectName(HeroCommonSkills[id])+ "|r" + "|cffffcc00" + " (" + GetObjectName(VUV[(id + 3)/ 4])+ ")" + "|r")
			else
				call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 15, "	" + GetObjectName(HeroCommonSkills[id])+ "|cffffcc00" + " (" + GetObjectName(VUV[(id + 3)/ 4])+ ")" + "|r")
			endif
			set loop_i = loop_i + 1
		exitwhen loop_i > 4 + ExtraAbilitiesNum  
		endloop
	endif
	//========================================================================

	if not Mode__DeathMatch then
		call KTX(whichPlayer)
	endif
	// 如果所有人都选择了英雄 7秒后移除酒馆视野
	if not IsChooseHeroEnd and(Player__Hero[GetPlayerId(Sentinels[1])]!= null and Player__Hero[GetPlayerId(Sentinels[2])]!= null and Player__Hero[GetPlayerId(Sentinels[3])]!= null and Player__Hero[GetPlayerId(Sentinels[4])]!= null and Player__Hero[GetPlayerId(Sentinels[5])]!= null and Player__Hero[GetPlayerId(Scourges[1])]!= null and Player__Hero[GetPlayerId(Scourges[2])]!= null and Player__Hero[GetPlayerId(Scourges[3])]!= null and Player__Hero[GetPlayerId(Scourges[4])]!= null and Player__Hero[GetPlayerId(Scourges[5])]!= null) then
		set t = CreateTrigger()
		call TriggerRegisterTimerEvent(t, 7, false)
		call TriggerAddCondition(t, Condition(function P8X))
		set t = null
	endif
	set M2[GetPlayerId(GetOwningPlayer((whichUnit)))]= false

	call RegionAddRect(r, Rect(-7584., 6176.,-6304., 7552.))
	// 如果是在泉水? 设置下随机位置
	if IsSentinelsPlayer(whichPlayer) then
		if IsUnitInRegion(r, whichUnit) then
			set x = GetRandomReal(GetRectMinX(VZ), GetRectMaxX(VZ))
			set y = GetRandomReal(GetRectMinY(VZ), GetRectMaxY(VZ))
		else
			set x = GetUnitX(whichUnit)
			set y = GetUnitY(whichUnit)
		endif
	else
		if IsUnitInRegion(r, whichUnit) then
			set x = GetRandomReal(GetRectMinX(GY), GetRectMaxX(GY))
			set y = GetRandomReal(GetRectMinY(GY), GetRectMaxY(GY))
		else
			set x = GetUnitX(whichUnit)
			set y = GetUnitY(whichUnit)
		endif
	endif

	set AY[playerId]= true
	// GVJ = rd   v4不知道什么东西
	if not GJV and not V4 then
		call PanCameraToTimedForPlayer(whichPlayer, x, y, 0)
	endif
	call ClearSelectionForPlayer(whichPlayer)
	call SelectUnitAddForPlayer(whichUnit, whichPlayer)
	call SetUnitX(whichUnit, x)
	call SetUnitY(whichUnit, y)
	set Player__Hero[playerId]= whichUnit
	set PlayerHeroTypeId[playerId]= GetUnitTypeId(whichUnit)
	call SaveInteger(HY, playerId,'hHid', GetUnitPointValue(whichUnit))
	call JMX(whichPlayer, "9", PlayerHeroTypeId[playerId])
	call XUX(whichPlayer) // 设置科技 意味不明
	call SaveBoolean(HY,(GetHandleId(whichUnit)), 85,(true))
	
	if not PW and not InHeroSelection and not X3 then
		set YQ[GetUnitPointValue(whichUnit)]= true
		set ZQ[GetUnitPointValue(whichUnit)]= true
		call XSX(GetUnitTypeId(whichUnit))
	endif

	// 死亡竞赛的特殊操作
	if Mode__DeathMatch then
		call L8X(whichUnit) // 刷新一下单位?
		// 分开判断两个队伍稳妥点
		if IsSentinelsPlayer(whichPlayer) then // 如果单位复活 那就增加生命值
			set TeamHeroUseLivesCount[0]= TeamHeroUseLivesCount[0] + 1
		endif
		if IsScourgesPlayer(whichPlayer) then
			set TeamHeroUseLivesCount[1]= TeamHeroUseLivesCount[1] + 1
		endif
		set PlayerHeroReincarnCount[playerId]= PlayerHeroReincarnCount[playerId]+ 1
		if PlayerHeroReincarnCount[playerId]> 1 and whichUnit != OW[playerId]then
			// 似乎是为了同步血精石充能 但没写完
			call MIX(OW[playerId])
			// 同步单位等级
			call SetHeroLevelAndXP(whichUnit, GetHeroLevel(OW[playerId])-1, false, GetHeroXP(OW[playerId]))
			// 同步英雄物品
			call SyncHeroItems(OW[playerId], whichUnit)
			set ZQ[GetUnitPointValue(OW[playerId])]= false

			// 分开判断两个队伍稳妥点
			if IsSentinelsPlayer(whichPlayer) then
				call FlushChildHashtable(P,'SPL0'+ playerId)
			endif
			if IsScourgesPlayer(whichPlayer) then
				call FlushChildHashtable(P,'SPLH'+ playerId)
			endif
			// 移除上一个英雄
			call EXRemoveHero(OW[playerId])
		endif
	endif

	if not Mode__SameHero or whichPlayer == HostPlayer then
		if(KS[playerId]and not Mode__SameHero) then
			call P7X(whichPlayer, GetObjectName('n0D5')+ " " + GetUnitName(whichUnit)+ ".")
		elseif((FT[playerId]and not Mode__DeathMatch ) or VT or OT) then
			call P7X(whichPlayer, GetObjectName('n0D3')+ " " + GetUnitName(whichUnit)+ ".")
		else
			call P7X(whichPlayer, GetObjectName('n0D2')+ " " + GetUnitName(whichUnit)+ ".")
		endif
	endif
	
	if IsNoHeroLimit then // 移除区域指示器 推测是英雄购买者
		call KillPlayerAllZoneIndicator(whichPlayer)
	endif
	if(GJV or V4) and IsNoHeroLimit then
		call KillPlayerAllZoneIndicator(whichPlayer)
	endif
	// 让能量圈可用
	call EnableCircle(whichPlayer)

	set IN[playerId]= true // 吞噬技能提示
	if GetUnitAbilityLevel(whichUnit,'Y253')> 0 then
		call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 15, "|c00ff0000通过吞噬技能获得的被动将会自动隐藏。|r")
	endif

	// 被动晕眩技能提示
	if IsPlayerHasSkill(whichPlayer, 311) or IsPlayerHasSkill(whichPlayer, 263) or IsPlayerHasSkill(whichPlayer, 275) then
		call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 10., " ")
		call DisplayTimedTextToPlayer(whichPlayer, 0, 0, 10., "|c00ff0303" + GetObjectName('n0G3')+ "|r")
	endif
	if not HaveSavedBoolean(HY, 600 + GetUnitPointValue(whichUnit), 87) then
		call SaveBoolean(HY,(600 + GetUnitPointValue(whichUnit)), 87,(true))
	endif
	// 设置英雄名称
	if not NeedHideHeroNames[LocalId] then
		call SetPlayerName(whichPlayer,(VMV[playerId])+ " (" + EJX(Player__Hero[playerId])+ ")")
	endif
	if Mode__MirrorDraft or GKV then
		call HidePlayerTavern(whichPlayer)
	endif
	call KVX(whichUnit) // 同步决斗的额外攻击力
	call RemoveRegion(r)
	set r = null
	//set whichUnit = null
	set whichPlayer = null
	set t = null
	return false
endfunction

function Q8X takes nothing returns boolean
	return((IsUnitType(GetSoldUnit(), UNIT_TYPE_HERO)))
endfunction

function Q9X takes nothing returns nothing
	local unit triggerUnit = GetSoldUnit()
	local unit QKX = GetSellingUnit()
	local player p = GetOwningPlayer(triggerUnit)
	if InHeroSelection then
		call PlayerPickHero(triggerUnit, GetPlayerId(p), QKX)
		return
	endif
	call XUX(p)
	set triggerUnit = null
	set QKX = null
endfunction
function AddGoldForIntervalActions takes nothing returns boolean
	local integer gold = 1
	if Mode__EasyMode then
		set gold = 2
	endif
	call SetPlayerState(Sentinels[1], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Sentinels[1], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	call SetPlayerState(Sentinels[2], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Sentinels[2], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	call SetPlayerState(Sentinels[3], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Sentinels[3], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	call SetPlayerState(Sentinels[4], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Sentinels[4], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	call SetPlayerState(Sentinels[5], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Sentinels[5], PLAYER_STATE_RESOURCE_GOLD)+ gold)

	call SetPlayerState(Scourges[1], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Scourges[1], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	call SetPlayerState(Scourges[2], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Scourges[2], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	call SetPlayerState(Scourges[3], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Scourges[3], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	call SetPlayerState(Scourges[4], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Scourges[4], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	call SetPlayerState(Scourges[5], PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(Scourges[5], PLAYER_STATE_RESOURCE_GOLD)+ gold)
	return false
endfunction
function SEX takes nothing returns nothing
	local integer IMX = R2I(GetGameTime()-WQ)
	local integer C8X = IMX / 60 -1 / 2
	local integer C9X = ModuloInteger(IMX, 60)
	if B3 then
		call SetResourceBarTime(C8X, C9X, false)
	elseif A3 == false then
		set IMX = R2I(16 -GetGameTime())
		set C8X = IMX / 60 -1 / 2
		set C9X = ModuloInteger(IMX, 60)
		call SetResourceBarTime(C8X, C9X, true)
	endif
	set QS = C8X
	set TS = C9X
endfunction

function HideMianbanCoolDownTimer takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 1)
	local integer id = LoadInteger(HY, h, 2)
	local integer TME = GetPlayerId(GetOwningPlayer(u))
	local integer TPE = PlayerSkillIndex[TME * HL + 4]
	local real cd = YDWEGetUnitAbilityState(u, id, 1)
	if id == HeroCommonSkills[TPE]or(HeroUpgradeSkills[TPE]!= null and id == HeroUpgradeSkills[TPE]) then
		call TimerStart(ESV[TME], cd, false, null)
	elseif Mode__SixSkills then
		call TimerStart(ETV[TME], cd, false, null)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set u = null
	set t = null
endfunction

function HideMianbanCoolDown takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 1, GetTriggerUnit())
	call SaveInteger(HY, h, 2, GetSpellAbilityId())
	call TriggerRegisterTimerEvent(t, 0.0, false)
	call TriggerAddCondition(t, Condition(function HideMianbanCoolDownTimer))
	set t = null
endfunction
function SXX takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local integer id = GetSpellAbilityId()
	local integer TME = GetPlayerId(GetOwningPlayer(WUE))
	local integer TPE = PlayerSkillIndex[TME * HL + 4]
	local real cd = 0.00
	if id =='A02W' then
		call TimerStart(ESV[TME], 0, false, null)
		call TimerStart(ETV[TME], 0, false, null)
	elseif IsUnitType(WUE, UNIT_TYPE_HERO) and IsUltimateSkill(id) then
		set cd = YDWEGetUnitAbilityDataReal(WUE, id, GetUnitAbilityLevel(WUE, id), 105)
		if cd > 0 then
			call HideMianbanCoolDown()
		endif
	endif
	set WUE = null
endfunction
function SOX takes nothing returns nothing
	local integer i = 0
	loop
	exitwhen(i >$D)
		set ESV[i]= CreateTimer()
		set ETV[i]= CreateTimer()
		set E[i]= CreateUnit(Player(i),'e00E', 0, 0, 0)
		set i = i + 1
	endloop
endfunction
function SRX takes nothing returns boolean
	local player p
	local integer i
	local integer id
	local integer g
	set i = 1
	loop
	exitwhen i > 5
		set p = Sentinels[i]
		set id = GetPlayerId(p)
		set g = GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)
		if g < EUV[id]then
			set EUV[id]= g
		endif
		set p = Scourges[i]
		set id = GetPlayerId(p)
		set g = GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)
		if g < EUV[id]then
			set EUV[id]= g
		endif
		set i = i + 1
	endloop
	return false
endfunction
function SIX takes integer WUE, integer targetUnit returns boolean
	local integer i = AssistListCurrentMaxNumber -1
	local real SAX = 0
	local real ECX =(GetGameTime())
	local integer EVX = 0
	loop
	exitwhen i == AssistListCurrentMaxNumber or SAX > E0V or EVX >$C8
		if i == 0 then
			set i = 8000 -1
		endif
		set EVX = EVX + 1
		set SAX = ECX -AssistTime[i]
		if EYV[i]== WUE and EZV[i]== targetUnit and SAX < E0V then
			set EYV[i]= 0
			set EZV[i]= 0
			return true
		endif
		set i = i -1
	endloop
	return false
endfunction
function SNX takes integer WUE, integer targetUnit returns boolean
	local integer i = AssistListCurrentMaxNumber -1
	local real SAX = 0
	local real ECX =(GetGameTime())
	local integer EVX = 0
	loop
	exitwhen i == AssistListCurrentMaxNumber or SAX > E0V or EVX >$C8
		if i == 0 then
			set i = 8000 -1
		endif
		set EVX = EVX + 1
		set SAX = ECX -AssistTime[i]
		if EYV[i]== WUE and EZV[i]== targetUnit and SAX < E0V then
			return true
		endif
		set i = i -1
	endloop
	return false
endfunction

function SCX takes unit SDX, unit SFX returns string
	local integer i = 1
	local integer SGX = GetPlayerId(GetOwningPlayer(SDX))
	local integer SHX = GetPlayerId(GetOwningPlayer(SFX))
	local integer BOX
	local string SJX = " " + GetObjectName('n0JY')+ " "
	local boolean SKX = false
	loop
	exitwhen i > 5
		if IsSentinelsPlayer(GetOwningPlayer(SFX)) then
			set BOX = GetPlayerId(Sentinels[i])
		else
			set BOX = GetPlayerId(Scourges[i])
		endif
		if SHX != BOX and SIX(BOX, SGX) then
			set CQ[BOX]= CQ[BOX]+ 1
			call JSX("Assist" + I2S(BOX), SGX)
			if SKX then
				set SJX = SJX + "/" + JS[BOX]+(VMV[GetPlayerId((Player(BOX)))])+ "|r"
			else
				set SJX = SJX + JS[BOX]+(VMV[GetPlayerId((Player(BOX)))])+ "|r"
			endif
			set SKX = true
		endif
		set i = i + 1
	endloop
	if SKX then
		return SJX
	endif
	return" "
endfunction
function SLX takes unit SDX, unit SFX returns string
	local integer i = 1
	local integer SGX = GetPlayerId(GetOwningPlayer(SDX))
	local integer SHX = GetPlayerId(GetOwningPlayer(SFX))
	local integer BOX
	local string SJX = ""
	local boolean SKX = false
	loop
	exitwhen i > 5
		if IsSentinelsPlayer(GetOwningPlayer(SFX)) then
			set BOX = GetPlayerId(Sentinels[i])
		else
			set BOX = GetPlayerId(Scourges[i])
		endif
		if SHX != BOX and SNX(BOX, SGX) then
			if SKX then
				set SJX = SJX + "/" + JS[BOX]+(VMV[GetPlayerId((Player(BOX)))])+ "|r"
			else
				set SJX = SJX + JS[BOX]+(VMV[GetPlayerId((Player(BOX)))])+ "|r"
			endif
			set SKX = true
		endif
		set i = i + 1
	endloop
	if SKX then
		return SJX
	endif
	return" "
endfunction
function SMX takes unit SDX, unit SFX returns integer
	local integer i = 1
	local integer SGX = GetPlayerId(GetOwningPlayer(SDX))
	local integer SHX = GetPlayerId(GetOwningPlayer(SFX))
	local integer BOX
	local integer EVX = 0
	loop
	exitwhen i > 5
		if IsSentinelsPlayer(GetOwningPlayer(SFX)) then
			set BOX = GetPlayerId(Sentinels[i])
		else
			set BOX = GetPlayerId(Scourges[i])
		endif
		if SHX != BOX and SNX(BOX, SGX) then
			set EVX = EVX + 1
		endif
		set i = i + 1
	endloop
	return EVX
endfunction
function SPX takes unit SDX, unit SFX returns boolean
	local integer i = 1
	local integer SGX = GetPlayerId(GetOwningPlayer(SDX))
	local integer SHX = GetPlayerId(GetOwningPlayer(SFX))
	local integer BOX
	local string SJX = " Assists: "
	local boolean SKX = false
	local integer x = 1
	set E1V[1]= null
	set E1V[2]= null
	set E1V[3]= null
	set E1V[4]= null
	set E1V[5]= null
	loop
	exitwhen i > 5
		if IsSentinelsPlayer(GetOwningPlayer(SFX)) then
			set BOX = GetPlayerId(Sentinels[i])
		else
			set BOX = GetPlayerId(Scourges[i])
		endif
		if SHX != BOX and SNX(BOX, SGX) then
			set E1V[x]= Player(BOX)
			set x = x + 1
			set SKX = true
		endif
		set i = i + 1
	endloop
	return SKX
endfunction
function SQX takes unit u returns unit
	if GetUnitAbilityLevel(u,'A1EL')> 0 then
		return CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	endif
	return u
endfunction
function SSX takes unit SDX, unit SFX, real L_X returns nothing
	local integer i = 1
	local integer EVX = 0
	call SPX(SDX, SFX)
	loop
	exitwhen i > 5
		if E1V[i]!= null then
			set EVX = EVX + 1
		endif
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > 5
		if E1V[i]!= null then
			set EUV[GetPlayerId(E1V[i])]= EUV[GetPlayerId(E1V[i])]+ R2I(L_X / EVX)
			call B8X(E1V[i], R2I(L_X / EVX), Player__Hero[GetPlayerId(E1V[i])])
		endif
		set i = i + 1
	endloop
endfunction
function STX takes integer id returns boolean
	return id =='ugho' or id =='unec' or id =='esen' or id =='edry' or id =='u001' or id =='u002' or id =='e00V' or id =='e00W' or id =='ebal' or id =='e026' or id =='umtw' or id =='u00R'
endfunction
function SUX takes unit u, integer TME returns nothing
	local texttag t = CreateTextTag()
	call SetTextTagText(t, "!", .03)
	call SetTextTagPosUnit(t, u, 0)
	call SetTextTagColorBJ(t, VQV[TME], VSV[TME], VTV[TME], 15)
	call SetTextTagVelocity(t, 0, .035)
	call SetTextTagFadepoint(t, 3)
	call SetTextTagLifespan(t, 1.5)
	call SetTextTagPermanent(t, false)
	call SetTextTagVisibility(t, F6V[LocalId]or(MW and(LocalPlayer== VKV or LocalPlayer== VLV)))
	set t = null
endfunction
function SWX takes unit SYX, unit SZX returns nothing
	local integer id = GetUnitTypeId(SZX)
	local integer TME = GetPlayerId(GetOwningPlayer(SYX))
	if GetOwningPlayer(SZX)== BW then
		set BQ[TME]= BQ[TME]+ 1
		set AQ[TME]= AQ[TME]+ 1
		call SaveInteger(HY, 400 + TME, 79, LoadInteger(HY, 400 + TME, 79)+ 1)
	else
		if STX(id) and(GetOwningPlayer(SZX)== Sentinels[0]or GetOwningPlayer(SZX)== Scourges[0]) then
			if IsUnitAlly(SZX, GetOwningPlayer(SYX)) then
				set NQ[TME]= NQ[TME]+ 1
				call SUX(SZX, TME)
			else
				set AQ[TME]= AQ[TME]+ 1
			endif
		endif
	endif
endfunction
function S_X takes unit SDX returns boolean
	return GetUnitTypeId(SDX)=='H00I' or GetUnitTypeId(SDX)=='H00J'
endfunction
function S0X takes unit SDX, location S1X returns nothing
	local integer h = GetHandleId(GetOwningPlayer(SDX))
	local unit S2X =(LoadUnitHandle(HY, h, 699))
	local unit S3X =(LoadUnitHandle(HY, h, 700))
	local unit S4X =(LoadUnitHandle(HY, h, 701))
	local unit S5X =(LoadUnitHandle(HY, h, 702))
	local unit S6X =(LoadUnitHandle(HY, h, 703))
	if S2X != null then
		call ReviveHeroLoc(S2X, S1X, true)
		call L8X(S2X)
	endif
	if S3X != null then
		call ReviveHeroLoc(S3X, S1X, true)
		call L8X(S3X)
	endif
	if S4X != null then
		call ReviveHeroLoc(S4X, S1X, true)
		call L8X(S4X)
	endif
	if S5X != null then
		call ReviveHeroLoc(S5X, S1X, true)
		call L8X(S5X)
	endif
	if S6X != null then
		call ReviveHeroLoc(S6X, S1X, true)
		call L8X(S6X)
	endif
	set S2X = null
	set S3X = null
	set S4X = null
	set S5X = null
	set S6X = null
endfunction
function S7X takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local player p
	local real x
	local real y
	if GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		set p = GetOwningPlayer(u)
		if IsScourgesPlayer(p) then
			set x = GetRectCenterX(GY)
			set y = GetRectCenterY(GY)
		else
			set x = GetRectCenterX(VZ)
			set y = GetRectCenterY(VZ)
		endif
		if OY == false and UnitIsDead(u) then
			call MEX(u, p, x, y, true)
			call ReviveHero(u, x, y, true)
			call SetUnitState(u, UNIT_STATE_MANA, 99999)
		endif
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTrigger(t)
	set u = null
	set t = null
endfunction
function S8X takes unit u, real SYV returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, u)
	call TriggerRegisterTimerEvent(t, SYV, false)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_HERO_REVIVE_FINISH)
	call TriggerAddCondition(t, Condition(function S7X))
	set t = null
endfunction
function S9X takes nothing returns boolean
	if GetItemPlayer(GetFilterItem())== NeutralPassivePlayer then
		call RemoveItem(GetFilterItem())
	endif
	return false
endfunction
function TVX takes nothing returns nothing
	call EnumItemsInRect(NI, Filter(function S9X), null)
endfunction
function TEX takes integer id returns integer
	local integer Y_E
	local integer TXX
	if HaveSavedInteger(U, id,'GOLD')== false then
		set Y_E = GetPlayerState(NeutralPassivePlayer, PLAYER_STATE_RESOURCE_GOLD)
		set TXX =$C350
		call SetPlayerState(NeutralPassivePlayer, PLAYER_STATE_RESOURCE_GOLD, TXX)
		call AddItemToStock(BI, id, 1, 1)
		call IssueImmediateOrderById(BI, id)
		set TXX = TXX -GetPlayerState(NeutralPassivePlayer, PLAYER_STATE_RESOURCE_GOLD)
		call SetPlayerState(NeutralPassivePlayer, PLAYER_STATE_RESOURCE_GOLD, Y_E)
		call SaveInteger(U, id,'GOLD', TXX)
		call TVX()
	else
		set TXX = LoadInteger(U, id,'GOLD')
	endif
	return TXX
endfunction
function TOX takes unit u returns integer
	local integer i = 0
	local integer TRX = 0
	local item it
	loop
		set it = UnitItemInSlot(u, i)
		if it != null then
			set TRX = TRX + TEX(GetItemTypeId(it))
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	set it = null
	return TRX
endfunction
function TIX takes integer nw, unit TAX returns nothing
	local texttag tt
	local integer h
	local integer hu = GetHandleId(TAX)
	local integer id = GetPlayerId(GetOwningPlayer(TAX))
	if HaveSavedHandle(HY, hu,'netw') then
		set tt = LoadTextTagHandle(HY, hu,'netw')
	else
		set tt = CreateTextTag()
		call SetTextTagPosUnit(tt, TAX, 0)
		call SetTextTagVelocity(tt, 0, 0)
		call SetTextTagPermanent(tt, true)
		call SaveTextTagHandle(HY, hu,'netw', tt)
	endif
	call SetTextTagText(tt, I2S(nw), .025)
	call SetTextTagVisibility(tt, IsUnitAlly(TAX, LocalPlayer) or IsObserver)
	if KFX(GetHeroLevel(Player__Hero[id]))* 50 + 50 > GetPlayerState(GetOwningPlayer(TAX), PLAYER_STATE_RESOURCE_GOLD) or UF[id]or W4[id]=='h0D4' then
		call SetTextTagColor(tt, 255, 75, 0, 255)
	else
		call SetTextTagColor(tt, 255,$DC, 0, 255)
	endif
	set tt = null
endfunction
function TNX takes nothing returns nothing
	local integer i = 1
	local integer TME
	local player p
	local integer TBX
	loop
		set TBX = 0
		set p = Sentinels[i]
		if XGX(p) then
			set TME = GetPlayerId(p)
			if GR[TME]then
				if Player__Hero[TME]!= null then
					set TBX = TBX + TOX(Player__Hero[TME])
					set TBX = TBX + TOX(Circle[TME])
				endif
				if HaveSavedHandle(HY, GetHandleId(p), 333) then
					set TBX = TBX + TOX(LoadUnitHandle(HY, GetHandleId(p), 333))
				endif
				set TBX = TBX + XX[TME]
				set GR[TME]= false
				set DR[TME]= TBX
			else
				set TBX = DR[TME]
			endif
			set RI[TME]= TBX + GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)
			call TIX(RI[TME], Circle[TME])
		endif
		set TBX = 0
		set p = Scourges[i]
		if XGX(p) then
			set TME = GetPlayerId(p)
			if GR[TME]then
				if Player__Hero[TME]!= null then
					set TBX = TBX + TOX(Player__Hero[TME])
					set TBX = TBX + TOX(Circle[TME])
				endif
				if HaveSavedHandle(HY, GetHandleId(p), 333) then
					set TBX = TBX + TOX(LoadUnitHandle(HY, GetHandleId(p), 333))
				endif
				set TBX = TBX + XX[TME]
				set GR[TME]= false
				set DR[TME]= TBX
			else
				set TBX = DR[TME]
			endif
			set RI[TME]= TBX + GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)
			call TIX(RI[TME], Circle[TME])
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
endfunction
function TCX takes nothing returns nothing
	set NI = Rect(6592,-7872, 7392,-7264)
	set BI = CreateUnit(NeutralPassivePlayer,'nshe', GetRectCenterX(NI), GetRectCenterY(NI), 0)
	call UnitAddAbility(BI,'Asid')
	call UnitRemoveAbility(BI,'Amov')
	call UnitAddAbility(BI,'Aloc')
	call SetUnitX(BI, GetRectCenterX(NI))
	call SetUnitY(BI, GetRectCenterY(NI))
	call ShowUnit(BI, false)
	set II = CreateTimer()
	call TimerStart(II, 1, true, function TNX)
endfunction
function TDX takes nothing returns boolean
	if(IsAliveNotStrucNotWard(GetFilterUnit())) and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitIllusion(GetFilterUnit())== false then
		if IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(E2V)) and GetItemOfTypeFromUnit(GetFilterUnit(), RealItemTypeId[NIV])!= null then
			call SetItemCharges(GetItemOfTypeFromUnit(GetFilterUnit(), RealItemTypeId[NIV]), GetItemCharges(GetItemOfTypeFromUnit(GetFilterUnit(), RealItemTypeId[NIV]))+ 1)
		endif
	endif
	return false
endfunction
function TFX takes nothing returns boolean
	local item i
	local integer HUX
	if E4V == 0 and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitIllusion(GetFilterUnit())== false and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(E3V)) then
		set i = GetItemOfTypeFromUnit(GetFilterUnit(), RealItemTypeId[NUV])
		if i != null then
			set E4V = E4V + 1
			set HUX = GetItemCharges(i)
			if HUX == 0 then
				set HUX = 2
			else
				set HUX = HUX + 1
			endif
			call SetItemCharges(i, HUX)
		endif
		set i = null
	endif
	set i = null
	return false
endfunction
function TGX takes unit u returns nothing
	local group g = LoginGroup(12)
	set E2V = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u),$659, Condition(function TDX))
	call LogoutGroup(g)
	set g = null
endfunction
function THX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit TJX =(LoadUnitHandle(HY, h, 335))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real x
	local real y
	local real a
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if GetTriggerUnit()!= TJX then
			call KillUnit(TJX)
		endif
	else
		set a = GetUnitFacing(targetUnit)* bj_RADTODEG
		set x = GetUnitX(targetUnit)+ 75
		set y = GetUnitY(targetUnit)+ 75
		call SetUnitX(TJX, x)
		call SetUnitY(TJX, y)
		call IssueTargetOrderById(TJX, 851983, targetUnit)
	endif
	set t = null
	set TJX = null
	set targetUnit = null
	return false
endfunction
function TKX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local unit TJX
	if GetSummoningUnit()== dummyUnit then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set TJX = GetSummonedUnit()
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterDeathEvent(t, TJX)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerRegisterTimerEvent(t, .05, true)
		call TriggerAddCondition(t, Condition(function THX))
		call SaveUnitHandle(HY, h, 335,(TJX))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call UnitAddAbility(TJX,'Aloc')
		call SetUnitPosition(TJX, GetUnitX(targetUnit)+ 100 , GetUnitY(targetUnit)+ 100 )
		call IssueTargetOrderById(TJX, 851983, targetUnit)
		call SetUnitMoveSpeed(TJX, 522)
	endif
	set t = null
	set targetUnit = null
	set WUE = null
	set dummyUnit = null
	set TJX = null
	return false
endfunction
function TLX takes unit WUE, unit TMX returns nothing
	local unit targetUnit = TMX
	local unit dummyUnit
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	if OZX(targetUnit) then
		set targetUnit =(Player__Hero[GetPlayerId(GetOwningPlayer((targetUnit)))])
	endif
	set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function TKX))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call UnitAddPermanentAbility(dummyUnit,'A2E7')
	call IssueTargetOrderById(dummyUnit, 852274, targetUnit)
	set t = null
	set targetUnit = null
	set dummyUnit = null
endfunction
function TPX takes nothing returns boolean
	if(IsAliveNotStrucNotWard(GetFilterUnit())) and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitIllusion(GetFilterUnit())== false then
		if IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(E2V))== false and GetItemOfTypeFromUnit(GetFilterUnit(), RealItemTypeId[RAV])!= null then
		endif
	endif
	return false
endfunction
function TQX takes unit u returns nothing
	local group g = LoginGroup(13)
	set E2V = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u),$659, Condition(function TPX))
	call LogoutGroup(g)
	set g = null
endfunction
function TSX takes unit u returns nothing
	local group g = LoginGroup(14)
	set E4V = 0
	set E3V = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u),$591, Condition(function TFX))
	call LogoutGroup(g)
	set E4V = 0
	set g = null
endfunction
function TTX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer TUX =(LoadInteger(HY, h, 88))
	local integer i = 1
	local player p
	local string TWX
	loop
	exitwhen i > 5
		if TUX == 0 then
			set p = Sentinels[i]
			set TWX = JS[GetPlayerId(Sentinels[0])]+ GetObjectName('n03N')+ "|r " + GetObjectName('n03P')+ " " + JS[GetPlayerId(Sentinels[0])]+ GetObjectName('n03Q')+ "|r"
		else
			set p = Scourges[i]
			set TWX = JS[GetPlayerId(Scourges[0])]+ GetObjectName('n03O')+ "|r " + GetObjectName('n03P')+ " " + JS[GetPlayerId(Scourges[0])]+ GetObjectName('n03Q')+ "|r"
		endif
		call DisplayTimedTextToPlayer(p, 0, 0, 10, TWX)
		call BYX(E1, p)
		set i = i + 1
	endloop
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set p = null
	return false
endfunction
function TYX takes integer TUX returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1.5, false)
	call TriggerAddCondition(t, Condition(function TTX))
	call SaveInteger(HY, h, 88,(TUX))
	set t = null
endfunction
function TZX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer T_X =(LoadInteger(HY, h, 89))
	local string TWX =(LoadStr(HY, h, 90))
	local integer WWV = LoadInteger(HY,'0SND','0PID')
	if T_X == 1 then
		call BWX(M0)
	elseif T_X == 2 then
		call BWX(X1)
	elseif T_X == 3 then
		call BWX(I1)
	elseif T_X == 4 then
		call BWX(A1)
	endif
	call SetTopMessageText(TWX, 8.)
	//call DisplayTimedTextToAllPlayer(XY, CR[LocalId], TWX)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function T0X takes string TWX, integer T_X returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1.5, false)
	call TriggerAddCondition(t, Condition(function TZX))
	call SaveStr(HY, h, 90,(TWX))
	call SaveInteger(HY, h, 89,(T_X))
	set t = null
endfunction
function T1X takes player T2X, integer T3X returns nothing
	local integer O3X = 1
	local integer LZX
	if IsSentinelsPlayer(T2X) then
		set LZX = XKX(RW)
	else
		set LZX = XKX(IW)
	endif
	if IsSentinelsPlayer(T2X) then
		loop
		exitwhen O3X > 5
			if IsPlaying(Sentinels[O3X]) then
				set EUV[GetPlayerId(Sentinels[O3X])]= EUV[GetPlayerId(Sentinels[O3X])]+ T3X / LZX
				call B8X(Sentinels[O3X], T3X / LZX, Player__Hero[GetPlayerId(Sentinels[O3X])])
			endif
			set O3X = O3X + 1
		endloop
	else
		loop
		exitwhen O3X > 5
			if IsPlaying(Scourges[O3X]) then
				set EUV[GetPlayerId(Scourges[O3X])]= EUV[GetPlayerId(Scourges[O3X])]+ T3X / LZX
				call B8X(Scourges[O3X], T3X / LZX, Player__Hero[GetPlayerId(Scourges[O3X])])
			endif
			set O3X = O3X + 1
		endloop
	endif
endfunction
function T4X takes unit SDX, integer T5X returns nothing
	local player T6X = GetOwningPlayer(SDX)
	call SetPlayerState(T6X, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(T6X, PLAYER_STATE_RESOURCE_GOLD)-T5X)
	set T6X = null
endfunction
function T7X takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='o003' then
		call KillUnit(GetFilterUnit())
		return true
	endif
	return false
endfunction
function T8X takes nothing returns nothing
	local group g = LoginGroup(15)
	call GroupEnumUnitsInRect(g, bj_mapInitialPlayableArea, Condition(function T7X))
	call LogoutGroup(g)
	set g = null
endfunction
function T9X takes unit SFX, player T6X, player T2X returns boolean
	return SFX == null or(IsSentinelsPlayer(T6X) and IsSentinelsPlayer(T2X)) or(IsScourgesPlayer(T6X) and IsScourgesPlayer(T2X))
endfunction
function UVX takes integer id returns integer
	local integer i = 1
	local integer xp = 0
	if id == 0 then
		loop
			if Player__Hero[GetPlayerId(Sentinels[i])]!= null then
				set xp = xp + GetHeroXP(Player__Hero[GetPlayerId(Sentinels[i])])
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
	else
		loop
			if Player__Hero[GetPlayerId(Scourges[i])]!= null then
				set xp = xp + GetHeroXP(Player__Hero[GetPlayerId(Scourges[i])])
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
	endif
	return xp
endfunction
function UEX takes integer id returns integer
	local integer i = 1
	local integer T9V = 0
	if id == 0 then
		loop
			set T9V = T9V + RI[GetPlayerId(Sentinels[i])]
			set i = i + 1
		exitwhen i > 5
		endloop
	else
		loop
			set T9V = T9V + RI[GetPlayerId(Scourges[i])]
			set i = i + 1
		exitwhen i > 5
		endloop
	endif
	return T9V
endfunction
function UXX takes player p returns integer
	local integer i = 1
	local integer UOX = 1
	local integer TME = GetPlayerId(p)
	local integer nw = RI[TME]
	if IsSentinelsPlayer(p) then
		loop
			if GetPlayerId(Sentinels[i])!= TME then
				if RI[GetPlayerId(Sentinels[i])]> nw then
					set UOX = UOX + 1
				endif
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
	else
		loop
			if GetPlayerId(Scourges[i])!= TME then
				if RI[GetPlayerId(Scourges[i])]> nw then
					set UOX = UOX + 1
				endif
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
	endif
	return UOX
endfunction
function URX takes nothing returns nothing
	local integer i = 1
	local integer WXV = LoadInteger(VV,'Assi', 0)
	local real array r
	local player array p
	local integer k = 0
	if WXV == 2 then
		set r[0]= .75
		set r[1]= 1.25
	elseif WXV == 3 then
		set r[0]= .75
		set r[1]= 1.
		set r[2]= 1.25
	elseif WXV == 4 then
		set r[0]= .75
		set r[1]= .75
		set r[2]= 1.25
		set r[3]= 1.25
	elseif WXV >= 5 then
		set r[0]= .75
		set r[1]= .75
		set r[2]= 1.
		set r[3]= 1.25
		set r[4]= 1.25
	endif
	loop
		if HaveSavedHandle(VV,'Assi', i) then
			set p[k]= LoadPlayerHandle(VV,'Assi', i)
			set k = k + 1
		endif
		set i = i + 1
	exitwhen i > 5 or k > WXV -1
	endloop
	set i = 0
	loop
		call SaveReal(VV,'Assi', GetPlayerId(p[i]), r[i])
		set i = i + 1
	exitwhen i > k
	endloop
endfunction
function UIX takes nothing returns nothing
	local group g = LoadGroupHandle(VV,'assi', 0)
	local group gg = LoginGroup(16)
	local integer UOX
	local unit u2
	local integer i = 0
	call FlushChildHashtable(VV,'Assi')
	call GroupAddGroup(g, gg)
	loop
		set u2 = FirstOfGroup(gg)
	exitwhen u2 == null
		set i = i + 1
		set UOX = UXX(GetOwningPlayer(u2))
		if HaveSavedHandle(VV,'Assi', UOX) then
			loop
				set UOX = UOX + 1
			exitwhen HaveSavedHandle(VV,'Assi', UOX)== false
			endloop
		endif
		call SavePlayerHandle(VV,'Assi', UOX, GetOwningPlayer(u2))
		call SaveInteger(VV,'Assi', i, GetPlayerId(GetOwningPlayer(u2)))
		call SaveInteger(VV,'Assi', 0, LoadInteger(VV,'Assi', 0)+ 1)
		call GroupRemoveUnit(gg, u2)
	endloop
	if i == 1 then
		call SaveReal(VV,'Assi', LoadInteger(VV,'Assi', 1), 1)
	else
		call URX()
	endif
	call LogoutGroup(gg)
	call RemoveSavedHandle(VV,'assi', 0)
endfunction
function UAX takes unit u1, unit u2 returns real
	local real x1 = GetUnitX(u1)
	local real y1 = GetUnitY(u1)
	local real x2 = GetUnitX(u2)
	local real y2 = GetUnitY(u2)
	if u1 == null or u2 == null then
		return I2R($540BE3FF)
	else
		return(x1 -x2)*(x1 -x2)+(y1 -y2)*(y1 -y2)
	endif
	return 1.
endfunction
function UNX takes nothing returns nothing
	if GetUnitAbilityLevel(GetEnumUnit(),'Aloc')== 0 and UnitIsDead(GetEnumUnit())== false and IsUnitEnemy(GetEnumUnit(), GetOwningPlayer(SB)) and UAX(GetTriggerUnit(), GetEnumUnit())<= QB * QB then
		call GroupAddUnit(IV, GetEnumUnit())
	endif
endfunction
function UBX takes nothing returns nothing
	if GetUnitAbilityLevel(GetEnumUnit(),'Aloc')== 0 and UnitIsDead(GetEnumUnit())== false and IsUnitAlly(GetEnumUnit(), GetOwningPlayer(SB)) and UAX(GetTriggerUnit(), GetEnumUnit())<= QB * QB then
		call GroupAddUnit(IV, GetEnumUnit())
	endif
endfunction
function UCX takes nothing returns nothing
	if GetUnitAbilityLevel(GetEnumUnit(),'Aloc')== 0 and UnitIsDead(GetEnumUnit())== false and UAX(GetTriggerUnit(), GetEnumUnit())<= QB * QB then
		call GroupAddUnit(IV, GetEnumUnit())
	endif
endfunction
function UDX takes nothing returns nothing
	local unit u = GetTriggerUnit()
	call GroupClear(IV)
	if GetOwningPlayer(u)== BW then
		if IsUnitType(u, UNIT_TYPE_ANCIENT)== false then
			call ForGroup(AllHerosGroup, function UCX)
		else
			call ForGroup(AllHerosGroup, function UBX)
		endif
	else
		if IsUnitAlly(u, GetOwningPlayer(GetKillingUnit())) and YB == false then
			call ForGroup(AllHerosGroup, function UNX)
		else
			call ForGroup(AllHerosGroup, function UBX)
		endif
	endif
	set u = null
endfunction
function UFX takes nothing returns nothing
	call GroupClear(IV)
	call ForGroup(AllHerosGroup, function UBX)
endfunction
function UGX takes unit SYX returns boolean
	local integer level
	local integer UHX = 0
	local integer UJX = 0
	local group g
	local integer UKX
	local integer ULX
	local real UMX
	local real UPX
	local integer xp
	local unit u = GetTriggerUnit()
	local integer UQX
	local integer USX
	local integer UTX
	local real UUX
	local real a
	local real UWX
	local integer UYX
	local integer UZX
	local integer heroPos
	local integer U_X
	local real U0X
	local real U1X
	local integer U2X
	local integer U3X
	local integer TME
	local real U4X
	local real U5X
	if IsUnitType(u, UNIT_TYPE_HERO) and not MOX(GetUnitTypeId(u)) then
		set level = GetHeroLevel(u)
		set xp = GetHeroXP(u)
		set SB = SYX
		call UFX()
		if IsUnitType(SYX, UNIT_TYPE_HERO) and not LoadBoolean(HY, GetHandleId(SYX), QR) then
			if HeroIsDummyUnit(SYX) then
				if UnitAlive(Player__Hero[GetPlayerId(GetOwningPlayer(SYX))]) then
					call GroupAddUnit(IV, Player__Hero[GetPlayerId(GetOwningPlayer(SYX))])
				endif
			else
				if UnitAlive(SYX) or LoadInteger(HY, GetHandleId(SYX),'A06B')== 1 then
					call GroupAddUnit(IV, SYX)
				endif
			endif
		else
			// 存在英雄 并且凶手单位存活 而且主人单位还是自爆的
			if Player__Hero[GetPlayerId(GetOwningPlayer(SYX))]!= null and ( UnitAlive(Player__Hero[GetPlayerId(GetOwningPlayer(SYX))]) or LoadInteger(HY, GetHandleId(Player__Hero[GetPlayerId(GetOwningPlayer(SYX))]),'A06B')== 1 ) then
				call GroupAddUnit(IV, Player__Hero[GetPlayerId(GetOwningPlayer(SYX))])
			endif
		endif
		set UYX = CountUnitsInGroup(IV)
		if UYX == 0 then
			set u = null
			set g = null
			return false
		endif
		if IsScourgesPlayer(GetOwningPlayer(u)) then
			set UKX = UVX(0)
			set ULX = UVX(1)
			set UTX = UEX(0)
			set USX = UEX(1)
		else
			set UKX = UVX(1)
			set ULX = UVX(0)
			set UTX = UEX(1)
			set USX = UEX(0)
		endif
		set U4X = IMaxBJ(USX -UTX, 0)* 1.
		set UMX = RMaxBJ((ULX -UKX)* 1. /(1. * IMaxBJ(ULX + UKX, 1)), 0)
		set UPX = UMX * xp
		if UYX == 1 then
			set UHX = 20 * level + R2I(UPX * .23 * .6)
		elseif UYX == 2 then
			set UHX =$F* level + R2I(UPX * .23 * .6)
		elseif UYX == 3 then
			set UHX =$A* level + R2I(UPX * .2 * .6)
		elseif UYX == 4 then
			set UHX = 7 * level + R2I(UPX * .15 * .6)
		elseif UYX >= 5 then
			set UHX = 5 * level + R2I(UPX * .12 * .6)
		endif
		set UZX = UXX(GetOwningPlayer(u))
		set UQX = RI[GetPlayerId(GetOwningPlayer(u))]
		set a =(1. * USX)/((UTX + 1)* 1.)-1.
		set UUX = RMinBJ(RMaxBJ(a, 0), 1)
		set UWX = UUX
		if UYX == 1 then
			set U_X =$96
			set U0X = 8.
			set U1X = .0375
			set U2X = 100 
			set U5X = 100.
		elseif UYX == 2 then
			set U_X = 100 
			set U0X = 7.
			set U1X = .0375
			set U2X = 75
			set U5X = 75.
		elseif UYX == 3 then
			set U_X = 40
			set U0X = 6.
			set U1X = .0375
			set U2X = 40
			set U5X = 50.
		elseif UYX == 4 then
			set U_X = 25
			set U0X = 4.
			set U1X = .03
			set U2X = 25
			set U5X = 35.
		elseif UYX >= 5 then
			set U_X = 20
			set U0X = 4.
			set U1X = .0225
			set U2X = 20
			set U5X = 25.
		endif
		set U3X = R2I((U_X + U0X * level + U1X * UQX * UWX + U5X * RMinBJ(U4X / 4000., 1))*(1.2 -0.1 *(UZX -1)))
		call SaveGroupHandle(VV,'assi', 0, IV)
		call UIX()
		set level = R2I(RNX(u)/ UYX)
		loop
			set u = FirstOfGroup(IV)
		exitwhen u == null
			set TME = GetPlayerId(GetOwningPlayer(u))
			set UJX = R2I(U3X * LoadReal(VV,'Assi', TME))
			call SaveInteger(VV,'Assi', TME, UJX)
			if u != SYX or UnitAlive(u) or LoadInteger(HY, GetHandleId(SYX),'A06B')== 1 then
				call AddHeroXPSimple(u, UHX, true)
			endif
			if u == SYX and not IsUnitInRange(SYX, GetTriggerUnit(), QB) then //GetDistanceBetweenUnits(SYX, GetTriggerUnit())> QB then
				if UnitAlive(u) or LoadInteger(HY, GetHandleId(SYX),'A06B')== 1 then
					call AddHeroXPSimple(u, level * UYX, true)
				endif
			else
				if UnitAlive(u) or LoadInteger(HY, GetHandleId(SYX),'A06B')== 1 then
					call AddHeroXPSimple(u, level, true)
				endif
			endif
			set E5V[TME]= E5V[TME]+ UHX
			set E6V[TME]= E6V[TME]+ UJX
			set EUV[TME]= EUV[TME]+ UJX
			call B8X(GetOwningPlayer(u), UJX, u)
			call GroupRemoveUnit(IV, u)
		endloop
	endif
	set u = null
	set g = null
	return false
endfunction
function U6X takes nothing returns nothing
	set IS[LoadInteger(HY, GetHandleId(GetExpiredTimer()), 0)]= 0
endfunction
// 英雄阵亡
function U7X takes nothing returns nothing
	local boolean U8X = false
	local unit U9X = GetDyingUnit()
	local unit WVX = GetKillingUnit()
	local player WEX = GetOwningPlayer(WVX)
	local player WXX = GetOwningPlayer(U9X)
	local integer WOX
	local integer WRX
	local integer WIX = 0
	local integer WAX = 0
	local boolean WNX = false
	local string WBX = ""
	local string WCX = ""
	local string WDX = ""
	local integer WFX
	local string WGX
	local string WHX
	local string WJX
	local string WKX
	local boolean WLX = false
	local real WMX = 1
	local real WPX = 1
	local real WQX = 0
	local integer WSX = 0
	local trigger t
	local real WTX
	local integer WUX
	local integer unittypeId
	local integer WWX = GetPlayerState(WXX, PLAYER_STATE_RESOURCE_GOLD)
	local integer WYX = WWX -EUV[GetPlayerId(WXX)]
	local unit WZX
	local unit W_X
	local string W0X
	local boolean W1X = LoadInteger(HY, GetHandleId(U9X), 4418)== 1 or(LoadInteger(HY, GetHandleId(U9X), 4419)== 1)
	local item it
	if W1X then
		set UF[GetPlayerId(WXX)]= true
	endif
	if LoadInteger(HY, GetHandleId(U9X), 4333)== 1 or LoadInteger(HY, GetHandleId(U9X), 4334)== 1 then
		set WVX = Player__Hero[GetPlayerId(LoadPlayerHandle(HY, GetHandleId(U9X), 4333))]
		set WEX = GetOwningPlayer(WVX)
		set WSX = 30
	endif
	if WVX == null and LoadInteger(HY, GetHandleId(U9X), 4500)== 1 then
		set WVX = QEV
		set WEX = GetOwningPlayer(WVX)
	endif
	set WUX = SMX(U9X, WVX)
	if IsPlayerAlly(WEX, WXX) and((LoadInteger(HY, GetHandleId(WVX), 4328))== 1) and PG != null then
		set WVX = PG
		set WEX = GetOwningPlayer(WVX)
	endif
	if T9X(WVX, WXX, WEX)== false and WUX == 1 and XFX(WEX)== false and WEX != BW then
		call SPX(U9X, WVX)
		set WEX = E1V[1]
		set WVX = Player__Hero[GetPlayerId(WEX)]
	endif
	set M2[GetPlayerId(GetOwningPlayer(U9X))]= true
	if WEX == null then
		set WEX = WXX
	endif
	if GetUnitAbilityLevel(WVX,'Aloc')> 0 then
		set WVX = Player__Hero[GetPlayerId(WEX)]
	endif
	if IsPlayerEnemy(WEX, WXX) and WEX != Player($C) then
		call UGX(WVX)
	endif
	if Mode__ItemDrop and GetUnitTypeId(U9X)!='H00J' then
		set it = UnitRemoveItemFromSlot(U9X, GetRandomInt(0, 5))
		if GetItemTypeId(it)=='I00K' then
			call CreateItem('I00G', GetItemX(it), GetItemY(it))
			call RemoveItem(it)
		endif
		set it = null
	endif
	set WOX = GetPlayerId(WEX)
	set WRX = GetPlayerId(WXX)
	if IsSentinelsPlayer(WXX) then
		if IsSentinelsPlayer(WEX) then
			set U8X = true
			if(WEX == WXX) then
				call DisplayTimedTextToAllPlayer(XY, CR[LocalId], JS[WRX]+ VMV[WRX]+ "|r " + GetObjectName('n03R'))
			else
				call DisplayTimedTextToAllPlayer(XY, CR[LocalId], J2X(WXX, WEX))
			endif
		elseif IsScourgesPlayer(WEX) then
			set WNX = true
			set IQ[GetPlayerId(Sentinels[0])]= IQ[GetPlayerId(Sentinels[0])]+ 1
			set RQ[GetPlayerId(Scourges[0])]= RQ[GetPlayerId(Scourges[0])]+ 1
			set FS[2]= FS[2]+ 1
			set FS[1]= 0
			if WEX != Scourges[0]then
				set RQ[WOX]= RQ[WOX]+ 1
				set XS[WOX]= XS[WOX]+ 1
			endif
		endif
	elseif IsScourgesPlayer(WXX) then
		if IsScourgesPlayer(WEX) then
			set U8X = true
			if(WEX == WXX) then
				call DisplayTimedTextToAllPlayer(XY, CR[LocalId], JS[WRX]+(VMV[WRX])+ "|r " + GetObjectName('n03R'))
			else
				call DisplayTimedTextToAllPlayer(XY, CR[LocalId], J2X(WXX, WEX))
			endif
		elseif IsSentinelsPlayer(WEX) then
			set WNX = true
			set IQ[GetPlayerId(Scourges[0])]= IQ[GetPlayerId(Scourges[0])]+ 1
			set RQ[GetPlayerId(Sentinels[0])]= RQ[GetPlayerId(Sentinels[0])]+ 1
			set FS[1]= FS[1]+ 1
			set FS[2]= 0
			if WEX != Sentinels[0]then
				set RQ[WOX]= RQ[WOX]+ 1
				set XS[WOX]= XS[WOX]+ 1
			endif
		endif
	endif
	if WEX == BW then
		set WNX = false
		if GetUnitTypeId(WVX)=='n00L' then
			call DisplayTimedTextToAllPlayer(XY, CR[LocalId], JS[WRX]+ VMV[WRX]+ "|r " + GetObjectName('n03T'))
		else
			call DisplayTimedTextToAllPlayer(XY, CR[LocalId], JS[WRX]+ VMV[WRX]+ "|r " + GetObjectName('n03U'))
		endif
		set U8X = true
	endif
	if X4 then
		call PlaySoundAtPoint(Q0, GetUnitX(U9X), GetUnitY(U9X))
	endif
	call JSX("Hero" + I2S(WRX), WOX)
	if XS[WOX]> HQ[WOX]then
		set HQ[WOX]= XS[WOX]
	endif
	set WFX = XS[WRX]
	if WFX > 2 and U8X == false then
		if WFX == 3 then
			set WBX = "|c0000ff40" + GetObjectName('n04L')+ "|r"
		elseif WFX == 4 then
			set WBX = "|c00400080" + GetObjectName('n04N')+ "|r"
		elseif WFX == 5 then
			set WBX = "|c00ff0080" + GetObjectName('n04M')+ "|r"
		elseif WFX == 6 then
			set WBX = "|c00ff8000" + GetObjectName('n04J')+ "|r"
		elseif WFX == 7 then
			set WBX = "|c00808000" + GetObjectName('n04I')+ "|r"
		elseif WFX == 8 then
			set WBX = "|c00ff80ff" + GetObjectName('n03V')+ "|r"
		elseif WFX == 9 then
			set WBX = "|c00ff0000" + GetObjectName('n03W')+ "|r"
		elseif WFX >= 10 then
			set WBX = "|c00ff8000" + GetObjectName('n03X')+ "|r"
		endif
		set WIX =(IMinBJ(WFX, 10)-2)* 60
	endif
	set WFX = XS[WOX]
	set WZX = WVX
	if IsUnitType(WZX, UNIT_TYPE_HERO)== false then
		set WZX = Player__Hero[GetPlayerId(GetOwningPlayer(WZX))]
	endif
	set W_X = U9X
	if IsUnitType(W_X, UNIT_TYPE_HERO)== false then
		set W_X = Player__Hero[GetPlayerId(GetOwningPlayer(W_X))]
	endif
	if U8X == false and WNX then
	endif
	if WFX > 2 and U8X == false then
		if WFX == 3 then
			call BWX(U0)
			set WCX = " " + GetObjectName('n04K')+ " |c0000ff40" + GetObjectName('n04L')+ "|r" + GetObjectName('n049')
		elseif WFX == 4 then
			call BWX(L0)
			set WCX = " " + GetObjectName('n04H')+ " |c00400080" + GetObjectName('n04N')+ "|r" + GetObjectName('n049')
		elseif WFX == 5 then
			call BWX(W0)
			set WCX = " " + GetObjectName('n04G')+ " |c00ff0080" + GetObjectName('n04M')+ "|r" + GetObjectName('n049')
		elseif WFX == 6 then
			call BWX(O1)
			set WCX = " " + GetObjectName('n04H')+ " |c00ff8000" + GetObjectName('n04J')+ "|r" + GetObjectName('n04A')
		elseif WFX == 7 then
			call BWX(R1)
			set WCX = " " + GetObjectName('n04H')+ " |c00808000" + GetObjectName('n04I')+ "|r" + GetObjectName('n04A')
		elseif WFX == 8 then
			call BWX(Z0)
			set WCX = " " + GetObjectName('n04G')+ " |c00ff80ff" + GetObjectName('n03V')+ "|r" + GetObjectName('n04A')
		elseif WFX == 9 then
			call BWX(S0)
			set WCX = " " + GetObjectName('n04H')+ " |c00ff0000" + GetObjectName('n03W')+ "|r" + GetObjectName('n04B')
		elseif WFX >= 10 then
			call BWX(T0)
			set WCX = " " + GetObjectName('n04H')+ " |c00ff8000" + GetObjectName('n03X')+ "|r. " + GetObjectName('n04F')+ GetObjectName('n04B')
		endif
	endif
	if U8X == false then
		set WIX = WIX + 100 + GetHeroLevel(U9X)* 9
		set WGX = JS[WRX]+(VMV[GetPlayerId((WXX))])+ "|r"
		set WHX = JS[WOX]+(VMV[GetPlayerId((WEX))])+ "|r"
		set WKX = "|c00FFDC00" + I2S(WIX)
		if LoadInteger(VV,'Assi', GetPlayerId(WEX))> 0 then
			set WKX = WKX + "(+" + I2S(LoadInteger(VV,'Assi', GetPlayerId(WEX)))+ ")"
		endif
		set WKX = WKX + "|r"
		if WEX == Sentinels[0]or WEX == Scourges[0]then
			if WUX == 0 then
				if WEX == Sentinels[0]then
					set WJX = WHX + " " + GetObjectName('n042')+ " " + WGX + GetObjectName('n043')+ GetObjectName('n049')+ " " + WKX + " " + GetObjectName('n044')+ "."
					call T1X(WEX, WIX)
				elseif WEX == Scourges[0]then
					set WJX = WHX + " " + GetObjectName('n042')+ " " + WGX + GetObjectName('n043')+ GetObjectName('n049')+ " " + WKX + " " + GetObjectName('n044')+ "."
					call T1X(WEX, WIX)
				endif
			elseif WUX > 1 then
				set WJX = WHX + " " + GetObjectName('n042')+ " " + WGX + GetObjectName('n043')+ GetObjectName('n049')+ " " + WKX + " " + GetObjectName('n044')+ "."
				call SSX(U9X, WVX, WIX)
			endif
		elseif WBX == ""and WCX == ""then
			set WJX = WHX + " " + GetObjectName('n042')+ " " + WGX + GetObjectName('n043')+ " " + GetObjectName('n04C')+ " " + WKX + " " + GetObjectName('n045')+ GetObjectName('n049')
		elseif WBX == ""and WCX != ""then
			set WJX = WHX + " " + GetObjectName('n042')+ " " + WGX + GetObjectName('n043')+ " " + GetObjectName('n04C')+ " " + WKX + " " + GetObjectName('n045')+ GetObjectName('n049')
		elseif WBX != ""and WCX == ""then
			set WJX = WHX + " " + GetObjectName('n048')+ " " + WGX + GetObjectName('n047')+ " " + WBX + " " + GetObjectName('n046')+ " " + WKX + " " + GetObjectName('n045')+ GetObjectName('n049')
		elseif WBX != ""and WCX != ""then
			set WJX = WHX + " " + GetObjectName('n048')+ " " + WGX + GetObjectName('n047')+ " " + WBX + " " + GetObjectName('n046')+ " " + WKX + " " + GetObjectName('n045')+ GetObjectName('n049')
		endif
		if WNX then
			set WDX = SCX(U9X, WVX)
		endif
		call DisplayTimedTextToAllPlayer(XY, CR[LocalId], WJX + WDX)
		if WCX != ""then
			//call SetTopMessageText(WHX + WCX, 8.)
			call DisplayTimedTextToAllPlayer(XY, CR[LocalId], WHX + WCX)
		endif
		set EUV[WOX]= EUV[WOX]+ WIX
		call B8X(WEX, WIX, U9X)
		set PQ[WOX]= PQ[WOX]+ WIX
		if FS[1]> 4 then
			call TYX(0)
		endif
		if FS[2]> 4 then
			call TYX(1)
		endif
	endif
	set WAX = GetHeroLevel(U9X)* 30
	if GetItemOfTypeFromUnit(U9X, RealItemTypeId[NIV])!= null then
		if GetItemCharges(GetItemOfTypeFromUnit(U9X, RealItemTypeId[NIV]))> 0 then
			set WQX =-1 *(3 * GetItemCharges(GetItemOfTypeFromUnit(U9X, RealItemTypeId[NIV])))
		endif
	endif
	if WAX > WYX then
		set WAX = WYX
	endif
	call TGX(U9X)
	if GetItemOfTypeFromUnit(WVX, RealItemTypeId[NIV])!= null and GetDistanceBetweenUnits(WVX, U9X)>$640 then
		call SetItemCharges(GetItemOfTypeFromUnit(WVX, RealItemTypeId[NIV]), GetItemCharges(GetItemOfTypeFromUnit(WVX, RealItemTypeId[NIV]))+ 1)
	endif
	call TSX(U9X)
	call TQX(U9X)
	set U2 = U9X
	set W2 = WVX
	call ExecuteFunc("W2X")
	if WLX == false then
		set GQ[WRX]= GQ[WRX]+ WAX
		call T4X(U9X, WAX)
	endif
	call SaveInteger(HY,(400 + WOX),(450 + WRX),((LoadInteger(HY,(400 + WOX),(450 + WRX)))+ 1))
	call SaveInteger(HY,(400 + WRX),(500 + WOX),((LoadInteger(HY,(400 + WRX),(500 + WOX)))+ 1))
	call TimerStart(MS[WOX], 18, false, function U6X)
	if U8X == false and WEX != Sentinels[0]and WEX != Scourges[0]and WEX != BW then
		set IS[WOX]= IS[WOX]+ 1
		if IS[WOX]== 2 then
			set JQ[WOX]= JQ[WOX]+ 1
			call SaveInteger(HY,'0SND','0PID', WOX)
			set W0X = GetObjectName('n04S')
			call T0X(JS[WOX]+(VMV[GetPlayerId((WEX))])+ "|r " + GetObjectName('n04D')+ " |c000000ff" + W0X + "|r" + GetObjectName('n049'), 1)
		endif
		if IS[WOX]== 3 then
			set KQ[WOX]= KQ[WOX]+ 1
			call SaveInteger(HY,'0SND','0PID', WOX)
			set W0X = GetObjectName('n04E')
			call T0X(JS[WOX]+(VMV[GetPlayerId((WEX))])+ "|r " + GetObjectName('n04D')+ " |c0000ff40" + W0X + "|r" + GetObjectName('n04B'), 2)
		endif
		if IS[WOX]== 4 then
			set KQ[WOX]= KQ[WOX]+ 1
			call SaveInteger(HY,'0SND','0PID', WOX)
			set W0X = GetObjectName('n0HJ')
			call T0X(JS[WOX]+(VMV[GetPlayerId((WEX))])+ "|r " + GetObjectName('n04D')+ " |c0000FFFF" + W0X + "|r" + GetObjectName('n04B'), 3)
		endif
		if IS[WOX]> 4 then
			set KQ[WOX]= KQ[WOX]+ 1
			call SaveInteger(HY,'0SND','0PID', WOX)
			set W0X = GetObjectName('n0HK')
			call T0X(JS[WOX]+(VMV[GetPlayerId((WEX))])+ "|r " + GetObjectName('n04K')+ " |c0000AAFF" + W0X + "|r" + GetObjectName('n04B'), 4)
		endif
	endif
	if(U8X == false) then
		set XS[WRX]= 0
	endif
	set XS[0]= 0
	set XS[6]= 0
	set IQ[WRX]= IQ[WRX]+ 1
	if WLX then
		set WMX = .4
	endif
	if U8X and(GetUnitAbilityLevel(U9X,'A06B')+ GetUnitAbilityLevel(U9X,'A471')> 0) then
		if GetUnitAbilityLevel(U9X,'A06B')> 0 then
			set WPX = .5
		else
			set WPX = .3
		endif
	else
		if GetUnitAbilityLevel(U9X,'A471')> 0 then
			set WPX = .8
			set U2 = U9X
			call ExecuteFunc("W3X")
		endif
	endif
	set WTX =((GetHeroLevel(U9X)* 3.8 + 5 + R2I(LoadReal(K, GetHandleId(U9X), 26)))* WPX + WSX)+ R2I(WQX)
	if Mode__FastRespawn then
		set WTX = WTX * .5
	endif
	if M3 then
		set LQ[WRX]= 0
		call TimerStart(PS[WRX], 1., false, null)
	else
		set LQ[WRX]= LQ[WRX]+ R2I(WTX)
		if GV then
			call JSX("LoD_DeadFor_" + R2S(WTX), GetPlayerId(WXX))
		endif
		call TimerStart(PS[WRX], WTX, false, null)
	endif
	call TriggerExecute(TG)
	if not Mode__DeathMatch then
		call S8X(U9X, WTX)
	else
		if IsSentinelsPlayer(WXX) then
			set TeamHeroKillsCount[0]= TeamHeroKillsCount[0]+ 1
		endif
		if IsScourgesPlayer(WXX) then
			set TeamHeroKillsCount[1]= TeamHeroKillsCount[1]+ 1
		endif
		// debug call SingleDebug( "记录单位 索引" + I2S( WRX ) + GetUnitName(U9X))
		set OW[WRX]= U9X
		if GetUnitTypeId(U9X)=='H00J' then
			set OW[WRX]=(LoadUnitHandle(HY,(GetHandleId(GetOwningPlayer(U9X))), 699))
		endif
		if Mode__HolyShitLimit and WFX >= 10 then
			call SaveBoolean(HY, GetHandleId(U9X),'suic', true)
	
			if IsSentinelsPlayer(WEX) then
				set TeamHeroKillsCount[1]= TeamHeroKillsCount[1] - 5
				set TeamHeroUseLivesCount[0] = TeamHeroUseLivesCount[0] - 5
			endif
			if IsScourgesPlayer(WEX) then
				set TeamHeroKillsCount[0]= TeamHeroKillsCount[0] - 5
				set TeamHeroUseLivesCount[1] = TeamHeroUseLivesCount[1] - 5
			endif
			set XS[WOX] = 0
			if UnitAlive(WVX) then
				call KillUnit(WVX)
				call DisplayTimedTextToAllPlayer(XY, CR[LocalId], JS[WOX]+(VMV[GetPlayerId((WEX))])+ "|r 已经 |c00ff8000" + GetObjectName('n03X')+ "|r 并自动死亡，其队伍额外增加5条生命值。")
			else
				call DisplayTimedTextToAllPlayer(XY, CR[LocalId], JS[WOX]+(VMV[GetPlayerId((WEX))])+ "|r 已经 |c00ff8000" + GetObjectName('n03X')+ "|r ，其队伍额外增加5条生命值。")
			endif
		endif
		if TeamHeroKillsCount[0]== DeathMatch__MaxLives then
			call TriggerExecute(JK)
		endif
		if TeamHeroKillsCount[1]== DeathMatch__MaxLives then
			call TriggerExecute(YK)
		endif
		if(GetUnitAbilityLevel(U9X,'Z234')> 0) then
			call ExecuteFunc("T8X")
		elseif GetUnitAbilityLevel(U9X,'Q231')> 0 then
			set VK = U9X
			call ExecuteFunc("W4X")
		elseif GetUnitAbilityLevel(U9X,'A0CY')> 0 then
			set VK = U9X
			call ExecuteFunc("W5X")
		endif
	endif
	set U9X = null
	set WVX = null
	set WEX = null
	set WXX = null
	set t = null
	set WZX = null
	set W_X = null
endfunction
function W6X takes unit SYX, unit SZX returns nothing
	local player p = GetOwningPlayer(SYX)
	local string s
	local integer W7X = SMX(SZX, SYX)
	local integer i = 1
	local integer TME
	local integer Y_E =$96
	if p == Sentinels[0]or p == Scourges[0]then
		call SSX(SZX, SYX, Y_E)
		set s = SLX(SZX, SYX)+ " " + GetObjectName('n04W')+ " |c00ff0303" + GetObjectName('n04Y')+ GetObjectName('n049')+ "|r "
		call SetTopMessageText(s, 8.)
		if W7X > 1 then
			set s = s + "(+" + I2S(Y_E)+ " " + GetObjectName('n044')+ ")"
		else
			set s = s + "(+" + I2S(Y_E)+ " " + GetObjectName('n045')+ ")"
		endif
		loop
		exitwhen i > 5
			if IsSentinelsPlayer(GetOwningPlayer(SYX)) then
				set TME = GetPlayerId(Sentinels[i])
			else
				set TME = GetPlayerId(Scourges[i])
			endif
			set i = i + 1
		endloop
	else
		set TME = GetPlayerId(p)
		set s = JS[TME]+(VMV[TME])+ "|r " + GetObjectName('n04W')+ " |c00ff0303" + GetObjectName('n04Y')+ GetObjectName('n049')+ "|r "
		call SetTopMessageText(s, 8.)
		set s = s + "(+" + I2S(Y_E)+ " " + GetObjectName('n045')+ ")"
		call B8X(p, Y_E, Player__Hero[TME])
		set EUV[TME]= EUV[TME]+ Y_E
	endif
	call DisplayTimedTextToAllPlayer(XY, CR[LocalId], s)
	call BWX(P0)
	set PR = true
	set p = null
endfunction
function W8X takes nothing returns nothing
	local unit SYX = GetKillingUnit()
	local unit SZX = GetTriggerUnit()
	local player pk = GetOwningPlayer(SYX)
	if PR == false then
		if pk != BW and SYX != null and IsPlayerEnemy(GetOwningPlayer(SZX), pk) then
			if pk == Sentinels[0]or pk == Scourges[0]then
				if SMX(SZX, SYX)> 0 then
					call W6X(SYX, SZX)
				endif
			else
				call W6X(SYX, SZX)
			endif
		endif
	endif
	set SYX = null
	set SZX = null
endfunction
function W9X takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player p
	local real YVX
	local unit u =(LoadUnitHandle(HY, h, 0))
	local integer c =(LoadInteger(HY, h, 34))
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED then
		set c = c + 1
		call SaveInteger(HY, h, 34,(c))
	endif
	if c > 5 / .05 or(GetTriggerEventId()== EVENT_UNIT_DAMAGED and GetEventDamage()> 20) or GetUnitAbilityLevel(u,'A3KL')== 0 then
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	else
		call SetUnitState(u, UNIT_STATE_LIFE, GetUnitState(u, UNIT_STATE_LIFE)+ .2 * GetUnitState(u, UNIT_STATE_MAX_LIFE)* .05)
		call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ .2 * GetUnitState(u, UNIT_STATE_MAX_MANA)* .05)
	endif
	set t = null
	set u = null
endfunction
function YEX takes unit u returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function W9X))
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call AddAbilityToTimed(u,'A3KL', 1, 5,'B3KL')
	call SaveReal(HY, GetHandleId(t), 0, GetGameTime()+ 5)
	set t = null
endfunction
function YXX takes nothing returns nothing
	local integer i = 1
	local unit u
	set E7V = null
	loop
	exitwhen i > 5
		set u = Player__Hero[GetPlayerId(Sentinels[i])]
		if u != null and GetItemOfTypeFromUnit(u, RealItemTypeId[AIV])!= null then
			call DisableTrigger(CUV)
			call JSX("AegisOff", GetPlayerId(GetOwningPlayer(u)))
			call RemoveItem(GetItemOfTypeFromUnit(u, RealItemTypeId[AIV]))
			call EnableTrigger(CUV)
			call YEX(u)
		endif
		set u = Player__Hero[GetPlayerId(Scourges[i])]
		if u != null and GetItemOfTypeFromUnit(u, RealItemTypeId[AIV])!= null then
			call DisableTrigger(CUV)
			call JSX("AegisOff", GetPlayerId(GetOwningPlayer(u)))
			call RemoveItem(GetItemOfTypeFromUnit(u, RealItemTypeId[AIV]))
			call EnableTrigger(CUV)
			call YEX(u)
		endif
		set i = i + 1
	endloop
	set u = null
endfunction
function YOX takes string YRX, string YIX returns string
	local string s = GetObjectName('n0CA')
	set s = JUX(s, "$team", YRX)
	set s = JUX(s, "$team", YIX)
	return s
endfunction

function YBX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local group g = LoginGroup(17)
	local real rDamage = 70 + R2I(GetGameTime()/240)* 20
	local unit firstUnit = null
	call GroupEnumUnitsInRange(g, GetUnitX(RoShan), GetUnitY(RoShan), 375, null)
	call GroupRemoveUnit( g, RoShan )
	loop
		set firstUnit = FirstOfGroup( g )
		exitwhen firstUnit == null
		call GroupRemoveUnit( g, firstUnit )
		if UnitAlive(firstUnit) and GetUnitAbilityLevel(firstUnit,'BCtc')> 0 then
			call UnitDamageTargetEx(RoShan, firstUnit, 1, rDamage)
		endif
	endloop
	call LogoutGroup(g)
	call DestroyTimer(t)
	set g = null
	set t = null
endfunction
function YCX takes nothing returns nothing
	call TimerStart(CreateTimer(), 0, false, function YBX)
endfunction

function IsHero takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO)))
endfunction

function YGX takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local real WIE = GetGameTime()-WQ
	local integer WUV = R2I(WIE / 600)
	if WUV > 4 then
		set WUV = 4
	endif
	if UnitIsDead(RoShan)== false and WUV > 0 and WQ > 0 then
		call UnitAddPermanentAbility(RoShan,'A43T')
		call UnitAddPermanentAbility(RoShan,'A43U')
		call SetUnitAbilityLevel(RoShan,'A43T', WUV)
		call SetUnitAbilityLevel(RoShan,'A43U', WUV)
	endif
	set t = null
endfunction
function YHX takes nothing returns nothing
	local integer hp = E9V * 500
	local integer YJX = LoadInteger(HY, GetHandleId(RoShan),'MXHP')
	if hp != YJX then
		call UnitAddMaxLife(RoShan, IMaxBJ(hp -YJX, 0))
		call SaveInteger(HY, GetHandleId(RoShan),'MXHP', hp)
	endif
endfunction
function YKX takes nothing returns nothing
	local integer YLX ='A3BA'
	local integer level = 0
	local integer IMX = 0
	local integer YMX = IMinBJ(E9V, 20)
	if E9V == 0 then
		return
	endif
	set IMX = R2I((YMX -1)/ 4)
	set level = YMX -IMX * 4
	call UnitAddPermanentAbilitySetLevel(RoShan, YLX + IMX, level)
endfunction
function YPX takes nothing returns boolean
	set E9V = GetTriggerEvalCount(GetTriggeringTrigger())
	if RoShan != null and GetUnitState(RoShan, UNIT_STATE_LIFE)> 1 then
		call YHX()
		call SetPlayerTechResearched(GetOwningPlayer(RoShan),'R00F', E9V)
		call YKX()
	endif
	return false
endfunction
function YQX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = null
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		call ExecuteFunc("YSX")
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT then
		call YCX()
	else
		if GetUnitAbilityLevel(RoShan,'B0BI')== 0 then
			call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 1)
		endif
		if LoadInteger(HY, h, 0)== 15 or GetTriggerEvalCount(t)== 1 then
			call SaveInteger(HY, h, 0, 0)
			set u = CreateUnit(BW,'e00E', GetUnitX(RoShan), GetUnitY(RoShan), 0)
			call UnitAddAbility(u,'A3KM')
			call IssueTargetOrderById(u,$D025C, RoShan)
			set u = null
		endif
		if GetOwningPlayer(RoShan) == BW and ModuloInteger(GetTriggerEvalCount(t), 10)== 0 then
			if not RectContainsUnit(FI, RoShan) then
				if (LoadBoolean(HY,(h), 91)) then
					call SaveBoolean(HY,(h), 91,(false))
				else
					call SetUnitPosition(RoShan, GetRectCenterX(PZ), GetRectCenterY(PZ))
					call SaveBoolean(HY,(h), 91,(true))
				endif
			endif
		endif
	endif
	set t = null
	return false
endfunction
function YTX takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterUnitEvent(t, RoShan, EVENT_UNIT_DEATH)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function YQX))
	call SaveBoolean(HY,(h), 91,(true))
	
	call TriggerRegisterUnitEvent(t, RoShan, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterUnitEvent(t, RoShan, EVENT_UNIT_SPELL_CAST)

	set t = null
endfunction
function YUX takes nothing returns nothing
	set RoShan = CreateUnit(Player($C),'n00L', GetRectCenterX(PZ), GetRectCenterY(PZ), 180.)
	call SetUnitAcquireRange(RoShan, 150)
	call YTX()
	if XEV > 1 then
		call UnitRemoveAbility(RoShan,'A0K2')
		call UnitAddAbility(RoShan,'A0Q6')
		call UnitAddItem(RoShan, CreateItem(RealItemTypeId[R7V], 0, 0))
	endif
	call UnitAddItem(RoShan, CreateItem(RealItemTypeId[AAV], 0, 0))
	call YKX()
endfunction
function YWX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local real XEX
	local integer WTX = LoadInteger(HY, GetHandleId(t), 0)
	if GetTriggerEvalCount(t)== WTX or FPV then
		set FPV = false
		call YXX()
		set XEV = XEV + 1
		call YUX()
		call YHX()
		call SetPlayerTechResearched(GetOwningPlayer(RoShan),'R00F', E9V)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEvalCount(t)== 300 then
		call YXX()
	endif
	set t = null
	return false
endfunction
function YSX takes nothing returns nothing
	local trigger t = CreateTrigger()
	local item it
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function YWX))
	if JE then
		call SaveInteger(HY, GetHandleId(t), 0, GetRandomInt(4, 6))
	else
		call SaveInteger(HY, GetHandleId(t), 0, GetRandomInt(480, 660))
	endif
	set FPV = false
	set E8V = false
	set it = CreateItem(PowerUpItemTypeId[AIV], GetUnitX(RoShan), GetUnitY(RoShan))
	call SetItemCharges(it, 1)
	if GetUnitAbilityLevel(RoShan,'A0Q6')== 1 then
		set it = CreateItem(PowerUpItemTypeId[R6V], GetUnitX(RoShan), GetUnitY(RoShan))
		call SetItemCharges(it, 1)
	endif
	call RemoveItem(UnitRemoveItemFromSlot(RoShan, 0))
	call RemoveItem(UnitRemoveItemFromSlot(RoShan, 1))
	call CreateUnitAtLoc(Player($C),'e01V', GetRectCenter(PZ), 0)
	if(IsSentinelsPlayer(GetOwningPlayer(GetKillingUnit()))) then
		call JSX("Roshan", 0)
		call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, CR[LocalId], YOX("|c00ff0000" + GetObjectName('n065')+ "|r", GetObjectName('n065')))
		set GN = 0
		call AddPlayerResourceGold(Sentinels[1], 200)
		call AddPlayerResourceGold(Sentinels[2], 200)
		call AddPlayerResourceGold(Sentinels[3], 200)
		call AddPlayerResourceGold(Sentinels[4], 200)
		call AddPlayerResourceGold(Sentinels[5], 200)
	endif
	if(IsScourgesPlayer(GetOwningPlayer(GetKillingUnit()))) then
		call JSX("Roshan", 1)
		call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, CR[LocalId], YOX("|c00004000" + GetObjectName('n06C')+ "|r", GetObjectName('n06C')))
		set GN = 1
		call AddPlayerResourceGold(Scourges[1], 200)
		call AddPlayerResourceGold(Scourges[2], 200)
		call AddPlayerResourceGold(Scourges[3], 200)
		call AddPlayerResourceGold(Scourges[4], 200)
		call AddPlayerResourceGold(Scourges[5], 200)
	endif
	set it = null
	set t = null
endfunction
function YYX takes integer id, player SZX, player SYX returns string
	local string s
	if id == 'np00' then
		set s = GetObjectName('n0ZJ')
	elseif id == 'n00I' then
		set s = GetObjectName('n0ZC')
	else
		set s = GetObjectName('n0AP')
	endif
	set s = JUX(s, "$dead", VMV[GetPlayerId(SZX)])
	return s
endfunction
function YZX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	call SetTerrainPathable(x, y, PATHING_TYPE_WALKABILITY, false)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function Y_X takes unit WUE returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x = GetUnitX(WUE)
	local real y = GetUnitY(WUE)
	call SetTerrainPathable(x, y, PATHING_TYPE_WALKABILITY, true)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function YZX))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	set WUE = null
	set t = null
endfunction
function Y0X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit Y1X =(LoadUnitHandle(HY, h, 2))
	local integer EVX = GetTriggerEvalCount(t)
	local integer Y2X = LoadInteger(HY, h, 0)-EVX
	local integer i = 1
	local integer id
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	loop
	exitwhen i > 5
		if IsPlayerAlly(GetOwningPlayer(Y1X), Sentinels[0]) then
			set id = GetPlayerId(Sentinels[i])
		else
			set id = GetPlayerId(Scourges[i])
		endif
		set i = i + 1
		if Y2X == 0 then
			if IsPlayerAlly(Sentinels[0], Player(id)) then
				set RL[GetPlayerId(Sentinels[0])]= false
			endif
			if IsPlayerAlly(Scourges[0], Player(id)) then
				set RL[GetPlayerId(Scourges[0])]= false
			endif
		endif
	endloop
	if Y2X == 2 then
		call SetUnitPosition(Y1X, x, y)
	endif
	if Y2X == 0 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set Y1X = null
	return false
endfunction
function Y3X takes nothing returns nothing
	if((GetUnitLevel(GetEnumUnit())< 25 or Mode__UnlimitedLevel) and GetUnitAbilityLevel(GetEnumUnit(),'Aloc')== 0) then
		call AddHeroXPSimple(GetEnumUnit(), WB, true)
	endif
endfunction
function Y4X takes integer xp, player p, unit SYX returns nothing
	if(xp > 0 and p != BW and p != null) then
		if IsUnitType(GetTriggerUnit(), UNIT_TYPE_SUMMONED) then
			set xp = R2I(xp * .5)
		endif
		set SB = SYX
		call UDX()
		if(FirstOfGroup(IV)!= null) then
			set WB = R2I(xp / CountUnitsInGroup(IV))
			call ForGroup(IV, function Y3X)
		endif
		set SB = null
	endif
endfunction
function Y5X takes nothing returns boolean
	local real x
	local real y
	local unit Y1X = GetTriggerUnit()
	local integer i = 1
	local integer Y6X = 175
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	if OPX(Y1X) then
		set Y6X =$96
		call SaveInteger(HY, h, 0,$8C)
		call SaveReal(HY, GetHandleId(Y1X),'DEAD', GetGameTime()+$8C)
	else
		call SaveInteger(HY, h, 0,$B4)
		call SaveReal(HY, GetHandleId(Y1X),'DEAD', GetGameTime()+$B4)
	endif
	call JSX("Courier" + I2S(GetPlayerId(GetOwningPlayer(Y1X))), GetPlayerId(GetOwningPlayer(GetKillingUnit())))
	
	call DisplayTimedTextToAllPlayer(XY, 10., YYX(GetUnitTypeId(Y1X), GetOwningPlayer(Y1X), GetOwningPlayer(GetKillingUnit())))
	call Y4X(349, GetOwningPlayer(LoadUnitHandle(HY, GetHandleId(Y1X),'lstd')), LoadUnitHandle(HY, GetHandleId(Y1X),'lstd'))
	call PingMinimapEx(GetUnitX(Y1X), GetUnitY(Y1X), 6, 255, 0, 0, false)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function Y0X))
	call SaveUnitHandle(HY, h, 2,(Y1X))
	if IsPlayerAlly(GetOwningPlayer(Y1X), Sentinels[0]) and RL[GetPlayerId(Sentinels[0])]== false then
		set RL[GetPlayerId(Sentinels[0])]= true
		loop
		exitwhen i > 5
			call OOX(Scourges[i], Y6X)
			set i = i + 1
		endloop
	endif
	set i = 1
	if IsPlayerAlly(GetOwningPlayer(Y1X), Scourges[0]) and RL[GetPlayerId(Scourges[0])]== false then
		set RL[GetPlayerId(Scourges[0])]= true
		loop
		exitwhen i > 5
			call OOX(Sentinels[i], Y6X)
			set i = i + 1
		endloop
	endif
	if GetPlayerTeam(GetOwningPlayer(Y1X)) == 0 then
		set x = GetRectCenterX(VZ)
		set y = GetRectCenterY(VZ)
	else
		set x = GetRectCenterX(GY)
		set y = GetRectCenterY(GY)
	endif
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	if IsTerrainPathable(GetUnitX(Y1X), GetUnitY(Y1X), PATHING_TYPE_WALKABILITY) then
		call Y_X(Y1X)
	endif
	set t = null
	set Y1X = null
	return false
endfunction
function Y7X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local real x = HS
	local real y = ZS
	if IsScourgesPlayer(GetOwningPlayer(WUE)) then
		set x = A7
		set y = N7
	endif
	if MessengerIsDead(WUE)== false then
		if GetDistanceBetween(GetUnitX(WUE), GetUnitY(WUE), x, y)< 800 then
			call UPV(WUE, "在家")
			//	call UnitAddPermanentAbility(WUE,'Avul')
			//	else
			//	call UnitRemoveAbility(WUE,'Avul')
		endif
	endif
	set t = null
	set WUE = null
	return false
endfunction
function Y8X takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	if HaveSavedHandle(K, GetHandleId(p),'COUR')== false then
		call SaveUnitHandle(K, GetHandleId(p),'COUR', u)
	endif
endfunction
function Y9X takes player p returns nothing
	if HaveSavedHandle(K, GetHandleId(p),'COUR') then
		if GetPlayerAlliance(GetOwningPlayer(LoadUnitHandle(K, GetHandleId(p),'COUR')), p, ALLIANCE_SHARED_CONTROL) then
			return
		endif
	endif
	call SaveUnitHandle(K, GetHandleId(p),'COUR', HJX(p))
endfunction
function ZVX takes unit c returns nothing
	if GXX(c)== false then
		call UnitRemoveAbility(c,'A00D')
		call UnitRemoveAbility(c,'A2HR')
		call UnitRemoveAbility(c,'A1VR')
		call UnitRemoveAbility(c,'A38Z')
		call UnitRemoveAbility(c,'A12V')
		call UnitRemoveAbility(c,'A05U')
		call UnitRemoveAbility(c,'AIms')
		call UnitRemoveAbility(c,'A2I9')
		call UnitRemoveAbility(c,'EUL1')
		call UnitRemoveAbility(c,'EUL2')
		call SetUnitState(c, UNIT_STATE_MANA, 0)
		call UnitRemoveAbility(c,'AImb')
	endif
endfunction
function ZEX takes nothing returns nothing
	local integer id
	local unit u
	local integer h = GetHandleId(GetTriggeringTrigger())
	local integer c
	local real x
	local real y
	if GetTriggerEventId()!= EVENT_GAME_TIMER_EXPIRED then
		set id = GetIssuedOrderId()
		if id >=852008 and id <= 852013 then
			set id = UUV(UnitItemInSlot(GetTriggerUnit(), id -852008))
			// and not( id == I9V or id == AVV or id == AEV or id == AXV or id == AOV or id == ARV ) 让信使能用BKB
			if id != R_V and id != RYV and id != RPV and id != IVV then
				call EXStopUnit(GetTriggerUnit())
			endif
		elseif id !='h085' and id !=$D02B7 and id !=$D0005 and id !='h0DE' and id !='h0BV' and id !=$D011C and id !=$D0117 and id !=$D0116 and id !=$D0084 and(GetIssuedOrderId()< 852002 or GetIssuedOrderId()>852013) then
			if UQV(GetTriggerUnit())== false then
				call UPV(GetTriggerUnit(), "控制中")
			endif
		endif
	else
		set u = LoadUnitHandle(HY, h, 0)
		if MessengerIsDead(u) then
			set u = null
			return
		endif
		set id = GetUnitCurrentOrder(u)
		set x = HS
		set y = ZS
		//	if IsScourgesPlayer(GetOwningPlayer(u)) then//测试
		if GetPlayerTeam(GetOwningPlayer(u)) == 0 then
			set x = A7
			set y = N7
		endif
		if GetDistanceBetween(GetUnitX(u), GetUnitY(u), x, y)< 800 then
			call UPV(GetTriggerUnit(), "在家")
		elseif id ==$D0021 then
			call UPV(GetTriggerUnit(), "控制中")
		elseif LoadReal(HY, h, 0)== GetUnitX(u) and LoadReal(HY, h, 1)== GetUnitY(u) then
			call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 1)
			if LoadInteger(HY, h, 0)>= 5 then
				call UPV(u, "待命")
			endif
		else
			if LoadInteger(HY, h, 0)> 0 then
				call SaveInteger(HY, h, 0, 0)
				call UPV(u, "移动中")
			endif
			call SaveReal(HY, h, 0, GetUnitX(u))
			call SaveReal(HY, h, 1, GetUnitY(u))
		endif
		if ModuloInteger(GetTriggerEvalCount(GetTriggeringTrigger()), 10)== 1 then
			call ZVX(u)
		endif
	endif
	set u = null
endfunction
function ZXX takes nothing returns nothing
	local unit WLE = GetTriggerUnit()
	local unit R8X = GetEventDamageSource()
	if GetEventDamage()> 0 then
		call SaveUnitHandle(HY, GetHandleId(WLE),'lstd', R8X)
		if AD < 1 and IsUnitType(R8X, UNIT_TYPE_MELEE_ATTACKER) and IsUnitIdType(GetUnitTypeId(R8X), UNIT_TYPE_HERO) then
			call IOX(R8X, WLE, 10, GetEventDamage()* .5, .0)
		endif
	endif
	set WLE = null
	set R8X = null
endfunction
function ZOX takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function Y5X))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function Y7X))
	call SaveUnitHandle(HY, h, 2,(u))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_ORDER)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function ZEX))
	call SaveUnitHandle(HY, h, 0, u)
	call Y8X(u)
	set t = null
	if MV == null then
		set MV = CreateTrigger()
		call TriggerAddCondition(MV, Condition(function ZXX))
	endif
	call TriggerRegisterUnitEvent(MV, u, EVENT_UNIT_DAMAGED)
endfunction
function ZRX takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	local integer TME = GetPlayerId(p)
	if IsMessengerUnit(u) and IsUnitIllusion(u)== false then
		call DisplayTimedTextToAllPlayer(XY, 10., JS[TME]+ VMV[TME]+ "|r的信使被 |c00ff0000永久地|r 杀死了.它不会再复活.")
		call PingMinimapEx(GetUnitX(u), GetUnitY(u), 6, 255, 0, 0, false)
	endif
endfunction
function ZIX takes integer id returns integer
	if id =='I006' then
		return'I0QB'
	elseif id =='I007' then
		return'I0QC'
	elseif id =='I00K' then
		return'I0QD'
	elseif id =='I008' then
		return'I0QE'
	elseif id =='I00J' then
		return'I0QF'
	elseif id =='I0QA' then
		return'I0QG'
	endif
	return 0
endfunction
function ZAX takes integer id returns integer
	if id =='I0QB' then
		return'I006'
	elseif id =='I0QC' then
		return'I007'
	elseif id =='I0QD' then
		return'I00K'
	elseif id =='I0QE' then
		return'I008'
	elseif id =='I0QF' then
		return'I00J'
	elseif id =='I0QG' then
		return'I0QA'
	endif
	return 0
endfunction
function ZNX takes integer i returns boolean	//各种神符
	return i =='I0QB' or i =='I0QC' or i =='I0QD' or i =='I0QE' or i =='I0QF' or i =='I0QG'
endfunction
function ZBX takes integer i returns boolean
	return i =='I006' or i =='I008' or i =='I00J' or i =='I00K' or i =='I007' or i =='I0QA'
endfunction
function ZCX takes nothing returns nothing
	if GetWidgetLife(GetEnumItem())> 0 and ZNX(GetItemTypeId(GetEnumItem())) then
		set Z2 = GetEnumItem()
	endif
endfunction
function ZDX takes nothing returns integer
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != CXV
		set i = GetRandomInt(1, 5)
	endloop
	set CXV = i
	return i
endfunction
function ZFX takes nothing returns nothing
	set NV = false
endfunction
function RuneRefresh__CallBack takes nothing returns boolean
	local boolean ZHX = false
	local boolean ZJX = false
	local real x
	local real y
	local real dx
	local real dy
	local real x1
	local real y1
	local real x2
	local real y2
	local integer ZKX
	set x1 = GetLocationX(WU)
	set y1 = GetLocationY(WU)
	set x2 = GetLocationX(YU)
	set y2 = GetLocationY(YU)
	set Z2 = null
	call EnumItemsInRect(IZ, TrueBoolexprCondition, function ZCX)
	set ZHX = true
	if Z2 != null then
		call RemoveItem(Z2)
	endif
	set Z2 = null
	call EnumItemsInRect(RZ, TrueBoolexprCondition, function ZCX)
	set ZJX = true
	if Z2 != null then
		call RemoveItem(Z2)
	endif
	set ZKX = ZDX()
	if GetRandomInt(1, 2)== 1 then
		set x = x1
		set y = y1
		set dx = x2
		set dy = y2
	else
		set x = x2
		set y = y2
		set dx = x1
		set dy = y1
	endif
	if FV then
		set FV = false
		call CreateItem(ZIX('I0QA'), dx, dy)
		call CreateItem(ZIX('I0QA'), x, y)
		call TimerStart(CreateTimer(), 120, false, function ZFX)
	else
		if ZKX == 1 then
			call CreateItem(ZIX('I007'), x, y)
		elseif ZKX == 2 then
			call CreateItem(ZIX('I006'), x, y)
		elseif ZKX == 3 then
			call CreateItem(ZIX('I00K'), x, y)
		elseif ZKX == 4 then
			call CreateItem(ZIX('I008'), x, y)
		elseif ZKX == 5 then
			call CreateItem(ZIX('I00J'), x, y)
		endif
		call CreateItem(ZIX('I0QA'), dx, dy)
	endif
	return false
endfunction
function ZLX takes unit u returns nothing
	local real x
	local real y
	if GetPlayerTeam(GetOwningPlayer(u)) == 0 then
		set x = GetRectCenterX(VZ)
		set y = GetRectCenterY(VZ)
	else
		set x = GetRectCenterX(GY)
		set y = GetRectCenterY(GY)
	endif
	call USV(u, 851986, x, y)
	call UPV(u, "回家")
endfunction
function ZMX takes nothing returns nothing
	local item C1X = GetEnumItem()
	if GetWidgetLife(C1X)> 0 and GetItemPlayer(C1X)== CMV and CSV == 0 then
		set CSV = CSV + 1
		call UnitAddItem(CPV, C1X)
	endif
	set C1X = null
endfunction
function ZPX takes nothing returns nothing
	local item C1X = GetEnumItem()
	if GetWidgetLife(C1X)> 0 and GetItemPlayer(C1X)== CMV then
		call UnitAddItem(CQV, C1X)
	endif
	set C1X = null
endfunction
function ZQX takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 2))
	local unit ZSX =(LoadUnitHandle(HY, h, 92))
	local player p =(LoadPlayerHandle(HY, h, 54))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local rect r = Rect(x -300, y -300, x + 300, y + 300)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set CMV = p
		set CPV = triggerUnit
		set CQV = ZSX
		call EnumItemsInRect(r, TrueBoolexprCondition, function ZPX)
	else
		if GetTriggerEvalCount(t)> 9 then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			set CMV = p
			set CPV = triggerUnit
			set CQV = ZSX
			call EnumItemsInRect(r, TrueBoolexprCondition, function ZPX)
		else
			set CMV = p
			set CPV = triggerUnit
			set CSV = 0
			call EnumItemsInRect(r, TrueBoolexprCondition, function ZMX)
		endif
	endif
	call RemoveRect(r)
	set t = null
	set triggerUnit = null
	set ZSX = null
	set r = null
	return false
endfunction
function ZTX takes unit ZSX, unit triggerUnit returns nothing
	local player p = GetOwningPlayer(triggerUnit)
	local integer i
	local item C1X
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x = GetUnitX(ZSX)
	local real y = GetUnitY(ZSX)
	local integer GTX
	if IsTerrainPathable(x, y, PATHING_TYPE_WALKABILITY) then
		set x = GetUnitX(triggerUnit)
		set y = GetUnitY(triggerUnit)
	endif
	call TriggerRegisterDeathEvent(t, triggerUnit)
	call TriggerRegisterTimerEvent(t, .01, true)
	call TriggerAddCondition(t, Condition(function ZQX))
	call SaveUnitHandle(HY, h, 2,(triggerUnit))
	call SaveUnitHandle(HY, h, 92,(ZSX))
	call SavePlayerHandle(HY, h, 54,(p))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	set i = 0
	loop
	exitwhen i > 5
		set C1X = UnitItemInSlot(ZSX, i)
		set GTX = UUV(C1X)
		if C1X != null and GetItemPlayer(C1X)== p and(GTX != O3V and GTX != O4V and GTX != O5V and GTX != O6V and GTX != O7V) then
			call UnitRemoveItem(ZSX, C1X)
			call SetItemPosition(C1X, x, y)
		endif
		set i = i + 1
	endloop
	set t = null
	set C1X = null
endfunction
function ZUX takes unit ZWX returns boolean
	local integer i = GetUnitCurrentOrder(ZWX)
	return(i == 0) or(i ==$D0007) or(i ==$D0013) or(i ==$D0019)
endfunction
function ZYX takes integer h returns nothing
	local unit Y1X = LoadUnitHandle(HY, h, 92)
	local unit WLE = LoadUnitHandle(HY, h, 2)
	local real x
	local real y
	local real distance
	local real ms
	local real radian
	local real ZZX
	local real Z_X
	local real Z0X
	local real Z1X
	local real hx = GetUnitX(WLE)
	local real hy = GetUnitY(WLE)
	if(ZUX(WLE)== false) then
		set x = GetUnitX(WLE)
		set y = GetUnitY(WLE)
		set ZZX = LoadReal(HY, h, 677)
		set Z_X = LoadReal(HY, h, 678)
		call SaveReal(HY, h, 677, x * 1.)
		call SaveReal(HY, h, 678, y * 1.)
		set radian = Atan2(y -Z_X, x -ZZX)
		set distance = SquareRoot((x -ZZX)*(x -ZZX)+(y -Z_X)*(y -Z_X))/ .2
		set ms = GetUnitMoveSpeedEx(Y1X)
		set Z0X = GetDistanceBetween(GetUnitX(WLE), GetUnitY(WLE), GetUnitX(Y1X), GetUnitY(Y1X))
		set Z1X = RAbsBJ(radian * bj_RADTODEG -GetUnitFacing(Y1X))
		if(Z0X < ms -distance and ms > distance) or(Z0X < RMaxBJ(ms, distance) and Z1X >= 90) then
		else
			set hx = x + distance * Cos(radian)
			set hy = y + distance * Sin(radian)
		endif
	endif
	call SaveInteger(HY, h, 679, 1)
	call USV(Y1X, 851986, hx, hy)
	set Y1X = null
	set WLE = null
endfunction
function Z2X takes hashtable h, integer pk, integer ck returns boolean
	call RemoveSavedInteger(h, pk, ck)
	return true
endfunction
function Z3X takes unit Y1X, unit KKX, boolean Z4X, integer Z5X returns nothing
	local integer i = 0
	local item it
	local integer k = 0
	local integer Z6X = 0
	local integer j
	local player p = GetOwningPlayer(KKX)
	local integer Z7X
	local integer Z8X
	local string s
	call FlushChildHashtable(HY,'ITEM')
	loop
		set it = UnitItemInSlot(Y1X, i)
		if it != null and(GetItemPlayer(it)== p or GetPlayerSlotState(GetItemPlayer(it))== PLAYER_SLOT_STATE_LEFT) then
			call SaveItemHandle(HY,'ITEM', k, it)
			call SaveInteger(HY,'ITEM', k, UUV(it))
			set k = k + 1
		endif
		set it = UnitItemInSlot(KKX, i)
		if it != null and(GetItemPlayer(it)== p or GetPlayerSlotState(GetItemPlayer(it))== PLAYER_SLOT_STATE_LEFT) then
			call SaveItemHandle(HY,'ITEM', k, it)
			call SaveInteger(HY,'ITEM', k, UUV(it))
			set k = k + 1
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	set it = null
	if Z4X == false and k <= 6 then
		return
	endif
	set Z6X = k
	set k = 1
	if Z4X then
		set k = Z5X
	endif
	loop
		call SaveInteger(HY,'ITEM', 51, COV[k])
		call SaveInteger(HY,'ITEM', 52, CRV[k])
		call SaveInteger(HY,'ITEM', 53, CIV[k])
		call SaveInteger(HY,'ITEM', 54, CAV[k])
		call SaveInteger(HY,'ITEM', 55, CNV[k])
		set Z8X = 0
		set Z7X = 0
		set i = 0
		if COV[k]!= 0 then
			set Z7X = Z7X + 1
		endif
		if CRV[k]!= 0 then
			set Z7X = Z7X + 1
		endif
		if CIV[k]!= 0 then
			set Z7X = Z7X + 1
		endif
		if CAV[k]!= 0 then
			set Z7X = Z7X + 1
		endif
		if CNV[k]!= 0 then
			set Z7X = Z7X + 1
		endif
		loop
			set j = LoadInteger(HY,'ITEM', i)
			if j > 0 and LoadBoolean(HY,'ITEM', i)!= true then
				if(j == LoadInteger(HY,'ITEM', 51) and Z2X(HY,'ITEM', 51)) or(j == LoadInteger(HY,'ITEM', 52) and Z2X(HY,'ITEM', 52)) or(j == LoadInteger(HY,'ITEM', 53) and Z2X(HY,'ITEM', 53)) or(j == LoadInteger(HY,'ITEM', 54) and Z2X(HY,'ITEM', 54)) or(j == LoadInteger(HY,'ITEM', 55) and Z2X(HY,'ITEM', 55)) then
					call SaveItemHandle(HY,'ITEM', 100 + Z8X, LoadItemHandle(HY,'ITEM', i))
					call SaveBoolean(HY,'ITEM', i, true)
					call SaveInteger(HY,'ITEM',$C8+ Z8X, i)
					set Z8X = Z8X + 1
				endif
			endif
			set i = i + 1
		exitwhen i >= Z6X
		endloop
		if Z8X > 0 then
			set i = 100 
			loop
				if Z8X == Z7X then
					set it = LoadItemHandle(HY,'ITEM', i)
					if CBV[k]== NIV then
						call SaveInteger(HY,'ITEM', 300, 8)
					elseif CBV[k]== Item_DiffusalBladeLevel1 then
						call SaveInteger(HY,'ITEM', 300, 12)
					elseif CBV[k]== Item_DiffusalBladeLevel2 then
						call SaveInteger(HY,'ITEM', 300, 12)
					elseif CBV[k]== Item_MagicWand then
						if UUV(it)== Item_MagicStick then
							call SaveInteger(HY,'ITEM', 300, GetItemCharges(it))
						endif
					endif
					call RemoveItem(it)
				else
					call RemoveSavedBoolean(HY,'ITEM', LoadInteger(HY,'ITEM', 100 + i))
				endif
				call RemoveSavedHandle(HY,'ITEM', i)
				set i = i + 1
			exitwhen HaveSavedHandle(HY,'ITEM', i)== false
			endloop
		endif
		if Z8X == Z7X then
			if Z4X == false then
				set it = UnitAddItemById(KKX, RealItemTypeId[CBV[k]])
				if CBV[k]== NIV or CBV[k]== Item_MagicWand or CBV[k]== Item_DiffusalBladeLevel1 or CBV[k]== Item_DiffusalBladeLevel2 then
					if HaveSavedInteger(HY,'ITEM', 300) then
						call SetItemCharges(it, LoadInteger(HY,'ITEM', 300))
						call RemoveSavedInteger(HY,'ITEM', 300)
					endif
				endif
				call SetItemPlayer(it, p, true)
				call SetItemUserData(it, 0)
				call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIem\\AIemTarget.mdl", KKX, "origin"))
				set it = null
			else
				set it = CreateItem(PowerUpItemTypeId[CBV[k]], GetUnitX(KKX), GetUnitY(KKX))
				if CBV[k]== NIV or CBV[k]== Item_MagicWand or CBV[k]== Item_DiffusalBladeLevel1 or CBV[k]== Item_DiffusalBladeLevel2 then
					if HaveSavedInteger(HY,'ITEM', 300) then
						call SetItemCharges(it, LoadInteger(HY,'ITEM', 300))
						call RemoveSavedInteger(HY,'ITEM', 300)
					endif
				endif
				call SetItemPlayer(it, p, true)
				call SetItemUserData(it, 0)
				call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIem\\AIemTarget.mdl", KKX, "origin"))
				call UnitAddItem(KKX, it)
				set it = null
			endif
		endif
	exitwhen k >= CCV
		set k = k + 1
	endloop
endfunction
function Z9X takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit ZSX =(LoadUnitHandle(HY, h, 92))
	local unit triggerUnit =(LoadUnitHandle(HY, h, 2))
	local real x
	local real y
	local integer i
	local player p = GetOwningPlayer(triggerUnit)
	local item C1X
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		if GetTriggerUnit()== triggerUnit or UnitIsDead(triggerUnit) then
			call ZLX(ZSX)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_UNIT_ISSUED_ORDER or GetTriggerEventId()== EVENT_UNIT_ISSUED_TARGET_ORDER or GetTriggerEventId()== EVENT_UNIT_ISSUED_POINT_ORDER then
		set i = GetIssuedOrderId()
		if(LoadInteger(HY, h, 679))== 1 then
			call SaveInteger(HY, h, 679, 0)
		elseif i != 852100 and i != 852090 and i != 851973 and i != 851986 and not(i >= 852002 and i <= 852013) then
			call FlushChildHashtable(HY, h)	//不确定新增
			call CleanCurrentTrigger(t)
			call UPV(ZSX, "被中断")
		endif
	else
		if GetDistanceBetweenUnits(ZSX, triggerUnit)< 350 then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			if UnitIsDead(triggerUnit) == false then
				call Z3X(ZSX, triggerUnit, false, 0)
				call ZTX(ZSX, triggerUnit)
			endif
			call ZLX(ZSX)
			call UPV(ZSX, "回家")
		else
			call ZYX(GetHandleId(t))
			call UPV(ZSX, "运送给 " + JS[GetPlayerId(GetOwningPlayer(triggerUnit))]+ VMV[GetPlayerId(GetOwningPlayer(triggerUnit))]+ "|r")
		endif
	endif
	set t = null
	set ZSX = null
	set triggerUnit = null
	set C1X = null
	return false
endfunction
function VVO takes unit u, boolean b returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit mns = GetSellingUnit()
	local integer id =(LoadInteger(HY,(GetHandleId(mns)), 8000))
	if u != null then
		if u !=(LoadUnitHandle(HY,(GetHandleId(mns)),(8002 + id))) and b then
			set id = id + 1
			call SaveInteger(HY,(GetHandleId(mns)), 8000,(id))
			call SaveUnitHandle(HY,(GetHandleId(mns)),(8002 + id),(u))
		endif
		call SaveReal(HY, h, 677,((GetUnitX(u))* 1.))
		call SaveReal(HY, h, 678,((GetUnitY(u))* 1.))
		call IssueTargetOrderById(mns, 851986, u)
		call TriggerRegisterDeathEvent(t, mns)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerRegisterUnitEvent(t, mns, EVENT_UNIT_ISSUED_ORDER)
		call TriggerRegisterUnitEvent(t, mns, EVENT_UNIT_ISSUED_TARGET_ORDER)
		call TriggerRegisterUnitEvent(t, mns, EVENT_UNIT_ISSUED_POINT_ORDER)
		call TriggerRegisterTimerEvent(t, .2, true)
		call TriggerAddCondition(t, Condition(function Z9X))
		call SaveUnitHandle(HY, h, 2,(u))
		call SaveUnitHandle(HY, h, 92,(mns))
	endif
	set t = null
	set mns = null
endfunction
function VOO takes nothing returns nothing
	local item C1X = GetEnumItem()
	local player p = ZO
	local integer id = GetPlayerId(p)
	if GetWidgetLife(C1X)> 0 and GetItemPlayer(C1X)== p and IsItemVisible(C1X) then
		call SetItemPosition(C1X, VHV[id], VJV[id])
		call UnitAddItem(CTV, C1X)
	endif
	set C1X = null
	set p = null
endfunction
function VRO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 53))
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local player p = LoadPlayerHandle(HY, h, 50)
	set ZO = p
	set CTV = WUE
	if IsSentinelsPlayer(p) then
		call EnumItemsInRect(O0, TrueBoolexprCondition, function VOO)
	else
		call EnumItemsInRect(R0, TrueBoolexprCondition, function VOO)
	endif
	if GetTriggerEvalCount(t)== 3 then
		call KillUnit(u)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	set WUE = null
	return false
endfunction
function VIO takes unit triggerUnit returns nothing
	local unit u = GetSoldUnit()
	local integer i = 0
	local item C1X
	local integer id = GetPlayerId(GetOwningPlayer(u))
	local region r = CreateRegion()
	local trigger t
	local integer h
	local unit WUE = GetSellingUnit()
	local player p = GetOwningPlayer(u)
	if IsSentinelsPlayer(GetOwningPlayer(u)) then
		call RegionAddRect(r, O0)
	else
		call RegionAddRect(r, R0)
	endif
	if IsUnitInRegion(r, WUE) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .05, true)
		call TriggerAddCondition(t, Condition(function VRO))
		call SaveUnitHandle(HY, h, 53,(u))
		call SavePlayerHandle(HY, h, 50, p)
		call SaveUnitHandle(HY, h, 2,(WUE))
		loop
		exitwhen i > 5
			set C1X = UnitItemInSlot(WUE, i)
			if GUX(UUV(C1X))== false and UUV(C1X)!= AIV then
				call UnitRemoveItemFromSlot(WUE, i)
				if IsUnitInRegion(r, WUE) and IsPlayerAlly(GetItemPlayer(C1X), GetOwningPlayer(WUE)) then
					set id = GetPlayerId(GetItemPlayer(C1X))
					call SetItemPosition(C1X, VHV[id], VJV[id])
				endif
			endif
			set i = i + 1
		endloop
	endif
	call RemoveRegion(r)
	set u = null
	set r = null
	set t = null
	set C1X = null
	set WUE = null
endfunction
function VAO takes unit u returns string
	local string s = GetObjectName('n0FO')
	set s = JUX(s, "$hero", JS[GetPlayerId(GetOwningPlayer(u))]+ GetUnitName(u)+ "|r")
	return s
endfunction
function VNO takes unit WUE returns boolean
	if GetOwningPlayer(WUE)!= LocalPlayer or JE then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, " ")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, VAO(Player__Hero[GetPlayerId(GetOwningPlayer(WUE))]))
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, " ")
	endif
	return false
endfunction
function VBO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call UnitRemoveAbility(LoadUnitHandle(HY, h, 0),'A336')
	call UnitRemoveAbility(LoadUnitHandle(HY, h, 0),'B0GU')
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
endfunction
function VCO takes unit u, real r returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, r, false, function VBO)
	call UnitAddPermanentAbility(u,'A336')
	call SaveUnitHandle(HY, h, 0, u)
	set t = null
endfunction
function VDO takes nothing returns nothing
	local unit u = GetSoldUnit()
	local player p = GetOwningPlayer(u)
	local integer TME = GetPlayerId(p)
	local real r = 0
	if GetUnitTypeId(u)=='h085' then
		if Player__Hero[TME]!= null and UnitIsDead(Player__Hero[TME])== false then
			call VVO(Player__Hero[TME], true)
		endif
		call KillUnit(u)
	elseif GetUnitTypeId(u)=='h0BV' then
		if Player__Hero[TME]!= null then
			call VIO(Player__Hero[TME])
		endif
		call KillUnit(u)
	elseif GetUnitTypeId(u)=='h0DE' then
		if Player__Hero[TME]!= null then
			call VVO(LoadUnitHandle(HY, GetHandleId(GetSellingUnit()), 8002 + LoadInteger(HY, GetHandleId(GetSellingUnit()), 8000)-1), false)
		endif
		call KillUnit(u)
	elseif KDX(GetUnitTypeId(u)) then
		if Player__Hero[TME]!= null then
			if UnitIsDead(Player__Hero[TME]) and p == GetOwningPlayer(GetSellingUnit()) and LoadInteger(HY, GetHandleId(Player__Hero[TME]), 4304)!= 1 and UF[TME]== false then
				set r = TimerGetRemaining(PS[TME])
				call SaveReal(K, GetHandleId(p), 25, r + GetGameTime())
				call SaveReal(K, GetHandleId(p), 26, r * .25)
				call VNO(Player__Hero[TME])
				call ReviveHero(Player__Hero[TME], GetUnitX(u), GetUnitY(u), true)
				call VCO(Player__Hero[TME], r)
				call SetUnitState(Player__Hero[TME], UNIT_STATE_MANA,$2710)
				set EUV[TME]= IMaxBJ(0, EUV[TME]-Y4[KFX(GetHeroLevel(Player__Hero[GetPlayerId(GetOwningPlayer(GetSellingUnit()))]))])
				call KYX(p)
			else
				call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)+ Y4[KFX(GetHeroLevel(Player__Hero[GetPlayerId(GetOwningPlayer(GetSellingUnit()))]))])
				if UF[TME]then
					call InterfaceErrorForPlayer(p, "因死神镰刀的诅咒无法买活")
				endif
			endif
		endif
		call KillUnit(u)
	endif
	set u = null
endfunction
function VFO takes player VBX, unit U6E, integer VGO, integer i0, integer i1, integer i2, integer i3, integer i4, integer i5 returns nothing
	local item C1X
	call DisableTrigger(C3V)
	if i0 > 0 then
		set C1X = UnitItemInSlot(U6E, 0)
		call HZX(C1X)
	endif
	if i1 > 0 then
		set C1X = UnitItemInSlot(U6E, 1)
		call HZX(C1X)
	endif
	if i2 > 0 then
		set C1X = UnitItemInSlot(U6E, 2)
		call HZX(C1X)
	endif
	if i3 > 0 then
		set C1X = UnitItemInSlot(U6E, 3)
		call HZX(C1X)
	endif
	if i4 > 0 then
		set C1X = UnitItemInSlot(U6E, 4)
		call HZX(C1X)
	endif
	if i5 > 0 then
		set C1X = UnitItemInSlot(U6E, 5)
		call HZX(C1X)
	endif
	set C1X = UnitAddItemById(U6E, RealItemTypeId[VGO])
	call SetItemPlayer(C1X, VBX, true)
	call SetItemUserData(C1X, 0)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIem\\AIemTarget.mdl", U6E, "origin"))
	if UUV(C1X)== NIV then
		call SetItemCharges(C1X, 8)
	endif
	call EnableTrigger(C3V)
	if IsPlayerAlly(LocalPlayer, VBX) then
		if VGO == I4V then
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 4, JS[GetPlayerId(VBX)]+(VMV[GetPlayerId((VBX))])+ "|r |c00ffff00" + GetObjectName('n0LX')+ "|r")
		elseif VGO == ASV then
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 4, JS[GetPlayerId(VBX)]+(VMV[GetPlayerId((VBX))])+ "|r |c00ffff00" + GetObjectName('n0LY')+ "|r")
		endif
	endif
	set C1X = null
endfunction
function VHO takes player p, unit U6E, integer GTX returns boolean
	local integer i
	local integer x
	local integer y
	local integer array VJO
	local boolean array VKO
	local integer array VLO
	local boolean array VMO
	local boolean array JLX
	local integer array JVX
	local player VBX
	local integer VPO = 1
	local integer k
	local player array VQO
	local integer m
	local item VSO
	local item VTO
	local item VUO
	local item VWO
	local item VYO
	local item VZO
	local player V_O
	local player V0O
	local player V1O
	local player V2O
	local player V3O
	local player V4O
	local integer V5O
	local integer V6O
	local integer V7O
	local integer V8O
	local integer V9O
	local integer EVO
	local integer EEO
	local integer EXO
	local integer EOO
	local integer ERO
	local integer EIO
	local integer EAO
	local boolean ENO = false
	local boolean EBO = true
	set VSO = UnitItemInSlot(U6E, 0)
	set VTO = UnitItemInSlot(U6E, 1)
	set VUO = UnitItemInSlot(U6E, 2)
	set VWO = UnitItemInSlot(U6E, 3)
	set VYO = UnitItemInSlot(U6E, 4)
	set VZO = UnitItemInSlot(U6E, 5)
	set V_O = GetItemPlayer(VSO)
	set V0O = GetItemPlayer(VTO)
	set V1O = GetItemPlayer(VUO)
	set V2O = GetItemPlayer(VWO)
	set V3O = GetItemPlayer(VYO)
	set V4O = GetItemPlayer(VZO)
	set V5O = GetItemUserData(VSO)
	set V6O = GetItemUserData(VTO)
	set V7O = GetItemUserData(VUO)
	set V8O = GetItemUserData(VWO)
	set V9O = GetItemUserData(VYO)
	set EVO = GetItemUserData(VZO)
	set EEO = UUV(VSO)
	set EXO = UUV(VTO)
	set EOO = UUV(VUO)
	set ERO = UUV(VWO)
	set EIO = UUV(VYO)
	set EAO = UUV(VZO)
	if(GetPlayerSlotState((p))== PLAYER_SLOT_STATE_LEFT) then
		set VPO = 5
		set ENO = true
	endif
	set VQO[1]= p
	if ENO then
		set k = 2
		set m = 1
		loop
		exitwhen k > VPO
			if IsSentinelsPlayer(p) then
				if p != Sentinels[m]then
					set VQO[k]= Sentinels[m]
					set k = k + 1
				endif
			else
				if p != Scourges[m]then
					set VQO[k]= Scourges[m]
					set k = k + 1
				endif
			endif
			set m = m + 1
		endloop
	endif
	set k = 1
	loop
	exitwhen k > VPO
		set VBX = VQO[k]
		set i = 0
		if VSO != null and V5O == 1 and(V_O == VBX or Mode__PoolMode or(GetPlayerSlotState((V_O))== PLAYER_SLOT_STATE_LEFT)) then
			set VJO[i + 1]= EEO
		else
			set VJO[i + 1]= 0
		endif
		set i = 1
		if VTO != null and V6O == 1 and(V0O == VBX or Mode__PoolMode or(GetPlayerSlotState((V0O))== PLAYER_SLOT_STATE_LEFT)) then
			set VJO[i + 1]= EXO
		else
			set VJO[i + 1]= 0
		endif
		set i = 2
		if VUO != null and V7O == 1 and(V1O == VBX or Mode__PoolMode or(GetPlayerSlotState((V1O))== PLAYER_SLOT_STATE_LEFT)) then
			set VJO[i + 1]= EOO
		else
			set VJO[i + 1]= 0
		endif
		set i = 3
		if VWO != null and V8O == 1 and(V2O == VBX or Mode__PoolMode or(GetPlayerSlotState((V2O))== PLAYER_SLOT_STATE_LEFT)) then
			set VJO[i + 1]= ERO
		else
			set VJO[i + 1]= 0
		endif
		set i = 4
		if VYO != null and V9O == 1 and(V3O == VBX or Mode__PoolMode or(GetPlayerSlotState((V3O))== PLAYER_SLOT_STATE_LEFT)) then
			set VJO[i + 1]= EIO
		else
			set VJO[i + 1]= 0
		endif
		set i = 5
		if VZO != null and EVO == 1 and(V4O == VBX or Mode__PoolMode or(GetPlayerSlotState((V4O))== PLAYER_SLOT_STATE_LEFT)) then
			set VJO[i + 1]= EAO
		else
			set VJO[i + 1]= 0
		endif
		set VJO[0]= GTX
		set i = 1
		loop
		exitwhen i >(CCV)
			set VLO[0]= COV[i]
			set VLO[1]= CRV[i]
			set VLO[2]= CIV[i]
			set VLO[3]= CAV[i]
			set VLO[4]= CNV[i]
			if EBO then
				set VMO[0]= true
				set VMO[1]= true
				set VMO[2]= true
				set VMO[3]= true
				set VMO[4]= true
				set VMO[5]= true
				set VMO[6]= true
				set VKO[0]= true
				set VKO[1]= true
				set VKO[2]= true
				set VKO[3]= true
				set VKO[4]= true
				set VKO[5]= true
				set VKO[6]= true
				set JVX[0]= 0
				set JVX[1]= 0
				set JVX[2]= 0
				set JVX[3]= 0
				set JVX[4]= 0
				set JVX[5]= 0
				set JVX[6]= 0
				set EBO = false
			endif
			set JLX[0]= false
			set JLX[1]= false
			set JLX[2]= false
			set JLX[3]= false
			set JLX[4]= false
			set x = 0
			loop
			exitwhen x == 5
				if VLO[x]== 0 then
					set JLX[x]= true
				else
					set y = 0
					loop
						if VJO[y]== VLO[x]and VKO[y]and VMO[x]then
							set VKO[y]= false
							set VMO[x]= false
							set JLX[x]= true
							set JVX[y]= 1
							set y = 7
							set EBO = true
						else
							set y = y + 1
						endif
					exitwhen y == 7
					endloop
				endif
				if JLX[x]then
					set x = x + 1
				else
					set x = 5
				endif
			endloop
			if JLX[0]and JLX[1]and JLX[2]and JLX[3]and JLX[4]then
				call VFO(VBX, U6E, CBV[i], JVX[1], JVX[2], JVX[3], JVX[4], JVX[5], JVX[6])
				set i = CCV + 2
			else
				set i = i + 1
			endif
		endloop
		set X3 = JVX[0]== 1
		if i ==(CCV + 2) then
			set VSO = null
			set VTO = null
			set VUO = null
			set VWO = null
			set VYO = null
			set VZO = null
			return true
		endif
		set k = k + 1
	endloop
	set VSO = null
	set VTO = null
	set VUO = null
	set VWO = null
	set VYO = null
	set VZO = null
	set V_O = null
	set V0O = null
	set V1O = null
	set V2O = null
	set V3O = null
	set V4O = null
	set VBX = null
	return false
endfunction
function ECO takes player VBX, unit U6E, integer GTX returns boolean
	local integer i = 1
	local boolean JVX
	set X3 = false
	set JVX = VHO(VBX, U6E, GTX)
	return JVX
endfunction
function EDO takes nothing returns boolean
	if IsUnitAlly(GetFilterUnit(), GetOwningPlayer(U2)) and GetUnitAbilityLevel(GetFilterUnit(),'Aloc')== 0 and UnitInventorySize(GetFilterUnit())> 1 and GetUnitTypeId(GetFilterUnit())!='ncop' and GetPlayerAlliance(GetOwningPlayer(GetFilterUnit()), GetOwningPlayer(U2), ALLIANCE_SHARED_CONTROL) and GetOwningPlayer(U2)!= GetOwningPlayer(GetFilterUnit()) and IsUnitIllusion(GetFilterUnit())== false and UnitIsDead(GetFilterUnit())== false then
		if IsMessengerUnit(GetFilterUnit()) then
			set Q2 = Q2 + 1
			set W2 = GetFilterUnit()
		endif
	endif
	return false
endfunction
function EFO takes nothing returns boolean
	if IsUnitAlly(GetFilterUnit(), GetOwningPlayer(U2)) and GetUnitAbilityLevel(GetFilterUnit(),'Aloc')== 0 and UnitInventorySize(GetFilterUnit())> 1 and GetUnitTypeId(GetFilterUnit())!='ncop' and IsUnitIllusion(GetFilterUnit())== false and UnitIsDead(GetFilterUnit())== false then
		if GetOwningPlayer(U2)== GetOwningPlayer(GetFilterUnit()) then
			if IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) then
				if GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 then
					set W2 = GetFilterUnit()
				endif
			elseif IsUnitType(W2, UNIT_TYPE_HERO)== false then
				set W2 = GetFilterUnit()
			endif
		endif
	endif
	return false
endfunction
function EGO takes unit U6E, integer EHO returns unit
	local group g = LoginGroup(18)
	set U2 = U6E
	set W2 = null
	call GroupEnumUnitsInRange(g, GetUnitX(Y2), GetUnitY(Y2),$514+ EHO, Condition(function EFO))
	if W2 == null then
		set Q2 = 0
		call LogoutGroup(g)
		set g = LoginGroup(19)
		call GroupEnumUnitsInRange(g, GetUnitX(Y2), GetUnitY(Y2),$44C+ EHO, Condition(function EDO))
		if Q2 > 1 then
			set W2 = null
		endif
	endif
	call LogoutGroup(g)
	set g = null
	return W2
endfunction
function EJO takes player VBX, unit U6E, unit EKO, integer GTX, real x, real y, integer HUX, integer ELO returns nothing
	local unit EMO = null
	local item HWX = null
	set Y2 = EKO
	if GTX < 0 then
		return
	endif
	if GetUnitPointValue(U6E)==$C8 then
		set EMO = EGO(U6E, 0)
		if EMO == null then
			set EMO = EGO(U6E, 300)
		endif
	else
		set EMO = U6E
	endif
	if EMO == null or ECO(VBX, EMO, GSX(GTX))== false or X3 == false then
		if HHX(GSX(GTX)) then
			if H_X(EMO)== 0 or EMO == null then
				if EMO == null then
					call HYX(PowerUpItemTypeId[GTX], x, y, VBX, true, HUX)
				else
					if GetDistanceBetween(GetUnitX(EMO), GetUnitY(EMO), x, y)>$7D0 then
						set x = GetUnitX(EMO)
						set y = GetUnitY(EMO)
						call InterfaceErrorForPlayer(VBX, "背包已满！")
					endif
					call HYX(PowerUpItemTypeId[GTX], x, y, VBX, true, HUX)
				endif
			else
				set HWX = UnitAddItemById(EMO, RealItemTypeId[GTX])
				call SetItemCharges(HWX, HUX)
				call SetItemPlayer(HWX, VBX, true)
				call SetItemUserData(HWX, ELO)
			endif
		elseif HGX(GSX(GTX)) then
			if EMO == null or(H_X(EMO)== 0 and GetItemOfTypeFromUnit(EMO, RealItemTypeId[GTX])== null) then
				call HYX(PowerUpItemTypeId[GTX], x, y, VBX, true, H7X(GTX))
			else
				set HWX = CreateItem(PowerUpItemTypeId[GTX], x, y)
				call SetItemPlayer(HWX, VBX, true)
				call SetItemUserData(HWX, ELO)
				call SetItemCharges(HWX, H7X(GTX))
				call UnitAddItem(EMO, HWX)
			endif
		else
			if H_X(EMO)== 0 or EMO == null then
				if EMO == null then
					call HYX(PowerUpItemTypeId[GTX], x, y, VBX, true, 0)
				else
					if GetDistanceBetween(GetUnitX(EMO), GetUnitY(EMO), x, y)>$7D0 then
						set x = GetUnitX(EMO)
						set y = GetUnitY(EMO)
						call InterfaceErrorForPlayer(VBX, "背包已满！")
					endif
					call HYX(PowerUpItemTypeId[GTX], x, y, VBX, true, 0)
				endif
			else
				if GTX != NXV then
					set HWX = UnitAddItemById(EMO, RealItemTypeId[GTX])
					call SetItemPlayer(HWX, VBX, true)
					call SetItemUserData(HWX, 0)
				else
					call HMX(HWX, VBX)
				endif
			endif
		endif
	else
		if IsUnitType(EMO, UNIT_TYPE_HERO) then
			if ELO == 0 then
				call JSX("PUI_" + I2S(GetPlayerId(GetOwningPlayer(EMO))), RealItemTypeId[GSX(GTX)])
			endif
		endif
	endif
	set EMO = null
	set HWX = null
endfunction
function EPO takes player p, integer GTX returns nothing
	local integer i = GetPlayerId(p)
	if GTX == RYV then
		set DQ[i]= DQ[i]+ 1
	elseif GTX == R_V then
		set DQ[i]= DQ[i]+ 1
	elseif GTX == R0V then
		set DQ[i]= DQ[i]+ 4
	elseif GTX == R2V then
		set DQ[i]= DQ[i]+ 1
		set FQ[i]= FQ[i]+ 1
	elseif GTX == R3V then
		set DQ[i]= DQ[i]+ 2
		set FQ[i]= FQ[i]+ 2
	elseif GTX == R4V then
		set DQ[i]= DQ[i]+ 1
	elseif GTX == R8V then
		set DQ[i]= DQ[i]+ 2
	elseif GTX == RZV then
		set DQ[i]= DQ[i]+ 2
	elseif GTX == R9V then
		set DQ[i]= DQ[i]+ 2
	endif
endfunction
function EQO takes unit ESO, unit ETO returns boolean
	local integer GTX
	if(ESO == J7 or ESO == F7 or ESO == shop_2) and IsUnitAlly(ETO, Scourges[0]) then
		return false
	elseif(ESO == SentinelsShop_AncientOfWonders or ESO == SentinelsShop_CacheOfTheQuelthelan or ESO == SentinelsShop_PigKing) and IsUnitAlly(ETO, Sentinels[0]) then
		return false
	endif
	set GTX = H3X(ETO)
	if GTX == R2V or GTX == X4V or GTX == IVV or GTX == it_jys then
		return true
	endif
	return false
endfunction
function EUO takes unit u returns boolean
	return u == SentinelsShop_CacheOfTheQuelthelan or u == SentinelsShop_WeaponsDealer or u == SentinelsShop_GrylaTheAccessorizer or u == SentinelsShop_AncientOfWonders or u == SentinelsShop_ArcaneSanctum or u == SentinelsShop_AncientWeaponry or u == SentinelsShop_SupportiveVestments or u == SentinelsShop_EnchantedArtifacts or u == SentinelsShop_GatewayRelics or u == SentinelsShop_Protectorate or u == SentinelsShop_BlackMarket1 or u == SentinelsShop_BlackMarket2 or u == SentinelsShop_PigKing
endfunction
function EWO takes unit u returns boolean
	return u == F7 or u == G7 or u == H7 or u == J7 or u == K7 or u == L7 or u == M7 or u == P7 or u == Q7 or u == S7 or u == C7 or u == D7 or u == shop_2
endfunction
function EYO takes unit u returns boolean
	return u == A2 or u == I2 or u == B2
endfunction
function EZO takes unit u returns boolean
	return u == N2 or u == F2 or u == C2
endfunction
function E_O takes unit EKO, unit E0O returns real
	if EUO(EKO) or EWO(EKO) then
		return VHV[GetPlayerId(GetOwningPlayer(E0O))]
	elseif EYO(EKO) then
		return -7133.
	elseif EZO(EKO) then
		return 7207.
	endif
	return GetUnitX(E0O)
endfunction
function E1O takes unit EKO, unit E0O returns real
	if EUO(EKO) or EWO(EKO) then
		return VJV[GetPlayerId(GetOwningPlayer(E0O))]
	elseif EYO(EKO) then
		return 4317.
	elseif EZO(EKO) then
		return -4243.
	endif
	return GetUnitY(E0O)
endfunction
function E2O takes unit EKO, unit E0O returns real
	if EUO(EKO) then
		return GetRectCenterX(VZ)
	elseif EWO(EKO) then
		return GetRectCenterX(GY)
	endif
	return GetUnitX(E0O)
endfunction
function E3O takes unit EKO, unit E0O returns real
	if EUO(EKO) then
		return GetRectCenterY(VZ)
	elseif EWO(EKO) then
		return GetRectCenterY(GY)
	endif
	return GetUnitY(E0O)
endfunction
function E4O takes unit u returns nothing
	local integer i = 0
	local item it
	local integer TME = GetPlayerId(GetOwningPlayer(u))
	local region r = CreateRegion()
	local boolean b = IsMessengerUnit(u) or GetUnitTypeId(u)=='ncop'
	if IsSentinelsPlayer(GetOwningPlayer(u)) then
		call RegionAddRect(r, O0)
	else
		call RegionAddRect(r, R0)
	endif
	loop
	exitwhen i > 5
		set it = UnitItemInSlot(u, i)
		if it != null and UUV(it)!= AIV then
			set it = UnitRemoveItemFromSlot(u, i)
			if b == false then
				call DisplayTimedTextToPlayer(GetOwningPlayer(u), 0, 0, 8, "|c00ffff00" + GetItemName(it)+ "|r 已被放置在你的能量圈中")
			endif
			if(GetUnitTypeId(u)=='ncop' or IsUnitInRegion(r, u)) and IsPlayerAlly(GetItemPlayer(it), GetOwningPlayer(u)) then
				set TME = GetPlayerId(GetItemPlayer(it))
				call SetItemPosition(it, VHV[TME], VJV[TME])
			endif
		endif
		set i = i + 1
	endloop
	call RemoveRegion(r)
	set it = null
	set r = null
endfunction
function E5O takes unit u, integer id returns nothing
	local player p = GetOwningPlayer(u)
	local real x
	local real y
	set x = GetUnitX(u)
	set y = GetUnitY(u)
	call EJO(p, u, GetSellingUnit(), GSX(id), x, y, 0, 0)
	set u = null
	set p = null
endfunction
function E6O takes unit u returns unit
	local unit d = null
	local player p = GetOwningPlayer(u)
	if HaveSavedHandle(K, GetHandleId(p),'COUR'+ 1)== false or UnitIsDead(LoadUnitHandle(K, GetHandleId(p),'COUR'+ 1)) then
		set d = CreateUnit(p,'e00E', GetUnitX(Circle[GetPlayerId(p)]), GetUnitY(Circle[GetPlayerId(p)]), 0)
		call UnitAddPermanentAbility(d,'AInv')
		call SaveUnitHandle(K, GetHandleId(p),'COUR'+ 1, d)
		call UnitPauseTimedLife(d, true)
		set d = null
	elseif HaveSavedHandle(K, GetHandleId(p),'COUR'+ 1) then
		set d = LoadUnitHandle(K, GetHandleId(p),'COUR'+ 1)
		if p != GetOwningPlayer(d) then
			call SetUnitOwner(d, p, true)
			call SetUnitPosition(d, GetUnitX(Circle[GetPlayerId(p)]), GetUnitY(Circle[GetPlayerId(p)]))
		endif
		set d = null
	endif
	return LoadUnitHandle(K, GetHandleId(p),'COUR'+ 1)
endfunction
function E7O takes integer id returns boolean
	return id == NZV or id == I3V or id == X0V or id == X1V or id == OOV or id == OKV or id == X7V or id == OBV or id == RXV or id == OIV or id == X2V or id == OCV or id == OUV or id == OTV
endfunction
function E8O takes unit u, integer id returns boolean
	local unit d = E6O(u)
	local integer TBX = TEX(RealItemTypeId[id])
	local player p = GetOwningPlayer(u)
	local boolean b = false
	if E7O(id) then
		call DisplayTimedTextToPlayer(p, 0, 0, 10, JUX(GetObjectName('TX1A'), "$item", "|c00ffff00" + GetObjectName(RealItemTypeId[id])+ "|r"))
		set d = null
		return false
	endif
	if GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)>= TBX then
		set b = true
		call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)-TBX)
		call E5O(d, id)
	else
		call DisplayTimedTextToPlayer(p, 0, 0, 10, JUX(GetObjectName('TX1B'), "$item", "|c00ffff00" + GetObjectName(RealItemTypeId[id])+ "|r"))
	endif
	set d = null
	return b
endfunction
function E9O takes nothing returns boolean
	if Q2 < 6 and GetItemPlayer(GetFilterItem())== E3 and GetItemUserData(GetFilterItem())>= 0 and GetWidgetLife(GetFilterItem())> 1 then
		set Q2 = Q2 + 1
		return true
	endif
	return false
endfunction
function XVO takes nothing returns nothing
	call SaveItemHandle(VV,'ITEM', Q2, GetEnumItem())
endfunction
function XEO takes unit u returns boolean
	return IsUnitInRange(u, B2, 800) or IsUnitInRange(u, C2, 800)
endfunction
function XXO takes item it returns boolean
	local integer id = UUV(it)
	return id == StoutShield_melee or id == OTV or id == XPV or id == XQV or id == XTV or id == XWV or id == X6V or id == X9V or id == OXV or id == ODV or id == OFV or id == OHV or id == OJV or id == OLV or id == OMV or id == Item_MagicStick or id == QuellingBlade_Melee or id == RXV or id == OWV or id == R4V or id == X2V or id == XMV or id == XKV or id == XZV or id == XYV or id == Item_PlaneswalkerCloak
endfunction
function XOO takes unit KKX, integer XRO, player p returns nothing
	local integer i = 0
	local item it
	local integer k = 0
	local integer Z6X = 0
	local integer j
	local integer Z7X
	local integer Z8X
	local string s
	local unit Y1X = LoadUnitHandle(K, GetHandleId(p),'COUR')
	local integer id
	local unit d
	local real x
	local real y
	if XRO ==-1 or GetPlayerSlotState(p)== PLAYER_SLOT_STATE_LEFT then
		set it = null
		set Y1X = null
		set d = null
		return
	endif
	if Y1X == null then
		set Y1X = HJX(p)
	endif
	call FlushChildHashtable(HY,'ITEM')
	loop
		if Y1X != null then
			set it = UnitItemInSlot(Y1X, i)
			if it != null and GetItemPlayer(it)== p then
				call SaveItemHandle(HY,'ITEM', k, it)
				call SaveInteger(HY,'ITEM', k, UUV(it))
				set k = k + 1
			endif
		endif
		set it = UnitItemInSlot(KKX, i)
		if it != null and GetItemPlayer(it)== p then
			call SaveItemHandle(HY,'ITEM', k, it)
			call SaveInteger(HY,'ITEM', k, UUV(it))
			set k = k + 1
		endif
		if KKX != Player__Hero[GetPlayerId(p)]then
			set it = UnitItemInSlot(Player__Hero[GetPlayerId(p)], i)
			if it != null and GetItemPlayer(it)== p then
				call SaveItemHandle(HY,'ITEM', k, it)
				call SaveInteger(HY,'ITEM', k, UUV(it))
				set k = k + 1
			endif
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	set E3 = p
	set Q2 = 0
	if IsSentinelsPlayer(p) then
		call EnumItemsInRect(WA, Condition(function E9O), function XVO)
	else
		call EnumItemsInRect(YA, Condition(function E9O), function XVO)
	endif
	set i = Q2
	loop
	exitwhen i < 0
		if HaveSavedHandle(VV,'ITEM', i) then
			call SaveItemHandle(HY,'ITEM', k, LoadItemHandle(VV,'ITEM', i))
			call SaveInteger(HY,'ITEM', k, UUV(LoadItemHandle(VV,'ITEM', i)))
			call RemoveSavedHandle(VV,'ITEM', i)
			set k = k + 1
		endif
		set i = i -1
	endloop
	set it = null
	set Z6X = k
	set k = XRO
	call SaveInteger(HY,'ITEM', 51, COV[k])
	call SaveInteger(HY,'ITEM', 52, CRV[k])
	call SaveInteger(HY,'ITEM', 53, CIV[k])
	call SaveInteger(HY,'ITEM', 54, CAV[k])
	call SaveInteger(HY,'ITEM', 55, CNV[k])
	set Z8X = 0
	set Z7X = 0
	set i = 0
	if COV[k]!= 0 then
		set Z7X = Z7X + 1
	endif
	if CRV[k]!= 0 then
		set Z7X = Z7X + 1
	endif
	if CIV[k]!= 0 then
		set Z7X = Z7X + 1
	endif
	if CAV[k]!= 0 then
		set Z7X = Z7X + 1
	endif
	if CNV[k]!= 0 then
		set Z7X = Z7X + 1
	endif
	loop
		set j = LoadInteger(HY,'ITEM', i)
		if j > 0 and LoadBoolean(HY,'ITEM', i)== false then
			if(j == LoadInteger(HY,'ITEM', 51) and Z2X(HY,'ITEM', 51)) or(j == LoadInteger(HY,'ITEM', 52) and Z2X(HY,'ITEM', 52)) or(j == LoadInteger(HY,'ITEM', 53) and Z2X(HY,'ITEM', 53)) or(j == LoadInteger(HY,'ITEM', 54) and Z2X(HY,'ITEM', 54)) or(j == LoadInteger(HY,'ITEM', 55) and Z2X(HY,'ITEM', 55)) then
				call SaveItemHandle(HY,'ITEM', 100 + Z8X, LoadItemHandle(HY,'ITEM', i))
				call SaveBoolean(HY,'ITEM', i, true)
				call SaveInteger(HY,'ITEM',$C8+ Z8X, i)
				set Z8X = Z8X + 1
			endif
		endif
		set i = i + 1
	exitwhen i >= Z6X
	endloop
	if Z8X != Z7X then
		set id = LoadInteger(HY,'ITEM', 51)
		if id != 0 then
			if E8O(KKX, id) then
				set Z7X = Z7X + 1
			endif
		endif
		set id = LoadInteger(HY,'ITEM', 52)
		if id != 0 then
			if E8O(KKX, id) then
				set Z7X = Z7X + 1
			endif
		endif
		set id = LoadInteger(HY,'ITEM', 53)
		if id != 0 then
			if E8O(KKX, id) then
				set Z7X = Z7X + 1
			endif
		endif
		set id = LoadInteger(HY,'ITEM', 54)
		if id != 0 then
			if E8O(KKX, id) then
				set Z7X = Z7X + 1
			endif
		endif
		set id = LoadInteger(HY,'ITEM', 55)
		if id != 0 then
			if E8O(KKX, id) then
				set Z7X = Z7X + 1
			endif
		endif
		if Z8X == Z7X then
			set i = 100 
			loop
				call UnitAddItem(LoadUnitHandle(K, GetHandleId(GetOwningPlayer(KKX)),'COUR'+ 1), LoadItemHandle(HY,'ITEM', i))
				call RemoveSavedHandle(HY,'ITEM', i)
				set i = i + 1
			exitwhen HaveSavedHandle(HY,'ITEM', i)== false
			endloop
		endif
		set d = LoadUnitHandle(K, GetHandleId(GetOwningPlayer(KKX)),'COUR'+ 1)
		if true then
			set x = GetUnitX(d)
			set y = GetUnitY(d)
			call SetUnitX(d, GetUnitX(KKX))
			call SetUnitY(d, GetUnitY(KKX))
			if UnitIsDead(KKX)== false and IsUnitInRange(KKX, SentinelsBuilding_FountainOfLife,$640) or IsUnitInRange(KKX, B7,$640) then
				call Z3X(d, KKX, true, k)
				if H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 0), KKX)
				endif
				if H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 1), KKX)
				endif
				if H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 2), KKX)
				endif
				if H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 3), KKX)
				endif
				if H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 4), KKX)
				endif
				if H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 5), KKX)
				endif
			elseif UnitIsDead(KKX)== false and XEO(KKX) then
				if XXO(UnitItemInSlot(d, 0)) and H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 0), KKX)
				endif
				if XXO(UnitItemInSlot(d, 1)) and H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 1), KKX)
				endif
				if XXO(UnitItemInSlot(d, 2)) and H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 2), KKX)
				endif
				if XXO(UnitItemInSlot(d, 3)) and H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 3), KKX)
				endif
				if XXO(UnitItemInSlot(d, 4)) and H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 4), KKX)
				endif
				if XXO(UnitItemInSlot(d, 5)) and H_X(KKX)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 5), KKX)
				endif
			elseif Y1X != null and UnitIsDead(Y1X)== false and(IsUnitInRangeXY(Y1X, GetRectCenterX(WA), GetRectCenterY(WA),$640) or IsUnitInRangeXY(Y1X, GetRectCenterX(YA), GetRectCenterY(YA),$640)) then
				call SetUnitX(d, GetUnitX(Y1X))
				call SetUnitY(d, GetUnitY(Y1X))
				call Z3X(d, Y1X, true, k)
				if H_X(Y1X)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 0), Y1X)
				endif
				if H_X(Y1X)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 1), Y1X)
				endif
				if H_X(Y1X)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 2), Y1X)
				endif
				if H_X(Y1X)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 3), Y1X)
				endif
				if H_X(Y1X)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 4), Y1X)
				endif
				if H_X(Y1X)> 0 then
					call UnitDropItemTarget(d, UnitItemInSlot(d, 5), Y1X)
				endif
			endif
			call SetUnitX(d, x)
			call SetUnitY(d, y)
		endif
		call E4O(d)
		set d = null
	endif
	call UnitRemoveAbility(LoadUnitHandle(K, GetHandleId(GetOwningPlayer(KKX)),'COUR'+ 1),'AInv')
	call UnitAddAbility(LoadUnitHandle(K, GetHandleId(GetOwningPlayer(KKX)),'COUR'+ 1),'AInv')
	set Y1X = null
	set it = null
	set d = null
endfunction
function XIO takes integer id, boolean XAO returns integer
	local integer i = 0
	loop
		if(XAO == false and CBV[i]== LoadInteger(HY,'ITDB', id)) or(XAO and(COV[i]== id or CRV[i]== id or CIV[i]== id or CAV[i]== id or CNV[i]== id)) then
			return i
		endif
		set i = i + 1
	exitwhen i > CCV
	endloop
	return -1
endfunction
function XNO takes nothing returns nothing
	local unit u = GetSoldUnit()
	local player p = GetOwningPlayer(u)
	local integer GTX = H3X(u)
	local real x
	local real y
	local integer i
	call UnitAddAbility(u,'Aloc')
	call ShowUnit(u, false)
	call UnitApplyTimedLife(u,'BTLF', 2)
	if GetUnitTypeId(u)=='h03Q' and not WN then
		call InterfaceErrorForPlayer(p, "开局3分钟内无法购买小鸟.")
		call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)+ 150)
		set u = null
		return
	endif
	if HGX(GTX)== false and RealItemTypeId[GTX]!= 0 then
		call SaveInteger(P,'ITEM', GetPlayerId(p), RealItemTypeId[GTX])
		call SaveReal(P,'ITEM', GetPlayerId(p), GetGameTime())
	endif
	if EQO(GetSellingUnit(), u) then
		call InterfaceErrorForPlayer(p, GetObjectName('n02G'))
		if IsUnitAlly(u, Sentinels[0]) then
			set p = Scourges[0]
		else
			set p = Sentinels[0]
		endif
		set x = E2O(GetSellingUnit(), u)
		set y = E3O(GetSellingUnit(), u)
		call HYX(PowerUpItemTypeId[H3X(u)], x, y, p, true, H7X(H3X(u)))
	else
		call EPO(p, GSX(GTX))
		if RealItemTypeId[GTX]== 0 then
			set i = XIO(GTX, false)
			if i ==-1 then
				call InterfaceErrorForPlayer(p, GetObjectName('n02H'))
			else
				call XOO(Player__Hero[GetPlayerId(p)], i, p)
			endif
		else
			set x = E_O(GetSellingUnit(), u)
			set y = E1O(GetSellingUnit(), u)
			if GTX == R8V then
				call EJO(p, u, GetSellingUnit(), GSX(GTX), x, y, 2, 0)
			else
				call EJO(p, u, GetSellingUnit(), GSX(GTX), x, y, 0, 0)
			endif
		endif
	endif
	set u = null
	set p = null
endfunction
function B1E takes nothing returns nothing
	set VE = true
endfunction
function XBO takes nothing returns nothing
	if InHeroSelection and TimerGetRemaining(NK)> 0 and((IsSentinelsPlayer(GetTriggerPlayer()) and CK[0]> 0) or(IsScourgesPlayer(GetTriggerPlayer()) and CK[1]> 0)) then
		if IsSentinelsPlayer(GetTriggerPlayer()) then
			set CK[0]= CK[0]-1
			if UnitIsDead(HR) then
				call KillUnit(JR)
			else
				call KillUnit(HR)
			endif
		else
			set CK[1]= CK[1]-1
			if UnitIsDead(KR) then
				call KillUnit(LR)
			else
				call KillUnit(KR)
			endif
		endif
		call ExecuteFunc("XCO")
		call DisplayTimedTextToPlayer(LocalPlayer, .0, .0, CR[LocalId], JS[GetPlayerId(GetTriggerPlayer())]+ GetPlayerName(GetTriggerPlayer())+ "|r" + " 增加了45秒的选择时间.")
	endif
endfunction
function XDO takes player p returns nothing
	if InHeroSelection and TimerGetRemaining(NK)> 0 and((IsSentinelsPlayer(p) and CK[0]> 0) or(IsScourgesPlayer(p) and CK[1]> 0)) then
		if IsSentinelsPlayer(p) then
			set CK[0]= CK[0]-1
		else
			set CK[1]= CK[1]-1
		endif
		call ExecuteFunc("XCO")
		call DisplayTimedTextToPlayer(LocalPlayer, .0, .0, CR[LocalId], JS[GetPlayerId(p)]+ GetPlayerName(p)+ "|r增加了45秒的选择时间.")
	endif
endfunction
function XFO takes nothing returns boolean
	local unit u = GetSoldUnit()
	local player p = LocalPlayer
	local player ETO = GetOwningPlayer(u)
	local integer TME = GetPlayerId(ETO)
	local integer WPV = H3X(u)
	if GetUnitTypeId(u)=='h304' or GetUnitTypeId(u)=='h305' then
		if(IsSentinelsPlayer(ETO) and GetUnitTypeId(u)=='h304') or(IsScourgesPlayer(ETO) and GetUnitTypeId(u)=='h305') then
			call KillUnit(GetSellingUnit())
			call XDO(GetOwningPlayer(u))
		else
			call InterfaceErrorForPlayer(ETO, "这是对方的加时器，请用你自己的.")
		endif
		call RemoveUnit(u)
	elseif GetUnitTypeId(u)=='h307' then
		set E3 = GetOwningPlayer(u)
		call ExecuteFunc("XGO")
		call RemoveUnit(u)
	endif
	if GetUnitPointValue(u)>=$C8 then
		call XNO()
		if IsPlayerAlly(p, ETO) or(MW and(p == VKV or p == VLV)) then
			if WPV == R5V then
				call PingMinimapEx(GetUnitX(u), GetUnitY(u), 3, 255, 255, 255, false)
				call DisplayTimedTextToPlayer(p, 0, 0, 20, JS[TME]+(VMV[TME])+ "|r |c00ffff00" + GetObjectName('n0HU')+ "|r")
			elseif WPV == BUV and WN then
				call PingMinimapEx(GetUnitX(u), GetUnitY(u), 3, 255, 255, 255, false)
				call DisplayTimedTextToPlayer(p, 0, 0, CR[LocalId], JS[TME]+(VMV[TME])+ "|r |c00ffff00" + GetObjectName('n0KG')+ "|r")
			elseif WPV == R8V then
				call DisplayTimedTextToPlayer(p, 0, 0, 4, JS[TME]+(VMV[TME])+ "|r |c00ffff00" + GetObjectName('n0KO')+ "|r")
			elseif WPV == R2V then
				call PingMinimapEx(GetUnitX(u), GetUnitY(u), 3, 255, 255, 255, false)
				call DisplayTimedTextToPlayer(p, 0, 0, 4, JS[TME]+(VMV[TME])+ "|r |c00ffff00" + GetObjectName('n0KP')+ "|r")
			elseif WPV == R3V then
				call PingMinimapEx(GetUnitX(u), GetUnitY(u), 3, 255, 255, 255, false)
				call DisplayTimedTextToPlayer(p, 0, 0, 4, JS[TME]+(VMV[TME])+ "|r |c00ffff00" + GetObjectName('n0KQ')+ "|r")
			elseif WPV == B4V then
				call PingMinimapEx(GetUnitX(u), GetUnitY(u), 3, 255, 255, 255, false)
				call DisplayTimedTextToPlayer(p, 0, 0, 4, JS[TME]+(VMV[TME])+ "|r |c00ffff00" + GetObjectName('n0KT')+ "|r")
			elseif WPV == X4V then
				call PingMinimapEx(GetUnitX(u), GetUnitY(u), 3, 255, 255, 255, false)
				call DisplayTimedTextToPlayer(p, 0, 0, 4, JS[TME]+(VMV[TME])+ "|r |c00ffff00" + GetObjectName('n0LB')+ "|r")
			elseif WPV == IVV then
				call PingMinimapEx(GetUnitX(u), GetUnitY(u), 3, 255, 255, 255, false)
				call DisplayTimedTextToPlayer(p, 0, 0, 4, JS[TME]+(VMV[TME])+ "|r |c00ffff00" + GetObjectName('n0LP')+ "|r")
			elseif WPV == it_jys then
				call PingMinimapEx(GetUnitX(u), GetUnitY(u), 3, 255, 255, 255, false)
				call DisplayTimedTextToPlayer(p, 0, 0, 4, JS[TME]+(VMV[TME])+ "|r |c00ffff00购买了知识之书|r")
			endif
		endif
		if WPV == OZV then
			if XI[TME]== false then
				call DisplayTimedTextToPlayer(ETO, 0, 0, CR[LocalId], "|c00FF0000注意|r: 你可以输入 -orp 指令来恢复旧版魔瓶模式.")
			endif
		endif
	else
		call VDO()
	endif
	set u = null
	return false
endfunction
function XHO takes integer XJO returns boolean
	return XJO == A4V or XJO == A3V or XJO == QuellingBlade_Ranged or XJO == QuellingBlade_Melee or XJO == StoutShield_ranged or XJO == StoutShield_melee or XJO == NSV or XJO == NQV or XJO == Vanguard_ranged or XJO == Vanguard_melee or XJO == XLV or XJO == XKV or XJO == ABV or XJO == ANV
endfunction
function XKO takes unit u, item it returns nothing
	local integer WPV = GetUnitTypeId(u)
	local integer TZE = GetItemIndex(it)
	local player p
	if XHO(TZE)== false then
		return
	endif
	if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) or IsUnitType(u, UNIT_TYPE_HERO)== false then
		if TZE == A4V then
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, RealItemTypeId[A3V], p, false, 1)
		elseif TZE == StoutShield_ranged then
			//set StoutShieldCount = StoutShieldCount - 1
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, RealItemTypeId[StoutShield_melee], p, false, 1)
		elseif TZE == NSV then
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, RealItemTypeId[NQV], p, false, 1)
		elseif TZE == Vanguard_ranged then
			//set VanguardCount = VanguardCount - 1
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, RealItemTypeId[Vanguard_melee], p, false, 1)
		elseif TZE == XLV then
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, RealItemTypeId[XKV], p, false, 1)
		endif
	else
		if TZE == A3V then
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, RealItemTypeId[A4V], p, false, 1)
		elseif TZE == StoutShield_melee then
			//set StoutShieldCount = StoutShieldCount - 1
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, RealItemTypeId[StoutShield_ranged], p, false, 1)
		elseif TZE == NQV then
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, RealItemTypeId[NSV], p, false, 1)
		elseif TZE == Vanguard_melee then
			//set VanguardCount = VanguardCount - 1
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, RealItemTypeId[Vanguard_ranged], p, false, 1)
		elseif TZE == XKV then
			set p = GetItemPlayer(it)
			call HZX(it)
			call TDE(u, RealItemTypeId[XLV], p, false, 1)
		endif
	endif
endfunction
function XLO takes unit triggerUnit, item C1X returns boolean
	local unit u = triggerUnit
	local integer H4X = GetUnitTypeId(u)
	local integer GTX = UUV(C1X)
	local real x
	local real y
	local integer i
	local boolean XMO = true
	set x = GetUnitX(u)
	set y = GetUnitY(u)
	if GTX == OZV then
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl", u, "overhead"))
		call IRX(GetOwningPlayer(u), "Abilities\\Spells\\Human\\Heal\\HealTarget.wav")
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		call TDE(triggerUnit, RealItemTypeId[O2V], E3, false, 1)
		call UnitRemoveAbility(u,'B0GI')
	endif
	if(GTX)== Item_DiffusalBladeLevel1 and GetItemCharges(C1X)== 0 then
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		call TDE(triggerUnit, RealItemTypeId[Item_DiffusalBladeLevel1_Empty], E3, false, 1)
	endif
	if GTX == RRV and GetItemCharges(C1X)== 0 then
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		call TDE(triggerUnit, RealItemTypeId[RIV], E3, false, 1)
	endif
	call DisableTrigger(CUV)
	if(GTX == ICV or GTX == IBV or GTX == IDV) and(GZX(u, RealItemTypeId[ICV], C1X)!= null or GZX(u, RealItemTypeId[IBV], C1X)!= null or GZX(u, RealItemTypeId[IDV], C1X)!= null) then
		call InterfaceErrorForPlayer(GetOwningPlayer(u), GetObjectName('n02L'))
		set E3 = GetItemPlayer(C1X)
		call RemoveItem(C1X)
		set Z2 = CreateItem(PowerUpItemTypeId[GTX], x, y)
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
	endif
	if(GTX == NCV or GTX == NBV or GTX == NFV or GTX == NDV) and(GZX(u, RealItemTypeId[NCV], C1X)!= null or GZX(u, RealItemTypeId[NBV], C1X)!= null or GZX(u, RealItemTypeId[NFV], C1X)!= null or GZX(u, RealItemTypeId[NDV], C1X)!= null) then
		call InterfaceErrorForPlayer(GetOwningPlayer(u), GetObjectName('n02C'))
		set E3 = GetItemPlayer(C1X)
		call RemoveItem(C1X)
		set Z2 = CreateItem(PowerUpItemTypeId[GTX], x, y)
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
	endif
	if(GTX == I9V or GTX == AVV or GTX == AEV or GTX == AXV or GTX == AOV or GTX == ARV) then
		set i = LoadInteger(K, GetHandleId(GetOwningPlayer(u)),'0BKB')
		if i == 0 and GTX != I9V then
			set E3 = GetItemPlayer(C1X)
			call HZX(C1X)
			call TDE(triggerUnit, RealItemTypeId[I9V], E3, false, 1)
		elseif i == 9 and GTX != AVV then
			set E3 = GetItemPlayer(C1X)
			call HZX(C1X)
			call TDE(triggerUnit, RealItemTypeId[AVV], E3, false, 1)
		elseif i == 8 and GTX != AEV then
			set E3 = GetItemPlayer(C1X)
			call HZX(C1X)
			call TDE(triggerUnit, RealItemTypeId[AEV], E3, false, 1)
		elseif i == 7 and GTX != AXV then
			set E3 = GetItemPlayer(C1X)
			call HZX(C1X)
			call TDE(triggerUnit, RealItemTypeId[AXV], E3, false, 1)
		elseif i == 6 and GTX != AOV then
			set E3 = GetItemPlayer(C1X)
			call HZX(C1X)
			call TDE(triggerUnit, RealItemTypeId[AOV], E3, false, 1)
		elseif i == 5 and GTX != ARV then
			set E3 = GetItemPlayer(C1X)
			call HZX(C1X)
			call TDE(triggerUnit, RealItemTypeId[ARV], E3, false, 1)
		endif
	endif
	if(GTX == ASV and IsPlayerEnemy(GetItemPlayer(C1X), GetOwningPlayer(u))) then
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		set Z2 = UnitAddItemById(u, RealItemTypeId[ATV])
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
	endif
	if(GTX == AIV) and(IsMessengerUnit(u) or IsBearUnit(u)) then
		if IsMessengerUnit(u) then
			call InterfaceErrorForPlayer(GetOwningPlayer(u), GetObjectName('n02K'))
		endif
		set E3 = GetItemPlayer(C1X)
		set Q2 = GetItemCharges(C1X)
		call RemoveItem(C1X)
		if GTX == AIV then
			set Z2 = CreateItem(PowerUpItemTypeId[GTX], GetRectCenterX(PZ), GetRectCenterY(PZ))
			call SetItemCharges(Z2, Q2)
		endif
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
	endif
	call EnableTrigger(CUV)
	if XMO then
		call XKO(triggerUnit, C1X)
	endif
	set u = null
	set C1X = null
	return false
endfunction
function XPO takes integer GTX returns boolean
	return GTX == I0V or GTX == NDV or GTX == NFV or GTX == NHV or GTX == I_V or GTX == NBV or GTX == NCV or GTX == NGV or GTX == X4V or GTX == X5V or GTX == IFV or GTX == IGV
endfunction
function XQO takes integer GTX returns boolean
	return GTX == X4V or GTX == X5V
endfunction
function XSO takes unit triggerUnit, item C1X returns boolean
	local integer JAX = 0
	local item UWV = C1X
	local integer GTX = GetItemIndex(UWV)
	local integer XTO = 0
	local boolean JVX = false
	local integer XUO = H1X(UWV)
	local boolean XWO = false
	if IsUnitType(triggerUnit, UNIT_TYPE_HERO) then
		if GTX == I0V then
			set XTO = I_V
		elseif GTX == IGV then
			set XTO = IFV
		elseif GTX == NDV then
			set XTO = NBV
		elseif GTX == NFV then
			set XTO = NCV
		elseif GTX == NHV then
			set XTO = NGV
		elseif GTX == X5V then
			set XTO = X4V
		endif
		if XUO == X5V then
			set XTO = X4V
			set XWO = true
		endif
		if XTO != 0 then
			set E3 = GetItemPlayer(UWV)
			call HZX(UWV)
			if XWO then
				set Z2 = UnitAddItemById(triggerUnit, InvalidItemTypeId[XTO])
			else
				set Z2 = UnitAddItemById(triggerUnit, RealItemTypeId[XTO])
			endif
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			set JVX = true
		endif
	else
		if GTX == X4V then
			set XTO = X5V
		endif
		if XUO == X4V then
			set XTO = X5V
			set XWO = true
		endif
		if XTO != 0 then
			set E3 = GetItemPlayer(UWV)
			call HZX(UWV)
			if XWO then
				set Z2 = UnitAddItemById(triggerUnit, InvalidItemTypeId[XTO])
			else
				set Z2 = UnitAddItemById(triggerUnit, RealItemTypeId[XTO])
			endif
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			set JVX = true
		endif
	endif
	set UWV = null
	return JVX
endfunction
function XYO takes unit triggerUnit, item C1X returns boolean
	if XPO(GetItemIndex(C1X)) or XQO(H1X(C1X)) then
		return XSO(triggerUnit, C1X)
	endif
	return false
endfunction
function XZO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit ZWX =(LoadUnitHandle(HY, h, 26))
	local integer X_O =(LoadInteger(HY, h, 97))
	local integer GTX =(LoadInteger(HY, h, 93))
	local boolean X0O =(LoadBoolean(HY, h, 95))
	local item C1X
	local player p = GetOwningPlayer(ZWX)
	local player X1O
	local integer HUX
	local boolean HTX = false
	local item HWX
	//local integer scepter_indexid
	//local integer scepter_abilityid
	//local integer scepter_hiddenabilityid
	local integer newCharges
	local item X2O
	local integer targetCount
	local item X3O
	local boolean X4O = false
	local integer i
	local integer k
	local real tt
	local boolean scepterWorks
	call DisableTrigger(C3V)
	if X0O then
		set X3O = null
		set X1O =(LoadPlayerHandle(HY, h, 54))
		set HUX =(LoadInteger(HY, h, 76))
	else
		set C1X =(LoadItemHandle(HY, h, 96))
		set X3O = C1X
		set X1O = GetItemPlayer(C1X)
		set HUX = GetItemCharges(C1X)
	endif
	if X0O == false and C1X == null then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call EnableTrigger(C3V)
		set t = null
		set ZWX = null
		set p = null
		return false
	endif
	if X_O == 1 then
		if p != X1O and GetUnitTypeId(ZWX)=='ncop' then
			if HGX(GSX(GTX)) or HHX(GSX(GTX)) then
				set HTX = true
			endif
			if IsPlayerEnemy(p, X1O) then
				call HYX(PowerUpItemTypeId[GTX], VHV[GetPlayerId(p)], VJV[GetPlayerId(p)], X1O, HTX, HUX)
			else
				call HYX(PowerUpItemTypeId[GTX], VHV[GetPlayerId(X1O)], VJV[GetPlayerId(X1O)], X1O, HTX, HUX)
			endif
			call InterfaceErrorForPlayer(p, GetObjectName('n0DR'))
			if X0O == false then
				set X4O = true
				call HZX(C1X)
			endif
		elseif Mode__PoolMode == false and X0O == false and GetItemType(C1X)== ITEM_TYPE_CAMPAIGN and H2X(C1X)!= 0 and(p == X1O or(GetPlayerSlotState(X1O)== PLAYER_SLOT_STATE_LEFT)) then
			if HHX(GTX) then
				set HTX = true
			else
				set HTX = false
			endif
			if not(GetPlayerSlotState(X1O)== PLAYER_SLOT_STATE_LEFT and GUX(GTX)) then
				call HZX(C1X)
				set X4O = true
				set HWX = UnitAddItemById(ZWX, RealItemTypeId[GTX])
				set X3O = HWX
				call SetItemPlayer(HWX, X1O, false)
				call SetItemUserData(HWX, 0)
				if HTX or GTX == R0V or GTX == R_V or GTX == RYV then
					call SetItemCharges(HWX, HUX)
				endif
			endif
		elseif Mode__PoolMode == false and X0O == false and GetItemType(C1X)== ITEM_TYPE_PERMANENT and p != X1O and InvalidItemTypeId[UUV(C1X)]!= 0 and(GetPlayerSlotState(X1O)== PLAYER_SLOT_STATE_LEFT)== false then
			if HHX(GTX) then
				set HTX = true
			else
				set HTX = false
			endif
			call HZX(C1X)
			set X4O = true
			set HWX = UnitAddItemById(ZWX, InvalidItemTypeId[GTX])
			set X3O = HWX
			call SetItemPlayer(HWX, X1O, false)
			call SetItemUserData(HWX, 0)
			if HTX then
				call SetItemCharges(HWX, HUX)
			endif
		elseif X0O == false and GetItemType(C1X)== ITEM_TYPE_PERMANENT and HFX(C1X) and IsUnitType(ZWX, UNIT_TYPE_HERO) then
			if HDX(ZWX, false) then
				if GTX == XFV or(IsPlayerHasSkill(X1O,(39 -1)* 4 + 3) and GTX != XDV) then
					call HZX(C1X)
					if IsPlayerHasSkill(X1O,(39 -1)* 4 + 3) then
						set HWX = UnitAddItemById(ZWX, RealItemTypeId[XDV])
					else
						set HWX = UnitAddItemById(ZWX, RealItemTypeId[XCV])
					endif
					set X3O = HWX
					call SetItemPlayer(HWX, X1O, false)
					call SetItemUserData(HWX, 1)
				endif
			else
				if GTX != XFV then
					call HZX(C1X)
					set HWX = UnitAddItemById(ZWX, RealItemTypeId[XFV])
					set X3O = HWX
					call SetItemPlayer(HWX, X1O, false)
					call SetItemUserData(HWX, 1)
				endif
			endif
		elseif X0O == false and GetItemType(C1X)== ITEM_TYPE_ARTIFACT then
			if(p != X1O and XHX(X1O)== false and(GTX == R0V or GTX == R_V or GTX == RYV)) then
				call DisableTrigger(CUV)
				call HZX(C1X)
				set HWX = UnitAddItemById(ZWX, InvalidItemTypeId[GTX])
				set X3O = HWX
				call SetItemPlayer(HWX, X1O, false)
				call SetItemUserData(HWX, 1)
				call SetItemCharges(HWX, HUX)
				call EnableTrigger(CUV)
			else
				call DisableTrigger(CUV)
				set X2O = G1X(X1O, ZWX, GTX, C1X)
				if X2O == null then
				else
					call SetItemCharges(X2O, HUX + GetItemCharges(X2O))
					call HZX(C1X)
					set X3O = null
				endif
				call EnableTrigger(CUV)
			endif
		elseif X0O and HGX(GSX(GTX)) then
			if(p == X1O) then
				call DisableTrigger(CUV)
				if H_X(ZWX)== 0 and G2X(X1O, ZWX, GTX)== null then
					call InterfaceErrorForPlayer(p, GetObjectName('n02O'))
					call HYX(PowerUpItemTypeId[(GTX)],(((LoadReal(HY, h, 6)))* 1.),(((LoadReal(HY, h, 7)))* 1.),(X1O),(true),(HUX))
				else
					set X2O = G2X(X1O, ZWX, GTX)
					if X2O == null then
						call DisableTrigger(CUV)
						set HWX = UnitAddItemById(ZWX, RealItemTypeId[GTX])
						set X3O = HWX
						call SetItemPlayer(HWX, X1O, false)
						call SetItemUserData(HWX, 1)
						call SetItemCharges(HWX, HUX)
					else
						call SetItemCharges(X2O, HUX + GetItemCharges(X2O))
					endif
				endif
				call EnableTrigger(CUV)
			else
				if InvalidItemTypeId[GTX]> 0 then
					set Q2 = InvalidItemTypeId[GTX]
				else
					set Q2 = RealItemTypeId[GTX]
				endif
				call DisableTrigger(CUV)
				set X2O = G2X(X1O, ZWX, GTX)
				if X2O == null and H_X(ZWX)!= 0 then
					set HWX = UnitAddItemById(ZWX, Q2)
					set X3O = HWX
					call SetItemPlayer(HWX, X1O, false)
					call SetItemUserData(HWX, 1)
					call SetItemCharges(HWX, HUX)
				elseif X2O == null and H_X(ZWX)== 0 then
					call InterfaceErrorForPlayer(p, GetObjectName('n02O'))
					call HYX(PowerUpItemTypeId[(GTX)],(((LoadReal(HY, h, 6)))* 1.),(((LoadReal(HY, h, 7)))* 1.),(X1O),(true),(HUX))
				else
					call SetItemCharges(X2O, HUX + GetItemCharges(X2O))
				endif
				call EnableTrigger(CUV)
			endif
		elseif X0O then
			call EJO(X1O, ZWX, null, GTX, LoadReal(HY, h, 6), LoadReal(HY, h, 7), HUX, 1)
		elseif X0O == false and(GetItemType(C1X)== ITEM_TYPE_PERMANENT or GetItemType(C1X)== ITEM_TYPE_CAMPAIGN) then
			call SetItemUserData(C1X, 1)
			set X4O = ECO(X1O, ZWX, 0)
		endif
		if X4O == false and X3O != null and H8X(X3O)== false then
			set X4O = XYO(ZWX, X3O)
		endif
		if X4O == false and X3O != null and H8X(X3O)== false then
			call XLO(ZWX, X3O)
		endif
	else
		if GetWidgetLife(C1X)> 0 then
			set Z2 = C1X
			if HFX(C1X) then
				call HDX(ZWX, true)
			endif
			if GetItemUserData(C1X)==-500 then
				call RemoveItem(C1X)
			elseif IsItemOwned(C1X)== false then
				if GetItemType(C1X)== ITEM_TYPE_ARTIFACT or HHX(GTX) or GTX == R_V or GTX == RYV or GTX == R0V or GTX == it_jys then
					set HTX = true
				endif
				call HYX(PowerUpItemTypeId[GTX], GetItemX(C1X), GetItemY(C1X), X1O, HTX, HUX)
				call HZX(C1X)
			endif
		endif
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call EnableTrigger(C3V)
	set t = null
	set C1X = null
	set ZWX = null
	set p = null
	set X1O = null
	set HWX = null
	set X2O = null
	set X3O = null
	return false
endfunction 
// 回音战刃攻击
function GetEchoSaber takes nothing returns nothing
	call RegisterUnitAttackEvent("EchoSaber_DE", DE_SH)
endfunction
// 静谧之鞋
function GetTranquilBoots takes nothing returns nothing
	call RegisterUnitAttackEvent("TranquilBoots_DE", DE_NONE)	
endfunction
//雷神之锤and漩涡
function GetChainLightning takes nothing returns nothing
	call RegisterUnitAttackEvent("ChainLightning_DE", DE_SH_TE_NM_NS_NW)	
endfunction
// 净魂之刃
function GetDiffusalBlade takes nothing returns nothing
	set HaveDiffusalBlade = true
	//call RegisterUnitAttackEvent("DiffusalBlade", PHYSICAL_ATTACK_EFFECT)	
endfunction

// 淬毒之珠
function GetOrbOfVenom takes nothing returns nothing
	call RegisterUnitAttackEvent("OrbOfVenom_DE", DE_SH_TE_NS_NW)	
endfunction
// 斯嘉蒂之眼
function GetEyeOfSkadiRecipe takes nothing returns nothing
	call RegisterUnitAttackEvent("EyeOfSkadiRecipe_DE", DE_SH_TE_NS_NW)
endfunction
// 散华
function GetSange takes nothing returns nothing
	call RegisterUnitAttackEvent("SangeCrippleEffect_DE", DE_SH_TE_NS_NW)
endfunction
// 散夜对剑
function GetSangeAndYasha takes nothing returns nothing
	call RegisterUnitAttackEvent("GetSangeAndYashaCrippleEffect_DE", DE_SH_TE_NS_NW)
endfunction



function GetVladmirOffering takes nothing returns nothing
	set HaveVladmirOffering = true
endfunction
function OHO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local player p = LoadPlayerHandle(HY, h, 0)
	local integer TME = GetPlayerId(p)
	local integer goldold = LoadInteger(HY, h, 0)
	local integer Y_E = GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)
	local integer OJO = TEX(LoadInteger(HY, h, 1))/ 2
	if OJO > 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 5, "出售刚刚购入的物品,额外返还  |cfffffa00" + I2S(OJO)+ "|r 金钱.")
		call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)+ OJO)
		call SaveInteger(P,'ITEM', TME, 0)
		call SaveReal(P,'ITEM', TME, .0)
	endif
	call PauseTimer(t)
	call DestroyTimer(t)
	call RemoveSavedHandle(VV,'ITEM', GetPlayerId(p))
	set t = null
endfunction
function OKO takes item it returns boolean
	return RealItemTypeId[UUV(it)]== RealItemTypeId[OFV]
endfunction
function OLO takes player p, item it returns nothing
	local timer t
	local integer Y_E
	local integer TME = GetPlayerId(p)
	if RealItemTypeId[UUV(it)]== LoadInteger(P,'ITEM', TME) and GetGameTime()-LoadReal(P,'ITEM', TME)< 10. and OKO(it)== false and HaveSavedHandle(VV,'ITEM', GetPlayerId(p))== false then
		set t = CreateTimer()
		set Y_E = GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)
		call TimerStart(t, 0, false, function OHO)
		call SavePlayerHandle(HY, GetHandleId(t), 0, p)
		call SaveInteger(HY, GetHandleId(t), 0, Y_E)
		call SaveTimerHandle(VV,'ITEM', GetPlayerId(p), t)
		call SaveInteger(HY, GetHandleId(t), 1, GetItemTypeId(it))
		set t = null
	endif
endfunction

function ManipulatedDragonLance takes unit whichUnit, integer count returns nothing
	if count == 1 then
		call AddUnitAttack1RangeBonus_OnlyRangeAttacker(whichUnit, 140)
	elseif count == 0 then
		call AddUnitAttack1RangeBonus_OnlyRangeAttacker(whichUnit, -140)
	endif
endfunction

function HurricaneThrustSetAttackRange takes unit whichUnit, boolean add returns nothing
	local integer hu = GetHandleId(whichUnit)
	if add then
		if not LoadBoolean(ExtraHT, hu, HTKEY_HURRICANE_THRUST_COUNT) then
			call UnitAddPermanentAbility(whichUnit, 'A3UC')
			call AddUnitAttack1RangeBonus_OnlyRangeAttacker(whichUnit, 90000)
		endif
	else
		if LoadBoolean(ExtraHT, hu, HTKEY_HURRICANE_THRUST_COUNT) then
			call AddUnitAttack1RangeBonus_OnlyRangeAttacker(whichUnit, -90000)
			call UnitRemoveAbility(whichUnit,'A3UC')
			call UnitRemoveAbility(whichUnit,'a3UC')
		endif
	endif
	call SaveBoolean(ExtraHT, hu, HTKEY_HURRICANE_THRUST_COUNT, add)
endfunction


function RemoveHurricaneThrustAction takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit sourceUnit = LoadUnitHandle(HY, h, 0)
	local integer hu = GetHandleId(sourceUnit)

	if LoadBoolean(ExtraHT, hu, HTKEY_HURRICANE_THRUST_COUNT) then
		call UnitRemoveAbility(sourceUnit,'A3UC')
		call UnitRemoveAbility(sourceUnit,'a3UC')
		call HurricaneThrustSetAttackRange(sourceUnit, false)
		call RemoveSavedInteger(ExtraHT, hu, HTKEY_HURRICANE_THRUST_COUNT)
		call RemoveSavedReal(ExtraHT, hu, HTKEY_HURRICANE_THRUST_COUNT)
		call RemoveSavedBoolean(ExtraHT, hu, HTKEY_HURRICANE_THRUST_COUNT)
		call RemoveSavedHandle(ExtraHT, hu, HTKEY_HURRICANE_THRUST_COUNT)
	endif

	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set sourceUnit = null
endfunction
function RemoveHurricaneThrust takes nothing returns nothing
	local integer h = TimerStartSingle(0, function RemoveHurricaneThrustAction)
	call SaveUnitHandle(HY, h, 0, ARSourceUnit[ARI])
endfunction

function HurricaneThrustAttackEffect takes nothing returns nothing
	local integer h = GetHandleId(ARSourceUnit[ARI])
	local integer i = LoadInteger(ExtraHT, h, HTKEY_HURRICANE_THRUST_COUNT)
	if i > 0 then
		if ARTargetUnit[ARI] == LoadUnitHandle(ExtraHT, h, HTKEY_HURRICANE_THRUST_COUNT) then
			if i == 1 then
				call RemoveHurricaneThrust()
			else
				call SaveInteger(ExtraHT, h, HTKEY_HURRICANE_THRUST_COUNT, i -1) // 计数减少
			endif
		endif
	endif
endfunction

function ClearGlobalsGroup takes nothing returns nothing
	set EnumUnitMaximum = 0
endfunction

function GroupAddEnumUnits takes group g returns nothing
	loop
	exitwhen EnumUnitMaximum <= 0
		call GroupAddUnit(g, EnumUnits[EnumUnitMaximum])
		set EnumUnitMaximum = EnumUnitMaximum - 1
	endloop
endfunction

function InsightAuraActions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY,(h), 2))
	local group tempGroup
	local group lastGroup = LoadGroupHandle(HY,(h), 340)
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local unit firstUnit = null
	local integer uh
	local real data = LoadReal(HY, h, 0)

	// 如果单位存活, 开始传染Buff
	if UnitAlive(u) then

		if LoadBoolean(HY, h, 0) then
			call RemoveSavedBoolean(HY, h, 0)
		endif

		set Temp__Player = GetOwningPlayer(u)
		set EnumUnitMaximum = 0
		set tempGroup = LoginGroup(498)
		call GroupEnumUnitsInRange(tempGroup, x, y, 900 + MAX_UNIT_COLLISION, null)
		loop
			set firstUnit = FirstOfGroup(tempGroup)
		exitwhen firstUnit == null
			call GroupRemoveUnit(tempGroup, firstUnit)
			// 友军 存活 非建筑 非守卫
			if IsUnitInRangeXY(firstUnit, x, y, 900) and IsUnitAlly(firstUnit, Temp__Player) and IsAliveNotStrucNotWard(firstUnit) then
				set uh = GetHandleId(firstUnit)
				// 获取目标单位的Buff来源
				if LoadUnitHandle(ExtraHT, uh, 'B0HC')  == null then // 如果没有来源, 则将来源设置为自己.
					call SaveUnitHandle(ExtraHT, uh, 'B0HC', u)
					call AddUnitMagicResistance(firstUnit, data)
				endif
				set EnumUnitMaximum = EnumUnitMaximum + 1
				set EnumUnits[EnumUnitMaximum] = firstUnit
			endif
		endloop
	
		call GroupAddEnumUnits(tempGroup)
		loop
			set firstUnit = FirstOfGroup(lastGroup)
		exitwhen firstUnit == null
			call GroupRemoveUnit(lastGroup, firstUnit)
			if not IsUnitInGroup(firstUnit, tempGroup) then // 如果不在组内 就表示离开了Buff范围
				set uh = GetHandleId(firstUnit)
				if LoadUnitHandle(ExtraHT, uh, 'B0HC') == u then
					call ReduceUnitMagicResistance(firstUnit, data )
					call RemoveSavedHandle(ExtraHT, uh, 'B0HC')
					call RemoveSavedInteger(ExtraHT, uh, 'B0HC')
				endif
			endif
		endloop

		call SaveGroupHandle(HY, h, 340,(tempGroup))
		call LogoutGroup(lastGroup)

	elseif not LoadBoolean(HY, h, 0) then
		call SaveBoolean(HY, h, 0, true)

		// 清空数据
		loop
			set firstUnit = FirstOfGroup(lastGroup)
		exitwhen firstUnit == null
			call GroupRemoveUnit(lastGroup, firstUnit) 
			set uh = GetHandleId(firstUnit)
			if LoadUnitHandle(ExtraHT, uh, 'B0HC') == u then
				call ReduceUnitMagicResistance(firstUnit, data)
				call RemoveSavedHandle(ExtraHT, uh, 'B0HC')
				call RemoveSavedInteger(ExtraHT, uh, 'B0HC')
			endif
		endloop

	endif

	set t = null
	set u = null
	set tempGroup = null
	set lastGroup = null
	return false
endfunction
// 获得 卡德加的洞察烟斗
function AddUnitInsightAura takes unit whichUnit, boolean add returns nothing
	local trigger trig
	local integer h
	local integer uh
	local unit firstUnit = null
	local group lastGroup = null
	local real data = 0.10
	if add then
		set trig = CreateTrigger()
		set h = GetHandleId(trig)
		call TriggerRegisterTimerEvent(trig, .5, true)
		call TriggerAddCondition(trig, Condition(function InsightAuraActions))
		call SaveReal(HY, h, 0, data)
		call SaveUnitHandle(HY,(h), 2,(whichUnit))
		call SaveGroupHandle(HY,(h), 340,(LoginGroup(499)))
		call SaveTriggerHandle(ExtraHT, GetHandleId(whichUnit), 'A406', trig)
		call SingleDebug("获取洞察光环")
	else
		set trig = LoadTriggerHandle(ExtraHT, GetHandleId(whichUnit), 'A406')
		set h = GetHandleId(trig)
		set lastGroup = LoadGroupHandle(HY, h, 340)
		loop
			set firstUnit = FirstOfGroup(lastGroup)
		exitwhen firstUnit == null
			call GroupRemoveUnit(lastGroup, firstUnit) 
			set uh = GetHandleId(firstUnit)
			if LoadUnitHandle(ExtraHT, uh, 'B0HC') == whichUnit then
				call ReduceUnitMagicResistance(firstUnit, data)
				call RemoveSavedHandle(ExtraHT, uh, 'B0HC')
				call RemoveSavedInteger(ExtraHT, uh, 'B0HC')
			endif
		endloop
		call SingleDebug("删除洞察光环")

		call LogoutGroup(lastGroup)
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(trig)
		set firstUnit = null
		set lastGroup = null
	endif
	set trig = null
endfunction

function GetHandleItemCount takes integer h, integer id returns integer
	return LoadInteger(ExtraHT, h, id)
endfunction

function UnitGetItemOnlyEffect takes unit whichUnit, integer id, boolean isPick returns nothing
	local integer h = GetHandleId(whichUnit)
	local integer count = 0
	if id == RealItemTypeId[Item_DragonLance] or id == RealItemTypeId[Item_HurricanePike] then // 魔龙枪和大推推
		set count = GetHandleItemCount(h, RealItemTypeId[Item_DragonLance]) + GetHandleItemCount(h, RealItemTypeId[Item_HurricanePike])
		call ManipulatedDragonLance(whichUnit, count)
	elseif id == RealItemTypeId[Item_KhadgarPipeOfInsight] then // 笛子
		call AddUnitInsightAura(whichUnit, isPick)
	endif
endfunction

function AddUnitItemCount takes unit whichUnit, integer id, integer add returns nothing
	local integer h = GetHandleId(whichUnit)
	local integer count = LoadInteger(ExtraHT, h, id) + add
	call SaveInteger(ExtraHT, h, id, count)
	if count == 1 then
		call UnitGetItemOnlyEffect(whichUnit, id, true)
	endif
endfunction

function ReduceUnitItemCount takes unit whichUnit, integer id, integer reduce returns nothing
	local integer h = GetHandleId(whichUnit)
	local integer count = LoadInteger(ExtraHT, h, id) - reduce
	call SaveInteger(ExtraHT, h, id, count)
	if count == 0 then
		call UnitGetItemOnlyEffect(whichUnit, id, false)
	endif
endfunction

function UnitGetItemActions takes unit whichUnit, item it, boolean isPick returns nothing
	local integer id = GetItemTypeId(it)
	local integer index
	// 不是占位物品, 不是力量提升, 单位存活, 是英雄级单位
	if id != 0 and id != 'I02M' and not IsItemPowerup(it) and ( IsHeroUnitId(GetUnitTypeId(whichUnit)) or IsBearUnit(whichUnit) ) then
		set index = GetItemIndex(it)
		if isPick then

			set ItemsCount[index] = ItemsCount[index] + 1
			call AddUnitItemCount(whichUnit, id, 1)
		else

			set ItemsCount[index] = ItemsCount[index] - 1
			call ReduceUnitItemCount(whichUnit, id, 1)
		endif

		// 魔抗物品
		if not IsUnitIllusion(whichUnit) then // 魔抗物品的魔法抗性并不会施加给幻象单位
			if id == RealItemTypeId[Item_GlimmerCape] or id == RealItemTypeId[Item_PlaneswalkerCloak] then
				if isPick then
					call AddUnitMagicResistance(whichUnit, 0.2)
				else
					call ReduceUnitMagicResistance(whichUnit, 0.2)
				endif
			elseif id == RealItemTypeId[Item_HoodOfDefiance] or id == RealItemTypeId[Item_KhadgarPipeOfInsight] then
				if isPick then
					call AddUnitMagicResistance(whichUnit, 0.3)
				else
					call ReduceUnitMagicResistance(whichUnit, 0.3)
				endif
			endif
		endif

		//call SingleDebug( I2S(GetHandleId(whichUnit)) + "全局计数" + I2S(ItemsCount[index]) + " " + I2S(id) +" " +YDWEId2S(id)+ " 获取物品数量 " + GetObjectName(id) + " " + I2S(GetHandleItemCount(GetHandleId(whichUnit), id)))
	endif

	set whichUnit = null
	set it = null
endfunction

function GetItemEvent takes nothing returns boolean
	local unit whichUnit = GetTriggerUnit()
	if not (IsUnitIllusion(whichUnit) and not UnitAlive(whichUnit)) then
		call UnitGetItemActions(whichUnit, GetManipulatedItem(), GetTriggerEventId()== EVENT_PLAYER_UNIT_PICKUP_ITEM)
	endif
	set whichUnit = null
	return false
endfunction

// 获取装备和丢弃装备
function OMO takes nothing returns boolean
	local item C1X
	local integer X_O
	local unit u = GetTriggerUnit()
	local trigger t
	local integer h
	//local integer scepter_indexid
	//local integer scepter_abilityid
	local integer id
	local integer k
	local item it
	local integer i = GetItemTypeId(GetManipulatedItem())
	set GR[GetPlayerId(GetOwningPlayer(u))]= true
	set id = GetPlayerId(GetOwningPlayer(u))
	// 非镜像 英雄或者熊灵
	if (IsUnitType(u, UNIT_TYPE_HERO) or IsBearUnit(u)) and not IsUnitIllusion(u) then
		if GetTriggerEventId()== EVENT_PLAYER_UNIT_PICKUP_ITEM then
			if i == RealItemTypeId[A5V]or i == RealItemTypeId[RXV]or i == RealItemTypeId[Item_MonkeyKingBar]or i == RealItemTypeId[Item_HeavenHalberd]or i == RealItemTypeId[RJV] or i == RealItemTypeId[ASV] then
				if i == RealItemTypeId[A5V]then
					call EnableEffectByTime(2, 0)
				elseif i == RealItemTypeId[RXV]then
					call EnableEffectByTime(6, 0)
				elseif i == RealItemTypeId[Item_HeavenHalberd]then
					call EnableEffectByTime(3, 0)
				elseif i == RealItemTypeId[RJV]then
					call EnableEffectByTime(5, 0)
				elseif i == RealItemTypeId[Item_MonkeyKingBar] or i == RealItemTypeId[ASV] then
					call EnableEffectByTime(17, 0)
				elseif i == RealItemTypeId[I8V] then
					call EnableEffectByTime(EFFECT_KEY_CRYSTALYS, 0)
				elseif i == RealItemTypeId[AUV] then
					call EnableEffectByTime(EFFECT_KEY_BURIZA_DO_KYANON, 0)
				endif
			endif
			if i == RealItemTypeId[Item_Javelin]then
				set CDV[id]= CDV[id]+ 1
			elseif i == RealItemTypeId[X9V]then
				set HaveBlinkDaggerCount = HaveBlinkDaggerCount + 1
				set CFV[id]= CFV[id]+ 1
			elseif i == RealItemTypeId[Item_MonkeyKingBar]or i == RealItemTypeId[AYV]then
				call ExecuteFunc("GetPassiveStun")
			elseif i == RealItemTypeId[NIV]then
				set CZV = CZV + 1
				set CGV[id]= CGV[id]+ 1
			elseif i == RealItemTypeId[IQV]or(i)== RealItemTypeId[N2V]then
				set CHV[id]= CHV[id]+ 1
				call ExecuteFunc("GetPassiveStun")
			elseif i == RealItemTypeId[A0V]then
				set HaveHeartofTarrasqueCount = HaveHeartofTarrasqueCount + 1
				set C7V[id]= C7V[id]+ 1
			elseif i == RealItemTypeId[APV]then
				set CWV = CWV + 1
				set CJV[id]= CJV[id]+ 1
				call DisableTrigger(CUV)
				set it = CreateItem('I0HM', GetUnitX(u), GetUnitY(u))
				call UnitAddItem(u, it)
				if GetWidgetLife(it)> 0 then
					call RemoveItem(it)
				endif
				set it = null
				call EnableTrigger(CUV)
			elseif i == RealItemTypeId[RNV]then
				set HaveTranquilBootsCount = HaveTranquilBootsCount + 1
				call GetTranquilBoots()
				set C8V[id]= C8V[id]+ 1
			elseif i == RealItemTypeId[RFV]then //玲珑心
				set HaveSpellLifesteal = true
			elseif i == RealItemTypeId[it_hyzr] then
				call GetEchoSaber()
			elseif i == RealItemTypeId[Item_DiffusalBladeLevel1]or i == RealItemTypeId[Item_DiffusalBladeLevel2]or id == RealItemTypeId[Item_DiffusalBladeLevel1_Empty]then
				call GetDiffusalBlade()
			elseif i == RealItemTypeId[A3V]or i == RealItemTypeId[A4V]then
				call GetEyeOfSkadiRecipe()
			elseif i == RealItemTypeId[Item_Sange] or i == RealItemTypeId[Item_SilverEdge] or i == RealItemTypeId[Item_HeavenHalberd] then
				call GetSange()
			elseif i == RealItemTypeId[Item_SangeAndYasha] then
				call GetSangeAndYasha()
			elseif i == RealItemTypeId[XKV]or i == RealItemTypeId[XLV]then
				call GetOrbOfVenom()
			elseif i == RealItemTypeId[NEV]or i == RealItemTypeId[ITV]then	//漩涡and雷神之锤
				call GetChainLightning()
			elseif i == RealItemTypeId[A5V]then
				if HaveSavedHandle(HY, GetHandleId(u),'AIev')== false then
					call UnitAddPermanentAbility(u,'A431')
					call UnitMakeAbilityPermanent(u, true,'AIev')
				endif
			elseif i == RealItemTypeId[NOV]then
				call GetVladmirOffering()
			elseif i == RealItemTypeId[Item_DragonLance] or i == RealItemTypeId[Item_HurricanePike] then //拾取魔龙枪
				if not IsBearUnit(u) then
					if i == RealItemTypeId[Item_HurricanePike] then
						call RegisterUnitAttackEvent("HurricaneThrustAttackEffect", DE_ATTACK_READY_LAUNCHING)
					endif
				endif
			endif
		elseif GetTriggerEventId()== EVENT_PLAYER_UNIT_DROP_ITEM then
			if i == RealItemTypeId[Item_Javelin]then
				set CDV[id]= CDV[id]-1
			elseif i == RealItemTypeId[X9V]then
				set CFV[id]= CFV[id]-1
				set HaveBlinkDaggerCount = HaveBlinkDaggerCount -1
			elseif i == RealItemTypeId[RNV]then
				set C8V[id]= C8V[id]-1
				set HaveTranquilBootsCount = HaveTranquilBootsCount -1
			elseif i == RealItemTypeId[NIV]then
				set CGV[id]= CGV[id]-1
				set CZV = CZV -1
			elseif i == RealItemTypeId[IQV]or(i)== RealItemTypeId[N2V]then
				set CHV[id]= CHV[id]-1
				if CHV[id]< 1 or GZX(u, RealItemTypeId[IQV], GetManipulatedItem())== null or GZX(u, RealItemTypeId[N2V], GetManipulatedItem())== null then
					call UnitRemoveAbility(u,'A174')
				endif
			elseif i == RealItemTypeId[A0V]then
				set C7V[id]= C7V[id]-1
				set HaveHeartofTarrasqueCount = HaveHeartofTarrasqueCount -1
			elseif i == RealItemTypeId[APV]or i == InvalidItemTypeId[APV]then
				set CWV = IMaxBJ(CWV -1, 0)
				set CJV[id]= IMaxBJ(CJV[id]-1, 0)
				call UnitRemoveAbility(u,'B0BI')
			elseif i == RealItemTypeId[A5V]then
				if GZX(u, RealItemTypeId[A5V], GetManipulatedItem())== null then
					call UnitRemoveAbility(u,'A431')
				endif
			endif
		endif
	endif
	if GetTriggerEventId()== EVENT_PLAYER_UNIT_PAWN_ITEM then
		set C1X = GetSoldItem()
		call SetItemUserData(C1X,-2)
		call OLO(GetOwningPlayer(u), C1X)
		set Z2 = C1X
		if HFX(C1X) then
			call HDX(u, true)
		endif
	elseif GetItemTypeId(GetManipulatedItem())!='I02M' then
		set C1X = GetManipulatedItem()
		if IsUnitIllusion(u) or GetItemUserData(C1X)==-2 then
			set C1X = null
			set u = null
			set t = null
			return false
		endif
		if GetTriggerEventId()== EVENT_PLAYER_UNIT_PICKUP_ITEM then
			set X_O = 1
		else
			set X_O = 2
		endif
		if((X_O == 1) or(X_O == 2 and H8X(C1X)== false and GetWidgetLife(C1X)> 0)) and GetUnitTypeId(u)!='H00J' then
			if ZBX(GetItemTypeId(C1X)) or ZNX(GetItemTypeId(C1X)) or GetItemTypeId(C1X)=='I0HM' then
				set C1X = null
				set u = null
				set t = null
				return false
			endif
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call TriggerRegisterTimerEvent(t, 0, false)
			call TriggerAddCondition(t, Condition(function XZO))
			call SaveUnitHandle(HY, h, 26,(u))
			call SaveInteger(HY, h, 97,(X_O))
			call SaveInteger(HY, h, 93,(UUV(C1X)))
			call SaveItemHandle(HY, h, 0, C1X)
			if H8X(C1X) then
				call SaveBoolean(HY, h, 95,(true))
				call SavePlayerHandle(HY, h, 54,(GetItemPlayer(C1X)))
				call SaveInteger(HY, h, 76,(GetItemCharges(C1X)))
				call SaveReal(HY, h, 6,((GetItemX(C1X))* 1.))
				call SaveReal(HY, h, 7,((GetItemY(C1X))* 1.))
				call HZX(C1X)
			else
				call SaveBoolean(HY, h, 95,(false))
				call SaveItemHandle(HY, h, 96,(C1X))
				call SetItemUserData(C1X, 0)
			endif
		endif
	endif
	set C1X = null
	set u = null
	set t = null
	return false
endfunction
function OQO takes unit triggerUnit, integer OSO, boolean OTO returns nothing
	local string OUO
	local string s
	local player p = GetOwningPlayer(triggerUnit)
	local real d = 2
	local string OWO = "Use"
	if OTO then
		set OWO = "Store"
	endif
	if OSO =='I006'or OSO == ZIX('I006') then
		set OUO = "|c00ff0000" + GetObjectName('n0JQ')+ "|r"
		call JSX("Rune" + OWO + "1", GetPlayerId(p))
	elseif OSO =='I008'or OSO == ZIX('I008') then
		set OUO = "|c0000ff00" + GetObjectName('n0JN')+ "|r"
		call JSX("Rune" + OWO + "2", GetPlayerId(p))
	elseif OSO =='I00K'or OSO == ZIX('I00K') then
		set OUO = "|c000000ff" + GetObjectName('n0K3')+ "|r"
		call JSX("Rune" + OWO + "3", GetPlayerId(p))
	elseif OSO =='I007'or OSO == ZIX('I007') then
		set OUO = "|c00afaf00" + GetObjectName('n0K2')+ "|r"
		call JSX("Rune" + OWO + "4", GetPlayerId(p))
	elseif OSO =='I00J'or OSO == ZIX('I00J') then
		set OUO = "|c00652DC1" + GetObjectName('n0K4')+ "|r"
		call JSX("Rune" + OWO + "5", GetPlayerId(p))
	elseif OSO =='I0QA'or OSO == ZIX('I0QA') then
		set OUO = "|c00ffff01" + "赏金神符" + "|r"
		call JSX("Rune" + OWO + "6", GetPlayerId(p))
	endif
	if OTO then
		set s = JS[GetPlayerId(p)]+ GetUnitName(triggerUnit)+ "|r " + GetObjectName('n0GU')+ "|r " + OUO + " " + GetObjectName('n0GW')
		set d = 1
	else
		if C2V then
			set s = JS[GetPlayerId(p)]+ GetUnitName(triggerUnit)+ "|r " + GetObjectName('n0GV')+ "|r " + OUO + " " + GetObjectName('n0GW')
		else
			set s = JS[GetPlayerId(p)]+ GetUnitName(triggerUnit)+ "|r " + GetObjectName('n0GT')+ "|r " + OUO + " " + GetObjectName('n0GW')
		endif
	endif
	if(IsPlayerAlly(LocalPlayer, p) and LocalPlayer!= p) or IsObserver or JE then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, d, s)
	endif
	set p = null
endfunction
function OYO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit WLE = LoadUnitHandle(HY, h, 0)
	local integer GFX = LoadInteger(HY, h, 0)
	local real OZO = LoadReal(HY, h, 0)
	local real O_O = LoadReal(HY, h, 1)
	local real WLV = LoadReal(HY, h, 2)
	if UnitAlive(WLE) and GetUnitAbilityLevel(WLE, GFX)> 0 then
		if O_O > 0 then
			call SetUnitState(WLE, UNIT_STATE_MANA, GetUnitState(WLE, UNIT_STATE_MANA)+ O_O / WLV * .1)
		endif
		if OZO > 0 and OYX(WLE)== false then
			call SetWidgetLife(WLE, GetWidgetLife(WLE)+ OZO / WLV * .1)
		endif
	else
		call SaveBoolean(P, GetHandleId(WLE), GFX, false)
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	endif
	set t = null
	set WLE = null
endfunction
function O0O takes real hp, real mp, real SYV, integer GFX, unit WLE returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .1, true, function OYO)
	call SaveUnitHandle(HY, h, 0, WLE)
	call SaveBoolean(P, GetHandleId(WLE), GFX, true)
	call SaveInteger(HY, h, 0, GFX)
	call SaveReal(HY, h, 0, hp)
	call SaveReal(HY, h, 1, mp)
	call SaveReal(HY, h, 2, SYV)
	set t = null
endfunction
function O1O takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit WLE = LoadUnitHandle(HY, h, 0)
	local integer O2O = LoadInteger(HY, h, 1)
	local integer GFX = LoadInteger(HY, h, 0)
	local real O3O = LoadReal(HY, h, 0)
	local real WLV = LoadReal(HY, h, 1)
	if UnitAlive(WLE) and GetUnitAbilityLevel(WLE, GFX)> 0 then
		if O2O =='00MP' then
			call SetUnitState(WLE, UNIT_STATE_MANA, GetUnitState(WLE, UNIT_STATE_MANA)+ O3O / WLV * .1)
		elseif O2O =='00HP' then
			if OYX(WLE)== false then
				call SetWidgetLife(WLE, GetWidgetLife(WLE)+ O3O / WLV * .1)
			endif
		endif
	else
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	endif
	set t = null
	set WLE = null
endfunction
function SmoothHealingSystem takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local unit WLE = GetSpellTargetUnit()
	call TimerStart(t, .1, true, function O1O)
	call SaveUnitHandle(HY, h, 0, WLE)
	if GetSpellAbilityId()=='AIpl' or GetSpellAbilityId()=='A1WA' then
		call SaveInteger(HY, h, 0,'BIrm')
		call SaveInteger(HY, h, 1,'00MP')
		call SaveReal(HY, h, 0,$AA)
		call SaveReal(HY, h, 1, 45)
	else
		call SaveInteger(HY, h, 0,'B02Z')
		call SaveInteger(HY, h, 1,'00HP')
		call SaveReal(HY, h, 0, 400)
		call SaveReal(HY, h, 1, 10)
	endif
	set t = null
	set WLE = null
endfunction
function O4O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	if GetUnitAbilityLevel(triggerUnit,'B01S')== 0 or(GetWidgetLife(triggerUnit)== GetUnitState(triggerUnit, UNIT_STATE_MAX_LIFE) and GetUnitState(triggerUnit, UNIT_STATE_MANA)== GetUnitState(triggerUnit, UNIT_STATE_MAX_MANA)) then
		call UnitRemoveAbility(triggerUnit,'B01S')
		call UnitRemoveAbility(triggerUnit,'B04A')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set triggerUnit = null
	return false
endfunction
function UseRegenerationRune takes unit triggerUnit, item C1X returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function O4O))
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	set t = null
	if LoadBoolean(P, GetHandleId(triggerUnit),'B01S')== false then
		call O0O($BB8,$7D0, 30,'B01S', triggerUnit)
	endif
endfunction
function UseIllusionRune takes unit triggerUnit returns nothing
	local unit illusionUnit = null
	local real dataB = 0.33
	local real dataC = 3.
	local real dur = 75.
	local string targetArt = "Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl"
	
	set illusionUnit = SummonIllusion(triggerUnit, triggerUnit, dur, dataB, dataC, dur, targetArt)

	set illusionUnit = SummonIllusion(triggerUnit, triggerUnit, dur, dataB, dataC, dur, targetArt)

	set illusionUnit = null
endfunction
function O7O takes nothing returns nothing
	local unit O8O = LoadUnitHandle(HY, 690, 1)
	local integer O9O = 0
	local timer t = GetExpiredTimer()
	loop
	exitwhen O9O > 6
		if GetItemTypeId(UnitItemInSlot(O8O, O9O))== 0 then
			call UnitRemoveItemFromSlot(O8O, O9O)
		endif
		set O9O = O9O + 1
	endloop
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set O8O = null
endfunction
function UseBountyRune takes unit u returns nothing
	local integer m = IMaxBJ(0, R2I((GetGameTime()-WQ)/ 60))
	local integer g
	local integer xp
	if NV then
		set g = 100 
		set xp = 100 
	else
		set g = m * 2 + 50
		set xp = m * 5 + 50
	endif
	if GetUnitAbilityLevel(u,'B00X')!= 0 then
		set g = R2I(g *(GetUnitAbilityLevel(u,'A0O3')* .5 + 2.5))
	endif
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\ResourceItems\\ResourceEffectTarget.mdl", u, "origin"))
	call BMX(GetOwningPlayer(u), u, g)
	if IsUnitType(u, UNIT_TYPE_HERO) then
		call AddHeroXPSimple(u, xp, true)
	endif
endfunction
function REO takes unit u, integer id returns nothing
	local item it = CreateItem(ZAX(id), GetUnitX(u), GetUnitY(u))
	if UnitAddItem(u, it) and GetWidgetLife(it)<= 0 then
	else
		call RemoveItem(it)
	endif
	set it = null
endfunction
function RXO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 26))
	local integer ROO =(LoadInteger(HY, h, 98))
	local item C1X = UnitItemInSlot(u, ROO)
	local integer RRO =(LoadInteger(HY, h,'i'))
	local item RIO
	local integer JNX
	local integer id
	local integer TZE = UUV(C1X)
	if C1X != null and GUX(TZE) and GetHandleId(C1X)== RRO and UnitAlive(u) and UnitAlive(u) then
		set id = GWX(TZE)
		set JNX = B2X(u, C1X)
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		set Z2 = JIX(u, RealItemTypeId[O2V], JNX)
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UZV(u, id)
	endif
	set t = null
	set u = null
	set C1X = null
	set RIO = null
	return false
endfunction
function RAO takes unit u, item RIO returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer ROO = B2X(u, RIO)
	call SaveInteger(HY, h, 98,(ROO))
	call SaveInteger(HY, h,'i',(GetHandleId(RIO)))
	call SaveUnitHandle(HY, h, 26,(u))
	call TriggerRegisterTimerEvent(t, 120, true)
	call TriggerAddCondition(t, Condition(function RXO))
	set t = null
endfunction
function RNO takes integer JAX returns integer
	if JAX =='I006' then
		return O5V
	elseif JAX =='I008' then
		return O6V
	elseif JAX =='I00J' then
		return O3V
	elseif JAX =='I00K' then
		return O4V
	elseif JAX =='I007' then
		return O7V
	elseif JAX =='I0QA' then
		return O8V
	endif
	return -1
endfunction
function UseDoubleDamageRune takes unit u returns nothing
	call AddAbilityToTimed(u,'A3FL', 1, 45,'B01P')
	call UnitMakeAbilityPermanent(u, true,'A3FK')
	call SetAllPlayerAbilityUnavailable('A3FL')
endfunction
function RCO takes unit triggerUnit, item C1X returns nothing
	local item it
	local integer i
	local integer k
	local boolean borrowed = false
	if ZNX(GetItemTypeId(C1X)) then
		set it = GetItemOfTypeFromUnit(triggerUnit, RealItemTypeId[O_V])
		if it == null then
			set it = GetItemOfTypeFromUnit(triggerUnit, RealItemTypeId[O0V])
		endif
		if it == null then
			set it = GetItemOfTypeFromUnit(triggerUnit, RealItemTypeId[O1V])
		endif
		if it == null then
			set it = GetItemOfTypeFromUnit(triggerUnit, RealItemTypeId[O2V])
		endif
		if it == null then
			set it = GetItemOfTypeFromUnit(triggerUnit, InvalidItemTypeId[O_V])
		endif
		if it == null then
			set it = GetItemOfTypeFromUnit(triggerUnit, InvalidItemTypeId[O0V])
		endif
		if it == null then
			set it = GetItemOfTypeFromUnit(triggerUnit, InvalidItemTypeId[O1V])
		endif
		if it == null then
			set it = GetItemOfTypeFromUnit(triggerUnit, InvalidItemTypeId[O2V])
		endif
		if it != null then
			if XI[GetPlayerId(GetOwningPlayer(triggerUnit))]== false then
				set i = B2X(triggerUnit, it)
				set k = RNO(ZAX(GetItemTypeId(C1X)))
				call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl", triggerUnit, "overhead"))
				set E3 = GetItemPlayer(it)
				call HZX(it)
				call DisableTrigger(CUV)
				if GetOwningPlayer(triggerUnit)== E3 then
					set Z2 = JIX(triggerUnit, RealItemTypeId[k], i)
				else
					set Z2 = JIX(triggerUnit, InvalidItemTypeId[k], i)
				endif
				call EnableTrigger(CUV)
				call SetItemPlayer(Z2, E3, false)
				call SetItemUserData(Z2, 1)
				set it = UnitItemInSlot(triggerUnit, i)
				call RAO(triggerUnit, it)
				call OQO(triggerUnit, GetItemTypeId(C1X), true)
			else
				set i = B2X(triggerUnit, it)
				set k = O2V
				call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl", triggerUnit, "overhead"))
				set E3 = GetItemPlayer(it)
				call HZX(it)
				call DisableTrigger(CUV)
				if GetOwningPlayer(triggerUnit)== E3 then
					set Z2 = JIX(triggerUnit, RealItemTypeId[k], i)
				else
					set Z2 = JIX(triggerUnit, InvalidItemTypeId[k], i)
				endif
				call EnableTrigger(CUV)
				call SetItemPlayer(Z2, E3, false)
				call SetItemUserData(Z2, 1)
				call REO(triggerUnit, GetItemTypeId(C1X))
			endif
		else
			call REO(triggerUnit, GetItemTypeId(C1X))
		endif
	elseif ZBX(GetItemTypeId(C1X)) then
		call OQO(triggerUnit, GetItemTypeId(C1X), false)
	endif
	if GetItemTypeId(C1X)=='I007' then
		call UseIllusionRune(triggerUnit)
	elseif GetItemTypeId(C1X)=='I0QA' then
		call UseBountyRune(triggerUnit)
	elseif GetItemTypeId(C1X)=='I00J' then
		if GetUnitAbilityLevel(triggerUnit,'B09Y')> 0 then
			call UnitRemoveAbility(triggerUnit,'B09Y')
			call UnitRemoveAbility(triggerUnit,'B01Q')
			call DisableTrigger(GetTriggeringTrigger())
			call UnitAddItemById(triggerUnit,'I00J')
			call EnableTrigger(GetTriggeringTrigger())
		endif
	elseif GetItemTypeId(C1X)=='I008' then
		call UseRegenerationRune(triggerUnit, C1X)
	elseif GetItemTypeId(C1X)=='I00K' then
		call UseDoubleDamageRune(triggerUnit)
	endif
	set it = null
endfunction
function RDO takes item C1X, unit WUE, boolean RFO returns nothing
	local integer GTX = UUV(C1X)
	local integer h = GetHandleId(WUE)
	local string s = ""
	// 宝石
	if(GTX == X4V and GZX(WUE, X4V, C1X)== null) or(GTX == X5V and GZX(WUE, X5V, C1X)== null) then
		if IsPlayerAlly(LocalPlayer, GetOwningPlayer(WUE)) or IsObserver then
			set s = "Abilities\\Spells\\Human\\MagicSentry\\MagicSentryCaster.mdl"
		endif
		if RFO then
			if H_X(WUE)> 0 or GetItemType(C1X)== ITEM_TYPE_PERMANENT or GetItemType(C1X)== ITEM_TYPE_CAMPAIGN then
				if GetUnitAbilityLevel(WUE,'A26A')== 0 and GetUnitAbilityLevel(WUE,'A26B')== 0 then
					if s == "Abilities\\Spells\\Human\\MagicSentry\\MagicSentryCaster.mdl" then
						call UnitAddPermanentAbility(WUE,'A26A')
					else
						call UnitAddPermanentAbility(WUE,'A26B')
					endif
				endif
			endif
		else
			if not(GetUnitAbilityLevel(WUE,'A26A')== 0 and GetUnitAbilityLevel(WUE,'A26B')== 0) then
				call UnitRemoveAbility(WUE,'A26B')
				call UnitRemoveAbility(WUE,'A26A')
				call RemoveSavedHandle(HY, h, 670)
			endif
		endif
	endif
endfunction
function RGO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer i = 0
	local integer k = UnitInventorySize(u)
	local item it
	local integer TME = GetPlayerId(GetOwningPlayer(u))
	call RemoveSavedHandle(HY, GetHandleId(u),'INVR')
	call DestroyTimer(t)
	loop
		set it = UnitItemInSlot(u, i)
		if it != null then
			call JSX("LoD_INV_" + I2S(TME), GetItemTypeId(it))
		endif
		set i = i + 1
	exitwhen i > k
	endloop
	set it = null
	set t = null
	set u = null
endfunction
function RHO takes unit u returns nothing
	local timer t
	local integer h
	local integer hu = GetHandleId(u)
	if GV == false then
		return
	endif
	if not HaveSavedHandle(HY, hu,'INVR') then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveTimerHandle(HY, hu,'INVR', t)
		call TimerStart(t, .1, false, function RGO)
		call SaveUnitHandle(HY, h, 0, u)
		set t = null
	else
		call TimerStart(LoadTimerHandle(HY, hu,'INVR'), .1, false, function RGO)
	endif
endfunction

function RJO takes nothing returns boolean
	local unit whichUnit = GetTriggerUnit()
	local item whichItem = GetManipulatedItem()
	local integer id = GetItemTypeId(whichItem)
	if whichItem == null or IsUnitIllusion(whichUnit) or not IsUnitType(whichUnit, UNIT_TYPE_HERO) or GetItemTypeId(whichItem)=='I02M' then
		set whichUnit = null
		set whichItem = null
		return false
	endif
	if UUV(whichItem)> 0 then
		if(GetTriggerEventId()== EVENT_PLAYER_UNIT_DROP_ITEM and GetItemType(whichItem)!= ITEM_TYPE_PURCHASABLE) or GetTriggerEventId()== EVENT_PLAYER_UNIT_PAWN_ITEM then
			call RDO(whichItem, whichUnit, false)
			call JSX("DRI_" + I2S(GetPlayerId(GetOwningPlayer(whichUnit))), RealItemTypeId[GSX(UUV(whichItem))])
			call RHO(whichUnit)
		elseif GetTriggerEventId()== EVENT_PLAYER_UNIT_PICKUP_ITEM then
			call RDO(whichItem, whichUnit, true)
			call JSX("PUI_" + I2S(GetPlayerId(GetOwningPlayer(whichUnit))), RealItemTypeId[GSX(UUV(whichItem))])
			call RHO(whichUnit)
		endif
	endif
	set whichUnit = null
	set whichItem = null
	return false
endfunction

function RKO takes player p, integer RLO, integer id, real x, real y returns nothing
	local item it = CreateItem(PowerUpItemTypeId[id], x, y)
	call SetItemPlayer(it, p, false)
	call SetItemUserData(it, RLO)
	set it = null
endfunction
function DisassembleItems takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local item it
	local integer i = 0
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local integer TZE
	local player p
	call DisableTrigger(CUV)
	loop
	exitwhen i > 5
		set it = UnitItemInSlot(u, i)
		set TZE = UUV(it)
		set p = GetItemPlayer(it)
		if TZE == IEV then
			call RemoveItem(it)
			call RKO(p, 1, OFV, x, y)
			call RKO(p, 1, OWV, x, y)
		elseif TZE == IRV or TZE == IIV then
			call RemoveItem(it)
			call RKO(p, 1, OGV, x, y)
			call RKO(p, 1, OMV, x, y)
		elseif TZE == NGV or TZE == NHV then
			call RemoveItem(it)
			call RKO(p, 1, OBV, x, y)
			call RKO(p, 1, OIV, x, y)
			call RKO(p, 1, B_V, x, y)
		elseif(TZE)== NEV then
			call RemoveItem(it)
			call RKO(p, 1, X7V, x, y)
			call RKO(p, 1, ITV, x, y)
			call RKO(p, 1, B3V, x, y)
		elseif TZE == NZV then
			call RemoveItem(it)
			call RKO(p, 1, XMV, x, y)
			call RKO(p, 1, X2V, x, y)
		elseif TZE == I_V or TZE == I0V then
			call RemoveItem(it)
			call RKO(p, 1, X6V, x, y)
			call RKO(p, 1, OXV, x, y)
		elseif TZE == ANV or TZE == ABV then
			call RemoveItem(it)
			call RKO(p, 1, IMV, x, y)
			call RKO(p, 1, OTV, x, y)
			call RKO(p, 1, BGV, x, y)
		elseif TZE == ROV then
			call RemoveItem(it)
			call RKO(p, 1, X1V, x, y)
			call RKO(p, 1, Item_GhostScepter, x, y)
		elseif TZE == Item_SangeAndYasha then
			call RemoveItem(it)
			call RKO(p, 1, Item_Sange, x, y)
			call RKO(p, 1, IMV, x, y)
		elseif TZE == RUV or TZE == RWV then
			call RemoveItem(it)
			call RKO(p, 1, IKV, x, y)
			call RKO(p, 1, IRV, x, y)
		elseif TZE == N2V then
			call RemoveItem(it)
			call RKO(p, 1, IQV, x, y)
			call RKO(p, 1, OKV, x, y)
		elseif TZE == RJV then
			call RemoveItem(it)
			call RKO(p, 1, N_V, x, y)
			call RKO(p, 1, RXV, x, y)
		elseif TZE == Item_GlimmerCape then
			call RemoveItem(it)
			call RKO(p, 1, Item_PlaneswalkerCloak, x, y)
			call RKO(p, 1, XGV, x, y)
		elseif TZE == RGV then
			call RemoveItem(it)
			call RKO(p, 1, RHV, x, y)
			call RKO(p, 1, XZV, x, y)
			call RKO(p, 1, XZV, x, y)
			call RKO(p, 1, IEV, x, y)
		elseif TZE == Item_HeavenHalberd then
			call RemoveItem(it)
			call RKO(p, 1, Item_Sange, x, y)
			call RKO(p, 1, RXV, x, y)
		elseif TZE == Item_MoonShard then
			call RemoveItem(it)
			call RKO(p, 1, X7V, x, y)
			call RKO(p, 1, X7V, x, y)
		elseif TZE == IBV or TZE == IDV or TZE == ICV then
			call RemoveItem(it)
			call RKO(p, 1, XMV, x, y)
			call RKO(p, 1, XPV, x, y)
			if TZE == IBV then
				call RKO(p, 1, XQV, x, y)
			elseif TZE == ICV then
				call RKO(p, 1, XTV, x, y)
			else
				call RKO(p, 1, OJV, x, y)
			endif
		endif
		set i = i + 1
	endloop
	call EnableTrigger(CUV)
	set u = null
	set it = null
endfunction
function RPO takes nothing returns boolean
	if GetSpellAbilityId()=='A0K5' or GetSpellAbilityId()=='A1RF' then
		call DisassembleItems()
	endif
	return false
endfunction
function RQO takes integer GTX returns boolean
	return GTX != ASV and GTX != NIV and GTX != X4V and GTX != AIV
endfunction
function RSO takes nothing returns nothing
	if GetTriggerEventId()== EVENT_PLAYER_UNIT_PICKUP_ITEM then
		call SetItemPawnable(GetManipulatedItem(), false)
	else
		call SetItemPawnable(GetManipulatedItem(), true)
	endif
endfunction
function RTO takes nothing returns boolean
	if GetItemType(GetManipulatedItem())== ITEM_TYPE_PERMANENT and RQO(GetItemIndex(GetManipulatedItem())) and IsMessengerUnit(GetTriggerUnit()) then
		call RSO()
	endif
	return false
endfunction
function RUO takes nothing returns nothing
	local integer x = 1
	local player p
	loop
	exitwhen x > 16
		if GetItemOfTypeFromUnit(Player__Hero[x], RealItemTypeId[NIV])!= null then
		endif
		set x = x + 1
	endloop
	set p = null
endfunction
function RWO takes nothing returns boolean
	return(IsUnitAlly(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()))!= null
endfunction
function RYO takes unit u returns nothing
	local group g = LoginGroup(20)
	local unit u2
	local real r = 500 + 30 * GetItemCharges(GetItemOfTypeFromUnit(u, RealItemTypeId[NIV]))
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u),$6A4, Condition(function RWO))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call SetWidgetLife(u2, GetWidgetLife(u2)+ r)
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\BloodstoneHealTarget.mdx", u2, "origin"))
		call GroupRemoveUnit(g, u2)
	endloop
	call LogoutGroup(g)
	set g = null
	set u2 = null
endfunction
function RZO takes unit triggerUnit returns nothing
	call RYO(triggerUnit)
endfunction
function R_O takes nothing returns nothing
	if GetItemOfTypeFromUnit(GetTriggerUnit(), RealItemTypeId[NIV])!= null then
		call RZO(GetTriggerUnit())
	endif
endfunction
function R0O takes unit u returns nothing
	local integer c = GetItemCharges(GetItemOfTypeFromUnit(u, RealItemTypeId[NIV]))
	if c > 0 then
		call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ c)
	endif
endfunction
function R1O takes nothing returns boolean
	local integer i = 1
	local unit triggerUnit
	local integer id
	if CZV > 0 then
		loop
		exitwhen i > 5
			set id = GetPlayerId(Sentinels[i])
			set triggerUnit = Player__Hero[id]
			if CGV[id]> 0 and triggerUnit != null and UnitAlive(triggerUnit) then
				call R0O(triggerUnit)
			endif
			set id = GetPlayerId(Scourges[i])
			set triggerUnit = Player__Hero[id]
			if CGV[id]> 0 and triggerUnit != null and UnitAlive(triggerUnit) then
				call R0O(triggerUnit)
			endif
			set i = i + 1
		endloop
	endif
	set triggerUnit = null
	return false
endfunction
function ObsWardAttacked takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer c = LoadInteger(HY, h, 0)
	if GetTriggerEventId()== EVENT_PLAYER_UNIT_ATTACKED then
		if GetUnitTypeId(GetTriggerUnit())=='oeye' or GetUnitTypeId(GetTriggerUnit())=='o004' then
			call UnitAddPermanentAbility(GetAttacker(),'A3AW')
			//call UnitMakeAbilityPermanent(GetAttacker(), true,'A3AV')
		elseif GetUnitAbilityLevel(GetAttacker(),'A3AV')> 0 then
			//call UnitRemoveAbility(GetAttacker(),'A3AW')
		endif
	else
		call SaveInteger(HY, h, 0, IMaxBJ(c -1, 0))
		if LoadInteger(HY, h, 0)< 1 then
			call DisableTrigger(t)
		endif
	endif
	set t = null
	return false
endfunction
function R2O takes unit R3O, unit R4O returns nothing
	local string s = ""
	local string s2 = "items\\wards\\"
	local string s3 = "war3mapImported\\"
	if GetUnitTypeId(R3O)=='oeye'then
		set s2 = s2 + "SentryWard.mdx"
		set s3 = s3 + "EnemySentryWardMark.mdx"
	else
		set s2 = s2 + "ObserverWard.mdx"
		set s3 = s3 + "EnemyObserverWardMark.mdx"
	endif
	if IsPlayerEnemy(LocalPlayer, GetOwningPlayer(R4O)) and IsObserver== false then
		set s = s3
		set s2 = ""
	endif
	call AddSpecialEffectTarget(s, R3O, "origin")
	call AddSpecialEffectTarget(s2, R3O, "origin")
endfunction
function R5O takes nothing returns nothing
	local unit u = GetSummonedUnit()
	local unit WJE = GetSummoningUnit()
	local integer WPV = GetUnitTypeId(u)
	local integer i
	if WPV =='osp4' or WPV =='o008' or WPV =='o009' or WPV =='o01C' or WPV =='o01D' or WPV =='o01E' then
		call W1E(u)
	elseif WPV =='o000' or WPV =='o001' or WPV =='o00A' or WPV =='o00X' then
		call W1E(u)
	endif
	set u = null
	set WJE = null
endfunction
function R6O takes nothing returns nothing
	local unit u = GetEnumUnit()
	local integer i = 0
	local player p = GetOwningPlayer(GetTriggerUnit())
	local item C1X
	local integer id = GetPlayerId(p)
	loop
	exitwhen i > 5
		set C1X = UnitItemInSlot(u, i)
		if C1X != null and GetItemPlayer(C1X)== p then
			call UnitRemoveItem(u, C1X)
			call SetItemPosition(C1X, VHV[id], VJV[id])
		endif
		set i = i + 1
	endloop
	set u = null
	set p = null
	set C1X = null
endfunction
function R7O takes nothing returns nothing
	local item C1X = GetEnumItem()
	local unit u = C4V
	local player p = GetOwningPlayer(u)
	local integer id = GetPlayerId(p)
	if GetWidgetLife(C1X)> 0 and GetItemPlayer(C1X)== p then
		call SetItemPosition(C1X, VHV[id], VJV[id])
		call UnitAddItem(Circle[id], C1X)
	endif
	set C1X = null
	set u = null
	set p = null
endfunction
function R8O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 53))
	set C4V = u
	if IsSentinelsPlayer(GetOwningPlayer(C4V)) then
		call EnumItemsInRect(O0, TrueBoolexprCondition, function R7O)
	else
		call EnumItemsInRect(R0, TrueBoolexprCondition, function R7O)
	endif
	if GetTriggerEvalCount(t)== 2 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	return false
endfunction
function R9O takes nothing returns boolean
	return IsMessengerUnit(GetFilterUnit())
endfunction

function G7E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer i = 0
	local group g = LoginGroup(21)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u),$514, Condition(function R9O))
	call ForGroup(g, function R6O)
	call LogoutGroup(g)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function R8O))
	call SaveUnitHandle(HY, h, 53,(u))
	set u = null
	set g = null
	set t = null
endfunction
function G6E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer i = 0
	local item C1X
	local integer id = GetPlayerId(GetOwningPlayer(u))
	local region r = CreateRegion()
	if IsSentinelsPlayer(GetOwningPlayer(u)) then
		call RegionAddRect(r, O0)
	else
		call RegionAddRect(r, R0)
	endif
	loop
	exitwhen i > 5
		set C1X = UnitItemInSlot(u, i)
		if GUX(UUV(C1X))== false and UUV(C1X)!= AIV then
			call UnitRemoveItemFromSlot(u, i)
			if(GetUnitTypeId(u)=='ncop' or IsUnitInRegion(r, u)) and IsPlayerAlly(GetItemPlayer(C1X), GetOwningPlayer(u)) then
				set id = GetPlayerId(GetItemPlayer(C1X))
				call SetItemPosition(C1X, VHV[id], VJV[id])
			endif
		endif
		set i = i + 1
	endloop
	call RemoveRegion(r)
	set u = null
	set C1X = null
	set r = null
endfunction


function IOO takes unit triggerUnit returns nothing
	local integer i = 0
	local item IRO
	local integer GTX
	local boolean IIO = false
	if(LoadReal(HY, GetHandleId(triggerUnit), 730) + 13) > (GetGameTime() ) then
		set IIO = true
	endif
	loop
	exitwhen i > 5
		set IRO = UnitItemInSlot(triggerUnit, i)
		set GTX = GetItemIndex(IRO)
		if GTX == RNV and IIO then
			call DisableTrigger(CUV)
			set E3 = GetItemPlayer(IRO)
			call RemoveItem(IRO)
			set Z2 = JIX(triggerUnit, RealItemTypeId[RBV], i)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			call EnableTrigger(CUV)
		endif
		if GTX == RBV and IIO == false then
			call DisableTrigger(CUV)
			set E3 = GetItemPlayer(IRO)
			call RemoveItem(IRO)
			set Z2 = JIX(triggerUnit, RealItemTypeId[RNV], i)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			call EnableTrigger(CUV)
		endif
		set i = i + 1
	endloop
	set triggerUnit = null
	set IRO = null
endfunction

function IAO takes unit triggerUnit returns nothing
	local integer i = 0
	local item INO
	local integer GTX
	local boolean IBO = false
	local real cd = 4
	if IsUnitType(triggerUnit, UNIT_TYPE_MELEE_ATTACKER)== false then
		set cd = 6
	endif
	if(LoadReal(HY, GetHandleId(triggerUnit), 785) ) + cd > GetGameTime() then
		set IBO = true
	endif
	loop
	exitwhen i > 5
		set INO = UnitItemInSlot(triggerUnit, i)
		set GTX = GetItemIndex(INO)
		if GTX == A0V and IBO then
			call DisableTrigger(CUV)
			set E3 = GetItemPlayer(INO)
			call RemoveItem(INO)
			set Z2 = JIX(triggerUnit, RealItemTypeId[A1V], i)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			call EnableTrigger(CUV)
		endif
		if GTX == A1V and IBO == false then
			call DisableTrigger(CUV)
			set E3 = GetItemPlayer(INO)
			call RemoveItem(INO)
			set Z2 = JIX(triggerUnit, RealItemTypeId[A0V], i)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			call EnableTrigger(CUV)
		endif
		set i = i + 1
	endloop
	set triggerUnit = null
	set INO = null
endfunction



function IFO takes unit u, item it, integer JOX returns nothing
	local integer i
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	set E3 = GetItemPlayer(it)
	call RemoveItem(it)
	call UnitAddAbility(d,'AInv')
	set it = UnitAddItemById(d, RealItemTypeId[OVV])
	call UnitUseItem(d, it)
	call JXX(u, it, JOX)
	call SetItemPlayer(it, E3, false)
	call SetItemUserData(it, 1)
	set d = null
endfunction

// 跳刀
function IGO takes unit u returns nothing
	local integer i = 0
	local item it
	local integer GTX
	local boolean b = false
	local real time = (LoadReal(HY, GetHandleId(u), 785) + 3) - GetGameTime() 
	if( (LoadReal(HY, GetHandleId(u), 785) ) + 3) > GetGameTime() then
		set b = true
	endif
	loop
		set it = UnitItemInSlot(u, i)
		set GTX = GetItemIndex(it)
		if(GTX == X9V and b) or(GTX == OVV and time >= 2.9) then
			call DisableTrigger(CUV)
			//call IFO(u, it, i)
			set E3 = GetItemPlayer(it)
			call RemoveItem(it)
			set Z2 = JIX(u, RealItemTypeId[OVV], i)
			call YDWESetUnitAbilityState(u,'A445', 1, 3.)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			call EnableTrigger(CUV)
		endif
		if GTX == OVV and b == false then
			call DisableTrigger(CUV)
			set E3 = GetItemPlayer(it)
			call RemoveItem(it)
			set Z2 = JIX(u, RealItemTypeId[X9V], i)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			call EnableTrigger(CUV)
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	set u = null
	set it = null
endfunction

function DHNO takes unit u, integer id returns nothing
	//if GetUnitAbilityLevel(u,'A0RN') == 0 then
	if CFV[id]> 0 then
		call IGO(u)
	endif
	if C8V[id]> 0 then
		call IOO(u)
	endif
	if C7V[id]> 0 then
		call IAO(u)
	endif
	//endif
endfunction

// 龙心 绿鞋 跳刀等会被打断的物品 中心计时器
function IHO takes nothing returns boolean
	local integer i = 1
	local unit u
	local integer id
	if HaveBlinkDaggerCount > 0 or HaveTranquilBootsCount > 0 or HaveHeartofTarrasqueCount > 0 then
		//绿鞋
		loop
		exitwhen i > 5
			set id = GetPlayerId(Sentinels[i])
			set u = Player__Hero[id]
			if u != null and UnitAlive(u) then
				call DHNO(u, id)
				if HaveBear then
					set u = LoadUnitHandle(HY, GetHandleId(Player(id)), 333)
					if u != null and UnitAlive(u) then
						call DHNO(u, id)
					endif
				endif
			endif
			set id = GetPlayerId(Scourges[i])
			set u = Player__Hero[id]
			if u != null and UnitAlive(u) then
				call DHNO(u, id)
				if HaveBear then
					set u = LoadUnitHandle(HY, GetHandleId(Player(id)), 333)
					if u != null and UnitAlive(u) then
						call DHNO(u, id)
					endif
				endif
			endif
			set i = i + 1
		endloop
	endif
	set u = null
	return false
endfunction
function ILO takes unit DKD returns boolean
	return false
endfunction

function ISO takes unit u returns nothing
	call AddAbilityToTimed(u,'A263', 1, 5,'B08N')
endfunction
function ITO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if GetEventDamageSource()== WUE and GetEventDamage()> 0 then
			if FK then
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
				call ISO(targetUnit)
			endif
		endif
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function IUO takes nothing returns nothing
	local unit WUE = GetAttacker()
	local unit targetUnit = GetTriggerUnit()
	local trigger t
	local integer h
	if((LoadInteger(HY,(GetHandleId((WUE))),(4309)))!= 1) then
		call EPX(WUE, 4309, .2)
		if GetPrdRandom(WUE,'MAIM'+ 1, 16) then
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
			call TriggerRegisterTimerEvent(t, 2.5, false)
			call TriggerAddCondition(t, Condition(function ITO))
			call SaveUnitHandle(HY, h, 2,(WUE))
			call SaveUnitHandle(HY, h, 17,(targetUnit))
		endif
	endif
	set WUE = null
	set targetUnit = null
	set t = null
endfunction
function DVD takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local real IWO =(LoadReal(HY,(GetHandleId(WUE)), 693))
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or IWO <(GetGameTime()) then
		call UnitRemoveAbility(WUE,'A264')
		call UnitRemoveAbility(WUE,'B02I')
		call SaveReal(HY,(GetHandleId(WUE)), 693,(0 * 1.))
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	return false
endfunction

function CraniumBasherWrapper takes nothing returns nothing
	local unit u = GetAttacker()
	local integer probability = 25
	local integer id = GetPlayerId(GetOwningPlayer(GetAttacker()))
	local integer h = GetHandleId(u)
	local real WIE =(GetGameTime())
	local real I0O =(LoadReal(HY, h,'e'))
	local boolean I1O =(LoadBoolean(HY, h, 99))
	local boolean I2O =(LoadBoolean(HY, h, 100))
	local boolean I3O = WIE < I0O
	local boolean I4O = false
	if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER)== false then
		set probability =$A
	endif
	if GetPrdRandom(u,'BASH', probability) then
		set I4O = true
	endif
	if GetUnitAbilityLevel(u,'A340')> 0 or GetUnitAbilityLevel(u,'A0JJ')> 0 or GetUnitAbilityLevel(u,'A081')> 0 or GetUnitAbilityLevel(u,'A0G5')> 0 or GetUnitAbilityLevel(u,'A09E')> 0 then
		call UnitRemoveAbility(u,'A174')
		set u = null
		return
	endif
	if I1O and I3O == false and I2O == false then
		call SaveReal(HY, h,'e',((WIE + 2.3)* 1.))
		if I4O == false then
			call SaveBoolean(HY, h, 100,(true))
		endif
	elseif I3O or I2O then
		call UnitRemoveAbility(u,'A174')
		call SaveBoolean(HY, h, 99,(false))
		call SaveBoolean(HY, h, 100,(false))
	endif
	if I4O then
		call UnitAddPermanentAbility(u,'A174')
		call UnitMakeAbilityPermanent(u, true,'A175')
		call SaveBoolean(HY, h, 99,(true))
	endif
	set u = null
endfunction
function I5O takes unit u returns unit
	if IsUnitType(u, UNIT_TYPE_HERO) or GetUnitAbilityLevel(u,'A04R')== 0 then
		return u
	else
		return Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
endfunction
function I6O takes unit SYX, unit SZX returns nothing
	local integer id = GetUnitTypeId(SZX)
	local integer i
	local real ZCE = 0
	local group g
	local unit u
	if(id =='n00J' or id =='n00A' or id =='n006') then
		set i = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(SZX))],'A0A8')
		if i > 0 or(IsUnitType(SYX, UNIT_TYPE_STRUCTURE)== false and IsUnitEnemy(SZX, GetOwningPlayer(SYX))) then
			if id =='n00J' then
				set ZCE = 400
			elseif id =='n00A' then
				set ZCE = 500
			elseif id =='n006' then
				set ZCE = 600
			endif
			if i > 0 then
				set g = LoginGroup(22)
				set U2 = SZX
				call GroupEnumUnitsInRange(g, GetUnitX(SZX), GetUnitY(SZX), 300, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
				if IsUnitType(SYX, UNIT_TYPE_STRUCTURE)== false and IsUnitEnemy(SZX, GetOwningPlayer(SYX)) then
					call GroupAddUnit(g, SYX)
				endif
				loop
					set u = FirstOfGroup(g)
				exitwhen u == null
					call UnitDamageTargetEx(SZX, u, 3, ZCE)
					call CHX("CLPB", SZX, u, 1, 1, 1, 1, .5)
					call GroupRemoveUnit(g, u)
				endloop
				call LogoutGroup(g)
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl", GetUnitX(SZX), GetUnitY(SZX)))
			else
				call UnitDamageTargetEx(SZX, I5O(SYX), 3, ZCE)
				call CHX("CLPB", SZX, I5O(SYX), 1, 1, 1, 1, .5)
			endif
		endif
	endif
endfunction
function I7O takes nothing returns boolean
	local unit whichUnit = GetTriggerUnit()
	local integer level = 1
	local integer id ='EUL1'
	if GetItemOfTypeFromUnit(whichUnit, RealItemTypeId[RBV])!= null then
		set level = 4
	endif
	if GZX(whichUnit, RealItemTypeId[XMV], GetManipulatedItem())!= null then
		set level = 2
	endif
	if GZX(whichUnit, RealItemTypeId[NKV], GetManipulatedItem())!= null then
		set level = 2
	endif
	if GZX(whichUnit, RealItemTypeId[IBV], GetManipulatedItem())!= null or GZX(whichUnit, RealItemTypeId[ICV], GetManipulatedItem())!= null or GZX(whichUnit, RealItemTypeId[IDV], GetManipulatedItem())!= null then
		set level = 2
	endif
	if GZX(whichUnit, RealItemTypeId[NZV], GetManipulatedItem())!= null then
		set level = 3
	endif
	if GZX(whichUnit, RealItemTypeId[RNV], GetManipulatedItem())!= null then
		set id ='EUL2'
		set level = 1
	endif
	if GZX(whichUnit, RealItemTypeId[IAV], GetManipulatedItem())!= null then
		set id ='EUL2'
		set level = 2
	endif
	if GZX(whichUnit, RealItemTypeId[Item_EulScepterOfDivinity], GetManipulatedItem())!= null then
		call UnitAddPermanentAbility(whichUnit, id)
		call SetUnitAbilityLevel(whichUnit, id, level)
	else
		call UnitRemoveAbility(whichUnit,'EUL1')
		call UnitRemoveAbility(whichUnit,'EUL2')
	endif
	set whichUnit = null
	return false
endfunction
function I9O takes nothing returns boolean
	local unit whichUnit = GetTriggerUnit()
	local integer level = 1
	local integer id ='EUL1'
	if GetItemOfTypeFromUnit(whichUnit, RealItemTypeId[RBV])!= null then
		set level = 4
	endif
	if GetItemOfTypeFromUnit(whichUnit, RealItemTypeId[XMV])!= null then
		set level = 2
	endif
	if GetItemOfTypeFromUnit(whichUnit, RealItemTypeId[NKV])!= null then
		set level = 2
	endif
	if GetItemOfTypeFromUnit(whichUnit, RealItemTypeId[IBV])!= null or GetItemOfTypeFromUnit(whichUnit, RealItemTypeId[ICV])!= null or GetItemOfTypeFromUnit(whichUnit, RealItemTypeId[IDV])!= null then
		set level = 2
	endif
	if GetItemOfTypeFromUnit(whichUnit, RealItemTypeId[NZV])!= null then
		set level = 3
	endif
	if GetItemOfTypeFromUnit(whichUnit, RealItemTypeId[RNV])!= null then
		set level = 1
		set id ='EUL2'
	endif
	if GetItemOfTypeFromUnit(whichUnit, RealItemTypeId[IAV])!= null then
		set level = 2
		set id ='EUL2'
	endif
	if GetItemOfTypeFromUnit(whichUnit, RealItemTypeId[Item_EulScepterOfDivinity])!= null then
		call UnitAddPermanentAbility(whichUnit, id)
		call SetUnitAbilityLevel(whichUnit, id, level)
	endif
	set whichUnit = null
	return false
endfunction
function AVO takes unit u, integer d returns nothing
	local integer array b
	local integer a = d
	local integer c = 1
	local integer i = 0
	local integer z
	local real hp
	if d == 0 then
		set hp = GetUnitState(u, UNIT_STATE_MAX_LIFE)-GetWidgetLife(u)
	endif
	if d < 1 then
		call UnitRemoveAbility(u, PB[0])
		call UnitRemoveAbility(u, PB[1])
		call UnitRemoveAbility(u, PB[2])
		call UnitRemoveAbility(u, PB[3])
		call UnitRemoveAbility(u, PB[4])
		call SetWidgetLife(u, RMaxBJ(GetUnitState(u, UNIT_STATE_MAX_LIFE)-hp, 1))
		return
	endif
	loop
	exitwhen c == 0
		set c = a / 2
		set b[i]= a -c * 2
		set a = c
		set i = i + 1
	endloop
	set z = 4
	set i = 0
	loop
	exitwhen i > z
		if b[i]== 1 then
			call UnitAddPermanentAbility(u, PB[i])
		else
			call UnitRemoveAbility(u, PB[i])
		endif
		set i = i + 1
	endloop
endfunction
function AEO takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(P, h, 0)
	local real AXO = LoadReal(P, h, 0)
	if GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		if GetItemOfTypeFromUnit(u, RealItemTypeId[NBV])== null then
			call SetHeroStr(u, IMaxBJ(GetHeroStr(u, false)-LoadInteger(K, GetHandleId(u),'ARML'), 1), true)
			call SaveInteger(K, GetHandleId(u),'ARML', 0)
			if IsTriggerEnabled(t) then
				call FlushChildHashtable(P, h)
				call CleanCurrentTrigger(t)
			endif
			set t = null
			set u = null
			return
		endif
		if GetTriggerEvalCount(t)<= 25 then
			call SetHeroStr(u, GetHeroStr(u, false)+ 1, true)
			call SaveInteger(K, GetHandleId(u),'ARML', GetTriggerEvalCount(t))
			if UnitAlive(u) then
			endif
		endif
	else
		call SetHeroStr(u, IMaxBJ(GetHeroStr(u, false)-LoadInteger(K, GetHandleId(u),'ARML'), 1), true)
		call SaveInteger(K, GetHandleId(u),'ARML', 0)
		if IsTriggerEnabled(t) then
			call FlushChildHashtable(P, h)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set u = null
endfunction
function AOO takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local trigger t
	local real AXO
	if GetTriggerEventId()== EVENT_PLAYER_UNIT_DROP_ITEM then
		if GetItemIndex(GetManipulatedItem())== NCV or GetItemIndex(GetManipulatedItem())== NFV then
			call UnitRemoveAbility(u,'A44Q')
			if GetItemIndex(GetManipulatedItem())== NCV then
				call AVO(u, 0)
			endif
		endif
		if GetItemIndex(GetManipulatedItem())== A2V then
			call UnitRemoveAbility(u,'A1BW')
		endif
		if GetItemIndex(GetManipulatedItem())== NBV or GetItemIndex(GetManipulatedItem())== NDV then
			call UnitRemoveAbility(u,'A44Q')
			call UnitRemoveAbility(u,'A0UK')
			if HaveSavedHandle(HY, GetHandleId(u),'ARML') then
				call TriggerEvaluate(LoadTriggerHandle(HY, GetHandleId(u),'ARML'))
			endif
			if GetItemIndex(GetManipulatedItem())== NBV then
			endif
		endif
	endif
	if GetTriggerEventId()== EVENT_PLAYER_UNIT_PICKUP_ITEM then
		if GetItemIndex(GetManipulatedItem())== NCV or GetItemIndex(GetManipulatedItem())== NFV then
			call UnitAddPermanentAbility(u,'A44Q')
			if GetItemIndex(GetManipulatedItem())== NCV then
				call AVO(u, 0)
			endif
		endif
		if GetItemIndex(GetManipulatedItem())== A2V then
			call UnitAddPermanentAbility(u,'A1BW')
		endif
		if GetItemIndex(GetManipulatedItem())== NBV or GetItemIndex(GetManipulatedItem())== NDV then
			call UnitAddPermanentAbility(u,'A44Q')
			call UnitAddPermanentAbility(u,'A0UK')
			if GetItemIndex(GetManipulatedItem())== NBV then
				set t = CreateTrigger()
				call TriggerRegisterTimerEvent(t, .6 / 25, true)
				set AXO = GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE)-GetWidgetLife(GetTriggerUnit())
				call SaveUnitHandle(P, GetHandleId(t), 0, u)
				call SaveBoolean(K, GetHandleId(u), 20, true)
				call SaveReal(P, GetHandleId(t), 0, AXO)
				call TriggerAddCondition(t, Condition(function AEO))
				if HaveSavedHandle(HY, GetHandleId(u),'ARML') then
					call TriggerEvaluate(LoadTriggerHandle(HY, GetHandleId(u),'ARML'))
				endif
				call SaveTriggerHandle(HY, GetHandleId(u),'ARML', t)
				set t = null
				call EPX(u, 4298, .6)
			endif
		endif
	endif
	set u = null
endfunction
function ARO takes nothing returns boolean
	if GetItemType(GetManipulatedItem())== ITEM_TYPE_PERMANENT and(GetItemIndex(GetManipulatedItem())== NBV or GetItemIndex(GetManipulatedItem())== NCV or GetItemIndex(GetManipulatedItem())== A2V or GetItemIndex(GetManipulatedItem())== NIV) then
		call AOO()
	endif
	return false
endfunction
function AIO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local item C1X =(LoadItemHandle(HY, h, 96))
	if GetTriggerEventId()== EVENT_UNIT_DROP_ITEM and GetManipulatedItem()== C1X then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()!= EVENT_UNIT_DROP_ITEM then
		if LoadInteger(HY, GetHandleId(triggerUnit), 4310)!= 1 and IsMessengerUnit(triggerUnit)== false and RFX(triggerUnit)== false then
			call SetWidgetLife(triggerUnit, RMaxBJ(GetWidgetLife(triggerUnit)-40., 1))
		endif
	endif
	set t = null
	set triggerUnit = null
	set C1X = null
	return false
endfunction
function AAO takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_DROP_ITEM)
	call TriggerAddCondition(t, Condition(function AIO))
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call SaveItemHandle(HY, h, 96,(GetManipulatedItem()))
	set t = null
	set triggerUnit = null
endfunction
function ANO takes nothing returns boolean
	if GetItemType(GetManipulatedItem())== ITEM_TYPE_PERMANENT and(GetItemIndex(GetManipulatedItem())== NBV or(GetItemIndex(GetManipulatedItem())== NDV and IsBearUnit(GetTriggerUnit()))) then
		call AAO()
	endif
	return false
endfunction
function ABO takes unit u returns boolean
	local item ACO = CreateItem('I0KK', GetUnitX(u), GetUnitY(u))
	local boolean JVX = UnitAddItem(u, ACO)
	if JVX == false then
		call RemoveItem(ACO)
	endif
	set ACO = null
	return JVX
endfunction
function ADO takes unit triggerUnit, item C1X, integer JNX returns item
	local real x = H9X(triggerUnit)
	local real y = JEX(triggerUnit)
	local integer i = 0
	local boolean array JBX
	local item JCX
	loop
	exitwhen i >(UnitInventorySize(triggerUnit)-1)
		if UnitItemInSlot(triggerUnit, i)== null and i != JNX then
			set JCX = CreateItem('I02M', x, y)
			call UnitAddItem(triggerUnit, JCX)
			set JBX[i]= true
		else
			set JBX[i]= false
		endif
		if i == JNX then
			call UnitAddItem(triggerUnit, C1X)
		endif
		set i = i + 1
	endloop
	set i = 0
	loop
	exitwhen i > 5
		if JBX[i]then
			call RemoveItem(UnitItemInSlot(triggerUnit, i))
		endif
		set i = i + 1
	endloop
	set Z2 = C1X
	set JCX = null
	return Z2
endfunction
function AFO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 14))
	local integer i = 0
	local item WNE
	local integer GTX
	local unit dummyUnit
	local item RIO
	local item it = null
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call SaveBoolean(HY,(GetHandleId(u)),'f',(false))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif ABO(u)== false then
		call TriggerRegisterTimerEvent(t, 5.5, false)
	else
		call SaveBoolean(HY,(GetHandleId(u)),'f',(false))
		call DisableTrigger(CUV)
		if CJV[GetPlayerId(GetOwningPlayer(u))]> 0 then
			set it = UnitAddItemById(u,'I0HM')
			if GetWidgetLife(it)> 0 then
				call RemoveItem(it)
			endif
			set it = null
		endif
		loop
		exitwhen i > 5
			set WNE = UnitItemInSlot(u, i)
			set GTX = GetItemIndex(WNE)
			if GTX == AQV then
				set E3 = GetItemPlayer(WNE)
				call RemoveItem(WNE)
				set dummyUnit = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
				call UnitAddAbility(dummyUnit,'AInv')
				set RIO = UnitAddItemById(dummyUnit, RealItemTypeId[APV])
				call UnitUseItem(dummyUnit, RIO)
				set Z2 = ADO(u, RIO, i)
				call SetItemPlayer(RIO, E3, false)
				call SetItemUserData(RIO, 1)
				call UnitRemoveAbility(dummyUnit,'AInv')
				set dummyUnit = null
				set RIO = null
			endif
			set WNE = null
			set i = i + 1
		endloop
		call EnableTrigger(CUV)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	set WNE = null
	set dummyUnit = null
	set RIO = null
	return false
endfunction
function AGO takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer i = 0
	local item WNE = null
	local integer GTX
	local unit dummyUnit = null
	local item RIO = null
	call DisableTrigger(CUV)
	call SaveBoolean(HY,(GetHandleId(u)),'f',(true))
	call TriggerRegisterTimerEvent(t, 17, false)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function AFO))
	call SaveUnitHandle(HY, h, 14,(u))
	loop
	exitwhen i > 5
		set WNE = UnitItemInSlot(u, i)
		set GTX = GetItemIndex(WNE)
		if GTX == APV or GTX == AQV then
			set E3 = GetItemPlayer(WNE)
			call RemoveItem(WNE)
			set dummyUnit = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
			call UnitAddAbility(dummyUnit,'AInv')
			set RIO = UnitAddItemById(dummyUnit, RealItemTypeId[AQV])
			call UnitUseItem(dummyUnit, RIO)
			set Z2 = ADO(u, RIO, i)
			call SetItemPlayer(RIO, E3, false)
			call SetItemUserData(RIO, 1)
			call UnitRemoveAbility(dummyUnit,'AInv')
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\DispelMagic\\DispelMagicTarget.mdl", u, "origin"))
			set dummyUnit = null
			set RIO = null
		endif
		set WNE = null
		set i = i + 1
	endloop
	call EnableTrigger(CUV)
	set t = null
endfunction
function AHO takes nothing returns boolean
	local integer i = 1
	local unit u = null
	local integer id
	if OY then
		return false
	endif
	if CWV > 0 then
		loop
		exitwhen i > 5
			set id = GetPlayerId(Sentinels[i])
			set u = Player__Hero[id]
			if CJV[id]> 0 and u != null and UnitAlive(u) and LoadBoolean(HY, GetHandleId(u),'f')== false and UnitHasSpellShield(u)== false and LoadBoolean(HY, GetHandleId(u),$81)== false then
				call AGO(u)
			endif
			set id = GetPlayerId(Scourges[i])
			set u = Player__Hero[id]
			if CJV[id]> 0 and u != null and UnitAlive(u) and LoadBoolean(HY, GetHandleId(u),'f')== false and UnitHasSpellShield(u)== false and LoadBoolean(HY, GetHandleId(u),$81)== false then
				call AGO(u)
			endif
			set i = i + 1
		endloop
	endif
	set u = null
	return false
endfunction
function AJO takes unit u returns nothing
	call AGO(u)
	call UnitRemoveAbility(u,'B0BI')
endfunction
function GLE takes nothing returns boolean
	local integer id
	local unit u
	local integer h
	if GetSpellAbilityId()=='A0H6' then
		set u = GetTriggerUnit()
		set h = GetHandleId(u)
		call SaveUnitHandle(HY, h,'g', null)
		call SaveInteger(HY, h,'h', 0)
		if(GetItemOfTypeFromUnit(GetTriggerUnit(), RealItemTypeId[O_V])!= null or GetItemOfTypeFromUnit(GetTriggerUnit(), InvalidItemTypeId[O_V])!= null) and(GetUnitTypeId(GetSpellTargetUnit())=='nfoh' or GetUnitTypeId(GetSpellTargetUnit())=='ndfl') then
			call SaveUnitHandle(HY, h,'g', GetSpellTargetUnit())
		elseif ZNX(GetItemTypeId(GetSpellTargetItem())) then
			set id = ZAX(GetItemTypeId(GetSpellTargetItem()))
			call OQO(GetTriggerUnit(), id, true)
			call SaveInteger(HY, h,'h', id)
			call HZX(GetSpellTargetItem())
		endif
	endif
	set u = null
	return false
endfunction
function AKO takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local item C1X = GetManipulatedItem()
	local integer GTX = UUV(C1X)
	local unit ALO
	local integer AMO
	local integer JNX
	local item RIO = null
	local integer APO
	local integer id
	if GTX == O_V then
		set JNX = B2X(u, C1X)
		set ALO =(LoadUnitHandle(HY,(GetHandleId(u)),'g'))
		set AMO =(LoadInteger(HY,(GetHandleId(u)),'h'))
		if GetUnitTypeId(ALO)=='nfoh' or GetUnitTypeId(ALO)=='ndfl' then
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl", u, "overhead"))
			call IRX(GetOwningPlayer(u), "Abilities\\Spells\\Human\\Heal\\HealTarget.wav")
			set E3 = GetItemPlayer(C1X)
			call HZX(C1X)
			set Z2 = JIX(u, RealItemTypeId[O2V], JNX)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
		elseif ZBX(AMO) then
			set APO = RNO(AMO)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl", u, "overhead"))
			set E3 = GetItemPlayer(C1X)
			call HZX(C1X)
			call DisableTrigger(CUV)
			if GetOwningPlayer(u)== E3 then
				set Z2 = JIX(u, RealItemTypeId[APO], JNX)
			else
				set Z2 = JIX(u, InvalidItemTypeId[APO], JNX)
			endif
			call EnableTrigger(CUV)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			set RIO = UnitItemInSlot(u, JNX)
			call RAO(u, RIO)
		endif
	elseif GTX == O2V then
		set JNX = B2X(u, C1X)
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		set Z2 = JIX(u, RealItemTypeId[O1V], JNX)
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
	elseif GTX == O1V then
		set JNX = B2X(u, C1X)
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		set Z2 = JIX(u, RealItemTypeId[O0V], JNX)
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
	elseif GTX == O0V then
		set JNX = B2X(u, C1X)
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		set Z2 = JIX(u, RealItemTypeId[O_V], JNX)
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 0)
	elseif GUX(GTX) then
		set C2V = true
		set JNX = B2X(u, C1X)
		set id = GWX(GTX)
		if id > 0 then
			set RIO = CreateItem(id, GetUnitX(u), GetUnitY(u))
		else
			set RIO = null
		endif
		set E3 = GetItemPlayer(C1X)
		call HZX(C1X)
		set Z2 = JIX(u, RealItemTypeId[O2V], JNX)
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
		call UnitAddItem(u, RIO)
		set C2V = false
	endif
	set u = null
	set C1X = null
	set ALO = null
	set RIO = null
endfunction
function AQO takes nothing returns boolean
	if GetIssuedOrderId()==851971 then
		if GetOrderTargetItem()!= null then
			if ZNX(GetItemTypeId(GetOrderTargetItem())) then
				call EXStopUnit(GetTriggerUnit())
				call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n0LU'))
			elseif UUV(GetOrderTargetItem())== ASV or UUV(GetOrderTargetItem())== ATV then
				call EXStopUnit(GetTriggerUnit())
				call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "信使不能拾取圣剑")
			endif
		endif
	endif
	return false
endfunction
function ASO takes unit ATO returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, ATO, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerAddCondition(t, Condition(function AQO))
	set t = null
endfunction
function AUO takes player p returns integer
	local integer r = GetRandomInt(1, 7)
	if OLX(p) then
		return'np00'
	endif
	if IsSentinelsPlayer(p) then
		if r == 1 then
			return'n00I'
		elseif r == 2 then
			return'n022'
		elseif r == 3 then
			return'n021'
		elseif r == 4 then
			return'n0KY'
		elseif r == 5 then
			return'n0KZ'
		elseif r == 7 then//彩蛋信使
			return'np00'
		else//
			return'n0LE'
		endif
	else
		if r == 1 then
			return'n023'
		elseif r == 2 then
			return'n024'
		elseif r == 3 then
			return'n025'
		elseif r == 4 then
			return'n0L0'
		elseif r == 5 then
			return'n0L1'
		elseif r == 7 then//
			return'np00'
		else//
			return'n0M4'
		endif
	endif
	return 0
endfunction
function AWO takes player p returns integer
	if OLX(p) then
		return'np01'
	endif
	if GetRandomInt(1, 3)== 1 then
		return'e02R'
	elseif IsSentinelsPlayer(p) then
		return'e01H'
	else
		return'e01Z'
	endif
	return 0
endfunction


function MUGetMessengerOwner takes unit messenger returns player
	return LoadPlayerHandle(HY, GetHandleId(messenger), StringHash("信使所有者"))
endfunction

function MUIsMessenger takes unit messenger returns boolean
	return MUGetMessengerOwner(messenger) != null
endfunction

function MUIsMessengerShared takes unit messenger returns boolean
	return GetOwningPlayer(messenger) != MUGetMessengerOwner(messenger)
endfunction

function MUIsPlayerMessengerShared takes player target returns boolean
	return LoadBoolean(HY, GetHandleId(target), StringHash("信使共享"))
endfunction

function MUSetMessengerNotShare takes unit messenger returns nothing
	local player owner = MUGetMessengerOwner(messenger)
	local integer i
	if owner == null then
		return
	endif
	call SetUnitOwner(messenger, owner, false)
	if GetPlayerTeam(owner) == 0 then
		set i = 1
		loop
			if Sentinels[i] != owner then
				call DisplayTimedTextToPlayer(Sentinels[i], 0, 0, 10, "|cffffff11你不再能控制" + JS[GetPlayerId(owner)] + GetPlayerName(owner) + "|cffffff11的信使了|r")
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
	else
		set i = 1
		loop
			if Scourges[i] != owner then
				call DisplayTimedTextToPlayer(Scourges[i], 0, 0, 10, "|cffffff11你不再能控制" + JS[GetPlayerId(owner)] + GetPlayerName(owner) + "|cffffff11的信使了|r")
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
	endif
	set owner = null
endfunction
//共享信使
function MUInitDummyPlayer takes integer id1, integer id2 returns nothing
	local integer i
	if mu_has_init_dummy_player then
		return
	endif
	set mu_has_init_dummy_player = true
	// 颜色
	set JS[id1] = JS[0]
	set JS[id2] = JS[6]
	call SetPlayerColor(Player(id1), GetPlayerColor(Sentinels[0]))
	call SetPlayerColor(Player(id2), GetPlayerColor(Scourges[0]))
	// 名字
	call SetPlayerName(Player(id1), GetPlayerName(Sentinels[0]))
	call SetPlayerName(Player(id2), GetPlayerName(Scourges[0]))
	set VMV[id1] = GetPlayerName(Player(id1))
	set VMV[id2] = GetPlayerName(Player(id2))
	// 队伍
	call SetPlayerTeam(Player(id1), 0)
	call SetPlayerTeam(Player(id2), 1)
	// 结盟
	set i = 0
	loop
		call SetPlayerAlliance(Player(id1), Sentinels[i], ALLIANCE_PASSIVE, true)
		call SetPlayerAlliance(Player(id1), Sentinels[i], ALLIANCE_HELP_REQUEST, true)
		call SetPlayerAlliance(Player(id1), Sentinels[i], ALLIANCE_HELP_RESPONSE, true)
		call SetPlayerAlliance(Player(id1), Sentinels[i], ALLIANCE_SHARED_XP, true)
		call SetPlayerAlliance(Player(id1), Sentinels[i], ALLIANCE_SHARED_SPELLS, true)
		call SetPlayerAlliance(Sentinels[i], Player(id1), ALLIANCE_PASSIVE, true)
		call SetPlayerAlliance(Sentinels[i], Player(id1), ALLIANCE_HELP_REQUEST, true)
		call SetPlayerAlliance(Sentinels[i], Player(id1), ALLIANCE_HELP_RESPONSE, true)
		call SetPlayerAlliance(Sentinels[i], Player(id1), ALLIANCE_SHARED_XP, true)
		call SetPlayerAlliance(Sentinels[i], Player(id1), ALLIANCE_SHARED_SPELLS, true)
		call SetPlayerAlliance(Player(id1), Scourges[i], ALLIANCE_PASSIVE, false)
		call SetPlayerAlliance(Player(id1), Scourges[i], ALLIANCE_HELP_REQUEST, false)
		call SetPlayerAlliance(Player(id1), Scourges[i], ALLIANCE_HELP_RESPONSE, false)
		call SetPlayerAlliance(Player(id1), Scourges[i], ALLIANCE_SHARED_XP, false)
		call SetPlayerAlliance(Player(id1), Scourges[i], ALLIANCE_SHARED_SPELLS, false)
		call SetPlayerAlliance(Scourges[i], Player(id1), ALLIANCE_PASSIVE, false)
		call SetPlayerAlliance(Scourges[i], Player(id1), ALLIANCE_HELP_REQUEST, false)
		call SetPlayerAlliance(Scourges[i], Player(id1), ALLIANCE_HELP_RESPONSE, false)
		call SetPlayerAlliance(Scourges[i], Player(id1), ALLIANCE_SHARED_XP, false)
		call SetPlayerAlliance(Scourges[i], Player(id1), ALLIANCE_SHARED_SPELLS, false)
		set i = i + 1
	exitwhen i > 5
	endloop
	set i = 0
	loop
		call SetPlayerAlliance(Player(id2), Scourges[i], ALLIANCE_PASSIVE, true)
		call SetPlayerAlliance(Player(id2), Scourges[i], ALLIANCE_HELP_REQUEST, true)
		call SetPlayerAlliance(Player(id2), Scourges[i], ALLIANCE_HELP_RESPONSE, true)
		call SetPlayerAlliance(Player(id2), Scourges[i], ALLIANCE_SHARED_XP, true)
		call SetPlayerAlliance(Player(id2), Scourges[i], ALLIANCE_SHARED_SPELLS, true)
		call SetPlayerAlliance(Scourges[i], Player(id2), ALLIANCE_PASSIVE, true)
		call SetPlayerAlliance(Scourges[i], Player(id2), ALLIANCE_HELP_REQUEST, true)
		call SetPlayerAlliance(Scourges[i], Player(id2), ALLIANCE_HELP_RESPONSE, true)
		call SetPlayerAlliance(Scourges[i], Player(id2), ALLIANCE_SHARED_XP, true)
		call SetPlayerAlliance(Scourges[i], Player(id2), ALLIANCE_SHARED_SPELLS, true)
		call SetPlayerAlliance(Player(id2), Sentinels[i], ALLIANCE_PASSIVE, false)
		call SetPlayerAlliance(Player(id2), Sentinels[i], ALLIANCE_HELP_REQUEST, false)
		call SetPlayerAlliance(Player(id2), Sentinels[i], ALLIANCE_HELP_RESPONSE, false)
		call SetPlayerAlliance(Player(id2), Sentinels[i], ALLIANCE_SHARED_XP, false)
		call SetPlayerAlliance(Player(id2), Sentinels[i], ALLIANCE_SHARED_SPELLS, false)
		call SetPlayerAlliance(Sentinels[i], Player(id2), ALLIANCE_PASSIVE, false)
		call SetPlayerAlliance(Sentinels[i], Player(id2), ALLIANCE_HELP_REQUEST, false)
		call SetPlayerAlliance(Sentinels[i], Player(id2), ALLIANCE_HELP_RESPONSE, false)
		call SetPlayerAlliance(Sentinels[i], Player(id2), ALLIANCE_SHARED_XP, false)
		call SetPlayerAlliance(Sentinels[i], Player(id2), ALLIANCE_SHARED_SPELLS, false)
		set i = i + 1
	exitwhen i > 5
	endloop
	set i = 0
	loop
		call SetPlayerAlliance(Player(id1), NeutralPassivePlayer, ConvertAllianceType(i), true)
		call SetPlayerAlliance(NeutralPassivePlayer, Player(id1), ConvertAllianceType(i), true)
		call SetPlayerAlliance(Player(id2), NeutralPassivePlayer, ConvertAllianceType(i), true)
		call SetPlayerAlliance(NeutralPassivePlayer, Player(id2), ConvertAllianceType(i), true)
		set i = i + 1
	exitwhen i > 5
	endloop
endfunction

function MUCreateDummyMessenger takes unit messenger, player owner, player origin_owner returns nothing
	local unit dummy = CreateUnit(owner, 'e00E', GetUnitX(messenger), GetUnitY(messenger), 0)
	local trigger trg = CreateTrigger()
	if owner != origin_owner then
		call UnitSetUsesAltIcon(dummy, true)
	endif
	call SetUnitFlyHeight(dummy, 10000, 0)
	call UnitAddAbility(dummy, 'Avul')
	call UnitAddAbility(dummy, 'AInv')
	call SaveUnitHandle(HY, GetHandleId(trg), 1, dummy)
	call SaveUnitHandle(HY, GetHandleId(trg), 2, messenger)
	call SavePlayerHandle(HY, GetHandleId(trg), 3, owner)
	call SavePlayerHandle(HY, GetHandleId(trg), 4, origin_owner)
	call SaveBoolean(HY, GetHandleId(trg), 5, true)
	call TriggerRegisterTimerEvent(trg, 0.1, true)
	call TriggerRegisterUnitEvent(trg, messenger, EVENT_UNIT_PICKUP_ITEM)
	call TriggerRegisterUnitEvent(trg, messenger, EVENT_UNIT_DROP_ITEM)
	call TriggerRegisterUnitEvent(trg, messenger, EVENT_UNIT_CHANGE_OWNER)
	call TriggerAddCondition(trg, mu_sync_dummy_messenger)
	set dummy = null
	set trg = null
endfunction

function MUSetMessengerShare takes unit messenger returns nothing
	local player owner = MUGetMessengerOwner(messenger)
	local integer team = GetPlayerTeam(owner)
	local player target_player = null
	local string name
	local integer i
	if team == 0 then
		if Sentinels[0] == Player(0) then
			set target_player = Player(13)
			call MUInitDummyPlayer(13, 14)
		elseif Sentinels[0] == Player(13) then
			set target_player = Player(0)
			call MUInitDummyPlayer(0, 6)
		endif
	elseif team == 1 then
		if Scourges[0] == Player(6) then
			set target_player = Player(14)
			call MUInitDummyPlayer(13, 14)
		elseif Scourges[0] == Player(14) then
			set target_player = Player(6)
			call MUInitDummyPlayer(0, 6)
		endif
	endif
	if target_player == null then
		
		return
	endif
	call SavePlayerHandle(HY, GetHandleId(owner), StringHash("信使共享玩家"), target_player)
	call UnitSetUsesAltIcon(messenger, true)
	call SetUnitOwner(messenger, target_player, false)
	set name = GetPlayerName(target_player)
	call SetPlayerName(target_player, JS[GetPlayerId(target_player)] + "动物信使|r")
	if team == 0 then
		set i = 1
		loop
			call SetPlayerAlliance(target_player, Sentinels[i], ALLIANCE_SHARED_CONTROL, true)
			call UnitShareVision(messenger, Sentinels[i], true)
			call MUCreateDummyMessenger(messenger, Sentinels[i], owner)
			if Sentinels[i] != owner then
				call DisplayTimedTextToPlayer(Sentinels[i], 0, 0, 10, "|cffffff11你可以控制" + JS[GetPlayerId(owner)] + GetPlayerName(owner) + "|cffffff11的信使了|r")
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
	elseif team == 1 then
		set i = 1
		loop
			call SetPlayerAlliance(target_player, Scourges[i], ALLIANCE_SHARED_CONTROL, true)
			call UnitShareVision(messenger, Scourges[i], true)
			call MUCreateDummyMessenger(messenger, Scourges[i], owner)
			if Scourges[i] != owner then
				call DisplayTimedTextToPlayer(Scourges[i], 0, 0, 10, "|cffffff11你可以控制" + JS[GetPlayerId(owner)] + GetPlayerName(owner) + "|cffffff11的信使了|r")
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
	endif
	call SetPlayerName(target_player, name)
	set target_player = null
	set owner = null
endfunction

function MUSyncDummyMessenger takes nothing returns nothing
	local trigger trg = GetTriggeringTrigger()
	local unit dummy = LoadUnitHandle(HY, GetHandleId(trg), 1)
	local unit messenger = LoadUnitHandle(HY, GetHandleId(trg), 2)
	local boolean need_sync_items = LoadBoolean(HY, GetHandleId(trg), 5)
	local integer i
	local item it
	if GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		call UnitPauseTimedLife(dummy, true)
		if IsUnitType(messenger, UNIT_TYPE_DEAD) then
			call ShowUnit(dummy, false)
		else
			call ShowUnit(dummy, true)
			call SetUnitX(dummy, GetUnitX(messenger))
			call SetUnitY(dummy, GetUnitY(messenger))
		endif
		if IsUnitType(dummy, UNIT_TYPE_DEAD) then
			call MUCreateDummyMessenger(messenger, LoadPlayerHandle(HY, GetHandleId(trg), 3), LoadPlayerHandle(HY, GetHandleId(trg), 4))
			call DestroyTrigger(trg)
			call FlushChildHashtable(HY, GetHandleId(trg))
		endif
	elseif GetTriggerEventId() == EVENT_UNIT_CHANGE_OWNER then
		// 删除马甲身上的物品
		call DisableTrigger(CUV)
		set i = 0
		loop
			set it = UnitItemInSlot(dummy, i)
			if it != null then
				call RemoveItem(it)
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
		set it = null
		call EnableTrigger(CUV)
		// 删除马甲并清空
		call RemoveUnit(dummy)
		call DestroyTrigger(trg)
		call FlushChildHashtable(HY, GetHandleId(trg))
	else
		call SaveBoolean(HY, GetHandleId(trg), 5, true)
	endif
	if need_sync_items and GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED then
		call SaveBoolean(HY, GetHandleId(trg), 5, false)
		// 同步马甲身上的物品
		call DisableTrigger(CUV)
		// 先删掉马甲身上的物品
		set i = 0
		loop
			set it = UnitItemInSlot(dummy, i)
			if it != null then
				call RemoveItem(it)
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
		// 然后同步物品
		set i = 0
		loop
			set it = UnitItemInSlot(messenger, i)
			if it == null or(GetTriggerEventId() == EVENT_UNIT_DROP_ITEM and it == GetManipulatedItem()) then
				// 创建占位物品
				set it = CreateItem('I02M', 0, 0)
			else
				set it = CreateItem(GetItemTypeId(it), 0, 0)
			endif
			if not UnitAddItem(dummy, it) then
				call RemoveItem(it)
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
		// 最后删掉占位物品
		set i = 0
		loop
			set it = UnitItemInSlot(dummy, i)
			if GetItemTypeId(it) == 'I02M' then
				call RemoveItem(it)
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
		set it = null
		call EnableTrigger(CUV)
	endif
	set trg = null
	set dummy = null
	set messenger = null
endfunction
function MUChangeMessengerShare takes player target returns nothing
	local boolean flag = not MUIsPlayerMessengerShared(target)
	local group temp_group = CreateGroup()
	local unit enum_unit
	if flag then
		call GroupEnumUnitsOfPlayer(temp_group, target, null)
	else
		call GroupEnumUnitsOfPlayer(temp_group, LoadPlayerHandle(HY, GetHandleId(target), StringHash("信使共享玩家")), null)
	endif
	if target == LocalPlayer then
		call GetSetUpText("信使共享", flag)
	endif
	call SaveBoolean(HY, GetHandleId(target), StringHash("信使共享"), flag)
	
	loop
		set enum_unit = FirstOfGroup(temp_group)
	exitwhen enum_unit == null
		call GroupRemoveUnit(temp_group, enum_unit)
		if MUIsMessenger(enum_unit) then
			if flag then
				if not MUIsMessengerShared(enum_unit) then
					call MUSetMessengerShare(enum_unit)
				endif
			else
				if MUIsMessengerShared(enum_unit) then
					call MUSetMessengerNotShare(enum_unit)
				endif
			endif
		endif
	endloop
	call DestroyGroup(temp_group)
	set temp_group = null
endfunction

function MUInitMessenger takes unit messenger returns nothing
	call SavePlayerHandle(HY, GetHandleId(messenger), StringHash("信使所有者"), GetOwningPlayer(messenger))
	if MUIsPlayerMessengerShared(GetOwningPlayer(messenger)) then
		call MUSetMessengerShare(messenger)
	endif
	if(LocalPlayer== GetOwningPlayer(messenger)) then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, "你可以在能量圈单独共享你的信使")
	endif
endfunction

function MUSpellEffect takes nothing returns nothing
	call MUChangeMessengerShare(GetTriggerPlayer())
	call Click_CheckBox_Nothing( GetTriggerPlayer(), 10)
endfunction


function GME takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local real a = GetUnitFacing(u)
	local unit c = CreateUnit(GetOwningPlayer(u), AUO(GetOwningPlayer(u)), x, y, a)
	call ZOX(c)
	call GroupAddUnit(KX, c)
	call SaveUnitHandle(K, GetHandleId(GetOwningPlayer(u)),'COUR', HJX(GetOwningPlayer(u)))
	call SetUnitPosition(c, x + 25 * Cos(a * bj_DEGTORAD), y + 25 * Sin(a * bj_DEGTORAD))
	call MUInitMessenger(c)
	if W3[GetPlayerId(GetOwningPlayer(c))]== false then
		call SetUnitPeonType(c, false)
	else
		call SetUnitPeonType(c, true)
	endif
	call SetUnitBlendTime(c, 0.)
	set c = null
	set u = null
endfunction
// 召唤信使
function GPE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit Y1X = CreateUnit(GetOwningPlayer(u), AWO(GetOwningPlayer(u)), GetUnitX(u), GetUnitY(u), GetUnitFacing(u))
	call MUInitMessenger(Y1X)
	call ZOX(Y1X)
	call GroupAddUnit(KX, Y1X)
	call SaveUnitHandle(K, GetHandleId(GetOwningPlayer(u)),'COUR', HJX(GetOwningPlayer(u)))
	if W3[GetPlayerId(GetOwningPlayer(Y1X))]== false then
		call SetUnitPeonType(Y1X, false)
	else
		call SetUnitPeonType(Y1X, true)
	endif
	call ASO(Y1X)
	call SetUnitBlendTime(Y1X, 0.)
	set Y1X = null
	set u = null
endfunction
function AYO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h,'|')
	local integer i = 1
	local integer array AZO
	local integer array HUX
	local integer A_O = LoadInteger(HY, h, 125)
	set AZO[1]= LoadInteger(HY, h,'j')
	set AZO[2]= LoadInteger(HY, h,'k')
	set AZO[3]= LoadInteger(HY, h,'l')
	set AZO[4]= LoadInteger(HY, h,'m')
	set AZO[5]= LoadInteger(HY, h, 110)
	set AZO[6]= LoadInteger(HY, h,'o')
	set HUX[1]= LoadInteger(HY, h,'p')
	set HUX[2]= LoadInteger(HY, h,'q')
	set HUX[3]= LoadInteger(HY, h, 114)
	set HUX[4]= LoadInteger(HY, h, 115)
	set HUX[5]= LoadInteger(HY, h, 116)
	set HUX[6]= LoadInteger(HY, h,'u')
	call DisableTrigger(CUV)
	if GetTriggerEvalCount(t)== 1 then
		call UnitAddAbility(u, A_O)
		if W3[GetPlayerId(GetOwningPlayer(u))]== false then
			call SetUnitPeonType(u, false)
		else
			call SetUnitPeonType(u, true)
		endif
	else
		loop
			if AZO[i]> 0 then
				set Z2 = CreateItem(AZO[i], GetUnitX(u), GetUnitY(u))
				call UnitAddItem(u, Z2)
				call SetItemPlayer(Z2, LoadPlayerHandle(HY, h,'u'+ i), false)
				call SetItemUserData(Z2, 1)
				if HUX[i]> 0 then
					call SetItemCharges(Z2, HUX[i])
				endif
			endif
			set i = i + 1
		exitwhen i > 6
		endloop
		if W3[GetPlayerId(GetOwningPlayer(u))]== false then
			call SetUnitPeonType(u, false)
		else
			call SetUnitPeonType(u, true)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	call EnableTrigger(CUV)
	call UnitMakeAbilityPermanent(u, true,'A29M')
	call UnitMakeAbilityPermanent(u, true,'A413')
	set t = null
	set u = null
	return false
endfunction
function A0O takes integer id returns boolean
	return id == R0V or id == R_V or id == RYV
endfunction
function A1O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit A2O =(LoadUnitHandle(HY, h, 2))
	local integer A3O = GetUnitTypeId(A2O)
	local real x = GetUnitX(A2O)
	local real y = GetUnitY(A2O)
	local item A4O
	local item A5O
	local item A6O
	local item A7O
	local item A8O
	local item A9O
	local player p0
	local player p1
	local player p2
	local player p3
	local player p4
	local player p5
	local integer NVO
	local integer NEO
	local integer NXO
	local integer NOO
	local integer NRO
	local integer NIO
	local integer NAO =-1
	local integer NNO =-1
	local integer NBO =-1
	local integer NCO =-1
	local integer NDO =-1
	local integer NFO =-1
	local integer A_O
	local item C1X
	local integer i
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	if A2O == null or UnitIsDead(A2O) then
		set t = null
		set A2O = null
		return false
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	set A4O = UnitItemInSlot(A2O, 0)
	set A5O = UnitItemInSlot(A2O, 1)
	set A6O = UnitItemInSlot(A2O, 2)
	set A7O = UnitItemInSlot(A2O, 3)
	set A8O = UnitItemInSlot(A2O, 4)
	set A9O = UnitItemInSlot(A2O, 5)
	set NVO = GetItemTypeId(A4O)
	set NEO = GetItemTypeId(A5O)
	set NXO = GetItemTypeId(A6O)
	set NOO = GetItemTypeId(A7O)
	set NRO = GetItemTypeId(A8O)
	set NIO = GetItemTypeId(A9O)
	set p0 = GetItemPlayer(A4O)
	set p1 = GetItemPlayer(A5O)
	set p2 = GetItemPlayer(A6O)
	set p3 = GetItemPlayer(A7O)
	set p4 = GetItemPlayer(A8O)
	set p5 = GetItemPlayer(A9O)
	set C1X = A4O
	set i = UUV(C1X)
	if GetItemType(C1X)== ITEM_TYPE_ARTIFACT or HHX(i) or(GetItemType(C1X)== ITEM_TYPE_CAMPAIGN and A0O(i)) then
		set NAO = GetItemCharges(C1X)
	endif
	set C1X = A5O
	set i = UUV(C1X)
	if GetItemType(C1X)== ITEM_TYPE_ARTIFACT or HHX(i) or(GetItemType(C1X)== ITEM_TYPE_CAMPAIGN and A0O(i)) then
		set NNO = GetItemCharges(C1X)
	endif
	set C1X = A6O
	set i = UUV(C1X)
	if GetItemType(C1X)== ITEM_TYPE_ARTIFACT or HHX(i) or(GetItemType(C1X)== ITEM_TYPE_CAMPAIGN and A0O(i)) then
		set NBO = GetItemCharges(C1X)
	endif
	set C1X = A7O
	set i = UUV(C1X)
	if GetItemType(C1X)== ITEM_TYPE_ARTIFACT or HHX(i) or(GetItemType(C1X)== ITEM_TYPE_CAMPAIGN and A0O(i)) then
		set NCO = GetItemCharges(C1X)
	endif
	set C1X = A8O
	set i = UUV(C1X)
	if GetItemType(C1X)== ITEM_TYPE_ARTIFACT or HHX(i) or(GetItemType(C1X)== ITEM_TYPE_CAMPAIGN and A0O(i)) then
		set NDO = GetItemCharges(C1X)
	endif
	set C1X = A9O
	set i = UUV(C1X)
	if GetItemType(C1X)== ITEM_TYPE_ARTIFACT or HHX(i) or(GetItemType(C1X)== ITEM_TYPE_CAMPAIGN and A0O(i)) then
		set NFO = GetItemCharges(C1X)
	endif
	call HZX(A4O)
	call HZX(A5O)
	call HZX(A6O)
	call HZX(A7O)
	call HZX(A8O)
	call HZX(A9O)
	//	if A3O =='np00'then
	//		set A_O ='S020'
	if A3O =='n00I' then
		set A_O ='S009'
	elseif A3O =='n022' then
		set A_O ='S00V'
	elseif A3O =='n021' then
		set A_O ='S00C'
	elseif A3O =='n023' then
		set A_O ='S00E'
	elseif A3O =='n024' then
		set A_O ='S00B'
	elseif A3O =='n025' then
		set A_O ='S00F'
	elseif A3O =='n0KY' then
		set A_O ='S00W'
	elseif A3O =='n0KZ' then
		set A_O ='S00Y'
	elseif A3O =='n0L0' then
		set A_O ='S00X'
	elseif A3O =='n0L1' then
		set A_O ='S00D'
	elseif A3O =='n0LE' then
		set A_O ='S01F'
	elseif A3O =='n0M4' then
		set A_O ='S015'
	elseif A3O =='np00' then
		set A_O ='S015'
	endif
	if GetRandomInt(1, 10)== 1 then
		set A_O ='S00G'
	endif
	if GetRandomInt(1, 10)< 3 then
		set A_O ='S016'
	endif
	if GetRandomInt(0, 50)< 3 then
		set A_O ='S0JH'
	endif
	if A3O =='n00M' then
		set A_O ='S00L'
	elseif A3O =='n0LS' then
		set A_O ='S00L'
	elseif A3O =='n0HV' then
		set A_O ='S00F'
	endif
	if A3O =='e01H' then
		set A_O ='S012'
	elseif A3O =='e01Z' then
		set A_O ='S010'
	elseif A3O =='e02R' then
		set A_O ='S014'
	elseif A3O =='e02T' then
		set A_O ='S011'
	elseif A3O =='e02S' then
		set A_O ='S017'
	elseif A3O =='e030' then
		set A_O ='S0SV'
	elseif A3O =='np01' then
		set A_O ='S013'
	endif
	call SavePlayerHandle(HY, h,'v',(p0))
	call SavePlayerHandle(HY, h,'w',(p1))
	call SavePlayerHandle(HY, h, 120,(p2))
	call SavePlayerHandle(HY, h, 121,(p3))
	call SavePlayerHandle(HY, h,'z',(p4))
	call SavePlayerHandle(HY, h,'{',(p5))
	call SaveInteger(HY, h,'j',(NVO))
	call SaveInteger(HY, h,'k',(NEO))
	call SaveInteger(HY, h,'l',(NXO))
	call SaveInteger(HY, h,'m',(NOO))
	call SaveInteger(HY, h, 110,(NRO))
	call SaveInteger(HY, h,'o',(NIO))
	call SaveInteger(HY, h,'p',(NAO))
	call SaveInteger(HY, h,'q',(NNO))
	call SaveInteger(HY, h, 114,(NBO))
	call SaveInteger(HY, h, 115,(NCO))
	call SaveInteger(HY, h, 116,(NDO))
	call SaveInteger(HY, h,'u',(NFO))
	call SaveUnitHandle(HY, h,'|',(A2O))
	call SaveInteger(HY, h, 125,(A_O))
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function AYO))
	set t = null
	set A2O = null
	set A4O = null
	set A5O = null
	set A6O = null
	set A7O = null
	set A8O = null
	set A9O = null
	set p0 = null
	set p1 = null
	set p2 = null
	set p3 = null
	set p4 = null
	set p5 = null
	set C1X = null
	return false
endfunction
function GQE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .05, false)
	call TriggerAddCondition(t, Condition(function A1O))
	call SaveUnitHandle(HY, h, 2,(GetTriggerUnit()))
	set t = null
endfunction
function NGO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit NHO =(LoadUnitHandle(HY, h,'|'))
	local integer A_O =(LoadInteger(HY, h, 125))
	local integer NVO =(LoadInteger(HY, h,'j'))
	local integer NEO =(LoadInteger(HY, h,'k'))
	local integer NXO =(LoadInteger(HY, h,'l'))
	local integer NOO =(LoadInteger(HY, h,'m'))
	local integer NRO =(LoadInteger(HY, h, 110))
	local integer NIO =(LoadInteger(HY, h,'o'))
	local player p0 =(LoadPlayerHandle(HY, h,'v'))
	local player p1 =(LoadPlayerHandle(HY, h,'w'))
	local player p2 =(LoadPlayerHandle(HY, h, 120))
	local player p3 =(LoadPlayerHandle(HY, h, 121))
	local player p4 =(LoadPlayerHandle(HY, h,'z'))
	local player p5 =(LoadPlayerHandle(HY, h,'{'))
	local integer NAO =(LoadInteger(HY, h,'p'))
	local integer NNO =(LoadInteger(HY, h,'q'))
	local integer NBO =(LoadInteger(HY, h, 114))
	local integer NCO =(LoadInteger(HY, h, 115))
	local integer NDO =(LoadInteger(HY, h, 116))
	local integer NFO =(LoadInteger(HY, h,'u'))
	call DisableTrigger(CUV)
	if GetTriggerEvalCount(t)== 1 then
		call UnitAddAbility(NHO, A_O)
		if W3[GetPlayerId(GetOwningPlayer(NHO))]== false then
			call SetUnitPeonType(NHO, false)
		else
			call SetUnitPeonType(NHO, true)
		endif
	else
		if NVO > 0 then
			set Z2 = CreateItem(NVO, GetUnitX(NHO), GetUnitY(NHO))
			call UnitAddItem(NHO, Z2)
			call SetItemPlayer(Z2, p0, false)
			call SetItemUserData(Z2, 1)
		endif
		if NAO > 0 then
			call SetItemCharges(Z2, NAO)
		endif
		if NEO > 0 then
			set Z2 = CreateItem(NEO, GetUnitX(NHO), GetUnitY(NHO))
			call UnitAddItem(NHO, Z2)
			call SetItemPlayer(Z2, p1, false)
			call SetItemUserData(Z2, 1)
		endif
		if NNO > 0 then
			call SetItemCharges(Z2, NNO)
		endif
		if NXO > 0 then
			set Z2 = CreateItem(NXO, GetUnitX(NHO), GetUnitY(NHO))
			call UnitAddItem(NHO, Z2)
			call SetItemPlayer(Z2, p2, false)
			call SetItemUserData(Z2, 1)
		endif
		if NBO > 0 then
			call SetItemCharges(Z2, NBO)
		endif
		if NOO > 0 then
			set Z2 = CreateItem(NOO, GetUnitX(NHO), GetUnitY(NHO))
			call UnitAddItem(NHO, Z2)
			call SetItemPlayer(Z2, p3, false)
			call SetItemUserData(Z2, 1)
		endif
		if NCO > 0 then
			call SetItemCharges(Z2, NCO)
		endif
		if NRO > 0 then
			set Z2 = CreateItem(NRO, GetUnitX(NHO), GetUnitY(NHO))
			call UnitAddItem(NHO, Z2)
			call SetItemPlayer(Z2, p4, false)
			call SetItemUserData(Z2, 1)
		endif
		if NDO > 0 then
			call SetItemCharges(Z2, NDO)
		endif
		if NIO > 0 then
			set Z2 = CreateItem(NIO, GetUnitX(NHO), GetUnitY(NHO))
			call UnitAddItem(NHO, Z2)
			call SetItemPlayer(Z2, p5, false)
			call SetItemUserData(Z2, 1)
		endif
		if NFO > 0 then
			call SetItemCharges(Z2, NFO)
		endif
		if W3[GetPlayerId(GetOwningPlayer(NHO))]== false then
			call SetUnitPeonType(NHO, false)
		else
			call SetUnitPeonType(NHO, true)
		endif
		call SetUnitFlyHeight(NHO,$F0, 0)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	call EnableTrigger(CUV)
	set t = null
	set NHO = null
	set p0 = null
	set p1 = null
	set p2 = null
	set p3 = null
	set p4 = null
	set p5 = null
	return false
endfunction
function NJO takes unit A2O returns nothing
	local integer A3O = GetUnitTypeId(A2O)
	local real x = GetUnitX(A2O)
	local real y = GetUnitY(A2O)
	local item A4O
	local item A5O
	local item A6O
	local item A7O
	local item A8O
	local item A9O
	local player p0
	local player p1
	local player p2
	local player p3
	local player p4
	local player p5
	local integer NVO
	local integer NEO
	local integer NXO
	local integer NOO
	local integer NRO
	local integer NIO
	local integer NAO =-1
	local integer NNO =-1
	local integer NBO =-1
	local integer NCO =-1
	local integer NDO =-1
	local integer NFO =-1
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer A_O
	local item C1X
	local integer i
	local item NKO
	set i = 0
	loop
	exitwhen i > 5
		set NKO = UnitItemInSlot(A2O, i)
		if UUV(NKO)== X4V then
			call UnitRemoveItem(A2O, NKO)
		endif
		set i = i + 1
	endloop
	set A4O = UnitItemInSlot(A2O, 0)
	set A5O = UnitItemInSlot(A2O, 1)
	set A6O = UnitItemInSlot(A2O, 2)
	set A7O = UnitItemInSlot(A2O, 3)
	set A8O = UnitItemInSlot(A2O, 4)
	set A9O = UnitItemInSlot(A2O, 5)
	set NVO = GetItemTypeId(A4O)
	set NEO = GetItemTypeId(A5O)
	set NXO = GetItemTypeId(A6O)
	set NOO = GetItemTypeId(A7O)
	set NRO = GetItemTypeId(A8O)
	set NIO = GetItemTypeId(A9O)
	set p0 = GetItemPlayer(A4O)
	set p1 = GetItemPlayer(A5O)
	set p2 = GetItemPlayer(A6O)
	set p3 = GetItemPlayer(A7O)
	set p4 = GetItemPlayer(A8O)
	set p5 = GetItemPlayer(A9O)
	set C1X = A4O
	if GetItemType(C1X)== ITEM_TYPE_ARTIFACT or HHX(UUV(C1X)) or(GetItemType(C1X)== ITEM_TYPE_CAMPAIGN and A0O(UUV(C1X))) then
		set NAO = GetItemCharges(C1X)
	endif
	set C1X = A5O
	if GetItemType(C1X)== ITEM_TYPE_ARTIFACT or HHX(UUV(C1X)) or(GetItemType(C1X)== ITEM_TYPE_CAMPAIGN and A0O(UUV(C1X))) then
		set NNO = GetItemCharges(C1X)
	endif
	set C1X = A6O
	if GetItemType(C1X)== ITEM_TYPE_ARTIFACT or HHX(UUV(C1X)) or(GetItemType(C1X)== ITEM_TYPE_CAMPAIGN and A0O(UUV(C1X))) then
		set NBO = GetItemCharges(C1X)
	endif
	set C1X = A7O
	if GetItemType(C1X)== ITEM_TYPE_ARTIFACT or HHX(UUV(C1X)) or(GetItemType(C1X)== ITEM_TYPE_CAMPAIGN and A0O(UUV(C1X))) then
		set NCO = GetItemCharges(C1X)
	endif
	set C1X = A8O
	if GetItemType(C1X)== ITEM_TYPE_ARTIFACT or HHX(UUV(C1X)) or(GetItemType(C1X)== ITEM_TYPE_CAMPAIGN and A0O(UUV(C1X))) then
		set NDO = GetItemCharges(C1X)
	endif
	set C1X = A9O
	if GetItemType(C1X)== ITEM_TYPE_ARTIFACT or HHX(UUV(C1X)) or(GetItemType(C1X)== ITEM_TYPE_CAMPAIGN and A0O(UUV(C1X))) then
		set NFO = GetItemCharges(C1X)
	endif
	call HZX(A4O)
	call HZX(A5O)
	call HZX(A6O)
	call HZX(A7O)
	call HZX(A8O)
	call HZX(A9O)
	if GetUnitTypeId(A2O)=='np00'then
		set A_O ='S020'
	else
		//	if IsSentinelsPlayer(GetOwningPlayer(A2O)) then
		if GetPlayerTeam(GetOwningPlayer(A2O)) == 0 then
			set A_O ='S00I'
		else
			set A_O ='S00J'
		endif
		if GetRandomInt(1, 3)== 1 then
			set A_O ='S00Z'
		endif
	endif
	call SavePlayerHandle(HY, h,'v',(p0))
	call SavePlayerHandle(HY, h,'w',(p1))
	call SavePlayerHandle(HY, h, 120,(p2))
	call SavePlayerHandle(HY, h, 121,(p3))
	call SavePlayerHandle(HY, h,'z',(p4))
	call SavePlayerHandle(HY, h,'{',(p5))
	call SaveInteger(HY, h,'j',(NVO))
	call SaveInteger(HY, h,'k',(NEO))
	call SaveInteger(HY, h,'l',(NXO))
	call SaveInteger(HY, h,'m',(NOO))
	call SaveInteger(HY, h, 110,(NRO))
	call SaveInteger(HY, h,'o',(NIO))
	call SaveInteger(HY, h,'p',(NAO))
	call SaveInteger(HY, h,'q',(NNO))
	call SaveInteger(HY, h, 114,(NBO))
	call SaveInteger(HY, h, 115,(NCO))
	call SaveInteger(HY, h, 116,(NDO))
	call SaveInteger(HY, h,'u',(NFO))
	call SaveUnitHandle(HY, h,'|',(A2O))
	call SaveInteger(HY, h, 125,(A_O))
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function NGO))
	set t = null
	set A2O = null
	set A4O = null
	set A5O = null
	set A6O = null
	set A7O = null
	set A8O = null
	set A9O = null
	set p0 = null
	set p1 = null
	set p2 = null
	set p3 = null
	set p4 = null
	set p5 = null
	set C1X = null
	set NKO = null
endfunction
function NLO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local item NMO = ACX(WUE, RealItemTypeId[BUV])
	local boolean Q0X = LoadBoolean(HY, h, 0)
	if Q0X == false then
		if NMO == null then
			set NMO = ACX(WUE, InvalidItemTypeId[BUV])
		endif
	endif
	if NMO != null or Q0X then
		if Q0X == false then
			call RemoveItem(NMO)
		endif
		call NJO(WUE)
	else
		call InterfaceErrorForPlayer(GetOwningPlayer(WUE), GetObjectName('n02Q'))
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	set NMO = null
	return false
endfunction
function NPO takes unit WUE, boolean Q0X returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call ASO(WUE)
	call TriggerRegisterTimerEvent(t, .05, false)
	call TriggerAddCondition(t, Condition(function NLO))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveBoolean(HY, h, 0, Q0X)
	set t = null
endfunction
function HPX takes nothing returns nothing
	call NPO(U2, true)
endfunction
function HDE takes nothing returns boolean
	if GetSpellAbilityId()=='A0GD' then
		call NPO(GetTriggerUnit(), false)
	endif
	return false
endfunction
function NQO takes nothing returns boolean
	local unit triggerUnit = GetTriggerUnit()
	local item C1X = GetManipulatedItem()
	local integer id = GetItemTypeId(C1X)
	local integer i
	if(id == RealItemTypeId[R4V]or id == RealItemTypeId[IAV]or id == RealItemTypeId[INV]) and IsUnitType(triggerUnit, UNIT_TYPE_HERO) then
		set C9V[GetPlayerId(GetOwningPlayer(triggerUnit))]= GetItemX(C1X)
		set DVV[GetPlayerId(GetOwningPlayer(triggerUnit))]= GetItemY(C1X)
	endif
	call RCO(triggerUnit, C1X)
	if(GetItemTypeId(C1X)== RealItemTypeId[NBV]or GetItemTypeId(C1X)== RealItemTypeId[NCV]) and IsMessengerUnit(triggerUnit) then
		call UnitRemoveItem(triggerUnit, C1X)
	elseif(GetItemTypeId(C1X))== RealItemTypeId[Item_MagicWand]and IsUnitType(triggerUnit, UNIT_TYPE_HERO) then
		// 如果拿了魔杖 还是英雄 设置
		set i = LoadInteger(HY, GetHandleId(triggerUnit), 750)
		if i > 0 then
			if(LoadBoolean(HY, GetHandleId(triggerUnit), 751))== false then
				call SaveBoolean(HY, GetHandleId(triggerUnit), 751, true)
				call SetItemCharges(C1X, i)
			endif
		endif
	elseif GetItemTypeId(C1X)== RealItemTypeId[AIV]and GetUnitTypeId(triggerUnit)!='n00L' and E8V == false then
		set E7V = triggerUnit
		set E8V = true
		call JSX("AegisOn", GetPlayerId(GetOwningPlayer(triggerUnit)))
		if(IsSentinelsPlayer(GetOwningPlayer(triggerUnit)) and GN == 0) or(IsScourgesPlayer(GetOwningPlayer(triggerUnit)) and GN == 1) then
			call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, CR[LocalId], JS[GetPlayerId(GetOwningPlayer(triggerUnit))]+ GetUnitName(triggerUnit)+ "|r " + GetObjectName('n0EQ'))
		else
			call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, CR[LocalId], JS[GetPlayerId(GetOwningPlayer(triggerUnit))]+ GetUnitName(triggerUnit)+ "|r " + "获得了不朽的守护!")
		endif
	elseif GetItemTypeId(C1X)== RealItemTypeId[BUV]and OPX(triggerUnit) then
		call NPO(triggerUnit, false)
	endif
	set triggerUnit = null
	set C1X = null
	return false
endfunction
function NSO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real YVX = LoadReal(HY, h, 0)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer c = LoadInteger(HY, h, 0)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call UnitRemoveAbility(u,'A0PV')
		call UnitRemoveAbility(u,'B07L')
		call RemoveSavedHandle(HY, GetHandleId(u),'TNGO')
		call DestroyTrigger(t)
		call FlushChildHashtable(HY, h)
	else
		if c > 0 then
			call SaveInteger(HY, h, 0, c -1)
			call SetWidgetLife(u, GetWidgetLife(u)+ YVX)
		else
			call UnitRemoveAbility(u,'A0PV')
			call UnitRemoveAbility(u,'B07L')
			call RemoveSavedHandle(HY, GetHandleId(u),'TNGO')
			call DestroyTrigger(t)
			call FlushChildHashtable(HY, h)
		endif
	endif
	set t = null
	set u = null
	return false
endfunction
function NTO takes real YVX returns nothing
	local trigger t
	local integer h
	local unit u = GetTriggerUnit()
	if HaveSavedHandle(HY, GetHandleId(u),'TNGO') then
		set t = LoadTriggerHandle(HY, GetHandleId(u),'TNGO')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, GetHandleId(u),'TNGO', t)
		call SaveUnitHandle(HY, h, 0, u)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerRegisterTimerEvent(t, 0, false)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerAddCondition(t, Condition(function NSO))
		call UnitAddPermanentAbility(u,'A0PV')
	endif
	call SaveReal(HY, h, 0, YVX * 1. / 16.)
	call SaveInteger(HY, h, 0, 16)
	set t = null
	set u = null
endfunction
function GSE takes nothing returns nothing
	if GetSpellTargetDestructable()!= null then
		if GetDestructableTypeId(GetSpellTargetDestructable()) == 'B005' then
			call NTO(230)
		else
			call NTO(115)
		endif
	elseif GetSpellTargetUnit()!= null then
		if IsUnitAlly(GetTriggerUnit(), GetOwningPlayer(GetSpellTargetUnit())) and(IsUnitType(GetSpellTargetUnit(), UNIT_TYPE_HERO) or IsBearUnit(GetSpellTargetUnit())) then
			call UnitAddItemById(GetSpellTargetUnit(), PowerUpItemTypeId[R1V])
		elseif IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetSpellTargetUnit())) and(GetUnitTypeId(GetSpellTargetUnit())=='oeye' or GetUnitTypeId(GetSpellTargetUnit())=='o004') then
			call NTO(230)
			call IOX(GetTriggerUnit(), GetSpellTargetUnit(), 2, 500, .0)
		else
			call CreateItem(PowerUpItemTypeId[R1V], GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit()))
		endif
	endif
endfunction
function NUO takes integer id, real x, real y returns nothing
	if IsPointInRegion(DNV, x, y)== false then
		set DIV = DIV + 1
		set DEV[DIV]= Player(id)
		set DXV[DIV]= x
		set DOV[DIV]= y
		set DRV[DIV]=(GetGameTime())
	endif
endfunction
function NWO takes integer id, real x, real y returns integer
	local real KGX =(GetGameTime())
	local integer i = 0
	local integer EVX = 0
	if IsPointInRegion(DNV, x, y) then
		return EVX
	endif
	loop
	exitwhen i > DIV
		if(KGX < DRV[i]+ 25) and(GetDistanceBetween(x, y, DXV[i], DOV[i])< ScrollOfTownPortal_Max_Range * 2 + 50) and IsPlayerAlly(Player(id), DEV[i]) then
			set EVX = EVX + 1
		endif
		set i = i + 1
	endloop
	return EVX
endfunction
function NYO takes integer ADX returns integer
	if ADX == GetPlayerId(Sentinels[1]) then
		return'h0BI'
	elseif ADX == GetPlayerId(Sentinels[2]) then
		return'h0BK'
	elseif ADX == GetPlayerId(Sentinels[3]) then
		return'h0BG'
	elseif ADX == GetPlayerId(Sentinels[4]) then
		return'h0BF'
	elseif ADX == GetPlayerId(Sentinels[5]) then
		return'h0BL'
	elseif ADX == GetPlayerId(Scourges[1]) then
		return'h0BH'
	elseif ADX == GetPlayerId(Scourges[2]) then
		return'h0BJ'
	elseif ADX == GetPlayerId(Scourges[3]) then
		return'h0BM'
	elseif ADX == GetPlayerId(Scourges[4]) then
		return'h0A5'
	elseif ADX == GetPlayerId(Scourges[5]) then
		return'h0BN'
	endif
	return'h0BN'
endfunction
function NZO takes integer ADX returns string
	if ADX == GetPlayerId(Sentinels[1]) then
		return"war3mapImported\\TeleportTarget_Blue.mdx"
	elseif ADX == GetPlayerId(Sentinels[2]) then
		return"war3mapImported\\TeleportTarget_Teal.mdx"
	elseif ADX == GetPlayerId(Sentinels[3]) then
		return"war3mapImported\\TeleportTarget_Purple.mdx"
	elseif ADX == GetPlayerId(Sentinels[4]) then
		return"war3mapImported\\TeleportTarget_Yellow.mdx"
	elseif ADX == GetPlayerId(Sentinels[5]) then
		return"war3mapImported\\TeleportTarget_Orange.mdx"
	elseif ADX == GetPlayerId(Scourges[1]) then
		return"war3mapImported\\TeleportTarget_Pink.mdx"
	elseif ADX == GetPlayerId(Scourges[2]) then
		return"war3mapImported\\TeleportTarget_Gray.mdx"
	elseif ADX == GetPlayerId(Scourges[3]) then
		return"war3mapImported\\TeleportTarget_LightBlue.mdx"
	elseif ADX == GetPlayerId(Scourges[4]) then
		return"war3mapImported\\TeleportTarget_DarkGreen.mdx"
	elseif ADX == GetPlayerId(Scourges[5]) then
		return"war3mapImported\\TeleportTarget_Brown.mdx"
	endif
	return"Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl"
endfunction
function N_O takes nothing returns boolean
	local real d
	local unit u = GetFilterUnit()
	local integer id = GetUnitTypeId(u)
	if IsUnitType(u, UNIT_TYPE_STRUCTURE) and GetWidgetLife(u)> 0 and GetUnitAbilityLevel(u,'Asud')== 0 and IsUnitAlly(u, GetOwningPlayer(W2)) and id !='ntav' and id!='u00S' and id!='ncop' and id!='emow' and id!='uzig' and IsUnitType(u, UNIT_TYPE_ANCIENT)== false then
		set d = GetDistanceBetween(TJ, RJ, GetUnitX(u), GetUnitY(u))
		if d < S2 then
			set S2 = d
			set U2 = u
		endif
	endif
	set u = null
	return false
endfunction
function N0O takes unit U6E, real x, real y returns unit
	local group g = LoginGroup(23)
	set U2 = null
	set W2 = U6E
	set S2 = 99999
	set TJ = x
	set RJ = y
	call GroupEnumUnitsInRange(g, x, y, 99999, Condition(function N_O))
	call LogoutGroup(g)
	set g = null
	return U2
endfunction

function GetUZ takes unit u returns real
	local integer lv = GetUnitAbilityLevel(u,'A0CY')
	local real r = 200
	if lv > 0 then
		set r = r * (1 + lv * 0.3)
	elseif GetUnitAbilityLevel(u,'Bblo') > 0 or GetUnitAbilityLevel(u,'B016') > 0 then
		set r = r * 1.3
	endif
	return r
endfunction

function GetpEffect takes unit u , real r returns effect
	set bj_lastCreatedEffect = AddSpecialEffect("Progressbar.mdx", GetUnitX(u), GetUnitY(u))
	call EXSetEffectSpeed(bj_lastCreatedEffect, 1 / r)
	call EXSetEffectSize(bj_lastCreatedEffect, 1.5)
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(u)) or IsObserver then
		call EXSetEffectZ(bj_lastCreatedEffect, EXGetEffectZ(bj_lastCreatedEffect)+ GetUZ(u)+ GetUnitDefaultFlyHeight(u))
	else
		call EXSetEffectZ(bj_lastCreatedEffect,-9999)
	endif
	return bj_lastCreatedEffect
endfunction

function tp_scroll_cast takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local unit N2O =(LoadUnitHandle(HY, h, 448))
	local unit N3O =(LoadUnitHandle(HY, h, 447))
	local ubersplat tp_ube =(LoadUbersplatHandle(HY, h, 131))
	local integer EVX =(LoadInteger(HY, h, 34))
	local real N5O =(LoadReal(HY, h, 57))
	local real KGX =(LoadReal(HY, h, 442))
	local integer id = GetPlayerId(GetOwningPlayer(triggerUnit))
	local integer miao
	local real jd
	local unit u
	if(GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED) then
		set jd = LoadReal(HY, h, 'jiao') + 10.00
		call SaveReal(HY, h, 'jiao', jd)
		call SetUnitFacing(LoadUnitHandle(HY, h, 'Uutx'), jd)
		set miao = LoadInteger(HY, h, 'miao')
		call SaveInteger(HY, h, 'miao', miao - 1)
		if(miao == 0) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetUnitX(triggerUnit), GetUnitY(triggerUnit)))
			call DestroyEffect(AddSpecialEffect(NZO(id), x, y))
			call DestroyEffect((LoadEffectHandle(HY, h, 176)))
			call EXSetEffectZ(LoadEffectHandle(HY, h, 'effe'),-9999)
			call DestroyEffect((LoadEffectHandle(HY, h, 'effe')))
			call SetUnitX(triggerUnit, x)
			call SetUnitY(triggerUnit, y)
			call PauseUnit(triggerUnit, true)
			call PauseUnit(triggerUnit, false)
			call KillDestructablesInCircle(x, y, 240)
		endif
	elseif GetTriggerEventId() == EVENT_UNIT_DEATH or GetSpellAbilityId() == 'A1R5'  then
		call SaveInteger(HY,(GetHandleId((triggerUnit))),(4256), 2)
		call EXSetEffectZ(LoadEffectHandle(HY, h, 'effe'),-9999)
		call DestroyEffect((LoadEffectHandle(HY, h, 'effe')))
		set u = LoadUnitHandle(HY, h,'Uutx')
		if IsBearUnit(u) == false then
			call ShowUnit(u, false)
			call SetUnitX(u,-7488)
			call SetUnitY(u, 7296)
		else
			call RemoveUnit(u)
		endif
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetUnitX(triggerUnit), GetUnitY(triggerUnit)))
		call DestroyEffect(AddSpecialEffect(NZO(id), x, y))
		call DestroyEffect((LoadEffectHandle(HY, h, 176)))
		if GetTriggerEventId() == EVENT_UNIT_DEATH then
			call IssueImmediateOrderById(triggerUnit, 851972)
		endif
		if LocalPlayer== GetOwningPlayer(triggerUnit) then
			call SelectUnit(Circle[GetPlayerId(GetOwningPlayer(triggerUnit))], false)
		endif
		call KillUnit(N2O)
		call KillUnit(N3O)
		call DestroyUbersplat(tp_ube)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set u = null
	set t = null
	set triggerUnit = null
	set N2O = null
	set N3O = null
	set tp_ube = null
	return false
endfunction
function tp_boots_cast takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local unit stg_u =(LoadUnitHandle(HY, h, 17))
	local real x = GetUnitX(stg_u)
	local real y = GetUnitY(stg_u)
	local ubersplat tp_ube =(LoadUbersplatHandle(HY, h, 131))
	local integer id = GetPlayerId(GetOwningPlayer(triggerUnit))
	local unit utx
	local real jd
	local integer miao
	local unit u
	if(GetTriggerEventId() == EVENT_GAME_TIMER_EXPIRED) then
		set utx = LoadUnitHandle(HY, h, 'Uutx')
		set jd = LoadReal(HY, h, 'jiao') + 10.00
		call SaveReal(HY, h, 'jiao', jd)
		call SetUnitFacing(utx, jd)
		set miao = LoadInteger(HY, h, 'miao')
		call SaveInteger(HY, h, 'miao', miao - 1)
		call SetUnitX(utx, x)
		call SetUnitY(utx, y)
		if(miao == 0) then
			call DestroyEffect((LoadEffectHandle(HY, h, 175)))
			call DestroyEffect((LoadEffectHandle(HY, h, 176)))
			call DestroyEffect((LoadEffectHandle(HY, h, 177)))
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl", GetUnitX(triggerUnit), GetUnitY(triggerUnit)))
			call EXSetEffectZ(LoadEffectHandle(HY, h, 'effe'),-9999)
			call DestroyEffect((LoadEffectHandle(HY, h, 'effe')))
			call SaveInteger(HY,(GetHandleId((triggerUnit))),(4256), 2)
			set u = LoadUnitHandle(HY, h,'Uutx')
			if IsBearUnit(u) == false then
				call ShowUnit(u, false)
				call SetUnitX(u,-7488)
				call SetUnitY(u, 7296)
			else
				call RemoveUnit(u)
			endif
			call DestroyUbersplat(tp_ube)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call SetUnitPeonType(stg_u, false)
			call SetUnitX(triggerUnit, GetUnitX(stg_u)-1)
			call SetUnitY(triggerUnit, GetUnitY(stg_u)-1)
			call PauseUnit(triggerUnit, true)
			call PauseUnit(triggerUnit, false)
			call KillDestructablesInCircle(x, y, 240)
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl", GetUnitX(triggerUnit), GetUnitY(triggerUnit)))
			if LocalPlayer== GetOwningPlayer(triggerUnit) then
				call SelectUnit(Circle[GetPlayerId(GetOwningPlayer(triggerUnit))], false)
			endif
		endif
	elseif GetTriggerEventId() == EVENT_WIDGET_DEATH or GetSpellAbilityId() == 'A231' or GetSpellAbilityId() == 'A3AG'  then
		call DestroyEffect((LoadEffectHandle(HY, h, 175)))
		call DestroyEffect((LoadEffectHandle(HY, h, 176)))
		call DestroyEffect((LoadEffectHandle(HY, h, 177)))
		call SetUnitPeonType(stg_u, false)
		call SaveInteger(HY,(GetHandleId((triggerUnit))),(4256), 2)
		call EXSetEffectZ(LoadEffectHandle(HY, h, 'effe'),-9999)
		call DestroyEffect((LoadEffectHandle(HY, h, 'effe')))
		set u = LoadUnitHandle(HY, h,'Uutx')
		if IsBearUnit(u) == false then
			call ShowUnit(u, false)
		else
			call RemoveUnit(u)
		endif
		call IssueImmediateOrderById(triggerUnit, 851972)
		call DestroyUbersplat(tp_ube)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if LocalPlayer== GetOwningPlayer(triggerUnit) then
			call SelectUnit(Circle[GetPlayerId(GetOwningPlayer(triggerUnit))], false)
		endif
	endif
	set t = null
	set triggerUnit = null
	set tp_ube = null
	set stg_u = null
	set utx = null
	set u = null
	return false
endfunction
function tp_texttag takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 0)
	local real tp_second = LoadReal(HY, h, 0)
	local real tri_ec = GetTriggerEvalCount(t)* .5 -0.5
	local texttag tt
	if GetTriggerEventId()== EVENT_UNIT_SPELL_ENDCAST or tri_ec >= tp_second then
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	else
		set tt = CreateTextTag()
		call SetTextTagText(tt, R2SW(tp_second -tri_ec, 1, 1), .03)
		call SetTextTagPosUnit(tt, triggerUnit, 0)
		call SetTextTagColorBJ(tt, 150, 75, 255, 15)
		call SetTextTagVelocity(tt, 0, .035)
		call SetTextTagFadepoint(tt, 3)
		call SetTextTagLifespan(tt, .5)
		call SetTextTagPermanent(tt, false)
		call SetTextTagVisibility(tt, IsUnitAlly(triggerUnit, LocalPlayer) or IsObserver)
	endif
	set tt = null
	set t = null
	set triggerUnit = null
endfunction
function SpellEffect__ScrollOfTownPortal takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local real x
	local real y
	local real a
	local trigger t
	local integer h
	local unit N2O
	local unit N3O
	local ubersplat tp_ube
	local integer id = GetPlayerId(GetOwningPlayer(triggerUnit))
	local integer EVX
	local real tp_second
	local trigger tt
	local real angle
	local unit utx
	local real flyheight
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SaveInteger(HY,(GetHandleId((triggerUnit))),(4256), 1)
	if LocalPlayer== GetOwningPlayer(triggerUnit) then
		call SelectUnit(Circle[id], true)
	endif
	if targetUnit == null then
		set x = GetSpellTargetX()
		set y = GetSpellTargetY()
		if x == C9V[id]and y == DVV[id] then
			if IsSentinelsPlayer(GetOwningPlayer(triggerUnit)) then
				set x = GetUnitX(SentinelsBuilding_FountainOfLife)
				set y = GetUnitY(SentinelsBuilding_FountainOfLife)
				set targetUnit = SentinelsBuilding_FountainOfLife
			else
				set x = GetUnitX(B7)
				set y = GetUnitY(B7)
				set targetUnit = B7
			endif
		endif
		set targetUnit = N0O(triggerUnit, x, y)
	else
		set x = GetUnitX(targetUnit)
		set y = GetUnitY(targetUnit)
	endif
	set angle = bj_RADTODEG * Atan2(y - GetUnitY(triggerUnit), x - GetUnitX(triggerUnit))
	if GetDistanceBetween(x, y, GetUnitX(targetUnit), GetUnitY(targetUnit))> ScrollOfTownPortal_Max_Range then
		set a = Atan2(y -GetUnitY(targetUnit), x -GetUnitX(targetUnit))
		set x = GetUnitX(targetUnit)+ ScrollOfTownPortal_Max_Range * Cos(a)
		set y = GetUnitY(targetUnit)+ ScrollOfTownPortal_Max_Range * Sin(a)
	elseif GetDistanceBetween(x, y, GetUnitX(targetUnit), GetUnitY(targetUnit))< 50 then
		set a = Atan2(y -GetUnitY(targetUnit), x -GetUnitX(targetUnit))
		set x = GetUnitX(targetUnit)+ 120* Cos(a)
		set y = GetUnitY(targetUnit)+ 120* Sin(a)
	endif
	if IsPointInRegion(R4, x, y) then
		set a = Atan2(y -GetUnitY(targetUnit), x -GetUnitX(targetUnit))
		set x = GetUnitX(targetUnit)+$C8* Cos(a)
		set y = GetUnitY(targetUnit)+$C8* Sin(a)
	endif
	set x = CoordinateX50(x)
	set y = CoordinateY50(y)
	if(IsUnitAlly(triggerUnit, LocalPlayer) and LocalPlayer!= GetOwningPlayer(triggerUnit)) or(MW and(LocalPlayer== VKV or LocalPlayer== VLV)) then
		call PingMinimapEx(x, y, 3, 255, 255, 255, false)
	endif
	set N3O = CreateUnit(GetOwningPlayer(triggerUnit), NYO(id), x, y, 0)
	set N2O = CreateUnit(GetOwningPlayer(triggerUnit),'h0AX', GetUnitX(triggerUnit), GetUnitY(triggerUnit), 0)
	set tp_ube = CreateUbersplat(GetUnitX(triggerUnit)+ 25 * Cos(225 * bj_DEGTORAD), GetUnitY(triggerUnit)+ 20 * Sin(225 * bj_DEGTORAD), "SCTP", 255, 255, 255, 255, false, false)
	call SetUbersplatRenderAlways(tp_ube, UnitVisibleToPlayer(triggerUnit, LocalPlayer))
	if Tp_Dummy[id]	== null or IsBearUnit(triggerUnit) then
		set utx = CreateUnit(Player(PLAYER_NEUTRAL_PASSIVE), GetUnitTypeId(triggerUnit), x, y, angle)
		if not IsBearUnit(triggerUnit) then
			set Tp_Dummy[id] = utx
			call SuspendHeroXP(utx, true)	
		endif
		call SetUnitX(utx, x)
		call SetUnitY(utx, y)
	else
		set utx = Tp_Dummy[id]
		call ShowUnit(utx, true)
		call SetUnitX(utx, x)
		call SetUnitY(utx, y)
	endif
	if GetUnitTypeId(utx) != GetUnitTypeId(triggerUnit) then
		call DzSetUnitID(utx, GetUnitTypeId(triggerUnit))
	endif
	call UnitAddAbility(utx, 'Arav')
	call UnitRemoveAbility(utx, 'Arav')
	call PauseUnit(utx, true)
	call EXSetUnitFacing(utx, angle)
	call UnitRemoveAbility(utx, 'Aloc')
	call UnitAddAbility(utx, 'Aloc')
	set flyheight = GetUnitDefaultFlyHeight(triggerUnit)
	if flyheight == 0.00 then
		set flyheight = flyheight + 150
	endif
	call SetUnitFlyHeight(utx, flyheight, 0.00)
	call SetUnitPathing(utx, false)
	call SetUnitVertexColor(utx, 128, 128, 128, 128)
	call SetUnitColor(utx, GetPlayerColor(GetOwningPlayer(triggerUnit)))
	//set EVX = NWO(GetPlayerId(GetOwningPlayer(triggerUnit)), x, y)
	set tp_second = 3
	//if EVX > 0 then
	//	set tp_second = 4.5 + .5 * EVX
	//endif
	call NUO(GetPlayerId(GetOwningPlayer(triggerUnit)), x, y)
	//if EVX > 0 then
	//	call SetUnitAnimationByIndex(N2O, 2)
	//	call SetUnitAnimationByIndex(N3O, 2)
	//endif
	//tp 漂浮文字
	call TriggerRegisterTimerEvent(t, tp_second -3, false)
	call TriggerRegisterTimerEvent(t, tp_second, false)
	set tt = CreateTrigger()
	call TriggerRegisterTimerEvent(tt, .5, true)
	call TriggerRegisterTimerEvent(tt, 0, false)
	call SaveUnitHandle(HY, GetHandleId(tt), 0, triggerUnit)
	call SaveReal(HY, GetHandleId(tt), 0, tp_second)
	
	//	endif
	call TriggerAddCondition(tt, Condition(function tp_texttag))
	call TriggerRegisterUnitEvent(tt, triggerUnit, EVENT_UNIT_SPELL_ENDCAST)
	set tt = null
	//tp 持续施法
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function tp_scroll_cast))
	call A8X(GetOwningPlayer(triggerUnit), tp_second, x, y, 200)
	call SaveReal(HY, h, 'jiao', angle)
	call SaveInteger(HY, h, 'miao', R2I(tp_second * 10))
	call SaveEffectHandle(HY, h,'effe', GetpEffect(triggerUnit, tp_second))
	call SaveEffectHandle(HY, h, 176,(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetUnitX(triggerUnit)+ 25 * Cos(225 * bj_DEGTORAD), GetUnitY(triggerUnit)+ 20 * Sin(225 * bj_DEGTORAD))))
	call SaveUnitHandle(HY, h, 447,(N3O))
	call SaveUnitHandle(HY, h, 448,(N2O))
	call SaveUnitHandle(HY, h, 'Uutx', (utx))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call SaveReal(HY, h, 442,(((GetGameTime()))* 1.))
	call SaveReal(HY, h, 57,((tp_second)* 1.))
	call SaveUbersplatHandle(HY, h, 131,(tp_ube))
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call SaveInteger(HY, h, 34, 0)
	call B1X(triggerUnit, HintSound, x, y, 2400)
	set triggerUnit = null
	set targetUnit = null
	set N2O = null
	set N3O = null
	set t = null
	set tp_ube = null
	set utx = null
endfunction
function BXO takes nothing returns boolean
	local real d
	local unit u = GetFilterUnit()
	if GetWidgetLife(u)> 0 and IsUnitIdType(GetUnitTypeId(u), UNIT_TYPE_HERO)== false and GetUnitAbilityLevel(u,'Asud')== 0 and(GetUnitAbilityLevel(u,'A04R')== 0 or GetUnitTypeId(u)=='nfoh' or GetUnitTypeId(u)=='ndfl') and IsUnitAlly(u, GetOwningPlayer(W2)) and GetOwningPlayer(u)!= NeutralPassivePlayer and IsUnitIllusion(u)== false then
		set d = GetDistanceBetween(TJ, RJ, GetUnitX(u), GetUnitY(u))
		if d < S2 then
			set S2 = d
			set U2 = u
		endif
	endif
	set u = null
	return false
endfunction
function BOO takes nothing returns boolean
	local real d
	if UnitIsDead(GetFilterUnit())== false and GetFilterUnit()!= GetTriggerUnit() and GetUnitAbilityLevel(GetFilterUnit(),'Asud')== 0 and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 or GetUnitTypeId(GetFilterUnit())=='nfoh' or GetUnitTypeId(GetFilterUnit())=='ndfl') and IsUnitAlly(GetFilterUnit(), GetOwningPlayer(W2)) and GetOwningPlayer(GetFilterUnit())!= NeutralPassivePlayer then
		set d = GetDistanceBetween(TJ, RJ, GetUnitX(GetFilterUnit()), GetUnitY(GetFilterUnit()))
		if d < S2 then
			set S2 = d
			set U2 = GetFilterUnit()
		endif
	endif
	return false
endfunction
function BRO takes unit U6E, real x, real y, boolean b returns unit
	local group g = LoginGroup(24)
	set U2 = null
	set W2 = U6E
	set S2 = 99999
	set TJ = x
	set RJ = y
	if b then
		call GroupEnumUnitsInRange(g, x, y, 99999, Condition(function BOO))
	else
		call GroupEnumUnitsInRange(g, x, y, 99999, Condition(function BXO))
	endif
	call LogoutGroup(g)
	return U2
endfunction
function boots_of_travel_recipe takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local unit stg_u = GetSpellTargetUnit()
	local real x
	local real y
	local real a
	local trigger t
	local integer h
	local ubersplat tp_ube
	local integer id = GetPlayerId(GetOwningPlayer(triggerUnit))
	local integer EVX
	local real tp_second
	local trigger tt
	local unit utx
	local real jd
	local real flyheight
	// tp 飞鞋 漂浮文字 三秒
	set tt = CreateTrigger()
	if LocalPlayer== GetOwningPlayer(triggerUnit) then
		call SelectUnit(Circle[id], true)
	endif
	call TriggerRegisterTimerEvent(tt, .5, true)
	call TriggerRegisterTimerEvent(tt, 0, false)
	call SaveUnitHandle(HY, GetHandleId(tt), 0, triggerUnit)
	call SaveReal(HY, GetHandleId(tt), 0, 3)
	
	call TriggerAddCondition(tt, Condition(function tp_texttag))
	call TriggerRegisterUnitEvent(tt, triggerUnit, EVENT_UNIT_SPELL_ENDCAST)
	set tt = null
	set t = CreateTrigger()
	set h = GetHandleId(t)
	if stg_u == null then
		set x = GetSpellTargetX()
		set y = GetSpellTargetY()
		if x == C9V[id]and y == DVV[id]then
			if IsSentinelsPlayer(GetOwningPlayer(triggerUnit)) then
				set x = GetUnitX(SentinelsBuilding_FountainOfLife)
				set y = GetUnitY(SentinelsBuilding_FountainOfLife)
				set stg_u = SentinelsBuilding_FountainOfLife
			else
				set x = GetUnitX(B7)
				set y = GetUnitY(B7)
				set stg_u = B7
			endif
		endif
		if GetSpellAbilityId()=='A3AG' then
			set stg_u = BRO(triggerUnit, x, y, true)
		else
			set stg_u = BRO(triggerUnit, x, y, false)
		endif
	endif
	set jd = bj_RADTODEG * Atan2(y - GetUnitY(triggerUnit), x - GetUnitX(triggerUnit))
	set x = GetUnitX(stg_u)
	set y = GetUnitY(stg_u)
	if(IsUnitAlly(triggerUnit, LocalPlayer) and LocalPlayer!= GetOwningPlayer(triggerUnit)) or(MW and(LocalPlayer== VKV or LocalPlayer== VLV)) then
		call PingMinimapEx(x, y, 3, 255, 255, 255, false)
	endif
	set tp_ube = CreateUbersplat(GetUnitX(triggerUnit)+ 25 * Cos(225 * bj_DEGTORAD), GetUnitY(triggerUnit)+ 20 * Sin(225 * bj_DEGTORAD), "SCTP", 255, 255, 255, 255, false, false)
	call SetUbersplatRenderAlways(tp_ube, UnitVisibleToPlayer(triggerUnit, LocalPlayer))
	if Tp_Dummy[id]	== null or IsBearUnit(triggerUnit) then
		set utx = CreateUnit(Player(PLAYER_NEUTRAL_PASSIVE), GetUnitTypeId(triggerUnit), x, y, jd)
		if IsBearUnit(triggerUnit) == false then
			set Tp_Dummy[id] = utx
			call SuspendHeroXP(utx, true)	
		endif
		call SetUnitX(utx, x)
		call SetUnitY(utx, y)
	else
		set utx = Tp_Dummy[id]
		call ShowUnit(utx, true)
		call SetUnitX(utx, x)
		call SetUnitY(utx, y)
	endif
	if GetUnitTypeId(utx) != GetUnitTypeId(triggerUnit) then
		call DzSetUnitID(utx, GetUnitTypeId(triggerUnit))
	endif
	call PauseUnit(utx, true)
	call UnitRemoveAbility(utx, 'Aloc')
	call UnitAddAbility(utx, 'Aloc')
	call EXSetUnitFacing(utx, jd)
	call UnitAddAbility(utx, 'Arav')
	call UnitRemoveAbility(utx, 'Arav')
	set flyheight = GetUnitDefaultFlyHeight(triggerUnit)
	if flyheight == 0 then
		set flyheight = flyheight + 150
	endif
	if IsUnitType(stg_u, UNIT_TYPE_STRUCTURE) then
		call SetUnitFlyHeight(utx, flyheight + 200, 0.00)
	else
		call SetUnitFlyHeight(utx, flyheight, 0.00)
	endif
	call SetUnitPathing(utx, false)
	call SetUnitVertexColor(utx, 128, 128, 128, 128)
	call SetUnitColor(utx, GetPlayerColor(GetOwningPlayer(triggerUnit)))
	set tp_second = 3
	call SetUnitPeonType(stg_u, true)
	// 飞鞋tp 持续施法 恒定三秒
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterDeathEvent(t, stg_u)
	call TriggerAddCondition(t, Condition(function tp_boots_cast))
	call SaveEffectHandle(HY, h,'effe', GetpEffect(triggerUnit, tp_second))
	call A8X(GetOwningPlayer(triggerUnit), tp_second, x, y, 200)
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call SaveUbersplatHandle(HY, h, 131,(tp_ube))
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call SaveUnitHandle(HY, h, 17,(stg_u))
	call SaveUnitHandle(HY, h, 'Uutx', (utx))
	call SaveInteger(HY, h, 'miao', 30)
	call SaveEffectHandle(HY, h, 175,(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTo.mdl", triggerUnit, "origin")))
	call SaveEffectHandle(HY, h, 176,(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", triggerUnit, "origin")))
	call SaveEffectHandle(HY, h, 177,(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTo.mdl", stg_u, "origin")))
	call B1X(triggerUnit, HintSound, x, y, 2400)
	set triggerUnit = null
	set stg_u = null
	set t = null
	set tp_ube = null
	set utx = null
endfunction
function SpellEffect__TownPortal takes nothing returns nothing
	if GetSpellAbilityId()=='A1R5' and not IsMessengerUnit(GetTriggerUnit()) then
		call SpellEffect__ScrollOfTownPortal()
	endif
	if GetSpellAbilityId()=='A231' or GetSpellAbilityId()=='A3AG' then
		call boots_of_travel_recipe()
	endif
endfunction
function BAO takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return i =='n00H' or i =='n00G' or i =='n00K' or i =='n00J' or i =='n00A' or i =='n006'
endfunction
function BNO takes nothing returns boolean
	if BAO(GetFilterUnit()) then
		if LoadInteger(VV, 0, 0)== LoadInteger(HY, GetHandleId(GetFilterUnit()), 784) then
			call KillUnit(GetFilterUnit())
		endif
	endif
	return false
endfunction
function GUE takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit BBO
	local unit BCO
	local integer BDO
	local integer BFO
	local group g = LoginGroup(25)
	local real a = GetUnitFacing(WJE)* bj_DEGTORAD
	local real x1 = GetUnitX(WJE)+ 50 * Cos(a)
	local real y1 = GetUnitY(WJE)+ 50 * Sin(a)
	local real x2 = GetUnitX(WJE)+ 50 * Cos(a)
	local real y2 = GetUnitY(WJE)+ 50 * Sin(a)
	local integer i = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetTriggerPlayer())],'A0A8')
	if GetSpellAbilityId()=='A0HB' then
		set BDO ='n00H'
		set BFO ='n00J'
	elseif GetSpellAbilityId()=='A0D3' then
		set BDO ='n00G'
		set BFO ='n00A'
	elseif GetSpellAbilityId()=='A0DF' then
		set BDO ='n00K'
		set BFO ='n006'
	endif
	call SaveInteger(VV, 0, 0, GetHandleId(WJE))
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(GetTriggerUnit()), Condition(function BNO))
	call LogoutGroup(g)
	set BBO = CreateUnit(GetOwningPlayer(WJE), BDO, x1, y1, GetUnitFacing(WJE))
	call SaveInteger(HY, GetHandleId(BBO), 784, GetHandleId(WJE))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", BBO, "origin"))
	call UnitApplyTimedLife(BBO,'BTLF', 40)
	set BCO = CreateUnit(GetOwningPlayer(WJE), BFO, x2, y2, GetUnitFacing(WJE))
	call SaveInteger(HY, GetHandleId(BCO), 784, GetHandleId(WJE))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", BCO, "origin"))
	call UnitApplyTimedLife(BCO,'BTLF', 40)
	if i > 0 then
		call UnitAddPermanentAbility(BBO,'A43C')
		call LodSystem_AddUnitExtraState(BBO, 20 +$A* i, STATE_SYSTEM_ATTACK)
		call LodSystem_AddUnitExtraState(BCO, 20 +$A* i, STATE_SYSTEM_ATTACK)
	endif
	set g = null
	set BBO = null
	set BCO = null
	set WJE = null
endfunction
function G_E takes nothing returns nothing
	call AddAbilityToTimed(GetTriggerUnit(),'A1CN', 1, 4, 0)
endfunction
function GWE takes nothing returns nothing
	local unit u = GetSpellTargetUnit()
	local integer WFV
	local integer TME = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))
	if IsSentinelsPlayer(Player(TME)) then
		call UnitShareVision(u, Scourges[0], false)
		call UnitShareVision(u, Scourges[1], false)
		call UnitShareVision(u, Scourges[2], false)
		call UnitShareVision(u, Scourges[3], false)
		call UnitShareVision(u, Scourges[4], false)
		call UnitShareVision(u, Scourges[5], false)
	else
		call UnitShareVision(u, Sentinels[0], false)
		call UnitShareVision(u, Sentinels[1], false)
		call UnitShareVision(u, Sentinels[2], false)
		call UnitShareVision(u, Sentinels[3], false)
		call UnitShareVision(u, Sentinels[4], false)
		call UnitShareVision(u, Sentinels[5], false)
	endif
	call UnitAddAbility(u,'ACrk')
	call I8X(u)
	call SetWidgetLife(u, 99999)
	set WFV = GetHandleId(GetTriggerUnit())
	call KillUnit(LoadUnitHandle(P, WFV,'ACch'))
	call SaveUnitHandle(P, WFV,'ACch', u)
	if GetUnitState(u, UNIT_STATE_MAX_LIFE)<$578 then
		call UnitAddMaxLife(u, R2I($578-GetUnitState(u, UNIT_STATE_MAX_LIFE)))
	endif
	set u = null
endfunction
function BGO takes integer i returns integer
	local integer level = LoadInteger(K, GetHandleId(GetOwningPlayer(GetTriggerUnit())),'0BKB')
	if(i =='A11F' or i =='A11E' or i =='A0S3' or i =='A11D' or i =='A11G' or i =='A11H')== false then
		return 0
	endif
	if level == 0 then
		return'A11B'
	elseif level == 9 then
		return'A11A'
	elseif level == 8 then
		return'A0S2'
	elseif level == 7 then
		return'A119'
	elseif level == 6 then
		return'A11C'
	elseif level == 5 then
		return'A118'
	endif
	return 0
endfunction
function BHO takes integer i returns integer
	local integer lv = LoadInteger(K, GetHandleId(GetOwningPlayer(GetTriggerUnit())),'0BKB')
	if lv == 0 then
		return 10
	else
		return lv
	endif
	return 0
endfunction

function BKO takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	//local unit dummy = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)

	local real duration = BHO(GetSpellAbilityId())


	call N1X(whichUnit, DBV, duration)
	call UnitMakeAbilityPermanent(whichUnit, true, DBV)
	call S9E(GetOwningPlayer(whichUnit), DBV, false)
	call UnitMakeAbilityPermanent(whichUnit, true,'A0S6')
	call UnitMakeAbilityPermanent(whichUnit, true,'A0S2')

	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl", whichUnit, "origin"))
	// 马甲放反魔法护盾
	//call UnitAddAbility(dummy, BGO(GetSpellAbilityId()))
	//call IssueTargetOrderById(dummy,$D00DA, whichUnit)
	// 驱散负面Buff
	call RemoveUnitBuff(whichUnit, false)
	// 驱散缴械
	call SkillImmunityDispel(whichUnit)
	// 小鸡BKB 3倍缩放
	if IsMessengerUnit(whichUnit) then
		call AddUnitModelScalePercentByDuration(whichUnit, duration, 2, 'A0S2', HTKEY_SCALE_BLACK_KING_BAR)
	else
		call AddUnitModelScalePercentByDuration(whichUnit, duration, 0.4, 'A0S2', HTKEY_SCALE_BLACK_KING_BAR)
	endif

	set whichUnit = null
	//set dummy = null
endfunction
function GYE takes nothing returns nothing
	if BGO(GetSpellAbilityId())> 0 then
		call BKO()
	endif
endfunction
function BLO takes nothing returns nothing
	if((LoadInteger(HY,(GetHandleId((GetEnumUnit()))),(4258)))== 1) then
		call InterfaceErrorForPlayer(GetOwningPlayer(GetEnumUnit()), GetObjectName('n02M')+ " " + GetUnitName(GetEnumUnit())+ " " + GetObjectName('n02S'))
	else
		if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
			call EPX(GetEnumUnit(), 4258, 25)
		endif
		call SetWidgetLife(GetEnumUnit(), GetWidgetLife(GetEnumUnit())+$FA)
	endif
endfunction
function GZE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local group g = LoginGroup(26)
	call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 925, Condition(function D1X))
	call ForGroup(g, function BLO)
	call LogoutGroup(g)
	set WUE = null
	set g = null
endfunction
function BMO takes nothing returns nothing
	if((LoadInteger(HY,(GetHandleId((GetEnumUnit()))),(4278)))== 1) then
		call InterfaceErrorForPlayer(GetOwningPlayer(GetEnumUnit()), GetObjectName('n02M'))
	else
		if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
			call EPX(GetEnumUnit(), 4278, 50)
		endif
		if GetUnitAbilityLevel(GetEnumUnit(),'B0BT')== 0 and GetUnitAbilityLevel(GetEnumUnit(),'B0BU')== 0 then
			call IssueTargetOrderById(DCV,$D00DA, GetEnumUnit())
		endif
	endif
endfunction
function BPO takes nothing returns boolean
	return IsUnitAlly(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit())
endfunction
function HFE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local group g = LoginGroup(27)
	set DCV = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(WUE), GetUnitY(WUE), 0)
	call UnitAddAbility(DCV,'A1EV')
	call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 525, Condition(function BPO))
	call ForGroup(g, function BMO)
	call LogoutGroup(g)
	set WUE = null
	set g = null
endfunction
function Item_SpellEffect_RefresherOrb takes nothing returns nothing
	local unit u = GetTriggerUnit()
	if GetSpellAbilityId()=='A02W' then
		call FlushChildHashtable(W, GetHandleId(u))
		//	call EXUnitResetCooldown(u)
		call EXUnitResetCooldown(u)
		call FixUnitSkillsBug(u)
	endif
endfunction
function BQO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local real IXX =(LoadReal(HY, h, 20))
	local integer id = LoadInteger(HY, h, 10)
	local integer bid
	local real damage
	if id == 'A3TP' then
		set bid = 'A4TP'
	else
		set bid = 'B031'
	endif
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED or GetUnitAbilityLevel(GetTriggerUnit(), bid)== 0 then
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitDamageTargetEx(WUE, targetUnit, 1, IXX)
		if IXX > 0 then
			call CommonTextTag("+" + I2S(R2I(IXX)), 1, targetUnit, .023, 255, 0, 0,$D8)
		endif
	elseif GetEventDamage() > 1 then
		if GetUnitAbilityLevel(GetTriggerUnit(), 'A4TP') > 0 and EXGetEventDamageData(1) != 0 and EXGetEventDamageData(4) == 4 then
			set damage = GetEventDamage()
			set damage = damage * 0.45
			call UnitDamageTargetEx(WUE, targetUnit, 2, damage)
			call CommonTextTag(I2S(R2I(damage))+ "!", 1, targetUnit, .025, 100, 200, 255, 255)
		endif
		if FK then
			call SaveReal(HY, h, 20, IXX + GetEventDamage()* .3)
		endif
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function BTO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer id = LoadInteger(HY, h, 10)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 30,(targetUnit))
	call SaveInteger(HY, h, 10, id)
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Silence\\SilenceTarget.mdl", targetUnit, "overhead")))
	call SaveReal(HY, h, 20, 0)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerRegisterTimerEvent(t, 5, false)
	call TriggerAddCondition(t, Condition(function BQO))
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function BUO takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function BTO))
	call SaveInteger(HY, h, 10, GetSpellAbilityId())
	call SaveUnitHandle(HY, h, 17,(GetSpellTargetUnit()))
	call SaveUnitHandle(HY, h, 2,(GetTriggerUnit()))
	set t = null
endfunction
function G1E takes nothing returns nothing
	if(GetSpellAbilityId()=='A0FD' or GetSpellAbilityId()=='A3TP') and not UnitHasSpellShield(GetSpellTargetUnit()) then
		call BUO()
	endif
endfunction
function BWO takes unit u, real d returns boolean
	if IsUnitType(u, UNIT_TYPE_HERO) or GetUnitAbilityLevel(u,'A04R')> 0 then
		return d > 5
	endif
	return true
endfunction
function BYO takes unit u returns unit
	local group g
	if GetUnitAbilityLevel(u,'A04R')== 0 then
		return u
	endif
	set U2 = GetTriggerUnit()
	set g = LoginGroup(28)
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 900, Condition(function DKX))
	set DDV = FirstOfGroup(g)
	call LogoutGroup(g)
	set g = null
	return DDV
endfunction
function BZO takes nothing returns nothing
	local unit u
	if SA > 0 then
		set SA = SA -1
		set u = CreateUnit(GetOwningPlayer(TA),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0)
		call UnitAddAbility(u,'A0K6')
		call IssueTargetOrderById(u,$D026B, GetEnumUnit())
		set u = null
	endif
endfunction
function B_O takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit
	local unit u = LoadUnitHandle(HY, h, 0)
	local group g
	if GetUnitAbilityLevel(u,'A3KI')== 0 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		set g = LoginGroup(29)
		set u =(LoadUnitHandle(HY, h, 2))
		set dummyUnit = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0)
		call EPX(GetTriggerUnit(), 4257, 1)
		call UnitAddAbility(dummyUnit,'A0K6')
		set TA = u
		set SA = 6
		call GroupEnumUnitsInRange(g, GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 925, Condition(function DQX))
		if GetDistanceBetweenUnits(GetTriggerUnit(), GetEventDamageSource())< 900 then
			if IssueTargetOrderById(dummyUnit,$D026B, BYO(GetEventDamageSource())) then
				set SA = 5
			endif
		endif
		call ForGroup(g, function BZO)
		call LogoutGroup(g)
		set g = null
	endif
	set t = null
	set dummyUnit = null
	set u = null
endfunction
function B0O takes nothing returns boolean
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED or(BWO(GetEventDamageSource(), GetEventDamage()) and IsUnitEnemy(GetEventDamageSource(), GetOwningPlayer(GetTriggerUnit())) and GetRandomInt(1, 100)< 21 and LoadInteger(HY, GetHandleId(GetTriggerUnit()), 4257)!= 1) then
		call B_O()
	endif
	return false
endfunction
function G2E takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	if WLE == null then
		set WLE = WJE
	endif
	call AddAbilityToTimed(WLE,'A3KI', 1, 15,'B3KI')
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterUnitEvent(t, WLE, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function B0O))
	call SaveUnitHandle(HY, h, 2,(WJE))
	call SaveUnitHandle(HY, h, 0, WLE)
	set t = null
	set WJE = null
	set WLE = null
endfunction
function ChainLightningActions takes unit R8X, unit WLE returns nothing
	local integer id = 0
	local integer probability = 0
	local unit W_V
	if GetUnitAbilityLevel(R8X,'A0JH')> 0 then
		set id ='A0JK'
		set probability = 25
	else
		set id ='A0FK'
		set probability = 25
	endif
	if GetPrdRandom(R8X, id, probability) then
		set W_V = CreateUnit(GetOwningPlayer(R8X),'e00E', GetUnitX(R8X), GetUnitY(R8X), 0)
		call UnitAddAbility(W_V, id)
		call IssueTargetOrderById(W_V,$D0097, WLE)
		set W_V = null
	endif
endfunction

function ManaDamge takes real value returns nothing
	local real mp = GetUnitState(DETargetUnit[DEI], UNIT_STATE_MANA)
	set value = RMinBJ(mp, value)
	if mp > 0 then
		call SetUnitState(DETargetUnit[DEI], UNIT_STATE_MANA, mp -value)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Feedback\\ArcaneTowerAttack.mdl", DETargetUnit[DEI], "origin"))
	endif
	set DEDamageValue[DEI] = DEDamageValue[DEI] + value
endfunction

function G4E takes nothing returns nothing
	local unit B5O = GetTriggerUnit()
	local item NMO = ACX(B5O, RealItemTypeId[BUV])
	if NMO == null then
		set NMO = ACX(B5O, InvalidItemTypeId[BUV])
	endif
	if NMO != null then
		call HZX(NMO)
		call UnitRemoveAbility(B5O,'A0VR')
		call UnitAddAbility(B5O,'A0VU')
		call SetUnitState(B5O, UNIT_STATE_MANA, 400)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIem\\AIemTarget.mdl", B5O, "origin"))
	else
		call InterfaceErrorForPlayer(GetOwningPlayer(B5O), GetObjectName('n02Q'))
	endif
	set B5O = null
	set NMO = null
endfunction
function B6O takes nothing returns nothing
	call UnitRemoveAbility(GetEnumUnit(),'BVA1')
	call UnitRemoveAbility(GetEnumUnit(),'BVA2')
	call UnitRemoveAbility(GetEnumUnit(),'BVA3')
	call UnitRemoveAbility(GetEnumUnit(),'BVA4')
endfunction
function B7O takes nothing returns boolean
	return IsUnitAlly(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit())
endfunction
function B8O takes nothing returns boolean
	return (B7O() and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO))
endfunction

function AddPermanentInvisibility takes unit u returns nothing
	local integer level = GetUnitAbilityLevel(u, 'A0MB')
	local custombuff b = custombuff.create(u, u)
	set b.aid = 'AWMB'
	set b.bid = 'BWMB'
	set b.overlayDur = true
	set b.level = level
	set b.deathDispel = false
	set b.basicDispel = false
	set b.removeActions = "PermanentInvisibility__RemoveBuff__Actions"
	set b.addActions = "PermanentInvisibility__AddBuff__Actions"
	call b.add_buff()
endfunction

function PermanentInvisibilityReset takes nothing returns nothing
	local integer h = GetHandleId(GetExpiredTimer())
	call AddPermanentInvisibility(LoadUnitHandle(HY, h, 0))
endfunction

function B9O takes unit whichUnit, player p, boolean b returns nothing
	local group g
	local integer level
	local real cooldown
	call SetPlayerAbilityAvailable(p,'A1J2', b)
	call SetPlayerAbilityAvailable(p,'A1IT', b)
	call SetPlayerAbilityAvailable(p,'A1J1', b)
	call SetPlayerAbilityAvailable(p,'A1J0', b)
	call SetPlayerAbilityAvailable(p,'A1IS', b)
	//call SetPlayerAbilityAvailable(p,'A34F', b)
	call SetPlayerAbilityAvailable(p,'A0AH', b)
	call SetPlayerAbilityAvailable(p,'A09E', b)

	set level = GetUnitAbilityLevel(whichUnit, 'A0MB')
	if level > 0 then
		set cooldown = 8 - level
		if level > 2 then
			set cooldown = cooldown - 1
		endif
		if b then
			call YDWESetUnitAbilityState(whichUnit, 'QP08', 1, cooldown)
			call TimerStart(LoadTimerHandle(ExtraHT, GetHandleId(whichUnit), 'A0MB'), cooldown, false, function PermanentInvisibilityReset )
		else
			call YDWESetUnitAbilityState(whichUnit, 'QP08', 1, 0)
			call PauseTimer(LoadTimerHandle(ExtraHT, GetHandleId(whichUnit), 'A0MB'))
			call UnitRemoveCustomBuffEx(whichUnit, 'BWMB')
		endif
	endif

	// 魔法抗性修正
	if b then

		set level = GetUnitAbilityLevel(whichUnit, 'A0KY') // 法术护盾
		// 0.18 + level * 0.08
		if level > 0 then
			call AddUnitMagicResistance(whichUnit, 0.18 + ( level ) * 0.08)
		endif
	
		set level = GetUnitAbilityLevel(whichUnit, 'A0MM') // 腐蚀外表
		// 0.05 + level * 0.05
		if level > 0 then
			call AddUnitMagicResistance(whichUnit, 0.05 + ( level ) * 0.05)
		endif
	
		set level = GetUnitAbilityLevel(whichUnit, 'A06D') // 腐肉堆积
		// 0.04 + level * 0.02
		if level > 0 then
			call AddUnitMagicResistance(whichUnit, 0.04 + ( level ) * 0.02)
		endif

	else

		set level = GetUnitAbilityLevel(whichUnit, 'A0KY') // 法术护盾
		// 0.18 + level * 0.08
		if level > 0 then
			call ReduceUnitMagicResistance(whichUnit, 0.18 + ( level ) * 0.08)
		endif
	
		set level = GetUnitAbilityLevel(whichUnit, 'A0MM') // 腐蚀外表
		// 0.05 + level * 0.05
		if level > 0 then
			call ReduceUnitMagicResistance(whichUnit, 0.05 + ( level ) * 0.05)
		endif
	
		set level = GetUnitAbilityLevel(whichUnit, 'A06D') // 腐肉堆积
		// 0.04 + level * 0.02
		if level > 0 then
			call ReduceUnitMagicResistance(whichUnit, 0.04 + ( level ) * 0.02)
		endif

	endif

	if b == false then
		call UnitRemoveAbility(whichUnit,'B03X')
	endif
	if b == false then
		call UnitRemoveAbility(whichUnit,'BOac')
	endif
	if b == false then
		call UnitRemoveAbility(whichUnit,'B01W')
	endif
	/*if GetUnitAbilityLevel(whichUnit,'P279')> 0 or GetUnitAbilityLevel(whichUnit,'A3BF')> 0 and IsUnitIllusion(whichUnit)== false then
		if b then
			call UnitRemoveAbility(whichUnit,'A3BF')
		else
			call UnitAddPermanentAbility(whichUnit,'A3BF')
			call SetAllPlayerAbilityUnavailable('A3BF')
		endif
	endif*/
	if b == false then
		call UnitRemoveAbility(whichUnit,'B00E')
	endif
	/*if GetUnitAbilityLevel(whichUnit,'P135')> 0 or GetUnitAbilityLevel(whichUnit,'A373')> 0 and IsUnitIllusion(whichUnit)== false then
		if b then
			call UnitRemoveAbility(whichUnit,'A374')
		else
			call UnitAddPermanentAbility(whichUnit,'A374')
			call SetAllPlayerAbilityUnavailable('A374')
		endif
	endif*/
	if b == false then
		call UnitRemoveAbility(whichUnit,'B07M')
	endif
	call SetPlayerAbilityAvailable(p,'P131', b)
	if GetUnitAbilityLevel(whichUnit,'P131')> 0 and IsUnitIllusion(whichUnit)== false then
		if b then
			call UnitRemoveAbility(whichUnit,'A375')
		else
			call UnitAddPermanentAbility(whichUnit,'A375')
			call SetUnitAbilityLevel(whichUnit,'A375', GetUnitAbilityLevel(whichUnit,'P131'))
		endif
	endif
	call SetPlayerAbilityAvailable(p,'A03B', b)
	call SetPlayerAbilityAvailable(p,'A0ZJ', b)
	call SetPlayerAbilityAvailable(p,'A0ZI', b)
	call SetPlayerAbilityAvailable(p,'A0ZH', b)
	call SetPlayerAbilityAvailable(p,'A0ZG', b)
	if b == false then
		call UnitRemoveAbility(whichUnit,'B09B')
		call UnitRemoveAbility(whichUnit,'B09A')
		call UnitRemoveAbility(whichUnit,'B097')
		call UnitRemoveAbility(whichUnit,'B09D')
	endif
	if b == false then
		call UnitRemoveAbility(whichUnit,'BVA1')
		call UnitRemoveAbility(whichUnit,'BVA2')
		call UnitRemoveAbility(whichUnit,'BVA3')
		call UnitRemoveAbility(whichUnit,'BVA4')
	endif
	if b == false then
		set g = LoginGroup(30)
		set U2 = whichUnit
		call GroupEnumUnitsInRange(g, GetUnitX(whichUnit), GetUnitY(whichUnit), 900, Condition(function B7O))
		call ForGroup(g, function B6O)
		call LogoutGroup(g)
	endif
endfunction
function CVO takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	call KillUnit(LoadUnitHandle(HY, GetHandleId(p),'brek'))
	call SaveUnitHandle(HY, GetHandleId(p),'brek', CreateUnit(p,'e00L', 0, 0, 0))
	call ShowUnit(LoadUnitHandle(HY, GetHandleId(p),'brek'), false)
	call PauseUnit(LoadUnitHandle(HY, GetHandleId(p),'brek'), true)
endfunction
function CEO takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	call KillUnit(LoadUnitHandle(HY, GetHandleId(p),'brek'))
endfunction
function CXO takes unit u returns nothing
	call B9O(u, GetOwningPlayer(u), true)
	call UnitRemoveAbility(u,'A36D')
	call UnitRemoveAbility(u,'B36D')
	if IsUnitType(u, UNIT_TYPE_HERO) then
		call CVO(u)
	endif
endfunction
function COO takes unit u returns nothing
	call B9O(u, GetOwningPlayer(u), false)
	if IsUnitType(u, UNIT_TYPE_HERO) then
		call CEO(u)
	endif
endfunction
function CRO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer c = LoadInteger(HY, h, 0)
	if GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		if c <= 1 then
			call RemoveSavedHandle(ExtraHT, GetHandleId(u), HTKEY_UNIT_BREAK)
			call FlushChildHashtable(HY, h)
			call DisableTrigger(t)
			call DestroyTrigger(t)
			call CXO(u)
		else
			call SaveInteger(HY, h, 0, c -1)
		endif
	else
		call RemoveSavedHandle(ExtraHT, GetHandleId(u), HTKEY_UNIT_BREAK)
		call FlushChildHashtable(HY, h)
		call DisableTrigger(t)
		call DestroyTrigger(t)
		call CXO(u)
	endif
	set t = null
	return false
endfunction

// 给单位在一定时间内添加破坏效果
function UnitAddBreakToTimed takes unit u, real time returns nothing
	local trigger t
	local integer h
	local integer hu = GetHandleId(u)
	if HaveSavedHandle(ExtraHT, hu, HTKEY_UNIT_BREAK) then
		set t = LoadTriggerHandle(ExtraHT, hu, HTKEY_UNIT_BREAK)
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, time, false)
		call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 1)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(ExtraHT, hu, HTKEY_UNIT_BREAK, t)
		call TriggerRegisterTimerEvent(t, time, false)
		call TriggerRegisterDeathEvent(t, u)
		call SaveInteger(HY, h, 0, 1)
		call SaveUnitHandle(HY, h, 0, u)
		call UnitAddPermanentAbility(u,'A36D')
		call TriggerAddCondition(t, Condition(function CRO))
		call COO(u)
	endif
	set t = null
endfunction
function CAO takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local group CNO = DFV
	local unit WUE = DGV
	if IsUnitInGroup(targetUnit, CNO)== false then
		call GroupAddUnit(CNO, targetUnit)
		call IssueTargetOrderById(DHV, 852075, targetUnit)
		call UnitDamageTargetEx(WUE, targetUnit, 1, 200)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl", targetUnit, "origin"))
	endif
	set targetUnit = null
	set CNO = null
	set WUE = null
endfunction
function CBO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local group CNO =(LoadGroupHandle(HY, h,$85))
	local real d
	local real x
	local real x0 = GetUnitX(WUE)
	local real y
	local real y0 = GetUnitY(WUE)
	local group g = LoginGroup(31)
	local integer EVX = GetTriggerEvalCount(t)
	local integer i
	call SetUnitX(dummyUnit, GetUnitX(WUE))
	call SetUnitY(dummyUnit, GetUnitY(WUE))
	set DFV = CNO
	set DGV = WUE
	set DHV =(LoadUnitHandle(HY, h,$84))
	if GetTriggerEvalCount(t)> 33 then
		call KillUnit(dummyUnit)
		call LogoutGroup(CNO)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set d = EVX * 21
		set i = 0
		loop
		exitwhen i > 36
			set x = x0 + d * Cos(360 * i / 36 * bj_DEGTORAD)
			set y = y0 + d * Sin(360 * i / 36 * bj_DEGTORAD)
			set U2 = WUE
			call GroupEnumUnitsInRange(g, x, y, 150, Condition(function DGX))
			call ForGroup(g, function CAO)
			set i = i + 1
		endloop
	endif
	call LogoutGroup(g)
	set t = null
	set dummyUnit = null
	set CNO = null
	set WUE = null
	set g = null
	return false
endfunction
function CCO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(t), 0),'BEim')
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTimer(t)
	set t = null
endfunction
function RemoveUnitBEim takes unit u returns nothing
	local timer t = CreateTimer()
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call TimerStart(t, 0, false, function CCO)
	set t = null
endfunction
function G3E takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local real x = GetUnitX(triggerUnit)
	local real y = GetUnitY(triggerUnit)
	local group CNO = LoginGroup(32)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'h091', x, y, 0)
	local unit CFO = CreateUnit(GetOwningPlayer(triggerUnit),'e00E', GetUnitX(triggerUnit), GetUnitY(triggerUnit), 0)
	call UnitAddAbility(CFO,'A0T0')
	call SaveGroupHandle(HY, h,$85,(CNO))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveUnitHandle(HY, h,$84,(CFO))
	call SaveUnitHandle(HY, h, 2,(triggerUnit))
	call TriggerRegisterTimerEvent(t, .06, true)
	call TriggerAddCondition(t, Condition(function CBO))
	call RemoveUnitBEim(triggerUnit)
	set t = null
	set CNO = null
	set dummyUnit = null
	set CFO = null
	set triggerUnit = null
endfunction
function SetMagicCharges takes unit whichUnit, integer charges returns nothing
	local integer h = GetHandleId(whichUnit)
	call SaveInteger(HY, h, 750, charges )
endfunction
// 获取魔棒的充能
function GetMagicCharges takes unit whichUnit returns integer
	local integer h = GetHandleId(whichUnit)
	return LoadInteger( HY, h, 750 )
endfunction

function G5E takes nothing returns nothing
	// 通过当前命令Id来得知按了哪个物品 之前那个遍历所有物品太坑爹
	local unit spellUnit = GetTriggerUnit()
	local item it = null
	local integer index = 0
	local integer charges = 0
	local integer iOrder = GetUnitCurrentOrder( spellUnit )
	local integer i = iOrder - 852008 
	set it = UnitItemInSlot(spellUnit, i)
	set index = GetItemIndex(it)
	if index == Item_MagicStick or index == Item_MagicWand then
		set charges = GetItemCharges(it)
		if charges > 0 then
			call SetItemCharges(it, 0)
			call SetMagicCharges(spellUnit, 0)
			//if not CJO then
			//	set CJO = true
			call SetUnitState(spellUnit, UNIT_STATE_MANA, GetUnitState(spellUnit, UNIT_STATE_MANA)+ 15 * charges)
			call SetWidgetLife(spellUnit, GetWidgetLife(spellUnit)+ 15 * charges)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIre\\AIreTarget.mdl", spellUnit, "origin"))
			//endif
		endif
	endif
	set it = null
	set spellUnit = null

endfunction
function CKO takes integer id returns boolean
	local integer i = 1
	loop
	exitwhen i > EHV
		if id == EGV[i]then
			return false
		endif
		set i = i + 1
	endloop
	return true
endfunction
// 给单位的魔棒充能 按顺序优先 78 45 12
// MagicStick Magic Wand
function MagicStickCharges takes unit whichUnit returns nothing
	local integer i = 0
	local integer c
	local integer id
	local integer maxCharges
	local item it
	loop
		set it = UnitItemInSlot(whichUnit, i)
		set id = GetItemIndex(it)
		if id == Item_MagicStick or id == Item_MagicWand then
			if id == Item_MagicStick then
				set maxCharges = 10
			else
				set maxCharges = 17
			endif
			set c = GetItemCharges(it)
			call SetMagicCharges(whichUnit, IMinBJ(c + 1, maxCharges))
			call SetItemCharges(it, IMinBJ(c + 1, maxCharges))
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl", whichUnit, "chest"))
			set i = 5
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	set it = null
endfunction
function CMO takes nothing returns nothing
	local group g = LoginGroup(33)
	local unit spellUnit = GetTriggerUnit()
	local unit firstUnit = null
	local real x = GetUnitX(spellUnit)
	local real y = GetUnitY(spellUnit)
	call GroupEnumUnitsInRange( g, x, y, 1225, null )
	loop
		set firstUnit = FirstOfGroup(g)
	exitwhen firstUnit == null
		call GroupRemoveUnit( g, firstUnit )
		// 英雄单位 敌人 存活 非建筑 非守卫 不是远古 但可以是熊灵 施法者对单位来是说可见的
		if UnitVisibleToPlayer( spellUnit, GetOwningPlayer(firstUnit)) and IsUnitType(firstUnit, UNIT_TYPE_HERO) and IsUnitEnemy(spellUnit, GetOwningPlayer(firstUnit)) and IsAliveNotStrucNotWard(firstUnit) and IsNoAncientOrBear(firstUnit) then
			call MagicStickCharges( firstUnit )
		endif
	endloop
	set firstUnit = null
	//call ForGroup(g, function CLO)
	call LogoutGroup(g)
	set g = null
	set spellUnit = null
endfunction
function CPO takes nothing returns nothing
	local integer id = GetSpellAbilityId()
	// 魔棒充能
	if id != 0 and IsNotItemAbility(id) and CKO(id) and GetUnitAbilityLevel(GetTriggerUnit(),'A04R')== 0 and not LNX(id) then
		call CMO()
	endif
endfunction
function CQO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit CSO =(LoadUnitHandle(HY, h,$86))
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call UnitRemoveAbility(CSO,'A17R')
		//call UnitRemoveAbility(CSO,'A24F')
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set CSO = null
	return false
endfunction
function CTO takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) and GetWidgetLife(GetFilterUnit())> .5 and IsUnitAlly(GetFilterUnit(), DJV) and GetOwningPlayer(GetFilterUnit())!= NeutralPassivePlayer and GetUnitTypeId(GetFilterUnit())!='ncop' and GetUnitTypeId(GetFilterUnit())!='n0FJ' and GetUnitTypeId(GetFilterUnit())!='n0FI' and GetUnitTypeId(GetFilterUnit())!='n0F6' and GetUnitTypeId(GetFilterUnit())!='n0FH'))
endfunction
function CUO takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit CSO = GetEnumUnit()
	local string s
	call UnitAddAbility(CSO,'A17R')
	//call UnitAddAbility(CSO,'A24F')
	if IsSentinelsPlayer(DJV) then
		set s = "effects\\GlyphSent.mdx"
	else
		set s = "effects\\GlyphScourge.mdx"
	endif
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget(s, CSO, "origin")))
	call SaveUnitHandle(HY, h,$86,(CSO))
	call TriggerRegisterUnitEvent(t, CSO, EVENT_UNIT_DEATH)
	call TriggerRegisterTimerEvent(t, 4, false)
	call TriggerAddCondition(t, Condition(function CQO))
	set t = null
	set CSO = null
endfunction
function CWO takes unit u, player p returns nothing
	local integer i
	local integer x = 1
	if IsSentinelsPlayer(p) then
		loop
		exitwhen x > 5
			set i = GetPlayerId(Sentinels[x])
			if u != Circle[i]then
				call YDWESetUnitAbilityState(Circle[i],'A141', 1, 300)
			endif
			set x = x + 1
		endloop
	else
		loop
		exitwhen x > 5
			set i = GetPlayerId(Scourges[x])
			if u != Circle[i]then
				call YDWESetUnitAbilityState(Circle[i],'A141', 1, 300)
			endif
			set x = x + 1
		endloop
	endif
endfunction
function GlyphCoolDown_Actions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 1)
	local real cd
	set cd = YDWEGetUnitAbilityState(u, 'A141', 1)
	if IsPlayerAlly(GetOwningPlayer(u), LocalPlayer) then
		if cd > 10 then
			call DzFrameSetText(GlyphFrame, I2S(R2I(cd)))
		elseif cd == 0 then
			call DzFrameSetText(GlyphFrame, " ")
		else
			call DzFrameSetText(GlyphFrame, R2SW(cd, 1, 1))
		endif
	endif
	if cd == 0 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	return false
endfunction
function GlyphCoolDown takes unit u returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 0.2, true)
	call TriggerRegisterTimerEvent(t, 0., false)
	call TriggerAddCondition(t, Condition(function GlyphCoolDown_Actions))
	call SaveUnitHandle(HY, GetHandleId(t), 1, u)
	set t = null
endfunction
function G8E takes nothing returns nothing
	local group g
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	if(IsSentinelsPlayer(p) and DKV == false) or(IsSentinelsPlayer(p)== false and DLV == false) then
		set g = LoginGroup(34)
		set DJV = p
		call GroupEnumUnitsInRange(g, 0, 0, 12000, Condition(function CTO))
		call ForGroup(g, function CUO)
		call LogoutGroup(g)
		if IsSentinelsPlayer(p) then
			set DKV = true
			call CWO(u, p)
			call GlyphCoolDown(u)
			set DKV = false
		else
			set DLV = true
			call CWO(u, p)
			call GlyphCoolDown(u)
			set DLV = false
		endif
		if(IsPlayerAlly(p, LocalPlayer) or(MW and IsObserver)) and p != LocalPlayer then
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 5, JS[GetPlayerId(p)]+ VMV[GetPlayerId((p))]+ "|r 开启了防御符文")
		endif
	endif
	set g = null
	set u = null
	set p = null
endfunction
function CYO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetTriggerEventId()== EVENT_UNIT_SPELL_CAST then
		call UnitRemoveAbility(GetTriggerUnit(),'A3CQ')
		call UnitRemoveAbility(GetTriggerUnit(),'A3K1')
		call UnitRemoveAbility(GetTriggerUnit(),'B09Y')
	endif
	call SetUnitPhaseMove( u, false )
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set u = null
	set t = null
	return false
endfunction
function CZO takes unit u returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_CAST)
	call TriggerRegisterTimerEvent(t, 2.5, false)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function CYO))
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SetUnitPhaseMove( u, true )
	if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
		call AddAbilityToTimed(u,'A3K1', 1, 2.5,'B09Y')
	else
		call AddAbilityToTimed(u,'A3CQ', 1, 2.5,'B09Y')
	endif
	set t = null
endfunction
function C_O takes unit u returns nothing
	if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
		call UZV(u,'I0T8')
	else
		call UZV(u,'I0TA')
	endif
endfunction
function G9E takes nothing returns nothing
	call RemoveUnitBEim(GetTriggerUnit())
	if GetUnitAbilityLevel(GetTriggerUnit(),'Bpsh')> 0 then
		call UnitRemoveAbility(GetTriggerUnit(),'Bpsh')
	endif
	//if IsUnitType(GetTriggerUnit(), UNIT_TYPE_FLYING) then
	call CZO(GetTriggerUnit())
	//else
	//	call C_O(GetTriggerUnit())
	//endif
endfunction

globals
	integer BladeMailCount = 0
endglobals

function BladeMailEnd takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer c = LoadInteger(HY, GetHandleId(u),'BMON')-1
	if c == 0 then
		call RemoveSavedBoolean(HY, GetHandleId(u),'BMON')
		call RemoveSavedInteger(HY, GetHandleId(u),'BMON')
		call UnitRemoveAbility(u,'A43C')
	else
		call SaveInteger(HY, GetHandleId(u),'BMON', c)
	endif
	set BladeMailCount = BladeMailCount - 1
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set u = null
	set t = null
	return false
endfunction
function Item_SpellEffect_BladeMail takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	call TriggerRegisterTimerEvent(t, 3.0, false)
	call TriggerAddCondition(t, Condition(function BladeMailEnd))
	call UnitAddPermanentAbility(WUE,'A43C')
	set BladeMailCount = BladeMailCount + 1
	call SaveBoolean(HY, GetHandleId(WUE),'BMON', true)
	call SaveInteger(HY, GetHandleId(WUE),'BMON', LoadInteger(HY, GetHandleId(WUE),'BMON')+ 1)
	call SaveUnitHandle(HY, h, 0, WUE)
	set t = null
	set WUE = null
endfunction
function C1O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit stg_u =(LoadUnitHandle(HY, h, 17))
	local real a =(LoadReal(HY, h, 137))
	local real d =(LoadReal(HY, h, 138))
	local real x = CoordinateX50(GetUnitX(stg_u)+ d / 10 * Cos(a * bj_DEGTORAD))
	local real y = CoordinateY50(GetUnitY(stg_u)+ d / 10 * Sin(a * bj_DEGTORAD))
	if GetTriggerEvalCount(t)== 11 or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl", x, y))
		if((LoadInteger(HY,(GetHandleId((stg_u))),(4306)))!= 1) and GetUnitAbilityLevel(stg_u,'B08V')== 0 then
			call KillDestructablesInCircle(x, y, 150)
			if IsUnitType(stg_u, UNIT_TYPE_HERO) then
				call SaveBoolean(K, GetHandleId(stg_u), 99, true)
			endif
			call SetUnitX(stg_u, x)
			call SetUnitY(stg_u, y)
		endif
	endif
	set stg_u = null
	set t = null
	return false
endfunction
function C2O takes unit stg_u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x
	local real y
	local real d
	local real a
	local integer i =-1
	local boolean C3O = false
	call EPX(stg_u, 4414, 3)
	set a = GetUnitFacing(stg_u)
	loop
	exitwhen C3O or i == 23
		set x = CoordinateX50(GetUnitX(stg_u)+(600 -i * 25)* Cos(a * bj_DEGTORAD))
		set y = CoordinateY50(GetUnitY(stg_u)+(600 -i * 25)* Sin(a * bj_DEGTORAD))
		if(IsPointInRegion(R4,((x)* 1.),((y)* 1.)))== false then
			set C3O = true
		endif
		set i = i + 1
	endloop
	set d = GetDistanceBetween(x, y, GetUnitX(stg_u), GetUnitY(stg_u))
	call TriggerRegisterTimerEvent(t, .04, true)
	call TriggerRegisterDeathEvent(t, stg_u)
	call TriggerAddCondition(t, Condition(function C1O))
	call SaveUnitHandle(HY, h, 17,(stg_u))
	call SaveReal(HY, h, 137,((a)* 1.))
	call SaveReal(HY, h, 138,((d)* 1.))
	set t = null
endfunction
function C4O takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO))!= null
endfunction
function C5O takes unit u returns nothing
	local group g = LoginGroup(35)
	set U2 = GetTriggerUnit()
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u)+ 70, 76, Condition(function C4O))
	if FirstOfGroup(g)!= null then
		call C2O(FirstOfGroup(g))
	endif
	call LogoutGroup(g)
	set g = null
endfunction

function FixAttackTargetActions takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit sourceUnit = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	if UnitAlive(sourceUnit) and UnitAlive(targetUnit) and not IsAttackOrdersId(GetUnitCurrentOrder(sourceUnit)) then
		call IssueTargetOrderById(sourceUnit, 851983, targetUnit)
	endif
	call PauseTimer(t)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set sourceUnit = null
	set targetUnit = null
	set t = null
endfunction

function FixAttackTarget takes unit sourceUnit, unit targetUnit returns nothing
	local integer h = TimerStartSingle(0.00, function FixAttackTargetActions)
	call SaveUnitHandle(HY, h, 0, sourceUnit)
	call SaveUnitHandle(HY, h, 1, targetUnit)
endfunction

function HurricaneThrustSetEffect takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit target = LoadUnitHandle(HY, h, 1)
	local integer hu = GetHandleId(u) 
	local integer id
	// 是有效时间
	if LoadReal(ExtraHT, hu, HTKEY_HURRICANE_THRUST_COUNT) > 0 then
		if GetTriggerEventId()== EVENT_UNIT_ACQUIRED_TARGET then
			call DisableTrigger(t)
			call HurricaneThrustSetAttackRange(u, GetEventTargetUnit() == target)
			call EnableTrigger(t)
		else
			set id = GetIssuedOrderId()
			// 攻击 或 右键
			if id == 851983 or id == 851971 then 
				call DisableTrigger(t)
				call HurricaneThrustSetAttackRange(u, GetOrderTargetUnit()== target)
				call EnableTrigger(t)
			endif
		endif
	endif
	if GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if LoadBoolean(ExtraHT, hu, HTKEY_HURRICANE_THRUST_COUNT) then
			call HurricaneThrustSetAttackRange(u, false)
			call RemoveSavedInteger(ExtraHT, hu, HTKEY_HURRICANE_THRUST_COUNT)
			call RemoveSavedReal(ExtraHT, hu, HTKEY_HURRICANE_THRUST_COUNT)
			call RemoveSavedBoolean(ExtraHT, hu, HTKEY_HURRICANE_THRUST_COUNT)
			call RemoveSavedHandle(ExtraHT, hu, HTKEY_HURRICANE_THRUST_COUNT)
		endif
	endif
	set target = null
	set u = null
	set t = null
endfunction

function CreateHurricaneThrustTrigger takes unit u, unit target returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call HurricaneThrustSetAttackRange(u, true)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveUnitHandle(HY, h, 1, target)
	call TriggerRegisterTimerEvent(t, 5., false)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ACQUIRED_TARGET)
	call TriggerAddCondition(t, Condition(function HurricaneThrustSetEffect))
	set t = null
endfunction

function YRQEQ takes player p, player t returns nothing
	call SaveReal(HY, GetHandleId(t), GetPlayerId(p)+'buff', GetGameTime())
endfunction
function QTRUW takes unit u returns boolean
	return LoadBoolean(HY, GetHandleId(u), 4306) or LoadBoolean(HY, GetHandleId(u), 4307)
endfunction
function QTTQW takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WWUTQ =(LoadUnitHandle(HY, h, 17))
	local real TWQUQ =(LoadReal(HY, h, 137))
	local real RTRWQ =(LoadReal(HY, h, 138))
	local real dx
	local real dy
	local integer c = GetTriggerEvalCount(t)
	local integer hu = GetHandleId(WWUTQ)
	if c == 11 or GetTriggerEventId()== EVENT_WIDGET_DEATH or LoadInteger(HY, hu, 4260)== 1 or LoadInteger(HY, hu,'ublo')== 1 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if(not QTRUW(WWUTQ)) and(LoadInteger(HY, hu, 4324)!= 1) then
			//call H5O(WWUTQ,4414,0.1)
			set dx = CoordinateX50(GetUnitX(WWUTQ)+ RTRWQ / 10. * Cos(TWQUQ * bj_DEGTORAD))
			set dy = CoordinateY50(GetUnitY(WWUTQ)+ RTRWQ / 10. * Sin(TWQUQ * bj_DEGTORAD))
			call DestroyEffect(AddSpecialEffect(LoadStr(HY, h, 12), dx, dy))
			call SetUnitX(WWUTQ, dx)
			call SetUnitY(WWUTQ, dy)
			if c == 10 then
				//call K2X(WWUTQ)
			endif
		endif
	endif
	set WWUTQ = null
	set t = null
	return false
endfunction
function QTTWW takes unit WEEUQ, unit WWUTQ, real TWRRQ, real QEEQQ, unit QTTEW returns nothing
	local trigger t
	local integer h
	local real x
	local real y
	local real RTRWQ
	local real TWQUQ
	local integer i =-1
	local boolean b = false
	local real QTTRW
	local real QTTTW
	local real dx
	local real dy
	if GetUnitAbilityLevel(WWUTQ,'A32U')!= 0 then
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	if WWUTQ == null and GetSpellTargetItem()!= null then
		set WWUTQ = WEEUQ
	endif
	if QTTEW != null then
		set TWQUQ = AngleBetweenUnit(WEEUQ, WWUTQ)
		if WEEUQ == WWUTQ then
			set TWQUQ = AngleBetweenUnit(QTTEW, WEEUQ)
		endif
	else
		set TWQUQ = GetUnitFacing(WWUTQ)
	endif
	set QTTRW = Cos(TWQUQ * bj_DEGTORAD)
	set QTTTW = Sin(TWQUQ * bj_DEGTORAD)
	set dx = GetUnitX(WWUTQ)
	set dy = GetUnitY(WWUTQ)
	set x = CoordinateX50(dx +(TWRRQ -i * 25)* QTTRW)
	set y = CoordinateY50(dy +(TWRRQ -i * 25)* QTTTW)
	if IsUnitAlly(WWUTQ, GetOwningPlayer(GetTriggerUnit())) then
		if IsUnitType(WWUTQ, UNIT_TYPE_HERO) then
			call YRQEQ(GetOwningPlayer(GetTriggerUnit()), GetOwningPlayer(WWUTQ))
		endif
	endif
	set RTRWQ = SquareRoot((x -GetUnitX(WWUTQ))*(x -GetUnitX(WWUTQ))+(y -GetUnitY(WWUTQ))*(y -GetUnitY(WWUTQ)))
	call TriggerRegisterTimerEvent(t, QEEQQ / 10., true)
	call TriggerRegisterDeathEvent(t, WWUTQ)
	call TriggerAddCondition(t, Condition(function QTTQW))
	call SaveUnitHandle(HY, h, 17,(WWUTQ))
	call SaveReal(HY, h, 137,((TWQUQ)* 1.0))
	call SaveReal(HY, h, 138,((RTRWQ)* 1.0))
	call SaveStr(HY, h, 12, "Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl")
	set WWUTQ = null
	set t = null
endfunction

//大推推 目标敌人
function Item_SpellEffect_HurricaneThrust takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local unit spellTargetUnit = GetSpellTargetUnit()
	local integer h
	if GetUnitTypeId(whichUnit)!='e00E'then
		if GetUnitAbilityLevel(spellTargetUnit,'A32U')== 0 then
			call QTTWW(whichUnit, spellTargetUnit, 450., 0.2, spellTargetUnit)
			call QTTWW(whichUnit, whichUnit, 450., 0.2, spellTargetUnit)
		endif
	else
		set whichUnit = LoadUnitHandle(HY, GetHandleId(whichUnit), 0)
	endif
	set h = GetHandleId(whichUnit)
	if whichUnit != null then
		call SaveReal(ExtraHT, h, HTKEY_HURRICANE_THRUST_COUNT, GetGameTime()+ 5.) // 到期时间
		call FixAttackTarget(whichUnit, spellTargetUnit)
		call CreateHurricaneThrustTrigger(whichUnit, spellTargetUnit)
		call SaveInteger(ExtraHT, h, HTKEY_HURRICANE_THRUST_COUNT, 4) // 持续攻击数
		call SaveUnitHandle(ExtraHT, h, HTKEY_HURRICANE_THRUST_COUNT, spellTargetUnit)
	endif
	set whichUnit = null
	set spellTargetUnit = null
endfunction

function Item_SpellEffect_ForceStaff takes nothing returns nothing
	local unit u = GetSpellTargetUnit()
	local unit WJE = GetTriggerUnit()
	local boolean C6O
	if GetSpellTargetItem()!= null then
		set u = WJE
	endif
	set C6O = R3X(GetUnitTypeId(u))
	if GetUnitTypeId(u)!='n00L' and GetUnitAbilityLevel(u,'B0FG')== 0 and LoadBoolean(HY, GetHandleId(u), 4306)== false then
		if C6O then
			call C2O(u)
		elseif GetUnitAbilityLevel(u,'A04R')> 0 and GetUnitMoveSpeed(u)== 0 then
			call C5O(u)
		elseif IsUnitEnemy(u, GetOwningPlayer(WJE)) then
			if UnitHasSpellShield(u)== false then
				call C2O(u)
			endif
		elseif IsUnitAlly(u, GetOwningPlayer(WJE)) and(LoadBoolean(HY, GetHandleId(GetOwningPlayer(u)),$8B)== false or GetOwningPlayer(u)== GetOwningPlayer(WJE)) then
			call C2O(u)
		endif
	endif
	set u = null
	set WJE = null
endfunction
//大推推
function Item_SpellEffect_HurricanePike takes nothing returns nothing
	local unit targetUnit = GetSpellTargetUnit()
	if IsUnitAlly(targetUnit, GetTriggerPlayer()) or GetSpellTargetItem()!= null or GetUnitTypeId(targetUnit)=='n00L' then
		call Item_SpellEffect_ForceStaff() //推推棒
	elseif GetUnitAbilityLevel(targetUnit,'B0BI')== 0 then
		call Item_SpellEffect_HurricaneThrust()
	endif
	set targetUnit = null
endfunction
function HOE takes nothing returns nothing
	local unit d
	if GetSpellTargetItem()!= null then
		set d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0)
		call UnitAddAbility(d,'AIpg')
		call IssueTargetOrderById(d, 852111, GetTriggerUnit())
		call RemoveUnitBuff(d, false)
		set d = null
	endif
endfunction
function C7O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	if(GetTriggerEvalCount(t)> 30) or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call UnitRemoveAbility(WUE,'A1QC')
		call UnitRemoveAbility(WUE,'B0CY')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set WUE = null
	set t = null
	return false
endfunction
function C8O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	if(GetTriggerEvalCount(t)> LoadInteger(HY, h, 2)) then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set WUE = null
	set t = null
	return false
endfunction
function C9O takes unit u, boolean DVO returns nothing
	local unit WUE = u
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer c = 40
	if DVO then
		set c = 30
	endif
	call AddAbilityToTimed(WUE,'Aetl', 1, R2I(c /$A), 0)
	call S9E(GetOwningPlayer(WUE),'Aetl', false)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function C8O))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveInteger(HY, h, 2, c)
	set WUE = null
	set t = null
endfunction
function DEO takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit WUE = U2
	local unit targetUnit = W2
	local real IXX =(LoadReal(HY, h, 20))
	local trigger t
	if WUE != targetUnit then
		call C9O(targetUnit, LoadBoolean(HY, h, 0))
		if LoadBoolean(HY, h, 0) then
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call AddAbilityToTimed(targetUnit,'A1QB', 1, 4,'B0CY')
			call TriggerRegisterTimerEvent(t, .1, true)
			call TriggerRegisterDeathEvent(t, targetUnit)
			call TriggerAddCondition(t, Condition(function C7O))
			call SaveUnitHandle(HY, h, 2,(targetUnit))
			call CommonTextTag("+" + I2S(R2I(IXX)), 2, targetUnit, .027, 3,$D8, 120,$D8)
			call UnitDamageTargetEx(WUE, targetUnit, 1, IXX)
		endif
	endif
	call C9O(WUE, LoadBoolean(HY, h, 0))
	set t = null
	set WUE = null
	set targetUnit = null
endfunction
function DXO takes boolean b, unit targetUnit returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t2
	local integer DOO
	local integer DRO
	local real O3O
	set t2 = NHX(WUE, targetUnit,'h0BS', "DEO", 1200, false)
	set DOO = GetHandleId(t2)
	set DRO = GetHeroPrimaryAttributesType(WUE)
	if b then
		if DRO == 2 then
			set O3O = GetHeroInt(WUE, true)* 2. + 75
		elseif DRO == 3 then
			set O3O = GetHeroAgi(WUE, true)* 2. + 75
		elseif DRO == 1 then
			set O3O = GetHeroStr(WUE, true)* 2. + 75
		endif
		call SaveReal(HY,(DOO), 20, O3O)
	endif
	call SaveBoolean(HY, DOO, 0, b)
	set WUE = null
	set t2 = null
endfunction
function HKE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit t = GetSpellTargetUnit()
	local item it = GetSpellTargetItem()
	local boolean b
	if it != null then
		set t = u
	endif
	set it = null
	if GetSpellAbilityId()=='A1QD' and(UnitHasSpellShield(t)== false or IsUnitAlly(u, GetOwningPlayer(t))) and IsMagicImmuneUnit(t)== false then
		call DXO(IsUnitEnemy(u, GetOwningPlayer(t)), t)
	endif
	set u = null
	set t = null
endfunction
function DIO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	if GetTriggerEvalCount(t)> 40 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif(IsMagicImmuneUnit(WUE) and IsUnitType(WUE, UNIT_TYPE_HERO)) then
		call UnitRemoveAbility(WUE,'Aetl')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set WUE = null
	set t = null
	return false
endfunction
function DAO takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t
	local integer h
	if IsMessengerUnit(WUE)== false then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call AddAbilityToTimed(WUE,'Aetl', 1, 4, 0)
		call S9E(GetOwningPlayer(WUE),'Aetl', false)
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerAddCondition(t, Condition(function DIO))
		call SaveUnitHandle(HY, h, 2,(WUE))
	endif
	set WUE = null
	set t = null
endfunction
function HRE takes nothing returns nothing
	if GetSpellAbilityId()=='A1AC' and(IsMagicImmuneUnit(GetTriggerUnit())== false or IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO)== false) then
		call DAO()
	endif
endfunction
function DNO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local real DBO =(LoadReal(HY, h, 529))
	local real DCO =(LoadReal(HY, h, 530))
	local real DDO = GetUnitState(WUE, UNIT_STATE_MANA)
	local real DFO = GetUnitState(WUE, UNIT_STATE_MAX_MANA)
	local real DGO =(LoadReal(HY, h, 668))
	local real DHO = GetUnitStatePercent(WUE, UNIT_STATE_MANA, UNIT_STATE_MAX_MANA)
	local real DJO =(DGO -DHO)/  100 
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEvalCount(t)== 20 *$A then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if DBO <$96 then
			call SetUnitState(WUE, UNIT_STATE_MANA, DDO -($96-DBO -DCO))
		endif
	else
		if DJO > 0 then
			set DBO = DBO + DJO * DFO
			if DCO > 0 then
				if DJO * DFO > DCO then
					call SetUnitState(WUE, UNIT_STATE_MANA, DDO + DCO)
					set DCO = 0
				else
					if DCO >(DFO -DDO) then
						set DCO = DCO -(DFO -DDO)
						call SetUnitState(WUE, UNIT_STATE_MANA, DFO)
					else
						set DCO = DCO -DJO * DFO
						call SetUnitState(WUE, UNIT_STATE_MANA, DDO + DJO * DFO)
					endif
				endif
			endif
		endif
		set DGO = DHO
		call SaveReal(HY, h, 668,((DGO)* 1.))
		call SaveReal(HY, h, 529,((DBO)* 1.))
		call SaveReal(HY, h, 530,((DCO)* 1.))
	endif
	set t = null
	set WUE = null
	return false
endfunction
function HJE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local real DKO = GetWidgetLife(WUE)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real DDO = GetUnitState(WUE, UNIT_STATE_MANA)
	if DKO >$97 then
		call SetWidgetLife(WUE, DKO -$96)
	else
		call SetWidgetLife(WUE, 1)
	endif
	call AddSpecialEffectTargetToTimed("Abilities\\Spells\\Orc\\SpiritLink\\SpiritLinkZapTarget.mdl", WUE, "origin", 2)
	call SetUnitState(WUE, UNIT_STATE_MANA, DDO +$96)
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerAddCondition(t, Condition(function DNO))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveReal(HY, h,$F2,((GetUnitState(WUE, UNIT_STATE_MANA))* 1.))
	call SaveReal(HY, h, 529,(0 * 1.))
	call SaveReal(HY, h, 668,((GetUnitStatePercent(WUE, UNIT_STATE_MANA, UNIT_STATE_MAX_MANA))* 1.))
	if(DDO +$96)> GetUnitState(WUE, UNIT_STATE_MAX_MANA) then
		call SaveReal(HY, h, 530,(((DDO +$96)-GetUnitState(WUE, UNIT_STATE_MAX_MANA))* 1.))
	endif
	set WUE = null
	set t = null
endfunction
function HIE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local real x
	local real y
	if GetPlayerTeam(GetOwningPlayer(WUE)) == 0 then
		set x = GetRectCenterX(VZ)
		set y = GetRectCenterY(VZ)
	else
		set x = GetRectCenterX(GY)
		set y = GetRectCenterY(GY)
	endif
	call USV(WUE, 851986, x, y)
	call UPV(WUE, "回家")
	set WUE = null
endfunction
function HNE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local real x
	local real y
	if GetPlayerTeam(GetOwningPlayer(WUE)) == 0 then
		set x =-4533
		set y =$486
	else
		set x =$C76
		set y =-35
	endif
	call USV(WUE, 851986, x, y)
	call UPV(WUE, "前往神秘商店")
	set WUE = null
endfunction
function DLO takes nothing returns nothing //分身斧分身技能
	local unit u = GetTriggerUnit()
	//call SaveBoolean(HY,(GetHandleId(u)),$81,(true))

	local real dataB
	local real dataC
	local string sSpecialArt = "Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl"
	local string sMissileArt = "Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageMissile.mdl"

	if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
		set dataB = 0.33
		set dataC = 3.5
	else
		set dataB = 0.28
		set dataC = 3
	endif
	
	call UnitSpellImage(u, 'A0B8', 2, dataB, dataC, 0.1, 20, sSpecialArt, sMissileArt, 1000, 128, 1000)
	//call A8X(GetOwningPlayer(u), 2., GetUnitX(u), GetUnitY(u), 1000)


	set u = null
endfunction
function HGE takes nothing returns nothing
	if(GetSpellAbilityId()=='A0B8' or GetSpellAbilityId()=='A1WE') then
		call DLO()
	endif
endfunction
function DMO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or(GetTriggerEventId()== EVENT_UNIT_DAMAGED and(STX(GetUnitTypeId(GetEventDamageSource()))== false and(GetOwningPlayer(GetEventDamageSource())!= BW) and GetEventDamage()> 0) or DMV) then
		call UnitRemoveAbility(targetUnit,'B0CG')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function DPO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	local integer c = LoadInteger(HY, h, 0)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or c == 0 then
		call UnitRemoveAbility(WLE,'A3B2')
		call UnitRemoveAbility(WLE,'B3B2')
		call RemoveSavedHandle(HY, GetHandleId(WLE),'EURN')
		call DestroyTrigger(t)
		call FlushChildHashtable(HY, h)
	else
		call SaveInteger(HY, h, 0, c -1)
		call UnitDamageTargetEx(SQX(WJE), WLE, 3, 150. / 8.)
	endif
	set WJE = null
	set WLE = null
	set t = null
	return false
endfunction
function DQO takes unit Q4X, unit to returns nothing
	local trigger t
	local integer h
	if HaveSavedHandle(HY, GetHandleId(to),'EURN') then
		set t = LoadTriggerHandle(HY, GetHandleId(to),'EURN')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, GetHandleId(to),'EURN', t)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerRegisterDeathEvent(t, to)
		call TriggerAddCondition(t, Condition(function DPO))
		call SaveUnitHandle(HY, h, 1, to)
	endif
	call SaveUnitHandle(HY, h, 0, Q4X)
	call SaveInteger(HY, h, 0, 8)
	call UnitAddPermanentAbility(to,'A3B2')
	set t = null
endfunction
function HHE takes nothing returns nothing
	local trigger t
	local integer h
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local unit dummyUnit
	local integer i = 0
	local boolean JLX = false
	local boolean C3O = false
	local integer HUX
	if targetUnit == null then
		set targetUnit = GetTriggerUnit()
	endif
	set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	loop
	exitwhen i > 5 or C3O
		if GetItemIndex(UnitItemInSlot(WUE, i))== NUV then
			set HUX = GetItemCharges(UnitItemInSlot(WUE, i))
			if HUX > 0 then
				set JLX = true
				set HUX = HUX -1
			else
				set C3O = true
				set JLX = false
			endif
		endif
		set i = i + 1
	endloop
	if JLX then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		if IsUnitAlly(targetUnit, GetOwningPlayer(WUE)) then
			if GetUnitAbilityLevel(targetUnit,'B0CG')== 0 then
				call UnitAddAbility(dummyUnit,'A1MM')
				call IssueTargetOrderById(dummyUnit,$D0281, targetUnit)
				call O0O(400, 0, 8,'B0CG', targetUnit)
			endif
			call SaveUnitHandle(HY, h, 17, targetUnit)
			call TriggerRegisterTimerEvent(t, 8, false)
			call TriggerRegisterDeathEvent(t, targetUnit)
			call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
			call TriggerAddCondition(t, Condition(function DMO))
		else
			call DQO(WUE, targetUnit)
		endif
	endif
	set WUE = null
	set dummyUnit = null
	set targetUnit = null
	set t = null
endfunction
function H5E takes nothing returns nothing
	local unit u = GetSpellTargetUnit()
	local integer i
	set bj_playerIsCrippled[0]= false
	if IsUnitType(u, UNIT_TYPE_HERO) and HeroIsDummyUnit(u)== false and GetUnitAbilityLevel(u,'A3E7')== 0 then
		call UnitAddPermanentAbility(u,'A3E7')
		call HDX(u, false)
		set i = 0
		loop
		exitwhen i > 5
			if HFX(UnitItemInSlot(u, i)) and IsItemPawnable(UnitItemInSlot(u, i))== false then
				call SetItemDroppable(UnitItemInSlot(u, i), true)
			endif
			set i = i + 1
		endloop
		set XX[GetPlayerId(GetOwningPlayer(u))]= XX[GetPlayerId(GetOwningPlayer(u))]+ TEX(RealItemTypeId[XFV])
		if GetOwningPlayer(u)!= GetOwningPlayer(GetTriggerUnit()) then
			set XX[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]= XX[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]+ TEX(RealItemTypeId[XFV])
		endif
		set GR[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]= true
		set GR[GetPlayerId(GetOwningPlayer(u))]= true
		call SetHeroStr(u, GetHeroStr(u, false)+$A, true)
		call SetHeroInt(u, GetHeroInt(u, false)+$A, true)
		call SetHeroAgi(u, GetHeroAgi(u, false)+$A, true)
		call UnitAddPermanentAbility(u,'A3I2')
		call UnitAddPermanentAbility(u,'A3I3')
		set bj_playerIsCrippled[0]= true
	endif
	set u = null
endfunction
function DSO takes nothing returns nothing
	call CNX(GetEnumUnit(),'A1ZY', 1, 6,'B0DX')
endfunction
function HTE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local integer i = 0
	local boolean JLX = false
	local boolean C3O = false
	local integer HUX
	local group g = LoginGroup(36)
	call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 925, Condition(function D0X))
	call ForGroup(g, function DSO)
	call LogoutGroup(g)
	set g = null
	set WUE = null
endfunction
function DTO takes unit u returns boolean
	local integer XIX = GetUnitTypeId(u)
	return XIX =='H0B8'
endfunction
function DUO takes nothing returns boolean
	return((IsUnitEnemy(GetFilterUnit(), DQV) and IsPrimalTypeId(GetUnitTypeId(GetFilterUnit()))== false and UnitIsDead(GetFilterUnit())== false and(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO)) and DTO(GetFilterUnit())== false))
endfunction
function DWO takes unit WUE returns boolean
	local group g = LoginGroup(37)
	local boolean JLX
	set DQV = GetOwningPlayer(WUE)
	call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE),$41A, Condition(function DUO))
	set JLX = FirstOfGroup(g)!= null
	call LogoutGroup(g)
	set g = null
	return JLX
endfunction
function DYO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local group g
	local integer EVX
	local boolean DZO
	if GetTriggerEventId()== EVENT_PLAYER_UNIT_ATTACKED then
		if GetAttacker()== WUE then
			call UnitRemoveAbility(WUE,'A20L')
			call UnitRemoveAbility(WUE,'A20S')
			call UnitRemoveAbility(WUE,'B0E2')
			call UnitRemoveAbility(WUE,'B09Y')
			if((LoadInteger(HY,(GetHandleId((WUE))),(4302)))== 1)== false then
				call UnitSetUsesAltIcon(WUE, false)
			endif
			call DestroyEffect((LoadEffectHandle(HY, h, 32)))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	else
		set DZO =(LoadBoolean(HY, h, 671))
		set EVX =(LoadInteger(HY, h, 34))
		set EVX = EVX + 1
		call SaveInteger(HY, h, 34,(EVX))
		set g = LoginGroup(38)
		set DQV = GetOwningPlayer(WUE)
		call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE),$41A, Condition(function DUO))
		if GetUnitAbilityLevel(WUE,'B09Y')> 0 then
			call SaveBoolean(HY, h, 671,(true))
		elseif DZO then
			call SaveBoolean(HY, h, 671,(false))
			call UnitRemoveAbility(WUE,'A20L')
			call UnitAddPermanentAbility(WUE,'A20L')
		endif
		if EVX > 350 or FirstOfGroup(g)!= null then
			call UnitRemoveAbility(WUE,'A20L')
			call UnitRemoveAbility(WUE,'A20S')
			call UnitRemoveAbility(WUE,'B0E2')
			call UnitRemoveAbility(WUE,'B09Y')
			if((LoadInteger(HY, GetHandleId(WUE), 4302))!= 1) then
				call UnitSetUsesAltIcon(WUE, false)
			endif
			call DestroyEffect(LoadEffectHandle(HY, h, 32))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
		call LogoutGroup(g)
	endif
	set t = null
	set WUE = null
	set g = null
	return false
endfunction
function D_O takes nothing returns nothing
	local unit WUE = GetEnumUnit()
	local trigger t = null
	local integer h
	if XFX(GetOwningPlayer(WUE)) and DWO(WUE)== false then
		if IsPlayerAlly(LocalPlayer, GetOwningPlayer(WUE))== false and IsObserver== false then
			call UnitSetUsesAltIcon(WUE, true)
		endif
		call L6X(WUE)
		call UnitAddPermanentAbility(WUE,'A20L')
		call UnitMakeAbilityPermanent(WUE, true,'A20L')
		if DVX(WUE)== false then
			call UnitAddPermanentAbility(WUE,'A20S')
			call UnitMakeAbilityPermanent(WUE, true,'A20S')
			call S9E(GetOwningPlayer(WUE),'A20S', false)
		endif
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveInteger(HY, h, 34, 0)
		call SaveUnitHandle(HY, h, 2,(WUE))
		call SaveBoolean(HY, h, 671,(false))
		call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\SmokeOfDeceit.mdx", WUE, "chest")))
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerAddCondition(t, Condition(function DYO))
		set t = null
	endif
	set WUE = null
endfunction
function HUE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local group g = LoginGroup(39)
	call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 1225, Condition(function D_X))
	call ForGroup(g, function D_O)
	call LogoutGroup(g)
	set WUE = null
	set g = null
endfunction

function VeilOfDiscord__RemoveBuff__Actions takes nothing returns nothing
	local custombuff b = GetTriggerBuff()
	call ReduceUnitMagicResistance(b.target, -0.25)
endfunction

function VeilOfDiscord__AddBuff__Actions takes nothing returns nothing
	local custombuff b = GetTriggerBuff()
	call AddUnitMagicResistance(b.target, -0.25)
endfunction

// 纷争面纱
function SpellEffect__VeilOfDiscord takes nothing returns nothing
	local group g = LoginGroup(40)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit firstUnit
	local unit spellUnit = GetTriggerUnit()
	local player spellPlayer = GetOwningPlayer(spellUnit)
	local integer h
	local custombuff b

	call GroupEnumUnitsInRange(g, x, y, 625 + MAX_UNIT_COLLISION, null)

	loop
		set firstUnit = FirstOfGroup(g)
		exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)
		if IsUnitEnemy(firstUnit, spellPlayer) and IsAliveNotStrucNotWard(firstUnit) and IsNoAncientOrBear(firstUnit) then
			set b = b.create(spellUnit, firstUnit)
			set b.aid = 'A28G'
			set b.bid = 'B0EQ'
			set b.dur = 16.
			set b.overlayDur = true
			set b.level = 1
			set b.basicDispel = true
			set b.removeActions = "VeilOfDiscord__RemoveBuff__Actions"
			set b.addActions = "VeilOfDiscord__AddBuff__Actions"
			call b.add_buff()
		endif
	endloop
	call LogoutGroup(g)
	call DestroyEffect(AddSpecialEffect("war3mapImported\\DarkLightningNova.mdx", x, y))
	set firstUnit = null
	set spellUnit = null
	set spellPlayer = null
	set g = null
endfunction
function D1O takes nothing returns nothing
	if IsUnitEnemy(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) then
		call UnitDamageTargetEx(GetTriggerUnit(), GetSpellTargetUnit(), 2, 500)
	endif
endfunction
function H9E takes nothing returns nothing
	if(GetUnitTypeId(GetSpellTargetUnit())=='o004' or GetUnitTypeId(GetSpellTargetUnit())=='oeye' or RMX(GetSpellTargetUnit())) then
		call D1O()
	endif
endfunction
function D2O takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddAbility(dummyUnit,'A2K3')
	call IssueTargetOrderById(dummyUnit, 852171, targetUnit)
	call EnableEffectByTime(18, 8)
	set WUE = null
	set targetUnit = null
	set dummyUnit = null
endfunction
function H_E takes nothing returns nothing
	if GetSpellAbilityId()=='A2EA' and not UnitHasSpellShield(GetSpellTargetUnit()) then
		call D2O()
	endif
endfunction
function D3O takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit()))!= null
endfunction
function D4O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	if GetUnitAbilityLevel(u,'Bdet')== 0 or LoadReal(HY, GetHandleId(u),'AItb')+ 12 < GetGameTime() then
		call UnitRemoveAbility(u,'A2SJ')
		call UnitRemoveAbility(u,'B0GR')
		call UnitRemoveAbility(u,'Bdet')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if DOX(u) then
			if GetUnitAbilityLevel(u,'B0GR')== 0 then
				call UnitAddPermanentAbility(u,'A2SJ')
			endif
		else
			if GetUnitAbilityLevel(u,'B0GR')> 0 then
				call UnitRemoveAbility(u,'A2SJ')
				call UnitRemoveAbility(u,'B0GR')
			endif
		endif
	endif
	set u = null
	set t = null
	return false
endfunction
function D5O takes nothing returns nothing
	local unit u = GetEnumUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function D4O))
	call SaveReal(HY, GetHandleId(u),'AItb', GetGameTime())
	call SaveUnitHandle(HY, h, 2,(u))
	set t = null
	set u = null
endfunction
function H8E takes nothing returns nothing // 撒粉
	local group g = LoginGroup(41)
	local unit u = GetTriggerUnit()
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 1075, Condition(function D3O))
	call ForGroup(g, function D5O)
	call LogoutGroup(g)
	set g = null
	set u = null
endfunction
function D6O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	call SetItemCharges(GetItemOfTypeFromUnit(u, RealItemTypeId[NIV]), GetItemCharges(GetItemOfTypeFromUnit(u, RealItemTypeId[NIV]))+ 1)
	call FlushChildHashtable(HY, h)
	call SaveBoolean(HY, GetHandleId(u),'suic', true)
	call CleanCurrentTrigger(t)
	call KillUnit(u)
	set u = null
	set t = null
	return false
endfunction
function H7E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2,(u))
	call TriggerAddCondition(t, Condition(function D6O))
	call TriggerRegisterTimerEvent(t, .01, false)
	set t = null
	set u = null
endfunction
function GGE takes nothing returns nothing
	local unit u = GetSpellTargetUnit()
	if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
		call AddAbilityToTimed(u,'C033', 1, 3,'D033')
		call AddAbilityToTimed(u,'A3KC', 1, 3, 0)
	else
		call AddAbilityToTimed(u,'C033', 1, 4.5,'D033')
		call AddAbilityToTimed(u,'A3KC', 1, 4.5, 0)
	endif
	set u = null
endfunction

function SpellEffect__Bloodlust takes nothing returns nothing
	local unit spellUnit = GetSpellAbilityUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(spellUnit, GetSpellAbilityId())
	local real dur = 30
	local real scale = 0.05 + 0.05 * level

	call AddUnitModelScalePercentByDuration(targetUnit, dur, scale, 'Bblo', HTKEY_SCALE_BLOODLUST_TRIGGER)
	
	set spellUnit = null
	set targetUnit = null
endfunction

function SpellEffect__Rabid takes nothing returns nothing
	local unit spellUnit = GetSpellAbilityUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(spellUnit, GetSpellAbilityId())
	local real dur = 50
	local real scale = 0.2 + 0.1 * level

	call AddUnitModelScalePercentByDuration(targetUnit, dur, scale, 'B016', HTKEY_SCALE_RABID_TRIGGER)
	
	set spellUnit = null
	set targetUnit = null
endfunction

function H4E takes nothing returns nothing
	local integer D7O = 0
	if GetSpellAbilityId()=='A02O' then
		set D7O = 1
	elseif GetSpellAbilityId()=='A08Y' then
		set D7O = 2
	elseif GetSpellAbilityId()=='A08Z' then
		set D7O = 3
	elseif GetSpellAbilityId()=='A090' then
		set D7O = 4
	elseif GetSpellAbilityId()=='A092' then
		set D7O = 5
	endif
	if D7O > 0 then
		if not UnitHasSpellShield(GetSpellTargetUnit()) then
			call UnitDamageTargetEx(GetTriggerUnit(), GetSpellTargetUnit(), 1, 300 + 100 * D7O)
		else
			call AJO(GetSpellTargetUnit())
		endif
	endif
endfunction
function H2E takes nothing returns nothing
	if GetSpellAbilityId()=='A2HQ' then
		call TLX(GetTriggerUnit(), GetSpellTargetUnit())
	endif
endfunction
function D8O takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local item it
	local unit u = LoadUnitHandle(HY, h, 0)
	call DisableTrigger(CUV)
	set it = CreateItem('I0HM', GetUnitX(u), GetUnitY(u))
	call UnitAddItem(u, it)
	if GetWidgetLife(it)> 0 then
		call RemoveItem(it)
	endif
	set it = null
	call EnableTrigger(CUV)
	call PauseTimer(t)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction
function D9O takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetUnitAbilityLevel(u,'B0BI')== 0 or GetTriggerEvalCount(t)>$A0 or GetTriggerEventId()== EVENT_UNIT_DEATH then
		call UnitRemoveAbility(u,'B0BI')
		call DestroyEffect(LoadEffectHandle(HY, h, 1))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
endfunction
function FVO takes unit u, boolean b returns nothing
	local trigger t
	local item it
	if IsUnitIllusion(u)== false then
		if b then
			call AGO(GetTriggerUnit())
			call UnitRemoveAbility(GetTriggerUnit(),'B0BI')
		endif
		call DisableTrigger(CUV)
		set it = CreateItem('I0HM', GetUnitX(u), GetUnitY(u))
		if UnitAddItem(u, it) and GetWidgetLife(it)<= 0 then
			set t = CreateTrigger()
			call TriggerRegisterTimerEvent(t, .1, true)
			call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
			call TriggerAddCondition(t, Condition(function D9O))
			call SaveEffectHandle(HY, GetHandleId(t), 1, AddSpecialEffectTarget("war3mapImported\\Linkens_Main.mdx", u, "chest"))
			call SaveUnitHandle(HY, GetHandleId(t), 0, u)
		else
			call RemoveItem(it)
		endif
		call EnableTrigger(CUV)
	endif
	set it = null
	set t = null
endfunction
function VDE takes nothing returns nothing
	call FVO(GetSpellTargetUnit(), true)
endfunction
function FXO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	call UnitRemoveAbility(WUE,'A1ZJ')
	call UnitRemoveAbility(targetUnit, LoadInteger(HY, h, 0))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set WUE = null
	set targetUnit = null
endfunction
function HSE takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	call TimerStart(t, 7, false, function FXO)
	call SaveUnitHandle(HY, h, 2, u)
	call SaveUnitHandle(HY, h, 17, WLE)
	call UnitAddPermanentAbility(u,'A1ZJ')
	if IsUnitEnemy(u, GetOwningPlayer(WLE)) then
		call UnitAddPermanentAbility(WLE,'A1ZJ')
		call SaveInteger(HY, h, 0,'A1ZJ')
		if WLE == RoShan then
			call SetUnitAbilityLevel(WLE,'A1ZJ', 2)
		endif
	else
		call UnitAddPermanentAbility(WLE,'A44N')
		call SaveInteger(HY, h, 0,'A44N')
	endif
	set t = null
	set u = null
	set WLE = null
endfunction
function FOO takes nothing returns nothing
	local unit U6E = GetTriggerUnit()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(U6E),'e00E', GetUnitX(U6E), GetUnitY(U6E), 0)
	if GetSpellAbilityId()=='AIpl' then
		call UnitAddAbility(dummyUnit,'A1WA')
	elseif GetSpellAbilityId()=='AIpr' then
		call UnitAddAbility(dummyUnit,'AIpr')
	endif
	call IssueTargetOrderById(dummyUnit,$D0281, U6E)
	set U6E = null
	set dummyUnit = null
endfunction
function FRO takes nothing returns nothing
	if GetSpellAbilityId()=='AIpl' or GetSpellAbilityId()=='AIpr' or GetSpellAbilityId()=='A1WA' then
		if GetSpellTargetItem()!= null then
			call FOO()
		else
			if(GetUnitAbilityLevel(GetSpellTargetUnit(),'BIrm')== 0 and GetSpellAbilityId()!='AIpr') then
				call O0O(0, 150, 30,'BIrm', GetSpellTargetUnit())
			elseif(GetUnitAbilityLevel(GetSpellTargetUnit(),'B02Z')== 0 and GetSpellAbilityId()=='AIpr') then
				call O0O(400, 0, 8,'B02Z', GetSpellTargetUnit())
			endif
		endif
	elseif GetSpellAbilityId()=='A0FO' and GetUnitAbilityLevel(GetTriggerUnit(),'B04A')== 0 then
		call O0O(110, 70, 3,'B04A', GetTriggerUnit())
	endif
endfunction
function FIO takes unit triggerUnit, integer FAO returns nothing
	local integer FNO
	local item it
	if FAO =='o004' then
		set FNO = RealItemTypeId[R2V]
	else
		set FNO = RealItemTypeId[R3V]
	endif
	call DisableTrigger(CUV)
	set it = GetItemOfTypeFromUnit(triggerUnit, FNO)
	if it == null then
		set E3 = GetOwningPlayer(triggerUnit)
		set Z2 = CreateItem(FNO, 0, 0)
		call UnitAddItem(triggerUnit, Z2)
		call SetItemPlayer(Z2, E3, false)
		call SetItemUserData(Z2, 1)
	else
		call SetItemCharges(it, GetItemCharges(it)+ 1)
	endif
	call EnableTrigger(CUV)
	set it = null
endfunction
function GHE takes nothing returns nothing
	local integer id = GetSpellAbilityId()
	local unit d
	local unit WJE
	local real x
	local real y
	local item it
	local integer FBO
	local integer FCO
	local integer SQV
	local real SYV = 0
	if id =='A02X' or id =='AIsw' then
		if id =='A02X' then
			set FBO ='o004'
			set FCO ='A33D'
			set SYV = 420
			set SQV = R2V
		else
			set FBO ='oeye'
			set FCO ='A33E'
			set SYV =$F0
			set SQV = R3V
		endif
		set WJE = GetTriggerUnit()
		set x = GetSpellTargetX()
		set y = GetSpellTargetY()
		if GetSpellTargetUnit()== null then
			if IsPointInRegion(FLV, x, y) then
				call FIO(WJE, FBO)
			else
				set d = CreateUnit(GetOwningPlayer(WJE), FBO, x, y, 0)
				call SetUnitPathing(d, false)
				call SetUnitPosition(d, x, y)
				call UnitAddAbility(d,'A0XB')
				call UnitApplyTimedLife(d,'BTFL', SYV)
				set d = null
			endif
		else
			set d = GetSpellTargetUnit()
			set it = GetItemOfTypeFromUnit(d, SQV)
			if it != null then
				call SetItemCharges(it, GetItemCharges(it)+ 1)
			elseif H_X(d)> 0 then
				set it = CreateItem(RealItemTypeId[SQV], 0, 0)
				call SetItemCharges(it, 1)
				call UnitAddItem(d, it)
			else
				call DisplayTimedTextToPlayer(GetOwningPlayer(WJE), 0, 0, 5, "目标背包已满")
				call FIO(WJE, FBO)
			endif
			set it = null
		endif
	endif
	set WJE = null
	set d = null
endfunction
function FDO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 34))
	if(GetTriggerEventId()== EVENT_UNIT_DEATH and GetKillingUnit()== WUE) or(GetTriggerEventId()== EVENT_UNIT_DAMAGED and GetUnitAbilityLevel(targetUnit,'B0ES')> 0) then
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl", GetUnitX(targetUnit), GetUnitY(targetUnit)))
		if(IsUnitType(WUE, UNIT_TYPE_HERO)) then
			call AddHeroXPSimple(WUE, R2I(LoadInteger(M, GetUnitTypeId(targetUnit), HC)* 2.5), true)
		else
			call AddHeroXPSimple(Player__Hero[GetPlayerId(GetOwningPlayer(WUE))], R2I(LoadInteger(M, GetUnitTypeId(targetUnit), HC)* 2.5), true)
		endif
		call BMX(GetOwningPlayer(WUE), targetUnit,$BE)
		set EUV[GetPlayerId(GetOwningPlayer(WUE))]= EUV[GetPlayerId(GetOwningPlayer(WUE))]+$BE
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(targetUnit)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function HQE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitLevel(targetUnit)
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 34,(level))
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function FDO))
	set t = null
	set WUE = null
	set targetUnit = null
endfunction
function FFO takes nothing returns nothing
	call SetUnitState(GetEnumUnit(), UNIT_STATE_MANA, GetUnitState(GetEnumUnit(), UNIT_STATE_MANA)+$87)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", GetEnumUnit(), "origin"))
endfunction
function FGO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local group g = LoginGroup(42)
	set U2 = WUE
	call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 25 + 900, Condition(function D2X))
	call ForGroup(g, function FFO)
	call LogoutGroup(g)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set g = null
	set WUE = null
	set t = null
	return false
endfunction
function HPE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t
	if GetSpellAbilityId()=='A0K7' then
		if GetUnitTypeId(WUE)!='H00J' then
			set t = CreateTrigger()
			call TriggerRegisterTimerEvent(t, 0, false)
			call TriggerAddCondition(t, Condition(function FGO))
			call SaveUnitHandle(HY,(GetHandleId(t)), 2,(WUE))
			set t = null
		elseif GetUnitTypeId(WUE)=='H00J' then
			call SetUnitState(WUE, UNIT_STATE_MANA, GetUnitState(WUE, UNIT_STATE_MANA)+ 25)
		endif
	endif
	set WUE = null
endfunction
function FHO takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		call UnitDamageTargetEx(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1), 1, 50)
	endif
	call DestroyTrigger(t)
	call FlushChildHashtable(HY, h)
	set t = null
endfunction
function FJO takes unit WLE, unit W_V returns boolean
	if IssueTargetOrderById(W_V,$D00B0, WLE) then
		// debug call SingleDebug("cyclone")
		return true
	elseif IssueTargetOrderById(W_V,$D0103, WLE) then
		// debug call SingleDebug("sleep")
		return true
	else
		call UnitShareVision(WLE, GetOwningPlayer(W_V), true)
		if IssueTargetOrderById(W_V,$D00B0, WLE) then
			// debug call SingleDebug("cyclone")
			call UnitShareVision(WLE, GetOwningPlayer(W_V), false)
			return true
		elseif IssueTargetOrderById(W_V,$D0103, WLE) then
			// debug call SingleDebug("sleep")
			call UnitShareVision(WLE, GetOwningPlayer(W_V), false)
			return true
		endif
		call UnitShareVision(WLE, GetOwningPlayer(W_V), false)
	endif
	// debug call SingleDebug("none")
	return false
endfunction
function HME takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local unit dummyUnit
	local trigger t
	if GetSpellTargetItem()!= null then
		set targetUnit = GetTriggerUnit()
	endif
	if not UnitHasSpellShield(GetSpellTargetUnit()) or IsPlayerAlly(GetOwningPlayer(WUE), GetOwningPlayer(targetUnit)) then
		set dummyUnit = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitAddAbility(dummyUnit,'A13V')
		call UnitAddAbility(dummyUnit,'A3G5')
		call SaveUnitHandle(HY, GetHandleId(dummyUnit), 0, WUE)
		if FJO(targetUnit, dummyUnit) and IsPlayerEnemy(GetOwningPlayer(WUE), GetOwningPlayer(targetUnit)) then
			set t = CreateTrigger()
			call TriggerRegisterTimerEvent(t, 2.51, false)
			call TriggerRegisterDeathEvent(t, targetUnit)
			call TriggerAddCondition(t, Condition(function FHO))
			call SaveUnitHandle(HY, GetHandleId(t), 0, dummyUnit)
			call SaveUnitHandle(HY, GetHandleId(t), 1, targetUnit)
			set t = null
		endif
	endif
	set WUE = null
	set targetUnit = null
	set dummyUnit = null
endfunction
function FKO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call SetUnitImitateMoveSpeed(LoadUnitHandle(HY, h, 0), 0, 0)
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
endfunction
function FLO takes unit u returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, u)
	call SetUnitImitateMoveSpeed(u, 999, 800)
	call TimerStart(t, 4., false, function FKO)
	set t = null
endfunction
function JVE takes nothing returns nothing
	call FLO(GetTriggerUnit())
endfunction
function AbyssalBlade_Overwhelm takes nothing returns nothing
	// 大晕锤
	if GetSpellAbilityId()=='A2K7' and not UnitHasSpellShield(GetSpellTargetUnit()) then
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\LevelerStunFX.mdx", GetSpellTargetUnit(), "head"))
	endif
endfunction
function FMO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	local integer i = GetUnitTypeId(u)
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTimer(t)
	if i !='ncop' then
		call EXUnitResetCooldown(u)
		call SetUnitState(u, UNIT_STATE_MANA,$F423F)
	endif
	set u = null
	set t = null
endfunction
function FPO takes nothing returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, 0, false, function FMO)
	call SaveUnitHandle(HY, GetHandleId(t), 0, GetTriggerUnit())
	set t = null
endfunction

function FSO takes nothing returns boolean
	local integer id = GetSpellAbilityId()
	// 如果是变身技能就返回
	if WQV() then
		return false
	endif
	if WTF__Status then
		call FPO()
	endif
	call FRO()
	if HaveSavedString(P, id, 12) then
		call ExecuteFunc(LoadStr(P, id, 12))
	endif
	if GetUnitTypeId(GetTriggerUnit())=='e00E' then
		return false
	endif
	// 魔棒
	call CPO()

	return false
endfunction
function FTO takes unit u returns nothing
	call SetWidgetLife(u, GetUnitState(u, UNIT_STATE_MAX_LIFE))
	call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MAX_MANA))
endfunction
function FUO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 14))
	call FTO(u)
	call L8X(u)
	call ClearSelectionForPlayer(GetOwningPlayer(u))
	call SelectUnitAddForPlayer(u, GetOwningPlayer(u))
	call KPX(u)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set u = null
	return false
endfunction
function FWO takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x
	local real y
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call JSX("AegisOff", GetPlayerId(GetOwningPlayer(u)))
	call UnitApplyTimedLife(CreateUnit(GetOwningPlayer(u),'o01P', GetUnitX(u), GetUnitY(u), 0),'BTLF', 5)
	set E7V = null
	call TriggerRegisterTimerEvent(t, 5, false)
	call TriggerAddCondition(t, Condition(function FUO))
	call SaveUnitHandle(HY, h, 14,(u))
	call EPX(u, 4304, 5)
	set t = null
	set u = null
endfunction
function FYO takes nothing returns nothing
	if GetItemIndex(GetManipulatedItem())== AIV then
		call FWO()
	endif
endfunction
function FZO takes unit u, integer id, integer RLO, item F_O returns nothing
	local item it
	local integer JOX = B2X(u, F_O)
	local player p = GetItemPlayer(F_O)
	call DisableTrigger(CUV)
	call RemoveItem(F_O)
	set it = JIX(u, RealItemTypeId[id], JOX)
	call SetItemPlayer(it, p, false)
	call SetItemUserData(it, RLO)
	call EnableTrigger(CUV)
	set it = null
endfunction
function F0O takes integer GTX returns nothing
	local unit u = GetTriggerUnit()
	local item it = GetManipulatedItem()
	local integer JOX
	local player p
	if GTX == IRV then
		call FZO(u, IIV, 1, it)
	elseif GTX == IIV then
		call FZO(u, IRV, 1, it)
	elseif GTX == RUV then
		call FZO(u, RWV, 1, it)
	elseif GTX == RWV then
		call FZO(u, RUV, 1, it)
	elseif GTX == Item_MonkeyKingBar then
		call FZO(u, AYV, 1, it)
	elseif GTX == AYV then
		call FZO(u, Item_MonkeyKingBar, 1, it)
	endif
	if GTX == AZV then
		call FZO(u, A_V, 1, it)
	elseif GTX == A_V then
		call FZO(u, AZV, 1, it)
	endif
	if GTX == IBV then
		call FZO(u, ICV, 1, it)
	elseif GTX == ICV then
		call FZO(u, IDV, 1, it)
	elseif GTX == IDV then
		call FZO(u, IBV, 1, it)
	endif
	if GTX == Item_DiffusalBladeLevel1 and GetItemCharges(it)== 0 then
		call FZO(u, Item_DiffusalBladeLevel1_Empty, 1, it)
	elseif GTX == Item_DiffusalBladeLevel2 and GetItemCharges(it)== 0 then
		call FZO(u, IZV, 1, it)
	elseif GTX == RRV and GetItemCharges(it)== 0 then
		call FZO(u, RIV, 1, it)
	endif
	set u = null
	set it = null
endfunction
function F1O takes integer GTX returns nothing
	local unit u = GetTriggerUnit()
	local item it = GetManipulatedItem()
	local player p = GetItemPlayer(it)
	local integer i = LoadInteger(K, GetHandleId(p),'0BKB')
	local integer F2O = 0
	if i == 0 then
		set F2O = AVV
	elseif i == 9 then
		set F2O = AEV
	elseif i == 8 then
		set F2O = AXV
	elseif i == 7 then
		set F2O = AOV
	elseif i == 6 then
		set F2O = ARV
	endif
	if GTX == ARV then
		call SetItemCharges(it, 5)
	endif
	if GTX == I9V or GTX == AVV or GTX == AEV or GTX == AXV or GTX == AOV then
		call FZO(u, F2O, 1, it)
		if i == 0 then
			call SaveInteger(K, GetHandleId(p),'0BKB', 9)
		else
			call SaveInteger(K, GetHandleId(p),'0BKB', IMaxBJ(i -1, 5))
		endif
	endif
	set u = null
	set it = null
endfunction
function F3O takes integer id returns boolean
	local real AXO
	local trigger t
	local real hp
	local unit u = GetTriggerUnit()
	local item it = GetManipulatedItem()
	if id == NCV then
		set AXO = GetUnitState(u, UNIT_STATE_MAX_LIFE)-GetWidgetLife(u)
		set hp = GetWidgetLife(u)
		call FZO(u, NBV, 1, it)
		call RemoveUnitBEim(u)
		call EPX(u, 4298, .6)
	elseif id == NBV then
		set AXO = GetUnitState(u, UNIT_STATE_MAX_LIFE)-GetWidgetLife(u)
		call FZO(u, NCV, 1, it)
		call SaveBoolean(K, GetHandleId(u), 20, false)
		call SetHeroStr(u, IMaxBJ(GetHeroStr(u, false)-LoadInteger(K, GetHandleId(u),'ARML'), 1), true)
		call SaveInteger(K, GetHandleId(u),'ARML', 0)
		call RemoveUnitBEim(u)
	endif
	set u = null
	set it = null
	return false
endfunction
function F4O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local item it
	if ABO(WUE) then
		call DisableTrigger(CUV)
		set it = CreateItem('I0HM', GetUnitX(WUE), GetUnitY(WUE))
		call UnitAddItem(WUE, it)
		if GetWidgetLife(it)> 0 then
			call RemoveItem(it)
		endif
		set it = null
		call EnableTrigger(CUV)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call SaveBoolean(HY,(GetHandleId(WUE)),$81,(false))
	set t = null
	set WUE = null
	return false
endfunction
function F5O takes integer GTX returns nothing
	local unit WUE = GetTriggerUnit()
	local item UWV = GetManipulatedItem()
	local trigger t
	if(GTX == ANV or GTX == ABV) and(LoadBoolean(HY,(GetHandleId(WUE)),$81)) then
		set t = CreateTrigger()
		call TriggerRegisterTimerEvent(t, .41, false)
		call TriggerAddCondition(t, Condition(function F4O))
		call SaveUnitHandle(HY,(GetHandleId(t)), 2,(WUE))
		set t = null
	endif
	set WUE = null
	set UWV = null
endfunction

function F6O takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call SetItemDroppable(LoadItemHandle(HY, h, 0), true)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction

function F7O takes nothing returns boolean
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, LoadInteger(Y, GetItemTypeId(GetManipulatedItem()),'00CD'), false, function F6O)
	call SetItemDroppable(GetManipulatedItem(), false)
	call SaveItemHandle(HY, h, 0, GetManipulatedItem())
	set t = null
	return false
endfunction

function IronwoodBranchExpire takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local destructable d = LoadDestructableHandle(HY, h, 0)
	call FlushChildHashtable(HY, GetHandleId(d))
	call RemoveDestructable(d)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set d = null
endfunction

function Item_SpellEffect_IronwoodBranch takes nothing returns nothing
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local destructable d = CreateDestructable('B005', x, y, 360.00, 1, 0)
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local unit spellUnit = GetTriggerUnit()
	//local integer iOrder = GetUnitCurrentOrder( spellUnit )
	//local integer i = iOrder - 852008 
	call SaveDestructableHandle(HY, h, 0, d)
	call TimerStart(t, 20.00, false, function IronwoodBranchExpire)

	//call RemoveItem( UnitItemInSlot(spellUnit, i) )
	// debug call SingleDebug("Remove")
	set spellUnit = null
	set d = null
	set t = null
endfunction
function Item_SpellEffect_MoonShard takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()

	call UnitAddPermanentAbility(targetUnit,'A398')
	call DestroyEffect(AddSpecialEffectTarget("effects\\Eclipse.mdx", targetUnit, "origin"))
	
	set spellUnit = null
	set targetUnit = null
endfunction

function F9O takes nothing returns boolean
	local real x
	local real y
	local real a
	local integer id = GetItemIndex(GetManipulatedItem())
	local integer TZE = GetItemTypeId(GetManipulatedItem())
	if GetUnitTypeId(GetTriggerUnit())!='e00E' and(LoadInteger(Y, TZE,'00CD'))> 0 and(GetUnitAbilityLevel(GetTriggerUnit(),'A0A5')> 0 or IsBearUnit(GetTriggerUnit())) then
		call F7O()
	endif
	if id == ADV or id == AFV or id == AGV or id == AHV or id == AJV then
		call SetItemCharges(GetManipulatedItem(), GetItemCharges(GetManipulatedItem()) + 1)
	elseif TZE == RealItemTypeId[RPV] or TZE == RealItemTypeId[Item_IronwoodBranch] or TZE == RealItemTypeId[Item_MoonShard] then
		// 使用芒果 树枝 银月 那就删了
		call RemoveItem(GetManipulatedItem())
	elseif TZE == RealItemTypeId[XDV]then
		if bj_playerIsCrippled[0]then
			call RemoveItem(GetManipulatedItem())
			call HDX(GetTriggerUnit(), true)
		endif
		set bj_playerIsCrippled[0]= false
	endif
	if VE then
		call XOO(GetTriggerUnit(), XIO(UUV(GetManipulatedItem()), true), GetItemPlayer(GetManipulatedItem()))
		set VE = false
	endif
	call F0O(id)
	call AKO()
	call FYO()
	call F3O(id)
	call F1O(id)
	call F5O(id)
	return false
endfunction
function GVO takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit())== Sentinels[0]then
		call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983, LT)
	elseif GetOwningPlayer(GetTriggerUnit())== Scourges[0]then
		call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983, MT)
	endif
	return false
endfunction
function GEO takes nothing returns nothing
	set CU = CU + 1
endfunction
function GXO takes nothing returns nothing
	set BU = BU + 1
endfunction
function GOO takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit())== Sentinels[0]then
		call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983, PT)
	endif
	return false
endfunction
function GRO takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit())== Scourges[0]then
		call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983, PT)
	endif
	return false
endfunction
function GIO takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit())== Sentinels[0]then
		call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983, QT)
	endif
	return false
endfunction
function GAO takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit())== Scourges[0]then
		call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983, QT)
	endif
	return false
endfunction
function GNO takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit())== Sentinels[0]then
		call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983, TT)
	endif
	return false
endfunction
function GBO takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit())== Scourges[0]then
		call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983, TT)
	endif
	return false
endfunction
function GCO takes nothing returns nothing
	local integer i = 1
	local integer id
	loop
	exitwhen i > 5
		set id = GetPlayerId(Sentinels[i])
		call JSX("CSK" + I2S(id), AQ[id])
		call JSX("ConvertSkillData" + I2S(id), NQ[id])
		call JSX("NK" + I2S(id),(LoadInteger(HY,(400 + id), 79)))
		set id = GetPlayerId(Scourges[i])
		call JSX("CSK" + I2S(id), AQ[id])
		call JSX("ConvertSkillData" + I2S(id), NQ[id])
		call JSX("NK" + I2S(id),(LoadInteger(HY,(400 + id), 79)))
		set i = i + 1
	endloop
endfunction
function GDO takes boolean GFO returns nothing
	local unit u
	local string s1
	local string s2
	if GFO then
		set s1 = "stand work alternate"
		set s2 = "stand work"
	else
		set s1 = "stand alternate"
		set s2 = "stand"
	endif
	if UnitIsDead(D6)== false then
		call SetUnitAnimation(D6, s1)
	endif
	if UnitIsDead(F6)== false then
		call SetUnitAnimation(F6, s1)
	endif
	if UnitIsDead(G6)== false then
		call SetUnitAnimation(G6, s1)
	endif
	if UnitIsDead(H6)== false then
		call SetUnitAnimation(H6, s1)
	endif
	if UnitIsDead(J6)== false then
		call SetUnitAnimation(J6, s1)
	endif
	if UnitIsDead(K6)== false then
		call SetUnitAnimation(K6, s1)
	endif
	if UnitIsDead(N8)== false then
		call SetUnitAnimation(N8, s2)
	endif
	if UnitIsDead(B8)== false then
		call SetUnitAnimation(B8, s2)
	endif
	if UnitIsDead(C8)== false then
		call SetUnitAnimation(C8, s2)
	endif
	if UnitIsDead(D8)== false then
		call SetUnitAnimation(D8, s2)
	endif
	if UnitIsDead(F8)== false then
		call SetUnitAnimation(F8, s2)
	endif
	if UnitIsDead(G8)== false then
		call SetUnitAnimation(G8, s2)
	endif
	set u = null
endfunction
function GGO takes nothing returns boolean
	call GDO(true)
	return false
endfunction
function GHO takes group g, integer GJO returns nothing
	local unit u
	loop
		set u = FirstOfGroup(g)
	exitwhen(u == null)
		call GroupRemoveUnit(g, u)
		call SetUnitAbilityLevel(u,'A06G', GJO)
		call IssuePointOrderByIdLoc(u, 851983, KW[GJO])
	endloop
	set u = null
endfunction
function GKO takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	call SetUnitMoveSpeed(u, LoadReal(HY, h, 25))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction
function GLO takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local real m
	local real d =$A
	if WC == 1 then
		set m = 1.25
	else
		set m = .75
	endif
	call SaveReal(HY, h, 25, GetUnitMoveSpeed(GetEnumUnit()))
	call SetUnitMoveSpeed(GetEnumUnit(), GetUnitMoveSpeed(GetEnumUnit())* m)
	call TimerStart(t, d, false, function GKO)
	call SaveUnitHandle(HY, h, 0, GetEnumUnit())
	set t = null
endfunction
function GMO takes nothing returns nothing
	local boolean GPO = ModuloInteger(GetTriggerExecCount(AG), 7)== 0
	if FMV then
		return
	endif
	call GDO(false)
	if GPO then
		call GCO()
	endif
	if GetTriggerExecCount(AG)== 1 and Mode__OnlyMid == false then
		call EXUnitResetCooldown(Circle[1])
		call EXUnitResetCooldown(Circle[2])
		call EXUnitResetCooldown(Circle[3])
		call EXUnitResetCooldown(Circle[4])
		call EXUnitResetCooldown(Circle[5])
		call EXUnitResetCooldown(Circle[7])
		call EXUnitResetCooldown(Circle[8])
		call EXUnitResetCooldown(Circle[9])
		call EXUnitResetCooldown(Circle[10])
		call EXUnitResetCooldown(Circle[11])
		call UnitRemoveAbility(SentinelsBuilding_AP_L1_TOP,'Avul')
		call UnitRemoveAbility(SentinelsBuilding_AP_L1_MID,'Avul')
		call UnitRemoveAbility(SentinelsBuilding_AP_L1_BOT,'Avul')
		call UnitRemoveAbility(U7,'Avul')
		call UnitRemoveAbility(W7,'Avul')
		call UnitRemoveAbility(Y7,'Avul')
	elseif GetTriggerExecCount(AG)== 1 and Mode__OnlyMid then
		call UnitRemoveAbility(SentinelsBuilding_AP_L1_MID,'Avul')
		call UnitRemoveAbility(W7,'Avul')
	endif
	if GetTriggerExecCount(AG)== 1 then
		call EnableTrigger(AddGoldForIntervalTrig)
	endif
	if Mode__OnlyMid == false and Mode__NoTop == false then
		if(ZT) then
			call CreateNUnitsAtLoc(BU,'ugho', Scourges[0], GU, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(BU,'u001', Scourges[0], GU, bj_UNIT_FACING)
		endif
		if MB then
			set WC = 1
			call ForGroup(bj_lastCreatedGroup, function GLO)
		endif
		call GHO(bj_lastCreatedGroup, 2)
	endif
	if Mode__NoMid == false then
		if(VU) then
			call CreateNUnitsAtLoc(BU,'ugho', Scourges[0], FU, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(BU,'u001', Scourges[0], FU, bj_UNIT_FACING)
		endif
		call GHO(bj_lastCreatedGroup, 3)
	endif
	if Mode__OnlyMid == false and Mode__NoBot == false then
		if(EU) then
			call CreateNUnitsAtLoc(BU,'ugho', Scourges[0], HU, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(BU,'u001', Scourges[0], HU, bj_UNIT_FACING)
		endif
		if MB then
			set WC = 2
			call ForGroup(bj_lastCreatedGroup, function GLO)
		endif
		call GHO(bj_lastCreatedGroup, 4)
	endif
	if Mode__OnlyMid == false and Mode__NoTop == false then
		if(UT) then
			call CreateNUnitsAtLoc(CU,'unec', Scourges[0], LU, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(CU,'u002', Scourges[0], LU, bj_UNIT_FACING)
		endif
		if MB then
			set WC = 1
			call ForGroup(bj_lastCreatedGroup, function GLO)
		endif
		call GHO(bj_lastCreatedGroup, 2)
	endif
	if Mode__NoMid == false then
		if(WT) then
			call CreateNUnitsAtLoc(CU,'unec', Scourges[0], JU, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(CU,'u002', Scourges[0], JU, bj_UNIT_FACING)
		endif
		call GHO(bj_lastCreatedGroup, 3)
	endif
	if Mode__OnlyMid == false and Mode__NoBot == false then
		if(YT) then
			call CreateNUnitsAtLoc(CU,'unec', Scourges[0], KU, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(CU,'u002', Scourges[0], KU, bj_UNIT_FACING)
		endif
		if MB then
			set WC = 2
			call ForGroup(bj_lastCreatedGroup, function GLO)
		endif
		call GHO(bj_lastCreatedGroup, 4)
	endif
	if GPO then
		if Mode__OnlyMid == false and Mode__NoTop == false then
			if(UT) then
				call CreateNUnitsAtLoc(CU,'umtw', Scourges[0], LU, bj_UNIT_FACING)
			else
				call CreateNUnitsAtLoc(CU,'u00R', Scourges[0], LU, bj_UNIT_FACING)
			endif
			if MB then
				set WC = 1
				call ForGroup(bj_lastCreatedGroup, function GLO)
			endif
			call GHO(bj_lastCreatedGroup, 2)
		endif
		if Mode__NoMid == false then
			if(WT) then
				call CreateNUnitsAtLoc(CU,'umtw', Scourges[0], JU, bj_UNIT_FACING)
			else
				call CreateNUnitsAtLoc(CU,'u00R', Scourges[0], JU, bj_UNIT_FACING)
			endif
			call GHO(bj_lastCreatedGroup, 3)
		endif
		if Mode__OnlyMid == false and Mode__NoBot == false then
			if(YT) then
				call CreateNUnitsAtLoc(CU,'umtw', Scourges[0], KU, bj_UNIT_FACING)
			else
				call CreateNUnitsAtLoc(CU,'u00R', Scourges[0], KU, bj_UNIT_FACING)
			endif
			if MB then
				set WC = 2
				call ForGroup(bj_lastCreatedGroup, function GLO)
			endif
			call GHO(bj_lastCreatedGroup, 4)
		endif
	endif
	if Mode__OnlyMid == false and Mode__NoTop == false then
		if(IU) then
			call CreateNUnitsAtLoc(BU,'esen', Sentinels[0], QU, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(BU,'e00V', Sentinels[0], QU, bj_UNIT_FACING)
		endif
		if MB then
			set WC = 2
			call ForGroup(bj_lastCreatedGroup, function GLO)
		endif
		call GHO(bj_lastCreatedGroup, 2)
	endif
	if Mode__NoMid == false then
		if(AU) then
			call CreateNUnitsAtLoc(BU,'esen', Sentinels[0], MU, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(BU,'e00V', Sentinels[0], MU, bj_UNIT_FACING)
		endif
		call GHO(bj_lastCreatedGroup, 3)
	endif
	if Mode__OnlyMid == false and Mode__NoBot == false then
		if(NU) then
			call CreateNUnitsAtLoc(BU,'esen', Sentinels[0], PU, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(BU,'e00V', Sentinels[0], PU, bj_UNIT_FACING)
		endif
		if MB then
			set WC = 1
			call ForGroup(bj_lastCreatedGroup, function GLO)
		endif
		call GHO(bj_lastCreatedGroup, 4)
	endif
	if Mode__OnlyMid == false and Mode__NoTop == false then
		if(XU) then
			call CreateNUnitsAtLoc(CU,'edry', Sentinels[0], UU, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(CU,'e00W', Sentinels[0], UU, bj_UNIT_FACING)
		endif
		if MB then
			set WC = 2
			call ForGroup(bj_lastCreatedGroup, function GLO)
		endif
		call GHO(bj_lastCreatedGroup, 2)
	endif
	if Mode__NoMid == false then
		if(OU) then
			call CreateNUnitsAtLoc(CU,'edry', Sentinels[0], SU, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(CU,'e00W', Sentinels[0], SU, bj_UNIT_FACING)
		endif
		call GHO(bj_lastCreatedGroup, 3)
	endif
	if Mode__OnlyMid == false and Mode__NoBot == false then
		if(RU) then
			call CreateNUnitsAtLoc(CU,'edry', Sentinels[0], TU, bj_UNIT_FACING)
		else
			call CreateNUnitsAtLoc(CU,'e00W', Sentinels[0], TU, bj_UNIT_FACING)
		endif
		if MB then
			set WC = 1
			call ForGroup(bj_lastCreatedGroup, function GLO)
		endif
		call GHO(bj_lastCreatedGroup, 4)
	endif
	if GPO then
		if Mode__OnlyMid == false and Mode__NoTop == false then
			if(RU) then
				call CreateNUnitsAtLoc(CU,'ebal', Sentinels[0], UU, bj_UNIT_FACING)
			else
				call CreateNUnitsAtLoc(CU,'e026', Sentinels[0], UU, bj_UNIT_FACING)
			endif
			if MB then
				set WC = 2
				call ForGroup(bj_lastCreatedGroup, function GLO)
			endif
			call GHO(bj_lastCreatedGroup, 2)
		endif
		if Mode__NoMid == false then
			if(OU) then
				call CreateNUnitsAtLoc(CU,'ebal', Sentinels[0], SU, bj_UNIT_FACING)
			else
				call CreateNUnitsAtLoc(CU,'e026', Sentinels[0], SU, bj_UNIT_FACING)
			endif
			call GHO(bj_lastCreatedGroup, 3)
		endif
		if Mode__OnlyMid == false and Mode__NoBot == false then
			if(RU) then
				call CreateNUnitsAtLoc(CU,'ebal', Sentinels[0], TU, bj_UNIT_FACING)
			else
				call CreateNUnitsAtLoc(CU,'e026', Sentinels[0], TU, bj_UNIT_FACING)
			endif
			if MB then
				set WC = 1
				call ForGroup(bj_lastCreatedGroup, function GLO)
			endif
			call GHO(bj_lastCreatedGroup, 4)
		endif
	endif
endfunction
function GQO takes nothing returns nothing
	set UT = false
	call DisableTrigger(F1)
	call JSX("Rax" + I2S(0)+ I2S(0)+ I2S(1), GetPlayerId(GetOwningPlayer(GetKillingUnit())))
	call ONX(GetKillingUnit(), true)
endfunction
function GSO takes nothing returns nothing
	set WT = false
	call DisableTrigger(G1)
	call JSX("Rax" + I2S(0)+ I2S(1)+ I2S(1), GetPlayerId(GetOwningPlayer(GetKillingUnit())))
	call ONX(GetKillingUnit(), true)
endfunction
function GTO takes nothing returns nothing
	set YT = false
	call DisableTrigger(H1)
	call JSX("Rax" + I2S(0)+ I2S(2)+ I2S(1), GetPlayerId(GetOwningPlayer(GetKillingUnit())))
	call ONX(GetKillingUnit(), true)
endfunction
function GUO takes nothing returns nothing
	set ZT = false
	call DisableTrigger(J1)
	call JSX("Rax" + I2S(0)+ I2S(0)+ I2S(0), GetPlayerId(GetOwningPlayer(GetKillingUnit())))
	call ONX(GetKillingUnit(), false)
endfunction
function GWO takes nothing returns nothing
	set VU = false
	call DisableTrigger(K1)
	call JSX("Rax" + I2S(0)+ I2S(1)+ I2S(0), GetPlayerId(GetOwningPlayer(GetKillingUnit())))
	call ONX(GetKillingUnit(), false)
endfunction
function GYO takes nothing returns nothing
	set EU = false
	call DisableTrigger(L1)
	call JSX("Rax" + I2S(0)+ I2S(2)+ I2S(0), GetPlayerId(GetOwningPlayer(GetKillingUnit())))
	call ONX(GetKillingUnit(), false)
endfunction
function GZO takes nothing returns nothing
	set XU = false
	call DisableTrigger(P1)
	call JSX("Rax" + I2S(1)+ I2S(0)+ I2S(1), GetPlayerId(GetOwningPlayer(GetKillingUnit())))
	call ONX(GetKillingUnit(), true)
endfunction
function G_O takes nothing returns nothing
	set OU = false
	call DisableTrigger(Q1)
	call JSX("Rax" + I2S(1)+ I2S(1)+ I2S(1), GetPlayerId(GetOwningPlayer(GetKillingUnit())))
	call ONX(GetKillingUnit(), true)
endfunction
function G0O takes nothing returns nothing
	set RU = false
	call DisableTrigger(S1)
	call JSX("Rax" + I2S(1)+ I2S(2)+ I2S(1), GetPlayerId(GetOwningPlayer(GetKillingUnit())))
	call ONX(GetKillingUnit(), true)
endfunction
function G1O takes nothing returns nothing
	set IU = false
	call DisableTrigger(T1)
	call JSX("Rax" + I2S(1)+ I2S(0)+ I2S(0), GetPlayerId(GetOwningPlayer(GetKillingUnit())))
	call ONX(GetKillingUnit(), false)
endfunction
function G2O takes nothing returns nothing
	set AU = false
	call DisableTrigger(U1)
	call JSX("Rax" + I2S(1)+ I2S(1)+ I2S(0), GetPlayerId(GetOwningPlayer(GetKillingUnit())))
	call ONX(GetKillingUnit(), false)
endfunction
function G3O takes nothing returns nothing
	set NU = false
	call DisableTrigger(W1)
	call JSX("Rax" + I2S(1)+ I2S(2)+ I2S(0), GetPlayerId(GetOwningPlayer(GetKillingUnit())))
	call ONX(GetKillingUnit(), false)
endfunction
function G4O takes nothing returns boolean
	local real G5O = GetWidgetLife(GetTriggerUnit())/ GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE)
	if G5O < .75 and D0V == false then
		set D0V = true
		call JSX("Tree", 75)
	endif
	if G5O < .5 and D_V == false then
		set D_V = true
		call JSX("Tree", 50)
	endif
	if G5O < .25 and DZV == false then
		set DZV = true
		call JSX("Tree", 25)
	endif
	if G5O < .1 and DYV == false then
		set DYV = true
		call JSX("Tree", 10)
	endif
	return false
endfunction
function G6O takes nothing returns boolean
	local real G5O = GetWidgetLife(GetTriggerUnit())/ GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE)
	if G5O < .75 and DWV == false then
		set DWV = true
		call JSX("Throne", 75)
	endif
	if G5O < .5 and DUV == false then
		set DUV = true
		call JSX("Throne", 50)
	endif
	if G5O < .25 and DTV == false then
		set DTV = true
		call JSX("Throne", 25)
	endif
	if G5O < .1 and DSV == false then
		set DSV = true
		call JSX("Throne", 10)
	endif
	return false
endfunction
function G7O takes nothing returns boolean
	return(not(IU or AU or NU or XU or OU or RU))
endfunction
function G8O takes nothing returns nothing
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, CR[LocalId]* 2, GetObjectName('n04O')+ " " + GetObjectName('n0C7'))
	call SetPlayerTechResearchedSwap('R00D',(GetPlayerTechCountSimple('R00D', Sentinels[0])+ 30), Sentinels[0])
	call SetPlayerTechResearchedSwap('R00C',(GetPlayerTechCountSimple('R00C', Sentinels[0])+ 30), Sentinels[0])
	call DisableTrigger(JG)
endfunction
function G9O takes nothing returns boolean
	return(not(ZT or VU or EU or UT or WT or YT))
endfunction
function HVO takes nothing returns nothing
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, CR[LocalId]* 2, GetObjectName('n04X')+ " " + GetObjectName('n0C9'))
	call SetPlayerTechResearchedSwap('R009',(GetPlayerTechCountSimple('R009', Scourges[0])+ 30), Scourges[0])
	call SetPlayerTechResearchedSwap('R00B',(GetPlayerTechCountSimple('R00B', Scourges[0])+ 30), Scourges[0])
	call DisableTrigger(KG)
endfunction
function HEO takes nothing returns nothing
	call SetPlayerTechResearchedSwap('R007',(GetPlayerTechCountSimple('R007', Sentinels[0])+ 1), Sentinels[0])
	call SetPlayerTechResearchedSwap('R00C',(GetPlayerTechCountSimple('R00C', Sentinels[0])+ 1), Sentinels[0])
	call SetPlayerTechResearchedSwap('R008',(GetPlayerTechCountSimple('R008', Sentinels[0])+ 1), Sentinels[0])
	call SetPlayerTechResearchedSwap('R00D',(GetPlayerTechCountSimple('R00D', Sentinels[0])+ 1), Sentinels[0])
	call SetPlayerTechResearchedSwap('R009',(GetPlayerTechCountSimple('R009', Scourges[0])+ 1), Scourges[0])
	call SetPlayerTechResearchedSwap('R003',(GetPlayerTechCountSimple('R003', Scourges[0])+ 1), Scourges[0])
	call SetPlayerTechResearchedSwap('R00A',(GetPlayerTechCountSimple('R00A', Scourges[0])+ 1), Scourges[0])
	call SetPlayerTechResearchedSwap('R00B',(GetPlayerTechCountSimple('R00B', Scourges[0])+ 1), Scourges[0])
	set MB = false
endfunction
function HXO takes nothing returns nothing
	local location HOO = GetRectCenter(J5)
	call RemoveUnit(CreateUnitAtLoc(BW,'nbdo', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nbds', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'ngst', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'n026', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nggr', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nbdk', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nbwm', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nogm', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nomg', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nfpc', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nfpu', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nsth', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nstl', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nsat', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nwlg', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nkol', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nkob', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nkot', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'ncnk', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'ncen', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'ngns', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nftb', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nfsh', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'ngh1', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'npfl', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nowe', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nowb', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nmrm', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nmrr', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'nmrl', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'ndtr', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'ndtw', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'n0LC', HOO, bj_UNIT_FACING))
	call RemoveUnit(CreateUnitAtLoc(BW,'n0LD', HOO, bj_UNIT_FACING))
	call RemoveLocation(HOO)
	set HOO = null
endfunction
function HRO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'n0HW', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'n0HX', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'n0HW', x, y, 0), x, y)
endfunction
function HIO takes real x, real y returns nothing
	local unit u
	set u = CreateUnit(BW,'njg1', x, y, 0)
	call SetUnitPosition(u, x, y)
	set u = CreateUnit(BW,'njg1', x, y, 0)
	call SetUnitPosition(u, x, y)
	set u = CreateUnit(BW,'njga', x, y, 0)
	call SetUnitPosition(u, x, y)
	set u = null
endfunction
function HAO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'nbdo', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nbdo', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nbds', x, y, 0), x, y)
endfunction
function HNO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'nbdk', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nbdk', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nbwm', x, y, 0), x, y)
endfunction
function HBO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'ngst', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'ngst', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nggr', x, y, 0), x, y)
endfunction
function HCO takes real x, real y returns nothing
	local unit u
	set u = CreateUnit(BW,'n0LC', x, y, 0)
	call SetUnitPosition(u, x, y)
	call SetUnitPosition(CreateUnit(BW,'n0LD', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'n0LD', x, y, 0), x, y)
	set u = null
endfunction
function HDO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'nogm', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nogm', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nomg', x, y, 0), x, y)
endfunction
function HFO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'nfpc', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nfpu', x, y, 0), x, y)
endfunction
function HGO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'nsth', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nstl', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nsat', x, y, 0), x, y)
endfunction
function HHO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'nstl', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nstl', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nsat', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nsat', x, y, 0), x, y)
endfunction
function HJO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'nwlg', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nwlg', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'n00S', x, y, 0), x, y)
endfunction
function HKO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'n026', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'n026', x, y, 0), x, y)
endfunction
function HLO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'nkol', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nkob', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nkob', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nkob', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nkot', x, y, 0), x, y)
endfunction
function HMO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'nftb', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nftb', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nfsh', x, y, 0), x, y)
endfunction
function HPO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'ncen', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'ncnk', x, y, 0), x, y)
endfunction
function HQO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'ngns', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'ngns', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'ngns', x, y, 0), x, y)
endfunction
function HSO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'nftb', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nftb', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nkol', x, y, 0), x, y)
endfunction
function HTO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'ngh1', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'npfl', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'npfl', x, y, 0), x, y)
endfunction
function HUO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'nowe', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nowb', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'nowb', x, y, 0), x, y)
endfunction
function HWO takes real x, real y returns nothing
	call SetUnitPosition(CreateUnit(BW,'ndtr', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'ndtr', x, y, 0), x, y)
	call SetUnitPosition(CreateUnit(BW,'ndtw', x, y, 0), x, y)
endfunction
function HYO takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != ZB[0]
		set i = GetRandomInt(1, 5)
	endloop
	set ZB[0]= i
	if i == 1 then
		call HFO(x, y)
	elseif i == 2 then
		call HGO(x, y)
	elseif i == 3 then
		call HUO(x, y)
	elseif i == 4 then
		call HWO(x, y)
	elseif i == 5 then
		call HPO(x, y)
	endif
endfunction
function HZO takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != ZB[1]
		set i = GetRandomInt(1, 5)
	endloop
	set ZB[1]= i
	if i == 1 then
		call HFO(x, y)
	elseif i == 2 then
		call HGO(x, y)
	elseif i == 3 then
		call HUO(x, y)
	elseif i == 4 then
		call HWO(x, y)
	elseif i == 5 then
		call HPO(x, y)
	endif
endfunction
function H_O takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != ZB[2]
		set i = GetRandomInt(1, 5)
	endloop
	set ZB[2]= i
	if i == 1 then
		call HFO(x, y)
	elseif i == 2 then
		call HGO(x, y)
	elseif i == 3 then
		call HUO(x, y)
	elseif i == 4 then
		call HWO(x, y)
	elseif i == 5 then
		call HPO(x, y)
	endif
endfunction
function H0O takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != ZB[3]
		set i = GetRandomInt(1, 5)
	endloop
	set ZB[3]= i
	if i == 1 then
		call HFO(x, y)
	elseif i == 2 then
		call HGO(x, y)
	elseif i == 3 then
		call HUO(x, y)
	elseif i == 4 then
		call HWO(x, y)
	elseif i == 5 then
		call HPO(x, y)
	endif
endfunction
function H1O takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != ZB[4]
		set i = GetRandomInt(1, 5)
	endloop
	set ZB[4]= i
	if i == 1 then
		call HKO(x, y)
	elseif i == 2 then
		call HDO(x, y)
	elseif i == 3 then
		call HHO(x, y)
	elseif i == 4 then
		call HJO(x, y)
	elseif i == 5 then
		call HPO(x, y)
	endif
endfunction
function H2O takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != ZB[5]
		set i = GetRandomInt(1, 5)
	endloop
	set ZB[5]= i
	if i == 1 then
		call HKO(x, y)
	elseif i == 2 then
		call HDO(x, y)
	elseif i == 3 then
		call HHO(x, y)
	elseif i == 4 then
		call HJO(x, y)
	elseif i == 5 then
		call HPO(x, y)
	endif
endfunction
function H3O takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != ZB[6]
		set i = GetRandomInt(1, 5)
	endloop
	set ZB[6]= i
	if i == 1 then
		call HKO(x, y)
	elseif i == 2 then
		call HDO(x, y)
	elseif i == 3 then
		call HHO(x, y)
	elseif i == 4 then
		call HJO(x, y)
	elseif i == 5 then
		call HPO(x, y)
	endif
endfunction
function H4O takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != ZB[7]
		set i = GetRandomInt(1, 5)
	endloop
	set ZB[7]= i
	if i == 1 then
		call HKO(x, y)
	elseif i == 2 then
		call HDO(x, y)
	elseif i == 3 then
		call HHO(x, y)
	elseif i == 4 then
		call HJO(x, y)
	elseif i == 5 then
		call HPO(x, y)
	endif
endfunction
function H5O takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 6)
	loop
	exitwhen i != ZB[8]
		set i = GetRandomInt(1, 6)
	endloop
	set ZB[8]= i
	if i == 1 then
		call HTO(x, y)
	elseif i == 2 then
		call HSO(x, y)
	elseif i == 3 then
		call HQO(x, y)
	elseif i == 4 then
		call HLO(x, y)
	elseif i == 5 then
		call HMO(x, y)
	elseif i == 6 then
		call HRO(x, y)
	endif
endfunction
function H6O takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 6)
	loop
	exitwhen i != ZB[9]
		set i = GetRandomInt(1, 6)
	endloop
	set ZB[9]= i
	if i == 1 then
		call HTO(x, y)
	elseif i == 2 then
		call HSO(x, y)
	elseif i == 3 then
		call HQO(x, y)
	elseif i == 4 then
		call HLO(x, y)
	elseif i == 5 then
		call HMO(x, y)
	elseif i == 6 then
		call HRO(x, y)
	endif
endfunction
function H7O takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != ZB[10]
		set i = GetRandomInt(3, 5)
	endloop
	set ZB[10]= i
	if i == 1 then
		call HIO(x, y)
	elseif i == 2 then
		call HAO(x, y)
	elseif i == 3 then
		call HNO(x, y)
	elseif i == 4 then
		call HBO(x, y)
	elseif i == 5 then
		call HCO(x, y)
	endif
endfunction
function H8O takes real x, real y returns nothing
	local integer i = GetRandomInt(1, 5)
	loop
	exitwhen i != ZB[11]
		set i = GetRandomInt(3, 5)
	endloop
	set ZB[11]= i
	if i == 1 then
		call HIO(x, y)
	elseif i == 2 then
		call HAO(x, y)
	elseif i == 3 then
		call HNO(x, y)
	elseif i == 4 then
		call HBO(x, y)
	elseif i == 5 then
		call HCO(x, y)
	endif
endfunction
function H9O takes nothing returns nothing
	if GetUnitAbilityLevel(GetEnumUnit(),'A0P4')!= 0 or GetUnitTypeId(GetEnumUnit())=='o003' or GetUnitTypeId(GetEnumUnit())=='o01X' or UnitIsDead(GetEnumUnit()) or IsMessengerUnit(GetEnumUnit()) then
		call GroupRemoveUnit(LW, GetEnumUnit())
	endif
endfunction
function JVO takes nothing returns boolean
	return(not(GetUnitAbilityLevel(GetFilterUnit(),'A0P4')!= 0 or GetUnitTypeId(GetFilterUnit())=='o003' or GetUnitTypeId(GetFilterUnit())=='o01X' or UnitIsDead(GetFilterUnit()) or IsMessengerUnit(GetFilterUnit())))
endfunction
function NeutralCreaturesRefreshActions takes nothing returns boolean
	local group g
	local rect r1
	local rect r2
	if Mode__NoNeutrals then
		return false
	endif
	set g = LoginGroup(43)
	call GroupEnumUnitsInRect(g, QZ, Condition(function JVO))
	
	//if Z3 then 
	if FirstOfGroup(g)== null then
		call H7O(GetRectCenterX(AZ), GetRectCenterY(AZ))
	endif
	call GroupEnumUnitsInRect(g, SZ, Condition(function JVO))
	if FirstOfGroup(g)== null then
		call H8O(GetRectCenterX(NZ), GetRectCenterY(NZ))
	endif
	//endif
	call GroupEnumUnitsInRect(g, TZ, Condition(function JVO))
	if FirstOfGroup(g)== null then
		call HYO(GetRectCenterX(BZ), GetRectCenterY(BZ))
	endif
	call GroupEnumUnitsInRect(g, UZ, Condition(function JVO))
	if FirstOfGroup(g)== null then
		call H_O(GetRectCenterX(CZ), GetRectCenterY(CZ))
	endif
	call GroupEnumUnitsInRect(g, WZ, Condition(function JVO))
	if FirstOfGroup(g)== null then
		call H6O(GetRectCenterX(DZ), GetRectCenterY(DZ))
	endif
	call GroupEnumUnitsInRect(g, YZ, Condition(function JVO))
	if FirstOfGroup(g)== null then
		call H5O(GetRectCenterX(FZ), GetRectCenterY(FZ))
	endif
	call GroupEnumUnitsInRect(g, ZZ, Condition(function JVO))
	if FirstOfGroup(g)== null then
		call H3O(GetRectCenterX(GZ), GetRectCenterY(GZ))
	endif
	call GroupEnumUnitsInRect(g, E0, Condition(function JVO))
	if FirstOfGroup(g)== null then
		call H4O(GetRectCenterX(HZ), GetRectCenterY(HZ))
	endif
	call GroupEnumUnitsInRect(g, V0, Condition(function JVO))
	if FirstOfGroup(g)== null then
		call H0O(GetRectCenterX(JZ), GetRectCenterY(JZ))
	endif
	call GroupEnumUnitsInRect(g, X0, Condition(function JVO))
	if FirstOfGroup(g)== null then
		call H1O(GetRectCenterX(KZ), GetRectCenterY(KZ))
	endif
	call GroupEnumUnitsInRect(g, I0, Condition(function JVO))
	if FirstOfGroup(g)== null then
		call H2O(GetRectCenterX(A0), GetRectCenterY(A0))
	endif
	call GroupEnumUnitsInRect(g, N0, Condition(function JVO))
	if FirstOfGroup(g)== null then
		call HZO(GetRectCenterX(B0), GetRectCenterY(B0))
	endif
	call LogoutGroup(g)
	set r1 = null
	set r2 = null
	set g = null
	return false
endfunction
function JXO takes nothing returns nothing
	local integer i = 0
	local group g
	local unit u = null
	local real x1
	local real y1
	local real x2
	local real y2
	local integer array JOO
	local integer JRO = GetRandomInt(0, 2)
	local integer F2O = 0
	local string s = ""
	local unit u2
	if Mode__NoMid and Mode__NoTop and Mode__NoBot then
		return
	endif
	set JOO[0]='n003'
	set JOO[1]='n00E'
	set JOO[2]='n00D'
	set F2O = JOO[JRO]
	set JRO = GetRandomInt(0, 2)
	if Mode__OnlyMid then
		set JRO = 0
	endif
	if(Mode__NoMid and JRO == 0) or(Mode__NoTop and JRO == 2) or(Mode__NoBot and JRO == 1) then
		loop
			set JRO = GetRandomInt(0, 2)
		exitwhen(Mode__NoMid and JRO != 0) or(Mode__NoTop and JRO != 2) or(Mode__NoBot and JRO != 1)
		endloop
	endif
	if JRO == 0 then
		set x1 = GetRectCenterX(H0)
		set y1 = GetRectCenterY(H0)
		set x2 = GetRectCenterX(C0)
		set y2 = GetRectCenterY(C0)
		set i = 2
		set s = "中路"
	elseif JRO == 1 then
		set x1 = GetRectCenterX(G0)
		set y1 = GetRectCenterY(G0)
		set x2 = GetRectCenterX(F0)
		set y2 = GetRectCenterY(F0)
		set i = 3
		set s = "下路"
	else
		set x1 = GetRectCenterX(J0)
		set y1 = GetRectCenterY(J0)
		set x2 = GetRectCenterX(D0)
		set y2 = GetRectCenterY(D0)
		set i = 4
		set s = "上路"
	endif
	if F2O > 0 then
		set g = LoginGroup(44)
		set u = CreateUnit(Sentinels[0], F2O, x1, y1, 90)
		call GroupAddUnit(g, u)
		set u2 = CreateUnit(Scourges[0], F2O, x2, y2, 90)
		call GroupAddUnit(g, u2)
		call GHO(g, i)
		if MB and JRO != 0 then
			call GroupClear(g)
			if JRO == 1 then
				set WC = 1
				call GroupAddUnit(g, u)
				call ForGroup(g, function GLO)
				call GroupClear(g)
				set WC = 2
				call GroupAddUnit(g, u2)
				call ForGroup(g, function GLO)
			else
				set WC = 1
				call GroupAddUnit(g, u2)
				call ForGroup(g, function GLO)
				call GroupClear(g)
				set WC = 2
				call GroupAddUnit(g, u)
				call ForGroup(g, function GLO)
			endif
		endif
		call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, CR[LocalId], "|c000000ff" + GetObjectName(F2O)+ "|r 已向双方阵营的 " + s + " 路出发")
		call LogoutGroup(g)
	endif
	set g = null
	set u = null
	set u2 = null
endfunction
function JIO takes nothing returns nothing
	local integer k
	local integer j
	local integer n
	local integer m
	local integer i
	local player p
	local integer TME
	local string JAO
	local string JNO
	local string JBO
	set D3V = D3V + 1
	set D4V = 0
	set D5V = 0
	set i = 0
	loop
	exitwhen i > 5
		set p = Sentinels[i]
		if XGX(p) then
			set D4V = D4V + 1
		endif
		set p = Scourges[i]
		if XGX(p) then
			set D5V = D5V + 1
		endif
		set i = i + 1
	endloop
	if YM == false then
		set IM1 = D4V
		set N1 = D5V
	endif
	set k = 1
	set j = 5
	set n = 1
	loop
	exitwhen k > j
		set p = Sentinels[k]
		if XGX(p) then
			set VW[n]= p
			set n = n + 1
		endif
		set k = k + 1
	endloop
	set k = 1
	set j = 5
	set n = 1
	loop
	exitwhen k > j
		set p = Scourges[k]
		if XGX(p) then
			set EW[n]= p
			set n = n + 1
		endif
		set k = k + 1
	endloop
	if D3V == 1 then
		set BT = CreateMultiboardBJ(8 + 6, 3 + D5V + D4V, " ")
		call MultiboardMinimize(BT, true)
	endif
	if ExtraAbilitiesNum  >= 2 then
		call VTX(BT, 2, 1, "CD1")
		call VTX(BT, 3, 1, "CD2")
	else
		call VTX(BT, 2, 1, "CD")
		call VTX(BT, 3, 1, " ")
	endif
	call VTX(BT, 4, 1, "|c00838B8BL|r")
	call VTX(BT, 5, 1, "|c00ff0303" + "K|r")
	call VTX(BT, 6, 1, "|c000042ff" + "D|r")
	call VTX(BT, 7, 1, "|c00646464" + "A|r")
	call VTX(BT, 1, 2, GetObjectName('n0DK'))
	call VTX(BT, 5, 2, "|c00ff0303" + "0|r")
	call VTX(BT, 6, 2, "|c000042ff" + "0|r")
	call VTX(BT, 1, 3 + D4V, GetObjectName('n0DO'))
	call VTX(BT, 5, 3 + D4V, "|c00ff0303" + "0|r")
	call VTX(BT, 6, 3 + D4V, "|c000042ff" + "0|r")
	set TME = GetPlayerId(Sentinels[0])
	call V0X(BT, 1, 2, X6X(SubString(JS[TME], 4, 6))/ 255. * 100 , X6X(SubString(JS[TME], 6, 8))/ 255. * 100 , X6X(SubString(JS[TME], 8, 10))/ 255. * 100 , 0)
	set TME = GetPlayerId(Scourges[0])
	call V0X(BT, 1, 3 + D4V, X6X(SubString(JS[TME], 4, 6))/ 255. * 100 , X6X(SubString(JS[TME], 6, 8))/ 255. * 100 , X6X(SubString(JS[TME], 8, 10))/ 255. * 100 , 0)
	set k = 1
	set j = 3 + D5V + D4V
	loop
	exitwhen k > j
		call V2X(BT, 1, k, 10.8)
		call V2X(BT, 2, k, 2)
		if ExtraAbilitiesNum  >= 2 then
			call V2X(BT, 3, k, 2)
		else
			call V2X(BT, 3, k, .01)
		endif
		call V2X(BT, 4, k, 2)
		call V2X(BT, 5, k, 1.3)
		call V2X(BT, 6, k, 1.3)
		call V2X(BT, 7, k, 1.3)
		call V2X(BT, 8, k, 2.5)
		call V2X(BT, 9, k, .01)
		call V2X(BT, 10, k, .01)
		call V2X(BT, 11, k, .01)
		call V2X(BT, 12, k, .01)
		call V2X(BT, 13, k, .01)
		call V2X(BT, 14, k, .01)
		set k = k + 1
	endloop
	set k = 1
	set j = 8 + 6
	loop
	exitwhen k > j
		set n = 1
		set m = 3 + D5V + D4V
		loop
		exitwhen n > m
			call VYX(BT, k, n, true, false)
			set n = n + 1
		endloop
		set k = k + 1
	endloop
	set k = 1
	set j = D4V
	loop
	exitwhen k > j
		call VYX(BT, 1, k + 2, true, true)
		call V0X(BT, 8, k + 2, 255,$CC, 0, 0)
		set TME = GetPlayerId(VW[k])
		set D1V[TME]= 1 -1
		set D2V[TME]= k + 2 -1
		call VTX(BT, 1, k + 2,(VMV[TME]))
		if IsPlaying(VW[k]) then
			set JAO = SubString(JS[TME], 4, 6)
			set JNO = SubString(JS[TME], 6, 8)
			set JBO = SubString(JS[TME], 8, 10)
			call V0X(BT, 1, k + 2, X6X(JAO)/ 255. * 100 , X6X(JNO)/ 255. * 100 , X6X(JBO)/ 255. * 100 , 0)
			call V0X(BT, 2, k + 2, X6X(JAO)/ 255. * 100 , X6X(JNO)/ 255. * 100 , X6X(JBO)/ 255. * 100 , 0)
			call V0X(BT, 3, k + 2, X6X(JAO)/ 255. * 100 , X6X(JNO)/ 255. * 100 , X6X(JBO)/ 255. * 100 , 0)
		else
			call VTX(BT, 1, k + 2, "|c00333333" +(VMV[TME])+ "|r")
		endif
		call VTX(BT, 5, k + 2, "|c00ff0303" + "0|r")
		call VTX(BT, 6, k + 2, "|c000042ff" + "0|r")
		call VTX(BT, 7, k + 2, "|c00646464" + "0|r")
		set k = k + 1
	endloop
	set k = 1
	set j = D5V
	loop
	exitwhen k > j
		call VYX(BT, 1, k + 3 + D4V, true, true)
		call V0X(BT, 8, k + 3 + D4V, 255,$CC, 0, 0)
		set TME = GetPlayerId(EW[k])
		set D1V[TME]= 1 -1
		set D2V[TME]= k + 3 + D4V -1
		call VTX(BT, 1, k + 3 + D4V,(VMV[TME]))
		if IsPlaying(EW[k]) then
			set JAO = SubString(JS[TME], 4, 6)
			set JNO = SubString(JS[TME], 6, 8)
			set JBO = SubString(JS[TME], 8, 10)
			call V0X(BT, 1, k + 3 + D4V, X6X(JAO)/ 255. * 100 , X6X(JNO)/ 255. * 100 , X6X(JBO)/ 255. * 100 , 0)
			call V0X(BT, 2, k + 3 + D4V, X6X(JAO)/ 255. * 100 , X6X(JNO)/ 255. * 100 , X6X(JBO)/ 255. * 100 , 0)
			call V0X(BT, 3, k + 3 + D4V, X6X(JAO)/ 255. * 100 , X6X(JNO)/ 255. * 100 , X6X(JBO)/ 255. * 100 , 0)
		else
			call VTX(BT, 1, k + 3 + D4V, "|c00333333" +(VMV[TME])+ "|r")
		endif
		call VTX(BT, 5, k + 3 + D4V, "|c00ff0303" + "0|r")
		call VTX(BT, 6, k + 3 + D4V, "|c000042ff" + "0|r")
		call VTX(BT, 7, k + 3 + D4V, "|c00646464" + "0|r")
		set k = k + 1
	endloop
	if MW and(LocalPlayer== VKV or LocalPlayer== VLV) and D3V == 1 then
		call MultiboardDisplay(BT, false)
	endif
	call VYX(BT, 8, 1, false, true)
	call VWX(BT, 8, 1, "UI\\Feedback\\Resources\\ResourceGold.blp")
	if D3V > 1 then
		call TriggerExecute(TG)
	endif
	set p = null
endfunction
function JCO takes nothing returns nothing
	local integer i
	local integer k
	call VTX(BT, 5, 2, "|c00ff0303" + I2S(RQ[GetPlayerId(Sentinels[0])])+ "|r")
	call VTX(BT, 6, 2, "|c000042ff" + I2S(IQ[GetPlayerId(Sentinels[0])])+ "|r")
	call VTX(BT, 5, 3 + D4V, "|c00ff0303" + I2S(RQ[GetPlayerId(Scourges[0])])+ "|r")
	call VTX(BT, 6, 3 + D4V, "|c000042ff" + I2S(IQ[GetPlayerId(Scourges[0])])+ "|r")
	set i = 1
	set k = D4V
	loop
	exitwhen i > k
		call VTX(BT, 5,(i + 2), "|c00ff0303" + I2S(RQ[GetPlayerId(VW[i])])+ "|r")
		call VTX(BT, 6,(i + 2), "|c000042ff" + I2S(IQ[GetPlayerId(VW[i])])+ "|r")
		call VTX(BT, 7,(i + 2), "|c00646464" + I2S(CQ[GetPlayerId(VW[i])])+ "|r")
		set i = i + 1
	endloop
	set i = 1
	set k = D5V
	loop
	exitwhen i > k
		call VTX(BT, 5,(i + 3 + D4V), "|c00ff0303" + I2S(RQ[GetPlayerId(EW[i])])+ "|r")
		call VTX(BT, 6,(i + 3 + D4V), "|c000042ff" + I2S(IQ[GetPlayerId(EW[i])])+ "|r")
		call VTX(BT, 7,(i + 3 + D4V), "|c00646464" + I2S(CQ[GetPlayerId(EW[i])])+ "|r")
		set i = i + 1
	endloop
endfunction
function JDO takes integer a returns integer
	local integer i = 0
	local integer x = 0
	local string s = I2S(a)
	loop
	exitwhen i > StringLength(s)
		if SubString(s, i, i + 1)== "1"then
			set x = x + 1
		endif
		set i = i + 1
	endloop
	return x
endfunction
function JFO takes player p, integer k returns string
	if IsPlayerAlly(LocalPlayer, p) then
		if GXV[LocalId]then
			if k <= 4 + ExtraAbilitiesNum  then
				return HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(p)* HL + k]]
			else
				return "UI\\Widgets\\Console\\Undead\\undead-inventory-slotfiller.blp"
			endif
		endif
		return H5X(UnitItemInSlot(Player__Hero[GetPlayerId(p)], k -1))
	else
		return "UI\\Widgets\\Console\\Undead\\undead-inventory-slotfiller.blp"
	endif
endfunction
function JGO takes nothing returns string
	local integer TME = LocalId
	local string loc_str = ""
	if LoadBoolean(K, GetHandleId(LocalPlayer),'OptC') then
		return""
	endif
	if GetUnitAbilityLevel(Player__Hero[TME],'A0K9')> 0 then
		set loc_str = loc_str + "|c0064a8e5"
		set loc_str = loc_str + I2S(LoadInteger(HY, GetHandleId(Player__Hero[TME]),'A0K9'))
		set loc_str = loc_str + " (" + I2S(R2I(LoadReal(HY, GetHandleId(LoadTriggerHandle(HY, GetHandleId(Player__Hero[TME]),'A0K9')), 0)))+ ")"
		set loc_str = loc_str + "|r;"
	endif
	if GetUnitAbilityLevel(Player__Hero[TME],'A34J')> 0 then
		if loc_str != "" then
			set loc_str = loc_str + " "
		endif
		set loc_str = loc_str + "|c009621c4"
		set loc_str = loc_str + I2S(LoadInteger(HY, GetHandleId(Player__Hero[TME]),'A34J'))
		set loc_str = loc_str + " (" + I2S(R2I(LoadReal(HY, GetHandleId(LoadTriggerHandle(HY, GetHandleId(Player__Hero[TME]),'A34J')), 0)))+ ")"
		set loc_str = loc_str + "|r;"
	endif
	if GetUnitAbilityLevel(Player__Hero[TME],'A064')> 0 then
		if loc_str != "" then
			set loc_str = loc_str + " "
		endif
		set loc_str = loc_str + "|c00dcf1f7"
		set loc_str = loc_str + I2S(LoadInteger(HY, GetHandleId(Player__Hero[TME]),'A064'))
		set loc_str = loc_str + " (" + I2S(R2I(LoadReal(HY, GetHandleId(LoadTriggerHandle(HY, GetHandleId(Player__Hero[TME]),'A064')), 0)))+ ")"
		set loc_str = loc_str + "|r;"
	endif
	if loc_str != "" then
		set loc_str = "充能点数: " + loc_str
	endif
	return loc_str
endfunction
function JHO takes nothing returns nothing
	local integer O3X
	local integer K0X
	local string KGX
	local real JJO
	local string s1 = " "
	local integer r
	local integer i
	local integer array time_1a
	local string array color_1a
	local integer index_1a = 0
	local integer array time_1b
	local string array color_1b
	local integer index_1b = 0
	local integer x = 0
	local integer id
	local string JKO
	local string JLO
	local string JMO
	local string JPO
	local string JQO
	local string s2 = " "
	local string s
	local string JSO
	local real JTO
	local real JUO
	local string spacer
	local integer JWO = 0
	local string JYO = ""
	local string JZO = ""
	local integer J_O = 0
	local integer J0O = 0
	local string J1O = ""
	local integer TME
	local string HUX = ""
	if BT == null then
		return
	endif
	set HUX = JGO()
	set i = 1
	loop
	exitwhen i > 5
		set TME = GetPlayerId(Sentinels[i])
		set r = R2I(TimerGetRemaining(PS[TME]))
		if r > 0 then
			set JWO = JWO + JDO(r)
			if J_O == 0 then
				if r <$A then
					set JYO = JS[TME]+ "0" + I2S(r)+ " |r"
				else
					set JYO = JS[TME]+ I2S(r)+ " |r"
				endif
			else
				if r <$A then
					set JYO = JYO + "|c00ffffff" + "| |r" + JS[TME]+ "0" + I2S(r)+ " |r"
				else
					set JYO = JYO + "|c00ffffff" + "| |r" + JS[TME]+ I2S(r)+ " |r"
				endif
			endif
			set J_O = J_O + 1
		endif
		set i = i + 1
	endloop
	if J_O > 0 then
		if IsPlayerAlly(LocalPlayer, Sentinels[0]) then
			set JYO = "|c00ffffff" + "[" + GetObjectName('n0JS')+ " |r" + JYO + "|c00ffffff" + "]|r"
		else
			set JYO = "|c00ff0303" + "[" + GetObjectName('n0JR')+ " |r" + JYO + "|c00ff0303" + "]|r"
		endif
	endif
	set i = 1
	loop
	exitwhen i > 5
		set TME = GetPlayerId(Scourges[i])
		set r = R2I(TimerGetRemaining(PS[TME]))
		if r > 0 then
			set JWO = JWO + JDO(r)
			if J0O == 0 then
				if r <$A then
					set JZO = JS[TME]+ "0" + I2S(r)+ " |r"
				else
					set JZO = JS[TME]+ I2S(r)+ " |r"
				endif
			else
				if r <$A then
					set JZO = JZO + "|c00ffffff" + "| |r" + JS[TME]+ "0" + I2S(r)+ " |r"
				else
					set JZO = JZO + "|c00ffffff" + "| |r" + JS[TME]+ I2S(r)+ " |r"
				endif
			endif
			set J0O = J0O + 1
		endif
		set i = i + 1
	endloop
	if J0O > 0 then
		if IsPlayerAlly(LocalPlayer, Scourges[0]) then
			set JZO = "|c00ffffff" + "[" + GetObjectName('n0JS')+ " |r" + JZO + "|c00ffffff" + "]|r"
		else
			set JZO = "|c00ff0303" + "[" + GetObjectName('n0JR')+ " |r" + JZO + "|c00ff0303" + "]|r"
		endif
	endif
	if BT != null then
		set id = LocalId
		if id >= 0 and id < 16 then
			if U3[x]then
				set JKO = I2S(RQ[id])
				set JLO = I2S(IQ[id])
				set JMO = I2S(CQ[id])
				set JPO = I2S(AQ[id])
				set JQO = I2S(NQ[id])
				set s2 = " |c00838B8B(" + JKO + "/" + JLO + "/" + JMO + " - " + JPO + "/" + JQO + " - |r|c00FFDC00" + I2S(EUV[id])+ "|r |c00838B8B)|r"
			endif
		endif
	endif
	if J0O == 0 and J_O == 0 then
		call MultiboardSetTitleText(BT, HUX + s2)
	else
		if IsPlayerAlly(LocalPlayer, Sentinels[0]) then
			call MultiboardSetTitleText(BT, HUX + JZO + " " + JYO + " " + s2)
		else
			call MultiboardSetTitleText(BT, HUX + JYO + " " + JZO + " " + s2)
		endif
	endif
	if not InHeroSelection then
		if(MW and(LocalPlayer== VKV or LocalPlayer== VLV))== false then
			call MultiboardDisplay(BT, true)
		endif
	endif
	if GBV[LocalId]== false then
		call SetWaterBaseColor(0, 0, 255, 255)
	endif
	set O3X = 1
	set K0X = D4V
	loop
	exitwhen O3X > K0X
		set TME = GetPlayerId(VW[O3X])
		call VWX(BT, 1, O3X + 2, ELX(Player__Hero[TME]))
		call VTX(BT, 4, O3X + 2, "|c00838B8B" + I2S(GetHeroLevel(Player__Hero[TME]))+ "|r")
		if GEV[LocalId]then
			call V2X(BT, 8, 1, 3)
			call V2X(BT, 9, 1, 2.8)
			call V2X(BT, 10, 1, .8)
			call V2X(BT, 11, 1, .8)
			call V2X(BT, 12, 1, .8)
			call V2X(BT, 13, 1, .8)
			call V2X(BT, 14, 1, .1)
			call V2X(BT, 8, O3X + 2, 3)
			call V2X(BT, 9, O3X + 2, 1.1)
			call V2X(BT, 10, O3X + 2, 1.1)
			call V2X(BT, 11, O3X + 2, 1.1)
			call V2X(BT, 12, O3X + 2, 1.1)
			call V2X(BT, 13, O3X + 2, 1.1)
			call V2X(BT, 14, O3X + 2, .1)
			call VYX(BT, 9, O3X + 2, false, true)
			call VYX(BT, 10, O3X + 2, false, true)
			call VYX(BT, 11, O3X + 2, false, true)
			call VYX(BT, 12, O3X + 2, false, true)
			call VYX(BT, 13, O3X + 2, false, true)
			call VYX(BT, 14, O3X + 2, false, true)
			call VTX(BT, 9, 1, "物品")
		elseif GXV[LocalId]then
			call V2X(BT, 8, 1, 3)
			call V2X(BT, 9, 1, 2.8)
			call V2X(BT, 10, 1, .8)
			call V2X(BT, 11, 1, .8)
			call V2X(BT, 12, 1, .8)
			call V2X(BT, 13, 1, .8)
			call V2X(BT, 14, 1, .1)
			call V2X(BT, 8, O3X + 2, 3)
			call V2X(BT, 9, O3X + 2, 1.1)
			call V2X(BT, 10, O3X + 2, 1.1)
			call V2X(BT, 11, O3X + 2, 1.1)
			if ExtraAbilitiesNum  >= 1 then
				call V2X(BT, 12, O3X + 2, 1.1)
			else
				call V2X(BT, 12, O3X + 2, .1)
			endif
			if ExtraAbilitiesNum  >= 2 then
				call V2X(BT, 13, O3X + 2, 1.1)
			else
				call V2X(BT, 13, O3X + 2, .1)
			endif
			call V2X(BT, 14, O3X + 2, .1)
			call VYX(BT, 9, O3X + 2, false, true)
			call VYX(BT, 10, O3X + 2, false, true)
			call VYX(BT, 11, O3X + 2, false, true)
			call VYX(BT, 12, O3X + 2, false, true)
			if ExtraAbilitiesNum  >= 1 then
				call VYX(BT, 13, O3X + 2, false, true)
			else
				call VYX(BT, 13, O3X + 2, false, false)
			endif
			if ExtraAbilitiesNum  >= 2 then
				call VYX(BT, 14, O3X + 2, false, true)
			else
				call VYX(BT, 14, O3X + 2, false, false)
			endif
			call VTX(BT, 9, 1, "技能")
		else
			call V2X(BT, 8, 1, 2)
			call V2X(BT, 9, 1, .1)
			call V2X(BT, 10, 1, .1)
			call V2X(BT, 11, 1, .1)
			call V2X(BT, 12, 1, .1)
			call V2X(BT, 13, 1, .1)
			call V2X(BT, 14, 1, .1)
			call V2X(BT, 8, O3X + 2, 2.5)
			call V2X(BT, 9, O3X + 2, .1)
			call V2X(BT, 10, O3X + 2, .1)
			call V2X(BT, 11, O3X + 2, .1)
			call V2X(BT, 12, O3X + 2, .1)
			call V2X(BT, 13, O3X + 2, .1)
			call V2X(BT, 14, O3X + 2, .1)
			call VYX(BT, 9, O3X + 2, false, false)
			call VYX(BT, 10, O3X + 2, false, false)
			call VYX(BT, 11, O3X + 2, false, false)
			call VYX(BT, 12, O3X + 2, false, false)
			call VYX(BT, 13, O3X + 2, false, false)
			call VYX(BT, 14, O3X + 2, false, false)
			call VTX(BT, 9, 1, " ")
		endif
		call VWX(BT, 9, O3X + 2, JFO(VW[O3X], 1))
		call VWX(BT, 10, O3X + 2, JFO(VW[O3X], 2))
		call VWX(BT, 11, O3X + 2, JFO(VW[O3X], 3))
		call VWX(BT, 12, O3X + 2, JFO(VW[O3X], 4))
		call VWX(BT, 13, O3X + 2, JFO(VW[O3X], 5))
		call VWX(BT, 14, O3X + 2, JFO(VW[O3X], 6))
		set TME = GetPlayerId(VW[O3X])
		if(E8X(Player__Hero[TME]) and Player__Hero[TME]!= null and TimerGetRemaining(PS[TME])> 0) then
			if IsPlayerAlly(LocalPlayer, VW[O3X]) then
				set J1O = "|c00ffffff" + " (" + I2S(R2I(TimerGetRemaining(PS[TME])))+ ")|r"
			else
				set J1O = "|c00ff0303" + " (" + I2S(R2I(TimerGetRemaining(PS[TME])))+ ")|r"
			endif
		else
			set J1O = "  "
		endif
		if EJV[TME]then
			call VTX(BT, 1, O3X + 2, TM + "|c00333333" +(VMV[TME])+ "|r" + J1O)
		else
			call VTX(BT, 1, O3X + 2, TM +(VMV[TME])+ J1O)
		endif
		set JTO =(TimerGetRemaining(ESV[TME]))
		if JTO > 0 then
			set s = I2S(R2I(JTO))
		else
			set s = " "
		endif
		set JUO =(TimerGetRemaining(ETV[TME]))
		if JUO > 0 then
			set JSO = I2S(R2I(JUO))
		else
			set JSO = " "
		endif
		if IsPlayerEnemy(LocalPlayer, VW[O3X]) and GetUnitAbilityLevel(Player__Hero[GetPlayerId(VW[O3X])],'B00L')== 0 then
			call VTX(BT, 8, O3X + 2, " ")
			set s = " "
			set JSO = " "
		else
			call VTX(BT, 8, O3X + 2, "|cffffcc00" + I2S(R2I(GetPlayerState(VW[O3X], PLAYER_STATE_RESOURCE_GOLD)))+ "|r")
		endif
		call VTX(BT, 2, O3X + 2, s)
		call VTX(BT, 3, O3X + 2, JSO)
		set O3X = O3X + 1
	endloop
	set O3X = 1
	set K0X = D5V
	loop
	exitwhen O3X > K0X
		set TME = GetPlayerId(EW[O3X])
		call VWX(BT, 1, O3X + 3 + D4V, ELX(Player__Hero[TME]))
		call VTX(BT, 4, O3X + 3 + D4V, "|c00838B8B" + I2S(GetHeroLevel(Player__Hero[TME]))+ "|r")
		if GEV[LocalId]then
			call V2X(BT, 8, 1, 3)
			call V2X(BT, 9, 1, 2.8)
			call V2X(BT, 10, 1, .8)
			call V2X(BT, 11, 1, .8)
			call V2X(BT, 12, 1, .8)
			call V2X(BT, 13, 1, .8)
			call V2X(BT, 14, 1, .1)
			call V2X(BT, 8, O3X + 3 + D4V, 3)
			call V2X(BT, 9, O3X + 3 + D4V, 1.1)
			call V2X(BT, 10, O3X + 3 + D4V, 1.1)
			call V2X(BT, 11, O3X + 3 + D4V, 1.1)
			call V2X(BT, 12, O3X + 3 + D4V, 1.1)
			call V2X(BT, 13, O3X + 3 + D4V, 1.1)
			call V2X(BT, 14, O3X + 3 + D4V, .1)
			call VYX(BT, 9, O3X + 3 + D4V, false, true)
			call VYX(BT, 10, O3X + 3 + D4V, false, true)
			call VYX(BT, 11, O3X + 3 + D4V, false, true)
			call VYX(BT, 12, O3X + 3 + D4V, false, true)
			call VYX(BT, 13, O3X + 3 + D4V, false, true)
			call VYX(BT, 14, O3X + 3 + D4V, false, true)
			call VTX(BT, 9, 1, "Items")
		elseif GXV[LocalId]then
			call V2X(BT, 8, 1, 3)
			call V2X(BT, 9, 1, 2.8)
			call V2X(BT, 10, 1, .8)
			call V2X(BT, 11, 1, .8)
			call V2X(BT, 12, 1, .8)
			call V2X(BT, 13, 1, .8)
			call V2X(BT, 14, 1, .1)
			call V2X(BT, 8, O3X + 3 + D4V, 3)
			call V2X(BT, 9, O3X + 3 + D4V, 1.1)
			call V2X(BT, 10, O3X + 3 + D4V, 1.1)
			call V2X(BT, 11, O3X + 3 + D4V, 1.1)
			if ExtraAbilitiesNum  >= 1 then
				call V2X(BT, 12, O3X + 3 + D4V, 1.1)
			else
				call V2X(BT, 12, O3X + 3 + D4V, .1)
			endif
			if ExtraAbilitiesNum  >= 2 then
				call V2X(BT, 13, O3X + 3 + D4V, 1.1)
			else
				call V2X(BT, 13, O3X + 3 + D4V, .1)
			endif
			call V2X(BT, 14, O3X + 3 + D4V, .1)
			call VYX(BT, 9, O3X + 3 + D4V, false, true)
			call VYX(BT, 10, O3X + 3 + D4V, false, true)
			call VYX(BT, 11, O3X + 3 + D4V, false, true)
			call VYX(BT, 12, O3X + 3 + D4V, false, true)
			if ExtraAbilitiesNum  >= 1 then
				call VYX(BT, 13, O3X + 3 + D4V, false, true)
			else
				call VYX(BT, 13, O3X + 3 + D4V, false, false)
			endif
			if ExtraAbilitiesNum  >= 2 then
				call VYX(BT, 14, O3X + 3 + D4V, false, true)
			else
				call VYX(BT, 14, O3X + 3 + D4V, false, false)
			endif
			call VTX(BT, 9, 1, "技能")
		else
			call V2X(BT, 8, 1, 2)
			call V2X(BT, 9, 1, .1)
			call V2X(BT, 10, 1, .1)
			call V2X(BT, 11, 1, .1)
			call V2X(BT, 12, 1, .1)
			call V2X(BT, 13, 1, .1)
			call V2X(BT, 14, 1, .1)
			call V2X(BT, 8, O3X + 3 + D4V, 2.5)
			call V2X(BT, 9, O3X + 3 + D4V, .1)
			call V2X(BT, 10, O3X + 3 + D4V, .1)
			call V2X(BT, 11, O3X + 3 + D4V, .1)
			call V2X(BT, 12, O3X + 3 + D4V, .1)
			call V2X(BT, 13, O3X + 3 + D4V, .1)
			call V2X(BT, 14, O3X + 3 + D4V, .1)
			call VYX(BT, 9, O3X + 3 + D4V, false, false)
			call VYX(BT, 10, O3X + 3 + D4V, false, false)
			call VYX(BT, 11, O3X + 3 + D4V, false, false)
			call VYX(BT, 12, O3X + 3 + D4V, false, false)
			call VYX(BT, 13, O3X + 3 + D4V, false, false)
			call VYX(BT, 14, O3X + 3 + D4V, false, false)
			call VTX(BT, 9, 1, " ")
		endif
		call VWX(BT, 9, O3X + 3 + D4V, JFO(EW[O3X], 1))
		call VWX(BT, 10, O3X + 3 + D4V, JFO(EW[O3X], 2))
		call VWX(BT, 11, O3X + 3 + D4V, JFO(EW[O3X], 3))
		call VWX(BT, 12, O3X + 3 + D4V, JFO(EW[O3X], 4))
		call VWX(BT, 13, O3X + 3 + D4V, JFO(EW[O3X], 5))
		call VWX(BT, 14, O3X + 3 + D4V, JFO(EW[O3X], 6))
		set TME = GetPlayerId(EW[O3X])
		if(E8X(Player__Hero[TME]) and Player__Hero[TME]!= null and TimerGetRemaining(PS[TME])> 0) then
			if IsPlayerAlly(LocalPlayer, EW[O3X]) then
				set J1O = "|c00ffffff" + " (" + I2S(R2I(TimerGetRemaining(PS[TME])))+ ")|r"
			else
				set J1O = "|c00ff0303" + " (" + I2S(R2I(TimerGetRemaining(PS[TME])))+ ")|r"
			endif
		else
			set J1O = "  "
		endif
		if EJV[TME]then
			call VTX(BT, 1, O3X + 3 + D4V, TM + "|c00333333" +(VMV[TME])+ "|r" + J1O)
		else
			call VTX(BT, 1, O3X + 3 + D4V, TM +(VMV[TME])+ J1O)
		endif
		set JTO = TimerGetRemaining(ESV[TME])
		if JTO > 0 then
			set s = I2S(R2I(JTO))
		else
			set s = " "
		endif
		set JUO = TimerGetRemaining(ETV[TME])
		if JUO > 0 then
			set JSO = I2S(R2I(JUO))
		else
			set JSO = " "
		endif
		if IsPlayerEnemy(LocalPlayer, EW[O3X]) and GetUnitAbilityLevel(Player__Hero[GetPlayerId(EW[O3X])],'B00L')== 0 then
			call VTX(BT, 8, O3X + 3 + D4V, " ")
			set s = " "
			set JSO = " "
		else
			call VTX(BT, 8, O3X + 3 + D4V, "|cffffcc00" + I2S(R2I(GetPlayerState(EW[O3X], PLAYER_STATE_RESOURCE_GOLD)))+ "|r")
		endif
		call VTX(BT, 2, O3X + 3 + D4V, s)
		call VTX(BT, 3, O3X + 3 + D4V, JSO)
		set O3X = O3X + 1
	endloop
endfunction
function J2O takes player p returns string
	return JS[GetPlayerId(p)]+ VMV[GetPlayerId(p)]+ "|r"
endfunction
function J3O takes player p returns string
	local string J4O = I2S(E6V[GetPlayerId(p)])
	local string J5O = J4O
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + J4O + "|r"
	endif
	return J5O
endfunction
function J6O takes player p returns string
	local string J4O = I2S(E5V[GetPlayerId(p)])
	local string J5O = J4O
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + J4O + "|r"
	endif
	return J5O
endfunction
function L5X takes nothing returns nothing
	local integer i = 1
	local multiboarditem VUX
	loop
	exitwhen i > FVV
		if(BY[GetPlayerId((D9V[i]))])!= "Here"then
			set VUX = MultiboardGetItem(D6V, D7V[i], D8V[i])
			call MultiboardSetItemStyle(VUX, true, false)
			call MultiboardSetItemValue(VUX, "|c00555555" +(BY[GetPlayerId((D9V[i]))])+ "|r")
			call MultiboardSetItemWidth(VUX, .07)
			call MultiboardReleaseItem(VUX)
		endif
		set i = i + 1
	endloop
	set VUX = null
endfunction
function J7O takes player p returns string
	local string J4O = I2S(GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD))
	local string J5O = J4O
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + J4O + "|r"
	endif
	return J5O
endfunction
function J8O takes player p returns string
	local string J4O = I2S(DQ[GetPlayerId(p)])
	local string J5O = J4O
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + J4O + "|r"
	endif
	return J5O
endfunction
function J9O takes player p returns string
	local string J4O = I2S(GetUnitLevel(Player__Hero[GetPlayerId(p)]))
	local string J5O = J4O
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + J4O + "|r"
	endif
	return J5O
endfunction
function KVO takes player p returns string
	local string J4O = I2S(FQ[GetPlayerId(p)])
	local string J5O = J4O
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + J4O + "|r"
	endif
	return J5O
endfunction
function KEO takes player p returns string
	local string J4O = I2S(PQ[GetPlayerId(p)])
	local string J5O = J4O
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + J4O + "|r"
	endif
	return J5O
endfunction
function KXO takes player p returns string
	local string J4O = I2S(GQ[GetPlayerId(p)])
	local string J5O = J4O
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + J4O + "|r"
	endif
	return J5O
endfunction
function KOO takes player p returns string
	local string J4O = I2S(CQ[GetPlayerId(p)])
	local string J5O = J4O
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + J4O + "|r"
	endif
	return J5O
endfunction
function KRO takes player p returns string
	local string J4O = I2S(RQ[GetPlayerId(p)])
	local string J5O = J4O
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + J4O + "|r"
	endif
	return J5O
endfunction
function KIO takes player p returns string
	local string J4O = I2S(IQ[GetPlayerId(p)])
	local string J5O = J4O
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + J4O + "|r"
	endif
	return J5O
endfunction
function KAO takes player p returns string
	local string J4O = I2S(AQ[GetPlayerId(p)])
	local string J5O = J4O
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + J4O + "|r"
	endif
	return J5O
endfunction
function KNO takes player p returns string
	local string J4O = I2S(NQ[GetPlayerId(p)])
	local string J5O = J4O
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + J4O + "|r"
	endif
	return J5O
endfunction
function KBO takes player p returns string
	local string J4O = I2S((LoadInteger(HY,(400 + GetPlayerId(p)), 79)))
	local string J5O = J4O
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + J4O + "|r"
	endif
	return J5O
endfunction
function KCO takes player p returns string
	local string J4O = I2S(JQ[GetPlayerId(p)])
	local string J5O = J4O
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + J4O + "|r"
	endif
	return J5O
endfunction
function KDO takes player p returns string
	local string J4O = I2S(KQ[GetPlayerId(p)])
	local string J5O = J4O
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + J4O + "|r"
	endif
	return J5O
endfunction
function KFO takes player p returns string
	local string J4O = I2S(HQ[GetPlayerId(p)])
	local string J5O = J4O
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + J4O + "|r"
	endif
	return J5O
endfunction
function KGO takes player p returns string
	local string KHO
	local string KJO
	local string J5O
	local integer k = QQ[GetPlayerId(p)]
	local integer d = MQ[GetPlayerId(p)]
	if k < 1 then
		set k = 0
	endif
	if d < 1 then
		set d = 0
	endif
	set KHO = I2S(k)
	set KJO = I2S(d)
	set J5O = KHO + "/" + KJO
	if p == LocalPlayer then
		set J5O = "|c00FF6600" + KHO + "|r/" + "|c00FF6600" + KJO + "|r"
	endif
	return J5O
endfunction
function KKO takes player p returns string
	local integer KLO = LQ[GetPlayerId(p)]
	local string KGX
	local integer C8X
	local integer C9X
	set C8X =(KLO / 60)-(1 / 2)
	set C9X = ModuloInteger(KLO, 60)
	if(C9X <$A) then
		set KGX = I2S(C8X)+ ":0" + I2S(C9X)
	else
		set KGX = I2S(C8X)+ ":" + I2S(C9X)
	endif
	if p == LocalPlayer then
		set KGX = "|c00FF6600" + KGX + "|r"
	endif
	return KGX
endfunction
function KMO takes player WUE, player targetUnit returns string
	local string KHO
	local string KJO
	local string J5O
	local integer k = LoadInteger(HY, 400 + GetPlayerId(WUE), 450 + GetPlayerId(targetUnit))
	local integer d = LoadInteger(HY, 400 + GetPlayerId(WUE), 500 + GetPlayerId(targetUnit))
	if k < 1 then
		set k = 0
	endif
	if d < 1 then
		set d = 0
	endif
	set KHO = I2S(k)
	set KJO = I2S(d)
	set J5O = KHO + "/" + KJO
	if WUE == LocalPlayer then
		set J5O = "|c00FF6600" + KHO + "|r/" + "|c00FF6600" + KJO + "|r"
	endif
	return J5O
endfunction
function KPO takes multiboarditem VUX, boolean KQO, boolean KSO, string KTO, string KUO, real KWO returns nothing
	call MultiboardSetItemStyle(VUX, KQO, KSO)
	if KUO != null then
		call MultiboardSetItemIcon(VUX, KUO)
	endif
	if KTO != null then
		call MultiboardSetItemValue(VUX, KTO)
	endif
	if KWO > 0 then
		call MultiboardSetItemWidth(VUX, KWO)
	endif
endfunction
function KYO takes nothing returns nothing
	local integer KZO = D4V
	local integer K_O = D5V
	local player array K0O
	local player array K1O
	local integer K2O
	local integer K3O
	local integer K4O = 21 + IMaxBJ(KZO, K_O)+ 1
	local integer K5O = 1 +(KZO + K_O)* 2
	local multiboarditem VUX
	local integer i
	local integer x
	local string e = "|r"
	local string c0 = "|cff99ccff"
	local integer K6O
	local integer K7O
	call DisableTrigger(QG)
	call DestroyMultiboard(BT)
	if KZO > 0 and K_O > 0 then
		set K4O = K4O + 2
	endif
	set D6V = CreateMultiboard()
	set BJ_Multiboard = D6V
	call MultiboardSetItemsWidth(D6V, 0)
	call MultiboardSetRowCount(D6V, K4O)
	call MultiboardSetColumnCount(D6V, K5O)
	call MultiboardSetTitleText(D6V, GetObjectName('n0E3')+ " " + " - " +(C3))
	call MultiboardMinimize(D6V, true)
	call MultiboardSetItemsStyle(D6V, false, false)
	call MultiboardDisplay(D6V, true)
	call MultiboardMinimize(D6V, false)
	call MultiboardSetTitleText(D6V, GetObjectName('n0E3')+ " " + " - " +(C3)+ " - " +("|c00ff0303" + I2S(RQ[GetPlayerId(Sentinels[0])])+ "|r/|c0020c000" + I2S(IQ[GetPlayerId(Sentinels[0])])+ "|r"))
	set x = 1
	set i = 1
	loop
	exitwhen i > 5
		if IsPlaying(Sentinels[i]) or GetPlayerSlotState(Sentinels[i])== PLAYER_SLOT_STATE_LEFT then
			set K0O[x]= Sentinels[i]
			set x = x + 1
		endif
		set i = i + 1
	endloop
	set x = 1
	set i = 1
	loop
	exitwhen i > 5
		if IsPlaying(Scourges[i]) or GetPlayerSlotState(Scourges[i])== PLAYER_SLOT_STATE_LEFT then
			set K1O[x]= Scourges[i]
			set x = x + 1
		endif
		set i = i + 1
	endloop
	set i = 0
	set K3O = 0
	loop
	exitwhen i > K4O
		set VUX = MultiboardGetItem(D6V, i, K3O)
		call MultiboardSetItemWidth(VUX, .075)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K2O = 0
	set K3O = 0
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, " ")
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, false, false)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, J2O(K0O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, J2O(K1O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, false, false)
	call MultiboardReleaseItem(VUX)
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, true, J9O(K0O[i]), ELX(Player__Hero[GetPlayerId(K0O[i])]), .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, true, J9O(K1O[i]), ELX(Player__Hero[GetPlayerId(K1O[i])]), .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0EB')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, false, true, null, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 0)), .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, false, true, null, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 1)), .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, false, true, null, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K1O[i])], 0)), .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, false, true, null, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K1O[i])], 1)), .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + " " + e)
	call MultiboardReleaseItem(VUX)
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, false, true, null, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 2)), .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, false, true, null, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 3)), .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, false, true, null, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K1O[i])], 2)), .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, false, true, null, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K1O[i])], 3)), .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + " " + e)
	call MultiboardReleaseItem(VUX)
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, false, true, null, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 4)), .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, false, true, null, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 5)), .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, false, true, null, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K1O[i])], 4)), .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, false, true, null, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 5)), .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0E2')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, J7O(K0O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, J7O(K1O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0E1')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KRO(K0O[i])+ "/" + KIO(K0O[i])+ "/" + KOO(K0O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KRO(K1O[i])+ "/" + KIO(K1O[i])+ "/" + KOO(K1O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0DZ')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KAO(K0O[i])+ "/" + KNO(K0O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KAO(K1O[i])+ "/" + KNO(K1O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0JU')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, J3O(K0O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, J3O(K1O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0KF')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, J6O(K0O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, J6O(K1O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0E0')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KVO(K0O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KVO(K1O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0DT')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KGO(K0O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KGO(K1O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0DY')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KBO(K0O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KBO(K1O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0DU')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KEO(K0O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KEO(K1O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0DV')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KKO(K0O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KKO(K1O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0DW')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KXO(K0O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KXO(K1O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0DN')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, J8O(K0O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, J8O(K1O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0D8')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KCO(K0O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KCO(K1O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0DI')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KDO(K0O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KDO(K1O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0DM')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KFO(K0O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, KFO(K1O[i]), null, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	if KZO > 0 and K_O > 0 then
		set K3O = 0
		set K6O = K2O
		set K7O = K3O
		set K2O = K2O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0DL')+ e)
		call MultiboardReleaseItem(VUX)
		set K2O = K6O
		set x = 1
		loop
		exitwhen x > KZO
			set K3O = 0
			set K2O = K6O
			set i = 1
			loop
			exitwhen i > K_O
				set K3O = x +(x -1)
				set K2O = K2O + 1
				set VUX = MultiboardGetItem(D6V, K2O, K3O)
				call KPO(VUX, false, true, null, ELX(Player__Hero[GetPlayerId(K0O[x])]), .01)
				call MultiboardReleaseItem(VUX)
				set K3O = K3O + 1
				set VUX = MultiboardGetItem(D6V, K2O, K3O)
				call KPO(VUX, true, true, " " + KMO(K0O[x], K1O[i]), ELX(Player__Hero[GetPlayerId(K1O[i])]), .059)
				call MultiboardReleaseItem(VUX)
				set i = i + 1
			endloop
			set x = x + 1
		endloop
		set x = KZO + 1
		loop
		exitwhen x >(K_O + KZO)
			set K3O = 0
			set K2O = K6O
			set i = 1
			loop
			exitwhen i > KZO
				set K3O = x +(x -1)
				set K2O = K2O + 1
				set VUX = MultiboardGetItem(D6V, K2O, K3O)
				call KPO(VUX, false, true, null, ELX(Player__Hero[GetPlayerId(K1O[x -KZO])]), .01)
				call MultiboardReleaseItem(VUX)
				set K3O = K3O + 1
				set VUX = MultiboardGetItem(D6V, K2O, K3O)
				call KPO(VUX, true, true, " " + KMO(K1O[x -KZO], K0O[i]), ELX(Player__Hero[GetPlayerId(K0O[i])]), .059)
				call MultiboardReleaseItem(VUX)
				set i = i + 1
			endloop
			set x = x + 1
		endloop
	endif
	set K2O = K2O + 1
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0CZ')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > KZO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, BY[GetPlayerId(K0O[i])], null, .07)
		call MultiboardReleaseItem(VUX)
		set FVV = FVV + 1
		set D7V[FVV]= K2O
		set D8V[FVV]= K3O
		set D9V[FVV]= K0O[i]
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > K_O
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(D6V, K2O, K3O)
		call KPO(VUX, true, false, BY[GetPlayerId(K1O[i])], null, .07)
		call MultiboardReleaseItem(VUX)
		set FVV = FVV + 1
		set D7V[FVV]= K2O
		set D8V[FVV]= K3O
		set D9V[FVV]= K1O[i]
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(D6V, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0D9')+ e)
	call MultiboardReleaseItem(VUX)
	set VUX = MultiboardGetItem(D6V, K2O, K3O + 1)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX,(K3))
	call MultiboardSetItemWidth(VUX, .07)
	call MultiboardReleaseItem(VUX)
	call MultiboardMinimize(D6V, true)
	call MultiboardMinimize(D6V, false)
	set VUX = null
endfunction
function K8O takes player p returns string
	return JS[GetPlayerId(p)]+(VMV[GetPlayerId((p))])+ "|r"
endfunction
function K9O takes player p returns string
	local integer k = QQ[GetPlayerId(p)]
	local integer d = MQ[GetPlayerId(p)]
	if k < 1 then
		set k = 0
	endif
	if d < 1 then
		set d = 0
	endif
	return I2S(k)+ "/" + I2S(d)
endfunction
function LVO takes player p returns string
	local integer KLO = LQ[GetPlayerId(p)]
	local string KGX
	local integer C8X
	local integer C9X
	set C8X =(KLO / 60)-(1 / 2)
	set C9X = ModuloInteger(KLO, 60)
	if(C9X <$A) then
		set KGX = I2S(C8X)+ ":0" + I2S(C9X)
	else
		set KGX = I2S(C8X)+ ":" + I2S(C9X)
	endif
	return KGX
endfunction
function LEO takes player WUE, player targetUnit returns string
	local integer k =(LoadInteger(HY,(400 + GetPlayerId(WUE)),(450 + GetPlayerId(targetUnit))))
	local integer d =(LoadInteger(HY,(400 + GetPlayerId(WUE)),(500 + GetPlayerId(targetUnit))))
	if k < 1 then
		set k = 0
	endif
	if d < 1 then
		set d = 0
	endif
	return I2S(k)+ "/" + I2S(d)
endfunction
function LXO takes player WUE returns string
	local string LOO
	if UnitIsDead(Player__Hero[GetPlayerId(WUE)]) then
		set LOO = I2S(R2I(TimerGetRemaining(PS[GetPlayerId(WUE)])))
	else
		set LOO = " "
	endif
	return LOO
endfunction
function LRO takes player WUE returns string
	local real r =(TimerGetRemaining(ESV[GetPlayerId((WUE))]))
	local string LOO
	if r > 0 then
		set LOO = I2S(R2I(r))
	else
		set LOO = " "
	endif
	return LOO
endfunction
function ob_tab0 takes nothing returns nothing
	call MultiboardMinimize(FEV, true)
endfunction
function ob_tab1 takes nothing returns nothing
	call MultiboardMinimize(FEV, false)
endfunction
function LIO takes integer LAO, integer LNO returns nothing		//Ob的Tab切换多面板
	set FEV = CreateMultiboard()
	call MultiboardSetItemsWidth(FEV, 0)
	call MultiboardSetRowCount(FEV, LAO)
	call MultiboardSetColumnCount(FEV, LNO)
	call MultiboardSetTitleText(FEV, GetObjectName('n0E3')+ " " + " - " +(C3))
	call MultiboardMinimize(FEV, true)
	call MultiboardSetItemsStyle(FEV, false, false)
	if(LocalPlayer== VKV or LocalPlayer== VLV) then
		call MultiboardDisplay(FEV, true)
		call DzTriggerRegisterKeyEventByCode(null, 9, 0, false, function ob_tab0)
		call DzTriggerRegisterKeyEventByCode(null, 9, 1, false, function ob_tab1)
	endif
endfunction
function LBO takes nothing returns nothing
	local integer LCO = IM1
	local integer LDO = N1
	local player array K0O
	local player array K1O
	local integer K2O
	local integer K3O
	local integer K4O = 1 + 21 + IMaxBJ(LCO, LDO)
	local integer K5O = 1 +(LCO + LDO)* 2
	local multiboarditem VUX
	local integer i
	local integer x
	local string e = "|r"
	local string c0 = "|cff99ccff"
	local integer K6O
	local integer K7O
	local integer LFO =$83
	local integer LGO =$8B
	local integer LHO =$8B
	local integer LJO = 255
	local integer JWO = 0
	local string JYO = ""
	local string JZO = ""
	local integer J_O = 0
	local integer J0O = 0
	local integer r
	if LCO > 0 and LDO > 0 then
		set K4O = K4O + 2
	endif
	if GetTriggerExecCount(GetTriggeringTrigger())== 1 then
		call LIO(K4O, K5O)
	endif
	if MW and(LocalPlayer== VKV or LocalPlayer== VLV) then
		call MultiboardDisplay(FEV, true)
	endif
	set i = 1
	loop
	exitwhen i > 5
		set r = R2I(TimerGetRemaining(PS[GetPlayerId(Sentinels[i])]))
		if r > 0 then
			set JWO = JWO + JDO(r)
			if J_O == 0 then
				if r <$A then
					set JYO = JS[GetPlayerId(Sentinels[i])]+ "0" + I2S(r)+ " |r"
				else
					set JYO = JS[GetPlayerId(Sentinels[i])]+ I2S(r)+ " |r"
				endif
			else
				if r <$A then
					set JYO = JYO + "|c00ffffff" + "| |r" + JS[GetPlayerId(Sentinels[i])]+ "0" + I2S(r)+ " |r"
				else
					set JYO = JYO + "|c00ffffff" + "| |r" + JS[GetPlayerId(Sentinels[i])]+ I2S(r)+ " |r"
				endif
			endif
			set J_O = J_O + 1
		endif
		set i = i + 1
	endloop
	if J_O > 0 then
		set JYO = "|c00ffffff" + "[AW: |r" + JYO + "|c00ffffff" + "]|r"
	endif
	set i = 1
	loop
	exitwhen i > 5
		set r = R2I(TimerGetRemaining(PS[GetPlayerId(Scourges[i])]))
		if r > 0 then
			set JWO = JWO + JDO(r)
			if J0O == 0 then
				if r <$A then
					set JZO = JS[GetPlayerId(Scourges[i])]+ "0" + I2S(r)+ " |r"
				else
					set JZO = JS[GetPlayerId(Scourges[i])]+ I2S(r)+ " |r"
				endif
			else
				if r <$A then
					set JZO = JZO + "|c00ffffff" + "| |r" + JS[GetPlayerId(Scourges[i])]+ "0" + I2S(r)+ " |r"
				else
					set JZO = JZO + "|c00ffffff" + "| |r" + JS[GetPlayerId(Scourges[i])]+ I2S(r)+ " |r"
				endif
			endif
			set J0O = J0O + 1
		endif
		set i = i + 1
	endloop
	if J0O > 0 then
		set JZO = "|c00ffffff" + "[天灾: |r" + JZO + "|c00ffffff" + "]|r"
	endif
	call MultiboardSetTitleText(FEV, JYO + " " + JZO + " " + GetObjectName('n0E3')+ "  - " + C3 + " - " +("|c00ff0303" + I2S(RQ[GetPlayerId(Sentinels[0])])+ "|r/|c0020c000" + I2S(IQ[GetPlayerId(Sentinels[0])])+ "|r"))
	set x = 1
	set i = 1
	loop
	exitwhen i > 5
		if IsPlaying(Sentinels[i]) or GetPlayerSlotState(Sentinels[i])== PLAYER_SLOT_STATE_LEFT then
			set K0O[x]= Sentinels[i]
			set x = x + 1
		endif
		set i = i + 1
	endloop
	set x = 1
	set i = 1
	loop
	exitwhen i > 5
		if IsPlaying(Scourges[i]) or GetPlayerSlotState(Scourges[i])== PLAYER_SLOT_STATE_LEFT then
			set K1O[x]= Scourges[i]
			set x = x + 1
		endif
		set i = i + 1
	endloop
	set i = 0
	set K3O = 0
	loop
	exitwhen i > K4O
		set VUX = MultiboardGetItem(FEV, i, K3O)
		call MultiboardSetItemWidth(VUX, .075)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K2O = 0
	set K3O = 0
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, " ")
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, false, false)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, K8O(K0O[i]))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, K8O(K1O[i]))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, false, false)
	call MultiboardReleaseItem(VUX)
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, true)
		call MultiboardSetItemValue(VUX, "(" +(I2S(GetUnitLevel(Player__Hero[GetPlayerId((K0O[i]))])))+ ")")
		call MultiboardSetItemIcon(VUX,(ELX(Player__Hero[GetPlayerId((K0O[i]))])))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, true)
		call MultiboardSetItemValue(VUX, "(" + I2S(GetUnitLevel(Player__Hero[GetPlayerId(K1O[i])]))+ ")")
		call MultiboardSetItemIcon(VUX,(ELX(Player__Hero[GetPlayerId(K1O[i])])))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0EB')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 1 -1)))
		call MultiboardSetItemWidth(VUX, .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 2 -1)))
		call MultiboardSetItemWidth(VUX, .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K1O[i])], 1 -1)))
		call MultiboardSetItemWidth(VUX, .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K1O[i])], 2 -1)))
		call MultiboardSetItemWidth(VUX, .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + " " + e)
	call MultiboardReleaseItem(VUX)
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 3 -1)))
		call MultiboardSetItemWidth(VUX, .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 4 -1)))
		call MultiboardSetItemWidth(VUX, .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K1O[i])], 3 -1)))
		call MultiboardSetItemWidth(VUX, .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K1O[i])], 4 -1)))
		call MultiboardSetItemWidth(VUX, .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + " " + e)
	call MultiboardReleaseItem(VUX)
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 5 -1)))
		call MultiboardSetItemWidth(VUX, .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K0O[i])], 6 -1)))
		call MultiboardSetItemWidth(VUX, .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K1O[i])], 5 -1)))
		call MultiboardSetItemWidth(VUX, .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, H5X(UnitItemInSlot(Player__Hero[GetPlayerId(K1O[i])], 6 -1)))
		call MultiboardSetItemWidth(VUX, .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0E2')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, I2S(GetPlayerState(K0O[i], PLAYER_STATE_RESOURCE_GOLD)))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX,(I2S(GetPlayerState(K1O[i], PLAYER_STATE_RESOURCE_GOLD))))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0LT')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(VUX, LFO, LGO, LHO, LJO)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX,(I2S(Y4[KFX(GetHeroLevel(Player__Hero[GetPlayerId((K0O[i]))]))])))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(VUX, LFO, LGO, LHO, LJO)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX,(I2S(Y4[KFX(GetHeroLevel(Player__Hero[GetPlayerId(K1O[i])]))])))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0DZ')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX,(I2S(AQ[GetPlayerId((K0O[i]))]))+ "/" +(I2S(NQ[GetPlayerId((K0O[i]))]))+ "/" +(I2S((LoadInteger(HY,(400 + GetPlayerId((K0O[i]))), 79)))))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX,(I2S(AQ[GetPlayerId(K1O[i])]))+ "/" +(I2S(NQ[GetPlayerId(K1O[i])]))+ "/" +(I2S((LoadInteger(HY,(400 + GetPlayerId(K1O[i])), 79)))))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0E1')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(VUX, LFO, LGO, LHO, LJO)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX,(I2S(RQ[GetPlayerId((K0O[i]))]))+ "/" +(I2S(IQ[GetPlayerId((K0O[i]))]))+ "/" +(I2S(CQ[GetPlayerId((K0O[i]))])))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(VUX, LFO, LGO, LHO, LJO)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX,(I2S(RQ[GetPlayerId(K1O[i])]))+ "/" +(I2S(IQ[GetPlayerId(K1O[i])]))+ "/" +(I2S(CQ[GetPlayerId(K1O[i])])))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0E0')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX,(I2S(FQ[GetPlayerId((K0O[i]))])))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX,(I2S(FQ[GetPlayerId(K1O[i])])))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0DT')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(VUX, LFO, LGO, LHO, LJO)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, K9O(K0O[i]))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(VUX, LFO, LGO, LHO, LJO)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, K9O(K1O[i]))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0DU')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX,(I2S(PQ[GetPlayerId((K0O[i]))])))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX,(I2S(PQ[GetPlayerId(K1O[i])])))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + "技能" + e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K0O[i])* HL + 1]])
		call MultiboardSetItemWidth(VUX, .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, I2S(ZTE(Player__Hero[GetPlayerId((K0O[i]))], 1)))
		call MultiboardSetItemWidth(VUX, .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K1O[i])* HL + 1]])
		call MultiboardSetItemWidth(VUX, .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, I2S(ZTE(Player__Hero[GetPlayerId(K1O[i])], 1)))
		call MultiboardSetItemWidth(VUX, .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + " " + e)
	call MultiboardReleaseItem(VUX)
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K0O[i])* HL + 2]])
		call MultiboardSetItemWidth(VUX, .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, I2S(ZTE(Player__Hero[GetPlayerId((K0O[i]))], 2)))
		call MultiboardSetItemWidth(VUX, .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K1O[i])* HL + 2]])
		call MultiboardSetItemWidth(VUX, .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, I2S(ZTE(Player__Hero[GetPlayerId(K1O[i])], 2)))
		call MultiboardSetItemWidth(VUX, .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + " " + e)
	call MultiboardReleaseItem(VUX)
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K0O[i])* HL + 3]])
		call MultiboardSetItemWidth(VUX, .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, I2S(ZTE(Player__Hero[GetPlayerId((K0O[i]))], 3)))
		call MultiboardSetItemWidth(VUX, .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K1O[i])* HL + 3]])
		call MultiboardSetItemWidth(VUX, .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, I2S(ZTE(Player__Hero[GetPlayerId(K1O[i])], 3)))
		call MultiboardSetItemWidth(VUX, .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K2O = K2O + 1
	set K3O = 0
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + " " + e)
	call MultiboardReleaseItem(VUX)
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K0O[i])* HL + 4]])
		call MultiboardSetItemWidth(VUX, .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, I2S(ZTE(Player__Hero[GetPlayerId((K0O[i]))], 4)))
		call MultiboardSetItemWidth(VUX, .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, false, true)
		call MultiboardSetItemIcon(VUX, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K1O[i])* HL + 4]])
		call MultiboardSetItemWidth(VUX, .015)
		call MultiboardReleaseItem(VUX)
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, I2S(ZTE(Player__Hero[GetPlayerId(K1O[i])], 4)))
		call MultiboardSetItemWidth(VUX, .054)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	if ExtraAbilitiesNum  >= 1 then
		set K2O = K2O + 1
		set K3O = 0
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, c0 + " " + e)
		call MultiboardReleaseItem(VUX)
		set i = 1
		loop
		exitwhen i > LCO
			set K3O = K3O + 1
			set VUX = MultiboardGetItem(FEV, K2O, K3O)
			call MultiboardSetItemStyle(VUX, false, true)
			call MultiboardSetItemIcon(VUX, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K0O[i])* HL + 5]])
			call MultiboardSetItemWidth(VUX, .015)
			call MultiboardReleaseItem(VUX)
			set K3O = K3O + 1
			set VUX = MultiboardGetItem(FEV, K2O, K3O)
			call MultiboardSetItemStyle(VUX, true, false)
			call MultiboardSetItemValue(VUX, I2S(ZTE(Player__Hero[GetPlayerId((K0O[i]))], 5)))
			call MultiboardSetItemWidth(VUX, .054)
			call MultiboardReleaseItem(VUX)
			set i = i + 1
		endloop
		set i = 1
		loop
		exitwhen i > LDO
			set K3O = K3O + 1
			set VUX = MultiboardGetItem(FEV, K2O, K3O)
			call MultiboardSetItemStyle(VUX, false, true)
			call MultiboardSetItemIcon(VUX, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K1O[i])* HL + 5]])
			call MultiboardSetItemWidth(VUX, .015)
			call MultiboardReleaseItem(VUX)
			set K3O = K3O + 1
			set VUX = MultiboardGetItem(FEV, K2O, K3O)
			call MultiboardSetItemStyle(VUX, true, false)
			call MultiboardSetItemValue(VUX, I2S(ZTE(Player__Hero[GetPlayerId(K1O[i])], 5)))
			call MultiboardSetItemWidth(VUX, .054)
			call MultiboardReleaseItem(VUX)
			set i = i + 1
		endloop
	endif
	if ExtraAbilitiesNum  >= 2 then
		set K2O = K2O + 1
		set K3O = 0
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, c0 + " " + e)
		call MultiboardReleaseItem(VUX)
		set i = 1
		loop
		exitwhen i > LCO
			set K3O = K3O + 1
			set VUX = MultiboardGetItem(FEV, K2O, K3O)
			call MultiboardSetItemStyle(VUX, false, true)
			call MultiboardSetItemIcon(VUX, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K0O[i])* HL + 6]])
			call MultiboardSetItemWidth(VUX, .015)
			call MultiboardReleaseItem(VUX)
			set K3O = K3O + 1
			set VUX = MultiboardGetItem(FEV, K2O, K3O)
			call MultiboardSetItemStyle(VUX, true, false)
			call MultiboardSetItemValue(VUX, I2S(ZTE(Player__Hero[GetPlayerId((K0O[i]))], 6)))
			call MultiboardSetItemWidth(VUX, .054)
			call MultiboardReleaseItem(VUX)
			set i = i + 1
		endloop
		set i = 1
		loop
		exitwhen i > LDO
			set K3O = K3O + 1
			set VUX = MultiboardGetItem(FEV, K2O, K3O)
			call MultiboardSetItemStyle(VUX, false, true)
			call MultiboardSetItemIcon(VUX, HeroSkillsIcon[PlayerSkillIndex[GetPlayerId(K1O[i])* HL + 6]])
			call MultiboardSetItemWidth(VUX, .015)
			call MultiboardReleaseItem(VUX)
			set K3O = K3O + 1
			set VUX = MultiboardGetItem(FEV, K2O, K3O)
			call MultiboardSetItemStyle(VUX, true, false)
			call MultiboardSetItemValue(VUX, I2S(ZTE(Player__Hero[GetPlayerId(K1O[i])], 6)))
			call MultiboardSetItemWidth(VUX, .054)
			call MultiboardReleaseItem(VUX)
			set i = i + 1
		endloop
	endif
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0DV')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, LVO(K0O[i]))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, LVO(K1O[i]))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0DW')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(VUX, LFO, LGO, LHO, LJO)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX,(I2S(GQ[GetPlayerId((K0O[i]))])))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(VUX, LFO, LGO, LHO, LJO)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX,(I2S(GQ[GetPlayerId(K1O[i])])))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0DN')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX,(I2S(DQ[GetPlayerId((K0O[i]))])))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX,(I2S(DQ[GetPlayerId(K1O[i])])))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	if LCO > 0 and LDO > 0 then
		set K3O = 0
		set K6O = K2O
		set K7O = K3O
		set K2O = K2O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemStyle(VUX, true, false)
		call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0DL')+ e)
		call MultiboardReleaseItem(VUX)
		set K2O = K6O
		set x = 1
		loop
		exitwhen x > LCO
			set K3O = 0
			set K2O = K6O
			set i = 1
			loop
			exitwhen i > LDO
				set K3O = x +(x -1)
				set K2O = K2O + 1
				set VUX = MultiboardGetItem(FEV, K2O, K3O)
				call MultiboardSetItemStyle(VUX, false, true)
				call MultiboardSetItemIcon(VUX,(ELX(Player__Hero[GetPlayerId((K0O[x]))])))
				call MultiboardSetItemWidth(VUX, .01)
				call MultiboardReleaseItem(VUX)
				set K3O = K3O + 1
				set VUX = MultiboardGetItem(FEV, K2O, K3O)
				call MultiboardSetItemStyle(VUX, true, true)
				call MultiboardSetItemIcon(VUX,(ELX(Player__Hero[GetPlayerId(K1O[i])])))
				call MultiboardSetItemValue(VUX, " " + LEO(K0O[x], K1O[i]))
				call MultiboardSetItemWidth(VUX, .059)
				call MultiboardReleaseItem(VUX)
				set i = i + 1
			endloop
			set x = x + 1
		endloop
		set x = LCO + 1
		loop
		exitwhen x >(LDO + LCO)
			set K3O = 0
			set K2O = K6O
			set i = 1
			loop
			exitwhen i > LCO
				set K3O = x +(x -1)
				set K2O = K2O + 1
				set VUX = MultiboardGetItem(FEV, K2O, K3O)
				call MultiboardSetItemStyle(VUX, false, true)
				call MultiboardSetItemIcon(VUX,(ELX(Player__Hero[GetPlayerId((K1O[x -LCO]))])))
				call MultiboardSetItemWidth(VUX, .01)
				call MultiboardReleaseItem(VUX)
				set K3O = K3O + 1
				set VUX = MultiboardGetItem(FEV, K2O, K3O)
				call MultiboardSetItemStyle(VUX, true, true)
				call MultiboardSetItemIcon(VUX,(ELX(Player__Hero[GetPlayerId((K0O[i]))])))
				call MultiboardSetItemValue(VUX, " " + LEO(K1O[x -LCO], K0O[i]))
				call MultiboardSetItemWidth(VUX, .059)
				call MultiboardReleaseItem(VUX)
				set i = i + 1
			endloop
			set x = x + 1
		endloop
	endif
	set K2O = K2O + 1
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0HS')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(VUX, LFO, LGO, LHO, LJO)
		if LXO(K0O[i])== " "then
			call MultiboardSetItemStyle(VUX, true, false)
		else
			call MultiboardSetItemStyle(VUX, true, false)
			call MultiboardSetItemIcon(VUX,(ELX(Player__Hero[GetPlayerId((K0O[i]))])))
		endif
		call MultiboardSetItemValue(VUX, LRO(K0O[i]))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		call MultiboardSetItemValueColor(VUX, LFO, LGO, LHO, LJO)
		if LXO(K1O[i])== " "then
			call MultiboardSetItemStyle(VUX, true, false)
		else
			call MultiboardSetItemStyle(VUX, true, false)
			call MultiboardSetItemIcon(VUX,(ELX(Player__Hero[GetPlayerId(K1O[i])])))
		endif
		call MultiboardSetItemValue(VUX, LRO(K1O[i]))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set K3O = 0
	set K2O = K2O + 1
	set VUX = MultiboardGetItem(FEV, K2O, K3O)
	call MultiboardSetItemStyle(VUX, true, false)
	call MultiboardSetItemValue(VUX, c0 + GetObjectName('n0E4')+ e)
	call MultiboardReleaseItem(VUX)
	set K3O = 0
	set i = 1
	loop
	exitwhen i > LCO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		if LXO(K0O[i])== " "then
			call MultiboardSetItemStyle(VUX, true, false)
		else
			call MultiboardSetItemStyle(VUX, true, true)
			call MultiboardSetItemIcon(VUX,(ELX(Player__Hero[GetPlayerId((K0O[i]))])))
		endif
		call MultiboardSetItemValue(VUX, LXO(K0O[i]))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > LDO
		set K3O = K3O + 1
		set VUX = MultiboardGetItem(FEV, K2O, K3O)
		if LXO(K1O[i])== " "then
			call MultiboardSetItemStyle(VUX, true, false)
		else
			call MultiboardSetItemStyle(VUX, true, true)
			call MultiboardSetItemIcon(VUX,(ELX(Player__Hero[GetPlayerId(K1O[i])])))
		endif
		call MultiboardSetItemValue(VUX, LXO(K1O[i]))
		call MultiboardSetItemWidth(VUX, .07)
		call MultiboardReleaseItem(VUX)
		set i = i + 1
	endloop
	set VUX = null
endfunction
function LKO takes nothing returns nothing
	local trigger t
	if MW then
		set t = CreateTrigger()
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddAction(t, function LBO)
		set FXV = t
	endif
	set t = null
endfunction
function LLO takes unit u returns boolean
	local integer i = GetUnitTypeId(u)
	return i =='hC95' or i =='n12B' or i =='n01K' or i =='nC38' or i =='n00V' or i =='n00W' or i =='n002' or i =='n00X' or i =='n009' or i =='n0HE' or i =='nC35' or i =='u00Q' or i =='uC74' or i =='u010' or i =='u00Z'or i =='n999'
endfunction
function LMO takes string p, real WIE, string WLE returns nothing
	local integer i = LoadInteger(Q,-1, 0)
	local integer LPO = R2I(WIE / 60 -1 / 2)
	local integer LQO = R2I(WIE -LPO * 60)
	call SaveStr(Q,-1, i, p + " selected " + WLE + " at " + I2S(LPO)+ ":" + I2S(LQO))
	call SaveInteger(Q,-1, 0, i + 1)
endfunction
function LSO takes unit u returns nothing
	if GetUnitTypeId(u)!='hfoo' and UnitVisibleToPlayer(u, GetTriggerPlayer())== false then
		call LMO(VMV[GetPlayerId(GetTriggerPlayer())], GetGameTime(), GetUnitName(u))
	endif
endfunction
function LTO takes nothing returns boolean
	local unit u = GetTriggerUnit()
	local integer id = GetUnitTypeId(u)
	local boolean b = GetOwningPlayer(u)== NeutralPassivePlayer and LLO(u) and LocalPlayer== GetTriggerPlayer()
	local string s = ""
	if GetTriggerEventId()== EVENT_PLAYER_UNIT_DESELECTED then
		if b then
			call ResetUnitAnimation(u)
		endif
	else
		if Mode__AntiHack then
			call LSO(u)
		endif
		if b then
			if id =='hC95' or id =='n12B' or id =='n00X' or id =='n009' or id =='nC35' or id =='u00Q' or id =='u010' or id =='u00Z' then
				set s = "stand work"
			elseif id =='n01K' then
				set s = "stand third"
			elseif id =='nC38' then
				call SetUnitAnimationByIndex(u, 3)
			elseif id =='n00V' then
				set s = "spell attack"
			elseif id =='n00W' then
				set s = "spell"
			elseif id =='n002' then
				call SetUnitAnimationByIndex(u, 3)
			elseif id =='n0HE' then
				set s = "stand victory"
			elseif id =='uC74' then
				set s = "stand work gold"
			elseif id =='n999' then
				set s = "spell attack"
			endif
			if s != ""then
				call SetUnitAnimation(u, s)
				call QueueUnitAnimation(u, s)
			endif
		endif
	endif
	set u = null
	return false
endfunction
function LUO takes unit u, unit IZX, real ZCE returns nothing
	local real FTX = .25
	if Mode__AntiBackdoor then
		set FTX = 1
	endif
	call SetWidgetLife(u, GetWidgetLife(u)+ FTX * ZCE)
endfunction
function LWO takes unit u returns boolean
	return(GetOwningPlayer(u)== Sentinels[0]or GetOwningPlayer(u)== Scourges[0]) and GetUnitTypeId(u)!='hFFD'
endfunction
function LYO takes nothing returns boolean
	return(GetOwningPlayer(GetFilterUnit())== Sentinels[0]or GetOwningPlayer(GetFilterUnit())== Scourges[0]) and GetUnitTypeId(GetFilterUnit())!='hFFD'
endfunction
// 防偷塔
function LZO takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer hu = GetHandleId(u)

	call FlushChildHashtable(P, hu)
	call GroupRemoveUnit(UR, u)

	set u = null
endfunction
function L_O takes unit u returns nothing
	local integer hu
	local rect r
	local group g
	local unit u2 = null
	local boolean b = false
	local player p = Sentinels[0]
	local integer i = 0
	if UnitIsDead(u) then
		return
	endif
	set hu = GetHandleId(u)
	set g = LoginGroup(45)
	if GetOwningPlayer(u)== Sentinels[0]then
		set p = Scourges[0]
	endif
	loop
		set r = LoadRectHandle(P, hu,'ABDr'+ i)
		call GroupEnumUnitsInRect(g, r, Condition(function LYO))
		loop
			set u2 = FirstOfGroup(g)
		exitwhen b or u2 == null
			if GetOwningPlayer(u2)== p then
				set b = true
			else
				call GroupRemoveUnit(g, u2)
			endif
		endloop
		set i = i + 1
	exitwhen b or HaveSavedHandle(P, hu,'ABDr'+ i)== false
	endloop
	call SaveBoolean(P, hu,'isBD', b == false)
	call LogoutGroup(g)
	set u2 = null
	set g = null
	set r = null
endfunction
function L0O takes nothing returns nothing
	local unit u
	local group g = LoginGroup(46)
	call GroupAddGroup(UR, g)
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call L_O(u)
		call GroupRemoveUnit(g, u)
	endloop
	call LogoutGroup(g)
	set g = null
	set u = null
endfunction
function L1O takes nothing returns nothing
	local unit u = GetEnumUnit()
	local integer hu = GetHandleId(u)
	local real L2O
	local real L3O
	if hu == 0 or UnitIsDead(u) or GetUnitState(u, UNIT_STATE_MAX_LIFE)== GetWidgetLife(u) then
		return
	endif
	set L2O = GetWidgetLife(u)
	set L3O = GetUnitState(u, UNIT_STATE_MAX_LIFE)-LoadReal(P, hu,'DMGR')
	if L2O <= L3O then
		if L2O + FOV <= L3O then
			call SetWidgetLife(u, L2O + FOV)
		else
			call SetWidgetLife(u, L3O)
		endif
	endif
	set u = null
endfunction
function L4O takes nothing returns nothing
	call ForGroup(UR, function L1O)
endfunction
function L5O takes nothing returns nothing
	if HaveSavedReal(K, GetHandleId(LocalPlayer),'CAMD') and GetCameraField(CAMERA_FIELD_TARGET_DISTANCE)!= LoadReal(K, GetHandleId(LocalPlayer),'CAMD') and LoadReal(K, GetHandleId(LocalPlayer),'CAMD')!=$672 then
		call SetCameraFieldForPlayer(LocalPlayer, CAMERA_FIELD_TARGET_DISTANCE, LoadReal(K, GetHandleId(LocalPlayer),'CAMD'), 0)
		call SetCameraFieldForPlayer(LocalPlayer, CAMERA_FIELD_FARZ,$186A0, 0)
		call SetCameraFieldForPlayer(LocalPlayer, CAMERA_FIELD_ZOFFSET, 0, 0)
		call SetCameraFieldForPlayer(LocalPlayer, CAMERA_FIELD_ROTATION, 90, 0)
		call SetCameraFieldForPlayer(LocalPlayer, CAMERA_FIELD_ANGLE_OF_ATTACK, 304, 0)
		call SetCameraFieldForPlayer(LocalPlayer, CAMERA_FIELD_ROLL, 0, 0)
		call SetCameraFieldForPlayer(LocalPlayer, CAMERA_FIELD_FIELD_OF_VIEW, 70, 0)
	endif
endfunction
function L6O takes nothing returns boolean
	return STX(GetUnitTypeId(GetFilterUnit())) and GetUnitCurrentOrder(GetFilterUnit())== 0
endfunction
function L7O takes nothing returns nothing
	call IssuePointOrderByIdLoc(GetEnumUnit(), 851983, KW[GetUnitAbilityLevel(GetEnumUnit(),'A06G')])
endfunction
function L8O takes nothing returns nothing
	local group g = LoginGroup(47)
	call GroupEnumUnitsOfPlayer(g, Sentinels[0], Condition(function L6O))
	call ForGroup(g, function L7O)
	call GroupEnumUnitsOfPlayer(g, Scourges[0], Condition(function L6O))
	call ForGroup(g, function L7O)
	call LogoutGroup(g)
endfunction
function L9O takes unit u returns nothing
	local integer hu = GetHandleId(u)
	call GroupAddUnit(UR, u)
	if GetOwningPlayer(u)== Sentinels[0]then
		call SaveRectHandle(P, hu,'ABDr'+ 0, Rect(-8160.,-8192.,-3712.,-4352.))
		call SaveRectHandle(P, hu,'ABDr'+ 1, Rect(-8192.,-4960.,-4640.,-3552.))
		call SaveRectHandle(P, hu,'ABDr'+ 2, Rect(-4000.,-7744.,-3072.,-5152.))
		call SaveRectHandle(P, hu,'ABDr'+ 3, Rect(-3328.,-7200.,-2464.,-6368.))
		call SaveRectHandle(P, hu,'ABDr'+ 4, Rect(-4288.,-4544.,-3424.,-3712.))
		call SaveRectHandle(P, hu,'ABDr'+ 5, Rect(-6784.,-3616.,-5920.,-2784.))
	else
		call SaveRectHandle(P, hu,'ABDr'+ 0, Rect(2304., 4064., 8032., 7776.))
		call SaveRectHandle(P, hu,'ABDr'+ 1, Rect(4640., 1952., 8000., 4384.))
		call SaveRectHandle(P, hu,'ABDr'+ 2, Rect(3136., 2816., 5216., 4960.))
		call SaveRectHandle(P, hu,'ABDr'+ 3, Rect(5984., 1152., 6848., 1984.))
		call SaveRectHandle(P, hu,'ABDr'+ 4, Rect(1472., 5440., 2336., 6272.))
		call SaveRectHandle(P, hu,'ABDr'+ 5, Rect(2656., 2336., 3520., 3168.))
	endif
endfunction
function MVO takes nothing returns boolean
	call CleanCurrentTrigger(GetTriggeringTrigger())
	call TriggerEvaluate(NeutralCreaturesRefreshTrig)
	return false
endfunction
function MEO takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='ntav' then
		if Player__Hero[GetPlayerId(GetOwningPlayer(GetFilterUnit()))]!= null or IsPlaying(GetOwningPlayer(GetFilterUnit()))== false then
			call KillUnit(GetFilterUnit())
		else
			set Q2 = Q2 + 1
		endif
	endif
	return false
endfunction
function MXO takes nothing returns nothing
	local group g = LoginGroup(48)
	set Q2 = 0
	call GroupEnumUnitsOfPlayer(g, Sentinels[1], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, Sentinels[2], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, Sentinels[3], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, Sentinels[4], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, Sentinels[5], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, Scourges[1], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, Scourges[2], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, Scourges[3], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, Scourges[4], Condition(function MEO))
	call GroupEnumUnitsOfPlayer(g, Scourges[5], Condition(function MEO))
	if Q2 == 0 then
		call DestroyTimer(GetExpiredTimer())
		call A8X(Sentinels[0], 10,-7000, 6800, 1000)
		call A8X(Scourges[0], 10,-7000, 6800, 1000)
	endif
	call LogoutGroup(g)
	set g = null
endfunction
function MOO takes nothing returns nothing
	if GKV or Mode__MirrorDraft then
		call TimerStart(CreateTimer(), 5, true, function MXO)
	endif
endfunction
function MRO takes nothing returns boolean
	local real r = TimerGetRemaining(NK)
	local real Y2X = r
	local integer JJO = R2I(Y2X)
	local integer C8X = JJO / 60 -1 / 2
	local integer C9X = ModuloInteger(JJO, 60)
	local trigger t
	local integer i
	local integer TME
	if r == 0 then
		if InHeroSelection then
			set InHeroSelection = false
			call RemoveUnit(HR)
			call RemoveUnit(JR)
			call RemoveUnit(KR)
			call RemoveUnit(LR)
			call RemoveUnit(IR)
			call ExecuteFunc("MIO")
			return false
		endif
		set FRV = true
		call FlushGameCache(InitGameCache("start"))
		call UEV("i", "d", 3)
		call A8X(Sentinels[0], 2,-6990., 6840, 800)
		call A8X(Scourges[0], 2,-6990., 6840, 800)
		call MOO()
		set i = 1
		loop
			if IsPlaying(Player(i)) then
				set TME = GetPlayerId(Player(i))
				call JSX("SP1_" + I2S(i), HeroCommonSkills[PlayerSkillIndex[TME * HL + 1]])
				call JSX("SP2_" + I2S(i), HeroCommonSkills[PlayerSkillIndex[TME * HL + 2]])
				call JSX("SP3_" + I2S(i), HeroCommonSkills[PlayerSkillIndex[TME * HL + 3]])
				call JSX("SP4_" + I2S(i), HeroCommonSkills[PlayerSkillIndex[TME * HL + 4]])
				if ExtraAbilitiesNum  >= 1 then
					call JSX("SP5_" + I2S(i), HeroCommonSkills[PlayerSkillIndex[TME * HL + 5]])
				endif
				if ExtraAbilitiesNum  >= 2 then
					call JSX("SP6_" + I2S(i), HeroCommonSkills[PlayerSkillIndex[TME * HL + 6]])
				endif
			endif
			set i = i + 1
			if i == 6 then
				set i = 7
			endif
		exitwhen i >$B
		endloop
		call SetResourceBarTime(C8X, C9X, true)
		set B3 = true
		set WQ = GetGameTime()
		call CleanCurrentTrigger(GetTriggeringTrigger())
		call SetFloatGameState(GAME_STATE_TIME_OF_DAY, 6.)
		call SuspendTimeOfDay(false)
		if Mode__NoPowerups == false then
			call TriggerRegisterTimerEvent(RuneRefreshTrigger, 120, true)
			call TriggerEvaluate(RuneRefreshTrigger)
		endif
		call TriggerRegisterTimerEvent(NeutralCreaturesRefreshTrig, 60, true)
		if not Mode__FastNeutrals then
			set t = CreateTrigger()
			call TriggerRegisterTimerEvent(t, 30, false)
			call TriggerAddCondition(t, Condition(function MVO))
			set t = null
		endif
		call TriggerRegisterTimerEvent(AG, 30, true)
		call TriggerExecute(AG)
		call TriggerRegisterTimerEvent(LG, 450, true)
		call TriggerRegisterTimerEvent(C1,$A8B-30, false)
		call TriggerRegisterTimerEvent(D1, 999 -$96, false)
		call TriggerRegisterTimerEvent(D1,$7CF-$F0, false)
		call TriggerRegisterTimerEvent(D1,$BB7-330, false)
		call TriggerRegisterTimerEvent(XVV, 240, true)
		call TriggerRegisterTimerEvent(FKV, 300, true)
		call TriggerRegisterTimerEvent(PN, 30, true)
		call TriggerEvaluate(PN)
		if Mode__SuperCreeps then
			call TriggerRegisterTimerEvent(SG, 600, true)
		endif
	elseif r == 7 and not InHeroSelection then
		set t = CreateTrigger()
		call TriggerRegisterTimerEvent(t, 30, true)
		call TriggerAddCondition(t, Condition(function GGO))
	elseif Y2X <$C and PK == false and not InHeroSelection then
		set PK = true
		call PlaySoundBJ(QD)
		call SetResourceBarTime(C8X, C9X, true)
	elseif Y2X == 20 then
	elseif Y2X ==$F and InHeroSelection and(CK[0]> 0 or CK[1]> 0) then
		if not FP[LocalId]then
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, CR[LocalId], "|c006699CC" + "如果你需要更多时间来挑选技能，请输入 -addtime" + "|r")
		endif
	else
		call SetResourceBarTime(C8X, C9X, true)
	endif
	return false
endfunction
function MAO takes nothing returns boolean
	if IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GetAttacker())) and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(GetAttacker())) and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and GetWidgetLife(GetFilterUnit())> 1 and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO)== false and GetOwningPlayer(GetFilterUnit())!= BW then
		if IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) then
			set FIV = GetFilterUnit()
		else
			set FAV = GetFilterUnit()
		endif
	endif
	return false
endfunction
function MNO takes nothing returns nothing
	local unit GPO = GetAttacker()
	local unit targetUnit = GetTriggerUnit()
	local group g = LoginGroup(49)
	call GroupEnumUnitsInRange(g, GetUnitX(GPO), GetUnitY(GPO), 900, Condition(function MAO))
	call LogoutGroup(g)
	call DisableTrigger(GetTriggeringTrigger())
	if FIV != null then
		call IssueTargetOrderById(GPO, 851983, FIV)
		call GroupAddUnit(FNV, GPO)
	elseif IsUnitType(targetUnit, UNIT_TYPE_HERO) and FAV != null then
		call IssueTargetOrderById(GPO, 851983, FAV)
		call GroupAddUnit(FNV, GPO)
	endif
	call EnableTrigger(GetTriggeringTrigger())
	set FIV = null
	set FAV = null
	set GPO = null
	set targetUnit = null
	set g = null
endfunction
function MBO takes nothing returns nothing
	if GetWidgetLife(GetEnumUnit())< 1 then
		call GroupRemoveUnit(FNV, GetEnumUnit())
	endif
	if GetUnitCurrentOrder(GetEnumUnit())!= 851983then
		call GroupRemoveUnit(FNV, GetEnumUnit())
		call IssuePointOrderByIdLoc(GetEnumUnit(), 851983, KW[GetUnitAbilityLevel(GetEnumUnit(),'A06G')])
	endif
endfunction
function MCO takes nothing returns boolean
	call ForGroup(FNV, function MBO)
	return false
endfunction
//function MDO takes string s returns nothing
//	set FBV = FBV + 1
//	set FCV[FBV]= s
//endfunction

function MJO takes nothing returns nothing
	if IsMessengerUnit(GetEnumUnit()) and IsUnitAlly(GetEnumUnit(), Sentinels[0])== false and GetWidgetLife(GetEnumUnit())> .5 then
		call UnitRemoveAbility(GetEnumUnit(),'B08H')
		call UnitDamageTargetEx(SentinelsBuilding_FountainOfLife, GetEnumUnit(), 2, 500)
	endif
endfunction
function MKO takes nothing returns nothing
	if IsMessengerUnit(GetEnumUnit()) and IsUnitAlly(GetEnumUnit(), Scourges[0])== false and GetWidgetLife(GetEnumUnit())> .5 then
		call UnitRemoveAbility(GetEnumUnit(),'B08H')
		call UnitDamageTargetEx(B7, GetEnumUnit(), 2, 500)
	endif
endfunction
function CourierFountainCheck takes nothing returns boolean
	local group g = LoginGroup(50)
	call GroupEnumUnitsInRect(g, O0, TrueBoolexprCondition)
	call ForGroup(g, function MJO)
	call GroupClear(g)
	call GroupEnumUnitsInRect(g, R0, TrueBoolexprCondition)
	call ForGroup(g, function MKO)
	call LogoutGroup(g)
	set g = null
	return false
endfunction
function MLO takes nothing returns nothing
	local integer i = LoadInteger(Q,-1, 0)
	local integer k = 0
	call PreloadEndEx()
	call PreloadGenClear()
	call PreloadGenStart()
	loop
		if HaveSavedString(Q,-1, k) then
			call Preload(LoadStr(Q,-1, k))
		endif
		set k = k + 1
	exitwhen k > i
	endloop
	call PreloadGenEnd("FogClicks.txt")
	call PreloadGenClear()
endfunction
function MMO takes string MPO returns nothing
	local integer i
	local player p
	local string id
	local integer JJO = R2I(GetGameTime()-WQ)
	local integer C8X = JJO / 60 -1 / 2
	local integer C9X = ModuloInteger(JJO, 60)
	local integer TME
	if MPO == "1" then
		call UEV("w", "0", 31)
	else
		call UEV("w", "0", 992)
	endif
	call O2X()
	if Mode__AntiHack then
		call MLO()
	endif
	set i = 1
	loop
	exitwhen i > 5
		set p = Sentinels[i]
		set id = I2S(GetPlayerId(p))
		set TME = GetPlayerId(p)
		call StoreInteger(K4, id, "1", RQ[TME])
		call StoreInteger(K4, id, "2", IQ[TME])
		call StoreInteger(K4, id, "3", AQ[TME])
		call StoreInteger(K4, id, "4", NQ[TME])
		call StoreInteger(K4, id, "5", CQ[TME])
		call StoreInteger(K4, id, "6", GetPlayerState((p), PLAYER_STATE_RESOURCE_GOLD))
		call StoreInteger(K4, id, "7", LoadInteger(HY, 400 + TME, 79))
		call StoreInteger(K4, id, "8_0", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 0)))
		call StoreInteger(K4, id, "8_1", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 1)))
		call StoreInteger(K4, id, "8_2", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 2)))
		call StoreInteger(K4, id, "8_3", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 3)))
		call StoreInteger(K4, id, "8_4", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 4)))
		call StoreInteger(K4, id, "8_5", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 5)))
		call StoreInteger(K4, id, "9", PlayerHeroTypeId[TME])
		call StoreInteger(K4, id, "id", i)
		set p = Scourges[i]
		set TME = GetPlayerId(p)
		set id = I2S(TME)
		call StoreInteger(K4, id, "1", RQ[TME])
		call StoreInteger(K4, id, "2", IQ[TME])
		call StoreInteger(K4, id, "3", AQ[TME])
		call StoreInteger(K4, id, "4", NQ[TME])
		call StoreInteger(K4, id, "5", CQ[TME])
		call StoreInteger(K4, id, "6", GetPlayerState((p), PLAYER_STATE_RESOURCE_GOLD))
		call StoreInteger(K4, id, "7", LoadInteger(HY, 400 + TME, 79))
		call StoreInteger(K4, id, "8_0", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 0)))
		call StoreInteger(K4, id, "8_1", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 1)))
		call StoreInteger(K4, id, "8_2", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 2)))
		call StoreInteger(K4, id, "8_3", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 3)))
		call StoreInteger(K4, id, "8_4", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 4)))
		call StoreInteger(K4, id, "8_5", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 5)))
		call StoreInteger(K4, id, "9", PlayerHeroTypeId[TME])
		call StoreInteger(K4, id, "id", i + 5)
		if LocalPlayer== HostPlayer then
			call SyncStoredInteger(K4, I2S(GetPlayerId(Sentinels[i])), "1")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Sentinels[i])), "2")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Sentinels[i])), "3")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Sentinels[i])), "4")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Sentinels[i])), "5")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Sentinels[i])), "6")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Sentinels[i])), "7")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Sentinels[i])), "8_0")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Sentinels[i])), "8_1")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Sentinels[i])), "8_2")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Sentinels[i])), "8_3")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Sentinels[i])), "8_4")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Sentinels[i])), "8_5")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Sentinels[i])), "9")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Sentinels[i])), "id")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Scourges[i])), "1")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Scourges[i])), "2")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Scourges[i])), "3")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Scourges[i])), "4")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Scourges[i])), "5")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Scourges[i])), "6")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Scourges[i])), "7")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Scourges[i])), "8_0")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Scourges[i])), "8_1")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Scourges[i])), "8_2")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Scourges[i])), "8_3")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Scourges[i])), "8_4")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Scourges[i])), "8_5")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Scourges[i])), "9")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Scourges[i])), "id")
		endif
		set i = i + 1
	endloop
	call StoreInteger(K4, "Global", "Winner", FDV)
	call StoreInteger(K4, "Global", "m", C8X)
	call StoreInteger(K4, "Global", "s", C9X)
	if LocalPlayer== HostPlayer then
		call SyncStoredInteger(K4, "Global", "Winner")
		call SyncStoredInteger(K4, "Global", "m")
		call SyncStoredInteger(K4, "Global", "s")
	endif
	set p = null
endfunction
function I09 takes nothing returns nothing
	call MMO("1")
endfunction
function L4X takes nothing returns nothing
	local player p = FFV
	local integer TME = GetPlayerId(p)
	local string id = I2S(TME)
	call StoreInteger(K4, id, "8_0", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 0)))
	call StoreInteger(K4, id, "8_1", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 1)))
	call StoreInteger(K4, id, "8_2", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 2)))
	call StoreInteger(K4, id, "8_3", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 3)))
	call StoreInteger(K4, id, "8_4", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 4)))
	call StoreInteger(K4, id, "8_5", GetItemTypeId(UnitItemInSlot(Player__Hero[TME], 5)))
	if LocalPlayer== HostPlayer then
		call SyncStoredInteger(K4, id, "8_0")
		call SyncStoredInteger(K4, id, "8_1")
		call SyncStoredInteger(K4, id, "8_2")
		call SyncStoredInteger(K4, id, "8_3")
		call SyncStoredInteger(K4, id, "8_4")
		call SyncStoredInteger(K4, id, "8_5")
	endif
	set p = null
endfunction
function MQO takes nothing returns boolean
	call ExecuteFunc("KYO")
	return false
endfunction
function MSO takes nothing returns nothing
	call XBX(GetEnumUnit())
endfunction
function MTO takes nothing returns nothing
	local group g = LoginGroup(51)
	call GroupEnumUnitsInRange(g, 0, 0,$2EE0, Condition(function DDX))
	call ForGroup(g, function MSO)
	call LogoutGroup(g)
	set g = null
endfunction
function MUO takes nothing returns nothing
	local integer i = 1
	local player p
	set bj_changeLevelShowScores = true
	call DisableTrigger(YK)
	call DisableTrigger(JK)
	call ExecuteFunc("RUO")
	if MW then
		call DisableTrigger(FXV)
	endif
	call DisableTrigger(EQV)
	call ClearTextMessages()
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 60, K3 + " " + GetObjectName('n054')+ " QQ讨论群1064025490")
	call ExecuteFunc("GetGroupList")
	set OY = true
	call NEX()
	call DisableTrigger(AG)
	call DisableTrigger(QG)
	call DisableTrigger(AddGoldForIntervalTrig)
	call UOV()
	call V9X()
endfunction
function MWO takes nothing returns nothing
	local trigger t = CreateTrigger()
	call PanCameraToTimed(GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0)
	call TriggerRegisterTimerEvent(t, 2.5, false)
	call TriggerAddCondition(t, Condition(function MQO))
	set FDV = 2
	set K3 = "|c0020c000" + GetObjectName('n03O')+ "|r"
	call MUO()
	call MTO()
	call MMO("2")
	set t = null
endfunction
function MYO takes nothing returns boolean
	call SetUnitVertexColorBJ(T7, 100, 100, 100, GetTriggerEvalCount(GetTriggeringTrigger()))
	if GetTriggerEvalCount(GetTriggeringTrigger())== 100  then
		call ShowUnit(T7, false)
		call CleanCurrentTrigger(GetTriggeringTrigger())
	endif
	return false
endfunction
function MZO takes nothing returns nothing
	local trigger t = CreateTrigger()
	call PanCameraToTimed(GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0)
	call TriggerRegisterTimerEvent(t, 1.5, false)
	call TriggerAddCondition(t, Condition(function MQO))
	set FDV = 1
	set K3 = "|c00ff0303" + GetObjectName('n03N')+ "|r"
	call MUO()
	call MTO()
	call MMO("1")
	call AddSpecialEffect("war3mapImported\\FrozenThronesDeath2.mdx", GetUnitX(T7)+$96, GetUnitY(T7)+ 100 )
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function MYO))
	set t = null
endfunction
function M_O takes real JQX returns boolean
	return( 100 * GetWidgetLife(GetTriggerUnit())/ GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE))< JQX
endfunction
function M0O takes unit u returns boolean
	return GetUnitAbilityLevel(u,'A464')> 0 or GetUnitAbilityLevel(u,'BNdo')> 0 or GetUnitAbilityLevel(u,'BEsh')> 0 or GetUnitAbilityLevel(u,'B001')> 0 or GetUnitAbilityLevel(u,'B0AQ')> 0 or GetUnitAbilityLevel(u,'B0AP')> 0
endfunction
function M1O takes nothing returns nothing
	if not((M_O(10) and IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE) and GetUnitTypeId(GetTriggerUnit())!='etol' and GetUnitTypeId(GetTriggerUnit())!='unpl') or(M_O(25) and M0O(GetTriggerUnit())) or(M_O(50) and IsUnitIdType(GetUnitTypeId(GetTriggerUnit()), UNIT_TYPE_HERO)== false and(IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE)== false)) or(GetUnitTypeId(GetTriggerUnit())=='u00S') or(LoadInteger(HY, GetHandleId(GetAttacker()), 4328)== 1)) then
		call IssueImmediateOrderById(GetAttacker(),$D0004)
	endif
endfunction



function M2O takes nothing returns boolean
	local boolean b
	if IsUnitAlly(GetTriggerUnit(), GetOwningPlayer(GetAttacker())) then
		call M1O()
	elseif IsUnitType(GetAttacker(), UNIT_TYPE_HERO) or IsBearUnit(GetAttacker()) then
		set b = IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE)== false and IsUnitIllusion(GetAttacker())== false
		set FGV = GetPlayerId(GetOwningPlayer(GetAttacker()))
		//if CDV[FGV]> 0 and b and GetUnitTypeId(GetTriggerUnit())!='n00L'and GYX(GetAttacker(), RealItemTypeId[Item_Javelin]) then
		//	call IMO()
		//endif
		if CKV[FGV]> 0 and b and GYX(GetAttacker(), RealItemTypeId[Item_SangeAndYasha]) then
			call IUO()
		//elseif(CLV[FGV]> 0 or C1V[FGV]> 0 or C1Z[FGV]> 0) and b and() then
		//	call I_O()
		endif
	elseif GetUnitAbilityLevel(GetAttacker(),'A17S')> 0 and IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE)== false then
		call MNO()
	endif
	return false
endfunction
function M3O takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	if GetTriggerEventId()== EVENT_PLAYER_UNIT_SPELL_EFFECT or LoadBoolean(HY, GetHandleId(triggerUnit),$8C) then
		if LoadBoolean(HY, GetHandleId(triggerUnit),$8C) then
			call SaveBoolean(HY, GetHandleId(triggerUnit), 140, false)
			call SaveInteger(HY, GetHandleId(triggerUnit), 4259, 2)
			call UnitRemoveAbility(triggerUnit,'A04R')
			call UnitRemoveAbility(triggerUnit,'Avul')
			call PauseUnit(triggerUnit, false)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		elseif GetSpellTargetUnit()== triggerUnit and GetSpellAbilityId()== FJV and(GetPlayerSlotState(GetOwningPlayer(triggerUnit))== PLAYER_SLOT_STATE_LEFT) and LoadInteger(HY, GetHandleId(triggerUnit), 4259)== 1 then
			call SaveInteger(HY, GetHandleId(triggerUnit), 4259, 2)
			call UnitRemoveAbility(triggerUnit,'A04R')
			call UnitRemoveAbility(triggerUnit,'Avul')
			call PauseUnit(triggerUnit, false)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	elseif UnitAlive(triggerUnit) then
		call SetUnitX(triggerUnit, x)
		call SetUnitY(triggerUnit, y)
		call SaveInteger(HY, GetHandleId(triggerUnit), 4259, 1)
		call UnitAddAbility(triggerUnit,'A04R')
		call UnitAddPermanentAbility(triggerUnit,'Avul')
		call PauseUnit(triggerUnit, true)
	endif
	set triggerUnit = null
	set t = null
	return false
endfunction
function M4O takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = GetSpellTargetUnit()
	call SaveBoolean(HY, GetHandleId(triggerUnit), 140, false)
	call SaveInteger(HY, GetHandleId(triggerUnit), 4259, 1)
	call UnitAddAbility(triggerUnit,'A04R')
	call UnitAddPermanentAbility(triggerUnit,'Avul')
	call PauseUnit(triggerUnit, true)
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	call SaveReal(HY, h, 6, GetUnitX(triggerUnit)* 1.)
	call SaveReal(HY, h, 7, GetUnitY(triggerUnit)* 1.)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function M3O))
	set t = null
	set triggerUnit = null
endfunction
function M5O takes nothing returns nothing
	local integer i = GetSpellAbilityId()
	if i =='A1WE' or i =='A0B8' or i =='A063' or i =='A03O' or i =='A1AY' or i =='A0MQ' or i =='A1B6' then
		call RemoveUnitBuff(GetTriggerUnit(), false)
	endif
endfunction
function M6O takes nothing returns boolean
	if GetSpellAbilityId()== FHV and GetPlayerSlotState(GetOwningPlayer(GetSpellTargetUnit()))== PLAYER_SLOT_STATE_LEFT and LoadInteger(HY, GetHandleId(GetSpellTargetUnit()), 4259)!= 1 then
		call M4O()
	elseif(GetSpellAbilityId()== FJV or GetSpellAbilityId()== FHV) and GetPlayerSlotState(GetOwningPlayer(GetSpellTargetUnit()))!= PLAYER_SLOT_STATE_LEFT then
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n02N'))
	endif
	if FDX(GetSpellAbilityId()) then
		if FCX(GetSpellAbilityId())== false then
			call RemoveUnitBuff(GetSpellTargetUnit(), IsUnitEnemy(GetSpellTargetUnit(), GetTriggerPlayer()))
		else
			call RemoveUnitBuff(GetSpellTargetUnit(), IsUnitEnemy(GetSpellTargetUnit(), GetOwningPlayer(LoadUnitHandle(HY, GetHandleId(GetTriggerUnit()), 0))))
		endif
	else
		call M5O()
	endif
	return false
endfunction
function M7O takes destructable d returns boolean
	local real x = GetDestructableX(d)
	local real y = GetDestructableY(d)
	local group g = LoginGroup(52)
	local boolean M8O
	call GroupEnumUnitsInRange(g, x, y,$FA, Condition(function FEX))
	set M8O = FirstOfGroup(g)!= null
	call LogoutGroup(g)
	set g = null
	return M8O
endfunction
function M9O takes nothing returns nothing
	if IsTreeDestructable(GetEnumDestructable()) and GetDestructableLife(GetEnumDestructable())< 1 and GetDestructableTypeId(GetEnumDestructable())!='B002' and GetDestructableTypeId(GetEnumDestructable())!='B003' then
		if M7O(GetEnumDestructable())== false then
			call DestructableRestoreLife(GetEnumDestructable(), GetDestructableMaxLife(GetEnumDestructable()), false)
			call SetDestructableAnimation(GetEnumDestructable(), "birth")
			if SL[LocalId]== 1 and GetDestructableTypeId(GetEnumDestructable())=='ATtr' then
				call SetDestructableAnimation(GetEnumDestructable(), "stand alternate")
			endif
		endif
	endif
endfunction
function PVO takes nothing returns nothing
	call EnumDestructablesInRectAll(bj_mapInitialPlayableArea, function M9O)
endfunction
function PEO takes nothing returns boolean
	if GetUnitTypeId(GetTriggerUnit())=='n00L' then
		//if IsUnitIllusion(GetAttacker()) then
		//	call KillUnit(GetAttacker())
		//else
		if IsUnitInRegion(FLV, GetAttacker())== false or RectContainsUnit(ZV, GetAttacker()) then
			call InterfaceErrorForPlayer(GetOwningPlayer(GetAttacker()), GetObjectName('n035'))
			call IssueImmediateOrderById(GetAttacker(),$D0004)
		endif
	endif
	return false
endfunction
// 马甲单位进入地图
function PXO takes nothing returns boolean
	local unit u = GetEnteringUnit()
	if GetUnitTypeId(u)=='e00E' or GetUnitTypeId(u)=='e022' then
		call ShowUnit(u, false)
		call SetUnitPathing(u, false)
		call SetUnitInvulnerable(u, true)
		call UnitApplyTimedLife(u,'BTLF', 20.)
	endif
	set u = null
	return false
endfunction

function PRO takes nothing returns boolean
	return(GetUnitTypeId(GetDyingUnit())=='e00R') or(GetUnitTypeId(GetDyingUnit())=='e011') or(GetUnitTypeId(GetDyingUnit())=='e00S') or(GetUnitTypeId(GetDyingUnit())=='e019')
endfunction
function PIO takes integer id returns nothing
	if id == 0 then
		call EXUnitResetCooldown(VXV)
		call EXUnitResetCooldown(VOV)
		call EXUnitResetCooldown(VRV)
		call EXUnitResetCooldown(VIV)
		call EXUnitResetCooldown(VAV)
	else
		call EXUnitResetCooldown(VNV)
		call EXUnitResetCooldown(VBV)
		call EXUnitResetCooldown(VCV)
		call EXUnitResetCooldown(VDV)
		call EXUnitResetCooldown(VFV)
	endif
endfunction
function PAO takes unit PNO returns boolean
	return GetUnitTypeId(PNO)=='e00R' or GetUnitTypeId(PNO)=='u00M'
endfunction
function PBO takes unit PNO, unit SYX returns nothing
	local player p = GetOwningPlayer(SYX)
	local integer TME = GetPlayerId(p)
	call DestroyEffect(tower_rangeeff[LoadInteger(ExtraHT, GetHandleId(PNO), HTKEY_TOWER_ATTACK_RANGE_EFFECT )])
	set tower_rangeeff[LoadInteger(ExtraHT, GetHandleId(PNO), HTKEY_TOWER_ATTACK_RANGE_EFFECT )] = null
	if IsUnitAlly(PNO, p) then
		set MQ[TME]= MQ[TME]+ 1
		call DisplayTimedTextToAllPlayer(XY, CR[LocalId], JS[TME]+ VMV[TME]+ "|r " + GetObjectName('n04P')+ ".")
	else
		set QQ[TME]= QQ[TME]+ 1
		call DisplayTimedTextToAllPlayer(XY, CR[LocalId], JS[TME]+ VMV[TME]+ "|r " + GetObjectName('n0EN')+ ".")
	endif
	if PAO(PNO) then
		if GetOwningPlayer(PNO)== Sentinels[0]then
			call DisplayTimedTextToAllPlayer(RW, CR[LocalId], "我方的防御符文冷却时间已刷新")
		else
			call DisplayTimedTextToAllPlayer(IW, CR[LocalId], "我方的防御符文冷却时间已刷新")
		endif
	endif
endfunction
function PCO takes nothing returns nothing
	local unit u = GetDyingUnit()
	local unit SYX = GetKillingUnit()
	local player pk = GetOwningPlayer(SYX)
	local integer TME = GetPlayerId(pk)
	call PBO(u, SYX)
	if u == SentinelsBuilding_AP_L1_TOP or u == SentinelsBuilding_AP_L1_MID or u == SentinelsBuilding_AP_L1_BOT then
		call OCX(SYX, 1)
		if IsUnitAlly(u, pk)== false then
			call PIO(0)
		endif
		if u == SentinelsBuilding_AP_L1_TOP then
			call JSX("Tower010", TME)
			call UnitRemoveAbility(SentinelsBuilding_AP_L2_TOP,'Avul')
		elseif u == SentinelsBuilding_AP_L1_MID then
			call JSX("Tower011", TME)
			call UnitRemoveAbility(X6,'Avul')
		else
			call JSX("Tower012", TME)
			call UnitRemoveAbility(O6,'Avul')
		endif
	elseif u == SentinelsBuilding_AP_L2_TOP or u == X6 or u == O6 then
		call OCX(SYX, 2)
		if u == SentinelsBuilding_AP_L2_TOP then
			call JSX("Tower020", TME)
			call UnitRemoveAbility(R6,'Avul')
		elseif u == X6 then
			call JSX("Tower021", TME)
			call UnitRemoveAbility(I6,'Avul')
		else
			call JSX("Tower022", TME)
			call UnitRemoveAbility(N6,'Avul')
		endif
	elseif u == R6 or u == I6 or u == N6 then
		call OCX(SYX, 3)
		call UnitRemoveAbility(B6,'Avul')
		call UnitRemoveAbility(C6,'Avul')
		call UnitRemoveAbility(X7,'Avul')
		call UnitRemoveAbility(O7,'Avul')
		call UnitRemoveAbility(R7,'Avul')
		call UnitRemoveAbility(I7,'Avul')
		call UnitRemoveAbility(L6,'Avul')
		call UnitRemoveAbility(M6,'Avul')
		call UnitRemoveAbility(P6,'Avul')
		call UnitRemoveAbility(Q6,'Avul')
		call UnitRemoveAbility(T6,'Avul')
		call UnitRemoveAbility(U6,'Avul')
		call UnitRemoveAbility(W6,'Avul')
		call UnitRemoveAbility(Y6,'Avul')
		call UnitRemoveAbility(Z6,'Avul')
		call UnitRemoveAbility(V7,'Avul')
		call UnitRemoveAbility(E7,'Avul')
		if u == R6 then
			call JSX("Tower030", TME)
			call UnitRemoveAbility(D6,'Avul')
			call UnitRemoveAbility(H6,'Avul')
		elseif u == I6 then
			call JSX("Tower031", TME)
			call UnitRemoveAbility(F6,'Avul')
			call UnitRemoveAbility(J6,'Avul')
		else
			call JSX("Tower032", TME)
			call UnitRemoveAbility(G6,'Avul')
			call UnitRemoveAbility(K6,'Avul')
		endif
	elseif u == B6 or u == C6 then
		call JSX("Tower041", TME)
		call OCX(SYX, 4)
		if(u == B6 and UnitIsDead(C6)) or(u == C6 and UnitIsDead(B6)) then
			call UnitRemoveAbility(SentinelsBuilding_TheWorldTree,'Avul')
		endif
	endif
	set u = null
	set SYX = null
endfunction
function PDO takes nothing returns boolean
	return(GetUnitTypeId(GetDyingUnit())=='u00M') or(GetUnitTypeId(GetDyingUnit())=='u00D') or(GetUnitTypeId(GetDyingUnit())=='u00N') or(GetUnitTypeId(GetDyingUnit())=='u00T')
endfunction
function PFO takes nothing returns nothing
	local unit u = GetDyingUnit()
	local unit SYX = GetKillingUnit()
	local player pk = GetOwningPlayer(SYX)
	local integer TME = GetPlayerId(pk)
	call PBO(u, SYX)
	if u == U7 or u == W7 or u == Y7 then
		call OCX(SYX, 1)
		if IsUnitAlly(u, pk)== false then
			call PIO(1)
		endif
		if u == U7 then
			call JSX("Tower110", TME)
			call UnitRemoveAbility(Z7,'Avul')
		elseif u == W7 then
			call JSX("Tower111", TME)
			call UnitRemoveAbility(V8,'Avul')
		else
			call JSX("Tower112", TME)
			call UnitRemoveAbility(E8,'Avul')
		endif
	elseif u == Z7 or u == V8 or u == E8 then
		call OCX(SYX, 2)
		if u == Z7 then
			call JSX("Tower120", TME)
			call UnitRemoveAbility(X8,'Avul')
		elseif u == V8 then
			call JSX("Tower121", TME)
			call UnitRemoveAbility(O8,'Avul')
		else
			call JSX("Tower122", TME)
			call UnitRemoveAbility(R8,'Avul')
		endif
	elseif u == X8 or u == O8 or u == R8 then
		call OCX(SYX, 3)
		call UnitRemoveAbility(I8,'Avul')
		call UnitRemoveAbility(A8,'Avul')
		call UnitRemoveAbility(Y8,'Avul')
		call UnitRemoveAbility(Z8,'Avul')
		call UnitRemoveAbility(VVV,'Avul')
		call UnitRemoveAbility(VEV,'Avul')
		call UnitRemoveAbility(H8,'Avul')
		call UnitRemoveAbility(J8,'Avul')
		call UnitRemoveAbility(K8,'Avul')
		call UnitRemoveAbility(L8,'Avul')
		call UnitRemoveAbility(M8,'Avul')
		call UnitRemoveAbility(P8,'Avul')
		call UnitRemoveAbility(Q8,'Avul')
		call UnitRemoveAbility(S8,'Avul')
		call UnitRemoveAbility(T8,'Avul')
		call UnitRemoveAbility(U8,'Avul')
		call UnitRemoveAbility(W8,'Avul')
		if u == X8 then
			call JSX("Tower130", TME)
			call UnitRemoveAbility(N8,'Avul')
			call UnitRemoveAbility(D8,'Avul')
		elseif u == O8 then
			call JSX("Tower131", TME)
			call UnitRemoveAbility(B8,'Avul')
			call UnitRemoveAbility(F8,'Avul')
		else
			call JSX("Tower132", TME)
			call UnitRemoveAbility(C8,'Avul')
			call UnitRemoveAbility(G8,'Avul')
		endif
	elseif u == I8 or u == A8 then
		call JSX("Tower141", TME)
		call OCX(SYX, 4)
		if(u == I8 and UnitIsDead(A8)) or(u == A8 and UnitIsDead(I8)) then
			call UnitRemoveAbility(T7,'Avul')
		endif
	endif
	set u = null
	set SYX = null
endfunction
function PGO takes nothing returns boolean
	local integer x = 0
	if GetPlayerSlotState(Sentinels[1])== PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(Sentinels[2])== PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(Sentinels[3])== PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(Sentinels[4])== PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(Sentinels[5])== PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(Scourges[1])== PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(Scourges[2])== PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(Scourges[3])== PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(Scourges[4])== PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	if GetPlayerSlotState(Scourges[5])== PLAYER_SLOT_STATE_EMPTY then
		set x = x + 1
	endif
	return x == 9
endfunction
function PHO takes nothing returns nothing
	set FMV = false
endfunction
function PJO takes nothing returns nothing
	set FPV = true
endfunction
function PKO takes nothing returns nothing
	set FMV = true
endfunction
function PLO takes nothing returns nothing
	set IsNoHeroLimit = false
endfunction
function PMO takes nothing returns boolean
	if IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false then
		call KillUnit(GetFilterUnit())
	endif
	return false
endfunction
function PPO takes nothing returns nothing
	local group g = LoginGroup(53)
	call GroupEnumUnitsOfPlayer(g, Scourges[0], Condition(function PMO))
	call LogoutGroup(g)
	set g = null
endfunction
function PQO takes nothing returns nothing
	local group g = LoginGroup(54)
	call GroupEnumUnitsOfPlayer(g, Sentinels[0], Condition(function PMO))
	call LogoutGroup(g)
	set g = null
endfunction
function PSO takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='o004' or GetUnitTypeId(GetFilterUnit())=='oeye' then
		call KillUnit(GetFilterUnit())
	endif
	return false
endfunction
function PTO takes nothing returns nothing
	local group g = LoginGroup(55)
	call GroupEnumUnitsInRange(g, 0, 0, 9999, Condition(function PSO))
	call LogoutGroup(g)
	set g = null
endfunction
function PUO takes nothing returns nothing
	call PQO()
	call PPO()
endfunction
function PWO takes nothing returns boolean
	if IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and GetUnitAbilityLevel(GetFilterUnit(),'Aloc') == 0 then
		call SetHeroLevelAndXP(GetFilterUnit(), IMaxBJ(Q2, 1), true, 0)
	endif
	return false
endfunction
function PYO takes nothing returns nothing
	local string s = SubString(GetEventPlayerChatString(), 2, StringLength(GetEventPlayerChatString()))
	local integer level = S2I(s)
	local group g = LoginGroup(56)
	if GetEventPlayerChatString()== "-l" then
		set Q2 = 25
		call GroupEnumUnitsOfPlayer(g, GetTriggerPlayer(), Condition(function PWO))
		call LogoutGroup(g)
		set g = null
		return
	endif
	if level == 0 then
		set level = S2I(SubString(GetEventPlayerChatString(), 6, StringLength(GetEventPlayerChatString())))
	endif
	if level < 1 then
		set level = 1
	endif
	set Q2 = level
	call GroupEnumUnitsOfPlayer(g, GetTriggerPlayer(), Condition(function PWO))
	call LogoutGroup(g)
	set g = null
endfunction
function PZO takes nothing returns nothing
	call TriggerExecute(AG)
endfunction
function P_O takes nothing returns boolean
	local unit u = GetFilterUnit()
	if IsUnitType(u, UNIT_TYPE_HERO) then
		call EXUnitResetCooldown(u)
		call TimerStart(ESV[GetPlayerId((GetOwningPlayer(u)))], 0, false, null)
		call TimerStart(ETV[GetPlayerId((GetOwningPlayer(u)))], 0, false, null)
		call SetWidgetLife(u, GetUnitState(u, UNIT_STATE_MAX_LIFE))
		call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MAX_MANA))
	endif
	set u = null
	return false
endfunction
function P0O takes nothing returns nothing
	local group g = LoginGroup(57)
	call GroupEnumUnitsOfPlayer(g, GetTriggerPlayer(), Condition(function P_O))
	call LogoutGroup(g)
	set g = null
endfunction
function P1O takes nothing returns nothing
	call KillUnit(Player__Hero[GetPlayerId(GetTriggerPlayer())])
endfunction
function P2O takes nothing returns nothing
	local string P3O = SubString(GetEventPlayerChatString(), 5, StringLength(GetEventPlayerChatString()))
	local integer KGX = S2I(P3O)
	if KGX < 0 or KGX > 24 then
		set KGX = 0
	endif
	call SetFloatGameState(GAME_STATE_TIME_OF_DAY, KGX)
endfunction
function P4O takes nothing returns nothing
	local string s = SubString(GetEventPlayerChatString(), 2, StringLength(GetEventPlayerChatString()))
	local integer g = S2I(s)
	if GetEventPlayerChatString()== "-g" then
		call SetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD,$F423F)
		return
	endif
	if g == 0 then
		set g = S2I(SubString(GetEventPlayerChatString(), 5, StringLength(GetEventPlayerChatString())))
	endif
	call SetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD)+ g)
endfunction
function P5O takes nothing returns nothing
	local unit SDX = Player__Hero[GetPlayerId(GetTriggerPlayer())]
	local player T6X = GetTriggerPlayer()
	local location S1X
	if IsScourgesPlayer(T6X) then
		set S1X = GetRectCenter(GY)
	else
		set S1X = GetRectCenter(VZ)
	endif
	if OY == false and UnitIsDead(SDX) then
		call MEX(SDX, T6X, GetLocationX(S1X), GetLocationY(S1X), true)
		if S_X(SDX)== false or GetUnitAbilityLevel(SDX,'A0MW')== 0 then
			call ReviveHeroLoc(SDX, S1X, true)
		else
			call S0X(SDX, S1X)
		endif
	endif
	call RemoveLocation(S1X)
	set SDX = null
	set T6X = null
	set S1X = null
endfunction
function P6O takes nothing returns nothing
	local unit WUE = Player__Hero[GetPlayerId(GetTriggerPlayer())]
	local player p
	local unit u
	local string s = SubString(GetEventPlayerChatString(), 2, StringLength(GetEventPlayerChatString()))
	local integer i = 1
	if(S2I(s)> 0) then
		set i = S2I(s)
	endif
	if IsScourgesPlayer(GetOwningPlayer(WUE)) then
		set p = Sentinels[1]
	else
		set p = Scourges[1]
	endif
	loop
		set u = CreateUnit(Scourges[1],'H000',-400,-400, 0)
		call SetHeroLevel(u, 10, false)
		set Player__Hero[GetPlayerId(Scourges[1])]= u
		set i = i -1
	exitwhen i == 0
	endloop
	call UnitAddAbility(u,'A00S')
	call UnitAddAbility(u,'A00L')
	set WUE = null
	set u = null
	set p = null
endfunction
function GetCurrentMaxHandleId takes nothing returns nothing
	local timer t = CreateTimer()
	local integer i = GetHandleId(t)

	call BJDebugMsg("当前游戏中最大HandleId为 " + I2S(i))

	call DestroyTimer(t)
	set t = null
endfunction

function ydweleak takes nothing returns nothing
	call GetLocalizedHotkey("yd_leak_monitor::create_report")
endfunction

function ChatPowerUpActions takes nothing returns nothing
	call TriggerEvaluate(RuneRefreshTrigger)
endfunction
function ChatNeutralsActions takes nothing returns nothing
	call TriggerEvaluate(NeutralCreaturesRefreshTrig)
endfunction
function P9O takes nothing returns nothing
	call EnumDestructablesInRectAll(bj_mapInitialPlayableArea, function M9O)
endfunction
function QVO takes nothing returns boolean
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 60, "**** 注意 ****")
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 60, "系统检测到你正在使用单机模式，所以你可以使用如下命令 -lvlup xx, -refresh, -spawncreeps, -powerup, -neutrals, -kill, -gold xxxx, -time xx, -killsent, -killscourge, -killall, -noherolimit, -trees, -killwards, -spawnoff, -spawnon, -roshan, -respawn, -dummy")
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 60, "**** 注意 ****")
	return false
endfunction
function QEO takes nothing returns nothing
	set WTF__Status = not WTF__Status
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, "WTF status: " + UNV(WTF__Status))
endfunction

function QXO takes nothing returns nothing
	local player QOO = HostPlayer 
	local trigger t
	set KB = true

	// 单机也能看到伤害减免
	//set MW = true
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 60, "系统检测到你正在使用单机模式，所以你可以使用如下命令 -lvlup xx, -refresh, -spawncreeps, -powerup, -neutrals, -kill, -gold xxxx, -time xx, -killsent, -killscourge, -killall, -noherolimit, -trees, -killwards, -spawnoff, -spawnon, -roshan, -respawn, -dummy")
	set t = CreateTrigger()
	call TriggerAddCondition(t, Condition(function QVO))
	call TriggerRegisterTimerEvent(t, GetRandomReal(60, 100), false)
	set t = CreateTrigger()
	call TUV(t, "-lvlup", false)
	call TUV(t, "-l ", false)
	call TUV(t, "-l", true)
	call TriggerAddAction(t, function PYO)
	set t = CreateTrigger()
	call TUV(t, "-spawncreeps", true)
	call TUV(t, "-sc", true)
	call TriggerAddAction(t, function PZO)
	set t = CreateTrigger()
	call TUV(t, "-refresh", true)
	call TriggerAddAction(t, function P0O)
	set t = CreateTrigger()
	call TUV(t, "-kill", true)
	call TriggerAddAction(t, function P1O)
	set t = CreateTrigger()
	call TUV(t, "-wtf", true)
	call TriggerAddAction(t, function QEO)
	set t = CreateTrigger()
	call TUV(t, "-gold", false)
	call TUV(t, "-g ", false)
	call TUV(t, "-g", true)
	call TriggerAddAction(t, function P4O)
	set t = CreateTrigger()
	call TUV(t, "-time", false)
	call TriggerAddAction(t, function P2O)
	set t = CreateTrigger()
	call TUV(t, "-powerup", true)
	call TriggerAddAction(t, function ChatPowerUpActions)
	set t = CreateTrigger()
	call TUV(t, "-killall", true)
	call TUV(t, "-ka", true)
	call TriggerAddAction(t, function PUO)
	set t = CreateTrigger()
	call TUV(t, "-killsent", true)
	call TriggerAddAction(t, function PQO)
	set t = CreateTrigger()
	call TUV(t, "-killscourge", true)
	call TriggerAddAction(t, function PPO)
	set t = CreateTrigger()
	call TUV(t, "-neutrals", true)
	call TUV(t, "-n", true)
	call TriggerAddAction(t, function ChatNeutralsActions)
	set t = CreateTrigger()
	call TUV(t, "-noherolimit", true)
	call TUV(t, "-nhl", true)
	call TriggerAddAction(t, function PLO)
	set t = CreateTrigger()
	call TUV(t, "-trees", true)
	call TriggerAddAction(t, function P9O)
	set t = CreateTrigger()
	call TUV(t, "-killwards", true)
	call TriggerAddAction(t, function PTO)
	set t = CreateTrigger()
	call TUV(t, "-spawnoff", true)
	call TriggerAddAction(t, function PKO)
	set t = CreateTrigger()
	call TUV(t, "-spawnon", true)
	call TriggerAddAction(t, function PHO)
	set t = CreateTrigger()
	call TUV(t, "-roshan", true)
	call TriggerAddAction(t, function PJO)
	set t = CreateTrigger()
	call TUV(t, "-respawn", true)
	call TriggerAddAction(t, function P5O)
	set t = CreateTrigger()
	call TUV(t, "-dummy", true)
	call TUV(t, "-d", true)
	call TUV(t, "-d ", false)
	call TriggerAddAction(t, function P6O)
	set t = CreateTrigger()
	call TUV(t, "-h ", false)
	call TriggerAddAction(t, function GetCurrentMaxHandleId)
	set t = CreateTrigger()
	call TUV(t, "-ydweleak ", true)
	call TriggerAddAction(t, function ydweleak)
	set QOO = null
	set t = null
endfunction
function QRO takes nothing returns boolean
	return not GS
endfunction
function QIO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit ZWX =(LoadUnitHandle(HY, h, 26))
	if GetUnitTypeId(ZWX)!='ncop' then
		call EXUnitResetCooldown(ZWX)
		call SetUnitManaPercentBJ(ZWX, 100)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set ZWX = null
	return false
endfunction
function QAO takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function QIO))
	call SaveUnitHandle(HY, h, 26,(GetTriggerUnit()))
	set t = null
endfunction
function QNO takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer QBO = XKX(RW)+ XKX(IW)
	local integer NumRequired = IMinBJ(QBO, QBO / 2 + 1)
	local integer h = GetHandleId(t)
	if GGV == false then
		set FQV = true
		call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 60., " ")
		call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 90., GetObjectName('n077'))
		call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 90., GetObjectName('n078'))
		set t = CreateTrigger()
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
		call TriggerAddAction(t, function QAO)
	endif
	set t = null
endfunction
function QCO takes nothing returns boolean
	if P9X(GetTriggerUnit()) and IsUnitIllusion(GetTriggerUnit())== false then
		call KTX(GetOwningPlayer(GetTriggerUnit()))
		call JSX("Level" + I2S(GetHeroLevel(GetTriggerUnit())), GetPlayerId(GetOwningPlayer(GetTriggerUnit())))
	endif
	return false
endfunction
function QDO takes nothing returns nothing
	if GGV == false then
		call QXO()
		call CleanCurrentTrigger(GetTriggeringTrigger())
	endif
endfunction
function QFO takes nothing returns boolean
	if GS == false and(bj_isSinglePlayer and PGO())== false then
		call QDO()
	endif
	return false
endfunction
function QGO takes nothing returns nothing
	call SetUnitUserData(GetEnumUnit(), 0)
	call IssuePointOrderByIdLoc(GetEnumUnit(), 851983,(KW[GetUnitAbilityLevel((GetEnumUnit()),'A06G')]))
endfunction
function QHO takes nothing returns nothing
	call IssueTargetOrderById(GetEnumUnit(), 851983, FUV)
	call GroupAddUnit(FTV, GetEnumUnit())
	call SetUnitUserData(GetEnumUnit(), FWV)
endfunction
function QJO takes nothing returns boolean
	local integer id = GetUnitTypeId(GetFilterUnit())
	if id =='ebal' or id =='e026' or id =='umtw' or id =='u00R' then
		return false
	endif
	if IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(FUV)) and(GetOwningPlayer(GetFilterUnit())== Sentinels[0]or GetOwningPlayer(GetFilterUnit())== Scourges[0]) and GetUnitUserData(GetFilterUnit())== 0 then
		return true
	endif
	return false
endfunction
function QKO takes nothing returns nothing
	if GetUnitCurrentOrder(GetEnumUnit())== 0 and IsUnitInRange(GetEnumUnit(), FUV, GetUnitAcquireRange(GetEnumUnit()))== false then
		call GroupRemoveUnit(FTV, GetEnumUnit())
		call SetUnitUserData(GetEnumUnit(), 0)
		call IssuePointOrderByIdLoc(GetEnumUnit(), 851983,(KW[GetUnitAbilityLevel((GetEnumUnit()),'A06G')]))
	endif
endfunction
function QLO takes nothing returns nothing
	local integer h = GetHandleId((LoadUnitHandle(HY,(GetHandleId(GetExpiredTimer())), 2)))
	local integer id =(LoadInteger(HY, h,$8F))
	local group QMO =(LoadGroupHandle(HY, h,$90))
	set FSV[id]= null
	call ForGroup(QMO, function QGO)
	call GroupClear(QMO)
	set QMO = null
endfunction
function QPO takes unit SZX, unit QQO returns nothing
	local integer h = GetHandleId(SZX)
	local group QMO = LoadGroupHandle(HY, h,$90)
	local integer id = LoadInteger(HY, h,$8F)
	local unit QSO = FSV[id]
	local group g
	if QSO != null and QSO != QQO then
		call ForGroup(QMO, function QGO)
		call GroupClear(QMO)
	endif
	set FSV[id]= QQO
	set FTV = QMO
	set FUV = QQO
	set FWV = id
	call ForGroup(QMO, function QKO)
	set g = LoginGroup(58)
	call GroupEnumUnitsInRange(g, GetUnitX(QQO), GetUnitY(QQO), 500, Condition(function QJO))
	call ForGroup(g, function QHO)
	call LogoutGroup(g)
	call TimerStart(LoadTimerHandle(HY, h,$8D), 2, false, function QLO)
	set QMO = null
	set QSO = null
	set g = null
endfunction
function QTO takes nothing returns boolean
	local unit triggerUnit = GetTriggerUnit()
	local unit targetUnit = GetOrderTargetUnit()
	local integer S6V = GetIssuedOrderId()
	local integer id
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) and IsUnitIllusion(targetUnit)== false and(S6V ==$D000F or S6V ==851971) and IsUnitEnemy(targetUnit, GetOwningPlayer(triggerUnit)) and UnitVisibleToPlayer(triggerUnit, GetOwningPlayer(targetUnit)) and EI == false then
		set id =(LoadInteger(HY,(GetHandleId(targetUnit)),$8F))
		if FSV[id]== null or FSV[id]== targetUnit or UnitIsDead(FSV[id]) then
			call QPO(targetUnit, triggerUnit)
		endif
	endif
	set triggerUnit = null
	set targetUnit = null
	return false
endfunction
function QUO takes nothing returns boolean
	local unit u = GetAttacker()
	local unit triggerUnit = GetTriggerUnit()
	local integer id
	if LWO(u)== false and EI == false then
		set id =(LoadInteger(HY,(GetHandleId(triggerUnit)),$8F))
		if FSV[id]== null or FSV[id]== triggerUnit or UnitIsDead(FSV[id]) then
			call QPO(triggerUnit, u)
		endif
	endif
	set u = null
	set triggerUnit = null
	return false
endfunction
function QWO takes unit triggerUnit returns nothing
	local group g
	local trigger t
	local timer tm
	local integer h = GetHandleId(triggerUnit)
	set FYV = FYV + 1
	call SaveBoolean(HY, h,$8E,(true))
	call SaveInteger(HY, h,$8F,(FYV))
	set g = LoginGroup(59)
	call SaveGroupHandle(HY, h,$90,(g))
	set t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerAddCondition(t, Condition(function QTO))
	set t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_ATTACKED)
	call TriggerAddCondition(t, Condition(function QUO))
	set tm = CreateTimer()
	call SaveTimerHandle(HY,(GetHandleId(triggerUnit)),$8D,(tm))
	call SaveUnitHandle(HY,(GetHandleId(tm)), 2,(triggerUnit))
	set g = null
	set t = null
	set tm = null
endfunction
function QYO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer id
	local unit u
	if GetTriggerEventId()== EVENT_UNIT_CHANGE_OWNER then
		set u = GetTriggerUnit()
		set id = GetUnitTypeId(u)
		if id =='n026' or id =='n127' then
			call UnitAddPermanentAbility(u,'A36I')
		elseif id =='ndtw' then
			call UnitAddPermanentAbility(u,'ACen')
		elseif id =='nomg' then
			call UnitAddPermanentAbility(u,'ACf2')
		elseif id =='n0HX' then
			call UnitAddPermanentAbility(u,'ACcl')
		elseif id =='nsat' then
			call UnitAddPermanentAbility(u,'ACpu')
		elseif id =='nstl' then
			call UnitAddPermanentAbility(u,'Ambd')
		endif
		set u = null
		call DestroyTrigger(t)
	else
		call DestroyTrigger(t)
	endif
	return false
endfunction
function QZO takes unit u returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_CHANGE_OWNER)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function QYO))
	set t = null
endfunction
function Q_O takes unit u returns nothing
	local integer id = GetUnitTypeId(u)
	if id =='n127' or id =='n128' then
		call UnitApplyTimedLife(u,'BTLF', 60)
		if GetOwningPlayer(u)!= BW then
			call UnitAddPermanentAbility(u,'A36I')
		endif
	endif
	if GetOwningPlayer(u)== BW then
		if id =='n127' or id =='n026' or id =='ndtw' or id =='nomg' or id =='n0HX' or id =='nsat' or id =='nstl' then
			call QZO(u)
		endif
		if id =='ndtw' or id =='ndtr' or id =='nftb' or id =='nfsh' or id =='ngns' or id =='n0HX' then
			call SetUnitAcquireRange(u, 300)
		endif
	endif
endfunction
function Q0O takes nothing returns boolean
	if O4X(GetTriggerUnit()) and(LoadBoolean(HY,(GetHandleId(GetTriggerUnit())),$8E))== false and(not InHeroSelection) then
		call QWO(GetTriggerUnit())
	endif
	if HaveSavedInteger(M, GetUnitTypeId(GetTriggerUnit()), HC) then
		call Q_O(GetTriggerUnit())
	endif
	return false
endfunction
function Q1O takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit())== Sentinels[0]then
		call SetUnitAbilityLevel(GetTriggerUnit(),'A06G', 5)
		if FSV[GetUnitUserData(GetTriggerUnit())]== null then
			call SetUnitUserData(GetTriggerUnit(), 0)
			call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983,(KW[GetUnitAbilityLevel((GetTriggerUnit()),'A06G')]))
		endif
	elseif GetOwningPlayer(GetTriggerUnit())== Scourges[0]then
		call SetUnitAbilityLevel(GetTriggerUnit(),'A06G', 1)
		if FSV[GetUnitUserData(GetTriggerUnit())]== null then
			call SetUnitUserData(GetTriggerUnit(), 0)
			call IssuePointOrderByIdLoc(GetTriggerUnit(), 851983,(KW[GetUnitAbilityLevel((GetTriggerUnit()),'A06G')]))
		endif
	endif
	return false
endfunction

// 给防御塔添加反隐马甲
function Q4O takes nothing returns nothing
	local group g
	local unit CSO
	local unit Q3O
	local integer i
	set g = LoginGroup(60)
	call GroupEnumUnitsOfPlayer(g, Sentinels[0], TrueBoolexprCondition)
	loop
		set CSO = FirstOfGroup(g)
	exitwhen CSO == null
		call GroupRemoveUnit(g, CSO)
		if GetUnitAbilityLevel(CSO,'Adts')> 0 or GetUnitAbilityLevel(CSO,'Atru')> 0 then
			set Q3O = CreateUnit(Sentinels[1],('u00B'),-5000,-5100, 0)
			call SetUnitScale(Q3O, 0, 0, 0)
			call SetUnitPathing(Q3O, false)
			call SetUnitInvulnerable(Q3O, true)
			call SetUnitX(Q3O, GetUnitX(CSO))
			call SetUnitY(Q3O, GetUnitY(CSO))
			call SaveUnitHandle(HY,(GetHandleId(CSO)), 145,(Q3O))
		endif
	endloop
	call LogoutGroup(g)
	set g = LoginGroup(61)
	call GroupEnumUnitsOfPlayer(g, Scourges[0], TrueBoolexprCondition)
	loop
		set CSO = FirstOfGroup(g)
	exitwhen CSO == null
		call GroupRemoveUnit(g, CSO)
		if GetUnitAbilityLevel(CSO,'Adts')> 0 or GetUnitAbilityLevel(CSO,'Atru')> 0 then
			set Q3O = CreateUnit(Scourges[1],('u00B'),$D48, 4400, 0)
			call SetUnitScale(Q3O, 0, 0, 0)
			call SetUnitPathing(Q3O, false)
			call SetUnitInvulnerable(Q3O, true)
			call SetUnitX(Q3O, GetUnitX(CSO))
			call SetUnitY(Q3O, GetUnitY(CSO))
			call SaveUnitHandle(HY,(GetHandleId(CSO)), 145,(Q3O))
		endif
	endloop
	call LogoutGroup(g)
	set g = null
	set Q3O = null
	set CSO = null
endfunction
function Q5O takes nothing returns nothing
	local unit Q6O = GetTriggerUnit()
	local unit targetUnit = FSV[GetUnitUserData(Q6O)]
	call SetUnitPosition(Q6O, GetUnitX(Q6O), GetUnitY(Q6O))
	if targetUnit != null and UnitIsDead(targetUnit)== false and UnitVisibleToPlayer(targetUnit, GetOwningPlayer(targetUnit)) then
		call IssueTargetOrderById(Q6O, 851983, targetUnit)
	else
		call DisableTrigger(GetTriggeringTrigger())
		call IssuePointOrderByIdLoc(Q6O, 851983,(KW[GetUnitAbilityLevel((Q6O),'A06G')]))
		call EnableTrigger(GetTriggeringTrigger())
	endif
	set Q6O = null
	set targetUnit = null
endfunction
function Q7O takes nothing returns boolean
	if LWO(GetTriggerUnit()) then
		call Q5O()
	endif
	return false
endfunction
function Q8O takes nothing returns nothing
	local unit Q6O = GetTriggerUnit()
	local unit targetUnit = FSV[GetUnitUserData(Q6O)]
	call SetUnitPosition(Q6O, GetUnitX(Q6O), GetUnitY(Q6O))
	if targetUnit != null and UnitIsDead(targetUnit)== false and UnitVisibleToPlayer(targetUnit, GetOwningPlayer(targetUnit)) then
		call IssueTargetOrderById(Q6O, 851983, targetUnit)
	else
		call DisableTrigger(GetTriggeringTrigger())
		call IssuePointOrderByIdLoc(Q6O, 851983,(KW[GetUnitAbilityLevel((Q6O),'A06G')]))
		call EnableTrigger(GetTriggeringTrigger())
	endif
	set Q6O = null
	set targetUnit = null
endfunction
function Q9O takes nothing returns boolean
	if GetIssuedOrderId()== 851986 then
		call Q8O()
	endif
	return false
endfunction
function SVO takes nothing returns boolean
	if GetOwningPlayer(GetTriggerUnit())== Sentinels[0]then
		if IsUnitFogged(GetAttacker(), Sentinels[1]) or IsUnitFogged(GetAttacker(), Scourges[1]) then
			call BEX(CreateFogModifierRadius(Sentinels[1], FOG_OF_WAR_VISIBLE, GetUnitX(GetAttacker()), GetUnitY(GetAttacker()), 128, true, false), 1)
		endif
	elseif GetOwningPlayer(GetTriggerUnit())== Scourges[0]then
		if IsUnitFogged(GetAttacker(), Sentinels[1]) or IsUnitFogged(GetAttacker(), Scourges[1]) then
			call BEX(CreateFogModifierRadius(Scourges[1], FOG_OF_WAR_VISIBLE, GetUnitX(GetAttacker()), GetUnitY(GetAttacker()), 128, true, false), 1)
		endif
	endif
	return false
endfunction
function SEO takes nothing returns boolean
	local trigger t
	local group g
	local unit u

	call ExecuteFunc("SXO") // 不知道为什么创建一堆食尸鬼

	if MW then
		set t = CreateTrigger()
		call TriggerRegisterPlayerUnitEvent(t, Sentinels[0], EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER, TrueBoolexprCondition)
		call TriggerRegisterPlayerUnitEvent(t, Scourges[0], EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER, TrueBoolexprCondition)
		call TriggerAddCondition(t, Condition(function Q9O))
		set t = CreateTrigger()
		set g = LoginGroup(62)
		call GroupEnumUnitsOfPlayer(g, Sentinels[0], TrueBoolexprCondition)
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			call GroupRemoveUnit(g, u)
			if GetUnitAcquireRange(u)!= 0 then
				call TriggerRegisterUnitInRange(t, u, 600, TrueBoolexprCondition)
			endif
		endloop
		call LogoutGroup(g)
		set g = LoginGroup(63)
		call GroupEnumUnitsOfPlayer(g, Scourges[0], TrueBoolexprCondition)
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			call GroupRemoveUnit(g, u)
			if GetUnitAcquireRange(u)!= 0 and IsUnitType(u, UNIT_TYPE_STRUCTURE) then
				call TriggerRegisterUnitInRange(t, u, 600, TrueBoolexprCondition)
			endif
		endloop
		call LogoutGroup(g)
		call TriggerAddCondition(t, Condition(function Q7O))
		set t = CreateTrigger()
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
		call TriggerAddCondition(t, Condition(function SVO))
	endif
	call CleanCurrentTrigger(GetTriggeringTrigger())
	set t = null
	set g = null
	set u = null
	return false
endfunction
// 修正视野 向友军玩家开放视野
function SOO takes unit U6E returns nothing
	local integer i = 0
	loop
	exitwhen(i == 16)
		if IsUnitAlly(U6E, Player(i)) then
			call UnitShareVision(U6E, Player(i), true)
		endif
		set i = i + 1
	endloop
endfunction
function SRO takes nothing returns nothing
	call SOO(GetEnumUnit())
endfunction
function SIO takes nothing returns nothing
	local integer x
	local group g
	set x = 1
	loop
	exitwhen x > 5
		call SetPlayerAlliance(Sentinels[0], Sentinels[x], ALLIANCE_SHARED_VISION, false)
		call SetPlayerAlliance(Scourges[0], Scourges[x], ALLIANCE_SHARED_VISION, false)
		set x = x + 1
	endloop
	set g = LoginGroup(64)
	call GroupEnumUnitsOfPlayer(g, Sentinels[0], TrueBoolexprCondition)
	call ForGroup(g, function SRO)
	call LogoutGroup(g)
	set g = LoginGroup(65)
	call GroupEnumUnitsOfPlayer(g, Scourges[0], TrueBoolexprCondition)
	call ForGroup(g, function SRO)
	call LogoutGroup(g)
	set g = null
endfunction
function SAO takes nothing returns nothing
	local integer x
	set x = 0
	loop
	exitwhen x > 5
		call SetPlayerAlliance(Sentinels[x], BW, ALLIANCE_PASSIVE, false)
		call SetPlayerAlliance(Sentinels[x], BW, ALLIANCE_HELP_REQUEST, false)
		call SetPlayerAlliance(Sentinels[x], BW, ALLIANCE_HELP_RESPONSE, false)
		call SetPlayerAlliance(Sentinels[x], BW, ALLIANCE_SHARED_XP, false)
		call SetPlayerAlliance(Sentinels[x], BW, ALLIANCE_SHARED_SPELLS, false)
		call SetPlayerAlliance(Sentinels[x], BW, ALLIANCE_SHARED_VISION, false)
		call SetPlayerAlliance(Sentinels[x], BW, ALLIANCE_SHARED_CONTROL, false)
		call SetPlayerAlliance(Sentinels[x], BW, ALLIANCE_SHARED_ADVANCED_CONTROL, false)
		call SetPlayerAlliance(Scourges[x], BW, ALLIANCE_PASSIVE, false)
		call SetPlayerAlliance(Scourges[x], BW, ALLIANCE_HELP_REQUEST, false)
		call SetPlayerAlliance(Scourges[x], BW, ALLIANCE_HELP_RESPONSE, false)
		call SetPlayerAlliance(Scourges[x], BW, ALLIANCE_SHARED_XP, false)
		call SetPlayerAlliance(Scourges[x], BW, ALLIANCE_SHARED_SPELLS, false)
		call SetPlayerAlliance(Scourges[x], BW, ALLIANCE_SHARED_VISION, false)
		call SetPlayerAlliance(Scourges[x], BW, ALLIANCE_SHARED_CONTROL, false)
		call SetPlayerAlliance(Scourges[x], BW, ALLIANCE_SHARED_ADVANCED_CONTROL, false)
		call SetPlayerAlliance(BW, Sentinels[x], ALLIANCE_PASSIVE, false)
		call SetPlayerAlliance(BW, Sentinels[x], ALLIANCE_HELP_REQUEST, false)
		call SetPlayerAlliance(BW, Sentinels[x], ALLIANCE_HELP_RESPONSE, false)
		call SetPlayerAlliance(BW, Sentinels[x], ALLIANCE_SHARED_XP, false)
		call SetPlayerAlliance(BW, Sentinels[x], ALLIANCE_SHARED_SPELLS, false)
		call SetPlayerAlliance(BW, Sentinels[x], ALLIANCE_SHARED_VISION, false)
		call SetPlayerAlliance(BW, Sentinels[x], ALLIANCE_SHARED_CONTROL, false)
		call SetPlayerAlliance(BW, Sentinels[x], ALLIANCE_SHARED_ADVANCED_CONTROL, false)
		call SetPlayerAlliance(BW, Scourges[x], ALLIANCE_PASSIVE, false)
		call SetPlayerAlliance(BW, Scourges[x], ALLIANCE_HELP_REQUEST, false)
		call SetPlayerAlliance(BW, Scourges[x], ALLIANCE_HELP_RESPONSE, false)
		call SetPlayerAlliance(BW, Scourges[x], ALLIANCE_SHARED_XP, false)
		call SetPlayerAlliance(BW, Scourges[x], ALLIANCE_SHARED_SPELLS, false)
		call SetPlayerAlliance(BW, Scourges[x], ALLIANCE_SHARED_VISION, false)
		call SetPlayerAlliance(BW, Scourges[x], ALLIANCE_SHARED_CONTROL, false)
		call SetPlayerAlliance(BW, Scourges[x], ALLIANCE_SHARED_ADVANCED_CONTROL, false)
		set x = x + 1
	endloop
endfunction
function SNO takes nothing returns boolean
	return LWO(GetTriggerUnit())
endfunction
function SBO takes nothing returns nothing
	call SOO(GetTriggerUnit())
endfunction
// 如果有ob 则会注册一些触发器
function SCO takes nothing returns nothing
	local trigger t = null
	call DestroyTrigger(GetTriggeringTrigger())
	if not MW then
		return
	endif
	call SIO()
	call SAO()
	set t = CreateTrigger()
	call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	call TriggerAddCondition(t, Condition(function SNO))
	call TriggerAddAction(t, function SBO)
	set t = null
endfunction
function SDO takes nothing returns boolean
	local integer WWV = 1
	local integer i
	local unit triggerUnit
	local integer SFO
	local integer SGO
	loop
	exitwhen WWV >$B
		set triggerUnit = Player__Hero[WWV]
		if triggerUnit != null and UnitAlive(triggerUnit) and GetUnitTypeId(triggerUnit)== PlayerHeroTypeId[WWV]and R5X(triggerUnit)== false then
			loop
				set i = GetRandomInt(1,'l')
			exitwhen(IsUnitIdType(VUV[i], UNIT_TYPE_MELEE_ATTACKER) and IsUnitIdType(PlayerHeroTypeId[WWV], UNIT_TYPE_MELEE_ATTACKER)) or(IsUnitIdType(VUV[i], UNIT_TYPE_RANGED_ATTACKER) and IsUnitIdType(PlayerHeroTypeId[WWV], UNIT_TYPE_RANGED_ATTACKER))
			endloop
			call SaveInteger(HY, GetHandleId(LoadTriggerHandle(HY, GetHandleId(triggerUnit),'0PAS')), 100, 1)
			call TriggerEvaluate(LoadTriggerHandle(HY, GetHandleId(triggerUnit),'0PAS'))
			set SFO = REX(PlayerHeroTypeId[WWV])
			set SGO = REX(VUV[i])
			call UnitAddAbility(triggerUnit, SFO)
			call UnitRemoveAbility(triggerUnit, SFO)
			call UnitAddAbility(triggerUnit, SGO + 1)
			call UnitRemoveAbility(triggerUnit, SGO + 1)
			set PlayerHeroTypeId[WWV]= VUV[i]
		endif
		set WWV = WWV + 1
	endloop
	set triggerUnit = null
	return false
endfunction
function SHO takes nothing returns nothing
	call UnitRemoveAbility(GetEnumUnit(),'A44F')
endfunction
function SJO takes nothing returns nothing
	local group g = LoginGroup(66)
	call GroupEnumUnitsInRange(g, 0, 0,$4650, TrueBoolexprCondition)
	call ForGroup(g, function SHO)
	call LogoutGroup(g)
	set g = null
endfunction
function SKO takes nothing returns nothing
	if bj_isSinglePlayer then
		call SetPlayerAlliance(Player(0), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(1), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(2), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(3), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(4), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(5), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(6), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(7), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(8), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(9), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(10), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player(11), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player($C), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player($D), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(Player($E), Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SetPlayerAlliance(NeutralPassivePlayer, Player(1), ALLIANCE_SHARED_CONTROL, true)
		call SJO()
		call ClearTextMessages()
	endif
endfunction
function ShowSkillsOnSelecting takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local player t = GetOwningPlayer(GetTriggerUnit())
	local integer i
	if p != t and JI[GetPlayerId(p)]and GetTriggerUnit()== Player__Hero[GetPlayerId(t)]and IsPlayerAlly(p, t) then
		set i = PlayerSkillIndex[GetPlayerId(t)* HL]
		call DisplayTimedTextToPlayer(p, 0, 0, 10, "|c00a0a0f8" + GetObjectName(HeroCommonSkills[i + 1])+ "|r level: |c00f8a0a0" + I2S(ZTE(GetTriggerUnit(), 1))+ "|r")
		call DisplayTimedTextToPlayer(p, 0, 0, 10, "|c00a0a0f8" + GetObjectName(HeroCommonSkills[i + 2])+ "|r level: |c00f8a0a0" + I2S(ZTE(GetTriggerUnit(), 2))+ "|r")
		call DisplayTimedTextToPlayer(p, 0, 0, 10, "|c00a0a0f8" + GetObjectName(HeroCommonSkills[i + 3])+ "|r level: |c00f8a0a0" + I2S(ZTE(GetTriggerUnit(), 3))+ "|r")
		call DisplayTimedTextToPlayer(p, 0, 0, 10, "|c00ff54f2" + GetObjectName(HeroCommonSkills[i + 4])+ "|r level: |c00f8a0a0" + I2S(ZTE(GetTriggerUnit(), 4))+ "|r")
		if ExtraAbilitiesNum  > 0 then
			call DisplayTimedTextToPlayer(p, 0, 0, 10, "|c00a0a0f8" + GetObjectName(HeroCommonSkills[i + 5])+ "|r level: |c00f8a0a0" + I2S(ZTE(GetTriggerUnit(), 5))+ "|r")
			if(HeroCommonSkills[PlayerSkillIndex[GetPlayerId(p)* HL + 6]]> 0) then
				call DisplayTimedTextToPlayer(p, 0, 0, 10, "|c00ff54f2" + GetObjectName(HeroCommonSkills[i + 6])+ "|r level: |c00f8a0a0" + I2S(ZTE(GetTriggerUnit(), 6))+ "|r")
			endif
		endif
	endif
	if GetUnitTypeId(GetTriggerUnit())!='hfoo' and IsUnitEnemy(GetTriggerUnit(), p) and UnitVisibleToPlayer(GetTriggerUnit(), p)== false then
		if GetObjectName('TEST')== "L1ch" then
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, "|c00ff0303可能的开图点击|r " + JS[GetPlayerId(p)]+ VMV[GetPlayerId(p)]+ "|r on " + GetUnitName(GetTriggerUnit()))
		endif
	endif
endfunction
function SLO takes nothing returns nothing
	call UnitRemoveAbility(GetChangingUnit(),'A44F')
endfunction
function SMO takes nothing returns nothing
	local integer i
	local integer T0V
	local integer TTV
	local player p
	local integer k = 1
	local integer te = 0
	loop
		set p = Player(k)
		set i = k
		if FP[i]== false and GetPlayerController(p)== MAP_CONTROL_USER and GetPlayerSlotState(p)== PLAYER_SLOT_STATE_PLAYING then
			loop
			exitwhen FP[i]
				if MainModeName =="sd" or MainModeName =="md" then
					loop
						set TTV = UIE(GetRandomInt(1, GL))
					exitwhen(DP[i * GL + TTV]and ZQ[TTV]== false)
					endloop
					set T0V =(TTV * 4)-4
					set T0V = T0V + GetRandomInt(1, 4)
					call SaveInteger(HY,'0REA','0PID', i)
					call SaveInteger(HY,'0REA','0SID', T0V)
					call SaveBoolean(HY,'0REA','000B', false)
					call ExecuteFunc("SPO")
				else
					loop
						set T0V =(GetRandomInt(1, GL * 4))
						set te = UIE((T0V + 3)/ 4)
					exitwhen ZQ[te]== false
					endloop
					call SaveInteger(HY,'0REA','0PID', i)
					call SaveInteger(HY,'0REA','0SID', T0V)
					call SaveBoolean(HY,'0REA','000B', false)
					call ExecuteFunc("SPO")
				endif
			endloop
		endif
		set k = k + 1
		if k == 6 then
			set k = 7
		endif
	exitwhen k >$B
	endloop
	call ExecuteFunc("SQO")
endfunction
function SSO takes nothing returns nothing
	call UnitAddPermanentAbility(GetEnumUnit(), WC)
	if MC == 1. then
		call SetPlayerAbilityAvailable(GetOwningPlayer(GetEnumUnit()), WC, false)
		set MC = .0
	endif
	if GetUnitAbilityLevel(GetEnumUnit(), WC)== 0 then
		call AddUnitToStock(GetEnumUnit(), WC, 1, 1)
		// debug call SingleDebug(UGV(WC)+ " (" + GetObjectName(WC)+ ") added")
	endif
endfunction
function STO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 99999)
	local group g
	if bj_isSinglePlayer then
		set WC = UDV(SUO)
		set MC = .0
		call XSX(WC)
		if SubString(SUO, 0, 2)== "QU" then
			set MC = 1.
		endif
		set g = LoginGroup(67)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function SSO)
		call LogoutGroup(g)
	endif
	set g = null
endfunction
function SWO takes nothing returns nothing
	call UnitRemoveAbility(GetEnumUnit(), WC)
endfunction
function SYO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 99999)
	local group g
	if bj_isSinglePlayer then
		set WC = UDV(SUO)
		set g = LoginGroup(68)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		if FirstOfGroup(g)== null then
			call GroupAddUnit(g, Player__Hero[GetPlayerId(GetTriggerPlayer())])
		endif
		call ForGroup(g, function SWO)
		call LogoutGroup(g)
	endif
	set g = null
endfunction
function SZO takes nothing returns nothing
	call BJDebugMsg(GetObjectName(GetUnitTypeId(GetEnumUnit()))+ "'s lvl of " + UGV(WC)+ " is " + I2S(GetUnitAbilityLevel(GetEnumUnit(), WC)))
endfunction
function S_O takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 99999)
	local group g
	if bj_isSinglePlayer then
		set WC = UDV(SUO)
		set g = LoginGroup(69)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function SZO)
		call LogoutGroup(g)
	endif
	set g = null
endfunction
function S0O takes nothing returns nothing
	call SetPlayerAbilityAvailable(GetOwningPlayer(GetEnumUnit()), WC, false)
endfunction
function S1O takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 99999)
	local group g
	if bj_isSinglePlayer then
		set WC = UDV(SUO)
		set g = LoginGroup(70)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function S0O)
		call LogoutGroup(g)
	endif
	set g = null
endfunction
function S2O takes nothing returns nothing
	local item it = UnitAddItemById(GetEnumUnit(), WC)
	call SetItemPlayer(it, GetOwningPlayer(GetEnumUnit()), false)
	set it = null
endfunction
function S3O takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 99999)
	local group g
	if bj_isSinglePlayer then
		set WC = UDV(SUO)
		set g = LoginGroup(71)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function S2O)
		call LogoutGroup(g)
	endif
	set g = null
endfunction
function S4O takes nothing returns nothing
	call SetUnitOwner(GetEnumUnit(), Player(WC), true)
	if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
		set Player__Hero[WC]= GetEnumUnit()
	endif
endfunction
function S5O takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 3, 5)
	local group g
	if bj_isSinglePlayer then
		set WC = S2I(SUO)
		if WC < 0 or WC >$F then
			return
		endif
		set g = LoginGroup(72)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function S4O)
		call LogoutGroup(g)
	endif
	set g = null
endfunction
function S6OCD takes nothing returns nothing
	local player p = GetTriggerPlayer()
	call ShowAbilityCd_Actions(p, false)
	call Click_CheckBox_Nothing(p, 2)
endfunction
function S6O takes nothing returns nothing
	local player p = GetTriggerPlayer()
	call Q_X(p, false)
	call Click_CheckBox_Nothing(p, 1)
endfunction
function LZSB takes nothing returns nothing
	local player p = GetTriggerPlayer()
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, GetPlayerName(p)+ " 已开启了隐藏作弊码")
endfunction
function JUHUABUniubi takes nothing returns nothing
	set ShouSiJuHuaB = true
	call DestroyTimer(GetExpiredTimer())
endfunction
function JUHUANIUBI takes nothing returns nothing
	local timer t
	if ShouSiJuHuaB then
		set ShouSiJuHuaB = false
		call PlaySoundBJ(ShouSiJuHua)
		set t = CreateTimer()
		call TimerStart(t, 80.00, false, function JUHUABUniubi)
	endif
	set t = null
endfunction
function WOJIUPAO takes nothing returns nothing
	set JUHUABIEPAOB = true
	call DestroyTimer(GetExpiredTimer())
endfunction
function JUHUAZHANZU takes nothing returns nothing
	local timer t
	if JUHUABIEPAOB then
		set JUHUABIEPAOB = false
		call PlaySoundBJ(JUHUABIEPAO)
		set t = CreateTimer()
		call TimerStart(t, 80.00, false, function WOJIUPAO)
	endif
	set t = null
endfunction
function WOZAODEZHU takes nothing returns nothing
	set SHUIZAODEZHUAB = true
	call DestroyTimer(GetExpiredTimer())
endfunction
function ZHESHUIZAODEZHUA takes nothing returns nothing
	local timer t
	if SHUIZAODEZHUAB then
		set SHUIZAODEZHUAB = false
		call PlaySoundBJ(SHUIZAODEZHUA)
		set t = CreateTimer()
		call TimerStart(t, 80.00, false, function WOZAODEZHU)
	endif
	set t = null
endfunction
function BEJUHUACHILE takes nothing returns nothing
	set WEIGOUCHILEB = true
	call DestroyTimer(GetExpiredTimer())
endfunction
function GENGXINGRIZHI takes nothing returns nothing
	local timer t
	if WEIGOUCHILEB then
		set WEIGOUCHILEB = false
		call PlaySoundBJ(WEIGOUCHILE)
		set t = CreateTimer()
		call TimerStart(t, 80.00, false, function BEJUHUACHILE)
	endif
	set t = null
	if GetTriggerPlayer() == LocalPlayer and not IsReplayMode then
		set UpdateLogIsShow = true
		call DzFrameShow(UIFrame__UpdateLog, true)
	endif
endfunction

function BUJIN takes nothing returns nothing
	local player p = GetTriggerPlayer()
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, "不禁，再问自杀")
endfunction
function S7O takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 18, 19)
	local integer i = S2I(SUO)
	if i > 0 and i < 7 then
		if UnitItemInSlot(Player__Hero[GetPlayerId(GetTriggerPlayer())], i -1)!= null and UUV(UnitItemInSlot(Player__Hero[GetPlayerId(GetTriggerPlayer())], i -1))< 0 or GetItemTypeId(UnitItemInSlot(Player__Hero[GetPlayerId(GetTriggerPlayer())], i -1)) == 0 then
			call UnitRemoveItemFromSlot(Player__Hero[GetPlayerId(GetTriggerPlayer())], i -1)
		else
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "该物品不属于Bug")
		endif
	endif
endfunction
function S8O takes nothing returns nothing
	call SetUnitMoveSpeed(GetEnumUnit(),(MC))
endfunction
function S9O takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 7, 999)
	local group g
	if bj_isSinglePlayer then
		set MC = S2R(SUO)
		set g = LoginGroup(73)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function S8O)
		call LogoutGroup(g)
	endif
	set g = null
endfunction
function TVO takes nothing returns nothing
	if IsItemPawnable(UnitItemInSlot(GetEnumUnit(), WC)) then
		call BJDebugMsg("pawn")
	else
		call BJDebugMsg("unpawn")
	endif
endfunction
function TEO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 999)
	local group g
	if bj_isSinglePlayer then
		set WC = S2I(SUO)
		set g = LoginGroup(74)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function TVO)
		call LogoutGroup(g)
	endif
	set g = null
endfunction
function TXO takes nothing returns nothing
	call UnitAddType(GetEnumUnit(), ConvertUnitType(WC))
	if IsUnitType(GetEnumUnit(), ConvertUnitType(WC)) then
		call BJDebugMsg("added")
	endif
endfunction
function TOO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 999)
	local group g
	if bj_isSinglePlayer then
		set WC = S2I(SUO)
		set g = LoginGroup(75)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function TXO)
		call LogoutGroup(g)
	endif
	set g = null
endfunction
function TRO takes nothing returns nothing
	local string s = SubString(GetEventPlayerChatString(), 6, 999)
	local group g
	local integer i = S2I(s)
	local boolean b = false
	local unit u
	if I2S(i)!= s then
		set b = true
	endif
	set g = LoginGroup(76)
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if b then
			call SetUnitAnimation(u, s)
		else
			call SetUnitAnimationByIndex(u, i)
		endif
		call GroupRemoveUnit(g, u)
	endloop
	call LogoutGroup(g)
	set g = null
endfunction
function TIO takes nothing returns nothing
	call SetWidgetLife(GetEnumUnit(), WC)
endfunction
function TAO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 999)
	local group g
	local integer i = S2I(SUO)
	if bj_isSinglePlayer then
		set WC = S2I(SUO)
		set g = LoginGroup(77)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function TIO)
		call LogoutGroup(g)
	endif
	set g = null
endfunction
function TNO takes nothing returns nothing
	// debug call SingleDebug(R2S(GetWidgetLife(GetEnumUnit())))
endfunction
function TBO takes nothing returns nothing
	local group g
	if bj_isSinglePlayer then
		set g = LoginGroup(78)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function TNO)
		call LogoutGroup(g)
	endif
	set g = null
endfunction
function TCO takes nothing returns nothing
	call KillUnit(GetEnumUnit())
endfunction
function TDO takes nothing returns nothing
	local group g
	if bj_isSinglePlayer then
		set g = LoginGroup(79)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function TCO)
		call LogoutGroup(g)
	endif
	set g = null
endfunction
function TFO takes nothing returns nothing
	call SetUnitState(GetEnumUnit(), UNIT_STATE_MANA, WC)
endfunction
function TGO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 999)
	local group g
	local integer i = S2I(SUO)
	if bj_isSinglePlayer then
		set WC = S2I(SUO)
		set g = LoginGroup(80)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function TFO)
		call LogoutGroup(g)
	endif
	set g = null
endfunction
function THO takes nothing returns nothing
	call CreateItem(WC, GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()))
endfunction
function TJO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 4, 9)
	local group g
	local integer i = S2I(SUO)
	if bj_isSinglePlayer then
		set WC = UDV(SUO)
		set g = LoginGroup(81)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function THO)
		call LogoutGroup(g)
	endif
	set g = null
endfunction
function TKO takes nothing returns nothing
	call BJDebugMsg(R2S(GetUnitX(GetEnumUnit()))+ " " + R2S(GetUnitY(GetEnumUnit())))
endfunction
function TLO takes nothing returns nothing
	local group g
	if bj_isSinglePlayer then
		set g = LoginGroup(82)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function TKO)
		call LogoutGroup(g)
	endif
	set g = null
endfunction
function TMO takes nothing returns nothing
	local real r = S2R(SubString(GetEventPlayerChatString(), 5, 15))
	call SetCameraFieldForPlayer(GetTriggerPlayer(), CAMERA_FIELD_FARZ,$5F5E100, 0)
	if r <= 0 then
		call SetCameraFieldForPlayer(GetTriggerPlayer(), CAMERA_FIELD_TARGET_DISTANCE,$672, 0)
		call SaveReal(K, GetHandleId(GetTriggerPlayer()),'CAMD',$672)
		call InterfaceErrorForPlayer(GetTriggerPlayer(), "不正确的参数，镜头调整至默认值。")
	elseif r > 0 and r < 3 then
		call SetCameraFieldForPlayer(GetTriggerPlayer(), CAMERA_FIELD_TARGET_DISTANCE,$672* r, 0)
		call SaveReal(K, GetHandleId(GetTriggerPlayer()),'CAMD',$672* r)
	elseif r >= 600 and r <= 4500 then
		call SetCameraFieldForPlayer(GetTriggerPlayer(), CAMERA_FIELD_TARGET_DISTANCE, r, 0)
		call SaveReal(K, GetHandleId(GetTriggerPlayer()),'CAMD', r)
	else
		call InterfaceErrorForPlayer(GetTriggerPlayer(), "参数不能低于600或高于4500。")
	endif
endfunction
function TPO takes nothing returns nothing
	call RemoveUnit(GetEnumUnit())
endfunction
function TQO takes nothing returns nothing
	local group g
	if bj_isSinglePlayer then
		set g = LoginGroup(83)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
		call ForGroup(g, function TPO)
		call LogoutGroup(g)
	endif
	set g = null
endfunction

// 投降
function TSO takes nothing returns nothing
	local integer i = 1
	local integer k = 5
	local integer TTO = 0
	local integer TME = GetPlayerId(GetTriggerPlayer())
	if FA[TME]== false then
		if TME > 6 then
			set k =$B
			set i = 7
		endif
		loop
			if FA[i]then
				set TTO = TTO + 1
			endif
			set i = i + 1
		exitwhen i > k
		endloop
		if TTO == 4 then
			call UOV()
			if TME < 7 then
				call KillUnit(SentinelsBuilding_TheWorldTree)
			else
				call KillUnit(T7)
			endif
		endif
		set FA[TME]= true
	endif
endfunction
function TUO takes nothing returns nothing
	local integer TME = GetPlayerId(GetTriggerPlayer())
	local unit u = Player__Hero[TME]
	if(u != null and UnitAlive(u)) then
		if GetUnitAbilityLevel(u,'A0KW')> 0 then
			call SetPlayerAbilityAvailable(Player(TME),'A0KW', XA[TME])
			call SetPlayerAbilityAvailable(Player(TME),'A0KX', XA[TME])
			set XA[TME]= not XA[TME]
		else
			call InterfaceErrorForPlayer(GetTriggerPlayer(), "你没有属性转换")
		endif
	else
		call InterfaceErrorForPlayer(GetTriggerPlayer(), "你没有英雄")
	endif
	set u = null
endfunction
function TWO takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer i = 1
	if IsScourgesPlayer(p) then
		set i = 7
	endif
	call SetPlayerAlliance(Player(i + 0), p, ALLIANCE_SHARED_ADVANCED_CONTROL, not GetPlayerAlliance(Player(i + 0), p, ALLIANCE_SHARED_ADVANCED_CONTROL))
	call SetPlayerAlliance(Player(i + 1), p, ALLIANCE_SHARED_ADVANCED_CONTROL, not GetPlayerAlliance(Player(i + 1), p, ALLIANCE_SHARED_ADVANCED_CONTROL))
	call SetPlayerAlliance(Player(i + 2), p, ALLIANCE_SHARED_ADVANCED_CONTROL, not GetPlayerAlliance(Player(i + 2), p, ALLIANCE_SHARED_ADVANCED_CONTROL))
	call SetPlayerAlliance(Player(i + 3), p, ALLIANCE_SHARED_ADVANCED_CONTROL, not GetPlayerAlliance(Player(i + 3), p, ALLIANCE_SHARED_ADVANCED_CONTROL))
	call SetPlayerAlliance(Player(i + 4), p, ALLIANCE_SHARED_ADVANCED_CONTROL, not GetPlayerAlliance(Player(i + 4), p, ALLIANCE_SHARED_ADVANCED_CONTROL))
endfunction
function TYO takes nothing returns nothing
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "你的资产为 " + I2S(RI[GetPlayerId(GetTriggerPlayer())]))
endfunction
function TZO takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local boolean b = LoadBoolean(K, GetHandleId(p),'UIds')
	call Click_CheckBox_Nothing(p, 18)
	if LocalPlayer == p then
		call GetSetUpText("信使复活窗口", b)
	endif
	call SaveBoolean(K, GetHandleId(p),'UIds', not b)
endfunction
function T_O takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer TME = GetPlayerId(p)
	call Click_CheckBox_Nothing(p, 17)
	if LocalPlayer == p then
		call GetSetUpText("快速清理", CR[TME]== 10.)
	endif
	if CR[TME]== 1. then
		//call DisplayTimedTextToPlayer(p, 0, 0, 3, "|c00aeae00 快速清理关闭|r - 所有死亡信息持续显示10秒.")
		set CR[TME]= 10.
	else
		//call DisplayTimedTextToPlayer(p, 0, 0, 3, "|c00fcfa00 快速清理开启|r - 所有死亡信息持续显示1秒.")
		set CR[TME]= 1.
	endif
endfunction
function T0O takes nothing returns nothing
	call SaveBoolean(K, GetHandleId(GetTriggerPlayer()),'NSHK', true)
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "|c00aeae00 无相同热键|r 模式关闭 - 你可以选择任意热键冲突的技能")
endfunction
function T1O takes nothing returns nothing
	local group g = LoginGroup(84)
	local unit u
	local integer i = 0
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		// debug call SingleDebug(UGV(GetUnitTypeId(u)))
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call LogoutGroup(g)
	set g = null
endfunction
function SetCharges takes player p returns nothing
	local boolean b = LoadBoolean(K, GetHandleId(p),'OptC')
	call SaveBoolean(K, GetHandleId(p),'OptC', not b)
	if LocalPlayer == p then
		call GetSetUpText("充能显示", b)
	endif
endfunction
function T2O takes nothing returns nothing
	local player p = GetTriggerPlayer()
	call SetCharges(p)
	call Click_CheckBox_Nothing(p, 3)
endfunction

function SetUpDoubleClickSpell takes nothing returns nothing
	local player p = GetTriggerPlayer()
	if LocalPlayer == p then
		set IsEnableDoubleClickSystem = not IsEnableDoubleClickSystem
		call GetSetUpText("双击对己施法", IsEnableDoubleClickSystem)
	endif
	call Click_CheckBox_Nothing(p, 16)
endfunction

function SetUpDoubleClickSpellByCheckBox takes boolean enable returns nothing
	set IsEnableDoubleClickSystem = enable
	call GetSetUpText("双击对己施法", IsEnableDoubleClickSystem)
endfunction

function T3O takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer TME = GetPlayerId(p)
	set ZR[TME]= not ZR[TME]
	call Click_CheckBox_Nothing(p, 14)
	if LocalPlayer == p then
		call GetSetUpText("震动视角", ZR[TME])
	endif
endfunction
function T4O takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer TME = GetPlayerId(p)
	if LocalPlayer == p then
		call GetSetUpText("自动装置神符", XI[TME])
	endif
	set XI[TME]= not XI[TME]
	call Click_CheckBox_Nothing(p, 8)
	//if XI[TME] then
	//	call DisplayTimedTextToPlayer(p, 0, 0, 5, "右键点击|cffff0000神符|r时|c0000FF00不会|r把神符装入瓶中")
	//else
	//	call DisplayTimedTextToPlayer(p, 0, 0, 5, "右键点击|cffff0000神符|r时|c0000FF00将会|r把神符装入瓶中")
	//endif

endfunction
function T5O takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer TME = GetPlayerId(p)
	set JI[TME]= not JI[TME]
	if LocalPlayer == p then
		call GetSetUpText("技能可见", JI[TME])
	endif
endfunction
function T6O takes nothing returns nothing
	local player p = GetTriggerPlayer()
	if GetEventPlayerChatString()== "-sddon" then
		//call DisplayTimedTextToPlayer(p, .0, .0, 10., "|cffff0000[SDD] |r" + "|c006699CC" + "显示伤害值已 |c0000FF00开启|r" + "|c006699CC" + "." + "|r")
		set EnableMapSetUp__ShowDamageTextTag[GetPlayerId(p)]= true
		call Set_CheckBox_Nothing(p, 15, true)
	else
		//call DisplayTimedTextToPlayer(p, .0, .0, 10., "|cffff0000[SDD] |r" + "|c006699CC" + "显示伤害值已 |c0000FF00关闭|r" + "|c006699CC" + "." + "|r")
		set EnableMapSetUp__ShowDamageTextTag[GetPlayerId(p)] = false
		call Set_CheckBox_Nothing(p, 15, false)
	endif
	if LocalPlayer == p then
		call GetSetUpText("显示伤害值", EnableMapSetUp__ShowDamageTextTag[GetPlayerId(p)])
	endif
endfunction
function T7O takes nothing returns nothing
	local integer TME = GetPlayerId(GetTriggerPlayer())
	if GetUnitAbilityLevel(Player__Hero[TME],'A0AK')> 0 or GetUnitAbilityLevel(Player__Hero[TME],'A1FY')> 0 then
		if GetUnitAbilityLevel(Player__Hero[TME],'A1WF')== 0 then
			call UnitAddPermanentAbility(Player__Hero[TME],'A1WF')
		else
			call UnitRemoveAbility(Player__Hero[TME],'A1WF')
		endif
	endif
endfunction
function T8O takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local boolean CD = LoadBoolean(P, GetHandleId(p), 4)
	if CD then
		call DisplayTimedTextToPlayer(p, .0, .0, 10., "被动技能内置冷却时间显示已 |c00FF0000关闭|r")
		call SaveBoolean(P, GetHandleId(p), 4, false)
	else
		call DisplayTimedTextToPlayer(p, .0, .0, 10., "被动技能内置冷却时间显示已 |c00FF0000开启|r")
		call SaveBoolean(P, GetHandleId(p), 4, true)
	endif

endfunction
function T9O takes nothing returns nothing
	if Mode__FastFinish then
		call YYE(GetPlayerId(GetTriggerPlayer()), false)
	endif
endfunction
function UVO takes nothing returns nothing
	if Mode__FastFinish then
		call Y0E(GetTriggerPlayer())
	endif
endfunction
function XCO takes nothing returns nothing
	local integer i = R2I(TimerGetRemaining(NK))
	call TimerStart(NK, i + 45, false, function SMO)
endfunction
function UEO takes player p returns nothing
	local integer UXO
	local integer ZKE
	local integer i
	local integer te
	if InHeroSelection then
		if GetGameTime()> JN[GetPlayerId(p)]then
			if GS == false then
				call DisplayTimedTextToPlayer(p, .0, .0, 10., "|cff99ccff" + "你现在还不能使用这个命令." + "|r")
			else
				if FP[GetPlayerId(p)]then
					call DisplayTimedTextToPlayer(p, .0, .0, 10., "|cff99ccff" + "你已经将你的所有技能选择完毕." + "|r")
				else
					set JN[GetPlayerId(p)]= GetGameTime()+ 4
					set i = GetPlayerId(p)
					loop
					exitwhen FP[i]
						if MainModeName =="sd" or MainModeName =="md" then
							loop
								set UXO = UIE(GetRandomInt(1, GL))
							exitwhen(DP[i * GL + UXO]and ZQ[UXO]== false)
							endloop
							set ZKE =(UXO * 4)-4
							set ZKE = ZKE + GetRandomInt(1, 4)
							call SaveInteger(HY,'0REA','0PID', i)
							call SaveInteger(HY,'0REA','0SID', ZKE)
							call SaveBoolean(HY,'0REA','000B', false)
							call ExecuteFunc("SPO")
						else
							loop
								set ZKE =(GetRandomInt(1, GL * 4))
								set te = UIE((ZKE + 3)/ 4)
							exitwhen(ZQ[te]== false and GetPlayerTechMaxAllowed(p, VUV[te])> 0)
							endloop
							call SaveInteger(HY,'0REA','0PID', i)
							call SaveInteger(HY,'0REA','0SID', ZKE)
							call SaveBoolean(HY,'0REA','000B', false)
							call ExecuteFunc("SPO")
						endif
					endloop
					call DisplayTimedTextToPlayer(p, .0, .0, 10., "|cff99ccff" + "你现在准备好了，你剩下的技能将随机选择." + "|r")
					call ExecuteFunc("SQO")
				endif
			endif
		else
			call DisplayTimedTextToPlayer(p, .0, .0, 10., "|cff99ccff这条命令你使用得太频繁了，请稍后。|r")
		endif
	endif
endfunction
function UOO takes nothing returns nothing
	call UEO(GetTriggerPlayer())
endfunction
function XGO takes nothing returns nothing
	call UEO(E3)
endfunction
function URO takes nothing returns nothing
	if false then
		if HK == false then
			set HK = true
			set QK = CreateTrigger()
			call TriggerRegisterTimerEvent(QK, 2, true)
			call TriggerAddCondition(QK, Condition(function SDO))
		else
			call CleanCurrentTrigger(QK)
		endif
	endif
endfunction
function UIO takes nothing returns nothing
	if not InHeroSelection and MainModeName != "md" then
		call ExecuteFunc("UAO")
	endif
endfunction
function UNO takes nothing returns nothing
	if not InHeroSelection then
		call ExecuteFunc("UBO")
	endif
endfunction
function UCO takes nothing returns nothing
	if B3 and CV then
		call ExecuteFunc("TSO")
	endif
endfunction
function UDO takes nothing returns nothing
	call SetUnitAbilityLevel(GetEnumUnit(), WC, Q2)
endfunction
function UFO takes nothing returns nothing
	local string id = SubString(GetEventPlayerChatString(), 4, 8)
	local integer level = S2I(SubString(GetEventPlayerChatString(), 9, 11))
	local group g
	set WC = UDV(id)
	set Q2 = level
	set g = LoginGroup(85)
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	call ForGroup(g, function UDO)
	call LogoutGroup(g)
	set g = null
endfunction
function UGO takes nothing returns nothing
	local integer id = UDV(SubString(GetEventPlayerChatString(), 4, 8))
	if id > 0 then
		set X3 = true
		call CreateUnit(BW, id,-510,-512, 0)
		set X3 = false
	endif
endfunction
function UHO takes nothing returns nothing
	call CommonUnitAddStun(GetEnumUnit(), 1, false)
endfunction
function UJO takes nothing returns nothing
	local group g
	set g = LoginGroup(86)
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	call ForGroup(g, function UHO)
	call LogoutGroup(g)
	set g = null
endfunction
function UKO takes nothing returns nothing
	call SetHeroAgi(GetEnumUnit(),'{', false)
endfunction
function ULO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 7, 10)
	local integer i = S2I(SUO)
	local string UMO = SubString(GetEventPlayerChatString(), 11, 15)
	local integer i2 = S2I(UMO)
	local group g
	set WC = i
	set Q2 = i2
	set g = LoginGroup(87)
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	call ForGroup(g, function UKO)
	call LogoutGroup(g)
	set g = null
endfunction
function UPO takes nothing returns nothing
	call EXUnitResetCooldown(GetEnumUnit())
	call SetWidgetLife(GetEnumUnit(), 99999999)
	call SetUnitState(GetEnumUnit(), UNIT_STATE_MANA, 99999999)
	call TimerStart(ESV[GetPlayerId(GetOwningPlayer(GetEnumUnit()))], 0, false, null)
	call TimerStart(ETV[GetPlayerId(GetOwningPlayer(GetEnumUnit()))], 0, false, null)
endfunction
function UQO takes nothing returns nothing
	local group g
	set g = LoginGroup(88)
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	call ForGroup(g, function UPO)
	call LogoutGroup(g)
	set g = null
endfunction
function USO takes nothing returns nothing
	if IssueTargetOrderById(GetEnumUnit(), WC, GetEnumUnit()) then
		// debug call SingleDebug(I2S(WC)+ " is target skill")
	elseif IssueImmediateOrderById(GetEnumUnit(), WC) then
		// debug call SingleDebug(I2S(WC)+ " is immediate skill")
	elseif IssuePointOrderById(GetEnumUnit(), WC, 0, 0) then
		// debug call SingleDebug(I2S(WC)+ " is point skill")
	endif
endfunction
function UTO takes nothing returns nothing
	local group g
	set WC = S2I(SubString(GetEventPlayerChatString(), 4, 19))
	// debug call SingleDebug("Started " + I2S(WC))
	set g = LoginGroup(89)
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	call ForGroup(g, function USO)
	call LogoutGroup(g)
	set g = null
endfunction
function UUO takes nothing returns nothing
	call SelectUnit(Player__Hero[1], false)
endfunction
function TestTimer takes nothing returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .005, true, function UUO)
endfunction
function UWO takes nothing returns nothing
	local group g = LoginGroup(90)
	local unit u
	local integer i = 0
	local integer k
	local real x
	local real y
	local boolean array b
	call GroupEnumUnitsOfPlayer(g, GetTriggerPlayer(), TrueBoolexprCondition)
	// debug call SingleDebug(I2S(StringHash("GoodGay")))
	call CreateUnit(Player(10),'e00E', 1388.5,-5038.25, 0)
	set i = 0
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call LogoutGroup(g)
	set g = null
endfunction
function UYO takes nothing returns nothing
	local group g = LoginGroup(91)
	local unit u
	local integer i = 0
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		call UnitAddPermanentAbility(u,'A44P')
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call LogoutGroup(g)
endfunction
function UZO takes string s returns nothing
	local string sr = ""
	local string sg = ""
	local string sb = ""
	local string sa = ""
	local integer i = 0
	local integer k = StringLength(s)
	local integer U_O = 1
	loop
		if SubString(s, i, i + 1)== " "then
			set U_O = U_O + 1
		else
			if U_O == 1 then
				set sr = sr + SubString(s, i, i + 1)
			elseif U_O == 2 then
				set sg = sg + SubString(s, i, i + 1)
			elseif U_O == 3 then
				set sb = sb + SubString(s, i, i + 1)
			else
				set sa = sa + SubString(s, i, i + 1)
			endif
		endif
		set i = i + 1
	exitwhen i > k
	endloop
	set XK[0]= S2I(sr)
	set XK[1]= S2I(sg)
	set XK[2]= S2I(sb)
	set Q2 = S2I(sa)
endfunction
function U0O takes nothing returns nothing
	local integer r
	local integer g
	local integer b
	local integer a
	local string s = SubString(GetEventPlayerChatString(), 7, StringLength(GetEventPlayerChatString()))
	local unit u
	local group gg = LoginGroup(92)
	call UZO(s)
	set r = XK[0]
	set g = XK[1]
	set b = XK[2]
	set a = Q2
	call GroupEnumUnitsSelected(gg, GetTriggerPlayer(), null)
	loop
		set u = FirstOfGroup(gg)
	exitwhen u == null
		call SetUnitVertexColor(u, r, g, b, a)
		call GroupRemoveUnit(gg, u)
	endloop
	call LogoutGroup(gg)
endfunction
function U1O takes string s returns string
	local integer i = 0
	local integer k = StringLength(s)
	local string ss = ""
	local string s3
	loop
		set s3 = SubString(s, i, i + 1)
		if s3 != " " then
			set ss = ss + s3
		else
			return ss
		endif
		set i = i + 1
	exitwhen i + 1 > k
	endloop
	return ss
endfunction
function U2O takes nothing returns nothing
	local string EZX = SubString(GetEventPlayerChatString(), 4, 99)
	local group g = LoginGroup(93)
	local unit u
	// debug call SingleDebug("PATH: [" + EZX + "]")
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		call AddSpecialEffect(EZX, GetUnitX(u), GetUnitY(u))
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call LogoutGroup(g)
endfunction
function U3O takes nothing returns nothing
	local string s = SubString(GetEventPlayerChatString(), 4, 99)
	local string U4O = U1O(s)
	local string EZX = SubString(s, StringLength(U4O)+ 1, 99)
	local group g = LoginGroup(94)
	local unit u
	// debug call SingleDebug("ATTACH: [" + U4O + "]; PATH: [" + EZX + "]")
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		call AddSpecialEffectTarget(EZX, u, U4O)
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call LogoutGroup(g)
endfunction
function U5O takes string s returns nothing
	local string U6O = ""
	local string U7O = ""
	local integer i = 0
	local integer U8O = StringLength(s)
	local integer k = 1
	loop
	exitwhen i > U8O
		if SubString(s, i, i + 1)== " "then
			set k = k + 1
		else
			if k == 1 then
				set U6O = U6O + SubString(s, i, i + 1)
			else
				set U7O = U7O + SubString(s, i, i + 1)
			endif
		endif
		set i = i + 1
	endloop
	set MC = S2R(U6O)
	set ER = S2R(U7O)
endfunction
function U9O takes nothing returns nothing
	local group g = LoginGroup(95)
	local unit u
	local string s = GetEventPlayerChatString()
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	call U5O(SubString(s, 5, 999))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if IsUnitType(u, UNIT_TYPE_STRUCTURE)== false then
			call SetUnitX(u, MC)
			call SetUnitY(u, ER)
		else
			call SetUnitPosition(u, MC, ER)
		endif
		call GroupRemoveUnit(g, u)
	endloop
	call LogoutGroup(g)
endfunction
function WVO takes nothing returns nothing
	local group g = LoginGroup(96)
	local unit u
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call SetUnitPathing(u, false)
		call GroupRemoveUnit(g, u)
	endloop
	call LogoutGroup(g)
endfunction
function WEO takes nothing returns nothing
	local group g = LoginGroup(97)
	local unit u
	local integer i = 0
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		call UnitAddBreakToTimed(u, 9)
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call LogoutGroup(g)
endfunction
function WXO takes nothing returns nothing
	local group g = LoginGroup(98)
	local unit u
	local integer i = 0
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		call SetUnitPathing(u, true)
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call LogoutGroup(g)
endfunction
function WOO takes nothing returns nothing
	local group g = LoginGroup(99)
	local unit u
	local integer i = 0
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		call SetUnitPathing(u, false)
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call LogoutGroup(g)
endfunction
function WRO takes nothing returns nothing
	local group g = LoginGroup(100)
	local unit u
	local integer i = 0
	local integer k = 0
	local string s = SubString(GetEventPlayerChatString(), 7, StringLength(GetEventPlayerChatString()))
	set i = IMinBJ(S2I(s), 36)
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	if i > 0 then
		loop
		exitwhen u == null
			set k = 0
			loop
			exitwhen k == i
				set k = k + 1
				call NHX(CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u)+ GetRandomReal(50, 300)* Cos(GetRandomReal(0, 6.14)), GetUnitY(u)+ GetRandomReal(50, 300)* Sin(GetRandomReal(0, 6.14)), 0), u,'h0CR', "WIO",$BB8, false)
			endloop
			call GroupRemoveUnit(g, u)
			set u = FirstOfGroup(g)
		endloop
	endif
	call LogoutGroup(g)
endfunction
function WAO takes nothing returns nothing
	local group g = LoginGroup(101)
	local unit u
	local integer i = 0
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		// debug call SingleDebug(UNV(IsTerrainPathable(GetUnitX(u), GetUnitY(u), PATHING_TYPE_WALKABILITY)== false))
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call LogoutGroup(g)
	set g = null
endfunction
function WNO takes nothing returns nothing
	local string SUO = SubString(GetEventPlayerChatString(), 7, 99999)
	local real WBO = S2R(SUO)
	local group g = LoginGroup(102)
	local unit u
	if WBO <= 0 then
		set WBO = 1
	endif
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), null)
	set u = FirstOfGroup(g)
	loop
	exitwhen u == null
		call SetUnitScale(u, WBO, 0, 0)
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
endfunction

// 获取当前选择的单位的所有技能
function EXGetUnitAllAbilityId takes nothing returns nothing
	local unit whichUnit = GetPlayerSelectedUnit()
	local integer abilityId = 0
	local integer loop__Index = 0

	call SingleDebug( "检查单位" + GetUnitName(whichUnit) + "的技能" )
	
	loop
		set abilityId = EXGetAbilityId( EXGetUnitAbilityByIndex( whichUnit, loop__Index ) )
		exitwhen abilityId == 0

		call SingleDebug( I2S( loop__Index ) + " 号技能为 " + GetObjectName(abilityId) + " " + YDWEId2S( abilityId ) + " level:" + I2S( GetUnitAbilityLevel(whichUnit, abilityId) ))
		
		set loop__Index = loop__Index + 1
	endloop
	set abilityId = EXGetAbilityId( EXGetUnitAbilityByIndex( whichUnit, loop__Index + 1 ) )
	if abilityId != 0 then
		call SingleDebug( "奇怪错误：" + I2S( loop__Index ) + " 号技能为 " + GetObjectName(abilityId) + " " + YDWEId2S( abilityId ) )
	endif

	set whichUnit = null
endfunction


function TestChat takes string s returns nothing
	local boolean WDO = SubString(s, 0, 4)== "-aa "
	local boolean WFO = SubString(s, 0, 4)== "-au "
	local boolean WGO = SubString(s, 0, 4)== "-sa "
	local boolean WHO = SubString(s, 0, 4)== "-at "
	local boolean WJO = SubString(s, 0, 4)== "-ra "
	local boolean WKO = s == "-r"
	local boolean WLO = SubString(s, 0, 4)== "-ga "
	local boolean WMO = SubString(s, 0, 4)== "-ha "
	local boolean WPO = SubString(s, 0, 4)== "-ai "
	local boolean WQO = SubString(s, 0, 3)== "-o "
	local boolean WSO = SubString(s, 0, 4)== "-et "
	local boolean WTO = SubString(s, 0, 4)== "-ep "
	local boolean WUO = SubString(s, 0, 7)== "-setms "
	local boolean WWO = SubString(s, 0, 6)== "-anim "
	local boolean WYO = SubString(s, 0, 4)== "-hp "
	local boolean WZO = s == "-hp"
	local boolean W_O = SubString(s, 0, 4)== "-mp "
	local boolean W0O = SubString(s, 0, 4)== "-ar "
	local boolean W1O = SubString(s, 0, 4)== "-ip "
	local boolean W2O = s == "-nerf"
	local boolean W3O = SubString(s, 0, 4)== "-or "
	local boolean W4O = SubString(s, 0, 7)== "-mytry "
	local boolean W5O = s == "-cc"
	local boolean W6O = s == "-b"
	local boolean W7O = s == "-control" or s == "-c"
	local boolean W8O = s == "-xy"
	local boolean gi = s == "-gi"
	local boolean W9O = SubString(s, 0, 5)== "-sxy "
	local boolean YVO = SubString(s, 0, 6)== "-tint "
	local boolean YEO = s == "-ms "
	local boolean YXO = s == "-path"
	local boolean YOO = s == "-k"
	local boolean YRO = s == "-br"
	local boolean YIO = s == "-path on"
	local boolean YAO = s == "-path off"
	local boolean YNO = s == "-path"
	local boolean YBO = SubString(s, 0, 7)== "-souls "
	local boolean YCO = SubString(s, 0, 7)== "-scale "
	local boolean YDO = s == "-fog"
	local boolean getId = s == "-all"
	local boolean testEfficiency = s == "-效率"
	if YDO then
		call Cheat("iseedeadpeople")
	endif
	
	call INX("EXGetUnitAllAbilityId", getId)
	call INX("TestEfficiency", testEfficiency)

	call INX("WNO", YCO)
	call INX("WNO", YCO)
	call INX("WRO", YBO)
	call INX("WAO", YNO)
	call INX("WXO", YIO)
	call INX("WOO", YAO)
	call INX("UYO", W6O)
	call INX("WEO", YRO)
	call INX("WEO", YRO)
	call INX("WVO", YXO)
	call INX("YFO", YEO)
	call INX("U9O", W9O)
	call INX("U2O", WTO)
	call INX("U3O", WSO)
	call INX("SKO", W7O)
	call INX("TLO", W8O)
	call INX("T1O", gi)
	call INX("UYO", W6O)
	call INX("U0O", YVO)
	call INX("UWO", W5O)
	call INX("UTO", W3O)
	call INX("ULO", W4O)
	call INX("UQO", WKO)
	call INX("UJO", W2O)
	call INX("UGO", WFO)
	call INX("UFO", WGO)
	call INX("TAO", WYO)
	call INX("TBO", WZO)
	call INX("TDO", YOO)
	call INX("TJO", W0O)
	call INX("TGO", W_O)
	call INX("TRO", WWO)
	call INX("TOO", WHO)
	call INX("S9O", WUO)
	call INX("TEO", W1O)
	call INX("STO", WDO)
	call INX("SYO", WJO)
	call INX("S_O", WLO)
	call INX("S1O", WMO)
	call INX("S5O", WQO)
	call INX("S3O", WPO)
endfunction
function YGO takes unit u, integer s1, integer s2 returns nothing
	local item YHO = null
	local item YJO = null
	call DisableTrigger(CUV)
	if UnitItemInSlot(u, s2 -1)!= null and GUX(UUV(UnitItemInSlot(u, s2 -1)))== false and GetItemIndex(UnitItemInSlot(u, s2 -1))== XCV then
		set YJO = UnitRemoveItemFromSlot(u, s2 -1)
	endif
	if UnitItemInSlot(u, s1 -1)!= null and GUX(UUV(UnitItemInSlot(u, s1 -1)))== false and GetItemIndex(UnitItemInSlot(u, s1 -1))== XCV then
		set YHO = UnitRemoveItemFromSlot(u, s1 -1)
	endif
	call EnableTrigger(CUV)
	if YHO != null then
		call JXX(u, YHO, s2 -1)
	endif
	if YJO != null then
		call JXX(u, YJO, s1 -1)
	endif
	set YHO = null
	set YJO = null
endfunction
function YKO takes nothing returns nothing
	local string s = SubString(GetEventPlayerChatString(), 9, 14)
	local integer s1
	local integer s2
	local integer IMX = 0
	if SubString(s, 0, 1)== " " then
		set IMX = 1
	endif
	set s1 = S2I(SubString(s, IMX, IMX + 1))
	set s = SubString(s, IMX + 1, 5)
	set IMX = 0
	if SubString(s, 0, 1)== " " then
		set IMX = 1
	endif
	set s2 = S2I(SubString(s, IMX, IMX + 1))
	if s1 > 0 and s1 < 7 and s2 > 0 and s2 < 7 then
		call YGO(Player__Hero[GetPlayerId(GetTriggerPlayer())], s1, s2)
	else
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 5, "不正确的数值.请在1-6之间输入.")
	endif
endfunction
// 获得技能的阿哈利姆神杖升级索引 没有神杖升级就是返回 0 
function GetSkillAghanimUpgradeIndex takes integer id returns integer
	local integer i = 1
	loop
	exitwhen i > AghanimUpgradeMaxIndex
		if id == CF[i]or id == NF[i]then
			return i
		endif
		set i = i + 1
	endloop
	return 0
endfunction

// 有等级区分
function GetHeroSkillTip takes integer id, string s, integer level returns string
	return GetObjectName(id) + "[|cffffcc00" + s + "|r] - [|cffffcc00等级 " + I2S(level) + "|r]"
endfunction
function GetHeroSkillResearchTip takes integer id, string s returns string
    return "学习" + GetObjectName(id) + "[|cffffcc00" + s + "|r] - [|cffffcc00等级 %d|r]"
endfunction
// 没有等级
function GetUnitAbilityTip takes integer id, string s returns string
	return GetObjectName(id) + "[|cffffcc00" + s + "|r]"
endfunction

//快捷键整数转字符串
function Key2Str takes integer key returns string
    local string s = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    local integer i = key - 65
    if key > 64 and key < 91 then
        return SubString(s, i , i + 1)
 	endif
  	return null
endfunction

//快捷键字符串转整数
function Str2Key takes string key returns integer
    local string s = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    local integer i = 65
	local integer b = 0
	set key = StringCase(key , true)
	loop
	exitwhen i > 90
		if key == SubString(s, b , b + 1) then
			return i
		endif
		set i = i + 1
		set b = b + 1
	endloop
  	return 0
endfunction

function SetAbilityHotKey takes unit u, integer id, integer hotkey, player p returns nothing
	local integer a = 1
	local integer i
	call SetUnitAbilityLevel(u, id, 4)
	if(LocalPlayer == p) then
		if LoadBoolean(LocalHashTable, id, KEY_USE_DOUBLECLICK_SPELL) then
			set i = YDWEGetUnitAbilityDataInteger(u, id, 1, 200)
			set KeyCanDoubleClickSpell[i] = KeyCanDoubleClickSpell[i] - 1
			set KeyCanDoubleClickSpell[hotkey] = KeyCanDoubleClickSpell[hotkey] + 1
		endif
		call SaveInteger(LocalHashTable, id, HotKeyStringHash, hotkey)
		set i = GetUnitAbilityLevel(u, id)
		call DisplayTextToPlayer(LocalPlayer, 0, 0, "修改技能" + GetObjectName(id)+ "快捷键为" + "[|cffffcc00" + SubString(YDWEId2S(hotkey), 3, 4)+ "|r]")
		call YDWESetUnitAbilityDataInteger(u, id, 1, 200, hotkey)
		call YDWESetUnitAbilityDataInteger(u, id, 1, 201, hotkey)
		call YDWESetUnitAbilityDataInteger(u, id, 1, 202, hotkey)
		call YDWESetUnitAbilityDataString(u, id, 1, 214, "学习" + GetObjectName(id) + "[|cffffcc00" + SubString(YDWEId2S(hotkey), 3, 4) + "|r] - [|cffffcc00等级 %d|r]")
		loop
		exitwhen a > i
			call YDWESetUnitAbilityDataString(u, id, a, 215, GetHeroSkillTip(id, Key2Str(hotkey), a))
			set a = a + 1
		endloop
	endif
endfunction
function SetExtraAbilityHotKey takes unit u, integer id, integer hotkey, player p returns nothing
	if(LocalPlayer == p) then
		call DisplayTextToPlayer(LocalPlayer, 0, 0, "修改 额外技能 " + GetObjectName(id)+ "快捷键为" + "[|cffffcc00" + SubString(YDWEId2S(hotkey), 3, 4)+ "|r]")
		call YDWESetUnitAbilityDataInteger(u, id, 1, 200, hotkey)
		call YDWESetUnitAbilityDataString(u, id, 1, 215, GetUnitAbilityTip(id, YDWEId2S(hotkey) ) )
	endif
endfunction
function SetPasAbilityHotKey takes unit u, integer id, integer hotkey, player p returns nothing
	if(p == LocalPlayer) then
		call DisplayTextToPlayer(LocalPlayer, 0, 0, "修改被动技能" + GetObjectName(id)+ "学习快捷键为" + "[|cffffcc00" + SubString(YDWEId2S(hotkey), 3, 4)+ "|r]")
		call YDWESetUnitAbilityDataInteger(u, id, 1, 202, hotkey)
		call YDWESetUnitAbilityDataString(u, id, 1, 214, "学习" + GetObjectName(id) + "[|cffffcc00" + SubString(YDWEId2S(hotkey), 3, 4) + "|r] - [|cffffcc00等级 %d|r]")
	endif
endfunction
function lua_GetButtonAbility takes integer i returns integer
	if i == 1 then
		return GetLocalAbilityId( 0, 2 )
	elseif i == 2 then
		return GetLocalAbilityId( 1, 2 )
	elseif i == 3 then
		return GetLocalAbilityId( 2, 2 )
	elseif i == 4 then
		return GetLocalAbilityId( 3, 2 )
	elseif i == 5 then
		return GetLocalAbilityId( 0, 1 )
	elseif i == 6 then
		return GetLocalAbilityId( 1, 1 )
	elseif i == 7 then
		return GetLocalAbilityId( 2, 1 )
	elseif i == 8 then
		return GetLocalAbilityId( 3, 1 )
	elseif i == 9 then
		return GetLocalAbilityId( 0, 0 )
	endif
	return 0
endfunction

function Loacl_SetUnitAbilityHotkey takes unit u, integer id, integer hotkey returns nothing
	local integer i = 200
	local boolean b = false
	local integer oldKey = YDWEGetUnitAbilityDataInteger(u, id, 1, 200)
	loop
	exitwhen i > 202
		if YDWEGetUnitAbilityDataInteger(u, id, 1, i) != 0 then
			if YDWESetUnitAbilityDataInteger(u, id, 1, i, hotkey) then
				set b = true
			endif
		endif
		set i = i + 1
	endloop
	if YDWEGetUnitAbilityDataString(u, id, 2, 215) == "" then
		call YDWESetUnitAbilityDataString(u, id, 1, 215, GetUnitAbilityTip(id, Key2Str(hotkey) ) )
	else
		set i = 1
		loop
		exitwhen YDWEGetUnitAbilityDataString(u, id, i, 215) == ""
			call YDWESetUnitAbilityDataString(u, id, i, 215, GetHeroSkillTip(id, Key2Str(hotkey),i ) )
			set i = i + 1
		endloop
		call YDWESetUnitAbilityDataString(u, id, 1, 214, "学习" + GetObjectName(id) + "[|cffffcc00" + SubString(YDWEId2S(hotkey), 3, 4) + "|r] - [|cffffcc00等级 %d|r]")
	endif	
	if b then
		call DisplayTextToPlayer(LocalPlayer, 0, 0, "修改技能" + GetObjectName(id)+ "快捷键为" + "[|cffffcc00" + SubString(YDWEId2S(hotkey), 3, 4)+ "|r]")
		if LoadBoolean(LocalHashTable, id, KEY_USE_DOUBLECLICK_SPELL) then
			set KeyCanDoubleClickSpell[oldKey] = KeyCanDoubleClickSpell[oldKey] - 1
			set KeyCanDoubleClickSpell[hotkey] = KeyCanDoubleClickSpell[hotkey] + 1
			call SaveInteger(LocalHashTable, id, HotKeyStringHash, hotkey)
		endif
	else
		call DisplayTextToPlayer(LocalPlayer, 0, 0, "该技能没有快捷键。")
	endif
endfunction

function HKY_C takes player p returns nothing 
	local unit u = null
	local integer i = S2I(SubString(GetEventPlayerChatString(), 6, 8))
	local integer hotkey 
	if i < 1 or i > 9 then
		call DisplayTimedTextToPlayer(p, .5,-1., 10., "|cffffcc00错误的参数，技能按钮取值必须为1至11。|r")
		return
	endif
	if i > 9 then
		set hotkey = YDWES2Id(StringCase(SubString(GetEventPlayerChatString(), 9, 10), true))
	else
		set hotkey = YDWES2Id(StringCase(SubString(GetEventPlayerChatString(), 8, 9), true))
	endif
	if hotkey < 65 or hotkey > 90 then
		call DisplayTimedTextToPlayer(p, .5,-1., 10., "|cffffcc00错误的参数，快捷键的取值必须为26英文字母。|r")
		return
	endif
	set u = GetPlayerSelectedUnit()
	set i = lua_GetButtonAbility(i)
	if i == 0 or i == 'AHer' or i == 'Asel' or i == 'Asud' then
		call DisplayTimedTextToPlayer(p, .5,-1., 10., "|cffffcc00没有该技能，技能按钮的位置为\n9\n5 6 7 8\n1 2 3 4\n|r")
	else
		call Loacl_SetUnitAbilityHotkey(u, i, hotkey)
	endif
	set u = null
endfunction

function HKY takes nothing returns nothing
	if LocalPlayer == GetTriggerPlayer() then
		call HKY_C(LocalPlayer)
	endif
endfunction
function FireRemnat_Hk takes unit u, integer id, integer hotkey, player p returns boolean
	local integer e
	if id == 'A2JR' then
		set e = 0
		loop
			if e == 0 then
				set id = 'A2JK'
			elseif e == 1 then
				set id = 'A2JQ'
			elseif e == 2 then
				set id = 'A2JP'
			elseif e == 3 then
				set id = 'A2JR'
			elseif e == 4 then
				set id = 'A2JO'
			endif
		exitwhen e > 4
			call UnitAddAbility(u, id)
			call SetAbilityHotKey(u, id, hotkey, p)
			call UnitRemoveAbility(u, id)
			set e = e + 1
		endloop
		return true
	endif
	return false
endfunction
function Ike_Sht takes player p, integer i, integer hotkey returns nothing
	local integer id = 0
	local integer a = 1
	local integer e = 1
	local integer TME = GetPlayerId(p)
	local integer AghanimID
	local boolean b1 = false
	local boolean b2 = false
	local integer IkeyID
	local integer f
	local unit u = Circle[GetPlayerId(p)]
	if IsPassiveSkill[PlayerSkillIndex[TME * HL + i]] then
		set id = HeroCommonSkills[PlayerSkillIndex[TME * HL + i]]
		if id != 0 then
			call UnitAddAbility(u, id)
			call SetPasAbilityHotKey(u, id, hotkey, p)
			call UnitRemoveAbility(u, id)
			if id == 'A088' then
				set id = 'A2KQ'
				call UnitAddAbility(u, id)
				call SetExtraAbilityHotKey(u, id, hotkey, p)
				call UnitRemoveAbility(u, id)
			endif
		endif
	else
		set id = HeroCommonSkills[PlayerSkillIndex[TME * HL + i]]
		if FireRemnat_Hk(u, id, hotkey, p) then
			set u = null
			return
		endif
		set IkeyID = LoadInteger(ExtraHT, HTKEY_SWITCHING_SKILLS, id)
		set AghanimID = HeroUpgradeSkills[PlayerSkillIndex[TME * HL + i]]
		if AghanimID != 0 then
			set b1 = true
		endif
		if IkeyID != 0 then
			set b2 = true
		endif
		if b1 or b2 then
			set f = 2
			if b1 and b2 then
				if LoadBoolean(ExtraHT, HTKEY_SWITCHING_SKILLS, id) then
					set f = 4
				endif
			endif
			if id == 'A2E5' then
				set f = 3
			endif
			loop
			exitwhen e > f
				if e == 1 then
					set id = HeroCommonSkills[PlayerSkillIndex[TME * HL + i]]
				elseif b2 then
					set id = IkeyID
				elseif b1 then
					set id = AghanimID 
				endif
				if e == 3 then
					set id = AghanimID 
				elseif e == 4 then
					set id = LoadInteger(ExtraHT, HTKEY_SWITCHING_SKILLS, AghanimID)	
				endif
				if id != 0 then
					call UnitAddAbility(u, id)
					call SetAbilityHotKey(u, id, hotkey, p)
					call UnitRemoveAbility(u, id)
				endif
				set e = e + 1
			endloop
		else
			if id != 0 then
				call UnitAddAbility(u, id)
				call SetAbilityHotKey(u, id, hotkey, p)
				call UnitRemoveAbility(u, id)
			endif
		endif
	endif
	set u = null
endfunction

function IKY takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer hotkey = YDWES2Id(StringCase(SubString(GetEventPlayerChatString(), 8, 9), true))
	local integer i = S2I(SubString(GetEventPlayerChatString(), 6, 7))
	if hotkey < 64 or hotkey > 91 then
		call InterfaceErrorForPlayer(p, "错误的参数，快捷键的取值必须为26英文字母。")
		return
	endif
	if i < 0 or i > (4 + ExtraAbilitiesNum  ) then
		call InterfaceErrorForPlayer(p, "错误的参数，技能编号的取值必须以-si面板中为准。")
		return
	endif
	call Ike_Sht(p, i, hotkey)
endfunction

function YLO takes string s returns nothing
	local string s5 = SubString(s, 0, 5)
	local boolean YMO = SubString(s, 0, 5)== "-swap"
	local boolean YPO = SubString(s, 0, 5)== "-roll"
	local boolean YQO = SubString(s, 0, 8)== "-kickafk"
	local boolean YSO = SubString(s, 0, 6)== "-music"
	local boolean YTO = SubString(s, 0, 6)== "-water"
	local boolean YUO = SubString(s, 0, 9)== "-rickroll"
	local boolean YWO = SubString(s, 0, 7)== "-switch"
	local boolean YYO = SubString(s, 0, 18)== "-removeiteminslot "
	local boolean YZO = SubString(s, 0, 2)== "-r" and(SubString(s, 2, 3)== " " or S2I(SubString(s, 2, 3))> 0)
	local boolean Y_O = SubString(s, 0, 4)== "-cam"
	local boolean Y0O = SubString(s, 0, 9)== "-itemswap"
	if s5 == "-ikey" then
		call ExecuteFunc("IKY")
	elseif s5 == "-hkey" then
		call ExecuteFunc("HKY")
	endif
	call INX("TMO", Y_O)
	call INX("Y1O", YMO)
	call INX("Y2O", YPO)
	call INX("Y3O", YQO)
	call INX("Y4O", YZO)
	call INX("S7O", YYO)
	call INX("Y5O", YSO)
	call INX("Y6O", YTO)
	call INX("Y7O", YUO)
	call INX("Y8O", YWO)
	call INX("YKO", Y0O)
	if(bj_isSinglePlayer) then
		call TestChat(s)
	endif
endfunction
function Y9O takes nothing returns nothing
	local string s = StringCase(GetEventPlayerChatString(), false)
	local integer h = StringHash(s)
	if HaveSavedString(Z, h, 0) then
		call ExecuteFunc(LoadStr(Z, h, 0))
		if(s != "-c") then
			return
		endif
	endif
	if(SubString(s, 0, 1)== "-") then
		call YLO(s)
	endif
endfunction
function Y7O takes nothing returns nothing
	local integer a = S2I(SubString(GetEventPlayerChatString(), 10, StringLength(GetEventPlayerChatString())))
	local integer TME = GetPlayerId(GetTriggerPlayer())
	set FZV[TME]= FZV[TME]+ 1
	if FZV[TME]>$A then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, CR[LocalId], GetObjectName('n0DQ'))
		return
	endif
	if a < 1 or a > 8 then
		set a = GetRandomInt(1, 8)
	endif
	if a == 1 then
		call DisplayTimedTextToAllPlayer(XY, 5, JS[GetPlayerId(GetTriggerPlayer())]+(VMV[GetPlayerId((GetTriggerPlayer()))])+ "|r's never gonna give you up")
	elseif a == 2 then
		call DisplayTimedTextToAllPlayer(XY, 5, JS[GetPlayerId(GetTriggerPlayer())]+(VMV[GetPlayerId((GetTriggerPlayer()))])+ "|r's never gonna let you down")
	elseif a == 3 then
		call DisplayTimedTextToAllPlayer(XY, 5, JS[GetPlayerId(GetTriggerPlayer())]+(VMV[GetPlayerId((GetTriggerPlayer()))])+ "|r's never gonna run around")
	elseif a == 4 then
		call DisplayTimedTextToAllPlayer(XY, 5, JS[GetPlayerId(GetTriggerPlayer())]+(VMV[GetPlayerId((GetTriggerPlayer()))])+ "|r's never gonna desert you")
	elseif a == 5 then
		call DisplayTimedTextToAllPlayer(XY, 5, JS[GetPlayerId(GetTriggerPlayer())]+(VMV[GetPlayerId((GetTriggerPlayer()))])+ "|r's never gonna make you cry")
	elseif a == 6 then
		call DisplayTimedTextToAllPlayer(XY, 5, JS[GetPlayerId(GetTriggerPlayer())]+(VMV[GetPlayerId((GetTriggerPlayer()))])+ "|r's never gonna say goodbye")
	elseif a == 7 then
		call DisplayTimedTextToAllPlayer(XY, 5, JS[GetPlayerId(GetTriggerPlayer())]+(VMV[GetPlayerId((GetTriggerPlayer()))])+ "|r's never gonna tell a lie")
	elseif a == 8 then
		call DisplayTimedTextToAllPlayer(XY, 5, JS[GetPlayerId(GetTriggerPlayer())]+(VMV[GetPlayerId((GetTriggerPlayer()))])+ "|r's never gonna hurt you")
	endif
endfunction
function ZVO takes nothing returns boolean
	return RY and FT[GetPlayerId(ZW)]== false and GS and Player__Hero[GetPlayerId(ZW)]== null and KS[GetPlayerId(ZW)]== false and AY[GetPlayerId(ZW)]== false
endfunction
function ZEO takes player p, integer ZXO returns nothing
	local integer k = 0
	local location l
	local integer TTV = 0
	local integer i = 0
	local boolean ZOO = ZXO == 1
	local boolean ZRO = ZXO == 2
	local boolean ZIO = ZXO == 0
	set FT[GetPlayerId(p)]= true
	if IsSentinelsPlayer(p) then
		set l = GetRectCenter(VZ)
	else
		set l = GetRectCenter(GY)
	endif
	loop
		if ZIO then
			set TTV = GetRandomInt(1, VZV)
		elseif ZOO then
			set TTV = TVE(V7V[GetRandomInt(1, V8V)])
		elseif ZRO then
			set TTV = TVE(V5V[GetRandomInt(1, V6V)])
		endif
	exitwhen GetPlayerTechMaxAllowed(p, VUV[TTV])> 0 and ZQ[TTV]== false
		set i = i + 1
	endloop
	if PW == false then
		call XTX(VUV[TTV])
		set YQ[TTV]= true
		set ZQ[TTV]= true
	endif
	call CreateUnitAtLoc(p, VUV[TTV], l, 0)
	call RemoveLocation(l)
	set l = null
endfunction
function ZAO takes player p, integer ZXO returns integer
	local boolean ZOO = ZXO == 1
	local boolean ZRO = ZXO == 2
	local boolean ZIO = ZXO == 0
	local integer i = 0
	local integer WOV = GL
	local integer k = 0
	loop
	exitwhen i > WOV
		if GetPlayerTechMaxAllowed(p, VUV[i])> 0 then
			if ZOO and IsUnitIdType(VUV[i], UNIT_TYPE_MELEE_ATTACKER) then
				set k = k + 1
			elseif ZRO and IsUnitIdType(VUV[i], UNIT_TYPE_MELEE_ATTACKER)== false then
				set k = k + 1
			elseif ZIO then
				set k = k + 1
			endif
		endif
		set i = i + 1
	endloop
	return k
endfunction
function ZNO takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player p =(LoadPlayerHandle(HY, h, 54))
	local string ZBO =(LoadStr(HY, h,$92))
	set ZW = p
	if ZVO() then
		set FT[GetPlayerId(p)]= true
		if ZBO == "-random int"then
			call OFX(p, 1)
			call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)-$96)
		elseif ZBO == "-random str"then
			call OFX(p, 3)
			call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)-$96)
		elseif ZBO == "-random agi"then
			call OFX(p, 2)
			call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)-$96)
		elseif ZBO == "-random melee"then
			call OHX(p, 1)
			call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)-$96)
		elseif ZBO == "-random range"then
			call OHX(p, 2)
			call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)-$96)
		else
			call OKX(p)
			call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)-50)
		endif
	else
		call DisplayTimedTextToPlayer(p, 0, 0, CR[LocalId], GetObjectName('n079'))
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set p = null
	return false
endfunction
function UAO takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local trigger t = null
	local string s = StringCase(GetEventPlayerChatString(), false)
	set ZW = p
	if ZVO() and G3[GetPlayerId(p)]== false then
		if PP[GetPlayerId(p)]== 2 and s == "-random melee" then
			call DisplayTimedTextToPlayer(p, 0, 0, 10, "你选择了至少一个|c00ff0000远程限定|r技能。你不能使用近战英雄模型.")
		elseif PP[GetPlayerId(p)]== 1 and s == "-random range" then
			call DisplayTimedTextToPlayer(p, 0, 0, 10, "你选择了至少一个|c00ff0000近战限定|r技能。你不能使用远程英雄模型.")
		elseif MainModeName =="sd" then
			if s == "-random melee"then
				if ZAO(p, 1)> 0 then
					set G3[GetPlayerId(p)]= true
					call ZEO(p, 1)
					call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)- 100 )
					return
				else
					call DisplayTimedTextToPlayer(p, 0, 0, 10, "你没有近战英雄可以选择了.")
				endif
			elseif s == "-random range"then
				if ZAO(p, 2)> 0 then
					set G3[GetPlayerId(p)]= true
					call ZEO(p, 2)
					call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)- 100 )
					return
				else
					call DisplayTimedTextToPlayer(p, 0, 0, 10, "你没有远程英雄可以选择了.")
				endif
			elseif s == "-random"then
				set G3[GetPlayerId(p)]= true
				call ZEO(p, 0)
				return
			endif
		else
			set G3[GetPlayerId(p)]= true
			call XUX(p)
			if s == "-random melee" then
				call DisplayTimedTextToPlayer(p, 0, 0, 10, "你随机选择了一个近战英雄.")
			elseif s == "-random range" then
				call DisplayTimedTextToPlayer(p, 0, 0, 10, "你随机选择了一个远程英雄.")
			else
				call DisplayTimedTextToPlayer(p, 0, 0, 10, GetObjectName('n07A'))
			endif
			set t = CreateTrigger()
			call TriggerRegisterTimerEvent(t, .1, false)
			call TriggerAddCondition(t, Condition(function ZNO))
			call SavePlayerHandle(HY, GetHandleId(t), 54, p)
			call SaveStr(HY, GetHandleId(t),$92, StringCase(GetEventPlayerChatString(), false))
		endif
	endif
	set t = null
	set p = null
endfunction
function ZCO takes nothing returns boolean
	local unit triggerUnit
	if GUV then
		call InterfaceErrorForPlayer(GetTriggerPlayer(), GetObjectName('n030'))
		return false
	endif
	if IY == false then
		if GKV == false and GJV == false and V4 == false then
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "-repick " + GetObjectName('n05B'))
		endif
		return false
	endif
	if(KS[GetPlayerId(GetTriggerPlayer())]) or(Player__Hero[GetPlayerId(GetTriggerPlayer())]== null) then
		return false
	endif
	if Mode__DeathMatch then
		return false
	endif
	if(Z3) then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n050'))
		return false
	endif
	if(GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD)< GT) or(GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD)< 400 and(RT or GKV) and FT[GetPlayerId(GetTriggerPlayer())]) then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n059'))
		return false
	endif
	if GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD)<$FA and RT then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n05U'))
		return false
	endif
	set triggerUnit = Player__Hero[GetPlayerId(GetTriggerPlayer())]
	if GetUnitState(triggerUnit, UNIT_STATE_MANA)!= GetUnitState(triggerUnit, UNIT_STATE_MAX_MANA) or GetWidgetLife(triggerUnit)!= GetUnitState(triggerUnit, UNIT_STATE_MAX_LIFE) then
		set triggerUnit = null
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n05J'))
		return false
	endif
	set triggerUnit = null
	return true
endfunction
function ZDO takes nothing returns nothing
	local unit u = GetEnumUnit()
	local integer i = GetUnitTypeId(u)
	if(IsUnitType(u, UNIT_TYPE_HERO)) then
		if(GetUnitAbilityLevel(u,'Z234')> 0) then
			call ExecuteFunc("T8X")
		elseif GetUnitAbilityLevel(u,'Q231')> 0 then
			set VK = u
			call ExecuteFunc("W4X")
		elseif GetUnitAbilityLevel(u,'A0CY')> 0 then
			set VK = u
			call ExecuteFunc("W5X")
		endif
		call DisplayTimedTextToAllPlayer(VNX(GetTriggerPlayer()), 10., GetObjectName('n05L')+ " " + EJX(u)+ ".")
	endif
	if IsBearUnit(u) or GetUnitTypeId(u)=='o01X' then
		call RemoveUnit(u)
	endif
	set u = null
endfunction
function ZFO takes player p, integer i returns nothing
	local integer k = 1
	local integer h = GetHandleId(p)
	local integer WWV = GetPlayerId(p)
	if GKV or Mode__MirrorDraft then
		set k = 1
		loop
			if LoadBoolean(HY, h, VUV[k]) and DP[WWV * GL + k]and ZQ[k]== false and YQ[k]== false then
				call SetPlayerTechMaxAllowed(p, VUV[k], 999)
			else
				call SetPlayerTechMaxAllowed(p, VUV[k], 0)
			endif
			set k = k + 1
		exitwhen k > GL
		endloop
	endif
	if i == 0 then
		return
	endif
	set k = 1
	if i == 1 then
		loop
			call SetPlayerTechMaxAllowed(p, V5V[k], 0)
			set k = k + 1
		exitwhen k > V6V
		endloop
	elseif i == 2 then
		loop
			call SetPlayerTechMaxAllowed(p, V7V[k], 0)
			set k = k + 1
		exitwhen k > V8V
		endloop
	endif
endfunction
function ZGO takes nothing returns nothing
	if GetUnitTypeId(GetFilterUnit())=='ntav' then
		call UnitAddAbility(GetFilterUnit(),'A1HX')
		call ShowUnit(GetFilterUnit(), true)
	elseif GetUnitTypeId(GetFilterUnit())=='n12C' then
		if LocalPlayer== GetOwningPlayer(GetFilterUnit()) then
			call SetUnitVertexColor(GetFilterUnit(), 255, 255, 255, 255)
		endif
	endif
endfunction
function ZHO takes player p returns nothing
	local group g = LoginGroup(103)
	call GroupEnumUnitsOfPlayer(g, p, Condition(function ZGO))
	call LogoutGroup(g)
	set g = null
endfunction
function ZJO takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local group g = LoginGroup(104)
	local integer ZKO
	local integer ZLO
	local location ZMO
	local integer X1X
	local integer O3X
	local integer K0X
	local unit ZPO
	local integer WWV = GetPlayerId(p)
	local location LIX = GetRectCenter(LZ)
	local location LAX = GetRectCenter(MZ)
	local integer i = 0
	set Q2 = WWV
	set bj_groupEnumOwningPlayer = p
	call GroupEnumUnitsInRect(g, GetWorldBounds(), filterGetUnitsInRectOfPlayer)
	if(IsSentinelsPlayer(p)) then
		set ZKO = 1
		set ZLO = VWV
		set ZMO = GetRectCenter(G4)
	else
		set ZKO = VYV
		set ZLO = VZV
		set ZMO = GetRectCenter(F4)
	endif
	if VT then
		if(GetRandomInt(1, 2)== 1) then
			set ZKO = 1
			set ZLO = VWV
		else
			set ZKO = VYV
			set ZLO = VZV
		endif
	endif
	if RT or GKV then
		set GT = 0
	endif
	set ZPO =(LoadUnitHandle(HY,(GetHandleId(GetTriggerPlayer())),$93))
	if ZPO != null and GetUnitTypeId(ZPO)=='e00C' then
		call RemoveUnit(ZPO)
	endif
	call AdjustPlayerStateBJ(-1 * GT, p, PLAYER_STATE_RESOURCE_GOLD)
	if(RT or GKV) and FT[GetPlayerId(GetTriggerPlayer())]then
		call AdjustPlayerStateBJ(-$96, p, PLAYER_STATE_RESOURCE_GOLD)
	endif
	set KS[WWV]= true
	set IN[WWV]= false
	call ForGroup(g, function ZDO)
	set i = GetUnitPointValueByType(GetUnitTypeId(Player__Hero[WWV]))
	set YQ[i]= false
	set ZQ[i]= false
	set DP[WWV * GL + i]= false
	call EXRemoveHero(Player__Hero[WWV])
	set PlayerHeroTypeId[WWV]= 0
	set Player__Hero[GetPlayerId(GetTriggerPlayer())]= null
	if RT or GKV or Mode__MirrorDraft then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 60, GetObjectName('n05Y'))
		if RT or GKV or Mode__MirrorDraft then
			set O3X = 1
			set K0X = VZV
		endif
		call YCE(p)
		if IsSentinelsPlayer(p) then
			call PanCameraToTimedLocForPlayer(p, LIX, 0)
		else
			call PanCameraToTimedLocForPlayer(p, LAX, 0)
		endif
		if GKV or Mode__MirrorDraft then
			call ZHO(p)
		endif
		loop
		exitwhen O3X > K0X
			if RT then
				if ZQ[O3X]== false then
					call SetPlayerTechMaxAllowed(p, VUV[O3X], 999)
				else
					call SetPlayerTechMaxAllowed(p, VUV[O3X], 0)
				endif
			elseif GKV or Mode__MirrorDraft then
				if DP[WWV * GL + O3X]and ZQ[O3X]== false and YQ[O3X]== false then
					call SetPlayerTechMaxAllowed(p, VUV[O3X], 999)
				else
					call SetPlayerTechMaxAllowed(p, VUV[O3X], 0)
				endif
			endif
			set O3X = O3X + 1
		endloop
		call ZFO(Player(WWV), PP[WWV])
		call RemoveLocation(LIX)
		call RemoveLocation(LAX)
		return
	endif
	loop
		set X1X = GetRandomInt(ZKO, ZLO)
		if(ZQ[X1X]== false) then
			set YQ[X1X]= true
			set ZQ[X1X]= true
			set Player__Hero[WWV]= CreateUnitAtLoc(p, VUV[X1X], ZMO, bj_UNIT_FACING)
			set PlayerHeroTypeId[WWV]= VUV[X1X]
			call XSX(VUV[X1X])
		endif
	exitwhen Player__Hero[WWV]!= null
	endloop
	call LogoutGroup(g)
	call RemoveLocation(ZMO)
	call RemoveLocation(LIX)
	call RemoveLocation(LAX)
	set ZPO = null
	set ZMO = null
	set LIX = null
	set LAX = null
endfunction
function UBO takes nothing returns nothing
	if ZCO() then
		call ZJO()
	endif
endfunction
function GameInfoActions takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local string colorCode = "|c006699CC"
	if Mode__DeathMatch then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Death Match" + "|r:		" + GetObjectName('n06Z'))
		call DisplayTimedTextToPlayer(p, 0, 0, 20, "							  " + GetObjectName('n06Y')+ " " + I2S(IMinBJ(VWV, VZV -VYV + 1))+ " " + GetObjectName('n07C'))
	endif
	if ET then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Random Draft|r:				 你将在24个随机分配了技能的英雄中选取一个英雄")
	endif
	if Mode__MirrorDraft then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Mirror Draft|r:				 对楼双方获得同样的英雄 (玩家 1 对 6, 2 对 7……)")
	endif
	if RT then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "All Pick" + "|r:				 " + GetObjectName('n06V'))
	endif
	if YS then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Switch On" + "|r:				 " + "允许玩家通过 -switch 指令变更队伍。使用 - unlock 指令解锁遗留的装备.")
	endif
	if GJV then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Random Draft" + "|r:				 " + GetObjectName('n072'))
	endif
	if GKV then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Single Draft" + "|r:				 每位玩家随机分配相应数量的英雄")
	endif
	if Mode__RearmCombos then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Rearm combos" + "|r:				 解除部分技能的冲突限制")
	endif
	if VT then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "All Random" + "|r:		  " + GetObjectName('n071'))
	endif
	if DW then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Shuffle Players" + "|r:	 " + GetObjectName('n07H'))
	endif
	if QW then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "All Agility" + "|r:			 " + GetObjectName('n07L'))
	endif
	if TW then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "All Strength" + "|r:		 " + GetObjectName('n07K'))
	endif
	if SW then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "All Intelligence" + "|r:	" + GetObjectName('n07J'))
	endif
	if GMV then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Range Only" + "|r:	" + GetObjectName('n0G4'))
	endif
	if GLV then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Melee Only" + "|r:	" + GetObjectName('n0G5'))
	endif
	if PW then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Duplicate Mode" + "|r:   " + GetObjectName('n07I'))
	endif
	if Mode__ItemDrop then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Item Drop" + "|r:			 " + GetObjectName('n07F'))
	endif
	if Mode__NoPowerups then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "No Powerups" + "|r:		" + GetObjectName('n07M'))
	endif
	if Mode__SuperCreeps then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Super Creeps" + "|r:		" + GetObjectName('n07N'))
		call DisplayTimedTextToPlayer(p, 0, 0, 20, "							 " + GetObjectName('n07O'))
	endif
	if Mode__EasyMode then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Easy Mode" + "|r:		   " + GetObjectName('n07T'))
	endif
	if Mode__SameHero then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Same Hero" + "|r:		   " + GetObjectName('n07U')+ " " +(VMV[GetPlayerId((HostPlayer))])+ "|r" + " " + GetObjectName('n07W'))
	endif
	if Mode__OnlyMid then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Only Mid" + "|r:		   " + GetObjectName('n080'))
	endif
	if Mode__NoBot then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "No Bot" + "|r:		   " + GetObjectName('n07V'))
	endif
	if Mode__NoMid then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "No Mid" + "|r:		   " + GetObjectName('n07S'))
	endif
	if Mode__NoTop then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "No Top" + "|r:		   " + GetObjectName('n07R'))
	endif
	if Mode__NoSwap then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "No Swap" + "|r:		   " + GetObjectName('n07X'))
	endif
	if Mode__NoRepick then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "No Repick" + "|r:		   " + GetObjectName('n07Q'))
	endif
	if Mode__PoolMode then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Pool Mode" + "|r:		   " + GetObjectName('n07Y'))
	endif
	if Mode__ObserverInfo then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Observer Info" + "|r:		   " + GetObjectName('n07Z'))
	endif
	if Mode__FastRespawn then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Fast Respawn" + "|r:		   " + GetObjectName('n0DP'))
	endif
	if Mode__ZoomMode then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Zoom mode" + "|r:		   " + GetObjectName('n0KI'))
	endif
	if Mode__UnlimitedLevel then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Unlimited Level" + "|r:		   英雄的等级上限提升至 ∞")
	endif
	if Mode__SeeSkills then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "See skills" + "|r:		   你能看见敌方选择的技能")
	endif
	if Mode__AntiBackdoor then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Antibackdoor" + "|r:		   当攻击塔时若被系统判定为偷塔则塔受到的伤害变为极小")
	endif
	if Mode__FiveSkills then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Five skills" + "|r:		   你可以选择第五个技能")
	endif
	if Mode__SixSkills then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Six skills" + "|r:		   你可以选择六个技能：四个普通技能、两个终极奥义")
	endif
	if Mode__FastNeutrals then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Fast neutrals" + "|r:		   游戏一开始即刷新野怪")
	endif
	if Mode__Draft20 then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Draft 20" + "|r:		   在所有酒馆中征召20名英雄用于技能及模型选择")
	endif
	if Mode__Draft30 then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Draft 30" + "|r:		   在所有酒馆中征召30名英雄用于技能及模型选择")
	endif
	if Mode__Draft40 then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Draft 40" + "|r:		   在所有酒馆中征召40名英雄用于技能及模型选择")
	endif
	if Mode__Draft50 then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Draft 50" + "|r:				在所有酒馆中征召50名英雄用于技能及模型选择")
	endif
	if Mode__OneSkill then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "One skill" + "|r:		   一个技能在同一队伍中只能选择一次")
	endif
	if Mode__BalanceOff then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Balance off" + "|r:		   关闭内置平衡模式")
	endif
	if Mode__RandomExtraAbilities then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Random extra abilities" + "|r:		   你的第五个和第六个技能是随机得到的")
	endif
	if Mode__LimitSkills3 then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Limit skills 3" + "|r:		   你最多能选择同一个英雄的3个技能")
	endif
	if Mode__LimitSkills2 then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Limit skills" + "|r:		   你最多能选择同一个英雄的2个技能")
	endif
	if Mode__FastFinish then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Fast Finish" + "|r:		   你可以使用 -ff 命令来投票游戏快速结束（其实是投降）也可以使用 -wff 命令来查看已投票情况")
	endif
	if Mode__AntiHack then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "Anti Hack|r:				 反开图作弊")
	endif
	if Mode__NoNeutrals then
		call DisplayTimedTextToPlayer(p, 0, 0, 20, colorCode + "No Neutrals|r:				 不会刷新野怪")
	endif
endfunction
function ZTO takes nothing returns nothing
	if GetUnitTypeId(GetEnumUnit())=='n004' then
		call RemoveUnit(GetEnumUnit())
	endif
	if GetUnitTypeId(GetEnumUnit())=='o003' then
		call RemoveUnit(GetEnumUnit())
	endif
endfunction

function ZTJ takes nothing returns nothing
	local integer h = GetHandleId(GetExpiredTimer())
	set E3 = LoadPlayerHandle(HY, h, 0)
	call ExecuteFunc("Reset_Ability")
	set E3 = LoadPlayerHandle(HY, h, 1)
	call ExecuteFunc("Reset_Ability")
	call DestroyTimerAndFlushHT_HY(GetExpiredTimer())
endfunction

function ZTQ takes player p1, player p2 returns nothing
	local integer h = TimerStartSingle(0.5, function ZTJ)
	call SavePlayerHandle(HY, h, 0, p1)
	call SavePlayerHandle(HY, h, 1, p2)
endfunction

function PlayerSwap takes player p1, player p2 returns nothing
	local integer h1 = GetHandleId(p1)
	local integer h2 = GetHandleId(p2)
	local integer id1 = GetPlayerId(p1)
	local integer id2 = GetPlayerId(p2)
	local integer pidd = id1 -id2
	local unit u1
	local unit u2
	local unit u3
	local integer i = 0
	local integer h
	local integer k
	local integer j
	set E3 = p1
	call ExecuteFunc("Reset_Ability")
	set E3 = p2
	call ExecuteFunc("Reset_Ability")
	call ZTQ(p1, p2)
	loop
	exitwhen not HaveSavedHandle(K, h1, 32 + i)
		set u1 = LoadUnitHandle(K, h1, 32 + i)
		set u2 = LoadUnitHandle(K, h2, 32 + i)
		call SetUnitOwner(u1, p2, true)
		call SetUnitOwner(u2, p1, true)
		if LocalPlayer== p2 then
			call SetUnitScale(u1, 0.5, 0.5, 0.5)
			call SetUnitScale(u2, 0.3, 0.3, 0.3)
		elseif LocalPlayer== p1 then
			call SetUnitScale(u2, 0.5, 0.5, 0.5)
			call SetUnitScale(u1, 0.3, 0.3, 0.3)
		endif
		set u1 = LoadUnitHandle(K, h1, 32 + i)
		call SaveUnitHandle(K, h1, 32 + i, LoadUnitHandle(K, h2, 32 + i))
		call SaveUnitHandle(K, h2, 32 + i, u1)
		set u2 = u1
		set u1 = LoadUnitHandle(K, h1, 32 + i)
		set h = GetHandleId(u2)
		set u3 = LoadUnitHandle(HY, h, 32 + i)
		call SetUnitPosition(u3, GetUnitX(u1), GetUnitY(u1))
		set h = GetHandleId(u1)
		set u3 = LoadUnitHandle(HY, h, 32 + i)
		call SetUnitPosition(u3, GetUnitX(u2), GetUnitY(u2))
		call SaveUnitHandle(HY, GetHandleId(u1), 32 + i, LoadUnitHandle(HY, GetHandleId(u2), 32 + i))
		call SaveUnitHandle(HY, GetHandleId(u2), 32 + i, u3)
		set i = i + 1
	endloop
	call SelectUnitForPlayerSingle(LoadUnitHandle(K, h1, 32), p1)
	call SelectUnitForPlayerSingle(LoadUnitHandle(K, h2, 32), p2)
	set i = LoadInteger(K, h1, 32)
	loop
		set k = LoadInteger(HY, h1,'hrpl'+ i)
		set j = LoadInteger(HY, h2,'hrpl'+ i)
		call RemoveSavedBoolean(HY, h1, k)
		call RemoveSavedBoolean(HY, h2, j)
		set DP[LoadInteger(HY, h1,'bapl'+ i)+ GetPlayerId(p1)* GL]= false
		set DP[LoadInteger(HY, h2,'bapl'+ i)+ GetPlayerId(p2)* GL]= false
		set i = i -1
	exitwhen i < 0
	endloop
	set i = LoadInteger(K, h1, 32)
	loop
		set k = LoadInteger(HY, h1,'hrpl'+ i)
		set j = LoadInteger(HY, h2,'hrpl'+ i)
		call SaveBoolean(HY, h2, k, true)
		call SaveBoolean(HY, h1, j, true)
		set id1 = LoadInteger(HY, h1,'bapl'+ i)
		set id2 = LoadInteger(HY, h2,'bapl'+ i)
		set DP[id1 + GetPlayerId(p2)* GL]= true
		set DP[id2 + GetPlayerId(p1)* GL]= true
		call SaveInteger(HY, h1,'hrpl'+ i, j)
		call SaveInteger(HY, h2,'hrpl'+ i, k)
		call SaveInteger(HY, h1,'bapl'+ i, id2)
		call SaveInteger(HY, h2,'bapl'+ i, id1)
		set i = i -1
	exitwhen i < 0
	endloop
	set u3 = null
	set u2 = null
	set u1 = null
endfunction
function ZUO takes unit u1, unit u2, player p1, player p2 returns nothing
	local unit d= null
	local group g = null
	local item NKO = null
	local integer ZZO
	local integer i = 1
	local integer array Z_O
	if u1 == null and u2 == null then
		set d = null
		call PlayerSwap(p1, p2)
		call FlushChildHashtable(HY, 800 + GetPlayerId(p2))
		call FlushChildHashtable(HY, 800 + GetPlayerId(p1))
		return
	endif
	set d = CreateUnit(p1,'e01F', 0, 0, 0)
	if FT[GetPlayerId(p1)]then
		if GetPlayerState(p1, PLAYER_STATE_RESOURCE_GOLD)< 100 then
			return
		endif
	endif
	if FT[GetPlayerId(p2)]then
		if GetPlayerState(p2, PLAYER_STATE_RESOURCE_GOLD)< 100 then
			return
		endif
	endif
	if FT[GetPlayerId(p1)]and KS[GetPlayerId(p1)]== false and TF[GetPlayerId(p1)]== 0 then
		set TF[GetPlayerId(p1)]= 1
		call SetPlayerState(p1, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p1, PLAYER_STATE_RESOURCE_GOLD)- 100 )
	endif
	if FT[GetPlayerId(p2)]and KS[GetPlayerId(p2)]== false and TF[GetPlayerId(p2)]== 0 then
		set TF[GetPlayerId(p2)]= 1
		call SetPlayerState(p2, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p2, PLAYER_STATE_RESOURCE_GOLD)- 100 )
	endif
	set ZZO = EUV[GetPlayerId(p1)]
	set EUV[GetPlayerId(p1)]= EUV[GetPlayerId(p2)]
	set EUV[GetPlayerId(p2)]= ZZO
	call DisableTrigger(CUV)
	if GetUnitAbilityLevel(u1,'A03E')> 0 then
		set IM = u1
		set AM = u2
		call ExecuteFunc("Z0O")
	elseif GetUnitAbilityLevel(u2,'A03E')> 0 then
		set IM = u2
		set AM = u1
		call ExecuteFunc("Z0O")
	endif
	if GetUnitAbilityLevel(u1,'A0CY')> 0 then
		set IM = u1
		set AM = u2
		call ExecuteFunc("Z1O")
	endif
	if GetUnitAbilityLevel(u2,'A0CY')> 0 then
		set IM = u2
		set AM = u1
		call ExecuteFunc("Z1O")
	endif
	call FlushChildHashtable(HY,(800 + GetPlayerId(GetOwningPlayer(u1))))
	call FlushChildHashtable(HY,(800 + GetPlayerId(GetOwningPlayer(u2))))
	set g = LoginGroup(105)
	set bj_groupEnumOwningPlayer = p1
	call GroupEnumUnitsInRect(g, GetWorldBounds(), filterGetUnitsInRectOfPlayer)
	call ForGroup(g, function ZTO)
	call LogoutGroup(g)
	set g = LoginGroup(106)
	set bj_groupEnumOwningPlayer = p2
	call GroupEnumUnitsInRect(g, GetWorldBounds(), filterGetUnitsInRectOfPlayer)
	call ForGroup(g, function ZTO)
	call LogoutGroup(g)
	call SetUnitOwner(u2, p1, true)
	call SetUnitOwner(u1, p2, true)
	set Player__Hero[GetPlayerId(p1)]= u2
	set PlayerHeroTypeId[GetPlayerId(p1)]= GetUnitTypeId(u2)
	call SaveInteger(HY, GetPlayerId(p1),'hHid', GetUnitPointValue(u2))
	set Player__Hero[GetPlayerId(p2)]= u1
	call SaveInteger(HY, GetPlayerId(p2),'hHid', GetUnitPointValue(u1))
	set PlayerHeroTypeId[GetPlayerId(p2)]= GetUnitTypeId(u1)
	call SetPlayerName(p1,(VMV[GetPlayerId((p1))])+ " (" + EJX(Player__Hero[GetPlayerId(p1)])+ ")")
	call SetPlayerName(p2,(VMV[GetPlayerId((p2))])+ " (" + EJX(Player__Hero[GetPlayerId(p2)])+ ")")
	call UnitAddItem(d, UnitItemInSlot(u2, 0))
	call UnitAddItem(d, UnitItemInSlot(u2, 1))
	call UnitAddItem(d, UnitItemInSlot(u2, 2))
	call UnitAddItem(d, UnitItemInSlot(u2, 3))
	call UnitAddItem(d, UnitItemInSlot(u2, 4))
	call UnitAddItem(d, UnitItemInSlot(u2, 5))
	set NKO = UnitItemInSlot(u1, 0)
	if NKO != null then
		call SetItemPlayer(NKO, p1, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u2, NKO)
	endif
	set NKO = UnitItemInSlot(u1, 1)
	if NKO != null then
		call SetItemPlayer(NKO, p1, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u2, NKO)
	endif
	set NKO = UnitItemInSlot(u1, 2)
	if NKO != null then
		call SetItemPlayer(NKO, p1, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u2, NKO)
	endif
	set NKO = UnitItemInSlot(u1, 3)
	if NKO != null then
		call SetItemPlayer(NKO, p1, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u2, NKO)
	endif
	set NKO = UnitItemInSlot(u1, 4)
	if NKO != null then
		call SetItemPlayer(NKO, p1, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u2, NKO)
	endif
	set NKO = UnitItemInSlot(u1, 5)
	if NKO != null then
		call SetItemPlayer(NKO, p1, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u2, NKO)
	endif
	set NKO = UnitItemInSlot(d, 0)
	if NKO != null then
		call SetItemPlayer(NKO, p2, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u1, NKO)
	endif
	set NKO = UnitItemInSlot(d, 1)
	if NKO != null then
		call SetItemPlayer(NKO, p2, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u1, NKO)
	endif
	set NKO = UnitItemInSlot(d, 2)
	if NKO != null then
		call SetItemPlayer(NKO, p2, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u1, NKO)
	endif
	set NKO = UnitItemInSlot(d, 3)
	if NKO != null then
		call SetItemPlayer(NKO, p2, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u1, NKO)
	endif
	set NKO = UnitItemInSlot(d, 4)
	if NKO != null then
		call SetItemPlayer(NKO, p2, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u1, NKO)
	endif
	set NKO = UnitItemInSlot(d, 5)
	if NKO != null then
		call SetItemPlayer(NKO, p2, false)
		call SetItemUserData(NKO, 1)
		call UnitAddItem(u1, NKO)
	endif
	call RemoveUnit(d)
	call EnableTrigger(CUV)
	call S9E(p1, HeroChangeAbilitySkills[PlayerSkillIndex[GetPlayerId(p2)* HL + 1]], false)
	call S9E(p1, HeroChangeAbilitySkills[PlayerSkillIndex[GetPlayerId(p2)* HL + 2]], false)
	call S9E(p1, HeroChangeAbilitySkills[PlayerSkillIndex[GetPlayerId(p2)* HL + 3]], false)
	call S9E(p1, HeroChangeAbilitySkills[PlayerSkillIndex[GetPlayerId(p2)* HL + 4]], false)
	call S9E(p2, HeroChangeAbilitySkills[PlayerSkillIndex[GetPlayerId(p1)* HL + 1]], false)
	call S9E(p2, HeroChangeAbilitySkills[PlayerSkillIndex[GetPlayerId(p1)* HL + 2]], false)
	call S9E(p2, HeroChangeAbilitySkills[PlayerSkillIndex[GetPlayerId(p1)* HL + 3]], false)
	call S9E(p2, HeroChangeAbilitySkills[PlayerSkillIndex[GetPlayerId(p1)* HL + 4]], false)
	loop
	exitwhen i > 4 + ExtraAbilitiesNum  
		set Z_O[i]= PlayerSkillIndex[GetPlayerId(p1)* HL + i]
		set PlayerSkillIndex[GetPlayerId(p1)* HL + i]= PlayerSkillIndex[GetPlayerId(p2)* HL + i]
		set PlayerSkillIndex[GetPlayerId(p2)* HL + i]= Z_O[i]
		set i = i + 1
	endloop
	call ClearSelectionForPlayer(p1)
	call SelectUnitAddForPlayer(u2, p1)
	call ClearSelectionForPlayer(p2)
	call SelectUnitAddForPlayer(u1, p2)
	call FlushChildHashtable(HY,(800 + GetPlayerId(p1)))
	call FlushChildHashtable(HY,(800 + GetPlayerId(p2)))
	call JMX(GetOwningPlayer(u1), "9", GetUnitTypeId(u1))
	call JMX(GetOwningPlayer(u2), "9", GetUnitTypeId(u2))
	call JSX("SWAP_" + I2S(GetPlayerId(GetOwningPlayer(u1)))+ "_" + I2S(GetPlayerId(GetOwningPlayer(u2))), GetUnitTypeId(u1))
	call JSX("SWAP_" + I2S(GetPlayerId(GetOwningPlayer(u2)))+ "_" + I2S(GetPlayerId(GetOwningPlayer(u1))), GetUnitTypeId(u2))
	call KTX(p1)
	call KTX(p2)
	if GKV or Mode__MirrorDraft then
		set KS[GetPlayerId(p1)]= true
		set KS[GetPlayerId(p2)]= true
	endif
	set p1 = null
	set p2 = null
	set g = null
	set d = null
	set NKO = null
endfunction
function Z2O takes unit u1, unit u2, player p1, player p2 returns boolean
	if u1 != null and u2 != null then
		return(LoadBoolean(HY,(800 + GetPlayerId(GetOwningPlayer(u2))),(GetUnitTypeId(u1)+ GetUnitTypeId(u2))))
	endif
	return(LoadBoolean(HY,(800 + GetPlayerId(p2)), GetPlayerId(p1)))
endfunction
function Z3O takes player p returns integer
	local integer i = 1
	loop
	exitwhen i > 5
		if Sentinels[i]== p or Scourges[i]== p then
			return i
		endif
		set i = i + 1
	endloop
	return -1
endfunction
function Z4O takes unit u1, unit u2, boolean Z5O, player p1, player p2 returns boolean
	if u1 != null and u2 != null then
		call SaveBoolean(HY,(800 + GetPlayerId(GetOwningPlayer(u1))),(GetUnitTypeId(u1)+ GetUnitTypeId(u2)),(true))
		if Z2O(u1, u2, p1, p2) then
			call ZUO(u1, u2, p1, p2)
			return true
		else
			call DisplayTimedTextToPlayer(GetOwningPlayer(u2), 0, 0, 30, "  ")
			call DisplayTimedTextToPlayer(GetOwningPlayer(u2), 0, 0, 30, "						 " + JS[GetPlayerId(GetOwningPlayer(u1))]+ GetUnitName(u1)+ "|r |cff99ccff" + GetObjectName('n082')+ " " + GetObjectName('n083')+ "|r |c00ff0303-swap " + I2S(Z3O(GetOwningPlayer(u1)))+ "|r |cff99ccff" + GetObjectName('n081')+ "|r")
			call DisplayTimedTextToPlayer(GetOwningPlayer(u2), 0, 0, 30, "  ")
			if GKV or Mode__MirrorDraft then
				call DisplayTimedTextToPlayer(GetOwningPlayer(u2), 0, 0, 30, "|c00ff0000WARNING:|r 所选模式禁止repick之后交换英雄.")
			endif
			if Z5O then
				call DisplayTimedTextToPlayer(GetOwningPlayer(u1), 0, 0, 30, "  ")
				call DisplayTimedTextToPlayer(GetOwningPlayer(u1), 0, 0, 30, "|cff99ccff" + GetObjectName('n08C')+ " |r" + JS[GetPlayerId(GetOwningPlayer(u2))]+ GetUnitName(u2)+ "|r")
				call DisplayTimedTextToPlayer(GetOwningPlayer(u1), 0, 0, 30, "  ")
				if GKV or Mode__MirrorDraft then
					call DisplayTimedTextToPlayer(GetOwningPlayer(u1), 0, 0, 30, "|c00ff0000WARNING:|r 所选模式禁止repick之后交换英雄.")
				endif
			endif
		endif
	else
		call SaveBoolean(HY,(800 + GetPlayerId(p1)), GetPlayerId(p2),(true))
		if Z2O(u1, u2, p1, p2) then
			call ZUO(u1, u2, p1, p2)
			return true
		else
			call DisplayTimedTextToPlayer(p2, 0, 0, 30, "  ")
			call DisplayTimedTextToPlayer(p2, 0, 0, 30, "						 " + JS[GetPlayerId(p1)]+ VMV[GetPlayerId(p1)]+ "|r |cff99ccff" + GetObjectName('n082')+ " " + GetObjectName('n083')+ "|r |c00ff0303-swap " + I2S(Z3O(p1))+ "|r |cff99ccff" + GetObjectName('n081')+ "|r")
			call DisplayTimedTextToPlayer(p2, 0, 0, 30, "  ")
			if Z5O then
				call DisplayTimedTextToPlayer(p1, 0, 0, 30, "  ")
				call DisplayTimedTextToPlayer(p1, 0, 0, 30, "|cff99ccff" + GetObjectName('n08C')+ " |r" + JS[GetPlayerId(p2)]+ VMV[GetPlayerId(p2)]+ "|r")
				call DisplayTimedTextToPlayer(p1, 0, 0, 30, "  ")
			endif
		endif
	endif
	return false
endfunction
function Z6O takes nothing returns nothing
	local integer i = S2I(SubString(GetEventPlayerChatString(), 6, StringLength(GetEventPlayerChatString())))
	local player p = GetTriggerPlayer()
	if GetEventPlayerChatString()== "-swapall"then
		set i = 1
		set W2 = Player__Hero[GetPlayerId(p)]
		loop
		exitwhen i > 5
			if IsSentinelsPlayer(p) then
				set E3 = Sentinels[i]
			else
				set E3 = Scourges[i]
			endif
			set U2 = Player__Hero[GetPlayerId(E3)]
			if not(W2 == null or GetOwningPlayer(W2)!= p or U2 == null or GetOwningPlayer(U2)!= E3 or E3 == p) then
				if Z4O(W2, U2, false, p, E3) then
					return
				endif
			endif
			set i = i + 1
		endloop
		return
	elseif i < 1 or i > 5 then
		call InterfaceErrorForPlayer(p, GetObjectName('n02Z'))
		return
	elseif InHeroSelection then
		if IsSentinelsPlayer(p) then
			set E3 = Sentinels[i]
		else
			set E3 = Scourges[i]
		endif
		if not IsPlaying(E3) or E3 == p then
			call InterfaceErrorForPlayer(p, GetObjectName('n02Z'))
			return
		endif
	endif
	set W2 = Player__Hero[GetPlayerId(p)]
	if IsSentinelsPlayer(p) then
		set E3 = Sentinels[i]
	else
		set E3 = Scourges[i]
	endif
	set U2 = Player__Hero[GetPlayerId(E3)]
	if InHeroSelection then
		if not((GKV or Mode__MirrorDraft) and IsPlaying(E3) and E3 != p) then
			call InterfaceErrorForPlayer(p, GetObjectName('n02Z'))
			return
		endif
	elseif W2 == null or GetOwningPlayer(W2)!= p or U2 == null or GetOwningPlayer(U2)!= E3 or E3 == p then
		call InterfaceErrorForPlayer(p, GetObjectName('n02Z'))
		return
	endif
	call Z4O(W2, U2, true, p, E3)
endfunction
function Z7O takes nothing returns nothing
	local integer i
	local player p
	local unit u
	local string s
	if LocalPlayer== GetTriggerPlayer() then
		call ClearTextMessages()
	endif
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 45, "|cff99ccff" + GetObjectName('n08B')+ "|r")
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 45, " ")
	set i = 1
	loop
	exitwhen i > 5
		set p = Sentinels[i]
		set u = Player__Hero[GetPlayerId(p)]
		if IsPlayerAlly(GetTriggerPlayer(), p) and GetTriggerPlayer()!= p and u != null and GetOwningPlayer(u)== p then
			set s = " "
			if Z2O(Player__Hero[GetPlayerId(GetTriggerPlayer())], u, GetTriggerPlayer(), p) then
				set s = " |c00ff0303(" + GetObjectName('n085')+ ")|r"
			endif
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 45, JS[GetPlayerId(p)]+ I2S(i)+ "|r" + " - " + "|cff99ccff" + GetUnitName(u)+ "|r" + s)
		endif
		set p = Scourges[i]
		set u = Player__Hero[GetPlayerId(p)]
		if IsPlayerAlly(GetTriggerPlayer(), p) and GetTriggerPlayer()!= p and u != null and GetOwningPlayer(u)== p then
			set s = " "
			if Z2O(Player__Hero[GetPlayerId(GetTriggerPlayer())], u, GetTriggerPlayer(), p) then
				set s = " |c00ff0303(" + GetObjectName('n085')+ ")|r"
			endif
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 45, JS[GetPlayerId(p)]+ I2S(i)+ "|r" + " - " + "|cff99ccff" + GetUnitName(u)+ "|r" + s)
		endif
		set i = i + 1
	endloop
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 45, " ")
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 45, "|cff99ccff" + GetObjectName('n083')+ "|r |c00ff0303-swap #|r |cff99ccff" + GetObjectName('n086')+ " -swapcancel " + GetObjectName('n087')+ "|r")
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 45, " ")
	set u = null
	set p = null
endfunction
function Z8O takes player VBX returns boolean
	local integer O3X = 1
	local integer Z9O = 0
	loop
	exitwhen O3X > 5
		if IsSentinelsPlayer(VBX) then
			if Player__Hero[GetPlayerId(Sentinels[O3X])]!= null and Sentinels[O3X]!= VBX and GetHeroLevel(Player__Hero[GetPlayerId(Sentinels[O3X])])== 1 then
				set Z9O = Z9O + 1
			endif
		else
			if Player__Hero[GetPlayerId(Scourges[O3X])]!= null and Scourges[O3X]!= VBX and GetHeroLevel(Player__Hero[GetPlayerId(Scourges[O3X])])== 1 then
				set Z9O = Z9O + 1
			endif
		endif
		set O3X = O3X + 1
	endloop
	if Z9O > 0 then
		return true
	else
		return false
	endif
endfunction
function VVR takes nothing returns boolean
	if Mode__NoRepick or Mode__NoSwap then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "-swaphero " + GetObjectName('n088'))
		return false
	endif
	if FT[GetPlayerId(GetTriggerPlayer())]then
		if GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD)< 100  then
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "在random之后需要至少100大洋才可以swap.")
			return false
		endif
	endif
	// if GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetTriggerPlayer())],'A0CL')> 0 then
	// 	 call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "由于你选择了某些技能，所以不能swap。")
	// 	 return false
	// endif
	if GetWidgetLife(Player__Hero[GetPlayerId(GetTriggerPlayer())])< 1 and(not InHeroSelection or not(GKV or Mode__MirrorDraft)) then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n08F'))
		return false
	endif
	if B3 then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n08G')+ " -swaphero.")
		return false
	endif
	if Z8O(GetTriggerPlayer())== false and(not InHeroSelection or not(GKV or Mode__MirrorDraft)) then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n08H'))
		return false
	endif
	return true
endfunction
function Y1O takes nothing returns nothing
	if VVR() then
		if GetEventPlayerChatString()== "-swap"or GetEventPlayerChatString()== "-swaphero"then
			call Z7O()
		elseif GetEventPlayerChatString()== "-swapcancel"then
			call FlushChildHashtable(HY,(800 + GetPlayerId(GetTriggerPlayer())))
		else
			call Z6O()
		endif
	endif
endfunction
function VER takes nothing returns boolean
	local integer VXR = GetUnitTypeId(Player__Hero[GetPlayerId(GetTriggerPlayer())])
	return(VXR =='U008' or VXR =='U007' or VXR =='Hlgr' or VXR =='Eevi' or VXR =='Ekee') and(RectContainsUnit(O0, Player__Hero[GetPlayerId(GetTriggerPlayer())]) or RectContainsUnit(R0, Player__Hero[GetPlayerId(GetTriggerPlayer())]))
endfunction
function VOR takes nothing returns nothing
	local unit triggerUnit = Player__Hero[GetPlayerId(GetTriggerPlayer())]
	call UnitAddAbility(triggerUnit,'A0FI')
	call IssueImmediateOrderById(triggerUnit,$D02B7)
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 120., "|c00ff0303" + GetObjectName('n08I')+ " " + EJX(GetEnumUnit())+ ". " + GetObjectName('n08J')+ "|r")
	set triggerUnit = null
endfunction
function VRR takes nothing returns nothing
	if VER() then
		call VOR()
	endif
endfunction
function VIR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local integer EVX = GetTriggerEvalCount(t)
	local real x
	local real y
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or EVX > 60 then
		if((LoadInteger(HY,(GetHandleId((triggerUnit))),(4259)))== 1)== false then
			if IsSentinelsPlayer(GetOwningPlayer(triggerUnit)) then
				set x = GetRectCenterX(VZ)
				set y = GetRectCenterY(VZ)
			else
				set x = GetRectCenterX(GY)
				set y = GetRectCenterY(GY)
			endif
			call SetUnitPosition(triggerUnit, x, y)
			call PauseUnit(triggerUnit, false)
			call ShowUnit(triggerUnit, true)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call PauseUnit(triggerUnit, true)
	endif
	set t = null
	set triggerUnit = null
	return false
endfunction
function VAR takes player p returns nothing
	local unit triggerUnit = Player__Hero[GetPlayerId(p)]
	local trigger t
	if UnitAlive(triggerUnit) then
		set t = CreateTrigger()
		call DisplayTimedTextToPlayer(p, 0, 0, 30., GetObjectName('n08K'))
		call UnitRemoveBuffs(triggerUnit, true, false)
		call UnitRemoveAbility(triggerUnit,'Bcyc')
		call UnitRemoveAbility(triggerUnit,'Bcy2')
		call UnitRemoveAbility(triggerUnit,'B02J')
		call UnitRemoveAbility(triggerUnit,'BUsp')
		call UnitRemoveAbility(triggerUnit,'Bust')
		call UnitRemoveAbility(triggerUnit,'B02F')
		call PauseUnit(triggerUnit, true)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerRegisterDeathEvent(t, triggerUnit)
		call TriggerAddCondition(t, Condition(function VIR))
		call SaveUnitHandle(HY,(GetHandleId(t)), 14,(triggerUnit))
	endif
	set p = null
	set triggerUnit = null
	set t = null
endfunction
function VNR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player p =(LoadPlayerHandle(HY, h, 54))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED then
		call VAR(p)
	endif
	set t = null
	set p = null
	return false
endfunction
function VBR takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local unit triggerUnit = Player__Hero[GetPlayerId(p)]
	local trigger t
	if UnitAlive(triggerUnit) then
		set t = CreateTrigger()
		call TriggerRegisterTimerEvent(t, 3.5, false)
		call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(t, Condition(function VNR))
		call SavePlayerHandle(HY,(GetHandleId(t)), 54,(p))
	endif
	set p = null
	set triggerUnit = null
	set t = null
endfunction
function VCR takes player p returns string
	local string s = BY[GetPlayerId(p)]
	if BY[GetPlayerId(p)]!= "Here"then
		return" |c00ff0303(" + GetObjectName('n089')+ " at " + SubString(s, 10, StringLength(s))+ "|c00ff0303)|r"
	endif
	return" "
endfunction
function VDR takes nothing returns nothing
	local integer O3X = 1
	local integer K0X = 5
	local integer ADX
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 20, " ")
	if(IsScourgesPlayer(GetTriggerPlayer())) then
		loop
		exitwhen O3X > K0X
			set ADX = GetPlayerId(Sentinels[O3X])
			if(Player__Hero[ADX]!= null) then
				call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 20, JS[ADX]+(VMV[GetPlayerId((Sentinels[O3X]))])+ "|r " + GetObjectName('n08M')+ " " + GetUnitName(Player__Hero[ADX])+ " (" + GetObjectName('n08L')+ " " + I2S(GetUnitLevel(Player__Hero[ADX]))+ ")" + VCR(Sentinels[O3X]))
			endif
			set O3X = O3X + 1
		endloop
	else
		loop
		exitwhen O3X > K0X
			set ADX = GetPlayerId(Scourges[O3X])
			if(Player__Hero[ADX]!= null) then
				call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 20, JS[ADX]+(VMV[GetPlayerId((Scourges[O3X]))])+ "|r " + GetObjectName('n08M')+ " " + GetUnitName(Player__Hero[ADX])+ " (" + GetObjectName('n08L')+ " " + I2S(GetUnitLevel(Player__Hero[ADX]))+ ")" + VCR(Scourges[O3X]))
			endif
			set O3X = O3X + 1
		endloop
	endif
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 20, " ")
endfunction
function VFR takes unit u returns boolean
	return GetUnitTypeId(u)=='N01O' or GetUnitTypeId(u)=='N013' or GetUnitTypeId(u)=='N014' or GetUnitTypeId(u)=='N015'
endfunction
function VGR takes unit u returns unit
	local integer h = GetHandleId(GetOwningPlayer(u))
	return(LoadUnitHandle(HY, h, 333))
endfunction
function VHR takes nothing returns nothing
	local unit u
	local integer i = 0
	if(Player__Hero[GetPlayerId(GetTriggerPlayer())]== null) then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., GetObjectName('n08A'))
	else
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., GetUnitName(Player__Hero[GetPlayerId(GetTriggerPlayer())])+ " " + GetObjectName('n08N')+ " " + I2S(R2I(.5 + GetUnitMoveSpeedEx(Player__Hero[GetPlayerId(GetTriggerPlayer())]))))
		if VFR(Player__Hero[GetPlayerId(GetTriggerPlayer())]) then
			set u = VGR(Player__Hero[GetPlayerId(GetTriggerPlayer())])
			if u != null then
				call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., GetUnitName(u)+ " " + GetObjectName('n08N')+ " " + I2S(R2I(.5 + GetUnitMoveSpeedEx(u))))
			endif
		endif
	endif
	set u = null
endfunction
function YFO takes nothing returns nothing
	local unit u
	local integer i = 0
	local group g = LoginGroup(107)
	call GroupEnumUnitsSelected(g, GetTriggerPlayer(), TrueBoolexprCondition)
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call SingleDebug(GetUnitName(u)+ " ms = " + R2S(GetUnitMoveSpeedEx(u)))
		call GroupRemoveUnit(g, u)
	endloop
	call LogoutGroup(g)
endfunction
function VJR takes nothing returns nothing
	local unit u
	local integer i = 0
	if(Player__Hero[GetPlayerId(GetTriggerPlayer())]== null) then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., GetObjectName('n08A'))
	else
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., GetUnitName(Player__Hero[GetPlayerId(GetTriggerPlayer())])+ " " + GetObjectName('n08N')+ " " + I2S(R2I(.5 + GetUnitMoveSpeedEx(Player__Hero[GetPlayerId(GetTriggerPlayer())]))))
		if VFR(Player__Hero[GetPlayerId(GetTriggerPlayer())]) then
			set u = VGR(Player__Hero[GetPlayerId(GetTriggerPlayer())])
			if u != null then
				call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., GetUnitName(u)+ " " + GetObjectName('n08N')+ " " + I2S(R2I(.5 + GetUnitMoveSpeedEx(u))))
			endif
		endif
		loop
		exitwhen i > 16
			set u = Player__Hero[i]
			if u != null and u != Player__Hero[GetPlayerId(GetTriggerPlayer())]and IsUnitAlly(u, GetTriggerPlayer()) then
				call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., GetUnitName(u)+ " " + GetObjectName('n08N')+ " " + I2S(R2I(.5 + GetUnitMoveSpeedEx(u))))
			endif
			set i = i + 1
		endloop
	endif
	set u = null
endfunction
function VKR takes nothing returns nothing
	call SaveBoolean(HY, GetHandleId(GetTriggerPlayer()),$8B, true)
	call GetSetUpText(GetObjectName('n08R'), true)
	//call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n08R'))
endfunction
function VLR takes nothing returns nothing
	call SaveBoolean(HY, GetHandleId(GetTriggerPlayer()),$8B, false)
	call GetSetUpText(GetObjectName('n08R'), false)
	//call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n08O'))
endfunction
function VMR takes nothing returns nothing
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., "   " + GetObjectName('n08P')+ " " + I2S(AQ[GetPlayerId(GetTriggerPlayer())])+ " " + GetObjectName('n08Q')+ " " + I2S(NQ[GetPlayerId(GetTriggerPlayer())])+ " " + GetObjectName('n08S')+ " " + I2S(BQ[GetPlayerId(GetTriggerPlayer())]))
endfunction
function VPR takes nothing returns nothing
	local integer x = GetPlayerId(GetTriggerPlayer())
	if(GetEventPlayerChatString()== "-cson") then
		set U3[x]= true
		set F6V[x]= true
	else
		set U3[x]= false
		set F6V[x]= false
	endif
endfunction
function Set_Disableselection takes player p returns nothing
	call Set_CheckBox_Nothing(p, 7, false)
	set F_V[GetPlayerId(p)]= false
	call DisplayTimedTextToPlayer(p, 0, 0, 5, GetObjectName('n0JZ'))
endfunction
function VQR takes nothing returns nothing
	call Set_Disableselection(GetTriggerPlayer())
endfunction
function Set_Enableselection takes player p returns nothing
	call Set_CheckBox_Nothing(p, 7, true)
	set F_V[GetPlayerId(p)]= true
	call DisplayTimedTextToPlayer(p, 0, 0, 5, GetObjectName('n0K0'))
endfunction
function VSR takes nothing returns nothing
	call Set_Enableselection(GetTriggerPlayer())
endfunction
function VTR takes nothing returns nothing
	local integer i = 0
	local integer id = GetPlayerId(GetTriggerPlayer())
	local integer EVX = 0
	local integer VUR = 0
	local player p
	if F1V == false or YS == false then
		return
	endif
	if F3V + 90 <(GetGameTime()) then
		loop
		exitwhen i >$F
			set F2V[i]= false
			set i = i + 1
		endloop
	endif
	set F3V =(GetGameTime())+ 90
	set F2V[id]= true
	set i = 0
	loop
	exitwhen i >$F
		if IsSentinelsPlayer(GetTriggerPlayer()) then
			if IsSentinelsPlayer(Player(i)) and IsPlaying(Player(i)) then
				set VUR = VUR + 1
				if F2V[i]then
					set EVX = EVX + 1
				endif
			endif
		else
			if IsScourgesPlayer(Player(i)) and IsPlaying(Player(i)) then
				set VUR = VUR + 1
				if F2V[i]then
					set EVX = EVX + 1
				endif
			endif
		endif
		set i = i + 1
	endloop
	if EVX * 2 > VUR then
		if IsSentinelsPlayer(GetTriggerPlayer()) then
			set i = 0
			loop
			exitwhen i > 5
				set p = Sentinels[i]
				if EJV[GetPlayerId(p)]and F0V[GetPlayerId(p)]== false then
					call DisplayTimedTextToAllPlayer(RW, 10, GetObjectName('n0KD')+ " " +(VMV[GetPlayerId((p))]))
					call C2X(p)
					set F0V[GetPlayerId(p)]= true
				endif
				set i = i + 1
			endloop
		else
			set i = 0
			loop
			exitwhen i > 5
				set p = Scourges[i]
				if EJV[GetPlayerId(p)]and F0V[GetPlayerId(p)]== false then
					call DisplayTimedTextToAllPlayer(IW, 10, GetObjectName('n0KD')+ " " +(VMV[GetPlayerId((p))]))
					call C2X(p)
					set F0V[GetPlayerId(p)]= true
				endif
				set i = i + 1
			endloop
		endif
	else
		if IsSentinelsPlayer(GetTriggerPlayer()) then
			call DisplayTimedTextToAllPlayer(RW, 10, GetObjectName('n0KB')+ " " + I2S(EVX)+ "/" + I2S(VUR)+ " (" +(VMV[GetPlayerId((GetTriggerPlayer()))])+ ")")
		else
			call DisplayTimedTextToAllPlayer(IW, 10, GetObjectName('n0KB')+ " " + I2S(EVX)+ "/" + I2S(VUR)+ " (" +(VMV[GetPlayerId((GetTriggerPlayer()))])+ ")")
		endif
	endif
	set p = null
endfunction
function VWR takes nothing returns nothing
	local integer i = 1
	local integer TME
	local boolean VYR
	local boolean Y1X
	local boolean U5V
	local player p
	local boolean VZR = not(M3 or OY)
	local string s = ""
	local integer WIE
	local integer V_R
	local real N3X
	local unit u
	local integer V0R
	local integer k = 1
	local integer c = LoadInteger(HY, GetHandleId(GetExpiredTimer()), 0)+ 1
	call SaveInteger(HY, GetHandleId(GetExpiredTimer()), 0, c)
	loop
		set i = 1
		loop
			set V_R = 0
			set s = "	"
			if k == 1 then
				set p = Sentinels[i]
			else
				set p = Scourges[i]
			endif
			if IsPlaying(p) then
				set TME = GetPlayerId(p)
				set WIE = R2I(TimerGetRemaining(PS[TME]))
				set VYR = WIE > 0 and F4V[TME]and VZR
				if VYR then
					set s = s + "即将复活: " + I2S(WIE)+ "|n"
					set V_R = 1
				endif
				if ModuloInteger(c, 2)== 1 then
					call Y9X(p)
				endif
				if HaveSavedHandle(K, GetHandleId(p),'COUR') and(LoadBoolean(K, GetHandleId(p),'UIds') or UnitIsDead(LoadUnitHandle(K, GetHandleId(p),'COUR'))) then
					set V_R = 1
					set u = LoadUnitHandle(K, GetHandleId(p),'COUR')
					set V0R = GetPlayerId(GetOwningPlayer(u))
					set s = s + JS[V0R]+ "信使|r: "
					if UnitIsDead(u) then
						set s = s + "|c00ff0000死亡|r (" + I2S(R2I(GetGameTime()-LoadReal(HY, GetHandleId(u),'DEAD'))*-1)+ "s)"
					else
						set s = s + LoadStr(K, GetHandleId(u),'ORDR')
					endif
				endif
				if V_R > 0 then
					call LeaderboardDisplay(F5V[TME], true)
					call LeaderboardSetLabel(F5V[TME], s)
					call PlayerSetLeaderboard(p, F5V[TME])
				elseif IsLeaderboardDisplayed(F5V[TME]) then
					call LeaderboardDisplay(F5V[TME], false)
				endif
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
		set k = k + 1
	exitwhen k > 2
	endloop
	set u = null
endfunction
function V1R takes nothing returns nothing
	local integer i = 1
	local integer TME
	local timer t = CreateTimer()
	call TimerStart(t, 1, true, function VWR)
	set t = null
	loop
		set TME = GetPlayerId(Sentinels[i])
		set F5V[TME]= CreateLeaderboard()
		call PlayerSetLeaderboard(Sentinels[i], F5V[TME])
		call LeaderboardDisplay(F5V[TME], false)
		call LeaderboardSetLabel(F5V[TME], "Default string")
		set TME = GetPlayerId(Scourges[i])
		set F5V[TME]= CreateLeaderboard()
		call PlayerSetLeaderboard(Scourges[i], F5V[TME])
		call LeaderboardDisplay(F5V[TME], false)
		call LeaderboardSetLabel(F5V[TME], "Default string")
		set i = i + 1
	exitwhen i > 5
	endloop
endfunction
function V2R takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer x = GetPlayerId(p)
	if GetEventPlayerChatString()== "-don"or GetEventPlayerChatString()== "-deathon"then
		call Set_CheckBox_Nothing(p, 18, true)
		set F4V[x]= true
		call GetSetUpText("复活计时器窗口", true)
		//call DisplayTimedTextToPlayer(p, 0, 0, 10, GetObjectName('n08W'))
	else
		call Set_CheckBox_Nothing(p, 18, false)
		set F4V[x]= false
		call GetSetUpText("复活计时器窗口", false)
		//call DisplayTimedTextToPlayer(p, 0, 0, 10, GetObjectName('n08X'))
	endif
endfunction
function V3R takes nothing returns nothing
	if(GetEventPlayerChatString()== "-showdeny") then
		set F6V[GetPlayerId(GetTriggerPlayer())]= true
	else
		set F6V[GetPlayerId(GetTriggerPlayer())]= false
	endif
endfunction
function V4R takes nothing returns nothing
	call InterfaceErrorForPlayer(GetTriggerPlayer(), GetObjectName('n0HG'))
endfunction
function V5R takes nothing returns nothing
	local player p = GetTriggerPlayer()
	call ForceRemovePlayer(XY, p)
	call GetSetUpText(GetObjectName('n08U'), true)
	call Set_CheckBox_Nothing(p, 12, true)
endfunction
function V6R takes nothing returns nothing
	local player p = GetTriggerPlayer()
	call ForceAddPlayer(XY, p)
	call GetSetUpText(GetObjectName('n08U'), false)
	call Set_CheckBox_Nothing(p, 12, false)
endfunction
function V7R takes nothing returns boolean
	local integer x = GetRandomInt(1, 4)
	if x == 1 then
		set F8V = E5
	elseif x == 2 then
		set F8V = X5
	elseif x == 3 then
		set F8V = Z4
	elseif x == 4 then
		set F8V = V5
	endif
	if F9V[LocalId]then
		call EnableWeatherEffect(E5, false)
		call EnableWeatherEffect(X5, false)
		call EnableWeatherEffect(Z4, false)
		call EnableWeatherEffect(V5, false)
		call EnableWeatherEffect(F8V, true)
	endif
	return false
endfunction
function V8R takes nothing returns nothing
	local integer x = GetRandomInt(1, 4)
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 300, true)
	call TriggerAddCondition(t, Condition(function V7R))
	set F9V[GetPlayerId(Sentinels[1])]= false
	set F9V[GetPlayerId(Sentinels[2])]= false
	set F9V[GetPlayerId(Sentinels[3])]= false
	set F9V[GetPlayerId(Sentinels[4])]= false
	set F9V[GetPlayerId(Sentinels[5])]= false
	set F9V[GetPlayerId(Scourges[1])]= false
	set F9V[GetPlayerId(Scourges[2])]= false
	set F9V[GetPlayerId(Scourges[3])]= false
	set F9V[GetPlayerId(Scourges[4])]= false
	set F9V[GetPlayerId(Scourges[5])]= false
	if MW then
		set F9V[GetPlayerId(VKV)]= false
		set F9V[GetPlayerId(VLV)]= false
	endif
	if x == 1 then
		set F8V = E5
	elseif x == 2 then
		set F8V = X5
	elseif x == 3 then
		set F8V = Z4
	elseif x == 4 then
		set F8V = V5
	endif
	set t = null
endfunction
function V9R takes nothing returns nothing
	local string EVR = StringCase(GetEventPlayerChatString(), false)
	if F7V then
		set F7V = false
		call V8R()
	endif
	if EVR != "-weather random" then
		set F9V[GetPlayerId(GetTriggerPlayer())]= false
	else
		set F9V[GetPlayerId(GetTriggerPlayer())]= true
	endif
	if LocalPlayer== GetTriggerPlayer() then
		call EnableWeatherEffect(E5, false)
		call EnableWeatherEffect(X5, false)
		call EnableWeatherEffect(Z4, false)
		call EnableWeatherEffect(V5, false)
		if EVR == "-weather snow" then
			call EnableWeatherEffect(E5, true)
		elseif EVR == "-weather rain" then
			call EnableWeatherEffect(X5, true)
		elseif EVR == "-weather moonlight" then
			call EnableWeatherEffect(Z4, true)
		elseif EVR == "-weather wind" then
			call EnableWeatherEffect(V5, true)
		elseif EVR == "-weather random" then
			call EnableWeatherEffect(F8V, true)
		endif
	endif
endfunction
function Y2O takes nothing returns nothing
	local integer a = S2I(SubString(GetEventPlayerChatString(), 6, StringLength(GetEventPlayerChatString())))
	local integer ADX = GetPlayerId(GetTriggerPlayer())
	local integer TTV
	if GetEventPlayerChatString()== "-rollon"or GetEventPlayerChatString()== "-rolloff"then
		return
	endif
	set Q3[ADX]= Q3[ADX]+ 1
	if Q3[ADX]> 20 then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n0DQ'))
		return
	endif
	if a == 0 then
		set a = 100 
	endif
	if a > 0 and a <$7D1 then
		set TTV = GetRandomInt(1, a)
		if S3[LocalId]then
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 5, JS[ADX]+ VMV[ADX]+ "|r " + GetObjectName('n05I')+ " " + I2S(TTV)+ " " + GetObjectName('n05M')+ " " + I2S(a))
		endif
	else
		call InterfaceErrorForPlayer(GetTriggerPlayer(), GetObjectName('n02Y'))
	endif
endfunction
function EER takes nothing returns nothing
	local integer a
	if GetRandomInt(1, 2)== 1 then
		set a = GetRandomInt(VYV, VZV)
	else
		set a = GetRandomInt(1, VWV)
	endif
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n0GS')+ " " + EKX(a))
endfunction
function EXR takes nothing returns nothing
	set S3[GetPlayerId(GetTriggerPlayer())]= false
endfunction
function EOR takes nothing returns nothing
	set S3[GetPlayerId(GetTriggerPlayer())]= true
endfunction
function ERR takes nothing returns nothing
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n090'))
	set NeedHideHeroNames[GetPlayerId(GetTriggerPlayer())]= true
	if LocalPlayer== GetTriggerPlayer() then
		call SetPlayerName(Sentinels[1], VMV[GetPlayerId(Sentinels[1])])
		call SetPlayerName(Sentinels[2], VMV[GetPlayerId(Sentinels[2])])
		call SetPlayerName(Sentinels[3], VMV[GetPlayerId(Sentinels[3])])
		call SetPlayerName(Sentinels[4], VMV[GetPlayerId(Sentinels[4])])
		call SetPlayerName(Sentinels[5], VMV[GetPlayerId(Sentinels[5])])
		call SetPlayerName(Scourges[1], VMV[GetPlayerId(Scourges[1])])
		call SetPlayerName(Scourges[2], VMV[GetPlayerId(Scourges[2])])
		call SetPlayerName(Scourges[3], VMV[GetPlayerId(Scourges[3])])
		call SetPlayerName(Scourges[4], VMV[GetPlayerId(Scourges[4])])
		call SetPlayerName(Scourges[5], VMV[GetPlayerId(Scourges[5])])
	endif
endfunction
function EIR takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer id = GetPlayerId(p)
	call Click_CheckBox_Nothing(p, 11)
	if T3[id]then
		set T3[id]= false
		call DisplayTimedTextToPlayer(p, 0, 0, 10, GetObjectName('n08T'))
	else
		set T3[id]= true
		call DisplayTimedTextToPlayer(p, 0, 0, 10, GetObjectName('n091'))
	endif
endfunction
//-si
function EAR takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer id = GetPlayerId(p)
	set GEV[id] = ( GXV[id] and SetUp_ItemInfo[id] ) //-ii
	set GXV[id] = not GXV[id] // -si
	set SetUp_SkillInfo[id] = GXV[id]
	if LocalPlayer == p then
		call DzFrameSetEnable(UIFrame__CheckBox[5], not GXV[id])
		if not GXV[id] and SetUp_ItemInfo[id] then
			call DzFrameSetEnable(UIFrame__CheckBox[4], false)
		elseif GXV[id] then
			call DzFrameSetEnable(UIFrame__CheckBox[4], true)
		endif
		call DzFrameShow( UIFrame__HighLight[4], GXV[id] )
		set UIFrame__IsCheckBoxEnable[4] = GXV[id]
	endif
endfunction
//-ii
function ENR takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer id = GetPlayerId(p)
	set GXV[id] = ( GEV[id] and SetUp_SkillInfo[id] ) //-si
	set GEV[id] = not GEV[id] //-ii
	set SetUp_ItemInfo[id] = GEV[id]
	if LocalPlayer == p then
		call DzFrameSetEnable(UIFrame__CheckBox[4], not GEV[id])
		if not GEV[id] and SetUp_SkillInfo[id] then
			call DzFrameSetEnable(UIFrame__CheckBox[5], false)
		elseif GEV[id] then
			call DzFrameSetEnable(UIFrame__CheckBox[5], true)
		endif
		call DzFrameShow( UIFrame__HighLight[5], GEV[id] )
		set UIFrame__IsCheckBoxEnable[5] = GEV[id]
	endif
endfunction
function EBR takes nothing returns nothing
	local integer i = 1
	local player p
	local real ECR
	loop
	exitwhen i > 5
		set p = Sentinels[i]
		if IsPlaying(p) then
			set ECR = SQ[GetPlayerId(p)]/(GetGameTime())* 60
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., JS[GetPlayerId(p)]+(VMV[GetPlayerId((p))])+ "|r" + " " + GetObjectName('n084')+ " " + R2S(ECR))
		endif
		set p = Scourges[i]
		if IsPlaying(p) then
			set ECR = SQ[GetPlayerId(p)]/(GetGameTime())* 60
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., JS[GetPlayerId(p)]+(VMV[GetPlayerId((p))])+ "|r" + " " + GetObjectName('n084')+ " " + R2S(ECR))
		endif
		set i = i + 1
	endloop
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., " ")
	set p = null
endfunction
function EDR takes nothing returns nothing
	call B4X(GetTriggerPlayer())
	if GetTriggerEventId()== EVENT_PLAYER_END_CINEMATIC then
		return
	endif
	set BR[GetPlayerId(GetTriggerPlayer())]= BR[GetPlayerId(GetTriggerPlayer())]+ 1
	if(BR[GetPlayerId(GetTriggerPlayer())]== 1) then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "Use command |c00ff0505-fc|r to reduce the duration of kill messages")
	endif
endfunction
function EFR takes player VBX returns nothing
	local integer EGR
	local player EHR
	set EGR = 0
	loop
		set EHR = Player(EGR)
		if(PlayersAreCoAllied(VBX, EHR) and VBX != EHR) then
			call SetPlayerAlliance(VBX, EHR, ALLIANCE_SHARED_VISION, true)
			call SetPlayerAlliance(VBX, EHR, ALLIANCE_SHARED_CONTROL, true)
			call SetPlayerAlliance(EHR, VBX, ALLIANCE_SHARED_CONTROL, true)
		endif
		set EGR = EGR + 1
	exitwhen EGR ==$C
	endloop
	set EHR = null
endfunction
function Y3O takes nothing returns nothing
	local integer ADX = S2I(SubString(GetEventPlayerChatString(), 9, StringLength(GetEventPlayerChatString())))
	local integer i = 1
	local player p
	local string KGX
	if GOV then
		if(TS <$A) then
			set KGX = I2S(QS)+ ":0" + I2S(TS)
		else
			set KGX = I2S(QS)+ ":" + I2S(TS)
		endif
		if ADX < 1 or GRV[ADX]== false then
			loop
			exitwhen i > 5
				set p = Sentinels[i]
				if IsPlaying(p) and((GetGameTime())-TQ[GetPlayerId(p)])> 300. and GRV[GetPlayerId(p)]== false and not InHeroSelection then
					set GRV[GetPlayerId(p)]= true
					call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., JS[GetPlayerId(p)]+(VMV[GetPlayerId((p))])+ "|r" + " " + GetObjectName('n05G')+ " " + R2S(((GetGameTime())-TQ[GetPlayerId(p)])/ 60)+ " " + GetObjectName('N05F'))
					call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., GetObjectName('n05O')+ " |cff99ccff-kickafk " + I2S(GetPlayerId(p))+ " |r " + GetObjectName('n05P'))
					call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., " ")
				endif
				set p = Scourges[i]
				if IsPlaying(p) and((GetGameTime())-TQ[GetPlayerId(p)])> 300. and GRV[GetPlayerId(p)]== false and not InHeroSelection then
					set GRV[GetPlayerId(p)]= true
					call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., JS[GetPlayerId(p)]+(VMV[GetPlayerId((p))])+ "|r" + " " + GetObjectName('n05G')+ " " + R2S(((GetGameTime())-TQ[GetPlayerId(p)])/ 60)+ " " + GetObjectName('N05F'))
					call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., GetObjectName('n05O')+ " |cff99ccff-kickafk " + I2S(GetPlayerId(p))+ " |r " + GetObjectName('n05P'))
					call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., " ")
				endif
				set i = i + 1
			endloop
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., " ")
		elseif IsPlaying(Player(ADX)) and IsPlayerAlly(GetTriggerPlayer(), Player(ADX)) then
			call DisplayTimedTextToPlayer(Player(ADX), 0, 0,$E10, "|c00ff0303" + GetObjectName('n05E')+ "|r")
			call L1X(Player(ADX))
			set BY[GetPlayerId(Player(ADX))]= "|c00555555" + KGX + "|r"
			call RemovePlayer(Player(ADX), PLAYER_GAME_RESULT_DEFEAT)
			call EFR(Player(ADX))
			if YS then
				call C0X(Player(ADX))
			endif
			set EJV[GetPlayerId(Player(ADX))]= true
			call L0X(Player(ADX))
			call DisplayTimedTextToAllPlayer(XY, 30., "|c00ff0303" +(VMV[GetPlayerId((Player(ADX)))])+ " " + GetObjectName('n05E')+ "|r")
		endif
	endif
	set p = null
endfunction
function EJR takes nothing returns nothing
	local integer i = 1
	local player p
	local integer x = 0
	if GOV then
		loop
		exitwhen i > 5
			set p = Sentinels[i]
			if IsPlaying(p) and((GetGameTime())-TQ[GetPlayerId(p)])/ 60 > .2 then
				set x = x + 1
				call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., JS[GetPlayerId(p)]+(VMV[GetPlayerId((p))])+ "|r" + " " + GetObjectName('n05D')+ " " + R2S(((GetGameTime())-TQ[GetPlayerId(p)])/ 60)+ " " + GetObjectName('N05F'))
			endif
			set p = Scourges[i]
			if IsPlaying(p) and((GetGameTime())-TQ[GetPlayerId(p)])/ 60 > .2 then
				set x = x + 1
				call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., JS[GetPlayerId(p)]+(VMV[GetPlayerId((p))])+ "|r" + " " + GetObjectName('n05D')+ " " + R2S(((GetGameTime())-TQ[GetPlayerId(p)])/ 60)+ " " + GetObjectName('N05F'))
			endif
			set i = i + 1
		endloop
		if x < 1 then
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., GetObjectName('N05Q'))
		else
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15., " ")
		endif
	endif
	set p = null
endfunction
function HeroGPS takes nothing returns nothing
	local integer i = 1
	local player p
	local integer TME
	local integer k = 0
	loop
		set k = 0
		set p = Sentinels[i]
		if IsPlaying(p) then
			set TME = GetPlayerId(p)
			call JSX("LoD_HeroX_" + I2S(R2I(GetUnitX(Player__Hero[TME]))), TME)
			call JSX("LoD_HeroY_" + I2S(R2I(GetUnitY(Player__Hero[TME]))), TME)
		endif
		set p = Scourges[i]
		if IsPlaying(p) then
			set TME = GetPlayerId(p)
			call JSX("LoD_HeroX_" + I2S(R2I(GetUnitX(Player__Hero[TME]))), TME)
			call JSX("LoD_HeroY_" + I2S(R2I(GetUnitY(Player__Hero[TME]))), TME)
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
endfunction
function EKR takes nothing returns boolean
	local integer i = 1
	local player p
	local real KGX =(GetGameTime())
	if GOV then
		loop
		exitwhen i > 5
			set p = Sentinels[i]
			if IsPlaying(p) and(KGX -TQ[GetPlayerId(p)])> 300. and GRV[GetPlayerId(p)]== false then
				set GRV[GetPlayerId(p)]= true
				call DisplayTimedTextToAllPlayer(RW, 15, JS[GetPlayerId(p)]+(VMV[GetPlayerId((p))])+ "|r" + " " + GetObjectName('n05G')+ " " + R2S((KGX -TQ[GetPlayerId(p)])/ 60)+ " " + GetObjectName('N05F'))
				call DisplayTimedTextToAllPlayer(RW, 15, GetObjectName('n05O')+ " |cff99ccff-kickafk " + I2S(GetPlayerId(p))+ " |r " + GetObjectName('n05P'))
				call DisplayTimedTextToAllPlayer(RW, 15, " ")
			endif
			set p = Scourges[i]
			if IsPlaying(p) and(KGX -TQ[GetPlayerId(p)])> 300. and GRV[GetPlayerId(p)]== false then
				set GRV[GetPlayerId(p)]= true
				call DisplayTimedTextToAllPlayer(IW, 15, JS[GetPlayerId(p)]+(VMV[GetPlayerId((p))])+ "|r" + " " + GetObjectName('n05G')+ " " + R2S((KGX -TQ[GetPlayerId(p)])/ 60)+ " " + GetObjectName('N05F'))
				call DisplayTimedTextToAllPlayer(IW, 15, GetObjectName('n05O')+ " |cff99ccff-kickafk " + I2S(GetPlayerId(p))+ " |r " + GetObjectName('n05P'))
				call DisplayTimedTextToAllPlayer(IW, 15, " ")
			endif
			set i = i + 1
		endloop
	endif
	set p = null
	return false
endfunction
function ELR takes nothing returns boolean
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local integer id = GetIssuedOrderId()
	local player p2
	if p != Sentinels[0]and p != Scourges[0]then
		set SQ[GetPlayerId(p)]= SQ[GetPlayerId(p)]+ 1
		if id !=$D000F then
			set TQ[GetPlayerId(p)]= GetGameTime()
			set GRV[GetPlayerId(p)]= false
		endif
		if(id ==$D000F or id ==851971) and GetOrderTargetItem()!= null then
			if id ==$D000F or(id ==851971 and LoadBoolean(HY, GetHandleId(GetItemPlayer(GetOrderTargetItem())),$8B)) then
				set p2 = GetItemPlayer(GetOrderTargetItem())
				if p2 != p and IsPlayerEnemy(p2, p)== false and XHX(p2)== false and IsPointInRegion(KK, GetItemX(GetOrderTargetItem()), GetItemY(GetOrderTargetItem())) then
					call DisableTrigger(GetTriggeringTrigger())
					call EXStopUnit(u)
					call InterfaceErrorForPlayer(p, GetObjectName('n0G7'))
					call EnableTrigger(GetTriggeringTrigger())
				endif
			endif
		endif
	endif
	set u = null
	return false
endfunction
function EMR takes nothing returns boolean
	return IsMessengerUnit(GetFilterUnit()) and GetOwningPlayer(GetFilterUnit())== GetTriggerPlayer()
endfunction
function EPR takes nothing returns nothing
	local group g = LoginGroup(108)
	call GroupEnumUnitsInRange(g, 0, 0,$2EE0, Condition(function EMR))
	call LogoutGroup(g)
	set g = null
endfunction
function EQR takes string s returns nothing
	call StopMusic(true)
	call PlayMusic(s)
endfunction
function Y5O takes nothing returns nothing
	local string s = GetEventPlayerChatString()
	local integer X1X = GetRandomInt(1, GAV)
	if LocalPlayer== GetTriggerPlayer() then
		if s == "-music off"then
			call StopMusic(false)
		elseif s == "-music random"then
			call EQR(GIV[X1X])
		elseif s == "-music nightelf1"then
			call EQR(QC)
		elseif s == "-music nightelf2"then
			call EQR(UC)
		elseif s == "-music nightelf3"then
			call EQR(V1)
		elseif s == "-music human1"then
			call EQR(XC)
		elseif s == "-music human2"then
			call EQR(YC)
		elseif s == "-music human3"then
			call EQR(JC)
		elseif s == "-music orc1"then
			call EQR(BD)
		elseif s == "-music orc2"then
			call EQR(DD)
		elseif s == "-music orc3"then
			call EQR(ED)
		elseif s == "-music undead1"then
			call EQR(IE)
		elseif s == "-music undead2"then
			call EQR(OE)
		elseif s == "-music undead3"then
			call EQR(AE)
		elseif s == "-music other1"then
			call EQR(FD)
		elseif s == "-music other2"then
			call EQR(GD)
		elseif s == "-music other3"then
			call EQR(HD)
		elseif s == "-music other4"then
			call EQR(ZD)
		elseif s == "-music other5"then
			call EQR(VD)
		elseif s == "-music other6"then
			call EQR(DF)
		elseif s == "-music other7"then
			call EQR(EF)
		elseif s == "-music other8"then
			call EQR(FF)
		elseif s == "-music other9"then
			call EQR(GF)
		elseif s == "-music special"then
			call EQR(GNV)
		else
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n0CW')+ " ")
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "off, random, nightelf1, nightelf2, nightelf3, human1, human2, human3, orc1, orc2, orc3, undead1, undead2, undead3, other1, other2, other3, other4, other5, other6, other7, other8, other9, special")
		endif
	endif
endfunction
function ESR takes nothing returns boolean
	set GAV = GAV + 1
	set GIV[GAV]= QC
	set GAV = GAV + 1
	set GIV[GAV]= UC
	set GAV = GAV + 1
	set GIV[GAV]= V1
	set GAV = GAV + 1
	set GIV[GAV]= XC
	set GAV = GAV + 1
	set GIV[GAV]= YC
	set GAV = GAV + 1
	set GIV[GAV]= JC
	set GAV = GAV + 1
	set GIV[GAV]= BD
	set GAV = GAV + 1
	set GIV[GAV]= DD
	set GAV = GAV + 1
	set GIV[GAV]= ED
	set GAV = GAV + 1
	set GIV[GAV]= IE
	set GAV = GAV + 1
	set GIV[GAV]= OE
	set GAV = GAV + 1
	set GIV[GAV]= AE
	set GAV = GAV + 1
	set GIV[GAV]= FD
	set GAV = GAV + 1
	set GIV[GAV]= GD
	set GAV = GAV + 1
	set GIV[GAV]= HD
	set GAV = GAV + 1
	set GIV[GAV]= ZD
	set GAV = GAV + 1
	set GIV[GAV]= VD
	set GAV = GAV + 1
	set GIV[GAV]= DF
	set GAV = GAV + 1
	set GIV[GAV]= EF
	set GAV = GAV + 1
	set GIV[GAV]= FF
	set GAV = GAV + 1
	set GIV[GAV]= GF
	set GAV = GAV + 1
	set GIV[GAV]= GNV
	return false
endfunction
function ETR takes player p, integer r, integer g, integer b, integer a returns nothing
	if LocalPlayer== p then
		call SetWaterBaseColor(r, g, b, a)
	endif
endfunction
function EUR takes string s returns nothing
	local string EWR = ""
	local string EYR = ""
	local string EZR = ""
	local integer i = 0
	local integer H0X = StringLength(s)
	local integer E_R = 1
	loop
	exitwhen i > H0X
		if SubString(s, i, i + 1)== " "then
			set E_R = E_R + 1
		else
			if E_R == 1 then
				set EWR = EWR + SubString(s, i, i + 1)
			elseif E_R == 2 then
				set EYR = EYR + SubString(s, i, i + 1)
			else
				set EZR = EZR + SubString(s, i, i + 1)
			endif
		endif
		set i = i + 1
	endloop
	set GCV = S2I(EWR)
	set GDV = S2I(EYR)
	set GFV = S2I(EZR)
endfunction
function Y6O takes nothing returns nothing
	local string E0R = SubString(GetEventPlayerChatString(), 7, StringLength(GetEventPlayerChatString()))
	local player p = GetTriggerPlayer()
	local integer r
	local integer g
	local integer b
	set GBV[GetPlayerId(p)]= true
	if E0R == "red"then
		call ETR(p, 255, 0, 0, 255)
	elseif E0R == "blue"then
		call ETR(p, 0, 0, 255, 255)
	elseif E0R == "green"then
		call ETR(p, 0, 255, 0, 255)
	elseif E0R == "default"then
		call ETR(p, 0, 0, 255, 255)
	elseif E0R == "random"then
		set r = GetRandomInt(0, 255)
		set g = GetRandomInt(0, 255)
		set b = GetRandomInt(0, 255)
		call ETR(p, r, g, b, 255)
		call DisplayTimedTextToPlayer(p, 0, 0, 5, GetObjectName('n0HD')+ " r=" + I2S(r)+ " g=" + I2S(g)+ " b=" + I2S(b))
	else
		call EUR(E0R)
		set r = GCV
		set g = GDV
		set b = GFV
		if r == 0 and g == 0 and b == 0 and E0R != "0 0 0"then
			return
		endif
		if r >= 0 and r <= 255 and g >= 0 and g <= 255 and b >= 0 and b <= 255 then
			call ETR(p, r, g, b, 255)
		endif
	endif
	set p = null
endfunction
function E1R takes nothing returns boolean
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., "额外经验/金钱加成总计：" + I2S(E5V[GetPlayerId(GetTriggerPlayer())])+ "/" + I2S(E6V[GetPlayerId(GetTriggerPlayer())]))
	return false
endfunction
function E2R takes player p returns nothing
	local unit triggerUnit = Player__Hero[GetPlayerId(p)]
	local integer i = GetUnitAbilityLevel(triggerUnit,'A0CQ')-1
	local integer E3R = 0
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0BR')
	if level == 1 then
		set E3R =$C
	elseif level == 2 then
		set E3R = 20
	elseif level == 3 then
		set E3R = 28
	elseif level == 4 then
		set E3R = 36
	endif
	set i = IMaxBJ(IMinBJ(i, E3R), 0)
	if IsPlayerHasSkill(p, 318) and i > 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0KE')+ " " + I2S(i)+ "/" + I2S(E3R))
	endif
	set triggerUnit = null
endfunction
function E4R takes nothing returns boolean
	local player p = GetTriggerPlayer()
	local integer TME = GetPlayerId(p)
	local integer h = GetHandleId(p)
	local integer i
	local integer k
	if HGV > 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0LO')+ ": " + I2S(HGV))
	endif
	if LoadInteger(K, h,'DUEL')> 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., "决斗: " + I2S(LoadInteger(K, h,'DUEL'))+ " 次胜利, " + I2S(LoadInteger(K, h,'DDUE'))+ " 点攻击力")
	endif
	if LoadInteger(P, h,'A0O3')> 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0GQ')+ " " + I2S(LoadInteger(P, h,'A0O3')))
	endif
	set i = LoadInteger(K, h,'ARRH')
	set k = LoadInteger(K, h,'ARRS')
	if k > 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0GM')+ " " + R2S(I2R(i)/ I2R(k)* 100 )+ "% (" + I2S(i)+ "/" + I2S(k)+ ")")
	endif
	if LoadInteger(K, TME,'MC_T')> 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0JH')+ " " + I2S(LoadInteger(K, TME,'MC_T')))
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0JM')+ " " + I2S(LoadInteger(K, TME,'MC_2')+ LoadInteger(K, TME,'MC_3')+ LoadInteger(K, TME,'MC_4'))+ " (" + I2S((LoadInteger(K, TME,'MC_2')+ LoadInteger(K, TME,'MC_3')+ LoadInteger(K, TME,'MC_4'))* 100 / LoadInteger(K, TME,'MC_T'))+ "%)")
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0JL')+ " " + I2S(LoadInteger(K, TME,'MC_2'))+ " (" + I2S( 100 * LoadInteger(K, TME,'MC_2')/ LoadInteger(K, TME,'MC_T'))+ "%)")
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0JK')+ " " + I2S(LoadInteger(K, TME,'MC_3'))+ " (" + I2S( 100 * LoadInteger(K, TME,'MC_3')/ LoadInteger(K, TME,'MC_T'))+ "%)")
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0JJ')+ " " + I2S(LoadInteger(K, TME,'MC_4'))+ " (" + I2S( 100 * LoadInteger(K, TME,'MC_4')/ LoadInteger(K, TME,'MC_T'))+ "%)")
	endif
	if JZV[TME]> 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0HM')+ " " + I2S(JZV[TME]))
	endif
	call E2R(p)
	if LoadInteger(P, GetHandleId(Player__Hero[TME]),'A06D')> 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., "腐肉堆积祭品数: " + I2S(SI[TME]))
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n09R')+ " " + I2S(LoadInteger(P, GetHandleId(Player__Hero[TME]),'A06D'))+ " " + GetObjectName('n09S'))
	endif
	set i = LoadInteger(K, h,'HK_H')
	set k = LoadInteger(K, h,'HK_T')
	if k > 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10., GetObjectName('n0EL')+ " " + R2S(I2R(i)/ I2R(k)* 100 )+ "% (" + I2S(i)+ "/" + I2S(k)+ ")")
	endif
	if HHV[TME]> 0 then
		call DisplayTimedTextToPlayer(p, 0, 0, 10, "通过追踪术获得的额外金钱: " + I2S(HHV[TME]))
	endif
	return false
endfunction
function E5R takes player p1 returns string
	local string s = GetObjectName('n0GB')
	set s = JUX(s, "$c1", "|c00ff0303")
	set s = JUX(s, "$p1", JS[GetPlayerId(p1)]+(VMV[GetPlayerId((p1))])+ "|r")
	return s
endfunction
function E6R takes nothing returns string
	local string s = GetObjectName('n0GA')
	set s = JUX(s, "$c1", "|c006699CC")
	set s = JUX(s, "$c2", "|c00ff0303")
	return s
endfunction
function E7R takes nothing returns nothing
	local integer i = 1
	local unit triggerUnit
	if MK then
		loop
		exitwhen i > 5
			set triggerUnit = Player__Hero[GetPlayerId(Sentinels[i])]
			if triggerUnit != null then
				if LK == 2 then
					call JKX(triggerUnit)
				endif
				call UnitSetUsesAltIcon(triggerUnit, false)
			endif
			set triggerUnit = Player__Hero[GetPlayerId(Scourges[i])]
			if triggerUnit != null then
				if LK == 2 then
					call JKX(triggerUnit)
				endif
				call UnitSetUsesAltIcon(triggerUnit, false)
			endif
			set i = i + 1
		endloop
		set triggerUnit = null
	endif
endfunction
function E8R takes player p1, player p2 returns string
	local string s = GetObjectName('n0G2')
	set s = JUX(s, "$c1", "|c006699CC")
	set s = JUX(s, "$c1", "|c006699CC")
	set s = JUX(s, "$c1", "|c006699CC")
	set s = JUX(s, "$c1", "|c006699CC")
	set s = JUX(s, "$c2", "|c00ff0303")
	set s = JUX(s, "$c2", "|c00ff0303")
	set s = JUX(s, "$p1", JS[GetPlayerId(p1)]+(VMV[GetPlayerId((p1))])+ "|r")
	set s = JUX(s, "$p2", JS[GetPlayerId(p2)]+(VMV[GetPlayerId((p2))])+ "|r")
	return s
endfunction
function E9R takes string XVR, string XER returns string
	local string s = GetObjectName('n0FV')
	set s = JUX(s, "$c1", "|c006699CC")
	set s = JUX(s, "$c1", "|c006699CC")
	set s = JUX(s, "$c1", "|c006699CC")
	set s = JUX(s, "$c1", "|c006699CC")
	set s = JUX(s, "$p1", XVR)
	set s = JUX(s, "$p2", XER)
	return s
endfunction
function XXR takes player p2 returns string
	local string s = GetObjectName('n0FS')
	set s = JUX(s, "$p2", JS[GetPlayerId(p2)]+(VMV[GetPlayerId((p2))])+ "|r")
	set s = JUX(s, "$c1", "|c006699CC")
	return s
endfunction
function XOR takes player p returns nothing
	local integer O3X
	local integer K0X
	if(IsSentinelsPlayer(p)) then
		set O3X = 1
		set K0X = 5
		loop
		exitwhen O3X > K0X
			if(Sentinels[O3X]!= p) then
				if(IsPlaying(Sentinels[O3X])) then
					call SetPlayerAllianceStateBJ(p, Sentinels[O3X], 4)
				endif
			endif
			set O3X = O3X + 1
		endloop
	else
		set O3X = 1
		set K0X = 5
		loop
		exitwhen O3X > K0X
			if(Scourges[O3X]!= p) then
				if(IsPlaying(Scourges[O3X])) then
					call SetPlayerAllianceStateBJ(p, Scourges[O3X], 4)
				endif
			endif
			set O3X = O3X + 1
		endloop
	endif
endfunction
function XRR takes nothing returns nothing
	if GetOwningPlayer(GetEnumUnit())== FM then
		call SetUnitOwner(GetEnumUnit(), GM, true)
	elseif GetOwningPlayer(GetEnumUnit())== GM then
		call SetUnitOwner(GetEnumUnit(), FM, true)
	endif
endfunction
function XIR takes unit u, player p returns nothing
	local real x1
	local real y1
	local real x2
	local real y2
	local integer i
	local item C1X
	if IsSentinelsPlayer(p) then
		set x1 = GetRectCenterX(GY)
		set y1 = GetRectCenterY(GY)
		set x2 = GetRectCenterX(VZ)
		set y2 = GetRectCenterY(VZ)
	else
		set x1 = GetRectCenterX(VZ)
		set y1 = GetRectCenterY(VZ)
		set x2 = GetRectCenterX(GY)
		set y2 = GetRectCenterY(GY)
	endif
	call SetUnitX(u, x1)
	call SetUnitY(u, y1)
	if IsMessengerUnit(u) then
		call IssueImmediateOrderById(u,$D0116)
	endif
	if IsUnitType(u, UNIT_TYPE_HERO) then
		call SaveBoolean(HY,(GetHandleId(u)), 140,(true))
		call SaveInteger(HY,(GetHandleId((u))),(4259), 2)
		call UnitRemoveAbility(u,'A04R')
		call SetUnitInvulnerable(u, false)
		call PauseUnit(u, false)
		set i = 0
		loop
		exitwhen i > 5
			set C1X = UnitItemInSlot(u, i)
			if GetUnitTypeId(u)!='H00J' and C1X != null and(GetItemPlayer(C1X)!= GetOwningPlayer(u) and UUV(C1X)!= ASV and UUV(C1X)!= ATV) and GetItemTypeId(C1X)!= RealItemTypeId[AIV]then
				call UnitRemoveItem(u, C1X)
			endif
			set i = i + 1
		endloop
	endif
	call SetUnitX(u, x2)
	call SetUnitY(u, y2)
	call SetUnitColor(u, GetPlayerColor(p))
	set C1X = null
endfunction
function XAR takes nothing returns boolean
	if IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) or IsMessengerUnit(GetFilterUnit()) then
		call XIR(GetFilterUnit(), WM)
	elseif GetUnitTypeId(GetFilterUnit())=='ncop' then
		call IssueImmediateOrderById(GetFilterUnit(),$D0116)
	elseif GetUnitTypeId(GetFilterUnit())=='u00B' then
		return true
	endif
	return false
endfunction
function XNR takes item i, player p returns nothing
	local real x
	local real y
	if IsSentinelsPlayer(p) then
		set x = GetRectCenterX(VZ)
		set y = GetRectCenterY(VZ)
	else
		set x = GetRectCenterX(GY)
		set y = GetRectCenterY(GY)
	endif
	call SetItemPosition(i, x, y)
endfunction
function XBR takes nothing returns nothing
	if GetItemPlayer(GetEnumItem())== WM then
		call XNR(GetEnumItem(), WM)
	endif
endfunction
function XCR takes player p1, player p2 returns nothing
	local group g1 = LoginGroup(109)
	local group g2 = LoginGroup(110)
	set WM = p1
	set E3 = p2
	call GroupEnumUnitsOfPlayer(g1, p1, Condition(function XAR))
	set WM = p2
	set E3 = p1
	call GroupEnumUnitsOfPlayer(g2, p2, Condition(function XAR))
	call ForGroup(g1, function XRR)
	call ForGroup(g2, function XRR)
	set WM = p1
	call EnumItemsInRect(GetWorldBounds(), TrueBoolexprCondition, function XBR)
	set WM = p2
	call EnumItemsInRect(GetWorldBounds(), TrueBoolexprCondition, function XBR)
	call LogoutGroup(g1)
	call LogoutGroup(g2)
	set g1 = null
	set g2 = null
endfunction
function XDR takes player p1, player p2 returns nothing
	local integer x
	local integer y
	local integer i
	local integer i1
	local integer i2
	local real x1
	local real y1
	local real x2
	local real y2
	local player p
	local string XVR = JS[GetPlayerId(p1)]+(VMV[GetPlayerId((p1))])+ "|r"
	local string XER = JS[GetPlayerId(p2)]+(VMV[GetPlayerId((p2))])+ "|r"
	local integer ZZO
	local integer XFR
	local integer XGR
	set ZZO = EUV[GetPlayerId(p1)]
	set EUV[GetPlayerId(p1)]= EUV[GetPlayerId(p2)]
	set EUV[GetPlayerId(p2)]= ZZO
	call JSX("SWITCH_" + I2S(GetPlayerId(p1))+ "_" + I2S(GetPlayerId(p2)), 0)
	call JSX("SWITCH_" + I2S(GetPlayerId(p2))+ "_" + I2S(GetPlayerId(p1)), 0)
	if IsSentinelsPlayer(p1) then
		set x1 = GetRectCenterX(GY)
		set y1 = GetRectCenterY(GY)
	else
		set x1 = GetRectCenterX(VZ)
		set y1 = GetRectCenterY(VZ)
	endif
	if IsSentinelsPlayer(p2) then
		set x2 = GetRectCenterX(GY)
		set y2 = GetRectCenterY(GY)
	else
		set x2 = GetRectCenterX(VZ)
		set y2 = GetRectCenterY(VZ)
	endif
	set i = 1
	loop
	exitwhen i > 5
		if Sentinels[i]== p1 or Scourges[i]== p1 then
			set i1 = i
		endif
		if Sentinels[i]== p2 or Scourges[i]== p2 then
			set i2 = i
		endif
		set i = i + 1
	endloop
	if IsSentinelsPlayer(p1) then
		set Scourges[i2]= p1
		set Sentinels[i1]= p2
	else
		set Sentinels[i2]= p1
		set Scourges[i1]= p2
	endif
	call SetPlayerTeam(Sentinels[0], 0)
	call SetPlayerTeam(Sentinels[1], 0)
	call SetPlayerTeam(Sentinels[2], 0)
	call SetPlayerTeam(Sentinels[3], 0)
	call SetPlayerTeam(Sentinels[4], 0)
	call SetPlayerTeam(Sentinels[5], 0)
	call SetPlayerTeam(Scourges[0], 1)
	call SetPlayerTeam(Scourges[1], 1)
	call SetPlayerTeam(Scourges[2], 1)
	call SetPlayerTeam(Scourges[3], 1)
	call SetPlayerTeam(Scourges[4], 1)
	call SetPlayerTeam(Scourges[5], 1)
	call K_X()
	set x = 0
	set y = 0
	loop
	exitwhen x > 5
		loop
		exitwhen y > 5
			call SetPlayerAllianceStateBJ(Sentinels[x], Sentinels[y], 3)
			call SetPlayerAllianceStateBJ(Scourges[x], Scourges[y], 3)
			call SetPlayerAllianceStateBJ(Sentinels[x], Scourges[y], 0)
			call SetPlayerAllianceStateBJ(Scourges[x], Sentinels[y], 0)
			set y = y + 1
		endloop
		set y = 0
		set x = x + 1
	endloop
	call ForceClear(RW)
	call ForceClear(IW)
	call ForceAddPlayer(RW, Sentinels[0])
	call ForceAddPlayer(RW, Sentinels[1])
	call ForceAddPlayer(RW, Sentinels[2])
	call ForceAddPlayer(RW, Sentinels[3])
	call ForceAddPlayer(RW, Sentinels[4])
	call ForceAddPlayer(RW, Sentinels[5])
	call ForceAddPlayer(IW, Scourges[0])
	call ForceAddPlayer(IW, Scourges[1])
	call ForceAddPlayer(IW, Scourges[2])
	call ForceAddPlayer(IW, Scourges[3])
	call ForceAddPlayer(IW, Scourges[4])
	call ForceAddPlayer(IW, Scourges[5])
	call ExecuteFunc("K1X")
	call XCR(p1, p2)
	set YM = true
	if JP == null then
		call PanCameraToTimedForPlayer(p1, x1, y1, 0)
		call PanCameraToTimedForPlayer(p2, x2, y2, 0)
	endif
	call KZX()
	set BM = false
	if XM != null then
		call TriggerEvaluate(XM)
	endif
	if GetPlayerSlotState(p2)== PLAYER_SLOT_STATE_EMPTY then
		set VMV[GetPlayerId(p2)]= GetPlayerName(p2)
		set VPV[i]= StringHash(VMV[GetPlayerId(p2)])
	endif
	set i = 1
	loop
	exitwhen i > 5
		set p = Sentinels[i]
		if XHX(p) then
			call XOR(p)
		endif
		set p = Scourges[i]
		if XHX(p) then
			call XOR(p)
		endif
		set i = i + 1
	endloop
	// 设置单位的RGB?
	call E7R()
	call JIO()
	call ClearTextMessages()
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 20, " ")
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 20, E9R(XVR, XER))
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 20, " ")
	call KQX(p1)
	call KQX(p2)
	set XFR = YUE(GetPlayerId(p1))
	set XGR = YUE(GetPlayerId(p2))
	set ZZO = ZL[XFR]
	set ZL[XFR]= ZL[XGR]
	set ZL[XGR]= ZZO
	set RM[GetPlayerId(p1)]= false
	set RM[GetPlayerId(p2)]= false
	if JP != null then
		call QAX()
	endif
	set p = null
endfunction
function XHR takes nothing returns nothing
	local integer i = 1
	local player p
	set JM = 0
	set KM = 0
	loop
	exitwhen i > 5
		set p = Sentinels[i]
		if IsPlaying(p) then
			set KM = KM + 1
			if HM[GetPlayerId(p)]then
				set JM = JM + 1
			endif
		endif
		set p = Scourges[i]
		if IsPlaying(p) then
			set KM = KM + 1
			if HM[GetPlayerId(p)]then
				set JM = JM + 1
			endif
		endif
		set i = i + 1
	endloop
	set p = null
endfunction
function XJR takes nothing returns nothing
	set BM = false
	if XM != null then
		call TriggerEvaluate(XM)
	endif
	call ClearTextMessages()
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 20, E5R(GetTriggerPlayer()))
endfunction
function XKR takes nothing returns nothing
	local integer i = 1
	local player p
	local integer XLR = 0
	local integer XMR = 0
	local integer XPR = 0
	if HM[GetPlayerId(GetTriggerPlayer())]== false then
		set HM[GetPlayerId(GetTriggerPlayer())]= true
		call XHR()
		call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 20, JS[GetPlayerId(GetTriggerPlayer())]+(VMV[GetPlayerId((GetTriggerPlayer()))])+ "|r|c006699CC " + GetObjectName('n0FT')+ "|r (" + I2S(JM)+ "/" + I2S(KM)+ ")")
	endif
	loop
	exitwhen i > 5
		set p = Sentinels[i]
		if IsPlaying(p) and HM[GetPlayerId(p)]== false then
			set XLR = XLR + 1
			set XPR = XPR + 1
		endif
		if IsPlaying(p) and HM[GetPlayerId(p)]then
			set XMR = XMR + 1
			set XPR = XPR + 1
		endif
		set p = Scourges[i]
		if IsPlaying(p) and HM[GetPlayerId(p)]== false then
			set XLR = XLR + 1
			set XPR = XPR + 1
		endif
		if IsPlaying(p) and HM[GetPlayerId(p)]then
			set XMR = XMR + 1
			set XPR = XPR + 1
		endif
		set i = i + 1
	endloop
	if XLR < 2 and XMR >= R2I(XPR / 2) then
		if(XPR == 2 and XMR > 1) or XPR != 2 then
			call XDR(FM, GM)
		endif
	endif
	set p = null
endfunction
function XQR takes nothing returns nothing
	local integer i = 1
	local player p = GetTriggerPlayer()
	local player XSR
	local string s
	local string s2
	loop
	exitwhen i > 5
		set s = ""
		set s2 = ""
		if IsSentinelsPlayer(p) then
			set XSR = Scourges[i]
		else
			set XSR = Sentinels[i]
		endif
		if GetPlayerSlotState(XSR)== PLAYER_SLOT_STATE_LEFT and GetPlayerController(XSR)== MAP_CONTROL_USER then
			set s = "|c00ff0303[" + GetObjectName('n0FY')+ "]|r"
		endif
		if Player__Hero[GetPlayerId(XSR)]!= null then
			set s2 = " (" + GetUnitName(Player__Hero[GetPlayerId(XSR)])+ ")"
		endif
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 15, GetObjectName('n083')+ "|c006699CC " + "-switch " + I2S(i)+ "|r " + GetObjectName('n0FQ')+ " " + JS[GetPlayerId(XSR)]+(VMV[GetPlayerId((XSR))])+ s2 + "|r " + s)
		set i = i + 1
	endloop
	set p = null
endfunction
function XTR takes nothing returns boolean
	local integer i = 0
	if BM then
		call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 20, "|c00ff0303" + GetObjectName('n0FU')+ "|r")
	endif
	set F1V = true
	set BM = false
	set FM = null
	set GM = null
	loop
	exitwhen i > 16
		set HM[i]= false
		set i = i + 1
	endloop
	call CleanCurrentTrigger(GetTriggeringTrigger())
	set XM = null
	return false
endfunction
function XUR takes player p1, player p2 returns nothing
	local trigger t = CreateTrigger()
	local integer i = 0
	local string s
	local string J1O
	local string msg2
	local string msg3
	local player p
	local string s2
	set F1V = false
	set BM = true
	set FM = p1
	set GM = p2
	loop
	exitwhen i > 16
		set HM[i]= false
		set i = i + 1
	endloop
	set HM[GetPlayerId(FM)]= true
	call TriggerRegisterTimerEvent(t, 60, false)
	call TriggerAddCondition(t, Condition(function XTR))
	set XM = t
	set s = E8R(p1, p2)
	set s2 = E6R()
	set i = 1
	loop
	exitwhen i > 5
		set p = Sentinels[i]
		if p != p1 then
			call DisplayTimedTextToPlayer(p, 0, 0, 20, s)
			call DisplayTimedTextToPlayer(p, 0, 0, 20, s2)
		endif
		set p = Scourges[i]
		if p != p1 then
			call DisplayTimedTextToPlayer(p, 0, 0, 20, s)
			call DisplayTimedTextToPlayer(p, 0, 0, 20, s2)
		endif
		set i = i + 1
	endloop
	set s = XXR(p2)
	call DisplayTimedTextToPlayer(p1, 0, 0, 20, s)
	set t = null
	set p = null
endfunction
function Y8O takes nothing returns nothing
	if YS == false then
		call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n0GX'))
		return
	endif
	if GetEventPlayerChatString()== "-switch accept"or GetEventPlayerChatString()== "-ok"then
		if BM then
			call XKR()
		endif
	elseif GetEventPlayerChatString()== "-no"then
		if BM then
			call XJR()
		endif
	elseif GetEventPlayerChatString()== "-switch"then
		if BM == false then
			call XQR()
		endif
	elseif BM == false then
		set VM = S2I(SubString(GetEventPlayerChatString(), 8, StringLength(GetEventPlayerChatString())))
		if VM > 0 and VM < 6 then
			if IsSentinelsPlayer(GetTriggerPlayer()) then
				if F0V[GetPlayerId(Scourges[VM])]== false then
					call XUR(GetTriggerPlayer(), Scourges[VM])
				else
					call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n0HY'))
				endif
			else
				if F0V[GetPlayerId(Sentinels[VM])]== false then
					call XUR(GetTriggerPlayer(), Sentinels[VM])
				else
					call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('n0HY'))
				endif
			endif
		endif
	endif
endfunction
function XWR takes nothing returns nothing
	call SetUnitAnimation(Player__Hero[GetPlayerId(GetTriggerPlayer())], "sleep")
endfunction
function XYR takes nothing returns nothing
	call SetUnitAnimationByIndex(Player__Hero[GetPlayerId(GetTriggerPlayer())], 23)
endfunction
function XZR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer i = 1
	local player p
	loop
		set p = Player(i)
		if XD[i]== false then
			call DisplayTimedTextToPlayer(p, 0, 0, 15, "|c006699CC提示：你可以输入 -SP(-SPCD)来隐藏被动技能,技能仍然可被正常使用和升级）|r")
		endif
		set i = i + 1
	exitwhen i >$B
	endloop
	call DestroyTimer(t)
	set t = null
endfunction
function X_R takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer i = 1
	local player p
	loop
		set p = Player(i)
		if GXV[i]== false then
			call DisplayTimedTextToPlayer(p, 0, 0, 15, "|c006699CC提示：你可以输入 -SI 来查看队友技能|r")
		endif
		set i = i + 1
	exitwhen i >$B
	endloop
	call DestroyTimer(t)
	set t = null
endfunction
function X0R takes nothing returns nothing
	local trigger t
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerAddCondition(t, Condition(function MRO))
	set NK = CreateTimer()
	if InHeroSelection then
		if MainModeName =="sd" then
			set N3 = KL +(ExtraAbilitiesNum  * 30)
		elseif MainModeName =="md" then
			set N3 = LL +(ExtraAbilitiesNum  * 30)
		elseif MainModeName =="ap" then
			set N3 = JL +(ExtraAbilitiesNum  * 30)
		else
			set N3 = 90
		endif
		if Mode__RandomExtraAbilities then
			set N3 = N3 -(ExtraAbilitiesNum  * 30)
		endif
	else
		if MainModeName =="rd"then
			set N3 = ML
		else
			set N3 = 90
		endif
	endif
	call TimerStart(NK, N3 + 1, false, function SMO)
	set Q3V[1]= false
	set Q3V[2]= false
	set Q3V[3]= false
	if VT == false and ET == false then
		call ExecuteFunc("X1R")
	endif
	set t = null
endfunction
function X2R takes integer WTV returns boolean
	return WTV =='A0FW' or WTV =='A0GP' or WTV =='A1EL' or WTV =='A2BE' or WTV =='A1S4' or WTV =='A020' or WTV =='A02Z'
endfunction
function X3R takes unit u, integer WTV returns nothing
	local integer WFV = GetHandleId(u)
	local boolean b = LoadBoolean(P, WFV, WTV)
	call SaveBoolean(P, WFV, WTV, b == false)
endfunction
function X4R takes integer WTV returns boolean
	if X2R(WTV) then
		return LoadBoolean(P, GetHandleId(GetTriggerUnit()), WTV)
	endif
	return true
endfunction
function X5R takes integer x returns boolean
	return x =='A3FJ' or x =='QM01' or x =='A0JT' or x =='A2TH' or x =='A0DI' or x =='A231' or x =='A1ZH' or x =='A1ZI' or x =='A1ZW' or x =='A28D' or x =='A2KG' or x =='A2K3' or x =='A2EA' or x =='A2K1' or x =='A2K4' or x =='A2K7' or x =='A06X' or x =='A0AQ' or x =='A14O' or x =='A0NE' or x =='A1C0' or x =='A418' or x =='A0K7' or x =='A1AC' or x =='A1QD' or x =='A0JL' or x =='AIpg' or x =='A11F' or x =='A0T9' or x =='A1T7' or x =='AIcy' or x =='A19M' or x =='A02O' or x =='A0FD' or x =='AChx' or x =='A1EW' or x =='A332' or x =='A2N1' or x =='A590' or x =='A591' or x =='A592' or x =='A593' or x =='A02Z' or x =='A0GC' or x =='A3UH' or x =='A3W8'
endfunction
function X6R takes integer id returns boolean
	return id =='A40K' or id =='A40L' or id =='A40M' or id =='A40N' or id =='A590' or id =='A591' or id =='A592' or id =='A593'
endfunction
function X7R takes integer WTV returns boolean
	return WTV =='A02Z'
endfunction
function X8R takes integer WTV returns boolean
	return WTV != 0 and X4R(WTV) and IsAttackSpecialEffectsId(WTV)== false and X5R(WTV)== false and LNX(WTV)== false and IsNotItemAbility(WTV) and GetUnitAbilityLevel(GetTriggerUnit(),'A04R')== 0 and X6R(WTV)== false and X7R(WTV)== false
endfunction

function X9R takes integer WWV, integer abilityId returns boolean
	local integer SQV
	if abilityId == 0 then
		return false
	endif
	// 如果 存了不能多重 并且另外个不能多重? 是攻击特效技能 是物品技能 那就返回
	if LoadBoolean(Q,'MCRS', abilityId) or X5R(abilityId) or IsAttackSpecialEffectsId(abilityId) or not IsNotItemAbility(abilityId) or X6R(abilityId) then
		return false
	endif
	set SQV = ZME(WWV, abilityId)
	if SQV != 0 then
		// 如果是变身 或者 灼热之箭类技能 就返回
		if TEE(SQV,-1, "metamorphosis", null) then
			return false
		elseif TEE(SQV,-1, "arrows", null) then
			return false
		endif
	endif
	return true
endfunction
function OVR takes integer id returns boolean
	return id =='A2T5' or id =='A2TJ' or id =='A2QI' or id =='A43J' or id =='A1A1' or id =='A1B3' or id =='A0QR' or id =='A1DP' or id =='A461' or id =='A46H' or id =='A46J'
endfunction
function OER takes integer WTV returns boolean
	return IsAttackSpecialEffectsId(WTV)== false and X5R(WTV)== false and LNX(WTV)== false and IsNotItemAbility(WTV) and X6R(WTV)== false
endfunction
function OXR takes integer si returns boolean
	return OVR(si)== false and X5R(si)== false and LNX(si)== false and IsNotItemAbility(si) and si !='A2M0' and si !='A32G' and si !='A32E' and si !='A32D' and si !='A32C' and si !='A32A' and si !='A0ZF'
endfunction
function OOR takes nothing returns nothing
	local integer WWV
	local integer hn
	local integer xx
	local integer id
	set WWV = 0
	if IsObserver== false then
		call ClearSelection()
	endif
	loop
		if IsObserverPlayer(Player(WWV))== false then
			call ShowAbilityCd_Actions(Player(WWV), true)
			call Q_X(Player(WWV), true)
			call B4X(Player(WWV))
			call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, "|cff99ccff" + " " + "你的技能:" + "|r")
			set xx = 1
			loop
				set id = PlayerSkillIndex[WWV * HL + xx]
				if id > 600 then
					call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, "	" + GetObjectName(HeroCommonSkills[id])+ "|cffffcc00" + " (" + "Invoker" + ")" + "|r")
				else
					if xx == 4 or xx == 6 then
						call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, "	" + "|c00ff0303" + GetObjectName(HeroCommonSkills[id])+ "|r" + "|cffffcc00" + " (" + GetObjectName(VUV[(id + 3)/ 4])+ ")" + "|r")
					else
						call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, "	" + GetObjectName(HeroCommonSkills[id])+ "|cffffcc00" + " (" + GetObjectName(VUV[(id + 3)/ 4])+ ")" + "|r")
					endif
				endif
				set xx = xx + 1
			exitwhen xx > 4 + ExtraAbilitiesNum  
			endloop
			if PP[WWV]== 1 then
				call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, " ")
				call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, "|c00FF0000[LoD]|r|c006699CC" + " " + "你只能选择近战英雄." + "|r")
			elseif PP[WWV]== 2 then
				call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, " ")
				call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, "|c00FF0000[LoD]|r|c006699CC" + " " + "你只能选择远程英雄." + "|r")
			endif
			call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, " ")
			call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, " ")
			call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, "|cff99ccff" + "你现在能选择英雄模型了." + "|r")
			call DisplayTimedTextToPlayer(Player(WWV), 0, 0, 15, " ")
			call IRX(Player(WWV), "Sound\\Interface\\Rescue.wav")
			call SuspendTimeOfDay(false)
			set hn = 1
			call ZFO(Player(WWV), PP[WWV])
		endif
		set WWV = WWV + 1
	exitwhen WWV >$B
	endloop
endfunction
function ORR takes integer i returns nothing
	local integer k = R2I((I2R(i)+ 3.)/ 4.)
	if k >$97 then
		set k =$97
	endif
	if not(LP[k]) then
		call MDX(k, i)
		set LP[k]= true
	endif
	if HaveSavedString(P, HeroCommonSkills[i], 600) and LoadBoolean(P, HeroCommonSkills[i], 600)== false then
		call SaveBoolean(P, HeroCommonSkills[i], 600, true)
		call ExecuteFunc(LoadStr(P, HeroCommonSkills[i], 600))
	endif
	if HaveSavedString(P, HeroCommonSkills[i], 601) and LoadBoolean(P, HeroCommonSkills[i], 601)== false then
		call SaveBoolean(P, HeroCommonSkills[i], 601, true)
		call ExecuteFunc(LoadStr(P, HeroCommonSkills[i], 601))
	endif
endfunction
function OIR takes integer WWV returns nothing
	local integer xx = 1
	loop
		call ORR(PlayerSkillIndex[WWV * HL + xx])
		set xx = xx + 1
	exitwhen xx > 4 + ExtraAbilitiesNum  
	endloop
endfunction
function OAR takes nothing returns nothing
	call DestroyTimer(GetExpiredTimer())
	set WN = true
endfunction
function ONR takes nothing returns nothing
	local unit u
	set WN = true
	set u = CreateUnit(NeutralPassivePlayer,'uC74',-7360 -$80,-6388, 270)
	call SetUnitVertexColor(u, 255, 100, 0, 255)
	set u = CreateUnit(NeutralPassivePlayer,'uC74', 6724, 6592, 270)
	call SetUnitVertexColor(u, 255, 100, 0, 255)
	set u = null
endfunction
function OBR takes nothing returns nothing
	set Z3 = true
endfunction

function fnDoubleClickSpellTips takes nothing returns nothing
	local timer t = GetExpiredTimer()
	// 没有启用双击施法 并且不是裁判才发
	if not IsEnableDoubleClickSystem and not IsObserver then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, "|c006699CC提示：你可以输入 -dch来开启双击对己施法(仅适用于游戏内的快捷键)|r")
	endif
	call DestroyTimer(t)
	set t = null
endfunction

function OCR takes nothing returns nothing
	if Mode__FiveSkills or Mode__SixSkills then
		call TimerStart(CreateTimer(), 20 +180, false, function XZR)
	endif
	call TimerStart(CreateTimer(), 20 + 300, false, function X_R)
	call TimerStart(CreateTimer(), 20 + 420, false, function fnDoubleClickSpellTips)
	call TimerStart(CreateTimer(), 15, false, function OBR)
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, "|c00FF0000原图作者:  DracoL1ch & ResQ|r")
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, "|c006699CC汉化作者:  紫心芥蓝|r")
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, "|c006699CC感谢贴吧汉化组|r")
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, "|c006699CC修改作者：偷税师|r")
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, " ")
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, "|cFFFF8000OMG ay|r")
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, "|c006699CCtieba.baidu.com/omgay|r")
	call TimerStart(CreateTimer(), 20 +180, false, function OAR)
endfunction
function ODR takes nothing returns nothing
endfunction
function OFR takes nothing returns boolean
	return GetUnitTypeId(GetFilterUnit())=='n00C' or GetUnitTypeId(GetFilterUnit())=='ntav'
endfunction
function OGR takes nothing returns nothing
	call ShowUnit(GetEnumUnit(), true)
endfunction
function OHR takes nothing returns nothing
	call ShowUnit(GetEnumUnit(), false)
endfunction
function OJR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group g = LoadGroupHandle(HY, h, 0)
	call ForGroup(g, function OGR)
	call LogoutGroup(g)
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set g = null
	set t = null
endfunction
function OKR takes integer TME returns nothing
	local timer t = CreateTimer()
	local group g = LoginGroup(111)
	call TimerStart(t, 4, false, function OJR)
	call GroupEnumUnitsOfPlayer(g, Player(TME), Condition(function OFR))
	call ForGroup(g, function OHR)
	call SaveGroupHandle(HY, GetHandleId(t), 0, g)
	set g = null
	set t = null
endfunction
function SQO takes nothing returns nothing
	local trigger t
	local integer WWV
	local timer OLR
	if ET then
		return
	endif
	set WWV = 0
	if TimerGetRemaining(NK)> 0 then
		loop
			if T6E(WWV) then
				if not(FP[WWV]) then
					return
				endif
			endif
			set WWV = WWV + 1
		exitwhen WWV >$C
		endloop
	endif
	set GP = true
	set WWV = 0
	loop
		if T6E(WWV) then
			call KillPlayerAllZoneIndicator(Player(WWV))
			call YCE(Player(WWV))
			call OIR(WWV)
		endif
		if bj_isSinglePlayer == false then
			call OKR(WWV)
		endif
		call FlushChildHashtable(HY, GetHandleId(KP[WWV]))
		call RemoveUnit(KP[WWV])
		set WWV = WWV + 1
	exitwhen WWV >$C
	endloop
	call PanCameraToTimed(-6990., 6840., .0)
	call RemoveUnit(HR)
	call RemoveUnit(JR)
	call RemoveUnit(KR)
	call RemoveUnit(LR)
	call RemoveUnit(IR)
	call ODR()
	call DestroyMultiboard(JP)
	call MultiboardDisplay(BT, true)
	set BJ_Multiboard = BT
	call AddUnitToStock(J7,'h02C', 2, 4)	//游戏开始时添加贩卖
	call AddUnitToStock(SentinelsShop_AncientOfWonders,'h02C', 2, 4)
	call AddUnitToStock(SentinelsShop_PigKing,'n139', 0, 3) 		//游戏开始时添加经验书
	call AddUnitToStock(shop_2,'n139', 0, 3)
	call ClearSelection()
	set InHeroSelection = false
	call DestroyTimer(NK)
	set NK = CreateTimer()
	call TimerStart(NK, 90 + 1, false, null)
	set OLR = CreateTimer()
	call TimerStart(OLR, 70, false, function OCR)
	if Mode__FastNeutrals then
		call NeutralCreaturesRefreshActions()
		set t = CreateTrigger()
		call TriggerRegisterTimerEvent(t, 30, false)
		call TriggerRegisterTimerEvent(t, 90, false)
		call TriggerAddCondition(t, Condition(function NeutralCreaturesRefreshActions))
		set t = null
	endif
	call EnableTrigger(hChooseHeroTrigger)
	set OLR = null
	call OOR()
endfunction
function OMR takes integer TME, integer sn, integer T0V returns nothing
	local multiboarditem mi
	local string s = HeroSkillsIcon[T0V]
	if LOD_DEBUGMODE then
		if IsScourgesPlayer(Player(TME)) then
			set mi = MultiboardGetItem(JP,(TME + 2)-1, sn -1)
		else
			set mi = MultiboardGetItem(JP,(TME + 1)-1, sn -1)
		endif
	else
		set mi = MultiboardGetItem(JP, D2V[TME]-1, sn -1)
	endif
	if IsSentinelsPlayer(Player(TME)) and Mode__SeeSkills == false then
		if IsScourgesPlayer(LocalPlayer) then
			if T0V == 0 then
				set s = HeroSkillsIcon[0]
			else
				set s = "ReplaceableTextures\\CommandButtons\\BTNQuestion.blp"
			endif
		endif
	elseif IsScourgesPlayer(Player(TME)) and Mode__SeeSkills == false then
		if IsSentinelsPlayer(LocalPlayer) then
			if T0V == 0 then
				set s = HeroSkillsIcon[0]
			else
				set s = "ReplaceableTextures\\CommandButtons\\BTNQuestion.blp"
			endif
		endif
	endif
	call MultiboardSetItemIcon(mi, s)
	call MultiboardReleaseItem(mi)
	set mi = null
endfunction
function OPR takes integer TME returns integer
	local integer k = 0
	local integer c = 0
	loop
		if RB[k]!= 0 then
			if PlayerSkillIndex[TME * HL + 1]== RB[k]or PlayerSkillIndex[TME * HL + 2]== RB[k]or PlayerSkillIndex[TME * HL + 3]== RB[k]or PlayerSkillIndex[TME * HL + 4]== RB[k]or(ExtraAbilitiesNum  >= 1 and PlayerSkillIndex[TME * HL + 5]== RB[k]) or(ExtraAbilitiesNum  >= 2 and PlayerSkillIndex[TME * HL + 6]== RB[k]) then
				set c = c + 1
			endif
		endif
		set k = k + 1
	exitwhen k > IB
	endloop
	return c
endfunction
function OQR takes integer TME returns boolean
	local integer id = 34 * 4 + 3
	local integer d = TME * HL
	if PlayerSkillIndex[d + 1]== id or PlayerSkillIndex[d + 2]== id or PlayerSkillIndex[d + 3]== id or PlayerSkillIndex[d + 4]== id or(ExtraAbilitiesNum  >= 1 and PlayerSkillIndex[d + 5]== id) or(ExtraAbilitiesNum  >= 2 and PlayerSkillIndex[d + 6]== id) then
		return true
	endif
	return false
endfunction
function OSR takes integer OTR returns boolean
	local integer k = 0
	local boolean b = false
	loop
		if OTR == RB[k]then
			set b = true
		endif
		set k = k + 1
	exitwhen b or k > IB
	endloop
	return b
endfunction
function OUR takes integer XQX returns boolean
	local integer i = 1
	loop
		if VUV[XQX]== V7V[i]then
			return true
		endif
		set i = i + 1
	exitwhen i > V8V
	endloop
	return false
endfunction
function OWR takes integer OYR, integer WWV, boolean OZR returns boolean
	local boolean O_R = I2R(OYR / 4)== I2R(OYR)/ 4.
	local boolean pr = true
	local integer ns = 0
	local integer O0R = 0
	local integer O1R = 0
	local integer xx = 0
	local integer YTE = 0
	local integer O2R = 0
	local integer O3R = 0
	local string O4R = ""
	local integer O5R = 0
	local integer O6R = 0
	local boolean O7R = false
	local boolean O8R = false
	local player p = Player(WWV)
	local boolean O9R
	local boolean RVR
	local boolean RER
	local boolean RXR
	local integer ROR = WWV * HL
	local integer RRR
	local unit u
	if PlayerSkillIndex[ROR + 1]== OYR or PlayerSkillIndex[ROR + 2]== OYR or PlayerSkillIndex[ROR + 3]== OYR or PlayerSkillIndex[ROR + 4]== OYR or PlayerSkillIndex[ROR + 5]== OYR or PlayerSkillIndex[ROR + 6]== OYR then
		return false
	endif
	if OYR ==(116 -1)* 4 + 4 or OYR ==(115 -1)* 4 + 4 or OYR ==(114 -1)* 4 + 4 then
		set O_R = false
	endif
	if FP[WWV]then
		call URE(p, OZR, "你已经准备好了")
		return false
	endif
	if IsDisabledSkill[OYR]then
		call URE(p, OZR, "该技能无法被选择 :(")
		return false
	endif
	if Mode__DeathMatch or MainModeName =="ar" then
		if IsNoDeathMatchSkill[OYR]then
			return false
		endif
	endif
	if Mode__OneSkill then
		if IsSentinelsPlayer(p) then
			set YTE = 1
		else
			set YTE = 2
		endif
		if XP[YTE * OP + OYR]!= 0 then
			call URE(p, OZR, "一个玩家已经选择了这个技能: " + JS[XP[YTE * OP + OYR]]+ VMV[XP[YTE * OP + OYR]]+ "|r")
			return false
		endif
	endif
	set xx = 1
	loop
		if O_R then
			if xx == 4 or xx == 6 then
				if PlayerSkillIndex[ROR + xx]== 0 then
					set O3R = xx
				exitwhen true
				endif
			endif
		else
			if not(xx == 4 or xx == 6) then
				if PlayerSkillIndex[ROR + xx]== 0 then
					set O2R = xx
				exitwhen true
				endif
			endif
		endif
		set xx = xx + 1
	exitwhen xx > 4 + ExtraAbilitiesNum  
	endloop
	if O3R == 0 and O_R then
		call URE(p, OZR, "你必须选择一个小技能（非最终技能）.")
		return false
	endif
	if O2R == 0 and not(O_R) then
		call URE(p, OZR, "你必须选择一个最终技能.")
		return false
	endif
	if Mode__RandomExtraAbilities then
		if PlayerSkillIndex[ROR + 5]== 0 and ExtraAbilitiesNum  >= 1 then
			set O2R = 5
		endif
		if PlayerSkillIndex[ROR + 6]== 0 and ExtraAbilitiesNum  >= 2 then
			set O3R = 6
		endif
	endif
	set RER = TEE(OYR,-1, "melee only", null)
	set O9R = TEE(OYR,-1, "melee morph", null)
	set RXR = TEE(OYR,-1, "range only", null)
	set RVR = TEE(OYR,-1, "range morph", null)
	if WWV == 0 then
		set u = LoadUnitHandle(HY,'0REA','000U')
		if u != null then
			if OUR(GetUnitUserData(u)) then
				if RXR then
					set u = null
					return false
				endif
			else
				if RER then
					set u = null
					return false
				endif
			endif
		endif
	endif
	if RER or O9R then
		set xx = 1
		loop
			if TEE(PlayerSkillIndex[ROR + xx],-1, "range only", null) or TEE(PlayerSkillIndex[ROR + xx],-1, "range morph", null) then
				set ns = xx
				if O9R then
					set O4R = "你不能选择一个近战变身技能"
				else
					set O4R = "你不能选择一个近战限定技能"
				endif
			exitwhen true
			endif
			set xx = xx + 1
		exitwhen xx > 4 + ExtraAbilitiesNum  
		endloop
		set xx = 1
		loop
			if TEE(PlayerSkillIndex[ROR + xx], OYR, null, "melee only") then
				set ns = xx
				set O4R = "buggy/orderids"
			exitwhen true
			endif
			set xx = xx + 1
		exitwhen xx > 4 + ExtraAbilitiesNum  
		endloop
	elseif RXR or RVR then
		set xx = 1
		loop
			if TEE(PlayerSkillIndex[ROR + xx],-1, "melee only", null) or TEE(PlayerSkillIndex[ROR + xx],-1, "melee morph", null) then
				set ns = xx
				if RVR then
					set O4R = "你不能选择一个远程变身技能"
				else
					set O4R = "你不能选择一个远程限定技能"
				endif
			exitwhen true
			endif
			set xx = xx + 1
		exitwhen xx > 4 + ExtraAbilitiesNum  
		endloop
		set xx = 1
		loop
			if TEE(PlayerSkillIndex[ROR + xx], OYR, null, "range only") then
				set ns = xx
				set O4R = "buggy/orderids"
			exitwhen true
			endif
			set xx = xx + 1
		exitwhen xx > 4 + ExtraAbilitiesNum  
		endloop
	else
		set xx = 1
		loop
			if TEE(PlayerSkillIndex[ROR + xx], OYR, null, null) then
				set ns = xx
				set O4R = "buggy/orderids"
			exitwhen true
			endif
			set xx = xx + 1
		exitwhen xx > 4 + ExtraAbilitiesNum  
		endloop
	endif
	if IsMultiIconSkill[OYR]and(Mode__FiveSkills or Mode__SixSkills) then
		call T9E(p, OZR, "注意：该技能是多图标技能。建议用命令改键来修改额外技能快捷键。")
	endif
	if OYR ==(35 -1)* 4 + 3 then
		if IsSentinelsPlayer(p) then
			if OQR(GetPlayerId(Sentinels[1])) or OQR(GetPlayerId(Sentinels[2])) or OQR(GetPlayerId(Sentinels[3])) or OQR(GetPlayerId(Sentinels[4])) or OQR(GetPlayerId(Sentinels[5])) then
				call URE(p, OZR, "你的队友已经选择了这个技能，不能再选择一个了。")
				return false
			endif
		else
			if OQR(GetPlayerId(Scourges[1])) or OQR(GetPlayerId(Scourges[2])) or OQR(GetPlayerId(Scourges[3])) or OQR(GetPlayerId(Scourges[4])) or OQR(GetPlayerId(Scourges[5])) then
				call URE(p, OZR, "你的队友已经选择了这个技能，不能再选择一个了。")
				return false
			endif
		endif
	endif
	if Mode__BalanceOff == false then
		set RRR = 1
	else
		set RRR = 2
	endif
	if OSR(OYR) then
		set O7R = OPR(WWV)>= RRR
		if O7R == false then
			if IsSentinelsPlayer(p) then
				set O7R =(OPR(GetPlayerId(Sentinels[1]))+ OPR(GetPlayerId(Sentinels[2]))+ OPR(GetPlayerId(Sentinels[3]))+ OPR(GetPlayerId(Sentinels[4]))+ OPR(GetPlayerId(Sentinels[5])))>= 7
			else
				set O7R =(OPR(GetPlayerId(Scourges[1]))+ OPR(GetPlayerId(Scourges[2]))+ OPR(GetPlayerId(Scourges[3]))+ OPR(GetPlayerId(Scourges[4]))+ OPR(GetPlayerId(Scourges[5])))>= 7
			endif
			set O8R = O7R
		endif
	endif
	if ns == 0 then
		if(Mode__LimitSkills2) then
			if O7R == false then
				set O0R = 0
				set O1R = 0
				set O5R =(OYR -1)/ 4
				set xx = 1
				loop
					if PlayerSkillIndex[ROR + xx]!= 0 then
						set O6R =(PlayerSkillIndex[ROR + xx]-1)/ 4
						if(O6R == O5R) then
							if O0R == 0 then
								set O0R = xx
							elseif Mode__LimitSkills3 then
								if O1R == 0 then
									set O1R = xx
								else
									set ns = xx
									set O4R = "同一个英雄的技能不能超过3个"
								exitwhen true
								endif
							else
								set ns = xx
								set O4R = "同一个英雄的技能不能超过2个"
							exitwhen true
							endif
						endif
					endif
					set xx = xx + 1
				exitwhen(xx > 4 + ExtraAbilitiesNum  ) or(xx > 4 and Mode__RandomExtraAbilities)
				endloop
			endif
		endif
	endif
	if ns != 0 then
		if O4R != "" then
			if O1R != 0 then
				call URE(p, OZR, "不兼容 : " + GetObjectName(HeroCommonSkills[PlayerSkillIndex[ROR + ns]])+ "/" + GetObjectName(HeroCommonSkills[PlayerSkillIndex[ROR + O0R]])+ "/" + GetObjectName(HeroCommonSkills[PlayerSkillIndex[ROR + O1R]])+ " (" + O4R + ")")
			elseif O0R != 0 then
				call URE(p, OZR, "不兼容 : " + GetObjectName(HeroCommonSkills[PlayerSkillIndex[ROR + ns]])+ "/" + GetObjectName(HeroCommonSkills[PlayerSkillIndex[ROR + O0R]])+ " (" + O4R + ")")
			else
				call URE(p, OZR, "不兼容 : " + GetObjectName(HeroCommonSkills[PlayerSkillIndex[ROR + ns]])+ " (" + O4R + ")")
			endif
		else
			call URE(p, OZR, "不兼容 : " + GetObjectName(HeroCommonSkills[PlayerSkillIndex[ROR + ns]]))
		endif
		return false
	endif
	if O7R then
		if O8R == false then
			if RRR == 2 then
				call URE(p, OZR, "不能选择该技能，你已经有2个控制技能了！")
			else
				call URE(p, OZR, "不能选择该技能，你已经有1个控制技能了！")
			endif
		else
			call URE(p, OZR, "不能选择该技能，你的队伍已经选择7个控制技能了！")
		endif
		return false
	endif
	if HaveSavedString(Q, HeroCommonSkills[OYR], HotKeyStringHash) then
		set xx = 1
		loop
			if PlayerSkillIndex[ROR + xx]> 0 and HaveSavedString(Q, HeroCommonSkills[PlayerSkillIndex[ROR + xx]], HotKeyStringHash) then
				if LoadStr(Q, HeroCommonSkills[OYR], HotKeyStringHash)== LoadStr(Q, HeroCommonSkills[PlayerSkillIndex[ROR + xx]], HotKeyStringHash) then
					call URE(p, OZR, "快捷键冲突 : " + GetObjectName(HeroCommonSkills[PlayerSkillIndex[ROR + xx]]))
					if HaveSavedBoolean(K, GetHandleId(Player(WWV)),'NSHK') and VT then
						return false
					endif
				endif
			endif
			set xx = xx + 1
		exitwhen(xx > 4 + ExtraAbilitiesNum  )
		endloop
	endif
	if O_R then
		set PlayerSkillIndex[ROR + O3R]= OYR
		call OMR(WWV, O3R, OYR)
	else
		set PlayerSkillIndex[ROR + O2R]= OYR
		call OMR(WWV, O2R, OYR)
	endif
	if Mode__OneSkill then
		if XP[YTE * OP + OYR]== 0 then
			set XP[YTE * OP + OYR]= WWV
		endif
	endif
	set xx = 1
	loop
		if PlayerSkillIndex[ROR + xx]== 0 then
			set pr = false
		exitwhen true
		endif
		set xx = xx + 1
	exitwhen xx > 4 + ExtraAbilitiesNum  
	endloop
	set FP[WWV]= pr
	if RER then
		set PP[WWV]= 1
		call UVE(p, OZR, "注意：该技能是近战限定技能.")
	elseif RXR then
		set PP[WWV]= 2
		call UVE(p, OZR, "注意：该技能是远程限定技能.")
	endif
	if O9R then
		call UVE(p, OZR, "注意：该技能是近战变身技能.")
	elseif RVR then
		call UVE(p, OZR, "注意：该技能是远程变身技能.")
	endif
	if ( not Mode__BalanceOff and NoBalanceOffTips[OYR]!= null ) then
		call UVE(p, OZR, "平衡改动(BO)：" + NoBalanceOffTips[OYR]) // BalanceOff
	endif
	if ( not Mode__RearmCombos and NoRearmCombosTips[OYR]!= null ) then
		call UVE(p, OZR, "平衡改动(RC)：" + NoRearmCombosTips[OYR]) // RearmCombos
	endif
	if ZTP[OYR]!= null then
		call UVE(p, OZR, "注意：" + ZTP[OYR])
	endif
	return true
endfunction
function Q7X takes nothing returns nothing
	local unit u = LoadUnitHandle(HY,'hRUT', 1)
	local integer WWV = GetPlayerId(GetOwningPlayer(u))
	local integer ZKE
	local integer i = 0
	local integer te
	set PlayerSkillIndex[WWV * HL + 1]= LoadInteger(HY,'hRUT', 2)
	set PlayerSkillIndex[WWV * HL + 2]= LoadInteger(HY,'hRUT', 3)
	set PlayerSkillIndex[WWV * HL + 3]= LoadInteger(HY,'hRUT', 4)
	set PlayerSkillIndex[WWV * HL + 4]= LoadInteger(HY,'hRUT', 5)
	set PlayerSkillIndex[WWV * HL + 5]= LoadInteger(HY,'hRUT', 6)
	set PlayerSkillIndex[WWV * HL + 6]= LoadInteger(HY,'hRUT', 7)
	set IP[WWV * 2 + 1]= LoadInteger(HY,'hRUT', 8)
	set IP[WWV * 2 + 2]= LoadInteger(HY,'hRUT', 9)
	loop
		set ZKE =(GetRandomInt(1, GL * 4))
		if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
			if not TEE(ZKE,-1, "range only", null) then
				call SaveInteger(HY,'0REA','0PID', WWV)
				call SaveInteger(HY,'0REA','0SID', ZKE)
				call SaveBoolean(HY,'0REA','000B', false)
				call ExecuteFunc("SPO")
			endif
		else
			if not TEE(ZKE,-1, "melee only", null) then
				call SaveInteger(HY,'0REA','0PID', WWV)
				call SaveInteger(HY,'0REA','0SID', ZKE)
				call SaveBoolean(HY,'0REA','000B', false)
				call ExecuteFunc("SPO")
			endif
		endif
		set i = i + 1
	exitwhen FP[WWV]
	endloop
	if not FP[WWV]then
		call SaveInteger(HY,'hRUT', 2, PlayerSkillIndex[WWV * HL + 1])
		call SaveInteger(HY,'hRUT', 3, PlayerSkillIndex[WWV * HL + 2])
		call SaveInteger(HY,'hRUT', 4, PlayerSkillIndex[WWV * HL + 3])
		call SaveInteger(HY,'hRUT', 5, PlayerSkillIndex[WWV * HL + 4])
		call SaveInteger(HY,'hRUT', 6, PlayerSkillIndex[WWV * HL + 5])
		call SaveInteger(HY,'hRUT', 7, PlayerSkillIndex[WWV * HL + 6])
		call SaveInteger(HY,'hRUT', 8, IP[WWV * 2 + 1])
		call SaveInteger(HY,'hRUT', 9, IP[WWV * 2 + 2])
		call ExecuteFunc("Q7X")
	endif
	call FlushChildHashtable(HY,'hRUT')
	call AddHeroSkills(u, Player(WWV))
	call OIR(WWV)
	set FP[WWV]= false
	set u = null
endfunction
function MIO takes nothing returns nothing
	local integer ZKE
	local integer UXO
	local integer WWV
	local integer te
	set WWV = 0
	loop
		if T6E(WWV) then
			loop
			exitwhen FP[WWV]
				if MainModeName =="sd" or MainModeName =="md" then
					loop
						set UXO = UIE(GetRandomInt(1, GL))
					exitwhen(DP[WWV * GL + UXO]and ZQ[UXO]== false)
					endloop
					set ZKE =(UXO * 4)-4
					set ZKE = ZKE + GetRandomInt(1, 4)
					call SaveInteger(HY,'0REA','0PID', WWV)
					call SaveInteger(HY,'0REA','0SID', ZKE)
					call SaveBoolean(HY,'0REA','000B', false)
					call ExecuteFunc("SPO")
				else
					loop
						set ZKE =(GetRandomInt(1, GL * 4))
						set te = UIE((ZKE + 3)/ 4)
					exitwhen(ZQ[te]== false and GetPlayerTechMaxAllowed(GetTriggerPlayer(), VUV[te])> 0)
					endloop
					call SaveInteger(HY,'0REA','0PID', WWV)
					call SaveInteger(HY,'0REA','0SID', ZKE)
					call SaveBoolean(HY,'0REA','000B', false)
					call ExecuteFunc("SPO")
				endif
			endloop
			call SQO()
		endif
		set WWV = WWV + 1
	exitwhen WWV >$C
	endloop
endfunction
function RIR takes integer TME, integer TPE returns boolean
	local integer xx
	local integer YTE
	local integer sn
	local integer V0R
	local integer WPV = GetUnitPointValueByType(VUV[TPE / 4])
	set sn = R2I((I2R(TPE)+ 3.)/ 4.)
	set sn = TPE -((sn -1)* 4)
	if Mode__RandomExtraAbilities then
		if PlayerSkillIndex[TME * HL + 5]== TPE and ExtraAbilitiesNum  >= 1 then
			call URE(Player(TME), true, "你不能在\"额外随机技能\"模式下移除该技能.")
			return false
		endif
		if PlayerSkillIndex[TME * HL + 6]== TPE and ExtraAbilitiesNum  >= 2 then
			call URE(Player(TME), true, "你不能在\"额外随机技能\"模式下移除该技能.")
			return false
		endif
	endif
	set xx = 1
	loop
		if(PlayerSkillIndex[TME * HL + xx]== TPE) then
			set PlayerSkillIndex[TME * HL + xx]= 0
			call OMR(TME, xx, 0)
		exitwhen true
		endif
		set xx = xx + 1
	exitwhen xx > 4 + ExtraAbilitiesNum  
	endloop
	set PP[TME]= 0
	set xx = 1
	loop
		if TEE(PlayerSkillIndex[TME * HL + xx],-1, "melee only", null) then
			set PP[TME]= 1
		exitwhen true
		elseif TEE(PlayerSkillIndex[TME * HL + xx],-1, "range only", null) then
			set PP[TME]= 2
		exitwhen true
		endif
		set xx = xx + 1
	exitwhen xx > 4 + ExtraAbilitiesNum  
	endloop
	if GetUnitAbilityLevel(KP[TME],'Z004'-1 + sn)> 0 then
		call UnitRemoveAbility(KP[TME],('Z004'-1)+ sn)
		call UnitAddAbility(KP[TME],('Z000'-1)+ sn)
	endif
	if Mode__OneSkill then
		set xx = 0
		loop
			if IsSentinelsPlayer(Player(TME)) then
				set V0R = GetPlayerId(Sentinels[xx])
			else
				set V0R = GetPlayerId(Scourges[xx])
			endif
			if LoadBoolean(HY, GetHandleId(Player(V0R)), WPV) then
				if GetUnitAbilityLevel(KP[V0R], HeroCommonSkills[TPE])> 0 then
					call UnitRemoveAbility(KP[V0R],('Z010'-1)+ sn)
					call UnitAddAbility(KP[V0R],('Z000'-1)+ sn)
				endif
			endif
			set xx = xx + 1
		exitwhen xx > 5
		endloop
		if IsSentinelsPlayer(Player(TME)) then
			set YTE = 1
		else
			set YTE = 2
		endif
		if XP[YTE * OP + TPE]== TME then
			set XP[YTE * OP + TPE]= 0
		endif
	endif
	return true
endfunction
function Y4O takes nothing returns nothing
	local integer WWV = GetPlayerId(GetTriggerPlayer())
	local integer i = S2I(SubString(GetEventPlayerChatString(), 2, 3))
	if i == 0 then
		set i = S2I(SubString(GetEventPlayerChatString(), 3, 4))
	endif
	if InHeroSelection then
		if GetGameTime()> HN[WWV]+ 2 then
			if i < 7 and i > 0 then
				set HN[WWV]= GetGameTime()
				call RIR(WWV, PlayerSkillIndex[WWV * HL + i])
				set FP[WWV]= false
			else
				call InterfaceErrorForPlayer(GetTriggerPlayer(), "错误的索引，请尝试 [1-6]")
			endif
		else
			call InterfaceErrorForPlayer(GetTriggerPlayer(), "不要频繁发送，稍后再试。")
		endif
	endif
endfunction
function reset_choice takes player p, boolean b returns nothing
	local integer id = GetPlayerId(p)
	if InHeroSelection then
		if b or GetGameTime()> HN[id]+ 2 then
			set HN[id]= GetGameTime()
			call RIR(id, PlayerSkillIndex[id * HL + 1])
			call RIR(id, PlayerSkillIndex[id * HL + 2])
			call RIR(id, PlayerSkillIndex[id * HL + 3])
			call RIR(id, PlayerSkillIndex[id * HL + 4])
			call RIR(id, PlayerSkillIndex[id * HL + 5])
			call RIR(id, PlayerSkillIndex[id * HL + 6])
			set FP[id]= false
		else
			call InterfaceErrorForPlayer(p, "不要频繁发送，稍后再试。")
		endif
	endif
endfunction
function RAR takes nothing returns nothing
	call reset_choice(GetTriggerPlayer(), false)
endfunction
function Reset_Ability takes nothing returns nothing
	call reset_choice(E3, true)
endfunction
function RNR takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='n00C' or GetUnitTypeId(GetFilterUnit())=='ntav' then
		call ShowUnit(GetFilterUnit(), true)
		call KillUnit(GetFilterUnit())
	endif
	return false
endfunction
function RBR takes nothing returns nothing
	local integer WWV = GetPlayerId(GetTriggerPlayer())
	local integer xx
	local group g = LoginGroup(112)
	if not(GP) and MainModeName != "ar" then
		set xx = 1
		loop
			call RIR(WWV, PlayerSkillIndex[WWV * HL + xx])
			set xx = xx + 1
		exitwhen xx > 4 + ExtraAbilitiesNum  
		endloop
	endif
	call GroupEnumUnitsOfPlayer(g, GetTriggerPlayer(), Condition(function RNR))
	call LogoutGroup(g)
	set g = null
endfunction
function RCR takes nothing returns nothing
	local integer WWV = GetPlayerId(GetOwningPlayer(GetSpellAbilityUnit()))
	local integer QLX =(MP[WWV]* 4)-4
	local integer sn
	if GetSpellAbilityId()=='Z004' then
		set QLX = QLX + 1
		set sn = 1
	elseif GetSpellAbilityId()=='Z005' then
		set QLX = QLX + 2
		set sn = 2
	elseif GetSpellAbilityId()=='Z006' then
		set QLX = QLX + 3
		set sn = 3
	elseif GetSpellAbilityId()=='Z007' then
		set QLX = QLX + 4
		set sn = 4
	else
		return
	endif
	if RIR(WWV, QLX) then
		set FP[WWV]= false
	endif
endfunction
function RDR takes nothing returns nothing
	local integer TME = GetPlayerId(GetOwningPlayer(GetSpellAbilityUnit()))
	local integer QLX =(MP[TME]* 4)-4
	local integer sn
	local integer xx
	local integer RFR
	if not((GetSpellAbilityId()>='Z000' and GetSpellAbilityId()<='Z003') or(GetSpellAbilityId()>='Z010' and GetSpellAbilityId()<='Z013')) then
		return
	endif
	if GetSpellAbilityId()=='Z000' or GetSpellAbilityId()=='Z010' then
		set QLX = QLX + 1
		set sn = 1
	elseif GetSpellAbilityId()=='Z001' or GetSpellAbilityId()=='Z011' then
		set QLX = QLX + 2
		set sn = 2
	elseif GetSpellAbilityId()=='Z002' or GetSpellAbilityId()=='Z012' then
		set QLX = QLX + 3
		set sn = 3
	elseif GetSpellAbilityId()=='Z003' or GetSpellAbilityId()=='Z013' then
		set QLX = QLX + 4
		set sn = 4
	else
		return
	endif
	if not OWR(QLX, TME, true) then
		return
	endif
	if IsPlayerHasSkill(Player(TME), QLX) then
		call UnitRemoveAbility(KP[TME],('Z000'-1)+ sn)
		call UnitAddAbility(KP[TME],('Z004'-1)+ sn)
		if Mode__OneSkill then
			set xx = 1
			loop
				if IsSentinelsPlayer(Player(TME)) then
					set RFR = GetPlayerId(Sentinels[xx])
				else
					set RFR = GetPlayerId(Scourges[xx])
				endif
				if GetUnitAbilityLevel(KP[RFR], HeroCommonSkills[QLX])> 0 and TME != RFR and GetUnitAbilityLevel(KP[RFR],'Z000'-1 + sn)> 0 then
					call UnitRemoveAbility(KP[RFR],('Z000'-1)+ sn)
					call UnitAddAbility(KP[RFR],('Z010'-1)+ sn)
				endif
				set xx = xx + 1
			exitwhen xx > 5
			endloop
		endif
	endif
	if FP[TME]then
		call SQO()
	endif
endfunction
// 创建酒馆和添加英雄
function RGR takes player p, integer iHeroTypeId, integer i2 returns nothing
	local integer h = GetHandleId(p)
	local integer c = LoadInteger(K, h, 32)
	// 十个英雄一个酒馆
	local integer i = R2I(c / 10)
	local integer RJR = 32 + i
	local real x = -7400 + i * 192
	local real y = 7128 -192 *(ModuloInteger(GetPlayerId(p)-1, 6))
	local integer h2
	local unit u = null
	local integer j = 1
	if p == Player(12) then
		return
	endif
	if DW then
		loop
		exitwhen j > 5
			if Sentinels[j]== p or Scourges[j]== p then
				set y = 7128 -192 *(j -1)
			endif
			set j = j + 1
		endloop
	endif
	if i == 2 then
		set x = x + 16
	endif
	if not HaveSavedHandle(K, h, RJR) then
		set u = CreateUnit(p,'ntav', x, y, 270)
		// 自己的酒馆大一点无可厚非吧
		if LocalPlayer!= p then
			call SetUnitScale(u, .3, .3, .3)
		endif
		call SaveUnitHandle(K, h, RJR, u)
		// 选中第一个酒馆
		if c == 0 then
			call SelectUnitForPlayerSingle(u, p)
		endif
		set h2 = GetHandleId(u)
		// 光圈
		call SaveUnitHandle(HY, h2, RJR, CreateUnit(p,'n12C', x, y, 0))
		// 异步光圈颜色 只有自己能看见
		if LocalPlayer!= p then
			call SetUnitVertexColor(LoadUnitHandle(HY, h2, RJR), 0, 0, 0, 0)
		endif
		set u = null
	endif
	call AddUnitToStock(LoadUnitHandle(K, h, RJR), iHeroTypeId, 1, 1)
	call SaveInteger(K, h, 32, c + 1)
	call SetPlayerTechMaxAllowed(p, iHeroTypeId, 999)
	call SaveBoolean(HY, h, iHeroTypeId, true)
	call SaveInteger(HY, h,'hrpl'+ c, iHeroTypeId)
	call SaveInteger(HY, h,'bapl'+ c, i2)
endfunction
function RKR takes nothing returns nothing
	local integer WWV = 0
	local integer i = 1
	local integer j
	local integer n
	local integer f
	local integer WOV = GL
	local boolean RLR = true
	if QW then
		loop
			set QP[i]= V_V[i]
			set i = i + 1
		exitwhen V_V[i]== 0
		endloop
	elseif SW then
		loop
			set QP[i]= V3V[i]
			set i = i + 1
		exitwhen V3V[i]== 0
		endloop
	elseif TW then
		loop
			set QP[i]= V1V[i]
			set i = i + 1
		exitwhen V1V[i]== 0
		endloop
	else
		loop
			set QP[i]= i
			set i = i + 1
		exitwhen i > GL
		endloop
		set RLR = false
	endif
	set WV = i -1
	set WOV = WV * 4
	set i = 1
	loop
		set j = GetRandomInt(1, WV)
		set n = GetRandomInt(1, WV)
		if j != n then
			set f = QP[j]
			set QP[j]= QP[n]
			set QP[n]= f
		endif
		set i = i + 1
	exitwhen i > WOV
	endloop
	set UV = RLR == false and(Mode__Draft20 == false or Mode__MirrorDraft) and Mode__Draft30 == false and Mode__Draft40 == false and Mode__Draft50 == false
	if RLR == false then
		return
	endif
	set i = 1
	loop
		set QP[i]= TVE(QP[i])
		set i = i + 1
	exitwhen QP[i]== 0
	endloop
endfunction
function RMR takes integer WWV, integer i returns boolean
	local boolean b = false
	set b = DP[GetPlayerId(Sentinels[1])* GL + i]== false and DP[GetPlayerId(Sentinels[2])* GL + i]== false and DP[GetPlayerId(Sentinels[3])* GL + i]== false and DP[GetPlayerId(Sentinels[4])* GL + i]== false and DP[GetPlayerId(Sentinels[5])* GL + i]== false
	set b = b and(DP[GetPlayerId(Scourges[1])* GL + i]== false and DP[GetPlayerId(Scourges[2])* GL + i]== false and DP[GetPlayerId(Scourges[3])* GL + i]== false and DP[GetPlayerId(Scourges[4])* GL + i]== false and DP[GetPlayerId(Scourges[5])* GL + i]== false)
	return b
endfunction

// 给玩家分配酒馆
function RPR takes integer iPlayerId, boolean RQR returns nothing
	local integer i
	local integer c = 10 + BP
	if c <= LoadInteger(HY, iPlayerId,'sdcn') then
		return
	endif
	loop
		set i = GetRandomInt(1, WV)
		if UV then
		exitwhen not DP[iPlayerId * GL + QP[i]] and RMR(iPlayerId, QP[i])
		else
		exitwhen not DP[iPlayerId * GL + QP[i]]
		endif
	exitwhen WV < c
	endloop
	if DP[iPlayerId * GL + QP[i]]== false then
		call RGR(Player(iPlayerId), VUV[QP[i]], QP[i])
		set DP[iPlayerId * GL + QP[i]]= true
		if RQR then
			call RGR(Player(iPlayerId + 6), VUV[QP[i]], QP[i])
			set DP[(iPlayerId + 6)* GL + QP[i]]= true
		endif
	endif
	call SaveInteger(HY, iPlayerId,'sdcn', LoadInteger(HY, iPlayerId,'sdcn')+ 1)
endfunction

// 给玩家分配酒馆 专门给MD模式的
function InitBarAndHeroByMDMode takes integer iTeamIndex, boolean bIsSentinelPlayer returns nothing
	local integer i
	local integer c = 10 + BP
	local integer iPlayerIndex// = GetPlayerId(Sentinels[iTeamIndex])
	if bIsSentinelPlayer then
		set iPlayerIndex = GetPlayerId(Sentinels[iTeamIndex])
	else
		set iPlayerIndex = GetPlayerId(Scourges[iTeamIndex])
	endif
	if c <= LoadInteger(HY, iTeamIndex,'sdcn') then
		return
	endif
	loop
		set i = GetRandomInt(1, WV)
		if UV then
		exitwhen not DP[iPlayerIndex * GL + QP[i]] and RMR(iPlayerIndex, QP[i])
		else
		exitwhen not DP[iPlayerIndex * GL + QP[i]]
		endif
	exitwhen WV < c
	endloop
	if not DP[iPlayerIndex * GL + QP[i]] then
		call RGR(Player(iPlayerIndex), VUV[QP[i]], QP[i])
		set DP[iPlayerIndex * GL + QP[i]]= true
		// 如果是近卫军团 就给天灾军团也弄一个
		if bIsSentinelPlayer and IsPlaying(Scourges[iTeamIndex]) then
			call RGR(Scourges[iTeamIndex], VUV[QP[i]], QP[i])
			set DP[(GetPlayerId(Scourges[iTeamIndex]))* GL + QP[i]]= true
		endif
	endif
	call SaveInteger(HY, iTeamIndex,'sdcn', LoadInteger(HY, iTeamIndex,'sdcn')+ 1)
endfunction

// 近卫Sentinels[] 天灾Scourges[]
function RSR takes integer iTeamIndex, integer i returns nothing
	// 如果是近卫或天灾就返回
	if iTeamIndex == 0 or iTeamIndex == 6 or i == 0 then
		return
	endif
	if not IsPlaying(Sentinels[iTeamIndex]) then
		// 如果 近卫没玩家 天灾有玩家
		if IsPlaying(Scourges[iTeamIndex]) then
			call InitBarAndHeroByMDMode(iTeamIndex, false)
			//if i == 1 then
			//	call BJDebugMsg("天灾存在玩家"+I2S(iTeamIndex))
			//endif
			// 如果两边没有玩家就返回
			return
		endif
	else
		// 那么就是近卫有玩家的情况
		call InitBarAndHeroByMDMode(iTeamIndex, true)
		//if i == 1 then
		//	call BJDebugMsg("近卫天灾存在玩家"+I2S(iTeamIndex))
		//endif
	endif
endfunction

function RemoveAllPickTavern takes nothing returns nothing
	call RemoveUnit(EVV)
	call RemoveUnit(EEV)
	call RemoveUnit(EXV)
	call RemoveUnit(EOV)
	call RemoveUnit(ERV)
	call RemoveUnit(EIV)
	call RemoveUnit(EAV)
	call RemoveUnit(ENV)
	call RemoveUnit(EBV)
	call RemoveUnit(ECV)
	call RemoveUnit(EDV)
	call RemoveUnit(EFV)
endfunction
// MD初始化酒馆
function RWR takes nothing returns nothing
	local integer i
	local integer iPlayerIndex = 1
	local integer c = 10 + BP
	loop
		set i = 1
		loop
			call RSR(iPlayerIndex, i)
			set i = i + 1
		exitwhen(i > c)
		endloop
		set iPlayerIndex = iPlayerIndex + 1
	exitwhen iPlayerIndex > 5
	endloop
endfunction
// MD初始化
function RYR takes nothing returns nothing
	call RemoveAllPickTavern()
	call RKR()
	call ExecuteFunc("RWR")
	call ExecuteFunc("QUX")
	call PanCameraToTimed(-7008., 6816., .0)
endfunction
function RZR takes integer id returns nothing
	set RB[IB]= id
	set IB = IB + 1
endfunction
function R_R takes nothing returns nothing
	call RZR((8 -1)* 4 + 1)
	call RZR((6 -1)* 4 + 1)
	call RZR((95 -1)* 4 + 4)
	call RZR((22 -1)* 4 + 1)
	call RZR((46 -1)* 4 + 1)
	call RZR((37 -1)* 4 + 4)
	call RZR((33 -1)* 4 + 2)
	call RZR((39 -1)* 4 + 2)
	call RZR((HB -1)* 4 + 4)
	call RZR((77 -1)* 4 + 4)
	call RZR((81 -1)* 4 + 1)
	call RZR((66 -1)* 4 + 2)
	call RZR((74 -1)* 4 + 4)
	call RZR((63 -1)* 4 + 1)
	call RZR(('l'-1)* 4 + 1)
	call RZR(('j'-1)* 4 + 4)
	call RZR((1 -1)* 4 + 1)
	call RZR((40 -1)* 4 + 2)
	call RZR((48 -1)* 4 + 2)
	call RZR((7 -1)* 4 + 2)
	call RZR((54 -1)* 4 + 1)
	call RZR((69 -1)* 4 + 4)
	call RZR((89 -1)* 4 + 1)
	call RZR((65 -1)* 4 + 1)
	call RZR((61 -1)* 4 + 4)
	call RZR((5 -1)* 4 + 2)
	call RZR((41 -1)* 4 + 2)
	call RZR((47 -1)* 4 + 1)
	call RZR((DB -1)* 4 + 2)
	call RZR((28 -1)* 4 + 2)
	call RZR((28 -1)* 4 + 3)
	call RZR((38 -1)* 4 + 2)
	call RZR((18 -1)* 4 + 1)
	call RZR((53 -1)* 4 + 1)
	call RZR((75 -1)* 4 + 3)
	call RZR((75 -1)* 4 + 4)
	call RZR(('h'-1)* 4 + 1)
	call RZR(('h'-1)* 4 + 2)
	call RZR((86 -1)* 4 + 1)
	call RZR((95 -1)* 4 + 1)
	call RZR(( 100 -1)* 4 + 1)
	call RZR((97 -1)* 4 + 1)
	call RZR((87 -1)* 4 + 2)
	call RZR(('e'-1)* 4 + 1)
	call RZR(('p'-1)* 4 + 1)
	call RZR((31 -1)* 4 + 1)
	call RZR((46 -1)* 4 + 4)
	call RZR(('o'-1)* 4 + 1)
	call RZR((78 -1)* 4 + 1)
	call RZR((4 -1)* 4 + 2)
	call RZR(( 120-1)* 4 + 2)
	call RZR((91 -1)* 4 + 2)
	call RZR((78 -1)* 4 + 4)
	call RZR((82 -1)* 4 + 1)
	call RZR(('m'-1)* 4 + 4)
	call RZR((96 -1)* 4 + 4)
endfunction
function R0R takes integer id, integer TXE, integer TOE, integer QMX, integer QPX returns nothing
	if Mode__RearmCombos == false and Mode__BalanceOff == false then
		if TXE =='Z601' then
			call SaveSkillOrder(id * 4 + 1, "r23")
		elseif TOE =='Z601' then
			call SaveSkillOrder(id * 4 + 2, "r23")
		elseif QMX =='Z601' then
			call SaveSkillOrder(id * 4 + 3, "r23")
		elseif QPX =='Z601' then
			call SaveSkillOrder(id * 4 + 4, "r23")
		endif
	endif
endfunction
function R1R takes nothing returns nothing
	local integer i = 1
	local integer k = 0
	local integer j = 1
	local integer array s
	local string array R2R
	local string array R3R
	local string array R4R
	local integer array QSX
	local integer array R5R
	local integer R6R
	local unit u = CreateUnit(Player(13), 'e00E', 0, 0, 0)
	//local integer rndIndex
	set s[1]= 1
	set s[2]= 2
	set s[3]= 3
	set s[4]= 4
	set s[5]= 5
	set s[6]= 6
	set s[7]= 7
	set s[8]= 8
	set s[9]= 9
	set s[10]= 10
	set R4R[1]= "t"
	set R4R[2]= "d"
	set R4R[3]= "f"
	set R4R[4]= "y"
	set R4R[5]= "v"
	set R4R[6]= "g"
	set R4R[7]= "z"
	set R4R[8]= "x"
	set R4R[9]= "c"
	set R4R[10]= "b"
	loop
	exitwhen(i == 10)
		set k = GetRandomInt(1, 10)
		set R6R = s[i]
		set s[i]= s[k]
		set s[k]= R6R
		set i = i + 1
	endloop
	set R3R[1]= "request_hero"
	set R3R[2]= "mechanicalcritter"
	set R3R[3]= "militia"
	set R3R[4]= "militiaconvert"
	set R3R[5]= "windwalk"
	set R3R[6]= "militiaoff"
	set R3R[7]= "militiaunconvert"
	set R3R[8]= "mindrot"
	set R3R[9]= "monsoon"
	set R3R[10]= "mount"
	set i = 1
	loop
		set QSX[i]='Z600'+ i
		set R5R[i]='Y600'+ i
		set R2R[i]= GetAbilitySoundById(QSX[i], SOUND_TYPE_EFFECT_LOOPED)
		set i = i + 1
	exitwhen i > 9
	endloop
	set QSX[10]='Z610'
	set R5R[10]='Y610'
	set R2R[10]= GetAbilitySoundById(QSX[10], SOUND_TYPE_EFFECT_LOOPED)
	set i = 114 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, R3R[s[1]]), QSX[s[1]], 0, R5R[s[1]], R4R[s[1]])
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, R3R[s[2]]), QSX[s[2]], 0, R5R[s[2]], R4R[s[2]])
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, R3R[s[3]]), QSX[s[3]], 0, R5R[s[3]], R4R[s[3]])
	call RegisterHeroSkill(i * 4 + 4, null, 0, 0, 0, "_")
	set IsDisabledSkill[i * 4 + 4]= true
	call R0R(i, QSX[s[1]], QSX[s[2]], QSX[s[3]], 0)
	set i = 115 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, R3R[s[4]]), QSX[s[4]], 0, R5R[s[4]], R4R[s[4]])
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, R3R[s[5]]), QSX[s[5]], 0, R5R[s[5]], R4R[s[5]])
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, R3R[s[6]]), QSX[s[6]], 0, R5R[s[6]], R4R[s[6]])
	call RegisterHeroSkill(i * 4 + 4, null, 0, 0, 0, "_")
	set IsDisabledSkill[i * 4 + 4]= true
	call R0R(i, QSX[s[4]], QSX[s[5]], QSX[s[6]], 0)
	set i = 116 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, R3R[s[7]]), QSX[s[7]], 0, R5R[s[7]], R4R[s[7]])
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, R3R[s[8]]), QSX[s[8]], 0, R5R[s[8]], R4R[s[8]])
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, R3R[s[9]]), QSX[s[9]], 0, R5R[s[9]], R4R[s[9]])
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, R3R[s[10]]), QSX[s[10]], 0, R5R[s[10]], R4R[s[10]])
	call R0R(i, QSX[s[7]], QSX[s[8]], QSX[s[9]], QSX[s[10]])
	set i = 114 -1
	loop
	exitwhen i > 116 -1
		if HeroCommonSkills[i * 4 + 1]=='Z610' then
			call RZR(i * 4 + 1)
			set i = 1231
		elseif HeroCommonSkills[i * 4 + 2]=='Z610' then
			call RZR(i * 4 + 2)
			set i = 1231
		elseif HeroCommonSkills[i * 4 + 3]=='Z610' then
			call RZR(i * 4 + 3)
			set i = 1231
		elseif HeroCommonSkills[i * 4 + 4]=='Z610' then
			call RZR(i * 4 + 4)
			set i = 1231
		endif
		set i = i + 1
	endloop
	set i = 1
	//call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, GetObjectName('n06G'))
	loop
	exitwhen i > 10
		call UnitAddAbility(u, QSX[s[i]])
		set i = i + 1
	endloop
	call UnitAddAbility(u,'QFZZ')
	call RemoveUnit(u)
	set u = null
endfunction
function R7R takes integer iPlayerIndex, integer i returns nothing
	// 如果是近卫或天灾就拉倒
	if iPlayerIndex == 0 or iPlayerIndex == 6 or i == 0 then
		return
	endif
	// 玩家不存在也拉倒 并且没有玩家名字等于"df" (不知道什么鬼 也许是俄国作者想要和谐玩家)
	if not IsPlaying(Player(iPlayerIndex)) and not JE then
		return
	endif
	call RPR(iPlayerIndex, false)
endfunction
// SD初始化酒馆
function R8R takes nothing returns nothing
	local integer iPlayerIndex = 0
	local integer i
	local integer c = 10 + BP
	loop
		set i = 1
		loop
			call R7R(iPlayerIndex, i)
			set i = i + 1
		exitwhen(i > c)
		endloop
		set iPlayerIndex = iPlayerIndex + 1
		if iPlayerIndex == 6 then
			set iPlayerIndex = 7
		endif
	exitwhen(iPlayerIndex > 11)
	endloop
endfunction
// SD初始化
function R9R takes nothing returns nothing
	call RemoveAllPickTavern()
	call RKR()
	call ExecuteFunc("R8R")
	call ExecuteFunc("QUX")
	call PanCameraToTimed(-7008., 6816., .0)
endfunction
function SPO takes nothing returns nothing
	local integer WWV = LoadInteger(HY,'0REA','0PID')
	local integer ZKE = LoadInteger(HY,'0REA','0SID')
	local boolean UEE = LoadBoolean(HY,'0REA','000B')
	call OWR(ZKE, WWV, UEE)
endfunction
function IVR takes nothing returns nothing
	local integer WWV = 0
	local integer ZKE = 0
	local integer UXO = 0
	set WWV = 1
	loop
		if T6E(WWV) then
			if ExtraAbilitiesNum  >= 1 then
				loop
					if MainModeName =="sd" or MainModeName =="md" then
						loop
							set UXO = UIE(GetRandomInt(1, GL))
						exitwhen DP[WWV * GL + UXO]and ZQ[UXO]== false
						endloop
						set UXO = QP[UXO]
					else
						loop
							set UXO = UIE(GetRandomInt(1, GL))
						exitwhen(ZQ[UXO]== false and GetPlayerTechMaxAllowed(Player(WWV), VUV[UXO -1])> 0)
						endloop
					endif
					set ZKE =(UXO -1)* 4
					set ZKE = ZKE + GetRandomInt(1, 3)
					call SaveInteger(HY,'0REA','0PID', WWV)
					call SaveInteger(HY,'0REA','0SID', ZKE)
					call SaveBoolean(HY,'0REA','000B', false)
					call ExecuteFunc("SPO")
				exitwhen PlayerSkillIndex[WWV * HL + 5]!= 0
				endloop
			endif
			if ExtraAbilitiesNum  >= 2 then
				loop
					if MainModeName =="sd" or MainModeName =="md" then
						loop
							set UXO = UIE(GetRandomInt(1, GL))
						exitwhen DP[WWV * GL + UXO]and ZQ[UXO]== false
						endloop
						set UXO = QP[UXO]
					else
						loop
							set UXO = UIE(GetRandomInt(1, GL))
						exitwhen(ZQ[UXO]== false and GetPlayerTechMaxAllowed(Player(WWV), VUV[UXO])> 0)
						endloop
					endif
					set ZKE =(UXO -1)* 4 + 4
					call SaveInteger(HY,'0REA','0PID', WWV)
					call SaveInteger(HY,'0REA','0SID', ZKE)
					call SaveBoolean(HY,'0REA','000B', false)
					call ExecuteFunc("SPO")
				exitwhen PlayerSkillIndex[WWV * HL + 6]!= 0
				endloop
			endif
		endif
		set WWV = WWV + 1
		if WWV == 6 then
			set WWV = 7
		endif
	exitwhen(WWV >$C)
	endloop
endfunction
function IER takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local image im
	local integer S7V = LoadInteger(HY, h, 0)-1
	local real x = LoadReal(HY, h, 10)
	local real y = LoadReal(HY, h, 11)
	local string s
	set im = LoadImageHandle(HY, h, 1)
	call DestroyImage(im)
	set im = LoadImageHandle(HY, h, 2)
	call DestroyImage(im)
	if S7V < 0 then
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
		set t = null
		return
	endif
	set s = I2S(S7V)
	if S7V <$A then
		set s = "0" + s
	endif
	call TXV("Fonts\\" + SubString(s, 0, 1)+ ".blp", 60, 60, x, y, 0, true)
	call SaveImageHandle(HY, h, 1, R3)
	call SetImageColor(R3, 255, 255, 255, 255)
	call TXV("Fonts\\" + SubString(s, 1, 2)+ ".blp", 60, 60, x + 40, y, 0, true)
	call SaveImageHandle(HY, h, 2, R3)
	call SetImageColor(R3, 255, 255, 255, 255)
	call SaveInteger(HY, h, 0, S7V)
	set t = null
endfunction
function IXR takes real S7V returns nothing
	local integer ht = GetHandleId(GetTriggeringTrigger())
	local timer IOR = LoadTimerHandle(HY, ht, 5)
	local integer oh = GetHandleId(IOR)
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local image IRR
	local image IIR
	local string s = I2S(R2I(S7V))
	local real x =-7030
	local real y = 6766
	if oh > 1 then
		set IRR = LoadImageHandle(HY, oh, 1)
		set IIR = LoadImageHandle(HY, oh, 2)
		call DestroyImage(IRR)
		call DestroyImage(IIR)
		call PauseTimer(IOR)
		call DestroyTimer(IOR)
		call FlushChildHashtable(HY, oh)
	endif
	call SaveTimerHandle(HY, ht, 5, t)
	call SaveReal(HY, h, 10, x)
	call SaveReal(HY, h, 11, y)
	call TXV("Fonts\\" + SubString(s, 0, 1)+ ".blp", 60, 60, x, y, 0, true)
	call SaveImageHandle(HY, h, 1, R3)
	call SetImageColor(R3, 255, 255, 255, 255)
	call TXV("Fonts\\" + SubString(s, 1, 2)+ ".blp", 60, 60, x + 40, y, 0, true)
	call SaveImageHandle(HY, h, 2, R3)
	call SetImageColor(R3, 255, 255, 255, 255)
	call TimerStart(t, 1, true, function IER)
	call SaveInteger(HY, h, 0, R2I(S7V))
	set IOR = null
	set t = null
endfunction
function IAR takes integer h, real x, real y returns nothing
	local integer i = 0
	local string s = "YOUR PICK"
	local integer k = 0
	call TXV("Fonts\\Y.blp", 60, 60, x -40 * 4, y, 0, true)
	call SetImageColor(R3, 255, 0, 0, k)
	call SaveImageHandle(HY, h,$C8+ 0, R3)
	call TXV("Fonts\\O.blp", 60, 60, x -40 * 3, y, 0, true)
	call SetImageColor(R3, 255, 0, 0, k)
	call SaveImageHandle(HY, h,$C8+ 1, R3)
	call TXV("Fonts\\U.blp", 60, 60, x -40 * 2, y, 0, true)
	call SetImageColor(R3, 255, 0, 0, k)
	call SaveImageHandle(HY, h,$C8+ 2, R3)
	call TXV("Fonts\\R.blp", 60, 60, x -40 * 1, y, 0, true)
	call SetImageColor(R3, 255, 0, 0, k)
	call SaveImageHandle(HY, h,$C8+ 3, R3)
	call TXV("Fonts\\P.blp", 60, 60, x + 40 * 1, y, 0, true)
	call SetImageColor(R3, 255, 0, 0, k)
	call SaveImageHandle(HY, h,$C8+ 4, R3)
	call TXV("Fonts\\I.blp", 60, 60, x + 40 * 2, y, 0, true)
	call SetImageColor(R3, 255, 0, 0, k)
	call SaveImageHandle(HY, h,$C8+ 5, R3)
	call TXV("Fonts\\C.blp", 60, 60, x + 40 * 2.5, y, 0, true)
	call SetImageColor(R3, 255, 0, 0, k)
	call SaveImageHandle(HY, h,$C8+ 6, R3)
	call TXV("Fonts\\K.blp", 60, 60, x + 40 * 3.5, y, 0, true)
	call SetImageColor(R3, 255, 0, 0, k)
	call SaveImageHandle(HY, h,$C8+ 7, R3)
endfunction
function INR takes player p, unit IBR returns nothing
	local integer TME = GetPlayerId(p)
	local unit u
	local integer hu = GetHandleId(IBR)
	local integer h = GetHandleId(GetTriggeringTrigger())
	local integer i = LoadInteger(HY, hu, 0)
	set FP[TME]= true
	set PlayerSkillIndex[TME * HL + 1]= LoadInteger(HY, h, 100 * i + 1)
	set PlayerSkillIndex[TME * HL + 2]= LoadInteger(HY, h, 100 * i + 2)
	set PlayerSkillIndex[TME * HL + 3]= LoadInteger(HY, h, 100 * i + 3)
	set PlayerSkillIndex[TME * HL + 4]= LoadInteger(HY, h, 100 * i + 4)
	set PlayerSkillIndex[TME * HL + 5]= LoadInteger(HY, h, 100 * i + 5)
	set PlayerSkillIndex[TME * HL + 6]= LoadInteger(HY, h, 100 * i + 6)
	call ORR(PlayerSkillIndex[TME * HL + 1])
	call ORR(PlayerSkillIndex[TME * HL + 2])
	call ORR(PlayerSkillIndex[TME * HL + 3])
	call ORR(PlayerSkillIndex[TME * HL + 4])
	call ORR(PlayerSkillIndex[TME * HL + 5])
	call ORR(PlayerSkillIndex[TME * HL + 6])
	call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD)-$FA)
	if IsSentinelsPlayer(p) then
		set Player__Hero[TME]= CreateUnit(p, VUV[GetUnitUserData(IBR)], GetRectCenterX(VZ), GetRectCenterY(VZ), 0)
		call ShowUnit(IBR, false)
		call UnitApplyTimedLife(IBR,'BTLF', 120)
		set u = CreateUnit(p, RX[GetUnitUserData(IBR)],-7250 +(GetPlayerId(p)-1)* 110, 6900, 270)
	else
		set Player__Hero[TME]= CreateUnit(p, VUV[GetUnitUserData(IBR)], GetRectCenterX(GY), GetRectCenterY(GY), 0)
		call ShowUnit(IBR, false)
		call UnitApplyTimedLife(IBR,'BTLF', 120)
		set u = CreateUnit(p, RX[GetUnitUserData(IBR)],-7250 +(GetPlayerId(p)-7)* 110, 6590, 90)
	endif
	call PauseUnit(u, true)
	call SaveUnitHandle(HY, h, 100 + i, u)
	call SetUnitUserData(IBR, 0)
	set u = null
endfunction
function ICR takes integer TME returns nothing
	local player p = Player(TME)
	local integer i = 0
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit u
	loop
		set i = GetRandomInt(1, XT)
		set u = LoadUnitHandle(HY, h, 50 + i)
	exitwhen GetUnitUserData(u)!= 0
	endloop
	call INR(p, u)
	set u = null
endfunction
function IDR takes nothing returns nothing
	local unit u = GetSoldUnit()
	local player p = GetOwningPlayer(u)
	local integer TME = GetPlayerId(p)
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit IBR
	if GetUnitTypeId(u)=='h06N'then
		call RemoveUnit(u)
		set u = null
		if TME != LoadInteger(HY, h, 10) and TME != LoadInteger(HY, h, 11) then
			call InterfaceErrorForPlayer(p, "还未到你选择.")
		else
			set IBR = GetSellingUnit()
			call INR(p, IBR)
			if TME == LoadInteger(HY, h, 10) then
				call RemoveSavedInteger(HY, h, 10)
			else
				call RemoveSavedInteger(HY, h, 11)
			endif
		endif
	endif
endfunction
function IFR takes integer h returns nothing
	call DestroyImage(LoadImageHandle(HY, h,$C8+ 0))
	call DestroyImage(LoadImageHandle(HY, h,$C8+ 1))
	call DestroyImage(LoadImageHandle(HY, h,$C8+ 2))
	call DestroyImage(LoadImageHandle(HY, h,$C8+ 3))
	call DestroyImage(LoadImageHandle(HY, h,$C8+ 4))
	call DestroyImage(LoadImageHandle(HY, h,$C8+ 5))
	call DestroyImage(LoadImageHandle(HY, h,$C8+ 6))
	call DestroyImage(LoadImageHandle(HY, h,$C8+ 7))
endfunction
function IGR takes integer h returns nothing
	call SetImageColor(LoadImageHandle(HY, h,$C8+ 0), 255, 0, 0, 0)
	call SetImageColor(LoadImageHandle(HY, h,$C8+ 1), 255, 0, 0, 0)
	call SetImageColor(LoadImageHandle(HY, h,$C8+ 2), 255, 0, 0, 0)
	call SetImageColor(LoadImageHandle(HY, h,$C8+ 3), 255, 0, 0, 0)
	call SetImageColor(LoadImageHandle(HY, h,$C8+ 4), 255, 0, 0, 0)
	call SetImageColor(LoadImageHandle(HY, h,$C8+ 5), 255, 0, 0, 0)
	call SetImageColor(LoadImageHandle(HY, h,$C8+ 6), 255, 0, 0, 0)
	call SetImageColor(LoadImageHandle(HY, h,$C8+ 7), 255, 0, 0, 0)
endfunction
function IHR takes integer h returns nothing
	call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, GetObjectName('n068'))
	call SetImageColor(LoadImageHandle(HY, h,$C8+ 0), 255, 0, 0, 255)
	call SetImageColor(LoadImageHandle(HY, h,$C8+ 1), 255, 0, 0, 255)
	call SetImageColor(LoadImageHandle(HY, h,$C8+ 2), 255, 0, 0, 255)
	call SetImageColor(LoadImageHandle(HY, h,$C8+ 3), 255, 0, 0, 255)
	call SetImageColor(LoadImageHandle(HY, h,$C8+ 4), 255, 0, 0, 255)
	call SetImageColor(LoadImageHandle(HY, h,$C8+ 5), 255, 0, 0, 255)
	call SetImageColor(LoadImageHandle(HY, h,$C8+ 6), 255, 0, 0, 255)
	call SetImageColor(LoadImageHandle(HY, h,$C8+ 7), 255, 0, 0, 255)
endfunction
function IJR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u
	local integer c = LoadInteger(HY, h, 0)
	local integer i
	local string s
	local string s1
	local string s2
	local integer IKR
	local integer V0R
	local integer ILR
	local integer IMR
	if GetTriggerEventId()== EVENT_UNIT_SELL then
		call IDR()
		set t = null
		return false
	endif
	if LoadBoolean(HY, h, 0) then
		set i = 1
		call DestroyMultiboard(JP)
		call MultiboardDisplay(BT, true)
		set BJ_Multiboard = BT
		call AddUnitToStock(J7,'h02C', 2, 4) 		//游戏开始时添加贩卖
		call AddUnitToStock(SentinelsShop_AncientOfWonders,'h02C', 2, 4)
		call AddUnitToStock(SentinelsShop_PigKing,'n139', 0, 3) 		//游戏开始时添加经验书
		call AddUnitToStock(shop_2,'n139', 0, 3)
		loop
			set u = LoadUnitHandle(HY, h, 50 + i)
			call FlushChildHashtable(HY, GetHandleId(u))
			call RemoveUnit(u)
			if HaveSavedHandle(HY, h, 100 + i) then
				set u = LoadUnitHandle(HY, h, 100 + i)
				call FlushChildHashtable(HY, GetHandleId(u))
				call RemoveUnit(u)
			endif
			set i = i + 1
		exitwhen i > XT
		endloop
		call IFR(h)
		call FogModifierStop(LoadFogModifierHandle(HY, h,$DC))
		call DestroyFogModifier(LoadFogModifierHandle(HY, h,$DC))
		call FogModifierStop(LoadFogModifierHandle(HY, h,$DD))
		call DestroyFogModifier(LoadFogModifierHandle(HY, h,$DD))
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
		set t = null
		return false
	endif
	if c == 0 then
		set i = GetRandomInt(1, 2)
		if i == 1 then
			set s = "1221122112"
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, JS[GetPlayerId(Sentinels[0])]+ GetObjectName('n065')+ "|r 将会以 1-2-2-2-2-1 的顺序选取英雄")
		else
			set s = "2112211221"
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, JS[GetPlayerId(Scourges[0])]+ GetObjectName('n06C')+ "|r 将会以 1-2-2-2-2-1 的顺序选取英雄")
		endif
		call SaveStr(HY, h, 0, s)
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15., " ")
	endif
	set s = LoadStr(HY, h, 0)
	if LoadInteger(HY, h, 10)> 0 and Player__Hero[LoadInteger(HY, h, 10)]== null then
		call ICR(LoadInteger(HY, h, 10))
	endif
	if LoadInteger(HY, h, 11)> 0 and Player__Hero[LoadInteger(HY, h, 11)]== null then
		call ICR(LoadInteger(HY, h, 11))
	endif
	if StringLength(s)>= c + 1 then
		call IGR(h)
		set s1 = SubString(s, c, c + 1)
		set s2 = SubString(s, c + 1, c + 2)
		set IMR = LoadInteger(HY, h, 5)+ 1
		set ILR = LoadInteger(HY, h, 6)+ 1
		set IKR = S2I(s1)
		set V0R = S2I(s2)
		if IKR != V0R then
			if IKR == 1 then
				call SaveInteger(HY, h, 10, GetPlayerId(Sentinels[IMR]))
				call SaveInteger(HY, h, 5, IMR)
				call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, JS[GetPlayerId(Sentinels[IMR])]+ VMV[GetPlayerId(Sentinels[IMR])]+ "|r " + GetObjectName('n064'))
				if LocalPlayer== Sentinels[IMR]then
					call IHR(h)
				endif
			else
				call SaveInteger(HY, h, 10, GetPlayerId(Scourges[ILR]))
				call SaveInteger(HY, h, 6, ILR)
				call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, JS[GetPlayerId(Scourges[ILR])]+ VMV[GetPlayerId(Scourges[ILR])]+ "|r " + GetObjectName('n064'))
				if LocalPlayer== Scourges[ILR]then
					call IHR(h)
				endif
			endif
			call SaveInteger(HY, h, 0, c + 1)
		else
			if IKR == 1 then
				call SaveInteger(HY, h, 10, GetPlayerId(Sentinels[IMR]))
				call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, JS[GetPlayerId(Sentinels[IMR])]+ VMV[GetPlayerId(Sentinels[IMR])]+ "|r " + GetObjectName('n064'))
				if LocalPlayer== Sentinels[IMR]then
					call IHR(h)
				endif
				if IMR + 1 < 6 then
					call SaveInteger(HY, h, 11, GetPlayerId(Sentinels[IMR + 1]))
					call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, JS[GetPlayerId(Sentinels[IMR + 1])]+ VMV[GetPlayerId(Sentinels[IMR + 1])]+ "|r " + GetObjectName('n064'))
					if LocalPlayer== Sentinels[IMR + 1]then
						call IHR(h)
					endif
				endif
				call SaveInteger(HY, h, 5, IMR + 1)
			else
				call SaveInteger(HY, h, 10, GetPlayerId(Scourges[ILR]))
				call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, JS[GetPlayerId(Scourges[ILR])]+ VMV[GetPlayerId(Scourges[ILR])]+ "|r " + GetObjectName('n064'))
				if LocalPlayer== Scourges[ILR]then
					call IHR(h)
				endif
				if ILR + 1 < 6 then
					call SaveInteger(HY, h, 11, GetPlayerId(Scourges[ILR + 1]))
					call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 15, JS[GetPlayerId(Scourges[ILR + 1])]+ VMV[GetPlayerId(Scourges[ILR + 1])]+ "|r " + GetObjectName('n064'))
					if LocalPlayer== Scourges[ILR + 1]then
						call IHR(h)
					endif
				endif
				call SaveInteger(HY, h, 6, ILR + 1)
			endif
			call SaveInteger(HY, h, 0, c + 2)
		endif
		call TriggerRegisterTimerEvent(t, 20, false)
		call IXR(20)
	else
		call SaveBoolean(HY, h, 0, true)
		call TriggerRegisterTimerEvent(t, 20, false)
	endif
	set t = null
	return false
endfunction
// takes integer c, unit u, integer h
function IPR takes nothing returns nothing
	local integer i = 0
	local integer ZKE
	local integer te
	local unit u = U2
	local integer c = Temp__ArrayInt[0]
	local integer h = Temp__ArrayInt[1]
	set FP[i]= false
	set PlayerSkillIndex[1]= 0
	set PlayerSkillIndex[2]= 0
	set PlayerSkillIndex[3]= 0
	set PlayerSkillIndex[4]= 0
	set PlayerSkillIndex[5]= 0
	set PlayerSkillIndex[6]= 0

	loop
	exitwhen FP[i]
		set ZKE =(GetRandomInt(1, GL * 4))
		set te =((ZKE + 3)/ 4)
		call SaveInteger(HY,'0REA','0PID', i)
		call SaveInteger(HY,'0REA','0SID', ZKE)
		call SaveBoolean(HY,'0REA','000B', false)
		call SaveUnitHandle(HY,'0REA','000U', u)
		call ExecuteFunc("SPO")
	endloop
	call SaveInteger(HY, h, 100 * c + 1, PlayerSkillIndex[1])
	call SaveInteger(HY, h, 100 * c + 2, PlayerSkillIndex[2])
	call SaveInteger(HY, h, 100 * c + 3, PlayerSkillIndex[3])
	call SaveInteger(HY, h, 100 * c + 4, PlayerSkillIndex[4])
	call SaveInteger(HY, h, 100 * c + 5, PlayerSkillIndex[5])
	call SaveInteger(HY, h, 100 * c + 6, PlayerSkillIndex[6])
	call UnitAddAbility(u, QGX(HeroCommonSkills[PlayerSkillIndex[1]]))
	call SetUnitAbilityLevel(u, QGX(HeroCommonSkills[PlayerSkillIndex[1]]), 4)
	call UnitAddAbility(u, QGX(HeroCommonSkills[PlayerSkillIndex[2]]))
	call SetUnitAbilityLevel(u, QGX(HeroCommonSkills[PlayerSkillIndex[2]]), 4)
	call UnitAddAbility(u, QGX(HeroCommonSkills[PlayerSkillIndex[3]]))
	call SetUnitAbilityLevel(u, QGX(HeroCommonSkills[PlayerSkillIndex[3]]), 4)
	call UnitAddAbility(u, QGX(HeroCommonSkills[PlayerSkillIndex[4]]))
	call SetUnitAbilityLevel(u, QGX(HeroCommonSkills[PlayerSkillIndex[4]]), 4)
	
	//call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "循环:"+I2S( c ) + " 技能名" + GetObjectName( QGX(HeroCommonSkills[PlayerSkillIndex[4]]) ))
	if ExtraAbilitiesNum  > 0 then
		call UnitAddAbility(u, QGX(HeroCommonSkills[PlayerSkillIndex[5]]))
		call SetUnitAbilityLevel(u, QGX(HeroCommonSkills[PlayerSkillIndex[5]]), 4)
		call SaveInteger(HY, GetHandleId(u),'RDIN'+ 5, PlayerSkillIndex[5])
	endif
	if ExtraAbilitiesNum  > 1 then
		call UnitAddAbility(u, QGX(HeroCommonSkills[PlayerSkillIndex[6]]))
		call SetUnitAbilityLevel(u, QGX(HeroCommonSkills[PlayerSkillIndex[6]]), 4)
		call SaveInteger(HY, GetHandleId(u),'RDIN'+ 6, PlayerSkillIndex[6])
	endif
	call SaveInteger(HY, GetHandleId(u),'RDIN'+ 1, PlayerSkillIndex[1])
	call SaveInteger(HY, GetHandleId(u),'RDIN'+ 2, PlayerSkillIndex[2])
	call SaveInteger(HY, GetHandleId(u),'RDIN'+ 3, PlayerSkillIndex[3])
	call SaveInteger(HY, GetHandleId(u),'RDIN'+ 4, PlayerSkillIndex[4])

	set u = null
endfunction
// 初始化 随机征召
function InitMode__RandomDraft takes nothing returns nothing
	local integer array QSX
	local integer i = 1
	local integer iHeroIndex = 0
	local unit u
	local real x
	local real y
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local fogmodifier fm
	local timer OLR = CreateTimer()
	call TimerStart(OLR, 180, false, function OCR)
	set OLR = null
	call IAR(h,-7000, 7080)
	// 设置选择英雄状态为否
	set InHeroSelection = false
	set IY = false
	set RY = false
	// 隐藏原本的酒馆
	call ShowUnit(EVV, false)
	call ShowUnit(EEV, false)
	call ShowUnit(EXV, false)
	call ShowUnit(EOV, false)
	call ShowUnit(ERV, false)
	call ShowUnit(EIV, false)
	call ShowUnit(EAV, false)
	call ShowUnit(ENV, false)
	call ShowUnit(EBV, false)
	call ShowUnit(ECV, false)
	call ShowUnit(EDV, false)
	call ShowUnit(EFV, false)
	// 创建单位
	loop
		loop
			set iHeroIndex = GetRandomInt(1, GL)
		exitwhen not HaveSavedBoolean(HY,'00RD', iHeroIndex)
		endloop
		call SaveBoolean(HY,'00RD', iHeroIndex, true)
		set x =-7030 + 450 * Cos(i *(360. / XT * 1.)* bj_DEGTORAD)
		set y = 6766 + 450 * Sin(i *(360. / XT * 1.)* bj_DEGTORAD)
		set u = CreateUnit(NeutralPassivePlayer, RX[iHeroIndex], x, y, AngleBetweenXY(x, y,-7030, 6766))
		call SetUnitPathing(u, false)
		call SetUnitPosition(u, x, y)
		call SetUnitUserData(u, iHeroIndex)
		call SaveUnitHandle(HY, h, 50 + i, u)
		set QSX[i]= iHeroIndex
		call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SELL)
		set U2 = u
		set Temp__ArrayInt[0] = i
		set Temp__ArrayInt[1] = h
		// call IPR(i, u, h)
		call ExecuteFunc("IPR")
		call SaveInteger(HY, GetHandleId(u), 0, i)
		set i = i + 1
	exitwhen i > XT
	endloop
	set fm = CreateFogModifierRadius(Sentinels[1], FOG_OF_WAR_VISIBLE,-7030, 6766, 900, true, true)
	call SaveFogModifierHandle(HY, h,$DC, fm)
	call FogModifierStart(fm)
	set fm = CreateFogModifierRadius(Scourges[1], FOG_OF_WAR_VISIBLE,-7030, 6766, 900, true, true)
	call SaveFogModifierHandle(HY, h,$DD, fm)
	call FogModifierStart(fm)
	set fm = null
	// 对RD的英雄进行沉默
	set u = CreateUnit(Scourges[0],'e00E',-7030, 6766, 0)
	call UnitAddAbility(u,'A457')
	call IssuePointOrderById(u,$D0270,-7030, 6766)
	call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS, 20, "所有玩家在开始挑选英雄前都有60秒的准备时间")
	call TriggerRegisterTimerEvent(t, 60, false)
	call TriggerAddCondition(t, Condition(function IJR))
	if Mode__FastNeutrals then
		set t = CreateTrigger()
		call TriggerRegisterTimerEvent(t,$D2, false)
		call TriggerAddCondition(t, Condition(function NeutralCreaturesRefreshActions))
		set t = null
	endif
	set t = null
	set u = null
endfunction
function ISR takes nothing returns nothing
	local string mn = NY
	local trigger t
	local timer OLR
	// 死亡竞赛模式或者全部随机 那就立即开始游戏(不需要选英雄)
	if mn == GetObjectName('n0I7') or mn == GetObjectName('n0II') then
		set MainModeName = "ar"
		set InHeroSelection = false
		// 游戏开始时添加贩卖经验书和假眼
		call AddUnitToStock(J7,'h02C', 2, 4)	
		call AddUnitToStock(SentinelsShop_AncientOfWonders,'h02C', 2, 4)
		call AddUnitToStock(SentinelsShop_PigKing,'n139', 0, 3) 		
		call AddUnitToStock(shop_2,'n139', 0, 3)
		call ODR()
		set OLR = CreateTimer()
		call TimerStart(OLR, 70, false, function OCR)
		set OLR = null
		if Mode__FastNeutrals then
			call NeutralCreaturesRefreshActions()
			set t = CreateTrigger()
			call TriggerRegisterTimerEvent(t, 30, false)
			call TriggerRegisterTimerEvent(t, 90, false)
			call TriggerAddCondition(t, Condition(function NeutralCreaturesRefreshActions))
			set t = null
		endif
	elseif mn == GetObjectName('n0ID') then
		set MainModeName = "ap"
		call QUX()
		if Mode__RandomExtraAbilities then
			call IVR()
		endif
	elseif mn == GetObjectName('n0IF') then
		set MainModeName = "rd"
		// 直接运行似乎会遇到字节码上限
		call ExecuteFunc("InitMode__RandomDraft")
	elseif mn == GetObjectName('n0I4') then
		set MainModeName = "sd"
		call R9R()
		if Mode__RandomExtraAbilities then
			call IVR()
		endif
	elseif mn == GetObjectName('n0I0') then
		set MainModeName = "md"
		call RYR()
		if Mode__RandomExtraAbilities then
			call IVR()
		endif
	endif
endfunction
function ITR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u
	if GetGameTime()> LoadReal(HY, h, 0) or GetUnitAbilityLevel(LoadUnitHandle(HY, h, 0),'QH00')== 0 then
		set u = LoadUnitHandle(HY, h, 0)
		call UnitRemoveAbility(u,'C104')
		call UnitRemoveAbility(u,'C105')
		call UnitRemoveAbility(u,'C106')
		call UnitRemoveAbility(u,'C107')
		call UnitRemoveAbility(u,'QH00')
		call UnitRemoveAbility(u,'D107')
		call RemoveSavedHandle(HY, GetHandleId(u),'A0MG')
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
		set u = null
	endif
	set t = null
endfunction
function FrostmourneActions takes unit R8X, unit WLE returns nothing
	local timer t = LoadTimerHandle(HY, GetHandleId(WLE),'A0MG')
	local integer h
	if t != null then
		set h = GetHandleId(t)
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, .1, true, function ITR)
		call UnitAddPermanentAbility(WLE,'C103'+ GetUnitAbilityLevel(R8X,'A0MG'))
		call UnitAddPermanentAbility(WLE,'QH00')
		call SaveUnitHandle(HY, h, 0, WLE)
		call SaveTimerHandle(HY, GetHandleId(WLE),'A0MG', t)
	endif
	call SaveReal(HY, h, 0, GetGameTime()+ 2.5)
	set t = null
endfunction
// 霜之哀伤
function FrostmourneAEActions takes unit u, unit t returns nothing
	local integer WUV = GetUnitAbilityLevel(u,'A0MG')
	if IsUnitType(u, UNIT_TYPE_STRUCTURE) or IsUnitType(t, UNIT_TYPE_STRUCTURE) or IsUnitAlly(u, GetOwningPlayer(t)) then
		return
	endif
	if WUV > 0 then
		call WJV(u,'C107'+ WUV,'D105', 4.5)
		return
	endif
	if GetUnitAbilityLevel(t,'D107')== 1 then
		set WUV = GetUnitAbilityLevel(t,'C104')+ 2 * GetUnitAbilityLevel(t,'C105')+ 3 * GetUnitAbilityLevel(t,'C106')+ 4 * GetUnitAbilityLevel(t,'C107')
		if WUV > 4 then
			set WUV = 4
		endif
		if WUV > 0 then
			call WJV(u,'C107'+ WUV,'D105', 4.5)
		endif
	endif
endfunction
// 注册A杖升级 iNormalId iChangeId iUpgradeId AghanimUpgradeMaxIndex
// 通过GetSkillAghanimUpgradeIndex来获得技能的神杖升级索引
function RegisterAghanimUpgrade takes integer iNormalId, integer iChangeId, integer iUpgradeId, integer whichInteger returns nothing
	// 获取原本技能的索引()
	local integer id = Z9E(iNormalId)
	// 原本技能
	set NF[AghanimUpgradeMaxIndex] = iNormalId
	// 神杖升级的工程升级技能
	set RF[AghanimUpgradeMaxIndex] = iChangeId
	call SetAllPlayerAbilityUnavailable(iChangeId)
	// 神杖升级后的技能
	set CF[AghanimUpgradeMaxIndex] = iUpgradeId
	// 未引用 参数都是0
	set HF[AghanimUpgradeMaxIndex] = whichInteger
	if id > 0 and HeroUpgradeSkills[id]== 0 then
		// 再设置神杖升级的变量(大概是为了保险)
		set HeroUpgradeSkills[id]= iUpgradeId
	endif
	set AghanimUpgradeMaxIndex = AghanimUpgradeMaxIndex + 1
endfunction
// 注册被动技能
// 第一个参数为真实的技能(用这个判断)(在魔法书里面不显示)
// 第二个参数为魔法书马甲技能(会被禁用)
// 第三个参数为被学习的技能 被学习技能等级为0就说明没这个技能
// 第四个参数为技能提供的Buff(没有就是0)
// 第五个参数为显示的马甲技能(没有作用只是显示，会被-sp隐藏)
// 第六个参数为幻象出生时添加的技能
// MaxPassiveSkillsNum 为最大被动数量
function RegisterPassiveSkills takes integer iRealSkill, integer iSpellBookSkill, integer iLearnedSkill, integer iSkillBuff, integer iShowSkill, integer iillusionUnitSkill returns nothing
	set MaxPassiveSkillsNum = MaxPassiveSkillsNum + 1
	set PassiveSkills_Real[MaxPassiveSkillsNum]= iRealSkill
	set PassiveSkills_SpellBook[MaxPassiveSkillsNum]= iSpellBookSkill
	set PassiveSkills_Learned[MaxPassiveSkillsNum]= iLearnedSkill
	set PassiveSkills_Buff[MaxPassiveSkillsNum]= iSkillBuff
	set PassiveSkills_Show[MaxPassiveSkillsNum]= iShowSkill
	set PassiveSkills_illusion[MaxPassiveSkillsNum]= iillusionUnitSkill
	call SetAllPlayerAbilityUnavailable(iSpellBookSkill)
endfunction

// 设置幻象的技能
function SyncIllusionUnitSkills takes unit hIllusionUnit, unit hSummoningUnit returns nothing
	local integer i = 1
	local integer lv
	//
	loop
		set lv = GetUnitAbilityLevel(hSummoningUnit, PassiveSkills_Learned[i])
		if lv == 0 and not PassiveSkills_IllusionInherit[i] then
			if PassiveSkills_SpellBook[i]> 0 or PassiveSkills_Real[i]> 0 then
				//call UnitRemoveAbility(hIllusionUnit, PassiveSkills_Real[i])
				//call UnitRemoveAbility(hIllusionUnit, PassiveSkills_SpellBook[i])
				//call UnitRemoveAbility(hIllusionUnit, PassiveSkills_Buff[i])
			endif
		else
			if PassiveSkills_SpellBook[i]> 0 or PassiveSkills_Real[i]> 0 or PassiveSkills_IllusionInherit[i] then

				call UnitAddPermanentAbility(hIllusionUnit,PassiveSkills_Learned[i])
				call SetUnitAbilityLevel(hIllusionUnit, PassiveSkills_Learned[i], lv)

				call UnitAddPermanentAbility(hIllusionUnit, PassiveSkills_SpellBook[i])
				call UnitMakeAbilityPermanent(hIllusionUnit, true, PassiveSkills_Real[i])
				call UnitAddPermanentAbility(hIllusionUnit, PassiveSkills_Show[i])
				if PassiveSkills_illusion[i]> 0 then
					call UnitAddPermanentAbility(hIllusionUnit, PassiveSkills_illusion[i])
					call SetUnitAbilityLevel(hIllusionUnit, PassiveSkills_illusion[i], lv)
				endif
				call SetUnitAbilityLevel(hIllusionUnit, PassiveSkills_Real[i], lv)
			endif
			// 瞄准
			if PassiveSkills_Learned[i] == 'A03U' then
				set U2 = hIllusionUnit
				set Q2 = lv
				call ExecuteFunc("range_Take_Aim")
			elseif PassiveSkills_Learned[i] == 'A0RO' then
				// ta被动
				set U2 = hIllusionUnit
				set Q2 = lv
				call ExecuteFunc("range_Psi_Blades")
			elseif PassiveSkills_Learned[i]=='A0CL' then
				set U2 = hIllusionUnit
				set Q2 = lv
				call ExecuteFunc("SyncIllusionUnitDragonBlood")
			endif
		endif
		set i = i + 1
	exitwhen i > MaxPassiveSkillsNum
	endloop
	call FixUnitRange(hSummoningUnit, hIllusionUnit)
	// 如果幻象是变身单位 直接播放单位的变身Stand 否则被认出来太蠢
	if UnitTypeIsMetamorphosis(hIllusionUnit) or WTB(hIllusionUnit) then
		// call BJDebugMsg("幻象是变身单位")
		call AddUnitAnimationProperties(hIllusionUnit, "alternate", true)
		call SetUnitAnimation(hIllusionUnit, "stand alternate")
	endif
	//call BJDebugMsg(I2S(GetHandleId(hIllusionUnit)) + "同步幻象技能" + I2S(GetHandleId(hSummoningUnit)))
endfunction

// 0s后再设置单位缩放 否则不生效
function Wait0sSetUnitScale takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer iHandleId = GetHandleId(trig)
	local unit whichUnit = LoadUnitHandle( HY, iHandleId, 0 )

	call SetUnitCurrentScaleEx( whichUnit, GetUnitCurrentScale(whichUnit) )
	// call SetUnitAnimation( whichUnit, "stand upgrade" )
	call FlushChildHashtable(HY, iHandleId)
	call CleanCurrentTrigger(trig)
	set trig = null
	return false
endfunction

function SyncIllusionUnitData takes unit illusionUnit, unit masterUnit returns nothing
	local integer iHandleId
	// 判断单位是否在施法镜像 如果是 则设置镜像的属性和位置
	if LoadBoolean(ExtraHT, GetHandleId(masterUnit), IMAGO_UNIT_IS_SUMMONING_ILLUSIONS) then
		set iHandleId = GetHandleId(illusionUnit)
		call SaveReal(ExtraHT, iHandleId, IllusionUnitDataB, Temp__ArrayReal['B'])
		call SaveReal(ExtraHT, iHandleId, IllusionUnitDataC, Temp__ArrayReal['C'])
		if Temp__ArrayInt['I'] != 0 then
			call SaveInteger(ExtraHT, iHandleId, IllusionUnitDataId, Temp__ArrayInt['I'])
		endif
		//call SetUnitX(illusionUnit, Temp__ArrayReal['X'])
		//call SetUnitY(illusionUnit, Temp__ArrayReal['Y'])
		call DzSetUnitPosition(illusionUnit, Temp__ArrayReal['X'], Temp__ArrayReal['Y'])
		set lastSummonedIllusionUnit = illusionUnit
	endif
	//call SyncIllusionUnitState(illusionUnit, masterUnit)
endfunction

function IllusionUnitGetItem takes unit hIllusionUnit, boolean isGet returns nothing
	local item it = null
	local integer i = 0
	local integer inventorySize = UnitInventorySize(hIllusionUnit)
	loop
	exitwhen i > inventorySize
		set it = UnitItemInSlot(hIllusionUnit, i)
		if it != null then
			call UnitGetItemActions(hIllusionUnit, it, isGet)
		endif
		set i = i + 1
	endloop
	set it = null

endfunction

function PermanentInvisibilityRemoveFilter takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local timer tim
	local unit u
	local integer level
	local real cooldown
	if GetTriggerEventId()== EVENT_UNIT_SPELL_CAST then
		set u = GetTriggerUnit()
		set tim = LoadTimerHandle(HY, h, 1)
		call UnitRemoveCustomBuffEx(u, 'BWMB')
		set level = GetUnitAbilityLevel(u, 'A0MB')
		set cooldown = 8 - level
		if level > 2 then
			set cooldown = cooldown - 1
		endif
		call YDWESetUnitAbilityState(u, 'QP08', 1, cooldown)
		call TimerStart(tim, cooldown, false, function PermanentInvisibilityReset )
	elseif GetTriggerEventId()== EVENT_PLAYER_UNIT_ATTACKED then
		if GetAttacker()== LoadUnitHandle(HY, h, 0) then
			set tim = LoadTimerHandle(HY, h, 1)
			set u = GetAttacker()
			call UnitRemoveCustomBuffEx(u, 'BWMB')
			set level = GetUnitAbilityLevel(u, 'A0MB')
			set cooldown = 8 - level
			if level > 2 then
				set cooldown = cooldown - 1
			endif
			call YDWESetUnitAbilityState(u, 'QP08', 1, cooldown)
			call TimerStart(tim, cooldown, false, function PermanentInvisibilityReset )
		endif
	elseif GetTriggerEventId() == EVENT_WIDGET_DEATH then
		set u = GetTriggerUnit()
		call UnitRemoveCustomBuffEx(u, 'BWMB')
		set tim = LoadTimerHandle(HY, h, 1)
		call DestroyTimerAndFlushHT_HY(tim)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
endfunction

function PermanentInvisibility__RemoveBuff__Actions takes nothing returns nothing
	local custombuff b = GetTriggerBuff()
	call UnitRemoveWindWalk(b.target)
endfunction
function PermanentInvisibility__AddBuff__Actions takes nothing returns nothing
	local custombuff b = GetTriggerBuff()
	call UnitAddWindWalk(b.target)
endfunction

function UnitAddPermanentInvisibility takes unit u returns nothing
	local trigger t
	local timer tt
	local integer h
	local integer level
	local real cooldown
	local custombuff b
	call UnitRemoveCustomBuffEx(u, 'BWMB')
	set level = GetUnitAbilityLevel(u, 'A0MB')
	if level == 1 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		set tt = CreateTimer()
		call SaveUnitHandle(HY, h, 0, u)
		call SaveUnitHandle(HY, GetHandleId(tt), 0, u)
		call SaveTimerHandle(HY, h, 1, tt)
		call SaveTimerHandle(ExtraHT, GetHandleId(u), 'A0MB', tt)
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)

		if IsUnitType(u, UNIT_TYPE_HERO) then
			call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_CAST)
		else
			call TriggerRegisterDeathEvent(t, u)
		endif
		call TriggerAddCondition(t, Condition(function PermanentInvisibilityRemoveFilter))
		set t = null
	else
		set tt = LoadTimerHandle(ExtraHT, GetHandleId(u), 'A0MB')
	endif
	if not IsUnitBreak(u) then
		call UnitAddPermanentAbility(u,'QP08')
		set cooldown = 8 - level
		if level > 2 then
			set cooldown = cooldown - 1
		endif
		call TimerStart(tt, cooldown, false, function PermanentInvisibilityReset )
		call YDWESetUnitAbilityState(u, 'QP08', 1, cooldown)
	endif
	set tt = null
endfunction

// 镜像被召唤事件
function SummonedIllusionUnitEvnet takes nothing returns boolean
	local unit hIllusionUnit = GetSummonedUnit()
	local integer iTriggerPlayerId = GetPlayerId(GetOwningPlayer(hIllusionUnit))
	local unit hSummoningUnit = null
	local unit illusionTargetUnit = null
	local integer iSummoningTypeId
	local integer h
	local real hp
	local integer level
	if not IsUnitIllusion(hIllusionUnit) or GetUnitTypeId(hIllusionUnit)< 1 then
		set hIllusionUnit = null
		return false
	endif
	set h = GetHandleId(GetSummoningUnit())
	set hSummoningUnit = LoadUnitHandle(ExtraHT, h, SUMMONING_SOURCE_UNIT)
	set illusionTargetUnit = LoadUnitHandle(ExtraHT, h, IMAGO_TARGET_UNIT)
	if illusionTargetUnit != null then
		set iTriggerPlayerId = GetPlayerId(GetOwningPlayer(illusionTargetUnit))
	else
		set illusionTargetUnit = Player__Hero[iTriggerPlayerId]
	endif
	call SaveUnitHandle(ExtraHT, GetHandleId(hIllusionUnit), SUMMONING_SOURCE_UNIT, hSummoningUnit)
	call SetUnitOwner(hIllusionUnit, GetOwningPlayer(hSummoningUnit), false)
	call W1E(hIllusionUnit)
	// 这里似乎是判断一下是否有变体精灵的镜像
	set iSummoningTypeId = GetUnitTypeId(illusionTargetUnit)
	if GetUnitTypeId(hIllusionUnit) != iSummoningTypeId then
		set hp = GetUnitState(hIllusionUnit, UNIT_STATE_MAX_LIFE)
		// 原本是极低效率的一大堆马甲技能，改成了japi的逆变身
		call YDWEUnitTransform(hIllusionUnit, iSummoningTypeId)
		// 然后同步下最大生命值
		call SetUnitState(hIllusionUnit, UNIT_STATE_MAX_LIFE, hp)
	endif
	// 同步一下幻象单位的技能 不然可能会有奇怪现象(一堆被动技能)
	call SyncIllusionUnitSkills(hIllusionUnit, illusionTargetUnit)
	// 同步射手天赋给幻象
	if GetUnitAbilityLevel(illusionTargetUnit,'A0VC')> 0 then
		set Temp__ArrayUnit[2] = hIllusionUnit
		set Temp__ArrayUnit[3] = illusionTargetUnit
		call ExecuteFunc("SyncIllusionUnitMarksmanship")
	endif
	if HaveSplitShot then // 继承分裂箭
		set level = LoadInteger(ExtraHT, GetHandleId(illusionTargetUnit), 'A1C0')
		if level > 0 then
			call SaveInteger(ExtraHT, GetHandleId(hIllusionUnit), 'A1C0', level)
			call AddAttackLaunchingTrigCount(hIllusionUnit)
		endif
	endif
	// 同步长大技能
	if a_fx_b[iTriggerPlayerId] and GetUnitTypeId(hIllusionUnit) == 'Ucrl' and GetUnitAbilityLevel(illusionTargetUnit,'A2KK')> 0 then
		// 小小模型有A就拿棒子
		call AddUnitAnimationProperties(hIllusionUnit, "upgrade", true)
	endif
	// 长大等级
	if GetUnitAbilityLevel(illusionTargetUnit,'A0CY')> 0 then
		set Temp__Int = CreateTimerEventTrigger( .0, false, function Wait0sSetUnitScale ) 
		call SaveUnitHandle( HY, Temp__Int, 0, hIllusionUnit )
		// call SaveReal( HY, Temp__Int, 1, 1 + .25 *  GetUnitAbilityLevel(illusionTargetUnit,'A0CY') )
		call SaveReal( ExtraHT, GetHandleId(hIllusionUnit), HTKEY_UNIT_CURRENT_ADDSCALE, GetUnitAbilityLevel(illusionTargetUnit,'A0CY') * 0.25 )
		// 模型缩放
		// call SetUnitCurrentScaleEx(hIllusionUnit, )
	endif

	// 幻象基础魔抗固定为0.25
	call SaveReal(ExtraHT, GetHandleId(hIllusionUnit), HTKEY_UNIT_ACTULA_MAGIC_RESISTANCE, 0.75)
	// 幻象的协同升级
	set level = GetUnitAbilityLevel(illusionTargetUnit,'A0A8')
	if level > 0 then
		call AddUnitMagicResistance(hIllusionUnit, 0.05 + level * 0.05)
		//call UnitAddPermanentAbilitySetLevel(hIllusionUnit,'A3L3', GetUnitAbilityLevel(Player__Hero[iTriggerPlayerId],'A0A8'))
	endif


	call IllusionUnitGetItem(hIllusionUnit, true)
	call SetUnitAnimation(hIllusionUnit, "stand")
	call QueueUnitAnimation(hIllusionUnit, "stand")

	call SyncIllusionUnitData(hIllusionUnit, illusionTargetUnit)
	set hIllusionUnit = null
	set illusionTargetUnit = null
	set hSummoningUnit = null
	return false
endfunction

//! import "Vjass\UnitRemoveEvent.j"

function AER takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit KKX = LoadUnitHandle(HY, h, 1)
	if UnitAlive(u) then
		if KKX == null or IsUnitType(u, UNIT_TYPE_HERO) then
			if GetUnitCurrentOrder(u)==$D024E then
				call SaveUnitHandle(HY, h, 1, GetOrderTargetUnit())
			endif
		else
			if GetDistanceBetweenUnits(u, KKX)>$5DC then
				if GetUnitCurrentOrder(u)==$D024D then
					call SetUnitPosition(u, GetUnitX(KKX), GetUnitY(KKX))
					call IssueImmediateOrderById(u,$D024D)
				elseif GetUnitCurrentOrder(u)==$D024E then
					call SetUnitPosition(u, GetUnitX(KKX), GetUnitY(KKX))
					call IssueTargetOrderById(u,$D024E, KKX)
				endif
			endif
		endif
	else
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	endif
	set u = null
	set t = null
endfunction
function GhoulEnterMapActions takes unit u returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .02, true, function AER)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveUnitHandle(HY, h, 1, Player__Hero[GetPlayerId(GetOwningPlayer(u))])
	set t = null
endfunction
function AOR takes nothing returns boolean
	return GetUnitAbilityLevel(GetFilterUnit(),'B0HL')> 0 and IsUnitAlly(GetFilterUnit(), E3) and IsAliveNotStrucNotWard(GetFilterUnit())
endfunction
function GraniteAura__Actions takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group AIR = LoadGroupHandle(HY, h, 1)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit u2
	local group g
	local group gg
	local integer AAR
	local integer ANR
	if not UnitAlive(u) or u == null then
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
		loop
			set u2 = FirstOfGroup(AIR)
		exitwhen u2 == null
			call GroupRemoveUnit(AIR, u2)
			call UnitAddMaxLife(u2,-1 * LoadInteger(P, GetHandleId(u2),'BHPA'))
			call SaveInteger(P, GetHandleId(u2),'BHPA', 0)
			call UnitRemoveAbility(u2,'B0HL')
		endloop
		call LogoutGroup(AIR)
	else
		set g = LoginGroup(113)
		set E3 = GetOwningPlayer(u)
		call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 925, Condition(function AOR))
		set gg = LoginGroup(114)
		call GroupAddGroup(AIR, gg)
		loop
			set u2 = FirstOfGroup(gg)
		exitwhen u2 == null
			if IsUnitInGroup(u2, g)== false then
				call GroupRemoveUnit(AIR, u2)
				call UnitAddMaxLife(u2,-1 * LoadInteger(P, GetHandleId(u2),'BHPA'))
				call SaveInteger(P, GetHandleId(u2),'BHPA', 0)
				call UnitRemoveAbility(u2,'B0HL')
			endif
			call GroupRemoveUnit(gg, u2)
		endloop
		call LogoutGroup(gg)
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			set ANR = LoadInteger(P, GetHandleId(u2),'BHPA')
			set AAR = R2I(R2I(GetUnitState(u2, UNIT_STATE_MAX_LIFE)-ANR)* .15)
			if ANR != 0 then
				if ANR != AAR then
					call UnitAddMaxLife(u2, AAR -ANR)
				endif
			else
				call UnitAddMaxLife(u2, AAR)
			endif
			call SaveInteger(P, GetHandleId(u2),'BHPA', AAR)
			call GroupRemoveUnit(g, u2)
			call GroupAddUnit(AIR, u2)
		endloop
		call LogoutGroup(g)
	endif
	set t = null
	set AIR = null
	set u = null
	set g = null
	set gg = null
endfunction
// 宝石傀儡光环
function UnitAddGraniteAura takes unit u returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .5, true, function GraniteAura__Actions)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveGroupHandle(HY, h, 1, LoginGroup(115))
	set t = null
endfunction
function ACR takes nothing returns nothing
	local integer i = 1
	local player p
	local unit u
	loop
		set p = Player(i)
		set u = CreateUnit(p,'e00I', 0, 0, 0)
		call ShowUnit(u, false)
		call PauseUnit(u, true)
		set i = i + 1
	exitwhen i >$B
	endloop
	set u = null
endfunction
function ADR takes string ZBO returns boolean
	if ZBO == "-ma"or ZBO == "-ms"or ZBO == "-cs"or ZBO == "-cson"or ZBO == "-disablehelp"or ZBO == "-enablehelp"or ZBO == "-unstuck"or ZBO == "-recreate"then
		return true
	elseif ZBO == "-swaphero"or ZBO == "-showmsg"or ZBO == "-hidemsg"or ZBO == "-showdeny"or ZBO == "-hidedeny"or ZBO == "-weather rain"or ZBO == "-weather snow"or ZBO == "-weather moonlight"or ZBO == "-weather wind"or ZBO == "-weather random"or ZBO == "-weather off"or ZBO == "-denyinfo"or ZBO == "-di"or ZBO == "-deathon"or ZBO == "-don"or ZBO == "-deathoff"or ZBO == "-doff"or ZBO == "-roll"or ZBO == "-hideheronames"or ZBO == "-hhn"or ZBO == "-test"or ZBO == "-mute"or ZBO == "-wtf"or ZBO == "-fleshstr"or ZBO == "-fs"or ZBO == "-switchon"then
		return true
	endif
	return false
endfunction
function AFR takes nothing returns boolean
	return not GS
endfunction
function AddMainModeName takes string AHR returns nothing
	if UW == ""then
		set UW = "|c006699CC" + AHR + "|r"
	else
		set UW = UW + "/|c006699CC" + AHR + "|r"
	endif
endfunction
function AddModeName takes string s returns nothing
	if UW == "" then
		set UW = "|c00C83264" + s + "|r"
	else
		set UW = UW + "/|c00C83264" + s + "|r"
	endif
endfunction
function AKR takes string ALR, integer AMR, integer APR returns string
	return SubString(ALR, 0, AMR)+ SubString(ALR, APR, StringLength(ALR))
endfunction
function AQR takes string ALR returns string
	return StringCase(SubString(ALR, 1, StringLength(ALR)), false)
endfunction
function ASR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	//local string s = LoadStr(HY, GetHandleId(t), 0)
	call ExecuteFunc("InitAghanimScepterUpgrade1")
	call ExecuteFunc("InitAghanimScepterUpgrade2")
	//call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTimer(t)
	set t = null
endfunction
function AWR takes nothing returns nothing
	call TimerStart(CreateTimer(), .5, false, function ASR)
endfunction

function ShowGameStartTopTips takes nothing returns nothing
	local string array tipList
	local integer randomTipIndex = GetRandomInt(1, 3)
	set tipList[1] = " Hello Gay! "
	set tipList[2] = " |CFFFF8000 输入 \"-更新\" 来查看更新日志 |R "
	set tipList[3] = " |CFFFF0000 F10菜单栏地图设置内可以进行游戏设置|R "

	call SetTopMessageText(tipList[randomTipIndex], 15)
endfunction

function AYR takes string AZR, integer A_R returns nothing
	local string EVR = AQR(AZR)
	local string array CGD
	local string array A0R
	local string array GameModeString
	local boolean array A1R
	local integer Z6X
	local integer A2R = StringLength(EVR)
	local integer x = 0
	local integer y = 0
	local integer z = 0
	local trigger t
	local boolean AP = false
	local boolean AR = false
	local boolean LM = false
	local boolean MM = false
	local boolean TR = false
	local boolean DM = false
	local boolean MR = false
	local boolean SP = false
	local boolean AA = false
	local boolean AI = false
	local boolean AS = false
	local boolean ID = false
	local boolean NP = false
	local boolean SC = false
	local boolean EM = false
	local boolean DU = false
	local boolean SH = false
	local boolean VR = false
	local boolean RV = false
	local boolean RD = false
	local boolean OM = false
	local boolean NT = false
	local boolean NB = false
	local boolean NM = false
	local boolean NS = false
	local boolean NR = false
	local boolean XL = false
	local boolean SD = false
	local boolean PM = false
	local boolean OI = false
	local boolean MI = false
	local boolean CM = false
	local boolean FR = false
	local boolean MO = false
	local boolean RO = false
	local boolean CD = false
	local boolean RS = false
	local boolean CP = false
	local boolean ZM = false
	local boolean UB = false
	local boolean UL = false
	local boolean SS = false
	local boolean AB = false
	local boolean S5 = false
	local boolean S6 = false
	local boolean FN = false
	local boolean D2 = false
	local boolean D3 = false
	local boolean D4 = false
	local boolean D5 = false
	local boolean OS = false
	local boolean BO = false
	local boolean MD = false
	local boolean RA = false
	local boolean LS = false
	local boolean A3R = false
	local boolean DFF = false
	local boolean A4R = false
	local boolean A5R = false
	local boolean A6R = false
	local boolean RC = false
	local boolean AH = false
	local boolean NN = false
	local boolean SO = false
	local boolean M1 = false
	local boolean MM2 = false
	local boolean MM5 = false
	set EP = EVR
	set A0R[1]= "ap"
	set A0R[2]= "ar"
	set A0R[3]= "dm"
	set A0R[4]= "sp"
	set A0R[5]= "aa"
	set A0R[6]= "ai"
	set A0R[7]= "as"
	set A0R[8]= "id"
	set A0R[9]= "np"
	set A0R[10]= "sc"
	set A0R[11]= "em"
	set A0R[12]= "du"
	set A0R[$D]= "sh"
	set A0R[$E]= "om"
	set A0R[$F]= "nm"
	set A0R[16]= "nt"
	set A0R[17]= "nb"
	set A0R[18]= "ns"
	set A0R[19]= "nr"
	set A0R[20]= "sd"
	set A0R[21]= "pm"
	set A0R[22]= "oi"
	set A0R[23]= "mi"
	set A0R[24]= "fr"
	set A0R[25]= "mo"
	set A0R[26]= "ro"
	set A0R[27]= "zm"
	set A0R[28]= "ul"
	set A0R[29]= "ss"
	set A0R[30]= "ab"
	set A0R[31]= "s5"
	set A0R[32]= "s6"
	set A0R[33]= "fn"
	set A0R[34]= "d2"
	set A0R[35]= "d3"
	set A0R[36]= "d4"
	set A0R[37]= "d5"
	set A0R[38]= "os"
	set A0R[39]= "bo"
	set A0R[40]= "md"
	set A0R[41]= "ra"
	set A0R[42]= "3ls"
	set A0R[43]= "ls"
	set A0R[44]= "ff"
	set A0R[45]= "eb"
	set A0R[46]= "fh"
	set A0R[47]= "ma"
	set A0R[48]= "rc"
	set A0R[49]= "rd"
	set A0R[50]= "ah"
	set A0R[51]= "nn"
	set A0R[52]= "so"
	
	set A0R[53]= "m1"
	set A0R[54]= "m2"
	set A0R[55]= "m5"
	set A0R[55]= "m5"
	set Z6X = 55
	set x =-1
	loop
	exitwhen x == A2R -1
		set x = x + 1
		set y = x
		loop
		exitwhen y == A2R
			set y = y + 1
			set z = 1
			loop
			exitwhen z > Z6X
				if A0R[z]== SubString(EVR, x, y) then
					set A1R[z]= true
					set z = Z6X + 1
					set EVR = AKR(EVR, x, y)
					set x =-1
					set A2R = StringLength(EVR)
					set y = A2R
				else
					set z = z + 1
				endif
			endloop
		endloop
	endloop
	set AP = A1R[1]
	set AR = A1R[2]
	set DM = A1R[3]
	set SP = A1R[4]
	set AA = A1R[5]
	set AI = A1R[6]
	set AS = A1R[7]
	set ID = A1R[8]
	set NP = A1R[9]
	set SC = A1R[10]
	set EM = A1R[11]
	set DU = A1R[12]
	set SH = A1R[$D]
	set OM = A1R[$E]
	set NM = A1R[$F]
	set NT = A1R[16]
	set NB = A1R[17]
	set NS = A1R[18]
	set NR = A1R[19]
	set SD = A1R[20]
	set PM = A1R[21]
	set OI = A1R[22]
	set MI = A1R[23]
	set FR = A1R[24]
	set MO = A1R[25]
	set RO = A1R[26]
	set ZM = A1R[27]
	set UL = A1R[28]
	set SS = A1R[29]
	set AB = A1R[30]
	set S5 = A1R[31]
	set S6 = A1R[32]
	set FN = A1R[33]
	set D2 = A1R[34]
	set D3 = A1R[35]
	set D4 = A1R[36]
	set D5 = A1R[37]
	set OS = A1R[38]
	set BO = A1R[39]
	set MD = A1R[40]
	set RA = A1R[41]
	set A3R = A1R[42]
	set LS = A1R[43]
	set DFF = A1R[44]
	set A5R = A1R[45]
	set A4R = A1R[46]
	set A6R = A1R[47]
	set RC = A1R[48]
	set RD = A1R[49]
	set AH = A1R[50]
	set NN = A1R[51]
	set SO = A1R[52]
	set M1 = A1R[53]
	set MM2 = A1R[54]
	set MM5 = A1R[55]
	if EVR != ""or ADR(AZR) then
		return
	endif
	if A3R and LS then
		call InterfaceErrorForPlayer(HostPlayer, GetObjectName('n02U'))
		return
	endif
	if(AR and(AP or SD or MD)) then
		call InterfaceErrorForPlayer(HostPlayer, GetObjectName('n02U'))
		return
	endif
	if(AA and(AI or AS or DM)) or(AS and(AI or DM)) or(AI and DM) then
		call InterfaceErrorForPlayer(HostPlayer, GetObjectName('n02U'))
		return
	endif
	if(RO and(MO or DM)) or(MO and DM) then
		call InterfaceErrorForPlayer(HostPlayer, GetObjectName('n02U'))
		return
	endif
	if(DM and(SH or SD or MD)) or(SH and DM) then
		call InterfaceErrorForPlayer(HostPlayer, GetObjectName('n02T'))
		return
	endif
	if SD and(AP or AR or DM or SH or RO or MO or MD) then
		call InterfaceErrorForPlayer(HostPlayer, GetObjectName('n02U'))
		return
	endif
	if S5 and S6 then
		call InterfaceErrorForPlayer(HostPlayer, "模式 <s5> 和 <s6> 不能叠加。")
		return
	endif
	if RA and not(S5 or S6) then
		call InterfaceErrorForPlayer(HostPlayer, "模式 <ra> 仅适用于 <s5> 和 <s6>。")
		return
	endif
	if RA and not(AP or SD or MD) then
		call InterfaceErrorForPlayer(HostPlayer, "模式 <ra> 仅适用于 <sd>, <ap> 和 <md>。")
		return
	endif
	if(D2 and(D3 or D4 or D5)) or(D3 and(D2 or D4 or D5)) or(D4 and(D2 or D3 or D5)) or(D5 and(D2 or D3 or D4)) then
		call InterfaceErrorForPlayer(HostPlayer, "模式 <d#> 不能叠加。")
		return
	endif
	if not(SD or MD or RD) and(D2 or D3 or D4 or D5) then
		call InterfaceErrorForPlayer(HostPlayer, "模式 <d#> 仅适用于 <sd>, <rd> 和 <md>。")
		return
	endif
	if not(AP or SD or MD) and SS then
		call InterfaceErrorForPlayer(HostPlayer, "模式 <ss> 仅适用于 <sd>, <ap> 和 <md>。")
		return
	endif
	if not(AP or SD or MD or AR) and SP then
		call InterfaceErrorForPlayer(HostPlayer, "模式 -sp 仅适用于 <sd>, <ap>, <ar> 和 <md>。")
		return
	endif
	if AP or AR or SD or MD or RD then
		call DisableTrigger(GHV)
	else
		return
	endif
	call XZX()
	call JIO()
	call LKO()
	set GS = true
	set C3 = AQR(AZR)
	if GGV then
		call JSX("Mode" + C3, 0)
	else
		call JSX("Mode" + C3, GetPlayerId(HostPlayer))
	endif
	set YW = false
	if DM then
		set NY = GetObjectName('n0II')
	elseif AP then
		set NY = GetObjectName('n0ID')
	elseif AR then
		set NY = GetObjectName('n0I7')
	elseif SD then
		set NY = GetObjectName('n0I4')
	elseif MD then
		set NY = GetObjectName('n0I0')
	elseif RD then
		set NY = GetObjectName('n0IF')
	endif
	if MD then
		set Mode__MirrorDraft = true
		call AddModeName("镜像模式")
		set Mode__FastFinish = true
		call AddModeName("快速结束")
		set Mode__AntiHack = true
		call AddModeName("反作弊")
	endif
	if RD then
		set ET = true
		if D2 then
			set XT = XT + 4
		elseif D3 then
			set XT = XT + 8
		elseif D4 then
			set XT = XT + 12
		elseif D5 then
			set XT = XT + 16
		endif
		call AddMainModeName("随机征召")
	endif
	if DM then
		call AddMainModeName(GetObjectName('n0IA'))
	endif
	if AP then
		call AddMainModeName(GetObjectName('n0IL'))
		set Mode__FastFinish = true
		call AddModeName("快速结束")
		set Mode__AntiHack = true
		call AddModeName("反作弊")
	endif
	if M1 then
		set Mode__FastFinish = true
		call AddModeName("快速结束")
		set Mode__AntiHack = true
		call AddModeName("反作弊")
		call AddModeName("天朝平衡")
		set Mode__BalanceOff = true
		call AddModeName("快速刷野")
		set Mode__FastNeutrals = true
		call AddModeName("六技能")
		set ExtraAbilitiesNum = 2
		call JIO()
		set Mode__SixSkills = true
		//call ACR()
		call UnitAddAbility(B7,'ACrk')
		call UnitAddAbility(SentinelsBuilding_FountainOfLife,'ACrk')
		//call UnitAddAbility(B7,'A1BY')
		//call UnitAddAbility(A5,'A1BY')
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第5个技能将在<5>, <8>, <11>, <14>级时自动升级" + "|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第6个技能将在<8>, <13>, <18>级时自动升级" + "|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
	endif
	if MM2 then
		set Mode__Draft20 = true
		call AddModeName("20英雄")
		set BP = 10
		set Mode__FastFinish = true
		call AddModeName("快速结束")
		set Mode__AntiHack = true
		call AddModeName("反作弊")
		call AddModeName("天朝平衡")
		set Mode__BalanceOff = true
		call AddModeName("快速刷野")
		set Mode__FastNeutrals = true
		call AddModeName("六技能")
		set ExtraAbilitiesNum = 2
		call JIO()
		set Mode__SixSkills = true
		//call ACR()
		call UnitAddAbility(B7,'ACrk')
		call UnitAddAbility(SentinelsBuilding_FountainOfLife,'ACrk')
		//call UnitAddAbility(B7,'A1BY')
		//call UnitAddAbility(A5,'A1BY')
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第5个技能将在<5>, <8>, <11>, <14>级时自动升级" + "|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第6个技能将在<8>, <13>, <18>级时自动升级" + "|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
	endif
	if MM5 then
		set Mode__Draft50 = true
		call AddModeName("50英雄")
		set BP = 40
		set Mode__FastFinish = true
		call AddModeName("快速结束")
		set Mode__AntiHack = true
		call AddModeName("反作弊")
		call AddModeName("天朝平衡")
		set Mode__BalanceOff = true
		call AddModeName("快速刷野")
		set Mode__FastNeutrals = true
		call AddModeName("六技能")
		set ExtraAbilitiesNum = 2
		call JIO()
		set Mode__SixSkills = true
		//call ACR()
		call UnitAddAbility(B7,'ACrk')
		call UnitAddAbility(SentinelsBuilding_FountainOfLife,'ACrk')
		//call UnitAddAbility(B7,'A1BY')
		//call UnitAddAbility(A5,'A1BY')
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第5个技能将在<5>, <8>, <11>, <14>级时自动升级" + "|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第6个技能将在<8>, <13>, <18>级时自动升级" + "|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
	endif
	if AR then
		call AddMainModeName(GetObjectName('n0IQ'))
	endif
	if SP then
		call AddMainModeName(GetObjectName('n0IO'))
	endif
	if AA then
		call AddMainModeName(GetObjectName('n0IU'))
	endif
	if AS then
		call AddMainModeName(GetObjectName('n0IP'))
	endif
	if AI then
		call AddMainModeName(GetObjectName('n0IS'))
	endif
	if RO then
		call AddMainModeName(GetObjectName('n0IT'))
	endif
	if MO then
		call AddMainModeName(GetObjectName('n032'))
	endif
	if DU then
		call AddMainModeName(GetObjectName('n0IX'))
	endif
	if ID then
		call AddMainModeName(GetObjectName('n0IZ'))
	endif
	if NP then
		call AddMainModeName(GetObjectName('n0J6'))
	endif
	if SC then
		call AddMainModeName(GetObjectName('n0J7'))
	endif
	if EM then
		call AddMainModeName(GetObjectName('n0J9'))
	endif
	if SH then
		call AddMainModeName(GetObjectName('n0JA'))
	endif
	if OM then
		call AddMainModeName(GetObjectName('n0IV'))
	endif
	if NM then
		call AddMainModeName(GetObjectName('n0IR'))
	endif
	if NB then
		call AddMainModeName(GetObjectName('n0JB'))
	endif
	if NT then
		call AddMainModeName(GetObjectName('n0J8'))
	endif
	if NS then
		call AddMainModeName(GetObjectName('n0JC'))
	endif
	if NR then
		call AddMainModeName(GetObjectName('n0JF'))
	endif
	if SD then
		call AddMainModeName(GetObjectName('n0J0'))
		set GKV = true
		
		set Mode__FastFinish = true
		call AddModeName("快速结束")
		set Mode__AntiHack = true
		call AddModeName("反作弊")
	endif
	if PM then
		call AddMainModeName(GetObjectName('n0IY'))
	endif
	if OI then
		call AddMainModeName(GetObjectName('n0J5'))
	endif
	if FR then
		call AddMainModeName(GetObjectName('n0JD'))
	endif
	if SO then
		call AddMainModeName(GetObjectName('n0J2'))
		set YS = true
	endif
	if ZM then
		call AddMainModeName(GetObjectName('n0KA'))
	endif
	if D2 then
		call AddModeName("20英雄")
		set Mode__Draft20 = true
		set BP =$A
	endif
	if D3 then
		call AddModeName("30英雄")
		set Mode__Draft30 = true
		set BP = 20
	endif
	if D4 then
		call AddModeName("40英雄")
		set Mode__Draft40 = true
		set BP = 30
	endif
	if D5 then
		call AddModeName("50英雄")
		set Mode__Draft50 = true
		set BP = 40
	endif
	if S5 then
		call AddModeName("五技能")
		set ExtraAbilitiesNum = 1
		set Mode__FiveSkills = true
		call UnitAddAbility(B7,'ACrk')
		call UnitAddAbility(SentinelsBuilding_FountainOfLife,'ACrk')
		//call UnitAddAbility(B7,'A1BY')
		//call UnitAddAbility(A5,'A1BY')
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第5个技能将在<5>, <8>, <11>, <14>级时自动升级" + "|r")
	endif
	if S6 then
		call AddModeName("六技能")
		set ExtraAbilitiesNum = 2
		call JIO()
		set Mode__SixSkills = true
		//call ACR()
		call UnitAddAbility(B7,'ACrk')
		call UnitAddAbility(SentinelsBuilding_FountainOfLife,'ACrk')
		//call UnitAddAbility(B7,'A1BY')
		//call UnitAddAbility(A5,'A1BY')
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第5个技能将在<5>, <8>, <11>, <14>级时自动升级" + "|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, "|c0066FF66" + "注意：第6个技能将在<8>, <13>, <18>级时自动升级" + "|r")
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 30, " ")
	endif
	if DFF then
		call AddModeName("快速结束")
		set Mode__FastFinish = true
	endif
	if AH then
		set Mode__AntiHack = true
		call AddModeName("反作弊")
	endif
	if OS then
		call AddModeName("技能唯一")
		set Mode__OneSkill = true
	endif
	if RA then
		call AddModeName("额外随机技能")
		set Mode__RandomExtraAbilities = true
	endif
	if BO then
		call AddModeName("天朝平衡")
		set Mode__BalanceOff = true
	endif
	if NN then
		call AddModeName("无野怪")
		set Mode__NoNeutrals = true
	endif
	if UL then
		call AddModeName("无限等级")
		set TL = 2048
		set Mode__UnlimitedLevel = true
	endif
	if SS then
		call AddModeName("技能可见")
		set Mode__SeeSkills = true
	endif
	if AB then
		call AddModeName("防偷塔")
		set Mode__AntiBackdoor = true
	endif
	if FN then
		call AddModeName("快速刷野")
		set Mode__FastNeutrals = true
	endif
	if LS then
		call AddModeName("技能限定")
		set Mode__LimitSkills2 = true
	endif
	if A4R then
		call AddMainModeName("Fun heroes")
	endif
	if A3R then
		call AddModeName("限制技能 3")
		set Mode__LimitSkills2 = true
		set Mode__LimitSkills3 = true
	endif
	if RC then
		call AddModeName("限制解除")
		set Mode__RearmCombos = true
	endif
	if LS or A3R then
		call R_R()
	endif
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., " ")
	if A_R == 1 then
		call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., JS[GetPlayerId(HostPlayer)]+(VMV[GetPlayerId((HostPlayer))])+ "|r" + " 选择了 " + UW)
	else
		call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., "系统将游戏模式默认选择为 " + UW)
	endif
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., " ")
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., "该版本移植了部分高版本内容。")
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., " ")
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., "现在可以通过指令“-更新”来查看更新日志。")
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., " ")
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 20., "地图内置了二种命令改键方式，详细可在能量圈查看。")
	call ShowGameStartTopTips()
	// 初始化技能表
	call ExecuteFunc("InitHeroSkillsData")
	// 初始化技能双击施法
	call ExecuteFunc("DoubleClickSkill__Init")
	call INX("A8R", SP)
	call INX("A9R", DM)
	call INX("NVR", SH)
	call INX("NER", AA)
	call INX("NXR", AI)
	call INX("NOR", AS)
	call INX("NRR", RO)
	call INX("NIR", MO)
	call INX("NAR", DU)
	call INX("NNR", AR)
	call INX("NBR", AP)
	call INX("NCR", ID)
	call INX("NDR", NP)
	call INX("NFR", SC)
	call INX("NGR", EM)
	call INX("NHR", OM)
	call INX("NJR", NB)
	call INX("NKR", NT)
	call INX("NLR", NM)
	call INX("NMR", NS)
	call INX("NPR", NR)
	call INX("NQR", PM)
	call INX("NSR", OI)
	call INX("NTR", FR)
	call INX("NUR", ZM)
	call INX("NWR", AH)
	// 初始化镜像召唤事件 英雄进入地图事件
	call ExecuteFunc("NYR")
	// 初始化神杖升级 0.5秒后
	call ExecuteFunc("AWR")
	// 初始化主模式
	call ExecuteFunc("ISR")
	//	call ExecuteFunc("Preload_Ability")			//预加载技能，以固定技能位置，防止跳键位。
	set A3 = true
	// 设置 木头和人口 即资源栏的游戏时间
	call SetResourceBarTime(0, 0, false)
	call X0R()
	set t = null
endfunction
function NZR takes nothing returns nothing
	call AYR(GetEventPlayerChatString(), 1)
endfunction
function N_R takes nothing returns boolean
	set CV = MW and(GetPlayerName(VKV)== "|cFFFF0000RGC" or GetPlayerName(VLV)== "|cFFFF0000RGC")
	if G2 == "rgc" then
		set G2 = "sdzm3lsso"
	elseif G2 == "rgc2" then
		set G2 = "sds5zm3lsso"
	elseif G2 == "rgc3" then
		set G2 = "sdd2s6osso"
	elseif G2 == "rgc4" then
		set G2 = "md3lszmso"
	elseif G2 == "rgc5" then
		set G2 = "mdd2s5zmulos3lsso"
	elseif G2 == "rgc6" then
		set G2 = "mdd2s6zmulosso"
	elseif G2 == "rgc7" then
		set G2 = "rdd2s6zmso"
	elseif G2 == "rgc8" then
		set G2 = "rdd2lszmso"
	elseif G2 == "md" then
		set G2 = "mds6d5ulabosfnzmso"
	elseif G2 == "sd" then
		set G2 = "sds6d5ulabosfnzmso"
	elseif G2 == "ap" then
		set G2 = "aps6ulabosfnzmso"
	elseif G2 == "ar" then
		set G2 = "ardms6omfrulabzmso"
	elseif G2 == "ru0" then
		set G2 = "mdabduffso"
	elseif G2 == "ru1" then
		set G2 = "mdulabfnduffso"
	elseif G2 == "ru2" then
		set G2 = "mds6ulabfnduffso"
	elseif G2 == "ru3" then
		set G2 = "mds6ulabfnduffso"
	elseif G2 == "ru4" then
		set G2 = "mdd2s6ulabfnduffso"
	elseif G2 == "ru5" then
		set G2 = "mdd2s6ulabfnduboffso"
	elseif G2 == "ru6" then
		set G2 = "sds6ulabfnduffso"
	elseif G2 == "ru7" then
		set G2 = "sdd2s6ulabfnduffso"
	elseif G2 == "ru8" then
		set G2 = "sdd2s6ulabfnduboffso"
	elseif G2 == "ru9" then
		set G2 = "sdd5s6ulabfnduboffso"
	elseif G2 == "ru10" then
		set G2 = "ardms6ulabfndubofrscffso"
	elseif G2 == "ru11" then
		set G2 = "ardms6ulabfndubofrnpomffso"
	elseif G2 == "ru12" then
		set G2 = "ardms6ulfndubofrscffnpntnmnbso"
	elseif G2 == "i1" then
		set G2 = "mds6omnpd2abnnso"
	elseif G2 == "i2" then
		set G2 = "sds6omnpd2abnnso"
	elseif G2 == "i3" then
		set G2 = "sds6omnpd3abnnso"
	elseif G2 == "ohs1" then
		set G2 = "sds6fnulboabd3ahso"
	elseif G2 == "ohs2" then
		set G2 = "ardms6fnulboabahso"
	elseif G2 == "ohs3" then
		set G2 = "aps6fnulboabssoslsahso"
	elseif G2 == "ohs4" then
		set G2 = "sdd5s6ulabbofnfrahso"
	elseif G2 == "ohs5" then
		set G2 = "mds6d2omfnulboahso"
	elseif G2 == "o1" then
		set G2 = "ardms6boomfnulso"
	elseif G2 == "o2" then
		set G2 = "mds6d3scfnulbonmso"
	elseif G2 == "rm1" then
		set G2 = "mdd2s6fnfrboulscduabrcffah"
	elseif G2 == "rm2" then
		set G2 = "sdd3s6fnfrboulscduabrcffmaah"
	elseif G2 == "ib1" then
		set G2 = "sds6d2ulabosfnzm"
	elseif G2 == "ib2" then
		set G2 = "sds6d3ulabosfnzm"
	elseif G2 == "ib3" then
		set G2 = "mds6d3fnffulosab"
	elseif G2 == "ib4" then
		set G2 = "mds6d4fnffulosab"
	endif
	if(G2)!= ""and A3 == false then
		set GGV = true
		call AYR("-" +(G2), 2)
	else
		call TriggerRegisterPlayerChatEvent(GHV, HostPlayer, "-", false)
	endif
	return false
endfunction
function NBR takes nothing returns nothing
	local location LIX = GetRectCenter(LZ)
	local location LAX = GetRectCenter(MZ)
	local integer x = 1
	local trigger t
	local integer h
	set RT = true
	set N3 = 120
	loop
	exitwhen x > 5
		if IsPlaying(Sentinels[x]) then
			call YCE(Sentinels[x])
		endif
		if IsPlaying(Scourges[x]) then
			call YCE(Scourges[x])
		endif
		set x = x + 1
	endloop
	call RemoveLocation(LIX)
	call RemoveLocation(LAX)
	set LIX = null
	set LAX = null
	set t = null
endfunction
function N0R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer BOX =(LoadInteger(HY, h, 55))
	local player p
	local integer X1X
	local location LIX = GetRectCenter(VZ)
	local location LAX = GetRectCenter(GY)
	if BOX < 6 then
		set p = Sentinels[BOX]
	elseif BOX <$B then
		set p = Scourges[BOX -5]
	endif
	if BOX >$A then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if not Mode__DeathMatch  then
			set IY = true
		endif
	elseif BOX < 6 then
		call SaveInteger(HY, h, 55,(BOX + 1))
		set Player__Hero[GetPlayerId(p)]= null
		set PlayerHeroTypeId[GetPlayerId(p)]= 0
		if IsPlaying(p) then
			loop
			exitwhen Player__Hero[GetPlayerId(p)]!= null
				set X1X = X0X()
				if ZQ[X1X]== false then
					if not PW then
						set YQ[X1X]= true
						set ZQ[X1X]= true
					endif
					set Player__Hero[GetPlayerId(p)]= CreateUnitAtLoc(p, VUV[X1X], LIX, bj_UNIT_FACING)
					set PlayerHeroTypeId[GetPlayerId(p)]= VUV[X1X]
				endif
			endloop
		endif
	elseif BOX <$B then
		call SaveInteger(HY, h, 55,(BOX + 1))
		set Player__Hero[GetPlayerId(p)]= null
		set PlayerHeroTypeId[GetPlayerId(p)]= 0
		if IsPlaying(p) then
			loop
			exitwhen Player__Hero[GetPlayerId(p)]!= null
				set X1X = X0X()
				if ZQ[X1X]== false then
					if not PW then
						set YQ[X1X]= true
						set ZQ[X1X]= true
					endif
					set Player__Hero[GetPlayerId(p)]= CreateUnitAtLoc(p, VUV[X1X], LAX, bj_UNIT_FACING)
					set PlayerHeroTypeId[GetPlayerId(p)]= VUV[X1X]
				endif
			endloop
		endif
	endif
	call RemoveLocation(LIX)
	call RemoveLocation(LAX)
	set LIX = null
	set LAX = null
	set p = null
	set t = null
	return false
endfunction
function NNR takes nothing returns nothing
	local location LIX = GetRectCenter(VZ)
	local location LAX = GetRectCenter(GY)
	local location N1R = GetRectCenter(VZ)
	local location N2R = GetRectCenter(GY)
	local integer O3X = 1
	local integer K0X = 5
	local integer X1X
	local trigger t
	set VT = true
	set RY = false
	if not PW then
		call XWX()
	endif
	set GT =$FA
	call PanCameraToTimedLocForPlayer(Sentinels[1], N1R, 0)
	call PanCameraToTimedLocForPlayer(Sentinels[2], N1R, 0)
	call PanCameraToTimedLocForPlayer(Sentinels[3], N1R, 0)
	call PanCameraToTimedLocForPlayer(Sentinels[4], N1R, 0)
	call PanCameraToTimedLocForPlayer(Sentinels[5], N1R, 0)
	call PanCameraToTimedLocForPlayer(Scourges[1], N2R, 0)
	call PanCameraToTimedLocForPlayer(Scourges[2], N2R, 0)
	call PanCameraToTimedLocForPlayer(Scourges[3], N2R, 0)
	call PanCameraToTimedLocForPlayer(Scourges[4], N2R, 0)
	call PanCameraToTimedLocForPlayer(Scourges[5], N2R, 0)
	if Mode__SameHero then
		loop
			set X1X = X0X()
		exitwhen ZQ[X1X]== false
		endloop
		if IsSentinelsPlayer(HostPlayer) then
			set Player__Hero[GetPlayerId(HostPlayer)]= CreateUnit(HostPlayer, VUV[X1X], GetLocationX(LIX), GetLocationY(LIX), 270)
			set PlayerHeroTypeId[GetPlayerId(HostPlayer)]= VUV[X1X]
		else
			set Player__Hero[GetPlayerId(HostPlayer)]= CreateUnit(HostPlayer, VUV[X1X], GetLocationX(LAX), GetLocationY(LAX), 270)
			set PlayerHeroTypeId[GetPlayerId(HostPlayer)]= VUV[X1X]
		endif
		call RemoveLocation(LIX)
		call RemoveLocation(LAX)
		call RemoveLocation(N1R)
		call RemoveLocation(N2R)
		set LIX = null
		set LAX = null
		set N1R = null
		set N2R = null
		set t = null
		return
	endif
	set IY = false
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function N0R))
	call SaveInteger(HY,(GetHandleId(t)), 55, 1)
	call RemoveLocation(LIX)
	call RemoveLocation(LAX)
	call RemoveLocation(N1R)
	call RemoveLocation(N2R)
	set LIX = null
	set LAX = null
	set N1R = null
	set N2R = null
	set t = null
endfunction
function N3R takes nothing returns nothing
	set M3 = true
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10, GetObjectName('n06K')+ " " + GetObjectName('n06L'))
	call DisableTrigger(GetTriggeringTrigger())
endfunction
function N4R takes nothing returns nothing
	local integer N5R = S2I(SubString(GetEventPlayerChatString(), 6, StringLength(GetEventPlayerChatString())))
	if N5R > 666 then
		call InterfaceErrorForPlayer(HostPlayer, GetObjectName('n03C'))
	elseif N5R < 10 then
		call InterfaceErrorForPlayer(HostPlayer, GetObjectName('n02I'))
	else
		set DeathMatch__MaxLives = N5R
		call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10, GetObjectName('n06X')+ " " + I2S(DeathMatch__MaxLives)+ " " + GetObjectName('n06N'))
		call DisableTrigger(GetTriggeringTrigger())
	endif
endfunction
function N6R takes nothing returns nothing
	call DisableTrigger((LoadTriggerHandle(HY,(GetHandleId(GetTriggeringTrigger())),170)))
	call DisableTrigger((LoadTriggerHandle(HY,(GetHandleId(GetTriggeringTrigger())),171)))
	call DisableTrigger((LoadTriggerHandle(HY,(GetHandleId(GetTriggeringTrigger())),172)))
	call DisableTrigger(GetTriggeringTrigger())
endfunction
function EnableHolyShitLimit takes nothing returns nothing
	set Mode__HolyShitLimit = true
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10, "开启了超神限制，现在，超神后会立即死亡，并增加我方队伍5条生命。")
	call DisableTrigger(GetTriggeringTrigger())
endfunction

function CheckLifes takes nothing returns nothing
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., "近卫军团已使用生命：" + I2S(TeamHeroUseLivesCount[0]) )
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10., "天灾军团已使用生命：" + I2S(TeamHeroUseLivesCount[1]) )
endfunction

function N7R takes nothing returns nothing
	local trigger N8R = CreateTrigger()
	local trigger N9R = CreateTrigger()
	local trigger nd = CreateTrigger()
	local trigger hsl = CreateTrigger()
	local trigger lifes = CreateTrigger()
	set DeathMatch__MaxLives = 66
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10., " ")
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10., GetObjectName('n06O')+ " -nd " + GetObjectName('n067')+ " -lives xx " + GetObjectName('n06Q'))
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10., GetObjectName('n06O')+ " -hsl 开启超神限制" )
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10., GetObjectName('n060')+ " " + I2S(DeathMatch__MaxLives))
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10., " 输入-life来查看双方生命值" )
	call TriggerRegisterTimerEvent(N8R, 15, false)
	call TriggerAddAction(N8R, function N6R)
	call SaveTriggerHandle(HY,(GetHandleId(N8R)), 170,(nd))
	call SaveTriggerHandle(HY,(GetHandleId(N8R)), 171,(N9R))
	call SaveTriggerHandle(HY,(GetHandleId(N8R)), 172,(hsl))

	call TriggerRegisterPlayerChatEvent(nd, HostPlayer, "-nd", true)
	call TriggerAddAction(nd, function N3R)

	call TriggerRegisterPlayerChatEvent(N9R, HostPlayer, "-lives", false)
	call TriggerAddAction(N9R, function N4R)

	call TriggerRegisterPlayerChatEvent(hsl, HostPlayer, "-hsl", true)
	call TriggerAddAction(hsl, function EnableHolyShitLimit)

	call TriggerRegisterPlayerChatEvent(lifes, HostPlayer, "-life", true)
	call TriggerAddAction(lifes, function CheckLifes)

	set hsl = null
	set N8R = null
	set N9R = null
	set nd = null
endfunction
function BVR takes nothing returns nothing
	local integer BER =(LoadInteger(HY,(GetHandleId(GetTriggeringTrigger())),$AD))
	local integer O3X
	local integer K0X
	local integer X1X
	local integer BOX
	local location LIX = GetRectCenter(LZ)
	local location LAX = GetRectCenter(MZ)
	if OY then
		return
	endif
	if IsSentinelsPlayer(Player(BER)) then
		set O3X = 1
		set K0X = VWV
		set BOX = 0
	else
		set O3X = VYV
		set K0X = VZV
		set BOX = 1
	endif
	set O3X = 1
	set K0X = VZV
	call YCE(Player(BER))
	set Q2 = BER
	if not VT then
		loop
		exitwhen O3X > K0X
			if ZQ[O3X]== false then
				call SetPlayerTechMaxAllowed(Player(BER), VUV[O3X], 999)
			endif
			set O3X = O3X + 1
		endloop
		if(GetPlayerState(Player(BER), PLAYER_STATE_RESOURCE_GOLD)<$FA) then
			call SetPlayerState(Player(BER), PLAYER_STATE_RESOURCE_GOLD,$FA)
		endif
	elseif(TeamHeroUseLivesCount[BOX]< DeathMatch__MaxLives) then
		//if Player__Hero[BER]!= null then
		//	call RemoveUnit(Player__Hero[BER])
		//endif
		set Player__Hero[BER]= null
		set PlayerHeroTypeId[BER]= 0
		if IsPlaying(Player(BER)) then
			loop
				if IsSentinelsPlayer(Player(BER)) then
					set Player__Hero[BER]= CreateUnitAtLoc(Player(BER), UFE(), LIX, bj_UNIT_FACING)
					set PlayerHeroTypeId[BER]= GetUnitTypeId(Player__Hero[BER])
				else
					set Player__Hero[BER]= CreateUnitAtLoc(Player(BER), UFE(), LAX, bj_UNIT_FACING)
					set PlayerHeroTypeId[BER]= GetUnitTypeId(Player__Hero[BER])
				endif
			exitwhen Player__Hero[BER]!= null
			endloop
		endif
	endif
	call TimerStart(ESV[BER], 0, false, null)
	call TimerStart(ETV[BER], 0, false, null)
	call RemoveLocation(LIX)
	call RemoveLocation(LAX)
	if not VT then
	endif
	set LIX = null
	set LAX = null
endfunction
function A9R takes nothing returns nothing
	local location HOO
	local real BXR
	local trigger t
	local integer BOR
	local integer x
	set Mode__DeathMatch = true
	set x = 1
	loop
	exitwhen x > 5
		set BOR = GetPlayerId(Sentinels[x])
		set t = CreateTrigger()
		call TriggerRegisterTimerExpireEvent(t, PS[BOR])
		call TriggerAddAction(t, function BVR)
		call SaveInteger(HY,(GetHandleId(t)),$AD,(BOR))
		set BOR = GetPlayerId(Scourges[x])
		set t = CreateTrigger()
		call TriggerRegisterTimerExpireEvent(t, PS[BOR])
		call TriggerAddAction(t, function BVR)
		call SaveInteger(HY,(GetHandleId(t)),$AD,(BOR))
		set x = x + 1
	endloop
	call UnitRemoveAbility(VXV,'Aawa')
	call UnitRemoveAbility(VOV,'Aawa')
	call UnitRemoveAbility(VRV,'Aawa')
	call UnitRemoveAbility(VIV,'Aawa')
	call UnitRemoveAbility(VAV,'Aawa')
	call UnitRemoveAbility(VNV,'Aawa')
	call UnitRemoveAbility(VBV,'Aawa')
	call UnitRemoveAbility(VCV,'Aawa')
	call UnitRemoveAbility(VDV,'Aawa')
	call UnitRemoveAbility(VFV,'Aawa')
	call ExecuteFunc("N7R")
	set HOO = null
	set t = null
endfunction
function NAR takes nothing returns nothing
	set PW = true
endfunction
function A8R takes nothing returns nothing
	local integer BRR = XKX(RW)
	local integer BIR = XKX(IW)
	local integer WXV = BRR + BIR
	local integer k
	local integer o
	local integer x
	local integer y
	local integer z
	local player array BAR
	local player array BNR
	local integer w
	local location N1R = GetRectCenter(VZ)
	local location N2R = GetRectCenter(GY)
	local location LIX = GetRectCenter(LZ)
	local location LAX = GetRectCenter(MZ)
	local integer i
	set DW = true
	call KillPlayerAllZoneIndicator(Sentinels[1])
	call KillPlayerAllZoneIndicator(Sentinels[2])
	call KillPlayerAllZoneIndicator(Sentinels[3])
	call KillPlayerAllZoneIndicator(Sentinels[4])
	call KillPlayerAllZoneIndicator(Sentinels[5])
	call KillPlayerAllZoneIndicator(Scourges[1])
	call KillPlayerAllZoneIndicator(Scourges[2])
	call KillPlayerAllZoneIndicator(Scourges[3])
	call KillPlayerAllZoneIndicator(Scourges[4])
	call KillPlayerAllZoneIndicator(Scourges[5])
	set x = 1
	loop
	exitwhen x > 5
		if IsPlaying(Sentinels[x]) then
			call YCE(Sentinels[x])
		endif
		if IsPlaying(Scourges[x]) then
			call YCE(Scourges[x])
		endif
		set x = x + 1
	endloop
	call RemoveLocation(LIX)
	call RemoveLocation(LAX)
	set BAR[1]= null
	set BAR[2]= null
	set BAR[3]= null
	set BAR[4]= null
	set BAR[5]= null
	set BAR[6]= null
	set BAR[7]= null
	set BAR[8]= null
	set BAR[9]= null
	set BAR[10]= null
	set z = 1
	set w = 1
	set k = 1
	loop
	exitwhen k > 5
		if(IsPlaying(Sentinels[k])) then
			set BAR[w]= Sentinels[k]
			set w = w + 1
		else
			set BNR[z]= Sentinels[k]
			set z = z + 1
		endif
		set k = k + 1
	endloop
	set k = 1
	loop
	exitwhen k > 5
		if(IsPlaying(Scourges[k])) then
			set BAR[w]= Scourges[k]
			set w = w + 1
		else
			set BNR[z]= Scourges[k]
			set z = z + 1
		endif
		set k = k + 1
	endloop
	set Sentinels[1]= null
	set Sentinels[2]= null
	set Sentinels[3]= null
	set Sentinels[4]= null
	set Sentinels[5]= null
	set Scourges[1]= null
	set Scourges[2]= null
	set Scourges[3]= null
	set Scourges[4]= null
	set Scourges[5]= null
	set k = 1
	loop
	exitwhen k >(WXV / 2)
		set o = GetRandomInt(1, WXV)
		if(BAR[o]!= null) then
			set Sentinels[k]= BAR[o]
			set BAR[o]= null
			set k = k + 1
		endif
	endloop
	set x = k
	set k = 1
	loop
	exitwhen k > WXV -x + 1
		set o = GetRandomInt(1, WXV)
		if(BAR[o]!= null) then
			set Scourges[k]= BAR[o]
			set BAR[o]= null
			set k = k + 1
		endif
	endloop
	set z = k
	set k = x
	set y = 1
	loop
	exitwhen k > 5
		set Sentinels[k]= BNR[y]
		set y = y + 1
		set k = k + 1
	endloop
	set k = z
	loop
	exitwhen k > 5
		set Scourges[k]= BNR[y]
		set y = y + 1
		set k = k + 1
	endloop
	set k = 0
	loop
	exitwhen k > 5
		set k = k + 1
	endloop
	call SetPlayerTeam(Sentinels[0], 0)
	call SetPlayerTeam(Sentinels[1], 0)
	call SetPlayerTeam(Sentinels[2], 0)
	call SetPlayerTeam(Sentinels[3], 0)
	call SetPlayerTeam(Sentinels[4], 0)
	call SetPlayerTeam(Sentinels[5], 0)
	call SetPlayerTeam(Scourges[0], 1)
	call SetPlayerTeam(Scourges[1], 1)
	call SetPlayerTeam(Scourges[2], 1)
	call SetPlayerTeam(Scourges[3], 1)
	call SetPlayerTeam(Scourges[4], 1)
	call SetPlayerTeam(Scourges[5], 1)
	set i = 1
	loop
		set ZL[i]= GetPlayerId(Sentinels[i])
		set i = i + 1
	exitwhen i > 5
	endloop
	set i = 7
	loop
		set ZL[i]= GetPlayerId(Scourges[i -6])
		set i = i + 1
	exitwhen i >$B
	endloop
	call K_X()
	set x = 0
	set y = 0
	loop
	exitwhen x > 5
		loop
		exitwhen y > 5
			call SetPlayerAllianceStateBJ(Sentinels[x], Sentinels[y], 3)
			call SetPlayerAllianceStateBJ(Scourges[x], Scourges[y], 3)
			call SetPlayerAllianceStateBJ(Sentinels[x], Scourges[y], 0)
			call SetPlayerAllianceStateBJ(Scourges[x], Sentinels[y], 0)
			set y = y + 1
		endloop
		set y = 0
		set x = x + 1
	endloop
	call ForceClear(RW)
	call ForceClear(IW)
	call ForceAddPlayer(RW, Sentinels[0])
	call ForceAddPlayer(RW, Sentinels[1])
	call ForceAddPlayer(RW, Sentinels[2])
	call ForceAddPlayer(RW, Sentinels[3])
	call ForceAddPlayer(RW, Sentinels[4])
	call ForceAddPlayer(RW, Sentinels[5])
	call ForceAddPlayer(IW, Scourges[0])
	call ForceAddPlayer(IW, Scourges[1])
	call ForceAddPlayer(IW, Scourges[2])
	call ForceAddPlayer(IW, Scourges[3])
	call ForceAddPlayer(IW, Scourges[4])
	call ForceAddPlayer(IW, Scourges[5])
	call ExecuteFunc("K1X")
	call JIO()
	set BRR = XKX(RW)
	set BIR = XKX(IW)
	set k = 1
	loop
	exitwhen k > 5
		if(IsPlaying(Sentinels[k])) then
			call SetPlayerStateBJ(Sentinels[k], PLAYER_STATE_RESOURCE_GOLD,(4375 / BRR))
			call SetPlayerStateBJ(Sentinels[k], PLAYER_STATE_RESOURCE_LUMBER, 0)
		endif
		if(IsPlaying(Scourges[k])) then
			call SetPlayerStateBJ(Scourges[k], PLAYER_STATE_RESOURCE_GOLD,(4375 / BIR))
			call SetPlayerStateBJ(Scourges[k], PLAYER_STATE_RESOURCE_LUMBER, 0)
		endif
		set k = k + 1
	endloop
	if MW then
		set x = 0
		loop
		exitwhen x > 5
			call SetPlayerAlliance(Player(0), Sentinels[x], ALLIANCE_PASSIVE, true)
			call SetPlayerAlliance(Player(0), Sentinels[x], ALLIANCE_SHARED_SPELLS, true)
			call SetPlayerAlliance(Player(0), Scourges[x], ALLIANCE_PASSIVE, false)
			call SetPlayerAlliance(Player(0), Scourges[x], ALLIANCE_SHARED_SPELLS, false)
			set x = x + 1
		endloop
	endif
	call KZX()
	call RemoveLocation(N1R)
	call RemoveLocation(N2R)
	set N1R = null
	set N2R = null
	set LIX = null
	set LAX = null
endfunction
function NER takes nothing returns nothing
	local integer i
	local integer k
	set QW = true
	set i = 1
	set k = V4V
	loop
	exitwhen i > k
		call XSX(V3V[i])
		set YQ[TVE(V3V[i])]= true
		set i = i + 1
	endloop
	set i = 1
	set k = V2V
	loop
	exitwhen i > k
		call XSX(V1V[i])
		set YQ[TVE(V1V[i])]= true
		set i = i + 1
	endloop
endfunction
function BBR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer VXR =(LoadInteger(HY, h,$AC))
	local player p
	local integer x = 1
	loop
	exitwhen x > 5
		set p = Sentinels[x]
		if IsPlaying(p) and p != HostPlayer then
			set Player__Hero[GetPlayerId(p)]= CreateUnit(p, VXR, GetRectCenterX(VZ), GetRectCenterY(VZ), 270)
			set PlayerHeroTypeId[GetPlayerId(p)]= VXR
		endif
		set p = Scourges[x]
		if IsPlaying(p) and p != HostPlayer then
			set Player__Hero[GetPlayerId(p)]= CreateUnit(p, VXR, GetRectCenterX(GY), GetRectCenterY(GY), 270)
			set PlayerHeroTypeId[GetPlayerId(p)]= VXR
		endif
		set x = x + 1
	endloop
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set p = null
	return false
endfunction
function BCR takes nothing returns nothing
	local integer x = 1
	local player p
	local unit triggerUnit = GetTriggerUnit()
	local integer VXR = GetUnitTypeId(triggerUnit)
	local trigger t
	local integer h
	if(GetOwningPlayer(triggerUnit)== HostPlayer and IsUnitType(triggerUnit, UNIT_TYPE_HERO)) then
		call DisableTrigger(GetTriggeringTrigger())
		if FT[GetPlayerId(HostPlayer)]== false and VT == false and OT == false then
			call SetPlayerState(HostPlayer, PLAYER_STATE_RESOURCE_GOLD,$FA+ GetPlayerState(HostPlayer, PLAYER_STATE_RESOURCE_GOLD))
		endif
		set KS[GetPlayerId(HostPlayer)]= true
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .01, false)
		call TriggerAddCondition(t, Condition(function BBR))
		call SaveInteger(HY, h,$AC,(VXR))
	endif
	set p = null
	set triggerUnit = null
	set t = null
endfunction
function NVR takes nothing returns nothing
	local integer x = 1
	local trigger t = CreateTrigger()
	local region r = CreateRegion()
	set Mode__SameHero = true
	loop
	exitwhen x > 5
		if(Sentinels[x]!= HostPlayer ) then
			call XUX(Sentinels[x])
			set FT[GetPlayerId(Sentinels[x])]= true
			set KS[GetPlayerId(Sentinels[x])]= true
		endif
		if(Scourges[x]!= HostPlayer ) then
			call XUX(Scourges[x])
			set FT[GetPlayerId(Scourges[x])]= true
			set KS[GetPlayerId(Scourges[x])]= true
		endif
		set x = x + 1
	endloop
	call RegionAddRect(r, bj_mapInitialPlayableArea)
	call TriggerRegisterEnterRegion(t, r, TrueBoolexprCondition)
	call TriggerAddAction(t, function BCR)
	set r = null
	set t = null
endfunction
function NOR takes nothing returns nothing
	local integer i
	local integer k
	set TW = true
	set i = 1
	set k = V4V
	loop
	exitwhen i > k
		call XSX(V3V[i])
		set YQ[TVE(V3V[i])]= true
		set ZQ[TVE(V3V[i])]= true
		set i = i + 1
	endloop
	set i = 1
	set k = V0V
	loop
	exitwhen i > k
		call XSX(V_V[i])
		set i = i + 1
	endloop
endfunction
function NXR takes nothing returns nothing
	local integer i
	local integer k
	set SW = true
	set i = 1
	set k = V0V
	loop
	exitwhen i > k
		call XSX(V_V[i])
		set YQ[TVE(V_V[i])]= true
		set ZQ[TVE(V_V[i])]= true
		set i = i + 1
	endloop
	set i = 1
	set k = V2V
	loop
	exitwhen i > k
		call XSX(V1V[i])
		set YQ[TVE(V1V[i])]= true
		set ZQ[TVE(V1V[i])]= true
		set i = i + 1
	endloop
endfunction
function NIR takes nothing returns nothing
	local integer i
	local integer k
	set GLV = true
	set i = 1
	set k = V6V
	loop
	exitwhen i > k
		call XSX(V5V[i])
		set YQ[TVE(V5V[i])]= true
		set ZQ[TVE(V5V[i])]= true
		set i = i + 1
	endloop
endfunction
function NRR takes nothing returns nothing
	local integer i
	local integer k
	set GMV = true
	set i = 1
	set k = V8V
	loop
	exitwhen i > k
		call XSX(V7V[i])
		set YQ[TVE(V7V[i])]= true
		set ZQ[TVE(V7V[i])]= true
		set i = i + 1
	endloop
endfunction
function NCR takes nothing returns nothing
	set Mode__ItemDrop = true
endfunction
function NGR takes nothing returns nothing
	set Mode__EasyMode = true

	call SetPlayerTechResearched(Sentinels[0], 'R004', 1)
	call SetPlayerTechResearched(Scourges[0], 'R004', 1)

	//设置经验获取不再有用，因为是脚本给予的经验值
	//call SetPlayerHandicapXP(Sentinels[1], 1.5)
	//call SetPlayerHandicapXP(Sentinels[2], 1.5)
	//call SetPlayerHandicapXP(Sentinels[3], 1.5)
	//call SetPlayerHandicapXP(Sentinels[4], 1.5)
	//call SetPlayerHandicapXP(Sentinels[5], 1.5)
	//call SetPlayerHandicapXP(Scourges[1], 1.5)
	//call SetPlayerHandicapXP(Scourges[2], 1.5)
	//call SetPlayerHandicapXP(Scourges[3], 1.5)
	//call SetPlayerHandicapXP(Scourges[4], 1.5)
	//call SetPlayerHandicapXP(Scourges[5], 1.5)
endfunction
function NDR takes nothing returns nothing
	set Mode__NoPowerups = true
	call DestroyTrigger(RuneRefreshTrigger)
endfunction
function NFR takes nothing returns nothing
	set Mode__SuperCreeps = true
endfunction
function BDR takes nothing returns nothing
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10, GetObjectName('n0HA'))
	call DisableTrigger(GetTriggeringTrigger())
endfunction
function BFR takes nothing returns nothing
	call DisableTrigger((LoadTriggerHandle(HY,(GetHandleId(GetTriggeringTrigger())),$AE)))
	call DisableTrigger(GetTriggeringTrigger())
endfunction
function BGR takes nothing returns nothing
	local trigger N8R = CreateTrigger()
	local trigger t = CreateTrigger()
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10., " ")
	call DisplayTimedTextToAllPlayer(bj_FORCE_ALL_PLAYERS, 10., "额外指令: 可以在15秒内输入 -noneutrals 取消野怪. ")
	call TriggerRegisterTimerEvent(N8R, 15, false)
	call TriggerAddAction(N8R, function BFR)
	call SaveTriggerHandle(HY,(GetHandleId(N8R)),$AE,(t))
	call TriggerRegisterPlayerChatEvent(t, HostPlayer, "-noneutrals", true)
	call TriggerAddAction(t, function BDR)
	set N8R = null
	set t = null
endfunction
function NHR takes nothing returns nothing
	set Mode__OnlyMid = true
	if Mode__NoNeutrals == false then
		call ExecuteFunc("BGR")
	endif
endfunction
function NJR takes nothing returns nothing
	set Mode__NoBot = true
endfunction
function NLR takes nothing returns nothing
	set Mode__NoMid = true
endfunction
function NKR takes nothing returns nothing
	set Mode__NoTop = true
endfunction
function NMR takes nothing returns nothing
	set Mode__NoRepick = true
	set Mode__NoSwap = true
endfunction
function NPR takes nothing returns nothing
	set GUV = true
endfunction
function NQR takes nothing returns nothing
	set Mode__PoolMode = true
endfunction
function BHR takes nothing returns nothing
	local integer i = 0
	local integer TME
	loop
	exitwhen i > 5
		set TME = GetPlayerId(Sentinels[i])
		call SetPlayerName(Sentinels[i], VMV[TME]+ " (" + I2S(RQ[TME])+ "/" + I2S(IQ[TME])+ " | " + I2S(AQ[TME])+ "-" + I2S(NQ[TME])+ ")")
		set TME = GetPlayerId(Scourges[i])
		call SetPlayerName(Scourges[i], VMV[TME]+ " (" + I2S(RQ[TME])+ "/" + I2S(IQ[TME])+ " | " + I2S(AQ[TME])+ "-" + I2S(NQ[TME])+ ")")
		set i = i + 1
	endloop
endfunction
function BJR takes nothing returns boolean
	if Mode__ObserverInfo == false then
		if LocalPlayer== VKV or LocalPlayer== VLV then
			call BHR()
		endif
	endif
	return false
endfunction
function NSR takes nothing returns nothing
	set Mode__ObserverInfo = true
endfunction
function NTR takes nothing returns nothing
	set Mode__FastRespawn = true
endfunction
function BKR takes nothing returns boolean
	if LocalPlayer== VKV or LocalPlayer== VLV then
		if GetTriggerEvalCount(GetTriggeringTrigger())== 1 then
			call CameraSetupSetDestPosition(G_V, 0, 0, .0)
		else
			call CameraSetupSetDestPosition(G_V, GetCameraTargetPositionX(), GetCameraTargetPositionY(), .0)
		endif
		call CameraSetupApplyForPlayer(true, G_V, LocalPlayer, 0)
		call SetTerrainFogEx(0, .0, 100000., .5, .353, .314, .235)
	endif
	return false
endfunction
function NUR takes nothing returns nothing
	local trigger t = CreateTrigger()
	set Mode__ZoomMode = true
	set G_V = CreateCameraSetup()
	call CameraSetupSetField(G_V, CAMERA_FIELD_ZOFFSET, .0, .0)
	call CameraSetupSetField(G_V, CAMERA_FIELD_ROTATION, 90., .0)
	call CameraSetupSetField(G_V, CAMERA_FIELD_ANGLE_OF_ATTACK, 304., .0)
	call CameraSetupSetField(G_V, CAMERA_FIELD_TARGET_DISTANCE, 2500., .0)
	call CameraSetupSetField(G_V, CAMERA_FIELD_ROLL, .0, .0)
	call CameraSetupSetField(G_V, CAMERA_FIELD_FIELD_OF_VIEW, 70., .0)
	call CameraSetupSetField(G_V, CAMERA_FIELD_FARZ, 16000., .0)
	call CameraSetupSetDestPosition(G_V, .0, .0, .0)
	call TriggerRegisterTimerEvent(t,$B4, true)
	call TriggerRegisterTimerEvent(t, .1, false)
	call TriggerAddCondition(t, Condition(function BKR))
	set t = null
endfunction
function BLR takes nothing returns nothing
	local integer i = 1
	local string id
	local player p
	loop
	exitwhen i > 5
		set p = Sentinels[i]
		set id = I2S(GetPlayerId(p))
		call StoreInteger(K4, id, "id", i)
		set p = Scourges[i]
		set id = I2S(GetPlayerId(p))
		call StoreInteger(K4, id, "id", i + 5)
		if LocalPlayer== HostPlayer then
			call SyncStoredInteger(K4, I2S(GetPlayerId(Sentinels[i])), "id")
			call SyncStoredInteger(K4, I2S(GetPlayerId(Scourges[i])), "id")
		endif
		set i = i + 1
	endloop
	set p = null
endfunction

function BMR takes nothing returns boolean
	if YW then
		call AYR("-mdd2s6fnboulffscah", 2)
	endif
	call BLR()
	call CleanCurrentTrigger(GetTriggeringTrigger())
	return false
endfunction
function BPR takes nothing returns boolean
	set GS = true
	call CleanCurrentTrigger(GetTriggeringTrigger())
	return false
endfunction
function BQR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	if UnitRemoveAbility(LoadUnitHandle(HY, h, 0), LoadInteger(HY, h, 0)) and GetUnitAbilityLevel(LoadUnitHandle(HY, h, 0), LoadInteger(HY, h, 0))== 0 then
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	endif
	set t = null
endfunction
function BSR takes unit u, integer id returns nothing
	local timer t
	local integer h
	if UnitRemoveAbility(u, id)== false then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, .5, true, function BQR)
		call SaveUnitHandle(HY, h, 0, u)
		call SaveInteger(HY, h, 0, id)
		set t = null
	endif
endfunction

function BYR takes unit u returns nothing //拉比克额外技能删除,和omg不兼容,不应该使用
	call UnitRemoveAbility(u,'A13D')
	call UnitRemoveAbility(u,'A21J')
	call UnitRemoveAbility(u,'A1QV')
	call UnitRemoveAbility(u,'A1TU')
	call UnitRemoveAbility(u,'A24A')
	call UnitRemoveAbility(u,'A24B')
	call UnitRemoveAbility(u,'A1NH')
	call UnitRemoveAbility(u,'A20N')
	call UnitRemoveAbility(u,'A1Z2')
	call UnitRemoveAbility(u,'A1Z3')
	call UnitRemoveAbility(u,'A205')
	call UnitRemoveAbility(u,'A1VU')
	call UnitRemoveAbility(u,'A0GC')
	call UnitRemoveAbility(u,'A24E')
	call UnitRemoveAbility(u,'A0RT')
	call UnitRemoveAbility(u,'A1RA')
	call UnitRemoveAbility(u,'A0HA')
	call UnitRemoveAbility(u,'A0SA')
	call UnitRemoveAbility(u,'A121')
	call UnitRemoveAbility(u,'A1WF')
	call UnitRemoveAbility(u,'A02T')
	call UnitRemoveAbility(u,'A1S9')
	call UnitRemoveAbility(u,'A21H')
	call UnitRemoveAbility(u,'A1MN')
	call UnitRemoveAbility(u,'A06K')
	call UnitRemoveAbility(u,'A0NE')
	call UnitRemoveAbility(u,'A0MP')
endfunction
function BZR takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	call SaveUnitHandle(HY, GetHandleId(p),'wrth', CreateUnit(p,'e00K', 0, 0, 0))
	call ShowUnit(LoadUnitHandle(HY, GetHandleId(p),'wrth'), false)
	call PauseUnit(LoadUnitHandle(HY, GetHandleId(p),'wrth'), true)
	call UnitRemoveAbility(u,'A3DC')
endfunction
// 禁用单位的血精石
function DisableUnitBloodstone takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	call KillUnit(LoadUnitHandle(HY, GetHandleId(p),'wrth'))
	call UnitAddPermanentAbility(u,'A3DC')
	call SetPlayerAbilityAvailable(p,'A3DC', false)
endfunction
function B0R takes unit u, unit t, integer id returns boolean
	local integer i = 0
	local real a
	local boolean b = false
	if IssueTargetOrderById(u, id, t) then
		return true
	else
		call UnitShareVision(t, GetOwningPlayer(u), true)
		if IssueTargetOrderById(u, id, t) then
			set b = true
		else
			set i = 0
			set a = AngleBetweenUnit(u, t)
			loop
				call SetUnitX(u, GetUnitX(u)+ 20 * Cos(a * bj_DEGTORAD))
				call SetUnitY(u, GetUnitY(u)+ 20 * Sin(a * bj_DEGTORAD))
				set i = i + 1
				if IssueTargetOrderById(u, id, t) then
					set b = true
				endif
			exitwhen GetDistanceBetweenUnits(u, t)> 1200 or b
			endloop
		endif
		call UnitShareVision(t, GetOwningPlayer(u), false)
	endif
	// debug call SingleDebug(I2S(i)+ " steps")
	return b
endfunction
function B1R takes unit d, string S6V, real x, real y returns nothing
	local real cx = GetUnitX(d)
	local real cy = GetUnitY(d)
	local real a = AngleBetweenXY(cx, cy, x, y)* bj_DEGTORAD
	local real B2R = 20 * Cos(a)
	local real B3R = 20 * Sin(a)
	local integer i = 0
	loop
	exitwhen IssuePointOrder(d, S6V, x, y) or i > 20
		call SetUnitX(d, GetUnitX(d)+ B2R)
		call SetUnitY(d, GetUnitY(d)+ B3R)
		call SaveReal(VV,'wave','000x', x)
		call SaveReal(VV,'wave','000y', y)
		set x = x + B2R
		set y = y + B3R
		set i = i + 1
	endloop
	if i > 20 then
		call UnitRemoveAbility(d,'Avul')
		call IssueTargetOrder(d, S6V, d)
	endif
endfunction
function GetUnitItemPhysicalLifesteal takes unit u returns real
	if GetUnitAbilityLevel(u,'A1CN')== 1 then	//撒旦主动
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl", DESourceUnit[DEI], "origin"))
		return 2.
	endif
	if GetUnitAbilityLevel(u,'A04T')== 1 then	//撒旦被动
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl", DESourceUnit[DEI], "origin"))
		return .25
	endif
	if GetUnitAbilityLevel(u,'A0II')== 1 then	//疯脸
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl", DESourceUnit[DEI], "origin"))
		return .2
	endif
	if GetUnitAbilityLevel(u,'A09P')== 1 then	//死亡面具和支配头盔
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl", DESourceUnit[DEI], "origin"))
		return .15
	endif
	return .0
endfunction
function StygianDesolatorActions takes unit t returns nothing
	call AddAbilityToTimed(t,'A3K2', 1, 15, 0)
	call AddAbilityToTimed(t,'A3K3', 1, 15,'BIcb')
endfunction
function B7R takes unit u, unit t returns boolean
	if GetUnitAbilityLevel(u,'AIcb')> 0 then	//黯灭
		call StygianDesolatorActions(t)
		return true
	endif
	return false
endfunction
function CVR takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer hu = LoadInteger(HY, h, 0)
	local real CER = LoadReal(HY, h, 0)
	local real hp = GetWidgetLife(u)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or u == null or LoadReal(HY, h, 1)< GetGameTime() then
		call RemoveSavedHandle(HY, hu,'FRZH')
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	else
		if hp < CER or LoadInteger(HY, hu,'AFRZ')== 1 then
			call SaveReal(HY, h, 0, hp)
		else
			call SetWidgetLife(u, CER)
		endif
	endif
	set t = null
	set u = null
endfunction
function CXR takes unit u, real SYV returns nothing
	local trigger t
	local integer h
	local integer hu = GetHandleId(u)
	if HaveSavedHandle(HY, hu,'FRZH') then
		set t = LoadTriggerHandle(HY, hu,'FRZH')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerAddCondition(t, Condition(function CVR))
		call SaveTriggerHandle(HY, hu,'FRZH', t)
		call SaveInteger(HY, h, 0, hu)
		call SaveUnitHandle(HY, h, 0, u)
		call SaveReal(HY, h, 0, GetWidgetLife(u))
	endif
	call SaveReal(HY, h, 1, SYV + GetGameTime())
	set t = null
endfunction
function COR takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or GetTriggerEvalCount(t)== 60 or GetUnitAbilityLevel(u,'A3K6')== 0 then
		call SetHeroStr(u, GetHeroStr(u, false)+ LoadInteger(HY, h, 0), true)
		call SetHeroAgi(u, GetHeroAgi(u, false)+ LoadInteger(HY, h, 1), true)
		call SetHeroInt(u, GetHeroInt(u, false)+ LoadInteger(HY, h, 2), true)
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	endif
	set u = null
	set t = null
endfunction
function CRR takes nothing returns nothing
	local real WLV = 0
	local unit u = GetEnumUnit()
	local trigger t
	local real SYV = 12.
	local integer stolen = 0
	local integer curstat = 0
	local integer level = GetUnitAbilityLevel(UN,'A32A')
	local integer CIR = 0
	local integer CAR
	local integer CNR
	local integer CBR
	local integer h
	if IsUnitType(u, UNIT_TYPE_HERO) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .2, true)
		call TriggerRegisterDeathEvent(t, u)
		set CIR = 3
		set CAR = IMinBJ(GetHeroStr(u, false)-1, level * 2)
		set CNR = IMinBJ(GetHeroAgi(u, false)-1, level * 2)
		set CBR = IMinBJ(GetHeroInt(u, false)-1, level * 2)
		call SetHeroStr(u, GetHeroStr(u, false)-CAR, true)
		call SetHeroAgi(u, GetHeroAgi(u, false)-CNR, true)
		call SetHeroInt(u, GetHeroInt(u, false)-CBR, true)
		call TriggerAddCondition(t, Condition(function COR))
		call AddAbilityToTimed(u,'A3K6', 1, 12,'B3K6')
		call SaveUnitHandle(HY, h, 0, u)
		call SaveInteger(HY, h, 0, CAR)
		call SaveInteger(HY, h, 1, CNR)
		call SaveInteger(HY, h, 2, CBR)
		set t = null
	endif
	call UnitDamageTargetEx(UN, u, 3, 50 + 25 * level)
	set u = null
	set t = null
endfunction
function CCR takes nothing returns boolean
	return IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(UN)) and IsAliveNotStrucNotWard(GetFilterUnit()) and IsMagicImmuneUnit(GetFilterUnit())== false
endfunction
function FVE takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local group g = LoginGroup(116)
	local group gg = LoginGroup(117)
	local integer level = GetUnitAbilityLevel(WJE, GetSpellAbilityId())
	local real radian = AngleBetweenXY(GetUnitX(WJE), GetUnitY(WJE), GetSpellTargetX(), GetSpellTargetY())* bj_DEGTORAD
	local real x = GetUnitX(WJE)
	local real y = GetUnitY(WJE)
	local unit W_V = CreateUnit(GetOwningPlayer(WJE),'e00E', GetUnitX(WJE), GetUnitY(WJE), radian * bj_RADTODEG)
	call UnitAddAbility(W_V,'A32X')
	call IssuePointOrderById(W_V,$D0264, x + 125 * Cos(radian), y + 125 * Sin(radian))
	set W_V = null
	set UN = WJE
	call GroupEnumUnitsInRange(g, x + 125 * Cos(radian), y + 125 * Sin(radian), 175, Condition(function CCR))
	call GroupAddGroup(g, gg)
	call GroupEnumUnitsInRange(g, x + 300 * Cos(radian), y + 300 * Sin(radian), 200, Condition(function CCR))
	call GroupAddGroup(g, gg)
	call GroupEnumUnitsInRange(g, x + 500 * Cos(radian), y + 500 * Sin(radian), 200, Condition(function CCR))
	call GroupAddGroup(g, gg)
	call GroupEnumUnitsInRange(g, x + 700 * Cos(radian), y + 700 * Sin(radian),$FA, Condition(function CCR))
	call GroupAddGroup(g, gg)
	set UN = WJE
	call ForGroup(gg, function CRR)
	call LogoutGroup(g)
	call LogoutGroup(gg)
	set WJE = null
	set g = null
	set gg = null
endfunction
function CDR takes nothing returns boolean
	return(IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(UN)) and IsAliveNotStrucNotWard(GetFilterUnit()) and IsUnitType(GetFilterUnit(), UNIT_TYPE_MECHANICAL)== false and IsUnitInGroup(GetFilterUnit(), GI)== false)!= null
endfunction
function CFR takes nothing returns nothing
	call UnitDamageTargetEx(UN, GetEnumUnit(), 1, MC)
	call AddAbilityToTimed(GetEnumUnit(),'A3LA', 1, 3.,'A32c')
	call GroupAddUnit(GI, GetEnumUnit())
endfunction
function CGR takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local real radian = LoadReal(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	local real x = LoadReal(HY, h, 1)
	local real y = LoadReal(HY, h, 2)
	local real cx
	local real cy
	local real N3X = LoadReal(HY, h, 3)
	local group g
	local group AIR = LoadGroupHandle(HY, h, 2)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call SetUnitPathing(u, true)
		call DestroyEffect(LoadEffectHandle(HY, h, 4))
		call DestroyEffect(LoadEffectHandle(HY, h, 5))
		call LogoutGroup(AIR)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SetUnitPosition(u, CoordinateX50(GetUnitX(u)+ N3X * Cos(radian)), CoordinateY50(GetUnitY(u)+ N3X * Sin(radian)))
		if ModuloInteger(GetTriggerEvalCount(t), 10)== 0 then
			call KillDestructablesInCircle(GetUnitX(u), GetUnitY(u), 150)
		endif
		call SetUnitFacing(u, radian * bj_RADTODEG)
		if GetDistanceBetween(x, y, GetUnitX(u), GetUnitY(u))< 50 or GetDistanceBetween(x, y, GetUnitX(u), GetUnitY(u))> 1200 or GetTriggerEvalCount(t)> 1200. / N3X then
			call DestroyEffect(LoadEffectHandle(HY, h, 4))
			call DestroyEffect(LoadEffectHandle(HY, h, 5))
			call SetUnitPathing(u, true)
			call SetUnitPosition(u, CoordinateX50(GetUnitX(u)), CoordinateY50(GetUnitY(u)))
			call LogoutGroup(AIR)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			call SetUnitAnimationByIndex(u, LoadInteger(P, GetUnitTypeId(u),'A1P8'))
			set cx = GetUnitX(u)
			set cy = GetUnitY(u)
			set g = LoginGroup(118)
			set UN = u
			set GI = AIR
			call GroupEnumUnitsInRange(g, cx, cy, 275, Condition(function CDR))
			set MC = level * 50.
			set WC = level
			set UN = u
			call ForGroup(g, function CFR)
			call GroupAddGroup(g, AIR)
			call LogoutGroup(g)
		endif
	endif
	set g = null
	set AIR = null
	set u = null
	set t = null
endfunction
function FEE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u, GetSpellAbilityId())
	local real cx = GetUnitX(u)
	local real cy = GetUnitY(u)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real radian = AngleBetweenXY(cx, cy, x, y)* bj_DEGTORAD
	local trigger t
	local integer h
	local group g = LoginGroup(119)
	local string s = GetFootAttachPointName(u)
	local string s2 = ""
	if s == "foot" then
		set s = "foot,right"
		set s2 = "foot,left"
	endif
	if GetDistanceBetween(cx, cy, x, y)>1000 then
		set x = cx +1000* Cos(radian)
		set y = cy +1000* Sin(radian)
	endif
	call SetUnitFacingTimed(u, radian * bj_RADTODEG, .3)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function CGR))
	call SaveUnitHandle(HY, h, 0, u)
	call SaveEffectHandle(HY, h, 4, AddSpecialEffectTarget("effects\\SandWaveMissile.mdx", u, s))
	call SaveEffectHandle(HY, h, 5, AddSpecialEffectTarget("effects\\SandWaveMissile.mdx", u, s2))
	call SaveReal(HY, h, 0, radian)
	call SaveReal(HY, h, 1, x)
	call SaveReal(HY, h, 2, y)
	call SaveReal(HY, h, 3, 1000. * .02)
	call SaveInteger(HY, h, 0, level)
	call SaveGroupHandle(HY, h, 2, g)
	call SetUnitPathing(u, false)
	set t = null
	set u = null
	set g = null
endfunction
function CHR takes nothing returns nothing
	local unit WJE = U2
	local unit WLE = W2
	local integer level = GetUnitAbilityLevel(WJE,'A32E')
	local real CJR = level * 40 + 40
	call UnitDamageTargetEx(WJE, WLE, 1, CJR)
	call CNX(WLE,'A32F', 1, 4,'B32F')
	set WJE = null
	set WLE = null
endfunction
function CKR takes nothing returns nothing
	local trigger t = NHX(GetTriggerUnit(), GetSpellTargetUnit(),'hKOD', "CHR", 1000, true)
	set t = null
endfunction
function FOE takes nothing returns nothing
	local integer i = LoadInteger(P, GetHandleId(GetTriggerUnit()),'A32D')-1
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call CKR()
	endif
	call SaveInteger(P, GetHandleId(GetTriggerUnit()),'A32D', i)
	if i < 1 then
		call SaveBoolean(P, GetHandleId(GetTriggerUnit()),'A32D', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(GetTriggerUnit()),'A32D', false)
	endif
endfunction
function LEE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	if LoadBoolean(P, GetHandleId(u),'A32D')== false or LoadInteger(P, GetHandleId(u),'A32D')< 1 then
		call EXStopUnit(u)
		call InterfaceErrorForPlayer(GetOwningPlayer(u), "没有树木可使用")
		call SaveBoolean(P, GetHandleId(u),'A32D', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A32D', false)
	endif
	set u = null
endfunction
function CLR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local destructable d = LoadDestructableHandle(HY, GetHandleId(t), 0)
	local unit u = CreateUnit(NeutralPassivePlayer,'e00E', GetDestructableX(d), GetDestructableY(d), 0)
	call UnitAddAbility(u,'A1FD')
	call IssueTargetOrderById(u,$D00B2, d)
	call FlushChildHashtable(HY, GetHandleId(t))
	call PauseTimer(t)
	call DestroyTimer(t)
	set u = null
	set t = null
endfunction
function CMR takes destructable d returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .3, false, function CLR)
	call SaveDestructableHandle(HY, GetHandleId(t), 0, d)
	set t = null
endfunction
function FXE takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(WJE, GetSpellAbilityId())
	call UnitAddPermanentAbility(WJE,'A32D')
	call SaveBoolean(P, GetHandleId(WJE),'A32D', true)
	call SetPlayerAbilityAvailable(GetOwningPlayer(WJE),'A32D', true)
	call SaveInteger(P, GetHandleId(WJE),'A32D', LoadInteger(P, GetHandleId(WJE),'A32D')+ 1)
	call CMR(GetSpellTargetDestructable())
	set WJE = null
endfunction
function SQE takes nothing returns nothing
	call UnitAddPermanentAbility(GetTriggerUnit(),'A32E')
	call SetUnitAbilityLevel(GetTriggerUnit(),'A32E', GetUnitAbilityLevel(GetTriggerUnit(),'A32Y'))
endfunction
function CPR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer UYX = 0
	local integer level = GetUnitAbilityLevel(u,'A32G')
	local integer I2X = 5 + 5 * level
	local integer CQR = 4 + 2 * level
	local integer CSR = LoadInteger(P, GetHandleId(u),'A32G')
	local integer CTR = LoadInteger(P, GetHandleId(u),'A32G'+ 1)
	local integer i = 0
	local integer id = 0
	local integer k = 0
	local integer CUR = 0
	if level == 0 then
		if CSR > 0 then
			call LodSystem_ReduceUnitExtraState(u, CSR, STATE_SYSTEM_DAMAGE)
			call LodSystem_ReduceUnitExtraState(u, CTR, STATE_SYSTEM_ATTACK)
		endif
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	else
		loop
			set k = 0
			set id = GetItemTypeId(UnitItemInSlot(u, i))
			if id > 0 then
				if TEX(id)>$7D0 then
					set UYX = UYX + 1
				endif
			endif
			set i = i + 1
		exitwhen i > 5
		endloop
		set CUR = UYX * I2X
		set CQR = UYX * CQR
		if CUR != CSR then
			call LodSystem_ReduceUnitExtraState(u, CSR, STATE_SYSTEM_DAMAGE)
			call LodSystem_ReduceUnitExtraState(u, CTR, STATE_SYSTEM_ATTACK)
			call LodSystem_AddUnitExtraState(u, CUR, STATE_SYSTEM_DAMAGE)
			call LodSystem_AddUnitExtraState(u, CQR, STATE_SYSTEM_ATTACK)
			call SaveInteger(P, GetHandleId(u),'A32G', CUR)
			call SaveInteger(P, GetHandleId(u),'A32G'+ 1, CQR)
		endif
	endif
	set t = null
	set u = null
endfunction
function L_E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local timer t = CreateTimer()
	call TimerStart(t, 1, true, function CPR)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveInteger(HY, GetHandleId(t), 0, GetUnitAbilityLevel(u, GetSpellAbilityId())+ 1)
	set t = null
	set u = null
endfunction
function CWR takes unit u, integer E6X returns nothing
	local integer array b
	local integer a = E6X
	local integer c = 1
	local integer i = 0
	local integer z = 5
	//local real hp
	local integer array CYR
	set CYR[0]='A32N'
	set CYR[1]='A32O'
	set CYR[2]='A32P'
	set CYR[3]='A32Q'
	set CYR[4]='A32R'
	set CYR[5]='A32S'
	if E6X < 1 then
		//set hp = GetWidgetLife(u)
		call UnitRemoveAbility(u, CYR[0])
		call UnitRemoveAbility(u, CYR[1])
		call UnitRemoveAbility(u, CYR[2])
		call UnitRemoveAbility(u, CYR[3])
		call UnitRemoveAbility(u, CYR[4])
		call UnitRemoveAbility(u, CYR[5])
		//call SetWidgetLife(u, hp)
		return
	endif
	loop
		set c = a / 2
		set b[i]= a -c * 2
		set a = c
		set i = i + 1
	exitwhen c == 0
	endloop
	set i = 0
	loop
	exitwhen i > z
		if b[i]== 1 then
			call UnitAddPermanentAbility(u, CYR[i])
		else
			call UnitRemoveAbility(u, CYR[i])
		endif
		set i = i + 1
	endloop
endfunction
function CZR takes unit u, integer E6X, integer C_R returns nothing
	local integer array b
	local integer a = C_R
	local integer c = 1
	local integer i = 0
	local integer z
	local real hp
	local integer array CYR
	set CYR[0]='A32H'
	set CYR[1]='A32I'
	set CYR[2]='A32J'
	set CYR[3]='A32K'
	set CYR[4]='A32L'
	set CYR[5]='A32M'
	if C_R < 1 then
		call UnitRemoveAbility(u, CYR[0])
		call UnitRemoveAbility(u, CYR[1])
		call UnitRemoveAbility(u, CYR[2])
		call UnitRemoveAbility(u, CYR[3])
		call UnitRemoveAbility(u, CYR[4])
		call UnitRemoveAbility(u, CYR[5])
		call CWR(u, 0)
		return
	endif
	loop
		set c = a / 2
		set b[i]= a -c * 2
		set a = c
		set i = i + 1
	exitwhen c == 0
	endloop
	set z = 5
	set i = 0
	loop
	exitwhen i > z
		if b[i]== 1 then
			call UnitAddPermanentAbility(u, CYR[i])
		else
			call UnitRemoveAbility(u, CYR[i])
		endif
		set i = i + 1
	endloop
	call CWR(u, E6X)
endfunction
function C0R takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer hu = 0
	local unit WJE = LoadUnitHandle(HY, h, 0)
	local integer i = 1
	local unit u = null
	local boolean C1R = LoadBoolean(HY, h, 0)
	local player p
	local integer TME = 0
	local integer C2R = LoadInteger(HY, h, 1)+ 1
	local integer C3R = 0
	local integer C4R = 0
	local integer C5R = 0
	local integer WOV = LoadInteger(HY, h,-1)
	local unit array C6R
	loop
		if C1R then
			set TME = GetPlayerId(Scourges[i])
		else
			set TME = GetPlayerId(Sentinels[i])
		endif
		set u = Player__Hero[TME]
		if u != null then //UnitAlive(u) and
			set hu = GetHandleId(u)
			if(GetDistanceBetween(GetUnitX(WJE), GetUnitY(WJE), GetUnitX(u), GetUnitY(u))< 925 or LoadBoolean(P, hu,'A32G'+ 1)) then
				//if C2R == 1 then
				call SaveBoolean(P, hu,'A32G'+ 1, true)
				//endif
				set C3R = C3R + 1
				set C6R[C3R]= u
			elseif GetDistanceBetween(GetUnitX(WJE), GetUnitY(WJE), GetUnitX(u), GetUnitY(u)) > 925 then
				call CZR(u, 0, 0)
				call SaveInteger(P, hu,'A32G'+ 1, 0)
				call SaveBoolean(P, hu,'A32G'+ 1, false)
			endif
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	set C5R =(6 + 2 * LoadInteger(HY, h, 0) )* C3R
	set i = 1
	loop
		set u = C6R[i]
		set hu = GetHandleId(u)
		if C2R < WOV and(GetDistanceBetween(GetUnitX(WJE), GetUnitY(WJE), GetUnitX(u), GetUnitY(u))< 925 and LoadBoolean(P, hu,'A32G'+ 1)) then
			set C4R = LoadInteger(P, hu,'A32G'+ 1)
			if C4R != C5R then
				call CZR(u, 0, 0)
				if u != WJE then
					call CZR(u, R2I(C5R / 2), C5R)
				else
					call CZR(u, C5R, C5R)
				endif
				call SaveInteger(P, hu,'A32G'+ 1, C5R)
			endif
		else
			call CZR(u, 0, 0)
			call SaveInteger(P, hu,'A32G'+ 1, 0)
			call SaveBoolean(P, hu,'A32G'+ 1, false)
		endif
		set i = i + 1
	exitwhen i > C3R
	endloop
	call SaveInteger(HY, h, 1, C2R)
	if C2R == WOV then
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	endif
	set WJE = null
	set t = null
	set u = null
	set C6R[1]= null
	set C6R[2]= null
	set C6R[3]= null
	set C6R[4]= null
	set C6R[5]= null
endfunction
function FRE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer lv = GetUnitAbilityLevel(u, GetSpellAbilityId())
	local timer t = CreateTimer()
	call TimerStart(t, .25, true, function C0R)
	call SaveInteger(HY, GetHandleId(t),-1, R2I(8 / .25)+ 1)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveInteger(HY, GetHandleId(t), 0, lv)
	call SaveBoolean(HY, GetHandleId(t), 0, IsScourgesPlayer(GetOwningPlayer(u)))
	set t = null
	set u = null
endfunction
function C7R takes nothing returns nothing
	local unit WJE = U2
	local unit WLE = W2
	local real CJR = 100 + 60 * GetUnitAbilityLevel(WJE,'A45W')
	if GetWidgetLife(WLE)< GetUnitState(WLE, UNIT_STATE_MAX_LIFE)/ 2 then
		set CJR = CJR / 2
	endif
	call DestroyEffect(LoadEffectHandle(HY, GetHandleId(GetTriggeringTrigger()),'00fx'))
	call UnitDamageTargetEx(WJE, WLE, 3, CJR)
	set WJE = null
	set WLE = null
endfunction
function B_E takes nothing returns nothing
	local trigger t = null
	local unit d = null
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = NHX(GetTriggerUnit(), GetSpellTargetUnit(),'h077', "C7R",$5DC, true)
		set d = LoadUnitHandle(HY, GetHandleId(t), 45)
		call SaveEffectHandle(HY, GetHandleId(t),'00fx', AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilMissile.mdl", d, "origin"))
		set t = null
		set d = null
	endif
endfunction
function C8R takes nothing returns boolean
	if UnitIsDead(GetFilterUnit())== false and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(QN)) and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false and IsMagicImmuneUnit(GetFilterUnit())== false then
		if IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) then
			set TN = TN + 1
		endif
		return true
	endif
	return false
endfunction
function C9R takes nothing returns nothing
	local integer T0V ='A45Y'
	local integer level = 1
	call UnitDamageTargetEx(QN, GetEnumUnit(), 1, SN * 40 + 40)
	if UnitIsDead(GetEnumUnit())== false then
		if TN < 2 then
			set level = TN + 1
		else
			set level = TN -1
			set T0V = T0V + 1
		endif
		call AddAbilityToTimed(GetEnumUnit(), T0V, level, 1 + SN,'B45Y')
	endif
endfunction
function DVR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	local group g = LoginGroup(120)
	local integer i = 0
	set SN = level
	set QN = WJE
	set TN = 0
	call GroupEnumUnitsInRange(g, LoadReal(HY, h, 1), LoadReal(HY, h, 2), 300 + 50 * level, Condition(function C8R))
	call ForGroup(g, function C9R)
	call LogoutGroup(g)
	call PauseTimer(t)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set WJE = null
	set t = null
	set g = null
endfunction
function B0E takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(GetTriggerUnit(),'A45X'))
	call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
	call SaveReal(HY, h, 1, x)
	call SaveReal(HY, h, 2, y)
	call TimerStart(t, .4, false, function DVR)
	call SaveEffectHandle(HY, h, 10, AddSpecialEffect("war3mapImported\\ArrowShower.mdx", x, y))
	call SaveEffectHandle(HY, h, 11, AddSpecialEffect("war3mapImported\\ArrowShower.mdx", x +$FA, y))
	call SaveEffectHandle(HY, h, 12, AddSpecialEffect("war3mapImported\\ArrowShower.mdx", x, y +$FA))
	call SaveEffectHandle(HY, h, 13, AddSpecialEffect("war3mapImported\\ArrowShower.mdx", x +$FA, y +$FA))
	call SaveEffectHandle(HY, h, 14, AddSpecialEffect("war3mapImported\\ArrowShower.mdx", x -$FA, y))
	call SaveEffectHandle(HY, h, 15, AddSpecialEffect("war3mapImported\\ArrowShower.mdx", x, y -$FA))
	call SaveEffectHandle(HY, h, 16, AddSpecialEffect("war3mapImported\\ArrowShower.mdx", x -$FA, y -$FA))
	set t = null
endfunction
function MortalWoundsLoop takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit sourceUnit = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	local real damage = LoadReal(HY, h, 0)
	local integer c = LoadInteger(HY, h, 0)+ 1
	if sourceUnit == null or targetUnit == null or damage == .0 or c > 3 then
		call DestroyEffect(LoadEffectHandle(HY, h, 3))
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	else
		set TransmittedDamage = true
		call UnitDamageTargetEx(sourceUnit, targetUnit, 2, damage)
		set TransmittedDamage = false
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\BloodRiteTarget.mdx", targetUnit, "origin"))
		call SaveInteger(HY, h, 0, c)
		if c == 3 then
			call DestroyEffect(LoadEffectHandle(HY, h, 3))
			call PauseTimer(t)
			call FlushChildHashtable(HY, h)
			call DestroyTimer(t)
		endif
	endif
	set t = null
	set sourceUnit = null
	set targetUnit = null
endfunction

function MortalWoundsTransmittedActions takes nothing returns nothing //致命创伤属于 英雄攻击 普通伤害 即物理伤害
	local timer tt = null
	local integer ht
	local real damage = GetAllDamage()
	if GetPrdRandom(DESourceUnit[DEI],'A460', 30) and damage > 20. then
		set tt = CreateTimer()
		set ht = GetHandleId(tt)
		call TimerStart(tt, 1, true, function MortalWoundsLoop)
		call SaveUnitHandle(HY, ht, 0, DESourceUnit[DEI])
		call SaveUnitHandle(HY, ht, 1, DETargetUnit[DEI])
		call SaveReal(HY, ht, 0, damage * (.05 *(GetUnitAbilityLevel(DESourceUnit[DEI],'A460'))+ .25))
		call SaveEffectHandle(HY, ht, 3, AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", DETargetUnit[DEI], "origin"))
		set tt = null
	endif
endfunction

function BladeMailTransmittedActions takes nothing returns nothing
	call UnitTransmittedSourceTypeDamage(DETargetUnit[DEI], DESourceUnit[DEI], GetAllDamage())
endfunction

function DRR takes nothing returns boolean
	if IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and UnitIsDead(GetFilterUnit())== false and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(QN)) and GetUnitAbilityLevel(GetFilterUnit(),'Avul')== 0 and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 then
		if GetWidgetLife(GetFilterUnit())< LN then
			set LN = GetWidgetLife(GetFilterUnit())
			set MN = GetFilterUnit()
		endif
		return true
	endif
	return false
endfunction
function DIR takes unit u, boolean DAR returns nothing
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	local integer T0V ='A462'
	local integer level = 1
	if DAR then
		set level = 2
	endif
	call UnitAddAbility(d, T0V)
	call SetUnitAbilityLevel(d, T0V, level)
	call IssueTargetOrderById(d, 852095, u)
	call EYX("Abilities\\Spells\\Orc\\Ensnare\\ensnare_AirTarget.mdl", u, "origin", .5)
	set d = null
endfunction
function DNR takes nothing returns nothing
	local integer h = GetHandleId(GetExpiredTimer())
	local unit WJE =(LoadUnitHandle(HY, h, 290))
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local real Ax =(LoadReal(HY, h, 284))
	local real Ay =(LoadReal(HY, h, 285))
	local real Cx =(LoadReal(HY, h, 286))
	local real Cy =(LoadReal(HY, h, 287))
	local real Bx =(LoadReal(HY, h, 288))
	local real By =(LoadReal(HY, h, 289))
	local real a =(LoadReal(HY, h, 137))
	local real b = 1 -a
	local boolean DBR =(LoadBoolean(HY, h, 291))
	local real DCR = RMaxBJ(GetDistanceBetween(Ax, Ay, Cx, Cy)/ $514, .2)
	local boolean bb = LoadBoolean(HY, h, 0)
	local group g = null
	local real x = CoordinateX50(Ax * a * a + Bx * 2 * a * b + Cx * b * b)
	local real y = CoordinateY50(Ay * a * a + By * 2 * a * b + Cy * b * b)
	local unit u
	local real ILX
	call SetUnitFacing(WJE, AngleBetweenXY(GetUnitX(WJE), GetUnitY(WJE), x, y))
	call SetUnitX(WJE, x)
	call SetUnitY(WJE, y)
	if GetDistanceBetween(x, y, Cx, Cy)< 50 and bb == false then
		call SaveBoolean(HY, h, 0, true)
		set g = LoginGroup(121)
		set QN = WJE
		set SN = GetUnitAbilityLevel(WJE,'A461')
		set MN = null
		set LN =$F423F
		call GroupEnumUnitsInRange(g, x, y, 300, Condition(function DRR))
		if MN != null then
			call SaveBoolean(HY, h, 1, true)
			call SaveUnitHandle(HY, h, 1, MN)
		endif
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			call UnitDamageTargetEx(WJE, u, 1, SN * 50 + 50)
			call DIR(u, false)
			call GroupRemoveUnit(g, u)
		endloop
		call LogoutGroup(g)
		set g = null
	endif
	if LoadBoolean(HY, h, 1) then
		call SetUnitPosition(LoadUnitHandle(HY, h, 1), x, y)
	endif
	if(DBR) then
		call SaveReal(HY, h, 137,((a -0.02 / DCR)* 1.))
		call SetUnitFlyHeight(WJE, GetUnitFlyHeight(WJE)+ LoadReal(HY, h, 291), 0)
	else
		call SaveReal(HY, h, 137,((a + .02 / DCR)* 1.))
		call SetUnitFlyHeight(WJE, GetUnitFlyHeight(WJE)-LoadReal(HY, h, 291), 0)
	endif
	if(a < 0 and DBR) then
		call SaveBoolean(HY, h, 291,(false))
		call SaveReal(HY, h, 288,((Ax + 300 * Cos(Atan2(Cy -Ay, Cx -Ax)+(LoadReal(HY, h, 292))))* 1.))
		call SaveReal(HY, h, 289,((Ay + 300 * Sin(Atan2(Cy -Ay, Cx -Ax)+(LoadReal(HY, h, 292))))* 1.))
	endif
	if(a > 1 and DBR == false) then
		if LoadBoolean(HY, h, 1) then
			call UnitDamageTargetEx(WJE, LoadUnitHandle(HY, h, 1), 1, 50 + 50 * GetUnitAbilityLevel(WJE,'A461'))
			call DIR(LoadUnitHandle(HY, h, 1), true)
			call EYX("Abilities\\Spells\\Orc\\Ensnare\\ensnare_AirTarget.mdl", LoadUnitHandle(HY, h, 1), "origin", 1)
			call KillDestructablesInCircle(GetUnitX(LoadUnitHandle(HY, h, 1)), GetUnitY(LoadUnitHandle(HY, h, 1)), 200)
		endif
		call SetUnitFlyHeight(WJE, LoadReal(HY, h, 290), 0)
		call KillDestructablesInCircle(GetUnitX(WJE), GetUnitY(WJE), 200)
		call PauseTimer(GetExpiredTimer())
		call FlushChildHashtable(HY, h)
		call DestroyTimer(GetExpiredTimer())
	endif
	set WJE = null
	set triggerUnit = null
endfunction
function B7E takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local real Ax = GetUnitX(WJE)
	local real Ay = GetUnitY(WJE)
	local real Cx = CoordinateX50(GetSpellTargetX())
	local real Cy = CoordinateY50(GetSpellTargetY())
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local real a = AngleBetweenXY(Ax, Ay, Cx, Cy)* bj_DEGTORAD
	if GetDistanceBetween(Ax, Ay, Cx, Cy)< 300 then
		set Cx = CoordinateX50(Ax + 300 * Cos(a))
		set Cy = CoordinateY50(Ay + 300 * Sin(a))
	endif
	call SaveUnitHandle(HY, h, 14,(WJE))
	call SaveUnitHandle(HY, h, 290,(WJE))
	call SaveReal(HY, h, 284,((Ax)* 1.))
	call SaveReal(HY, h, 285,((Ay)* 1.))
	call SaveReal(HY, h, 286,((Cx)* 1.))
	call SaveReal(HY, h, 287,((Cy)* 1.))
	call SaveReal(HY, h, 288,((Ax + 300 * Cos(Atan2(Cy -Ay, Cx -Ax)-45))* 1.))
	call SaveReal(HY, h, 289,((Ay + 300 * Sin(Atan2(Cy -Ay, Cx -Ax)-45))* 1.))
	call SaveReal(HY, h, 137, 1.)
	call SaveReal(HY, h, 292, 45.)
	call SaveBoolean(HY, h, 291, true)
	call SaveReal(HY, h, 290, GetUnitFlyHeight(WJE))
	call SaveReal(HY, h, 291,$514/ GetDistanceBetween(Ax, Ay, Cx, Cy))
	if O0X(WJE)== false then
		call UnitAddPermanentAbility(WJE,'Amrf')
		call UnitRemoveAbility(WJE,'Amrf')
	endif
	call TimerStart(t, .02, true, function DNR)
	set WJE = null
	set t = null
endfunction
function DDR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer EVX = GetTriggerEvalCount(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local integer level =(LoadInteger(HY, h, 5))
	local real DFR
	local unit dummyUnit
	set DFR = .6 *(EVX -25)*(EVX -25)
	if EVX < 51 and GetTriggerEventId()!= EVENT_WIDGET_DEATH then
		if ModuloInteger(EVX, 5)== 0 then
			call UnitDamageTargetEx(WUE, targetUnit, 1, 3 + 3 * level)
		endif
		if O0X(targetUnit)== false then
			call SetUnitFlyHeight(targetUnit, 500 -DFR, 0)
		endif
	else
		set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitAddPermanentAbility(dummyUnit,'A11L')
		call SetUnitAbilityLevel(dummyUnit,'A11L', level)
		call IssueTargetOrderById(dummyUnit, 852075, targetUnit)
		if O0X(targetUnit)== false then
			call SetUnitFlyHeight(targetUnit, GetUnitDefaultFlyHeight(targetUnit), 0)
		endif
		if OY == false then
			call PauseUnit(targetUnit, false)
		endif
		call SetUnitPathing(targetUnit, true)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set dummyUnit = null
	return false
endfunction
function DGR takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = U2
	local unit targetUnit = GetEnumUnit()
	local integer level = Q2
	call PauseUnit(targetUnit, true)
	call SetUnitPathing(targetUnit, false)
	if O0X(targetUnit)== false then
		call UnitAddPermanentAbility(targetUnit,'Amrf')
		call UnitRemoveAbility(targetUnit,'Amrf')
	endif
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function DDR))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))
	call SaveInteger(HY, h, 5,(level))
	call UnitDamageTargetEx(WUE, targetUnit, 1, 30 + 30 * level)
	set t = null
	set WUE = null
	set targetUnit = null
endfunction
function DHR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local integer level = LoadInteger(HY, h, 5)
	local group g = LoginGroup(122)
	local ubersplat N4O = CreateUbersplat(x, y, "THNN", 255, 255, 255, 255, false, false)
	call SetUbersplatRenderAlways(N4O, true)
	call A8X(GetOwningPlayer(triggerUnit), 4, x, y, 400)
	call DestroyEffect(LoadEffectHandle(HY, h, 175))
	call DestroyEffect(LoadEffectHandle(HY, h, 176))
	call DestroyEffect(LoadEffectHandle(HY, h,$B1))
	call DestroyEffect(LoadEffectHandle(HY, h,$B2))
	call DestroyEffect(LoadEffectHandle(HY, h,$B3))
	call DestroyEffect(LoadEffectHandle(HY, h,$B4))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl", x, y))
	call DestroyEffect(AddSpecialEffect("effects\\TidalErruption.mdx", x, y))
	set U2 = triggerUnit
	set Q2 = level
	call GroupEnumUnitsInRange(g, x, y,$E1+ 25, Condition(function DPX))
	call ForGroup(g, function DGR)
	call LogoutGroup(g)
	set t = null
	set triggerUnit = null
	set g = null
	set N4O = null
	return false
endfunction
function YWV takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(triggerUnit,'A136')
	local string s = ""
	local real a
	local real r
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(triggerUnit)) or IsObserver then
		set s = "Objects\\Spawnmodels\\Other\\IllidanFootprint\\IllidanWaterSpawnFootPrint.mdl"
	endif
	call SaveInteger(HY, h, 5, level)
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	call SaveReal(HY, h, 6, x * 1.)
	call SaveReal(HY, h, 7, y * 1.)
	call SaveInteger(HY, h, 5, level)
	set r = 60 * bj_DEGTORAD
	set a = 0
	call SaveEffectHandle(HY, h, 175, AddSpecialEffect(s, x + 40 * Cos(a / r), y + 40 * Sin(a / r)))
	set a = 1
	call SaveEffectHandle(HY, h, 176, AddSpecialEffect(s, x + 40 * Cos(a / r), y + 40 * Sin(a / r)))
	set a = 2
	call SaveEffectHandle(HY, h,$B1, AddSpecialEffect(s, x + 40 * Cos(a / r), y + 40 * Sin(a / r)))
	set a = 3
	call SaveEffectHandle(HY, h,$B2, AddSpecialEffect(s, x + 40 * Cos(a / r), y + 40 * Sin(a / r)))
	set a = 4
	call SaveEffectHandle(HY, h,$B3, AddSpecialEffect(s, x + 40 * Cos(a / r), y + 40 * Sin(a / r)))
	set a = 5
	call SaveEffectHandle(HY, h,$B4, AddSpecialEffect(s, x + 40 * Cos(a / r), y + 40 * Sin(a / r)))
	call TriggerRegisterTimerEvent(t, 2.0, false)
	call TriggerAddCondition(t, Condition(function DHR))
	set triggerUnit = null
	set t = null
endfunction

// 幻象的受伤害系数 很憨批的穷举 等模拟分身后再改
function GetIllusionUnitData takes unit d returns real
	//小娜迦幻象 鬼影重重 混沌之军 魔法镜像 崩裂禁锢 幻影斧 灵魂之矛 神行百变 并列
	if GetUnitAbilityLevel(d,'B0DA') > 0 then
		return 1.5
	elseif GetUnitAbilityLevel(d,'B06L') > 0 or GetUnitAbilityLevel(d,'B012') > 0 then
		return 2.
	elseif GetUnitAbilityLevel(d,'BO30') > 0 or GetUnitAbilityLevel(d,'BIil') > 0 or GetUnitAbilityLevel(d,'B0EB') > 0 or GetUnitAbilityLevel(d,'B07Z') > 0 then
		return 3.
	elseif GetUnitAbilityLevel(d,'BO35') > 0 then
		return 3.5
	elseif GetUnitAbilityLevel(d,'B40D') > 0 or GetUnitAbilityLevel(d,'B098') > 0 or GetUnitAbilityLevel(d,'BO40') > 0 then
		return 4.
	elseif GetUnitAbilityLevel(d,'BO50') > 0 then
		return 5.
	elseif GetUnitAbilityLevel(d,'B46G') > 0 or GetUnitAbilityLevel(d,'BO60') > 0 then
		return 6.
	endif
	return .0
endfunction

// 2022/1/12 A13T 和 A522 数据互换 不必使用魔法护盾来实现技能cd 重生已经可以
function Fix_Tidebringer_Add takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local integer level = LoadInteger(HY, h, 1)
	local integer iUnitHandleId = GetHandleId(whichUnit)
	if UnitAlive(whichUnit) then
		call LodSystem_AddUnitExtraState(whichUnit, 15 * level + 5, STATE_SYSTEM_DAMAGE)
		//call UnitAddPermanentAbility(whichUnit,'A147')
		//call SetUnitAbilityLevel(whichUnit,'A146', level)
		//call UnitMakeAbilityPermanent(whichUnit, true,'A146')

		// debug call SingleDebug( "存活，可再加技能" )
		call SaveBoolean(ExtraHT, iUnitHandleId, HTKEY_SKILL_TIDEBRINGER, true)
		call SaveEffectHandle(ExtraHT, iUnitHandleId, HTKEY_SKILL_TIDEBRINGER, AddSpecialEffectTarget("effects\\WaterHands.mdx", whichUnit, T2V(whichUnit)))
		call CleanCurrentTrigger(t)
		call FlushChildHashtable(HY, h)
	endif
	set t = null
	set whichUnit = null
	return false
endfunction
// 添加潮汐使者效果
function Tidebringer_Add takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local trigger trig = null
	local unit whichUnit = LoadUnitHandle(HY, GetHandleId(t), 0)
	local integer level = GetUnitAbilityLevel(whichUnit,'A13T')
	local integer iHandleId = GetHandleId(whichUnit)
	if not UnitAlive(whichUnit) then
		set trig = CreateTrigger()
		call TriggerRegisterTimerEvent(trig, 1, true)
		call TriggerAddCondition(trig, Condition(function Fix_Tidebringer_Add))
		call SaveUnitHandle(HY, GetHandleId(trig), 0, whichUnit)
		call SaveInteger(HY, GetHandleId(trig), 1, level)
		set trig = null
	else
		call LodSystem_AddUnitExtraState(whichUnit, 15 * level + 5, STATE_SYSTEM_DAMAGE)
		//call UnitAddPermanentAbility(whichUnit,'A147')
		//call SetUnitAbilityLevel(whichUnit,'A146', level)
		//call UnitMakeAbilityPermanent(whichUnit, true,'A146')
		set iHandleId = GetHandleId(whichUnit)
		call SaveBoolean(ExtraHT, iHandleId, HTKEY_SKILL_TIDEBRINGER, true)
		call SaveEffectHandle(ExtraHT, iHandleId, HTKEY_SKILL_TIDEBRINGER, AddSpecialEffectTarget("effects\\WaterHands.mdx", whichUnit, T2V(whichUnit)))
	endif
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set whichUnit = null
endfunction

function Tidebringer_Ranged takes unit sourceUnit, unit targetUnit, real attackDmg, integer level returns nothing
	local real x1 = GetUnitX(sourceUnit)
	local real y1 = GetUnitY(sourceUnit)
	local real range = 525 + 100 *(level / 4)
	local real radian = GetUnitFacing(sourceUnit) * bj_DEGTORAD
	local real x2 = x1 + range * Cos(radian)
	local real y2 = y1 + range * Sin(radian)
	local real targetUnitArmor = GetUnitState(targetUnit, UNIT_STATE_ARMOR)
	local real reduceRatio = 1
	local unit firstUnit = null
	// 逆推税前伤害
	if IsFortDefenseTypeUnit(targetUnit) then
		set attackDmg = attackDmg * 2
	endif
	if targetUnitArmor >= 0 then
		set reduceRatio = 0.06 * targetUnitArmor / (0.06 * targetUnitArmor + 1)
		set reduceRatio = 1 - reduceRatio
	elseif targetUnitArmor < 0 then
		set reduceRatio = 2 - Pow(1 -0.06, -targetUnitArmor)
	endif
	set attackDmg = attackDmg / reduceRatio
	if IsUnitIllusion(targetUnit) then
		set attackDmg = attackDmg / GetIllusionUnitData(targetUnit)
	endif
	if Mode__RearmCombos then
		set Temp__ArrayReal[0]= attackDmg
	else
		set Temp__ArrayReal[0]= attackDmg * .8
	endif
	set Temp__ArrayUnit[0]= sourceUnit
	set Temp__ArrayUnit[1]= targetUnit
	set Temp__Player = GetOwningPlayer(sourceUnit)
	call GroupEnumUnitsInRange( AK, x2, y2, range, null )
	call GroupRemoveUnit( AK, targetUnit ) // 移除攻击目标 防止造成第二次伤害
	loop
		set firstUnit = FirstOfGroup(AK)
	exitwhen firstUnit == null
		call GroupRemoveUnit(AK, firstUnit)
		// 敌对 非守卫 非建筑 存活
		if IsUnitEnemy(firstUnit, Temp__Player) and GetUnitAbilityLevel(firstUnit,'A04R')== 0 and not IsUnitType(firstUnit, UNIT_TYPE_STRUCTURE) and UnitAlive(firstUnit) then
			call UnitDamageTargetEx(Temp__ArrayUnit[0], firstUnit, 2, Temp__ArrayReal[0])
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\WaterElementalMissile\\WaterElementalMissile.mdl", firstUnit, "chest"))
		endif
	endloop
	set firstUnit = null
endfunction

function IsUnitTidebringerAvailable takes unit whichUnit returns boolean
	return (YDWEGetUnitAbilityState(whichUnit, 'A522', 1) == 0)
endfunction

function Tidebringer_Actions takes unit sourceUnit, unit targetUnit, real attackDmg returns nothing
	local integer iHandleId = GetHandleId(sourceUnit)
	local integer level = GetUnitAbilityLevel(sourceUnit,'A522')
	local real cool = 16 - 3 * level
	local integer timerHandleId
	if GetUnitAbilityLevel(sourceUnit, 'A39S') == 1 then
		set cool = cool * 0.75
	endif
	set timerHandleId = TimerStartSingle( cool, function Tidebringer_Add)
	call SaveUnitHandle(HY, timerHandleId, 0, sourceUnit)
	// 移除潮汐使者效果
	call SaveBoolean(ExtraHT, iHandleId, HTKEY_SKILL_TIDEBRINGER, false)
	call DestroyTimerAndFlushHT_P(LoadTimerHandle(ExtraHT, iHandleId, HTKEY_SKILL_TIDEBRINGER))
	call DestroyEffect(LoadEffectHandle(ExtraHT, iHandleId, HTKEY_SKILL_TIDEBRINGER))
	call RemoveSavedHandle(ExtraHT, iHandleId, HTKEY_SKILL_TIDEBRINGER)

	call LodSystem_ReduceUnitExtraState(sourceUnit, level * 15+ 5, STATE_SYSTEM_DAMAGE)
	//call UnitRemoveAbility(sourceUnit,'A147')
	call YDWESetUnitAbilityState(sourceUnit,'A522', 1, cool)
endfunction

function LearnSkill__Tidebringer takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer h = GetHandleId(u)
	local boolean isDestroyEffect = GetUnitAbilityLevel(u,'A36D')== 1 // 破坏效果
	// 如果有水刀 而且不是禁用技能状态 + 15 攻击力
	if LoadBoolean(ExtraHT, h, HTKEY_SKILL_TIDEBRINGER) and not isDestroyEffect then
		call LodSystem_AddUnitExtraState(u, 15, STATE_SYSTEM_DAMAGE)
	elseif GetUnitAbilityLevel(u,'A13T')== 1 then
		// 第一次学习
		set HaveTidebringer = true
		call Learn_HaveCoolDownSkill()
		if not isDestroyEffect then
			call LodSystem_AddUnitExtraState(u, 15 + 5, STATE_SYSTEM_DAMAGE)
			call SaveEffectHandle(ExtraHT, h, HTKEY_SKILL_TIDEBRINGER, AddSpecialEffectTarget("effects\\WaterHands.mdx", u, T2V(u)))
		endif
		call SaveBoolean(ExtraHT, h, HTKEY_SKILL_TIDEBRINGER, true)
		if not isDestroyEffect then
			if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then // 如果是近战 就加分裂技能
				//call UnitAddPermanentAbility(u,'A147')
				//call UnitMakeAbilityPermanent(u, true,'A146')
			endif
		endif
	endif
	//call SetUnitAbilityLevel(u,'A146', GetUnitAbilityLevel(u,'A13T'))
	set u = null
	set u = null
endfunction

//玩家是否选择了此技能
function PlayerHaveAbilityByActive takes player p, integer abid returns boolean
	local integer i = 1
	local integer maxi = 4 + ExtraAbilitiesNum  
	local integer pid = GetPlayerId(p)
	loop
		if HeroCommonSkills[PlayerSkillIndex[pid * HL + i]] == abid then
			return true
		endif
		set i = i + 1
	exitwhen i > maxi
	endloop
	return false
endfunction

//对切换型技能的筛选,防止拉比克大和技能导致的冲突
//先判断是否窃取的技能,再判断玩家是否选择了此技能
function Rubick_AbilityFilter takes unit u, integer abid returns boolean
	local integer h = GetHandleId(u)
	local integer pid = GetPlayerId(GetOwningPlayer(u))
	if LoadInteger(HY, h, 704) == 0 or LoadInteger(HY, h, 704) == abid then
		return true
	endif
	return PlayerHaveAbilityByActive(GetOwningPlayer(u), abid)
endfunction

function DWR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit target = LoadUnitHandle(HY, h, 30)
	local image i = LoadImageHandle(HY, h,$B9)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local unit u = LoadUnitHandle(HY, h, 2)
	if GetTriggerEventId()!= EVENT_UNIT_SPELL_EFFECT or(GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A13D') then
		if GetTriggerEventId()!= EVENT_WIDGET_DEATH and(not IsMagicImmuneUnit(target) or IsUnitAlly(target, GetOwningPlayer(u))) then
			if not IsUnitInvulnerable(target) then
			//	call SetUnitX(target, x)
			//	call SetUnitY(target, y)
			//else
				call SetUnitPosition(target, x, y)
			endif
		endif
		call S9E(GetOwningPlayer(u),'A13D', false)
		if Rubick_AbilityFilter(u, 'A11N') then
			call S9E(GetOwningPlayer(u),'A11N', true)
		endif
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call ShowImage(i, false)
		call DestroyImage(i)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set target = null
	set i = null
	set u = null
	return false
endfunction
function DYR takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit target = GetSpellTargetUnit()
	local real x = GetUnitX(target)
	local real y = GetUnitY(target)
	local real WBO = 90
	local image i = CreateImage("Fonts\\X.blp", WBO, WBO, 0, x -WBO / 2, y -WBO / 2, 0, 0, 0, 0, 2)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local string fx = ""
	//local integer level = GetUnitAbilityLevel(u,'A11N')
	local real dur = 4.
	if IsPlayerAlly(GetOwningPlayer(u), GetOwningPlayer(target)) then
		set dur = dur * 2
	endif
	call EPX(target, 4401, 5)
	call UnitAddPermanentAbility(u,'A13D')
	call S9E(GetOwningPlayer(u),'A13D', true)
	call S9E(GetOwningPlayer(u),'A11N', false)
	call SetImageRenderAlways(i, true)
	if IsUnitAlly(u, GetOwningPlayer(target))== false or IsUnitAlly(target, LocalPlayer) or IsObserver then
		set fx = "effects\\BlackTide.mdx"
		call ShowImage(i, true)
	else
		call ShowImage(i, false)
	endif
	call SetImageColor(i, 255, 0, 0, 255)
	call UnitApplyTimedLife(CreateUnit(GetOwningPlayer(u),'o00G', x, y, 0),'BTLF', 5)
	call TriggerRegisterTimerEvent(t, dur, false)
	call TriggerRegisterDeathEvent(t, target)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function DWR))
	call SaveImageHandle(HY, h,$B9, i)
	call SaveUnitHandle(HY, h, 30,(target))
	call SaveReal(HY, h, 6, x * 1.)
	call SaveReal(HY, h, 7, y * 1.)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget(fx, target, "overhead"))
	call SaveUnitHandle(HY, h, 2, u)
	set u = null
	set target = null
	set i = null
	set t = null
endfunction
function PZE takes nothing returns nothing
	call S9E(GetOwningPlayer(GetTriggerUnit()),'A13D', false)
	call UnitAddPermanentAbility(GetTriggerUnit(),'A13D')
endfunction
function D5E takes nothing returns nothing
	if IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) or not UnitHasSpellShield(GetSpellTargetUnit()) then
		call DYR()
	endif
endfunction
function KOE takes nothing returns nothing
	if(LoadBoolean(HY,(GetHandleId(GetOwningPlayer(GetSpellTargetUnit()))),$8B)) and IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n038'))
	elseif IsMagicImmuneUnit(GetSpellTargetUnit()) and IsUnitEnemy(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "无法作用于魔免的敌人")
	endif
endfunction
function DZR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer BOX = 1
	local player p
	local real d
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer D_R = LoadInteger(HY, h,$88)
	local integer N5O = LoadInteger(HY, h,$BC)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or GetTriggerEvalCount(t)> N5O then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		loop
		exitwhen BOX > D_R
			set p = LoadPlayerHandle(HY, h,$514+ BOX)
			set d = LoadReal(HY, h, 1200+ BOX)
			if p == null then
				set BOX = D_R
			else
				call SetWidgetLife(targetUnit, RMaxBJ(1, GetWidgetLife(targetUnit)-d / N5O))
			endif
			set BOX = BOX + 1
		endloop
	endif
	set t = null
	set p = null
	set targetUnit = null
	return false
endfunction
function D0R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local player p = LoadPlayerHandle(HY, h, 54)
	local trigger D1R = LoadTriggerHandle(HY, h,$87)
	local integer BOX = GetTriggerEvalCount(t)
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call TriggerRegisterTimerEvent(D1R, 1, true)
		call TriggerAddCondition(D1R, Condition(function DZR))
		call UnitRemoveAbility(targetUnit,'B09U')
	elseif FK then
		set h = GetHandleId(D1R)
		call SavePlayerHandle(HY, h,$514+ BOX, GetOwningPlayer(GetEventDamageSource()))
		call SaveReal(HY, h, 1200+ BOX, .5 * GetEventDamage()* 1.)
		call SaveInteger(HY, h,$88, BOX)
	endif
	set t = null
	set targetUnit = null
	set p = null
	set D1R = null
	return false
endfunction
function D2R takes nothing returns nothing
	local unit WUE = HDV
	local unit targetUnit = GetEnumUnit()
	local integer level = HFV
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer N5O =$A
	local trigger D1R = CreateTrigger()
	call AddAbilityToTimed(targetUnit,'A12D', 1, N5O,'B09U')
	call TriggerRegisterTimerEvent(t, N5O + .01, false)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function D0R))
	call SavePlayerHandle(HY, h, 54,(GetOwningPlayer(WUE)))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveTriggerHandle(HY, h,$87,(D1R))
	call SaveUnitHandle(HY,(GetHandleId(D1R)), 17,(targetUnit))
	call SaveInteger(HY,(GetHandleId(D1R)),$BC,(N5O))
	set WUE = null
	set targetUnit = null
	set t = null
	set D1R = null
endfunction
function D3R takes nothing returns boolean
	if(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit()))== false and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit())) and IsUnitInGroup(GetFilterUnit(), HCV)== false then
		call GroupAddUnit(HCV, GetFilterUnit())
		return true
	endif
	return false
endfunction
function D4R takes nothing returns nothing
	local unit WUE = HDV
	local unit targetUnit = GetEnumUnit()
	local integer level = HFV
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddPermanentAbility(dummyUnit,'A13X')
	call IssueTargetOrderById(dummyUnit, 852095, targetUnit)
	call UnitDamageTargetEx(WUE, targetUnit, 1, 300 + 100 * level)
	set WUE = null
	set targetUnit = null
	set dummyUnit = null
endfunction

function YOI1 takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) or IsUnitIllusion(GetFilterUnit()) ) and DCX() 
endfunction

function D5R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit NIX =(LoadUnitHandle(HY, h, 45))
	local unit D6R
	local real a =(LoadReal(HY, h, 13))
	local real WYE = GetUnitX(NIX)
	local real WZE = GetUnitY(NIX)
	local real W_E =(LoadReal(HY, h, 66))
	local real W0E =(LoadReal(HY, h, 67))
	local integer EVX = GetTriggerEvalCount(t)
	local real NBX = CoordinateX50(W_E + 13.33 * EVX * Cos(a))
	local real NCX = CoordinateY50(W0E + 13.33 * EVX * Sin(a))
	local integer lv =(LoadInteger(HY, h, 5))
	local group D7R =(LoadGroupHandle(HY, h, 187))
	local group g
	local group g2
	local unit u
	local boolean b = LoadBoolean(HY, h, 5)
	local integer TYIPP = LoadInteger(HY, h, 6)
	if not b then
		if EVX < 19 then
			call SetUnitVertexColor(NIX, 255, 255, 255, 5 + EVX * 10)
			set D6R =(LoadUnitHandle(HY, h,$BA))
			call SetUnitVertexColor(D6R, 255, 255, 255, 5 + EVX * 10)
		elseif EVX < 125 then
			call SetUnitVertexColor(NIX, 255, 255, 255,$BE)
		endif
	else
		if EVX < 10 then
			call SetUnitVertexColor(NIX, 255, 255, 255, 5 + EVX * 20)
			call SetUnitVertexColor(LoadUnitHandle(HY, h, 186), 255, 255, 255, 5 + EVX * 20)
		elseif EVX < 62 then
			call SetUnitVertexColor(NIX, 255, 255, 255, 190)
		endif
	endif
	set g = LoginGroup(123)
	set HCV = D7R
	set U2 = NIX
	set HDV = NIX
	set HFV = lv
	call GroupEnumUnitsInRange(g, GetUnitX(NIX), GetUnitY(NIX), 425, Condition(function D3R))
	call ForGroup(g, function D2R)
	call LogoutGroup(g)
	call SetUnitX(NIX, NBX)
	call SetUnitY(NIX, NCX)
	if b then
		set g2 = LoginGroup(124)
		set TYIPP = 70
		call GroupEnumUnitsInRange(g2, NBX, NCX, 225, Condition(function YOI1))
		loop
			set u = FirstOfGroup(g2)
		exitwhen u == null
			call SetUnitX(u, NBX)
			call SetUnitY(u, NCX)
			call GroupRemoveUnit(g2, u)
		endloop
		call LogoutGroup(g2)
		if ModuloInteger(EVX, 10) == 1 then
			call KillDestructablesInCircle(NBX, NCX, 325)
		endif
	else
		set TYIPP = 140
	endif
	if EVX == TYIPP then
		set D6R =(LoadUnitHandle(HY, h,$BA))
		call KillUnit(D6R)
	elseif EVX < TYIPP then
		set D6R =(LoadUnitHandle(HY, h,$BA))
		call SetUnitX(D6R, NBX)
		call SetUnitY(D6R, NCX)
	endif
	if EVX == LoadInteger(HY, h, 6) then
		set g = LoginGroup(125)
		set U2 = NIX
		call GroupEnumUnitsInRange(g, NBX, NCX, 450, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call ForGroup(g, function D4R)
		call LogoutGroup(g)
		call KillUnit(NIX)
		call LogoutGroup(D7R)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set NIX = null
	set D6R = null
	set D7R = null
	set g = null
	set g2 = null
	set u = null
	return false
endfunction
function YYV takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real WYE = GetUnitX(u)
	local real WZE = GetUnitY(u)
	local real x0 = GetSpellTargetX()
	local real y0 = GetSpellTargetY()
	local real a
	local real x1
	local real y1
	local real x2
	local real y2
	local trigger t
	local integer h
	local integer lv
	local unit NIX
	local unit D6R
	local string s = ""
	local integer D8R ='h06U'
	local boolean b = GetSpellAbilityId()=='Z31K'
	local integer c = 150
	if GetRandomInt(0, 5)== 0 then
		set D8R ='h0DJ'
	endif
	if IsPlayerAlly(GetOwningPlayer(u), LocalPlayer) or IsObserver then
		set s = "war3mapImported\\Whirlpool.mdx"
	endif
	if x0 == GetUnitX(u) and y0 == GetUnitY(u) then
		set x0 = x0 + 50 * Cos(GetUnitFacing(u)* bj_DEGTORAD)
		set y0 = y0 + 50 * Sin(GetUnitFacing(u)* bj_DEGTORAD)
	endif
	set a = Atan2(y0 -WZE, x0 -WYE)
	if b then
		set x1 = WYE
		set y1 = WZE
		set c = c / 2
	else
		set x1 = WYE -1000 * Cos(a)
		set y1 = WZE -1000 * Sin(a)
	endif
	set x2 = WYE +1000* Cos(a)
	set y2 = WZE +1000* Sin(a)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	set lv = GetUnitAbilityLevel(u,'A11K')+ GetUnitAbilityLevel(u,'Z31K')
	set NIX = CreateUnit(GetOwningPlayer(u), D8R, x1, y1, Atan2(y0 -WZE, x0 -WYE)* bj_RADTODEG)
	set D6R = CreateUnit(GetOwningPlayer(u),'h06V', x1, y1, Atan2(y0 -WZE, x0 -WYE)* bj_RADTODEG)
	call SetUnitVertexColor(NIX, 255, 255, 255, 0)
	call SetUnitPathing(NIX, false)
	call SaveInteger(HY, h, 5,(lv))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveUnitHandle(HY, h, 45,(NIX))
	call SaveUnitHandle(HY, h,$BA,(D6R))
	call SaveReal(HY, h, 66,((x1)* 1.))
	call SaveReal(HY, h, 67,((y1)* 1.))
	call SaveGroupHandle(HY, h, 187,(LoginGroup(126)))
	call SaveBoolean(HY, h, 5, b)
	call SaveInteger(HY, h, 6, c)
	call DestroyEffect(AddSpecialEffect(s, CoordinateX50(x2), CoordinateY50(y2)))
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function D5R))
	set u = null
	set t = null
	set NIX = null
	set D6R = null
endfunction
function PQX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A11L')
endfunction
function D9R takes nothing returns boolean
	local unit t = GetFilterUnit()
	if IsUnitEnemy(Temp__ArrayUnit[0], GetOwningPlayer(t)) and IsAliveNotStrucNotWard(t) then
		if Temp__ArrayReal[4]== 1 and GetUnitAbilityLevel(t,'A3E9')== 1 and IsMagicImmuneUnit(Temp__ArrayUnit[1])== false then
			call SaveInteger(VV,'A3E9','0lvl', R2I(Temp__ArrayReal[2]))
			call SaveUnitHandle(VV,'A3E9','targ', Temp__ArrayUnit[1])
			call SaveUnitHandle(VV,'A3E9','cstr', t)
			call SaveReal(VV,'A3E9','0dur', Temp__ArrayReal[3])
			call ExecuteFunc("FVR")
		endif
		if UnitHasSpellShield(t)== false then
			call UnitDamageTargetEx(Temp__ArrayUnit[0], t, 2, Temp__ArrayReal[0])
			call CommonUnitAddStun(t, Temp__ArrayReal[1], false)
		else
			call AJO(t)
		endif
	endif
	set t = null
	return false
endfunction
function FER takes unit u, real WLV, real x, real y, boolean b, integer WUV, boolean FXR returns nothing
	set Temp__ArrayReal[3]= WLV
	set WLV = WLV / 5.
	set Temp__ArrayReal[0]=(60 + 70 * WUV)* WLV
	set Temp__ArrayReal[1]=(1 + .75 * WUV)* WLV
	set Temp__ArrayReal[2]= WUV
	set Temp__ArrayReal[4]= 0
	set Temp__ArrayUnit[0]= I_X(u)
	set Temp__ArrayUnit[1]= u
	if FXR then
		set Temp__ArrayReal[4]= 1
	endif
	call GroupEnumUnitsInRange(AK, x, y, 200, Condition(function D9R))
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\DemolisherFireMissile\\DemolisherFireMissile.mdl", x, y))
	if b then
		call UnitDamageTargetEx(Temp__ArrayUnit[0], u, 2, Temp__ArrayReal[0])
		call CommonUnitAddStun(u, Temp__ArrayReal[1], false)
	endif
endfunction
function FOR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local unit NIX = LoadUnitHandle(HY, h, 45)
	local real SAX = LoadReal(HY, h, 444)
	local real a = AngleBetweenXY(GetUnitX(NIX), GetUnitY(NIX), GetUnitX(targetUnit), GetUnitY(targetUnit))
	local real x = GetUnitX(NIX)+ 18 * Cos(a * bj_DEGTORAD)
	local real y = GetUnitY(NIX)+ 18 * Sin(a * bj_DEGTORAD)
	local integer level = LoadInteger(HY, h, 0)
	call SetUnitX(NIX, x)
	call SetUnitY(NIX, y)
	if GetDistanceBetween(x, y, GetUnitX(targetUnit), GetUnitY(targetUnit))<= 18 or(GetUnitX(targetUnit)== 0 and GetUnitY(targetUnit)== 0) then
		call KillUnit(NIX)
		call FER(WUE, SAX, x, y, false, level, LoadBoolean(HY, h, 0))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set NIX = null
	return false
endfunction
function FRR takes unit Q4X, unit to, real FIR, integer level, boolean FAR returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit NIX = CreateUnit(GetOwningPlayer(Q4X),'h0BD', GetUnitX(Q4X), GetUnitY(Q4X), GetUnitFacing(Q4X))
	call SaveUnitHandle(HY, h, 2, Q4X)
	call SaveUnitHandle(HY, h, 17, to)
	call SaveUnitHandle(HY, h, 45, NIX)
	call SaveReal(HY, h, 444, FIR * 1.)
	call SaveInteger(HY, h, 0, level)
	call SaveBoolean(HY, h, 0, FAR)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function FOR))
	set NIX = null
	set t = null
endfunction
function FVR takes nothing returns nothing
	local unit WJE = LoadUnitHandle(VV,'A3E9','cstr')
	local unit WLE = LoadUnitHandle(VV,'A3E9','targ')
	local real FNR = LoadReal(VV,'A3E9','0dur')
	local integer level = LoadInteger(VV,'A3E9','0lvl')
	call FRR(WJE, WLE, FNR, level, true)
	call T4V(WJE)
	call FlushChildHashtable(VV,'A3E9')
	set WJE = null
	set WLE = null
endfunction
function FBR takes string s, unit targetUnit, unit triggerUnit returns nothing
	local texttag tt = CreateTextTag()
	call SetTextTagPosUnit(tt, targetUnit, 64)
	call SetTextTagColor(tt, 255, 0, 0, 255)
	call SetTextTagVelocity(tt, 0, .0355)
	call SetTextTagFadepoint(tt, .15)
	call SetTextTagPermanent(tt, false)
	call SetTextTagLifespan(tt, .65)
	if(IsUnitAlly(triggerUnit, LocalPlayer) or IsObserver)== false then
		set s = ""
	endif
	call SetTextTagText(tt, s, .033)
	call SetTextTagVisibility(tt, true)
	set tt = null
endfunction
function FCR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local real FDR = LoadReal(HY, h, 442)
	local real KGX = GetGameTime()
	local real Y2X = 5. -(KGX -FDR)
	local real JJO = RMinBJ(KGX -FDR, 5.)
	local integer EVX = LoadInteger(HY, h, 34)+ 1
	local integer i
	local string s
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		if Rubick_AbilityFilter(WUE , 'A1NI') then
			call S9E(GetOwningPlayer(WUE),'A1NI', true)
		endif
		call S9E(GetOwningPlayer(WUE),'A1NH', false)
		call ResetUnitVertexColor(WUE)
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT then
		if GetSpellAbilityId()=='A1NH' then
			call FRR(WUE, GetSpellTargetUnit(), JJO, level, false)
			if Rubick_AbilityFilter(WUE , 'A1NI') then
				call S9E(GetOwningPlayer(WUE),'A1NI', true)
			endif
			call S9E(GetOwningPlayer(WUE),'A1NH', false)
			call ResetUnitVertexColor(WUE)
			call DestroyEffect(LoadEffectHandle(HY, h, 32))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	else
		call SaveInteger(HY, h, 34, EVX)
		if Y2X >= 0 then
			set i = R2I(Y2X)
			set s = I2S(i)
			if Y2X -i >= .5 then
				set s = s + ".5"
			else
				set s = s + ".0"
			endif
			set i = ModuloInteger(EVX, 2)* 75
			call FBR(s, WUE, WUE)
			call SetUnitVertexColorEx(WUE, 255, 100 + i, 100 + i,-1)
		else
			call SetUnitVertexColorEx(WUE, 255, 0, 0,-1)
		endif
		if KGX -FDR >(5. + .5) then
			call FER(WUE, 5., GetWidgetX(WUE), GetWidgetY(WUE), true, level, true)
			if Rubick_AbilityFilter(WUE , 'A1NI') then
				call S9E(GetOwningPlayer(WUE),'A1NI', true)
			endif
			call S9E(GetOwningPlayer(WUE),'A1NH', false)
			call ResetUnitVertexColor(WUE)
			call DestroyEffect(LoadEffectHandle(HY, h, 32))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set WUE = null
	return false
endfunction
function YZV takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local string s = "war3mapImported\\UnstableConcoctionRangeDisplay3.mdx"
	if LocalPlayer!= GetOwningPlayer(WUE) then
		set s = ""
	endif
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveReal(HY, h, 442, GetGameTime())
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(WUE,'A1NI'))
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget(s, WUE, "origin"))
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerAddCondition(t, Condition(function FCR))
	call S9E(GetOwningPlayer(WUE),'A1NI', false)
	call S9E(GetOwningPlayer(WUE),'A1NH', true)
	call UnitAddPermanentAbility(WUE,'A1NH')
	call TriggerEvaluate(t)
	set WUE = null
	set t = null
endfunction
function FFR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer DSR = LoadInteger(P, h, 0)
	call SaveInteger(P, DSR,'A0O3', LoadInteger(P, DSR,'A0O3')-LoadInteger(P, h, 1))
	call DestroyTimerAndFlushHT_P(t)
	set t = null
endfunction
function FGR takes unit u, unit d, player p, integer WUV returns nothing
	local timer t = CreateTimer()
	local texttag FHR
	local integer h = GetHandleId(t)
	local integer hu = GetHandleId(u)
	local integer Y_E = LoadInteger(P, hu,'A0O3')+ WUV * 2 + 2
	local boolean b = IsUnitType(d, UNIT_TYPE_HERO)
	if Y_E > (8 * WUV) then
		set Y_E = 8 * WUV
	endif
	if b then
		set FHR = CreateTextTag()
		set Y_E = AddPlayerResourceGold(p, Y_E)
		call SetTextTagText(FHR, "+" + I2S(Y_E), .025)
		call SetTextTagPosUnit(FHR, d, .3)
		call SetTextTagColor(FHR, 255,$DC, 0, 255)
		call SetTextTagVelocity(FHR, 0, .05)
		call SetTextTagVisibility(FHR, LocalPlayer== p)
		call SetTextTagFadepoint(FHR, 2)
		call SetTextTagLifespan(FHR, 3)
		call SetTextTagPermanent(FHR, false)
		set FHR = null
	endif
	call SaveInteger(P, hu,'A0O3', 2 + LoadInteger(P, hu,'A0O3'))
	call SaveInteger(P, h, 0, hu)
	call SaveInteger(P, h, 1, 2)
	call TimerStart(t, 25, false, function FFR)
	set hu = GetHandleId(p)
	call SaveInteger(P, hu,'A0O3', LoadInteger(P, hu,'A0O3')+ Y_E)
	set t = null
	set FHR = null
endfunction
function FJR takes unit u, unit t returns nothing
	local player p = GetOwningPlayer(u)
	local integer WUV
	if GetUnitAbilityLevel(u,'Aloc')== 1 then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
	set WUV = GetUnitAbilityLevel(u,'P155')
	if GetUnitAbilityLevel(u,'A36D')!= 0 then
		set WUV = 0
	endif
	if WUV > 0 and IsUnitEnemy(t, p) and IsUnitType(t, UNIT_TYPE_STRUCTURE)== false and IsUnitIllusion(t)== false and(GetUnitAbilityLevel(t,'A04R')== 0) then
		call FGR(u, t, p, WUV)
	endif
endfunction
function FKR takes nothing returns nothing
	local integer ETX
	local integer WFV
	local unit t = GetFilterUnit()
	if UnitAlive(t) and IsUnitEnemy(t, Temp__Player) and GetUnitAbilityLevel(t,'A04R')== 0 and IsUnitType(t, UNIT_TYPE_STRUCTURE)== false and GetUnitTypeId(t)!='n0F5' then
		call GroupAddUnit(BK, t)
		call UnitDamageTargetEx(Temp__ArrayUnit[0], t, 2, XK[0])
		if IsUnitInGroup(t, IK)== false then
			set WFV = GetHandleId(t)
			set ETX = StringHash("acidspray_count")
			call LodSystem_ReduceUnitExtraState(t, XK[1], STATE_SYSTEM_ARMOUR)
			call SaveInteger(P, GetHandleId(t), StringHash("acidspray"), LoadInteger(P, GetHandleId(t), StringHash("acidspray")+ XK[1]))
			call WJV(t,'C014','D014',-1)
			call SaveInteger(P, WFV, ETX, LoadInteger(P, WFV, ETX)+ 1)
			set t = null
			return
		endif
		call GroupRemoveUnit(IK, t)
	endif
	set t = null
endfunction
function FLR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(P, h, 2)
	if E8X(u)== false then
		call WHV(u,'D014')
		call LodSystem_AddUnitExtraState(u, LoadInteger(P, h, 0), STATE_SYSTEM_ARMOUR)
		call DisableTrigger(t)
		call DestroyTrigger(t)
		call FlushChildHashtable(P, h)
	endif
	set u = null
	set t = null
	return false
endfunction
function FMR takes nothing returns nothing
	local unit u = null
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer ETX = StringHash("acidspray_count")
	local integer UYX = LoadInteger(P, WFV, 0)
	local trigger tt
	local integer h
	set XK[1]= LoadInteger(P, WFV, 2)
	set IK = LoadGroupHandle(P, WFV, 1)
	if UYX == 17 then
		set UYX = LoadInteger(P, WFV, 2)
		call DestroyEffect(LoadEffectHandle(P, WFV, 2))
		loop
			set u = FirstOfGroup(IK)
		exitwhen u == null
			set WFV = GetHandleId(u)
			set UYX = LoadInteger(P, WFV, ETX)
			if E8X(u)== false then
				if UYX == 1 then
					call WHV(u,'D014')
				endif
				call SaveInteger(P, GetHandleId(u), StringHash("acidspray"), IMinBJ(LoadInteger(P, GetHandleId(u), StringHash("acidspray")-XK[1]), 0))
				call LodSystem_AddUnitExtraState(u, XK[1], STATE_SYSTEM_ARMOUR)
			else
				set tt = CreateTrigger()
				call TriggerRegisterTimerEvent(tt, 1, true)
				call TriggerAddCondition(tt, Condition(function FLR))
				set h = GetHandleId(tt)
				call SaveInteger(P, h, 0, XK[1])
				call SaveUnitHandle(P, h, 2, u)
				set tt = null
			endif
			call SaveInteger(P, WFV, ETX, UYX -1)
			call GroupRemoveUnit(IK, u)
		endloop
		call LogoutGroup(IK)
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		return
	endif
	call SaveInteger(P, WFV, 0, UYX + 1)
	set Temp__Player = LoadPlayerHandle(P, WFV, 3)
	set Temp__ArrayUnit[0]= LoadUnitHandle(P, WFV, 0)
	set XK[0]= LoadInteger(P, WFV, 1)
	call GroupEnumUnitsInRange(AK, LoadReal(P, WFV, 0), LoadReal(P, WFV, 1), 650, Condition(function FKR))
	loop
		set u = FirstOfGroup(IK)
	exitwhen u == null
		set WFV = GetHandleId(u)
		set UYX = LoadInteger(P, WFV, ETX)
		if UYX == 1 then
			call WHV(u,'D014')
		endif
		call SaveInteger(P, WFV, ETX, UYX -1)
		call SaveInteger(P, WFV, StringHash("acidspray"), LoadInteger(P, WFV, StringHash("acidspray")-XK[1]))
		call LodSystem_AddUnitExtraState(u, XK[1], STATE_SYSTEM_ARMOUR)
		call GroupRemoveUnit(IK, u)
	endloop
	loop
		set u = FirstOfGroup(BK)
	exitwhen u == null
		call GroupRemoveUnit(BK, u)
		call GroupAddUnit(IK, u)
	endloop
	set u = null
	set tt = null
	set t = null
endfunction
function YOV takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local integer WUV = GetUnitAbilityLevel(u,'A0IL')
	local integer WFV = GetHandleId(t)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	call SaveUnitHandle(P, WFV, 0, u)
	call SaveGroupHandle(P, WFV, 1, LoginGroup(127))
	call SaveEffectHandle(P, WFV, 2, AddSpecialEffect("effects\\Radioactivecloud_2c.mdl", x, y))
	call SavePlayerHandle(P, WFV, 3, GetOwningPlayer(u))
	call SaveInteger(P, WFV, 0, 0)
	call SaveInteger(P, WFV, 1, WUV * 6 + 8)
	call SaveInteger(P, WFV, 2, WUV + 3)
	call SaveReal(P, WFV, 0, x)
	call SaveReal(P, WFV, 1, y)
	call TimerStart(t, 1, true, function FMR)
	set t = null
	set u = null
endfunction
function FPR takes unit triggerUnit, unit targetUnit returns nothing
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0E3')
	local real IXX =(.35 + .25 * level)*(GetUnitState(targetUnit, UNIT_STATE_MAX_MANA)-GetUnitState(targetUnit, UNIT_STATE_MANA))
	local group g = LoginGroup(128)
	local unit u2
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\DragonHawkMissile\\DragonHawkMissile.mdl", targetUnit, "chest"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SpiritOfVengeanceMissile\\SpiritOfVengeanceMissile.mdl", targetUnit, "chest"))
	call DestroyEffect(AddSpecialEffect("war3mapImported\\Enchantment.mdx", GetUnitX(targetUnit), GetUnitY(targetUnit)))
	set U2 = triggerUnit
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 500 + 25, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call UnitDamageTargetEx(triggerUnit, u2, 1, IXX)
		call GroupRemoveUnit(g, u2)
	endloop
	call PlaySoundOnUnitBJ(NC, 100, targetUnit)
	call LogoutGroup(g)
	set g = null
endfunction
function FQR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	if UnitHasSpellShield(WLE)== false then
		call FPR(LoadUnitHandle(HY, h, 0), WLE)
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set WLE = null
endfunction
function Y_V takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
	call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
	call TimerStart(t, 0, false, function FQR)
	set t = null
endfunction
function FSR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local integer EVX = GetTriggerEvalCount(t)
	local integer FTR = R2I(((.9 -0.3)/ .5)/ .03)
	local integer FUR = R2I((175 / FTR))
	local integer FWR = R2I(($FF/ FTR)* 1.75)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	if EVX > FTR then
		call SetUnitVertexColor(dummyUnit, 255, 255, 255, 0)
		call SetUnitVertexColorEx(triggerUnit,-1,-1,-1, 255)
		call ShowUnit(dummyUnit, false)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SetUnitVertexColor(dummyUnit, 255, 255, 255, 175 -FUR * EVX)
		call SetUnitX(dummyUnit, x)
		call SetUnitY(dummyUnit, y)
		call SetUnitVertexColorEx(triggerUnit,-1,-1,-1, FWR * EVX)
	endif
	set t = null
	set dummyUnit = null
	set triggerUnit = null
	return false
endfunction
function Y0V takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local unit dummyUnit =(LoadUnitHandle(HY,(GetHandleId(triggerUnit)), 293))
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x = GetUnitX(triggerUnit)
	local real y = GetUnitY(triggerUnit)
	call SetUnitX(dummyUnit, x)
	call SetUnitY(dummyUnit, y)
	call SetUnitX(triggerUnit, x)
	call SetUnitY(triggerUnit, y)
	call SetUnitVertexColorEx(triggerUnit,-1,-1,-1, 0)
	call SetUnitVertexColor(dummyUnit, 255, 255, 255, 175)
	call SetUnitTimeScale(dummyUnit, .5)
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function FSR))
	set triggerUnit = null
	set dummyUnit = null
	set t = null
endfunction
function KRE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local unit dummyUnit
	local integer h = GetHandleId(triggerUnit)
	local real a = AngleBetweenXY(GetUnitX(triggerUnit), GetUnitY(triggerUnit), GetSpellTargetX(), GetSpellTargetY())
	local real x = GetUnitX(triggerUnit)
	local real y = GetUnitY(triggerUnit)
	call SetUnitPathing(triggerUnit, false)
	call UnitAddPermanentAbility(triggerUnit,'Aeth')
	set dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'h06K', GetUnitX(triggerUnit), GetUnitY(triggerUnit), a)
	call BQX(dummyUnit, 5)
	call SetUnitPathing(dummyUnit, false)
	call UnitAddPermanentAbility(dummyUnit,'Aeth')
	call UnitAddPermanentAbility(dummyUnit,'Aloc')
	call UnitAddPermanentAbility(dummyUnit,'A04R')
	call SetUnitVertexColor(dummyUnit, 255, 255, 255, 0)
	call SetUnitX(dummyUnit, x)
	call SetUnitY(dummyUnit, y)
	call SetUnitX(triggerUnit, x)
	call SetUnitY(triggerUnit, y)
	call SetUnitAnimation(dummyUnit, "Spell Throw")
	call SetUnitPathing(triggerUnit, true)
	call UnitRemoveAbility(triggerUnit,'Aeth')
	call SaveUnitHandle(HY, h, 293,(dummyUnit))
	set triggerUnit = null
	set dummyUnit = null
endfunction
function DiffusalBladeActions takes nothing returns nothing	//净魂之刃
	if not DETargetIsMagicImmune[DEI] and GetUnitAbilityLevel(DESourceUnit[DEI],'Afbt')> 0 and GetUnitState(DETargetUnit[DEI], UNIT_STATE_MANA)> 0 then
		if DESourceIsMelee[DEI] then
			if DESourceIsIllusion[DEI] then
				call ManaDamge(12)	//近战幻象12点
			else
				call ManaDamge(25)	//近战25点
			endif
		else
			if DESourceIsIllusion[DEI] then
				call ManaDamge(12)	//远程幻象12点
			else
				call ManaDamge(8)	//远程8点
			endif
		endif
	endif
endfunction
function ManaBreakActions takes nothing returns nothing
	if not DETargetIsMagicImmune[DEI] and GetUnitAbilityLevel(DESourceUnit[DEI],'P133')> 0 and GetUnitState(DETargetUnit[DEI], UNIT_STATE_MANA)> 0 then
		// 幻象的数值减半
		if DESourceIsIllusion[DEI] then
			call ManaDamge( ( 16 + 12 * GetUnitAbilityLevel(DESourceUnit[DEI],'P133') ) * 0.5 )
		else
			call ManaDamge(16 + 12 * GetUnitAbilityLevel(DESourceUnit[DEI],'P133'))
		endif
	endif
endfunction

function Learn__SpellShield takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u, 'A0KY')
	if not IsUnitBreak(u) then
		if level == 1 then
			call AddUnitMagicResistance(u, 0.18 + level * 0.08)
		else
			call ReduceUnitMagicResistance(u, 0.18 + ( level - 1 ) * 0.08)
			call AddUnitMagicResistance(u, 0.18 + level * 0.08)
		endif
	endif
	set u = null
endfunction

function Learn__ManaBreak takes nothing returns nothing
	set HaveManaBreak = true
	//call RegisterUnitAttackEvent("ManaBreakActions", PHYSICAL_ATTACK_EFFECT)
endfunction

function RemoveFurySwipesBuff takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit sourceUnit = (LoadUnitHandle(HY,(h), 0))
	local unit targetUnit = (LoadUnitHandle(HY,(h), 1))
	local integer sourceH = GetHandleId(sourceUnit)
	local integer targetH = GetHandleId(targetUnit)
	local real r = LoadReal(HY, h, 0)

	call RemoveSavedHandle(ExtraHT, targetH, sourceH + 'P067')
	call SaveInteger(ExtraHT, targetH, 'P067', LoadInteger(ExtraHT, targetH, 'P067') - 1)
	
	if LoadInteger(ExtraHT, targetH, 'P067') == 0 then
		call UnitRemoveAbility(targetUnit,'A349')
		call UnitRemoveAbility(targetUnit,'B02N')
		call RemoveSavedInteger(ExtraHT, targetH, 'P067')
	endif

	call DestroyTimer(LoadTimerHandle(HY, h, 10))

	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)

	set t = null
	set sourceUnit = null
	set targetUnit = null
endfunction

function FurySwipesActions takes nothing returns nothing

	local integer h
	local integer level = GetUnitAbilityLevel(DESourceUnit[DEI],'P067')
	local trigger trig = LoadTriggerHandle(ExtraHT, DETargetId[DEI], 'P067' + DESourceId[DEI]) 
	local timer tim = null
	local real dur
	local real value

	if DESourceIsMelee[DEI] then
		set dur = 12.
		set value = 5 + 5 * level
	else
		set dur = 8.
		set value = 8 + 2 * level
	endif

	if trig == null then
		set trig = CreateTrigger()
		set h = GetHandleId(trig)
		set tim = CreateTimer()

		call SaveUnitHandle(HY, h, 0, DESourceUnit[DEI])
		call SaveUnitHandle(HY, h, 1, DETargetUnit[DEI])
		call SaveTimerHandle(HY, h, 10, tim)
		call SaveTriggerHandle(ExtraHT, DETargetId[DEI], 'P067' + DESourceId[DEI], trig)
		call SaveInteger(ExtraHT, DETargetId[DEI], 'P067', LoadInteger(ExtraHT, DETargetId[DEI], 'P067') + 1)

		call TriggerRegisterDeathEvent(trig, DETargetUnit[DEI])
		call TriggerRegisterTimerExpireEvent(trig, tim)
		call TriggerAddCondition(trig, Condition( function RemoveFurySwipesBuff))

		if GetUnitAbilityLevel(DETargetUnit[DEI],'A349') <=0 then
			call UnitAddPermanentAbility(DETargetUnit[DEI], 'A349')
		endif

	else
		set h = GetHandleId(trig)
		set tim = LoadTimerHandle(HY, h, 10)
	endif

	set value = value + LoadReal(HY, h, 0)
	call SaveReal(HY, h, 0, value)
	//call BJDebugMsg("额外伤害 "+ R2S(value))

	set DEDamageValue[DEI] = DEDamageValue[DEI] + value
	call TimerStart(tim, dur, false, null)

	set trig = null
	set tim = null
endfunction

function F0R takes unit u, real x, real y, group CNO, integer level returns nothing
	local group g = LoginGroup(129)
	local unit u2
	call KillDestructablesInCircle(x, y, 150)
	call GroupEnumUnitsInRange(g, x, y, 150, TrueBoolexprCondition)
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		if(IsUnitInGroup(u2, CNO)== false and IsUnitEnemy(u2, GetOwningPlayer(u))) then
			if(GetUnitAbilityLevel(u2,'A04R')!= 1 and UnitIsDead(u2)== false and IsUnitType(u2, UNIT_TYPE_STRUCTURE)== false) then
				call GroupAddUnit(CNO, u2)
				call UnitDamageTargetEx(u, u2, 5, 60 + level * 30)
				call AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", u2, "overhead")
			endif
		endif
		call GroupRemoveUnit(g, u2)
	endloop
	call LogoutGroup(g)
	set g = null
	set u2 = null
endfunction
function F1R takes nothing returns nothing
	local integer h = GetHandleId(GetExpiredTimer())
	local unit F2R = LoadUnitHandle(HY, h, 290)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local real Ax = LoadReal(HY, h, 284)
	local real Ay = LoadReal(HY, h, 285)
	local real Cx = LoadReal(HY, h, 286)
	local real Cy = LoadReal(HY, h, 287)
	local real Bx = LoadReal(HY, h, 288)
	local real By = LoadReal(HY, h, 289)
	local real a = LoadReal(HY, h, 137)
	local real b = 1 -a
	local boolean DBR = LoadBoolean(HY, h, 291)
	local group CNO = LoadGroupHandle(HY, h,$85)
	local real DCR = RMaxBJ(GetDistanceBetween(Ax, Ay, Cx, Cy)/ $514, .4)
	call SetUnitX(F2R, CoordinateX50(Ax * a * a + Bx * 2 * a * b + Cx * b * b))
	call SetUnitY(F2R, CoordinateY50(Ay * a * a + By * 2 * a * b + Cy * b * b))
	call F0R(triggerUnit, GetUnitX(F2R), GetUnitY(F2R), CNO, LoadInteger(HY, h, 0))
	if(DBR) then
		call SaveReal(HY, h, 137,((a -0.02 / DCR)* 1.))
	else
		call SaveReal(HY, h, 137,((a + .02 / DCR)* 1.))
		call SaveReal(HY, h, 284, GetUnitX(triggerUnit))
		call SaveReal(HY, h, 285, GetUnitY(triggerUnit))
	endif
	if(a < 0 and DBR) then
		call SaveBoolean(HY, h, 291, false)
		call SaveReal(HY, h, 288,(Ax + 300 * Cos(Atan2(Cy -Ay, Cx -Ax)+ LoadReal(HY, h, 292)))* 1.)
		call SaveReal(HY, h, 289,(Ay + 300 * Sin(Atan2(Cy -Ay, Cx -Ax)+ LoadReal(HY, h, 292)))* 1.)
	endif
	if(a > 1 and DBR == false) then
		call PauseTimer(GetExpiredTimer())
		call LogoutGroup(CNO)
		call FlushChildHashtable(HY, h)
		call RemoveUnit(F2R)
		call DestroyTimer(GetExpiredTimer())
	endif
	set F2R = null
	set triggerUnit = null
	set CNO = null
endfunction
function Y1V takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real Ax
	local real Ay
	local real Cx = GetSpellTargetX()
	local real Cy = GetSpellTargetY()
	local unit a1
	local unit a2
	local integer h1
	local integer h2
	local timer t1 = CreateTimer()
	local timer t2 = CreateTimer()
	if GetUnitTypeId(u)=='e00E' then 
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))] 
	endif
	set Ax = GetUnitX(u)
	set Ay = GetUnitY(u)
	set a1 = CreateUnit(GetOwningPlayer(u),'e01T', Ax, Ay, 270.)
	set a2 = CreateUnit(GetOwningPlayer(u),'e01T', Ax, Ay, 270.)
	if GetSpellTargetUnit()!= null then
		set Cx = GetUnitX(GetSpellTargetUnit())
		set Cy = GetUnitY(GetSpellTargetUnit())
	endif
	call UnitAddPermanentAbility(a1,'Amrf')
	call UnitRemoveAbility(a1,'Amrf')
	call SetUnitFlyHeight(a1, 150, 0)
	call UnitAddPermanentAbility(a2,'Amrf')
	call UnitRemoveAbility(a2,'Amrf')
	call SetUnitFlyHeight(a2, 150, 0)
	set h1 = GetHandleId(t1)
	call SaveUnitHandle(HY, h1, 14, u)
	call SaveUnitHandle(HY, h1, 290, a1)
	call SaveGroupHandle(HY, h1,$85, LoginGroup(130))
	call SaveReal(HY, h1, 284, Ax * 1.)
	call SaveReal(HY, h1, 285, Ay * 1.)
	call SaveReal(HY, h1, 286, Cx * 1.)
	call SaveReal(HY, h1, 287, Cy * 1.)
	call SaveReal(HY, h1, 288,(Ax + 300 * Cos(Atan2(Cy -Ay, Cx -Ax)+ 45))* 1.)
	call SaveReal(HY, h1, 289,(Ay + 300 * Sin(Atan2(Cy -Ay, Cx -Ax)+ 45))* 1.)
	call SaveReal(HY, h1, 137, 1.)
	call SaveReal(HY, h1, 292,-45.)
	call SaveBoolean(HY, h1, 291, true)
	set h2 = GetHandleId(t2)
	call SaveUnitHandle(HY, h2, 14, u)
	call SaveUnitHandle(HY, h2, 290, a2)
	call SaveGroupHandle(HY, h2,$85, LoginGroup(131))
	call SaveReal(HY, h2, 284, Ax * 1.)
	call SaveReal(HY, h2, 285, Ay * 1.)
	call SaveReal(HY, h2, 286, Cx * 1.)
	call SaveReal(HY, h2, 287, Cy * 1.)
	call SaveReal(HY, h2, 288,(Ax + 300 * Cos(Atan2(Cy -Ay, Cx -Ax)-45))* 1.)
	call SaveReal(HY, h2, 289,(Ay + 300 * Sin(Atan2(Cy -Ay, Cx -Ax)-45))* 1.)
	call SaveReal(HY, h2, 137, 1.)
	call SaveReal(HY, h2, 292, 45.)
	call SaveBoolean(HY, h2, 291, true)
	call SaveInteger(HY, h2, 0, GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call SaveInteger(HY, h1, 0, GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call TimerStart(t1, .025, true, function F1R)
	call TimerStart(t2, .025, true, function F1R)
	set u = null
	set a1 = null
	set a2 = null
	set t1 = null
	set t2 = null
endfunction
function F3R takes nothing returns nothing
	local real x = GetUnitX(GetEnumUnit())
	local real y = GetUnitY(GetEnumUnit())
	local real a = bj_RADTODEG * Atan2(y -TJ, x -S2)
	local real targetX
	local real targetY
	local real UCV
	if Sin((a -RJ)* bj_DEGTORAD)< 0 then
		set UCV =-90
	else
		set UCV = 90
	endif
	set targetX = GetUnitX(GetEnumUnit())+$F* Cos((RJ + UCV)* bj_DEGTORAD)
	set targetY = GetUnitY(GetEnumUnit())+$F* Sin((RJ + UCV)* bj_DEGTORAD)
	call SetUnitPosition(GetEnumUnit(), targetX, targetY)
	call SetUnitFacingTimed(GetEnumUnit(), RJ -UCV, .3)
	if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
		call SaveBoolean(K, GetHandleId(GetEnumUnit()), 99, true)
	endif
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl", GetEnumUnit(), "origin"))
endfunction
function F6R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real a = LoadReal(HY, h, 13)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local group g = LoadGroupHandle(HY, h, 22)
	if GetTriggerEvalCount(t)> 20 then
		call LogoutGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set S2 = x
		set TJ = y
		set RJ = a
		call ForGroup(g, function F3R)
	endif
	set t = null
	set g = null
	return false
endfunction
function F7R takes nothing returns nothing
	call UnitDamageTargetEx(U2, GetEnumUnit(), 1, S2)
endfunction
function F8R takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0O2')
	local unit dummyUnit
	local real a = bj_RADTODEG * Atan2(GetUnitY(targetUnit)-GetUnitY(triggerUnit), GetUnitX(targetUnit)-GetUnitX(triggerUnit))
	local real x
	local real y
	local group g = LoginGroup(132)
	local group g2 = LoginGroup(133)
	if level == 0 then
		set level = GetUnitAbilityLevel(triggerUnit,'A289')
	endif
	call SaveGroupHandle(HY, h, 22,(g))
	call SaveReal(HY, h, 13, a * 1.)
	call SaveReal(HY, h, 6, GetUnitX(triggerUnit))
	call SaveReal(HY, h, 7, GetUnitY(triggerUnit))
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function F6R))
	set x = GetUnitX(triggerUnit)+ 50 * Cos(a * bj_DEGTORAD)
	set y = GetUnitY(triggerUnit)+ 50 * Sin(a * bj_DEGTORAD)
	call GroupEnumUnitsInRange(g2, x, y, 275, Condition(function DDX))
	call GroupAddGroup(g2, g)
	call GroupClear(g2)
	set dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'o00Y', x, y, a)
	call UnitApplyTimedLife(dummyUnit,'BTLF', 1)
	call UnitAddPermanentAbility(dummyUnit,'A0NY')
	call SetUnitAbilityLevel(dummyUnit,'A0NY', level)
	call IssueImmediateOrderById(dummyUnit,$D0080)
	set x = GetUnitX(triggerUnit)+$FA* Cos(a * bj_DEGTORAD)
	set y = GetUnitY(triggerUnit)+$FA* Sin(a * bj_DEGTORAD)
	call GroupEnumUnitsInRange(g2, x, y, 275, Condition(function DDX))
	call GroupAddGroup(g2, g)
	call GroupClear(g2)
	set dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'o00Y', x, y, a)
	call UnitApplyTimedLife(dummyUnit,'BTLF', 1)
	call UnitAddPermanentAbility(dummyUnit,'A0NY')
	call SetUnitAbilityLevel(dummyUnit,'A0NY', level)
	call IssueImmediateOrderById(dummyUnit,$D0080)
	set x = GetUnitX(triggerUnit)+ 450 * Cos(a * bj_DEGTORAD)
	set y = GetUnitY(triggerUnit)+ 450 * Sin(a * bj_DEGTORAD)
	call GroupEnumUnitsInRange(g2, x, y, 275, Condition(function DDX))
	call GroupAddGroup(g2, g)
	call GroupClear(g2)
	set dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'o00Y', x, y, a)
	call UnitApplyTimedLife(dummyUnit,'BTLF', 1)
	call UnitAddPermanentAbility(dummyUnit,'A0NY')
	call SetUnitAbilityLevel(dummyUnit,'A0NY', level)
	call IssueImmediateOrderById(dummyUnit,$D0080)
	if GetUnitAbilityLevel(triggerUnit,'A0O2')== 0 then
		set x = GetUnitX(triggerUnit)+ 650 * Cos(a * bj_DEGTORAD)
		set y = GetUnitY(triggerUnit)+ 650 * Sin(a * bj_DEGTORAD)
		call GroupEnumUnitsInRange(g2, x, y, 275, Condition(function DDX))
		call GroupAddGroup(g2, g)
		call GroupClear(g2)
		set dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'o00Y', x, y, a)
		call UnitApplyTimedLife(dummyUnit,'BTLF', 1)
		call UnitAddPermanentAbility(dummyUnit,'A0NY')
		call SetUnitAbilityLevel(dummyUnit,'A0NY', level)
		call IssueImmediateOrderById(dummyUnit,$D0080)
	endif
	call LogoutGroup(g2)
	call GroupRemoveUnit(g, targetUnit)
	set S2 =$96+ 50 * level
	set U2 = triggerUnit
	call ForGroup(g, function F7R)
	set t = null
	set triggerUnit = null
	set targetUnit = null
	set dummyUnit = null
	set g = null
	set g2 = null
endfunction
function Y2V takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call F8R()
	endif
endfunction
function F9R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	call UnitRemoveAbility(WUE,'A140')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	return false
endfunction
function Y3V takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	call UnitAddPermanentAbility(WUE,'A140')
	call TriggerRegisterTimerEvent(t, 6, false)
	call TriggerAddCondition(t, Condition(function F9R))
	call SaveUnitHandle(HY, h, 2,(WUE))
	set t = null
	set WUE = null
endfunction
function GVR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit GER =(LoadUnitHandle(HY, h, 2))
	local real GXR =(LoadReal(HY, h, 6))
	local real GOR =(LoadReal(HY, h, 7))
	local real GRR = GetUnitX(GER)
	local real GIR = GetUnitY(GER)
	call SaveReal(HY, h, 6,((GRR)* 1.))
	call SaveReal(HY, h, 7,((GIR)* 1.))
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if GXR == GRR and GOR == GIR then
			if GetUnitAbilityLevel(GER,'A1WG')== 0 then
				call UnitAddPermanentAbility(GER,'A1WG')
			endif
		else
			if GetUnitAbilityLevel(GER,'A1WG')> 0 then
				call UnitRemoveAbility(GER,'A1WG')
			endif
		endif
	endif
	set t = null
	set GER = null
	return false
endfunction
function Q1E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer WUV = GetUnitAbilityLevel(u,'A0OO')
	if(WUV == 1) then
		call UnitAddPermanentAbility(u,'A300')
		call UnitAddPermanentAbility(u,'A301')
	endif
	call SetUnitAbilityLevel(u,'A300', WUV)
	call SetUnitAbilityLevel(u,'A301', WUV)
	set u = null
endfunction
function D7E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer i = GetUnitAbilityLevel(u,'A301')
	local group g
	local unit GAR = null
	local integer id
	if GetUnitTypeId(u)=='e00E' then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
	if i == 1 then
		set id ='h30A'
	elseif i == 2 then
		set id ='n01M'
	elseif i == 3 then
		set id ='n01S'
	else
		set id ='h30B'
	endif
	set GAR = CreateUnit(GetOwningPlayer(u), id, GetUnitX(u), GetUnitY(u), GetUnitFacing(u))
	call UnitApplyTimedLife(GAR,'BTLF', 60)
	call SetUnitAbilityLevel(GAR,'A0OP', i)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl", GAR, "chest"))
	set i = GetUnitAbilityLevel(u,'A0A8')
	if i > 0 then
		call UnitAddMaxLife(GAR, 100 * i)
		call UnitAddPermanentAbilitySetLevel(GAR,'A3IM', i)
	endif
	set GAR = null
	set u = null
endfunction
function D6E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer i = GetUnitAbilityLevel(u,'A300')
	local trigger t
	local integer h
	local unit GNR
	local integer id
	if GetUnitTypeId(u)=='e00E' then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
	if i == 1 then
		set id ='h308'
	elseif i == 2 then
		set id ='n01Q'
	elseif i == 3 then
		set id ='n01R'
	else
		set id ='h309'
	endif
	set GNR = CreateUnit(GetOwningPlayer(u), id, GetUnitX(u), GetUnitY(u), GetUnitFacing(u))
	call UnitApplyTimedLife(GNR,'BTLF', 60)
	if i > 2 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .05, true)
		call TriggerRegisterUnitEvent(t, GNR, EVENT_UNIT_DEATH)
		call SaveReal(HY, h, 6,((GetUnitX(GNR))* 1.))
		call SaveReal(HY, h, 7,((GetUnitY(GNR))* 1.))
		call SaveUnitHandle(HY, h, 2,(GNR))
		call TriggerAddCondition(t, Condition(function GVR))
		set t = null
	endif
	set i = GetUnitAbilityLevel(u,'A0A8')
	if i > 0 then
		call SetUnitMoveSpeed(GNR, GetUnitDefaultMoveSpeed(GNR)+ 50 * i)
		call UnitAddPermanentAbility(GNR,'Amim')
	endif
	set u = null
	set GNR = null
endfunction
function GBR takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local integer h = GetHandleId(WUE)
	local player p =(LoadPlayerHandle(HY, h, 54))
	local integer level =(LoadInteger(HY, h, 5))
	local texttag tt = CreateTextTag()
	local integer Y_E
	local integer i = 1
	local unit u
	local player p2
	if level == 1 then
		set Y_E =$96
	elseif level == 2 then
		set Y_E =$C8
	else
		set Y_E =$FA
	endif
	set Y_E = AddPlayerResourceGold(p, Y_E)
	call SetTextTagText(tt, "+" + I2S(Y_E), .025)
	call SetTextTagPosUnit(tt, Player__Hero[GetPlayerId(p)], 100)
	call SetTextTagColor(tt, 255,$DC, 0, 255)
	call SetTextTagVelocity(tt, 0, .03)
	call SetTextTagVisibility(tt, LocalPlayer== p)
	call SetTextTagFadepoint(tt, 2)
	call SetTextTagLifespan(tt, 3)
	call SetTextTagPermanent(tt, false)
	set EUV[GetPlayerId(p)]= EUV[GetPlayerId(p)]+ Y_E
	set HHV[GetPlayerId(p)]= HHV[GetPlayerId(p)]+ Y_E
	loop
	exitwhen i > 5
		if IsSentinelsPlayer(p) then
			set p2 = Sentinels[i]
		else
			set p2 = Scourges[i]
		endif
		if p2 != p then
			set u = Player__Hero[GetPlayerId(p2)]
			if GetDistanceBetweenUnits(u, WUE)< 950 then
				set tt = CreateTextTag()
				if level == 1 then
					set Y_E = 40
				elseif level == 2 then
					set Y_E = 80
				else
					set Y_E = 120
				endif
				set Y_E = AddPlayerResourceGold(p2, Y_E)
				call SetTextTagText(tt, "+" + I2S(Y_E), .025)
				call SetTextTagPosUnit(tt, u, 100)
				call SetTextTagColor(tt, 255,$DC, 0, 255)
				call SetTextTagVelocity(tt, 0, .03)
				call SetTextTagVisibility(tt, LocalPlayer== p2)
				call SetTextTagFadepoint(tt, 2)
				call SetTextTagLifespan(tt, 3)
				call SetTextTagPermanent(tt, false)
				set EUV[GetPlayerId(p2)]= EUV[GetPlayerId(p2)]+ Y_E
				set HHV[GetPlayerId(p2)]= HHV[GetPlayerId(p2)]+ Y_E
			endif
		endif
		set i = i + 1
	endloop
	set WUE = null
	set p = null
	set p2 = null
	set u = null
	set tt = null
endfunction
function GCR takes nothing returns nothing
	if LoadReal(HY, GetHandleId(GetTriggerUnit()), 314)> GetGameTime() then
		call GBR()
	endif
endfunction
function GDR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local unit dummyUnit = LoadUnitHandle(HY, h, 19)
	call SetUnitX(dummyUnit, GetUnitX(targetUnit))
	call SetUnitY(dummyUnit, GetUnitY(targetUnit))
	if(GetTriggerEvalCount(t)>$A and GetUnitAbilityLevel(targetUnit,'B00L')== 0) or LoadReal(HY, GetHandleId(targetUnit), 314)== 0 then
		call UnitRemoveAbility(targetUnit,'B00L')
		call RemoveSavedHandle(HY, GetHandleId(targetUnit),'B00L')
		call SaveReal(HY, GetHandleId(targetUnit), 314, 0)
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call KillUnit(dummyUnit)
		call RemoveUnit(dummyUnit)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	set dummyUnit = null
	return false
endfunction
function Y4V takes nothing returns nothing
	local trigger t
	local integer h
	local unit targetUnit = GetSpellTargetUnit()
	local unit WUE = GetTriggerUnit()
	local unit dummyUnit
	local string FX = "war3mapImported\\TrackBuff.mdx"
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(targetUnit)) and IsObserver== false then
		set FX = ""
	endif
	if HaveSavedHandle(HY, GetHandleId(targetUnit),'B00L') then
		set t = LoadTriggerHandle(HY, GetHandleId(targetUnit),'B00L')
		set h = GetHandleId(t)
		call UnitRemoveAbility(targetUnit,'B00L')
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, GetHandleId(targetUnit),'B00L', t)
		set dummyUnit = CreateUnit(GetOwningPlayer(targetUnit),'e01V', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitAddPermanentAbility(dummyUnit,'A115')
		call TriggerRegisterTimerEvent(t, .02, true)
		call TriggerAddCondition(t, Condition(function GDR))
		call SaveUnitHandle(HY, h, 17, targetUnit)
		call SaveUnitHandle(HY, h, 19, dummyUnit)
		call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget(FX, targetUnit, "overhead"))
	endif
	call SaveReal(HY, GetHandleId(targetUnit), 314, GetGameTime()+ 30 * 1.)
	call SavePlayerHandle(HY, GetHandleId(targetUnit), 54, GetOwningPlayer(WUE))
	call SaveInteger(HY, GetHandleId(targetUnit), 5, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	set t = null
	set targetUnit = null
	set WUE = null
	set dummyUnit = null
endfunction
function NRE takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	call UnitRemoveAbility(targetUnit,'A1IW')
	call UnitRemoveAbility(targetUnit,'B0CA')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set targetUnit = null
	return false
endfunction

// 忍术效果
function WaitJinadaCoolDown takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit sourceUnit = LoadUnitHandle(HY, h, 0)

	call AddJinadaEffectActions(sourceUnit)

	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set sourceUnit = null
endfunction
function UnitAttackJinadaActions takes nothing returns nothing
	local real cool = GetUnitAbilityCoolDown(DESourceUnit[DEI], 'A1IQ')
	local integer h = CreateTimerEventTrigger(cool, false, function WaitJinadaCoolDown)
	call SaveUnitHandle(HY, h, 0, DESourceUnit[DEI])
	call UnitRemoveAbility(DESourceUnit[DEI], 'A1IS')
	call AddAbilityToTimed(DETargetUnit[DEI],'A1IX', 1, 3,'B0CA')
	call YDWESetUnitAbilityState(DESourceUnit[DEI], 'A1IQ', 1 , cool)
	set JinadaCount = JinadaCount - 1
endfunction
function LearnSkill__Jinada takes nothing returns nothing
	set JinadaCount = JinadaCount + 1
	call UnitAddPermanentAbility(GetTriggerUnit(),'A1IS')
	/*
	local unit triggerUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call UnitAddPermanentAbility(triggerUnit,'A1IQ')
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function GLR))
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	call SaveInteger(HY, h,$B5, 0)
	set triggerUnit = null
	set t = null
	*/
endfunction

function GSR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local integer level = GetUnitAbilityLevel(WUE,'A07A')
	if level < 1 then
		set level = GetUnitAbilityLevel(WUE,'QB09')
	endif
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if GetEventDamageSource()== WUE then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			if((LoadInteger(HY,(GetHandleId((WUE))),($9B7)))== 1)== false then
				call EPX(WUE,$9B7, .5)
				if IsUnitType(targetUnit, UNIT_TYPE_STRUCTURE)== false and IsUnitEnemy(targetUnit, GetOwningPlayer(WUE)) then
					call UnitDamageTargetEx(WUE, targetUnit, 2, 30 * level)
					call CommonTextTag(I2S(R2I(30 * level)), 1, WUE, .027,$D8, 0, 0,$D8)
				endif
			endif
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function GTR takes nothing returns nothing
	local trigger t = CreateTrigger()
	local unit targetUnit = GetTriggerUnit()
	local unit WUE = GetAttacker()
	local integer h = GetHandleId(t)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerRegisterTimerEvent(t, 2, false)
	call TriggerAddCondition(t, Condition(function GSR))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveUnitHandle(HY, h, 2,(WUE))
	set targetUnit = null
	set WUE = null
	set t = null
endfunction
function GUR takes nothing returns boolean
	local integer lv
	local unit u
	if GetTriggerEventId()== EVENT_UNIT_SPELL_CAST or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		set u =(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 14))
		
		call FlushChildHashtable(HY,(GetHandleId(GetTriggeringTrigger())))
		call CleanCurrentTrigger(GetTriggeringTrigger())
	elseif GetTriggerEventId()== EVENT_PLAYER_UNIT_ATTACKED then
		if GetAttacker()==(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 14)) then
			if((LoadInteger(HY,(GetHandleId((GetAttacker()))),($9B8)))== 1)== false then
				call FlushChildHashtable(HY,(GetHandleId(GetTriggeringTrigger())))
				call CleanCurrentTrigger(GetTriggeringTrigger())
				call GTR()
			endif
			
		endif
	else
		if LoadBoolean(HY, GetHandleId(GetTriggeringTrigger()), 0) then
			set u =(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 14))
			call L6X(u)
			call UZV(u,'I0TG')
			call RemoveSavedBoolean(HY, GetHandleId(GetTriggeringTrigger()), 0)
		else
			set u =(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 14))

			call FlushChildHashtable(HY,(GetHandleId(GetTriggeringTrigger())))
			call CleanCurrentTrigger(GetTriggeringTrigger())
		endif
	endif
	set u = null
	return false
endfunction

function SpellEffect__SkeletonWalk takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(trigUnit, GetSpellAbilityId())
	local real dataA = 0
	local real dataB = 0.6
	local real dataF = 0.05 + 0.5 * level
	local real dur = 15 + 5 * level

	call UnitSpellEffectWindWalk(trigUnit, dataA, dataB, dur, level, 'AW76', 'B076', 1, 0, dataF)

	set trigUnit = null
endfunction
function Item_SpellEffect_SilverEdge takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(trigUnit, GetSpellAbilityId())
	local real dataA = 225
	local real dataB = 0.3
	local real dataF = 0.2
	local real dur = 18
	call EnableEffectByTime(19, 20)
	call UnitSpellEffectWindWalk(trigUnit, dataA, dataB, dur, level, 'AW9C', 'B39C', 1, 0, dataF)

	set trigUnit = null
endfunction
function Item_SpellEffect_LotharEdge takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(trigUnit, GetSpellAbilityId())
	local real dataA = 175
	local real dataB = 0.3
	local real dataF = 0.12
	local real dur = 14

	call UnitSpellEffectWindWalk(trigUnit, dataA, dataB, dur, level, 'AW7T', 'B07T', 1, 0, dataF)

	set trigUnit = null
endfunction
function SpellEffect__Vendetta takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(trigUnit, GetSpellAbilityId())
	local real dataA = 100 + 150 * level
	local real dataB = 0.
	local real dataF = 0.14 + 0.02 * level
	local real dur = 30 + 10 * level

	call UnitSpellEffectWindWalk(trigUnit, dataA, dataB, dur, level, 'AWWK', 'B00K', 1, 0, dataF)

	set trigUnit = null
endfunction
function SpellEffect__WindWalk takes nothing returns nothing
	local unit trigUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(trigUnit, GetSpellAbilityId())
	local real dataA = 30 * level
	local real dataB = 1.1 - 0.1 * level
	local real dataF = 0.
	local real dur = 10 + 5 * level

	call UnitSpellEffectWindWalk(trigUnit, dataA, dataB, dur, level, 'A068', 'B068', 1, 0, dataF)

	set trigUnit = null
	/*local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = GetSpellTargetUnit()
	local unit WUE = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(WUE, GetSpellAbilityId())
	call EPX(WUE,$9B8, 1.25 -0.25 * level -0.01)
	call TriggerRegisterTimerEvent(t,$A+ 5 * level, false)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_CAST)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerRegisterTimerEvent(t, 0, false)
	call SaveBoolean(HY, h, 0, true)
	call TriggerAddCondition(t, Condition(function GUR))
	call SaveUnitHandle(HY, h, 14,(WUE))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	set t = null
	set targetUnit = null
	set WUE = null*/
endfunction
function GWR takes nothing returns nothing
	local unit WJE = U2
	local unit WLE = W2
	local group g
	local group tg
	local unit u
	local integer GYR
	local real ZCE = .0
	local integer level
	local boolean GZR = false
	local integer h
	if LoadUnitHandle(P, GetHandleId(WJE),'A004'+ 1)!= null then
		set WJE = LoadUnitHandle(P, GetHandleId(WJE),'A004'+ 1)
		set GZR = true
		call RemoveSavedHandle(P, GetHandleId(U2),'A004'+ 1)
	endif
	set h = GetHandleId(WJE)
	set g = LoadGroupHandle(P, h,'A004')
	set GYR = LoadInteger(P, h,'A004')
	set level = LoadInteger(P, h,'A005')
	call TDV(WLE)
	call GroupAddUnit(g, WLE)
	if GZR then
		set ZCE = 25 + 50 * level
	else
		set ZCE = 75 *(level + 1)
	endif
	call UnitDamageTargetEx(WJE, WLE, 1, ZCE)
	if GetUnitAbilityLevel(WLE,'A3E9')== 1 and LoadBoolean(P, h,'A004')== false then
		if IsMagicImmuneUnit(WJE)== false and GetUnitAbilityLevel(WJE,'Aloc')== 0 then
			call SaveUnitHandle(VV,'A3E9', 0, WLE)
			call SaveUnitHandle(VV,'A3E9', 1, WJE)
			call SaveInteger(VV,'A3E9', 0, level)
			call ExecuteFunc("G_R")
		endif
	endif
	if GYR > 0 then
		set tg = LoginGroup(134)
		set U2 = WJE
		call GroupEnumUnitsInRange(tg, GetUnitX(WLE), GetUnitY(WLE), 425, Condition(function DSX))
		call GroupRemoveGroup(g, tg)
		set u = FirstOfGroup(tg)
		if u != null then
			call NHX(WLE, u,'h02K', "GWR", 1000, true)
			call SaveUnitHandle(P, GetHandleId(WLE),'A004'+ 1, WJE)
			call SaveInteger(P, h,'A004', GYR -1)
		else
			call LogoutGroup(g)
			call RemoveSavedInteger(P, h,'A004')
			call RemoveSavedHandle(P, h,'A004')
			call RemoveSavedBoolean(P, h,'A004')
			call RemoveSavedInteger(P, h,'A005')
		endif
		call LogoutGroup(tg)
		set tg = null
	else
		call LogoutGroup(g)
		call RemoveSavedInteger(P, h,'A004')
		call RemoveSavedHandle(P, h,'A004')
		call RemoveSavedBoolean(P, h,'A004')
		call RemoveSavedInteger(P, h,'A005')
	endif
	set WJE = null
	set WLE = null
	set u = null
	set g = null
	set tg = null
endfunction
function G_R takes nothing returns nothing
	local unit WJE = LoadUnitHandle(VV,'A3E9', 0)
	local unit WLE = LoadUnitHandle(VV,'A3E9', 1)
	local integer level = LoadInteger(VV,'A3E9', 0)
	call T4V(WJE)
	if UnitHasSpellShield(WLE)== false then
		call NHX(WJE, WLE,'h02K', "GWR", 1000, true)
		call SaveInteger(P, GetHandleId(WJE),'A004', level -1)
		call SaveInteger(P, GetHandleId(WJE),'A005', level)
		call SaveGroupHandle(P, GetHandleId(WJE),'A004', LoginGroup(135))
		call SaveBoolean(P, GetHandleId(WJE),'A004', true)
	else
		call AJO(WLE)
	endif
	call FlushChildHashtable(VV,'A3E9')
	set WJE = null
	set WLE = null
endfunction
function FIE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call NHX(GetTriggerUnit(), GetSpellTargetUnit(),'h02K', "GWR", 1000, true)
		call SaveInteger(P, GetHandleId(GetTriggerUnit()),'A004', GetUnitAbilityLevel(GetTriggerUnit(),'A004')-1)
		call SaveGroupHandle(P, GetHandleId(GetTriggerUnit()),'A004', LoginGroup(136))
		call SaveInteger(P, GetHandleId(GetTriggerUnit()),'A005', GetUnitAbilityLevel(GetTriggerUnit(),'A004'))
	endif
endfunction
function G0R takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer DSR = LoadInteger(P, WFV, 0)
	local integer UYX = LoadInteger(P, DSR,'A0FV')-1
	local unit u = LoadUnitHandle(P, WFV, 0)
	local integer G1R = LoadInteger(P, GetHandleId(u),'WARP')
	local integer N3X
	local integer WUV = LoadInteger(P, GetHandleId(u),'WARL')
	local integer i = R2I(.5 * WUV * WUV + .5 * WUV + 4)
	if G1R > 0 then
		call J8X(u, G1R)
	endif
	set N3X = i +(UYX)* WUV
	if(UYX > 0) then
		call J6X(u, N3X)
		call SaveInteger(P, GetHandleId(u),'WARP', N3X)
	else
		call SaveInteger(P, GetHandleId(u),'WARP', 0)
		call UnitRemoveAbility(u,'A30P')
	endif
	call SaveInteger(P, DSR,'A0FV', UYX)
	call LodSystem_ReduceUnitExtraState(u, LoadInteger(P, WFV, 1), STATE_SYSTEM_DAMAGE)
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set u = null
endfunction
function G2R takes unit u, integer WUV returns nothing
	local timer t = null
	local integer W0V
	local integer N3X
	local integer CJR
	local integer WFV = GetHandleId(u)
	local integer UYX = LoadInteger(P, WFV,'A0FV')+ 1
	local integer i
	local integer G1R
	set CJR =$F+ 5 * WUV
	if UYX == 5 + WUV then
		return
	endif
	set t = CreateTimer()
	set W0V = GetHandleId(t)
	set N3X = UYX *(WUV + 2)
	if LoadInteger(P, WFV,'WARP')> 0 then
		call J8X(u, LoadInteger(P, WFV,'WARP'))
	endif
	call LodSystem_AddUnitExtraState(u, CJR, STATE_SYSTEM_DAMAGE)
	call SaveInteger(P, WFV,'A0FV', UYX)
	call SaveInteger(P, WFV,'WARP', N3X)
	call SaveInteger(P, WFV,'WARL', WUV)
	call J6X(u, N3X)
	call SaveUnitHandle(P, W0V, 0, u)
	call SaveInteger(P, W0V, 0, WFV)
	call SaveInteger(P, W0V, 1, CJR)
	call TimerStart(t, 14., false, function G0R)
	call UnitAddPermanentAbility(u,'A30P')
	call UnitMakeAbilityPermanent(u, true,'A0EF')
	set t = null
endfunction
function G3R takes unit u, integer WTV returns nothing
	local integer WUV = GetUnitAbilityLevel(u,'A0FV')
	if WUV > 0 and(WTV =='A0FW' or WTV =='A0GP' or X8R(WTV)) then
		call G2R(u, WUV)
	endif
endfunction

function G5R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer ht = GetHandleId(t)
	local unit WJE =(LoadUnitHandle(HY,(ht), 0))
	local integer hc = GetHandleId(WJE)
	local integer i = 0
	local unit u
	local integer hu
	loop
		set i = i + 1
	exitwhen not HaveSavedHandle(HY, ht, i)
		set u = LoadUnitHandle(HY, ht, i)
		set hu = GetHandleId(u)
		if hu < 1 then
			set hu = LoadInteger(HY, ht, i)
			call FlushChildHashtable(HY, hu)
		else
			call SaveReal(HY, hc, hu, RMaxBJ(LoadReal(HY, hc, hu)-LoadReal(HY, ht, i), 0))
		endif
	endloop
	call FlushChildHashtable(HY,(ht))
	call CleanCurrentTrigger(t)
	set u = null
	set WJE = null
	set t = null
	return false
endfunction
// 针刺扫射
function UnitSpellEffectQuillSpray takes unit spellUnit, integer level returns nothing
	local integer spellUnitHandleId = GetHandleId(spellUnit)
	local group g = LoginGroup(137)
	local trigger t = CreateTrigger()
	local integer ht = GetHandleId(t)
	local unit firstUnit
	local integer h
	local real extraDamage
	local real damage
	local integer addDamage = 28 + 2 * level
	local integer i = 0
	local unit W_V
	if not IsUnitType(spellUnit, UNIT_TYPE_HERO) then
		set spellUnit = Player__Hero[GetPlayerId(GetOwningPlayer(spellUnit))]
		set spellUnitHandleId = GetHandleId(spellUnit)
	endif
	call GroupEnumUnitsInRange(g, GetUnitX(spellUnit), GetUnitY(spellUnit), 650, null)
	set Temp__Player = GetOwningPlayer( spellUnit )
	loop
		set firstUnit = FirstOfGroup(g)
	exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)
		// 敌对 存活不是建筑不是守卫
		if IsUnitEnemy(firstUnit, Temp__Player) and IsAliveNotStrucNotWard(firstUnit) then
			set i = i + 1
			set h = GetHandleId(firstUnit)
			set extraDamage = LoadReal(HY, spellUnitHandleId, h) // 获取挨打单位被扫射的次数
			set damage = RMinBJ(level * 20 + extraDamage, 400)
			call CommonTextTag("+" + I2S(R2I(damage)), 1, firstUnit, .023, 255, 0, 0, 216)
			call SaveReal(HY, ht, i, addDamage)
			call SaveUnitHandle(HY, ht, i, firstUnit)
			call SaveInteger(HY, ht, i, h)
			call UnitDamageTargetEx(spellUnit, firstUnit, 2, damage)
			call SaveReal(HY, spellUnitHandleId, h, extraDamage + addDamage)
		endif
	endloop
	set firstUnit = null
	call LogoutGroup(g)
	set g = null

	call SaveUnitHandle(HY, ht, 0, spellUnit )
	call TriggerRegisterTimerEvent(t, 14, false)
	call TriggerAddCondition(t, Condition(function G5R))
	set t = null

endfunction

function SpellEffect__QuillSpray takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	call UnitSpellEffectQuillSpray( spellUnit, GetUnitAbilityLevel( spellUnit, GetSpellAbilityId() ) )
	set spellUnit = null
endfunction

function G8R takes unit whichUnit returns nothing
	local unit dummyUnit = CreateUnit(GetOwningPlayer(whichUnit),'e00E', GetUnitX(whichUnit), GetUnitY(whichUnit), 0)
	local integer level = GetUnitAbilityLevel(whichUnit,'A0GP')
	//call SetUnitUserData(dummyUnit, 1)
	//call TriggerRegisterUnitEvent(JJ, dummyUnit, EVENT_UNIT_SPELL_EFFECT)
	call UnitAddPermanentAbility(dummyUnit,'A0GP')
	call IssueImmediateOrderById(dummyUnit,$D022E)
	// 马甲只是为了释放特效 真正的伤害和操作还得看英雄
	if level <= 0 then
		set level = 4
	endif
	call UnitSpellEffectQuillSpray( whichUnit, level )
	set dummyUnit = null
endfunction
function G9R takes unit whichUnit, real CJR returns nothing
	local integer h = GetHandleId(whichUnit)
	local real FBX = LoadReal(HY, h, 278)+ CJR
	if FBX >$E6 then
		call SaveReal(HY, h, 278, 0)
		call G8R(whichUnit)
	else
		call SaveReal(HY, h, 278, FBX)
	endif
endfunction
function HVR takes nothing returns boolean
	local unit whichUnit = GetTriggerUnit()
	local unit HER = GetEventDamageSource()
	local real HXR = AngleBetweenUnit(HER, whichUnit)
	local real HOR = GetUnitFacing(whichUnit)
	local real HRR
	local real IXX = GetEventDamage()
	local real hp
	local real HIR
	local real L2O = GetWidgetLife(whichUnit)
	if(IXX > 5) and L2O > .405 and FK and GetUnitAbilityLevel(whichUnit,'A36D')== 0 then
		if((HOR -HXR)<(-180.)) then
			set HRR =(HOR -HXR + 360)
		else
			if((HOR -HXR)> 180.) then
				set HRR =(HOR -HXR -360)
			else
				set HRR =(HOR -HXR)
			endif
		endif
		set HIR = RAbsBJ(HRR)
		if HIR <= 70 then
			set hp =((GetUnitAbilityLevel(whichUnit,'A0M3'))* .06 + .06)* IXX
			call G9R(whichUnit, IXX -hp)
			call SetUnitToReduceDamage(whichUnit, hp)
		elseif HIR <= 110 then
			set hp =((GetUnitAbilityLevel(whichUnit,'A0M3'))* .02 + .06)* IXX
			call SetUnitToReduceDamage(whichUnit, hp)
		endif
	endif
	set whichUnit = null
	set HER = null
	return false
endfunction
function PSE takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function HVR))
	set t = null
endfunction
function MXE takes nothing returns nothing
	call PSE()
endfunction
function HAR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer hu = LoadInteger(HY, h, 0)
	local integer HNR = LoadInteger(HY, hu,'A0Fw')
	call RemoveSavedHandle(HY, hu,'A0FW')
	call RemoveSavedInteger(HY, hu,'A0FW')
	call RemoveSavedInteger(HY, hu,'A0Fw')
	if GetHandleId(u)!= 0 then
		call UnitRemoveAbility(u, HNR)
		call UnitRemoveAbility(u,'B37Y')
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction
function HBR takes nothing returns nothing
	local integer h
	local unit WJE = U2
	local unit WLE = W2
	local integer level = GetUnitAbilityLevel(WJE,'A0FW')+ GetUnitAbilityLevel(WJE,'A3OD')
	local integer HCR
	local integer HDR
	local integer HFR
	local timer t
	local integer hu = GetHandleId(WLE)
	local boolean HGR = false
	if level == 0 and GetUnitAbilityLevel(WLE,'A0FW')> 0 then
		set level = GetUnitAbilityLevel(WLE,'A0FW')
		set HGR = true
	endif
	set HCR ='A37U'-1 + level
	set HDR ='A3F0'+ 4 *(level -1)-1
	if GetUnitAbilityLevel(WLE,'B37Y')== 0 then
		set HFR = 0
	else
		set HFR = LoadInteger(HY, hu,'A0FW')
	endif
	if level > 0 then
		if HFR > 0 then
			call UnitRemoveAbility(WLE,'A37U')
			call UnitRemoveAbility(WLE,'A37V')
			call UnitRemoveAbility(WLE,'A37W')
			call UnitRemoveAbility(WLE,'A37X')
			call UnitRemoveAbility(WLE, LoadInteger(HY, hu,'A0Fw'))
			call UnitRemoveAbility(WLE,'B37Y')
		endif
		if HaveSavedHandle(HY, hu,'A0FW') then
			set t = LoadTimerHandle(HY, hu,'A0FW')
		else
			set t = CreateTimer()
			call SaveTimerHandle(HY, hu,'A0FW', t)
			call SaveUnitHandle(HY, GetHandleId(t), 0, WLE)
			call SaveInteger(HY, GetHandleId(t), 0, hu)
		endif
		call SaveInteger(HY, hu,'A0FW', IMinBJ(4, HFR + 1))
		call TimerStart(t, 5., false, function HAR)
		set t = null
		set HDR = HDR + IMinBJ(4, HFR + 1)
		call UnitAddPermanentAbility(WLE, HDR)
		call SaveInteger(HY, hu,'A0Fw', HDR)
		call AddAbilityToTimed(WLE, HCR, HFR + 1, 5, 0)
	endif
	if GetUnitAbilityLevel(WLE,'A3E9')== 1 and IsMagicImmuneUnit(WJE) and HGR == false then
		if UnitHasSpellShield(WJE)== false then
			call NHX(WLE, WJE,'h01K', "HBR", 1000, true)
		else
			call AJO(WJE)
		endif
	endif
	set t = null
	set WJE = null
	set WLE = null
endfunction
function Y7V takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call NHX(GetTriggerUnit(), GetSpellTargetUnit(),'h01K', "HBR", 1000, true)
	endif
endfunction
function a_gangbei takes nothing returns nothing
	local group g = LoginGroup(138)
	local unit u
	set U2 = GetTriggerUnit()
	call GroupEnumUnitsInRange(g, GetUnitX(U2), GetUnitY(U2), 725, Condition(function DJX))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call NHX(GetTriggerUnit(), u,'h01K', "HBR", 1000, true)
		call GroupRemoveUnit(g, u)
	endloop
	call LogoutGroup(g)
endfunction
function CWReturnActions takes unit R8X, unit WLE returns nothing
	local integer level = GetUnitAbilityLevel(WLE,'P123')
	local real IXX =($E+ 2 * level)+(.18 + .12 * level)* E3X(WLE)
	call UnitDamageTargetEx(I_X(WLE), R8X, 2, IXX)
endfunction
function HJR takes nothing returns boolean
	local unit t = GetFilterUnit()
	local unit u = Temp__ArrayUnit[0]
	local group g = LoadGroupHandle(HY, XK[0], 1)

	set g = null
	set u = null
	set t = null
	return false
endfunction

function Wait0sEvaluateActions takes nothing returns nothing
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)

	local trigger evaluateTrigger = LoadTriggerHandle(HY, h, 0)

	if evaluateTrigger != null and IsTriggerEnabled(evaluateTrigger) then
		call TriggerEvaluate(evaluateTrigger)
	endif

	set evaluateTrigger = null
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(trig)
	set trig = null
endfunction
// 等待0秒后 调用触发器条件
function Wait0sTriggerEvaluate takes trigger trig returns nothing
	local integer h = CreateTimerEventTrigger(0., false, function Wait0sEvaluateActions)
	call SaveTriggerHandle(HY, h, 0, trig)
endfunction

function StampedeActions takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local integer count = LoadInteger(HY, h, 0)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local group targetGroup = LoadGroupHandle(HY, h, 1)
	local group stampedeGroup = LoadGroupHandle(HY, h, 2)
	local group tempGroup = null
	local real damage = 3 * GerHeroMainAttributesValue(whichUnit)
	local real dur = LoadReal(HY, h, 2)
	local unit firstUnit = null
	local unit stampedeUnit = null
	local boolean isScepterUpgrade
	local real x
	local real y

	// 如果单位死亡 就将其移除单位组
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		set firstUnit = GetTriggerUnit()
		call GroupRemoveUnit(stampedeGroup, firstUnit)
		set h = GetHandleId(firstUnit)

		call DestroyEffect(LoadEffectHandle(ExtraHT, h, HTKEY_STAMPDE_BUFF_COUNT)) // 删除特效
		call RemoveSavedHandle(ExtraHT, h, HTKEY_STAMPDE_BUFF_COUNT)
		call RemoveSavedInteger(ExtraHT, h, HTKEY_STAMPDE_BUFF_COUNT)
		call UnitRemoveAbility(firstUnit,'A2O4')
		call UnitRemoveAbility(firstUnit,'B0GB')
		call EXSetUnitPathing(firstUnit, true)

		set stampedeUnit = null
		set trig = null
		set whichUnit = null
		set stampedeGroup = null
		set targetGroup = null
		set firstUnit = null

		return false
	elseif count >= 76 then

		set isScepterUpgrade = LoadBoolean(HY, h, 20)
		call LogoutGroup(targetGroup)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(trig)

		loop
			set stampedeUnit = FirstOfGroup(stampedeGroup)
			exitwhen stampedeUnit == null
			call GroupRemoveUnit(stampedeGroup, stampedeUnit)

			// 减少计数
			set h = GetHandleId(stampedeUnit)
			set count = LoadInteger(ExtraHT, h, HTKEY_STAMPDE_BUFF_COUNT) - 1
			if count == 0 then
				call DestroyEffect(LoadEffectHandle(ExtraHT, h, HTKEY_STAMPDE_BUFF_COUNT)) // 删除特效
				call RemoveSavedHandle(ExtraHT, h, HTKEY_STAMPDE_BUFF_COUNT)
				call RemoveSavedInteger(ExtraHT, h, HTKEY_STAMPDE_BUFF_COUNT)
				call UnitRemoveAbility(stampedeUnit,'A2O4')
				call UnitRemoveAbility(stampedeUnit,'B0GB')
				call EXSetUnitPathing(stampedeUnit, true)
			else
				call SaveInteger(ExtraHT, h, HTKEY_STAMPDE_BUFF_COUNT, count)
			endif

			// 清空人马大减伤
			if isScepterUpgrade then
				set count = LoadInteger(ExtraHT, h, HTKEY_HAS_STAMPDE_UPGRADE_BUFF) - 1
				if count == 0 then
					call RemoveSavedBoolean(ExtraHT, h, HTKEY_HAS_STAMPDE_UPGRADE_BUFF)
					call RemoveSavedInteger(ExtraHT, h, HTKEY_HAS_STAMPDE_UPGRADE_BUFF)
				else
					call SaveInteger(ExtraHT, h, HTKEY_HAS_STAMPDE_UPGRADE_BUFF, count)
				endif
			endif

		endloop
		call LogoutGroup(stampedeGroup)
		set stampedeUnit = null

		set trig = null
		set whichUnit = null
		set stampedeGroup = null
		set targetGroup = null

		return false
	endif

	call SaveInteger(HY, h, 0, count + 1)

	set tempGroup = LoginGroup(505)
	set Temp__Player = GetOwningPlayer(whichUnit)
	loop
		set stampedeUnit = FirstOfGroup(stampedeGroup)
		exitwhen stampedeUnit == null
		call GroupRemoveUnit(stampedeGroup, stampedeUnit)
		// 把单位加回去 这里只是起到一个中转作用 为了更快遍历单位
		call GroupAddUnit(tempGroup, stampedeUnit)

		set x = GetUnitX(stampedeUnit)
		set y = GetUnitY(stampedeUnit)
		call GroupEnumUnitsInRange(AK, x, y, 175, null)

		loop
			set firstUnit = FirstOfGroup(AK)
			exitwhen firstUnit == null
			call GroupRemoveUnit(AK, firstUnit)

			// 第一次被撞 敌对 存活非守卫非建筑 非魔免 不是肉山
			if not IsUnitInGroup(firstUnit, targetGroup) and IsUnitEnemy(firstUnit, Temp__Player) and IsAliveNotStrucNotWard(firstUnit) and not IsMagicImmuneUnit(firstUnit) and IsNotRoshan(firstUnit) then
				call GroupAddUnit(targetGroup, firstUnit)
				call WJV(firstUnit,'C017','D017', dur)
				call UnitDamageTargetEx(whichUnit, firstUnit, 1, damage)
			endif

		endloop

		call KillDestructablesInCircle(x, y, 150)

	endloop
	set stampedeUnit = null
	set firstUnit = null
	set whichUnit = null

	call LogoutGroup(stampedeGroup)
	set stampedeGroup = null
	call SaveGroupHandle(HY, h, 2, tempGroup)
	set tempGroup = null
	set trig = null

	return false
endfunction

// 给指定单位组添加奔袭冲撞
function GroupAddStampedeEffect takes unit whichUnit, group whichGroup, integer level, boolean isScepterUpgrade returns nothing
	local trigger trig = CreateTrigger()
	local integer h = GetHandleId(trig)
	local integer count
	local unit firstUnit = null
	local group tempGroup = LoginGroup(504)

	call TriggerRegisterTimerEvent(trig, .05, true)
	call TriggerAddCondition(trig, Condition(function StampedeActions))
	call SaveUnitHandle(HY, h, 0, whichUnit)
	call SaveGroupHandle(HY, h, 1, LoginGroup(139))
	call SaveGroupHandle(HY, h, 2, tempGroup)
	call SaveReal(HY, h, 2, 1. + .5 * level)
	call SaveInteger(HY, h, 0, 0)
	call SaveInteger(HY, h, 1, 3)
	call SaveBoolean(HY, h, 20, isScepterUpgrade)

	loop
		set firstUnit = FirstOfGroup(whichGroup)
		exitwhen firstUnit == null
		call GroupRemoveUnit(whichGroup, firstUnit)
		// 把单位加回去 这里只是起到一个中转作用 为了更快遍历单位
		call GroupAddUnit(tempGroup, firstUnit)

		call TriggerRegisterDeathEvent(trig, firstUnit)
		// 如果是神杖升级 就给他绑定一个布尔值 代表该单位拥有神杖升级奔袭冲撞
		set h = GetHandleId(firstUnit)
		if isScepterUpgrade then
			call SaveBoolean(ExtraHT, h, HTKEY_HAS_STAMPDE_UPGRADE_BUFF, true)
			call SaveInteger(ExtraHT, h, HTKEY_HAS_STAMPDE_UPGRADE_BUFF, LoadInteger(ExtraHT, h, HTKEY_HAS_STAMPDE_UPGRADE_BUFF) + 1)
		endif

		set count = LoadInteger(ExtraHT, h, HTKEY_STAMPDE_BUFF_COUNT) 
		if count == 0 then
			call SaveEffectHandle(ExtraHT, h, HTKEY_STAMPDE_BUFF_COUNT, AddSpecialEffectTarget("war3mapImported\\SandBreathDamageSmall.mdx", firstUnit, GetFootAttachPointName(firstUnit)))
			call EXSetUnitPathing(firstUnit, false)
			call UnitAddPermanentAbility(firstUnit,'A2O4')
		endif
		call SaveInteger(ExtraHT, h, HTKEY_STAMPDE_BUFF_COUNT, count + 1 )

	endloop
	call LogoutGroup(whichGroup)
	set firstUnit = null
	set tempGroup = null

	set trig = null
endfunction

// 奔袭冲撞
function SpellEffect__Stampede takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(spellUnit,'A2O6')+ GetUnitAbilityLevel(spellUnit,'A384')
	local sound s = CreateSound("abilities\\Spells\\Other\\Stampede\\StampedeCaster1.wav", false, false, false, 10, 10, "DefaultEAXON")
	local integer i = 1
	local boolean isScepterUpgrade = GetUnitAbilityLevel(spellUnit,'A384')> 0
	local boolean isSentinelsPlayer = IsSentinelsPlayer(GetOwningPlayer(spellUnit))
	local unit firstUnit = null
	local group g
	call StartSound(s)
	call KillSoundWhenDone(s)
	set s = null

	// 原本是按范围寻找99999999 但按范围的实现是枚举范围内所有的单元格 对于这种情况效率会低很多
	// 遍历对应队伍的所有单位
	loop
		exitwhen i == 5
		if isSentinelsPlayer then
			// 如果是近卫施法...
			set Temp__Player = Sentinels[i]
	
		else
			// 如果是天灾施法...
			set Temp__Player = Scourges[i]
	
		endif
		call GroupEnumUnitsOfPlayer(AK, Temp__Player, null)
		set g = LoginGroup(503)
		loop
			set firstUnit = FirstOfGroup(AK)
			exitwhen firstUnit == null
			call GroupRemoveUnit(AK, firstUnit)
			
			// 不是蝗虫 (是有效单位) 存活 不是建筑 不是守卫
			if GetUnitAbilityLevel(firstUnit,'Aloc') <= 0 and UnitIsCanRegisterUnitEvent(firstUnit) and IsAliveNotStrucNotWard(firstUnit) then // and( LoadInteger(HY, GetHandleId(firstUnit),'STMP')!= 1) then
				//if firstUnit != spellUnit then
				//	call EPX(firstUnit,'STMP', 45)
				//endif
				//call SingleDebug( GetUnitName( firstUnit ) + " 添加奔袭冲撞 " )
				call GroupAddUnit(g, firstUnit)
	
			endif
	
		endloop

		// 如果没有匹配单位就什么也不干
		if FirstOfGroup(g) == null then
			call LogoutGroup(g)
		else
			call GroupAddStampedeEffect(spellUnit, g, level, isScepterUpgrade)
		endif
		set i = i + 1
	endloop

	set g = null
	set firstUnit = null
	set spellUnit = null
endfunction
function MJX takes nothing returns nothing
	local sound s = CreateSound("abilities\\Spells\\Other\\Stampede\\StampedeCaster1.wav", false, false, false, 10, 10, "DefaultEAXON")
	call StartSound(s)
	call KillSoundWhenDone(s)
	set s = null
endfunction
function HoofStompDE takes nothing returns nothing
	local integer lv = GetUnitAbilityLevel(DESourceUnit[DEI],'A3IA')
	if lv > 0 then
		call CommonUnitAddStun(DETargetUnit[DEI], lv * .25 + 1.75, false)
	endif
endfunction
function ZEV takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0)
	call UnitAddAbility(d,'A3IA')
	call TGV(1)
	call SetUnitAbilityLevel(d,'A3IA', GetUnitAbilityLevel(GetTriggerUnit(),'A00S'))
	call IssueImmediateOrderById(d,$D009F)
	call UnitRemoveAbility(d,'A3IA')
	set d = null
endfunction
function HTR takes nothing returns boolean
	local unit t = GetFilterUnit()
	local unit u = QF
	if IsUnitEnemy(u, GetOwningPlayer(t)) and UnitAlive(t) and IsMagicImmuneUnit(t)== false and GetUnitAbilityLevel(t,'A04R')== 0 and IsUnitType(t, UNIT_TYPE_STRUCTURE)== false then
		call UnitDamageTargetEx(u, t, 1, PF)
	endif
	set u = null
	set t = null
	return false
endfunction
function HUR takes unit u, unit t, integer level, boolean FAR returns nothing
	local real x = GetWidgetX(t)
	local real y = GetWidgetY(t)
	local group g
	if GetUnitAbilityLevel(t,'A3E9')== 1 and not FAR and GetUnitAbilityLevel(u,'A04R')== 0 then
		call SaveUnitHandle(VV,'A3E9', 0, t)
		call SaveUnitHandle(VV,'A3E9', 1, u)
		call SaveInteger(VV,'A3E9', 0, level)
		call ExecuteFunc("HWR")
	endif
	if UnitHasSpellShield(t)== false then
		set g = LoginGroup(140)
		set QF = u
		set PF = 100 + level * 75
		call GroupEnumUnitsInRange(g, x, y,$D7, Condition(function HTR))
		call DestroyEffect(AddSpecialEffect("war3mapImported\\DoubleEdgeTarget.mdx", x, y))
		if GetWidgetLife(u)< PF * .75 then
			set PF = R2I(GetWidgetLife(u)/ .75)-$A
		endif
		call UnitDamageTargetEx(u, u, 1, PF)
		call LogoutGroup(g)
	elseif FAR then
		call AJO(t)
	endif
endfunction
function ZVV takes nothing returns nothing
	call HUR(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(),'A00L'), false)
endfunction
function HWR takes nothing returns nothing
	call T4V(LoadUnitHandle(VV,'A3E9', 0))
	call HUR(LoadUnitHandle(VV,'A3E9', 0), LoadUnitHandle(VV,'A3E9', 1), LoadInteger(VV,'A3E9', 0), true)
	call FlushChildHashtable(VV,'A3E9')
endfunction
function KBE takes nothing returns nothing
	call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\DoubleEdgeCaster.mdx", GetTriggerUnit(), "hand, right"))
endfunction
function HYR takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(P, h, 0)
	if GetUnitAbilityLevel(u,'A3KA')== 1 then
		call SetUnitX(u, LoadReal(P, h, 0))
		call SetUnitY(u, LoadReal(P, h, 1))
	endif
	call UnitRemoveAbility(u,'A3KA')
	call FlushChildHashtable(P, h)
	call CleanCurrentTrigger(t)
	set t = null
	set u = null
endfunction
function HZR takes unit u, real x, real y, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer S7V = 7 -level
	call SaveUnitHandle(P, h, 0, u)
	call UnitAddPermanentAbility(u,'A3KA')
	call SaveReal(P, h, 0, x)
	call SaveReal(P, h, 1, y)
	call TriggerRegisterTimerEvent(t, S7V, false)
	call TriggerAddCondition(t, Condition(function HYR))
	set t = null
endfunction
function H_R takes nothing returns boolean
	return UnitIsDead(GetFilterUnit())== false and((GetUnitAbilityLevel(GetFilterUnit(),'A0KO')== 1) or(GetUnitAbilityLevel(GetFilterUnit(),'A0KQ')== 1) or(GetUnitAbilityLevel(GetFilterUnit(),'A0KR')== 1) or(GetUnitAbilityLevel(GetFilterUnit(),'A0KP')== 1))
endfunction
function H0R takes nothing returns boolean
	return UnitIsDead(GetFilterUnit())== false and GetUnitAbilityLevel(GetFilterUnit(),'Aloc')== 0 and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and IsUnitIdType(GetUnitTypeId(GetFilterUnit()), UNIT_TYPE_HERO)== false
endfunction
function H1R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit H2R = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	else
		call SetUnitPosition(WLE, GetUnitX(H2R)+ GetRandomReal(50, 100)* Cos(GetRandomReal(0, 359)* bj_DEGTORAD), GetUnitY(H2R)+ GetRandomReal(50, 100)* Sin(GetRandomReal(0, 359)* bj_DEGTORAD))
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	endif
	set H2R = null
	set WLE = null
	set t = null
	return false
endfunction
function H3R takes unit H2R, unit WLE returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer S7V = 7 -GetUnitAbilityLevel(H2R,'A0LV')
	call TriggerRegisterTimerEvent(t, S7V, false)
	call TriggerRegisterDeathEvent(t, H2R)
	call TriggerRegisterDeathEvent(t, WLE)
	call TriggerAddCondition(t, Condition(function H1R))
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("effects\\Test_of_Faith_FX.mdx", WLE, "overhead"))
	call SaveUnitHandle(HY, h, 0, H2R)
	call SaveUnitHandle(HY, h, 1, WLE)
	set t = null
endfunction
function YCV takes nothing returns nothing
	local unit u = GetSpellTargetUnit()
	local unit H2R = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local integer level = GetUnitAbilityLevel(H2R,'A2MC')
	local real x
	local real y
	local group g
	local unit u2
	if IsSentinelsPlayer(p) then
		set x = GetRectCenterX(VZ)
		set y = GetRectCenterY(VZ)
	else
		set x = GetRectCenterX(GY)
		set y = GetRectCenterY(GY)
	endif
	if IsUnitType(u, UNIT_TYPE_HERO) and p != GetOwningPlayer(H2R) then
		if LoadBoolean(HY, GetHandleId(u), 80) then
			call InterfaceErrorForPlayer(GetOwningPlayer(H2R), GetObjectName('n036'))
		elseif LoadBoolean(HY, GetHandleId(p),$8B)== false then
			call HZR(u, x, y, level)
		else
			call InterfaceErrorForPlayer(GetOwningPlayer(H2R), GetObjectName('n038'))
		endif
	elseif u == H2R then
		set g = LoginGroup(141)
		set U2 = H2R
		call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(H2R), Condition(function H0R))
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			call H3R(H2R, u2)
			call GroupRemoveUnit(g, u2)
		endloop
		call LogoutGroup(g)
	else
		call SetUnitX(u, x)
		call SetUnitY(u, y)
	endif
	set p = null
	set u = null
	set H2R = null
endfunction
function H4R takes unit u, unit t returns nothing
	local integer WUV = GetUnitAbilityLevel(u,'A0LV')
	local integer CJR = 0
	if WUV == 4 then
		set CJR = GetRandomInt(275, 400)
	elseif WUV == 3 then
		set CJR = GetRandomInt($E1, 300)
	elseif WUV == 2 then
		set CJR = GetRandomInt(125, 200)
	elseif WUV == 1 then
		set CJR = GetRandomInt(75, 150)
	endif
	call UnitDamageTargetEx(u, t, 3, CJR)
	call CommonTextTag(I2S(CJR), 1, t, .023, 255, 255, 0,$D8)
endfunction
function H5R takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call H4R(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function YBV takes nothing returns nothing
	local timer t
	local integer h
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, 0, false, function H5R)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		set t = null
	endif
endfunction
function P7E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	if GetUnitAbilityLevel(u,'A2MC')== 0 then
		call UnitAddPermanentAbility(u,'A2MC')
	endif
	call SetUnitAbilityLevel(u,'A2MC', GetUnitAbilityLevel(u,'A0LV'))
	set u = null
endfunction

function PenitenceEnd takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer level =(LoadInteger(HY,(h), 5))
	local real data = LoadReal(HY, h, 5)

	local unit targetUnit = LoadUnitHandle(HY, h, 0)
	local integer hu = GetHandleId(targetUnit)

	set data = LoadReal(ExtraHT, hu, 'A0KM') - data
	call SaveReal(ExtraHT, hu, 'A0KM', data)
	if data == 0. then
		//call BJDebugMsg("赎罪"+R2S(data))
		call RemoveSavedReal(ExtraHT, hu, 'A0KM')
		call UnitRemoveAbility(targetUnit, 'A3QU')
		call UnitRemoveAbility(targetUnit, 'B05H')
	endif

	call FlushChildHashtable(HY,(h))
	call CleanCurrentTrigger(t)
	set t = null
	set targetUnit = null
endfunction
// 赎罪
function SpellEffect__Penitence takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer hu
	local unit targetUnit = GetSpellTargetUnit()
	local unit spellUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(spellUnit,'A0KM')
	local real data = .1 + .05 * level

	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl", spellUnit, "chest"))
	call SaveInteger(HY,(h), 5,(level))
	call TriggerRegisterTimerEvent(t, 7, false)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call SaveUnitHandle(HY, h, 0, targetUnit)
	call UnitAddPermanentAbilitySetLevel(targetUnit,'A3QU', level)
	call SaveReal(HY, h, 5, data)
	call TriggerAddCondition(t, Condition(function PenitenceEnd))

	set hu = GetHandleId(targetUnit)
	call SaveReal(ExtraHT, hu, 'A0KM', LoadReal(ExtraHT, hu, 'A0KM') + data)
	call EnableEffectByTime(EFFECT_KEY_PENITENCE, 7.)

	set t = null
	set spellUnit = null
	set targetUnit = null
endfunction
function H7R takes nothing returns boolean
	return(H_R() and IsUnitType(GetFilterUnit(), UNIT_TYPE_ANCIENT))!= null
endfunction
function H8R takes group g returns unit
	local unit u
	local real H9R = 99999.
	set U2 = null
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if LoadReal(HY, GetHandleId(u),'0age')< H9R then
			set U2 = u
			set H9R = LoadReal(HY, GetHandleId(u),'0age')
		endif
		call GroupRemoveUnit(g, u)
	endloop
	set u = null
	return U2
endfunction
function JVR takes unit WLE returns nothing
	local unit H2R = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(H2R,'A28T')+ GetUnitAbilityLevel(H2R,'A361')
	local integer WOV = level
	local integer i
	local integer JER
	local group g = LoginGroup(142)
	local integer JXR
	if IsUnitType(WLE, UNIT_TYPE_ANCIENT) then
		call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(H2R), Condition(function H7R))
		set JER = CountUnitsInGroup(g)
		set JXR = IMinBJ(R2I((GetUnitLevel(H2R)-1)/ 5), 3)
		if JER >= JXR then
			call KillUnit(H8R(g))
		endif
	endif
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(H2R), Condition(function H_R))
	set i = CountUnitsInGroup(g)
	if i == WOV then
		call KillUnit(H8R(g))
	endif
	call LogoutGroup(g)
	set g = null
	if IsSentinelsPlayer(GetOwningPlayer(H2R)) then
		call UnitShareVision(WLE, Scourges[0], false)
		call UnitShareVision(WLE, Scourges[1], false)
		call UnitShareVision(WLE, Scourges[2], false)
		call UnitShareVision(WLE, Scourges[3], false)
		call UnitShareVision(WLE, Scourges[4], false)
		call UnitShareVision(WLE, Scourges[5], false)
	else
		call UnitShareVision(WLE, Sentinels[0], false)
		call UnitShareVision(WLE, Sentinels[1], false)
		call UnitShareVision(WLE, Sentinels[2], false)
		call UnitShareVision(WLE, Sentinels[3], false)
		call UnitShareVision(WLE, Sentinels[4], false)
		call UnitShareVision(WLE, Sentinels[5], false)
	endif
	call I8X(WLE)
	call UnitAddPermanentAbility(WLE,'A0KO')
	if GetUnitState(WLE, UNIT_STATE_MAX_LIFE)< 600 + 100 * level then
		call UnitAddMaxLife(WLE, R2I(600 + 100 * level -GetUnitState(WLE, UNIT_STATE_MAX_LIFE)))
	endif
	call SaveReal(HY, GetHandleId(WLE),'0age', GetGameTime())
	call UnitAddPermanentAbility(WLE,'A12G')
	set i = GetUnitAbilityLevel(H2R,'A0A8')
	if i > 0 then
		call SetUnitMoveSpeed(WLE, GetUnitDefaultMoveSpeed(WLE)+ 20 +$A* i)
	endif
	set H2R = null
endfunction
function JOR takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local unit dummyUnit
	if IsUnitEnemy(targetUnit, GetOwningPlayer(WUE)) then
		set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitAddAbility(dummyUnit,'A069')
		call IssueTargetOrderById(dummyUnit,$D0265, targetUnit)
		call JVR(targetUnit)
	endif
	set WUE = null
	set targetUnit = null
	set dummyUnit = null
endfunction
function ZOV takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call JOR()
	endif
endfunction
function KCE takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	if IsUnitEnemy(WLE, GetOwningPlayer(WJE)) then
		if IsUnitType(WLE, UNIT_TYPE_HERO) or IsUnitIllusion(WLE) or IsBearUnit(WLE) then
			call EXStopUnit(WJE)
			call InterfaceErrorForPlayer(GetOwningPlayer(WJE), GetObjectName('n0K9'))
		elseif IsUnitType(WLE, UNIT_TYPE_ANCIENT) and GetSpellAbilityId()!='A361' then
			call EXStopUnit(WJE)
			call InterfaceErrorForPlayer(GetOwningPlayer(WJE), "只有在拥有蓝杖后才可以劝化远古单位!")
		endif
	endif
	set WJE = null
	set WLE = null
endfunction
function JRR takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and GetWidgetLife(GetFilterUnit())> 1))
endfunction
function ZRV takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A0LT')
	local group g = LoginGroup(143)
	local unit u2
	local boolean b = false
	if level == 0 then
		set level = GetUnitAbilityLevel(u,'A1CS')
		set b = true
	endif
	call GroupEnumUnitsInRect(g, bj_mapInitialPlayableArea, Condition(function JRR))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		if(IsUnitAlly(u2, GetOwningPlayer(u))) then
			if OYX(u2)== false then
				if b then
					call SetWidgetLife(u2, GetWidgetLife(u2)+ .3 * GetUnitState(u, UNIT_STATE_MAX_LIFE))
				endif
				call SetWidgetLife(u2, GetWidgetLife(u2)+ 100 + 200 * level)
			endif
			call DestroyEffect(AddSpecialEffectTargetUnitBJ("chest", u2, "Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl"))
		endif
		call GroupRemoveUnit(g, u2)
	endloop
	call LogoutGroup(g)
	set g = LoginGroup(144)
	set bj_groupEnumOwningPlayer = GetOwningPlayer(u)
	call GroupEnumUnitsInRect(g, GetWorldBounds(), filterGetUnitsInRectOfPlayer)
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		if(IsUnitType(u2, UNIT_TYPE_HERO)== false and GetUnitTypeId(u2)!='n00C') then
			call SetWidgetLife(u2, 99999999)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", u2, "chest"))
		endif
		call GroupRemoveUnit(g, u2)
	endloop
	call LogoutGroup(g)
	set g = null
	set u = null
	set u2 = null
endfunction
function JIR takes nothing returns nothing
	if IsMessengerUnit(GetEnumUnit())== false then
		call UnitDamageTargetEx(HKV, GetEnumUnit(), 1, HJV)
	endif
endfunction
function JAR takes unit WUE, real x, real y, integer level returns nothing
	local real x1
	local real y1
	local group g = LoginGroup(145)
	local real IXX = 40 + 40 * level
	set U2 = WUE
	set HKV = WUE
	set HJV = IXX
	call GroupEnumUnitsInRange(g, x, y, 600, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	call ForGroup(g, function JIR)
	call LogoutGroup(g)
	set x1 = x
	set y1 = y
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x1, y1))
	set x1 = x +$C8
	set y1 = y +$C8
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x1, y1))
	set x1 = x +$C8
	set y1 = y -$C8
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x1, y1))
	set x1 = x -$C8
	set y1 = y +$C8
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x1, y1))
	set x1 = x -$C8
	set y1 = y -$C8
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x1, y1))
	call A8X(GetOwningPlayer(WUE), 10, x, y, 600)
	set g = null
endfunction
function JNR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit
	local unit NIX = LoadUnitHandle(HY, h, 45)
	local real W_E = LoadReal(HY, h, 47)
	local real W0E = LoadReal(HY, h, 48)
	local real a = LoadReal(HY, h, 13)
	local real WYE = LoadReal(HY, h, 189)
	local real WZE = LoadReal(HY, h,$BE)
	local real NBX = CoordinateX50(WYE + 44 * Cos(a))
	local real NCX = CoordinateY50(WZE + 44 * Sin(a))
	local real JBR
	local real JCR
	local integer level = LoadInteger(HY, h, 0)
	call SetUnitX(NIX, NBX)
	call SetUnitY(NIX, NCX)
	call SaveReal(HY, h, 189, NBX * 1.)
	call SaveReal(HY, h, 190, NCX * 1.)
	if GetDistanceBetween(W_E, W0E, NBX, NCX)<= 35 then
		call KillUnit(NIX)
		set triggerUnit = LoadUnitHandle(HY, h, 14)
		call JAR(triggerUnit, NBX, NCX, level)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set triggerUnit = null
	set NIX = null
	return false
endfunction
function ZAV takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local real WYE = CoordinateX50(GetUnitX(triggerUnit))
	local real WZE = CoordinateY50(GetUnitY(triggerUnit))
	local real W_E = CoordinateX50(GetSpellTargetX())
	local real W0E = CoordinateY50(GetSpellTargetY())
	local real a = Atan2(W0E -WZE, W_E -WYE)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit NIX = CreateUnit(GetOwningPlayer(triggerUnit),'h03Y', WYE, WZE, a * bj_RADTODEG)
	call SetUnitFacing(NIX, a * bj_RADTODEG)
	call SetUnitPathing(NIX, false)
	call UnitAddPermanentAbility(NIX,'Aloc')
	call ShowUnit(NIX, false)
	call UnitRemoveAbility(NIX,'Aloc')
	call ShowUnit(NIX, true)
	call SaveReal(HY, h, 191, WYE * 1.)
	call SaveReal(HY, h, 192, WZE * 1.)
	call SaveReal(HY, h, 189, WYE * 1.)
	call SaveReal(HY, h, 190, WZE * 1.)
	call SaveReal(HY, h, 47, W_E * 1.)
	call SaveReal(HY, h, 48, W0E * 1.)
	call SaveReal(HY, h, 13, a * 1.)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(triggerUnit, GetSpellAbilityId()))
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	call SaveUnitHandle(HY, h, 45, NIX)
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function JNR))
	set triggerUnit = null
	set t = null
	set NIX = null
endfunction
function JDR takes real s, real d1, real d2, real d3 returns boolean
	return s <= d1 and s <= d2 and s <= d3
endfunction
function JFR takes unit u, real x, real y, real d returns real
	local real x2 = GetUnitX(u)
	local real y2 = GetUnitY(u)
	local real JGR = GetDistanceBetween(x -d, y, x2, y2)
	local real JHR = GetDistanceBetween(x + d, y, x2, y2)
	local real JJR = GetDistanceBetween(x, y + d, x2, y2)
	local real JKR = GetDistanceBetween(x, y -d, x2, y2)
	if JDR(JGR, JHR, JKR, JJR) then
		return 180.
	elseif JDR(JHR, JGR, JKR, JJR) then
		return .0
	elseif JDR(JKR, JHR, JGR, JJR) then
		return 270.
	endif
	return 90.
endfunction
function JLR takes real s, real d1, real d2, real d3, real d4, real d5, real d6, real d7 returns boolean
	return s <= d1 and s <= d2 and s <= d3 and s <= d4 and s <= d5 and s <= d6 and s <= d7
endfunction
function JMR takes unit u, integer h returns unit
	local real x1 = GetUnitX(u)
	local real y1 = GetUnitY(u)
	local unit JPR =(LoadUnitHandle(HY, h,($44C+ 1)))
	local unit JQR =(LoadUnitHandle(HY, h,($44C+ 2)))
	local unit JSR =(LoadUnitHandle(HY, h,($44C+ 3)))
	local unit JTR =(LoadUnitHandle(HY, h,($44C+ 4)))
	local unit JUR =(LoadUnitHandle(HY, h,($44C+ 5)))
	local unit JWR =(LoadUnitHandle(HY, h,($44C+ 6)))
	local unit JYR =(LoadUnitHandle(HY, h,($44C+ 7)))
	local unit JZR =(LoadUnitHandle(HY, h,($44C+ 8)))
	local real d1 = GetDistanceBetween(x1, y1, GetUnitX(JPR), GetUnitY(JPR))
	local real d2 = GetDistanceBetween(x1, y1, GetUnitX(JQR), GetUnitY(JQR))
	local real d3 = GetDistanceBetween(x1, y1, GetUnitX(JSR), GetUnitY(JSR))
	local real d4 = GetDistanceBetween(x1, y1, GetUnitX(JTR), GetUnitY(JTR))
	local real d5 = GetDistanceBetween(x1, y1, GetUnitX(JUR), GetUnitY(JUR))
	local real d6 = GetDistanceBetween(x1, y1, GetUnitX(JWR), GetUnitY(JWR))
	local real d7 = GetDistanceBetween(x1, y1, GetUnitX(JYR), GetUnitY(JYR))
	local real d8 = GetDistanceBetween(x1, y1, GetUnitX(JZR), GetUnitY(JZR))
	if JLR(d1, d2, d3, d4, d5, d6, d7, d8) then
		set JQR = null
		set JSR = null
		set JTR = null
		set JUR = null
		set JWR = null
		set JYR = null
		set JZR = null
		return JPR
	elseif JLR(d2, d1, d3, d4, d5, d6, d7, d8) then
		set JPR = null
		set JSR = null
		set JTR = null
		set JUR = null
		set JWR = null
		set JYR = null
		set JZR = null
		return JQR
	elseif JLR(d3, d2, d1, d4, d5, d6, d7, d8) then
		set JPR = null
		set JQR = null
		set JTR = null
		set JUR = null
		set JWR = null
		set JYR = null
		set JZR = null
		return JSR
	elseif JLR(d4, d2, d3, d1, d5, d6, d7, d8) then
		set JPR = null
		set JQR = null
		set JSR = null
		set JUR = null
		set JWR = null
		set JYR = null
		set JZR = null
		return JTR
	elseif JLR(d5, d2, d3, d4, d1, d6, d7, d8) then
		set JPR = null
		set JQR = null
		set JSR = null
		set JTR = null
		set JWR = null
		set JYR = null
		set JZR = null
		return JUR
	elseif JLR(d6, d2, d3, d4, d5, d1, d7, d8) then
		set JPR = null
		set JQR = null
		set JSR = null
		set JTR = null
		set JUR = null
		set JYR = null
		set JZR = null
		return JWR
	elseif JLR(d7, d2, d3, d4, d5, d6, d1, d8) then
		set JPR = null
		set JQR = null
		set JSR = null
		set JTR = null
		set JUR = null
		set JWR = null
		set JZR = null
		return JYR
	elseif JLR(d8, d2, d3, d4, d5, d6, d7, d1) then
		set JPR = null
		set JQR = null
		set JSR = null
		set JTR = null
		set JUR = null
		set JWR = null
		set JYR = null
		return JZR
	endif
	return null
endfunction
function J_R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real a =(LoadReal(HY, h, 13))
	local real x = GetUnitX(targetUnit)
	local real y = GetUnitY(targetUnit)
	local real J0R = 7.5
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local integer level =(LoadInteger(HY, h, 5))
	local integer J1R = 40 + 40 * level
	if GetTriggerEvalCount(t)> 34 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SaveInteger(HY,(GetHandleId((targetUnit))),(4260), 2)
		call UnitDamageTargetEx(WUE, targetUnit, 1, J1R)
		call SetUnitState(targetUnit, UNIT_STATE_MANA, RMaxBJ(GetUnitState(targetUnit, UNIT_STATE_MANA)-J1R, 0))
	else
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl", x, y))
		call KillDestructablesInCircle(x, y, 150)
		if((LoadInteger(HY,(GetHandleId((targetUnit))),(4261)))== 1)== false then
			call SetUnitPosition(targetUnit, x + J0R * Cos(a * bj_DEGTORAD), y + J0R * Sin(a * bj_DEGTORAD))
		endif
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function J2R takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = GetEnumUnit()
	local real x = S2
	local real y = TJ
	local real d = RJ
	local real a = JFR(targetUnit, x, y, d)
	local real x2 = GetWidgetX(targetUnit)
	local real y2 = GetWidgetY(targetUnit)
	local real d2 = d -SquareRoot((x -x2)*(x -x2)+(y -y2)*(y -y2))+ 100 
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl", targetUnit, "chest"))
	call SaveInteger(HY,(GetHandleId((targetUnit))),(4260), 1)
	if d2 > 0 then
		call SetUnitX(targetUnit, x2 + d2 * Cos(a * bj_DEGTORAD))
		call SetUnitY(targetUnit, y2 + d2 * Sin(a * bj_DEGTORAD))
	endif
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveInteger(HY, h, 5,(Q2))
	call SaveUnitHandle(HY, h, 2,(U2))
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function J_R))
	set t = null
	set targetUnit = null
endfunction
function J3R takes unit u, integer h returns boolean
	local unit J4R = JMR(u, h)
	local boolean JVX = true
	if UnitIsDead(J4R) or(LoadInteger(HY,(GetHandleId(J4R)),$9C))== 1 then
		set JVX = false
	endif
	call SaveInteger(HY,(GetHandleId(J4R)),$9C, 1)
	call SetUnitVertexColor(J4R, 25, 25, 25, 175)
	set J4R = null
	return JVX
endfunction
function J5R takes nothing returns nothing
	if GetUnitState(GetEnumUnit(), UNIT_STATE_MANA)> 0 and IsUnitInGroup(GetEnumUnit(), DK)== false and((LoadInteger(HY, GetHandleId(GetEnumUnit()), 4260))== 1)== false and J3R(GetEnumUnit(), HLV) then
		call SaveInteger(HY, GetHandleId(GetEnumUnit()), 4260, 1)
		call GroupAddUnit(EK, GetEnumUnit())
	endif
endfunction
function J6R takes trigger t, unit triggerUnit, real x, real y, real d, integer level returns nothing
	local integer h = GetHandleId(t)
	local real J7R =$C8
	local rect r1 = Rect(x -d, y -d, x + d, y + d)
	local rect r2 = Rect(x -d -J7R, y -d -J7R, x + d + J7R, y + d + J7R)
	local group g1 = LoginGroup(146)
	local group g2 = LoginGroup(147)
	local group g3 = LoginGroup(148)
	set U2 = triggerUnit
	call GroupEnumUnitsInRect(g1, r1, Condition(function DQX))
	call GroupEnumUnitsInRect(g2, r2, Condition(function DQX))
	set DK = g1
	set EK = g3
	set S2 = x
	set TJ = y
	set RJ = d
	set HLV = h
	call ForGroup(g2, function J5R)
	set Q2 = level
	call ForGroup(g3, function J2R)
	call LogoutGroup(g1)
	call LogoutGroup(g2)
	call LogoutGroup(g3)
	call RemoveRect(r1)
	call RemoveRect(r2)
	set g1 = null
	set g2 = null
	set g3 = null
	set r1 = null
	set r2 = null
endfunction
function J8R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local player p =(LoadPlayerHandle(HY, h, 54))
	local boolean J9R =(LoadBoolean(HY, h,$9B))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	if J9R then
		call A8X(p, .2, x, y, 500)
	endif
	set t = null
	set p = null
	return false
endfunction
function KVR takes unit KER returns nothing
	local real x = GetUnitX(KER)
	local real y = GetUnitY(KER)
	local player p = GetOwningPlayer(KER)
	local unit dummyUnit = CreateUnit(p,'u00W', x, y, 0)
	call KillUnit(dummyUnit)
	set p = null
	set dummyUnit = null
endfunction
function KXR takes integer h, real x, real y, boolean J9R, player p returns nothing
	local unit JPR =(LoadUnitHandle(HY, h,($44C+ 1)))
	local unit JQR =(LoadUnitHandle(HY, h,($44C+ 2)))
	local unit JSR =(LoadUnitHandle(HY, h,($44C+ 3)))
	local unit JTR =(LoadUnitHandle(HY, h,($44C+ 4)))
	local unit JUR =(LoadUnitHandle(HY, h,($44C+ 5)))
	local unit JWR =(LoadUnitHandle(HY, h,($44C+ 6)))
	local unit JYR =(LoadUnitHandle(HY, h,($44C+ 7)))
	local unit JZR =(LoadUnitHandle(HY, h,($44C+ 8)))
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .1, false)
	call TriggerAddCondition(t, Condition(function J8R))
	call SaveReal(HY,(GetHandleId(t)), 6,((x)* 1.))
	call SaveReal(HY,(GetHandleId(t)), 7,((y)* 1.))
	call SavePlayerHandle(HY,(GetHandleId(t)), 54,(p))
	call SaveBoolean(HY,(GetHandleId(t)), 155,(J9R))
	call KVR(JPR)
	call RemoveUnit(JPR)
	call KVR(JQR)
	call RemoveUnit(JQR)
	call KVR(JSR)
	call RemoveUnit(JSR)
	call KVR(JTR)
	call RemoveUnit(JTR)
	call KVR(JUR)
	call RemoveUnit(JUR)
	call KVR(JWR)
	call RemoveUnit(JWR)
	call KVR(JYR)
	call RemoveUnit(JYR)
	call KVR(JZR)
	call RemoveUnit(JZR)
	set t = null
	set JPR = null
	set JQR = null
	set JSR = null
	set JTR = null
	set JUR = null
	set JWR = null
	set JYR = null
	set JZR = null
endfunction
function KOR takes unit KER, integer h, integer ADX, player p returns nothing
	if UnitVisibleToPlayer(KER, p) then
		call SaveBoolean(HY, h, 155,(true))
	endif
	call SaveUnitHandle(HY, h,($44C+ ADX),(KER))
endfunction
function KRR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real N5O =(LoadReal(HY, h, 57))
	local integer EVX = GetTriggerEvalCount(t)
	if EVX > R2I(N5O * 10) then
		call KXR(h,(LoadReal(HY, h, 6)),(LoadReal(HY, h, 7)),(LoadBoolean(HY, h,$9B)),(LoadPlayerHandle(HY, h,$9A)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call J6R(t,(LoadUnitHandle(HY, h, 14)),(LoadReal(HY, h, 6)),(LoadReal(HY, h, 7)),(LoadReal(HY, h, 138)),(LoadInteger(HY, h, 5)))
	endif
	set t = null
	return false
endfunction
function KIR takes nothing returns nothing
	call SetUnitX(GetEnumUnit(), GetUnitX(U2))
	call SetUnitY(GetEnumUnit(), GetUnitY(U2))
endfunction
function KAR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0Z5')
	local integer ID ='u00S'
	local real x1 = R2I(GetUnitX(triggerUnit))-ModuloInteger(R2I(GetUnitX(triggerUnit)), 64)
	local real y1 = R2I(GetUnitY(triggerUnit))-ModuloInteger(R2I(GetUnitY(triggerUnit)), 64)
	local real x2
	local real y2
	local real d =$80
	local unit KER
	local real N5O = 4 + level
	local real BufferDuration = 5
	local group g
	local rect KNR
	local player XSR
	local real L2O = 3
	if level < 4 then
		set L2O = 2
	endif
	if IsSentinelsPlayer(GetOwningPlayer(triggerUnit)) then
		set XSR = Scourges[0]
	else
		set XSR = Sentinels[0]
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SaveBoolean(HY, h, 155,(false))
	set g = LoginGroup(149)
	set d = d + 110
	set KNR = Rect(x1 -d, y1 -d, x1 + d, y1 + d)
	set d = d -110
	set U2 = triggerUnit
	call GroupEnumUnitsInRect(g, KNR, Condition(function D7X))
	set x2 = x1 + d
	set y2 = y1
	set KER = CreateUnit(GetOwningPlayer(triggerUnit), ID, x2, y2, 0)
	call SetWidgetLife(KER, L2O)
	call SetUnitPosition(KER, x2, y2)
	call KOR(KER, h, 1, XSR)
	set x2 = x1 + d
	set y2 = y1 + d
	set KER = CreateUnit(GetOwningPlayer(triggerUnit), ID, x2, y2, 0)
	call SetUnitPosition(KER, x2, y2)
	call SetWidgetLife(KER, L2O)
	call KOR(KER, h, 2, XSR)
	set x2 = x1
	set y2 = y1 + d
	set KER = CreateUnit(GetOwningPlayer(triggerUnit), ID, x2, y2, 0)
	call SetUnitPosition(KER, x2, y2)
	call SetWidgetLife(KER, L2O)
	call KOR(KER, h, 3, XSR)
	set x2 = x1 -d
	set y2 = y1 + d
	set KER = CreateUnit(GetOwningPlayer(triggerUnit), ID, x2, y2, 0)
	call SetUnitPosition(KER, x2, y2)
	call SetWidgetLife(KER, L2O)
	call KOR(KER, h, 4, XSR)
	set x2 = x1 -d
	set y2 = y1
	set KER = CreateUnit(GetOwningPlayer(triggerUnit), ID, x2, y2, 0)
	call SetUnitPosition(KER, x2, y2)
	call SetWidgetLife(KER, L2O)
	call KOR(KER, h, 5, XSR)
	set x2 = x1 -d
	set y2 = y1 -d
	set KER = CreateUnit(GetOwningPlayer(triggerUnit), ID, x2, y2, 0)
	call SetUnitPosition(KER, x2, y2)
	call SetWidgetLife(KER, L2O)
	call KOR(KER, h, 6, XSR)
	set x2 = x1
	set y2 = y1 -d
	set KER = CreateUnit(GetOwningPlayer(triggerUnit), ID, x2, y2, 0)
	call SetUnitPosition(KER, x2, y2)
	call SetWidgetLife(KER, L2O)
	call KOR(KER, h, 7, XSR)
	set x2 = x1 + d
	set y2 = y1 -d
	set KER = CreateUnit(GetOwningPlayer(triggerUnit), ID, x2, y2, 0)
	call SetUnitPosition(KER, x2, y2)
	call SetWidgetLife(KER, L2O)
	call KOR(KER, h, 8, XSR)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function KRR))
	call SaveReal(HY, h, 57,((N5O)* 1.))
	call SaveReal(HY, h, 6,((x1)* 1.))
	call SaveReal(HY, h, 7,((y1)* 1.))
	call SaveReal(HY, h, 138,((d)* 1.))
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call SaveInteger(HY, h, 5,(level))
	call SavePlayerHandle(HY, h,$9A,(XSR))
	call ForGroup(g, function KIR)
	call LogoutGroup(g)
	set t = null
	set g = null
	set triggerUnit = null
	set KER = null
	set KNR = null
	set XSR = null
	return false
endfunction
function ZNV takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = GetTriggerUnit()
	call TriggerRegisterTimerEvent(t, .1, false)
	call TriggerAddCondition(t, Condition(function KAR))
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	set t = null
	set triggerUnit = null
endfunction
function KBR takes unit WUE, unit targetUnit returns nothing
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local integer level = GetUnitAbilityLevel(WUE,'A0Z8')
	if level == 0 then
		set level = GetUnitAbilityLevel(WUE,'A1CV')
	endif
	call UnitAddPermanentAbility(dummyUnit,'A0Z9')
	call SetUnitAbilityLevel(dummyUnit,'A0Z9', level)
	call IssueTargetOrderById(dummyUnit, 852095, targetUnit)
	set dummyUnit = null
endfunction
function KCR takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), DK)== false then
		call GroupAddUnit(DK, GetEnumUnit())
		call KBR(U2, GetEnumUnit())
	endif
endfunction
function KDR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer KFR = LoadInteger(HY, h, 18)
	local integer EVX = GetTriggerEvalCount(t)
	local unit KGR
	local group KHR = LoadGroupHandle(HY, h, 16)
	local group g
	local real KJR =$C8
	if targetUnit == null then
		set KGR = LoadUnitHandle(HY, h, 700 + KFR + 1 -EVX)
		call RemoveUnit(KGR)
	else
		set KGR = LoadUnitHandle(HY, h, 700 + EVX)
		if IsUnitType(triggerUnit, UNIT_TYPE_HERO) then
			call SaveBoolean(K, GetHandleId(triggerUnit), 99, true)
		endif
		call SetUnitX(triggerUnit, GetUnitX(KGR))
		call SetUnitY(triggerUnit, GetUnitY(KGR))
		call RemoveUnit(KGR)
		if EVX == KFR then
			set KJR =$E1
		endif
		set g = LoginGroup(150)
		set U2 = triggerUnit
		set DK = KHR
		call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), KJR, Condition(function DMX))
		call ForGroup(g, function KCR)
		call LogoutGroup(g)
	endif
	if EVX ==(KFR) then
		if targetUnit != null then
			call PauseUnit(targetUnit, false)
		endif
		call KillDestructablesInCircle(GetUnitX(triggerUnit), GetUnitY(triggerUnit), 100)
		call LogoutGroup(KHR)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set triggerUnit = null
	set targetUnit = null
	set KGR = null
	set KHR = null
	set g = null
	return false
endfunction
function KKR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local real a = LoadReal(HY, h, 13)
	local integer KLR = LoadInteger(HY, h, 12)
	local integer EVX = GetTriggerEvalCount(t)
	local real x = GetUnitX(triggerUnit)+ EVX * 50 * Cos(a * bj_DEGTORAD)
	local real y = GetUnitY(triggerUnit)+ EVX * 50 * Sin(a * bj_DEGTORAD)
	local boolean isScepterUpgrade = LoadBoolean(HY, h, 15)
	local unit KPR
	local integer level = LoadInteger(HY, h, 0)
	local trigger KQR = LoadTriggerHandle(HY, h, 11)
	local integer KSR = GetHandleId(KQR)
	local group g = LoginGroup(151)
	local unit targetUnit = null
	local integer ID ='u00V'
	local real KJR = 125
	if EVX == 1 then
		set KJR = 100 
	endif
	set U2 = triggerUnit
	call GroupEnumUnitsInRange(g, x, y, KJR, Condition(function DNX))
	call GroupRemoveUnit(g, triggerUnit)
	set targetUnit = GroupPickRandomUnit(g)
	call LogoutGroup(g)
	if targetUnit != null or EVX == KLR or EVX ==(KLR -1) or EVX ==(KLR -2) then
		set ID ='u00U'
	endif
	set KPR = CreateUnit(GetOwningPlayer(triggerUnit), ID, x, y, a)
	call SaveUnitHandle(HY, KSR, 700 + EVX, KPR)
	if targetUnit != null then
		if GetOwningPlayer(targetUnit)== BW or LoadInteger(HY, GetHandleId(targetUnit), 4259)== 1 then
			set targetUnit = null
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if targetUnit != null and IsUnitAlly(targetUnit, GetOwningPlayer(triggerUnit))== false then
			call PauseUnit(targetUnit, true)
		endif
		call TriggerRegisterTimerEvent(KQR, .5 / KLR, true)
		call TriggerAddCondition(KQR, Condition(function KDR))
		call SaveInteger(HY, KSR, 18, EVX)
		call SaveInteger(HY, KSR, 0, level)
		call SaveUnitHandle(HY, KSR, 17, targetUnit)
		call SaveUnitHandle(HY, KSR, 14, triggerUnit)
		call SaveGroupHandle(HY, KSR, 16, LoginGroup(152))
	elseif EVX > KLR then
		set targetUnit = null
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call TriggerRegisterTimerEvent(KQR, .5 / KLR, true)
		call TriggerAddCondition(KQR, Condition(function KDR))
		call SaveInteger(HY, KSR, 18, EVX)
		call SaveInteger(HY, KSR, 0, level)
		call SaveUnitHandle(HY, KSR, 17, targetUnit)
		call SaveUnitHandle(HY, KSR, 14, triggerUnit)
		call SaveGroupHandle(HY, KSR, 16, LoginGroup(153))
	endif
	set t = null
	set triggerUnit = null
	set KPR = null
	set KQR = null
	set g = null
	set targetUnit = null
	return false
endfunction
function ZBV takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = GetTriggerUnit()
	local real a = AngleBetweenXY(GetUnitX(triggerUnit), GetUnitY(triggerUnit), GetSpellTargetX(), GetSpellTargetY())
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0Z8')
	local integer KTR
	local integer KLR
	local boolean isScepterUpgrade = false
	local trigger KUR = CreateTrigger()
	if level == 0 then
		set level = GetUnitAbilityLevel(triggerUnit,'A1CV')
		set isScepterUpgrade = true
	endif
	set KTR =$5DC+ 500 * level
	set KLR = KTR / 50
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	call SaveInteger(HY, h, 5, level)
	call SaveReal(HY, h, 13, a * 1.)
	call SaveInteger(HY, h, 12, KLR)
	call SaveTriggerHandle(HY, h, 11, KUR)
	call SaveBoolean(HY, h, 15, isScepterUpgrade)
	call TriggerRegisterTimerEvent(t, .5 / KLR, true)
	call TriggerAddCondition(t, Condition(function KKR))
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(triggerUnit, GetSpellAbilityId()))
	set t = null
	set triggerUnit = null
	set KUR = null
endfunction
function KWR takes nothing returns boolean
	return DQX() and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2))
endfunction
function KYR takes unit WUE, integer level returns nothing
	local group g = LoginGroup(154)
	local real x = GetUnitX(WUE)
	local real y = GetUnitY(WUE)
	local unit targetUnit
	local unit dummyUnit
	set U2 = WUE
	call GroupEnumUnitsInRange(g, x, y, 300, Condition(function KWR))
	set targetUnit = GroupPickRandomUnit(g)
	call LogoutGroup(g)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl", WUE, "origin"))
	if targetUnit != null then
		set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', x, y, 0)
		call UnitAddPermanentAbility(dummyUnit,'A0Z7')
		call SetUnitAbilityLevel(dummyUnit,'A0Z7', level)
		call IssueTargetOrderById(dummyUnit, 852095, targetUnit)
		set dummyUnit = null
	endif
	set targetUnit = null
endfunction
function KZR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer EVX = GetTriggerEvalCount(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	if EVX >$E or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call KYR(triggerUnit, LoadInteger(HY, h, 0))
	endif
	set t = null
	set triggerUnit = null
	return false
endfunction
function ZCV takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = GetTriggerUnit()
	call TriggerRegisterTimerEvent(t, .7, true)
	call TriggerRegisterDeathEvent(t, triggerUnit)
	call TriggerAddCondition(t, Condition(function KZR))
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(triggerUnit, GetSpellAbilityId()))
	call TriggerEvaluate(t)
	set t = null
	set triggerUnit = null
endfunction
function K_R takes nothing returns nothing
	call UnitDamageTargetEx(HMV, GetEnumUnit(), 1, HPV)
endfunction
function K0R takes unit WUE, real x, real y, integer level, boolean K1R returns nothing
	local group g = LoginGroup(155)
	set HPV = 20 + 50 * level
	if K1R then
		set HPV = HPV + 50
	endif
	set HMV = WUE
	set U2 = WUE
	call GroupEnumUnitsInRange(g, x, y, 275, Condition(function DJX))
	call ForGroup(g, function K_R)
	call LogoutGroup(g)
	set g = null
endfunction
function K2R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local integer level =(LoadInteger(HY, h, 5))
	local integer c = GetTriggerEvalCount(t)
	local integer K3R = ModuloInteger(c, 4)+ 1
	local real a
	local real d
	local real x
	local real y
	local group g
	set U2 = triggerUnit
	if K3R == 1 then
		set a = GetRandomReal(0, 90)
	elseif K3R == 2 then
		set a = GetRandomReal(90,$B4)
	elseif K3R == 3 then
		set a = GetRandomReal($B4, 270)
	else
		set a = GetRandomReal(270, 360)
	endif
	set d = GetRandomReal($8C, 710)
	if c >$96 or GetUnitAbilityLevel(triggerUnit,'A03R')+ GetUnitAbilityLevel(triggerUnit,'A0AV')== 0 or(GetTriggerEventId()== EVENT_UNIT_SPELL_ENDCAST and(GetSpellAbilityId()=='A03R' or GetSpellAbilityId()=='A0AV')) then
		if GetSpellAbilityId()=='A0AV' and LoadBoolean(HY, h, 0)== false then
			call UnitRemoveAbility(triggerUnit,'A0ST')
			call DestroyEffect(LoadEffectHandle(HY, h, 0))
		endif
		call UnitRemoveAbility(triggerUnit,'A347')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call StopSound(AC, false, true)
	else
		if LoadBoolean(HY, h, 0)== false and(R2I(2 / LoadReal(HY, h, 5))< GetTriggerEvalCount(t)) then
			call UnitRemoveAbility(triggerUnit,'A0ST')
			call UnitRemoveAbility(triggerUnit,'A347')
			call DestroyEffect(LoadEffectHandle(HY, h, 0))
			call SaveBoolean(HY, h, 0, true)
		endif
		set x = GetUnitX(triggerUnit)+ d * Cos(a * bj_DEGTORAD)
		set y = GetUnitY(triggerUnit)+ d * Sin(a * bj_DEGTORAD)
		call DestroyEffect(AddSpecialEffect("effects\\SnowyBlizzardTarget.mdx", x, y))
		call K0R(triggerUnit, x, y, level, LoadBoolean(HY, h, 2))
	endif
	set t = null
	set triggerUnit = null
	set g = null
	return false
endfunction
function ZDV takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level
	local real r = .07
	call PlaySoundAtPoint(AC, GetUnitX(triggerUnit), GetUnitY(triggerUnit))
	call UnitAddAbility(triggerUnit,'A347')
	if GetSpellAbilityId()=='A03R' then
		set level = GetUnitAbilityLevel(triggerUnit,'A03R')
		call SaveBoolean(HY, h, 2, false)
	else
		call SetUnitAbilityLevel(triggerUnit,'A347', 2)
		call SaveBoolean(HY, h, 2, true)
		set level = GetUnitAbilityLevel(triggerUnit,'A0AV')
		call UnitAddPermanentAbility(triggerUnit,'A0ST')
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl", triggerUnit, "origin"))
		call SaveEffectHandle(HY, h, 0, AddSpecialEffectTarget("Abilities\\Spells\\Human\\DivineShield\\DivineShieldTarget.mdl", triggerUnit, "origin"))
		call SetPlayerAbilityAvailable(GetOwningPlayer(triggerUnit),'A0ST', false)
	endif
	call TriggerRegisterTimerEvent(t, r, true)
	call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function K2R))
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h, 5, r)
	set t = null
	set triggerUnit = null
endfunction
function K4R takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	if GetHandleId(u)> 0 then
		if GetWidgetLife(u)> 1 then
			call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ level * .1 + .1)
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
endfunction
function PHE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'AHab')
	local trigger t
	local integer h
	if HaveSavedHandle(HY, GetHandleId(u),'AHab') then
		set t = LoadTriggerHandle(HY, GetHandleId(u),'AHab')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call FlushChildHashtable(HY, h)
		call SaveTriggerHandle(HY, GetHandleId(u),'AHab', t)
		call SaveUnitHandle(HY, h, 0, u)
		call TriggerRegisterTimerEvent(t, .2, true)
		call TriggerAddCondition(t, Condition(function K4R))
	endif
	call SaveInteger(HY, h, 0, level)
	set t = null
	set u = null
endfunction
function ZFV takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local integer level = GetUnitAbilityLevel(WJE,'A1E9')
	local group g = LoginGroup(156)
	local unit u2
	set U2 = WJE
	call GroupEnumUnitsInRange(g, x, y, 425, Condition(function DQX))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call UnitDamageTargetEx(WJE, u2, 1, 50 + 50 * level)
		call AddAbilityToTimed(u2,'A3EO'-1 + level, 1, 4.5,'B386')
		call GroupRemoveUnit(g, u2)
	endloop
	call LogoutGroup(g)
	call DestroyEffect(AddSpecialEffect("war3mapImported\\IceNova.mdx", x, y))
	set WJE = null
	set g = null
	set u2 = null
endfunction
function K5R takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	if GetUnitAbilityLevel(WLE,'B017')> 0 and(WLE != RoShan or LoadInteger(HY, h, 0)< 2 + LoadInteger(HY, h, 1)) then
		call UnitDamageTargetEx(WJE, WLE, 1, 37.5)
		call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 1)
	else
		call UnitRemoveAbility(WLE,'B017')
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	endif
	set WJE = null
	set WLE = null
	set t = null
endfunction
function K6R takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local timer t = CreateTimer()
	local integer level = GetUnitAbilityLevel(WJE, GetSpellAbilityId())
	call TimerStart(t, .5, true, function K5R)
	call SaveUnitHandle(HY, GetHandleId(t), 0, WJE)
	call SaveInteger(HY, GetHandleId(t), 1, level)
	call SaveUnitHandle(HY, GetHandleId(t), 1, GetSpellTargetUnit())
	call UnitDamageTargetEx(WJE, GetSpellTargetUnit(), 1, 37.5)
	set t = null
	set WJE = null
endfunction
function FBE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call K6R()
	endif
endfunction
function K7R takes unit u returns nothing
	local boolean K8R = IsSentinelsPlayer(GetOwningPlayer(u))
	local boolean K9R = IsScourgesPlayer(GetOwningPlayer(u))
	if K9R then
		call UnitShareVision(u, Scourges[0], false)
		call UnitShareVision(u, Scourges[1], false)
		call UnitShareVision(u, Scourges[2], false)
		call UnitShareVision(u, Scourges[3], false)
		call UnitShareVision(u, Scourges[4], false)
		call UnitShareVision(u, Scourges[5], false)
	elseif K8R then
		call UnitShareVision(u, Sentinels[0], false)
		call UnitShareVision(u, Sentinels[1], false)
		call UnitShareVision(u, Sentinels[2], false)
		call UnitShareVision(u, Sentinels[3], false)
		call UnitShareVision(u, Sentinels[4], false)
		call UnitShareVision(u, Sentinels[5], false)
	endif
endfunction
function LVR takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local real ZCE = GetPlayerState(GetOwningPlayer(WLE), PLAYER_STATE_RESOURCE_GOLD)*(GetUnitAbilityLevel(WJE,'A44U')* .05 + .15)
	call UnitDamageTargetEx(WJE, WLE, 1, ZCE)
	call CommonTextTag("+" + I2S(R2I(ZCE)), 1, WLE, .03, 255, 200, 0, 255)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\ResourceItems\\ResourceEffectTarget.mdl", WLE, "origin"))
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Other\\ToonBoom\\ToonBoom.mdl", WLE, "origin"))
	set WJE = null
	set WLE = null
endfunction
function FCE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call LVR()
	endif
endfunction
function GEE takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local integer OJO = GetPlayerState(GetOwningPlayer(WLE), PLAYER_STATE_RESOURCE_GOLD)-GetPlayerState(GetOwningPlayer(WJE), PLAYER_STATE_RESOURCE_GOLD)
	local real ZCE
	local unit d = CreateUnit(GetOwningPlayer(WJE),'e00E', GetUnitX(WLE), GetUnitY(WLE), 0)
	local integer level = GetUnitAbilityLevel(WJE,'A44V')
	local integer Z6X = 400 + 400 * level
	call UnitAddAbility(d,'A44W')
	call IssueTargetOrderById(d, 852095, WLE)
	set d = null
	if OJO <-Z6X then
		set OJO =-Z6X
	elseif OJO > Z6X then
		set OJO = Z6X
	endif
	if OJO < 0 then
		set ZCE = OJO *(level * .1 + .6)*-1
		call UnitDamageTargetEx(WJE, WLE, 1, ZCE)
		call CommonTextTag("+" + I2S(R2I(ZCE)), 1, WLE, .03, 255, 100, 0, 255)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\ResourceItems\\ResourceEffectTarget.mdl", WLE, "origin"))
		call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Other\\ToonBoom\\ToonBoom.mdl", WLE, "origin"))
	else
		call SetPlayerState(GetOwningPlayer(WLE), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(GetOwningPlayer(WLE), PLAYER_STATE_RESOURCE_GOLD)+ OJO)
		call SetPlayerState(GetOwningPlayer(WJE), PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(GetOwningPlayer(WJE), PLAYER_STATE_RESOURCE_GOLD)+ OJO)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\ResourceItems\\ResourceEffectTarget.mdl", WLE, "origin"))
		call CommonTextTag("+" + I2S(OJO), 1, WLE, .03, 255, 200, 0, 255)
		call CommonTextTag("+" + I2S(OJO), 1, WJE, .03, 255, 200, 0, 255)
	endif
	set WJE = null
	set WLE = null
endfunction
function OgreLord_CashInWrap takes nothing returns nothing
	call GEE()
endfunction
function LER takes unit u, player p, real dur returns nothing
	call K7R(u)
	call SetUnitOwner(u, p, true)
	call UnitApplyTimedLife(u,'BTLF', dur)
	call UnitAddPermanentAbility(u,'A46M')
	call DestroyEffect(AddSpecialEffectTarget(GetAbilityEffectById('A46K', EFFECT_TYPE_TARGET, 0), u, GetAbilityEffectById('A46K', EFFECT_TYPE_TARGET, 1)))
endfunction

function ChangeOwnerIllusionUnit takes unit illusionUnit, unit newOwner returns nothing
	local unit masterUnit = GetSummonSourceUnit(illusionUnit)
	local integer h
	local integer count
	if LoadBoolean(ExtraHT, GetHandleId(illusionUnit), 'P083') and (GetUnitAbilityLevel(masterUnit,'P083')> 0) then
		call SaveUnitHandle(ExtraHT, GetHandleId(illusionUnit), SUMMONING_SOURCE_UNIT, newOwner)
		set h = GetHandleId(masterUnit)
		set count = LoadInteger(ExtraHT, h, 'P083')
		if count > 0 then
			call SaveInteger(ExtraHT, h, 'P083', count - 1)
		endif
		
		set h = GetHandleId(newOwner)
		set count = LoadInteger(ExtraHT, h, 'P083')
		call SaveInteger(ExtraHT, h, 'P083', count + 1)

		set masterUnit = null
	endif
	call SaveUnitHandle(ExtraHT, GetHandleId(illusionUnit), SUMMONING_SOURCE_UNIT, newOwner)
endfunction

function LXR takes unit d, unit t, real dur, integer life returns nothing
	//call BJDebugMsg(GetUnitName(t))
	if IsUnitIllusion(t) then
		call LER(t, GetOwningPlayer(d), dur)
		call ChangeOwnerIllusionUnit(t, d)
	elseif not IssueTargetOrderById(d, 852581, t) then
		call UnitShareVision(t, GetOwningPlayer(d), true)
		if not IssueTargetOrderById(d, 852581, t) then
			call UnitShareVision(t, GetOwningPlayer(d), false)
		else
			call UnitApplyTimedLife(t,'BTLF', dur)
			call I8X(t)
			call UnitAddPermanentAbility(t,'A46M')
			call UnitAddMaxLife(t, life)
		endif
	else
		call UnitApplyTimedLife(t,'BTLF', dur)
		call I8X(t)
		call UnitAddPermanentAbility(t,'A46M')
		call UnitAddMaxLife(t, life)
	endif
endfunction
//宇宙兽人大第一次filter 敌对、非建筑、非守卫、存活、非英雄、非熊灵、非元素、非佣兽、非地狱火
function MindControl_Filter takes unit u returns boolean
	return (IsUnitEnemy(u, GetOwningPlayer(U2)) and IsAliveNotStrucNotWard(u) and not IsUnitType(u, UNIT_TYPE_HERO) and not IsBearUnit(u) and not IsPrimalTypeId(GetUnitTypeId(u)) and not IsFamiliarsTypeId(GetUnitTypeId(u)) and not IsInfernalUnit(u))
endfunction
function LRR takes nothing returns boolean
	return MindControl_Filter(GetFilterUnit())
endfunction
//宇宙兽人大
function GXE takes nothing returns nothing
	local group g = LoginGroup(157)
	local unit WJE = GetTriggerUnit()
	local unit d = CreateUnit(GetOwningPlayer(WJE),'e00E', GetUnitX(WJE), GetUnitY(WJE), 0)
	local unit u
	local integer lv = GetUnitAbilityLevel(WJE,'A46J')
	local boolean b = IsSentinelsPlayer(GetOwningPlayer(WJE))
	local integer c
	local integer GOX = 0
	local integer LAR = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetTriggerPlayer())],'A0A8')
	local real dur = 30 + 5 * LAR
	local integer life = LAR * 50
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	call UnitAddAbility(d,'A46K')
	call DestroyEffect(AddSpecialEffect("MindControl.mdx", x, y))
	set U2 = WJE
	call GroupEnumUnitsInRange(g, x, y, 375, Condition(function LRR))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if IsUnitType(u, UNIT_TYPE_ANCIENT) then
			if lv == 3 then
				call LXR(d, u, dur, life)
			endif
		elseif IsUnitIllusion(u) or(GetOwningPlayer(u)!= Sentinels[0]and GetOwningPlayer(u)!= Scourges[0]and GetOwningPlayer(u)!= BW) then
			if lv > 1 then
				call LXR(d, u, dur, life)
			endif
		else
			call LXR(d, u, dur, life)
		endif
		call GroupRemoveUnit(g, u)
	endloop
	call LogoutGroup(g)
	set g = null
	set d = null
	set WJE = null
	set u = null
endfunction
function LNR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local real x = LoadReal(HY, h, 10)
	local real y = LoadReal(HY, h, 11)
	local integer c = LoadInteger(HY, h, 0)+ 1
	local string s = "Objects\\Spawnmodels\\NightElf\\NightElfBlood\\NightElfBloodArcher.mdl"
	if c == 1 then
		call DestroyEffect(AddSpecialEffect(s, x, y))
		call DestroyEffect(AddSpecialEffect(s, x + 50 * Cos($F* bj_DEGTORAD), y + 50 * Sin($F* bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 100 * Cos(7 * bj_DEGTORAD), y + 100 * Sin(7 * bj_DEGTORAD)))
	elseif c == 2 then
		call DestroyEffect(AddSpecialEffect(s, x +$96* Cos(0 * bj_DEGTORAD), y +$96* Sin(0 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x +$C8* Cos(340 * bj_DEGTORAD), y +$C8* Sin(340 * bj_DEGTORAD)))
	elseif c == 3 then
		call DestroyEffect(AddSpecialEffect(s, x +$FA* Cos(325 * bj_DEGTORAD), y +$FA* Sin(325 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 300 * Cos(300 * bj_DEGTORAD), y + 300 * Sin(300 * bj_DEGTORAD)))
	elseif c == 4 then
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos(275 * bj_DEGTORAD), y + 350 * Sin(270 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 400 * Cos($FA* bj_DEGTORAD), y + 400 * Sin($FA* bj_DEGTORAD)))
	elseif c == 5 then
		call DestroyEffect(AddSpecialEffect(s, x + 450 * Cos($E1* bj_DEGTORAD), y + 450 * Sin($E1* bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 500 * Cos($C8* bj_DEGTORAD), y + 500 * Sin($C8* bj_DEGTORAD)))
	elseif c == 6 then
		call DestroyEffect(AddSpecialEffect(s, x + 550 * Cos(175 * bj_DEGTORAD), y + 550 * Sin(175 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 570 * Cos($96* bj_DEGTORAD), y + 570 * Sin($96* bj_DEGTORAD)))
	elseif c == 7 then
		call DestroyEffect(AddSpecialEffect(s, x + 570 * Cos(125 * bj_DEGTORAD), y + 570 * Sin(125 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 570 * Cos( 100 * bj_DEGTORAD), y + 570 * Sin( 100 * bj_DEGTORAD)))
	elseif c == 8 then
		call DestroyEffect(AddSpecialEffect(s, x + 550 * Cos( 100 * bj_DEGTORAD), y + 550 * Sin( 100 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 550 * Cos(90 * bj_DEGTORAD), y + 550 * Sin(90 * bj_DEGTORAD)))
	elseif c == 9 then
		call DestroyEffect(AddSpecialEffect(s, x + 500 * Cos(70 * bj_DEGTORAD), y + 500 * Sin(70 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 450 * Cos(45 * bj_DEGTORAD), y + 450 * Sin(45 * bj_DEGTORAD)))
	elseif c ==$A then
		call DestroyEffect(AddSpecialEffect(s, x + 450 * Cos(20 * bj_DEGTORAD), y + 450 * Sin(20 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 450 * Cos(0 * bj_DEGTORAD), y + 450 * Sin(0 * bj_DEGTORAD)))
	elseif c == 11 then
		call DestroyEffect(AddSpecialEffect(s, x + 400 * Cos(345 * bj_DEGTORAD), y + 400 * Sin(345 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos(330 * bj_DEGTORAD), y + 350 * Sin(330 * bj_DEGTORAD)))
	elseif c ==$C then
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos(315 * bj_DEGTORAD), y + 350 * Sin(315 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos(300 * bj_DEGTORAD), y + 350 * Sin(300 * bj_DEGTORAD)))
	elseif c ==$D then
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos(275 * bj_DEGTORAD), y + 350 * Sin(275 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 300 * Cos($FA* bj_DEGTORAD), y + 300 * Sin($FA* bj_DEGTORAD)))
	elseif c == 14 then
		call DestroyEffect(AddSpecialEffect(s, x + 300 * Cos($E1* bj_DEGTORAD), y + 300 * Sin($E1* bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos($C8* bj_DEGTORAD), y + 350 * Sin($C8* bj_DEGTORAD)))
	elseif c ==$F then
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos($B4* bj_DEGTORAD), y + 350 * Sin($B4* bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 400 * Cos($A0* bj_DEGTORAD), y + 400 * Sin($A0* bj_DEGTORAD)))
	elseif c == 16 then
		call DestroyEffect(AddSpecialEffect(s, x + 400 * Cos($82* bj_DEGTORAD), y + 400 * Sin($82* bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 400 * Cos(110 * bj_DEGTORAD), y + 400 * Sin(110 * bj_DEGTORAD)))
	elseif c == 17 then
		call DestroyEffect(AddSpecialEffect(s, x + 400 * Cos(90 * bj_DEGTORAD), y + 400 * Sin(90 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 400 * Cos(70 * bj_DEGTORAD), y + 400 * Sin(70 * bj_DEGTORAD)))
	elseif c == 18 then
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos(45 * bj_DEGTORAD), y + 350 * Sin(45 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos(30 * bj_DEGTORAD), y + 350 * Sin(30 * bj_DEGTORAD)))
	elseif c == 19 then
		call DestroyEffect(AddSpecialEffect(s, x +$FA* Cos(0 * bj_DEGTORAD), y +$FA* Sin(0 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x +$FA* Cos(345 * bj_DEGTORAD), y +$FA* Sin(345 * bj_DEGTORAD)))
	elseif c == 20 then
		call DestroyEffect(AddSpecialEffect(s, x +$96* Cos(330 * bj_DEGTORAD), y +$96* Sin(330 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 100 * Cos(300 * bj_DEGTORAD), y + 100 * Sin(300 * bj_DEGTORAD)))
	elseif c == 21 then
		call DestroyEffect(AddSpecialEffect(s, x + 50 * Cos(275 * bj_DEGTORAD), y + 50 * Sin(275 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 0 * Cos($FA* bj_DEGTORAD), y + 0 * Sin($FA* bj_DEGTORAD)))
	elseif c == 22 then
		call DestroyEffect(AddSpecialEffect(s, x - 100 * Cos($E1* bj_DEGTORAD), y - 100 * Sin($E1* bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x -$96* Cos($C8* bj_DEGTORAD), y -$96* Sin($C8* bj_DEGTORAD)))
	elseif c == 23 then
		call DestroyEffect(AddSpecialEffect(s, x -$C8* Cos(175 * bj_DEGTORAD), y -$C8* Sin(175 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x -$FA* Cos($96* bj_DEGTORAD), y -$FA* Sin($96* bj_DEGTORAD)))
	elseif c == 24 then
		call DestroyEffect(AddSpecialEffect(s, x -$FA* Cos($B4* bj_DEGTORAD), y -$FA* Sin($B4* bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x -300 * Cos($B4* bj_DEGTORAD), y -300 * Sin($B4* bj_DEGTORAD)))
	elseif c == 25 then
		call DestroyEffect(AddSpecialEffect(s, x -350 * Cos(270 * bj_DEGTORAD), y -350 * Sin(270 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x -400 * Cos(270 * bj_DEGTORAD), y -400 * Sin(270 * bj_DEGTORAD)))
	elseif c == 26 then
		call DestroyEffect(AddSpecialEffect(s, x + 350 * Cos(90 * bj_DEGTORAD), y + 350 * Sin(90 * bj_DEGTORAD)))
		call DestroyEffect(AddSpecialEffect(s, x + 400 * Cos(90 * bj_DEGTORAD), y + 400 * Sin(90 * bj_DEGTORAD)))
	endif
	if c > 26 then
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	else
		call SaveInteger(HY, h, 0, c)
	endif
	set t = null
endfunction
function LBR takes real x, real y returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveReal(HY, h, 10, x)
	call SaveReal(HY, h, 11, y)
	call TimerStart(t, .1, true, function LNR)
	set t = null
endfunction
function LCR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local effect fx = LoadEffectHandle(HY, h, 1)
	local real ZCE = LoadReal(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	local group g = LoginGroup(158)
	local real x = LoadReal(HY, h, 10)
	local real y = LoadReal(HY, h, 11)
	local unit u2
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', x, y, 0)
	call PlaySoundAtPoint(VX, x, y)
	call UnitAddAbility(d,'A450')
	call SetUnitAbilityLevel(d,'A450', level)
	call IssuePointOrderById(d,$D0270, x, y)
	set d = null
	set U2 = u
	call GroupEnumUnitsInRange(g, x, y, 625, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call UnitDamageTargetEx(u, u2, 3, ZCE)
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\BloodRiteTarget.mdx", u2, "chest"))
		call GroupRemoveUnit(g, u2)
	endloop
	call DestroyEffect(fx)
	call LogoutGroup(g)
	set g = null
	set fx = null
	set t = null
	set u = null
endfunction
function FFE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A44Z')
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local effect fx = AddSpecialEffect("war3mapImported\\Bloodrite.mdx", x, y)
	call A8X(GetOwningPlayer(u), 2.5, x, y, 300)
	call PlaySoundAtPoint(ZE, x, y)
	call TimerStart(t, 2.6, false, function LCR)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveReal(HY, h, 0, level * 40 + 80)
	call SaveInteger(HY, h, 0, level)
	call SaveEffectHandle(HY, h, 1, fx)
	call SaveReal(HY, h, 10, x)
	call SaveReal(HY, h, 11, y)
	call LBR(x, y)
	set t = null
	set fx = null
	set u = null
endfunction

function BloodrageActions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit buffTarget = LoadUnitHandle(HY, h, 0)
	local unit killingUnit = null
	local unit dyingUnit
	local real time
	if GetTriggerEventId()== EVENT_PLAYER_UNIT_DEATH then
		set dyingUnit = GetTriggerUnit()
		set killingUnit = GetKillingUnit()
		if GetUnitAbilityLevel(killingUnit,'Aloc')> 0 or GetUnitAbilityLevel(killingUnit,'A04R')> 0 or GetUnitTypeId(killingUnit) == 'e00E'then
			set killingUnit = Player__Hero[GetPlayerId(GetOwningPlayer(killingUnit))]
		endif
		if killingUnit == buffTarget then
			if GetUnitAbilityLevel(buffTarget,'A44Y')> 0 then
				if UnitAlive(buffTarget) and not IsUnitIllusion(dyingUnit) and not IsUnitType(dyingUnit, UNIT_TYPE_STRUCTURE) and dyingUnit != RoShan then
					call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HeroBloodElfBlood.mdl", buffTarget, "overhead"))
					call UnitRestoreHealth(buffTarget, GetUnitState(dyingUnit, UNIT_STATE_MAX_LIFE)* .2)
				endif
			endif
		elseif dyingUnit == buffTarget then
			if GetUnitAbilityLevel(buffTarget,'A44Y')> 0 then
			// 凶手存活 BUFF目标不是幻象 不是肉山 不是建筑
				if UnitAlive(killingUnit) and not IsUnitIllusion(buffTarget) and buffTarget != RoShan and not IsUnitType(killingUnit, UNIT_TYPE_STRUCTURE) then
					call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HeroBloodElfBlood.mdl", killingUnit, "overhead"))
					call UnitRestoreHealth(killingUnit, GetUnitState(buffTarget, UNIT_STATE_MAX_LIFE)* .2)
				endif
				set killingUnit = null
			endif
			call UnitRemoveAbility(buffTarget,'A44Y')
			call UnitRemoveAbility(buffTarget,'B44Y')
			call FlushChildHashtable(HY, h)
			call RemoveSavedHandle(ExtraHT, GetHandleId(buffTarget),'A2X9')
			call RemoveSavedReal(ExtraHT, GetHandleId(buffTarget),'A2X9')
			call CleanCurrentTrigger(t)
		endif
		set killingUnit = null
		set dyingUnit = null
	else
		set time = LoadReal(HY, h, 1)
		if time < GetGameTime() or GetUnitAbilityLevel(buffTarget,'A44Y')== 0 then
			call UnitRemoveAbility(buffTarget,'A44Y')
			call UnitRemoveAbility(buffTarget,'B44Y')
			call FlushChildHashtable(HY, h)
			call RemoveSavedHandle(ExtraHT, GetHandleId(buffTarget),'A2X9')
			call RemoveSavedReal(ExtraHT, GetHandleId(buffTarget),'A2X9')
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set buffTarget = null
	return false
endfunction
// 血怒
function BloodrageAdd takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(spellUnit, GetSpellAbilityId())
	local real dur = 8 + level
	local real newData = .15 + .05 * level
	local trigger t
	local integer h
	local real oldData
	if HaveSavedHandle(ExtraHT, GetHandleId(targetUnit),'A2X9') then
		set t = LoadTriggerHandle(ExtraHT, GetHandleId(targetUnit),'A2X9')
		set h = GetHandleId(t)
		set oldData = LoadReal(HY, h, 10)
		if oldData != newData then
			call SaveReal(HY, h, 10, newData)
			call SaveReal(ExtraHT, GetHandleId(targetUnit), 'A2X9', newData)
		endif
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .1, true)
		call SaveUnitHandle(HY, h, 0, targetUnit)
		call SaveTriggerHandle(ExtraHT, GetHandleId(targetUnit),'A2X9', t)
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
		call TriggerAddCondition(t, Condition(function BloodrageActions))
		call SaveReal(ExtraHT, GetHandleId(targetUnit),'A2X9', newData)
		call SaveReal(HY, h, 10, newData)
	endif
	call UnitAddPermanentAbility(targetUnit,'A44Y')
	call SetUnitAbilityLevel(targetUnit,'A44Y', level)
	call SaveReal(HY, h, 1, dur + GetGameTime())
	call EnableEffectByTime(EFFECT_KEY_BLOODRAGE, dur)
	set t = null
	set spellUnit = null
	set targetUnit = null
endfunction
function SpellEffect__Bloodrage takes nothing returns nothing
	if IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) or not UnitHasSpellShield(GetSpellTargetUnit()) then
		call BloodrageAdd()
	endif
endfunction
function LKR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	local group g
	local unit u2
	local real ZCE
	if UnitIsDead(u) then
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	else
		set g = LoginGroup(159)
		set U2 = u
		set ZCE =(level *$F+ 10.)/ 2.
		call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 175, Condition(function DJX))
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			call GroupRemoveUnit(g, u2)
			if LoadInteger(HY, GetHandleId(u2),'frwl')!= 1 then
				call EPX(u2,'frwl', .49)
				call AddAbilityToTimed(u2,'A452', 1, 1,'B452')
				call UnitDamageTargetEx(u, u2, 1, ZCE)
			endif
		endloop
		call LogoutGroup(g)
	endif
	set t = null
endfunction
function LLR takes unit d, integer level returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .5, true, function LKR)
	call SaveUnitHandle(HY, h, 0, d)
	call SaveInteger(HY, h, 0, level)
	set t = null
endfunction
function FGE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u, GetSpellAbilityId())
	local unit W_V
	local integer i = 0
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real LMR =$C
	loop
		set W_V = CreateUnit(GetOwningPlayer(u),'ho03', x + 450 * Cos(LMR * i), y + 450 * Sin(LMR * i), 0)
		call LLR(W_V, level)
		call UnitApplyTimedLife(W_V,'BTLF', 5)
		call SetUnitX(W_V, x + 450 * Cos($F* i))
		call SetUnitY(W_V, y + 450 * Sin($F* i))
		set i = i + 1
	exitwhen i * LMR > 360
	endloop
	set u = null
	set W_V = null
endfunction
function JUE takes nothing returns nothing
	call DestroyEffect(AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire2.mdl", GetTriggerUnit(), "left hand"))
	call DestroyEffect(AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire2.mdl", GetTriggerUnit(), "weapon"))
endfunction
function FJE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A454')
	local unit u2
	local group g = LoginGroup(160)
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", x, y))
	call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", x, y))
	set U2 = u
	call GroupEnumUnitsInRange(g, x, y, 350 + 25, Condition(function DJX))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call UnitDamageTargetEx(u, u2, 1, 100 * level)
		call CommonUnitAddStun(u2, level * 1., false)
		call GroupRemoveUnit(g, u2)
	endloop
	call LogoutGroup(g)
	set u = null
	set u2 = null
endfunction
function LPR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call DestroyEffect(LoadEffectHandle(HY, h, 0))
	call DestroyEffect(LoadEffectHandle(HY, h, 1))
	call DestroyEffect(LoadEffectHandle(HY, h, 2))
	call DestroyEffect(LoadEffectHandle(HY, h, 3))
	call DestroyEffect(LoadEffectHandle(HY, h, 4))
	call DestroyEffect(LoadEffectHandle(HY, h, 5))
	call FlushChildHashtable(HY, h)
	call DestroyTrigger(t)
	set t = null
	return false
endfunction
function S1E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterTimerEvent(t, 1.2, false)
	call TriggerAddCondition(t, Condition(function LPR))
	call SaveEffectHandle(HY, h, 0, AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl", u, "hand right"))
	call SaveEffectHandle(HY, h, 1, AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlameStrike\\FlameStrikeEmbers.mdl", u, "hand right"))
	call SaveEffectHandle(HY, h, 2, AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl", u, "weapon left"))
	call SaveEffectHandle(HY, h, 3, AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlameStrike\\FlameStrikeEmbers.mdl", u, "weapon left"))
	call SaveEffectHandle(HY, h, 4, AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlameStrike\\FlameStrikeEmbers.mdl", u, "right foot"))
	call SaveEffectHandle(HY, h, 5, AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlameStrike\\FlameStrikeEmbers.mdl", u, "left foot"))
	set t = null
	set u = null
endfunction
function LQR takes nothing returns nothing
	call LodSystem_AddUnitExtraState(GetEnumUnit(), LoadInteger(HY, GetHandleId(GetEnumUnit()),'MDMG'), STATE_SYSTEM_DAMAGE)
endfunction
function LSR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer ZCE
	local integer level = LoadInteger(HY, h, 0)
	local real LTR
	local group g = LoadGroupHandle(HY, h, 100)
	local unit u2
	local group gg
	if LoadBoolean(HY, h, 0)== false and GetTriggerEventId()== EVENT_UNIT_ATTACKED then
		set ZCE = LoadInteger(HY, GetHandleId(GetAttacker()),'MDMG')+ 5 + 5 * level
		call LodSystem_ReduceUnitExtraState(GetAttacker(), 5 + 5 * level, STATE_SYSTEM_DAMAGE)
		call SaveInteger(HY, GetHandleId(GetAttacker()),'MDMG', ZCE)
		call GroupAddUnit(g, GetAttacker())
	elseif LoadBoolean(HY, h, 0)== false and GetGameTime()> LoadReal(HY, h, 0) or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call SaveBoolean(HY, h, 0, true)
		call SaveInteger(HY, h,-1, 5 * 4)
		call DestroyEffect(LoadEffectHandle(HY, h, 1))
		call DestroyEffect(LoadEffectHandle(HY, h, 2))
		call DestroyEffect(LoadEffectHandle(HY, h, 3))
		call DestroyEffect(LoadEffectHandle(HY, h, 4))
		call DestroyEffect(LoadEffectHandle(HY, h, 5))
		call DestroyEffect(LoadEffectHandle(HY, h, 6))
		call DestroyEffect(LoadEffectHandle(HY, h, 7))
		call DestroyEffect(LoadEffectHandle(HY, h, 8))
	elseif LoadBoolean(HY, h, 0) then
		call SaveInteger(HY, h,-1, LoadInteger(HY, h,-1)-1)
		if LoadInteger(HY, h,-1)<= 0 then
			call ForGroup(g, function LQR)
			call LogoutGroup(g)
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		endif
	else
		set gg = LoginGroup(161)
		set U2 = u
		call GroupEnumUnitsInRange(gg, GetUnitX(u), GetUnitY(u), 350 + 25, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		set LTR =(level * 25 + 50)/ 5
		loop
			set u2 = FirstOfGroup(gg)
		exitwhen u2 == null
			call UnitDamageTargetEx(u, u2, 1, LTR)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\ImmolationRed\\ImmolationRedDamage.mdl", u2, "chest"))
			call GroupRemoveUnit(gg, u2)
		endloop
		call LogoutGroup(gg)
	endif
	set g = null
	set u = null
	set t = null
	return false
endfunction
function FHE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u, GetSpellAbilityId())
	local group g = LoginGroup(162)
	local string ss = "Objects\\Spawnmodels\\Other\\FlameThrower\\FlameThrowerSpawnObj.mdl"
	local string s = "Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl"
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ATTACKED)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveGroupHandle(HY, h, 100, g)
	call SaveInteger(HY, h, 0, level)
	call SaveReal(HY, h, 0, GetGameTime()+$E)
	call SaveEffectHandle(HY, h, 1, AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl", u, "origin"))
	call DestroyEffect(AddSpecialEffectTarget(ss, u, "weapon"))
	call DestroyEffect(AddSpecialEffectTarget(ss, u, "hand left"))
	call DestroyEffect(AddSpecialEffectTarget(ss, u, "hand right"))
	call DestroyEffect(AddSpecialEffectTarget(ss, u, "foot left"))
	call DestroyEffect(AddSpecialEffectTarget(ss, u, "foot right"))
	call DestroyEffect(AddSpecialEffectTarget(ss, u, "head"))
	call DestroyEffect(AddSpecialEffectTarget(ss, u, "chest"))
	call SaveEffectHandle(HY, h, 2, AddSpecialEffectTarget(s, u, "weapon"))
	call SaveEffectHandle(HY, h, 3, AddSpecialEffectTarget(s, u, "hand left"))
	call SaveEffectHandle(HY, h, 4, AddSpecialEffectTarget(s, u, "hand right"))
	call SaveEffectHandle(HY, h, 5, AddSpecialEffectTarget(s, u, "foot left"))
	call SaveEffectHandle(HY, h, 6, AddSpecialEffectTarget(s, u, "foot right"))
	call SaveEffectHandle(HY, h, 7, AddSpecialEffectTarget(s, u, "head"))
	call SaveEffectHandle(HY, h, 8, AddSpecialEffectTarget(s, u, "chest"))
	call TriggerAddCondition(t, Condition(function LSR))
	set t = null
	set u = null
endfunction
function FlameShowActions takes nothing returns nothing
	local group g
	local unit u
	local real a
	local integer level
	local real ZCE = 0
	local integer probability
	local real x
	local real y
	set level = GetUnitAbilityLevel(DESourceUnit[DEI],'A455')
	if IsUnitType(DESourceUnit[DEI], UNIT_TYPE_MELEE_ATTACKER) then
		set probability = level * 5 + 20
	else
		set probability = level * 5 + 5
	endif
	if GetPrdRandom(DESourceUnit[DEI],'A455', probability) then
		set a = AngleBetweenUnit(DESourceUnit[DEI], DETargetUnit[DEI])
		set g = LoginGroup(163)
		set U2 = DESourceUnit[DEI]
		set x = GetUnitX(DETargetUnit[DEI])+$FA* Cos(a * bj_DEGTORAD)
		set y = GetUnitY(DETargetUnit[DEI])+$FA* Sin(a * bj_DEGTORAD)
		call GroupEnumUnitsInRange(g, x, y, 275, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call GroupAddUnit(g, DETargetUnit[DEI])
		if IsUnitType(DETargetUnit[DEI], UNIT_TYPE_HERO) then
			set ZCE = GetHeroStr(DETargetUnit[DEI], true)+ GetHeroAgi(DETargetUnit[DEI], true)+ GetHeroInt(DETargetUnit[DEI], true)+ GetHeroStr(DESourceUnit[DEI], true)+ GetHeroAgi(DESourceUnit[DEI], true)+ GetHeroInt(DESourceUnit[DEI], true)
			set ZCE = ZCE / 2
		else
			set ZCE = GetHeroStr(DESourceUnit[DEI], true)+ GetHeroAgi(DESourceUnit[DEI], true)+ GetHeroInt(DESourceUnit[DEI], true)
		endif
		call KillUnit(CreateUnit(DESourcePlayer[DEI],'h02I', GetUnitX(DETargetUnit[DEI]), GetUnitY(DETargetUnit[DEI]), 0))
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			call DestroyEffect(AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire2.mdl", u, "origin"))
			call UnitDamageTargetEx(DESourceUnit[DEI], u, 1, ZCE)
			call GroupRemoveUnit(g, u)
		endloop
		call LogoutGroup(g)
		set g = null
		set u = null
	endif
endfunction
// 火焰秀
function FlameShow_DE takes nothing returns nothing
	if GetUnitAbilityLevel(DESourceUnit[DEI],'A455')> 0 and not DESourceIsBreak[DEI] then
		call FlameShowActions()
	endif
endfunction
function LYR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	call SetUnitAnimationByIndex(WUE, 8)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	return false
endfunction
function LZR takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SetUnitAnimationByIndex(WUE, 7)
	call TriggerRegisterTimerEvent(t, 2.5, false)
	call TriggerAddCondition(t, Condition(function LYR))
	call SaveUnitHandle(HY, h, 2,(WUE))
	set t = null
	set WUE = null
endfunction
function L_R takes nothing returns nothing
	if GetUnitTypeId(GetTriggerUnit())=='N0M0' then
		call LZR()
	endif
endfunction
function L0R takes nothing returns nothing
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\ChimaeraLightningMissile\\ChimaeraLightningMissile.mdl", GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit())))
	call UnitDamageTargetEx(HQV, GetEnumUnit(), 1, HSV)
endfunction
function L1R takes nothing returns boolean
	local trigger t2 = GetTriggeringTrigger()
	local integer DOO = GetHandleId(t2)
	local trigger t1 =(LoadTriggerHandle(HY,(DOO), 9))
	local integer L2R = GetHandleId(t1)
	local unit L3R =(LoadUnitHandle(HY,(DOO), 8))
	local group g
	local integer level =(LoadInteger(HY,(DOO), 5))
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		call ShowUnit(L3R, false)
		call KillUnit(L3R)
		call FlushChildHashtable(HY,(L2R))
		call CleanCurrentTrigger(t1)
		call FlushChildHashtable(HY,(DOO))
		call CleanCurrentTrigger(t2)
	elseif IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(L3R)) and IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE)== false and GetUnitAbilityLevel(GetTriggerUnit(),'A04R')== 0 then
		set g = LoginGroup(164)
		set U2 = L3R
		set HQV = L3R
		set HSV = 100 + 40 * level
		call GroupEnumUnitsInRange(g, GetUnitX(L3R), GetUnitY(L3R), 285, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call ForGroup(g, function L0R)
		call LogoutGroup(g)
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\Bolt\\BoltImpact.mdl", GetUnitX(L3R), GetUnitY(L3R)))
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\Bolt\\BoltImpact.mdl", GetUnitX(L3R), GetUnitY(L3R)))
		call ShowUnit(L3R, false)
		call KillUnit(L3R)
		call FlushChildHashtable(HY,(L2R))
		call CleanCurrentTrigger(t1)
		call FlushChildHashtable(HY,(DOO))
		call CleanCurrentTrigger(t2)
	endif
	set t1 = null
	set t2 = null
	set L3R = null
	set g = null
	return false
endfunction
function L4R takes nothing returns boolean
	local trigger t1 = GetTriggeringTrigger()
	local integer L2R = GetHandleId(t1)
	local trigger t2
	local integer DOO
	local unit L3R
	local integer level
	local real x =(LoadReal(HY,(L2R), 6))
	local real y =(LoadReal(HY,(L2R), 7))
	local real BXR
	local integer EVX = GetTriggerEvalCount(t1)
	if EVX == 1 then
		call DestroyEffect((LoadEffectHandle(HY,(L2R), 3)))
	elseif EVX == 2 then
		call DestroyEffect((LoadEffectHandle(HY,(L2R), 4)))
		set t2 = CreateTrigger()
		set DOO = GetHandleId(t2)
		set level =(LoadInteger(HY,(L2R), 5))
		set BXR =(LoadReal(HY,(L2R), 1))
		set L3R = CreateUnit(GetOwningPlayer((LoadUnitHandle(HY,(L2R), 2))),'h07F', x, y, BXR)
		call SetUnitVertexColor(L3R, 255, 255, 255, 100)
		call UnitApplyTimedLife(L3R,'BTLF', 12)
		call SaveUnitHandle(HY,(L2R), 8,(L3R))
		call SaveUnitHandle(HY,(DOO), 8,(L3R))
		call SaveTriggerHandle(HY,(DOO), 9,(t1))
		call SaveInteger(HY,(DOO), 5,(level))
		call TriggerRegisterUnitInRange(t2, L3R,$EB, TrueBoolexprCondition)
		call TriggerRegisterUnitEvent(t2, L3R, EVENT_UNIT_DEATH)
		call TriggerAddCondition(t2, Condition(function L1R))
		call DestroyEffect(AddSpecialEffectTarget("effects\\ManaFlareBoltImpact_NoSound.mdx", L3R, "origin"))
	elseif EVX > 2 then
		set L3R =(LoadUnitHandle(HY,(L2R), 8))
		call DestroyEffect(AddSpecialEffectTarget("effects\\ManaFlareBoltImpact_NoSound.mdx", L3R, "origin"))
	endif
	set t1 = null
	set t2 = null
	set L3R = null
	return false
endfunction
function ZGV takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t1 = CreateTrigger()
	local integer L2R = GetHandleId(t1)
	local real x = GetUnitX(WUE)
	local real y = GetUnitY(WUE)
	call TriggerRegisterTimerEvent(t1, .5, true)
	call TriggerAddCondition(t1, Condition(function L4R))
	call SaveReal(HY,(L2R), 6,((x)* 1.))
	call SaveReal(HY,(L2R), 7,((y)* 1.))
	call SaveInteger(HY,(L2R), 5,(GetUnitAbilityLevel(WUE,'A14P')))
	call SaveUnitHandle(HY,(L2R), 2,(WUE))
	call SaveReal(HY,(L2R), 1,((GetUnitFacing(WUE))* 1.))
	call SaveEffectHandle(HY,(L2R), 3,(AddSpecialEffect("Abilities\\Spells\\Orc\\LightningShield\\LightningShieldTarget.mdl", x, y)))
	call SaveEffectHandle(HY,(L2R), 4,(AddSpecialEffect("effects\\Static_Remnant_FX.mdx", x, y)))
	set WUE = null
	set t1 = null
endfunction
function L5R takes nothing returns nothing
	call UnitDamageTargetEx(HTV, GetEnumUnit(), 1, HUV)
	call AddAbilityToTimed(GetEnumUnit(),'A335', 1, .6,'B08B')
endfunction
function L6R takes unit WUE, unit targetUnit returns nothing
	local integer h = GetHandleId(WUE)
	local group g = LoginGroup(165)
	call DestroyEffect((LoadEffectHandle(HY, h, 200)))
	call DestroyEffect((LoadEffectHandle(HY, h,$C9)))
	call SaveInteger(HY,(GetHandleId((WUE))),(4264), 2)
	set U2 = WUE
	set HTV = WUE
	set HUV = GetUnitAbilityLevel(WUE,'A0QW')* 20 +$A
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 300, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	call ForGroup(g, function L5R)
	call LogoutGroup(g)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl", GetUnitX(targetUnit), GetUnitY(targetUnit)))
	set g = null
endfunction
function L7R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local trigger L8R =(LoadTriggerHandle(HY, h,$CA))
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if GetEventDamageSource()== WUE and((LoadInteger(HY,(GetHandleId((WUE))),(4264)))== 1) then
			call DisableTrigger(t)
			call L6R(WUE, targetUnit)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call FlushChildHashtable(HY,(GetHandleId(L8R)))
			call CleanCurrentTrigger(L8R)
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	set WUE = null
	set L8R = null
	return false
endfunction
function L9R takes nothing returns nothing
	local trigger t = CreateTrigger()
	local unit targetUnit = GetTriggerUnit()
	local unit WUE = GetAttacker()
	local integer h = GetHandleId(t)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerRegisterTimerEvent(t, 2.5, false)
	call TriggerAddCondition(t, Condition(function L7R))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveTriggerHandle(HY, h,$CA,(GetTriggeringTrigger()))
	set t = null
	set targetUnit = null
	set WUE = null
endfunction
function MVR takes nothing returns boolean
	if GetAttacker()==(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 2)) and IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE)== false and IsUnitAlly(GetAttacker(), GetOwningPlayer(GetTriggerUnit()))== false then
		call L9R()
	endif
	return false
endfunction
function MER takes nothing returns nothing
	local trigger t = CreateTrigger()
	local unit WUE = GetTriggerUnit()
	local integer h = GetHandleId(WUE)
	local string fx = ""
	if IsUnitAlly(WUE, LocalPlayer) or IsObserver then
		set fx = "Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl"
	endif
	call SaveEffectHandle(HY, h, 200,(AddSpecialEffectTarget(fx, WUE, "right hand")))
	call SaveEffectHandle(HY, h,$C9,(AddSpecialEffectTarget(fx, WUE, "left hand")))
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerAddCondition(t, Condition(function MVR))
	call SaveUnitHandle(HY,(GetHandleId(t)), 2,(WUE))
	set t = null
	set WUE = null
endfunction
function MXR takes nothing returns boolean
	local integer WTV = GetSpellAbilityId()
	if(WTV =='A14O' or WTV =='A3FJ' or WTV =='A0SB' or X8R(WTV)) and(LoadInteger(HY, GetHandleId(GetTriggerUnit()), 4264)!= 1) and GetUnitAbilityLevel(GetTriggerUnit(),'A36D')== 0 and IsNotItemAbility(WTV) then
		call SaveInteger(HY, GetHandleId(GetTriggerUnit()), 4264, 1)
		call MER()
	endif
	return false
endfunction
function MZE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function MXR))
	set WUE = null
	set t = null
endfunction
function MOR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 17))
	local real a =(LoadReal(HY, h, 13))
	local real x = GetUnitX(u)-5 * Cos(a)
	local real y = GetUnitY(u)-5 * Sin(a)
	local integer lv =(LoadInteger(HY, h, 5))
	local real x0 =(LoadReal(HY, h, 6))
	local real y0 =(LoadReal(HY, h, 7))
	if((x0 -x)*(x0 -x))+((y0 -y)*(y0 -y))< 100  then
		set x = x0
		set y = y0
	endif
	call SetUnitX(u, x)
	call SetUnitY(u, y)
	if GetTriggerEvalCount(t)==($A+$A* lv) or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	return false
endfunction

function MRR takes unit u, unit target, real x, real y, integer lv returns nothing
	local unit d = null
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	if IsUnitType(target, UNIT_TYPE_HERO) then
		set d = CreateUnit(GetOwningPlayer(target),'u00X', x, y, GetUnitFacing(u))
	else
		set d = CreateUnit(GetOwningPlayer(u),'u00X', x, y, GetUnitFacing(u))
	endif
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterDeathEvent(t, target)
	call TriggerAddCondition(t, Condition(function MOR))
	call SaveUnitHandle(HY, h, 17,(target))
	call SaveReal(HY, h, 13,((Atan2(GetUnitY(target)-y, GetUnitX(target)-x))* 1.))
	call SaveInteger(HY, h, 5,(lv))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call UnitAddPermanentAbility(d,'A14Q')
	call SetUnitAbilityLevel(d,'A14Q', lv)
	if GetUnitAbilityLevel(target,'B0AD') == 1 then
		call UnitRemoveAbility(target, 'B0AD' )
	endif
	call IssueTargetOrderById(d, 852480, target)
	call UnitApplyTimedLife(d,'BTLF', 1 + .5 * lv)
	set d = null
	set t = null
endfunction

function UNOO takes nothing returns boolean
	return IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and IsAliveNotStrucNotWard(GetFilterUnit()) and not IsMagicImmuneUnit(GetFilterUnit())
endfunction

// 电子涡流
function ElectricVortex takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer lv
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local unit d
	local group g = null
	// 如果是马甲放的 那就设置为主人单位
	if GetUnitAbilityLevel(u,'Aloc')== 1 and HaveSavedHandle(HY, GetHandleId(u), 0) then
		set u = LoadUnitHandle(HY, GetHandleId(u), 0)
	endif
	// 在过滤马甲单位后再获取技能等级 否则会导致多重施法失败
	set lv = GetUnitAbilityLevel(u,'A14R')
	if lv == 0 then
		set lv = GetUnitAbilityLevel(u,'A3WT')
		set g = LoginGroup(166)
		set U2 = u
		call GroupEnumUnitsInRange(g, x, y, 275. + lv * 50., Condition(function UNOO))
		loop
			set d = FirstOfGroup(g)
		exitwhen d == null
			if GetUnitTypeId(d)!='n00L' then
				call MRR(u, d, x, y, lv)
				call UnitDamageTargetEx(u, d, 1, lv * 40 + 40)
			endif
			call GroupRemoveUnit(g, d)
		endloop
		call LogoutGroup(g)
		set g = null
	else
		set d = GetSpellTargetUnit()
		if GetUnitTypeId(d)!='n00L' and UnitHasSpellShield(d)== false then
			call MRR(u, d, x, y, lv)
			call UnitDamageTargetEx(u, d, 1, lv * 40 + 40)
		endif
	endif
	set u = null
	set d = null
endfunction
function MIR takes nothing returns nothing
	if(LoadBoolean(HY,(HWV),(GetHandleId(GetEnumUnit()))))== false then
		call SaveBoolean(HY,(HWV),(GetHandleId(GetEnumUnit())),(true))
		call UnitDamageTargetEx(HZV, GetEnumUnit(), 1, H_V *(HYV * 4 + 4)/  100 )
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl", GetEnumUnit(), "origin"))
	endif
endfunction
function MAR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer level =(LoadInteger(HY, h, 5))
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit MNR =(LoadUnitHandle(HY, h,$C3))
	local integer Y2X =(LoadInteger(HY, h,$C2))
	local real W_E =(LoadReal(HY, h, 6))
	local real W0E =(LoadReal(HY, h, 7))
	local real GRR = GetUnitX(WUE)
	local real GIR = GetUnitY(WUE)
	local real a = Atan2(W0E -GIR, W_E -GRR)
	local real LMR = LoadReal(HY, h, 0)
	local real NBX = GRR +(LMR)* Cos(a)
	local real NCX = GIR +(LMR)* Sin(a)
	local lightning APX =(LoadLightningHandle(HY, h,$C4))
	local real lx =(LoadReal(HY, h,$C5))
	local real ly =(LoadReal(HY, h,$C6))
	local real DDO = GetUnitState(WUE, UNIT_STATE_MANA)
	local real MBR
	local group g = LoginGroup(167)
	local real MCR =(LoadReal(HY, h,$C7))
	local boolean MDR = LoadBoolean(HY, h, 0)
	if MDR then
		set MBR =(LMR)*($A+ .006 * GetUnitState(WUE, UNIT_STATE_MAX_MANA))/  100 
	else
		set MBR =(LMR)*($C+ .007 * GetUnitState(WUE, UNIT_STATE_MAX_MANA))/  100 
	endif
	set MCR = MCR + LMR
	call SaveReal(HY, h,$C7,((MCR)* 1.))
	if GetTriggerEvalCount(t)> 25 then
		set lx = lx +(LMR)* Cos(a)
		set ly = ly +(LMR)* Sin(a)
		call SaveReal(HY, h,$C5,((lx)* 1.))
		call SaveReal(HY, h,$C6,((ly)* 1.))
	endif
	call SetUnitState(WUE, UNIT_STATE_MANA, RMaxBJ(DDO -MBR, 0))
	call MoveLightning(APX, true, lx, ly, NBX, NCX)
	if IsUnitType(WUE, UNIT_TYPE_HERO) then
		call SaveBoolean(K, GetHandleId(WUE), 99, true)
	endif
	call SetUnitX(WUE, NBX)
	call SetUnitY(WUE, NCX)
	call SetUnitPosition(dummyUnit, NBX, NCX)
	call SetUnitPosition(MNR, NBX, NCX)
	set U2 = WUE
	set HZV = WUE
	set HWV = h
	set HYV = level
	set H_V = MCR
	call GroupEnumUnitsInRange(g, NBX, NCX, 75 + 75 * level, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	call ForGroup(g, function MIR)
	call LogoutGroup(g)
	set Y2X = Y2X -1
	call SaveInteger(HY, h,$C2,(Y2X))
	call SetUnitVertexColorEx(WUE,-1,-1,-1, 0)
	if Y2X == 0 or GetUnitState(WUE, UNIT_STATE_MANA)< 1 then
		call DestroyLightning(APX)
		call KillDestructablesInCircle(NBX, NCX, 75)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call RemoveUnit(dummyUnit)
		call RemoveUnit(MNR)
		call SetUnitVertexColorEx(WUE,-1,-1,-1, 255)
		call SetUnitPathing(WUE, true)
		call SetUnitInvulnerableEx(WUE, false)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call KillDestructablesInCircle(NBX, NCX, 75)
	endif
	set t = null
	set dummyUnit = null
	set WUE = null
	set APX = null
	set g = null
	set MNR = null
	return false
endfunction
function ZJV takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local real WYE = GetUnitX(WUE)
	local real WZE = GetUnitY(WUE)
	local unit dummyUnit
	local unit MNR
	local real x
	local real y
	local trigger t
	local integer h
	local lightning APX
	local integer level = GetUnitAbilityLevel(WUE,'A14O')+ GetUnitAbilityLevel(WUE,'A3FJ')
	local real DDO = GetUnitState(WUE, UNIT_STATE_MANA)
	local real MBR = 30 + .08 * GetUnitState(WUE, UNIT_STATE_MAX_MANA)
	local boolean MDR = false
	local real distance
	if GetUnitAbilityLevel(WUE,'A3FJ')> 0 then
		set MBR =$F+ .05 * GetUnitState(WUE, UNIT_STATE_MAX_MANA)
		set MDR = true
	endif
	call SetUnitState(WUE, UNIT_STATE_MANA, RMaxBJ(DDO -MBR, 0))
	if GetUnitState(WUE, UNIT_STATE_MANA)>$A then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'o010', WYE, WZE, 0)
		set MNR = CreateUnit(GetOwningPlayer(WUE),'H07G', WYE, WZE, 0)
		set APX = AddLightning("FORK", true, WYE, WZE, WYE, WZE)
		if GetSpellTargetUnit()== null then
			set x = GetSpellTargetX()
			set y = GetSpellTargetY()
		else
			set x = GetUnitX(GetSpellTargetUnit())
			set y = GetUnitY(GetSpellTargetUnit())
		endif
		set distance = GetDistanceBetween(x, y, WYE, WZE)
		if distance < 25 + 25 * level then
			call SaveReal(HY, h, 0, distance)
		else
			call SaveReal(HY, h, 0, 25 + 25 * level)
		endif
		call SetUnitVertexColorEx(WUE,-1,-1,-1, 0)
		call SetUnitVertexColor(MNR, 255, 255, 255, 0)
		call SetUnitPathing(WUE, false)
		call SetUnitPathing(dummyUnit, false)
		call SetUnitInvulnerableEx(WUE, true)
		call SaveUnitHandle(HY, h, 19,(dummyUnit))
		call SaveUnitHandle(HY, h, 2,(WUE))
		call SaveUnitHandle(HY, h,$C3,(MNR))
		call SaveLightningHandle(HY, h,$C4,(APX))
		call SaveInteger(HY, h, 5,(level))
		call SaveReal(HY, h, 6,((x)* 1.))
		call SaveReal(HY, h, 7,((y)* 1.))
		call SaveReal(HY, h,$C5,((WYE)* 1.))
		call SaveReal(HY, h,$C6,((WZE)* 1.))
		call SaveReal(HY, h,$C7,(0 * 1.))
		call SaveInteger(HY, h,$C2,(IMaxBJ(R2I(SquareRoot((x -WYE)*(x -WYE)+(y -WZE)*(y -WZE))/(25 + 25 * level)), 1)))
		call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("effects\\Lightning_Ball_Tail_FX.mdx", MNR, "origin")))
		call TriggerRegisterTimerEvent(t, .04, true)
		call TriggerAddCondition(t, Condition(function MAR))
		//call ShowUnit(WUE, false)
		//call ShowUnit(WUE, true)
		//call SelectUnitAddForPlayer(WUE, GetOwningPlayer(WUE))
		call EXShowHideUnit(WUE)
		call SaveBoolean(HY, h, 0, MDR)
	endif
	set WUE = null
	set dummyUnit = null
	set MNR = null
	set t = null
	set APX = null
endfunction
function KDE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real mp = GetUnitState(u, UNIT_STATE_MANA)
	local real MFR
	if GetSpellAbilityId()=='A3FJ'then
		set MFR =$F+ .05 * GetUnitState(u, UNIT_STATE_MAX_MANA)
	else
		set MFR = 30 + .08 * GetUnitState(u, UNIT_STATE_MAX_MANA)
	endif
	if mp < MFR then
		call EXStopUnit(u)
		call InterfaceErrorForPlayer(GetOwningPlayer(u), GetObjectName('n0G8'))
	elseif IsUnitType(u, UNIT_TYPE_SNARED) then
		call EXStopUnit(u)
		call InterfaceErrorForPlayer(GetOwningPlayer(u), GetObjectName('n0ZD'))
	endif
	set u = null
endfunction
function MGR takes nothing returns nothing
	call SetUnitPathing(GetEnumUnit(), true)
	if IsUnitEnemy(GetEnumUnit(), GetOwningPlayer(MA)) then
		call UnitDamageTargetEx(MA, GetEnumUnit(), 1, QA)
		call AddAbilityToTimed(GetEnumUnit(),'A3B7', 1, 1.,'B3B7')
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl", GetEnumUnit(), "origin"))
	endif
endfunction
function MHR takes nothing returns nothing
	call SetUnitPosition(GetEnumUnit(), GetUnitX(GetEnumUnit())+ 40 * Cos(LA), GetUnitY(GetEnumUnit())+ 40 * Sin(LA))
	call KillDestructablesInCircle(GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()), 200)
	call SetUnitPathing(GetEnumUnit(), false)
endfunction
function MJR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local real a = LoadReal(HY, h, 0)
	local integer c = LoadInteger(HY, h, 0)-1
	local unit WJE = LoadUnitHandle(HY, h, 0)
	local real x = GetUnitX(WJE)
	local real y = GetUnitY(WJE)
	local group g = null
	if c < 1 or GetDistanceBetween(x, y, LoadReal(HY, h, 1), LoadReal(HY, h, 2))< 50 then
		set MA = WJE
		set QA = LoadInteger(HY, h, 5)* 50 + 50
		set g = LoginGroup(168)
		set U2 = WJE
		call GroupEnumUnitsInRange(g, x, y, 275, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call GroupAddGroup(g, LoadGroupHandle(HY, h, 10))
		call ForGroup(LoadGroupHandle(HY, h, 10), function MGR)
		call LogoutGroup(g)
		call KillDestructablesInCircle(x, y, 200)
		call DestroyLightning(LoadLightningHandle(HY, h, 11))
		call LogoutGroup(LoadGroupHandle(HY, h, 10))
		call DestroyTimerAndFlushHT_HY(t)
	else
		set LA = a
		call ForGroup(LoadGroupHandle(HY, h, 10), function MHR)
		call MoveLightning(LoadLightningHandle(HY, h, 11), true, x, y, LoadReal(HY, h, 1), LoadReal(HY, h, 2))
		call SaveInteger(HY, h, 0, c)
	endif
	set WJE = null
	set t = null
endfunction
function MKR takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and UnitIsDead(GetFilterUnit())== false)!= null
endfunction
function ERE takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local real x = GetUnitX(WJE)
	local real y = GetUnitY(WJE)
	local real dx = GetSpellTargetX()
	local real dy = GetSpellTargetY()
	local real radian = AngleBetweenXY(x, y, dx, dy)* bj_DEGTORAD
	local group g = LoginGroup(169)
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local lightning l
	local real WOV = 800 +$C8* GetUnitAbilityLevel(WJE, GetSpellAbilityId())
	if GetDistanceBetween(x, y, dx, dy)> WOV then
		set dx = x + WOV * Cos(radian)
		set dy = y + WOV * Sin(radian)
	endif
	set l = AddLightning("CLPB", true, x, y, dx, dy)
	call SetLightningColor(l, .75, .75, 1, .75)
	call GroupEnumUnitsInRange(g, x, y, 350, Condition(function MKR))
	call TimerStart(t, .03, true, function MJR)
	call SaveInteger(HY, h, 0, R2I(GetDistanceBetween(x, y, dx, dy)/ 40)+ 1)
	call SaveReal(HY, h, 0, radian)
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(WJE, GetSpellAbilityId()))
	call SaveGroupHandle(HY, h, 10, g)
	call SaveLightningHandle(HY, h, 11, l)
	call SaveUnitHandle(HY, h, 0, WJE)
	call SaveReal(HY, h, 1, dx)
	call SaveReal(HY, h, 2, dy)
	set l = null
	set t = null
	set WJE = null
	set g = null
endfunction
function MQR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	call UnitAddPermanentAbility(u,'A34D')
	call SaveInteger(HY, GetHandleId(u),'DEAT', 2)
	call DestroyTimerAndFlushHT_HY(t)
	set t = null
	set u = null
endfunction
function MSR takes unit u, real cd returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, cd, false, function MQR)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call UnitRemoveAbility(u,'A34D')
	call UnitRemoveAbility(u,'B0H7')
	call SaveInteger(HY, GetHandleId(u),'DEAT', 1)
	call IssueImmediateOrderById(u,$D01FE)
	set t = null
endfunction

function LearnLevel1Skill_DeathFraud takes nothing returns nothing
	local unit u = GetTriggerUnit()
	call UnitAddPermanentAbility(u,'A34D')
	set u = null
	set HaveDeathFraud = true
endfunction

function F1E takes nothing returns nothing
	/*local unit u = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer level = GetUnitAbilityLevel(u, GetSpellAbilityId())
	call MSR(u,$E-level)
	call TriggerRegisterUnitEvent(t, WLE, EVENT_UNIT_DAMAGED)
	call TriggerRegisterTimerEvent(t,$E-level, false)
	//call TriggerAddCondition(t, Condition(function MTR))
	call UnitAddPermanentAbility(WLE,'A34D')
	call SaveUnitHandle(HY, GetHandleId(t), 0, WLE)
	call SaveBoolean(HY, GetHandleId(t), 0, true)
	set t = null
	set WLE = null
	set u = null*/
endfunction
function J7E takes nothing returns nothing
	if IsUnitIllusion(GetSpellTargetUnit()) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "不能用于幻象")
	endif
endfunction
function MWR takes unit WUE returns nothing
	local integer level = GetUnitAbilityLevel(WUE,'A2AI')
	call SetUnitAbilityLevel(WUE,'A0AR', level)
endfunction
function P8E takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(WUE,'A2AI')
	if level == 1 then
		call UnitAddPermanentAbility(WUE,'A0AR')
	endif
	call MWR(WUE)
	set WUE = null
endfunction
function MYR takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if GetEventDamageSource()== LoadUnitHandle(HY, h, 0) then
			call CommonUnitAddStun(GetTriggerUnit(),(LoadReal(HY, h, 0)* .25)+ 2.25, false)
			call UnitDamageTargetEx(LoadUnitHandle(HY, h, 1), GetTriggerUnit(), 1, 25 * LoadReal(HY, h, 0))
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	endif
	set t = null
endfunction
function MZR takes nothing returns nothing
	local trigger t
	local integer h
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local unit d = CreateUnit(GetOwningPlayer(WJE),'e00E', GetUnitX(WJE), GetUnitY(WJE), 0)
	call UnitAddAbility(d,'A42F')
	if IssueTargetOrderById(d, 852095, WLE) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 3.5, false)
		call TriggerRegisterUnitEvent(t, WLE, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(t, Condition(function MYR))
		call SaveUnitHandle(HY, h, 0, d)
		call SaveUnitHandle(HY, h, 1, WJE)
		call SaveReal(HY, h, 0, GetUnitAbilityLevel(WJE, GetSpellAbilityId()))
		set t = null
	endif
	set d = null
	set WJE = null
	set WLE = null
endfunction
function ZKV takes nothing returns nothing
	local unit u = GetTriggerUnit()
	if GetUnitTypeId(u)=='H00G' or GetUnitTypeId(u)=='H00F' or GetUnitTypeId(u)=='H00E' then
		call SetUnitAnimation(u, "stand")
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Defend\\DefendCaster.mdl", u, "head"))
	elseif GetUnitTypeId(u)=='Hlgr' then
		call SetUnitAnimation(u, "stand defend")
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Defend\\DefendCaster.mdl", u, "origin"))
	endif
	set u = null
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call MZR()
	endif
endfunction
function PickDragonKnight takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A0AR')
	call AddAbilityIDToPreloadQueue('QB0G')
	//call SetAllPlayerAbilityUnavailable('A3KW')
endfunction
// 火焰气息
function BreatheFireDE takes nothing returns nothing
	local integer i = GetUnitAbilityLevel(DESourceUnit[DEI] ,'A3ES')
	if GetUnitAbilityLevel(DESourceUnit[DEI] ,'A3ES')> 0 then
		call AddAbilityToTimed(DETargetUnit[DEI],'A3KS', 1, 11,'B387')
		//call SetUnitAbilityLevel(DETargetUnit[DEI], 'A3KS', i)
		//call UnitMakeAbilityPermanent(DETargetUnit[DEI], true,'A3KS')
		call EnableEffectByTime(EFFECT_KEY_BREATHE_FIRE, 11)
	endif
endfunction
function ZMV takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit d = CreateUnit(GetOwningPlayer(WJE),'e00E', GetUnitX(WJE), GetUnitY(WJE), 0)
	call UnitAddAbility(d,'A3ES')
	call SetUnitAbilityLevel(d,'A3ES', GetUnitAbilityLevel(WJE,'A03F'))
	call TGV(3)
	if GetSpellTargetUnit()== WJE then
		call B1R(d, "breathoffire", GetUnitX(WJE)+ 1 * Cos(bj_DEGTORAD * GetUnitFacing(WJE)), GetUnitY(WJE)+ 1 * Sin(bj_DEGTORAD * GetUnitFacing(WJE)))
	else
		call B1R(d, "breathoffire", GetSpellTargetX(), GetSpellTargetY())
	endif
	set d = null
	set WJE = null
endfunction

// 刷新幻象的护甲 龙族血统
function SyncIllusionUnitDragonBlood takes nothing returns nothing
	local unit u = U2
	local integer lv = Q2
	call AddUnitState(u, UNIT_STATE_ARMOR, 3 * lv)
	set u = null
endfunction
function Q_E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A0CL')
	call AddUnitState(u, UNIT_STATE_ARMOR, 3)
	//call SetPlayerTechResearched(GetOwningPlayer(u),'R006', level)
	set u = null
endfunction

function M0R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	call MWR(WUE)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	return false
endfunction
function M1R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	call MWR(WUE)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	return false
endfunction
function L9X takes nothing returns nothing
	if GetUnitAbilityLevel(U2,'A0AR')> 0 or GetUnitAbilityLevel(U2,'QB0G')> 0 then
		call MWR(U2)
	endif
endfunction
function ZLV takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerAddCondition(t, Condition(function M0R))
	call SaveUnitHandle(HY, h, 2,(WUE))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerAddCondition(t, Condition(function M1R))
	call SaveUnitHandle(HY, h, 2,(WUE))
	set WUE = null
	set t = null
endfunction

function M4R takes nothing returns nothing
	local unit u = GetEnumUnit()
	if GetUnitTypeId(u)!='o01X' then
		call SetUnitPathing(u, true)
	endif
	call SaveInteger(HY,(GetHandleId((u))),(4336), 2)
	set u = null
endfunction
function M5R takes unit WLE returns nothing
	local unit d = CreateUnit(GetOwningPlayer(WLE),'e00E', GetUnitX(WLE), GetUnitY(WLE), 0)
	call UnitAddAbility(d,'A2TG')
	call SetUnitAbilityLevel(d,'A2TG', EH)
	call IssueTargetOrderById(d,$D02BC, WLE)
	set d = null
endfunction
function M6R takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), NH)== false then
		call GroupAddUnit(NH, GetEnumUnit())
		call M5R(GetEnumUnit())
		if XH == 1 then
			call UnitDamageTargetEx(RH, GetEnumUnit(), 1, 50 * EH)
		endif
	endif
endfunction
function M7R takes nothing returns nothing
	local unit u = GetEnumUnit()
	local real radian =(LoadReal(HY,(GetHandleId(u)), 801))
	local real N3X =(LoadReal(HY,(GetHandleId(u)), 802))
	local real M8R = BH + N3X * Cos(radian)
	local real M9R = CH + N3X * Sin(radian)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl", M8R, M9R))
	if GetUnitTypeId(u)=='o01X' or GetUnitTypeId(u)=='o020' then
		set XH = 1
		call SetUnitPosition(u, M8R, M9R)
		call SetUnitX(u, M8R)
		call SetUnitY(u, M9R)
	else
		call SetUnitX(u, M8R)
		call SetUnitY(u, M9R)
		call KillDestructablesInCircle(M8R, M9R, 100)
	endif
	set u = null
endfunction
function PVR takes nothing returns nothing
	local unit u = GetEnumUnit()
	if UnitIsDead(u) or((LoadInteger(HY,(GetHandleId((u))),(4306)))== 1) or GetUnitAbilityLevel(u,'B08V')> 0 or((LoadInteger(HY,(GetHandleId((u))),(4335)))== 1) then
		call GroupRemoveUnit(NH, u)
		call SaveInteger(HY,(GetHandleId((u))),(4336), 2)
		if GetUnitTypeId(u)!='o01X' then
			call SetUnitPathing(u, true)
		endif
	endif
	set u = null
endfunction
function PER takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE =(LoadUnitHandle(HY, h, 2))
	local group g =(LoadGroupHandle(HY, h, 803))
	local real PXR =(LoadReal(HY, h, 6))
	local real POR =(LoadReal(HY, h, 7))
	local real PRR =(LoadReal(HY, h, 23))
	local real PIR =(LoadReal(HY, h, 24))
	local real radian = bj_DEGTORAD * AngleBetweenXY(PRR, PIR, PXR, POR)
	local real PAR
	local real PNR
	local boolean b = false
	local group gg =(LoadGroupHandle(HY, h, 187))
	local group PBR
	set XH = 0
	set NH = g
	call ForGroup(g, function PVR)
	if GetTriggerEvalCount(t)>$C8 or FirstOfGroup(g)== null then
		set b = true
	else
		set PAR = PRR +1000* .03 * Cos(radian)
		set PNR = PIR +1000* .03 * Sin(radian)
		if GetDistanceBetween(PAR, PNR, PXR, POR)< 30 then
			set PAR = PXR
			set PNR = POR
			set b = true
		endif
		set PAR = CoordinateX50(PAR)
		set PNR = CoordinateY50(PNR)
		set NH = g
		set BH = PAR
		set CH = PNR
		call ForGroup(g, function M7R)
		call SaveReal(HY, h, 23,((PAR)* 1.))
		call SaveReal(HY, h, 24,((PNR)* 1.))
		set PBR = LoginGroup(170)
		set U2 = WJE
		set NH = gg
		set RH = WJE
		set EH = GetUnitAbilityLevel(WJE,'A2QI')
		call GroupEnumUnitsInRange(PBR, PAR, PNR,$CD, Condition(function DJX))
		call ForGroup(PBR, function M6R)
		call LogoutGroup(PBR)
		set PBR = null
	endif
	if b then
		call ForGroup(g, function M4R)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call LogoutGroup(gg)
		call LogoutGroup(g)
	endif
	set WJE = null
	set t = null
	set gg = null
	set g = null
	return false
endfunction
function PCR takes nothing returns boolean
	return GetUnitTypeId(GetFilterUnit())=='o01X' and GetOwningPlayer(GetFilterUnit())== GetOwningPlayer(U2)
endfunction
function PDR takes nothing returns nothing
	local unit u = GetEnumUnit()
	call SetUnitPathing(u, false)
	call SaveInteger(HY,(GetHandleId((u))),(4336), 1)
	call SaveReal(HY,(GetHandleId(u)), 801,((bj_DEGTORAD * AngleBetweenXY(BH, CH, GetUnitX(u), GetUnitY(u)))* 1.))
	call SaveReal(HY,(GetHandleId(u)), 802,((GetDistanceBetween(BH, CH, GetUnitX(u), GetUnitY(u)))* 1.))
	set u = null
endfunction
function ZPV takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local trigger t
	local integer h
	local real PRR = GetUnitX(GetSpellTargetUnit())
	local real PIR = GetUnitY(GetSpellTargetUnit())
	local real PXR = GetUnitX(WJE)
	local real POR = GetUnitY(WJE)
	local real radian = AngleBetweenXY(PXR, POR, PRR, PIR)
	local unit WLE = GetSpellTargetUnit()
	local group g
	if WLE == null then
		set g = LoginGroup(171)
		set U2 = WJE
		call GroupEnumUnitsInRange(g, GetSpellTargetX(), GetSpellTargetY(), 265, Condition(function PCR))
		if FirstOfGroup(g)== null then
			call LogoutGroup(g)
			set WJE = null
			set g = null
			return
		endif
		set WLE = FirstOfGroup(g)
		call LogoutGroup(g)
	endif
	set g = LoginGroup(172)
	call GroupAddUnit(g, WLE)
	set PRR = GetUnitX(WLE)
	set PIR = GetUnitY(WLE)
	set radian = AngleBetweenXY(PXR, POR, PRR, PIR)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	set BH = PRR
	set CH = PIR
	call ForGroup(g, function PDR)
	set PXR = PXR + 100 * Cos(radian * bj_DEGTORAD)
	set POR = POR + 100 * Sin(radian * bj_DEGTORAD)
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function PER))
	call SaveUnitHandle(HY, h, 2,(WJE))
	call SaveReal(HY, h, 6,((PXR)* 1.))
	call SaveReal(HY, h, 7,((POR)* 1.))
	call SaveReal(HY, h, 23,((PRR)* 1.))
	call SaveReal(HY, h, 24,((PIR)* 1.))
	call SaveGroupHandle(HY, h, 187,(LoginGroup(173)))
	call SaveGroupHandle(HY, h, 803,(g))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\MagneticGripTarget.mdx", WLE, "chest")))
	set WJE = null
	set t = null
	set g = null
	set WLE = null
endfunction
function KHE takes nothing returns nothing
	local unit WLE = GetSpellTargetUnit()
	local group g
	if WLE == null then
		set g = LoginGroup(174)
		set U2 = GetTriggerUnit()
		call GroupEnumUnitsInRange(g, GetSpellTargetX(), GetSpellTargetY(), 265, Condition(function PCR))
		if FirstOfGroup(g)== null then
			call EXStopUnit(GetTriggerUnit())
			if IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) then
				call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "附近没有发现岩石")
			endif
		endif
		call LogoutGroup(g)
	endif
	set g = null
	set WLE = null
endfunction
function PFR takes nothing returns boolean
	return(UnitIsDead(GetFilterUnit())== false and IsUnitEnemy(LH, GetOwningPlayer(GetFilterUnit())) and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and((LoadInteger(HY,(GetHandleId((GetFilterUnit()))),(809)))== 1))!= null
endfunction
function PGR takes nothing returns nothing
	call CNX((GetEnumUnit()),'A2QN', 1, 2,'B0GK')
endfunction
function PHR takes unit WLE returns nothing
	local group g = LoginGroup(175)
	if((LoadInteger(HY,(GetHandleId((WLE))),(809)))== 1) then
		call GroupEnumUnitsInRange(g, 0, 0, 99999, Condition(function PFR))
	endif
	call GroupAddUnit(g, WLE)
	call ForGroup(g, function PGR)
	call LogoutGroup(g)
	set g = null
endfunction
function PJR takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), KH)== false then
		call GroupAddUnit(KH, GetEnumUnit())
		if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
			set FH = true
			set MH = GetEnumUnit()
			if((LoadInteger(HY,(GetHandleId((GetEnumUnit()))),(809)))== 1) then
				set PH = GetEnumUnit()
			endif
			if GH == 1 then
				call UnitDamageTargetEx(LH, GetEnumUnit(), 1, HH * 1.5)
				call PHR(GetEnumUnit())
			else
				call UnitDamageTargetEx(LH, GetEnumUnit(), 1, HH)
			endif
		else
			if GH == 1 then
				call UnitDamageTargetEx(LH, GetEnumUnit(), 1, HH * 1.5)
			else
				call UnitDamageTargetEx(LH, GetEnumUnit(), 1, HH)
			endif
		endif
	endif
endfunction
function PKR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE =(LoadUnitHandle(HY, h, 2))
	local group g =(LoadGroupHandle(HY, h, 187))
	local group gg
	local unit W_V =(LoadUnitHandle(HY, h, 19))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local real PLR = GetUnitX(WJE)
	local real PMR = GetUnitY(WJE)
	local real PPR = GetDistanceBetween(x, y, PLR, PMR)
	local real M8R
	local real M9R
	local real PQR =(LoadReal(HY, h, 137))
	local real N3X = 800
	local integer PSR =(LoadInteger(HY, h, 34))
	local real PTR =(LoadReal(HY, h, 138))
	local boolean b = false
	local unit WLE =(LoadUnitHandle(HY, h, 810))
	local integer c = GetTriggerEvalCount(t)
	set FH = false
	call SetUnitTimeScale(WJE, 3)
	call SetUnitFacing(WJE, PQR)
	call SetUnitAnimationByIndex(WJE, 0)
	if c > 30 then
		if PSR == 0 then
			set gg = LoginGroup(176)
			set U2 = WJE
			call GroupEnumUnitsInRange(gg, PLR, PMR, 175, Condition(function PCR))
			if FirstOfGroup(gg)!= null then
				call KillUnit(FirstOfGroup(gg))
				set PSR = 1
				call SaveInteger(HY, h, 34,(PSR))
			endif
			call LogoutGroup(gg)
		endif
		if PSR == 1 then
			set N3X = N3X * 2
		endif
		if WLE != null then
			set PQR = AngleBetweenUnit(WJE, WLE)
			call SaveReal(HY, h, 137,((PQR)* 1.))
		endif
		set M8R = x + .02 * N3X * Cos(PQR * bj_DEGTORAD)
		set M9R = y + .02 * N3X * Sin(PQR * bj_DEGTORAD)
		if IsUnitType(WJE, UNIT_TYPE_HERO) then
			call SaveBoolean(K, GetHandleId(WJE), 99, true)
		endif
		call SetUnitX(WJE, CoordinateX50(M8R))
		call SetUnitY(WJE, CoordinateY50(M9R))
		call SaveReal(HY, h, 6,((GetUnitX(WJE))* 1.))
		call SaveReal(HY, h, 7,((GetUnitY(WJE))* 1.))
		call SetUnitX(W_V, GetUnitX(WJE))
		call SetUnitY(W_V, GetUnitY(WJE))
		call KillDestructablesInCircle(GetUnitX(WJE), GetUnitY(WJE), 100)
		set PPR = GetDistanceBetween(x, y, GetUnitX(WJE), GetUnitY(WJE))
		set PTR = PTR + PPR
		call SaveReal(HY, h, 138,((PTR)* 1.))
		set gg = LoginGroup(177)
		set U2 = WJE
		set LH = WJE
		set KH = g
		set DH = GetUnitAbilityLevel(WJE,'A2TJ')
		set MH = null
		set HH = 60 + 30 * DH
		set GH = PSR
		set PH = null
		if c < 40 then
			if c < 35 then
				call GroupEnumUnitsInRange(gg, GetUnitX(WJE), GetUnitY(WJE), RMinBJ( 100 ,(c -30)* 25), Condition(function DJX))
			else
				call GroupEnumUnitsInRange(gg, GetUnitX(WJE), GetUnitY(WJE), 125, Condition(function DJX))
			endif
		else
			call GroupEnumUnitsInRange(gg, GetUnitX(WJE), GetUnitY(WJE), 175, Condition(function DJX))
		endif
		call GroupEnumUnitsInRange(gg, GetUnitX(WJE), GetUnitY(WJE), 175, Condition(function DJX))
		call ForGroup(gg, function PJR)
		call LogoutGroup(gg)
		if PH != null then
			set gg = LoginGroup(178)
			set MH = null
			set OJ = 9999
			call GroupEnumUnitsInRange(gg, GetUnitX(PH), GetUnitY(PH), 625, Condition(function PFR))
			call LogoutGroup(gg)
			if MH == null then
				set b = true
				set MH = PH
			else
				set WLE = MH
				call SaveUnitHandle(HY, h, 810,(WLE))
			endif
		endif
	else
		if IsUnitType(WJE, UNIT_TYPE_HERO) then
			call SaveBoolean(K, GetHandleId(WJE), 99, true)
		endif
		call SetUnitX(WJE, x)
		call SetUnitY(WJE, y)
	endif
	if C5X(WJE) or GetTriggerEventId()== EVENT_WIDGET_DEATH or b or(WLE == null and(c >$82 or FH or(PSR == 0 and PTR > 800) or(PSR == 1 and PTR >$640))) then
		call KillUnit(W_V)
		call LogoutGroup(g)
		call DestroyEffect(LoadEffectHandle(HY, h, 5))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SetUnitTimeScale(WJE, 1)
		if FH then
			set M8R = GetUnitX(MH)+ 50 * Cos(PQR * bj_DEGTORAD)
			set M9R = GetUnitY(MH)+ 50 * Sin(PQR * bj_DEGTORAD)
			if IsUnitType(WJE, UNIT_TYPE_HERO) then
				call SaveBoolean(K, GetHandleId(WJE), 99, true)
			endif
			call SetUnitX(WJE, CoordinateX50(M8R))
			call SetUnitY(WJE, CoordinateY50(M9R))
			call IssueTargetOrderById(WJE, 851983, MH)
		endif
	endif
	set WJE = null
	set t = null
	set gg = null
	set g = null
	set W_V = null
	set WLE = null
	return false
endfunction
function PUR takes unit WJE, unit WLE returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit d = CreateUnit(GetOwningPlayer(WJE),'o01P', GetUnitX(WJE), GetUnitY(WJE), 0)
	local real radian = AngleBetweenXY(GetUnitX(WJE), GetUnitY(WJE), GetSpellTargetX(), GetSpellTargetY())
	call SaveEffectHandle(HY, h, 5, AddSpecialEffectTarget("war3mapImported\\RollingBoulder.mdx", WJE, "origin"))
	call SetUnitTimeScale(WJE, 3)
	call TriggerRegisterDeathEvent(t, WJE)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function PKR))
	call SaveUnitHandle(HY, h, 2,(WJE))
	call SaveGroupHandle(HY, h, 187,(LoginGroup(179)))
	call SaveUnitHandle(HY, h, 19,(d))
	call SaveReal(HY, h, 6,((GetUnitX(WJE))* 1.))
	call SaveReal(HY, h, 7,((GetUnitY(WJE))* 1.))
	call SaveReal(HY, h, 137,((radian)* 1.))
	call SaveInteger(HY, h, 34, 0)
	call SaveReal(HY, h, 138,(0 * 1.))
	call SaveUnitHandle(HY, h, 810,(null))
	if WLE != null and GetUnitTypeId(WLE)=='o01X' then
		call KillUnit(WLE)
	endif
	set t = null
	set d = null
endfunction
function PWR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE =(LoadUnitHandle(HY, h, 2))
	local real PYR =(LoadReal(HY, h, 442))
	local integer PZR =(LoadInteger(HY,(GetHandleId(WJE)), 800))
	if GetTriggerEventId()== EVENT_UNIT_SPELL_CAST then
		if(GetSpellAbilityId()=='A2TH') and PZR <= 0 then
			call InterfaceErrorForPlayer(GetOwningPlayer(WJE), "没有足够的巨石了")
			call EXStopUnit(WJE)
		endif
	elseif GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT then
		if GetSpellAbilityId()=='A2TH' or GetSpellAbilityId()=='A2TJ' then
			if GetSpellAbilityId()=='A2TJ' then
				call PUR(WJE, null)
			endif
		endif
	elseif PZR < 6 then
		set PYR = PYR -0.2
		call SaveReal(HY, h, 442,((PYR)* 1.))
		if PYR <= 0.00 then
			set PZR = PZR + 1
			call SaveInteger(HY,(GetHandleId(WJE)), 800,(PZR))
			call SaveReal(HY, h, 442,(25 * 1.))
		endif
	endif
	set WJE = null
	set t = null
	return false
endfunction
function P_R takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_CAST)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function PWR))
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveReal(HY, h, 442, 30.)
	call SaveInteger(HY,(GetHandleId(u)), 800, 6)
	set t = null
endfunction
function P0R takes unit P1R returns nothing
	local unit P2R = Player__Hero[GetPlayerId(GetOwningPlayer(P1R))]
	local integer h = GetHandleId(P2R)
	local integer level = GetUnitAbilityLevel(P2R,'A2TH')
	local integer P3R =(LoadInteger(HY, h, 279))
	local integer i = 1
	local integer k = 1
	local unit P4R
	loop
	exitwhen i > P3R
		set P4R =(LoadUnitHandle(HY, h,($578+ i)))
		if UnitIsDead(P4R)== false then
			call SaveUnitHandle(HY, h,($578+ k),(P4R))
			set k = k + 1
		endif
		set i = i + 1
	endloop
	set P3R = P3R -1
	call SaveInteger(HY, h, 279,(P3R))
	set P4R = null
	set P2R = null
endfunction
function P5R takes nothing returns boolean
	if GetUnitTypeId(GetTriggerUnit())=='o01X' then
		call P0R(GetTriggerUnit())
	endif
	return false
endfunction
function ZQV takes nothing returns nothing
	local unit P6R
	local unit WJE = GetTriggerUnit()
	local integer h = GetHandleId(WJE)
	local integer level = GetUnitAbilityLevel(WJE,'A2TH')
	local integer P3R =(LoadInteger(HY, h, 279))
	local unit P7R =(LoadUnitHandle(HY, h,$579))
	local real x
	local real y
	local integer PZR =(LoadInteger(HY,(GetHandleId(WJE)), 800))
	if PZR > 0 then
		set PZR = IMaxBJ(0, PZR -1)
		if PZR < 2 then
			call DisplayTimedTextToPlayer(GetOwningPlayer(WJE), 0, 0, 10, I2S(PZR)+ " 剩余巨石")
		endif
		call SaveInteger(HY,(GetHandleId(WJE)), 800,(PZR))
		if GetSpellTargetUnit()== null then
			set x = GetSpellTargetX()
			set y = GetSpellTargetY()
		else
			set x = GetUnitX(GetSpellTargetUnit())
			set y = GetUnitY(GetSpellTargetUnit())
		endif
		set P6R = CreateUnit(GetOwningPlayer(WJE),'o01X', x, y, 0)
		call SaveInteger(HY, GetHandleId(P6R), 4335, 0)
		call SaveInteger(HY, GetHandleId(P6R), 4340, 0)
		call UnitApplyTimedLife(P6R,'BTLF', 120)
		call SetUnitPathing(P6R, false)
		set P3R = P3R + 1
		call SaveUnitHandle(HY, h,($578+ P3R),(P6R))
		call SaveInteger(HY, h, 279,(P3R))
		if(P3R > 6) then
			call KillUnit(P7R)
		endif
	else
		call InterfaceErrorForPlayer(GetOwningPlayer(WJE), "没有可用的石头")
	endif
	set P6R = null
	set WJE = null
	set P7R = null
endfunction
function Kaolin_Stones_Summon takes nothing returns boolean
	if GetSpellAbilityId()=='A2TH' then
		call ZQV()
	endif
	return false
endfunction
function MGX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function P5R))
	set t = null
endfunction
function P8R takes nothing returns boolean
	return(UnitIsDead(GetFilterUnit())== false and IsUnitEnemy(QH, GetOwningPlayer(GetFilterUnit())) and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and((LoadInteger(HY,(GetHandleId((GetFilterUnit()))),(809)))== 1))!= null
endfunction
function P9R takes nothing returns nothing
	call CommonUnitAddStun(GetEnumUnit(), .25 + .5 * XJ, false)
endfunction
function QVR takes unit u returns nothing
	local group g = LoginGroup(180)
	if((LoadInteger(HY,(GetHandleId((u))),(809)))== 1) then
		call GroupEnumUnitsInRange(g, 0, 0, 99999, Condition(function P8R))
	endif
	call GroupAddUnit(g, u)
	call ForGroup(g, function P9R)
	call LogoutGroup(g)
	set g = null
endfunction
function QER takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), ZH)== false then
		call GroupAddUnit(ZH, GetEnumUnit())
		call UnitDamageTargetEx(QH, GetEnumUnit(), 1, NJ)
		if VJ == 1 then
			call QVR(GetEnumUnit())
		endif
		if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) and(LoadInteger(HY, GetHandleId(GetEnumUnit()), 809)== 1) then
			set UH = GetEnumUnit()
		endif
	endif
endfunction
function QXR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE =(LoadUnitHandle(HY, h, 2))
	local unit WLE =(LoadUnitHandle(HY, h, 17))
	local real dx =(LoadReal(HY, h, 6))
	local real dy =(LoadReal(HY, h, 7))
	local real QOR
	local real PRR =(LoadReal(HY, h, 23))
	local real PIR =(LoadReal(HY, h, 24))
	local real M8R
	local real M9R
	local boolean b = false
	local group g =(LoadGroupHandle(HY, h, 187))
	local group gg
	local unit QRR =(LoadUnitHandle(HY, h, 810))
	if QRR != null then
		set dx = GetUnitX(QRR)
		set dy = GetUnitY(QRR)
	endif
	set QOR = bj_DEGTORAD * AngleBetweenXY(GetUnitX(WLE), GetUnitY(WLE), dx, dy)
	set M8R = PRR + 1200* .03 * Cos(QOR)
	set M9R = PIR + 1200* .03 * Sin(QOR)
	if GetDistanceBetween(M8R, M9R, dx, dy)<(5 + 1200* .03) then
		set M8R = dx
		set M9R = dy
		set b = true
	endif
	set M8R = CoordinateX50(M8R)
	set M9R = CoordinateY50(M9R)
	set ZH = g
	set QH = WJE
	set XJ = GetUnitAbilityLevel(WJE,'A2QM')
	set NJ = 50 * XJ
	set UH = null
	if((LoadInteger(HY,(GetHandleId(WLE)), 4306))== 1) or GetTriggerEventId()== EVENT_WIDGET_DEATH or GetUnitAbilityLevel(WLE,'B08V')> 0 or((LoadInteger(HY,(GetHandleId(WLE)), 4336))== 1) or(QRR == null and GetTriggerEvalCount(t)>$C8) then
		set b = true
	else
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl", M8R, M9R))
		if GetUnitTypeId(WLE)=='o01X' or GetUnitTypeId(WLE)=='o020' then
			set VJ = 1
			call SetUnitPosition(WLE, M8R, M9R)
			call SetUnitX(WLE, CoordinateX50(M8R))
			call SetUnitY(WLE, CoordinateY50(M9R))
		else
			set VJ = 0
			call SetUnitX(WLE, CoordinateX50(M8R))
			call SetUnitY(WLE, CoordinateY50(M9R))
		endif
		call KillDestructablesInCircle(M8R, M9R, 150)
		call SaveReal(HY, h, 23,((M8R)* 1.))
		call SaveReal(HY, h, 24,((M9R)* 1.))
		set gg = LoginGroup(181)
		set U2 = WJE
		call GroupEnumUnitsInRange(gg, M8R, M9R,$E1, Condition(function DJX))
		call GroupRemoveUnit(gg, WLE)
		call ForGroup(gg, function QER)
		call LogoutGroup(gg)
		if UH != null and VJ == 1 then
			set gg = LoginGroup(182)
			set TH = null
			set OJ = 9999
			call GroupEnumUnitsInRange(gg, GetUnitX(UH), GetUnitY(UH), 625, Condition(function P8R))
			call LogoutGroup(gg)
			if TH != null then
				set QRR = TH
				call SaveUnitHandle(HY, h, 810,(QRR))
				set b = false
			endif
		endif
		set gg = null
	endif
	if b then
		if GetUnitTypeId(WLE)!='o01X' then
			call SetUnitPathing(WLE, true)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call LogoutGroup(g)
		call SaveInteger(HY,(GetHandleId((WLE))),(4335), 2)
		if GetTriggerEventId()!= EVENT_WIDGET_DEATH then
			if IsPlayerAlly(GetOwningPlayer(WJE), GetOwningPlayer(WLE))== false then
				call UnitDamageTargetEx(QH, WLE, 1, NJ)
			endif
		endif
	endif
	set WLE = null
	set t = null
	set g = null
	set WJE = null
	set QRR = null
	return false
endfunction
function QIR takes nothing returns nothing
	local unit WLE = GetSpellTargetUnit()
	local unit WJE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real radian
	local real dx
	local real dy
	local real x = GetUnitX(WJE)
	local real y = GetUnitY(WJE)
	local integer i =-1
	local boolean b = false
	local real QAR = 400 + 100 * GetUnitAbilityLevel(WJE, GetSpellAbilityId())
	local group g
	if WLE == null then
		set g = LoginGroup(183)
		set U2 = WJE
		call GroupEnumUnitsInRange(g, x, y,$E1, Condition(function PCR))
		set WLE = GetNearestUnitByGroup(g, x, y)
		call LogoutGroup(g)
		set g = null
		set radian = AngleBetweenXY(GetUnitX(WLE), GetUnitY(WLE), GetSpellTargetX(), GetSpellTargetY())
	else
		set radian = AngleBetweenUnit(WJE, WLE)
	endif
	if WLE == null then
		return
	endif
	if GetUnitTypeId(WLE)=='o01X' then
		set QAR =$7D0
	endif
	loop
	exitwhen b or i == R2I(QAR / 25)
		set i = i + 1
		set dx = CoordinateX50(GetUnitX(WLE)+(QAR -i * 25)* Cos(radian * bj_DEGTORAD))
		set dy = CoordinateY50(GetUnitY(WLE)+(QAR -i * 25)* Sin(radian * bj_DEGTORAD))
		if(IsPointInRegion(R4,((dx)* 1.),((dy)* 1.)))== false then
			set b = true
		endif
	endloop
	call SetUnitPathing(WLE, false)
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerRegisterDeathEvent(t, WLE)
	call TriggerAddCondition(t, Condition(function QXR))
	call SaveUnitHandle(HY, h, 2,(WJE))
	call SaveUnitHandle(HY, h, 17,(WLE))
	call SaveReal(HY, h, 6,((dx)* 1.))
	call SaveReal(HY, h, 7,((dy)* 1.))
	call SaveReal(HY, h, 23,((GetUnitX(WLE))* 1.))
	call SaveReal(HY, h, 24,((GetUnitY(WLE))* 1.))
	call SaveInteger(HY, h, 34, 0)
	call SaveGroupHandle(HY, h, 187,(LoginGroup(184)))
	call SaveUnitHandle(HY, h, 810,(null))
	call SaveInteger(HY,(GetHandleId((WLE))),(4335), 1)
	set WLE = null
	set WJE = null
	set t = null
endfunction
function QNR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 1)
	local integer hu = GetHandleId(u)
	local unit WLE = LoadUnitHandle(HY, h, 0)
	local integer QBR = GetUnitCurrentOrder(u)
	if QBR != LoadInteger(HY, h, 0) then
		if QBR !=$D0005 then
			call CleanCurrentTrigger(t)
			call FlushChildHashtable(HY, h)
			call RemoveSavedHandle(HY, hu,'A2UU')
		else
			call IssuePointOrderById(u, 851986, GetUnitX(WLE), GetUnitY(WLE))
		endif
	else
		if GetDistanceBetweenUnits(u, WLE)<=$C8 then
			call CleanCurrentTrigger(t)
			call FlushChildHashtable(HY, h)
			call RemoveSavedHandle(HY, hu,'A2UU')
			call IssueTargetOrderById(u,$D00DD, WLE)
		endif
	endif
	set WLE = null
	set u = null
	set t = null
	return false
endfunction
function QCR takes unit u, unit WLE returns nothing
	local trigger t
	local integer h
	local integer hu = GetHandleId(u)
	if HaveSavedHandle(HY, hu,'A2UU') then
		set t = LoadTriggerHandle(HY, hu,'A2UU')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .02, true)
		call TriggerAddCondition(t, Condition(function QNR))
		call SaveTriggerHandle(HY, hu,'A2UU', t)
		call SaveUnitHandle(HY, h, 1, u)
	endif
	call IssueTargetOrderById(u, 851986, WLE)
	call SaveUnitHandle(HY, h, 0, WLE)
	call SaveInteger(HY, h, 0, 851986)
	set t = null
endfunction
function QDR takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local group g = LoginGroup(185)
	set U2 = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u),$CD, Condition(function PCR))
	if FirstOfGroup(g)== null then
		call EXStopUnit(u)
		if IsUnitType(u, UNIT_TYPE_HERO) then
			call InterfaceErrorForPlayer(GetOwningPlayer(u), "无效目标")
		endif
	endif
	call LogoutGroup(g)
	set u = null
	set WLE = null
	set g = null
endfunction
function QFR takes nothing returns nothing
	if GetDistanceBetweenUnits(GetTriggerUnit(), GetSpellTargetUnit())>$C8 then
		call QCR(GetTriggerUnit(), GetSpellTargetUnit())
	endif
endfunction
function ZSV takes nothing returns nothing
	if IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) or not UnitHasSpellShield(GetSpellTargetUnit()) then
		call QIR()
	endif
endfunction
function J_E takes nothing returns nothing
	if GetSpellTargetUnit()== null then
		call QDR()
	elseif(GetDistanceBetweenUnits(GetTriggerUnit(), GetSpellTargetUnit())>$AA and GetUnitTypeId(GetSpellTargetUnit())!='n00L') then
		call QFR()
	elseif GetUnitTypeId(GetSpellTargetUnit())=='n00L' then
		call EXStopUnit(GetTriggerUnit())
		if IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) then
			call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "无效目标")
		endif
	endif
endfunction
function QGR takes nothing returns nothing
	set YH = GetEnumUnit()
	call ExecuteFunc("QHR")
endfunction
function QJR takes nothing returns boolean
	return UnitIsDead(GetFilterUnit())== false and GetUnitTypeId(GetFilterUnit())=='o01X' and((LoadInteger(HY,(GetHandleId((GetFilterUnit()))),(4335)))== 1)== false and((LoadInteger(HY,(GetHandleId((GetFilterUnit()))),(4340)))== 1)== false
endfunction
function QKR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 2)
	local unit SZX = LoadUnitHandle(HY, h, 17)
	local real x = GetUnitX(SZX)
	local real y = GetUnitY(SZX)
	local group g = LoginGroup(186)
	local integer C2R = GetTriggerEvalCount(t)
	local integer level = GetUnitAbilityLevel(WJE,'A2TI')
	local real QLR =(LoadReal(HY,(GetHandleId(SZX)), 807))
	if ModuloInteger(C2R, 5)== 0 then
		call UnitDamageTargetEx(WJE, SZX, 1,(25 + 25 * level)/ 2)
	endif
	set WH = WJE
	set U2 = WJE
	call GroupEnumUnitsInRange(g, x, y, 325, Condition(function QJR))
	call ForGroup(g, function QGR)
	call LogoutGroup(g)
	if(GetGameTime())> QLR or UnitIsDead(SZX) then
		call SaveInteger(HY, GetHandleId(SZX), 809, 2)
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WJE = null
	set SZX = null
	set g = null
	return false
endfunction
function QMR takes unit u, unit SZX returns nothing
	local trigger t
	local integer h
	local real QPR = LoadReal(HY, GetHandleId(SZX), 807)
	call SaveReal(HY,(GetHandleId(SZX)), 807,(((GetGameTime())+ 6)* 1.))
	if QPR <(GetGameTime()) then
		call SaveInteger(HY,(GetHandleId((SZX))), 809, 1)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(u))
		call SaveUnitHandle(HY, h, 17,(SZX))
		call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\MagnetizeTargetOverhead.mdx", SZX, "origin")))
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerAddCondition(t, Condition(function QKR))
	endif
	set t = null
endfunction
function QQR takes nothing returns nothing
	call QMR(WH, GetEnumUnit())
endfunction
function QSR takes unit u, unit WLE returns nothing
	local group g = LoginGroup(187)
	local real x = GetUnitX(WLE)
	local real y = GetUnitY(WLE)
	local real QTR = 300
	if GetUnitTypeId(WLE)=='o01X' then
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\DemolisherMissile\\DemolisherMissile.mdx", GetUnitX(WLE), GetUnitY(WLE)))
		call UnitApplyTimedLife(WLE,'BTLF', 5)
		call SaveInteger(HY,(GetHandleId((WLE))),(4340), 1)
		call SetUnitVertexColor(WLE, 0, 0, 0, 100)
		set QTR = 600
	else
		call DestroyEffect(AddSpecialEffect("war3mapImported\\MagnetizeCastAoE.mdx", GetUnitX(WLE), GetUnitY(WLE)))
	endif
	set U2 = u
	set WH = u
	set YH = WLE
	call GroupEnumUnitsInRange(g, x, y, QTR + 25, Condition(function DJX))
	call ForGroup(g, function QQR)
	call LogoutGroup(g)
	set g = null
endfunction
function QHR takes nothing returns nothing
	call QSR(WH, YH)
endfunction
function F3E takes nothing returns nothing
	call QSR(GetTriggerUnit(), GetTriggerUnit())
endfunction
function QUR takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='o01X' then
		call KillUnit(GetFilterUnit())
	endif
	return false
endfunction
function QWR takes unit u returns nothing
	local group g
	local player p
	if not Mode__DeathMatch  or IsUnitType(u, UNIT_TYPE_HERO)== false or LoadBoolean(HY, GetHandleId(u), QR) then
		return
	endif
	if Mode__DeathMatch and GetUnitAbilityLevel(u,'A2TH')> 0 then
		set g = LoginGroup(188)
		set p = GetOwningPlayer(u)
		call GroupEnumUnitsOfPlayer(g, p, Condition(function QUR))
		call LogoutGroup(g)
		set g = null
	endif
endfunction
function QYR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call SetUnitAnimationByIndex(LoadUnitHandle(HY, h, 2), 8)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function QZR takes nothing returns nothing
	local timer t
	local unit u = GetTriggerUnit()
	if GetUnitTypeId(u)=='N0MU' then
		set t = CreateTimer()
		call SetUnitAnimationByIndex(u, 7)
		call TimerStart(t, 2.5, false, function QYR)
		call SaveUnitHandle(HY, GetHandleId(t), 2, u)
		set t = null
	endif
	set u = null
endfunction
function Q_R takes nothing returns nothing
	call AddSpecialEffectTargetToTimed("war3mapImported\\FortunesEndTarget.mdx", GetEnumUnit(), "origin", 3)
	call IssueTargetOrderById(IG, 852111, GetEnumUnit())
	call UnitRemoveAbility(GetEnumUnit(),'A2T4')
	call UnitDamageTargetEx(RG, GetEnumUnit(), 1, 60 + 30 * BG)
endfunction
function Q0R takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit WLE =(LoadUnitHandle(HY,(GetHandleId(WJE)), 796))
	local real WIE = RMinBJ((GetGameTime())-(LoadReal(HY,(GetHandleId(WJE)), 358)), 3)
	local integer level = GetUnitAbilityLevel(WJE,'A2QT')
	local integer Q1R = R2I(2. * WIE)
	local unit W_V = CreateUnit(GetOwningPlayer(WJE),'e00E', GetUnitX(WJE), GetUnitY(WJE), GetUnitFacing(WJE))
	local unit Q2R
	local group g
	local integer T0V ='A594'
	if Q1R > 3 then
		set T0V ='A595'
		set Q1R = Q1R -3
	endif
	if WLE != null then
		set Q2R = CreateUnit(GetOwningPlayer(WJE),'o00Z', GetUnitX(WLE), GetUnitY(WLE), 0)
		call UnitApplyTimedLife(Q2R,'BTLF', .5)
		call UnitAddAbility(W_V, T0V)
		call SetUnitAbilityLevel(W_V, T0V, Q1R)
		set U2 = WJE
		set RG = WJE
		set IG = W_V
		set BG = level
		set g = LoginGroup(189)
		call GroupEnumUnitsInRange(g, GetUnitX(WLE), GetUnitY(WLE), 325, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call ForGroup(g, function Q_R)
		if GetUnitAbilityLevel(WLE,'A3E9')== 1 and IsMagicImmuneUnit(WJE)== false then
			if UnitHasSpellShield(WJE)== false then
				call SetUnitOwner(W_V, GetOwningPlayer(WLE), true)
				call SetUnitX(W_V, GetUnitX(WJE))
				call SetUnitY(W_V, GetUnitY(WJE))
				set U2 = WLE
				set RG = WLE
				set IG = W_V
				set BG = level
				call GroupEnumUnitsInRange(g, GetUnitX(WJE), GetUnitY(WJE), 325, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
				call ForGroup(g, function Q_R)
			else
				call AJO(WJE)
			endif
		endif
		call LogoutGroup(g)
	endif
	set WJE = null
	set WLE = null
	set W_V = null
	set Q2R = null
	set g = null
endfunction
function Q3R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE =(LoadUnitHandle(HY, h, 14))
	local unit WLE =(LoadUnitHandle(HY, h, 17))
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call SaveReal(HY,(GetHandleId(WJE)), 356,((GetUnitX(WLE))* 1.))
		call SaveReal(HY,(GetHandleId(WJE)), 357,((GetUnitY(WLE))* 1.))
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WJE = null
	set WLE = null
	return false
endfunction
function Q4R takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WJE = GetTriggerUnit()
	call SaveReal(HY,(GetHandleId(WJE)), 358,(((GetGameTime()))* 1.))
	call SaveUnitHandle(HY,(GetHandleId(WJE)), 796,(GetSpellTargetUnit()))
	call DestroyEffect(AddSpecialEffect("war3mapImported\\CleanseTargetArea.mdx", GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit())))
	call SaveUnitHandle(HY, h, 14,(WJE))
	call SaveUnitHandle(HY, h, 17,(GetSpellTargetUnit()))
	call TriggerRegisterTimerEvent(t, 10, false)
	call TriggerRegisterDeathEvent(t, GetSpellTargetUnit())
	call TriggerAddCondition(t, Condition(function Q3R))
	set t = null
	set WJE = null
endfunction
function SpellEffect__FortuneEnd takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call SaveBoolean(HY,(GetHandleId(GetTriggerUnit())), 360,(true))
	endif
endfunction
function JFE takes nothing returns nothing
	if LoadBoolean(HY, GetHandleId(GetTriggerUnit()), 360) then
		call Q0R()
	endif
endfunction
function KJE takes nothing returns nothing
	call SaveBoolean(HY,(GetHandleId(GetTriggerUnit())), 360,(false))
	call Q4R()
endfunction
function FateEdictEnd takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WLE =(LoadUnitHandle(HY, h, 17))
	local real dur = LoadReal(HY, h, 1)
	local integer hu
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		set hu = GetHandleId(WLE)

		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(WLE,'A3KE')
		call UnitRemoveAbility(WLE,'B3KE')
		call UnitRemoveAbility(WLE,'A3KD')
		call RemoveSavedHandle(HY, GetHandleId(WLE),'A2T5')
		call SetUnitImmunityMagicDamage(WLE, false)
	elseif dur < GetGameTime() or GetUnitAbilityLevel(WLE,'A3KD')== 0 then
		set hu = GetHandleId(WLE)
		
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(WLE,'A3KE')
		call UnitRemoveAbility(WLE,'B3KE')
		call UnitRemoveAbility(WLE,'A3KD')
		call RemoveSavedHandle(HY, GetHandleId(WLE),'A2T5')
		call SetUnitImmunityMagicDamage(WLE, false)
	endif
	set t = null
	set WLE = null
	return false
endfunction

// 命运敕令
function FateEdictAdd takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(WJE,'A2T5')
	local trigger t
	local integer h
	local real dur = 2 + level * 1
	if HaveSavedHandle(HY, GetHandleId(targetUnit),'A2T5') then
		set t = LoadTriggerHandle(HY, GetHandleId(targetUnit),'A2T5')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, GetHandleId(targetUnit),'A2T5', t)
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function FateEdictEnd))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
	endif
	call DisarmUnitToTimed(targetUnit, 'A3KD', 'A3KE', 'B3KE', dur)
	call SetUnitImmunityMagicDamage(targetUnit, true)

	call EnableEffectByTime(EFFECT_KEY_FATE_EDICT, dur)

	call SaveInteger(HY, h, 0, 0)
	call SaveReal(HY, h, 1, dur + GetGameTime())
	set WJE = null
	set targetUnit = null
	set t = null
endfunction
function SpellEffect__FateEdict takes nothing returns nothing
	if IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) or not UnitHasSpellShield(GetSpellTargetUnit()) then
		call FateEdictAdd()
	endif
endfunction
function Q7R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WLE =(LoadUnitHandle(HY, h, 17))
	local integer level = LoadInteger(HY, h, 5)
	local integer C2R =(LoadInteger(HY, h, 34))
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or C2R > 9 * 5 or LoadInteger(HY, GetHandleId(WLE),'A2SG')== 0 then
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call SaveInteger(HY, GetHandleId(WLE),'A2SG', IMaxBJ(LoadInteger(HY, GetHandleId(WLE),'A2SG')-1, 0))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set C2R = C2R + 1
		call SaveInteger(HY, h, 34,(C2R))
		if ModuloInteger(C2R, 5)== 0 then
			call SetWidgetLife(WLE, GetWidgetLife(WLE)+$B* level)
		endif
	endif
	set t = null
	set WLE = null
	return false
endfunction
function Q8R takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(WJE,'A2SG')
	local real ZCE = level * 90
	local real Q9R = .75
	call SaveInteger(HY, GetHandleId(WLE),'A2SG', LoadInteger(HY, GetHandleId(WLE),'A2SG')+ 1)
	call TriggerRegisterDeathEvent(t, WLE)
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerAddCondition(t, Condition(function Q7R))
	call SaveUnitHandle(HY, h, 17,(WLE))
	call SaveInteger(HY, h, 5,(level))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\DarkMending.mdx", WLE, "origin")))
	if IsUnitType(WLE, UNIT_TYPE_HERO)== false then
		set Q9R = 1.
	endif
	if GetWidgetLife(WLE)<= ZCE * Q9R and IsUnitAlly(WLE, GetOwningPlayer(WJE)) then
		set ZCE = GetWidgetLife(WLE)/ .75 -$A
	endif
	call UnitDamageTargetEx(WJE, WLE, 1, ZCE)
	set t = null
	set WJE = null
	set WLE = null
endfunction
function ZWV takes nothing returns nothing
	if IsUnitEnemy(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit()))== false or not UnitHasSpellShield(GetSpellTargetUnit()) then
		call Q8R()
	endif
endfunction

function FalsePromise_CallBack takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit spellUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer damagedCount =(LoadInteger(HY, h, 34))
	local integer timeCount =(LoadInteger(HY, h, 25))
	local integer level =(LoadInteger(HY, h, 5))
	local integer i = 0
	local real SXR = (LoadReal(HY, h, 697))
	local real SOR = (LoadReal(HY, h, 811))
	local real SRR = GetWidgetLife(targetUnit)
	local real SIR = GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)
	local real restoreLife = (LoadReal(HY, h, 808))
	local real SNR
	local real ZCE
	local boolean SBR = LoadBoolean(HY, h, 5)
	local integer duration = level + 6
	if SBR then
		set duration = duration - 2
	endif
	if timeCount >(duration)* 50 or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call DisableTrigger(t)
		call UnitRemoveAbility(targetUnit,'A3KN')
		call UnitRemoveAbility(targetUnit,'B3KN')
		if GetTriggerEventId()!= EVENT_WIDGET_DEATH then
			set restoreLife = restoreLife * 2
			loop
			exitwhen i > damagedCount
				set i = i + 1
				set SRR = GetWidgetLife(targetUnit)
				set SNR = RMinBJ(SIR -SRR, restoreLife)
				call SetWidgetLife(targetUnit, SRR + SNR)
				set restoreLife = restoreLife -SNR
				set ZCE =(LoadReal(HY, h,(20000+ i)))
				if(LoadUnitHandle(HY, h,(22000+ i)))== spellUnit or((LoadInteger(HY,(GetHandleId((targetUnit))),($9B5)))== 1) then
					if GetWidgetLife(targetUnit)<= ZCE + 2 then
						set ZCE = GetWidgetLife(targetUnit)-2
					endif
				endif
				call UnitDamageTargetEx((LoadUnitHandle(HY, h,(22000+ i))), targetUnit, 6, ZCE)
			endloop
			set SRR = GetWidgetLife(targetUnit)
			set SNR = RMinBJ(SIR -SRR, restoreLife)
			call SetWidgetLife(targetUnit, SRR + SNR)
			set restoreLife = restoreLife -SNR
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_UNIT_DAMAGED and IsEffectiveDamage(GetEventDamage()) then
		set damagedCount = damagedCount + 1
		call SaveInteger(HY, h, 34,(damagedCount))
		call SaveUnitHandle(HY, h,(22000+ damagedCount),(GetEventDamageSource()))
		call SaveReal(HY, h,(20000+ damagedCount),((GetEventDamage())* 1.))
	elseif GetTriggerEventId()!= EVENT_UNIT_DAMAGED and GetTriggerEventId()!= EVENT_WIDGET_DEATH then
		set timeCount = timeCount + 1
		call SaveInteger(HY, h, 25,(timeCount))
		if SIR != SOR then
			set SOR = SIR
			set SXR = SRR
			call SaveReal(HY, h, 697,((SXR)* 1.))
			call SaveReal(HY, h, 811,((SOR)* 1.))
		endif
		if SRR > SXR then
			if((LoadInteger(HY,(GetHandleId((targetUnit))),(4298)))!= 1) then
				set restoreLife = restoreLife + SRR -SXR
				call SaveReal(HY, h, 808,((restoreLife)* 1.))
			else
				call SetWidgetLife(targetUnit, SRR)
			endif
		endif
		call SetWidgetLife(targetUnit, SXR)
		call GBX(targetUnit)
	endif
	set t = null
	set targetUnit = null
	set spellUnit = null
	return false
endfunction

function SpellEffect__FalsePromise takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(spellUnit,'A2TF')
	local boolean SBR = false
	call UnitAddPermanentAbility(targetUnit,'A3KN')
	// 受伤事件 死亡事件
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function FalsePromise_CallBack))
	call SaveUnitHandle(HY, h, 2,(spellUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 34, 0)
	call SaveInteger(HY, h, 25, 0)
	call SaveInteger(HY, h, 5,(level))
	call SaveBoolean(HY, h, 5, SBR)
	call SaveReal(HY, h, 808, .0)
	call SaveReal(HY, h, 697,((GetWidgetLife(targetUnit))* 1.))
	call SaveReal(HY, h, 811,((GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE))* 1.))
	call GBX(targetUnit)
	set spellUnit = null
	set targetUnit = null
	set t = null
endfunction
function SCR takes nothing returns nothing
	call TriggerRegisterUnitEvent(CI, GetEnumUnit(), EVENT_UNIT_DAMAGED)
	call SaveInteger(HY, GetHandleId(CI), 0, LoadInteger(HY, GetHandleId(CI), 0)+ 1)
endfunction
function SDR takes unit u returns nothing
	local group g = LoginGroup(190)
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 500, TrueBoolexprCondition)
	call ForGroup(g, function SCR)
	call LogoutGroup(g)
	set g = null
endfunction
function SFR takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer c
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if GetEventDamageSource()== LoadUnitHandle(HY, h, 0) then
			call CommonUnitAddStun(GetTriggerUnit(), LoadReal(HY, h, 0), false)
			call UnitDamageTargetEx(LoadUnitHandle(HY, h, 1), GetTriggerUnit(), 1, LoadReal(HY, h, 1))
			set c = LoadInteger(HY, h, 0)
			if c == 1 then
				call FlushChildHashtable(HY, h)
				call DestroyTrigger(t)
				set CI = null
			else
				call SaveInteger(HY, h, 0, c -1)
			endif
		endif
	else
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
		set CI = null
	endif
	set t = null
endfunction

function SGR takes unit u, integer level returns nothing
	local trigger t
	local integer h
	local unit d
	local real SYV
	local real ZCE
	local real cool = 7.5 - level * 1.5
	if GetUnitAbilityLevel(u,'A36D')== 1 then
		return
	endif
	if GetUnitAbilityLevel(u, 'A39S') == 1 then
		set cool = cool * 0.75
	endif
	if GetUnitAbilityLevel(u,'A0DJ')+ GetUnitAbilityLevel(u,'QP1G') > 0 then
		call YDWESetUnitAbilityState(u,'QP1G', 1, cool)
	endif
	set d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call UnitAddAbility(d,'A42H')
	set CI = CreateTrigger()
	set h = GetHandleId(CI)
	call SDR(d)
	call TriggerRegisterTimerEvent(CI, .02, false)
	call TriggerAddCondition(CI, Condition(function SFR))
	call SaveUnitHandle(HY, h, 0, d)
	set SYV = .3 + .3 * level
	set ZCE = 50 + 25 * level
	call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)* .96)
	call SaveReal(HY, h, 0, SYV)
	call SaveReal(HY, h, 1, ZCE)
	call SaveUnitHandle(HY, h, 1, u)
	set t = null
	call IssueImmediateOrderById(d,$D009F)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl", GetUnitX(d), GetUnitY(d)))
	set d = null
endfunction

function SHR takes unit u, integer WTV returns nothing
	local integer WUV = GetUnitAbilityLevel(u,'A0DJ')+ GetUnitAbilityLevel(u,'QF85')
	if WUV > 0 then
		if OER(WTV) and(YDWEGetUnitAbilityState(u, 'QP1G', 1) == 0) then
			call SGR(u, WUV)
		endif
	endif
endfunction

function SJR takes nothing returns nothing
	call UnitDamageTargetEx(GetTriggerUnit(), GetEnumUnit(), 1, S2)
	call CommonUnitAddStun(GetEnumUnit(), Q2 * .25 + .75, false)
endfunction
function ZZV takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local location l = GetSpellTargetLoc()
	local integer i = 1
	local real WYE = GetUnitX(triggerUnit)
	local real WZE = GetUnitY(triggerUnit)
	local real W_E
	local real W0E
	local real x
	local real y
	local real a
	local group g = LoginGroup(191)
	local group g2 = LoginGroup(192)
	if targetUnit == null then
		set W_E = GetLocationX(l)
		set W0E = GetLocationY(l)
	else
		set W_E = GetUnitX(targetUnit)
		set W0E = GetUnitY(targetUnit)
	endif
	set a = bj_DEGTORAD * AngleBetweenXY(WYE, WZE, W_E, W0E)
	call RemoveLocation(l)
	loop
	exitwhen i > 22
		set x = CoordinateX50(WYE + i * 60 * Cos(a))
		set y = CoordinateY50(WZE + i * 60 * Sin(a))
		call GroupEnumUnitsInRange(g2, x, y,$FA, Condition(function DDX))
		call GroupAddGroup(g2, g)
		call GroupClear(g2)
		call BRX(CreateDestructable('B000', x, y, GetRandomReal(0, 360), .5, GetRandomInt(0, 2)), 8)
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Volcano\\VolcanoDeath.mdl", x, y))
		set i = i + 1
	endloop
	set Q2 = GetUnitAbilityLevel(triggerUnit,'A0SK')
	set S2 = Q2 * 50 + 60
	call ForGroup(g, function SJR)
	call LogoutGroup(g)
	call LogoutGroup(g2)
	set g = null
	set g2 = null
	set targetUnit = null
	set triggerUnit = null
	set l = null
endfunction

function SQR takes nothing returns nothing
	local real x = GetUnitX(GetEnumUnit())
	local real y = GetUnitY(GetEnumUnit())
	local integer id = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))
	call SetUnitX(H0V[id], x)
	call SetUnitY(H0V[id], y)
	call IssueImmediateOrderById(H0V[id],$D022E)
endfunction
function SSR takes nothing returns nothing
	local real x = GetUnitX(GetEnumUnit())
	local real y = GetUnitY(GetEnumUnit())
	local integer id = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))
	if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) or IsUnitIllusion(GetEnumUnit()) then
		call SetUnitX(H0V[id], x)
		call SetUnitY(H0V[id], y)
		call IssueImmediateOrderById(H0V[id],$D022E)
	endif
endfunction
function STR takes nothing returns boolean
	return((GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit())) and UnitIsDead(GetFilterUnit())== false))
endfunction
function SUR takes nothing returns nothing
	call UnitShareVision(GetEnumUnit(), GetOwningPlayer(UI), false)
endfunction
function SWR takes nothing returns nothing
	call UnitShareVision(GetEnumUnit(), GetOwningPlayer(UI), true)
endfunction
function SYR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group g = LoadGroupHandle(HY, h, 0)
	set UI = LoadUnitHandle(HY, h, 1)
	call ForGroup(g, function SUR)
	call LogoutGroup(g)
	call DestroyTimerAndFlushHT_HY(t)
	set g = null
	set t = null
endfunction
function SZR takes group g, unit u returns nothing
	local group gg = LoginGroup(193)
	local timer t = CreateTimer()
	call TimerStart(t, 0, false, function SYR)
	call GroupAddGroup(g, gg)
	call SaveGroupHandle(HY, GetHandleId(t), 0, gg)
	call SaveUnitHandle(HY, GetHandleId(t), 1, u)
	set gg = null
	set t = null
endfunction
function Z_V takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local real x = GetUnitX(WUE)
	local real y = GetUnitY(WUE)
	local group g = LoginGroup(194)
	local integer TME = GetPlayerId(GetOwningPlayer(WUE))
	local integer level = GetUnitAbilityLevel(WUE,'A0DH')
	call SGR(WUE, 4)
	if level == 0 then
		set level = GetUnitAbilityLevel(WUE,'A1OB')
	endif
	set H0V[TME]= CreateUnit(GetOwningPlayer(WUE),'e00E', x, y, 0)
	call UnitAddAbility(H0V[TME],'A3L6')
	call SetUnitAbilityLevel(H0V[TME],'A3L6', level)
	call IssueImmediateOrderById(H0V[TME],$D022E)
	call UnitRemoveAbility(H0V[TME],'A3L6')
	call SetUnitScale(H0V[TME], .25, .25, .25)
	call UnitAddPermanentAbility(H0V[TME],'A0DM')
	call SetUnitAbilityLevel(H0V[TME],'A0DM', level)
	set UI = WUE
	call GroupEnumUnitsInRange(g, x, y, 1200, Condition(function STR))
	call ForGroup(g, function SWR)
	call SZR(g, WUE)
	call GroupEnumUnitsInRange(g, x, y, 600, Condition(function STR))
	call ForGroup(g, function SQR)
	if GetUnitAbilityLevel(WUE,'A1OB')> 0 then
		call ForGroup(g, function SSR)
	endif
	call LogoutGroup(g)
	set WUE = null
	set g = null
endfunction
function MKX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A0DM')
	call AddAbilityIDToPreloadQueue('A0SJ')
endfunction
function S_R takes nothing returns nothing
	local unit WUE
	local unit targetUnit
	if GetTriggerEventId()== EVENT_PLAYER_UNIT_SPELL_EFFECT then
		set WUE = GetSpellTargetUnit()
		set targetUnit = GetTriggerUnit()
	else
		set WUE = GetTriggerUnit()
		set targetUnit = GetAttacker()
	endif
	if IsUnitEnemy(targetUnit, GetOwningPlayer(WUE)) and IsUnitType(targetUnit, UNIT_TYPE_STRUCTURE)== false and IsMagicImmuneUnit(targetUnit)== false then
		call AddAbilityToTimed(targetUnit,'A3EK'-1 + GetUnitAbilityLevel(WUE,'A0DW'), 1, 4.,'B38B')
	endif
	set WUE = null
	set targetUnit = null
endfunction
function S0R takes nothing returns boolean
	if GetTriggerEventId()== EVENT_PLAYER_UNIT_SPELL_EFFECT then
		return GetUnitAbilityLevel(GetSpellTargetUnit(),'A0DW')> 0 and GetUnitAbilityLevel(GetSpellTargetUnit(),'A36D')== 0
	else
		return GetUnitAbilityLevel(GetTriggerUnit(),'A0DW')> 0 and GetUnitAbilityLevel(GetTriggerUnit(),'A36D')== 0
	endif
endfunction
function MMX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function S0R))
	call TriggerAddAction(t, function S_R)
	set t = null
endfunction
function S1R takes nothing returns boolean
	return((IsUnitAlly(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit())) and GetWidgetLife(GetFilterUnit())!= GetUnitState(GetFilterUnit(), UNIT_STATE_MAX_LIFE))!= null
endfunction

function S3R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local integer S4R =(LoadInteger(HY, h, 28))
	local group g
	local unit S5R
	if S4R >$A then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SaveInteger(HY, h, 28,(S4R + 1))
		set U2 = WUE
		set g = LoginGroup(195)
		call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 300, Condition(function S1R))
		set S5R = GroupPickRandomUnit(g)
		call LogoutGroup(g)
		call SetWidgetLife(S5R, GetWidgetLife(S5R)+$A)
	endif
	set t = null
	set WUE = null
	set g = null
	set S5R = null
	return false
endfunction
function S6R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	call AddUnitAnimationProperties(WUE, "alternate", false)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	return false
endfunction
function Z0V takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local integer i = 1
	local trigger t
	local integer h
	loop
	exitwhen i >(2 + 2 * GetUnitAbilityLevel(WUE,'A01B'))
		set t = CreateTrigger()
		call SaveUnitHandle(HY,(GetHandleId(t)), 2,(WUE))
		call SaveInteger(HY,(GetHandleId(t)), 28, 0)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function S3R))
		set i = i + 1
	endloop
	if GetUnitTypeId(WUE)=='E02X' then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 0, false)
		call TriggerAddCondition(t, Condition(function S6R))
		call SaveUnitHandle(HY, h, 2,(WUE))
		set t = null
	endif
	set t = null
	set WUE = null
endfunction
function ImpetusActions takes unit u, unit t returns nothing
	local real distance = RMinBJ(GetDistanceBetween(GetUnitX(t), GetUnitY(t), GetUnitX(u), GetUnitY(u)),$9C4)
	local integer level = GetUnitAbilityLevel(u,'A0DY')+ GetUnitAbilityLevel(u,'A1WB')
	local real d =(.1 + .05 * level)* distance
	call UnitRemoveAbility(t,'B03U')
	call CommonTextTag("+" + I2S(R2I(d)), 1, t, .023, 3,$D8,$D8,$D8)
	call UnitDamageTargetEx(u, t, 7, d)
endfunction
function S8R takes unit u returns boolean
	return IsUnitType(u, UNIT_TYPE_HERO)== false and IsUnitType(u, UNIT_TYPE_ANCIENT)== false and GetUnitTypeId(u)!='n01E' and GetUnitTypeId(u)!='n019'
endfunction
function S9R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	call UnitRemoveAbility(targetUnit,'Bslo')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set targetUnit = null
	return false
endfunction
function TVR takes nothing returns nothing
	local unit targetUnit = GetSpellTargetUnit()
	local unit WUE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call K7R(targetUnit)
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerAddCondition(t, Condition(function S9R))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SetUnitOwner(targetUnit, GetOwningPlayer(WUE), true)

	if IsUnitIllusion(targetUnit)  then
		call ChangeOwnerIllusionUnit(targetUnit, WUE)
	endif

	if GetUnitAbilityLevel(WUE,'A0A8')== 0 then
		call UnitApplyTimedLife(targetUnit,'BTLF', 80)
	else
		call UnitApplyTimedLife(targetUnit,'BTLF', 180)
		call UnitAddMaxLife(targetUnit, 100 * GetUnitAbilityLevel(WUE,'A0A8'))
	endif
	call UnitAddPermanentAbility(targetUnit,'Aeth')
	call UnitAddPermanentAbility(targetUnit,'A12G')
	call I8X(targetUnit)
	set targetUnit = null
	set WUE = null
	set t = null
endfunction
function SpellEffect__Enchant takes nothing returns nothing
	if S8R(GetSpellTargetUnit()) then
		call TVR()
	endif
endfunction
function LFE takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit u = CreateUnit(GetOwningPlayer(WJE),'e00E', GetUnitX(WJE), GetUnitY(WJE), 0)
	call UnitAddAbility(u,'A415')
	if IssuePointOrderById(u,$D00FD, GetSpellTargetX(), GetSpellTargetY())== false then
		call SetUnitX(u, GetUnitX(WJE))
		call SetUnitY(u, GetUnitY(WJE))
		call EXUnitResetCooldown(u)
		if IssuePointOrderById(u,$D00FD, GetSpellTargetX(), GetSpellTargetY())== false then
			call EXStopUnit(WJE)
			call InterfaceErrorForPlayer(GetOwningPlayer(WJE), "无法在此释放午夜凋零")
		endif
	endif
	call KillUnit(u)
	set WJE = null
	set u = null
endfunction
function Z2V takes nothing returns nothing
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit WUE = GetTriggerUnit()
	local real x0 = GetUnitX(WUE)
	local real y0 = GetUnitY(WUE)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', x0, y0, 0)
	call UnitApplyTimedLife(dummyUnit,'BTLF', 8)
	call UnitAddAbility(dummyUnit,'A0B2')
	call SetUnitAbilityLevel(dummyUnit,'A0B2', GetUnitAbilityLevel(WUE,'A0B1'))
	if IssuePointOrderById(dummyUnit,$D00FD, x, y)== false then
	endif
	set WUE = null
	set dummyUnit = null
endfunction
function TER takes unit WUE, unit targetUnit, integer level returns nothing
	local real IXX =$A+$F* level
	local real TXR = .25 * level
	call CommonUnitAddStun(targetUnit, TXR, false)
	call UnitDamageTargetEx(WUE, targetUnit, 1, IXX)
endfunction
function TOR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 5))
	call TER(WUE, targetUnit, level)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function TRR takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(WUE,'A0I7')
	call TER(WUE, targetUnit, level)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call TriggerRegisterTimerEvent(t, 2, false)
	call TriggerAddCondition(t, Condition(function TOR))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call TriggerRegisterTimerEvent(t, 4, false)
	call TriggerAddCondition(t, Condition(function TOR))
	set t = null
	set WUE = null
	set targetUnit = null
endfunction
function Z3V takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call TRR()
	endif
endfunction
function Z4V takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local real x = GetUnitX(targetUnit)
	local real y = GetUnitY(targetUnit)
	local integer level = GetUnitAbilityLevel(WUE,'A180')
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', x, y, 0)
	local integer TIR = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetTriggerPlayer())],'A0A8')
	local integer id ='A17Z'
	call SetWidgetLife(targetUnit, 1)
	call UnitDamageTargetEx(WUE, targetUnit, 2, 20)
	call UnitDamageTargetEx(WUE, targetUnit, 1, 20)
	call UnitDamageTargetEx(WUE, targetUnit, 3, 20)
	if TIR == 1 then
		set id ='A3IU'
	elseif TIR < 4 then
		set id ='A3IV'
	elseif TIR == 4 then
		set id ='A3IW'
	endif
	call UnitAddPermanentAbility(dummyUnit, id)
	call SetUnitAbilityLevel(dummyUnit, id, level)
	call IssueImmediateOrderById(dummyUnit,$D02BB)
	set WUE = null
	set targetUnit = null
	set dummyUnit = null
endfunction
function KLE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer UHE = GetUnitLevel(targetUnit)
	if GetOwningPlayer(targetUnit)!= Sentinels[0]and GetOwningPlayer(targetUnit)!= Scourges[0]and LoadInteger(M, GetUnitTypeId(targetUnit), HC)> 88 then
		call EXStopUnit(triggerUnit)
		call InterfaceErrorForPlayer(GetOwningPlayer(triggerUnit), GetObjectName('n0CX'))
	endif
	set triggerUnit = null
	set targetUnit = null
endfunction
function TAR takes real x returns real
	local real TNR = GetRectMinX(bj_mapInitialPlayableArea)+$96
	if(x < TNR) then
		return TNR
	endif
	set TNR = GetRectMaxX(bj_mapInitialPlayableArea)-$96
	if(x > TNR) then
		return TNR
	endif
	return x
endfunction
function TBR takes real y returns real
	local real TNR = GetRectMinY(bj_mapInitialPlayableArea)+$96
	if(y < TNR) then
		return TNR
	endif
	set TNR = GetRectMaxY(bj_mapInitialPlayableArea)-$96
	if(y > TNR) then
		return TNR
	endif
	return y
endfunction
function TCR takes nothing returns boolean
	return((GXX(GetFilterUnit()) and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false and(IsUnitType(GetFilterUnit(), UNIT_TYPE_ANCIENT)== false or IsPrimalTypeId(GetUnitTypeId(GetFilterUnit())) or IsBearUnit(GetFilterUnit()) or GetUnitTypeId(GetFilterUnit())=='n00U' or GetUnitTypeId(GetFilterUnit())=='n00Y' or GetUnitTypeId(GetFilterUnit())=='n00Z' or GetUnitTypeId(GetFilterUnit())=='n0KU' or GetUnitTypeId(GetFilterUnit())=='n0KV' or GetUnitTypeId(GetFilterUnit())=='n0KW' or IsFamiliarsTypeId(GetUnitTypeId(GetFilterUnit()))) and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer((LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 318))))))
endfunction
function TED takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 1)
	if((GetUnitAbilityLevel(u, 'B08V') == 0)) then
		call UnitRemoveAbility(u,'B463')
	endif
	set u = null
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction

function BlackHoleActions takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local group g
	local integer h = GetHandleId(trig)
	local group targetGroup = LoadGroupHandle(HY, h, 300)
	local unit bh = LoadUnitHandle(HY, h, 318)
	local unit dummyUnit
	local unit firstUnit = null
	local real centreX
	local real centreY
	local real enumUnitX
	local real enumUnitY
	local real dX
	local real dY
	local real angle
	local real radian
	local real distance
	local player tempPlayer
	if GetTriggerEventId()== EVENT_UNIT_SPELL_ENDCAST and(GetSpellAbilityId()=='A1BX' or GetSpellAbilityId()=='A30L') then
		call KillUnit(bh)
		set dummyUnit = LoadUnitHandle(HY, h, 19)
		call UnitApplyTimedLife(LoadUnitHandle(HY, h,$FA),'BTLF', 1)
		call UnitApplyTimedLife(LoadUnitHandle(HY, h,$FB),'BTLF', 1)
		call UnitApplyTimedLife(LoadUnitHandle(HY, h,$FC),'BTLF', 1)
		call UnitApplyTimedLife(LoadUnitHandle(HY, h,$FD),'BTLF', 1)
		loop
			set firstUnit = FirstOfGroup(targetGroup)
			exitwhen firstUnit == null
			call GroupRemoveUnit(targetGroup, firstUnit)
			call YDWEUnitRemoveStun(firstUnit)
		endloop
		call LogoutGroup(targetGroup)
		
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(trig)
		call KillUnit(dummyUnit)
	elseif GetTriggerEvalCount(trig)> 90 then // 90
		loop
			set firstUnit = FirstOfGroup(targetGroup)
			exitwhen firstUnit == null
			call GroupRemoveUnit(targetGroup, firstUnit)
			call YDWEUnitRemoveStun(firstUnit)
		endloop
		call LogoutGroup(targetGroup)
		set dummyUnit = LoadUnitHandle(HY, h, 19)
		call UnitApplyTimedLife(LoadUnitHandle(HY, h,$FA),'BTLF', 1)
		call UnitApplyTimedLife(LoadUnitHandle(HY, h,$FB),'BTLF', 1)
		call UnitApplyTimedLife(LoadUnitHandle(HY, h,$FC),'BTLF', 1)
		call UnitApplyTimedLife(LoadUnitHandle(HY, h,$FD),'BTLF', 1)

		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(trig)
		
		call KillUnit(bh)
		call KillUnit(dummyUnit)
		call EXStopUnit(LoadUnitHandle(HY, h, 2))
	else
		set centreX = GetUnitX(bh)
		set centreY = GetUnitY(bh)
		set Q6V = LoadUnitHandle(HY, h, 2)

		// 神杖效果
		set KN = GetUnitAbilityLevel(Q6V,'A30L')> 0 and (GetTriggerEvalCount(trig)== 20 or GetTriggerEvalCount(trig)== 40 or GetTriggerEvalCount(trig)== 60 or GetTriggerEvalCount(trig)== 80)
		
		set g = LoginGroup(196)
		set tempPlayer = GetOwningPlayer(bh)
		call GroupEnumUnitsInRange(g, centreX, centreY, 445, null)
		loop
			set firstUnit = FirstOfGroup(g)
			exitwhen firstUnit == null
			call GroupRemoveUnit(g, firstUnit)

			// 存活 非建筑费守卫 非远古 但可以是英雄级单位
			if IsUnitCanMove(firstUnit) and IsAliveNotStrucNotWard(firstUnit) and IsUnitEnemy(firstUnit, tempPlayer) and ( not IsUnitType(firstUnit, UNIT_TYPE_ANCIENT) or IsHeroLevelNormalUnit(firstUnit) ) then
				if not IsUnitInGroup(firstUnit, targetGroup) then
					call GroupAddUnit(targetGroup, firstUnit)
					call YDWEUnitAddStun(firstUnit)
				endif
				set enumUnitX = GetUnitX(firstUnit)
				set enumUnitY = GetUnitY(firstUnit)
				set radian = RadianBetweenXY(centreX, centreY, enumUnitX, enumUnitY)
				set dX = GetUnitX(firstUnit) - 1.5 * Cos(radian) - centreX
				set dY = GetUnitY(firstUnit) - 1.5 * Sin(radian) - centreY
				set distance = SquareRoot(dX * dX + dY * dY)
				set radian = Atan2(dY, dX) + 1.125 /( RMaxBJ(distance, 100.) / 100. ) * bj_DEGTORAD
				
				set enumUnitX = centreX + RMaxBJ(distance, 100.)* Cos(radian)
				set enumUnitY = centreY + RMaxBJ(distance, 100.)* Sin(radian)
				call SetUnitX(firstUnit, enumUnitX)
				call SetUnitY(firstUnit, enumUnitY)
				
				call KillDestructablesInCircle(enumUnitX, enumUnitY, 200)

				if KN then
					set KN = false
					call UnitDamageTargetEx(Q6V, firstUnit, 7, GetUnitState(firstUnit, UNIT_STATE_MAX_LIFE)/ 100 *(7))
					call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayTarget.mdl", firstUnit, "origin"))
				endif
			elseif IsUnitInGroup(firstUnit, targetGroup) then
				call GroupRemoveUnit(targetGroup, firstUnit)
				call YDWEUnitRemoveStun(firstUnit)
			endif

		endloop
		set tempPlayer = null
		set firstUnit = null
		call LogoutGroup(g)
	endif
	set dummyUnit = null
	set bh = null
	set trig = null
	set g = null
	return false
endfunction

// 黑洞
function SpellEffect__BlackHole takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local trigger trig = CreateTrigger()
	local integer h = GetHandleId(trig)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(spellUnit),'e00E', x, y, 0)
	local unit bh = CreateUnit(GetOwningPlayer(spellUnit),'u004', x, y, 0)
	call SetUnitAbilityLevel(bh,'A0C0', GetUnitAbilityLevel(spellUnit,'A1BX')+ GetUnitAbilityLevel(spellUnit,'A30L'))
	
	// 乌云技能bug
	if IsScourgesPlayer(GetOwningPlayer(spellUnit)) then
		call UnitAddPermanentAbility(dummyUnit,'A0X4')
	else
		call UnitAddPermanentAbility(dummyUnit,'A0X3')
	endif
	call IssuePointOrderById(dummyUnit,$D01F9, x, y)

	call SaveUnitHandle(HY, h, 19, dummyUnit)
	call SaveUnitHandle(HY, h,$FA, CreateUnit(GetOwningPlayer(spellUnit),'h06R', x, y, 0))
	call SaveUnitHandle(HY, h,$FB, CreateUnit(GetOwningPlayer(spellUnit),'h06R', x, y, 0))
	call SaveUnitHandle(HY, h,$FC, CreateUnit(GetOwningPlayer(spellUnit),'h06R', x, y, 0))
	call SaveUnitHandle(HY, h,$FD, CreateUnit(GetOwningPlayer(spellUnit),'h06R', x, y, 0))
	call SaveUnitHandle(HY, h, 318, bh)
	call SaveUnitHandle(HY, h, 2, spellUnit)
	call SaveGroupHandle(HY, h, 300, LoginGroup(46843))

	call EnableEffectByTime(EFFECT_KEY_BLACKHOLE, 4)
	
	call TriggerRegisterUnitEvent(trig, spellUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterTimerEvent(trig, .05, true)
	call TriggerAddCondition(trig, Condition(function BlackHoleActions))

	
	set spellUnit = null
	set bh = null
	set trig = null
	set dummyUnit = null
endfunction
function KME takes nothing returns nothing
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	if(x != TAR(x) and y != TBR(y)) or RectContainsCoords(IA, x, y) or RectContainsCoords(OA, x, y) or RectContainsCoords(BA, x, y) or RectContainsCoords(CA, x, y) or RectContainsCoords(DA, x, y) or RectContainsCoords(EA, x, y) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "不能在这里释放黑洞")
	endif
endfunction
function MPX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A0C0')
endfunction
function TLR takes nothing returns nothing
	call UnitDamageTargetEx(GetTriggerUnit(), GetEnumUnit(), 1, S2)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\StaffOfPurification\\PurificationTarget.mdx", GetEnumUnit(), "chest"))
endfunction
function Z7V takes nothing returns nothing
	local group g = LoginGroup(197)
	local unit triggerUnit = GetTriggerUnit()
	local real x = GetUnitX(triggerUnit)
	local real y = GetUnitY(triggerUnit)
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0SC')
	local unit dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'e00E', x, y, 0)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\StaffOfPurification\\PurificationCaster.mdx", x, y))
	call UnitAddPermanentAbility(dummyUnit,'A0SD')
	call SetUnitAbilityLevel(dummyUnit,'A0SD', level)
	call IssuePointOrderById(dummyUnit,$D0270, x, y)
	set S2 = level * 60 + 40
	call GroupEnumUnitsInRange(g, x, y, 425, Condition(function DFX))
	call ForGroup(g, function TLR)
	call LogoutGroup(g)
	set dummyUnit = null
	set g = null
	set triggerUnit = null
endfunction
function TMR takes unit u, integer level returns nothing
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call UnitAddAbility(d,'A42T')
	call SetUnitAbilityLevel(d,'A42T', level)
	call IssueTargetOrderById(d, 852095, u)
	set d = null
endfunction
function TPR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local integer level
	local unit targetUnit
	local real x1
	local real y1
	local real d
	local real a
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set targetUnit =(LoadUnitHandle(HY, h, 17))
		set d =(LoadReal(HY, h, 138))
		set x =(LoadReal(HY, h, 6))
		set y =(LoadReal(HY, h, 7))
		set a =(LoadReal(HY, h, 137))
		set x1 = GetUnitX(targetUnit)+ d / $F* Cos(a)
		set y1 = GetUnitY(targetUnit)+ d / $F* Sin(a)
		call SaveBoolean(K, GetHandleId(targetUnit), 99, true)
		call SetUnitPosition(targetUnit, x1, y1)
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl", x1, y1))
		if GetTriggerEvalCount(t)>$F then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
		set targetUnit = null
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function TQR takes unit targetUnit, unit TSR returns nothing
	local trigger t
	local integer h
	if RFX(targetUnit) then
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function TPR))
	call SaveReal(HY, h, 6, GetUnitX(TSR))
	call SaveReal(HY, h, 7, GetUnitY(TSR))
	call SaveReal(HY, h, 138, GetDistanceBetween(GetUnitX(TSR), GetUnitY(TSR), GetUnitX(targetUnit), GetUnitY(targetUnit)))
	call SaveReal(HY, h, 137, Atan2(GetUnitY(TSR)-GetUnitY(targetUnit), GetUnitX(TSR)-GetUnitX(targetUnit)))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	set t = null
endfunction
function TTR takes unit WUE, unit targetUnit, integer level, integer A_R returns nothing
	if A_R == 1 then
		call UnitDamageTargetEx(WUE, targetUnit, 1, level * 50 + 50)
		call CommonUnitAddStun(targetUnit, .75 + .75 * level, false)
	else
		call UnitDamageTargetEx(WUE, targetUnit, 1, level * 50 +$96)
		call TMR(targetUnit, level)
	endif
endfunction
function TUR takes unit WUE, unit targetUnit returns nothing
	local unit dummyUnit = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddPermanentAbility(dummyUnit,'A0SF')
	call IssueTargetOrderById(dummyUnit, 852095, targetUnit)
	set dummyUnit = null
endfunction
function TWR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer level =(LoadInteger(HY, h, 5))
	local integer A_R =(LoadInteger(HY, h,$98))
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local lightning APX =(LoadLightningHandle(HY, h,$C4))
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		if A_R == 2 and GetTriggerUnit()== WUE then
			call TQR(targetUnit, WUE)
		endif
		call DestroyLightning(APX)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call MoveLightning(APX, true, GetUnitX(WUE), GetUnitY(WUE), GetUnitX(targetUnit), GetUnitY(targetUnit))
		if GetDistanceBetween(GetUnitX(WUE), GetUnitY(WUE), GetUnitX(targetUnit), GetUnitY(targetUnit))> 600 then
			call DestroyLightning(APX)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call TTR(WUE, targetUnit, level, A_R)
			if A_R == 2 then
				call TQR(targetUnit, WUE)
			endif
		endif
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set APX = null
	return false
endfunction
function TYR takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local lightning APX = AddLightning("HWPB", true, GetUnitX(H4V), GetUnitY(H4V), GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()))
	call SetLightningColor(APX, 0, .7, 1, 1)
	call SaveLightningHandle(HY, h,$C4,(APX))
	call SaveUnitHandle(HY, h, 2,(H4V))
	call SaveUnitHandle(HY, h, 30,((GetEnumUnit())))
	call SaveInteger(HY, h, 5,(H1V))
	call SaveInteger(HY, h,$98,(H2V))
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerRegisterDeathEvent(t, GetEnumUnit())
	call TriggerRegisterDeathEvent(t, H4V)
	call TriggerAddCondition(t, Condition(function TWR))
	call UnitDamageTargetEx(GetTriggerUnit(), GetEnumUnit(), 1, H3V)
	call TUR(GetTriggerUnit(), GetEnumUnit())
	set t = null
	set APX = null
endfunction
function TZR takes nothing returns boolean
	return(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()) and(IsUnitIllusion(GetFilterUnit()) or IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO)))!= null
endfunction
function Z8V takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'e00U', x, y, 0)
	local group g = LoginGroup(198)
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0S8')
	local real N5O = 6
	local integer A_R = 1
	if level == 0 then
		set level = GetUnitAbilityLevel(triggerUnit,'A1QP')
		set N5O = 8
		set A_R = 2
	endif
	call SetUnitAnimation(dummyUnit, "channel")
	call BUX(dummyUnit, N5O)
	set H4V = dummyUnit
	set H3V = level * 50 + 50
	set H1V = level
	set H2V = A_R
	set U2 = triggerUnit
	call GroupEnumUnitsInRange(g, x, y, 400, Condition(function TZR))
	call ForGroup(g, function TYR)
	call LogoutGroup(g)
	set g = null
	set dummyUnit = null
	set triggerUnit = null
endfunction
function T_R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local integer level
	local integer S4R
	local integer d
	if(GetTriggerEventId()== EVENT_UNIT_ISSUED_ORDER and GetIssuedOrderId()!=$D0222) or GetTriggerEventId()== EVENT_UNIT_ISSUED_POINT_ORDER or GetTriggerEventId()== EVENT_UNIT_ISSUED_TARGET_ORDER or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call SetUnitInvulnerableEx(triggerUnit, false)
		call UnitRemoveAbility(triggerUnit,'A04R')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set level =(LoadInteger(HY, h, 5))
		set d = 3 * level
		if level == 4 then
			set d = d + 1
		endif
		set S4R =(LoadInteger(HY, h, 28))+ 1
		call SaveInteger(HY, h, 28,(S4R))
		if S4R > d or GetDistanceBetween(GetUnitX(triggerUnit), GetUnitY(triggerUnit),(LoadReal(HY, h, 6)),(LoadReal(HY, h, 7)))> 125 then
			call SetUnitInvulnerableEx(triggerUnit, false)
			call UnitRemoveAbility(triggerUnit,'A04R')
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set triggerUnit = null
	return false
endfunction
function T0R takes nothing returns nothing
	local timer t = GetExpiredTimer()
	call UnitAddAbility(LoadUnitHandle(P, GetHandleId(t), 0),'A04R')
	call DestroyTimerAndFlushHT_P(t)
	set t = null
endfunction
function T1R takes nothing returns nothing
	local timer WIE = CreateTimer()
	local unit triggerUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(P, GetHandleId(WIE), 0, triggerUnit)
	call TimerStart(WIE, 0, false, function T0R)
	call SetUnitInvulnerableEx(triggerUnit, true)
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call SaveInteger(HY, h, 5,(GetUnitAbilityLevel(triggerUnit,'A0SB')))
	call SaveInteger(HY, h, 28, 0)
	call SaveReal(HY, h, 6,((GetUnitX(triggerUnit))* 1.))
	call SaveReal(HY, h, 7,((GetUnitY(triggerUnit))* 1.))
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_ISSUED_ORDER)
	call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterDeathEvent(t, triggerUnit)
	call TriggerAddCondition(t, Condition(function T_R))
	call EPX(triggerUnit, 4266, 5.9)
	set t = null
	set triggerUnit = null
	set WIE = null
endfunction
function T2R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	call IssueImmediateOrderById(triggerUnit,$D0224)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set triggerUnit = null
	return false
endfunction
function T3R takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function T2R))
	set t = null
	set triggerUnit = null
endfunction
function T4R takes nothing returns boolean
	if GetIssuedOrderId()==$D0222 and IsUnitIllusion(GetTriggerUnit())== false and((LoadInteger(HY, GetHandleId(GetTriggerUnit()), 4266))!= 1) then
		call T1R()
	elseif GetIssuedOrderId()==$D0223 then
		call T3R()
	endif
	return false
endfunction
function PKX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call A1X(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call TriggerAddCondition(t, Condition(function T4R))
	set t = null
endfunction
function T5R takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), DK)== false then
		call GroupAddUnit(DK, GetEnumUnit())
		call UnitDamageTargetEx(U2, GetEnumUnit(), 1, S2)
	endif
endfunction
function T6R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local group g =(LoadGroupHandle(HY, h, 22))
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local integer level =(LoadInteger(HY, h, 5))
	local real a =(LoadReal(HY, h, 13))
	local unit WUE =(LoadUnitHandle(HY, h, 14))
	local group T7R
	local real x
	local real y
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		if GetUnitTypeId(WUE)=='e00E' then
			set WUE = Player__Hero[GetPlayerId(GetOwningPlayer(WUE))]
		endif
		set U2 = CreateUnit(GetOwningPlayer(dummyUnit),'h06O', GetUnitX(WUE), GetUnitY(WUE), 0)
		call SetUnitScale(U2, 2.5, 2.5, 2.5)
		call KillUnit(U2)
		call SetUnitPosition(WUE, GetUnitX(dummyUnit), GetUnitY(dummyUnit))
		call ShowUnit(WUE, false)
		call ShowUnit(WUE, true)
		call SelectUnitAddForPlayer(WUE, GetOwningPlayer(WUE))
		set H5V[GetPlayerId(GetOwningPlayer(dummyUnit))]= null
		call LogoutGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEvalCount(t)> 120 then
		set H5V[GetPlayerId(GetOwningPlayer(dummyUnit))]= null
		call LogoutGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SetUnitScale(dummyUnit, 2.5, 2.5, 2.5)
		call KillUnit(dummyUnit)
	else
		set x = GetUnitX(dummyUnit)
		set y = GetUnitY(dummyUnit)
		set T7R = LoginGroup(199)
		set DK = g
		set U2 = dummyUnit
		set S2 = level * 70
		call GroupEnumUnitsInRange(T7R, x, y, 9999, Condition(function DUX))
		call BJDebugMsg("伤害"+R2S(S2)+"范围"+"9999")
		call ForGroup(T7R, function T5R)
		call LogoutGroup(T7R)
		call SetUnitX(dummyUnit, CoordinateX50(x + 16.25 * Cos(a * bj_DEGTORAD)))
		call SetUnitY(dummyUnit, CoordinateY50(y + 16.25 * Sin(a * bj_DEGTORAD)))
	endif
	set t = null
	set g = null
	set T7R = null
	set dummyUnit = null
	set WUE = null
	return false
endfunction
function Z9V takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local group g = LoginGroup(200)
	local unit triggerUnit = GetTriggerUnit()
	local real x1 = GetUnitX(triggerUnit)
	local real y1 = GetUnitY(triggerUnit)
	local real x2 = GetSpellTargetX()
	local real y2 = GetSpellTargetY()
	local real a = AngleBetweenXY(x1, y1, x2, y2)
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0S9')
	local unit dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'h06O', x1, y1, a)
	call PlaySoundAtPoint(KC, x1, y1)
	call UnitAddPermanentAbility(GetTriggerUnit(),'A0SA')
	set H5V[GetPlayerId(GetOwningPlayer(triggerUnit))]= dummyUnit
	call SetUnitScale(dummyUnit, 3.5, 3.5, 3.5)
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveGroupHandle(HY, h, 22,(g))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerRegisterDeathEvent(t, dummyUnit)
	call TriggerAddCondition(t, Condition(function T6R))
	set t = null
	set dummyUnit = null
	set g = null
	set triggerUnit = null
endfunction
function VVE takes nothing returns nothing
	local integer i = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))
	if H5V[i]== null then
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n037'))
	else
		call SetUnitScale(H5V[i], 2.5, 2.5, 2.5)
		call KillUnit(H5V[i])
	endif
endfunction
function T8R takes nothing returns nothing
	call SetUnitX(GetEnumUnit(), H6V)
	call SetUnitY(GetEnumUnit(), H7V)
endfunction
function VEE takes nothing returns nothing
	local destructable array dx
	local integer O3X
	local integer K0X
	local fogmodifier T9R
	local unit dummyUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local location UVR
	local real x
	local real y
	local group g = LoginGroup(201)
	if targetUnit == null then
		set UVR = GetSpellTargetLoc()
	else
		set UVR = GetUnitLoc(targetUnit)
	endif
	set x = GetLocationX(UVR)
	set y = GetLocationY(UVR)
	set H6V = x
	set H7V = y
	if IsUnitAlly(dummyUnit, GetOwningPlayer(targetUnit)) or not UnitHasSpellShield(GetSpellTargetUnit()) then
		set U2 = dummyUnit
		call GroupEnumUnitsInRange(g, x, y, 150, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call BEX(CreateFogModifierRadiusLocBJ(true, GetOwningPlayer(dummyUnit), FOG_OF_WAR_VISIBLE, UVR, 1000.), 2 + GetUnitAbilityLevel(dummyUnit,'A21E'))
		set O3X = 1
		set K0X = 8
		loop
		exitwhen O3X > K0X
			call BRX(CreateDestructableLoc('B005', VIX(UVR, 150.,(I2R(O3X)* 45.)), GetRandomReal(0, 360), 1, 0), 2 + GetUnitAbilityLevel(dummyUnit,'A21E'))
			set O3X = O3X + 1
		endloop
	endif
	call RemoveLocation(UVR)
	call ForGroup(g, function T8R)
	call LogoutGroup(g)
	set T9R = null
	set dummyUnit = null
	set targetUnit = null
	set UVR = null
	set g = null
endfunction
function KPE takes nothing returns nothing
	if IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) and(LoadBoolean(HY,(GetHandleId(GetOwningPlayer(GetSpellTargetUnit()))),$8B)) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n038'))
	endif
endfunction
function UER takes unit WUE, real x, real y returns nothing
	local unit u = CreateUnit(GetOwningPlayer(WUE),'efon', x, y, 0)
	call UnitApplyTimedLife(u,'BEfn', 60)
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\NightElf\\EntBirthTarget\\EntBirthTarget.mdl", u, "origin"))
	call SetUnitFlyHeight(u, 0, 0)
	set u = null
endfunction
function TreantEnterMapActions takes unit u returns nothing
	local integer i = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A0A8')
	if i > 0 then
		call UnitAddPermanentAbilitySetLevel(u,'A3IN', i)
		call UnitAddPermanentAbility(u,'AId1'-1 + i)
	endif
endfunction
function UOR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local destructable d = LoadDestructableHandle(HY, GetHandleId(t), 0)
	call RemoveSavedBoolean(P, GetHandleId(d),'0FON')
	call PauseTimer(t)
	call DestroyTimer(t)
	set d = null
	set t = null
endfunction
function URR takes destructable d returns nothing
	local timer t = CreateTimer()
	call SaveBoolean(P, GetHandleId(d),'0FON', true)
	call SaveDestructableHandle(HY, GetHandleId(t), 0, d)
	call TimerStart(t, 5, false, function UOR)
	set t = null
endfunction
function UIR takes nothing returns nothing
	if(IsTreeDestructable(GetEnumDestructable()) or GetDestructableTypeId(GetEnumDestructable())=='B005') and H8V <= H9V and(GetDestructableLife(GetEnumDestructable())> 0 or(DN and LoadBoolean(P, GetHandleId(GetEnumDestructable()),'0FON'))) then
		set H8V = H8V + 1
		call UER(GetTriggerUnit(), BN, CN)
		if not DN then
			call URR(GetEnumDestructable())
			call KillDestructable(GetEnumDestructable())
		endif
	elseif H8V > H9V then
		call KillDestructable(GetEnumDestructable())
	endif
endfunction
function OTE takes nothing returns nothing
	local integer lv = GetUnitAbilityLevel(GetTriggerUnit(),'A333')
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real d = 75 + 75 * lv + 25
	local rect r = Rect(x -d, y -d, x + d, y + d)
	set BN = x
	set CN = y
	set DN = GetUnitTypeId(GetTriggerUnit())=='e00E'
	set H8V = 0
	set H9V = lv
	call EnumDestructablesInRect(r, TrueBoolexprCondition, function UIR)
	call RemoveRect(r)
	set DN = false
	set r = null
endfunction
function S_E takes nothing returns nothing
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(GetTriggerUnit())) then
		call PingMinimapEx(x, y, 3, 255, 255, 255, false)
	endif
	call DestroyEffect(AddSpecialEffect("war3mapImported\\FurionTeleportTarget.mdx", x, y))
	call DestroyEffect(AddSpecialEffect("war3mapImported\\FurionTeleportTarget.mdx", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
endfunction
function UAR takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local real d = GetDistanceBetween(GetUnitX(targetUnit), GetUnitY(targetUnit), JXV, JOV)
	if d < JEV and UnitVisibleToPlayer(targetUnit, GetOwningPlayer(JRV)) then
		set JVV = GetEnumUnit()
		set JEV = d
	endif
	set targetUnit = null
endfunction
function VRE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(GetTriggerUnit(),'A1W8')
	local integer N0X ='A07X'
	local group g
	local unit dummyUnit
	call TGV($D)
	if level == 0 then
		set level = GetUnitAbilityLevel(GetTriggerUnit(),'A1W9')
		set N0X ='A0AL'
	endif
	if targetUnit == null then
		set JVV = null
		set JRV = WUE
		set JEV =$F423F
		set JXV = GetSpellTargetX()
		set JOV = GetSpellTargetY()
		set U2 = WUE
		set g = LoginGroup(202)
		call GroupEnumUnitsInRange(g, 0, 0, 9999, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call ForGroup(g, function UAR)
		call LogoutGroup(g)
		set targetUnit = JVV
		set g = null
	endif
	if targetUnit != null then
		set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(WUE), GetUnitY(WUE), 0)
		call UnitAddPermanentAbility(dummyUnit, N0X)
		call SetUnitAbilityLevel(dummyUnit, N0X, level)
		call IssueTargetOrderById(dummyUnit,$D0097, targetUnit)
		set dummyUnit = null
	endif
	set WUE = null
	set targetUnit = null
endfunction
function UNR takes nothing returns nothing
	if LoadInteger(HY, GetHandleId(SV),'A3JO')> 0 then
		if IsUnitType(SV, UNIT_TYPE_HERO) then
			call UnitApplyTimedLife(CreateUnit(Player(LoadInteger(HY, GetHandleId(SV),'A3JO')),'efo2', GetUnitX(SV), GetUnitY(SV), 0),'BEfn', 60)
		else
			call UnitApplyTimedLife(CreateUnit(Player(LoadInteger(HY, GetHandleId(SV),'A3JO')),'efon', GetUnitX(SV), GetUnitY(SV), 0),'BEfn', 60)
		endif
		call DestroyEffect(AddSpecialEffect("war3mapImported\\NatureExplosion.mdx", GetUnitX(SV), GetUnitY(SV)))
	endif
endfunction
// 自然之怒
function WrathOfNatureDE takes nothing returns nothing
	if GetUnitAbilityLevel(DETargetUnit[DEI],'A0AL')> 0 then
		call AddAbilityToTimed(DETargetUnit[DEI],'A3JO', 1, 4,'B3JO')
		call EUX(DETargetUnit[DEI],'A3JO', GetPlayerId(GetOwningPlayer(DESourceUnit[DEI])), 4.01)
	endif
endfunction
function UCR takes unit WUE, unit targetUnit, integer level, boolean UDR returns nothing
	local real UFR
	local real UGR = .35
	call CNX(targetUnit,'A334', level, 3 + level,'B083')
	if UDR then
		set UGR = .65
	endif
	set UFR = .35
	call UnitDamageTargetEx(WUE, WUE, 1, GetWidgetLife(WUE)* UFR)
	call UnitDamageTargetEx(WUE, targetUnit, 1, GetWidgetLife(targetUnit)* UGR)
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", WUE, "chest"))
	call DestroyEffect(AddSpecialEffectTarget("effects\\LifeBreak.mdx", targetUnit, "chest"))
endfunction
function UHR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local real GXR = LoadReal(HY, h, 23)
	local real GOR = LoadReal(HY, h, 24)
	local real x
	local real y
	local real WYE = GetUnitX(WUE)
	local real WZE = GetUnitY(WUE)
	local real W_E = GetUnitX(targetUnit)
	local real W0E = GetUnitY(targetUnit)
	local real a = Atan2(W0E -WZE, W_E -WYE)
	local integer level = LoadInteger(HY, h, 0)
	local boolean UDR = LoadInteger(HY, h, 1)=='A1B3'
	call SetUnitAnimationByIndex(WUE, LoadInteger(P, GetUnitTypeId(WUE),'A1P8'))
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or GetDistanceBetween(GXR, GOR, W_E, W0E)>$578 or C5X(WUE) then
		call SetUnitPathing(WUE, true)
		call DestroyEffect(LoadEffectHandle(HY, h, 175))
		call DestroyEffect(LoadEffectHandle(HY, h, 176))
		call UnitRemoveAbility(WUE,'A0ST')
		call SetUnitTimeScale(WUE, 1.)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetDistanceBetween(WYE, WZE, W_E, W0E)< 125 then
		call SetUnitPathing(WUE, true)
		call DestroyEffect(LoadEffectHandle(HY, h, 175))
		call DestroyEffect(LoadEffectHandle(HY, h, 176))
		call UnitRemoveAbility(WUE,'A0ST')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SetUnitTimeScale(WUE, 1.)
		if targetUnit != null and UnitIsDead(targetUnit)== false then
			call IssueTargetOrderById(WUE, 851983, targetUnit)
			call UCR(WUE, targetUnit, level, UDR)
		endif
	else
		call SetUnitPathing(WUE, false)
		set GXR = W_E
		set GOR = W0E
		call SaveReal(HY, h, 23, GXR * 1.)
		call SaveReal(HY, h, 24, GOR * 1.)
		set x = WYE +$F* Cos(a)
		set y = WZE +$F* Sin(a)
		if IsUnitType(WUE, UNIT_TYPE_HERO) then
			call SaveBoolean(K, GetHandleId(WUE), 99, true)
		endif
		call SetUnitPosition(WUE, x, y)
		call SetUnitFacing(WUE, a * bj_RADTODEG)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function UJR takes unit WUE, unit targetUnit, integer id, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .015, true)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerAddCondition(t, Condition(function UHR))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveInteger(HY, h, 0, level)
	call SaveInteger(HY, h, 1, id)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveReal(HY, h, 23, GetUnitX(targetUnit)* 1.)
	call SaveReal(HY, h, 24, GetUnitY(targetUnit)* 1.)
	call SaveEffectHandle(HY, h, 175, AddSpecialEffectTarget("war3mapImported\\LifeBreakCharge.mdx", WUE, "hand right alternate"))
	call SaveEffectHandle(HY, h, 176, AddSpecialEffectTarget("war3mapImported\\LifeBreakCharge.mdx", WUE, "hand left alternate"))
	call SetUnitPathing(WUE, false)
	call UnitAddPermanentAbility(WUE,'A0ST')
	call S9E(GetOwningPlayer(WUE),'A0ST', false)
	call SetUnitAnimationByIndex(WUE, LoadInteger(P, GetUnitTypeId(WUE),'A1P8'))
	call RemoveUnitBuff(WUE, false)
	call SkillImmunityDispel(WUE)
	call SetUnitTimeScale(WUE, 3.)
	set t = null
endfunction
function UKR takes nothing returns nothing
	//	local string IDO = StringCase("124", false)
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	local integer id = LoadInteger(HY, h, 0)
	local integer level = LoadInteger(HY, h, 1)
	if GetUnitAbilityLevel(WJE,'Aloc')== 1 and HaveSavedHandle(HY, GetHandleId(WJE), 0) then
		set WJE = LoadUnitHandle(HY, GetHandleId(WJE), 0)
	endif
	call UJR(WJE, WLE, id, level)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set WJE = null
	set WLE = null
endfunction
function VIE takes nothing returns nothing
	local timer t
	local integer h
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		call SaveInteger(HY, h, 0, GetSpellAbilityId())
		call SaveInteger(HY, h, 1, GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
		call TimerStart(t, 0, false, function UKR)
		set t = null
	endif
endfunction
function ULR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer level =(LoadInteger(HY, h, 5))
	local unit WLE =(LoadUnitHandle(HY, h, 17))
	local integer DRO = GerHeroMainAttributesValue(WLE)
	local real L2O = GetWidgetLife(WLE)
	local real IQX = GetUnitState(WLE, UNIT_STATE_MAX_LIFE)
	local real YVX
	local integer c = LoadInteger(HY, h, 0)+ 1
	if L2O / IQX > .4 then
		set YVX =(level * 1.)/ 4 * .2 * DRO + 2 * level
	else
		set YVX =(level * 1. / 4 + .25)* .6 * DRO + 2 * level
	endif
	set YVX = YVX / 8.
	if c > 16 * 8. or GetUnitAbilityLevel(WLE,'A0QO')== 0 or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call RemoveSavedHandle(HY, GetHandleId(WLE),'A0QP')
		call UnitRemoveAbility(WLE,'A0QO')
		call UnitRemoveAbility(WLE,'B080')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SetWidgetLife(WLE, L2O + YVX)
		call SaveInteger(HY, h, 0, c)
	endif
	set WLE = null
	set t = null
	return false
endfunction
function VAE takes nothing returns nothing
	local unit targetUnit = GetSpellTargetUnit()
	local unit WUE = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(WUE,'A0QP')
	local trigger t
	local integer h
	if HaveSavedHandle(HY, GetHandleId(targetUnit),'A0QP') then
		set t = LoadTriggerHandle(HY, GetHandleId(targetUnit),'A0QP')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, GetHandleId(targetUnit),'A0QP', t)
		call TriggerRegisterTimerEvent(t, 1 / 8., true)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function ULR))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
	endif
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY, h, 0, 0)
	call UnitAddPermanentAbility(targetUnit,'A0QO')
	call SetUnitAbilityLevel(targetUnit,'A0QO', level)
	set targetUnit = null
	set WUE = null
	set t = null
endfunction
function UMR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	if GetTriggerEvalCount(t)> 8 or UnitIsDead(targetUnit) then
		call DestroyEffect(LoadEffectHandle(HY, h, 31))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call UnitDamageTargetEx(WUE, targetUnit, 1, 5 * GetUnitAbilityLevel(WUE,'A0QN'))
	endif
	set t = null
	set targetUnit = null
	set WUE = null
	return false
endfunction
function UPR takes unit R8X, unit targetUnit returns nothing
	local integer hu = GetHandleId(R8X)
	local integer h
	local trigger t
	if LoadBoolean(P, hu,'A0QN'+ 1) then
		call UnitRemoveAbility(R8X,'A40H')
		call SaveBoolean(P, hu,'A0QN'+ 1, false)
	endif
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function UMR))
	set h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2, R8X)
	call SaveUnitHandle(HY, h, 30, targetUnit)
	call SetWidgetLife(R8X, RMaxBJ(GetWidgetLife(R8X)-$F, 1))
	call SaveEffectHandle(HY, h, 31, AddSpecialEffectTarget("Abilities\\Spells\\Other\\BreathOfFire\\BreathOfFireDamage.mdl", targetUnit, "chest"))
	set t = null
endfunction
function UQR takes unit R8X, unit WLE returns nothing
	if GetUnitAbilityLevel(R8X,'A0QN')> 0 and not X3X(R8X) and IsUnitType(WLE, UNIT_TYPE_MECHANICAL)== false then
		if LoadBoolean(P, GetHandleId(R8X),'A0QN') then
			call UPR(R8X, WLE)
		endif
		if LoadBoolean(P, GetHandleId(R8X),'A0QN'+ 1) then
			if LoadUnitHandle(P, GetHandleId(R8X),'A0QN'+ 1)== WLE then
				call UPR(R8X, WLE)
			else
				call SaveBoolean(P, GetHandleId(R8X),'A0QN'+ 1, false)
				call UnitRemoveAbility(R8X,'A40H')
			endif
		endif
	endif
endfunction
function USR takes unit R8X, unit WLE returns nothing
	if LoadBoolean(P, GetHandleId(R8X),'A0QN'+ 1) then
		if LoadUnitHandle(P, GetHandleId(R8X),'A0QN'+ 1)!= WLE then
			call SaveBoolean(P, GetHandleId(R8X),'A0QN'+ 1, false)
			call UnitRemoveAbility(R8X,'A40H')
		endif
	endif
endfunction
/*function UTR takes unit triggerUnit, integer O3O returns nothing
	local integer i = 0
	loop
		if i != O3O / 3 and GetUnitAbilityLevel(triggerUnit, CG[i])> 0 then
			call UnitRemoveAbility(triggerUnit, CG[i])
		endif
		set i = i + 1
	exitwhen i > 28
	endloop
	if GetUnitAbilityLevel(triggerUnit, CG[O3O / 3])== 0 then
		call UnitAddPermanentAbility(triggerUnit, CG[O3O / 3])
	endif
endfunction*/
function BerserkerBloodLoop takes nothing returns boolean
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local real life = GetWidgetLife(triggerUnit)
	local integer percent
	local integer i
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0QQ')
	local boolean haveEffect = LoadBoolean(HY, h, 319)
	local integer attackSpeed
	local real lastMagicResistance = LoadReal(HY, h, 1)
	local real newMagicResistance
	if IsUnitType(triggerUnit, UNIT_TYPE_HERO) and level > 0 and UnitAlive(triggerUnit) then
		set percent = R2I( 100. * life / GetUnitState(triggerUnit, UNIT_STATE_MAX_LIFE)) // 当前生命值百分比
		set i = IMaxBJ(IMinBJ(R2I( 100 -percent)/ 7, 14), 1) // 层数
		set newMagicResistance =(2 + level)* i * 0.01
		set attackSpeed =(6 + 2 * level)* i
		if IsUnitBreak(triggerUnit) then
			if lastMagicResistance != 0. then
				call ReduceUnitMagicResistance(triggerUnit, lastMagicResistance)
			endif
			set newMagicResistance = 0.
			call SaveReal(HY, h, 1, newMagicResistance)
			set attackSpeed = 0
		endif
		if newMagicResistance != lastMagicResistance then
			if lastMagicResistance != 0. then
				call ReduceUnitMagicResistance(triggerUnit, lastMagicResistance)
			endif
			call AddUnitMagicResistance(triggerUnit, newMagicResistance)
			call SaveReal(HY, h, 1, newMagicResistance)
		endif
		if attackSpeed != LoadInteger(HY, h, 0) then
			if attackSpeed -LoadInteger(HY, h, 0)> 0 then
				call LodSystem_AddUnitExtraState(triggerUnit, attackSpeed -LoadInteger(HY, h, 0), STATE_SYSTEM_ATTACK)
			else
				call LodSystem_ReduceUnitExtraState(triggerUnit, LoadInteger(HY, h, 0)-attackSpeed, STATE_SYSTEM_ATTACK)
			endif
			call SaveInteger(HY, h, 0, attackSpeed)
		endif
		if percent < 40 then
			if not haveEffect then
				call SaveBoolean(HY, h, 319, true)
				call SaveEffectHandle(HY, h, 175, AddSpecialEffectTarget("Abilities\\Spells\\Orc\\TrollBerserk\\HeadhunterWEAPONSLeft.mdl", triggerUnit, "left weapon"))
				call SaveEffectHandle(HY, h, 176, AddSpecialEffectTarget("effects\\HeadhunterWEAPONSRight_NoSound.mdx", triggerUnit, "right weapon"))
			endif
		else
			if haveEffect then
				call SaveBoolean(HY, h, 319, false)
				call DestroyEffect(LoadEffectHandle(HY, h, 175))
				call DestroyEffect(LoadEffectHandle(HY, h, 176))
			endif
		endif
	endif
	set triggerUnit = null
	return false
endfunction

// 开关魔法盾
function OpenManaShield takes unit whichUnit, boolean flag returns nothing
	if flag then
		call SaveInteger(ExtraHT, GetHandleId(whichUnit), 'A0MP', GetUnitAbilityLevel(whichUnit, 'A0MP'))
	else
		call RemoveSavedInteger(ExtraHT, GetHandleId(whichUnit), 'A0MP')
	endif
endfunction

function ManaShieldOrderFilter takes nothing returns boolean
	local unit u = GetTriggerUnit()
	local integer id = GetIssuedOrderId()
	local boolean flag 
	if id == 852589 then
		set flag = true
	elseif id == 852590 then
		set flag = false
	endif
	if GetUnitAbilityLevel(u, 'A0MP') > 0 and not IsUnitPaused(u) then
		call OpenManaShield(u, flag)
	endif
	set u = null
	return false
endfunction

function LearnLevel1Skill_ManaShield takes nothing returns nothing
	local trigger trig = CreateTrigger()
	local unit u = GetTriggerUnit()
	call TriggerRegisterUnitEvent(trig, u, EVENT_UNIT_ISSUED_ORDER)
	call TriggerAddCondition(trig, Condition( function ManaShieldOrderFilter))
	set HaveManaShield = true
	set trig = null
	set u = null
endfunction

// 狂战士之血
function LearnLevel1Skill_BerserkerBlood takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function BerserkerBloodLoop))
	call SaveUnitHandle(HY, GetHandleId(t), 14, GetTriggerUnit())
	call SaveBoolean(HY, GetHandleId(t), 319, false)
	call SaveInteger(HY, GetHandleId(t), 0, 0)
	set t = null
	/*
	set CG[1]='A2PD'
	set CG[2]='A2PA'
	set CG[3]='A2P9'
	set CG[4]='A2P8'
	set CG[5]='A2PE'
	set CG[6]='A2PC'
	set CG[7]='A2PB'
	set CG[8]='A2OW'
	set CG[9]='A2OX'
	set CG[10]='A2OY'
	set CG[11]='A2P0'
	set CG[12]='A2P1'
	set CG[$D]='A2P2'
	set CG[$E]='A2P7'
	set CG[$F]='A2P6'
	set CG[16]='A2P5'
	set CG[17]='A2P4'
	set CG[18]='A2P3'
	set CG[19]='A2OZ'
	set CG[20]='A2PF'
	set CG[21]='A2PG'
	set CG[22]='A2T8'
	set CG[23]='A2T9'
	set CG[24]='A2T7'
	set CG[25]='A46N'
	set CG[26]='A46O'
	set CG[27]='A46P'
	set CG[28]='A46Q'
	call SetAllPlayerAbilityUnavailable(CG[1])
	call SetAllPlayerAbilityUnavailable(CG[2])
	call SetAllPlayerAbilityUnavailable(CG[3])
	call SetAllPlayerAbilityUnavailable(CG[4])
	call SetAllPlayerAbilityUnavailable(CG[5])
	call SetAllPlayerAbilityUnavailable(CG[6])
	call SetAllPlayerAbilityUnavailable(CG[7])
	call SetAllPlayerAbilityUnavailable(CG[8])
	call SetAllPlayerAbilityUnavailable(CG[9])
	call SetAllPlayerAbilityUnavailable(CG[10])
	call SetAllPlayerAbilityUnavailable(CG[11])
	call SetAllPlayerAbilityUnavailable(CG[12])
	call SetAllPlayerAbilityUnavailable(CG[$D])
	call SetAllPlayerAbilityUnavailable(CG[$E])
	call SetAllPlayerAbilityUnavailable(CG[$F])
	call SetAllPlayerAbilityUnavailable(CG[16])
	call SetAllPlayerAbilityUnavailable(CG[17])
	call SetAllPlayerAbilityUnavailable(CG[18])
	call SetAllPlayerAbilityUnavailable(CG[19])
	call SetAllPlayerAbilityUnavailable(CG[20])
	call SetAllPlayerAbilityUnavailable(CG[21])
	call SetAllPlayerAbilityUnavailable(CG[22])
	call SetAllPlayerAbilityUnavailable(CG[23])
	call SetAllPlayerAbilityUnavailable(CG[24])
	call SetAllPlayerAbilityUnavailable(CG[25])
	call SetAllPlayerAbilityUnavailable(CG[26])
	call SetAllPlayerAbilityUnavailable(CG[27])
	call SetAllPlayerAbilityUnavailable(CG[28]) */
endfunction
function U0R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local integer level = LoadInteger(HY, h, 5)
	local real a = LoadReal(HY, h, 137)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local integer id = GetPlayerId(GetOwningPlayer(WUE))
	local integer EVX = GetTriggerEvalCount(t)
	local real NBX = x +$96* EVX * Cos(a)
	local real NCX = y +$96* EVX * Sin(a)
	local integer U1R = 6
	if LoadBoolean(HY, h, 0) then
		set U1R =$C
	endif
	call IssuePointOrderById(JIV[id],$D0208, NBX, NCX)
	if EVX ==(U1R) then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SetUnitAnimation(WUE, "stand")
	endif
	set t = null
	set WUE = null
	return false
endfunction
function VNE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = Atan2(y -GetUnitY(WUE), x -GetUnitX(WUE))
	local integer level = GetUnitAbilityLevel(WUE,'A0O5')
	local integer U2R ='A0OE'
	call SaveBoolean(HY, h, 0, false)
	if level == 0 then
		set level = GetUnitAbilityLevel(WUE,'A1B1')
		set U2R ='A1B2'
		call SaveBoolean(HY, h, 0, true)
	endif
	call SetUnitAnimation(WUE, "spell")
	set JIV[GetPlayerId(GetOwningPlayer(WUE))]= CreateUnit(GetOwningPlayer(WUE),'e00E', x, y, 0)
	call UnitAddPermanentAbility(JIV[GetPlayerId(GetOwningPlayer(WUE))], U2R)
	call SetUnitAbilityLevel(JIV[GetPlayerId(GetOwningPlayer(WUE))], U2R, level)
	call SaveInteger(HY, h, 5, level)
	call SaveReal(HY, h, 6, GetUnitX(WUE))
	call SaveReal(HY, h, 7, GetUnitY(WUE))
	call SaveReal(HY, h, 137, a * 1.)
	call SaveUnitHandle(HY, h, 2, WUE)
	if U2R =='A0OE' then
		call TriggerRegisterTimerEvent(t, .1, true)
	else
		call TriggerRegisterTimerEvent(t, .05, true)
	endif
	call TriggerAddCondition(t, Condition(function U0R))
	set t = null
	set WUE = null
endfunction
function VCE takes nothing returns nothing
endfunction
function U3R takes timer t, integer WFV returns nothing
	local integer i = 0
	loop
		call DestroyUbersplat(LoadUbersplatHandle(P, WFV, i + 500))
		call DestroyEffect(LoadEffectHandle(P, WFV, i + 3))
		set i = i + 1
	exitwhen i ==$E
	endloop
	call RemoveUnit(LoadUnitHandle(P, WFV, 1))
	call LogoutGroup(LoadGroupHandle(P, WFV, 2))
	call DestroyTimerAndFlushHT_P(t)
	set t = null
endfunction
function U4R takes nothing returns boolean
	local unit t = GetFilterUnit()
	local unit u = Temp__ArrayUnit[0]
	local player p = GetOwningPlayer(t)
	local group g
	if IsUnitEnemy(u, p) and IsAliveNotStrucNotWard(t) and IsMagicImmuneUnit(t)== false then
		set g = LoadGroupHandle(P, XK[0], 2)
		if IsUnitInGroup(t, g)== false then
			call GroupAddUnit(g, t)
			call UnitDamageTargetEx(u, t, 1, XK[1])
			call CommonUnitAddStun(t,(XK[2]* 1.)* .4 + .6, false)
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathMissile.mdl", GetUnitX(t), GetUnitY(t)))
		endif
		set g = null
	endif
	set u = null
	set t = null
	return false
endfunction
function U5R takes nothing returns nothing
	local ubersplat u = null
	local timer t = GetExpiredTimer()
	local integer WVV
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(P, WFV, 0)+ 1
	local integer UJV = LoadInteger(P, WFV, 1)
	local real radian
	local real ax
	local real ay
	local real x
	local real y
	if UYX == UJV then
		call U3R(t, WFV)
		set t = null
		return
	endif
	call SaveInteger(P, WFV, 0, UYX)
	if UYX <$E then
		set radian = LoadReal(P, WFV, 0)
		set x = LoadReal(P, WFV, 1)+ 100 * UYX * Cos(radian)
		set y = LoadReal(P, WFV, 2)+ 100 * UYX * Sin(radian)
		call SaveEffectHandle(P, WFV, 2 + UYX, AddSpecialEffect("effects\\IcePath.mdx", x, y))
		set u = CreateUbersplat(x, y, "IPTH", 255, 255, 255, 255, false, false)
		call SetUbersplatRenderAlways(u, true)
		call SaveUbersplatHandle(P, WFV, 500 + UYX, u)
		set t = null
		set u = null
		return
	endif
	set Temp__ArrayUnit[0]= LoadUnitHandle(P, WFV, 0)
	set Temp__ArrayUnit[1]= LoadUnitHandle(P, WFV, 1)
	set XK[2]= LoadInteger(P, WFV, 3)
	set XK[1]= LoadInteger(P, WFV, 2)
	set XK[0]= WFV
	set radian = LoadReal(P, WFV, 0)
	set x = LoadReal(P, WFV, 1)
	set y = LoadReal(P, WFV, 2)
	set ax = Cos(radian)
	set ay = Sin(radian)
	set WVV = 0
	loop
		call GroupEnumUnitsInRange(AK, x, y, 175, Condition(function U4R))
		set x = x + 100 * ax
		set y = y + 100 * ay
		set WVV = WVV + 1
	exitwhen WVV ==$D
	endloop
	set t = null
endfunction
function Jakiro_Icepath_Start2 takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local integer WFV = GetHandleId(t)
	local integer WUV = GetUnitAbilityLevel(u,'A0O6')
	local real x = GetWidgetX(u)
	local real y = GetWidgetY(u)
	call SaveUnitHandle(P, WFV, 0, u)
	set u = CreateUnit(NeutralPassivePlayer,'e00E', 0, 0, 0)
	call SaveUnitHandle(P, WFV, 1, u)
	call SaveGroupHandle(P, WFV, 2, LoginGroup(203))
	call SaveInteger(P, WFV, 0, 0)
	call SaveInteger(P, WFV, 1, WUV * 8 +$C)
	call SaveInteger(P, WFV, 2, 50)
	call SaveInteger(P, WFV, 3, WUV)
	call SaveReal(P, WFV, 0, Atan2(GetSpellTargetY()-y, GetSpellTargetX()-x))
	call SaveReal(P, WFV, 1, x)
	call SaveReal(P, WFV, 2, y)
	call TimerStart(t, .05, true, function U5R)
	set t = null
	set u = null
endfunction
function U6R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real x =(LoadReal(HY,(h), 6))
	local real y =(LoadReal(HY,(h), 7))
	local real a =(LoadReal(HY,(h), 137))
	local unit WJE =(LoadUnitHandle(HY,(h), 2))
	local integer c = GetTriggerEvalCount(t)
	local real dx
	local real dy
	local group g
	local integer i
	local group gg =(LoadGroupHandle(HY,(h), 187))
	local integer level = LoadInteger(HY, h, 5)
	local unit u
	local real GEX
	set i = 0
	set g = LoginGroup(204)
	loop
		set dx = x + 100 * i * Cos(a * bj_DEGTORAD)
		set dy = y + 100 * i * Sin(a * bj_DEGTORAD)
		set U2 = WJE
		set GEX =(.6 + .4 * level)-(c * .05)
		call GroupEnumUnitsInRange(g, dx, dy, 175, Condition(function DJX))
		call GroupRemoveGroup(gg, g)
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			if IsUnitInGroup(u, gg)== false and RCX(u)== false then
				call GroupAddUnit(gg, u)
				call CommonUnitAddStun(u, GEX, false)
				call UnitDamageTargetEx(WJE, u, 1, 50)
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathMissile.mdl", GetUnitX(u), GetUnitY(u)))
			endif
			call GroupRemoveUnit(g, u)
		endloop
		set i = i + 1
	exitwhen i >$D
	endloop
	call LogoutGroup(g)
	if c == 20 *(.6 + .4 * level) then
		call LogoutGroup(gg)
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WJE = null
	set g = null
	set gg = null
	return false
endfunction
function U7R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local real a =(LoadReal(HY, h, 137))
	local integer c = GetTriggerEvalCount(t)
	local real dx = x + 100 * c * Cos(a * bj_DEGTORAD)
	local real dy = y + 100 * c * Sin(a * bj_DEGTORAD)
	local unit WJE =(LoadUnitHandle(HY, h, 2))
	local integer level = LoadInteger(HY, h, 5)
	local ubersplat ub
	local integer i
	if c <$D+ 1 then
		call SaveEffectHandle(HY, h,(609 + c),(AddSpecialEffect("effects\\IcePath.mdx", dx, dy)))
		set ub = CreateUbersplat(dx, dy, "IPTH", 255, 255, 255, 255, false, false)
		call SetUbersplatRenderAlways(ub, true)
		call SaveUbersplatHandle(HY, h,(760 + c),(ub))
	endif
	if c == 14 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .05, true)
		call TriggerAddCondition(t, Condition(function U6R))
		call SaveInteger(HY, h, 5, level)
		call SaveReal(HY, h, 6,((x)* 1.))
		call SaveReal(HY, h, 7,((y)* 1.))
		call SaveReal(HY, h, 137,((a)* 1.))
		call SaveUnitHandle(HY, h, 2,(WJE))
		call SaveGroupHandle(HY, h, 187,(LoginGroup(205)))
		call TriggerEvaluate(t)
	elseif c >=(.4 + .6 + .4 * level)/ .05 then
		set i = 0
		loop
			call DestroyEffect((LoadEffectHandle(HY, h,(609 + i))))
			call DestroyUbersplat((LoadUbersplatHandle(HY, h,(760 + i))))
			set i = i + 1
		exitwhen i ==$E
		endloop
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WJE = null
	return false
endfunction
function YXV takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WJE = GetTriggerUnit()
	local real x = GetUnitX(WJE)
	local real y = GetUnitY(WJE)
	local real a = AngleBetweenXY(x, y, GetSpellTargetX(), GetSpellTargetY())
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function U7R))
	call SaveReal(HY,(h), 6,((x)* 1.))
	call SaveReal(HY,(h), 7,((y)* 1.))
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(WJE,'A0O6'))
	call SaveReal(HY,(h), 137,((a)* 1.))
	call SaveUnitHandle(HY,(h), 2,(WJE))
	call TriggerEvaluate(t)
	set t = null
	set WJE = null
endfunction
// 冰火交加
function DualBreathDE takes nothing returns nothing
	local integer i = GetUnitAbilityLevel(DESourceUnit[DEI],'A0OB')
	if i > 0 and GetUnitAbilityLevel(DESourceUnit[DEI],'A3JI'-1 + i)== 0 then
		call AddAbilityToTimed(DETargetUnit[DEI],'A3JI'-1 + GetUnitAbilityLevel(DESourceUnit[DEI],'A0OB'), 1, 5,'B3J1')
	endif
endfunction
function U9R takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit d = LoadUnitHandle(HY, h, 0)
	call IssuePointOrderById(d,$D0250, LoadReal(HY, h, 0), LoadReal(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTrigger(t)
	set d = null
	set t = null
endfunction
function VGE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local trigger t = CreateTrigger()
	local integer level = GetUnitAbilityLevel(u, GetSpellAbilityId())
	local integer h = GetHandleId(t)
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call TGV(3)
	call TriggerRegisterTimerEvent(t, .3, false)
	call TriggerAddCondition(t, Condition(function U9R))
	call UnitAddAbility(d,'A0OB')
	call SetUnitAbilityLevel(d,'A0OB', level)
	call IssuePointOrderById(d,$D0264, x, y)
	set d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call UnitAddAbility(d,'A0OC')
	call SetUnitAbilityLevel(d,'A0OC', level)
	call SaveUnitHandle(HY, h, 0, d)
	call SaveReal(HY, h, 0, x)
	call SaveReal(HY, h, 1, y)
	set d = null
	set t = null
	set u = null
endfunction
function MHX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A0OB')
	call AddAbilityIDToPreloadQueue('A0OC')
	call AddAbilityIDToPreloadQueue('A0OA')
	call AddAbilityIDToPreloadQueue('A0OE')
endfunction
function WVR takes unit u, unit t returns nothing
	local real a = GetRandomReal(0, 360)
	local real x = GetUnitX(t)+ 50 * Cos(a * bj_DEGTORAD)
	local real y = GetUnitY(t)+ 50 * Sin(a * bj_DEGTORAD)
	local real damage = GetRandomReal(200, 225)
	call SetUnitX(u, x)
	call SetUnitY(u, y)
	call SetUnitFacing(u, bj_RADTODEG * Atan2(GetUnitY(t)-GetUnitY(u), GetUnitX(t)-GetUnitX(u)))
	call SetUnitAnimation(u, "Attack")
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl", u, "chest"))
	if XFX(GetOwningPlayer(t))== false and IsUnitType(t, UNIT_TYPE_ANCIENT)== false then
		set damage = 99999
	endif
	call UnitDamageTargetEx(u, t, 2, damage)
endfunction
function WXR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 14))
	local unit target =(LoadUnitHandle(HY, h, 17))
	call WVR(u, target)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set u = null
	set target = null
	return false
endfunction
function WOR takes unit triggerUnit returns nothing
	local group g = LoginGroup(206)
	set U2 = triggerUnit
	call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), 450, Condition(function FXX))
	set U2 = GroupPickRandomUnit(g)
	if U2 != null then
		call WVR(triggerUnit, U2)
	endif
	call LogoutGroup(g)
	set g = null
endfunction
function WRR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 14))
	local unit fovd =(LoadUnitHandle(HY, h, 19))
	local integer WAR =(LoadInteger(HY, h,$D8))
	local integer WNR =(LoadInteger(HY, h, 325))
	local integer S4R =(LoadInteger(HY, h, 28))
	local unit WBR
	if S4R > WAR then
		if LoadInteger(HY, h, 0)> 0 then
			call LodSystem_ReduceUnitExtraState(u, LoadInteger(HY, h, 0), STATE_SYSTEM_ATTACK)
		endif
		call KillUnit(fovd)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		
		call EXSetUnitPathing(u, true)
		call SetUnitInvulnerableEx(u, false)
		call SaveInteger(HY,(GetHandleId((u))),(4253), 2)
		call SetUnitVertexColorEx(u,-1,-1,-1, 255)
	else
		call SaveInteger(HY, h, 28,(S4R + 1))
		call WOR(u)
		if U2 == null then
			if LoadInteger(HY, h, 0)> 0 then
				call LodSystem_ReduceUnitExtraState(u, LoadInteger(HY, h, 0), STATE_SYSTEM_ATTACK)
			endif
			call KillUnit(fovd)
			call DestroyEffect((LoadEffectHandle(HY, h, 32)))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			
			call EXSetUnitPathing(u, true)
			call SetUnitInvulnerableEx(u, false)
			call SaveInteger(HY,(GetHandleId((u))),(4253), 2)
			call SetUnitVertexColorEx(u,-1,-1,-1, 255)
		endif
	endif
	set t = null
	set u = null
	set WBR = null
	set fovd = null
	return false
endfunction
function WCR takes nothing returns nothing
	local timer t2 = GetExpiredTimer()
	local integer h2 = GetHandleId(t2)
	local unit u = LoadUnitHandle(HY, h2, 0)
	local unit target = LoadUnitHandle(HY, h2, 1)
	local integer lv = GetUnitAbilityLevel(u,'A0M1')
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer WNR = GetUnitAbilityLevel(u,'A05G')
	local player p = GetOwningPlayer(u)
	local integer WAR = 3
	local unit fovd = CreateUnit(GetOwningPlayer(u),'o00D', GetUnitX(u), GetUnitY(u), 0)
	local integer WDR
	local integer WFR
	if GetUnitAbilityLevel(u,'Aloc')== 1 and HaveSavedHandle(HY, GetHandleId(u), 0) then
		set u = LoadUnitHandle(HY, GetHandleId(u), 0)
	endif
	set WDR = IMaxBJ(GetHeroStr(u, true), IMaxBJ(GetHeroAgi(u, true), GetHeroInt(u, true)))
	set WFR = WDR -GetHeroAgi(u, true)
	if lv == 0 then
		set lv = GetUnitAbilityLevel(u,'A1AX')
		if lv == 1 then
			set WAR = 6
		elseif lv == 2 then
			set WAR = 9
		elseif lv == 3 then
			set WAR = 12
		endif
	elseif lv == 2 then
		set WAR = 6
	elseif lv == 3 then
		set WAR = 9
	endif
	call SetUnitVertexColorEx(u,-1,-1,-1, 125)
	call EXSetUnitPathing(u, false)
	call SetUnitInvulnerableEx(u, true)
	call SaveInteger(HY, GetHandleId(u), 4253, 1)
	call SaveUnitHandle(HY, h, 14,(u))
	call SaveUnitHandle(HY, h, 17,(target))
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function WXR))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 14,(u))
	call SaveUnitHandle(HY, h, 19,(fovd))
	call SaveInteger(HY, h,$D8,(WAR))
	call SaveInteger(HY, h, 325,(WNR))
	call SaveInteger(HY, h, 28, 2)
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl", u, T2V(u))))
	call TriggerRegisterTimerEvent(t, .4, true)
	call TriggerAddCondition(t, Condition(function WRR))
	if WFR > 0 then
		call LodSystem_AddUnitExtraState(u, WFR, STATE_SYSTEM_ATTACK)
		call SaveInteger(HY, h, 0, WFR)
	endif
	call DestroyTimer(t2)
	call FlushChildHashtable(HY, h2)
	set t2 = null
	set u = null
	set target = null
	set t = null
	set p = null
	set fovd = null
endfunction
function Omnislash takes nothing returns nothing
	local timer t = null
	local integer h
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		call TimerStart(t, 0, false, function WCR)
		set t = null
	endif
endfunction
function WGR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call SetUnitAnimationByIndex(WUE, 4)
	set t = null
	set WUE = null
	return false
endfunction
function KQE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerAddCondition(t, Condition(function WGR))
	call SaveUnitHandle(HY, h, 2,(WUE))
	set t = null
	set WUE = null
endfunction
function WHR takes nothing returns nothing
	call UnitDamageTargetEx(JAV, GetEnumUnit(), 8,(55. + 25. * JNV)* .25)
endfunction
function WJR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local integer EVX = GetTriggerEvalCount(t)
	local group g
	if EVX == 16 or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		//call SetUnitPathing(WUE, true)
		call CleanCurrentTrigger(t)
	else
		set U2 = WUE
		set JAV = WUE
		set JNV = LoadInteger(HY, h, 0)
		set g = LoginGroup(207)
		call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 275, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call ForGroup(g, function WHR)
		call LogoutGroup(g)
		set g = null
	endif
	set t = null
	set WUE = null
	return false
endfunction
function VLE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerRegisterDeathEvent(t, GetTriggerUnit())
	//call SetUnitPathing(GetTriggerUnit(), false)
	call TriggerAddCondition(t, Condition(function WJR))
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(GetTriggerUnit(),'A05G'))
	call SaveUnitHandle(HY, h, 2,(GetTriggerUnit()))
	if(GetUnitTypeId(GetTriggerUnit())!='Nbbc' and GetUnitTypeId(GetTriggerUnit())!='Opgh') then
		call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\SpinFX2.mdx", GetTriggerUnit(), "origin")))
	endif
	call TriggerEvaluate(t)
	call EPX(GetTriggerUnit(), 4252, 5)
	call RemoveUnitBuff(GetTriggerUnit(), false)
	call SkillImmunityDispel(GetTriggerUnit())
	set t = null
endfunction
function WKR takes nothing returns boolean
	return GetUnitTypeId(GetSummonedUnit())=='o00C' or GetUnitTypeId(GetSummonedUnit())=='o01G' or GetUnitTypeId(GetSummonedUnit())=='o01H' or GetUnitTypeId(GetSummonedUnit())=='o01I'
endfunction
function WLR takes nothing returns nothing
	call SetUnitAbilityLevel(GetSummonedUnit(),'A058', GetUnitAbilityLevel(GetSummoningUnit(),'A047'))
endfunction
function MQX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function WKR))
	call TriggerAddAction(t, function WLR)
	set t = null
endfunction
function WMR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real x1
	local real y1
	local real x2
	local real y2
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or(GetTriggerEventId()== EVENT_UNIT_DAMAGED and GetEventDamage()> 2 and XFX(GetOwningPlayer(GetEventDamageSource()))) then
		call DestroyEffect((LoadEffectHandle(HY, h, 175)))
		call DestroyEffect((LoadEffectHandle(HY, h, 176)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()!= EVENT_UNIT_DAMAGED and GetTriggerEventId()!= EVENT_WIDGET_DEATH then
		set x1 = GetUnitX(WUE)
		set y1 = GetUnitY(WUE)
		set x2 = GetUnitX(targetUnit)
		set y2 = GetUnitY(targetUnit)
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x1, y1))
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl", x2, y2))
		call EPX(targetUnit, 4410, 1)
		call SetUnitPosition(targetUnit, GetUnitX(WUE), GetUnitY(WUE))
		call DestroyEffect(LoadEffectHandle(HY, h, 175))
		call DestroyEffect(LoadEffectHandle(HY, h, 176))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function WPR takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local real d = GetDistanceBetween(GetUnitX(targetUnit), GetUnitY(targetUnit), JDV, JFV)
	if d < JCV and LoadBoolean(HY, GetHandleId(GetOwningPlayer(targetUnit)),$8B)== false then
		set JBV = targetUnit
		set JCV = d
	endif
	set targetUnit = null
endfunction
function VSE takes nothing returns nothing
	local unit targetUnit = GetSpellTargetUnit()
	local unit WUE = GetTriggerUnit()
	local trigger t
	local integer h
	local real N5O
	local group g = null
	local integer level = GetUnitAbilityLevel(WUE,'A10U')
	if targetUnit == null then
		set JBV = null
		set JCV =$F423F
		set JDV = GetSpellTargetX()
		set JFV = GetSpellTargetY()
		set U2 = WUE
		set g = LoginGroup(208)
		call GroupEnumUnitsInRange(g, 0, 0, 9999, Condition(function D4X))
		call GroupRemoveUnit(g, WUE)
		call ForGroup(g, function WPR)
		call LogoutGroup(g)
		set targetUnit = JBV
		set g = null
	endif
	if targetUnit != null then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerRegisterDeathEvent(t, WUE)
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
		call TriggerRegisterTimerEvent(t, 6 -level, false)
		call TriggerAddCondition(t, Condition(function WMR))
		call SaveUnitHandle(HY, h, 2,(WUE))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SaveEffectHandle(HY, h, 175,(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTo.mdl", WUE, "origin")))
		call SaveEffectHandle(HY, h, 176,(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTo.mdl", targetUnit, "origin")))
	endif
	set targetUnit = null
	set WUE = null
	set t = null
endfunction

function KSE takes nothing returns nothing
	if GetSpellTargetUnit()!= null and LoadBoolean(HY, GetHandleId(GetOwningPlayer(GetSpellTargetUnit())),$8B) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetSpellTargetUnit()), "该玩家已禁用来自盟友的帮助。")
	endif
endfunction

// 法力流失的AbilityId和Buff
function GetManaLeakAbilityFromLevel takes integer lv returns integer
	if lv == 1 then
		return'A10Z'
	elseif lv == 2 then
		return'A111'
	elseif lv == 3 then
		return'A10Y'
	elseif lv == 4 then
		return'A110'
	endif
	return 0
endfunction
function GetManaLeakBuffFromLevel takes integer lv returns integer
	if lv == 1 then
		return'B09M'
	elseif lv == 2 then
		return'B09N'
	elseif lv == 3 then
		return'B09O'
	elseif lv == 4 then
		return'B09L'
	endif
	return 0
endfunction
function ManaLeak_Fx takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 5))
	local real lastX =(LoadReal(HY, h, 23))
	local real lastY =(LoadReal(HY, h, 24))
	local real x = GetUnitX(targetUnit)
	local real y = GetUnitY(targetUnit)
	local real distance = GetDistanceBetween( lastX, lastY, x, y )//SquareRoot(lastX -x)*(lastX -x)+(lastY -y)*(lastY -y)
	local real leakValue =(.0005)* distance * GetUnitState(targetUnit, UNIT_STATE_MAX_MANA)
	local integer evalCount = GetTriggerEvalCount(trig)
	if IsMagicImmuneUnit(targetUnit) then
		set leakValue = 0
	endif
	if distance > 300 then
		set leakValue = 0
	endif
	if leakValue > 1 and ModuloInteger(evalCount, 3)== 0 then
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\WingedSerpentMissile\\WingedSerpentMissile.mdl", targetUnit, "chest"))
	endif
	if leakValue > 0 then
		// debug call SingleDebug( "法力流失 移动距离" + R2S( distance ) + " 流失魔法值：" + R2S( leakValue ) )
		call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)-leakValue)
	endif
	call SaveReal(HY, h, 23,(x)* 1.)
	call SaveReal(HY, h, 24,(y)* 1.)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or evalCount == (level + 4)* 10 or GetUnitAbilityLevel(targetUnit, GetManaLeakAbilityFromLevel(level))== 0 then
		call UnitRemoveAbility(targetUnit, GetManaLeakAbilityFromLevel(level))
		call UnitRemoveAbility(targetUnit, GetManaLeakBuffFromLevel(level))
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(trig)
	elseif GetUnitState(targetUnit, UNIT_STATE_MANA)< 1 then
		call CommonUnitAddStun(targetUnit, 1 + .5 * level, false)
		call UnitRemoveAbility(targetUnit, GetManaLeakAbilityFromLevel(level))
		call UnitRemoveAbility(targetUnit, GetManaLeakBuffFromLevel(level))
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(trig)
	endif
	set trig = null
	set targetUnit = null
	return false
endfunction
function ManaLeak_CallBack takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger trig = CreateTrigger()
	local integer h = GetHandleId(trig)
	local integer level = GetUnitAbilityLevel(spellUnit,'A10X')
	call UnitAddPermanentAbility(targetUnit, GetManaLeakAbilityFromLevel(level))
	call SaveUnitHandle(HY, h, 17, targetUnit)
	//call SaveUnitHandle(HY, h, 2, spellUnit)
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h, 23,(GetUnitX(targetUnit)* 1.))
	call SaveReal(HY, h, 24,(GetUnitY(targetUnit)* 1.))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("effects\\BasicWaterFlash.mdx", targetUnit, "chest")))
	call TriggerRegisterTimerEvent(trig, .1, true)
	call TriggerRegisterDeathEvent(trig, targetUnit)
	call TriggerAddCondition(trig, Condition(function ManaLeak_Fx))
	set spellUnit = null
	set targetUnit = null
	set trig = null
endfunction
function SpellEffect__ManaLeak takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call ManaLeak_CallBack()
	endif
endfunction
function WZR takes nothing returns nothing
	local integer h = GetHandleId(GetExpiredTimer())
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit d = LoadUnitHandle(HY, h, 1)
	if GetUnitTypeId(u)=='H06X' and UnitAlive(u) and GetWidgetLife(u)> 0 and IsUnitHidden(u)== false then
		if IsUnitHidden(d) then
			call ShowUnit(d, true)
			call UnitRemoveAbility(d, 'Aloc')
			call UnitAddAbility(d, 'Aloc')
		endif
		call SetUnitPosition(d, GetUnitX(u), GetUnitY(u))
	else
		if IsUnitHidden(d)== false then
			call ShowUnit(d, false)
		endif
	endif
	set u = null
	set d = null
endfunction
function W_R takes unit u returns nothing
	local unit d = CreateUnit(GetOwningPlayer(u),'hSPR', GetUnitX(u), GetUnitY(u), 0)
	local timer t = CreateTimer()
	call TimerStart(t, .25, true, function WZR)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveUnitHandle(HY, GetHandleId(t), 1, d)
	call SaveBoolean(P, GetHandleId(u),'SPRT', true)
	set t = null
	set d = null
endfunction
function V0E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'QM01')
	local player p = GetOwningPlayer(u)
	local boolean W0R = GetUnitTypeId(u)!='H06X'
	call SetPlayerAbilityAvailable(p,'A11X', W0R)
	call SetPlayerAbilityAvailable(p,'A10U', W0R)
	call SetUnitAbilityLevel(u,'A11X', level)
	call SetUnitAbilityLevel(u,'A10U', level)
	if W0R then
		if LoadBoolean(P, GetHandleId(u),'SPRT')!= true then
			call W_R(u)
		endif
	endif
	set u = null
endfunction
function FWE takes nothing returns nothing
	call SaveBoolean(P, GetHandleId(GetTriggerUnit()),'A085', false)
endfunction
function JNE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer id = GetUnitTypeId(u)
	if id <'H06W' or id >'H06Y' then
		call SaveBoolean(P, GetHandleId(u),'A085', false)
	endif
	set u = null
endfunction
function W1R takes nothing returns boolean
	local unit u = GetFilterUnit()
	local integer id = GetUnitTypeId(u)
	if UnitAlive(u) and IsUnitInGroup(u, Q7V)== false and GetUnitAbilityLevel(u,'A04R')== 0 and IsUnitType(u, UNIT_TYPE_STRUCTURE)== false then
		call GroupAddUnit(Q7V, u)
		if IsUnitEnemy(u, Temp__Player) then
			call UnitDamageTargetEx(Temp__ArrayUnit[0], u, 1, XK[0])
		elseif X3 then
			call SetWidgetLife(u, GetWidgetLife(u)+ XK[0]* .75)
		endif
	endif
	set u = null
	return false
endfunction
function W2R takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(P, WFV, 0)
	local unit u = LoadUnitHandle(P, WFV, 0)
	local real x
	local real y
	local real s = LoadReal(P, WFV, StringHash("scale"))
	local unit O8O = LoadUnitHandle(P, WFV, 1)
	if UYX == 1 then
		call LogoutGroup(LoadGroupHandle(P, WFV, 2))
		call DestroyTimerAndFlushHT_P(t)
		call KillUnit(u)
		set t = null
		set u = null
		return
	endif
	call SaveInteger(P, WFV, 0, UYX -1)
	set x = GetWidgetX(u)+ LoadReal(P, WFV, 3)
	set y = GetWidgetY(u)+ LoadReal(P, WFV, 4)
	call SetUnitX(u, x)
	call SetUnitY(u, y)
	if s < .4 then
		set s = s + .025
	elseif s < 1.5 and s > .4 then
		set s = s + .09
	else
		set s = 1.5
	endif
	call SetUnitScale(u, s, s, s)
	call SaveReal(P, WFV, StringHash("scale"), s)
	call A8X(GetOwningPlayer(O8O), 2.5, x, y, 375)
	set Temp__Player = LoadPlayerHandle(P, WFV, 2)
	set Temp__ArrayUnit[0]= O8O
	set XK[0]= LoadInteger(P, WFV, 1)
	set Q7V = LoadGroupHandle(P, WFV, 3)
	set X3 = G3X(u)
	call GroupEnumUnitsInRange(AK, x, y, 375, Condition(function W1R))
	set O8O = null
	set t = null
	set u = null
endfunction
function W3R takes nothing returns nothing
	local real s
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(P, WFV, 0)-1
	local unit u = LoadUnitHandle(P, WFV, 0)
	local unit O8O
	if UYX == 0 or LoadBoolean(P, GetHandleId(LoadUnitHandle(P, WFV, 1)),'A085')== false then
		call KillUnit(u)
		set O8O = CreateUnit(NeutralPassivePlayer,'h070', LoadReal(P, WFV, 0), LoadReal(P, WFV, 1), LoadReal(P, WFV, 2))
		call SetUnitScale(O8O, .1, .1, .1)
		call SaveReal(P, WFV, StringHash("scale"), .15)
		call SaveInteger(P, WFV, 0, 61)
		call SaveInteger(P, WFV, 1,(LoadInteger(P, WFV, 1)-UYX)* 10)
		call SaveUnitHandle(P, WFV, 0, O8O)
		call SaveGroupHandle(P, WFV, 3, LoginGroup(209))
		call TimerStart(t, .025, true, function W2R)
		call SaveBoolean(P, GetHandleId(LoadUnitHandle(P, WFV, 1)),'A085', false)
		call S9E(LoadPlayerHandle(P, WFV, 2),'A121', false)
		call S9E(LoadPlayerHandle(P, WFV, 2),'A085', true)
		call RemoveUnit(LoadUnitHandle(P, WFV, 4))
		set O8O = null
		set t = null
		set u = null
		return
	endif
	set s = 1 +(LoadInteger(P, WFV, 1)-UYX)* .1
	call SetUnitScale(u, s, s, s)
	call SaveInteger(P, WFV, 0, UYX)
	set t = null
	set u = null
endfunction
function FUE takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local real x = GetWidgetX(u)
	local real y = GetWidgetY(u)
	local real a = Atan2(GetSpellTargetY()-y, GetSpellTargetX()-x)
	local real x1 = x +$96* Cos(a)
	local real y1 = y +$96* Sin(a)
	local integer WFV = GetHandleId(t)
	local integer i = GetUnitAbilityLevel(u,'A085')*$A+$A
	call S9E(p,'A085', false)
	call S9E(p,'A121', true)
	call UnitAddPermanentAbility(u,'A121')
	call SaveUnitHandle(P, WFV, 0, CreateUnit(NeutralPassivePlayer,'u00J', x1, y1, a * bj_RADTODEG))
	call SavePlayerHandle(P, WFV, 2, p)
	call SaveInteger(P, WFV, 0, i)
	call SaveInteger(P, WFV, 1, i)
	call SaveReal(P, WFV, 0, x1)
	call SaveReal(P, WFV, 1, y1)
	call SaveReal(P, WFV, 2, a * bj_RADTODEG)
	call SaveReal(P, WFV, 3, 26.25 * Cos(a))
	call SaveReal(P, WFV, 4, 26.25 * Sin(a))
	if GetUnitTypeId(u)=='e00E' then
		call SaveUnitHandle(P, WFV, 1, Player__Hero[GetPlayerId(p)])
		call SaveBoolean(P, GetHandleId(Player__Hero[GetPlayerId(p)]),'A085', true)
	else
		call SaveUnitHandle(P, WFV, 1, u)
		call SaveBoolean(P, GetHandleId(u),'A085', true)
		if GetUnitTypeId(u)>='H06W' and GetUnitTypeId(u)<='H06Y' then
			set u = CreateUnit(p,'h06Z', x, y, a * bj_RADTODEG)
			call SetUnitX(u, x)
			call SetUnitY(u, y)
			call SetUnitAnimation(u, "spell")
			call QueueUnitAnimation(u, "spell")
			call SetUnitVertexColor(u, 255, 255, 255, 75)
			call SaveUnitHandle(P, WFV, 4, u)
		endif
	endif
	call TimerStart(t, .1, true, function W3R)
	set t = null
	set u = null
endfunction
function W4R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real W5R =(LoadReal(HY, h,$F2))
	call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)+ W5R)
	call AddAbilityToTimed(targetUnit,'A3DU'-1 + LoadInteger(HY, h, 5), 1, 12,'B3DU')
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIim\\AIimTarget.mdl", targetUnit, "origin"))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set targetUnit = null
	set t = null
	return false
endfunction
function V_E takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(triggerUnit,'A112'))
	call SaveReal(HY, h,$F2,((75 * GetUnitAbilityLevel(triggerUnit,'A112'))* 1.))
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function W4R))
	set t = null
	set triggerUnit = null
	set targetUnit = null
endfunction
function W6R takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local real x = GetUnitX(targetUnit)
	local real y = GetUnitY(targetUnit)
	local real a = Atan2(y -JJV, x -JHV)
	set x = CoordinateX50(x + 40 * Cos(a))
	set y = CoordinateY50(y + 40 * Sin(a))
	call KillDestructablesInCircle(x, y, 150)
	call SetUnitX(targetUnit, x)
	call SetUnitY(targetUnit, y)
	set targetUnit = null
endfunction
function W7R takes nothing returns nothing
	call AddAbilityToTimed(GetEnumUnit(),'A3PZ', 1, 3 + JGV,'B09K')
endfunction
function W8R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player p =(LoadPlayerHandle(HY, h, 54))
	local real WYE =(LoadReal(HY, h, 189))
	local real WZE =(LoadReal(HY, h,$BE))
	local integer CVX =(LoadInteger(HY, h, 59))
	local group g =(LoadGroupHandle(HY, h, 22))
	local integer EVX = GetTriggerEvalCount(t)
	set JHV = WYE
	set JJV = WZE
	call ForGroup(g, function W6R)
	if EVX ==$A then
		set JGV = CVX
		set E3 = p
		call ForGroup(g, function W7R)
		call LogoutGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set p = null
	set g = null
	return false
endfunction
function W9R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player p =(LoadPlayerHandle(HY, h, 54))
	local real WYE =(LoadReal(HY, h, 189))
	local real WZE =(LoadReal(HY, h,$BE))
	local integer CVX =(LoadInteger(HY, h, 59))
	local group g =(LoadGroupHandle(HY, h, 22))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .04, true)
	call TriggerAddCondition(t, Condition(function W8R))
	call SavePlayerHandle(HY, h, 54,(p))
	call SaveReal(HY, h, 189,((WYE)* 1.))
	call SaveReal(HY, h, 190,((WZE)* 1.))
	call SaveGroupHandle(HY, h, 22,(g))
	call SaveInteger(HY, h, 59,(CVX))
	set t = null
	set p = null
	set g = null
	return false
endfunction
function V1E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local group g = LoginGroup(210)
	local unit WUE = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	call KillUnit(CreateUnit(GetOwningPlayer(WUE),'h06P', x, y, 0))
	set U2 = WUE
	call GroupEnumUnitsInRange(g, x, y, 700, Condition(function DQX))
	call TriggerRegisterTimerEvent(t, .4, false)
	call TriggerAddCondition(t, Condition(function W9R))
	call SavePlayerHandle(HY, h, 54,(GetOwningPlayer(WUE)))
	call SaveReal(HY, h, 189,((x)* 1.))
	call SaveReal(HY, h, 190,((y)* 1.))
	call SaveGroupHandle(HY, h, 22,(g))
	call SaveInteger(HY, h, 59, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	call EnableEffectByTime(I, 8)
	set t = null
	set g = null
	set WUE = null
endfunction
function YVR takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u
	local integer YER
	if GetGameTime()> LoadReal(HY, h, 0) then
		set u = LoadUnitHandle(HY, h, 0)
		call RemoveSavedHandle(HY, GetHandleId(u),'A18X')
		call LodSystem_ReduceUnitExtraState(u, LoadInteger(HY, h, 1), STATE_SYSTEM_ATTACK)
		call J8X(u, LoadInteger(HY, h, 2))
		set YER = LoadInteger(HY, h, 0)
		call DestroyEffect(LoadEffectHandle(HY, h,$A+ 1))
		call DestroyEffect(LoadEffectHandle(HY, h, 20 + 1))
		if YER >= 2 then
			call DestroyEffect(LoadEffectHandle(HY, h,$A+ 2))
			call DestroyEffect(LoadEffectHandle(HY, h, 20 + 2))
		endif
		if YER >= 3 then
			call DestroyEffect(LoadEffectHandle(HY, h,$A+ 3))
			call DestroyEffect(LoadEffectHandle(HY, h, 20 + 3))
		endif
		call UnitRemoveAbility(u,'C021')
		call UnitRemoveAbility(u,'D021')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set u = null
	endif
	set t = null
endfunction
function YXR takes unit u returns nothing
	local trigger t = LoadTriggerHandle(HY, GetHandleId(u),'A18X')
	local integer h
	local integer YER
	local integer as
	local integer ms
	if t == null then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .5, true)
		call TriggerAddCondition(t, Condition(function YVR))
		call SaveUnitHandle(HY, h, 0, u)
		call UnitAddPermanentAbility(u,'C021')
		call SaveTriggerHandle(HY, GetHandleId(u),'A18X', t)
	else
		set h = GetHandleId(t)
	endif
	call SaveReal(HY, h, 0, GetGameTime()+ 9)
	set YER = LoadInteger(HY, h, 0)
	if YER < 3 then
		call SaveInteger(HY, h, 0, YER + 1)
		set as = 20 +$A*(GetUnitAbilityLevel(u,'A18X'))
		set ms = 4 + 1 *(GetUnitAbilityLevel(u,'A18X'))
		call LodSystem_AddUnitExtraState(u, as, STATE_SYSTEM_ATTACK)
		call J6X(u, ms)
		call SaveInteger(HY, h, 1, LoadInteger(HY, h, 1)+ as)
		call SaveInteger(HY, h, 2, LoadInteger(HY, h, 2)+ ms)
		call SaveEffectHandle(HY, h,$A+ YER + 1, AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl", u, "head"))
		call SaveEffectHandle(HY, h, 20 + YER + 1, AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl", u, "chest"))
	endif
	set t = null
endfunction
function YOR takes nothing returns boolean
	if GetUnitAbilityLevel(GetTriggerUnit(),'A36D')== 0 and(X8R(GetSpellAbilityId()) or(Mode__BalanceOff and OER(GetSpellAbilityId()))) then
		call YXR(GetTriggerUnit())
	endif
	return false
endfunction
function M4E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function YOR))
	set t = null
endfunction
function KTE takes nothing returns nothing
	if IsMagicImmuneUnit(GetSpellTargetUnit()) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n0LR'))
	endif
endfunction
function YRR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	local unit u
	local group g = LoginGroup(211)
	local real GEX = 1.6
	local real CJR = 40 + 40 * level
	set U2 = WJE
	call GroupEnumUnitsInRange(g, LoadReal(HY, h, 10), LoadReal(HY, h, 11),$E1+ 20, Condition(function DJX))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call UnitDamageTargetEx(WJE, u, 1, CJR)
		if UnitAlive(u) then
			call CommonUnitAddStun(u, GEX, false)
		endif
		call GroupRemoveUnit(g, u)
	endloop
	call KillDestructablesInCircle(LoadReal(HY, h, 10), LoadReal(HY, h, 11),$E1)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set WJE = null
	set t = null
endfunction
function V2E takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .5, false, function YRR)
	call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
	call SaveReal(HY, h, 10, GetSpellTargetX())
	call SaveReal(HY, h, 11, GetSpellTargetY())
	set t = null
endfunction
function YIR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	local real ZCE = 0
	local integer level = LoadInteger(HY, h, 0)
	if level == 1 then
		set ZCE = 450
	elseif level == 2 then
		set ZCE = 650
	elseif level == 3 then
		set ZCE = 850
	endif
	call UnitDamageTargetEx(WJE, WLE, LoadInteger(HY, h, 1), ZCE)
	call DestroyTimerAndFlushHT_HY(t)
	set WJE = null
	set WLE = null
	set t = null
endfunction
function V5E takes nothing returns nothing
	local timer t
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		call TimerStart(t, .25, false, function YIR)
		call SaveUnitHandle(HY, GetHandleId(t), 0, GetTriggerUnit())
		call SaveUnitHandle(HY, GetHandleId(t), 1, GetSpellTargetUnit())
		call SaveInteger(HY, GetHandleId(t), 0, GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
		if GetSpellAbilityId()=='A01P'then
			call SaveInteger(HY, GetHandleId(t), 1, 1)
		else
			call SaveInteger(HY, GetHandleId(t), 1, 7)
		endif
	endif
	set t = null
endfunction
function V3E takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetUnitFacing(GetTriggerUnit()))
	call UnitAddAbility(d,'A3IJ')
	call SetUnitAbilityLevel(d,'A3IJ', GetUnitAbilityLevel(GetTriggerUnit(),'A01F'))
	if GetSpellTargetUnit()== GetTriggerUnit() then
		call B1R(d, "carrionswarm", GetUnitX(GetTriggerUnit())+ 1 * Cos(bj_DEGTORAD * GetUnitFacing(GetTriggerUnit())), GetUnitY(GetTriggerUnit())+ 1 * Sin(bj_DEGTORAD * GetUnitFacing(GetTriggerUnit())))
	else
		call B1R(d, "carrionswarm", GetSpellTargetX(), GetSpellTargetY())
	endif
	set d = null
endfunction
function YAR takes nothing returns nothing
	local integer ETX
	local integer WFV
	local unit u = GetFilterUnit()
	if IsUnitType(u, UNIT_TYPE_HERO) and IsUnitAlly(u, Temp__Player) and UnitAlive(u) then
		call GroupAddUnit(BK, u)
		if IsUnitInGroup(u, IK)== false then
			set WFV = GetHandleId(u)
			set ETX = StringHash("lunar_count")
			call WJV(u,'C032','D032',-1)
			call LodSystem_AddUnitExtraState(u, XK[1], STATE_SYSTEM_DAMAGE)
			call SaveInteger(P, WFV, ETX, LoadInteger(P, WFV, ETX)+ 1)
			set u = null
			return
		endif
		call GroupRemoveUnit(IK, u)
		if LoadBoolean(P, 99999, 99998) then
			call LodSystem_AddUnitExtraState(u, XK[1], STATE_SYSTEM_DAMAGE)
			call LodSystem_ReduceUnitExtraState(u, XK[0], STATE_SYSTEM_DAMAGE)
		endif
	endif
	set u = null
endfunction
function YNR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer ETX = StringHash("lunar_count")
	local integer WFV = GetHandleId(t)
	local unit u = LoadUnitHandle(P, WFV, 0)
	set IK = LoadGroupHandle(P, WFV, 1)
	set XK[0]= LoadInteger(P, WFV, 0)
	if UnitIsDead(u) then
		set u = FirstOfGroup(IK)
		if u != null then
			loop
				set WFV = GetHandleId(u)
				call SaveInteger(P, WFV, ETX, LoadInteger(P, WFV, ETX)-1)
				if LoadInteger(P, WFV, ETX)== 0 then
					call WHV(u,'D032')
				endif
				call LodSystem_ReduceUnitExtraState(u, XK[0], STATE_SYSTEM_DAMAGE)
				call GroupRemoveUnit(IK, u)
				set u = FirstOfGroup(IK)
			exitwhen u == null
			endloop
		endif
		set u = null
		set t = null
		return
	endif
	set XK[1]= GetUnitAbilityLevel(u,'A062')* 8 + 6
	set Temp__Player = GetOwningPlayer(u)
	if XK[0]!= XK[1]then
		call SaveBoolean(P, 99999, 99998, true)
		call SaveInteger(P, WFV, 0, XK[1])
	else
		call SaveBoolean(P, 99999, 99998, false)
	endif
	call GroupEnumUnitsInRange(AK, GetWidgetX(u), GetWidgetY(u), 925, Condition(function YAR))
	loop
		set u = FirstOfGroup(IK)
	exitwhen u == null
		set WFV = GetHandleId(u)
		call SaveInteger(P, WFV, ETX, LoadInteger(P, WFV, ETX)-1)
		if LoadInteger(P, WFV, ETX)== 0 then
			call WHV(u,'D032')
		endif
		call LodSystem_ReduceUnitExtraState(u, XK[0], STATE_SYSTEM_DAMAGE)
		call GroupRemoveUnit(IK, u)
	endloop
	loop
		set u = FirstOfGroup(BK)
	exitwhen u == null
		call GroupRemoveUnit(BK, u)
		call GroupAddUnit(IK, u)
	endloop
	set t = null
endfunction
function L6E takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local integer WFV = GetHandleId(t)
	call SaveBoolean(P, 99999, 99998, true)
	set IK = CreateGroup()
	set Temp__Player = GetOwningPlayer(u)
	set XK[0]= 0
	set XK[1]= GetUnitAbilityLevel(u,'A062')* 8 + 6
	call SaveUnitHandle(P, WFV, 0, u)
	call SaveGroupHandle(P, WFV, 1, IK)
	call SaveInteger(P, WFV, 0, XK[1])
	call GroupEnumUnitsInRange(AK, GetWidgetX(u), GetWidgetY(u), 925, Condition(function YAR))
	loop
		set u = FirstOfGroup(BK)
	exitwhen u == null
		call GroupRemoveUnit(BK, u)
		call GroupAddUnit(IK, u)
	endloop
	call SetPlayerTechResearched(Temp__Player,'R00I', 1)
	call TimerStart(t, .25, true, function YNR)
	set u = null
	set t = null
endfunction
function YBR takes nothing returns boolean
	local unit fu = GetFilterUnit()
	local real N5X = GetDistanceBetweenUnits(fu, AL)
	if fu != AL and IsUnitEnemy(fu, GetOwningPlayer(IL)) and UnitIsDead(fu)== false and C3X(fu)== false and N5X < CL and(GetUnitAbilityLevel(fu,'A04R')== 0) and GetUnitAbilityLevel(fu,'Avul')== 0 and UnitVisibleToPlayer(fu, GetOwningPlayer(IL)) and IsUnitInRangeXY(fu, GetUnitX(AL), GetUnitY(AL), 460) then
		set CL = N5X
		set NL = fu
	endif
	set fu = null
	return false
endfunction

function GetMoonGlaiveEnumUnit takes player sourcePlayer, unit targetUnit returns unit
	local group g
	local real minDistance = 9999
	local real tempDistance = 0.
	local unit firstUnit = null
	local unit enumUnit = null
	local real x = GetUnitX(targetUnit)
	local real y = GetUnitY(targetUnit)
	set g = LoginGroup(212)
	call GroupEnumUnitsInRange(g, x, y, 500 + MAX_UNIT_COLLISION, null)
	call GroupRemoveUnit(g, targetUnit)

	loop
		set firstUnit = FirstOfGroup(g)
		exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)

		// 敌对 存活 非建筑 非守卫 可见
		if IsUnitEnemy(firstUnit, sourcePlayer) and IsUnitInRangeXY(firstUnit, x, y, 500) and IsAliveNotStrucNotWard(firstUnit) and UnitVisibleToPlayer(firstUnit, sourcePlayer) then
			set tempDistance = GetDistanceBetweenUnits(targetUnit, firstUnit)

			if minDistance > tempDistance then
				set minDistance = tempDistance
				set enumUnit = firstUnit
			endif

		endif
		
	endloop

	call LogoutGroup(g)
	set firstUnit = null
	set g = null
	return enumUnit
endfunction

function MoonGlaiveLoopHitActions takes nothing returns nothing
	local missile m = GetHitMissile()
	local unit enumUnit = null
	local unit targetUnit = m.target
	local unit ownerUnit = m.owner
	local real damageValue = m.damageValue
	local integer level = m.level - 1
	if level > 0 then
		set enumUnit = GetMoonGlaiveEnumUnit(GetOwningPlayer(ownerUnit), targetUnit)
		if enumUnit != null then
			set m = m.create(ownerUnit, enumUnit, 800.)
			set m.missileFile = "Abilities\\Weapons\\SentinelMissile\\SentinelMissile.mdl"
			set m.damageValue = damageValue * 0.65
			set m.damageType = 12
			set m.usePlayerColor = true
			set m.startUnit = targetUnit
			set m.level = level
			set m.hitActions = "MoonGlaiveLoopHitActions"
			call m.LaunchMissile()
			set enumUnit = null
		endif
	endif
	set targetUnit = null
	set ownerUnit = null
endfunction

// 月刃弹射
function MoonGlaiveActions takes nothing returns nothing
	local trigger trig = null
	local integer h
	local real damage
	local unit enumUnit = GetMoonGlaiveEnumUnit(DESourcePlayer[DEI], DETargetUnit[DEI])
	local missile m
	if enumUnit != null then
		set m = m.create(DESourceUnit[DEI], enumUnit, 800.)
		set m.missileFile = "Abilities\\Weapons\\SentinelMissile\\SentinelMissile.mdl"
		set m.damageValue = DEDamageValue[DEI] * 0.65
		set m.damageType = 12
		set m.usePlayerColor = true
		set m.startUnit = DETargetUnit[DEI]
		set m.level = GetUnitAbilityLevel(DESourceUnit[DEI],'A041') + 1
		set m.hitActions = "MoonGlaiveLoopHitActions"
		call m.LaunchMissile()
		set enumUnit = null
	endif
endfunction

function YGR takes nothing returns nothing
	call SaveBoolean(P,'DARK', 0, false)
	call SuspendTimeOfDay(false)
	call SetFloatGameState(GAME_STATE_TIME_OF_DAY, LoadReal(P,'DARK', 1))
endfunction
function YHR takes real SYV, boolean b returns nothing
	local real YJR = GetGameTime()
	local real YKR = LoadReal(P,'DARK', 0)
	local real endTime
	local real YLR
	local real YMR
	set YLR = SYV / 20.
	if YJR + SYV > YKR then
		call TimerStart(ZC, SYV + .1, false, function YGR)
		call SaveReal(P,'DARK', 0, YJR + SYV)
		call SuspendTimeOfDay(true)
		if LoadBoolean(P,'DARK', 0)== false then
			set YJR = GetFloatGameState(GAME_STATE_TIME_OF_DAY)
			set YMR = YJR + YLR
			if YMR >= 24 then
				set YMR = YMR -24.
			endif
			call SaveReal(P,'DARK', 1, YMR)
		endif
		// debug call SingleDebug(R2S(YMR)+ " " + R2S(YLR))
		if b then
			call SetFloatGameState(GAME_STATE_TIME_OF_DAY, 0)
		endif
		call SaveBoolean(P,'DARK', 0, true)
	endif
endfunction
function YPR takes nothing returns boolean
	if DPX() and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) then
		if(LoadInteger(HY,(JKV),(GetHandleId(GetFilterUnit()))))< Q2 then
			return true
		endif
	endif
	return false
endfunction
function YQR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE =(LoadUnitHandle(HY, h, 14))
	local integer ZQE =(LoadInteger(HY, h,$D9))
	local integer WAR =(LoadInteger(HY, h,$D8))
	local integer YSR =(LoadInteger(HY, h,$DA))
	local group g = LoginGroup(214)
	local real x = GetUnitX(WJE)
	local real y = GetUnitY(WJE)
	local unit targetUnit
	local boolean b
	local unit YTR = LoadUnitHandle(HY, h, 0)
	if LoadBoolean(HY, h, 0) then
		set b = true
		set x = LoadReal(HY, h, 0)
		set y = LoadReal(HY, h, 1)
	else
		set b = UnitIsDead(WJE)== false
		set x = GetUnitX(WJE)
		set y = GetUnitY(WJE)
	endif
	set U2 = WJE
	set Q2 = YSR
	set JKV = GetHandleId(t)
	call GroupEnumUnitsInRange(g, x, y, 700, Condition(function YPR))
	set targetUnit = GroupPickRandomUnit(g)
	call LogoutGroup(g)
	if b and targetUnit != null and(GetUnitTypeId((targetUnit))!='u009') then
		call SaveInteger(HY,(JKV),(GetHandleId(targetUnit)),((LoadInteger(HY,(JKV),(GetHandleId(targetUnit))))+ 1))
		call AddSpecialEffectTargetToTimed("effects\\Eclipse.mdx", targetUnit, "origin", 3)
		call UnitDamageTargetEx(WJE, targetUnit, 1, 300)
	elseif b then
		set x = x + GetRandomInt(-350, 350)
		set y = y + GetRandomInt(-350, 350)
		call ABX("effects\\Eclipse.mdx", x, y, 1.5)
	endif
	if(GetTriggerEvalCount(t)+ 1)== WAR or b == false then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WJE = null
	set g = null
	set targetUnit = null
	return false
endfunction
function V8E takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer WXV
	local integer YUR = 4
	local integer Z6X
	if GetSpellAbilityId()=='A054' then
		set WXV = 2 + 3 * GetUnitAbilityLevel(WJE,'A054')
		call SaveUnitHandle(HY, h, 0, WJE)
		set Z6X = 5 + GetUnitAbilityLevel(WJE,'A054')
		call E1X("Abilities\\Spells\\NightElf\\Tranquility\\Tranquility.mdx", GetUnitX(WJE), GetUnitY(WJE), 2)
	else
		set WXV = 6 * GetUnitAbilityLevel(WJE,'A00U')
		set Z6X = 60
		call SaveUnitHandle(HY, h, 0, WJE)
		if GetSpellTargetUnit()== null or IsUnitEnemy(GetSpellTargetUnit(), GetOwningPlayer(WJE)) then
			call SaveBoolean(HY, h, 0, true)
			call SaveReal(HY, h, 0, GetSpellTargetX())
			call SaveReal(HY, h, 1, GetSpellTargetY())
			call UnitApplyTimedLife(CreateUnit(GetOwningPlayer(WJE),'o01P', GetSpellTargetX(), GetSpellTargetY(), 0),'BTLF', 7)
			call E1X("Abilities\\Spells\\NightElf\\Tranquility\\Tranquility.mdx", GetSpellTargetX(), GetSpellTargetY(), 2)
		else
			set WJE = GetSpellTargetUnit()
			call EYX("Units\\NightElf\\Owl\\Owl.mdl", WJE, "origin", 4)
			call E1X("Abilities\\Spells\\NightElf\\Tranquility\\Tranquility.mdx", GetUnitX(WJE), GetUnitY(WJE), 2)
		endif
	endif
	call SaveInteger(HY,(h),$D9,(YUR))
	call SaveInteger(HY,(h),$D8,(WXV))
	call SaveInteger(HY,(h),$DA,(Z6X))
	call SaveUnitHandle(HY,(h), 14,(WJE))
	call TriggerRegisterTimerEvent(t, .6, true)
	call TriggerAddCondition(t, Condition(function YQR))
	call TriggerEvaluate(t)
	call YHR(10., true)
	set t = null
	set WJE = null
endfunction
function V9E takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetUnitFacing(GetTriggerUnit()))
	call UnitAddAbility(d,'A3IE')
	call SetUnitAbilityLevel(d,'A3IE', GetUnitAbilityLevel(GetTriggerUnit(),'A042'))
	call IssueTargetOrderById(d,$D0107, GetSpellTargetUnit())
	set d = null
endfunction
function YWR takes nothing returns nothing
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl", GetEnumUnit(), "origin"))
endfunction
function YYR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	call UnitDamageTargetEx(triggerUnit, targetUnit, 1, LoadInteger(HY, h, 0)* 56.25)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set triggerUnit = null
	set targetUnit = null
	return false
endfunction
function YZR takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local group g// = LoginGroup(215)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local integer level = LoadInteger(HY, h, 0)
	if not UnitAlive(targetUnit) then
		set JMV = triggerUnit
		set g = LoginGroup(216)
		set U2 = triggerUnit
		call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), 450, Condition(function DGX))
		set targetUnit = GetNearestUnitByGroup(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit))
		call LogoutGroup(g)
		set g = null
	endif
	call DestroyEffect(LoadEffectHandle(HY, h, 32))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl", targetUnit, "origin"))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	call SaveUnitHandle(HY, h, 30, targetUnit)
	call SaveInteger(HY, h, 0, level)
	call TriggerRegisterTimerEvent(t, .5, false)
	call TriggerAddCondition(t, Condition(function YYR))
	set t = null
	set triggerUnit = null
	set targetUnit = null
	return false
endfunction
function Y_R takes nothing returns nothing
	call UnitDamageTargetEx(JMV, GetEnumUnit(), 1, JLV)
endfunction
function Y0R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local group g = LoadGroupHandle(HY, h, 22)
	set JLV = LoadInteger(HY, h, 0)* 75
	set JMV = triggerUnit
	call ForGroup(g, function Y_R)
	call LogoutGroup(g)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set triggerUnit = null
	set g = null
	return false
endfunction
function Y1R takes nothing returns nothing
	if GetDistanceBetweenUnits(U2, GetEnumUnit())<= 650 then
		call GroupAddUnit(DK, GetEnumUnit())
	endif
endfunction
function xingluo takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local group g = LoginGroup(217)
	local integer level = GetUnitAbilityLevel(u,'A0KV')+ GetUnitAbilityLevel(u,'A3UG')
	local unit targetUnit
	set U2 = u
	set JMV = u
	set DK = LoginGroup(218)
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 900, Condition(function DGX))
	call ForGroup(g, function Y1R)
	call LogoutGroup(g)
	set g = DK
	call ForGroup(g, function YWR)
	call SaveGroupHandle(HY, h, 22, g)
	call SaveUnitHandle(HY, h, 14, u)
	call SaveInteger(HY, h, 0, level)
	call TriggerRegisterTimerEvent(t, .5, false)
	call TriggerAddCondition(t, Condition(function Y0R))
	set JMV = u
	set g = LoginGroup(219)
	set U2 = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 450, Condition(function DGX))
	set targetUnit = GetNearestUnitByGroup(g, GetUnitX(u), GetUnitY(u))
	call LogoutGroup(g)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 14, u)
	call SaveUnitHandle(HY, h, 30,(targetUnit))
	call SaveInteger(HY, h, 0, level)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Starfall\\StarfallCaster.mdl", u, "origin"))
	call TriggerRegisterTimerEvent(t, 1, false)
	call TriggerAddCondition(t, Condition(function YZR))
	set t = null
	set g = null
	set u = null
	set targetUnit = null
endfunction
function EVE takes nothing returns nothing
	call xingluo(GetTriggerUnit())
endfunction
function XJCAX takes nothing returns nothing
	local integer h = GetHandleId(GetExpiredTimer())
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer c = LoadInteger(HY, h, 0)
	local integer level
	local group g
	if LoadBoolean(HY, h, 0) then
		call RemoveSavedBoolean(HY, h, 0)
		call TimerStart(GetExpiredTimer(), 1., true, function XJCAX)
	endif
	if c > 0 then
		set c = c -1
		call SaveInteger(HY, h, 0, c)
	endif
	if c == 0 and GetUnitAbilityLevel(u,'A3UF')> 0 and(GetUnitAbilityLevel(u,'A0KV')> 0 or GetUnitAbilityLevel(u,'A3UG')> 0) and(GetWidgetLife(u)> 0.405 and not IsUnitType(u, UNIT_TYPE_DEAD)) and GetUnitAbilityLevel(u,'A36D')== 0 then
		set g = LoginGroup(220)
		set U2 = u
		call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 650, Condition(function DGX))
		if FirstOfGroup(g)!= null and not DXX(u) then
			call xingluo(u)
			
			if GetUnitAbilityLevel(u, 'A39S') == 1 then
				call SaveInteger(HY, h, 0, R2I(12 * 0.75))
				call YDWESetUnitAbilityState(u,'A3UF', 1, 12.0 * 0.75)
			else
				call SaveInteger(HY, h, 0, 12)
				call YDWESetUnitAbilityState(u,'A3UF', 1, 12.0)
			endif

		endif
		call LogoutGroup(g)
	endif
	set u = null
endfunction
function XJVXX takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = U2
	local integer h = GetHandleId(t)
	call TimerStart(t, 0, false, function XJCAX)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveInteger(HY, h, 0, 0)
	call SaveBoolean(HY, h, 0, true)
	call SaveTimerHandle(HY, GetHandleId(u),'A3UF', t)
	set u = null
	set t = null
endfunction
function Y2R takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitAlly(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit()))))
endfunction
function Y3R takes nothing returns nothing
	call UnitRemoveAbility(GetEnumUnit(),'A37P')
	call UnitRemoveAbility(GetEnumUnit(),'A37Q')
	call UnitRemoveAbility(GetEnumUnit(),'A37R')
	call UnitRemoveAbility(GetEnumUnit(),'A3AF')
	call UnitRemoveAbility(GetEnumUnit(),'B3AF')
endfunction
function Y4R takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group g =(LoadGroupHandle(HY, h, 220))
	call ForGroup(g, function Y3R)
	call LogoutGroup(g)
	call DestroyTimerAndFlushHT_HY(t)
	set t = null
	set g = null
endfunction
// 月之暗面
function SpellEffect__MoonlightShadow takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	local timer t = CreateTimer()
	local integer Y6R = GetHandleId(t)
	local integer lv = GetUnitAbilityLevel(spellUnit,('A0KU'))
	local real dur = 15
	local string s
	local unit u = null
	local group g = null
	local boolean isSentinelsPlayer = IsSentinelsPlayer(GetOwningPlayer(spellUnit))
	local unit firstUnit = null
	local group enumGroup = LoginGroup(221)
	local integer i = 1
	local player tempPlayer

	// 原本是按范围寻找99999999 但按范围的实现是枚举范围内所有的单元格 对于这种情况效率会低很多
	// 遍历对应队伍的所有单位
	loop
		exitwhen i == 5
		if isSentinelsPlayer then
			// 如果是近卫施法...
			set tempPlayer = Sentinels[i]
	
		else
			// 如果是天灾施法...
			set tempPlayer = Scourges[i]
	
		endif
		call GroupEnumUnitsOfPlayer(enumGroup, tempPlayer, null)
		loop
			set firstUnit = FirstOfGroup(enumGroup)
			exitwhen firstUnit == null
			call GroupRemoveUnit(enumGroup, firstUnit)
			
			// 英雄单位
			if IsUnitType(firstUnit, UNIT_TYPE_HERO) and GetUnitAbilityLevel(firstUnit,'Aloc') <= 0 and UnitIsCanRegisterUnitEvent(firstUnit) and UnitAlive(firstUnit) then

				set s = ""
				call AddAbilityToTimed(u,'A37P'-1 + lv, 1, 15., 0)
				call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Invisibility\\InvisibilityTarget.mdl", u, "chest"))
				if IsPlayerAlly(GetOwningPlayer(u), LocalPlayer) or IsObserver then
					set s = "Moonlight_Shadow.mdx"
				endif
				call EYX(s, u, "overhead", 15.)
			endif
	
		endloop

		set i = i + 1
	endloop
	
	call GroupEnumUnitsInRange(g, 0, 0, 9999, Condition(function Y2R))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		
		call GroupRemoveUnit(g, u)
	endloop
	call SaveGroupHandle(HY,(Y6R), 220,(g))
	call TimerStart(t, dur, false, function Y4R)
	set t = null
	set g = null
	set u = null
	set spellUnit = null
endfunction
function Y8R takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitAlly(GetFilterUnit(), GetOwningPlayer(GW))))
endfunction
function Y9R takes nothing returns nothing
	local unit triggerUnit = GetEnumUnit()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'e01R', 0, 0, 0)
	call UnitAddPermanentAbility(dummyUnit,'A0LO')
	call SetUnitAbilityLevel(dummyUnit,'A0LO', TI)
	call UnitApplyTimedLife(dummyUnit,'BTLF', 10)
	set triggerUnit = null
	set dummyUnit = null
endfunction
function ZVR takes unit triggerUnit, integer level returns nothing
	local group g = LoginGroup(222)
	set GW = triggerUnit
	set TI = level
	call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), 800, Condition(function Y8R))
	call ForGroup(g, function Y9R)
	call LogoutGroup(g)
	set g = null
endfunction
function ZER takes unit triggerUnit returns nothing
	local integer h = GetHandleId(triggerUnit)
	local string ZXR = LoadStr(HY, h,$CE)
	local string ZOR = OrderId2String(LoadInteger(HY, h,$D3))
	local real W_E
	local real W0E
	local unit targetUnit
	local trigger t = LoadTriggerHandle(HY, h,$CC)
	local boolean ZRR = not(LoadBoolean(HY, h,$CF))
	local boolean ZIR = LoadBoolean(HY, h,$D0)
	call DisableTrigger(t)
	call IssueImmediateOrderById(triggerUnit,$D0004)
	if ZXR == "Target"and(ZRR or ZIR) then
		set targetUnit = LoadUnitHandle(HY, h,$D7)
		call IssueTargetOrder(triggerUnit, ZOR, targetUnit)
	elseif ZXR == "Point"and(ZRR or ZIR) then
		set W_E = LoadReal(HY, h,$D1)
		set W0E = LoadReal(HY, h,$D2)
		call IssuePointOrder(triggerUnit, ZOR, W_E, W0E)
	elseif(ZRR or ZIR) then
		call IssueImmediateOrder(triggerUnit, "OrderString")
	endif
	call SaveBoolean(HY, h,$D0, false)
	call EnableTrigger(t)
	set targetUnit = null
	set t = null
endfunction
function ZAR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local real ZNR = LoadReal(HY, h,$D4)
	local real ZBR = LoadReal(HY, h,$D5)
	local real a = LoadReal(HY, h, 13)
	local real NBX = GetUnitX(triggerUnit)+ 30 * Cos(a * bj_DEGTORAD)
	local real NCX = GetUnitY(triggerUnit)+ 30 * Sin(a * bj_DEGTORAD)
	local real ZCR =$C8
	local real ZDR =(1 -ZNR / ZBR)* ZCR * 2
	if ZDR > ZCR then
		set ZDR = ZCR * 2 -ZDR
	endif
	if O0X(triggerUnit)== false then
		call SetUnitFlyHeight(triggerUnit, GetUnitDefaultFlyHeight(triggerUnit)+ RMaxBJ(ZDR, 0), 0)
	endif
	if IsUnitType(triggerUnit, UNIT_TYPE_HERO) then
		call SaveBoolean(K, GetHandleId(triggerUnit), 99, true)
	endif
	call SetUnitX(triggerUnit, CoordinateX50(NBX))
	call SetUnitY(triggerUnit, CoordinateY50(NCX))
	call SetUnitFacing(triggerUnit, a)
	call SaveReal(HY, h,$D4,(ZNR -20)* 1.)
	if ZDR < 1 and ZNR -ZBR != 0 then
		call SaveBoolean(HY, GetHandleId(triggerUnit),$D6, false)
		call SetUnitFacing(triggerUnit, a)
		call SetUnitAnimation(triggerUnit, "stand")
		call SetUnitPathing(triggerUnit, true)
		//call ZER(triggerUnit) 也许想让单位恢复动作
		if O0X(triggerUnit)== false then
			call SetUnitFlyHeight(triggerUnit, GetUnitDefaultFlyHeight(triggerUnit), 0)
		endif
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	endif
	set t = null
	set triggerUnit = null
endfunction
function EXE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(triggerUnit,('A0LN'))
	local real GIX = 350 + 50 * level
	local real a = GetUnitFacing(triggerUnit)
	local real WYE = GetUnitX(triggerUnit)
	local real WZE = GetUnitY(triggerUnit)
	local real W_E = CoordinateX50(WYE + GIX * Cos(a * bj_DEGTORAD))
	local real W0E = CoordinateY50(WZE + GIX * Sin(a * bj_DEGTORAD))
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local trigger ZFR = LoadTriggerHandle(HY, GetHandleId(triggerUnit),$CC)
	set GIX = SquareRoot((WYE -W_E)*(WYE -W_E)+(WZE -W0E)*(WZE -W0E))
	call ShowUnit(triggerUnit, false)
	call ShowUnit(triggerUnit, true)
	if LocalPlayer== GetOwningPlayer(triggerUnit) then
		call ClearSelection()
		call SelectUnit(triggerUnit, true)
	endif
	if GIX > 100  then
		call UnitAddPermanentAbility(triggerUnit,'Amrf')
		call UnitRemoveAbility(triggerUnit,'Amrf')
		call SetUnitPathing(triggerUnit, false)
		call DisableTrigger(ZFR)
		call IssueImmediateOrderById(triggerUnit,$D0004)
		call EnableTrigger(ZFR)
		call SaveReal(HY, h,$D4, GIX * 1.)
		call SaveReal(HY, h,$D5, GIX * 1.)
		call SaveReal(HY, h, 13, a * 1.)
		call SaveUnitHandle(HY, h, 14, triggerUnit)
		call TimerStart(t, .025, true, function ZAR)
		call SaveBoolean(HY, GetHandleId(triggerUnit),$D6, true)
		call SaveBoolean(HY, GetHandleId(triggerUnit),$D0, false)
		call ZVR(triggerUnit, level)
	endif
	set triggerUnit = null
	set t = null
	set ZFR = null
endfunction
function ZGR takes nothing returns boolean
	return((IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GW)) and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and UnitIsDead(GetFilterUnit())== false and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false and GetUnitAbilityLevel(GetFilterUnit(),'Aloc')== 0))
endfunction
function ZHR takes integer ZJR returns real
	if ZJR <= 1 then
		return .01
	elseif ZJR == 2 then
		return .6
	elseif ZJR == 3 then
		return 1.1
	elseif ZJR == 4 then
		return 1.7
	elseif ZJR == 5 then
		return 2.2
	elseif ZJR == 6 then
		return 2.8
	elseif ZJR == 7 then
		return 3.3
	elseif ZJR == 8 then
		return 3.9
	elseif ZJR == 9 then
		return 4.4
	else
		return 5.
	endif
	return .0
endfunction
function ZKR takes unit u, unit WLE, integer GEX returns nothing
	local texttag tt = CreateTextTag()
	local string s = ""
	if GetHandleId(tt)< 1 then
		call DestroyTextTag(tt)
	else
		set s = R2SW(ZHR(GEX), 1, 1)
		call SetTextTagText(tt, s, .03)
		call SetTextTagPosUnit(tt, WLE, 0)
		call SetTextTagColorBJ(tt, 150, 75, 255, 15)
		call SetTextTagVelocity(tt, 0, .035)
		call SetTextTagFadepoint(tt, 3)
		call SetTextTagLifespan(tt, RMinBJ(1., GEX / 2))
		call SetTextTagPermanent(tt, false)
		call SetTextTagVisibility(tt, IsUnitAlly(u, LocalPlayer) or IsObserver)
	endif
	set tt = null
endfunction
function ZLR takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 14)
	local unit ZMR = LoadUnitHandle(HY, h, 45)
	local real ZPR = LoadReal(HY, h, 47)
	local real ZQR = LoadReal(HY, h, 48)
	local real radian = LoadReal(HY, h, 13)
	local real ZSR = GetUnitX(ZMR)
	local real ZTR = GetUnitY(ZMR)
	local real targetX = CoordinateX50(GetUnitX(ZMR)+ 30 * Cos(radian))
	local real targetY = CoordinateY50(GetUnitY(ZMR)+ 30 * Sin(radian))
	local group g = LoginGroup(223)
	local unit W_V
	local unit targetUnit
	local integer ZJR = 0
	local integer ZUR = 0
	local integer ZWR = 0
	local player p = GetOwningPlayer(WJE)
	call SetUnitX(ZMR, targetX)
	call SetUnitY(ZMR, targetY)
	set GW = WJE
	call GroupEnumUnitsInRange(g, targetX, targetY, 140, Condition(function ZGR))
	set targetUnit = FirstOfGroup(g)
	call LogoutGroup(g)
	if targetUnit != null then
		if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
			call SaveInteger(K, GetHandleId(p),'ARRH', LoadInteger(K, GetHandleId(p),'ARRH')+ 1)
			call JSX("AA_Hits" + I2S(GetPlayerId(GetOwningPlayer(WJE))), LoadInteger(K, GetHandleId(p),'ARRH'))
		endif
		set W_V = CreateUnit(GetOwningPlayer(targetUnit),'e00E', ZSR, ZTR, 0)
		set ZJR = IMinBJ(R2I(GetDistanceBetween(LoadReal(HY, h, 191), LoadReal(HY, h, 192), ZSR, ZTR)/$96), 10)
		if ZJR <= 1 then
			set ZUR ='A40Y'
			set ZWR = 1
		elseif ZJR < 4 then
			set ZUR ='A407'
			set ZWR = ZJR -1
		elseif ZJR < 7 then
			set ZUR ='A408'
			set ZWR = ZJR -3
		else
			set ZUR ='A409'
			set ZWR = ZJR -6
		endif
		call CommonUnitAddStun(targetUnit, ZHR(ZJR), false)
		call UnitDamageTargetEx(WJE, targetUnit, 1, 90 * LoadInteger(HY, h, 0)-40 + ZJR *$E)
		call ZKR(WJE, targetUnit, ZJR)
		call KillUnit(ZMR)
		call DestroyTimerAndFlushHT_HY(t)
	elseif(targetX -ZPR)*(targetX -ZPR)+(targetY -ZQR)*(targetY -ZQR)<$640 then
		call KillUnit(ZMR)
		call DestroyTimerAndFlushHT_HY(t)
	endif
	set t = null
	set WJE = null
	set ZMR = null
	set g = null
	set W_V = null
	set targetUnit = null
endfunction
function EOE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x1 = CoordinateX50(GetUnitX(u))
	local real y1 = CoordinateY50(GetUnitY(u))
	local real x2 = GetSpellTargetX()
	local real y2 = GetSpellTargetY()
	local real a = Atan2(y2 -y1, x2 -x1)
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local player p = GetOwningPlayer(u)
	local unit d = CreateUnit(p,'h005', x1, y1, a * bj_RADTODEG)
	call SaveInteger(K, GetHandleId(p),'ARRS', LoadInteger(K, GetHandleId(p),'ARRS')+ 1)
	call JSX("AA_Total" + I2S(GetPlayerId(p)), LoadInteger(K, GetHandleId(p),'ARRS'))
	call SetUnitFacing(d, a * bj_RADTODEG)
	set x2 = CoordinateX50(x1 +$BB8* Cos(a))
	set y2 = CoordinateY50(y1 +$BB8* Sin(a))
	call SaveReal(HY, h, 191, x1 * 1.)
	call SaveReal(HY, h, 192, y1 * 1.)
	call SaveReal(HY, h, 47, x2 * 1.)
	call SaveReal(HY, h, 48, y2 * 1.)
	call SaveReal(HY, h, 13, a * 1.)
	call SaveUnitHandle(HY, h, 14, u)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(u,'A0L8'))
	call SaveUnitHandle(HY, h, 45, d)
	call TimerStart(t, .035, true, function ZLR)
	set u = null
	set t = null
	set d = null
endfunction
function ZYR takes nothing returns boolean
	local unit ZZR = GetFilterUnit()
	if IsUnitInGroup(ZZR, LW) then
		set ZZR = null
		return false
	endif
	if IsUnitEnemy(ZZR, GetOwningPlayer(GW)) and GetUnitAbilityLevel(ZZR,'A04R')!= 1 and GetWidgetLife(ZZR)> 0 and IsUnitType(ZZR, UNIT_TYPE_STRUCTURE)== false then
		set ZZR = null
		return true
	endif
	set ZZR = null
	return false
endfunction
function Z_R takes nothing returns nothing
	call UnitDamageTargetEx(GW, GetEnumUnit(), 1, JW)
endfunction
function Z0R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local unit u =(LoadUnitHandle(HY, h,$DD))
	local real a =(LoadReal(HY, h, 13))
	local integer Y2X =(LoadInteger(HY, h,$C2))
	local group CNO =(LoadGroupHandle(HY, h,$85))
	local real GRR = GetUnitX(u)
	local real GIR = GetUnitY(u)
	local real GXR =(LoadReal(HY, h, 23))
	local real GOR =(LoadReal(HY, h, 24))
	local real NBX = GXR +1000* .05 * Cos(a)
	local real NCX = GOR +1000* .05 * Sin(a)
	local group g = LoginGroup(224)
	call SaveReal(HY, h, 23,((NBX)* 1.))
	call SaveReal(HY, h, 24,((NCX)* 1.))
	set GW = u
	set JW = LoadInteger(HY, h, 0)* 75 + 25
	set LW = CNO
	call GroupEnumUnitsInRange(g, GRR, GIR,$E1, Condition(function ZYR))
	call ForGroup(g, function Z_R)
	call GroupAddGroup(g, CNO)
	call LogoutGroup(g)
	set Y2X = Y2X -1
	call SaveInteger(HY, h,$C2,(Y2X))
	if IsUnitType(u, UNIT_TYPE_HERO) then
		call SaveBoolean(K, GetHandleId(u), 99, true)
	endif
	call SetUnitX(u, CoordinateX50(NBX))
	call SetUnitY(u, CoordinateY50(NCX))
	call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl", GRR, GIR))
	if Y2X == 0 then
		call SetUnitVertexColorEx(u,-1,-1,-1, 255)
		call SaveBoolean(HY,(GetHandleId(u)),$E1,(false))
		call SetUnitInvulnerable(u, false)
		call SetUnitPathing(u, true)
		call LogoutGroup(CNO)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set u = null
	set dummyUnit = null
	set CNO = null
	set g = null
	set t = null
	return false
endfunction
function EIE takes nothing returns nothing
	local unit K4X = GetTriggerUnit()
	local player p = GetOwningPlayer(K4X)
	local real WYE = GetUnitX(K4X)
	local real WZE = GetUnitY(K4X)
	local real W_E = GetSpellTargetX()
	local real W0E = GetSpellTargetY()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local group CNO = LoginGroup(225)
	local unit dummyUnit = CreateUnit(p,'e00E', 0, 0, 0)
	local integer WWV = GetPlayerId(p)
	call UnitAddAbility(dummyUnit,'A2N4')
	if GetSpellTargetUnit()!= null then
		set W_E = GetUnitX(GetSpellTargetUnit())
		set W0E = GetUnitY(GetSpellTargetUnit())
	endif
	call SetUnitVertexColorEx(K4X,-1,-1,-1, 0)
	call SaveBoolean(HY,(GetHandleId(K4X)),$E1,(true))
	call SetUnitInvulnerable(K4X, true)
	call SetUnitPathing(K4X, false)
	call SetUnitPathing(dummyUnit, false)
	call SaveUnitHandle(HY, h,$DD,(K4X))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveReal(HY, h, 23,((WYE)* 1.))
	call SaveReal(HY, h, 24,((WZE)* 1.))
	call SaveGroupHandle(HY, h,$85,(CNO))
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(K4X, GetSpellAbilityId()))
	call SaveInteger(HY, h, 1, GetSpellAbilityId())
	call SaveReal(HY, h, 13,((Atan2(W0E -WZE, W_E -WYE))* 1.))
	call SaveInteger(HY, h,$C2,(IMaxBJ(R2I(SquareRoot((W_E -WYE)*(W_E -WYE)+(W0E -WZE)*(W0E -WZE))/ 50), 1)))
	call TriggerRegisterTimerEvent(t, .04, true)
	call TriggerAddCondition(t, Condition(function Z0R))
	call ShowUnit(K4X, false)
	call ShowUnit(K4X, true)
	call SelectUnitAddForPlayer(K4X, GetOwningPlayer(K4X))
	set dummyUnit = null
	set K4X = null
	set CNO = null
	set t = null
endfunction
function Z1R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer EVX =(LoadInteger(HY, h, 34))-1
	local texttag tt
	call SaveInteger(HY, h, 34,(EVX))
	if GetTriggerEvalCount(t)== 1 then
		call RemoveSavedHandle(ExtraHT, h, SUMMONING_SOURCE_UNIT)
	endif
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set tt = CreateTextTag()
		call SetTextTagText(tt, I2S(EVX), .03)
		call SetTextTagPosUnit(tt, WUE, 0)
		call SetTextTagColorBJ(tt, 0, 29, 255, 15)
		call SetTextTagVelocity(tt, 0, .035)
		call SetTextTagFadepoint(tt, 3)
		call SetTextTagLifespan(tt, .9)
		call SetTextTagPermanent(tt, false)
		call SetTextTagVisibility(tt, GetOwningPlayer(WUE)== LocalPlayer)
		set tt = CreateTextTag()
		call SetTextTagText(tt, I2S(EVX), .03)
		call SetTextTagPosUnit(tt, targetUnit, 0)
		call SetTextTagColorBJ(tt, 0, 29, 255, 15)
		call SetTextTagVelocity(tt, 0, .035)
		call SetTextTagFadepoint(tt, 3)
		call SetTextTagLifespan(tt, .9)
		call SetTextTagPermanent(tt, false)
		call SetTextTagVisibility(tt, GetOwningPlayer(WUE)== LocalPlayer)
	endif
	set t = null
	set tt = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function Z2R takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local unit triggerUnit =(LoadUnitHandle(HY,(GetHandleId(t)), 14))
	local unit Z3R =(LoadUnitHandle(HY,(GetHandleId(triggerUnit)),$E5))
	call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl", GetUnitX(Z3R), GetUnitY(Z3R)))
	call RemoveUnit(Z3R)
	call UnitRemoveAbility(triggerUnit,('A0GC'))
	if Rubick_AbilityFilter(triggerUnit , 'A0G8') then
		call S9E(GetOwningPlayer(triggerUnit),('A0G8'), true)
	endif
	call FlushChildHashtable(HY,(GetHandleId(t)))
	call CleanCurrentTrigger((t))
	set triggerUnit = null
	set Z3R = null
	set t = null
endfunction
function Z4R takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit KKX = LoadUnitHandle(HY, h, 0)
	local unit Z5R = LoadUnitHandle(HY, h, 1)
	local real x = GetUnitX(Z5R)
	local real y = GetUnitY(Z5R)
	if UnitIsDead(KKX)== false and UnitIsDead(Z5R)== false then
		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl", x, y))
		call SetUnitPosition(Z5R, GetUnitX(KKX), GetUnitY(KKX))
		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl", GetUnitX(KKX), GetUnitY(KKX)))
		call SetUnitPosition(KKX, x, y)
		call PanCameraToTimedForPlayer(GetOwningPlayer(KKX), x, y, 0)
	endif
	call PauseTimer(t)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set KKX = null
	set Z5R = null
	set t = null
endfunction
function Z6R takes unit KKX, unit Z5R returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, 0, false, function Z4R)
	call SaveUnitHandle(HY, h, 0, KKX)
	call SaveUnitHandle(HY, h, 1, Z5R)
	set t = null
endfunction
function ENE takes nothing returns nothing
	call Z6R(GetTriggerUnit(), LoadUnitHandle(HY, GetHandleId(GetTriggerUnit()),$E5))
endfunction
function Z7R takes nothing returns boolean
	return GetUnitAbilityLevel(GetSummonedUnit(),('B030'))> 0 and GetWidgetLife(GetSummonedUnit())> 0
endfunction
function SpellEffect__Replicate takes nothing returns nothing
	local integer h
	local unit targetUnit = GetSpellTargetUnit()
	local unit illusionUnit
	local trigger t
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u, GetSpellAbilityId())
	local real dur = 15. + 15. * level
	local real dataB = 0.8
	local real dataC = 1.

	if GetUnitAbilityLevel(u,'Aloc')== 1 and HaveSavedHandle(HY, GetHandleId(u), 0) then
		set u = LoadUnitHandle(HY, GetHandleId(u), 0)
	endif
	set h = GetHandleId(u)
	call S9E(GetOwningPlayer(u),'A0G8', false)
	if GetUnitAbilityLevel(u,'A0G8')> 0 then
		call UnitAddPermanentAbility(u,'A0GC')
	endif

	set illusionUnit = SummonIllusion(targetUnit, u, dur, dataB, dataC, 0., null)
	call SetUnitColor(illusionUnit, GetPlayerColor(GetOwningPlayer(illusionUnit)))
	call SaveUnitHandle(HY, h, 229, illusionUnit)
	set t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, illusionUnit, EVENT_UNIT_DEATH)
	call TriggerAddAction(t, function Z2R)
	call SaveUnitHandle(HY, GetHandleId(t), 14, u)
	set t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, illusionUnit, EVENT_UNIT_DEATH)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function Z1R))
	call SaveUnitHandle(HY, GetHandleId(t), 2, u)
	call SaveUnitHandle(HY, GetHandleId(t), 17, illusionUnit)
	call SaveInteger(HY, GetHandleId(t), 34, GetUnitAbilityLevel(u,'A0G8')*$F+$F-1)
	set u = null
	set illusionUnit = null
	set targetUnit = null
	set t = null
	

endfunction
function Z9R takes unit triggerUnit, integer VVI, real VEI returns nothing
	local integer E5X = GetHeroAgi(triggerUnit, false)
	local integer E6X = GetHeroStr(triggerUnit, false)
	local real mp = GetUnitState(triggerUnit, UNIT_STATE_MANA)
	if VVI == 0 then
		if mp >= VEI and E5X -LoadInteger(K, GetHandleId(triggerUnit), 31)> 2 and UnitAlive(triggerUnit) and E5X > PC then
			call SetUnitState(triggerUnit, UNIT_STATE_MANA, mp -VEI)
			call SetHeroAgi(triggerUnit, E5X -2, true)
			call SetHeroStr(triggerUnit, E6X + 2, true)
		endif
	elseif VVI == 1 then
		if mp >= VEI and E6X -LoadInteger(K, GetHandleId(triggerUnit), 30)-LoadInteger(K, GetHandleId(triggerUnit),'ARML')> 4 and UnitAlive(triggerUnit) and E6X > PC then
			call SetUnitState(triggerUnit, UNIT_STATE_MANA, mp -VEI)
			call SetHeroAgi(triggerUnit, E5X + 2, true)
			call SetHeroStr(triggerUnit, E6X -2, true)
		endif
	endif
endfunction
function VXI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0KX')
	call Z9R(triggerUnit, 1, 30. / level)
	set t = null
	set triggerUnit = null
	return false
endfunction
function VOI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0KX')
	call Z9R(triggerUnit, 0, 30. / level)
	set t = null
	set triggerUnit = null
	return false
endfunction
function VRI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local trigger VII =(LoadTriggerHandle(HY, h,$E2))
	local integer level = GetUnitAbilityLevel(u,'A0KX')
	local integer lastorder =(LoadInteger(HY, h,$E3))
	local real VEI = 1. / level
	if VEI == .25 then
		set VEI = .2
	endif
	if GetIssuedOrderId()==$D0245 then
		if VII != null then
			call FlushChildHashtable(HY,(GetHandleId(VII)))
			call CleanCurrentTrigger(VII)
		endif
		set VII = CreateTrigger()
		call TriggerRegisterTimerEvent(VII, VEI, true)
		call TriggerAddCondition(VII, Condition(function VXI))
		call SaveUnitHandle(HY,(GetHandleId(VII)), 14,(u))
		call SaveTriggerHandle(HY, h,$E2,(VII))
		call SaveInteger(HY, h,$E3,(GetIssuedOrderId()))
		call UnitAddAbility(u,'A22L')
		call UnitRemoveAbility(u,'A22T')
	elseif GetIssuedOrderId()==$D0242 then
		if VII != null then
			call FlushChildHashtable(HY,(GetHandleId(VII)))
			call CleanCurrentTrigger(VII)
		endif
		set VII = CreateTrigger()
		call TriggerRegisterTimerEvent(VII, VEI, true)
		call TriggerAddCondition(VII, Condition(function VOI))
		call SaveUnitHandle(HY,(GetHandleId(VII)), 14,(u))
		call SaveTriggerHandle(HY, h,$E2,(VII))
		call SaveInteger(HY, h,$E3,(GetIssuedOrderId()))
		call UnitAddAbility(u,'A22T')
		call UnitRemoveAbility(u,'A22L')
	elseif GetIssuedOrderId()==$D0246 then
		if VII != null then
			call FlushChildHashtable(HY,(GetHandleId(VII)))
			call CleanCurrentTrigger(VII)
		endif
		call SaveTriggerHandle(HY, h,$E2,(null))
		call SaveInteger(HY, h,$E3,(GetIssuedOrderId()))
		call UnitRemoveAbility(u,'A22L')
		call UnitRemoveAbility(u,'A22T')
	elseif GetIssuedOrderId()==$D0243 then
		if VII != null then
			call FlushChildHashtable(HY,(GetHandleId(VII)))
			call CleanCurrentTrigger(VII)
		endif
		call SaveTriggerHandle(HY, h,$E2,(null))
		call SaveInteger(HY, h,$E3,(GetIssuedOrderId()))
		call UnitRemoveAbility(u,'A22L')
		call UnitRemoveAbility(u,'A22T')
	elseif GetIssuedOrderId()==$D0244 then
		if IssueImmediateOrderById(u,$D0245)== false then
			call IssueImmediateOrderById(u,$D0246)
		endif
	elseif GetIssuedOrderId()==$D0241 then
		if IssueImmediateOrderById(u,$D0242)== false then
			call IssueImmediateOrderById(u,$D0243)
		endif
	endif
	set t = null
	set u = null
	set VII = null
	return false
endfunction
function PUE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0KX')
	if level == 1 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call UnitAddPermanentAbility(triggerUnit,'A0KW')
		call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_ISSUED_ORDER)
		call TriggerAddCondition(t, Condition(function VRI))
		call SaveTriggerHandle(HY, h,$E2,(null))
		set t = null
	else
		call SetUnitAbilityLevel(triggerUnit,'A0KW', level)
	endif
	set triggerUnit = null
	set t = null
endfunction
function VAI takes nothing returns nothing
	local unit K4X =(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 326))
	local real r
	local real g
	local real b
	local integer VNI
	local integer VBI
	local real VCI
	local real BXE
	if GetUnitTypeId(K4X)!='O00P' then
		call DisableTrigger(GetTriggeringTrigger())
	elseif UnitIsDead(K4X)== false and(LoadBoolean(HY,(GetHandleId(K4X)),$E1))== false then
		set VNI = GetHeroAgi(K4X, true)
		set VBI = GetHeroStr(K4X, true)
		set VCI = RMaxBJ(75 + 2 *(VNI -VBI), 35)
		set r = VCI
		set g = VCI
		set b = VCI
		call SetUnitVertexColorBJ(K4X, r, g, b, GetRandomReal(.0, 10.))
	endif
	set K4X = null
endfunction
function VDI takes nothing returns boolean
	return not InHeroSelection and GetUnitTypeId(GetTriggerUnit())=='O00P' and IsUnitIllusion(GetTriggerUnit())== false
endfunction
function VFI takes nothing returns nothing
	local trigger t
	if((LoadBoolean(HY,(GetHandleId(GetTriggerUnit())), 327))== false) then
		set t = CreateTrigger()
		call SaveUnitHandle(HY,(GetHandleId(t)), 326,(GetTriggerUnit()))
		call SaveTriggerHandle(HY,(GetHandleId(GetTriggerUnit())), 328,(t))
		call TriggerAddAction(t, function VAI)
		call TriggerRegisterTimerEvent(t, 1., true)
		call SaveBoolean(HY,(GetHandleId(GetTriggerUnit())), 327,(true))
		set t = null
	endif
endfunction
// 水人转属性颜色
function MSX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	call TriggerAddCondition(t, Condition(function VDI))
	call TriggerAddAction(t, function VFI)
	set t = null
endfunction
function VGI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if GetEventDamageSource()== LoadUnitHandle(HY, h, 0) then
			call CommonUnitAddStun(GetTriggerUnit(), LoadReal(HY, h, 0), false)
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	endif
	set t = null
endfunction
function VHI takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(u,'A0G6')
	local integer VJI
	local integer VKI
	local real ZCE
	local unit d
	local integer ZJR
	local real radian
	local trigger t
	local integer h
	if GetUnitAbilityLevel(u,'Aloc')== 1 and HaveSavedHandle(HY, GetHandleId(u), 0) then
		set u = LoadUnitHandle(HY, GetHandleId(u), 0)
	endif
	if GetUnitAbilityLevel(u,'A04R')> 0 then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
	set VJI = GetHeroPrimaryAttributesType(u)
	if VJI == 2 then
		set VKI = GetHeroInt(u, true)
	elseif VJI == 3 then
		set VKI = GetHeroAgi(u, true)
	elseif VJI == 1 then
		set VKI = GetHeroStr(u, true)
	endif
	set ZCE = VKI *(1 + .25 * level)+ 40 + 20 * level
	set d = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddAbility(d,'A33K')
	call SetUnitAbilityLevel(d,'A33K', level)
	if IssueTargetOrderById(d, 852095, targetUnit) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 3.5, false)
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(t, Condition(function VGI))
		call SaveUnitHandle(HY, h, 0, d)
		call SaveReal(HY, h, 0, .8 + .2 * level)
		set t = null
	endif
	call CommonTextTag("|c001ce6b9+" + I2S(R2I(ZCE))+ "|r", 1, targetUnit, .023, 255, 255, 255,$D8)
	call UnitDamageTargetEx(u, targetUnit, 1, ZCE)
	set u = null
	set d = null
	set targetUnit = null
endfunction
function EBE takes nothing returns nothing
	if GetUnitTypeId(GetSpellTargetUnit())!='n00L' and not UnitHasSpellShield(GetSpellTargetUnit()) then
		call VHI()
	endif
endfunction
function VLI takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), JSV)== false then
		call GroupAddUnit(JTV, GetEnumUnit())
		call UnitRemoveAbility(GetEnumUnit(),'B02J')
		call UnitRemoveAbility(GetEnumUnit(),'BUsp')
		call UnitRemoveAbility(GetEnumUnit(),'Bust')
	endif
endfunction
function VMI takes nothing returns nothing
	call UnitRemoveAbility(GetEnumUnit(),'B02J')
	call UnitRemoveAbility(GetEnumUnit(),'BUsp')
	call UnitRemoveAbility(GetEnumUnit(),'Bust')
endfunction
function VPI takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), JQV)== false then
		call SetUnitOwner(JPV, GetOwningPlayer(GetEnumUnit()), false)
		if IssueTargetOrderById(JPV,$D0103, GetEnumUnit()) then
			call GroupAddUnit(JQV, GetEnumUnit())
		endif
	endif
endfunction
function VQI takes nothing returns nothing
	call SetWidgetLife(GetEnumUnit(), GetWidgetLife(GetEnumUnit())+ .08 * GetUnitState(GetEnumUnit(), UNIT_STATE_MAX_LIFE)* .05)
endfunction
function VSI takes nothing returns boolean
	return IsUnitAlly(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit())
endfunction
function VTI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local real x = GetUnitX(WUE)
	local real y = GetUnitY(WUE)
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local group g
	local group D7R =(LoadGroupHandle(HY, h, 187))
	if GetTriggerEvalCount(t)==$A then
		call UnitAddPermanentAbility(WUE,'A24E')
		call S9E(GetOwningPlayer(WUE),'A07U', false)
		call S9E(GetOwningPlayer(WUE),'A38E', false)
		call S9E(GetOwningPlayer(WUE),'A24E', true)
	endif
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or GetTriggerEvalCount(t)>$8C or(GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A24E') then
		if Rubick_AbilityFilter(WUE , 'A07U') or(LoadInteger(HY,(GetHandleId(WUE)), 704))=='A38E' then
			call S9E(GetOwningPlayer(WUE),'A07U', true)
			call S9E(GetOwningPlayer(WUE),'A38E', true)
		endif
		call S9E(GetOwningPlayer(WUE),'A24E', false)
		call ForGroup(D7R, function VMI)
		call LogoutGroup(D7R)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set g = LoginGroup(226)
		set U2 = WUE
		set JPV = dummyUnit
		set JQV = D7R
		call GroupEnumUnitsInRange(g, x, y,$4E2+ 25, Condition(function DCX))
		call ForGroup(g, function VPI)
		set JSV = g
		set JTV = LoginGroup(227)
		call ForGroup(D7R, function VLI)
		call GroupRemoveGroup(JTV, D7R)
		set U2 = WUE
		if GetUnitAbilityLevel(WUE,'A38E')> 0 then
			call GroupEnumUnitsInRange(g, x, y,$4FB, Condition(function VSI))
			call ForGroup(g, function VQI)
		endif
		call LogoutGroup(g)
		call LogoutGroup(JTV)
	endif
	set t = null
	set g = null
	set WUE = null
	set D7R = null
	set dummyUnit = null
	return false
endfunction
function ECE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local real x = GetUnitX(WUE)
	local real y = GetUnitY(WUE)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', x, y, 0)
	call UnitAddAbility(dummyUnit,'A07T')
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function VTI))
	call SaveGroupHandle(HY, h, 187,(LoginGroup(228)))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\SongOfTheSiren_2.mdx", WUE, "origin")))
	set t = null
	set WUE = null
	set dummyUnit = null
endfunction
function VUI takes unit WUE, unit targetUnit returns nothing
	local integer level = GetUnitAbilityLevel(WUE,'A2KU')
	call AddAbilityToTimed(targetUnit,'A240', level, 8, 0)
	call UnitDamageTargetEx(WUE, targetUnit, 1, 60 + 40 * level)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\CrushingWave\\CrushingWaveDamage.mdl", targetUnit, "chest"))
endfunction
function VWI takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), FL)== false then
		call GroupAddUnit(FL, GetEnumUnit())
		call VUI(DL, GetEnumUnit())
	endif
endfunction
function VYI takes nothing returns nothing
	local unit WUE = GetEnumUnit()
	local real x = GetUnitX(WUE)
	local real y = GetUnitY(WUE)
	local group g = LoginGroup(229)
	call DestroyEffect(AddSpecialEffect("war3mapImported\\RipTide09.mdx", x, y))
	set U2 = WUE
	call GroupEnumUnitsInRange(g, x, y, 350 + 25, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	call ForGroup(g, function VWI)
	call LogoutGroup(g)
	set g = null
	set WUE = null
endfunction
function VZI takes nothing returns boolean
	return IsUnitIllusion(GetFilterUnit()) and UnitIsDead(GetFilterUnit())== false
endfunction
function EDE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local real x = GetUnitX(WUE)
	local real y = GetUnitY(WUE)
	local group g = LoginGroup(230)
	set FL = LoginGroup(231)
	set DL = WUE
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(WUE), Condition(function VZI))
	call GroupAddUnit(g, WUE)
	call ForGroup(g, function VYI)
	call LogoutGroup(g)
	call LogoutGroup(FL)
	set WUE = null
	set g = null
endfunction
function V_I takes nothing returns boolean
	return IsUnitEnemy(ZK, GetOwningPlayer(GetFilterUnit())) and UnitIsDead(GetFilterUnit())== false and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0)
endfunction
function V0I takes nothing returns nothing
	local unit u = GetEnumUnit()
	local real IXX = 25 + 75 * VL
	if IsUnitType(u, UNIT_TYPE_STRUCTURE) then
		call UnitDamageTargetEx(ZK, u, 1, IXX * .5)
	else
		call UnitDamageTargetEx(ZK, u, 1, IXX)
	endif
	set u = null
endfunction
function V1I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local group g = LoginGroup(232)
	set ZK = WUE
	set VL = LoadInteger(HY, h, 0)
	call GroupEnumUnitsInRange(g, x, y, 425, Condition(function V_I))
	call ForGroup(g, function V0I)
	call LogoutGroup(g)
	call PauseTimer(t)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set WUE = null
	set t = null
endfunction
function W7V takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit dummyUnit
	local timer t
	local integer h
	set t = CreateTimer()
	set h = GetHandleId(t)
	set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', x, y, 0)
	call UnitAddAbility(dummyUnit,'AHbz')
	call IssuePointOrderById(dummyUnit,$D0079, x, y)
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveReal(HY, h, 6, x)
	call SaveReal(HY, h, 7, y)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	if GetUnitTypeId(WUE)!='e00E' then
		call TimerStart(t, .9, false, function V1I)
	else
		call TimerStart(t, .0, false, function V1I)
	endif
	set dummyUnit = null
	set WUE = null
	set t = null
endfunction
function V2I takes unit WUE, unit targetUnit, integer level returns nothing
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(WUE), GetUnitY(WUE), 0)
	call UnitAddAbility(dummyUnit,'A0BA')
	call SetUnitAbilityLevel(dummyUnit,'A0BA', level)
	call IssueTargetOrderById(dummyUnit,$D008A, targetUnit)
	set dummyUnit = null
endfunction
function V3I takes nothing returns boolean
	if IsUnitIllusion(GetFilterUnit()) and GetOwningPlayer(GetFilterUnit())== GetOwningPlayer(GetTriggerUnit()) then
		call V2I(GetFilterUnit(), JUV, GetUnitAbilityLevel(GetTriggerUnit(),'A24D'))
	endif
	return false
endfunction
function V4I takes nothing returns boolean
	if IsUnitIllusion(GetFilterUnit()) and GetOwningPlayer(GetFilterUnit())== GetOwningPlayer(GetTriggerUnit()) then
		call SetUnitFacing(GetFilterUnit(), S2)
		call SetUnitAnimation(GetFilterUnit(), "spell")
	endif
	return false
endfunction
function KUE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local group g = LoginGroup(233)
	set S2 = AngleBetweenXY(GetUnitX(triggerUnit), GetUnitY(triggerUnit), GetUnitX(JUV), GetUnitY(JUV))
	call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), 700, Condition(function V4I))
	call LogoutGroup(g)
	set triggerUnit = null
	set g = null
endfunction
function V5I takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local unit targetUnit = JUV
	local group g = LoginGroup(234)
	call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), 700, Condition(function V3I))
	call LogoutGroup(g)
	set triggerUnit = null
	set targetUnit = null
	set g = null
endfunction
function EFE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set JUV = GetSpellTargetUnit()
		call V2I(GetTriggerUnit(), JUV, GetUnitAbilityLevel(GetTriggerUnit(),'A24D'))
		call V5I()
	endif
endfunction
function DOE takes nothing returns nothing
	call SetUnitState(GetTriggerUnit(), UNIT_STATE_MANA, GetUnitState(GetTriggerUnit(), UNIT_STATE_MANA)* .4)
endfunction
function V6I takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if GetEventDamageSource()== LoadUnitHandle(HY, h, 1) then
			call CommonUnitAddStun(GetTriggerUnit(), 1.5, false)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
endfunction
function V7I takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit target = GetSpellTargetUnit()
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(target), GetUnitY(target), 0)
	local trigger t = null
	local integer h
	call UnitAddPermanentAbility(d,'A2KR')
	if IssueTargetOrderById(d, 852095, target) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 3, false)
		call TriggerRegisterUnitEvent(t, target, EVENT_UNIT_DAMAGED)
		call SaveUnitHandle(HY, h, 1, d)
		call TriggerAddCondition(t, Condition(function V6I))
	endif
	set u = null
	set target = null
	set d = null
endfunction
function HVX takes nothing returns nothing
	local unit WUE = U2
	call UnitAddPermanentAbility(WUE,'A2KQ')
	call S9E(GetOwningPlayer(WUE),'A2KQ', true)
	set WUE = null
endfunction
function HAX takes nothing returns nothing
	local unit WUE = U2
	call S9E(GetOwningPlayer(WUE),'A2KQ', false)
	set WUE = null
endfunction
function V8I takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if GetEventDamageSource()== LoadUnitHandle(HY, h, 0) then
			call CommonUnitAddStun(GetTriggerUnit(), 1.5, false)
			call UnitDamageTargetEx(LoadUnitHandle(HY, h, 1), GetTriggerUnit(), 1,$F+ 65 * LoadReal(HY, h, 0))
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	endif
	set t = null
endfunction
function V9I takes nothing returns nothing
	local trigger t
	local integer h
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local unit d = CreateUnit(GetOwningPlayer(WJE),'e00E', GetUnitX(WJE), GetUnitY(WJE), 0)
	call UnitAddAbility(d,'A42E')
	if IssueTargetOrderById(d, 852095, WLE) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 5, false)
		call TriggerRegisterUnitEvent(t, WLE, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(t, Condition(function V8I))
		call SaveUnitHandle(HY, h, 0, d)
		call SaveUnitHandle(HY, h, 1, WJE)
		call SaveReal(HY, h, 0, GetUnitAbilityLevel(WJE, GetSpellAbilityId())* 1.)
		set t = null
	endif
	set d = null
	set WJE = null
	set WLE = null
endfunction
function F9E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call V9I()
	endif
endfunction
function EVI takes unit u, integer ETX, real EEI, real EXI returns boolean
	return(Mode__BalanceOff and GetPrdRandom(u, ETX, EEI)) or(Mode__BalanceOff == false and GetPrdRandom(u, ETX, EXI))
endfunction
function EOI takes nothing returns boolean
	local integer id = LoadInteger(VV,'MULT', 0)
	return id =='A1HS'
endfunction

function GetGroupList takes nothing returns nothing
	local string s = null
	local integer i = 1
	set GourpListStr = null
	if UIFrame__DebugLog == 0 then
		return
	endif
	set GourpListStr = "AEI:" + I2S(AEI) + "\n"
	set GourpListStr = "DEI:" + I2S(DEI) + "\n"
	set GourpListStr = "ARI:" + I2S(ARI) + "\n"
	if GetTriggerPlayer() == LocalPlayer then
		loop
		exitwhen i == 140
			if J2[i] then
				set s = "单位组" + I2S(i) + "已使用Id:" + I2S(GroupsId[i]) + "\n"
			else
				set s = "单位组" + I2S(i) + "号 空闲\n"
			endif
			set GourpListStr = GourpListStr + s
			set i = i + 1
		endloop
		call DzFrameShow( UIFrame__DebugLog, true )
		call DzFrameSetText(DzFrameFindByName("DebugLogArea", 0), GourpListStr)
	endif
endfunction

function ERI takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer iPlayerId = GetPlayerId(p)
	local integer i = 1
	local integer abilityId
	loop
		set abilityId = HeroCommonSkills[PlayerSkillIndex[iPlayerId * HL + i]]
		if abilityId > 0 and not IsPassiveSkill[PlayerSkillIndex[iPlayerId * HL + i]] then
			call SaveInteger(VV,'MULT', 0, abilityId)
			// 能被多重施法
			if(X9R(iPlayerId, abilityId) and OXR(abilityId)) or EOI() then
				call DisplayTimedTextToPlayer(p, 0, 0, 15, "	|c00ff0303" + GetObjectName(abilityId)+ "|r " + UGV(abilityId)+ " 能被多重施法")
			endif
		endif
		set i = i + 1
	exitwhen i > 4 + ExtraAbilitiesNum  
	endloop
endfunction

function EII takes unit u, integer lv returns integer
	local integer i = GetPlayerId(GetOwningPlayer(u))
	call SaveInteger(K, i,'MC_T', LoadInteger(K, i,'MC_T')+ 1)
	if lv == 1 then
		if EVI(u,'A088', 25, 18) then
			call SaveInteger(K, i,'MC_2', LoadInteger(K, i,'MC_2')+ 1)
			return 2
		endif
	elseif lv == 2 then
		if EVI(u,'A088'+ 1, 20, 13) then
			call SaveInteger(K, i,'MC_3', LoadInteger(K, i,'MC_3')+ 1)
			return 3
		elseif EVI(u,'A088', 40, 29.5) then
			call SaveInteger(K, i,'MC_2', LoadInteger(K, i,'MC_2')+ 1)
			return 2
		endif
	elseif lv == 3 then
		if EVI(u,'A088'+ 2, 12.5, 5.5) then
			call SaveInteger(K, i,'MC_4', LoadInteger(K, i,'MC_4')+ 1)
			return 4
		elseif EVI(u,'A088'+ 1, 25, 14.5) then
			call SaveInteger(K, i,'MC_3', LoadInteger(K, i,'MC_3')+ 1)
			return 3
		elseif EVI(u,'A088', 50, 39.5) then
			call SaveInteger(K, i,'MC_2', LoadInteger(K, i,'MC_2')+ 1)
			return 2
		endif
	endif
	if JE then
		return 4
	endif
	return 0
endfunction
function EAI takes unit u returns integer
	//	local real r
	//	local boolean MDR = false
	//	local integer ENI = 0
	local integer id = GetPlayerId(GetOwningPlayer(u))
	//	local integer probability
	//	local integer ph = GetHandleId(GetOwningPlayer(u))
	if not(X9R(id, GetSpellAbilityId())) then
		return 0
	endif
	return EII(u, GetUnitAbilityLevel(u,'A088'))
endfunction
function EBI takes nothing returns nothing
	set Q2 = 0
	if GetUnitAbilityLevel(U2,'A088')== 0 or EOI()== false then
		return
	endif
	set Q2 = EII(U2, GetUnitAbilityLevel(U2,'A088'))
	if Q2 > 0 then
		if Q2 == 2 then
			call CommonTextTag(GetObjectName('n0K7'), 5, U2, .03, 255, 0, 0, 255)
		elseif Q2 == 3 then
			call CommonTextTag(GetObjectName('n0JT'), 5, U2, .03, 255, 0, 0, 255)
		elseif Q2 == 4 then
			call CommonTextTag(GetObjectName('n0K8'), 5, U2, .03, 255, 0, 0, 255)
		endif
	endif
endfunction
function ECI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	call IssueImmediateOrderById(u,$D0004)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set u = null
	set t = null
	return false
endfunction
function EDI takes nothing returns boolean
	return(IsUnitEnemy(Q5V, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()) and IsMagicImmuneUnit(GetFilterUnit())== false and GetUnitAbilityLevel(GetFilterUnit(),'B03J')== 0 and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(Q5V)))!= null
endfunction
function EFI takes nothing returns boolean
	return(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()) and IsMagicImmuneUnit(GetFilterUnit())== false and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and IsHeroUnitId(GetUnitTypeId(GetFilterUnit()))== false)!= null
endfunction
function EGI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit d = LoadUnitHandle(HY, h, 0)
	local unit u = LoadUnitHandle(HY, h, 1)
	if S3V(u)== false then
		call KillUnit(d)
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	endif
	set t = null
	set d = null
	set u = null
endfunction
function EHI takes unit d, unit u returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .1, true, function EGI)
	call SaveUnitHandle(HY, GetHandleId(t), 0, d)
	call SaveUnitHandle(HY, GetHandleId(t), 1, u)
	set t = null
endfunction


function ShockWaveActions takes nothing returns nothing
	local unit target = Wave_U
	local unit u = Player__Hero[GetPlayerId(GetOwningPlayer(Wave_Sou))]
	local integer lv = Wave_LV
	if not IsUnitType(target, UNIT_TYPE_MAGIC_IMMUNE) then
		call UnitDamageTargetEx(u, target, 1, 37.5 * lv)
		call AddAbilityToTimed(target,'A3Y9', 1, 2.,'a3Y9')
	endif
	set target = null
	set u = null
endfunction

function GushUpgraded_Actions takes nothing returns nothing
	local unit u = Wave_U
	local integer lv = Wave_LV
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl", u, "origin"))
	call AddAbilityToTimed(u,'A3JR', lv, 4, 0)
	call AddAbilityToTimed(u,'A3JS', 1, 4,'B3JS')
	set u = null
endfunction

function Group_Condition takes unit u returns boolean
	return IsUnitType(u, UNIT_TYPE_STRUCTURE)== false and UnitAlive(u) and GetUnitAbilityLevel(u,'A04R')== 0
endfunction

function Enum_Unit1 takes nothing returns boolean
	return Group_Condition(GetFilterUnit())
endfunction

function Enum_Unit2 takes nothing returns boolean
	return IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and Group_Condition(GetFilterUnit())
endfunction

function WavedamageUnit_Condition takes unit u, unit source, boolean b returns boolean
	return(b or IsUnitEnemy(source, GetOwningPlayer(u)) and(Group_Condition(u) ) )
endfunction

function WaveDamageEnumUnit takes unit u, unit du, integer dt, real damage, string s, integer lv, boolean b returns nothing
	if WavedamageUnit_Condition(du, u, b) then
		if(not b or IsUnitEnemy(u, GetOwningPlayer(du)) ) and GXX(u) then
			call UnitDamageTargetEx(u, du, dt, damage)
		endif
		if s != null then
			set Wave_U = du
			set Wave_Sou = u
			set Wave_LV = lv
			call ExecuteFunc(s)
		endif
	endif
endfunction

function WaveRunningActions takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local real damage = LoadReal(HY, h, 0)
	local real radian = LoadReal(HY, h, 3)* bj_DEGTORAD
	local real speed = LoadReal(HY, h, 4)
	local real area = LoadReal(HY, h, 8)
	local unit spu
	local unit du
	local group g
	local group gg
	local boolean b = LoadBoolean(HY, h, 10)
	local boolean funcend = false
	local integer dt = LoadInteger(HY, h, 1)
	local string funcstr = LoadStr(HY, h, 0)
	local integer lv = LoadInteger(HY, h, 5)
	local boolean time_event = GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED
	local boolean b2 = LoadBoolean(HY, h,'ally')
	local real x
	local real y
	local real inrange
	local real angle_between
	local real angle
	local real a
	if time_event then
		call SetUnitX(u, CoordinateX50(GetUnitX(u)+ speed * Cos(radian)))
		call SetUnitY(u, CoordinateY50(GetUnitY(u)+ speed * Sin(radian)))
		call SaveInteger(HY, h, 12, LoadInteger(HY, h, 12)+ 1)
		if LoadInteger(HY, h, 12)> LoadInteger(HY, h, 13) then
			set funcend = true
			call SetUnitX(u, LoadReal(HY, h, 5))
			call SetUnitY(u, LoadReal(HY, h, 6))
		endif
	else
		set du = GetTriggerUnit()
	endif
	if b then
		set g = LoadGroupHandle(HY, h, 2)
		set gg = LoginGroup(235)
		set U2 = u
		set x = GetUnitX(u)
		set y = GetUnitY(u)
		set inrange = area + LoadReal(HY, h, 9) *(GetTriggerEvalCount(t)-1) + 100
		if b2 then
			call GroupEnumUnitsInRange(gg, x, y, inrange, Condition(function Enum_Unit1))
		else
			call GroupEnumUnitsInRange(gg, x, y, inrange, Condition(function Enum_Unit2))
		endif
		call GroupRemoveGroup(g, gg)
		set spu = LoadUnitHandle(HY, h, 5)
		set inrange = inrange - 100
		loop
			set du = FirstOfGroup(gg)
		exitwhen du == null
			call GroupRemoveUnit(gg, du)
			if IsUnitInRangeXY(du, x, y, inrange) then
				if GetTriggerEvalCount(t)< 3 then
					set angle = LoadReal(HY, h, 3)
					set angle_between = AngleBetweenUnit(u, du)
					if(angle -angle_between <-180.00) then
						set a =(angle -angle_between + 360)
					else
						if(angle -angle_between > 180.00) then
							set a = angle -angle_between -360
						else
							set a = angle -angle_between
						endif
					endif
					set a = RAbsBJ(a)
					if a <= 120 then
						call GroupAddUnit(g, du)
						call WaveDamageEnumUnit(spu, du, dt, damage, funcstr, lv, b2)
					endif
				else
					call GroupAddUnit(g, du)
					call WaveDamageEnumUnit(spu, du, dt, damage, funcstr, lv, b2)
				endif
			endif
		endloop
		call LogoutGroup(gg)
		if funcend then
			call LogoutGroup(g)
		endif
	elseif not time_event then
		call WaveDamageEnumUnit(LoadUnitHandle(HY, h, 5), du, dt, damage, funcstr, lv, b2)
	endif
	if funcend then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(u)
	endif
	set du = null
	set u = null
	set t = null
	set g = null
	set gg = null
	set spu = null
endfunction

//如果参数area和range的值一样，为矩形冲击波，每次选取的范围一样.range＞area则像食腐蜂群。
function Wave takes unit u1, integer id, real damage, real max_distance, real area, real range, real ux, real uy, real spx, real spy, real missiespeed, integer dt, boolean b, string func, integer lv returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real angle = AngleBetweenXY(ux, uy, spx, spy)
	local unit u = CreateUnit(GetOwningPlayer(u1), id, ux, uy, angle)
	local real interval = 0.02
	local real speed = missiespeed * interval
	local integer max_evalcount = R2I(max_distance / speed)+ 1
	call SetUnitColor(u, PLAYER_COLOR_ORANGE)
	if LoadBoolean(VV,'wave','ally') then
		call RemoveSavedBoolean(VV,'wave','ally')
		call SaveBoolean(HY, h,'ally', true)
	endif
	call SaveUnitHandle(HY, h, 0, u)
	call SaveReal(HY, h, 0, damage)
	call SaveUnitHandle(HY, h, 5, u)
	call SaveReal(HY, h, 1, max_distance)
	call SaveReal(HY, h, 2, range)
	call SaveReal(HY, h, 3, angle)
	call SaveReal(HY, h, 4, speed)
	call SaveInteger(HY, h, 12, 0)
	call SaveInteger(HY, h, 13, max_evalcount)
	call TriggerRegisterTimerEvent(t, interval, true)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function WaveRunningActions))
	call SaveReal(HY, h, 8, area)
	call SaveReal(HY, h, 9,(range -area)/ I2R(max_evalcount))
	call SaveGroupHandle(HY, h, 2, LoginGroup(236))
	call SaveBoolean(HY, h, 10, true)
	call SetUnitX(u, CoordinateX50(ux + area / 2. * Cos(angle * bj_DEGTORAD)))
	call SetUnitY(u, CoordinateY50(uy + area / 2. * Sin(angle * bj_DEGTORAD)))
	call SaveReal(HY, h, 5, CoordinateX50(GetUnitX(u)+ max_distance * Cos(angle * bj_DEGTORAD)))
	call SaveReal(HY, h, 6, CoordinateY50(GetUnitY(u)+ max_distance * Sin(angle * bj_DEGTORAD)))
	call SaveInteger(HY, h, 1, dt)
	call SaveBoolean(HY, h, 0, b)
	if func != null then
		call SaveStr(HY, h, 0, func)
		call SaveInteger(HY, h, 5, lv)
	endif
	set IR = u
	set u = null
	set t = null
endfunction

function UAII takes real UNI, real UBI, real UCI, real F5OO, real HHXX, string P7EE, unit u, real tx, real ty, integer NMX returns nothing
	set IR = u
	call Wave(IR,'h070', F5OO, UNI, UBI, UCI, GetUnitX(u), GetUnitY(u), tx, ty, HHXX, 1, false, P7EE, NMX)
endfunction

function EJI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	local player p = GetOwningPlayer(u)
	local integer ELI =(LoadInteger(HY, h, 300))
	local integer lv =(LoadInteger(HY, h, 5))
	local integer id =(LoadInteger(HY, h, 299))
	local integer S6V =(LoadInteger(HY, h,'0ORD'))
	local integer i =(LoadInteger(HY, h,'ORDT'))
	local unit dummyUnit
	local unit EQI
	local real ux
	local real uy
	local real tx
	local real ty
	local real d
	local real a
	local boolean b
	local boolean ESI
	local trigger tt = null
	local real S7V
	local group g = null
	if GetTriggerEvalCount(t)> ELI then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set dummyUnit = CreateUnit(p,'e00E', GetWidgetX(u), GetWidgetY(u), 0)
		call SaveBoolean(HY, GetHandleId(dummyUnit),'REFL', true)
		call SaveUnitHandle(HY, GetHandleId(dummyUnit),'REFL', u)
		call SetUnitX(dummyUnit, GetWidgetX(u))
		call SetUnitY(dummyUnit, GetWidgetY(u))
		call SaveUnitHandle(P, GetHandleId(dummyUnit), 0, LoadUnitHandle(HY, h, 2))
		call TriggerRegisterUnitEvent(JJ, dummyUnit, EVENT_UNIT_SPELL_EFFECT)
		call RemoveSavedHandle(P, GetHandleId(dummyUnit), 0)
		if HaveSavedInteger(P, id, 0) then
			set id = LoadInteger(P, id, 0)
		endif
		call UnitAddPermanentAbility(dummyUnit, id)
		call SetUnitAbilityLevel(dummyUnit, id, lv)
		set ESI = LoadBoolean(P, GetHandleId(p), id)
		if ESI then
			call SetPlayerAbilityAvailable(p, id, true)
		endif
		if i == 1 then
			set EQI = LoadUnitHandle(HY, h, 17)
			if id !='A011' and id !='A180' then
				set ux = GetUnitX(EQI)
				set uy = GetUnitY(EQI)
				set tx = GetUnitX(u)
				set ty = GetUnitY(u)
				set d = LoadReal(HY, h,'000D')
				set a = Atan2(ty -uy, tx -ux)
				call UnitShareVision(EQI, p, true)
				loop
				exitwhen IssueTargetOrderById(dummyUnit, S6V, EQI) or d < 0
					call SetUnitX(dummyUnit, ux +(d * Cos(a)))
					call SetUnitY(dummyUnit, uy +(d * Sin(a)))
					set d = d -$A
				endloop
				if id =='A2QT' then
					set S7V = RMinBJ(GetGameTime()-LoadReal(HY, GetHandleId(u), 358)-(.3 * GetTriggerEvalCount(t)), 3)
					set tt = CreateTrigger()
					call TriggerRegisterTimerEvent(tt, S7V, false)
					call TriggerAddCondition(tt, Condition(function ECI))
					call SaveUnitHandle(HY, GetHandleId(tt), 0, dummyUnit)
					set tt = null
				endif
				call UnitShareVision(EQI, p, false)
			elseif id =='A011' then
				set g = LoginGroup(237)
				set Q5V = u
				call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u),$578, Condition(function EDI))
				call GroupRemoveUnit(g, EQI)
				if FirstOfGroup(g)!= null then
					set EQI = GroupPickRandomUnit(g)
				endif
				call IssueTargetOrderById(dummyUnit, S6V, EQI)
				call LogoutGroup(g)
				set g = null
			elseif id =='A180' then
				set g = LoginGroup(238)
				set U2 = u
				call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 900, Condition(function EFI))
				call GroupRemoveUnit(g, EQI)
				loop
					set EQI = FirstOfGroup(g)
					if EQI != null then
						call SetUnitX(dummyUnit, GetUnitX(EQI))
						call SetUnitY(dummyUnit, GetUnitY(EQI))
					endif
				exitwhen EQI == null or(LoadInteger(M, GetUnitTypeId(EQI), HC)<= 88 and IssueTargetOrderById(dummyUnit, S6V, EQI))
					call GroupRemoveUnit(g, EQI)
				endloop
				call LogoutGroup(g)
				set g = null
			endif
		elseif i == 2 then
			set EQI = LoadUnitHandle(HY, h, 17)
			set ux = LoadReal(HY, h,'0LOX')
			set uy = LoadReal(HY, h,'0LOY')
			set tx = GetUnitX(u)
			set ty = GetUnitY(u)
			set d = LoadReal(HY, h,'000D')
			set a = Atan2(ty -uy, tx -ux)
			if id =='A0JC'then
				call SaveUnitHandle(VV,'A3E9', 0, dummyUnit)
				call SaveInteger(VV,'A3E9', 0, lv)
				call SaveReal(VV,'A3E9', 0, ux)
				call SaveReal(VV,'A3E9', 1, uy)
				call ExecuteFunc("ETI")
			else
				loop
					set b = IssuePointOrderById(dummyUnit, S6V, ux, uy)
				exitwhen b or d < 0
					call SetUnitX(dummyUnit, ux +(d * Cos(a)))
					call SetUnitY(dummyUnit, uy +(d * Sin(a)))
					set d = d -$A
				endloop
			endif
			if id =='A3OH' then
				call Wave(dummyUnit,'h08O', 60 + 50 * lv, 1200, 240, 240, tx, ty, ux, uy, 1500, 1, false, "GushUpgraded_Actions", lv)
			endif
			if id =='A12K' then
				set S7V = RMinBJ((GetGameTime())-(LoadReal(HY,(GetHandleId(u)), 358))-(.3 * GetTriggerEvalCount(t)), 1.05)
				set tt = CreateTrigger()
				call TriggerRegisterTimerEvent(tt, S7V, false)
				call TriggerAddCondition(tt, Condition(function ECI))
				call SaveUnitHandle(HY, GetHandleId(tt), 0, dummyUnit)
				set tt = null
			endif
		elseif i == 3 then
			call TriggerRegisterUnitEvent(JJ, dummyUnit, EVENT_UNIT_SPELL_FINISH)
			call IssueImmediateOrderById(dummyUnit, S6V)
			if id =='A03R' or id =='A0AV'then
				call EHI(dummyUnit, u)
			endif
		endif
		if ESI then
			call SetPlayerAbilityAvailable(p, id, false)
		endif
	endif
	set t = null
	set u = null
	set dummyUnit = null
	set EQI = null
	set p = null
	return false
endfunction
function EUI takes integer r returns nothing
	local unit u = GetTriggerUnit()
	local integer id = GetSpellAbilityId()
	local integer lv = GetUnitAbilityLevel(u, id)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer uh = GetHandleId(u)
	local integer i = LoadInteger(HY, uh,'ORDT')
	local real cost
	if r == 2 then
		set cost = 0.5
		call CommonTextTag(GetObjectName('n0K7'), 5, GetTriggerUnit(), .03, 255, 0, 0, 255)
	elseif r == 3 then
		set cost = 0.75
		call CommonTextTag(GetObjectName('n0JT'), 5, GetTriggerUnit(), .03, 255, 0, 0, 255)
	elseif r == 4 then
		set cost = 1.00
		call CommonTextTag(GetObjectName('n0K8'), 5, GetTriggerUnit(), .03, 255, 0, 0, 255)
	elseif r == 5 then
		set cost = 2.00
		call CommonTextTag(GetObjectName('n0JO'), 5, GetTriggerUnit(), .03, 255, 0, 0, 255)
	endif
	if not Mode__RearmCombos then
		set cost = (YDWEGetUnitAbilityDataInteger(u, id, lv, 104))* cost
		call SetUnitState(u, UNIT_STATE_MANA, (GetUnitState(u, UNIT_STATE_MANA) - cost))
	endif
	set r = r -1
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveInteger(HY, h, 300,(r))
	call SaveInteger(HY, h, 5,(lv))
	call SaveInteger(HY, h, 299,(id))
	if i == 1 then
		call SaveInteger(HY, h,'0ORD', LoadInteger(HY, uh,'0ORD'))
		call SaveReal(HY, h,'000D', LoadReal(HY, uh,'000D'))
		call SaveUnitHandle(HY, h, 17,(GetSpellTargetUnit()))
	elseif i == 2 then
		call SaveInteger(HY, h,'0ORD', LoadInteger(HY, uh,'0ORD'))
		call SaveReal(HY, h,'000D', LoadReal(HY, uh,'000D'))
		call SaveReal(HY, h,'0LOX', GetSpellTargetX())
		call SaveReal(HY, h,'0LOY', GetSpellTargetY())
	elseif i == 3 then
		call SaveInteger(HY, h,'0ORD', LoadInteger(HY, uh,'0ORD'))
	endif
	call SaveInteger(HY, h,'ORDT', i)
	call TriggerRegisterTimerEvent(t, .3, true)
	call TriggerAddCondition(t, Condition(function EJI))
	set t = null
	set u = null
endfunction
function EYI takes nothing returns boolean
	local integer r
	local unit u
	local real ux
	local real uy
	local real tx
	local real ty
	if(GetUnitAbilityLevel(GetTriggerUnit(),'A088'))> 0 then
		set u = GetTriggerUnit()
		if GetTriggerEventId()== EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER then
			call SaveInteger(HY, GetHandleId(u),'0ORD', GetIssuedOrderId())
			call SaveInteger(HY, GetHandleId(u),'ORDT', 1)
			set u = null
			return false
		elseif GetTriggerEventId()== EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER then
			call SaveInteger(HY, GetHandleId(u),'0ORD', GetIssuedOrderId())
			call SaveInteger(HY, GetHandleId(u),'ORDT', 2)
			set u = null
			return false
		elseif GetTriggerEventId()== EVENT_PLAYER_UNIT_ISSUED_ORDER then
			call SaveInteger(HY, GetHandleId(u),'0ORD', GetIssuedOrderId())
			call SaveInteger(HY, GetHandleId(u),'ORDT', 3)
			set u = null
			return false
		endif
		if OXR(GetSpellAbilityId()) and GetUnitAbilityLevel(GetTriggerUnit(),'A04R')== 0 then
			if GetSpellTargetUnit()!= null and LoadInteger(HY, GetHandleId(u),'ORDT')== 1 then
				if not UnitHasSpellShield(GetSpellTargetUnit()) and IsPlayerEnemy(GetOwningPlayer(GetSpellTargetUnit()), GetOwningPlayer(u)) then
					set r = EAI(u)
					if r > 1 then
						set ux = GetUnitX(u)
						set uy = GetUnitY(u)
						set tx = GetUnitX(GetSpellTargetUnit())
						set ty = GetUnitY(GetSpellTargetUnit())
						call SaveReal(HY, GetHandleId(u),'000D', SquareRoot(((tx -ux)*(tx -ux))+((ty -uy)*(ty -uy))))
						call EUI(r)
					endif
				endif
			elseif GetSpellTargetLoc()!= null and LoadInteger(HY, GetHandleId(u),'ORDT')== 2 then
				set r = EAI(u)
				if r > 1 then
					set ux = GetUnitX(u)
					set uy = GetUnitY(u)
					set tx = GetSpellTargetX()
					set ty = GetSpellTargetY()
					call SaveReal(HY, GetHandleId(u),'000D', SquareRoot(((tx -ux)*(tx -ux))+((ty -uy)*(ty -uy))))
					call EUI(r)
				endif
			elseif LoadInteger(HY, GetHandleId(u),'ORDT')== 3 then
				set r = EAI(u)
				if r > 1 then
					call EUI(r)
				endif
			endif
		endif
	endif
	if GetSpellAbilityId()=='A2KQ' and not UnitHasSpellShield(GetSpellTargetUnit()) then
		call V7I()
	endif
	set u = null
	return false
endfunction
function MUX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function EYI))
	set t = null
endfunction

function SetAbilityCanNotMultiCast takes integer abilityId returns nothing
	call SaveBoolean(Q,'MCRS', abilityId, true)
endfunction

// 设置一些不能被多重施法的普通技能
function InitMultiCast takes nothing returns nothing
	//call SaveBoolean(Q,'MCRS','A44U', true)		//下注
	call SetAbilityCanNotMultiCast('A1TU')
	call SetAbilityCanNotMultiCast('A33U')
	call SetAbilityCanNotMultiCast('A456')
	call SetAbilityCanNotMultiCast('A44X')
	call SetAbilityCanNotMultiCast('A1MG')
	call SetAbilityCanNotMultiCast('A19O')
	call SetAbilityCanNotMultiCast('A1MV')
	call SetAbilityCanNotMultiCast('A0DL')
	call SetAbilityCanNotMultiCast('A0WP')
	call SetAbilityCanNotMultiCast('A43D')
	call SetAbilityCanNotMultiCast('A0MQ')
	call SetAbilityCanNotMultiCast('A1B6')
	call SetAbilityCanNotMultiCast('A1TA')
	call SetAbilityCanNotMultiCast('A1T8')
	call SetAbilityCanNotMultiCast('A28Q')
	call SetAbilityCanNotMultiCast('A1TB')
	call SetAbilityCanNotMultiCast('A3FQ')
	call SetAbilityCanNotMultiCast('QB0K')
	call SetAbilityCanNotMultiCast('ANcr')
	call SetAbilityCanNotMultiCast('A0Z4')
	call SetAbilityCanNotMultiCast('A0Z5')
	call SetAbilityCanNotMultiCast('A1NI')
	call SetAbilityCanNotMultiCast('QM00')
	call SetAbilityCanNotMultiCast('A1YY')
	call SetAbilityCanNotMultiCast('A1RK')
	call SetAbilityCanNotMultiCast('A43H')
	call SetAbilityCanNotMultiCast('A1S7')
	call SetAbilityCanNotMultiCast('A1YQ')
	call SetAbilityCanNotMultiCast('A3DE')
	call SetAbilityCanNotMultiCast('A2JR')
	call SetAbilityCanNotMultiCast('A2JL')
	call SetAbilityCanNotMultiCast('A2JO')
	call SetAbilityCanNotMultiCast('A2JQ')
	call SetAbilityCanNotMultiCast('A2JP')
	call SetAbilityCanNotMultiCast('A2E5')
	call SetAbilityCanNotMultiCast('A43S')
	call SetAbilityCanNotMultiCast('A43Q')
	call SetAbilityCanNotMultiCast('A43S')
	call SetAbilityCanNotMultiCast('A43Q')
	call SetAbilityCanNotMultiCast('QB08')
	call SetAbilityCanNotMultiCast('AEbl')
	
	
	call SetAbilityCanNotMultiCast('Z607')
	call SetAbilityCanNotMultiCast('A01Z')
	call SetAbilityCanNotMultiCast('A01V')	//森林之眼
	call SetAbilityCanNotMultiCast('A05G')	//剑刃风暴
	call SetAbilityCanNotMultiCast('A0T2')	//狂暴
	
	call SetAbilityCanNotMultiCast('A05G')
	call SetAbilityCanNotMultiCast('A0M1')
	call SetAbilityCanNotMultiCast('A1AX')
	call SetAbilityCanNotMultiCast('A0A5')
	call SetAbilityCanNotMultiCast('A1EG')
	call SetAbilityCanNotMultiCast('A0AG')
	call SetAbilityCanNotMultiCast('A0KX')
	call SetAbilityCanNotMultiCast('A0G8')
	call SetAbilityCanNotMultiCast('A0KW')
	call SetAbilityCanNotMultiCast('A063')
	call SetAbilityCanNotMultiCast('A07U')
	call SetAbilityCanNotMultiCast('A38E')
	call SetAbilityCanNotMultiCast('QB0B')
	call SetAbilityCanNotMultiCast('A0D7')
	call SetAbilityCanNotMultiCast('A0LN')
	call SetAbilityCanNotMultiCast('A0KU')
	call SetAbilityCanNotMultiCast('A0BE')
	call SetAbilityCanNotMultiCast('A1EJ')
	call SetAbilityCanNotMultiCast('A229')
	call SetAbilityCanNotMultiCast('QB03')
	call SetAbilityCanNotMultiCast('A1EA')
	call SetAbilityCanNotMultiCast('A0RV')
	call SetAbilityCanNotMultiCast('QB0P')
	call SetAbilityCanNotMultiCast('A1N4')
	call SetAbilityCanNotMultiCast('A0LC')
	call SetAbilityCanNotMultiCast('A443')
	call SetAbilityCanNotMultiCast('A0IN')
	call SetAbilityCanNotMultiCast('A1AW')
	call SetAbilityCanNotMultiCast('QB09')
	call SetAbilityCanNotMultiCast('A07A')
	call SetAbilityCanNotMultiCast('QB0L')
	call SetAbilityCanNotMultiCast('A2H0')
	call SetAbilityCanNotMultiCast('A2HS')
	call SetAbilityCanNotMultiCast('A01B')
	call SetAbilityCanNotMultiCast('QM01')
	call SetAbilityCanNotMultiCast('A01O')
	call SetAbilityCanNotMultiCast('A0SB')
	call SetAbilityCanNotMultiCast('A28T')
	call SetAbilityCanNotMultiCast('A361')
	call SetAbilityCanNotMultiCast('A14O')
	call SetAbilityCanNotMultiCast('A3FJ')
	call SetAbilityCanNotMultiCast('A085')
	call SetAbilityCanNotMultiCast('A14I')
	call SetAbilityCanNotMultiCast('A12P')
	call SetAbilityCanNotMultiCast('A1D6')
	call SetAbilityCanNotMultiCast('A1SW')
	call SetAbilityCanNotMultiCast('A06B')
	call SetAbilityCanNotMultiCast('A471')
	call SetAbilityCanNotMultiCast('A065')
	call SetAbilityCanNotMultiCast('A00P')
	call SetAbilityCanNotMultiCast('A27F')
	call SetAbilityCanNotMultiCast('A27H')
	call SetAbilityCanNotMultiCast('A30J')
	call SetAbilityCanNotMultiCast('A0I6')
	call SetAbilityCanNotMultiCast('A0RW')
	call SetAbilityCanNotMultiCast('A03O')
	call SetAbilityCanNotMultiCast('A10R')
	call SetAbilityCanNotMultiCast('A1OP')
	call SetAbilityCanNotMultiCast('QP1W')
	call SetAbilityCanNotMultiCast('A194')
	call SetAbilityCanNotMultiCast('A0SW')
	call SetAbilityCanNotMultiCast('A0NS')
	call SetAbilityCanNotMultiCast('A1DA')
	call SetAbilityCanNotMultiCast('QM02')
	call SetAbilityCanNotMultiCast('A0R0')
	call SetAbilityCanNotMultiCast('A06K')
	call SetAbilityCanNotMultiCast('A0FL')
	call SetAbilityCanNotMultiCast('A1CX')
	call SetAbilityCanNotMultiCast('DRKN')
	call SetAbilityCanNotMultiCast('DRKU')
	call SetAbilityCanNotMultiCast('A05C')
	call SetAbilityCanNotMultiCast('QM03')
	call SetAbilityCanNotMultiCast('A1RD')
	call SetAbilityCanNotMultiCast('A1P8')
	call SetAbilityCanNotMultiCast('A0H0')
	call SetAbilityCanNotMultiCast('A030')
	call SetAbilityCanNotMultiCast('QB0A')
	call SetAbilityCanNotMultiCast('A025')
	call SetAbilityCanNotMultiCast('A04Q')
	call SetAbilityCanNotMultiCast('Z234')
	call SetAbilityCanNotMultiCast('A0WQ')
	call SetAbilityCanNotMultiCast('A0PL')
	call SetAbilityCanNotMultiCast('A09U')
	call SetAbilityCanNotMultiCast('A2KO')
	call SetAbilityCanNotMultiCast('QB01')
	call SetAbilityCanNotMultiCast('A0CA')
	call SetAbilityCanNotMultiCast('A0CT')
	call SetAbilityCanNotMultiCast('A3DM')
	call SetAbilityCanNotMultiCast('A1RI')
	call SetAbilityCanNotMultiCast('A07Q')
	call SetAbilityCanNotMultiCast('A0H9')
	call SetAbilityCanNotMultiCast('A1IN')
	call SetAbilityCanNotMultiCast('A0LK')
	call SetAbilityCanNotMultiCast('A1C0')
	call SetAbilityCanNotMultiCast('A418')
	call SetAbilityCanNotMultiCast('A0MP')
	call SetAbilityCanNotMultiCast('A04Y')
	call SetAbilityCanNotMultiCast('A04N')
	call SetAbilityCanNotMultiCast('A02N')
	call SetAbilityCanNotMultiCast('A0CC')
	call SetAbilityCanNotMultiCast('A02Z')
	call SetAbilityCanNotMultiCast('A0OJ')
	call SetAbilityCanNotMultiCast('A0ME')
	call SetAbilityCanNotMultiCast('A1S8')
	call SetAbilityCanNotMultiCast('Z605')
	call SetAbilityCanNotMultiCast('A1HS')
endfunction
function E_I takes nothing returns boolean
	local unit f = GetFilterUnit()
	local unit u = GetTriggerUnit()
	if IsUnitAlly(f, GetOwningPlayer(u)) and UnitIsDead(f)== false and(IsUnitType(f, UNIT_TYPE_HERO) or((GetOwningPlayer(f)== Sentinels[0]or GetOwningPlayer(f)== Scourges[0])) or(GetOwningPlayer(f)== GetOwningPlayer(u) and R_X(f)== false)) then
		set f = null
		set u = null
		return true
	endif
	set f = null
	set u = null
	return false
endfunction
function E0I takes group gg returns unit
	local unit u
	local group g = LoginGroup(239)
	set U2 = null
	set W2 = null
	call GroupAddGroup(gg, g)
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if IsUnitType(u, UNIT_TYPE_HERO) then
			if U2 == null then
				set U2 = u
			else
				if GetRandomInt(0, 1)== 1 then
					set U2 = u
				endif
			endif
		else
			if W2 == null then
				set W2 = u
			else
				if GetRandomInt(0, 1)== 1 then
					set W2 = u
				endif
			endif
		endif
		call GroupRemoveUnit(g, u)
	endloop
	call LogoutGroup(g)
	set u = null
	set g = null
	if U2 != null then
		return U2
	endif
	return W2
endfunction
function E1I takes integer r returns nothing
	local unit u = GetTriggerUnit()
	local integer level = r
	local group g = LoginGroup(240)
	local group gg = LoginGroup(241)
	local unit d
	local unit t
	local integer id = GetSpellAbilityId()
	local integer k = 1
	local boolean b = false
	if r == 2 then
		call CommonTextTag(GetObjectName('n0K7'), 5, u, .03, 255, 0, 0, 255)
	elseif r == 3 then
		call CommonTextTag(GetObjectName('n0JT'), 5, u, .03, 255, 0, 0, 255)
	elseif r == 4 then
		call CommonTextTag(GetObjectName('n0K8'), 5, u, .03, 255, 0, 0, 255)
	elseif r == 5 then
		call CommonTextTag(GetObjectName('n0JO'), 5, u, .03, 255, 0, 0, 255)
	endif
	set r = r -1
	set U2 = u
	call GroupEnumUnitsInRange(gg, GetUnitX(u), GetUnitY(u), 600, Condition(function E_I))
	if u != GetSpellTargetUnit() then
		call GroupAddUnit(gg, u)
	endif
	if HaveSavedInteger(P, id, 0) then
		set id = LoadInteger(P, id, 0)
	endif
	call GroupAddGroup(gg, g)
	loop
	exitwhen b
		loop
		exitwhen k > level or b
			if id =='A08N' or id =='A2QM' then
				set t = GetSpellTargetUnit()
			else
				set t = E0I(gg)
			endif
			if id =='AEfn' then
				set id = 'A333'
			endif
			set b = t == null
			if b == false then
				set d = CreateUnit(GetOwningPlayer(u),'e00C', GetUnitX(u), GetUnitY(u), 270)
				call TriggerRegisterUnitEvent(JJ, d, EVENT_UNIT_SPELL_EFFECT)
				call UnitAddPermanentAbility(d, id)
				call SetUnitAbilityLevel(d, id, GetUnitAbilityLevel(u, id))
				call UnitApplyTimedLife(d,'BTLF', 1.)
				call IssueTargetOrderById(d, LoadInteger(HY, GetHandleId(u),'0ORD'), t)
				call SetUnitPathing(d, false)
				call UnitAddPermanentAbility(d,'Aloc')
				call GroupRemoveUnit(gg, t)
				set k = k + 1
			endif
		endloop
		if b and level > k then
			set b = false
			call GroupAddGroup(g, gg)
		endif
	endloop
	call LogoutGroup(gg)
	call LogoutGroup(g)
	set d = null
	set gg = null
	set t = null
	set u = null
	set g = null
endfunction
function E2I takes nothing returns boolean
	local integer r
	if(GetUnitAbilityLevel(GetTriggerUnit(),'A088'))> 0 then
		if GetTriggerEventId()== EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER then
			call SaveInteger(HY, GetHandleId(GetTriggerUnit()),'0ORD'+ 1, GetIssuedOrderId())
		elseif GetTriggerEventId()== EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER then
			call SaveInteger(HY, GetHandleId(GetTriggerUnit()),'0ORD'+ 1, 0)
		elseif GetTriggerEventId()== EVENT_PLAYER_UNIT_ISSUED_ORDER then
			call SaveInteger(HY, GetHandleId(GetTriggerUnit()),'0ORD'+ 1, 0)
		endif
		if GetTriggerEventId()== EVENT_PLAYER_UNIT_SPELL_EFFECT and(LoadInteger(HY, GetHandleId(GetTriggerUnit()),'0ORD'+ 1)!= 0) then
			if OXR(GetSpellAbilityId()) and(GetSpellTargetUnit()!= null) and(GetSpellAbilityId()!= null) and GetUnitAbilityLevel(GetTriggerUnit(),'A04R')== 0 then
				if IsPlayerAlly(GetOwningPlayer(GetSpellTargetUnit()), GetOwningPlayer(GetTriggerUnit())) then
					set r = EAI(GetTriggerUnit())
					if r > 1 then
						call E1I(r)
					endif
				endif
			endif
		endif
	endif
	return false
endfunction
function MWX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function E2I))
	set t = null
endfunction
function PGE takes nothing returns nothing
	call UnitAddPermanentAbility(GetTriggerUnit(),'A083')
	call SetUnitAbilityLevel(GetTriggerUnit(),'A083', GetUnitAbilityLevel(GetTriggerUnit(),'A40B'))
endfunction
function E3I takes nothing returns boolean
	return(IsAliveNotStrucNotWard(GetFilterUnit()) and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(U2)))!= null
endfunction
function CLE takes nothing returns nothing
	call UnitDamageTargetEx(GetTriggerUnit(), GetEnumUnit(), 3, JW)
endfunction
function EGE takes nothing returns nothing
	local group g = LoginGroup(242)
	local unit u = GetSpellTargetUnit()
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local unit u2
	set JW = 90 * GetUnitAbilityLevel(GetTriggerUnit(),('A08N'))
	if GetWidgetLife(u)> 1 and OYX(u)== false then
		call SetWidgetLife(u, GetWidgetLife(u)+ JW)
	endif
	set u = GetTriggerUnit()
	set U2 = u
	call GroupEnumUnitsInRange(g, x, y, 260 + 25, Condition(function E3I))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call UnitDamageTargetEx(u, u2, 3, JW)
		call GroupRemoveUnit(g, u2)
	endloop
	call LogoutGroup(g)
	set u = null
	set u2 = null
	set g = null
endfunction
function F7E takes nothing returns nothing
	call SkillImmunityDispel(GetSpellTargetUnit())
	call RemoveUnitBuff(GetSpellTargetUnit(), false)
endfunction
function E4I takes nothing returns boolean
	return IsUnitAlly(GetFilterUnit(), GetOwningPlayer(U2)) and GetUnitAbilityLevel(GetFilterUnit(),'B00G')> 0 and GetDistanceBetweenUnits(GetFilterUnit(), U2)> 2000
endfunction
function E5I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit WJE = LoadUnitHandle(HY, GetHandleId(t), 0)
	local group g
	local unit u
	set g = LoginGroup(243)
	set U2 = WJE
	call GroupEnumUnitsInRange(g, 0, 0, 12000, Condition(function E4I))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call UnitRemoveAbility(u,'B00G')
		call GroupRemoveUnit(g, u)
	endloop
	call LogoutGroup(g)
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTimer(t)
	set u = null
	set WJE = null
	set t = null
endfunction
function VPE takes nothing returns nothing
	local timer t
	if ZLE(GetTriggerUnit()) then
		set t = CreateTimer()
		call TimerStart(t, 0, false, function E5I)
		call SaveUnitHandle(HY, GetHandleId(t), 0, GetTriggerUnit())
	endif
	set t = null
endfunction


function E9I takes unit WUE, player p, unit targetUnit, integer level, boolean XVI returns nothing
	local unit dummyUnit
	if XVI then
		set dummyUnit = CreateUnit(p,'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitAddAbility(dummyUnit,'A10C')
		call SetUnitAbilityLevel(dummyUnit,'A10C', level)
		call IssueTargetOrderById(dummyUnit,$D00DD, targetUnit)
		call UnitDamageTargetEx(dummyUnit, targetUnit, 1, 50 + 50 * level)
		//call E7I(p, targetUnit, level)
		set dummyUnit = null
		if GetUnitAbilityLevel(targetUnit,'A3E9')== 1 and IsMagicImmuneUnit(WUE)== false and HaveSavedHandle(HY, GetHandleId(WUE), 0)== false then
			call SaveUnitHandle(VV,'A3E9', 0, targetUnit)
			call SaveUnitHandle(VV,'A3E9', 1, WUE)
			call SaveInteger(VV,'A3E9', 0, level)
			call ExecuteFunc("XEI")
		endif
	endif
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\IllidanMissile\\IllidanMissile.mdl", targetUnit, "origin"))
endfunction



function SpiritLanceHitActions takes nothing returns boolean
	local missile m = GetHitMissile()
	local unit sourceUnit = m.owner
	local unit targetUnit = m.target
	local unit dummyUnit 
	local unit illusionUnit
	local integer level = m.level
	local real dataB = 0.2
	local real dataC = 4.
	local real dur = level * 2

	// 残废减速
	set dummyUnit = CreateUnit(GetOwningPlayer(sourceUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddAbility(dummyUnit,'A10C')
	call SetUnitAbilityLevel(dummyUnit,'A10C', level)
	call IssueTargetOrderById(dummyUnit,$D00DD, targetUnit)
	set dummyUnit = null
	
	set illusionUnit = SummonIllusion(sourceUnit, sourceUnit, dur, dataB, dataC, 0., null)
	call SetUnitX(illusionUnit, GetUnitX(targetUnit))
	call SetUnitY(illusionUnit, GetUnitY(targetUnit))
	call IssueTargetOrderById(illusionUnit, 851983, targetUnit)

	set sourceUnit = null
	set targetUnit = null
	set illusionUnit = null
	return false
endfunction

// h06L
function LaunchSpiritLance takes unit soucreUnit, integer level, unit targetUnit, boolean haveHitTrig returns nothing
	local missile m 
	set m = m.create(soucreUnit, targetUnit, 1000.)
	set m.hitFile = "Abilities\\Weapons\\IllidanMissile\\IllidanMissile.mdl"
	set m.missileFile = "war3mapImported\\Gaussgun.mdx"
	set m.level = level
	set m.startUnit = soucreUnit
	
	if haveHitTrig then
		set m.damageValue = 50 + 50 * level
		set m.damageType = 1
		set m.canCountered = true
		set m.hitActions = "SpiritLanceHitActions"
	endif
	call m.LaunchMissile()
endfunction
function XRI takes nothing returns boolean
	if IsUnitIllusion(GetFilterUnit()) and IsPlayerHasSkill(GetOwningPlayer(GetFilterUnit()), 83) and GetOwningPlayer(GetFilterUnit())== GetOwningPlayer(GetTriggerUnit()) then
		call LaunchSpiritLance(GetFilterUnit(), 3, GetSpellTargetUnit(), false)
	endif
	return false
endfunction
function EHE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(triggerUnit,'A10D')
	local group g = LoginGroup(244)
	call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), 700, Condition(function XRI))
	call LogoutGroup(g)
	call LaunchSpiritLance(triggerUnit, level, targetUnit, not UnitHasSpellShield(GetSpellTargetUnit()))
	set triggerUnit = null
	set targetUnit = null
endfunction
function XEI takes nothing returns nothing
	call T4V(LoadUnitHandle(VV,'A3E9', 0))
	call LaunchSpiritLance(LoadUnitHandle(VV,'A3E9', 0), LoadInteger(VV,'A3E9', 0), LoadUnitHandle(VV,'A3E9', 1), UnitHasSpellShield(LoadUnitHandle(VV,'A3E9', 1))== false)
	call FlushChildHashtable(VV,'A3E9')
endfunction
function XII takes nothing returns boolean
	if IsUnitIllusion(GetFilterUnit()) and IsPlayerHasSkill(GetOwningPlayer(GetFilterUnit()), 83) and GetOwningPlayer(GetFilterUnit())== GetOwningPlayer(GetTriggerUnit()) then
		call SetUnitFacing(GetFilterUnit(), S2)
		call SetUnitAnimation(GetFilterUnit(), "spell")
	endif
	return false
endfunction
function KWE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local group g = LoginGroup(245)
	set S2 = AngleBetweenXY(GetUnitX(triggerUnit), GetUnitY(triggerUnit), GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit()))
	call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), 700, Condition(function XII))
	call LogoutGroup(g)
	set triggerUnit = null
	set g = null
endfunction
function MZX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A10C')
endfunction

function JuxtaposeIllusionUnitDeath takes nothing returns boolean
	local unit illusionUnit = GetTriggerUnit()
	local unit masterUnit
	local integer h
	local integer count

	if IsUnitIllusion(illusionUnit) then
		set masterUnit = GetSummonSourceUnit(illusionUnit)
		//call BJDebugMsg("触发死亡" + I2S(GetHandleId(masterUnit)) + GetUnitName(masterUnit) )
		if LoadBoolean(ExtraHT, GetHandleId(illusionUnit), 'P083') then
			set h = GetHandleId(masterUnit)
			set count = LoadInteger(ExtraHT, h, 'P083')
			if count > 0 then
				call SaveInteger(ExtraHT, h, 'P083', count - 1)
				//call BJDebugMsg("count"+ I2S(count - 1))
			endif

			set masterUnit = null
		endif
	endif

	set illusionUnit = null
	return false
endfunction

function JuxtaposeDEActions takes nothing returns nothing
	local integer level = GetUnitAbilityLevel(DESourceUnit[DEI],'P083')
	local integer maxCount = 3 + 2 * level
	local integer probability = 35 + 5 * level
	local integer count
	local unit illusionUnit = null
	local integer h
	if DESourceIsIllusion[DEI] then
		set h = GetHandleId(GetSummonSourceUnit(DESourceUnit[DEI]))
		set count = LoadInteger(ExtraHT, h, 'P083')
	else
		set count = LoadInteger(ExtraHT, DESourceId[DEI], 'P083')
	endif
	// A0DD

	if count < maxCount then

		if not DESourceIsIllusion[DEI] and GetPrdRandom(DESourceUnit[DEI], 'P083', probability) then
			set illusionUnit = SummonIllusion(DESourceUnit[DEI], DESourceUnit[DEI], 8., 0.22, 4., 200., "Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl")
			call SaveBoolean(ExtraHT, GetHandleId(illusionUnit), 'P083', true)
			call SaveInteger(ExtraHT, DESourceId[DEI], 'P083', count + 1)
			//call BJDebugMsg("count"+ I2S(count + 1))
		endif
		if DESourceIsIllusion[DEI] and GetRandomInt(1, 100) <= 8 then
			set illusionUnit = SummonIllusion(DESourceUnit[DEI], DESourceUnit[DEI], 4., 0.22, 4., 200., "Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl")
			call SaveBoolean(ExtraHT, GetHandleId(illusionUnit), 'P083', true)
			call SaveInteger(ExtraHT, h, 'P083', count + 1)
			//call BJDebugMsg("count"+ I2S(count + 1))
		endif

	endif

endfunction

// 并列
function JuxtaposeDEFilter takes nothing returns nothing
	if(GetUnitAbilityLevel(DESourceUnit[DEI],'P083')> 0) and not DESourceIsBreak[DEI] then
		call JuxtaposeDEActions()
	endif
endfunction

function EKE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call UnitAddPermanentAbility(dummyUnit,'A0DC')
	call IssueTargetOrderById(dummyUnit, 852274, u)
	set u = null
	set dummyUnit = null
endfunction
function XDI takes unit u, integer hu, trigger t returns nothing
	local integer h = GetHandleId(t)
	if GetUnitAbilityLevel(u,'A46D')> 0 and LoadBoolean(HY, h, 5) then
		call SetUnitImitateMoveSpeed(u, 0, 0)
		call SetUnitPathing(u, true)
	endif
	call UnitRemoveAbility(u,'A46F')
	call UnitRemoveAbility(u,'B46F')
	if GetHandleId(u)> 0 then
		call RemoveSavedHandle(HY, GetHandleId(u),'A46E')
	else
		call RemoveSavedHandle(HY, LoadInteger(HY, h, 0),'A46E')
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
endfunction
function XFI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer hu = LoadInteger(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	local real distance
	local real XGI = LoadReal(HY, h, 0)
	local boolean ESI = false
	local real x
	local real y
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		if GetTriggerUnit()== u then
			call XDI(u, hu, t)
		else
			if GetUnitCurrentOrder(u)!= 851986 then
				call DisableTrigger(t)
				call IssuePointOrderById(u, 851986, LoadReal(HY, h, 10), LoadReal(HY, h, 11))
				call EnableTrigger(t)
			endif
		endif
	elseif GetTriggerEventId()== EVENT_UNIT_ATTACKED then
		if GetAttacker()== u then
			call XDI(u, hu, t)
		endif
	elseif GetTriggerEventId()== EVENT_UNIT_ISSUED_ORDER or GetTriggerEventId()== EVENT_UNIT_ISSUED_TARGET_ORDER or GetTriggerEventId()== EVENT_UNIT_ISSUED_POINT_ORDER then
		if GetIssuedOrderId()!=$D000F and not(GetIssuedOrderId()==851971 and GetOrderTargetUnit()!= null and IsUnitEnemy(GetOrderTargetUnit(), GetOwningPlayer(u))) then
			call XDI(u, hu, t)
		endif
	else
		if C6X(u) or(LoadBoolean(HY, h, 5) and GetUnitAbilityLevel(u,'A46F')== 0) then
			call XDI(u, hu, t)
		else
			set distance = GetDistanceBetweenUnits(u, WLE)
			if LoadBoolean(HY, h, 5) and(distance > XGI +$96 or UnitVisibleToPlayer(WLE, GetOwningPlayer(u))== false or RFX(WLE)) then
				if GetUnitCurrentOrder(u)!= 851986 then
					if LoadBoolean(HY, h, 0) then
						call XDI(u, hu, t)
					else
						call DisableTrigger(t)
						call SaveBoolean(HY, h, 0, true)
						call IssuePointOrderById(u, 851986, LoadReal(HY, h, 10), LoadReal(HY, h, 11))
						call EnableTrigger(t)
					endif
				elseif GetDistanceBetween(GetUnitX(u), GetUnitY(u), LoadReal(HY, h, 10), LoadReal(HY, h, 11))<= 120 then
					call XDI(u, hu, t)
				endif
			elseif LoadBoolean(HY, h, 5)== false then
				if LoadBoolean(HY, h, 0)== false and GetUnitAbilityLevel(u,'A46F')== 0 and distance <= XGI and GetUnitAbilityLevel(u,'A46D')> 0 then
					call UnitAddPermanentAbility(u,'A46F')
					call SetUnitImitateMoveSpeed(u, 999, 800)
					if GetUnitAbilityLevel(u,'A46D')> 0 then
						call SaveReal(HY, GetHandleId(u),'A46E', GetGameTime())
					endif
					call SetUnitPathing(u, false)
					call SaveBoolean(HY, h, 5, true)
				endif
			elseif GetDistanceBetween(GetUnitX(u), GetUnitY(u), LoadReal(HY, h, 10), LoadReal(HY, h, 11))<= 100  then
				call XDI(u, hu, t)
			else
				call SaveReal(HY, h, 10, GetUnitX(WLE))
				call SaveReal(HY, h, 11, GetUnitY(WLE))
				call SaveBoolean(HY, h, 0, false)
			endif
		endif
	endif
	set t = null
	return false
endfunction
function XHI takes nothing returns nothing
	local trigger t
	local integer h
	local unit u = GetTriggerUnit()
	local integer hu = GetHandleId(u)
	local integer level = GetUnitAbilityLevel(u,'A46D')
	local unit WLE = GetOrderTargetUnit()
	local real distance = GetDistanceBetweenUnits(u, WLE)
	local real XGI = 500 + 100 * level
	local unit XJI
	if distance > 300 and LoadReal(HY, hu,'A46E')+ 20 -4 * level < GetGameTime() then
		if HaveSavedHandle(HY, hu,'A46E') then
			set t = LoadTriggerHandle(HY, hu,'A46E')
			set h = GetHandleId(t)
			set XJI = LoadUnitHandle(HY, h, 1)
			if XJI != WLE then
				call XDI(u, hu, t)
			endif
		else
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call SaveTriggerHandle(HY, hu,'A46E', t)
			call SaveUnitHandle(HY, h, 0, u)
			call SaveInteger(HY, h, 0, hu)
			call SaveUnitHandle(HY, h, 1, WLE)
			call TriggerRegisterTimerEvent(t, .02, true)
			call TriggerRegisterTimerEvent(t, 0, false)
			call TriggerRegisterUnitEvent(t, WLE, EVENT_UNIT_ATTACKED)
			call TriggerRegisterDeathEvent(t, WLE)
			call TriggerRegisterDeathEvent(t, u)
			call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_ORDER)
			call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_POINT_ORDER)
			call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_TARGET_ORDER)
			call TriggerAddCondition(t, Condition(function XFI))
		endif
		call SaveReal(HY, h, 0, XGI)
		call SaveReal(HY, h, 10, GetUnitX(WLE))
		call SaveReal(HY, h, 11, GetUnitY(WLE))
	endif
	set u = null
	set WLE = null
	set t = null
endfunction
// 幻影冲锋 右键
function XKI takes nothing returns boolean
	if GetOrderTargetUnit()!= null and IsUnitEnemy(GetOrderTargetUnit(), GetOwningPlayer(GetTriggerUnit())) and(GetIssuedOrderId()==$D000F or GetIssuedOrderId()==851971) then
		if GetUnitAbilityLevel(GetTriggerUnit(),'A46D')> 0 and GetUnitAbilityLevel(GetTriggerUnit(),'A36D')== 0 then
			call XHI()
		endif
	endif
	return false
endfunction
// 幻影冲锋
function XLI takes nothing returns boolean
	local unit u
	if IsUnitIllusion(GetTriggerUnit()) then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]
		if GetUnitAbilityLevel(u,'A46E')> 0 and GetUnitTypeId(GetTriggerUnit())== GetUnitTypeId(u) then
			call UnitAddPermanentAbility(GetTriggerUnit(),'A46D')
			call SetUnitAbilityLevel(GetTriggerUnit(),'A46D', GetUnitAbilityLevel(u,'A46E'))
		endif
	endif
	set u = null
	return false
endfunction
function POE takes nothing returns boolean
	call UnitAddPermanentAbility(GetTriggerUnit(),'A46D')
	call SetUnitAbilityLevel(GetTriggerUnit(),'A46D', GetUnitAbilityLevel(GetTriggerUnit(),'A46E'))
	call SetHeroAgi(GetTriggerUnit(), GetHeroAgi(GetTriggerUnit(), false)+ 5, true)
	return false
endfunction

function DoppelgangerMoveLoop takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u
	local unit u2
	local integer i = 1
	local real angle
	local real XQI = 325
	local real x = LoadReal(HY, h, 10)
	local real y = LoadReal(HY, h, 11)
	local real targetX
	local real targetY
	local real radian
	local real distance
	local integer c = LoadInteger(HY, h, 0)+ 1
	local real N3X
	local group g
	local boolean isillusion = false
	// 运动到期, 开始显示幻象
	if c == 50 then
		call ClearSelectionForPlayer(GetOwningPlayer(LoadUnitHandle(HY, h, 0)))
		set g = LoginGroup(247)
		loop
		exitwhen HaveSavedHandle(HY, h, i)== false
			set u = LoadUnitHandle(HY, h, i)
			call ShowUnit(u, true)
			call YDWEUnitRemoveStun(u)
			call IssueImmediateOrderById(u,$D0004)
			call SetUnitInvulnerableEx(u, false)
			set targetX = LoadReal(HY, h, 100 * i)
			set targetY = LoadReal(HY, h, 100 * i + 1)
			call KillDestructablesInCircle(targetX, targetY, 200)
			call SetUnitPosition(u, targetX, targetY)
			set isillusion = IsUnitIllusion(u)
			if isillusion then
				call UnitPauseTimedLife(u, false)
			endif
			if not isillusion then
				call SetUnitFacing(u, LoadReal(HY, h, 0))
				if not isillusion then
					call SelectUnitAddForPlayer(u, GetOwningPlayer(u))
				endif
			else
				call GroupAddUnit(g, u)
			endif
			call KillUnit(LoadUnitHandle(HY, h, 300 + i))
			set i = i + 1
		endloop
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			call SelectUnitAddForPlayer(u, GetOwningPlayer(u))
			call GroupRemoveUnit(g, u)
		endloop
		call LogoutGroup(g)
		call RemoveUnit(LoadUnitHandle(HY, h,- 100 ))
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	else
		// 运动
		if c == 1 then
			loop
			exitwhen HaveSavedHandle(HY, h, i)== false
				set u = LoadUnitHandle(HY, h, i)
				call YDWEUnitAddStun(u)
				call IssueImmediateOrderById( u, 851972 )
				set i = i + 1
			endloop
		elseif c >= 30 then
			loop
			exitwhen HaveSavedHandle(HY, h, i)== false
				set u = LoadUnitHandle(HY, h, 300 + i)
				set N3X = LoadReal(HY, h, 100 * i + 2)
				set radian = LoadReal(HY, h, 100 * i + 3)
				set targetX = CoordinateX50(GetUnitX(u)+ N3X * Cos(radian))
				set targetY = CoordinateY50(GetUnitY(u)+ N3X * Sin(radian))
				call SetUnitAnimation(u, "walk")
				call SetUnitX(u, targetX)
				call SetUnitY(u, targetY)
				set i = i + 1
			endloop
		endif
		call SaveInteger(HY, h, 0, c)
	endif
	set u = null
	set u2 = null
	set t = null
endfunction
// 神行百变
function SpellEffect__Doppelganger takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local group g = LoginGroup(248)
	local integer i = 0
	local unit firstUnit
	local real angle = GetUnitFacing(u)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit d
	local real radian
	local real distance
	local real targetX
	local real targetY
	local unit illusionUnit = null
	local real spellUnitX = GetUnitX(u)
	local real spellUnitY = GetUnitY(u)
	local string s
	local player p = GetOwningPlayer(u)

	call RemoveUnitBuff(u, false)

	set illusionUnit = SummonIllusion(u, u, 8., 0., 1., 0., null)
	set s = ""
	if IsUnitAlly(u, LocalPlayer) or(IsObserver) then
		set s = "Abilities\\Spells\\Items\\AIda\\AIdaTarget.mdl"
	endif
	call AddSpecialEffectTargetToTimed(s, illusionUnit, "head", 9)

	set illusionUnit = SummonIllusion(u, u, 8., 0.2, 6., 0., null)
	set s = ""
	if IsUnitAlly(u, LocalPlayer) or(IsObserver) then
		set s = "war3mapImported\\PLPower.mdx"
	endif
	call AddSpecialEffectTargetToTimed(s, illusionUnit, "overhead", 9)

	call GroupEnumUnitsInRange(g, spellUnitX, spellUnitY, 900 + MAX_UNIT_COLLISION, null)

	set d = null

	call GroupAddUnit(g, u)

	loop
		set firstUnit = FirstOfGroup(g)
	exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)
		if IsUnitAlly(firstUnit, p) and IsUnitInRangeXY(firstUnit, spellUnitX, spellUnitY, 900.) and firstUnit == u or IsUnitIllusion(firstUnit) then
			set i = i + 1
			call SaveUnitHandle(HY, h, i, firstUnit)
			call SetUnitInvulnerableEx(firstUnit, true)
			call ShowUnit(firstUnit, false)
			if IsUnitIllusion(firstUnit) then
				call UnitPauseTimedLife(firstUnit, true)
			endif
			set d = CreateUnit(GetOwningPlayer(firstUnit),'h07W', GetUnitX(firstUnit), GetUnitY(firstUnit), GetUnitFacing(firstUnit))
			call SaveUnitHandle(HY, h, 300 + i, d)
			set radian = GetRandomReal(0, 360)* bj_DEGTORAD
			set distance = GetRandomReal(10, 325)
			set targetX = CoordinateX50(x + distance * Cos(radian))
			set targetY = CoordinateY50(y + distance * Sin(radian))
			call SaveReal(HY, h, 100 * i + 0, targetX)
			call SaveReal(HY, h, 100 * i + 1, targetY)
			call SaveReal(HY, h, 100 * i + 2, GetDistanceBetween(GetUnitX(d), GetUnitY(d), targetX, targetY)/ .4 * .02)
			call SaveReal(HY, h, 100 * i + 3, AngleBetweenXY(GetUnitX(d), GetUnitY(d), targetX, targetY)* bj_DEGTORAD)
		endif
	endloop
	set firstUnit = null
	set d = null

	call SaveUnitHandle(HY, h,- 100 , CreateUnit(GetOwningPlayer(u),'o01P', GetUnitX(u), GetUnitY(u), 0))
	call SaveReal(HY, h, 0, angle)
	call SaveUnitHandle(HY, h, 0, u)
	call TimerStart(t, .02, true, function DoppelgangerMoveLoop)
	call SaveReal(HY, h, 10, x)
	call SaveReal(HY, h, 11, y)
	call LogoutGroup(g)
	set t = null
	set u = null
endfunction


// 注册幻影长矛手触发器
function RegisterPhantomLancerTrigger takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
	call TriggerAddCondition(t, Condition(function XKI))
	set t = CreateTrigger()
	call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	call TriggerAddCondition(t, Condition(function XLI))
	
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function JuxtaposeIllusionUnitDeath))

	set t = null
endfunction
function XUI takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())== VUV[21]and GetOwningPlayer(GetFilterUnit())== GetOwningPlayer(GetTriggerUnit()) and IsUnitIllusion(GetFilterUnit())== false then
		set U2 = GetFilterUnit()
	endif
	return false
endfunction
function XWI takes nothing returns nothing
	local unit TJX = GetTriggerUnit()
	local unit WUE
	local group g = LoginGroup(249)
	local real x
	local real y
	set U2 = null
	call GroupEnumUnitsInRange(g, GetUnitX(TJX), GetUnitY(TJX), 1000, Condition(function XUI))
	call LogoutGroup(g)
	set WUE = U2
	if WUE != null then
		set x = GetUnitX(WUE)
		set y = GetUnitY(WUE)
		call SetUnitPosition(TJX, x, y)
	endif
	set x = GetUnitX(TJX)+ 600 * Cos(GetUnitFacing(TJX)* bj_DEGTORAD)
	set y = GetUnitY(TJX)+ 600 * Sin(GetUnitFacing(TJX)* bj_DEGTORAD)
	call IssuePointOrderById(TJX, 851986, x, y)
	set TJX = null
	set WUE = null
	set g = null
endfunction
function XYI takes nothing returns boolean
	if GetUnitAbilityLevel(GetTriggerUnit(),'B03A')> 0 then
		call XWI()
	endif
	return false
endfunction
function MYX takes nothing returns nothing
	local trigger t = CreateTrigger()
	local region r = CreateRegion()
	call RegionAddRect(r, bj_mapInitialPlayableArea)
	call TriggerRegisterEnterRegion(t, r, TrueBoolexprCondition)
	call TriggerAddCondition(t, Condition(function XYI))
	set t = null
	set r = null
endfunction
function XZI takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit())) and UnitIsDead(GetFilterUnit()) == false)
endfunction
function X_I takes nothing returns nothing
	local unit R3O = GetTriggerUnit()
	local unit R4O = CreateUnit(GetOwningPlayer(R3O),'e022', GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()), 270)
	call UnitAddPermanentAbility(R4O,'A06T')
	call SetUnitAbilityLevel(R4O,'A06T', GetUnitAbilityLevel(R3O,'A07Z')+ GetUnitAbilityLevel(R3O,'A44S'))
	call UnitRemoveAbility(GetEnumUnit(),'B0ER')
	call IssueTargetOrderById(R4O,$D00CB, GetEnumUnit())
	set R3O = null
	set R4O = null
endfunction
function X0I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u
	local integer h = GetHandleId(t)
	local integer i = 1
	local integer X1I = LoadInteger(HY, h, 0)
	local integer C6R = LoadInteger(HY, h,-1)
	local unit WJE = LoadUnitHandle(HY, h, 0)
	loop
		if HaveSavedHandle(HY, h, i) then
			set u = LoadUnitHandle(HY, h, i)
			if UnitAlive(u) and GetUnitAbilityLevel(u,'B0ER')> 0 then
				call UnitDamageTargetEx(WJE, u, 1, 175)
			else
				call RemoveSavedBoolean(HY, LoadInteger(HY, h, i),'B0ER')
				call RemoveSavedHandle(HY, h, i)
			endif
		endif
		set i = i + 1
	exitwhen i > C6R
	endloop
	if X1I >$A then
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	elseif X1I == 0 then
		call TimerStart(t, 1, true, function X0I)
	endif
	set t = null
	set u = null
	set WJE = null
endfunction
function X2I takes unit WJE, group g returns nothing
	local timer t = CreateTimer()
	local unit u
	local integer h = GetHandleId(t)
	local integer hu
	local integer i = 1
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		set hu = GetHandleId(u)
		if GetUnitAbilityLevel(u,'B0ER')== 0 and LoadBoolean(HY, hu,'B0ER')== false then
			call SaveUnitHandle(HY, h, i, u)
			call SaveInteger(HY, h, i, hu)
			call SaveBoolean(HY, hu,'B0ER', true)
			set i = i + 1
		endif
		call GroupRemoveUnit(g, u)
	endloop
	call TimerStart(t, 0, false, function X0I)
	call SaveUnitHandle(HY, h, 0, WJE)
	call SaveInteger(HY, h,-1, i)
	set t = null
	set u = null
endfunction
function FYE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local group g = LoginGroup(250)
	local boolean MDR = GetSpellAbilityId()!='A07Z'
	local integer hu = GetHandleId(GetOwningPlayer(u))
	local group gg
	local group g3
	local integer i
	local integer k
	local destructable d
	local boolean X3I = ZLE(u)
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 700, Condition(function XZI))
	if MDR then
		set gg = LoginGroup(251)
		set g3 = LoginGroup(252)
		set i = 0
		set k = LoadInteger(HY, hu,'EinF')
		loop
			set i = i + 1
		exitwhen i > k
			set d = LoadDestructableHandle(HY, hu,'EinF'+ i)
			if X3I == false or GetDistanceBetween(GetUnitX(u), GetUnitY(u), GetDestructableX(d), GetDestructableY(d))< 3000 then
				call GroupEnumUnitsInRange(gg, GetDestructableX(d), GetDestructableY(d), 800, Condition(function XZI))
				call GroupAddGroup(gg, g)
				call GroupAddGroup(gg, g3)
			endif
		endloop
		call X2I(u, g3)
		call LogoutGroup(g3)
		call LogoutGroup(gg)
	endif
	call ForGroup(g, function X_I)
	call LogoutGroup(g)
	set u = null
	set g = null
	set gg = null
	set g3 = null
	set d = null
endfunction
function X4I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer hu
	local integer i
	local unit u = LoadUnitHandle(HY, h, 2)
	if GetTriggerEventId()!= EVENT_GAME_TIMER_EXPIRED then
		set hu = LoadInteger(HY, h, 0)
		set i = LoadInteger(HY, h, 1) -1
		call DestroyUbersplat(LoadUbersplatHandle(HY, h, 3))
		call KillUnit(u)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		loop
			set i = i + 1
		exitwhen HaveSavedHandle(HY, hu,'EinF'+ i + 1)== false
			call SaveDestructableHandle(HY, hu,'EinF'+ i, LoadDestructableHandle(HY, hu,'EinF'+ i + 1))
		endloop
		call SaveInteger(HY, hu,'EinF', LoadInteger(HY, hu,'EinF') -1)
	else
		call SetUbersplatRenderAlways(LoadUbersplatHandle(HY, h, 3), IsPlayerAlly(LocalPlayer, GetOwningPlayer(u)) or IsObserver or(UnitVisibleToPlayer(u, LocalPlayer)))
	endif
	set t = null
	set u = null
	return false
endfunction
function FZE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer hu = GetHandleId(GetOwningPlayer(u))
	local destructable d = GetSpellTargetDestructable()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer c = LoadInteger(HY, hu,'EinF')
	local unit W_V = CreateUnit(GetOwningPlayer(u),'ewsp', GetDestructableX(d), GetDestructableY(d), 0)
	local ubersplat ub = CreateUbersplat(GetUnitX(W_V), GetUnitY(W_V), "EINF", 255, 255, 255, 40, false, false)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(W_V),'e00E', GetUnitX(W_V), GetUnitY(W_V), 0)
	call UnitAddPermanentAbility(dummyUnit,'A44T')
	call IssueTargetOrderById(dummyUnit,$D0065, W_V)
	set dummyUnit = null
	call SetUnitPathing(W_V, false)
	call SetUnitX(W_V, GetDestructableX(d))
	call SetUnitY(W_V, GetDestructableY(d))
	call SetUnitPeonType(W_V, false)
	call PauseUnit(W_V, true)
	call TriggerRegisterDeathEvent(t, d)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function X4I))
	call SaveDestructableHandle(HY, GetHandleId(GetOwningPlayer(u)),'EinF'+ c + 1, d)
	call SaveInteger(HY, hu,'EinF', c + 1)
	call SaveInteger(HY, h, 0, hu)
	call SaveInteger(HY, h, 1, c + 1)
	call SaveUnitHandle(HY, h, 2, W_V)
	call SaveUbersplatHandle(HY, h, 3, ub)
	set ub = null
	set W_V = null
	set t = null
	set d = null
	set u = null
endfunction
function HBX takes nothing returns nothing
	call SetPlayerAbilityAvailable(GetOwningPlayer(U2),'A01V', false)
endfunction
function HXX takes nothing returns nothing
	call UnitAddPermanentAbility(U2,'A01V')
	call SetPlayerAbilityAvailable(GetOwningPlayer(U2),'A01V', true)
endfunction
function PointHaveTreeInRangeFilter takes nothing returns boolean
	local destructable d = GetFilterDestructable()
	local real x
	local real y
	if(IsTreeDestructable(d) or GetDestructableTypeId(d)=='B005') and GetWidgetLife(d)> 0 then
		set x = GetWidgetX(d)-Temp__ArrayReal[$C9]
		set y = GetWidgetY(d)-Temp__ArrayReal[$CA]
		if Temp__ArrayReal[$C8]> SquareRoot(x * x + y * y) then
			set PointHaveTree = true
		endif
	endif
	set d = null
	return false
endfunction
// 坐标的范围内是否有树
function IsPointHaveTreeInRange takes real x, real y, real radius returns boolean
	local rect r = null
	set Temp__ArrayReal[$C8]= radius
	set Temp__ArrayReal[$C9]= x
	set Temp__ArrayReal[$CA]= y
	set radius = radius +$96
	set r = Rect(x -radius, y -radius, x + radius, y + radius)
	set PointHaveTree = false
	call EnumDestructablesInRect(r, Condition(function PointHaveTreeInRangeFilter), null)
	call RemoveRect(r)
	set r = null
	return PointHaveTree
endfunction
function NatureGuiseAEActions takes unit u returns nothing
	if GetUnitAbilityLevel(u,'A23N')> 0 then
		call SaveBoolean(ExtraHT, GetHandleId(u), 'A01Z', false)
		call UnitRemoveAbility(u,'B021')
		call UnitRemoveAbility(u,'B0E9')
		call UnitRemoveAbility(u,'A1GA')
		call UnitRemoveAbility(u,'A23N')
	endif
endfunction
function NatureGuiseLoopAction takes nothing returns nothing
	local unit d = null
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer count = LoadInteger(HY, h, 0)
	local unit u = LoadUnitHandle(HY, h, 0)
	local boolean b1 = GetUnitAbilityLevel(u,'B021')== 0
	local boolean b2 = IsPointHaveTreeInRange(GetWidgetX(u), GetWidgetY(u), 375)
	if LoadBoolean(ExtraHT, GetHandleId(u), 'A01Z') and LoadBoolean(HY, h, 0) and b1 and b2 and count > 1 then
		set d = CreateUnit(GetOwningPlayer(u),'e00E', GetWidgetX(u), GetWidgetY(u), 0)
		call UnitAddAbility(d,'A01Z')
		call SetUnitAbilityLevel(d,'A01Z', LoadInteger(HY, h, 2))
		call IssueTargetOrderById(d,$D0065, u)
		call SaveInteger(HY, h, 0, count -1)
		set d = null
		set u = null
		set t = null
		return
	endif
	if count == 0 or UnitIsDead(u) or b1 or LoadBoolean(ExtraHT, GetHandleId(u), 'A01Z')== false then
		call SaveBoolean(HY, h, 0, false)
		call UnitRemoveAbility(u,'B021')
		call UnitRemoveWindWalk(u)
		call UnitRemoveAbility(u,'A23N')
		call UnitRemoveAbility(u,'B0E9')
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		set u = null
		return
	endif
	call SaveInteger(HY, h, 0, count -1)
	if b2 then
		call SaveInteger(HY, h, 1, 0)
	else
		set count = LoadInteger(HY, h, 1)
		if count == 9 then
			call UnitRemoveAbility(u,'B0E9')
			call UnitRemoveAbility(u,'B021')
			call UnitRemoveAbility(u,'A23N')
			call UnitRemoveWindWalk(u)
			call DestroyTimerAndFlushHT_P(t)
		else
			call SaveInteger(HY, h, 1, count + 1)
		endif
	endif
	set t = null
	set u = null
endfunction
function NatureGuiseRemoveEffect takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	call UnitRemoveAbility(u,'B021')
	call DestroyTimerAndFlushHT_HY(t)
	set u = null
	set t = null
endfunction

globals
	
endglobals

// 大自然的掩护
function SpellEffect__NatureGuise takes nothing returns nothing
	local unit u = null
	local unit d = GetSpellTargetUnit()
	local timer t = LoadTimerHandle(ExtraHT, GetHandleId(d), 'A01Z')
	local integer h
	local integer level
	if not IsPointHaveTreeInRange(GetWidgetX(d), GetWidgetY(d), 375) then
		call TimerStart(t, 0, false, function NatureGuiseRemoveEffect)
		call SaveUnitHandle(HY, GetHandleId(t), 0, d)
		call UnitRemoveAbility(d,'B021')
		set d = null
		set t = null
		return
	endif
	if t == null then
		set t = CreateTimer()
		call SaveTimerHandle(ExtraHT, GetHandleId(d), 'A01Z', t)
		call UnitAddWindWalk(d)
	endif
	set u = GetTriggerUnit()
	set h = GetHandleId(t)
	set level = GetUnitAbilityLevel(u, 'A01Z')
	call SaveUnitHandle(HY, h, 0, d)
	call SaveInteger(HY, h, 0, level * 150)
	call SaveInteger(HY, h, 1, 0)
	call SaveInteger(HY, h, 2, level)
	call SaveBoolean(HY, h, 0, false)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Invisibility\\InvisibilityTarget.mdl", d, "chest"))
	call UnitAddPermanentAbility(d,'A23N')
	call SaveBoolean(HY, h, 0, true)
	call SaveBoolean(ExtraHT, GetHandleId(d), 'A01Z', true)
	call TimerStart(t, .1, true, function NatureGuiseLoopAction)
	set d = null
	set u = null
	set t = null
endfunction
function OEI takes unit u returns nothing
	local real x = GetWidgetX(u)-Temp__ArrayReal[0]
	local real y = GetWidgetY(u)-Temp__ArrayReal[1]
	local real d = SquareRoot(x * x + y * y)
	if Temp__ArrayReal[2]> d then
		set Temp__ArrayReal[2]= d
		set Temp__ArrayUnit[1]= u
	endif
endfunction
function OXI takes integer id returns boolean
	return id =='u00M' or id =='u00N' or id =='u00D' or id =='u00T' or id =='usep' or id =='utod' or id =='unpl' or id =='e00R' or id =='e011' or id =='e00S' or id =='e019' or id =='eaom' or id =='eaoe' or id =='etol'
endfunction
function OOI takes nothing returns boolean
	local unit t = GetFilterUnit()
	if IsUnitAlly(Temp__ArrayUnit[0], GetOwningPlayer(t)) and(IsUnitType(t, UNIT_TYPE_HERO) or(IsUnitType(t, UNIT_TYPE_STRUCTURE) and OXI(GetUnitTypeId(t)))) and UnitAlive(t) then
		call OEI(t)
	endif
	set t = null
	return false
endfunction
function ORI takes unit u returns unit
	set Temp__ArrayUnit[0]= u
	set Temp__ArrayUnit[1]= null
	set Temp__ArrayReal[0]= GetSpellTargetX()
	set Temp__ArrayReal[1]= GetSpellTargetY()
	set Temp__ArrayReal[2]= 99999
	call GroupEnumUnitsInRange(AK, 0, 0, 99999, Condition(function OOI))
	return Temp__ArrayUnit[1]
endfunction
function OII takes nothing returns real
	local trigger t = LoadTriggerHandle(HY, GetHandleId(GetTriggerUnit()),'A2ML')
	local integer h = GetHandleId(t)
	local real ZCE = LoadReal(HY, h, 0)
	local integer HUX = LoadInteger(HY, h, 0)
	local real d = GetEventDamage()
	local real OAI = .0
	if d > 5 and HUX > 0 then
		call SaveInteger(HY, h, 0, HUX -1)
		set OAI = RMinBJ(d, ZCE)
		// debug call SingleDebug(R2S(OAI))
	endif
	set t = null
	return OAI
endfunction
function ONI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer c = LoadInteger(HY, h, 1)+ 1
	if GetUnitAbilityLevel(u,'A3KF')== 0 or LoadInteger(HY, h, 0)== 0 or c >=$F* 5 or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call RemoveSavedHandle(HY, GetHandleId(u),'A2ML')
		call UnitRemoveAbility(u,'A3KF')
		call UnitRemoveAbility(u,'B3KF')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SaveInteger(HY, h, 1, c)
		call SetWidgetLife(u, GetWidgetLife(u)+ LoadReal(HY, h, 1))
	endif
	set t = null
	set u = null
endfunction
function YKV takes nothing returns nothing
	local trigger t
	local unit u = GetTriggerUnit()
	local unit u2 = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(u,'A2ML')
	local integer h
	if u2 == null then
		set u2 = ORI(u)
	endif
	if HaveSavedHandle(HY, GetHandleId(u2),'A2ML') then
		set t = LoadTriggerHandle(HY, GetHandleId(u2),'A2ML')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, GetHandleId(u2),'A2ML', t)
		call TriggerRegisterDeathEvent(t, u2)
		call TriggerRegisterTimerEvent(t, .2, true)
		call TriggerAddCondition(t, Condition(function ONI))
		call SaveUnitHandle(HY, h, 0, u2)
	endif
	call UnitAddPermanentAbility(u2,'A3KF')
	call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 3 + level)
	call SaveInteger(HY, h, 1, 0)
	call SaveReal(HY, h, 0, 20. * level)
	call SaveReal(HY, h, 1,(.1 + .3 * level))
	set t = null
	set u = null
	set u2 = null
endfunction
function OBI takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit WUE = U2
	local unit targetUnit = W2
	local real OCI = LoadReal(HY, h, 21)
	call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+ OCI)
	set WUE = null
	set targetUnit = null
endfunction
function ODI takes nothing returns nothing
	local trigger t = NHX(JWV, GetEnumUnit(),'h0D8', "OBI", 400, false)
	call SaveReal(HY, GetHandleId(t), 21, JYV * 1.)
	set t = null
endfunction
function OFI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 5))
	local group g
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(targetUnit,'A272')
		call UnitRemoveAbility(targetUnit,'B0EL')
	else
		if GetTriggerEvalCount(t)> 6 then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call UnitRemoveAbility(targetUnit,'A272')
			call UnitRemoveAbility(targetUnit,'B0EL')
		endif
		call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\NightElf\\EntBirthTarget\\EntBirthTarget.mdl", targetUnit, "origin"))
		set U2 = WUE
		set g = LoginGroup(253)
		call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 525, Condition(function D2X))
		set JWV = targetUnit
		set JYV =$C+$C* level
		call ForGroup(g, function ODI)
		call LogoutGroup(g)
		call UnitDamageTargetEx(WUE, targetUnit, 1, JYV)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set g = null
	return false
endfunction
function OGI takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call UnitAddPermanentAbility(targetUnit,'A272')
	call TriggerRegisterTimerEvent(t, .75, true)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function OFI))
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveReal(HY, h, 442, GetGameTime()* 1.)
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	set t = null
	set WUE = null
	set targetUnit = null
endfunction
function ELE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call OGI()
	endif
endfunction
function OHI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	local unit W_V = LoadUnitHandle(HY, h, 2)
	local unit OJI
	local eventid OKI = GetTriggerEventId()
	local integer level = LoadInteger(HY, h, 3)
	local integer WRV
	if OKI == EVENT_UNIT_SPELL_EFFECT then
		set WRV = GetSpellAbilityId()
		if IsNotItemAbility(WRV) and LNX(WRV)== false and IsAttackSpecialEffectsId(WRV)== false and X5R(WRV)== false then
			call UnitDamageTargetEx(WJE, WLE, 1, level * 50 + 100 )
			call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\LastWordDamageSpell.mdx", WLE, "overhead"))
			set OJI = CreateUnit(GetOwningPlayer(WLE),'e00E', GetUnitX(WLE), GetUnitY(WLE), 0)
			call UnitAddAbility(OJI,'A0LS')
			call SetUnitAbilityLevel(OJI,'A0LS', level)
			call IssueTargetOrderById(OJI,$D0269, WLE)
			call DestroyEffect(LoadEffectHandle(HY, h, 4))
			call RemoveUnit(W_V)
			call CleanCurrentTrigger(t)
			call FlushChildHashtable(HY, h)
		endif
	elseif OKI == EVENT_WIDGET_DEATH then
		call DestroyEffect(LoadEffectHandle(HY, h, 4))
		call RemoveUnit(W_V)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif LoadReal(HY, h, 5)+ 5 <= GetGameTime() then
		call UnitDamageTargetEx(WJE, WLE, 1, level * 50 + 100 )
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\LastWordDamageSpell.mdx", WLE, "overhead"))
		set OJI = CreateUnit(GetOwningPlayer(WLE),'e00E', GetUnitX(WLE), GetUnitY(WLE), 0)
		call UnitAddAbility(OJI,'Z051')
		call SetUnitAbilityLevel(OJI,'Z051', level)
		call IssueTargetOrderById(OJI,$D0269, WLE)
		call DestroyEffect(LoadEffectHandle(HY, h, 4))
		call RemoveUnit(W_V)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SetUnitX(W_V, GetUnitX(WLE))
		call SetUnitY(W_V, GetUnitY(WLE))
	endif
	set t = null
	set W_V = null
	set WLE = null
	set WJE = null
	set OJI = null
	set OKI = null
endfunction
function W5V takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(WJE, GetSpellAbilityId())
	local unit W_V = CreateUnit(GetOwningPlayer(WJE),'o019', GetUnitX(WLE), GetUnitY(WLE), 0)
	local real WIE = GetGameTime()
	call TriggerRegisterUnitEvent(t, WLE, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterDeathEvent(t, WLE)
	call TriggerAddCondition(t, Condition(function OHI))
	call SaveUnitHandle(HY, h, 0, WJE)
	call SaveUnitHandle(HY, h, 1, WLE)
	call SaveUnitHandle(HY, h, 2, W_V)
	call SaveInteger(HY, h, 3, level)
	call SaveEffectHandle(HY, h, 4, AddSpecialEffectTarget("war3mapImported\\LastWordDebuff_6.mdx", WLE, "overhead"))
	call SaveReal(HY, h, 5, WIE)
	set t = null
	set WJE = null
	set WLE = null
	set W_V = null
endfunction
function GlaivesOfWisdomActions takes unit R8X, unit WLE returns nothing
	local real d =(.15 + .1 * I2R(GetUnitAbilityLevel(R8X,'A0LZ')))* E3X(R8X)
	call UnitRemoveAbility(WLE,'B05X')
	call CommonTextTag("+" + I2S(R2I(d)), 1, WLE, .023, 3,$D8,$D8,$D8)
	call UnitDamageTargetEx(R8X, WLE, 3, d)
endfunction
function OMI takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit WUE = W2
	local real IXX =(LoadReal(HY, h, 20))
	call SetHeroInt(WUE, GetHeroInt(WUE, false)+ 2, true)
	call CommonTextTag("+2 " + GetObjectName('n0JP'), 3, WUE, .023, 0, 255, 0,$E6)
	set WUE = null
endfunction
function OPI takes nothing returns nothing
	local unit WUE = GetEnumUnit()
	local unit SZX = GetTriggerUnit()
	set JZV[GetPlayerId(GetOwningPlayer(WUE))]= JZV[GetPlayerId(GetOwningPlayer(WUE))]+ 2
	call CommonTextTag("-2 " + GetObjectName('n0JP'), 3, SZX, .023, 255, 0, 0,$E6)
	call SetHeroInt(SZX, GetHeroInt(SZX, false)-2, true)
	call NHX(SZX, WUE,'h0CP', "OMI",$960, false)
	set WUE = null
	set SZX = null
endfunction
function OQI takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and GetUnitAbilityLevel(GetFilterUnit(),'A0LZ')> 0 and UnitIsDead(GetFilterUnit())== false and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(U2)))!= null
endfunction
function OSI takes unit SYX, unit SZX returns nothing
	local group g
	if IsUnitType(SZX, UNIT_TYPE_HERO)== false or LoadBoolean(HY, GetHandleId(SZX), QR) then
		return
	endif
	set g = LoginGroup(254)
	set U2 = SZX
	call GroupEnumUnitsInRange(g, GetUnitX(SZX), GetUnitY(SZX), 925, Condition(function OQI))
	if IsUnitType(SYX, UNIT_TYPE_HERO)== false then
		set SYX = Player__Hero[GetPlayerId(GetOwningPlayer(SYX))]
	endif
	if GetUnitAbilityLevel(SYX,'A0LZ')> 0 and UnitIsDead(SYX)== false and IsUnitEnemy(SYX, GetOwningPlayer(SZX)) then
		call GroupAddUnit(g, SYX)
	endif
	if FirstOfGroup(g)!= null then
		call ForGroup(g, function OPI)
	endif
	call LogoutGroup(g)
	set g = null
endfunction
function OTI takes integer id returns boolean
	return LNX(id)== false and IsNotItemAbility(id)
endfunction
function OUI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 5)
	local integer EVX = LoadInteger(HY, h, 34)
	if GetTriggerEventId()!= EVENT_WIDGET_DEATH and GetTriggerEventId()!= EVENT_UNIT_SPELL_EFFECT and EVX < 6 then
		set EVX = EVX + 1
		call SaveInteger(HY, h, 34, EVX)
		call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)-8 * level)
		call UnitDamageTargetEx(WUE, targetUnit, 1, 5 +$F* level)
	endif
	if EVX >= 6 or GetUnitAbilityLevel(targetUnit,'A1PS')== 0 or GetTriggerEventId()== EVENT_WIDGET_DEATH or(GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT and OTI(GetSpellAbilityId())) then
		call UnitRemoveAbility(targetUnit,'A1PS')
		call UnitRemoveAbility(targetUnit,'B0CQ')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function OWI takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetEnumUnit()
	local integer level = KA
	//local integer level=4
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call UnitAddPermanentAbility(targetUnit,'A1PS')
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function OUI))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY, h, 34, 0)
	set WUE = null
	set targetUnit = null
	set t = null
endfunction
function OYI takes nothing returns boolean
	return(IsMagicImmuneUnit(GetFilterUnit())== false and(IsUnitIdType(GetUnitTypeId(GetFilterUnit()), UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and RFX(GetFilterUnit())== false and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit())))!= null
endfunction
function EME takes nothing returns nothing
	local group g = LoginGroup(255)
	set U2 = GetTriggerUnit()
	call GroupEnumUnitsInRange(g, GetSpellTargetX(), GetSpellTargetY(), 375, Condition(function OYI))
	set KA = GetUnitAbilityLevel(U2,'A14L')
	call ForGroup(g, function OWI)
	call ABX("war3mapImported\\CotS.mdx", GetSpellTargetX(), GetSpellTargetY(), 5)
	call LogoutGroup(g)
	set g = null
endfunction
function OZI takes nothing returns boolean
	local player p = LoadPlayerHandle(HY, GetHandleId(GetTriggeringTrigger()), 0)
	call RemoveSavedHandle(HY, GetHandleId(GetTriggeringTrigger()), 0)
	call CleanCurrentTrigger(GetTriggeringTrigger())
	if IsPlayerEnemy(p, LocalPlayer) then
		call VolumeGroupReset()
	endif
	return false
endfunction
function O_I takes nothing returns boolean
	return(IsMagicImmuneUnit(GetFilterUnit())== false and(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit())))!= null
endfunction
function O0I takes nothing returns nothing
	local group g
	local integer l = 4
	if l > 0 then
		set g = LoginGroup(256)
		call GroupEnumUnitsInRange(g, 0, 0, 9999, Condition(function O_I))
		set KA = 4
		call ForGroup(g, function OWI)
		call LogoutGroup(g)
	endif
	set g = null
endfunction
function EPE takes nothing returns nothing
	local location HOO = GetUnitLoc(GetTriggerUnit())
	local trigger t = CreateTrigger()
	local integer level = GetUnitAbilityLevel(GetTriggerUnit(),'A0L3')
	if level == 0 then
		set level = 1 + GetUnitAbilityLevel(GetTriggerUnit(),'A2QC')
		call O0I()
	endif
	call TriggerRegisterTimerEvent(t, level + 3, false)
	call SavePlayerHandle(HY, GetHandleId(t), 0, GetTriggerPlayer())
	call TriggerAddCondition(t, Condition(function OZI))
	set bj_lastCreatedUnit = CreateUnit(GetTriggerPlayer(),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0)
	call ShowUnit(bj_lastCreatedUnit, false)
	call UnitApplyTimedLife(bj_lastCreatedUnit,'BTLF', 5)
	call UnitAddAbility(bj_lastCreatedUnit,'A0L2')
	call SetUnitAbilityLevel(bj_lastCreatedUnit,'A0L2', level)
	call IssuePointOrderByIdLoc(bj_lastCreatedUnit,$D0270, HOO)
	if IsPlayerEnemy(LocalPlayer, GetTriggerPlayer()) then
		call VolumeGroupSetVolume(SOUND_VOLUMEGROUP_UNITSOUNDS, .0)
		call VolumeGroupSetVolume(SOUND_VOLUMEGROUP_COMBAT, .0)
		call VolumeGroupSetVolume(SOUND_VOLUMEGROUP_SPELLS, .0)
		call VolumeGroupSetVolume(SOUND_VOLUMEGROUP_MUSIC, .0)
	endif
	call RemoveLocation(HOO)
	set t = null
	set HOO = null
endfunction

function range_Take_Aim takes nothing returns nothing
	local unit u = U2
	local integer lv = Q2
	call SetUnitAcquireRange(u, GetUnitAcquireRange(u)+ 100. * lv)
	call AddUnitAttack1RangeBonus_OnlyRangeAttacker(u, 100. * lv)
	set u = null
endfunction

function PTE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	call SetUnitAcquireRange(u, GetUnitAcquireRange(u)+ 100)
	call AddUnitAttack1RangeBonus_OnlyRangeAttacker(u, 100.)
	set u = null
endfunction

function HeadshotActions takes nothing returns nothing
	if GetPrdRandom(DESourceUnit[DEI],'P102', 40) then
		call AddAbilityToTimed(DETargetUnit[DEI],'A469', 1, .5,'B469')
		set DEDamageValue[DEI] = DEDamageValue[DEI] + ( 25 * GetUnitAbilityLevel(DESourceUnit[DEI],'P102') - 10 )
	endif
endfunction
function O2I takes nothing returns boolean
	return(IsEnemyAliveNotStrucNotWardNotInvulnerable() and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false)!= null
endfunction
function O3I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit dummyUnit = LoadUnitHandle(HY, h, 19)
	local integer level = LoadInteger(HY, h, 5)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local group g = LoginGroup(257)
	local real d
	local real a
	local real x2
	local real y2
	local unit u
	set U2 = WUE
	call GroupEnumUnitsInRange(g, x, y, 475, Condition(function O2I))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call UnitDamageTargetEx(WUE, u, 1, level *$C)
		set E3 = GetOwningPlayer(dummyUnit)
		call SetUnitOwner(dummyUnit, GetOwningPlayer(u), false)
		call IssueTargetOrderById(dummyUnit, 852075, u)
		call SetUnitOwner(dummyUnit, E3, false)
		call GroupRemoveUnit(g, u)
	endloop
	call LogoutGroup(g)
	call DestroyEffect(LoadEffectHandle(HY, h, 309))
	call DestroyEffect(LoadEffectHandle(HY, h, 175))
	call DestroyEffect(LoadEffectHandle(HY, h, 176))
	call DestroyEffect(LoadEffectHandle(HY, h,$B1))
	call DestroyEffect(LoadEffectHandle(HY, h,$B2))
	call DestroyEffect(LoadEffectHandle(HY, h,$B3))
	call DestroyEffect(LoadEffectHandle(HY, h,$B4))
	call DestroyEffect(LoadEffectHandle(HY, h, 330))
	call DestroyEffect(LoadEffectHandle(HY, h, 331))
	if GetTriggerEvalCount(t)== 11 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set d = 0
		set a = 0
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h, 309, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
		set d =$96
		set a = 45
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h, 175, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
		set d = 275
		set a = 90
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h, 176, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
		set d =$96
		set a =$87
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h,$B1, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
		set d = 275
		set a =$B4
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h,$B2, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
		set d =$96
		set a =$E1
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h,$B3, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
		set d = 275
		set a = 270
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h,$B4, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
		set d =$96
		set a = 305
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h, 330, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
		set d = 275
		set a = 360
		set x2 = x + d * Cos(a * bj_DEGTORAD)
		set y2 = y + d * Sin(a * bj_DEGTORAD)
		call SaveEffectHandle(HY, h, 331, AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl", x2, y2))
	endif
	set t = null
	set WUE = null
	set dummyUnit = null
	set g = null
	return false
endfunction
function O4I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local integer level = LoadInteger(HY, h, 0)
	local real x1 = LoadReal(HY, h, 6)
	local real y1 = LoadReal(HY, h, 7)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', x1, y1, 0)
	local real x2
	local real y2
	local real d
	local real a
	local integer i
	call UnitAddPermanentAbility(dummyUnit,'A19F')
	call SetUnitAbilityLevel(dummyUnit,'A19F', level)
	if GetTriggerEvalCount(t)== 1 then
		set i = 1
		loop
		exitwhen i >$A
			set d = GetRandomReal(0, 450)
			set a = GetRandomReal(0, 360)
			set x2 = x1 + d * Cos(a * bj_DEGTORAD)
			set y2 = y1 + d * Sin(a * bj_DEGTORAD)
			set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00J', GetUnitX(WUE), GetUnitY(WUE), 90)
			call IssuePointOrderById(dummyUnit,$D0010, x2, y2)
			call UnitApplyTimedLife(dummyUnit,'BTLF', .5)
			set i = i + 1
		endloop
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2, WUE)
		call SaveUnitHandle(HY, h, 19, dummyUnit)
		call SaveReal(HY, h, 6, x1 * 1.)
		call SaveReal(HY, h, 7, y1 * 1.)
		call SaveInteger(HY, h, 5, level)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function O3I))
		call TriggerEvaluate(t)
	endif
	set WUE = null
	set dummyUnit = null
	set t = null
	return false
endfunction
function EQE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	call SaveInteger(HY, GetHandleId(u),'A064', LoadInteger(HY, GetHandleId(u),'A064')-1)
	call A8X(GetOwningPlayer(u), 9.4, x, y, 400)
	call TriggerRegisterTimerEvent(t, .4, true)
	call TriggerAddCondition(t, Condition(function O4I))
	call SaveUnitHandle(HY, h, 2, u)
	call SaveReal(HY, h, 6, x * 1.)
	call SaveReal(HY, h, 7, y * 1.)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(u,'A064'))
	set t = null
	set u = null
endfunction
function O5I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY,(h), 0))
	local real WIE =(LoadReal(HY,(h), 0))
	local integer HUX = LoadInteger(HY, GetHandleId(u),'A064')
	if HUX < 3 then
		set WIE = WIE -0.2
		if WIE <= 0.00 then
			call SaveInteger(HY, GetHandleId(u),'A064', HUX + 1)
			call SaveReal(HY, h, 0, 40.)
		else
			call SaveReal(HY, h, 0, WIE * 1.)
		endif
	endif
	if HUX == 0 or GetUnitAbilityLevel(u,'A064')== 0 then
		call UnitRemoveAbility(u,'A46B')
		call UnitRemoveAbility(u,'B46B')
	elseif GetUnitAbilityLevel(u,'A064')> 0 then
		call UnitAddPermanentAbility(u,'A46B')
	endif
	set u = null
	set t = null
	return false
endfunction
function O6I takes unit O7I returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerAddCondition(t, Condition(function O5I))
	call SaveUnitHandle(HY, GetHandleId(t), 0, O7I)
	call SaveReal(HY, GetHandleId(t), 0, 40.)
	call SaveInteger(HY, GetHandleId(O7I),'A064', 3)
	call SaveTriggerHandle(HY, GetHandleId(O7I),'A064', t)
	call SaveBoolean(HY, GetHandleId(O7I),'A064', true)
	call DisplayTimedTextToPlayer(GetOwningPlayer(O7I), 0, 0, 10, "|c00FF0000提示|r: 你可以输入指令|c00bd2222-charges|r来开启或关闭充能计数面板")
	set t = null
endfunction
function JPE takes nothing returns nothing
	if HaveSavedHandle(HY, GetHandleId(GetTriggerUnit()),'A064')== false then
		call O6I(GetTriggerUnit())
	endif
	if LoadInteger(HY, GetHandleId(GetTriggerUnit()),'A064')== 0 then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "能量点数不足")
	endif
endfunction
function LHE takes nothing returns nothing
	if HaveSavedHandle(HY, GetHandleId(GetTriggerUnit()),'A064')== false then
		call O6I(GetTriggerUnit())
	endif
endfunction
function M0X takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A19F')
endfunction
function O8I takes nothing returns nothing
	local unit IZX = U2
	local unit WLE = W2
	local integer h = GetHandleId(GetTriggeringTrigger())
	local integer level = LoadInteger(HY, h, 10)
	local real ZCE
	local group g = LoginGroup(258)
	local unit u
	call GroupEnumUnitsInRange(g, GetUnitX(WLE), GetUnitY(WLE), 350, Condition(function DJX))
	set ZCE =$CD+$96* level
	call GroupRemoveUnit(g, WLE)
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\Mortar\\MortarMissile.mdl", GetUnitX(WLE), GetUnitY(WLE)))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call UnitDamageTargetEx(IZX, u, 1, ZCE)
		call GroupRemoveUnit(g, u)
	endloop
	call DestroyEffect(LoadEffectHandle(HY, GetHandleId(LoadUnitHandle(HY, h, 45)),-1))
	call LogoutGroup(g)
	set g = null
	set IZX = null
	set WLE = null
endfunction
function F8E takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local trigger t = NHX(WJE, WLE,'n07D', "O8I",$9C4, false)
	local integer h = GetHandleId(t)
	local unit d = LoadUnitHandle(HY, h, 45)
	local effect fx = AddSpecialEffectTarget("Abilities\\Weapons\\CannonTowerMissile\\CannonTowerMissile.mdl", d, "origin")
	call SaveInteger(HY, h, 10, GetUnitAbilityLevel(WJE, GetSpellAbilityId()))
	call SaveEffectHandle(HY, GetHandleId(d),-1, fx)
	set fx = null
	set d = null
	set t = null
	set WJE = null
	set WLE = null
endfunction
function O9I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local effect FX =(LoadEffectHandle(HY, h, 32))
	local player p = GetOwningPlayer(triggerUnit)
	call DestroyEffect(FX)
	call RemoveUnit(dummyUnit)
	call UnitRemoveAbility(targetUnit,'B06H')
	call UnitRemoveAbility(targetUnit,'A313')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set triggerUnit = null
	set dummyUnit = null
	set targetUnit = null
	set FX = null
	set p = null
	return false
endfunction
function S0E takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local player p = GetOwningPlayer(triggerUnit)
	local unit dummyUnit
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local string s = "effects\\Snipe Target.mdx"
	if IsPlayerAlly(LocalPlayer, p) or IsObserver then
		set s = ""
	endif
	call UnitAddPermanentAbility(targetUnit,'A313')
	call GHX(targetUnit, triggerUnit,'A313')
	set dummyUnit = CreateUnit(GetOwningPlayer(targetUnit),'e01R', 0, 0, 0)
	call UnitAddPermanentAbility(dummyUnit,'A0NI')
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget(s, targetUnit, "overhead")))
	call TriggerRegisterTimerEvent(t, 4, false)
	call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function O9I))
	set t = null
	set triggerUnit = null
	set targetUnit = null
	set dummyUnit = null
	set p = null
endfunction
function RVI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group AIR = LoadGroupHandle(HY, h, 0)
	local group gg
	local integer c = LoadInteger(HY, h, 0)
	local unit u2
	if c < 60 then
		set gg = LoginGroup(259)
		set U2 = LoadUnitHandle(HY, h, 1)
		call GroupEnumUnitsInRange(gg, LoadReal(HY, h, 0), LoadReal(HY, h, 1),$FA+ 25 * LoadInteger(HY, h, 5), Condition(function DPX))
		loop
			set u2 = FirstOfGroup(AIR)
		exitwhen u2 == null
			call SetUnitTurnSpeed(u2, GetUnitDefaultTurnSpeed(u2))
			call GroupRemoveUnit(AIR, u2)
		endloop
		loop
			set u2 = FirstOfGroup(gg)
		exitwhen u2 == null
			if GetUnitAbilityLevel(u2,'B0BS')== 0 then
				call GroupAddUnit(AIR, u2)
				call SetUnitTurnSpeed(u2, GetUnitDefaultTurnSpeed(u2)* .7)
			endif
			call GroupRemoveUnit(gg, u2)
		endloop
		call SaveInteger(HY, h, 0, c + 1)
		call LogoutGroup(gg)
	else
		loop
			set u2 = FirstOfGroup(AIR)
		exitwhen u2 == null
			if GetUnitAbilityLevel(u2,'B0BS')== 0 then
				call SetUnitTurnSpeed(u2, GetUnitDefaultTurnSpeed(u2))
			endif
			call GroupRemoveUnit(AIR, u2)
		endloop
		call LogoutGroup(AIR)
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	endif
	set t = null
	set AIR = null
	set u2 = null
	set gg = null
endfunction
function ESE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'e003', x, y, 0)
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0RG')
	local real REI =(83 + 17 * level)* .01
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .1, true, function RVI)
	call SaveGroupHandle(HY, h, 0, LoginGroup(260))
	call SaveReal(HY, h, 0, x)
	call SaveReal(HY, h, 1, y)
	call SaveInteger(HY, h, 5, level)
	call SaveUnitHandle(HY, h, 1, triggerUnit)
	set t = null
	call SetUnitVertexColor(dummyUnit, 255, 255, 255, 150)
	call UnitApplyTimedLife(dummyUnit,'BTLF', 6)
	call SetUnitScale(dummyUnit, REI, REI, REI)
	if IsScourgesPlayer(GetOwningPlayer(triggerUnit)) then
		call UnitAddPermanentAbility(dummyUnit,'A019')
		call SetUnitAbilityLevel(dummyUnit,'A019', level)
	else
		call UnitAddPermanentAbility(dummyUnit,'A0E7')
		call SetUnitAbilityLevel(dummyUnit,'A0E7', level)
	endif
	call EnableEffectByTime(B, 8.)
	set F = level
	call IssuePointOrderById(dummyUnit,$D01F9, x, y)
	set triggerUnit = null
	set dummyUnit = null
endfunction
function RXI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	local integer ZCE = LoadInteger(P, GetHandleId(WJE),'BACK')
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
		call RemoveSavedHandle(P, GetHandleId(WJE),'BACK')
	elseif GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if GetEventDamageSource()== WJE and AD < 1 and GetEventDamage()> 0 then
			call SaveInteger(P, GetHandleId(WJE),'BACK', 0)
			call RemoveSavedHandle(P, GetHandleId(WJE),'BACK')
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", WLE, "chest"))
			call UnitDamageTargetEx(WJE, WLE, 2, ZCE)
		endif
	else
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
		call RemoveSavedHandle(P, GetHandleId(WJE),'BACK')
	endif
	set t = null
	set WJE = null
	set WLE = null
endfunction
function BackstabActions takes unit u, unit t returns nothing
	local integer level = GetUnitAbilityLevel(u,'A0DZ')
	local real d
	local unit W_V
	local real ENI
	local integer prevdmg
	local integer RRI
	local integer h
	local integer i
	local integer ms
	if level == 0 or GetUnitAbilityLevel(u,'A36D')== 1 then
		return
	endif
	set d = RAbsBJ(GetUnitFacing(u)-GetUnitFacing(t))
	if d > 180 then
		set d = 360 -d
	endif
	//if LoadInteger(P, GetHandleId(u),'BACK')> 0 then
	//	call SaveInteger(P, GetHandleId(u),'BACK', 0)
	//endif
	//if LoadTriggerHandle(P, GetHandleId(u),'BACK')!= null then
	//	call FlushChildHashtable(HY, GetHandleId(LoadTriggerHandle(P, GetHandleId(u),'BACK')))
	//	call DestroyTrigger(LoadTriggerHandle(P, GetHandleId(u),'BACK'))
	//endif
	if not IsUnitType(t, UNIT_TYPE_STRUCTURE) and not IsUnitIllusion(u) and d <=105 then
		set ENI = .25 * level
		set i = GerHeroMainAttributesValue(u)
		set RRI = R2I(i *(ENI))
		
		call SaveReal(ExtraHT, AEAttackerId[AEI], HTKEY_UNIT_BACKSTAB_VALUE, RRI)
	endif
	set W_V = null
endfunction
function RII takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY,(h), 0))
	local real WIE =(LoadReal(HY,(h), 0))
	local integer HUX =(LoadInteger(HY,(GetHandleId(u)),('A0K9')))
	if HUX < GetUnitAbilityLevel(u,'A0K9')+ 3 then
		set WIE = WIE -0.2
		if WIE <= 0.00 then
			call SaveInteger(HY, GetHandleId(u),'A0K9', HUX + 1)
			call SaveReal(HY, h, 0, 35.)
		else
			call SaveReal(HY, h, 0, WIE * 1.)
		endif
	endif
	set u = null
	set t = null
	return false
endfunction
function RAI takes unit O7I, unit RNI returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerAddCondition(t, Condition(function RII))
	call SaveUnitHandle(HY, GetHandleId(t), 0, O7I)
	call SaveReal(HY, GetHandleId(t), 0, 35.)
	call SaveInteger(HY, GetHandleId(O7I),'A0K9', GetUnitAbilityLevel(RNI,'A0K9')+ 3)
	call SaveTriggerHandle(HY, GetHandleId(O7I),'A0K9', t)
	call DisplayTimedTextToPlayer(GetOwningPlayer(O7I), 0, 0, 10, "|c00FF0000提示|r: 你可以输入指令|c00bd2222-charges|r来开启或关闭充能计数面板")
	set t = null
endfunction
function RBI takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local real IXX =$A+ 30 * GetUnitAbilityLevel(WUE,'A0K9')
	local real x = GetUnitX(targetUnit)-75 * Cos(GetUnitFacing(targetUnit)* bj_DEGTORAD)
	local real y = GetUnitY(targetUnit)-75 * Sin(GetUnitFacing(targetUnit)* bj_DEGTORAD)
	call SetUnitX(WUE, x)
	call SetUnitY(WUE, y)
	call SetUnitFacing(WUE, GetUnitFacing(targetUnit))
	call DestroyEffect(AddSpecialEffect("war3mapImported\\BlinkStrike.mdx", x, y))
	if IsUnitEnemy(targetUnit, GetOwningPlayer(WUE)) then
		call UnitDamageTargetEx(WUE, targetUnit, 1, IXX)
		call SaveBoolean(HY,(GetHandleId(WUE)), 332,(true))
		call WPE(WUE, targetUnit)
	endif
	set WUE = null
	set targetUnit = null
endfunction
function ETE takes nothing returns nothing
	local integer HUX = LoadInteger(HY, GetHandleId(GetTriggerUnit()),'A0K9')
	call SaveInteger(HY, GetHandleId(GetTriggerUnit()),'A0K9', HUX -1)
	if IsPlayerAlly(GetTriggerPlayer(), GetOwningPlayer(GetSpellTargetUnit())) or not UnitHasSpellShield(GetSpellTargetUnit()) then
		call RBI()
	endif
endfunction
function KYE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer HUX = LoadInteger(HY, GetHandleId(u),'A0K9')
	if HUX == 0 then
		if HaveSavedHandle(HY, GetHandleId(u),'A0K9')== false then
			call RAI(u, u)
			set HUX = LoadInteger(HY, GetHandleId(u),'A0K9')
		endif
	endif
	if HUX <= 0 then
		call EXStopUnit(u)
		call InterfaceErrorForPlayer(GetOwningPlayer(u), "能量点数不足")
	else
		call DestroyEffect(AddSpecialEffect("war3mapImported\\BlinkStrike.mdx", GetUnitX(u), GetUnitY(u)))
	endif
endfunction
function PXE takes nothing returns nothing
	if HaveSavedHandle(HY, GetHandleId(GetTriggerUnit()),'A0K9') then
		call SaveInteger(HY, GetHandleId(GetTriggerUnit()),'A0K9', LoadInteger(HY, GetHandleId(GetTriggerUnit()),'A0K9')+ 1)
	else
		call RAI(GetTriggerUnit(), GetTriggerUnit())
	endif
endfunction

// 永久隐身
function LearnSkill__PermanentInvisibility takes nothing returns nothing
	call Learn_HaveCoolDownSkill()
	call UnitAddPermanentInvisibility(GetTriggerUnit())
endfunction
function RFI takes nothing returns boolean
	return(UnitIsDead(GetFilterUnit())== false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and IsUnitAlly(LoadUnitHandle(VV,'A2IS','cast'), GetOwningPlayer(GetFilterUnit())) and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false and IsUnitIllusion(GetFilterUnit())== false)!= null
endfunction
function RGI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer c = LoadInteger(HY, h, 0)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or c <= 0 or GetUnitAbilityLevel(u,'C025')== 0 then
		call LodSystem_ReduceUnitExtraState(u, LoadInteger(HY, h, 1), STATE_SYSTEM_ARMOUR)
		call UnitRemoveAbility(u,'C025')
		call UnitRemoveAbility(u,'D025')
		call FlushChildHashtable(HY, h)
		call RemoveSavedHandle(HY, GetHandleId(u),'A2IS')
		call CleanCurrentTrigger(t)
	else
		call SaveInteger(HY, h, 0, c -1)
	endif
	set t = null
	set u = null
endfunction
function RHI takes nothing returns nothing
	local unit u = GetEnumUnit()
	local trigger t
	local integer h
	local integer hu = GetHandleId(u)
	local integer level = LoadInteger(VV,'A2IS','levl')
	if HaveSavedHandle(HY, hu,'A2IS') then
		set t = LoadTriggerHandle(HY, hu,'A2IS')
		set h = GetHandleId(t)
		call SaveInteger(HY, h, 0, 70)
		call LodSystem_AddUnitExtraState(u, 5 * level, STATE_SYSTEM_ARMOUR)
		call SaveInteger(HY, h, 1, LoadInteger(HY, h, 1)+ 5 * level)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerRegisterDeathEvent(t, u)
		call SaveUnitHandle(HY, h, 0, u)
		call SaveInteger(HY, h, 0, 70)
		call SaveTriggerHandle(HY, hu,'A2IS', t)
		call TriggerAddCondition(t, Condition(function RGI))
		call LodSystem_AddUnitExtraState(u, 5 * level, STATE_SYSTEM_ARMOUR)
		call SaveInteger(HY, h, 1, 5 * level)
		call UnitAddPermanentAbility(u,'C025')
	endif
	set u = null
	set t = null
endfunction
function YGV takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local group g = LoginGroup(261)
	call SaveUnitHandle(VV,'A2IS','cast', u)
	call SaveInteger(VV,'A2IS','levl', GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl", u, "overhead"))
	call GroupEnumUnitsInRange(g, GetWidgetX(u), GetWidgetY(u), 925, Condition(function RFI))
	call ForGroup(g, function RHI)
	call FlushChildHashtable(VV,'A2IS')
	call LogoutGroup(g)
	set g = null
	set u = null
endfunction
function RJI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	call UnitRemoveAbility(u,'A0WO')
	call UnitRemoveAbility(u,'A43G')
	call UnitRemoveAbility(u,'B009')
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set u = null
	set t = null
endfunction
function EUE takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local unit triggerUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(triggerUnit, GetSpellAbilityId())
	call TimerStart(t, 25, false, function RJI)
	call SaveUnitHandle(HY, h, 0, triggerUnit)
	call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\BattleCryCaster.mdx", triggerUnit, "overhead"))
	call UnitAddPermanentAbility(triggerUnit,'A0WO')
	call UnitMakeAbilityPermanent(triggerUnit, true,'A0WM')
	call SetUnitAbilityLevel(triggerUnit,'A0WM', level)
	call SetPlayerAbilityAvailable(GetOwningPlayer(triggerUnit),'A0WO', false)
	if GetSpellAbilityId()=='A43D' then
		call UnitAddPermanentAbility(triggerUnit,'A43G')
		call UnitMakeAbilityPermanent(triggerUnit, true,'A43F')
		call SetUnitAbilityLevel(triggerUnit,'A43F', level)
		call SetPlayerAbilityAvailable(GetOwningPlayer(triggerUnit),'A43G', false)
	endif
	set triggerUnit = null
	set t = null
endfunction
function RKI takes nothing returns nothing
	call UnitDamageTargetEx(J_V, GetEnumUnit(), 1, XK[4])
	call CommonUnitAddStun(GetEnumUnit(), 2., false)
endfunction
function RLI takes unit WUE, player p, unit targetUnit, integer level returns nothing
	local unit dummyUnit = CreateUnit(p,'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local integer E8I
	local group g = LoginGroup(262)
	if GetUnitAbilityLevel(targetUnit,'A3E9')== 1 and IsMagicImmuneUnit(WUE)== false then
		call SaveUnitHandle(VV,'A3E9', 0, targetUnit)
		call SaveUnitHandle(VV,'A3E9', 1, WUE)
		call SaveInteger(VV,'A3E9', 0, level)
		call ExecuteFunc("RMI")
	endif
	set U2 = Player__Hero[GetPlayerId(p)]
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 280, Condition(function DJX))
	call GroupAddUnit(g, targetUnit)
	set J_V = dummyUnit
	set Temp__ArrayUnit[0]= targetUnit
	set Temp__Player = p
	set XK[4]= 25 + level * 50
	call ForGroup(g, function RKI)
	call LogoutGroup(g)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\StormBolt\\StormBoltMissile.mdl", targetUnit, "origin"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\StormBolt\\StormBoltMissile.mdl", targetUnit, "origin"))
	set dummyUnit = null
	set g = null
endfunction
function RPI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player p
	local unit targetUnit
	local integer level
	local unit NIX
	local real x
	local real y
	local real W_E
	local real W0E
	local boolean RQI
	local real NFX
	local real NGX
	local real NAX
	local real NNX
	local real NBX
	local real NCX
	local boolean I1O
	if GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT then
		if IsBlinkAbilityId(GetSpellAbilityId()) then
			call SaveBoolean(HY, h, 0, true)
			call SaveReal(HY, h, 0, GetUnitX(GetTriggerUnit()))
			call SaveReal(HY, h, 1, GetUnitY(GetTriggerUnit()))
		endif
	else
		set p =(LoadPlayerHandle(HY, h, 54))
		set targetUnit = LoadUnitHandle(HY, h, 30)
		set level =(LoadInteger(HY, h, 5))
		set NIX =(LoadUnitHandle(HY, h, 45))
		set x = GetUnitX(NIX)
		set y = GetUnitY(NIX)
		set W_E = GetUnitX(targetUnit)
		set W0E = GetUnitY(targetUnit)
		set RQI = LoadBoolean(HY, h, 0)
		set NFX = LoadReal(HY, h, 0)
		set NGX = LoadReal(HY, h, 1)
		set NAX =1000* .035
		if RQI then
			set W_E = NFX
			set W0E = NGX
		endif
		set NNX = AngleBetweenXY(x, y, W_E, W0E)
		set NBX = x + NAX * Cos(NNX * bj_DEGTORAD)
		set NCX = y + NAX * Sin(NNX * bj_DEGTORAD)
		set I1O =(LoadBoolean(HY, h,$F9))
		call SetUnitX(NIX, NBX)
		call SetUnitY(NIX, NCX)
		call SetUnitFacing(NIX, NNX)
		if GetDistanceBetween(W_E, W0E, NBX, NCX)<= NAX then
			if RQI == false and I1O then
				call RLI(LoadUnitHandle(HY, h, 31), p, targetUnit, level)
			endif
			call KillUnit(NIX)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set targetUnit = null
	set NIX = null
	set p = null
	return false
endfunction
function RSI takes unit WUE, unit targetUnit, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit NIX = CreateUnit(GetOwningPlayer(WUE),'h07Q', GetUnitX(WUE), GetUnitY(WUE), AngleBetweenXY(GetUnitX(WUE), GetUnitY(WUE), GetUnitX(targetUnit), GetUnitY(targetUnit)))
	local boolean I1O = UnitHasSpellShield(targetUnit)== false
	call SaveBoolean(HY, h,$F9,(I1O))
	call SavePlayerHandle(HY, h, 54,(GetOwningPlayer(WUE)))
	call SaveUnitHandle(HY, h, 30, targetUnit)
	call SaveUnitHandle(HY, h, 31, WUE)
	call SaveUnitHandle(HY, h, 45,(NIX))
	call SaveInteger(HY, h, 5,(level))
	call SaveBoolean(HY, h, 0, false)
	call SaveReal(HY, h, 0, 0)
	call SaveReal(HY, h, 1, 0)
	call TriggerRegisterTimerEvent(t, .035, true)
	call TriggerAddCondition(t, Condition(function RPI))
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_SPELL_EFFECT)
	set t = null
	set NIX = null
endfunction
function EWE takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(WJE,'A190')
	call RSI(WJE, WLE, level)
	set WJE = null
	set WLE = null
endfunction
function RMI takes nothing returns nothing
	call T4V(LoadUnitHandle(VV,'A3E9', 0))
	call RSI(LoadUnitHandle(VV,'A3E9', 0), LoadUnitHandle(VV,'A3E9', 1), LoadInteger(VV,'A3E9', 0))
	call FlushChildHashtable(VV,'A3E9')
endfunction
function KZE takes nothing returns nothing
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Bolt\\BoltImpact.mdl", GetTriggerUnit(), T2V(GetTriggerUnit())))
endfunction
function RTI takes nothing returns boolean
	return(GetUnitTypeId(GetFilterUnit())=='n01G') or(GetUnitTypeId(GetFilterUnit())=='n01C') or(GetUnitTypeId(GetFilterUnit())=='n018') or(GetUnitTypeId(GetFilterUnit())=='n004')
endfunction
function EYE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit u
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(WUE), GetUnitY(WUE), 0)
	local integer level = GetUnitAbilityLevel(WUE, GetSpellAbilityId())
	local group g = LoginGroup(263)
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(WUE), Condition(function RTI))
	set u = FirstOfGroup(g)
	call LogoutGroup(g)
	call UnitAddPermanentAbility(dummyUnit,'A0AE')
	call SetUnitAbilityLevel(dummyUnit,'A0AE', level)
	call IssueTargetOrderById(dummyUnit,$D0085, WUE)
	if u != null and UnitAlive(u) then
		call IssueTargetOrderById(dummyUnit,$D0085, u)
	endif
	set g = null
	set WUE = null
	set u = null
	set dummyUnit = null
endfunction
function RUI takes nothing returns boolean
	return IsBearUnit(GetFilterUnit()) and IsUnitIllusion(GetFilterUnit())== false and UnitIsDead(GetFilterUnit())== false
endfunction
function SLE takes nothing returns nothing
	local integer level = GetUnitAbilityLevel(GetTriggerUnit(),'A0A8')
	local group g = LoginGroup(264)
	local unit RWI
	local unit u
	call GroupEnumUnitsOfPlayer(g, GetTriggerPlayer(), Condition(function RUI))
	if FirstOfGroup(g)!= null then
		set RWI = FirstOfGroup(g)
		
		call SetUnitMoveSpeed(RWI, GetUnitDefaultMoveSpeed(RWI)+ 8 * level)
		
		if GetUnitAbilityLevel(RWI,'A3IL')== 0 then
			call UnitAddPermanentAbility(RWI,'A3IL')
		endif
		call SetUnitAbilityLevel(RWI,'A3IL', level)
	endif
	call GroupEnumUnitsOfPlayer(g, GetTriggerPlayer(), TrueBoolexprCondition)
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if GetUnitAbilityLevel(u,'A0KO')> 0 then
			call SetUnitMoveSpeed(u, GetUnitDefaultMoveSpeed(u)+ 20 +$A* level)
		endif
		if IsFamiliarsTypeId(GetUnitTypeId(u)) then
			call RGX(u, level)
		endif
		call GroupRemoveUnit(g, u)
	endloop
	call SetPlayerTechResearched(GetTriggerPlayer(),'Recb', level)
	call LogoutGroup(g)
endfunction
function RYI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 2)
	local real WIE
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if GetEventDamage()> 2 and GetEventDamageSource()!= GetTriggerUnit() and XFX(GetOwningPlayer(GetEventDamageSource())) then
			call SaveReal(HY, h, 785, GetGameTime()* 1.)
			call SaveReal(HY, GetHandleId(u), 785, GetGameTime()* 1.)
			call S9E(GetOwningPlayer(u),'A0A7', false)
		endif
	endif
	set WIE = LoadReal(HY, h, 785)
	if WIE + 3 < GetGameTime() then
		if(LoadInteger(HY, h, 34))== 2 then
			call SaveInteger(HY, h, 34, 1)
			call S9E(GetOwningPlayer(u),'A0A7', true)
		endif
	else
		if(LoadInteger(HY, h, 34))== 1 then
			call SaveInteger(HY, h, 34, 2)
			call S9E(GetOwningPlayer(u),'A0A7', false)
		endif
	endif
	set t = null
	set u = null
	return false
endfunction
function RZI takes unit RWI returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerRegisterUnitEvent(t, RWI, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(t, RWI, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function RYI))
	call SaveUnitHandle(HY, h, 2, RWI)
	call SaveReal(HY, h, 785, .0)
	call SaveInteger(HY, h, 34, 1)
	call S9E(GetOwningPlayer(RWI),'A0A7', true)
	set t = null
endfunction
function R_I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit WLE = LoadUnitHandle(HY, h, 0)
	local unit RWI = LoadUnitHandle(HY, h, 1)
	local integer c = LoadInteger(HY, h, 0)+ 1
	call SaveInteger(HY, h, 0, c)
	if GetHandleId(RWI)!= 0 and(GetUnitAbilityLevel(WLE,'B0C1')> 0 or c == 1) then
		call UnitDamageTargetEx(I_X(RWI), WLE, 2, 30)
	endif
	if UnitIsDead(WLE) or(GetUnitAbilityLevel(WLE,'B0C1')== 0 and c > 1) then
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	elseif c == 1 then
		call TimerStart(t, .5, true, function R_I)
	endif
	set WLE = null
	set RWI = null
	set t = null
endfunction
function R0I takes unit X1O, unit WLE returns nothing
	local unit d = CreateUnit(GetOwningPlayer(X1O),'e00E', GetUnitX(WLE), GetUnitY(WLE), 0)
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, 0, false, function R_I)
	call SaveUnitHandle(HY, h, 0, WLE)
	call SaveUnitHandle(HY, h, 1, X1O)
	call UnitAddAbility(d,'A1GZ')
	call IssueTargetOrderById(d,$D008A, WLE)
	set d = null
	set t = null
endfunction
function SpiritBearAttackActions takes unit R8X, unit WLE returns nothing
	if GetUnitAbilityLevel(R8X,'A33C')> 0 and GetUnitAbilityLevel(R8X,'A36D')== 0 and GetGameTime()> LoadReal(P, GetHandleId(R8X),'A33C') and GetPrdRandom(R8X,'A33C', 20) then
		call SaveReal(P, GetHandleId(R8X),'A33C', GetGameTime()+ 5)
		call R0I(R8X, WLE)
	endif
endfunction
function R3I takes nothing returns boolean
	return IsBearUnit(GetFilterUnit()) and GetUnitTypeId(GetFilterUnit())!='n01G' and UnitIsDead(GetFilterUnit())== false
endfunction
function SyncSpiritBearItem takes nothing returns nothing
	local integer h = GetHandleId(GetOwningPlayer(GetTriggerUnit()))
	local unit u = LoadUnitHandle(HY, h, 334)
	local unit WZV = LoadUnitHandle(HY, h, 333)
	if u != null and not Mode__DeathMatch  then
		call UnitAddItem(WZV, UnitRemoveItemFromSlot(u, 0))
		call UnitAddItem(WZV, UnitRemoveItemFromSlot(u, 1))
		call UnitAddItem(WZV, UnitRemoveItemFromSlot(u, 2))
		call UnitAddItem(WZV, UnitRemoveItemFromSlot(u, 3))
		call UnitAddItem(WZV, UnitRemoveItemFromSlot(u, 4))
		call UnitAddItem(WZV, UnitRemoveItemFromSlot(u, 5))
		if GetUnitAbilityLevel(u,'A398')> 0 then
			call UnitAddPermanentAbility(WZV,'A398')
		endif
	endif
	set u = null
	set WZV = null
endfunction
function R5I takes unit u, integer level, player p, boolean b returns nothing
	if level == 0 then
		return
	endif
	call UnitAddPermanentAbility(u,'A34C')
	call SetUnitAbilityLevel(u,'A34C', level)
	call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A34C', true)
	if b then
		call TriggerRegisterUnitEvent(JJ, u, EVENT_UNIT_SPELL_EFFECT)
	endif
endfunction
function PYE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local group g
	local integer level = GetUnitAbilityLevel(u,'A0A5')
	local integer i
	local unit RWI
	call SetPlayerTechResearched(GetOwningPlayer(GetTriggerUnit()),'R000', level)
	if level > 1 then
		set g = LoginGroup(265)
		call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(u), Condition(function R3I))
		set i = CountUnitsInGroup(g)
		if(i == 1) then
			set RWI = FirstOfGroup(g)
			call AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl", RWI, "chest")
			if(level == 2) then
				call UnitAddMaxLife(RWI, 400)
				call UnitAddPermanentAbility(RWI,'A0A7')
				call RZI(RWI)
			elseif(level == 3) then
				call UnitAddMaxLife(RWI, 500)
				call UnitAddPermanentAbility(RWI,'A33C')
			elseif(level == 4) then
				call UnitAddMaxLife(RWI, 400)
				//call UnitAddPermanentAbility(RWI,'A03A')
				call UnitAddPermanentAbility(RWI,'A0AH')
			endif
			call R5I(RWI, level -1, p, true)
		endif
		call LogoutGroup(g)
	endif
	set g = null
	set u = null
	set RWI = null
endfunction
function R6I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit RWI = LoadUnitHandle(HY, h, 0)
	local unit KKX = LoadUnitHandle(HY, h, 1)
	if UnitIsDead(RWI) then
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	else
		if GetDistanceBetweenUnits(RWI, KKX)>$591 and G3X(KKX)== false then
			call UnitAddPermanentAbility(RWI,'A44D')
			call UnitAddPermanentAbility(RWI,'A44E')
		elseif GetUnitAbilityLevel(RWI,'A44D')> 0 then
			call UnitRemoveAbility(RWI,'A44D')
			call UnitRemoveAbility(RWI,'A44E')
		endif
	endif
	set KKX = null
	set RWI = null
	set t = null
endfunction
function R7I takes unit RWI returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .2, true, function R6I)
	call SaveUnitHandle(HY, h, 0, RWI)
	call SaveUnitHandle(HY, h, 1, Player__Hero[GetPlayerId(GetOwningPlayer(RWI))])
	set t = null
endfunction
function SpellEffect__SummonSpiritBear takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local group g = LoginGroup(266)
	local integer level = GetUnitAbilityLevel(u,'A0A5')
	local integer h = GetHandleId(p)
	local unit RWI
	local integer id = 0
	
	if HaveBear == false then
		set HaveBear = true
	endif
	
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(u), Condition(function RUI))
	if FirstOfGroup(g)== null then
		if(level == 1) then
			set id ='n004'
		elseif(level == 2) then
			set id ='n018'
		elseif(level == 3) then
			set id ='n01C'
		else
			set id ='n01G'
		endif
		set RWI = CreateUnit(GetOwningPlayer(u), id, x, y, GetUnitFacing(u))
		if level == 4 then // 4级熊灵有 33%的额外魔法抗性
			call AddUnitMagicResistance(RWI, 0.33)
		endif
		call R5I(RWI, level -1, p, true)
		call SaveUnitHandle(HY, h, 333, RWI)
		call SyncSpiritBearItem()
		call AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl", RWI, "chest")
		call RZI(RWI)
		call SetUnitAbilityLevel(RWI,'A09Y', level)
		call R7I(RWI)
	else
		set RWI = FirstOfGroup(g)
		call AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl", RWI, "chest")
		call SetWidgetLife(RWI, GetUnitState(RWI, UNIT_STATE_MAX_LIFE))
		call SetUnitPosition(RWI, GetUnitX(u), GetUnitY(u))
	endif
	if GetUnitAbilityLevel(u,'A0A8')> 0 then
		
		call SetUnitMoveSpeed(RWI, GetUnitDefaultMoveSpeed(RWI)+ 8 * GetUnitAbilityLevel(u,'A0A8'))
		
		if GetUnitAbilityLevel(RWI,'A3IL')== 0 then
			call UnitAddPermanentAbility(RWI,'A3IL')
		endif
		call SetUnitAbilityLevel(RWI,'A3IL', GetUnitAbilityLevel(u,'A0A8'))
	endif
	set RWI = null
	call LogoutGroup(g)
	set u = null
	set g = null
endfunction
function SpellEffect__TrueForm takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer i = GetUnitTypeId(u)
	call UnitAddPermanentAbility(u, 'A344')
	call SetPlayerTechResearched(GetOwningPlayer(u),'R001',(GetUnitAbilityLevel(u, GetSpellAbilityId())+ 1))
	if i !='N015' and i !='N014' and i !='N013' then
		call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A344', true)
	else
		call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A344', false)
	endif
	call SetUnitAbilityLevel(u,'A344', GetUnitAbilityLevel(u, GetSpellAbilityId()))
	set u = null
endfunction
// 熊灵的战争咆哮
function I4E takes nothing returns nothing
	local unit hTriggerUnit = GetTriggerUnit()
	local unit d = CreateUnit(GetOwningPlayer(hTriggerUnit),'e00E', GetUnitX(hTriggerUnit), GetUnitY(hTriggerUnit), 0)
	//local group hFindBearGroup
	call UnitAddAbility(d,'A1ED')
	call SetUnitAbilityLevel(d,'A1ED', GetUnitAbilityLevel(hTriggerUnit,'A344')+ GetUnitAbilityLevel(hTriggerUnit,'A34C'))
	call IssueImmediateOrderById(d,$D0277)
	if IsBearUnit(hTriggerUnit) then
		set hTriggerUnit = Player__Hero[GetPlayerId(GetOwningPlayer(hTriggerUnit))]
	//else
	//	set hFindBearGroup = LoginGroup(267)
	//	call GroupEnumUnitsOfPlayer(hFindBearGroup, GetOwningPlayer(hTriggerUnit), Condition(function RUI))
	//	set hTriggerUnit = FirstOfGroup(hFindBearGroup)
	//	call LogoutGroup(hFindBearGroup)
	//	set hFindBearGroup = null
	endif
	// 给主英雄单位再放一次
	if UnitAlive(hTriggerUnit) then
		call SetUnitX(d, GetUnitX(hTriggerUnit))
		call SetUnitY(d, GetUnitY(hTriggerUnit))
		call UnitResetCooldown(d)
		call IssueImmediateOrderById(d, $D0277)
	endif
	set hTriggerUnit = null
	set d = null
endfunction
function R8I takes nothing returns nothing
	local unit RWI
	local unit u
	if GetSpellAbilityId()=='A0A7' then
		set RWI = GetTriggerUnit()
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(RWI))]
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl", GetUnitX(RWI), GetUnitY(RWI)))
		call SetUnitX(RWI, GetUnitX(u)+ GetRandomReal(25, 50)* Cos(GetRandomReal(0, 360)))
		call SetUnitY(RWI, GetUnitY(u)+ GetRandomReal(25, 50)* Sin(GetRandomReal(0, 360)))
		call IssueImmediateOrderByIdToTimed(RWI,$D0004, 0)
	endif
	set RWI = null
	set u = null
endfunction

function M1X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function R8I))
	set t = null
endfunction
function R9I takes unit SZX returns nothing
	local integer TME = GetPlayerId(GetOwningPlayer(SZX))
	if SZX == Player__Hero[TME]and HaveSavedHandle(HY, GetHandleId(GetOwningPlayer(SZX)), 333) and UnitIsDead(LoadUnitHandle(HY, GetHandleId(GetOwningPlayer(SZX)), 333))== false and G3X(SZX)== false then
		call KillUnit(LoadUnitHandle(HY, GetHandleId(GetOwningPlayer(SZX)), 333))
	endif
endfunction
function IVI takes nothing returns nothing
	local location l
	if IsSentinelsPlayer(GetOwningPlayer(GetTriggerUnit())) then
		set l = GetRectCenter(VZ)
	else
		set l = GetRectCenter(GY)
	endif
	if HQX(GetEnumItem())== false then
		call SetItemPositionLoc(GetEnumItem(), l)
	endif
	call RemoveLocation(l)
	set l = null
endfunction
function IEI takes nothing returns nothing
	local integer h = GetHandleId(GetOwningPlayer(GetTriggerUnit()))
	local unit IXI = LoadUnitHandle(HY, h, 334)
	local unit RWI = LoadUnitHandle(HY, h, 333)
	local integer x
	local integer y
	if IXI == null then
		if IsSentinelsPlayer(GetOwningPlayer(RWI)) then
			set x =-6390
			set y =-5615
		else
			set x = 5875
			set y = 5000
		endif
		set IXI = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e01F', x, y, 0)
		call SaveUnitHandle(HY, h, 334, IXI)
	endif
	if HQX(GetEnumItem())== false then
		call UnitAddItem(IXI, GetEnumItem())
	endif
	if GetUnitAbilityLevel(RWI,'A398')> 0 then
		call UnitAddPermanentAbility(IXI,'A398')
	endif
	call ShowUnit(IXI, true)
	set IXI = null
	set RWI = null
endfunction
function IOI takes nothing returns nothing
	local integer GTX = UUV(GetEnumItem())
	if GetWidgetLife(GetEnumItem())> 0 and GTX != AIV then
		if Mode__DeathMatch then
			call IVI()
		else
			call IEI()
		endif
	endif
endfunction
function IRI takes unit R8X, unit SZX returns nothing
	local location l = GetUnitLoc(SZX)
	local rect r = RectFromCenterSizeBJ(l, 400., 400.)
	local unit u = Player__Hero[GetPlayerId(GetOwningPlayer(SZX))]
	local integer level = GetUnitAbilityLevel(u,'A0A5')
	call SetHeroXP(u, GetHeroXP(u)-(GetHeroXP(u)/(125 -(25 * level))), false)
	call UnitDamageTargetEx(R8X, u, 5, 100. * I2R(level))
	call EnumItemsInRect(r, TrueBoolexprCondition, function IOI)
	call RemoveLocation(l)
	call RemoveRect(r)
	set l = null
	set r = null
	set u = null
endfunction
function III takes unit R8X, unit SZX returns nothing
	if IsBearUnit(SZX) then
		call IRI(R8X, SZX)
	endif
endfunction
function IAI takes unit u returns nothing
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call UnitAddAbility(d,'A325')
	call IssueTargetOrderById(d, 852095, u)
	set d = null
endfunction
function INI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer UYX = LoadInteger(HY, h, 100)
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if XFX(GetOwningPlayer(GetEventDamageSource())) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetEventDamageSource())) and J7V == false then
			if J8V == false then
				call UnitRemoveAbility(GetTriggerUnit(),'B0BM')
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			endif
		endif
		if J8V then
			set J8V = false
		endif
		if J7V then
			set J7V = false
		endif
	else
		set UYX = UYX + 1
		call SaveInteger(HY, h, 100, UYX)
		if UYX > level * 2 then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(GetTriggeringTrigger())
		else
			call IAI(LoadUnitHandle(HY, h, 0))
		endif
	endif
	set t = null
	return false
endfunction
function IBI takes nothing returns boolean
	local trigger HLR = null
	local unit u = GetFilterUnit()
	if IsUnitEnemy(u, Temp__Player) and GetUnitAbilityLevel(u,'A04R')== 0 and GetUnitAbilityLevel(u,'B0BM')> 0 then
		set HLR = CreateTrigger()
		call TriggerRegisterUnitEvent(HLR, u, EVENT_UNIT_DAMAGED)
		call TriggerRegisterDeathEvent(HLR, u)
		call TriggerRegisterTimerEvent(HLR, .5, true)
		call TriggerRegisterTimerEvent(HLR, 0, false)
		call TriggerAddCondition(HLR, Condition(function INI))
		call SaveInteger(HY, GetHandleId(HLR), 0, WC)
		call SaveUnitHandle(HY, GetHandleId(HLR), 0, u)
		set HLR = null
	endif
	set u = null
	return false
endfunction
function ICI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	set Temp__Player = LoadPlayerHandle(P, WFV, 0)
	set WC = LoadInteger(P, WFV, 0)
	call GroupEnumUnitsInRange(AK, LoadReal(P, WFV, 0), LoadReal(P, WFV, 1), 1000, Condition(function IBI))
	call DestroyTimerAndFlushHT_P(t)
	set t = null
endfunction
function IDI takes nothing returns boolean
	local unit t = GetFilterUnit()
	if IsUnitEnemy(t, Temp__Player) and GetUnitAbilityLevel(t,'A04R')== 0 and IsMagicImmuneUnit(t)== false and UnitAlive(t) and IsUnitType(t, UNIT_TYPE_STRUCTURE)== false then
		call UnitDamageTargetEx(I_X(Temp__ArrayUnit[0]), t, XK[0], 70 +$A* GetUnitAbilityLevel(Temp__ArrayUnit[1],'A1A9'))
		call UnitShareVision(t, Temp__Player, true)
		call IssueTargetOrderById(Temp__ArrayUnit[1], 852095, t)
		call UnitShareVision(t, Temp__Player, false)
	endif
	set t = null
	return false
endfunction
function IFI takes nothing returns boolean
	local integer WFV
	local unit d = null
	local unit t = GetFilterUnit()
	local real x
	local real y
	if GetUnitTypeId(t)=='h07U'then
		set WFV = GetHandleId(t)
		if LoadBoolean(P,'A1AA', WFV) then
			set x = GetWidgetX(t)
			set y = GetWidgetY(t)
			set d = CreateUnit(GetOwningPlayer(t),'h07Z', x, y, 0)
			call SetUnitTimeScale(d, 2.5)
			call UnitApplyTimedLife(d,'BTLF', 2)
			call GroupEnumUnitsInRange(BK, x, y, 525, Condition(function IDI))
			call SaveBoolean(P,'A1AA', WFV, false)
			call SaveBoolean(P, WFV,'A1AA', false)
			call SetUnitAnimationByIndex(t, 3)
			set d = null
		endif
	endif
	set t = null
	return false
endfunction
function JGE takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local real x = GetWidgetX(u)
	local real y = GetWidgetY(u)
	local unit d = CreateUnit(GetOwningPlayer(u),'h07Z', x, y, 0)
	local integer WFV = GetHandleId(t)
	if GetUnitTypeId(u)=='e00E' then
		set u = Player__Hero[GetPlayerId(Temp__Player)]
	endif
	call SetUnitTimeScale(d, 2.5)
	call UnitApplyTimedLife(d,'BTLF', 2)
	set Temp__Player = GetOwningPlayer(u)
	set Temp__ArrayUnit[0]= u
	set Temp__ArrayUnit[1]= CreateUnit(Temp__Player,'e00E', x, y, 0)
	set XK[0]= 1
	call UnitAddAbility(Temp__ArrayUnit[1],'A1A9')
	call GroupEnumUnitsInRange(AK, x, y, 525, Condition(function IDI))
	set XK[0]= 2
	call GroupEnumUnitsOfPlayer(AK, GetOwningPlayer(u), Condition(function IFI))
	call SavePlayerHandle(P, WFV, 0, Temp__Player)
	call SaveReal(P, WFV, 0, x)
	call SaveInteger(P, WFV, 0, GetUnitAbilityLevel(u,'A1AA'))
	call SaveReal(P, WFV, 1, y)
	call SaveUnitHandle(P, WFV, 2, u)
	call TimerStart(t, .65, false, function ICI)
	set d = null
	set u = null
	set t = null
endfunction
function IGI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit TJX =(LoadUnitHandle(HY, h, 335))
	local boolean IHI =(LoadBoolean(HY, h, 336))
	if GetTriggerEventId()== EVENT_UNIT_SPELL_ENDCAST then
		call SaveInteger(HY,(GetHandleId((WUE))),(4269), 2)
		call SaveBoolean(HY,(GetHandleId(TJX)), 337,(true))
		call SaveBoolean(P, GetHandleId(TJX),'A1AA', false)
		call IssueImmediateOrderById(TJX,$D0004)
		if GetUnitAbilityLevel(TJX,'Aloc')== 0 then
			call SetUnitAnimation(TJX, "stand")
		else
			call SetUnitAnimationByIndex(TJX, 3)
		endif
		if IHI then
			call ShowUnit(TJX, false)
			call KillUnit(TJX)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if IHI then
			call SetUnitFacing(TJX, GetUnitFacing(WUE))
		endif
	endif
	set t = null
	set TJX = null
	set WUE = null
	return false
endfunction
function IJI takes unit u, unit s, boolean b returns nothing
	local trigger t = CreateTrigger()
	local integer WFV = GetHandleId(t)
	call UnitRemoveAbility(u,'A2LK')
	call SetUnitAnimation(u, "spell slam")
	call QueueUnitAnimation(u, "spell slam")
	call SaveUnitHandle(HY, WFV, 335, u)
	call SaveUnitHandle(HY, WFV, 2, s)
	if b then
		call SaveBoolean(HY, WFV, 336, true)
		call TriggerRegisterTimerEvent(t, .1, true)
	endif
	call TriggerRegisterUnitEvent(t, s, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function IGI))
	set WFV = GetHandleId(u)
	call SaveBoolean(P,'A1AA', WFV, true)
	call SaveBoolean(P, WFV,'A1AA', true)
	set t = null
endfunction
function IKI takes nothing returns boolean
	local unit t = GetFilterUnit()
	if GetUnitTypeId(t)=='h07U'then
		if IssueImmediateOrderById(t,$D0004) then
			call IJI(t, Temp__ArrayUnit[0], false)
		endif
		call SaveBoolean(P, 99999, 99997, false)
	endif
	set t = null
	return false
endfunction
function KVE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit TJX = null
	if GetUnitTypeId(WUE)=='e00E'then
		set Temp__ArrayUnit[0]= Player__Hero[GetPlayerId(GetOwningPlayer(WUE))]
	elseif GetUnitTypeId(WUE)=='h07U' then
		set Temp__ArrayUnit[0]= LoadUnitHandle(P, GetHandleId(WUE),'A1A8')
		if IssueImmediateOrderById(Temp__ArrayUnit[0],$D007C)== false then
			call UnitAddAbility(WUE,'A2LK')
			call SetUnitAnimation(WUE, "stand")
			call IssueImmediateOrderById(WUE,$D0004)
			call SaveBoolean(P, GetHandleId(WUE),'A1AA', false)
			call SaveBoolean(P,'A1AA', GetHandleId(WUE), false)
			set WUE = null
			return
		endif
	else
		set Temp__ArrayUnit[0]= WUE
	endif
	call SaveBoolean(P, 99999, 99997, true)
	call GroupEnumUnitsOfPlayer(AK, GetOwningPlayer(WUE), Condition(function IKI))
	if LoadBoolean(P, 99999, 99997) then
		set TJX = CreateUnit(GetOwningPlayer(WUE),'h07U', GetUnitX(WUE), GetUnitY(WUE), GetUnitFacing(WUE))
		call UnitAddPermanentAbility(TJX,'Aloc')
		call UnitAddPermanentAbility(TJX,'Aetl')
		call SetUnitPosition(TJX, GetUnitX(WUE), GetUnitY(WUE))
		call SetUnitScale(TJX, 1.4, 1.4, 1.4)
		call IssueImmediateOrderById(TJX,$D0004)
		call IJI(TJX, Temp__ArrayUnit[0], true)
		set TJX = null
	endif
	set WUE = null
endfunction
function ILI takes nothing returns nothing
	if DVX(GetEnumUnit()) then
		return
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A1CA')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'A1CA')
		call UnitRemoveAbility(GetEnumUnit(),'B0BP')
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A1C9')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'A1C9')
		call UnitRemoveAbility(GetEnumUnit(),'B0BP')
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A1CB')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'A1CB')
		call UnitRemoveAbility(GetEnumUnit(),'B0BP')
	endif
	if GetUnitAbilityLevel(GetEnumUnit(),'A1CC')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'A1CC')
		call UnitRemoveAbility(GetEnumUnit(),'B0BP')
	endif
	//call KRX(GetEnumUnit(), 0)
endfunction
function IMI takes nothing returns nothing
	if DVX(GetEnumUnit()) then
		return
	endif
	if J0V == 1 then
		if GetUnitAbilityLevel(GetEnumUnit(),'A1CA')== 0 then
			call UnitAddPermanentAbility(GetEnumUnit(),'A1CA')
		endif
	elseif J0V == 2 then
		if GetUnitAbilityLevel(GetEnumUnit(),'A1C9')== 0 then
			call UnitAddPermanentAbility(GetEnumUnit(),'A1C9')
		endif
	elseif J0V == 3 then
		if GetUnitAbilityLevel(GetEnumUnit(),'A1CB')== 0 then
			call UnitAddPermanentAbility(GetEnumUnit(),'A1CB')
		endif
	elseif J0V == 4 then
		if GetUnitAbilityLevel(GetEnumUnit(),'A1CC')== 0 then
			call UnitAddPermanentAbility(GetEnumUnit(),'A1CC')
		endif
	endif
	if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
		//call KRX(GetEnumUnit(), R2I((I2R(GetHeroAgi(GetEnumUnit(), true))/ 7)* I2R((J0V * 20 + 20)/ 100 )))
	endif
endfunction

// 每次查询单位身上的Buff来源, 如果来源不是自己, 则不做动作.
// 如果没有来源, 则将来源设置为自己.
// 自然秩序
function NaturalOrderTimerLoop takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local unit trigUnit =(LoadUnitHandle(HY, h, 2))
	local group lastGroup =(LoadGroupHandle(HY, h, 340))
	local real x = GetUnitX(trigUnit)
	local real y = GetUnitY(trigUnit)
	local real value
	local group tempGroup
	local unit firstUnit = null
	local integer uh
	local unit sourceUnit = null
	local integer level = 0
	local real data 

	// 如果单位消失则关闭触发器
	if trigUnit == null or GetUnitTypeId(trigUnit) == 0 then //or GetUnitTypeId(trigUnit)!='E02X' 
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(trig)

		// 清空数据
		loop
			set firstUnit = FirstOfGroup(lastGroup)
		exitwhen firstUnit == null
			call GroupRemoveUnit(lastGroup, firstUnit) 
			set uh = GetHandleId(firstUnit)
			if LoadUnitHandle(ExtraHT, uh, 'A1CD') == trigUnit then 
				call RestoreUnitBaseResistance(firstUnit)
				call RemoveSavedHandle(ExtraHT, uh, 'A1CD')
				call RemoveSavedInteger(ExtraHT, uh, 'A1CD')
			endif
		endloop

		call LogoutGroup(lastGroup)
		set trig = null
		set trigUnit = null
		set lastGroup = null
		return false
	endif

	if UnitAlive(trigUnit) and not IsUnitBreak(trigUnit) then

		if LoadBoolean(HY, h, 0) then
			call RemoveSavedBoolean(HY, h, 0)
		endif

		set Temp__Player = GetOwningPlayer(trigUnit)
		set level = GetUnitAbilityLevel(trigUnit, 'A1CD')
		set data = -0.2 - 0.2 * level
		set tempGroup = LoginGroup(268)
		set EnumUnitMaximum = 0
		call GroupEnumUnitsInRange(tempGroup, x, y, 325 + MAX_UNIT_COLLISION, null)
		loop
			set firstUnit = FirstOfGroup(tempGroup)
		exitwhen firstUnit == null
			call GroupRemoveUnit(tempGroup, firstUnit)
			// 友军 存活 非建筑 非守卫 非远古
			if IsUnitInRangeXY(firstUnit, x, y, 325.) and IsUnitEnemy(firstUnit, Temp__Player) and IsNoAncientOrBear(firstUnit) and IsAliveNotStrucNotWard(firstUnit) then
				set uh = GetHandleId(firstUnit)
				set sourceUnit = LoadUnitHandle(ExtraHT, uh, 'A1CD') // 获取目标单位的Buff来源
				if sourceUnit == null then // 如果没有来源, 则将来源设置为自己.
					call SaveUnitHandle(ExtraHT, uh, 'A1CD', trigUnit)
					call SaveInteger(ExtraHT, uh, 'A1CD', level)
					call ReduceUnitBaseResistance(firstUnit, data)
				elseif sourceUnit != trigUnit or level > LoadInteger(ExtraHT, uh, 'A1CD') then
					if level > LoadInteger(ExtraHT, uh, 'A1CD') then // 如果等级>原有光环 则进行覆盖
						call RestoreUnitBaseResistance(firstUnit)
						call ReduceUnitBaseResistance(firstUnit, data)
						call SaveUnitHandle(ExtraHT, uh, 'A1CD', trigUnit)
						call SaveInteger(ExtraHT, uh, 'A1CD', level)
					endif
				endif
				set EnumUnitMaximum = EnumUnitMaximum + 1
				set EnumUnits[EnumUnitMaximum] = firstUnit
			endif
		endloop
	
		call GroupAddEnumUnits(tempGroup)
		loop
			set firstUnit = FirstOfGroup(lastGroup)
		exitwhen firstUnit == null
			call GroupRemoveUnit(lastGroup, firstUnit)
			if not IsUnitInGroup(firstUnit, tempGroup) then // 如果不在组内 就表示离开了Buff范围
				set uh = GetHandleId(firstUnit)
				if LoadUnitHandle(ExtraHT, uh, 'A1CD') == trigUnit then 
					call RestoreUnitBaseResistance(firstUnit)
					call RemoveSavedHandle(ExtraHT, uh, 'A1CD')
					call RemoveSavedInteger(ExtraHT, uh, 'A1CD')
				endif
			endif
		endloop

		set sourceUnit = null
		call SaveGroupHandle(HY, h, 340,(tempGroup))
		call LogoutGroup(lastGroup)

	elseif not LoadBoolean(HY, h, 0) then
		call SaveBoolean(HY, h, 0, true)

		// 清空数据
		loop
			set firstUnit = FirstOfGroup(lastGroup)
		exitwhen firstUnit == null
			call GroupRemoveUnit(lastGroup, firstUnit) 
			set uh = GetHandleId(firstUnit)
			if LoadUnitHandle(ExtraHT, uh, 'A1CD') == trigUnit then 
				call RestoreUnitBaseResistance(firstUnit)
				call RemoveSavedHandle(ExtraHT, uh, 'A1CD')
				call RemoveSavedInteger(ExtraHT, uh, 'A1CD')
			endif
		endloop

		set tempGroup = LoginGroup(268)
		call SaveGroupHandle(HY, h, 340,(tempGroup))
		call LogoutGroup(lastGroup)

	endif

	set firstUnit = null
	
	set trig = null
	set trigUnit = null
	set lastGroup = null
	set tempGroup = null
	return false
endfunction
function GetSkill_NaturalOrder takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit sourceUnit = GetTriggerUnit()
	
	call UnitAddPermanentAbility(sourceUnit,'A1CQ')
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function NaturalOrderTimerLoop))
	call SaveUnitHandle(HY, h, 2, sourceUnit)
	call SaveGroupHandle(HY, h, 340, LoginGroup(270))

	set t = null
	set sourceUnit = null
endfunction
function ISI takes nothing returns nothing
	local real x1 = J3V
	local real y1 = J4V
	local real x2 = J5V
	local real y2 = J6V
	local real x3 = GetUnitX(GetEnumUnit())
	local real y3 = GetUnitY(GetEnumUnit())
	local real u =((x3 -x1)*(x2 -x1)+(y3 -y1)*(y2 -y1))/((x1 -x2)*(x1 -x2)+(y1 -y2)*(y1 -y2))
	local real x4 = x1 + u *(x2 -x1)
	local real y4 = y1 + u *(y2 -y1)
	local real WER = GetUnitState(GetEnumUnit(), UNIT_STATE_MAX_LIFE)* .35 / 2
	if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
		call SetUnitPosition(GetEnumUnit(), x4, y4)
	else
		call SetUnitX(GetEnumUnit(), x4)
		call SetUnitY(GetEnumUnit(), y4)
	endif
	call U1V(J1V, 852095, GetEnumUnit())
	call UnitDamageTargetEx(J2V, GetEnumUnit(), 1, WER)
	call UnitDamageTargetEx(J2V, GetEnumUnit(), 2, WER)
	if VI > 0 and UnitIsDead(GetEnumUnit())== false then
		call AddAbilityToTimed(GetEnumUnit(),'A43L', 1, VI + 3., 0)
		call AddAbilityToTimed(GetEnumUnit(),'A44E', 1, VI + 3., 0)
	endif
endfunction
function ITI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local real x0 = LoadReal(HY, h, 282)
	local real y0 = LoadReal(HY, h, 283)
	local real a0 = LoadReal(HY, h, 341)
	local integer i = 0
	local real x
	local real y
	local group g = LoginGroup(271)
	local group D7R = LoginGroup(272)
	local integer level = LoadInteger(HY, h, 0)
	local boolean MDR = LoadBoolean(HY, h, 2)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set U2 = WUE
	set J2V = WUE
	set J1V = CreateUnit(GetOwningPlayer(WUE),'e00E', x0, y0, 0)
	call UnitAddPermanentAbility(J1V,'A43M')
	call SetUnitAbilityLevel(J1V,'A43M', level)
	if MDR then
		set VI = level
	else
		set VI = 0
	endif
	loop
	exitwhen i >$B
		set x = x0 + i *$C8* Cos(a0)
		set y = y0 + i *$C8* Sin(a0)
		call ABX("Abilities\\Spells\\Orc\\EarthQuake\\EarthQuakeTarget.mdl", x, y, 1.6)
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl", x, y -$FA))
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl", x, y))
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl", x +$FA, y))
		call KillDestructablesInCircle(x, y, 300)
		call GroupEnumUnitsInRange(g, x, y, 325, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call GroupAddGroup(g, D7R)
		call GroupClear(g)
		set i = i + 1
	endloop
	set J3V = x0
	set J4V = y0
	set J5V = x
	set J6V = y
	call ForGroup(D7R, function ISI)
	call LogoutGroup(D7R)
	call LogoutGroup(g)
	set t = null
	set WUE = null
	set g = null
	set D7R = null
	return false
endfunction
function IUI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local real a = LoadReal(HY, h, 137)
	local real x0 = LoadReal(HY, h, 282)
	local real y0 = LoadReal(HY, h, 283)
	local real a0
	local real IWI
	local real IYI
	local real IZI
	local real I_I
	local real I0I
	local real I1I
	local real I2I
	local real I3I
	local real I4I
	local real I5I
	local real I6I
	local real I7I
	local real x
	local real y
	local integer level
	local ubersplat N4O
	local integer EVX = GetTriggerEvalCount(t)
	local boolean MDR = LoadBoolean(HY, h, 2)
	set x = x0 +$C8* EVX * Cos(a)
	set y = y0 +$C8* EVX * Sin(a)
	set N4O = CreateUbersplat(x, y, "THNE", 255, 255, 255, 255, false, false)
	call SetUbersplatRenderAlways(N4O, true)
	set IWI = x +$FA* Cos(bj_DEGTORAD *(a * bj_RADTODEG -45))
	set IYI = y +$FA* Sin(bj_DEGTORAD *(a * bj_RADTODEG -45))
	set IZI = x +$FA* Cos(bj_DEGTORAD *(a * bj_RADTODEG + 45))
	set I_I = y +$FA* Sin(bj_DEGTORAD *(a * bj_RADTODEG + 45))
	set I0I = x -125 * Cos(bj_DEGTORAD *(a * bj_RADTODEG -45))
	set I1I = y -125 * Sin(bj_DEGTORAD *(a * bj_RADTODEG -45))
	set I2I = x -125 * Cos(bj_DEGTORAD *(a * bj_RADTODEG + 45))
	set I3I = y -125 * Sin(bj_DEGTORAD *(a * bj_RADTODEG + 45))
	set I4I = x
	set I5I = y
	set I6I = x
	set I7I = y
	call A8X(GetOwningPlayer(WUE), 4, x, y, 500)
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl", IWI, IYI))
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl", IZI, I_I))
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl", I0I, I1I))
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl", I2I, I3I))
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl", I4I, I5I))
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl", I6I, I7I))
	if GetTriggerEvalCount(t)>$B then
		set x0 = LoadReal(HY, h, 282)
		set y0 = LoadReal(HY, h, 283)
		set a0 = LoadReal(HY, h, 341)
		set level = LoadInteger(HY, h, 0)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .5, false)
		call TriggerAddCondition(t, Condition(function ITI))
		call SaveUnitHandle(HY, h, 2, WUE)
		call SaveBoolean(HY, h, 2, MDR)
		call SaveInteger(HY, h, 0, level)
		call SaveReal(HY, h, 282, x0 * 1.)
		call SaveReal(HY, h, 283, y0 * 1.)
		call SaveReal(HY, h, 341, a0 * 1.)
	endif
	set t = null
	set WUE = null
	set N4O = null
	return false
endfunction
function E1E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = Atan2(y -GetUnitY(WUE), x -GetUnitX(WUE))
	local boolean b = GetSpellAbilityId()=='A43J'
	if b then
		call TriggerRegisterTimerEvent(t, .08, true)
	else
		call TriggerRegisterTimerEvent(t, .22, true)
	endif
	call TriggerAddCondition(t, Condition(function IUI))
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	call SaveBoolean(HY, h, 2, b)
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveReal(HY, h, 6, GetUnitX(WUE)* 1.)
	call SaveReal(HY, h, 7, GetUnitY(WUE)* 1.)
	call SaveReal(HY, h, 137, a * 1.)
	call SaveReal(HY, h, 282, GetUnitX(WUE)* 1.)
	call SaveReal(HY, h, 283, GetUnitY(WUE)* 1.)
	call SaveReal(HY, h, 341, a * 1.)
	set t = null
	set WUE = null
endfunction
function I8I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local unit u = LoadUnitHandle(P, WFV, 0)
	call LodSystem_ReduceUnitExtraState(u, LoadInteger(P, WFV, 3), STATE_SYSTEM_DAMAGE)
	call J8X(u, R2I(LoadReal(P, WFV, 0)))
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set u = null
endfunction
function I9I takes nothing returns boolean
	local unit t = GetFilterUnit()
	local group g = LoadGroupHandle(P, XK[0], 2)
	if UnitAlive(t) and IsUnitEnemy(Temp__ArrayUnit[0], GetOwningPlayer(t)) and GetUnitAbilityLevel(t,'A04R')== 0 and IsUnitInGroup(t, g)== false and IsUnitType(t, UNIT_TYPE_STRUCTURE)== false then
		if IsUnitType(t, UNIT_TYPE_HERO) then
			call SaveInteger(P, XK[0], 4, LoadInteger(P, XK[0], 4)+ 1)
		else
			call SaveInteger(P, XK[0], 3, LoadInteger(P, XK[0], 3)+ 1)
		endif
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl", t, "chest"))
		call UnitDamageTargetEx(Temp__ArrayUnit[0], t, 1, XK[1])
		call GroupAddUnit(g, t)
	endif
	set g = null
	set t = null
	return false
endfunction
function AVI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer i3
	local integer i2
	local integer i1
	local unit u = LoadUnitHandle(P, WFV, 0)
	local unit d = LoadUnitHandle(P, WFV, 1)
	local real x2 = GetWidgetX(u)
	local real y2 = GetWidgetY(u)
	local real x1 = GetWidgetX(d)
	local real y1 = GetWidgetY(d)
	local real radian = Atan2(y2 -y1, x2 -x1)
	if LoadBoolean(P, GetHandleId(d),'A1AA') then
		set d = null
		set u = null
		set t = null
		return
	endif
	set x1 = x1 +$F* Cos(radian)
	set y1 = y1 +$F* Sin(radian)
	call SetUnitX(d, x1)
	call SetUnitY(d, y1)
	call SetUnitFacing(d, radian * bj_RADTODEG)
	set Temp__ArrayUnit[0]= u
	set XK[0]= WFV
	set XK[1]= LoadInteger(P, WFV, 2)
	call GroupEnumUnitsInRange(AK, x1, y1, 300, Condition(function I9I))
	if  100 > SquareRoot((x1 -x2)*(x1 -x2)+(y1 -y2)*(y1 -y2)) then
		set i3 = LoadInteger(P, WFV, 1)
		set i2 = LoadInteger(P, WFV, 3)
		set i1 = LoadInteger(P, WFV, 4)
		if i1 + i2 > 0 then
			set x1 =(i2 + i1 * 5)
			set i3 = i2 *(3 * i3 + 3)+ i1 *$A* i3
			call WJV(u,'C015','C015', 9)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl", u, "chest"))
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl", u, "origin"))
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl", u, "hand,left"))
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl", u, "hand,right"))
			call SaveInteger(P, WFV, 3, i3)
			call SaveReal(P, WFV, 0, x1)
			call J6X(u, R2I(x1))
			call LodSystem_AddUnitExtraState(u, i3, STATE_SYSTEM_DAMAGE)
			call TimerStart(t, 9, false, function I8I)
		else
			call DestroyTimerAndFlushHT_P(t)
		endif
		set WFV = GetHandleId(u)
		set i1 = LoadInteger(P, WFV,'A1A8')
		call SaveInteger(P, WFV,'A1A8', i1 -1)
		if i1 == 1 then
			call UnitRemoveAbility(u,'A21J')
			call S9E(GetOwningPlayer(u),'A1A8', true)
		endif
		call FlushChildHashtable(P, GetHandleId(d))
		call RemoveUnit(d)
	endif
	set d = null
	set u = null
	set t = null
endfunction
function AncestralSpiritLoop takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(P, WFV, 0)
	local unit u = LoadUnitHandle(P, WFV, 0)
	local unit d = LoadUnitHandle(P, WFV, 1)
	local real x = GetWidgetX(d)
	local real y = GetWidgetY(d)
	set Temp__ArrayUnit[0]= u
	set XK[0]= WFV
	set XK[1]= LoadInteger(P, WFV, 2)
	call GroupEnumUnitsInRange(AK, x, y, 300, Condition(function I9I))
	if UYX == 80 or LoadBoolean(P, GetHandleId(u),'A1A8') or LoadBoolean(P, GetHandleId(d),'A1A8') then
		call UnitAddAbility(d,'Aloc')
		call SetUnitAnimationByIndex(d, 1)
		call IssueImmediateOrderById(d,$D0004)
		call SaveBoolean(P, WFV, 0, true)
		call TimerStart(t, .025, true, function AVI)
		set d = null
		set u = null
		set t = null
		return
	endif
	call SetUnitMoveSpeed(d, GetUnitMoveSpeedEx(u))
	call SaveInteger(P, WFV, 0, UYX + 1)
	set d = null
	set u = null
	set t = null
endfunction
function AXI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(P, GetHandleId(t), 0)
	call UnitRemoveAbility(u,'A21J')
	call UnitAddPermanentAbility(u,'A21J')
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set u = null
endfunction
function YIV takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	call SaveUnitHandle(P, GetHandleId(t), 0, u)
	call SaveBoolean(P, GetHandleId(u),'A1A8', true)
	call TimerStart(t, 0, false, function AXI)
	set t = null
	set u = null
endfunction
function YRV takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local unit d = CreateUnit(p,'h07U', GetSpellTargetX(), GetSpellTargetY(), GetUnitFacing(u)-$B4)
	local integer WFV = GetHandleId(t)
	local integer WUV = GetUnitAbilityLevel(u,'A1A8')
	local integer id
	call UnitAddAbility(d,'Aloc')
	call UnitRemoveAbility(d,'Aloc')
	call ShowUnit(d, false)
	call ShowUnit(d, true)
	call SaveBoolean(P, WFV, 0, false)
	call SaveUnitHandle(P, WFV, 0, u)
	call SaveUnitHandle(P, WFV, 1, d)
	call SaveGroupHandle(P, WFV, 2, LoginGroup(273))
	call SaveInteger(P, WFV, 0, 0)
	call SaveInteger(P, WFV, 1, WUV)
	call SaveInteger(P, WFV, 2, 20 + 40 * WUV)
	call SaveInteger(P, WFV, 3, 0)
	call SaveInteger(P, WFV, 4, 0)
	set WFV = GetHandleId(u)
	call SaveBoolean(P, WFV,'A1A8', false)
	call SaveInteger(P, WFV,'A1A8', LoadInteger(P, WFV,'A1A8')+ 1)
	call SaveUnitHandle(P, WFV,'A1A8', d)
	call S9E(p,'A1A8', false)
	call UnitAddAbility(u,'A21J')
	call TriggerRegisterUnitEvent(JJ, d, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterUnitEvent(JJ, d, EVENT_UNIT_SPELL_CAST)
	call UnitAddAbility(d,'A21J')
	call UnitAddAbility(d,'Aetl')
	if GetUnitAbilityLevel(u,'A1AA')> 0 then
		call UnitAddAbility(d,'A2LK')
	endif
	if GetUnitAbilityLevel(u,'A1CD')> 0 then
		call UnitAddPermanentAbility(d,'A1CQ')
	endif
	call SaveUnitHandle(P, GetHandleId(d),'A1A8', u)
	call TimerStart(t, .1, true, function AncestralSpiritLoop)
	set d = null
	set u = null
	set t = null
	set p = null
endfunction
function AOI takes nothing returns nothing
	local unit targetUnit = GetOrderTargetUnit()
	local real x
	local real y
	if GetTriggerEventId()== EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER then
		set x = GetUnitX(GetOrderTargetUnit())
		set y = GetUnitY(GetOrderTargetUnit())
	else
		set x = GetOrderPointX()
		set y = GetOrderPointY()
	endif
	if GetDistanceBetween(GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), x, y)< 700 then
		call PlaySoundAtPoint(FE, x, y)
	endif
	set targetUnit = null
endfunction
function ARIOrderI takes nothing returns boolean
	if GetIssuedOrderId()==$D0048 then
		call AOI()
	endif
	return false
endfunction
function MOE takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEvent(t, GetOwningPlayer(GetTriggerUnit()), EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER, TrueBoolexprCondition)
	call TriggerRegisterPlayerUnitEvent(t, GetOwningPlayer(GetTriggerUnit()), EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER, TrueBoolexprCondition)
	call TriggerAddCondition(t, Condition(function ARIOrderI))
	set t = null
endfunction
function AII takes nothing returns boolean
	return IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0) and not IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) and UnitAlive(GetFilterUnit())
endfunction
function AAI takes unit u returns nothing
	local integer lv = GetUnitAbilityLevel(u,'A06B')+ GetUnitAbilityLevel(u,'A471')
	local real ABI
	local real ACI
	local group g = LoginGroup(274)
	local unit hFirstUnit
	local unit d = I_X(u)
	if lv == 1 then
		set ABI = 500
		set ACI = 260
	elseif lv == 2 then
		set ABI = 650
		set ACI = 300
	elseif lv == 3 then
		set ABI = 850
		set ACI = 340
	elseif lv == 4 then
		set ABI =$47E
		set ACI = 380
	endif
	set U2 = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 525, Condition(function AII))
	loop
		set hFirstUnit = FirstOfGroup(g)
	exitwhen hFirstUnit == null
		if IsUnitInRange(hFirstUnit, u, 205) then
			call IOX(d, hFirstUnit, 2, ABI, 0)
		else
			call IOX(d, hFirstUnit, 2, ACI, 0)
		endif
		call GroupRemoveUnit(g, hFirstUnit)
	endloop
	call LogoutGroup(g)
	call SaveBoolean(HY, GetHandleId(u),'suic', true)
	call EPX(u,'A06B', .1)
	set d = null
	set g = null
	set hFirstUnit = null
endfunction
function FKE takes nothing returns nothing
	call AAI(GetTriggerUnit())
endfunction
function W3X takes nothing returns nothing
	call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", GetUnitX(U2), GetUnitY(U2)))
	call AAI(U2)
endfunction
function LQE takes nothing returns nothing
	call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, "你可以使用 -show 命令将技能遥控炸弹切换至其副技能集中引爆")
	if(GetUnitAbilityLevel(GetTriggerUnit(),'A0AK')== 1 or GetUnitAbilityLevel(GetTriggerUnit(),'A1FY')== 1) then
		call UnitAddPermanentAbility(GetTriggerUnit(),'A1WF')
	endif
endfunction
function ADI takes nothing returns boolean
	return(IsUnitEnemy(GetFilterUnit(), LoadPlayerHandle(VV,'A0AM', 1)) and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0)!= null
endfunction
function AFI takes nothing returns nothing
	call UnitDamageTargetEx(LoadUnitHandle(VV,'A0AM', 0), GetEnumUnit(), 1, LoadReal(VV,'A0AM', 0))
endfunction
function AGI takes unit u, boolean AHI returns nothing
	local real ZCE = .0
	local integer WPV = GetUnitTypeId(u)
	local group g
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	if WPV =='o018' then
		set ZCE = 300.
	elseif WPV =='o002'then
		set ZCE = 450.
	elseif WPV =='o00B'then
		set ZCE = 600.
	elseif WPV =='o01B' then
		set ZCE = 750.
	endif
	set g = LoginGroup(275)
	call SaveUnitHandle(VV,'A0AM', 0, u)
	call SavePlayerHandle(VV,'A0AM', 1, GetOwningPlayer(u))
	call GroupEnumUnitsInRange(g, x, y, 450, Condition(function ADI))
	call ABX("Abilities\\Spells\\Human\\FlameStrike\\FlameStrike1.mdl", x, y, 5)
	call A8X(GetOwningPlayer(u), 3, x, y, 500)
	call SaveReal(VV,'A0AM', 0, ZCE)
	set X4 = AHI == false
	call ForGroup(g, function AFI)
	set X4 = false
	call FlushChildHashtable(VV,'A0AM')
	call RemoveUnit(u)
	call LogoutGroup(g)
	set g = null
endfunction
function AJI takes unit AKI returns nothing
	if RLX(AKI) then
	endif
endfunction
function JQE takes nothing returns nothing
	call AGI(GetTriggerUnit(), false)
endfunction
function ALI takes nothing returns boolean
	return GetOwningPlayer(GetFilterUnit())== LoadPlayerHandle(VV,'A0AN', 0) and UnitIsDead(GetFilterUnit())== false and RLX(GetFilterUnit())
endfunction
function AMI takes nothing returns nothing
	call IssueImmediateOrderById(GetEnumUnit(),$D024C)
endfunction
function JTE takes nothing returns nothing
	local group g = LoginGroup(276)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	call SavePlayerHandle(VV,'A0AN', 0, GetOwningPlayer(GetTriggerUnit()))
	call GroupEnumUnitsInRange(g, x, y, 716, Condition(function ALI))
	call ForGroup(g, function AMI)
	call FlushChildHashtable(VV,'A0AN')
	call LogoutGroup(g)
	set g = null
endfunction
function API takes nothing returns nothing
	if RLX(GetSummonedUnit()) then
		call TriggerRegisterUnitEvent(JJ, GetSummonedUnit(), EVENT_UNIT_SPELL_CAST)
	endif
endfunction
function M2X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function API))
	call CJX("Units\\Creeps\\GoblinSapper\\GoblinSapperYesAttack1.wav")
	set t = null
endfunction
function AQI takes nothing returns boolean
	return RMX(GetTriggerUnit())
endfunction
function ASI takes nothing returns boolean
	return IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(U2)) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 or OPX(GetFilterUnit())) and R0X(GetFilterUnit())== false and RFX(GetFilterUnit())== false
endfunction
function ATI takes nothing returns boolean
	return IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(U2)) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 or OPX(GetFilterUnit())) and R0X(GetFilterUnit())== false and RFX(GetFilterUnit())== false and((IsUnitAliveBJ(GetEnumUnit()) == true))
endfunction
function AUI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit AKI = LoadUnitHandle(HY, h, 0)
	local group g = LoginGroup(277)
	local unit u
	local real ZCE
	local integer id = GetUnitTypeId(AKI)
	local unit d = CreateUnit(GetOwningPlayer(AKI),'e00E', GetUnitX(AKI), GetUnitY(AKI), 0)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	call DestroyEffect(AddSpecialEffect("war3mapImported\\NewGroundEX.mdx", GetUnitX(AKI), GetUnitY(AKI)))
	call KillUnit(AKI)
	if id =='n00O'then
		set ZCE = 350
	elseif id =='n00P'then
		set ZCE = 450
	elseif id =='n00Q'then
		set ZCE = 555
	elseif id =='n00N'then
		set ZCE = 650
	endif
	set U2 = AKI
	call GroupEnumUnitsInRange(g, GetUnitX(AKI), GetUnitY(AKI), 525, Condition(function ASI))
	set WE = WE + 1
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if GetDistanceBetweenUnits(d, u)<$E1 then
			call UnitDamageTargetEx(d, u, 5, ZCE)
		else
			call UnitDamageTargetEx(d, u, 5, ZCE / 2)
		endif
		call GroupRemoveUnit(g, u)
	endloop
	set WE = WE -1
	call LogoutGroup(g)
	set g = null
	set u = null
	set d = null
endfunction
function AWI takes unit u, real time returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, u)
	call TimerStart(t, time, false, function AUI)
	set t = null
endfunction
function AYI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 347))
	local group g
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		if GetHandleId(GetKillingUnit())== 0 then
			call AWI(u, .3)
		else
			call SetUnitAnimationByIndex(GetTriggerUnit(), 4)
		endif
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		if LoadBoolean(HY, h, 0)== false then
			if LoadInteger(HY, h, 0)== 0 then
				call SaveInteger(HY, h, 0, 1)
				call TriggerRegisterUnitInRange(t, u,$E1, TrueBoolexprCondition)
			else
				set g = LoginGroup(278)
				set U2 = u
				call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u),$E1, Condition(function ATI))
				if FirstOfGroup(g)!= null then
					call TriggerRegisterTimerEvent(t, .3, false)
					call SaveBoolean(HY, h, 0, true)
				endif
				call LogoutGroup(g)
			endif
		else
			call AWI(u, .3)
			call FlushChildHashtable(HY,(h))
			call CleanCurrentTrigger(t)
		endif
	else
		if IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(u)) and(GetUnitAbilityLevel(GetTriggerUnit(),'A04R')== 0 or OPX(GetTriggerUnit())) and R0X(GetTriggerUnit())== false and RFX(GetTriggerUnit())== false then
			call TriggerRegisterTimerEvent(t, .3, false)
			call SaveBoolean(HY, h, 0, true)
		endif
	endif
	set t = null
	set u = null
	set g = null
	return false
endfunction
function AZI takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 1.0, true)
	call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function AYI))
	call SaveUnitHandle(HY, GetHandleId(t), 347, GetTriggerUnit())
	set t = null
endfunction
function A_I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u
	local unit A0I = LoadUnitHandle(HY, h, 0)
	local group g
	local unit d
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		if GetKillingUnit()!= null then
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		else
			call TriggerRegisterTimerEvent(t, 0, false)
		endif
	elseif GetTriggerEvalCount(t)== 1 then
		call TriggerRegisterUnitInRange(t, A0I, 450, TrueBoolexprCondition)
	elseif GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		call DisableTrigger(t)
		call KillUnit(A0I)
		call SetUnitAnimationByIndex(A0I, 3)
		set g = LoginGroup(279)
		set U2 = A0I
		call GroupEnumUnitsInRange(g, GetUnitX(A0I), GetUnitY(A0I), 450 + 25, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			set d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
			call UnitAddAbility(d,'A38L')
			call SetUnitAbilityLevel(d,'A38L', LoadInteger(HY, h, 0))
			call IssueTargetOrderById(d, 852095, u)
			call GroupRemoveUnit(g, u)
		endloop
		set d = null
		call UnitRemoveAbility(d,'A38L')
		call LogoutGroup(g)
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	else
		set u = GetTriggerUnit()
		if IsUnitEnemy(u, GetOwningPlayer(A0I)) and not IsMagicImmuneUnit(u) and GetUnitAbilityLevel(u,'A04R')== 0 then
			if IsUnitAlly(A0I, LocalPlayer) or IsObserver then
				call SetUnitAnimationByIndex(A0I, 5)
			endif
			call TriggerRegisterTimerEvent(t, 1.5, false)
		endif
	endif
	set t = null
	return false
endfunction
// 麻痹陷阱
function A1I takes nothing returns boolean
	local unit u
	local trigger t
	local integer h
	if GetUnitTypeId(GetTriggerUnit())=='otot' then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		set u = GetTriggerUnit()
		call SaveUnitHandle(HY, h, 0, u)
		call SaveInteger(HY, h, 0, GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A06H'))
		call TriggerRegisterTimerEvent(t, 1.5, false)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerAddCondition(t, Condition(function A_I))
		set t = null
		set u = null
	endif
	return false
endfunction
function M3X takes nothing returns nothing
	local trigger t = CreateTrigger()
	// 地精地雷
	call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	call TriggerAddCondition(t, Condition(function AQI))
	call TriggerAddAction(t, function AZI)
	// 麻痹陷阱
	set t = CreateTrigger()
	call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	call TriggerAddCondition(t, Condition(function A1I))
	set t = null
endfunction
function JHE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	call TWE(u, true)
	//call WYV(u,'A065', GetUnitAbilityLevel(u,'A065'))
	call FixUnitSkillsBug(u)
	set u = null
endfunction
function A2I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ 50 + 100 * GetUnitAbilityLevel(u,'A528'))
	set u = null
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTimer(t)
	set t = null
endfunction
function Tinker_Rearm_DummySpell takes nothing returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, 0, false, function A2I)
	call SaveUnitHandle(HY, GetHandleId(t), 0, GetTriggerUnit())
	set t = null
endfunction
function Tinker_MarchOfMachines_OnCast takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit u = CreateUnit(GetOwningPlayer(WJE),'n03C', GetUnitX(WJE), GetUnitY(WJE), 0)
	call UnitAddAbility(u,'A416')
	if IssuePointOrderById(u,$D0271, GetSpellTargetX(), GetSpellTargetY())== false then
		call EXStopUnit(WJE)
		call InterfaceErrorForPlayer(GetOwningPlayer(WJE), "无法在此处施放机器人的进军")
	endif
	call KillUnit(u)
	set WJE = null
	set u = null
endfunction
// 机器人的进军
function MarchOfTheMachinesDE takes nothing returns nothing
	if GetUnitAbilityLevel(DESourceUnit[DEI],'A05F')> 0 then
		//if ( not IsMagicImmuneUnit(damageTarget) ) then
		//	call UnitDamageTargetEx(Player__Hero[GetPlayerId(DESourcePlayer[DEI])], damageTarget, 1, GetUnitAbilityLevel(damageSource,'A05F')* 8 + 8)
		//else
			call UnitDamageTargetEx(Player__Hero[GetPlayerId(DESourcePlayer[DEI])], DETargetUnit[DEI], 7, GetUnitAbilityLevel(DESourceUnit[DEI],'A05F')* 8 + 8)
		//endif
	endif
endfunction
function Tinker_MarchOfMachinesOld takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'e00E', GetUnitX(triggerUnit), GetUnitY(triggerUnit), 0)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local integer i = 0
	local real a = 0
	local real r = 0
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0BQ')
	call TGV(10)
	call UnitAddAbility(dummyUnit,'A05F')
	call SetUnitAbilityLevel(dummyUnit,'A05F', level)
	if IssuePointOrderById(dummyUnit,$D0271, x, y) then
	endif
	set triggerUnit = null
	set dummyUnit = null
endfunction
function E2E takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real radian = AngleBetweenXY(GetUnitX(WJE), GetUnitY(WJE), x, y)
	local unit W_V = CreateUnit(GetOwningPlayer(WJE),'e00E', x, y, 0)
	local integer i = 0
	local real a = 0
	local real k = 0
	local boolean b = false
	local boolean A4I = false
	call TGV(10)
	call UnitAddAbility(W_V,'A05F')
	call SetUnitAbilityLevel(W_V,'A05F', GetUnitAbilityLevel(WJE,'A0BQ'))
	set x = x +$A* Cos(bj_DEGTORAD * radian)
	set y = y +$A* Sin(bj_DEGTORAD * radian)
	loop
		set b = IsTerrainPathable(x + k * Cos(a), y + k * Sin(a), PATHING_TYPE_WALKABILITY)== false
		if b == false then
			call SetTerrainPathable(x + k * Cos(a), y + k * Sin(a), PATHING_TYPE_WALKABILITY, true)
		endif
		set A4I = IssuePointOrderById(W_V,$D0271, x + k * Cos(a), y + k * Sin(a))
		if b == false then
			call SetTerrainPathable(x + k * Cos(a), y + k * Sin(a), PATHING_TYPE_WALKABILITY, false)
		endif
	exitwhen A4I or i > 40
		set i = i + 1
		set k = k +$A
	endloop
	set WJE = null
	set W_V = null
endfunction
function A5I takes nothing returns boolean
	return DPX() and IsHeroUnitId(GetUnitTypeId(GetFilterUnit())) and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and LoadInteger(HY, GetHandleId(GetFilterUnit()),'A33G')!= 1
endfunction
function A6I takes unit WJE, unit A7I returns nothing
	local group g = LoginGroup(280)
	local unit u
	local unit A8I = A7I
	local unit d
	local integer level = GetUnitAbilityLevel(WJE,'A33G')
	loop
		set U2 = WJE
		call GroupEnumUnitsInRange(g, GetUnitX(A8I), GetUnitY(A8I), 550 + 25, Condition(function A5I))
		set u = GetNearestUnitByGroup(g, GetUnitX(A8I), GetUnitY(A8I))
	exitwhen u == null
		set d = CreateUnit(GetOwningPlayer(WJE),'e00E', GetUnitX(A8I), GetUnitY(A8I), 0)
		call UnitAddAbility(d,'A049')
		call SetUnitAbilityLevel(d,'A049', level)
		call TriggerRegisterUnitEvent(JJ, d, EVENT_UNIT_SPELL_EFFECT)
		call IssueTargetOrderById(d,$D0269, u)
		set d = null
		call EPX(u,'A33G', .5)
		set A8I = u
		call GroupRemoveUnit(g, u)
	endloop
	call LogoutGroup(g)
	set u = null
	set A8I = null
endfunction
function E3E takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(spellUnit, GetSpellAbilityId())
	local real dur = 2.5 + level * .5
	if not IsHeroLevelUnit(targetUnit) then
		set dur = 6.
	endif
	call UnitLaunchesMissileToTarget( spellUnit, targetUnit, "war3mapImported\\laser.MDX", 6000, 0., 150, null )
	if not UnitHasSpellShield(targetUnit) then
		call EnableEffectByTime(14, dur + 1.)
		call AddAbilityToTimed(targetUnit,'A3Q0', 1, 2.5 + level * .5,'B02P')
		call UnitDamageTargetEx(spellUnit, targetUnit, 3, level * 80)
		if GetSpellAbilityId()=='A33G' then
			call EPX(targetUnit,'A33G', .5)
			call A6I(spellUnit, targetUnit)
		endif
	endif
	set spellUnit = null
	set targetUnit = null
endfunction
function SpellEffect__HeatSeekingMissile takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(triggerUnit, GetSpellAbilityId())
	local group g = LoginGroup(282)
	local real x = GetUnitX(triggerUnit)
	local real y = GetUnitX(triggerUnit)
	local integer i = 4
	local integer k = 0
	local group gg = LoginGroup(283)
	local unit firstUnit = null
	local unit nearestUnit = null
	local missile m
	local player tempPlayer = GetOwningPlayer(triggerUnit)
	if GetSpellAbilityId()=='A05E' then
		set i = 2
	endif
	set U2 = triggerUnit
	call GroupEnumUnitsInRange(g, x, y, 2500, null)
	
	
	loop
		set firstUnit = FirstOfGroup(g)
		exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)
		if IsHeroUnitId(GetUnitTypeId(firstUnit)) and not IsMagicImmuneUnit(firstUnit) and UnitVisibleToPlayer(firstUnit, tempPlayer) and IsUnitEnemy(firstUnit, tempPlayer) and IsAliveNotStrucNotWard(firstUnit) then
			call GroupAddUnit(gg, firstUnit)
		endif
	endloop

	call LogoutGroup(g)
	set g = null

	loop
		set nearestUnit = GetNearestUnitByGroup(gg, x, y)
		exitwhen nearestUnit == null or k >= i
		call GroupRemoveUnit(gg, nearestUnit)
		set m = m.create(triggerUnit, nearestUnit, 900.)
		set m.damageType = 1
		set m.damageValue = 50 + 75 * level
	endloop
	call LogoutGroup(gg)
	set gg = null

	set triggerUnit = null
endfunction
function NOI takes nothing returns nothing
	if IsUnitType(GetEnumUnit(), UNIT_TYPE_STRUCTURE) then
		call UnitDamageTargetEx(J9V, GetEnumUnit(), 1, KVV / 3)
	else
		call UnitDamageTargetEx(J9V, GetEnumUnit(), 1, KVV)
	endif
endfunction
function NRI takes unit WUE, real x, real y, real r, real d returns nothing
	local group g = LoginGroup(284)
	set U2 = WUE
	call GroupEnumUnitsInRange(g, x, y, r, Condition(function DWX))
	set J9V = WUE
	set KVV = d
	call ForGroup(g, function NOI)
	call LogoutGroup(g)
	set g = null
endfunction
function NII takes nothing returns boolean
	return((IsAliveNotStrucNotWard(GetFilterUnit()) and GetFilterUnit()!= RoShan and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and(IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(U2)) or IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO)== false or(LoadBoolean(HY, GetPlayerId(GetOwningPlayer(GetFilterUnit())),$8B)== false))))
endfunction
function NAI takes unit triggerUnit, real d returns unit
	local unit WUE = null
	local group g = LoginGroup(285)
	set U2 = triggerUnit
	call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), d, Condition(function NII))
	if GetUnitAbilityLevel(triggerUnit,'A04R')> 0 then
		call GroupRemoveUnit(g, Player__Hero[GetPlayerId(GetOwningPlayer(triggerUnit))])
	else
		call GroupRemoveUnit(g, triggerUnit)
	endif
	set WUE = GetNearestUnitByGroup(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit))
	call LogoutGroup(g)
	set U2 = WUE
	set WUE = null
	set g = null
	return U2
endfunction
function NNI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer EVX = GetTriggerEvalCount(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local real x0 = LoadReal(HY, h, 282)
	local real y0 = LoadReal(HY, h, 283)
	local real x1 = GetUnitX(WUE)
	local real y1 = GetUnitY(WUE)
	local real x2
	local real y2
	local real a
	local real NBI
	local real J0R
	local real DFR
	local real NBX
	local real NCX
	local location l
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0CY')
	local integer NCI = LoadInteger(HY, h, 0)
	if targetUnit != null then
		set x2 = GetUnitX(targetUnit)
		set y2 = GetUnitY(targetUnit)
	endif
	if targetUnit == null or GetDistanceBetween(x0, y0, x2, y2)>1000 then
		set x2 = x0
		set y2 = y0
	endif
	set a = AngleBetweenXY(x1, y1, x2, y2)
	set NBI = GetDistanceBetween(x1, y1, x2, y2)
	set J0R = NBI / IMaxBJ((58 -EVX), 1)
	set DFR =(EVX -29)*(EVX -29)
	set NBX = x1 + J0R * Cos(a * bj_DEGTORAD)
	set NCX = y1 + J0R * Sin(a * bj_DEGTORAD)
	if EVX < 58 then
		if O0X(WUE)== false then
			call SetUnitFlyHeight(WUE, 775 -DFR, 0)
		endif
		if IsUnitType(WUE, UNIT_TYPE_HERO) then
			call SaveBoolean(K, GetHandleId(WUE), 99, true)
		endif
		if IsUnitCanMove(WUE) then
			call SetUnitPosition(WUE, NBX, NCX)
		endif
	else
		if O0X(WUE)== false then
			call SetUnitFlyHeight(WUE, GetUnitDefaultFlyHeight(WUE), 0)
		endif
		call PauseUnit(WUE, false)
		call SetUnitPathing(WUE, true)
		call SetUnitPosition(WUE, x2, y2)
		call SaveInteger(HY, GetHandleId(WUE), 4268, 2)
		set l = Location(x2, y2)
		call TerrainDeformationRippleBJ(.2, true, l, 1., 300., 96., 1, 64.)
		call RemoveLocation(l)
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl", GetUnitX(WUE), GetUnitY(WUE)))
		if IsUnitEnemy(WUE, GetOwningPlayer(triggerUnit)) then
			if G3X(triggerUnit) then
				call UnitDamageTargetEx(triggerUnit, WUE, 1,(.2 + .15 *(level + 1))* 75 * NCI)
			else
				call UnitDamageTargetEx(triggerUnit, WUE, 1,(.2 + .15 * level)* 75 * NCI)
			endif
		endif
		if LoadBoolean(HY, h, 0)== false and targetUnit != null and IsUnitEnemy(targetUnit, GetOwningPlayer(triggerUnit)) and GetUnitAbilityLevel(targetUnit,'A3E9')== 1 and IsMagicImmuneUnit(triggerUnit)== false then
			call SaveInteger(VV,'A3E9', 0, NCI)
			call SaveUnitHandle(VV,'A3E9', 0, targetUnit)
			call SaveUnitHandle(VV,'A3E9', 1, triggerUnit)
			call ExecuteFunc("NDI")
		endif
		call KillDestructablesInCircle(x2, y2, 300)
		call NRI(triggerUnit, x2, y2, 300, 75 * NCI)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set triggerUnit = null
	set WUE = null
	set targetUnit = null
	set l = null
	return false
endfunction
function NFI takes unit triggerUnit, unit targetUnit, integer level, boolean FAR returns nothing
	local unit WUE = KEV
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x
	local real y
	if targetUnit != null then
		set x = GetUnitX(targetUnit)
		set y = GetUnitY(targetUnit)
	else
		set x = GetItemX(GetSpellTargetItem())
		set y = GetItemY(GetSpellTargetItem())
	endif
	if GetUnitTypeId(triggerUnit)=='e00C' or GetUnitTypeId(triggerUnit)=='e00E'then
		if targetUnit == null then
			set triggerUnit = Player__Hero[GetPlayerId(GetOwningPlayer(triggerUnit))]
			if GetOwningPlayer(targetUnit)== GetOwningPlayer(triggerUnit) then
				set targetUnit = NAI(triggerUnit, 500 +$C8* level + 25)
			endif
			if WUE == null or targetUnit == null then
				return
			endif
		endif
	else
		if IsUnitEnemy(triggerUnit, GetOwningPlayer(WUE)) and not FAR then
			call IssueTargetOrderById(triggerUnit, 851983, WUE)
		endif
	endif
	call PauseUnit(WUE, true)
	call SetUnitPathing(WUE, false)
	if O0X(WUE)== false then
		call UnitAddPermanentAbility(WUE,'Amrf')
		call UnitRemoveAbility(WUE,'Amrf')
	endif
	call SaveInteger(HY, GetHandleId(WUE), 4268, 1)
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveInteger(HY, h, 0, level)
	call SaveBoolean(HY, h, 0, FAR)
	call SaveUnitHandle(HY, h, 30,(targetUnit))
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl", WUE, "origin"))
	call SaveReal(HY, h, 282, x)
	call SaveReal(HY, h, 283, y)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function NNI))
	set WUE = null
	set t = null
endfunction
function E5E takes nothing returns nothing
	call NFI(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(),'A0BZ'), false)
endfunction
function NDI takes nothing returns nothing
	local unit WJE = LoadUnitHandle(VV,'A3E9', 0)
	local unit NGI = NAI(WJE, 300)
	call T4V(WJE)
	if NGI != null then
		set KEV = NGI
		call NFI(WJE, LoadUnitHandle(VV,'A3E9', 1), LoadInteger(VV,'A3E9', 0), true)
	endif
	set WJE = null
	set NGI = null
	call FlushChildHashtable(VV,'A3E9')
endfunction
function K_E takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit NGI = NAI(WJE, 300)
	local unit WLE = GetSpellTargetUnit()
	set KEV = NGI
	if GetUnitTypeId(WJE)!='e00C' and GetUnitTypeId(WJE)!='e00E' then
		if NGI == null then
			call EXStopUnit(WJE)
			call InterfaceErrorForPlayer(GetOwningPlayer(WJE), GetObjectName('n0DA'))
		elseif GetSpellTargetItem()!= null and ZNX(GetItemTypeId(GetSpellTargetItem()))== false then
			call EXStopUnit(WJE)
			call InterfaceErrorForPlayer(GetOwningPlayer(WJE), "必须以符文为目标")
		endif
	endif
	set WJE = null
	set NGI = null
	set WLE = null
endfunction
function Z1O takes nothing returns nothing
	local unit WUE = IM
	local unit targetUnit = AM
	local unit dummyUnit =(LoadUnitHandle(HY,(GetHandleId(WUE)), 297))
	call SaveUnitHandle(HY,(GetHandleId(targetUnit)), 297,(dummyUnit))
	call SetUnitOwner(dummyUnit, GetOwningPlayer(targetUnit), true)
	set WUE = null
	set targetUnit = null
	set dummyUnit = null
endfunction
function W5X takes nothing returns nothing
	local unit triggerUnit = VK
	local unit dummyUnit =(LoadUnitHandle(HY,(GetHandleId(triggerUnit)), 297))
	if dummyUnit != null and GetUnitTypeId(dummyUnit)=='e01V' then
		call RemoveUnit(dummyUnit)
	endif
	set triggerUnit = null
	set dummyUnit = null
endfunction

// 学习长大
function LearnSkill__Grow takes nothing returns nothing
	local trigger t
	local unit u = GetTriggerUnit()
	local integer lv = GetUnitAbilityLevel(u,'A0CY')
	local unit W_V
	local region r
	local real scale = GetUnitModelScale(u)
	local real addScale = lv * 0.25
	local player p = GetOwningPlayer(u)
	local integer TME = GetPlayerId(p)
	set HaveGrow = true
	if lv == 1 then
		set W_V = CreateUnit(p,'e01V', 0, 0, 0)
		call UnitAddPermanentAbility(W_V,'A10B')
		call SaveUnitHandle(HY,(GetHandleId(u)), 297,(W_V))
	else
		set W_V =(LoadUnitHandle(HY,(GetHandleId(u)), 297))
	endif
	if lv == 2 then
		call UnitRemoveAbility(W_V,'A10B')
		call UnitRemoveAbility(u,'B04E')
		call UnitAddPermanentAbility(W_V,'A10A')
	elseif lv == 3 then
		call UnitRemoveAbility(W_V,'A10B')
		call UnitRemoveAbility(W_V,'A10A')
		call UnitRemoveAbility(u,'B09C')
		call UnitRemoveAbility(u,'B04E')
		call UnitAddPermanentAbility(W_V,'A0ZS')
	endif
	call SetPlayerTechResearched(p,'R0L1', lv)
	if Mode__RearmCombos then
		call SetPlayerTechResearched(p,'R00E', lv)
	else
		call SetPlayerTechResearched(p,'R00L', lv)
		call SetPlayerTechResearched(p,'R00M', lv)
	endif
	// call SetUnitScale(u, scale + .25 * lv, scale + .25 * lv, scale + .25 * lv)
	// debug call SingleDebug( GetUnitName(u) + " 改变模型缩放 比例" + R2S( GetUnitCurrentScale(u) + addScale ) + "原始模型缩放" + R2S(scale))
	call SaveReal( ExtraHT, GetHandleId(u), HTKEY_UNIT_CURRENT_ADDSCALE, addScale )
	call SetUnitCurrentScaleEx(u, GetUnitCurrentScale(u) )
	set u = null
	set W_V = null
endfunction
function NQI takes nothing returns boolean
	local unit WUE
	local unit targetUnit
	local integer level
	local unit dummyUnit
	if GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT then
		if IsAttackSpecialEffectsId(GetSpellAbilityId()) and GetSpellTargetUnit()== LoadUnitHandle(HY, GetHandleId(GetTriggeringTrigger()), 0) then
			set targetUnit = GetSpellTargetUnit()
			set WUE = GetTriggerUnit()
		else
			return false
		endif
	else
		set WUE = GetTriggerUnit()
		set targetUnit = GetAttacker()
	endif
	set level =(GetUnitAbilityLevel(WUE,'A19Q'))
	if level > 0 and GetUnitAbilityLevel(WUE,'A36D')== 0 and IsAliveNotStrucNotWard(targetUnit) and GetDistanceBetweenUnits(WUE, targetUnit)< 500 and GetPrdRandom(WUE,'A19Q', 15) then
		call UnitDamageTargetEx(WUE, targetUnit, 1, 25 + 25 * level)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RockBoltMissile\\RockBoltMissile.mdl", targetUnit, "origin"))
		call CommonUnitAddStun(targetUnit, 1.1 + .1 * level, false)
	endif
	set WUE = null
	set targetUnit = null
	return false
endfunction
function SZE takes nothing returns nothing
	call LodSystem_AddUnitExtraState(GetTriggerUnit(), 1, STATE_SYSTEM_ARMOUR)
endfunction
function PPE takes nothing returns nothing
	local trigger t
	local unit WUE = GetTriggerUnit()
	if GetUnitAbilityLevel(WUE,'A19Q')== 1 then
		set t = CreateTrigger()
		call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_ATTACKED)
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
		call SaveUnitHandle(HY, GetHandleId(t), 0, WUE)
		call TriggerAddCondition(t, Condition(function NQI))
		call LodSystem_AddUnitExtraState(GetTriggerUnit(), 1, STATE_SYSTEM_ARMOUR)
	endif
	call LodSystem_AddUnitExtraState(GetTriggerUnit(), 1, STATE_SYSTEM_ARMOUR)
	set t = null
	set WUE = null
endfunction
function NSI takes nothing returns boolean
	if((LoadInteger(HY,(GetHandleId((GetFilterUnit()))),(4268)))== 1) and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(KXV)) then
		call UnitDamageTargetEx(KXV, GetFilterUnit(), 1, KOV)
	endif
	return false
endfunction
function NTI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local unit dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'e00E', x, y, 0)
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0LL')
	local group g = LoginGroup(286)
	call UnitAddPermanentAbility(dummyUnit,'A10J')
	call SetUnitAbilityLevel(dummyUnit,'A10J', level)
	set KXV = triggerUnit
	if level == 1 then
		set KOV = 25
	elseif level == 2 then
		set KOV = 45
	elseif level == 3 then
		set KOV = 65
	elseif level == 4 then
		set KOV = 75
	endif
	call GroupEnumUnitsInRange(g, x, y, 275 + 24, Condition(function NSI))
	call LogoutGroup(g)
	if GetTriggerEvalCount(t)> 6 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set triggerUnit = null
	set dummyUnit = null
	set g = null
	return false
endfunction
function E6E takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'e00E', GetUnitX(triggerUnit), GetUnitY(triggerUnit), 0)
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0LL')
	call UnitAddPermanentAbility(dummyUnit,'A10M')
	call SetUnitAbilityLevel(dummyUnit,'A10M', level)
	call IssuePointOrderById(dummyUnit,$D02AC, x, y)
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerAddCondition(t, Condition(function NTI))
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call TriggerEvaluate(t)
	set triggerUnit = null
	set t = null
	set dummyUnit = null
endfunction
function NUI takes nothing returns nothing
	local unit u = GetEnumUnit()
	call CNX(u,'A0XE', KRV, 7,'B00B')
	call S9E(GetOwningPlayer(u),'A0XE', false)
	set u = null
endfunction
function NWI takes nothing returns boolean
	return(IsUnitIdType(GetUnitTypeId(GetFilterUnit()), UNIT_TYPE_HERO) and IsUnitAlly(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit()))!= null
endfunction
function E7E takes nothing returns nothing
	local group g = LoginGroup(287)
	set KRV = GetUnitAbilityLevel(GetTriggerUnit(),'A1EJ')
	call GroupEnumUnitsInRange(g, 0, 0,$2EE0, Condition(function NWI))
	call ForGroup(g, function NUI)
	call LogoutGroup(g)
	set g = null
endfunction
function NYI takes unit u returns boolean
	return GetUnitTypeId(u)=='QTW3' or GetUnitTypeId(u)=='N017' or GetUnitTypeId(u)=='N02B' or GetUnitTypeId(u)=='QTW2'
endfunction
function NZI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	call SetUnitAbilityLevel(WUE,'A09E', GetUnitAbilityLevel(WUE,'A0BE'))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set WUE = null
endfunction
function E8E takes nothing returns nothing
	local timer t
	if NYI(GetTriggerUnit())== false then
		set t = CreateTimer()
		call SaveUnitHandle(HY, GetHandleId(t), 2, GetTriggerUnit())
		call TimerStart(t, 0, false, function NZI)
		set t = null
	endif
endfunction
function N_I takes unit u, unit targetUnit returns nothing
	local integer h = GetHandleId(u)
	local unit N0I = LoadUnitHandle(HY, h,$ED)
	local integer c = IMaxBJ(LoadInteger(HY, h,$EC), 0)
	local integer level = GetUnitAbilityLevel(u,'P107')
	local integer WFR
	local integer N1I = LoadInteger(P, GetHandleId(u),'P107')
	if N0I != targetUnit then
		set c = 0
	else
		if c == 4 then
			call AddAbilityToTimed(targetUnit,'A468', level, 4, 0)
		else
			set c = c + 1
		endif
	endif
	set WFR =($F+ 5 * level)* c
	if(N1I != WFR) then
		if N1I < WFR then
			call LodSystem_AddUnitExtraState(u, WFR -N1I, STATE_SYSTEM_ATTACK)
		else
			call LodSystem_ReduceUnitExtraState(u, N1I -WFR, STATE_SYSTEM_ATTACK)
		endif
		call SaveInteger(P, GetHandleId(u),'P107', WFR)
	endif
	call SaveInteger(HY, h,$EC, c)
	if N0I != targetUnit then
		call SaveUnitHandle(HY, h,$ED, targetUnit)
	endif
	call EPX(u, 4271, .4)
	set N0I = null
endfunction
function N2I takes unit R8X, unit WLE returns nothing
	if GetUnitAbilityLevel(R8X,'P107')> 0 and GetUnitAbilityLevel(R8X,'A36D')== 0 and LoadInteger(HY, GetHandleId(R8X), 4271)!= 1 then
		call N_I(R8X, WLE)
	endif
endfunction
function N3I takes unit WUE, unit targetUnit, unit dummyUnit, integer level returns nothing
	call SetUnitOwner(dummyUnit, GetOwningPlayer(targetUnit), false)
	call SetUnitAbilityLevel(dummyUnit,'A21O', level)
	call IssueTargetOrderById(dummyUnit,852190, targetUnit)
	call UnitDamageTargetEx(WUE, targetUnit, 1, 50 + 50 * level)
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", targetUnit, "overhead"))
endfunction
function N4I takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), KNV)== false then
		call GroupAddUnit(KNV, GetEnumUnit())
		call N3I(KIV, GetEnumUnit(), KAV, KBV)
	endif
endfunction
function N5I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local real x = GetUnitX(WUE)
	local real y = GetUnitY(WUE)
	local unit N6I =(LoadUnitHandle(HY, h, 675))
	local unit N7I =(LoadUnitHandle(HY, h, 676))
	local real a =(LoadReal(HY, h, 13))
	local real d =(LoadReal(HY, h, 433))
	local integer level =(LoadInteger(HY, h, 5))
	local group D7R =(LoadGroupHandle(HY, h, 187))
	local group g = LoginGroup(288)
	if GetTriggerEvalCount(t)<= 50 then
		set a = a + 20
		set d = d + 7
		call SaveReal(HY, h, 13,((a)* 1.))
		call SaveReal(HY, h, 433,((d)* 1.))
	elseif GetTriggerEvalCount(t)<= 100  then
		set a = a + 20
		set d = d -7
		call SaveReal(HY, h, 13,((a)* 1.))
		call SaveReal(HY, h, 433,((d)* 1.))
	endif
	call SetUnitX(N6I, CoordinateX50(x + d * Cos(a * bj_DEGTORAD)))
	call SetUnitY(N6I, CoordinateY50(y + d * Sin(a * bj_DEGTORAD)))
	set a = a +$B4
	call SetUnitX(N7I, CoordinateX50(x + d * Cos(a * bj_DEGTORAD)))
	call SetUnitY(N7I, CoordinateY50(y + d * Sin(a * bj_DEGTORAD)))
	set U2 = WUE
	set KIV = WUE
	set KAV = dummyUnit
	set KNV = D7R
	set KBV = level
	call GroupEnumUnitsInRange(g, GetUnitX(N6I), GetUnitY(N6I), 125, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	call ForGroup(g, function N4I)
	set U2 = WUE
	call GroupEnumUnitsInRange(g, GetUnitX(N7I), GetUnitY(N7I), 125, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	call ForGroup(g, function N4I)
	call LogoutGroup(g)
	if GetTriggerEvalCount(t)> 100  then
		call KillUnit(N6I)
		call KillUnit(N7I)
		call KillUnit(dummyUnit)
		call LogoutGroup(D7R)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	set N6I = null
	set N7I = null
	set dummyUnit = null
	set D7R = null
	set g = null
	return false
endfunction
function XEE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local real x = GetUnitX(WUE)
	local real y = GetUnitY(WUE)
	local unit N6I = CreateUnit(GetOwningPlayer(WUE),'e02Y', x, y, 0)
	local unit N7I = CreateUnit(GetOwningPlayer(WUE),'e02Y', x, y, 0)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', x, y, 0)
	call UnitAddAbility(dummyUnit,'A21O')
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveUnitHandle(HY, h, 675,(N6I))
	call SaveUnitHandle(HY, h, 676,(N7I))
	call SaveReal(HY, h, 13,(0 * 1.))
	call SaveReal(HY, h, 433,(0 * 1.))
	call SaveInteger(HY, h, 5,(GetUnitAbilityLevel(WUE,'A21N')))
	call SaveGroupHandle(HY, h, 187,(LoginGroup(289)))
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function N5I))
	call EnableEffectByTime(16, 12.)
	set WUE = null
	set N6I = null
	set N7I = null
	set t = null
	set dummyUnit = null
endfunction
function N8I takes unit WUE, unit targetUnit, unit dummyUnit, integer level returns nothing
	call SetUnitOwner(dummyUnit, GetOwningPlayer(targetUnit), false)
	call SetUnitAbilityLevel(dummyUnit,'A21P', level)
	call IssueTargetOrderById(dummyUnit, 852075, targetUnit)
	call UnitDamageTargetEx(WUE, targetUnit, 1, 75)
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", targetUnit, "overhead"))
endfunction
function N9I takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), KNV)== false then
		call GroupAddUnit(KNV, GetEnumUnit())
		call N8I(KIV, GetEnumUnit(), KAV, KBV)
	endif
endfunction
function BVI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 2)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local unit BEI = LoadUnitHandle(HY, h, 393)
	local unit BXI = LoadUnitHandle(HY, h, 394)
	local unit BOI = LoadUnitHandle(HY, h, 395)
	local unit BRI = LoadUnitHandle(HY, h, 396)
	local unit BII = LoadUnitHandle(HY, h, 397)
	local real a = LoadReal(HY, h, 13)-12.5
	local real d = LoadReal(HY, h, 433)
	local integer level = LoadInteger(HY, h, 5)
	local unit u
	local group g
	local group D7R = LoadGroupHandle(HY, h, 187)
	local unit W_V = LoadUnitHandle(HY, h, 19)
	local integer i = 0
	set d = d + 900 / 20.
	call SaveReal(HY, h, 433, d * 1.)
	set KIV = WJE
	set KAV = W_V
	set KNV = D7R
	set KBV = level
	set g = LoginGroup(290)
	loop
	exitwhen HaveSavedHandle(HY, h, 393 + i)== false
		set u = LoadUnitHandle(HY, h, 393 + i)
		if u != null and UnitAlive(u) then
			call SetUnitX(u, CoordinateX50(LoadReal(HY, h, 6)+ d * Cos(a * bj_DEGTORAD)))
			call SetUnitY(u, CoordinateY50(LoadReal(HY, h, 7)+ d * Sin(a * bj_DEGTORAD)))
			set x = GetUnitX(u)
			set y = GetUnitY(u)
			set U2 = WJE
			call GroupEnumUnitsInRange(g, x, y, 125, Condition(function DJX))
			call ForGroup(g, function N9I)
			call GroupClear(g)
		endif
		set a = a + 6.25
		set i = i + 1
	endloop
	call LogoutGroup(g)
	if GetTriggerEvalCount(t)> 20 then
		call KillUnit(BEI)
		call KillUnit(BXI)
		call KillUnit(BOI)
		call KillUnit(BRI)
		call KillUnit(BII)
		call KillUnit(W_V)
		call LogoutGroup(D7R)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WJE = null
	set BEI = null
	set BXI = null
	set BOI = null
	set BRI = null
	set BII = null
	set W_V = null
	set u = null
	set D7R = null
	set g = null
	return false
endfunction
function XVE takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local real x0 = GetUnitX(WJE)
	local real y0 = GetUnitY(WJE)
	local real x1 = GetSpellTargetX()
	local real y1 = GetSpellTargetY()
	local real a = AngleBetweenXY(x0, y0, x1, y1)
	local unit BEI = CreateUnit(GetOwningPlayer(WJE),'e02Z', x0, y0, a -12.5)
	local unit BXI = CreateUnit(GetOwningPlayer(WJE),'e02Z', x0, y0, a -6.25)
	local unit BOI = CreateUnit(GetOwningPlayer(WJE),'e02Z', x0, y0, a)
	local unit BRI = CreateUnit(GetOwningPlayer(WJE),'e02Z', x0, y0, a + 6.25)
	local unit BII = CreateUnit(GetOwningPlayer(WJE),'e02Z', x0, y0, a + 12.5)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit d = CreateUnit(GetOwningPlayer(WJE),'e00E', x0, y0, 0)
	call UnitAddAbility(d,'A21P')
	call SaveUnitHandle(HY, h, 2, WJE)
	call SaveUnitHandle(HY, h, 19, d)
	call SaveUnitHandle(HY, h, 393, BEI)
	call SaveUnitHandle(HY, h, 394, BXI)
	call SaveUnitHandle(HY, h, 395, BOI)
	call SaveUnitHandle(HY, h, 396, BRI)
	call SaveUnitHandle(HY, h, 397, BII)
	call SaveReal(HY, h, 6, x0 * 1.)
	call SaveReal(HY, h, 7, y0 * 1.)
	call SaveReal(HY, h, 433, 0 * 1.)
	call SaveReal(HY, h, 13, a * 1.)
	call SaveGroupHandle(HY, h, 187, LoginGroup(291))
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(WJE,'A21M'))
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function BVI))
	set WJE = null
	set BEI = null
	set BXI = null
	set BOI = null
	set BRI = null
	set BII = null
	set t = null
	set d = null
endfunction
function BAI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local integer level = GetUnitAbilityLevel(WUE,'A21L')
	if level == 0 then
		set level = GetUnitAbilityLevel(WUE,'A21M')
	endif
	call SetUnitAbilityLevel(WUE,'A21N', level)
	call SetUnitAbilityLevel(WUE,'A21M', level)
	set t = null
	set WUE = null
	return false
endfunction
function LLE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	call UnitAddPermanentAbility(WUE,'A21N')
	call UnitAddPermanentAbility(WUE,'A21M')
	call SaveInteger(HY,(GetHandleId((WUE))),(4416), 2)
	call SaveInteger(HY,(GetHandleId((WUE))),(4417), 2)
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function BAI))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SavePlayerHandle(HY, h, 54,(GetOwningPlayer(WUE)))
	set t = null
	set WUE = null
endfunction
function KMF takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local integer level = LoadInteger(HY, h, 5)
	local integer EVX = LoadInteger(HY, h, 34)
	local integer Z6X = LoadInteger(HY, h, 0)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call UnitRemoveAbility(WUE,'A1N3')
		call UnitRemoveAbility(WUE,'A1N7')
		call UnitRemoveAbility(WUE,'B0CH')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_PLAYER_UNIT_ATTACKED then
		if GetAttacker()== WUE then
			set EVX = EVX + 1
			call SaveInteger(HY, h, 34,(EVX))
			if EVX >= Z6X then
				call UnitRemoveAbility(WUE,'A1N3')
				call UnitRemoveAbility(WUE,'A1N7')
				call UnitRemoveAbility(WUE,'B0CH')
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			endif
		endif
	else
		call UnitRemoveAbility(WUE,'A1N3')
		call UnitRemoveAbility(WUE,'A1N7')
		call UnitRemoveAbility(WUE,'B0CH')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	return false
endfunction
// 超强力量 - 攻击事件
function Overpower_AE takes nothing returns nothing
	local integer c
	if GetUnitAbilityLevel(AEAttackerUnit[AEI],'A1N7')> 0 then
		set c = LoadInteger(HY, AEAttackerId[AEI],'A1N7'+ 1)
		if c > 1 then
			call SaveInteger(HY, AEAttackerId[AEI],'A1N7'+ 1, c -1)
		else
			call RemoveSavedInteger(HY, AEAttackerId[AEI],'A1N7'+ 1)
			call UnitRemoveAbility(AEAttackerUnit[AEI],'A1N7')
			call UnitRemoveAbility(AEAttackerUnit[AEI],'B0CH')
			call UnitRemoveAbility(AEAttackerUnit[AEI],'A1N3')
		endif
	endif
endfunction
function XOE takes nothing returns nothing
	local trigger t
	local integer h
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u, GetSpellAbilityId())
	call AddAbilityToTimed(u,'A1N7', 1, 15,'B0CH')
	if GetUnitAbilityLevel(u,'A0CY')== 0 then
		call AddAbilityToTimed(u,'A1N3', 1, 15, 0)
	endif
	call SaveInteger(HY, GetHandleId(u),'A1N7'+ 1, 2 + level)
	set t = null
	set u = null
endfunction
function XRE takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0)
	call UnitAddAbility(d,'A3IC')
	call SetUnitAbilityLevel(d,'A3IC', GetUnitAbilityLevel(GetTriggerUnit(),'A03Y'))
	call IssueImmediateOrderById(d,$D0080)
	set d = null
endfunction

function BGI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local integer ZCE
	local integer BHI
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or(GetUnitAbilityLevel(WUE,'B02H')== 0 and GetTriggerEvalCount(t)> 4) or(GetTriggerEventId()== EVENT_PLAYER_UNIT_SPELL_EFFECT and GetSpellTargetUnit()== WUE and FDX(GetSpellAbilityId())) then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(WUE,'B02H')
		call SaveInteger(HY, GetHandleId(WUE),'a068', 0)
		call KVX(WUE)
	else
		if LoadBoolean(HY, h, 0) then
			set ZCE = R2I(GetUnitState(WUE, UNIT_STATE_MAX_LIFE)*(.04 + .01 * LoadInteger(HY, h, 0)))
		else
			set ZCE = R2I(GetWidgetLife(WUE)*(.04 + .01 * LoadInteger(HY, h, 0)))
		endif
		set BHI = LoadInteger(HY, h,$EE)
		if ZCE != BHI then
			call SaveInteger(HY, h,$EE, ZCE)
			call SaveInteger(HY, GetHandleId(WUE),'a068', ZCE)
			call KVX(WUE)
		endif
	endif
	set t = null
	set WUE = null
	return false
endfunction
function XIE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerRegisterDeathEvent(t, GetTriggerUnit())
	call TriggerAddCondition(t, Condition(function BGI))
	call SaveUnitHandle(HY, h, 2, GetTriggerUnit())
	call SaveInteger(HY, h,$EE, 0)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
	call SaveBoolean(HY, h, 0, GetSpellAbilityId()=='A443')
	call GBX(GetTriggerUnit())
	set t = null
endfunction
function BJI takes unit dummyUnit, real x, real y, integer level returns nothing
	call SetUnitPosition(dummyUnit, x, y)
	call IssueImmediateOrderById(dummyUnit,$D026C)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\HowlOfTerror\\HowlCaster.mdl", x, y))
	set dummyUnit = null
endfunction
function BKI takes nothing returns boolean
	if(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit()))) and IsUnitInGroup(GetFilterUnit(), KCV)== false then
		call GroupAddUnit(KCV, GetFilterUnit())
		call UnitDamageTargetEx(KDV, GetFilterUnit(), 7, KFV)
	endif
	return false
endfunction
function BLI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local real a =(LoadReal(HY, h, 13))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local integer level =(LoadInteger(HY, h, 5))
	local group CNO =(LoadGroupHandle(HY, h,$85))
	local group g
	if GetTriggerEvalCount(t)>$A then
		call LogoutGroup(CNO)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set KCV = CNO
		set KDV = WUE
		set KFV = 60 + 20 * level
		set U2 = WUE
		set g = LoginGroup(292)
		call GroupEnumUnitsInRange(g, x, y, 325, Condition(function BKI))
		call LogoutGroup(g)
		set g = null
		call BJI(dummyUnit, x, y, level)
		if ModuloInteger(GetTriggerEvalCount(t), 2)== 0 then
			call KillUnit(CreateUnit(GetOwningPlayer(WUE),'e02A', x, y, 0))
		endif
		set x = CoordinateX50(x +$C8* Cos(a * bj_DEGTORAD))
		set y = CoordinateY50(y +$C8* Sin(a * bj_DEGTORAD))
		call SaveReal(HY, h, 6,((x)* 1.))
		call SaveReal(HY, h, 7,((y)* 1.))
	endif
	set t = null
	set WUE = null
	set dummyUnit = null
	set CNO = null
	return false
endfunction
function XNE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local real x1 = GetUnitX(WUE)
	local real y1 = GetUnitY(WUE)
	local real x2 = GetSpellTargetX()
	local real y2 = GetSpellTargetY()
	local real a = AngleBetweenXY(x1, y1, x2, y2)
	local integer level = GetUnitAbilityLevel(WUE,'A17O')
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', x1, y1, 0)
	call UnitAddPermanentAbility(dummyUnit,'A0AP')
	call SetUnitAbilityLevel(dummyUnit,'A0AP', level)
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h, 6,((x1)* 1.))
	call SaveReal(HY, h, 7,((y1)* 1.))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveGroupHandle(HY, h,$85,(LoginGroup(293)))
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function BLI))
	set t = null
	set WUE = null
	set dummyUnit = null
endfunction
function BMI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetTriggerEventId()== EVENT_UNIT_DEATH or GetTriggerEventId()== EVENT_UNIT_HERO_REVIVE_FINISH or GetUnitTypeId(LoadUnitHandle(HY, h, 1))!= LoadInteger(HY, h, 0) then
		call UnitRemoveAbility(u, LoadInteger(HY, h, 1))
		call UnitRemoveAbility(u,'B0HB')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set u = null
	set t = null
endfunction
function BPI takes integer level, unit SYX, unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call UnitAddPermanentAbility(SYX,'A3LC'-1 + level)
	call TriggerRegisterUnitEvent(t, SYX, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_HERO_REVIVE_FINISH)
	call TriggerRegisterTimerEvent(t, 1, false)
	call SaveInteger(HY, GetHandleId(t), 0, GetUnitTypeId(u))
	call TriggerAddCondition(t, Condition(function BMI))
	call SaveUnitHandle(HY, GetHandleId(t), 0, SYX)
	call SaveUnitHandle(HY, GetHandleId(t), 1, u)
	call SaveInteger(HY, GetHandleId(t), 1,'A3LC'-1 + level)
	set t = null
endfunction
function BQI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if UnitAlive(u) then
		call SetUnitPathing(u, true)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set u = null
	set t = null
endfunction
function BSI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real x1 =(LoadReal(HY, h, 64))
	local real x2 =(LoadReal(HY, h, 66))
	local real y1 =(LoadReal(HY, h, 65))
	local real y2 =(LoadReal(HY, h, 67))
	local trigger tt
	call SetUnitPosition(WUE, x2, y2)
	if(A4X(x1, y1)== false or IsPointInRegion(R4, x1, y1)) and IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		set tt = CreateTrigger()
		call SaveUnitHandle(HY, GetHandleId(tt), 0, targetUnit)
		call TriggerRegisterTimerEvent(tt, 5, false)
		call SetUnitPathing(targetUnit, false)
		call TriggerAddCondition(tt, Condition(function BQI))
		set tt = null
	endif
	call SetUnitPosition(targetUnit, x1, y1)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction

function NetherSwapWait0S takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local unit WUE = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	local real x1 = GetUnitX(WUE)
	local real y1 = GetUnitY(WUE)
	local real x2 = GetUnitX(targetUnit)
	local real y2 = GetUnitY(targetUnit)
	local trigger t
	local boolean BTI = IsUnitAlly(WUE, GetOwningPlayer(targetUnit))
	local boolean BUI = GetUnitAbilityLevel(targetUnit,'A3E9')== 1
	if GetUnitAbilityLevel(WUE,'Aloc')== 1 or(BTI == false and BUI) then
		if GetUnitAbilityLevel(WUE,'Aloc')== 0 then
			call T4V(targetUnit)
			call SetUnitPosition(targetUnit, x2, y2)
			call SetUnitPosition(WUE, x1, y1)
		endif
		set targetUnit = null
		set WUE = null
		return false
	endif
	if BTI or not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(WUE))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SaveReal(HY, h, 64,((x1)* 1.))
		call SaveReal(HY, h, 66,((x2)* 1.))
		call SaveReal(HY, h, 65,((y1)* 1.))
		call SaveReal(HY, h, 67,((y2)* 1.))
		call TriggerRegisterTimerEvent(t, 0, false)
		call TriggerAddCondition(t, Condition(function BSI))
		call AddLightningToTimed("SPLK", x1, y1, x2, y2, .5, 0, 1, 1, .3)
		call KillDestructablesInCircle(x1, y1, 300)
		call KillDestructablesInCircle(x2, y2, 300)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(trig)
	set trig = null
	set WUE = null
	set targetUnit = null
	set t = null
	return false
endfunction

function SpellEffect__NetherSwap takes nothing returns nothing
	local integer h = CreateTimerEventTrigger(0., false, function NetherSwapWait0S)
	call SaveUnitHandle(HY, h, 0, GetTriggerUnit())	
	call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())	
endfunction
function K0E takes nothing returns nothing
	if(IsTerrainPathable(GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), PATHING_TYPE_WALKABILITY)) and GetUnitAbilityLevel(GetTriggerUnit(),'Aloc')== 0 then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n03B'))
	endif
endfunction
function K2E takes nothing returns nothing
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareMissile.mdl", GetTriggerUnit(), T2V(GetTriggerUnit())))
endfunction
function BWI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if GetEventDamageSource()== LoadUnitHandle(HY, h, 0) then
			call CommonUnitAddStun(GetTriggerUnit(), 1.35 + LoadReal(HY, h, 0)* .1, false)
			call UnitDamageTargetEx(LoadUnitHandle(HY, h, 1), GetTriggerUnit(), 1, 25 + 75 * LoadReal(HY, h, 0))
			if GetUnitAbilityLevel(GetTriggerUnit(),'A3E9')== 1 and LoadBoolean(HY, h, 0)== false and IsMagicImmuneUnit(LoadUnitHandle(HY, h, 1))== false then
				call SaveUnitHandle(VV,'A3E9', 0, GetTriggerUnit())
				call SaveUnitHandle(VV,'A3E9', 1, LoadUnitHandle(HY, h, 1))
				call SaveInteger(VV,'A3E9', 0, R2I(LoadReal(HY, h, 0)))
				call ExecuteFunc("BYI")
			endif
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	endif
	set t = null
endfunction
function BZI takes unit WJE, unit WLE, integer level, boolean FAR returns nothing
	local trigger t
	local integer h
	local unit d = CreateUnit(GetOwningPlayer(WJE),'e00E', GetUnitX(WJE), GetUnitY(WJE), 0)
	call UnitAddAbility(d,'A42D')
	if FAR then
		call B0R(d, WLE,$D007F)
	endif
	if FAR or IssueTargetOrderById(d, 852095, WLE) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 5, false)
		call TriggerRegisterUnitEvent(t, WLE, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(t, Condition(function BWI))
		call SaveUnitHandle(HY, h, 0, d)
		call SaveUnitHandle(HY, h, 1, WJE)
		call SaveBoolean(HY, h, 0, FAR)
		call SaveReal(HY, h, 0, level * 1.)
		set t = null
	endif
	set d = null
endfunction

function F5E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call BZI(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()), false)
	endif
endfunction
function BYI takes nothing returns nothing
	local unit WJE = LoadUnitHandle(VV,'A3E9', 0)
	local unit WLE = LoadUnitHandle(VV,'A3E9', 1)
	local integer level = LoadInteger(VV,'A3E9', 0)
	call T4V(WJE)
	if UnitHasSpellShield(WLE)== false then
		call BZI(WJE, WLE, level, true)
	endif
	set WJE = null
	set WLE = null
	call FlushChildHashtable(VV,'A3E9')
endfunction
function B_I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(P, WFV, 0)
	if UYX == 4 or UnitIsDead(LoadUnitHandle(P, WFV, 0)) then
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		return
	endif
	set UYX = UYX + 1
	call SaveInteger(P, WFV, 0, UYX)
	call SaveInteger(P, LoadInteger(P, WFV, 1), 1, UYX)
	set t = null
endfunction
function B0I takes nothing returns boolean
	local unit t = GetFilterUnit()
	if UnitAlive(t) and IsUnitEnemy(Temp__ArrayUnit[0], GetOwningPlayer(t)) and GetUnitAbilityLevel(t,'A04R')== 0 and IsUnitType(t, UNIT_TYPE_STRUCTURE)== false and(IsUnitType(t, UNIT_TYPE_ANCIENT)== false or IsBearUnit(t)) then
		call WJV(t, XK[0],'B08M', 5)
		call UnitDamageTargetEx(U2, t, 3, 75)
	endif
	set t = null
	return false
endfunction
function B1I takes nothing returns boolean
	local unit t = GetFilterUnit()
	local real d
	local real x
	local real y
	if GetUnitTypeId(t)=='e020' and GetWidgetLife(t)> .405 then
		set x = GetWidgetX(t)-Temp__ArrayReal[1]
		set y = GetWidgetY(t)-Temp__ArrayReal[2]
		set d = SquareRoot(x * x + y * y)
		if Temp__ArrayReal[0]> d then
			set Temp__ArrayUnit[0]= t
			set Temp__ArrayReal[0]= d
		endif
	endif
	set t = null
	return false
endfunction
function B2I takes nothing returns boolean
	local unit t = GetFilterUnit()
	local integer i
	if GetUnitTypeId(t)=='e020' and GetWidgetLife(t)> .405 then
		set i = LoadInteger(P, GetHandleId(t), 2)
		if XK[0]== 0 or XK[1]> i then
			set XK[1]= i
			set Temp__ArrayUnit[0]= t
		endif
		set XK[0]= XK[0]+ 1
	endif
	set t = null
	return false
endfunction
function B3I takes player p, integer WOV returns nothing
	set XK[0]= 0
	call GroupEnumUnitsOfPlayer(AK, p, Condition(function B2I))
	if XK[0]> WOV then
		call RemoveUnit(Temp__ArrayUnit[0])
	endif
endfunction
function YJV takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local integer hu = GetHandleId(u)
	local integer UYX = LoadInteger(P, hu,'A0RP')
	local real x
	local real y
	if GetUnitTypeId(u)=='e020'then
		set Temp__ArrayUnit[0]= u
		set XK[0]= LoadInteger(P, hu, 1)+'A510'
		set u = LoadUnitHandle(P, hu, 0)
		set hu = GetHandleId(u)
		set UYX = LoadInteger(P, hu,'A0RP')
	else
		set Temp__ArrayUnit[0]= null
		set Temp__ArrayReal[0]= 99999
		set Temp__ArrayReal[1]= GetWidgetX(u)
		set Temp__ArrayReal[2]= GetWidgetY(u)
		call GroupEnumUnitsOfPlayer(AK, p, Condition(function B1I))
		if Temp__ArrayUnit[0]== null then
			set u = null
			return
		endif
		set XK[0]= LoadInteger(P, GetHandleId(Temp__ArrayUnit[0]), 1)+'A510'
	endif
	set x = GetWidgetX(Temp__ArrayUnit[0])
	set y = GetWidgetY(Temp__ArrayUnit[0])
	set U2 = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	call GroupEnumUnitsInRange(AK, x, y, 400, Condition(function B0I))
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\TomeOfRetraining\\TomeOfRetrainingCaster.mdl", x, y))
	call RemoveUnit(LoadUnitHandle(P, GetHandleId(Temp__ArrayUnit[0]), 1))
	call RemoveUnit(Temp__ArrayUnit[0])
	set p = null
	set u = null
endfunction
function B4I takes unit u returns nothing
	if GetUnitTypeId(u)=='e020'then
		call YJV()
	endif
endfunction
function YHV takes nothing returns nothing
	local timer t
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local unit d = CreateUnit(p,'e020', GetSpellTargetX(), GetSpellTargetY(), 0)
	local integer hu = GetHandleId(u)
	local integer h = LoadInteger(P, hu,'A0RP')
	local integer WOV = 2 + 3 *(GetUnitAbilityLevel(u,'A0RP')+ GetUnitAbilityLevel(u,'A449'))
	local boolean b = GetUnitAbilityLevel(u,'A449')> 0
	local unit du
	call SaveInteger(P, hu,'A0RP', h + 1)
	set hu = GetHandleId(d)
	call SaveUnitHandle(P, hu, 0, u)
	call SaveInteger(P, hu, 0, 0)
	call SaveInteger(P, hu, 1, 0)
	call SaveInteger(P, hu, 2, h)
	call TriggerRegisterUnitEvent(JJ, d, EVENT_UNIT_SPELL_EFFECT)
	call B3I(p, WOV)
	call W1E(d)
	if b then
		call SaveInteger(P, hu, 1, 4)
		set du = CreateUnit(p,'e01V', GetSpellTargetX(), GetSpellTargetY(), 0)
		call UnitAddAbility(du,'A44B')
		call SaveUnitHandle(P, hu, 1, du)
		set du = null
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveInteger(P, h, 0, 0)
		call SaveInteger(P, h, 1, hu)
		call SaveUnitHandle(P, h, 0, d)
		call TimerStart(t, 1, true, function B_I)
	endif
	set d = null
	set p = null
	set u = null
	set t = null
endfunction
function L2E takes nothing returns nothing
	call UnitAddAbility(GetTriggerUnit(),'A0RT')
endfunction
function B5I takes real xc, real xt, real x, real yc, real yt, real y returns boolean
	return((y -yc)*(xt -xc)-(x -xc)*(yt -yc)> 0)
endfunction
function B6I takes unit u, real B7I, real B8I, real B9I, real CVI, real CEI, real CXI, real COI, real CRI returns boolean
	local real a1 = GetWidgetX(u)
	local real a2 = GetWidgetY(u)
	return B5I(B7I, B8I, a1, CEI, CXI, a2)== false and B5I(B9I, CVI, a1, COI, CRI, a2) and B5I(B7I, B9I, a1, CEI, COI, a2) and B5I(B8I, CVI, a1, CXI, CRI, a2)== false
endfunction

function CAI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(P, WFV, 0)
	local integer WVV
	local integer a = 0
	if LocalPlayer== LoadPlayerHandle(P, WFV, 4) then
		set a = 1
	endif
	if UYX ==$A then
		call DestroyLightning(LoadLightningHandle(P, WFV, 3))
		call DestroyLightning(LoadLightningHandle(P, WFV, 2))
		call DestroyLightning(LoadLightningHandle(P, WFV, 1))
		call DestroyLightning(LoadLightningHandle(P, WFV, 0))
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		return
	endif
	set WVV = 0
	call SaveInteger(P, WFV, 0, UYX + 1)
	set UYX = 65 +$F* UYX
	loop
	exitwhen WVV == 4
		call SetLightningColor(LoadLightningHandle(P, WFV, WVV), UYX, UYX, UYX, a)
		set WVV = WVV + 1
	endloop
	set t = null
endfunction
function CNI takes player p returns nothing
	local lightning l = null
	local timer t = CreateTimer()
	local integer WFV = GetHandleId(t)
	local integer a = 0
	if LocalPlayer== p then
		set a = 1
	endif
	call SaveInteger(P, WFV, 0, 0)
	set l = AddLightning("DRAB", false, Temp__ArrayReal[0], Temp__ArrayReal[4], Temp__ArrayReal[1], Temp__ArrayReal[5])
	call SetLightningColor(l, 50, 50, 50, a)
	call SaveLightningHandle(P, WFV, 0, l)
	// 左
	set l = AddLightning("DRAB", false, Temp__ArrayReal[0], Temp__ArrayReal[4], Temp__ArrayReal[2], Temp__ArrayReal[6])
	call SetLightningColor(l, 50, 50, 50, a)
	call SaveLightningHandle(P, WFV, 1, l)
	// 下
	set l = AddLightning("DRAB", false, Temp__ArrayReal[2], Temp__ArrayReal[6], Temp__ArrayReal[3], Temp__ArrayReal[7])
	call SetLightningColor(l, 50, 50, 50, a)
	call SaveLightningHandle(P, WFV, 2, l)
	// 右
	set l = AddLightning("DRAB", false, Temp__ArrayReal[3], Temp__ArrayReal[7], Temp__ArrayReal[1], Temp__ArrayReal[5])
	call SetLightningColor(l, 50, 50, 50, a)
	call SaveLightningHandle(P, WFV, 3, l)
	call SavePlayerHandle(P, WFV, 4, p)
	// 上
	call TimerStart(t, .05, true, function CAI)
	set l = null
	set t = null
endfunction
	
// 来源到目标的弧度
function PsiBlades_Enum takes unit u, real range, real radian, real x, real y returns nothing
	local player p = GetOwningPlayer(u)
	local real a1 = radian + bj_PI / 2.
	local real a2 = radian - bj_PI / 2.
	local real B7I = x + 55 * Cos(a1)
	local real CEI = y + 55 * Sin(a1)
	local real B9I = x + 55 * Cos(a2)
	local real COI = y + 55 * Sin(a2)
	local real B8I
	local real CXI
	local real CVI
	local real CRI
	local unit firstUnit
	local group targetGroup = LoginGroup(601)
	local real tx = x + range * Cos(radian)
	local real ty = y + range * Sin(radian)
	set a1 = range * Cos(radian)
	set a2 = range * Sin(radian)
	set B8I = B7I + a1
	set CXI = CEI + a2
	set CVI = B9I + a1
	set CRI = COI + a2
	set Temp__ArrayUnit[0]= u
	set Temp__ArrayReal[0]= B7I
	set Temp__ArrayReal[1]= B8I
	set Temp__ArrayReal[2]= B9I
	set Temp__ArrayReal[3]= CVI
	set Temp__ArrayReal[4]= CEI
	set Temp__ArrayReal[5]= CXI
	set Temp__ArrayReal[6]= COI
	set Temp__ArrayReal[7]= CRI
	if LoadBoolean(P, GetHandleId(p),'A0RO') then
		call CNI(p)
	endif

	call LineSegment.EnumUnitsEx(targetGroup, x, y, tx, ty, 110., true, null)
	call GroupRemoveUnit(targetGroup, DETargetUnit[DEI])
	loop	
		set firstUnit = FirstOfGroup(targetGroup)
		exitwhen firstUnit == null
		call GroupRemoveUnit(targetGroup, firstUnit)
		if IsUnitEnemy(firstUnit, DESourcePlayer[DEI]) and IsAliveNotStrucNotWardNotInvulnerable(firstUnit) and IsNoAncientOrBear(firstUnit) then
			call UnitDamageTargetEx(DESourceUnit[DEI], firstUnit, 3, DEDamageValue[DEI])
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\PriestMissile\\PriestMissile.mdl", firstUnit, "chest"))
		endif
	endloop
	set firstUnit = null

	call LogoutGroup(targetGroup)
	set targetGroup = null
	set p = null
endfunction

function PsiBlades_Actions takes nothing returns nothing
	local real x = GetWidgetX(DETargetUnit[DEI])
	local real y = GetWidgetY(DETargetUnit[DEI])
	local real radian

	set radian = RadianBetweenUnit(DESourceUnit[DEI], DETargetUnit[DEI])

	call PsiBlades_Enum(DESourceUnit[DEI], 575 +(GetUnitAbilityLevel(DESourceUnit[DEI],'A0RO'))* 40, radian, x, y)
endfunction

function S3E takes nothing returns nothing
	local player p = GetTriggerPlayer()
	local integer WFV = GetHandleId(p)
	local boolean b = LoadBoolean(P, WFV,'A0RO')
	if LocalPlayer == p then
		call GetSetUpText("灵能之刃作用范围显示", b)
	endif
	call SaveBoolean(P, WFV,'A0RO', not b)
	//if b then
	//	call DisplayTextToPlayer(p, 0, 0, "灵能之刃作用范围显示已|c00FF0000关闭|r")
	//else
	//	call DisplayTextToPlayer(p, 0, 0, "灵能之刃作用范围显示已|c00FF0000开启|r")
	//endif

endfunction
function CHI takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	call TriggerRegisterPlayerChatEvent(KJ, p, "-display", true)
	call DisplayTextToPlayer(p, 0, 0, "输入 -display 来显示灵能之刃的作用范围")
endfunction

function range_Psi_Blades takes nothing returns nothing
	local unit u = U2
	local integer lv = Q2
	call AddUnitAttack1RangeBonus_OnlyRangeAttacker(u, 60. * lv)
	set u = null
endfunction

function P_E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer lv =(GetUnitAbilityLevel(u,'A0RO'))
	call AddUnitAttack1RangeBonus_OnlyRangeAttacker(u, 60.)
	if lv == 1 then
		call CHI(u)
		call SaveBoolean(P, GetHandleId(u),'A0RO', true)
	endif
	set u = null
endfunction
function CJI takes nothing returns boolean
	local unit triggerUnit = GetTriggerUnit()
	local integer h = GetHandleId(triggerUnit)
	local integer Y2X =(LoadInteger(HY, h, 'A0RN'))

		call UnitRemoveAbility(triggerUnit,'A0RN')
		call UnitRemoveAbility(triggerUnit,'B08J')
		call SaveInteger(HY, h, 'A0RN', 0)
	set triggerUnit = null
	return false
endfunction
function CKI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local unit triggerUnit =(LoadUnitHandle(HY,(GetHandleId(t)), 14))
	local integer h = GetHandleId(triggerUnit)
	local integer Y2X =(LoadInteger(HY, h, 351))
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or(GetTriggerEventId()== EVENT_PLAYER_UNIT_ATTACKED and GetAttacker()== triggerUnit and IsUnitAlly(GetAttacker(), GetOwningPlayer(GetTriggerUnit()))== false) then
		if GetTriggerEventId()!= EVENT_WIDGET_DEATH and Y2X > 0 and GetEventDamage()> 0 then
			call SaveInteger(HY, h, 351,(Y2X -1))
		else
			call UnitRemoveAbility(triggerUnit,'A0RF')
			call UnitRemoveAbility(triggerUnit,'A0RM')
			call UnitRemoveAbility(triggerUnit,'B08I')
			call SaveInteger(HY, h, 351, 0)
		endif
	endif
	set t = null
	set triggerUnit = null
	return false
endfunction
function CLI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 14))
	local integer hu = GetHandleId(u)
	if LoadInteger(HY, h, 0)<= 1 then
		call RemoveSavedHandle(HY, hu,'A0RN')
		call SaveInteger(HY, hu, 'A0RN', 0)
		call SaveInteger(HY, hu, 351, 0)
		call UnitRemoveAbility(u,'A0RF')
		call UnitRemoveAbility(u,'A0RM')
		call UnitRemoveAbility(u,'A0RN')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)-1)
	endif
	set t = null
	set u = null
	return false
endfunction
function XFE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer hu = GetHandleId(u)
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(u, GetSpellAbilityId())+ 2
	if HaveSavedHandle(HY, hu,'A0RN') then
		set t = LoadTriggerHandle(HY, hu,'A0RN')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerAddCondition(t, Condition(function CLI))
		call SaveUnitHandle(HY,(GetHandleId(t)), 14,(u))
		call SaveTriggerHandle(HY, hu,'A0RN', t)
	endif
	call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 1)
	call TriggerRegisterTimerEvent(t, 17, false)
	call PlaySoundAtPoint(CE, GetUnitX(u), GetUnitY(u))
	call UnitAddPermanentAbility(u,'A0RN')
	call SaveInteger(HY, hu, 'A0RN', level)
	call UnitAddPermanentAbility(u,'A0RF')
	call SetUnitAbilityLevel(u,'A0RF', GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call UnitAddPermanentAbility(u,'A0RM')
	call SaveInteger(HY, hu, 351, level)
	set u = null
	set t = null
endfunction
function M_E takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local trigger t
	set t = CreateTrigger()
	call TriggerRegisterDeathEvent(t, triggerUnit)
	call TriggerAddCondition(t, Condition(function CJI))
	call SaveInteger(HY,(GetHandleId(triggerUnit)), 'A0RN', 0)
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterDeathEvent(t, triggerUnit)
	call TriggerAddCondition(t, Condition(function CKI))
	call SaveUnitHandle(HY,(GetHandleId(t)), 14,(triggerUnit))
	call SaveInteger(HY,(GetHandleId(triggerUnit)), 351, 0)
	set t = null
	set triggerUnit = null
endfunction

function MeldEffectRemoveActions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit sourceUnit = LoadUnitHandle(HY, h, 14)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local integer level = LoadInteger(HY, h, 0)
	local boolean isEnd = false
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		set isEnd = true
	elseif GetTriggerEventId() == EVENT_UNIT_SPELL_CAST and not IsNotShowAbilityId(GetSpellAbilityId()) then
		set isEnd = true
	else
		set isEnd = (x != GetUnitX(sourceUnit) or y != GetUnitY(sourceUnit))
	endif
	if isEnd then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveCustomBuffEx(sourceUnit,'B08K')
		set h = GetHandleId(sourceUnit)
		call RemoveSavedBoolean(ExtraHT, h, MELD_STATE)
		call RemoveSavedInteger(ExtraHT, h, MELD_STATE)
	endif
	set t = null
	set sourceUnit = null
	return false
endfunction

globals
	key MELD_STATE
endglobals

function MeldAttackEffectEnd takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local real armor = LoadReal(HY, GetHandleId(t), 0)
	call LodSystem_AddUnitExtraState(LoadUnitHandle(HY, GetHandleId(t), 14), armor, STATE_SYSTEM_ARMOUR)
	call FlushChildHashtable(HY, GetHandleId(t))
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function MeldAttackHitAcionts takes unit WUE, unit targetUnit, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer damage = 50 * level
	local real armor = 2 * level
	call SaveReal(HY, GetHandleId(t), 0, armor)
	call SaveUnitHandle(HY, GetHandleId(t), 14, targetUnit)
	call TriggerRegisterTimerEvent(t, 10, false)
	call TriggerAddCondition(t, Condition(function MeldAttackEffectEnd))
	call LodSystem_ReduceUnitExtraState(targetUnit, armor, STATE_SYSTEM_ARMOUR)
	call UnitDamageTargetEx(WUE, targetUnit, 2, damage)
	call CommonTextTag(I2S(damage), 1, targetUnit, .03, 255, 0, 0, 255)

	set t = null
endfunction

function MeldAttack_RL takes nothing returns nothing
	if LoadBoolean(ExtraHT, GetHandleId(ARSourceUnit[ARI]), 'A0RV')  then
		if not IsUnitType(ARTargetUnit[ARI], UNIT_TYPE_STRUCTURE) and IsUnitEnemy(ARSourceUnit[ARI], GetOwningPlayer(ARTargetUnit[ARI])) then
			set MeldCount = MeldCount + 1
			call SaveBoolean(ExtraHT, GetHandleId(ARSourceUnit[ARI]), MELD_STATE, true)
			call SaveUnitHandle(ExtraHT, GetHandleId(ARSourceUnit[ARI]), MELD_STATE, ARTargetUnit[ARI])
		endif
		call RemoveSavedBoolean(ExtraHT, GetHandleId(ARSourceUnit[ARI]), 'A0RV')
		call UnitRemoveCustomBuffEx(ARSourceUnit[ARI], 'B08K')
	endif
endfunction
function Meld__AddBuff__Actions takes nothing returns nothing
	local custombuff b = GetTriggerBuff()
	call UnitAddWindWalk(b.target)
	call AddAttackLaunchingTrigCount(b.target)
	//call SetUnitPeonType(b.target, true)
endfunction
function Meld__RemoveBuff__Actions takes nothing returns nothing
	local custombuff b = GetTriggerBuff()
	call UnitRemoveWindWalk(b.target)
	call ReduceAttackLaunchingTrigCount(b.target)
	//call SetUnitPeonType(b.target, false)
endfunction
// 隐匿
function SpellEffect__Meld takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0RV')
	local custombuff b = custombuff.create(triggerUnit, triggerUnit)
	call UnitRemoveAbilityToTimed(triggerUnit, 'BOwk', 0.)
	call SaveBoolean(ExtraHT, GetHandleId(triggerUnit), 'A0RV', true)
	call SaveInteger(ExtraHT, GetHandleId(triggerUnit), MELD_STATE, level)

	set b.aid = 'AW8K'
	set b.bid = 'B08K'
	set b.dur = 3600.
	set b.overlayDur = true
	set b.level = level
	set b.basicDispel = false
	set b.removeActions = "Meld__RemoveBuff__Actions"
	set b.addActions = "Meld__AddBuff__Actions"
	call b.add_buff()

	call DestroyEffect(AddSpecialEffectTarget("effects\\PurpleAura.mdx", triggerUnit, "origin"))
	call PlaySoundAtPoint(MeldSound, GetUnitX(triggerUnit), GetUnitY(triggerUnit))
	call TriggerRegisterDeathEvent(t, triggerUnit)
	call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_SPELL_CAST)
	call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerAddCondition(t, Condition(function MeldEffectRemoveActions))
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	call SaveReal(HY, h, 6, GetUnitX(triggerUnit))
	call SaveReal(HY, h, 7, GetUnitY(triggerUnit))
	call IssueImmediateOrderById(triggerUnit,$D0019)
	set t = null
	set triggerUnit = null
endfunction
function CWI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local integer level =(LoadInteger(HY, h, 5))
	local integer CYI =(LoadInteger(HY, h,$F7))
	call DestroyEffect(AddSpecialEffect("effects\\Tornado.mdx", GetUnitX(WUE), GetUnitY(WUE)))
	if GetTriggerEvalCount(t)>$A*(2 + .75 * level) or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call DestroyEffect((LoadEffectHandle(HY, h, 175)))
		call DestroyEffect((LoadEffectHandle(HY, h, 176)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	return false
endfunction
function XHE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(WUE,'A14I')
	local integer CYI
	if level == 1 then
		set CYI ='A135'
	elseif level == 2 then
		set CYI ='A12O'
	elseif level == 3 then
		set CYI ='A134'
	elseif level == 4 then
		set CYI ='A139'
	endif
	call EnableEffectByTime(0, 7)
	call AddAbilityToTimed(WUE, CYI, 1, 2 + level,'B09W')
	call UnitMakeAbilityPermanent(WUE, true,'ACes')
	call UnitMakeAbilityPermanent(WUE, true,'A12M')
	call UnitMakeAbilityPermanent(WUE, true,'A133')
	call UnitMakeAbilityPermanent(WUE, true,'A132')
	call UnitMakeAbilityPermanent(WUE, true,'A131')
	call UnitMakeAbilityPermanent(WUE, true,'A13A')
	call S9E(GetOwningPlayer(WUE), CYI, false)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerAddCondition(t, Condition(function CWI))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY, h,$F7,(CYI))
	call SaveEffectHandle(HY, h, 175,(AddSpecialEffectTarget("effects\\Tornado.mdx", WUE, "hand,left")))
	call SaveEffectHandle(HY, h, 176,(AddSpecialEffectTarget("effects\\Tornado.mdx", WUE, "hand,right")))
	call EXShowHideUnit(WUE)
	set WUE = null
	set t = null
endfunction
function CZI takes nothing returns nothing
	local destructable targetUnit = GetEnumDestructable()
	local real a = Atan2(GetDestructableY(targetUnit)-GetUnitY(U2), GetDestructableX(targetUnit)-GetUnitX(U2))
	local real AXO = RAbsBJ((S2 -a)* bj_RADTODEG)
	if(IsTreeDestructable(targetUnit) or GetDestructableTypeId(targetUnit)=='B005') and GetDestructableLife(targetUnit)> 1 and AXO < KJV and AXO <(KKV) then
		set KJV = AXO
		set KGV = targetUnit
	endif
	set targetUnit = null
endfunction
function C_I takes unit NIX, unit WUE, real J2E returns destructable
	local real x = GetUnitX(NIX)
	local real y = GetUnitY(NIX)
	local rect r = Rect(x -KLV, y -KLV, x + KLV, y + KLV)
	set KJV = 9999
	set U2 = NIX
	set KGV = null
	call EnumDestructablesInRect(r, TrueBoolexprCondition, function CZI)
	call RemoveRect(r)
	set r = null
	return KGV
endfunction
function C0I takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local real a = Atan2(GetUnitY(targetUnit)-GetUnitY(U2), GetUnitX(targetUnit)-GetUnitX(U2))
	local real AXO = RAbsBJ((S2 -a)* bj_RADTODEG)
	if AXO < KJV and AXO < KKV and targetUnit != W2 then
		set KJV = AXO
		set KHV = targetUnit
	endif
	set targetUnit = null
endfunction
function C1I takes unit NIX, unit WUE, real J2E returns unit
	local group g = LoginGroup(294)
	set KHV = null
	set KJV = 9999
	set U2 = NIX
	set S2 = Atan2(GetUnitY(WUE)-KPV, GetUnitX(WUE)-KMV)
	set W2 = WUE
	call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 600, Condition(function DQX))
	call ForGroup(g, function C0I)
	call LogoutGroup(g)
	set g = null
	return KHV
endfunction
function C2I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if(LoadLightningHandle(HY, h,$C4))!= null then
		call DestroyLightning((LoadLightningHandle(HY, h,$C4)))
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function C3I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit NIX =(LoadUnitHandle(HY, h, 45))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real C4I =(LoadReal(HY, h,$F8))
	local real a = Atan2(GetUnitY(targetUnit)-GetUnitY(NIX), GetUnitX(targetUnit)-GetUnitX(NIX))
	local integer level =(LoadInteger(HY, h, 5))
	local real x = GetUnitX(NIX)+ 50 * Cos(a)
	local real y = GetUnitY(NIX)+ 50 * Sin(a)
	local unit C5I
	local destructable d
	local lightning APX
	local unit dummyUnit
	local boolean I1O =(LoadBoolean(HY, h,$F9))
	local real FWX
	local real C6I
	local boolean FAR
	local unit WUE
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(NIX)
	else
		call SetUnitX(NIX, x)
		call SetUnitY(NIX, y)
		call SetUnitFacing(NIX, a * bj_RADTODEG)
		if GetDistanceBetween(x, y, GetUnitX(targetUnit), GetUnitY(targetUnit))< 45 then
			set KMV =(LoadReal(HY, h, 6))
			set KPV =(LoadReal(HY, h, 7))
			set FAR = LoadBoolean(HY, h, 0)
			set WUE = LoadUnitHandle(HY, h, 44)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			if GetUnitTypeId(targetUnit)!='n00L' and I1O then
				if GetUnitAbilityLevel(targetUnit,'A3E9')== 1 and IsMagicImmuneUnit(WUE)== false and FAR == false then
					call SaveUnitHandle(VV,'A3E9', 0, targetUnit)
					call SaveUnitHandle(VV,'A3E9', 1, WUE)
					call SaveInteger(VV,'A3E9', 0, level)
					call ExecuteFunc("C7I")
				endif
				set C5I = C1I(NIX, targetUnit, C4I)
				set d = C_I(NIX, targetUnit, C4I)
				if C5I != null then
					set t = CreateTrigger()
					set h = GetHandleId(t)
					set FWX = CommonUnitAddStun(targetUnit, .75 *(level + 1), false)
					set C6I = CommonUnitAddStun(C5I, .75 *(level + 1), false)
					call TriggerRegisterTimerEvent(t, RMaxBJ(FWX, C6I), false)
					call TriggerAddCondition(t, Condition(function C2I))
					set APX = AddLightning("MFPB", true, GetUnitX(targetUnit), GetUnitY(targetUnit), GetUnitX(C5I), GetUnitY(C5I))
					call SetLightningColor(APX, .5, .5, 1, 1)
					call SaveLightningHandle(HY, h,$C4,(APX))
				elseif d != null then
					set t = CreateTrigger()
					set h = GetHandleId(t)
					set dummyUnit = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
					set FWX = CommonUnitAddStun(targetUnit, .75 *(level + 1), false)
					call TriggerRegisterTimerEvent(t, FWX, false)
					call TriggerAddCondition(t, Condition(function C2I))
					set APX = AddLightning("MFPB", true, GetUnitX(targetUnit), GetUnitY(targetUnit), GetDestructableX(d), GetDestructableY(d))
					call SetLightningColor(APX, .5, .5, 1, 1)
					call SaveLightningHandle(HY, h,$C4,(APX))
					call SetDestructableAnimation(d, "stand hit")
				else
					call CommonUnitAddStun(targetUnit, .75, false)
				endif
			endif
			call KillUnit(NIX)
		endif
	endif
	set t = null
	set NIX = null
	set targetUnit = null
	set APX = null
	set C5I = null
	set d = null
	set dummyUnit = null
	return false
endfunction
function C8I takes unit WUE, unit targetUnit, integer level, boolean FAR returns nothing
	local real a = Atan2(GetUnitY(targetUnit)-GetUnitY(WUE), GetUnitX(targetUnit)-GetUnitX(WUE))
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit NIX = CreateUnit(GetOwningPlayer(WUE),'h077', GetUnitX(WUE), GetUnitY(WUE), a * bj_RADTODEG)
	local boolean I1O = UnitHasSpellShield(targetUnit)== false
	call SaveUnitHandle(HY, h, 45,(NIX))
	call SaveUnitHandle(HY, h, 44, WUE)
	call SaveBoolean(HY, h, 0, FAR)
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h,$F8,((a)* 1.))
	call SaveBoolean(HY, h,$F9,(I1O))
	call SaveReal(HY, h, 6,((GetUnitX(WUE))* 1.))
	call SaveReal(HY, h, 7,((GetUnitY(WUE))* 1.))
	call TriggerRegisterTimerEvent(t, .033, true)
	call TriggerAddCondition(t, Condition(function C3I))
	call TriggerRegisterDeathEvent(t, targetUnit)
	set NIX = null
	set t = null
endfunction
function XJE takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(WJE,'A12J')
	call C8I(WJE, WLE, level, false)
	set WJE = null
	set WLE = null
endfunction
function C7I takes nothing returns nothing
	local unit WJE = LoadUnitHandle(VV,'A3E9', 0)
	local unit WLE = LoadUnitHandle(VV,'A3E9', 1)
	local integer level = LoadInteger(VV,'A3E9', 0)
	call T4V(WJE)
	call C8I(WJE, WLE, level, true)
	set WJE = null
	set WLE = null
endfunction
function C9I takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), KQV)== false and GetUnitAbilityLevel(GetEnumUnit(),'Bcyc')== 0 then
		call UnitDamageTargetEx((KSV),(GetEnumUnit()), 1,(((KTV)* 1.))* Pow(.9,(KWV))* Pow(.99,(KUV)))
		call GroupAddUnit(KQV, GetEnumUnit())
		set KWV = KWV + 1
	endif
endfunction
function DVI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit NIX =(LoadUnitHandle(HY, h, 45))
	local real W_E =(LoadReal(HY, h, 47))
	local real W0E =(LoadReal(HY, h, 48))
	local real a =(LoadReal(HY, h, 13))
	local real IXX =(LoadReal(HY, h, 20))
	local integer DEI =(LoadInteger(HY, h, 354))
	local integer DXI =(LoadInteger(HY, h, 355))
	local group D7R =(LoadGroupHandle(HY, h, 187))
	local real x = CoordinateX50(GetUnitX(NIX)+(60 * Pow(.9, DXI)* Pow(.99, DEI))* Cos(a))
	local real y = CoordinateY50(GetUnitY(NIX)+(60 * Pow(.9, DXI)* Pow(.99, DEI))* Sin(a))
	local group g = LoginGroup(295)
	local real d
	if GetTriggerEvalCount(t)> 2 then
		set d =$96
	else
		set d = 75
	endif
	call DestroyEffect(AddSpecialEffect("effects\\Tornado.mdx", x, y))
	set DEI = DEI + KillDestructablesInCircle(x, y, 75)
	call SaveInteger(HY, h, 354,(DEI))
	set KQV = D7R
	set KSV = NIX
	set KTV = IXX
	set KUV = DEI
	set KWV = DXI
	set U2 = NIX
	call GroupEnumUnitsInRange(g, x, y, d, Condition(function DJX))
	call ForGroup(g, function C9I)
	call LogoutGroup(g)
	call SaveInteger(HY, h, 355,(KWV))
	call SetUnitX(NIX, x)
	call SetUnitY(NIX, y)
	if GetTriggerEvalCount(t)> 43 then
		call KillUnit(NIX)
		call LogoutGroup(D7R)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set NIX = null
	set D7R = null
	set g = null
	return false
endfunction
function DOI takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local real x2 =(LoadReal(HY,(GetHandleId(WUE)), 356))
	local real y2 =(LoadReal(HY,(GetHandleId(WUE)), 357))
	local real DRI = RMinBJ(GetGameTime()-LoadReal(HY, GetHandleId(WUE), 358), 1.)
	local real a = Atan2(y2 -GetUnitY(WUE), x2 -GetUnitX(WUE))
	local trigger t
	local integer h
	local unit NIX
	local integer level = GetUnitAbilityLevel(WUE,'A12K')
	local real IXX =(40 + 80 * level)*(DRI)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	set NIX = CreateUnit(GetOwningPlayer(WUE),'h078', GetUnitX(WUE), GetUnitY(WUE), a * bj_RADTODEG)
	set x2 = GetUnitX(WUE)+$9AB* Cos(a)
	set y2 = GetUnitY(WUE)+$9AB* Sin(a)
	call SaveUnitHandle(HY, h, 45,(NIX))
	call SaveReal(HY, h, 47,((x2)* 1.))
	call SaveReal(HY, h, 48,((y2)* 1.))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveReal(HY, h, 20,((IXX)* 1.))
	call SaveInteger(HY, h, 354, 0)
	call SaveInteger(HY, h, 355, 0)
	call SaveGroupHandle(HY, h, 187,(LoginGroup(296)))
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function DVI))
	set WUE = null
	set t = null
	set NIX = null
endfunction
function DII takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	call SetUnitTimeScale(triggerUnit, 1)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set triggerUnit = null
	return false
endfunction
function DAI takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = GetTriggerUnit()
	local location l = GetSpellTargetLoc()
	local real x = GetLocationX(l)
	local real y = GetLocationY(l)
	call RemoveLocation(l)
	call SaveReal(HY,(GetHandleId(triggerUnit)), 356,((x)* 1.))
	call SaveReal(HY,(GetHandleId(triggerUnit)), 357,((y)* 1.))
	call SaveReal(HY,(GetHandleId(triggerUnit)), 358, GetGameTime()-0.3)
	call SetUnitTimeScale(triggerUnit, .75)
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call TriggerRegisterTimerEvent(t, .75, false)
	call TriggerRegisterDeathEvent(t, triggerUnit)
	call TriggerAddCondition(t, Condition(function DII))
	set t = null
	set triggerUnit = null
	set l = null
endfunction
function LIE takes nothing returns nothing
	call SaveBoolean(HY, GetHandleId(GetTriggerUnit()), 360, false)
	call DAI()
endfunction
function DNI takes nothing returns boolean
	if GetSpellAbilityId()=='A12K' then
		if(LoadBoolean(HY,(GetHandleId(GetTriggerUnit())), 360)) then
			call DOI()
		endif
	endif
	return false
endfunction
function XKE takes nothing returns nothing
	call SaveBoolean(HY, GetHandleId(GetTriggerUnit()), 360, true)
endfunction
function PSX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function DNI))
	call SetAllPlayerAbilityUnavailable('A12R')
	set t = null
endfunction
function FocusFireActions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit sourceUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local real J0R =(LoadReal(HY, h,$C1))
	local boolean isScepterUpgrade =(LoadBoolean(HY, h, 15))
	//	if GetTriggerEvalCount(t)== 1 then
	//		call TriggerRegisterUnitEvent(t, sourceUnit, EVENT_UNIT_SPELL_EFFECT)
	//	endif
	if GetTriggerEventId()== EVENT_PLAYER_UNIT_ATTACKED then
		if GetAttacker()== sourceUnit and GetTriggerUnit()== targetUnit then
			call DestroyEffect(AddSpecialEffectTarget("effects\\Tornado.mdx", sourceUnit, "hand,left"))
			call DestroyEffect(AddSpecialEffectTarget("effects\\Tornado.mdx", sourceUnit, "hand,right"))
			if GetUnitAbilityLevel(sourceUnit,'A12R')== 0 then
				call UnitAddPermanentAbility(sourceUnit,'A12R')
				call UnitMakeAbilityPermanent(sourceUnit, true,'A12S')
				call UnitMakeAbilityPermanent(sourceUnit, true,'A12Q')
			endif
		elseif GetAttacker()== sourceUnit and GetTriggerUnit()!= targetUnit then
			call UnitRemoveAbility(sourceUnit,'A12R')
			call UnitRemoveAbility(sourceUnit,'B09X')
		endif
	else
		call UnitRemoveAbility(sourceUnit,'A12R')
		call UnitRemoveAbility(sourceUnit,'B09X')
		call RemoveSavedHandle(HY, GetHandleId(sourceUnit), 'A12P')
		call RemoveSavedReal(HY, GetHandleId(sourceUnit), 'A12P')
		call RemoveSavedBoolean(HY, GetHandleId(sourceUnit), 'A12P')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set sourceUnit = null
	set targetUnit = null
	return false
endfunction

function FocusFireTrig takes nothing returns nothing
	local unit soucrUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger trig
	local integer h
	local integer uh = GetHandleId(soucrUnit)
	local integer level = GetUnitAbilityLevel(soucrUnit,'A12P')
	local real J0R = .6 -level * .1
	local boolean isScepterUpgrade = false
	if GetUnitAbilityLevel(soucrUnit,'Aloc')== 1 and HaveSavedHandle(HY, GetHandleId(soucrUnit), 0) then
		set soucrUnit = LoadUnitHandle(HY, GetHandleId(soucrUnit), 0)
	endif
	if(HaveSavedHandle(HY, uh, 'A12P') ) then
		set trig = LoadTriggerHandle(HY, uh, 'A12P')
		call FlushChildHashtable(HY, GetHandleId(trig))
		call CleanCurrentTrigger(trig)
	endif
	set trig = CreateTrigger()
	set h = GetHandleId(trig)
	call UnitRemoveAbility(soucrUnit,'A12R')
	call UnitRemoveAbility(soucrUnit,'B09X')
	//	call UnitAddAbility(u, 'A33Y')
	//    call UnitRemoveAbility(u, 'A33Y')
	if level == 0 then
		set level = GetUnitAbilityLevel(soucrUnit,'A1D6')
		if level == 3 then
			set J0R = 1.
		else
			set J0R = .6 -level * .15
		endif
	endif

	call IssueTargetOrderById(soucrUnit, 851983, targetUnit)

	call UnitAddPermanentAbility(soucrUnit,'A12R')
	call UnitMakeAbilityPermanent(soucrUnit, true,'A12S')
	call UnitMakeAbilityPermanent(soucrUnit, true,'A12Q')

	call SaveUnitHandle(HY, h, 2,(soucrUnit))
	call SaveBoolean(HY, h, 15,(isScepterUpgrade))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))

	call SaveTriggerHandle(HY, uh, 'A12P', trig)
	call SaveReal(HY, uh, 'A12P', J0R)

	call TriggerRegisterTimerEvent(trig, 20, false)
	call TriggerRegisterPlayerUnitEventBJ(trig, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterDeathEvent(trig, soucrUnit)
	call TriggerRegisterUnitEvent(trig, targetUnit, EVENT_UNIT_DEATH)
	call TriggerAddCondition(trig, Condition(function FocusFireActions))

	call EnableEffectByTime(EFFECT_KEY_FOCUS_FIRE, 20)


	set soucrUnit = null
	set targetUnit = null
	set trig = null
endfunction
function SpellEffect__FocusFire takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call FocusFireTrig()
	endif
endfunction
function DFI takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and GetUnitTypeId(GetFilterUnit())!='H00J' and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(KYV))))
endfunction
function DGI takes nothing returns nothing
	local real x = GetUnitX(GetEnumUnit())
	local real y = GetUnitY(GetEnumUnit())
	local unit d = CreateUnit(GetOwningPlayer(KYV),'e000', x, y, 0)
	local integer id ='A06L'
	call UnitAddAbility(d,'Aloc')
	call UnitApplyTimedLife(d,'BTLF', 3)
	if GetSpellAbilityId()!='A29G' then
		set id ='A07C'
	endif
	call UnitAddAbility(d, id)
	call SetUnitAbilityLevel(d, id, QI)
	if GetUnitAbilityLevel(GetEnumUnit(),'A1HX')== 0 then
		call IssueTargetOrderById(d,$D0097, GetEnumUnit())
	endif
	set d = null
endfunction
function XME takes nothing returns nothing
	local group g = LoginGroup(297)
	set KYV = GetTriggerUnit()
	set QI = GetUnitAbilityLevel(KYV,'A29G')+ GetUnitAbilityLevel(KYV,'A29H')
	call GroupEnumUnitsInRect(g, bj_mapInitialPlayableArea, Condition(function DFI))
	call ForGroup(g, function DGI)
	call LogoutGroup(g)
	set g = null
endfunction
function DHI takes nothing returns boolean
	local unit t = GetFilterUnit()
	local unit u = Temp__ArrayUnit[0]
	if IsUnitEnemy(u, GetOwningPlayer(t)) and UnitAlive(t) and IsMagicImmuneUnit(t)== false and GetUnitAbilityLevel(t,'A04R')== 0 and IsUnitType(t, UNIT_TYPE_STRUCTURE)== false and GetUnitTypeId(t)!='n00L' then
		call UnitDamageTargetEx(u, t, 1, GetWidgetLife(t)*(.03 + .02 * XK[0])+ .01 * GetUnitState(t, UNIT_STATE_MAX_LIFE))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\ForkedLightning\\ForkedLightningTarget.mdl", t, "overhead"))
	endif
	set u = null
	set t = null
	return false
endfunction
function DJI takes unit u returns nothing
	local group g = LoginGroup(298)
	local unit u2
	local unit IZX = null
	local integer level
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u),$514, Condition(function D5X))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		if GetUnitAbilityLevel(u2,'A0N5')> 0 then
			set IZX = u2
		exitwhen true
		endif
		call GroupRemoveUnit(g, u2)
	endloop
	if IZX != null then
		set XK[0]= GetUnitAbilityLevel(IZX,'A0N5')
		set Temp__ArrayUnit[0]= IZX
		call GroupEnumUnitsInRange(AK, GetWidgetX(IZX), GetWidgetY(IZX), 1225, Condition(function DHI))
	endif
	set IZX = null
	set u2 = null
	call LogoutGroup(g)
	set g = null
endfunction
function DKI takes unit u, integer WTV returns nothing
	set XK[0]= GetUnitAbilityLevel(u,'A0N5')
	if GetUnitAbilityLevel(u,'A36D')== 0 and((IsAttackSpecialEffectsId(WTV)== false and X5R(WTV)== false and LNX(WTV)== false and IsNotItemAbility(WTV) and GetUnitAbilityLevel(u,'A04R')== 0 and X6R(WTV)== false) or(Mode__BalanceOff and OER(WTV))) then
		if XK[0]> 0 then
			set Temp__ArrayUnit[0]= u
			call GroupEnumUnitsInRange(AK, GetWidgetX(u), GetWidgetY(u), 1225, Condition(function DHI))
		endif
	endif
endfunction
function DLI takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsAliveNotStrucNotWard(GetFilterUnit()) and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(U2)) and IsMagicImmuneUnit(GetFilterUnit())== false)!= null
endfunction
function DMI takes unit u, unit t, integer lv, boolean FAR, real x, real y returns nothing
	local unit d
	local real ZCE = 25 + lv * 75
	local group g
	if lv == 3 then
		set ZCE = 275
	endif
	if lv == 4 then
		set ZCE = 350
	endif
	if t == null then
		set g = LoginGroup(299)
		set U2 = u
		call GroupEnumUnitsInRange(g, x, y, 425, Condition(function DLI))
		set t = GetNearestUnitByGroup(g, x, y)
		call LogoutGroup(g)
		set g = null
	endif
	if t != null and UnitHasSpellShield(t)== false then
		if GetUnitAbilityLevel(t,'A3E9')== 1 and not IsMagicImmuneUnit(u) and FAR == false then
			call SaveUnitHandle(VV,'A3E9', 0, t)
			call SaveUnitHandle(VV,'A3E9', 1, u)
			call SaveInteger(VV,'A3E9', 0, lv)
			call ExecuteFunc("DPI")
		endif
		set x = GetUnitX(t)
		set y = GetUnitY(t)
		call TDV(t)
		call IOX(u, t, 1, ZCE, .25)
	endif
	set d = CreateUnit(GetOwningPlayer(u),'e000', x, y, 0)
	call UnitAddAbility(d,'Aloc')
	call UnitAddAbility(d,'A3FR')
	call UnitApplyTimedLife(d,'BTLF', 4.5)
	call SetUnitPathing(d, false)
	if t == null or IssueTargetOrderById(d,$D0097, t)== false then
		set t = CreateUnit(GetOwningPlayer(u),'e00C', x, y, 0)
		call UnitApplyTimedLife(t,'BTLF', .2)
		call UnitAddAbility(t,'Aetl')
		call IssueTargetOrderById(d,$D0097, t)
		call DestroyEffect(AddSpellEffectById('A3FR', EFFECT_TYPE_TARGET, x, y))
	endif
	set g = null
	set d = null
endfunction
function XPE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit t = GetSpellTargetUnit()
	call DMI(u, t, GetUnitAbilityLevel(u,'A0JC'), false, GetSpellTargetX(), GetSpellTargetY())
	set u = null
	set t = null
endfunction
function DPI takes nothing returns nothing
	local unit WJE = LoadUnitHandle(VV,'A3E9', 0)
	local unit WLE = LoadUnitHandle(VV,'A3E9', 1)
	local integer lv = LoadInteger(VV,'A3E9', 0)
	call T4V(LoadUnitHandle(VV,'A3E9', 0))
	call DMI(WJE, WLE, lv, true, GetUnitX(WLE), GetUnitY(WLE))
	set WJE = null
	set WLE = null
	call FlushChildHashtable(VV,'A3E9')
endfunction
function ETI takes nothing returns nothing
	local unit u = LoadUnitHandle(VV,'A3E9', 0)
	local integer lv = LoadInteger(VV,'A3E9', 0)
	local real x = LoadReal(VV,'A3E9', 0)
	local real y = LoadReal(VV,'A3E9', 1)
	call DMI(u, null, lv, true, x, y)
	set u = null
	call FlushChildHashtable(VV,'A3E9')
endfunction
function DQI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit dummyUnit = LoadUnitHandle(HY, h, 19)
	local integer UYX = LoadInteger(HY, h, 0)+ 1
	call SaveInteger(HY, h, 0, UYX)
	call SetUnitX(dummyUnit, GetUnitX(WUE))
	call SetUnitY(dummyUnit, GetUnitY(WUE))
	if UYX > 80 then
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	endif
	set t = null
	set WUE = null
	set dummyUnit = null
endfunction
function DSI takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e02C', GetUnitX(WUE), GetUnitY(WUE), 0)
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call UnitAddPermanentAbility(dummyUnit,'A1FM')
	call SetUnitAbilityLevel(dummyUnit,'A1FM', GetUnitAbilityLevel(WUE,'A020'))
	call IssueTargetOrderById(dummyUnit,$D0097, targetUnit)
	call UnitApplyTimedLife(dummyUnit,'BTLF', 10)
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 19, dummyUnit)
	call TimerStart(t, .05, true, function DQI)
	set WUE = null
	set targetUnit = null
	set dummyUnit = null
	set t = null
endfunction
function XQE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call DSI()
	endif
endfunction
function DTI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call UnitDamageTargetEx(LoadUnitHandle(HY, h, 14), LoadUnitHandle(HY, h, 14), 3, LoadReal(HY, h, 20))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function DUI takes unit WJE, unit WLE returns nothing
	local real ZCE = 25 + 25 * GetUnitAbilityLevel(WJE,('A0I3'))
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	if IsUnitType(WJE, UNIT_TYPE_HERO)== false and HaveSavedHandle(HY, GetHandleId(WJE), 0) then
		set WJE = LoadUnitHandle(HY, GetHandleId(WJE), 0)
	endif
	if IsUnitAlly(WLE, GetOwningPlayer(WJE)) then
		if UnitAlive(WLE) then
			call SetWidgetLife(WLE, GetWidgetLife(WLE)+ 2 * ZCE + 75)
		endif
	else
		call UnitDamageTargetEx(WJE, WLE, 1, 2 * ZCE + 75)
	endif
	call SaveUnitHandle(HY, h, 14, WJE)
	call SaveReal(HY, h, 20,(ZCE + 50)* 1.)
	call TimerStart(t, 0, false, function DTI)
	set t = null
endfunction
function DWI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call DUI(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function XSE takes nothing returns nothing
	local timer t
	local integer h
	if IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) or not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, 0, false, function DWI)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		set t = null
	endif
endfunction
function DYI takes nothing returns nothing
	local unit dummyUnit = CreateUnit(GetOwningPlayer(KZV),'e00E', GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()), 0)
	call UnitAddPermanentAbility(dummyUnit,'A0MJ')
	call SetUnitAbilityLevel(dummyUnit,'A0MJ', K_V)
	call IssueTargetOrderById(dummyUnit,$D026B, GetEnumUnit())
	set dummyUnit = null
endfunction
function DZI takes unit WUE, unit targetUnit, integer level returns nothing
	local group g = LoginGroup(300)
	set U2 = WUE
	set K_V = level
	set KZV = WUE
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 700, Condition(function DGX))
	call ForGroup(g, function DYI)
	call LogoutGroup(g)
	set g = null
endfunction
function D_I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real D0I =(LoadReal(HY, h, 362))
	local unit WUE
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local integer level
	local integer c = LoadInteger(HY, h, 0)
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if FK and LoadBoolean(P, GetHandleId(GetTriggerUnit()),'A0NS')== false then
			if D0I < GetEventDamage() then
				set WUE =(LoadUnitHandle(HY, h, 2))
				set level =(LoadInteger(HY, h, 5))
				call SaveBoolean(HY,(GetHandleId(targetUnit)), 363,(false))
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
				call UnitRemoveAbility(targetUnit,'C000')
				call UnitRemoveAbility(targetUnit,'D000')
				call SetUnitToReduceDamage(GetTriggerUnit(), D0I)
				call DZI(WUE, GetTriggerUnit(), level)
			elseif GetEventDamage()> 0 then
				call SetUnitToReduceDamage(GetTriggerUnit(), GetEventDamage())
				call SaveReal(HY, h, 362,((D0I -GetEventDamage())* 1.))
			endif
		endif
	else
		if GetUnitAbilityLevel(targetUnit,'C000')== 0 or c >$F* 5 then
			set WUE =(LoadUnitHandle(HY, h, 2))
			set level =(LoadInteger(HY, h, 5))
			call SaveBoolean(HY,(GetHandleId(targetUnit)), 363,(false))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call DZI(WUE, targetUnit, level)
			call UnitRemoveAbility(targetUnit,'C000')
			call UnitRemoveAbility(targetUnit,'D000')
		else
			call SaveInteger(HY, h, 0, c + 1)
		endif
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function XTE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = GetSpellTargetUnit()
	local unit WUE = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(WUE,'A0MF')
	local integer hu = GetHandleId(targetUnit)
	local real D0I
	if(LoadBoolean(HY,(hu), 363)) then
		call UnitRemoveAbility(targetUnit,'C000')
		call TriggerEvaluate((LoadTriggerHandle(HY,(hu), 364)))
	endif
	call GBX(targetUnit)
	if level == 1 then
		set D0I = 100
	elseif level == 2 then
		set D0I = 175
	elseif level == 3 then
		set D0I = 250
	else
		set D0I = 325
	endif
	call UnitAddPermanentAbility(targetUnit,'C000')
	call SaveReal(HY, h, 362,((D0I)* 1.))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveInteger(HY, h, 5,(level))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerAddCondition(t, Condition(function D_I))
	call SaveTriggerHandle(HY,(hu), 364,(t))
	call SaveBoolean(HY,(hu), 363,(true))
	set t = null
	set targetUnit = null
	set WUE = null
endfunction
function D1I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local boolean Q0X = LoadBoolean(P, WFV,'forc')
	if LoadBoolean(P, WFV, 0) then
		call SaveBoolean(P,'A0NS', LoadInteger(P, WFV, 0), true)
		call DestroyTimerAndFlushHT_P(t)
	else
		call TimerStart(t, LoadInteger(P, WFV, 1), false, function D1I)
		call SaveBoolean(P, LoadInteger(P, WFV, 0),'A0NS', false)
		call SaveBoolean(P, WFV, 0, true)
	endif
	set t = null
endfunction
function D2I takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit D3I = LoadUnitHandle(HY, h, 0)
	local boolean b = GetUnitAbilityLevel( D3I, 'C022' ) == 0
	local real ZCE
	local unit u
	local integer j = LoadInteger(HY, h, 0)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or b == false then
		if j > 0 then
			loop
				set u = LoadUnitHandle(HY, h, j)
				call UnitRemoveAbility(u,'A3KG')
				call UnitRemoveAbility(u,'B3KG')
				call RemoveSavedHandle(HY, GetHandleId(u),'A3KG')
				set j = j -1
			exitwhen j <= 0
			endloop
		endif
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	else
		if j > 0 then
			loop
				set u = LoadUnitHandle(HY, h, j)
				if GetDistanceBetweenUnits(D3I, u)< 900 then
					if GetUnitAbilityLevel(u,'A3KG')== 0 then
						call UnitAddPermanentAbility(u,'A3KG')
						call SaveUnitHandle(HY, GetHandleId(u),'A3KG', D3I)
					endif
				else
					call UnitRemoveAbility(u,'A3KG')
					call UnitRemoveAbility(u,'B3KG')
					call RemoveSavedHandle(HY, GetHandleId(u),'A3KG')
				endif
				set j = j -1
			exitwhen j <= 0
			endloop
		endif
	endif
	set t = null
	set D3I = null
endfunction
function D4I takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local player p = GetOwningPlayer(u)
	local integer i = 1
	local integer k = 5
	local boolean b = false
	local integer j = 0
	if IsScourgesPlayer(p) then
		set b = true
	endif
	loop
		if b then
			if Player__Hero[GetPlayerId(Scourges[i])]!= null and Player__Hero[GetPlayerId(Scourges[i])]!= u then
				set j = j + 1
				call SaveUnitHandle(HY, h, j, Player__Hero[GetPlayerId(Scourges[i])])
			endif
		else
			if Player__Hero[GetPlayerId(Sentinels[i])]!= null and Player__Hero[GetPlayerId(Sentinels[i])]!= u then
				set j = j + 1
				call SaveUnitHandle(HY, h, j, Player__Hero[GetPlayerId(Sentinels[i])])
			endif
		endif
		set i = i + 1
	exitwhen i > k
	endloop
	call TriggerRegisterDeathEvent(t, u)
	call TriggerRegisterTimerEvent(t, .1, true)
	call SaveInteger(HY, h, 0, j)
	call TriggerAddCondition(t, Condition(function D2I))
	call SaveUnitHandle(HY, h, 0, u)
	set t = null
endfunction
//回光返照
function UnitSpellEffect__BorrowedTime takes unit u, integer DSR returns nothing
	local timer t = CreateTimer()
	local player trigPlayer = GetOwningPlayer(u)
	local integer h = GetHandleId(t)
	local integer lv = GetUnitAbilityLevel(u,'A0NS') //技能等级
	local boolean isSelected = IsUnitSelected(u, trigPlayer) //玩家是否选择了该单位
	local real dur = 0
	local integer id ='A0NS'
	local real cool = 100 - lv * 10
	call GBX(u)
	if lv == 0 then
		set lv = GetUnitAbilityLevel(u,'A1DA')
		set dur = 2.5 + lv * 1.
		set id ='A1DA'
		call D4I(u)
	else
		set dur = 2.7 + .3 * lv
	endif
	if GetUnitAbilityLevel(u,'A39S') == 1 then
		set cool = cool * 0.75
	endif
	call YDWESetUnitAbilityState(u, id, 1, cool)
	if trigPlayer == LocalPlayer and isSelected then
		call SelectUnit(u, true) //让玩家再选择他
	endif
	call WJV(u,'C022','D022', dur) // 添加Buff

	//call SaveInteger(P, h, 1, R2I(YDWEGetUnitAbilityDataReal(u, id, lv, 105))-R2I(dur))
	//call SaveBoolean(P, DSR,'A0NS', true)
	//call SaveBoolean(P,'A0NS', DSR, false)
	//call SaveInteger(P, h, 0, DSR)
	//call SaveBoolean(P, h, 0, false)
	//call TimerStart(t, dur, false, function D1I)
	//call SaveTimerHandle(HY, DSR,'A0NS', t)
	set t = null
	set trigPlayer = null
endfunction
function YDV takes nothing returns nothing
	local unit u = GetTriggerUnit()
	call UnitSpellEffect__BorrowedTime(u, GetHandleId(u))
	set u = null
endfunction
function D6I takes unit u, real d returns nothing
	local integer hu = GetHandleId(u)
	if LoadBoolean( ExtraHT, hu, HTKEY_HAS_BORROWEDTIME ) and YDWEGetUnitAbilityState(u, 'A0NS', 1) == 0. and YDWEGetUnitAbilityState(u, 'A1DA', 1) == 0. and 400 > GetWidgetLife(u) and GetUnitAbilityLevel(u,'A36D')== 0 then
		call UnitSpellEffect__BorrowedTime(u, hu)
	endif
endfunction
function LearnSkill__BorrowedTime takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer h = GetHandleId(u)
	if(GetUnitAbilityLevel(u,'A0NS')== 1 or GetUnitAbilityLevel(u,'A1DA')== 1) and IsUnitIllusion(u)== false then
		call SaveBoolean( ExtraHT, h, HTKEY_HAS_BORROWEDTIME, true )
		call TriggerRegisterUnitEvent(JJ, u, EVENT_UNIT_DAMAGED)
	endif
	set u = null
endfunction
function D7I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 5))
	local integer EVX =(LoadInteger(HY, h, 34))
	local real IXX =(level + 1)* 8
	local integer N5O =$A
	local unit TMX
	if GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT then
		if GetTriggerEvalCount(t)> 1 and GetSpellAbilityId()=='A0S1' and not UnitHasSpellShield(GetSpellTargetUnit()) and targetUnit == GetSpellTargetUnit() then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	elseif GetTriggerEventId()== EVENT_PLAYER_UNIT_SPELL_EFFECT then
		if FDX(GetSpellAbilityId()) and GetSpellTargetUnit()== targetUnit then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	elseif GetTriggerEventId()== EVENT_PLAYER_UNIT_DEATH then
		if IsUnitIllusion(GetTriggerUnit())== false and GetUnitTypeId(GetTriggerUnit())!='u00S' then
			set TMX = GetKillingUnit()
			if OZX(TMX) then
				set TMX =(Player__Hero[GetPlayerId(GetOwningPlayer((TMX)))])
			endif
			if GetTriggerUnit()== targetUnit or TMX == targetUnit then
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
				call UnitRemoveAbility(targetUnit,'A1W2')
				call UnitRemoveAbility(targetUnit,'B0DO')
			endif
		endif
	else
		set EVX = EVX + 1
		call SaveInteger(HY, h, 34,(EVX))
		if GetUnitAbilityLevel(targetUnit,'A1W2')== 0 or EVX == N5O then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call UnitRemoveAbility(targetUnit,'A1W2')
			call UnitRemoveAbility(targetUnit,'B0DO')
		endif
		call UnitDamageTargetEx(WUE, targetUnit, 1, IXX)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set TMX = null
	return false
endfunction
function D8I takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(WUE,'A0S1')
	local real IXX
	local real N5O
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Demon\\ReviveDemon\\ReviveDemon.mdl", targetUnit, "overhead"))
	call UnitAddPermanentAbility(targetUnit,'A1W2')
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function D7I))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY, h, 34, 0)
	set WUE = null
	set targetUnit = null
	set t = null
endfunction
function D9I takes nothing returns nothing
	if GetUnitAbilityLevel(GetEnumUnit(),'B0DO')> 0 then
		set Q2 = Q2 + 1
	endif
endfunction
function FVI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local group g = LoginGroup(301)
	set U2 = WUE
	set Q2 = 0
	call GroupEnumUnitsInRange(g, 0, 0, 9999, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	call ForGroup(g, function D9I)
	call LogoutGroup(g)
	if Q2 == 0 then
		if GetUnitAbilityLevel(WUE,'B0EZ')> 0 then
			call UnitRemoveAbility(WUE,'A2AO')
			call UnitRemoveAbility(WUE,'B0EZ')
		endif
	elseif GetUnitAbilityLevel(WUE,'A2AO')!= Q2 then
		call UnitAddPermanentAbility(WUE,'A2AO')
		call SetUnitAbilityLevel(WUE,'A2AO', Q2)
	endif
	set t = null
	set WUE = null
	set g = null
	return false
endfunction
function LSE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function FVI))
	call SaveUnitHandle(HY, h, 2,(WUE))
	set t = null
	set WUE = null
endfunction
function XUE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call D8I()
	endif
endfunction
function FEI takes nothing returns boolean
	return IsEnemyAliveNotStrucNotWardNotInvulnerable() and RFX(GetFilterUnit())== false
endfunction
function FXI takes integer h, integer FOI returns nothing
	local integer i = 1
	loop
	exitwhen i > FOI
		call DestroyEffect((LoadEffectHandle(HY, h,($A8C+ i))))
		set i = i + 1
	endloop
endfunction
function FRI takes nothing returns nothing
	call UnitWakeUp(GetEnumUnit())
	call IssueTargetOrderById(GetEnumUnit(), 851983, K1V)
endfunction
function FII takes nothing returns nothing
	call UnitRemoveAbility(GetEnumUnit(),'C003')
endfunction
function FAI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local group g =(LoadGroupHandle(HY, h,$DC))
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local integer FOI =(LoadInteger(HY, h, 365))
	local integer level =(LoadInteger(HY, h, 5))
	local integer EVX =(LoadInteger(HY, h, 34))
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		set EVX = EVX + 1
		if GetTriggerEventId()== EVENT_WIDGET_DEATH then
			set EVX = 9999
		endif
		call SaveInteger(HY, h, 34,(EVX))
		if EVX >=(5 + 2.5 * level) then
			call LodSystem_ReduceUnitExtraState(triggerUnit, 30, STATE_SYSTEM_ARMOUR)
			call UnitRemoveAbility(triggerUnit,'A0I5')
			call ForGroup(g, function FII)
			call LogoutGroup(g)
			call FXI(h, FOI)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			call DisableTrigger(t)
			set K1V = triggerUnit
			call ForGroup(g, function FRI)
			call EnableTrigger(t)
		endif
	else
		if IsUnitInGroup(GetTriggerUnit(), g) and UnitIsSleeping(GetTriggerUnit())== false and GetIssuedOrderId()!=$D0005 and K0V == false then
			call DisableTrigger(t)
			call IssueTargetOrderById(GetTriggerUnit(), 851983, triggerUnit)
			call EnableTrigger(t)
		endif
	endif
	set t = null
	set g = null
	set triggerUnit = null
	return false
endfunction
function FNI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetUnitAbilityLevel(u,'C003')== 2 then
	elseif GetUnitAbilityLevel(u,'C003')== 0 then
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	endif
	set u = null
	set t = null
endfunction
function FBI takes nothing returns nothing
	local unit u = GetEnumUnit()
	set Q2 = Q2 + 1
	call AddAbilityToTimed(u,'C003', 1, GetUnitAbilityLevel(GetTriggerUnit(),'A0I6')* .5 + 1,'D003')
	call SaveEffectHandle(HY,(WK),($A8C+ Q2),(AddSpecialEffectTarget("Abilities\\Weapons\\LavaSpawnMissile\\LavaSpawnBirthMissile.mdl", u, "chest")))
	set u = null
endfunction
function XWE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0I6')
	local group g = LoginGroup(302)
	set U2 = triggerUnit
	set K1V = triggerUnit
	set Q2 = 0
	set WK = h
	call LodSystem_AddUnitExtraState(triggerUnit, 30, STATE_SYSTEM_ARMOUR)
	call WJV(triggerUnit,'C004','D004', level * .5 + 1)
	call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), 325, Condition(function FEI))
	call ForGroup(g, function FBI)
	call ForGroup(g, function FRI)
	call SaveInteger(HY, h, 365,(Q2))
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call SaveGroupHandle(HY, h,$DC,(g))
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY, h, 34, 0)
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerRegisterDeathEvent(t, triggerUnit)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call TriggerAddCondition(t, Condition(function FAI))
	set t = null
	set g = null
	set triggerUnit = null
endfunction
function FCI takes nothing returns boolean
	return((IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and((GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0) and(IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false) and UnitIsDead(GetFilterUnit())== false)))
endfunction
function FDI takes unit triggerUnit returns nothing
	local group g = LoginGroup(303)
	local unit u
	//local unit d = I_X(triggerUnit)
	local integer level = GetUnitAbilityLevel(triggerUnit,'P327')
	local real ZCE = level * 35 + 65
	local real cool = .5 -0.05 * level
	//if GetUnitAbilityLevel(triggerUnit, 'A39S') == 1 then
	//	set cool = cool * 0.75
	//endif
	set U2 = triggerUnit
	//if IsUnitIllusion(triggerUnit) == false then
		call YDWESetUnitAbilityState(triggerUnit,'QP17', 1, cool)
	//endif
	call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), 300, Condition(function FCI))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", u, "origin"))
		call UnitDamageTargetEx(triggerUnit, u, 2, ZCE)
		call GroupRemoveUnit(g, u)
	endloop
	if(GetUnitTypeId(triggerUnit)!='Nbbc' and GetUnitTypeId(triggerUnit)!='Opgh') then
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\SpinFX3.mdx", triggerUnit, "origin"))
	else
		call SetUnitAnimation(triggerUnit, "spin")
	endif
	set u = null
	call BAX(triggerUnit, .6)
	call EPX(triggerUnit, 4267, cool)
	call LogoutGroup(g)
endfunction
function CounterHelixActions takes unit R8X, unit WLE returns nothing
	if LoadInteger(HY, GetHandleId(WLE), 4267)!= 1 and GetPrdRandom(WLE,'B03P', 20) then
		call FDI(WLE)
	endif
endfunction
function FGI takes nothing returns nothing
	call AddAbilityToTimed(GetEnumUnit(),'A2IB', 1, XK[0],'B0FV')
endfunction
function FHI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 0)
	local unit targetUnit = LoadUnitHandle(HY, h, 1)
	local real D0I = GetWidgetLife(targetUnit)
	local integer FJI = LoadInteger(HY, h, 1)
	local integer level = LoadInteger(HY, h, 0)
	local unit dummyUnit
	local boolean FKI = LoadBoolean(HY, h, 0)
	local group g
	local real WOV = 999
	if FKI then
		if level == 1 then
			set WOV = 300
		elseif level == 2 then
			set WOV = 450
		else
			set WOV = 625
		endif
		set XK[0]=$A
	else
		set WOV =$96+ 100 * level
		set XK[0]= 6
	endif
	if(D0I <= WOV) then
		call PlaySoundOnUnitBJ(K0, 100, targetUnit)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile.mdl", targetUnit, "overhead"))
		set dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'e00E', 0, 0, 0)
		if IsUnitType(targetUnit, UNIT_TYPE_SUMMONED)== false then
			call UnitRemoveBuffs(targetUnit, true, true)
		endif
		call UnitRemoveAbility(targetUnit,'Aetl')
		call UnitDamageTargetEx(dummyUnit, targetUnit, 4,$5F5E100)
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\AxeUltiMSFX_01.mdx", triggerUnit, "origin"))
		set g = LoginGroup(304)
		set U2 = triggerUnit
		call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), 925, Condition(function B7O))
		call ForGroup(g, function FGI)
		call LogoutGroup(g)
		if IsUnitType(targetUnit, UNIT_TYPE_HERO) and IsUnitType(triggerUnit, UNIT_TYPE_HERO) then
			//call LFX(triggerUnit, FJI, true, 100) //直接刷新技能 需要用reset
			call Japi_ResetUnitAbilityCoolDownActions(triggerUnit, FJI)
		endif
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set triggerUnit = null
	set targetUnit = null
	set dummyUnit = null
	set t = null
endfunction
function X_E takes nothing returns nothing
	local timer t
	local integer h
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		call SaveInteger(HY, h, 0, GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
		call SaveInteger(HY, h, 1, GetSpellAbilityId())
		if GetSpellAbilityId()=='A1MR' then
			call SaveBoolean(HY, h, 0, true)
		endif
		call TimerStart(t, 0, false, function FHI)
		set t = null
	endif
endfunction
function FLI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	local integer i
	set i = GetUnitAbilityLevel(u,'A0GK')
	if IsUnitType(u, UNIT_TYPE_HERO)== false then
		if HaveSavedHandle(HY, GetHandleId(u), 0) then
			set u = LoadUnitHandle(HY, GetHandleId(u), 0)
		endif
	endif
	call UnitDamageTargetEx(u, WLE, 3, 20 + 70 * i)
	if GetWidgetLife(u)> 1 then
		call SetWidgetLife(u, GetWidgetLife(u)+ 20 + 70 * i)
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set WLE = null
	set u = null
	set t = null
endfunction
function FAE takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		call TimerStart(t, 0, false, function FLI)
	else
		call DestroyTimer(t)
	endif
	set t = null
endfunction
function FMI takes nothing returns boolean
	local trigger FPI = GetTriggeringTrigger()
	local integer h = GetHandleId(FPI)
	local integer level =(LoadInteger(HY,(h), 30))
	local unit R3O = LoadUnitHandle(HY, h, 30)
	local unit R4O =(LoadUnitHandle(HY,(h), 2))
	local player FQI =(LoadPlayerHandle(HY,(h), 54))
	local integer FSI =(LoadInteger(HY,(h), 5))
	local unit FTI
	local boolean b = GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED
	if GetUnitAbilityLevel(R3O,'B02F')== 0 then
		call SetPlayerAbilityAvailable(GetOwningPlayer(R3O),'A04Y', true)
		call SetPlayerAbilityAvailable(GetOwningPlayer(R3O),'A2O9', false)
		call UnitRemoveAbility(R3O,'A37S')
		call UnitRemoveAbility(R3O,'A3C9')
		call AddAbilityToTimed(R3O,'A3CA', 1, 1,'A3CA')
		if HaveSavedHandle(HY, GetHandleId(R3O),'VisD') then
			call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A37S')
			call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A3C9')
			call AddAbilityToTimed(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A3CA', 1, 1,'A3CA')
		endif
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(FPI)
	elseif b == false and GetTriggerUnit()== R3O then
		call SetPlayerAbilityAvailable(GetOwningPlayer(R3O),'A04Y', true)
		call SetPlayerAbilityAvailable(GetOwningPlayer(R3O),'A2O9', false)
		call UnitRemoveAbility(R3O,'B02F')
		set FTI = CreateUnit(FQI,'e00E', GetUnitX(R3O), GetUnitY(R3O), 0)
		call UnitAddPermanentAbility(FTI,'A04Y')
		call UnitRemoveAbility(R3O,'A37S')
		call UnitRemoveAbility(R3O,'A3C9')
		call AddAbilityToTimed(R3O,'A3CA', 1, 1,'A3CA')
		if HaveSavedHandle(HY, GetHandleId(R3O),'VisD') then
			call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A37S')
			call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A3C9')
			call AddAbilityToTimed(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A3CA', 1, 1,'A3CA')
		endif
		call SetUnitAbilityLevel(FTI,'A04Y', FSI)
		call IssueTargetOrderById(FTI,$D0103, GetAttacker())
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(FPI)
	elseif b then
		call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 1)
		if LoadInteger(HY, h, 0)== 9 then
			call UnitRemoveAbility(R3O,'A3C9')
			if HaveSavedHandle(HY, GetHandleId(R3O),'VisD') then
				call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A3C9')
			endif
		endif
		if ModuloInteger(LoadInteger(HY, h, 0), 10)== 0 then
			if GetUnitState(R3O, UNIT_STATE_LIFE)> 21 then
				call SetUnitState(R3O, UNIT_STATE_LIFE, GetUnitState(R3O, UNIT_STATE_LIFE)-20)
			else
				call SetPlayerAbilityAvailable(GetOwningPlayer(R3O),'A04Y', true)
				call SetPlayerAbilityAvailable(GetOwningPlayer(R3O),'A2O9', false)
				call UnitRemoveAbility(R3O,'B02F')
				call UnitRemoveAbility(R3O,'A37S')
				call UnitRemoveAbility(R3O,'A3C9')
				if HaveSavedHandle(HY, GetHandleId(R3O),'VisD') then
					call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A37S')
					call UnitRemoveAbility(LoadUnitHandle(HY, GetHandleId(R3O),'VisD'),'A3C9')
					call AddAbilityToTimed(R3O,'A3CA', 1, 1,'A3CA')
				endif
				call AddAbilityToTimed(R3O,'A3CA', 1, 1,'A3CA')
				call UnitDamageTargetEx(R4O, R3O, 1, 50)
				call FlushChildHashtable(HY,(h))
				call CleanCurrentTrigger(FPI)
			endif
		endif
	endif
	set FPI = null
	set FQI = null
	set FTI = null
	set R3O = null
	set R4O = null
	return false
endfunction
function FUI takes unit R3O, unit R4O returns nothing
	local trigger FPI = CreateTrigger()
	local integer Y6R = GetHandleId(FPI)
	set Y6R = GetHandleId(FPI)
	call SaveUnitHandle(HY,(Y6R), 30,((R4O)))
	call SaveUnitHandle(HY,(Y6R), 2,(R3O))
	call SavePlayerHandle(HY,(Y6R), 54,(GetOwningPlayer(R3O)))
	call SaveInteger(HY,(Y6R), 5,(GetUnitAbilityLevel(R3O,'A04Y')))
	call TriggerRegisterPlayerUnitEventBJ(FPI, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterTimerEvent(FPI, .1, true)
	call TriggerAddCondition(FPI, Condition(function FMI))
	if GetUnitAbilityLevel(R4O,'A04Y')> 0 then
		call SetPlayerAbilityAvailable(GetOwningPlayer(R4O),'A04Y', false)
		call UnitAddPermanentAbility(R4O,'A2O9')
		call SetPlayerAbilityAvailable(GetOwningPlayer(R4O),'A2O9', true)
	endif
	call UnitAddAbility(R4O,'A37S')
	call UnitAddAbility(R4O,'A3C9')
	if HaveSavedHandle(HY, GetHandleId(R4O),'VisD') then
		call UnitAddAbility(LoadUnitHandle(HY, GetHandleId(R4O),'VisD'),'A37S')
		call UnitAddAbility(LoadUnitHandle(HY, GetHandleId(R4O),'VisD'),'A3C9')
	endif
	set DMV = true
	call UnitDamageTargetEx(R3O, R4O, 2, 0)
	set DMV = false
	set FPI = null
endfunction
function FWI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call FUI(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function Nightmare takes nothing returns nothing
	local timer t
	local integer h
	if IsMessengerUnit(GetSpellTargetUnit())== false and not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, 0, false, function FWI)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		set t = null
	endif
endfunction
function J4E takes nothing returns boolean
	if IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) then
		if GetOwningPlayer(GetTriggerUnit())!= GetOwningPlayer(GetSpellTargetUnit()) and IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) and(LoadBoolean(HY, GetHandleId(GetOwningPlayer(GetSpellTargetUnit())),$8B)) then
			call EXStopUnit(GetTriggerUnit())
			call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n038'))
		endif
	endif
	return false
endfunction
function FYI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(P, GetHandleId(t), 0)
	call UnitRemoveAbility(u,'B02F')
	call UnitRemoveAbility(u,'A2O9')
	call S9E(GetOwningPlayer(u),'A04Y', true)
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set u = null
endfunction
function FZI takes nothing returns boolean
	local timer t = null
	local unit u = GetTriggerUnit()
	if GetIssuedOrderId()== 852589and GetUnitAbilityLevel(u,'A2O9')> 0 then
		set t = CreateTimer()
		call TimerStart(t, 0, false, function FYI)
		call SaveUnitHandle(P, GetHandleId(t), 0, u)
		set t = null
	endif
	set u = null
	return false
endfunction
function M4X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call TriggerAddCondition(t, Condition(function FZI))
	set t = null
endfunction
function F_I takes unit R8X, unit WLE returns nothing
	local unit u
	if LoadBoolean(P, GetHandleId(WLE),'Grip') then
		if IsUnitEnemy(R8X, GetOwningPlayer(WLE)) then
			set u = CreateUnit(GetOwningPlayer(R8X),'e00E', GetUnitX(WLE), GetUnitY(WLE), 0)
			call UnitAddPermanentAbility(u,'A04Y')
			call SetUnitAbilityLevel(u,'A04Y', 2)
			call IssueTargetOrderById(u,$D0103, R8X)
			set u = null
		endif
	endif
endfunction
function F0I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real W5R
	local integer EVX = 6
	local fogmodifier fm =(LoadFogModifierHandle(HY, h, 42))
	if GetUnitAbilityLevel(WUE,'A1D9')> 0 then
		set EVX = 8
	endif
	if GetTriggerEventId()== EVENT_UNIT_SPELL_ENDCAST then
		call FogModifierStop(fm)
		call DestroyFogModifier(fm)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SaveBoolean(P, GetHandleId(WUE),'Grip', false)
		call FIX(targetUnit)
	elseif GetTriggerEvalCount(t)> EVX or(GetTriggerEvalCount(t)== 1 and GetUnitAbilityLevel(targetUnit,'A3E9')== 1) then
		call FogModifierStop(fm)
		call DestroyFogModifier(fm)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call EXStopUnit(WUE)
		call SaveBoolean(P, GetHandleId(WUE),'Grip', false)
		call FIX(targetUnit)
	else
		if GetUnitAbilityLevel(WUE,'A1D9')> 0 then
			set W5R = RMinBJ(.1 * GetUnitState(targetUnit, UNIT_STATE_MAX_MANA), GetUnitState(targetUnit, UNIT_STATE_MANA))
		else
			set W5R = RMinBJ(.05 * GetUnitState(targetUnit, UNIT_STATE_MAX_MANA), GetUnitState(targetUnit, UNIT_STATE_MANA))
		endif
		if W5R > 0 then
			call SetUnitState(WUE, UNIT_STATE_MANA, GetUnitState(WUE, UNIT_STATE_MANA)+ W5R)
			call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)-W5R)
		endif
		if UnitIsDead(targetUnit)== false and GetUnitAbilityLevel(targetUnit,'Bdet')== 0 then
			call FAX(WUE, targetUnit)
		endif
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set fm = null
	return false
endfunction
function F1I takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local fogmodifier ff = CreateFogModifierRadius(GetOwningPlayer(WUE), FOG_OF_WAR_VISIBLE, GetUnitX(targetUnit), GetUnitY(targetUnit), 350, true, true)
	call FogModifierStart(ff)
	call UnitRemoveAbility(targetUnit,'B02F')
	call UnitRemoveAbility(targetUnit,'BUsp')
	call UnitRemoveAbility(targetUnit,'Bust')
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterTimerEvent(t, .1, false)
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function F0I))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveFogModifierHandle(HY, h, 42, ff)
	call SaveBoolean(P, GetHandleId(WUE),'Grip', GetUnitAbilityLevel(WUE,'A1D9')> 0)
	call FAX(WUE, targetUnit)
	set WUE = null
	set targetUnit = null
	set t = null
	set ff = null
endfunction
function X2E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call F1I()
	endif
endfunction
function F2I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local unit u = LoadUnitHandle(P, WFV, 0)
	call LodSystem_AddUnitExtraState(u, LoadInteger(P, WFV, 0), STATE_SYSTEM_DAMAGE)
	call RemoveSavedHandle(P, GetHandleId(u),'A04V')
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set u = null
endfunction
function F3I takes unit u returns nothing
	local unit d = GetTriggerUnit()
	local timer t = LoadTimerHandle(P, GetHandleId(u),'A04V')
	local integer WFV = GetHandleId(t)
	local integer O3O = 30 * GetUnitAbilityLevel(d,'A04V')
	if t == null or GetUnitAbilityLevel(u,'D018')== 0 or GetUnitTypeId(d)=='e00E' then
		set t = CreateTimer()
		set WFV = GetHandleId(t)
		call SaveTimerHandle(P, GetHandleId(u),'A04V', t)
		call SaveUnitHandle(P, WFV, 0, u)
	else
		call LodSystem_AddUnitExtraState(u, LoadInteger(P, WFV, 0), STATE_SYSTEM_DAMAGE)
	endif
	call SaveInteger(P, WFV, 0, O3O)
	call TimerStart(t, 20, false, function F2I)
	call LodSystem_ReduceUnitExtraState(u, O3O, STATE_SYSTEM_DAMAGE)
	call WJV(u,'C018','D018', 20)
	set d = null
	set t = null
endfunction
function YNV takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call F3I(GetSpellTargetUnit())
	endif
endfunction
function F4I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer EVX =(LoadInteger(HY,(GetHandleId(targetUnit)), 281))
	local boolean F5I =(LoadBoolean(HY, h, 280))
	local real ZCE = 0.5
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call SetUnitTurnSpeed(targetUnit, GetUnitDefaultTurnSpeed(targetUnit))
		call SaveInteger(HY,(GetHandleId(targetUnit)), 281, 0)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call FNX(targetUnit, 0, 0)
	elseif EVX == 0 then
		call SetUnitTurnSpeed(targetUnit, GetUnitDefaultTurnSpeed(targetUnit))
		call SaveInteger(HY,(GetHandleId(targetUnit)), 281, 0)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_UNIT_DAMAGED and F5I == false then
		if EVX > 0 and GetUnitAbilityLevel(GetEventDamageSource(),'A1EL')> 0 and WUE == GetEventDamageSource() and FK then
			call SaveBoolean(HY, h, 280,(true))
			set ZCE =(3 + 5 * GetUnitAbilityLevel(WUE,'A1EL'))* EVX
			if LEV then
				set ZCE = ZCE * 0.5
			endif
			if IsHeroLevelUnit(targetUnit) then
				set ZCE = ZCE * 1
			endif
			if GetEventDamage()>$A or LEV then
				call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\LordofFlameMissile\\LordofFlameMissile.mdl", targetUnit, "chest"))
				call UnitDamageTargetEx(WUE, targetUnit, 1, ZCE)
			endif
			call SaveBoolean(HY, h, 280,(false))
		endif
	else
		call SetUnitTurnSpeed(targetUnit, GetUnitDefaultTurnSpeed(targetUnit)* .3)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function F6I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real IWO =(LoadReal(HY,(GetHandleId(targetUnit)), 675))
	local integer StickyCount =(LoadInteger(HY,(GetHandleId(targetUnit)), 281))
	if(GetGameTime())-IWO >= 8 then
		call SetUnitTurnSpeed(targetUnit, GetUnitDefaultTurnSpeed(targetUnit))
		call SaveInteger(HY,(GetHandleId(targetUnit)), 281, 0)
		call FNX(targetUnit, 0, 0)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function F7I takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetEnumUnit()
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(WUE,'A1EL')
	local integer EVX = IMinBJ((LoadInteger(HY,(GetHandleId(targetUnit)), 281))+ 1, 10)
	if IsMagicImmuneUnit(targetUnit) then
		set WUE = null
		set targetUnit = null
		return
	endif
	call FNX(targetUnit, level, EVX)
	call SaveInteger(HY,(GetHandleId(targetUnit)), 281,(EVX))
	call SaveReal(HY,(GetHandleId(targetUnit)), 675,(((GetGameTime()))* 1.))
	call SetUnitTurnSpeed(targetUnit, GetUnitDefaultTurnSpeed(targetUnit)* .3)
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		call AYX(GetOwningPlayer(WUE), I2S(EVX)+ "!", 2, targetUnit, .026, 50, 0, 255,$D8)
	endif
	if EVX == 1 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(WUE))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SaveBoolean(HY, h, 280,(false))
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function F4I))
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 8, false)
	call TriggerAddCondition(t, Condition(function F6I))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	set t = null
	set WUE = null
	set targetUnit = null
endfunction
function X4E takes nothing returns nothing
	local group g = LoginGroup(305)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit WUE = GetTriggerUnit()
	local string s = "Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodGargoyle.mdl"
	set U2 = WUE
	call GroupEnumUnitsInRange(g, x, y, 400, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	call ForGroup(g, function F7I)
	call A8X(GetOwningPlayer(WUE), 2, x, y, 500)
	call DestroyEffect(AddSpecialEffect(s, x, y))
	call DestroyEffect(AddSpecialEffect(s, x, y +$82))
	call DestroyEffect(AddSpecialEffect(s, x, y -$82))
	call DestroyEffect(AddSpecialEffect(s, x +$82, y))
	call DestroyEffect(AddSpecialEffect(s, x +$82, y +$82))
	call DestroyEffect(AddSpecialEffect(s, x +$82, y -$82))
	call DestroyEffect(AddSpecialEffect(s, x -$82, y))
	call DestroyEffect(AddSpecialEffect(s, x -$82, y +$82))
	call DestroyEffect(AddSpecialEffect(s, x -$82, y -$82))
	call LogoutGroup(g)
	set WUE = null
endfunction
function PTX takes nothing returns nothing
	local integer i
	set K2V[1]='A1XC'
	set K2V[2]='A1XB'
	set K2V[3]='A1X4'
	set K2V[4]='A1X5'
	set K2V[5]='A1X6'
	set K2V[6]='A1X7'
	set K2V[7]='A1XA'
	set K2V[8]='A1X8'
	set K2V[9]='A1X9'
	set K2V[10]='A1XD'
	set K3V[1]='A1XM'
	set K3V[2]='A1XE'
	set K3V[3]='A1XF'
	set K3V[4]='A1XG'
	set K3V[5]='A1XH'
	set K3V[6]='A1XI'
	set K3V[7]='A1XJ'
	set K3V[8]='A1XK'
	set K3V[9]='A1XN'
	set K3V[10]='A1XL'
	set K4V[1]='A1XO'
	set K4V[2]='A1XV'
	set K4V[3]='A1XW'
	set K4V[4]='A1XQ'
	set K4V[5]='A1XR'
	set K4V[6]='A1XS'
	set K4V[7]='A1XX'
	set K4V[8]='A1XT'
	set K4V[9]='A1XU'
	set K4V[10]='A1XP'
	set K5V[1]='A1XY'
	set K5V[2]='A1XZ'
	set K5V[3]='A1Y5'
	set K5V[4]='A1Y6'
	set K5V[5]='A1Y7'
	set K5V[6]='A1Y1'
	set K5V[7]='A1Y2'
	set K5V[8]='A1Y3'
	set K5V[9]='A1Y4'
	set K5V[10]='A1Y0'
	set i = 1
	loop
	exitwhen i >$A
		call AddAbilityIDToPreloadQueue(K2V[i])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i >$A
		call AddAbilityIDToPreloadQueue(K3V[i])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i >$A
		call AddAbilityIDToPreloadQueue(K4V[i])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i >$A
		call AddAbilityIDToPreloadQueue(K5V[i])
		set i = i + 1
	endloop
endfunction
function F8I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real a =(LoadReal(HY, h, 137))
	local real d =(LoadReal(HY, h, 138))
	local real x1 =(LoadReal(HY, h, 6))
	local real y1 =(LoadReal(HY, h, 7))
	local real x2
	local real y2
	local real x
	local real y
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or GetTriggerEvalCount(t)>$A then
		call KillDestructablesInCircle(GetUnitX(targetUnit), GetUnitY(targetUnit), 200)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set x2 = x1 + d * Cos(a)
		set y2 = y1 + d * Sin(a)
		if(IsPointInRegion(R4,((x2)* 1.),((y2)* 1.)))== false then
			call SaveReal(HY, h, 6,((x2)* 1.))
			call SaveReal(HY, h, 7,((y2)* 1.))
			set x = x2
			set y = y2
		else
			set x = x1
			set y = y1
		endif
		if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
			call SetUnitPosition(targetUnit, x, y)
		else
			call SetUnitX(targetUnit, x)
			call SetUnitY(targetUnit, y)
		endif
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function F9I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer c = LoadInteger(HY, h, 0)
	local unit u = LoadUnitHandle(HY, h, 1)
	if c == 1 or UnitIsDead(u) or GetUnitAbilityLevel(u,'A37T')== 0 then
		if GetUnitAbilityLevel(u,'A37T')!= 0 then
			call UnitDamageTargetEx(LoadUnitHandle(HY, h, 0), u, 1, LoadReal(HY, h, 0))
		endif
		call UnitRemoveAbility(u,'A37T')
		call UnitRemoveAbility(u,'B37T')
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	else
		call UnitDamageTargetEx(LoadUnitHandle(HY, h, 0), u, 1, LoadReal(HY, h, 0))
		call SaveInteger(HY, h, 0, c -1)
	endif
	set t = null
	set u = null
endfunction
function GVI takes unit WJE, unit WLE returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, WJE)
	call SaveUnitHandle(HY, h, 1, WLE)
	call SaveInteger(HY, h, 0, K7V + 2)
	call UnitAddPermanentAbility(WLE,'A37T')
	call SaveReal(HY, h, 0, K7V * 5 + 20)
	call TimerStart(t, 1, true, function F9I)
	set t = null
endfunction
function GEI takes nothing returns nothing
	local unit WUE = K6V
	local unit targetUnit = GetEnumUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function F8I))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveReal(HY, h, 137,((Atan2(GetUnitY(targetUnit)-K9V, GetUnitX(targetUnit)-K8V))* 1.))
	call SaveReal(HY, h, 138,((RMaxBJ((400 -GetDistanceBetween(K8V, K9V, GetUnitX(targetUnit), GetUnitY(targetUnit))), 10)/ $A)* 1.))
	call SaveReal(HY, h, 6,((GetUnitX(targetUnit))* 1.))
	call SaveReal(HY, h, 7,((GetUnitY(targetUnit))* 1.))
	call GVI(WUE, targetUnit)
	set WUE = null
	set targetUnit = null
	set t = null
	call UnitDamageTargetEx(K6V, GetEnumUnit(), 1, 20 + K7V * 40)
endfunction
function GXI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local real a =(LoadReal(HY, h, 137))
	local group g
	local unit targetUnit
	local real x = GetUnitX(dummyUnit)
	local real y = GetUnitY(dummyUnit)
	local real GOI =(LoadReal(HY, h, 6))
	local real GRI =(LoadReal(HY, h, 7))
	set x = CoordinateX50(x + 36 * Cos(a))
	set y = CoordinateY50(y + 36 * Sin(a))
	call SetUnitX(dummyUnit, x)
	call SetUnitY(dummyUnit, y)
	set U2 = dummyUnit
	if GetDistanceBetween(x, y, GOI, GRI)< 40 or GetTriggerEvalCount(t)> 100  then
		set targetUnit = null
		set x = GOI
		set y = GRI
		set K6V = WUE
		set K7V =(LoadInteger(HY, h, 5))
		set K8V = x
		set K9V = y
		set g = LoginGroup(306)
		set U2 = WUE
		call GroupEnumUnitsInRange(g, x, y, 400, Condition(function DPX))
		call ForGroup(g, function GEI)
		call KillUnit(dummyUnit)
		call LogoutGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	set dummyUnit = null
	set WUE = null
	set g = null
	return false
endfunction
function X5E takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = Atan2(y -GetUnitY(WUE), x -GetUnitX(WUE))
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(WUE,'A19V')
	local unit dummyUnit
	set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'h0ED', GetUnitX(WUE), GetUnitY(WUE), a * bj_RADTODEG)
	call SaveReal(HY, h, 137,((a)* 1.))
	call SaveInteger(HY, h, 5,(level))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call TriggerRegisterTimerEvent(t, .04, true)
	call TriggerAddCondition(t, Condition(function GXI))
	set WUE = null
	set dummyUnit = null
	set t = null
endfunction
function GII takes nothing returns nothing
	local unit WUE = LVV
	local unit CSO = GetEnumUnit()
	local unit targetUnit
	local group g
	if GetUnitCurrentOrder(CSO)== 0 then
		set g = LoginGroup(307)
		set U2 = CSO
		call GroupEnumUnitsInRange(g, GetUnitX(CSO), GetUnitY(CSO), 825, Condition(function DKX))
		set targetUnit = FirstOfGroup(g)
		if targetUnit != null then
			call GroupRemoveUnit(g, targetUnit)
		endif
		if FirstOfGroup(g)== null and targetUnit == WUE then
			call IssueTargetOrderById(CSO, 851983, targetUnit)
		endif
		call LogoutGroup(g)
		set targetUnit = null
		set g = null
	endif
	set WUE = null
	set CSO = null
endfunction
function GAI takes unit WUE returns nothing
	local group g = LoginGroup(308)
	set U2 = WUE
	set LVV = WUE
	call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 1000, Condition(function FRX))
	call ForGroup(g, function GII)
	call LogoutGroup(g)
	set g = null
endfunction
function GNI takes nothing returns nothing
	call UnitDamageTargetEx(LVV, GetEnumUnit(), 1, LXV)
endfunction
function GBI takes unit WUE, integer h, integer EVX, integer level returns nothing
	local group g1 = LoginGroup(309)
	local group g2 = LoginGroup(310)
	local integer i = 0
	set U2 = WUE
	loop
	exitwhen i > EVX
		call GroupEnumUnitsInRange(g2, LoadReal(HY, h,$8FC+ i), LoadReal(HY, h,$9C4+ i),$E1, Condition(function DKX))
		call GroupAddGroup(g2, g1)
		call GroupClear(g2)
		set i = i + 1
	endloop
	call LogoutGroup(g2)
	if FirstOfGroup(g1)!= null then
		set LVV = WUE
		set LXV = level *$A-5
		call ForGroup(g1, function GNI)
	endif
	call LogoutGroup(g1)
	set g1 = null
	set g2 = null
endfunction
function GCI takes nothing returns boolean
	local unit WUE = null
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer EVX = LoadInteger(HY, h, 34)
	local integer i
	local real x
	local real y
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEvalCount(t)> 360 then
		set i = 0
		loop
		exitwhen i > EVX
			call DestroyEffect(LoadEffectHandle(HY, h,$A8C+ i))
			set i = i + 1
		endloop
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set t = null
		return false
	endif
	set WUE = LoadUnitHandle(HY, h, 2)
	set x = GetWidgetX(WUE)
	set y = GetWidgetY(WUE)
	if MW then
		call GAI(WUE)
	endif
	if GetDistanceBetween(x, y, LoadReal(HY, h, 23), LoadReal(HY, h, 24))> 125 then
		set EVX = EVX + 1
		call SaveInteger(HY, h, 34, EVX)
		call SaveReal(HY, h, 23, x * 1.)
		call SaveReal(HY, h, 24, y * 1.)
		call SaveEffectHandle(HY, h,$A8C+ EVX, AddSpecialEffect("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl", x, y))
		call SaveReal(HY, h,$8FC+ EVX, x * 1.)
		call SaveReal(HY, h,$9C4+ EVX, y * 1.)
	endif
	if ModuloInteger(GetTriggerEvalCount(t), 10)== 0 then
		set LEV = true
		call GBI(WUE, h, EVX, level)
		set LEV = false
	endif
	if UnitIsDead(WUE)== false then
		call KillDestructablesInCircle(x, y, 100)
	endif
	set WUE = null
	set t = null
	return false
endfunction
function GDI takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x = GetWidgetX(WUE)
	local real y = GetWidgetY(WUE)
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function GCI))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveEffectHandle(HY, h,$A8C, AddSpecialEffect("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl", x, y))
	call SaveReal(HY, h, 23, x * 1.)
	call SaveReal(HY, h, 24, y * 1.)
	call SaveReal(HY, h,$8FC, x * 1.)
	call SaveReal(HY, h,$9C4, y * 1.)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	set WUE = null
	set t = null
endfunction
function GFI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	call SetTerrainPathable(x, y, PATHING_TYPE_WALKABILITY, false)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function GGI takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local real x = GetUnitX(WUE)
	local real y = GetUnitY(WUE)
	call SetTerrainPathable(x, y, PATHING_TYPE_WALKABILITY, true)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function GFI))
	call SaveReal(HY, h, 6, x * 1.)
	call SaveReal(HY, h, 7, y * 1.)
	set WUE = null
	set t = null
endfunction
function X7E takes nothing returns nothing
	if GetUnitTypeId(GetTriggerUnit())!='O017' then
		call GDI()
		if(GetRandomInt(1, 10)== 1) then
			call PlaySoundOnUnitBJ(B1, 100, GetTriggerUnit())
		endif
	elseif IsTerrainPathable(GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), PATHING_TYPE_WALKABILITY) then
		call GGI()
	endif
endfunction
function GHI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local unit dummyUnit = LoadUnitHandle(HY, h, 19)
	local real d = GetDistanceBetween(GetUnitX(WUE), GetUnitY(WUE), GetUnitX(targetUnit), GetUnitY(targetUnit))
	local real a
	local real N5O = LoadReal(HY, h, 57)
	local real x0 = LoadReal(HY, h, 282)
	local real y0 = LoadReal(HY, h, 283)
	local real x1
	local real y1
	local boolean MDR = LoadBoolean(HY, h, 0)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or GetTriggerEvalCount(t)> R2I(20 * N5O) then
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(dummyUnit)
		call SetUnitPathing(targetUnit, true)
		call KillDestructablesInCircle(GetUnitX(targetUnit), GetUnitY(targetUnit), 175)
		if MDR == false then
			call UnitRemoveAbility(WUE,'Abun')
		endif
	else
		call SetUnitX(dummyUnit, GetUnitX(WUE))
		call SetUnitY(dummyUnit, GetUnitY(WUE))
		if MDR and ModuloInteger(GetTriggerEvalCount(t), 20)== 0 then
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl", targetUnit, "chest"))
			call UnitDamageTargetEx(WUE, targetUnit, 1, 50 + 25 * LoadInteger(HY, h, 0))
		endif
		if GetDistanceBetween(x0, y0, GetUnitX(WUE), GetUnitY(WUE))> 400 then
			call DestroyEffect(LoadEffectHandle(HY, h, 32))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call KillUnit(dummyUnit)
			call SetUnitPathing(targetUnit, true)
			call KillDestructablesInCircle(GetUnitX(targetUnit), GetUnitY(targetUnit), 175)
			if MDR == false then
				call UnitRemoveAbility(WUE,'Abun')
			endif
		else
			call SaveReal(HY, h, 282, GetUnitX(WUE)* 1.)
			call SaveReal(HY, h, 283, GetUnitY(WUE)* 1.)
			if d > 300 then
				set a = Atan2(GetUnitY(targetUnit)-GetUnitY(WUE), GetUnitX(targetUnit)-GetUnitX(WUE))
				set x1 = GetUnitX(WUE)+ 300 * Cos(a)
				set y1 = GetUnitY(WUE)+ 300 * Sin(a)
				if(IsPointInRegion(R4, x1 * 1., y1 * 1.))== false then
					call SetUnitX(targetUnit, x1)
					call SetUnitY(targetUnit, y1)
				endif
			endif
		endif
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set dummyUnit = null
	return false
endfunction
function GJI takes unit WUE, unit targetUnit returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'u00Y', GetUnitX(WUE), GetUnitY(WUE), 0)
	local integer level = GetUnitAbilityLevel(WUE,'A19O')+ GetUnitAbilityLevel(WUE,'A1MV')
	local boolean MDR = GetUnitAbilityLevel(WUE,'A1MV')> 0
	if IsUnitType(WUE, UNIT_TYPE_HERO)== false then
		if HaveSavedHandle(HY, GetHandleId(WUE), 0) then
			set WUE = LoadUnitHandle(HY, GetHandleId(WUE), 0)
		endif
	endif
	if MDR == false then
		call UnitAddPermanentAbility(WUE,'Abun')
	endif
	call SaveBoolean(HY, h, 0, MDR)
	call SaveInteger(HY, h, 0, level)
	call UnitAddPermanentAbility(dummyUnit,'A19N')
	call SetUnitAbilityLevel(dummyUnit,'A19N', level)
	call IssueTargetOrderById(dummyUnit,$D0200, targetUnit)
	call SetUnitPathing(dummyUnit, false)
	call SetUnitPathing(targetUnit, false)
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function GHI))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveUnitHandle(HY, h, 19, dummyUnit)
	call SaveReal(HY, h, 57,(2.5 + level * .5)* 1.)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("Abilities\\Spells\\Human\\AerialShackles\\AerialShacklesTarget.mdl", targetUnit, "chest"))
	call SaveReal(HY, h, 282, GetUnitX(WUE)* 1.)
	call SaveReal(HY, h, 283, GetUnitY(WUE)* 1.)
	set t = null
	set dummyUnit = null
endfunction
function GKI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call GJI(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function X8E takes nothing returns nothing
	local timer t = null
	local integer h
	if not UnitHasSpellShield(GetSpellTargetUnit()) and GetUnitTypeId(GetSpellTargetUnit())!='n00L' then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		call TimerStart(t, 0, false, function GKI)
		set t = null
	endif
endfunction
function GLI takes unit WUE, unit targetUnit, real J0R returns nothing
	call SetWidgetLife(WUE, GetWidgetLife(WUE)+ GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)* J0R)
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HeroBloodElfBlood.mdl", WUE, "overhead"))
endfunction
function GMI takes nothing returns boolean
	if UnitIsDead(GetFilterUnit())== false and GetUnitAbilityLevel(GetFilterUnit(),'A0LE')> 0 and IsUnitEnemy(LOV, GetOwningPlayer(GetFilterUnit())) then
		call GLI(GetFilterUnit(), LOV, GetUnitAbilityLevel(GetFilterUnit(),'A0LE')* .1 * .5)
	endif
	return false
endfunction
function GPI takes unit WUE, unit targetUnit, integer level returns nothing
	local group g = LoginGroup(311)
	set LOV = targetUnit
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 350, Condition(function GMI))
	call LogoutGroup(g)
	set LOV = null
	set g = null
endfunction
function GQI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	local boolean GSI = LoadBoolean(HY, h, 0)
	local integer GTI = level *$A
	local integer GUI = level * 5
	if GSI then
		set GTI = GTI * 2
		set GUI = GUI * 2
	endif
	call LodSystem_ReduceUnitExtraState(u, GTI, STATE_SYSTEM_ATTACK)
	call LodSystem_ReduceUnitExtraState(u, GUI, STATE_SYSTEM_DAMAGE)
	call UnitRemoveAbility(u,'A33M')
	call UnitRemoveAbility(u,'B0GY')
	call SaveBoolean(P, GetHandleId(u),'A0LE', false)
	call RemoveSavedHandle(P, GetHandleId(u),'A0LE')
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set u = null
	set t = null
endfunction
function GWI takes unit u, integer level, boolean GSI returns nothing
	local integer GYI
	local timer t
	local real r
	local integer h = GetHandleId(u)
	local boolean b = LoadBoolean(P, h,'A0LE')
	local integer GZI
	local integer G_I
	local real WLV = 5
	local integer G0I = 1
	if GSI then
		set WLV = 20
		set G0I = 2
	endif
	if b then
		set t = LoadTimerHandle(P, h,'A0LE')
		set GYI = LoadInteger(HY, GetHandleId(t), 0)
		set GZI = GYI *$A
		set G_I = GYI * 5
		if LoadBoolean(HY, GetHandleId(t), 0) then
			set GZI = GZI * 2
			set G_I = G_I * 2
		endif
		if TimerGetRemaining(t)< WLV or GZI < level *$A* G0I then
			call TimerStart(t, WLV, false, function GQI)
			if GZI < level *$A* G0I then
				call LodSystem_AddUnitExtraState(u, level *$A* G0I -GZI, STATE_SYSTEM_ATTACK)
				call LodSystem_AddUnitExtraState(u, level * 5 * G0I -G_I, STATE_SYSTEM_DAMAGE)
				call SaveInteger(HY, GetHandleId(t), 0, level)
				call SaveBoolean(HY, GetHandleId(t), 0, GSI)
			endif
		endif
	else
		call SaveBoolean(P, h,'A0LE', true)
		set t = CreateTimer()
		call TimerStart(t, WLV, false, function GQI)
		call SaveBoolean(HY, GetHandleId(t), 0, GSI)
		call SaveInteger(HY, GetHandleId(t), 0, level)
		call SaveUnitHandle(HY, GetHandleId(t), 0, u)
		call SaveTimerHandle(P, h,'A0LE', t)
		call LodSystem_AddUnitExtraState(u, level *$A* G0I, STATE_SYSTEM_ATTACK)
		call LodSystem_AddUnitExtraState(u, level * 5 * G0I, STATE_SYSTEM_DAMAGE)
		call UnitAddPermanentAbility(u,'A33M')
	endif
	set t = null
endfunction
function G1I takes unit WUE, unit targetUnit returns nothing
	local integer level
	local real FTX = 1.
	if GetUnitTypeId(WUE)=='e00E' or IsUnitType(WUE, UNIT_TYPE_HERO)== false then
		set WUE = Player__Hero[GetPlayerId(GetOwningPlayer(WUE))]
	endif
	set level = GetUnitAbilityLevel(WUE,'A0LE')
	if IsUnitIllusion(targetUnit)== false and IsUnitType(targetUnit, UNIT_TYPE_STRUCTURE)== false and targetUnit != RoShan then
		if IsUnitType(WUE, UNIT_TYPE_MELEE_ATTACKER)== false then
			set FTX = .5
		endif
		if IsUnitType(targetUnit, UNIT_TYPE_HERO)== false then
			if level > 0 then
				call GWI(WUE, level, false)
				call GLI(WUE, targetUnit,(level * .05 + .05)* FTX)
			endif
		else
			if level > 0 then
				call GWI(WUE, level, true)
				call GLI(WUE, targetUnit, level * .1 * FTX)
			else
				call GPI(WUE, targetUnit, level)
			endif
		endif
	endif
endfunction
function G2I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 5))
	local real GXR =(LoadReal(HY, h, 23))
	local real GOR =(LoadReal(HY, h, 24))
	local real x = GetUnitX(targetUnit)
	local real y = GetUnitY(targetUnit)
	local real d = SquareRoot((GXR -x)*(GXR -x)+(GOR -y)*(GOR -y))
	local real ZCE = .2 * level * d
	local integer G3I =(LoadInteger(HY, h, 25))
	if d >$514 then
		set ZCE = 0
	endif
	if ZCE > 5 then
		call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", targetUnit, "origin"))
	endif
	if ZCE > 0 and UnitIsDead(targetUnit)== false then
		call UnitDamageTargetEx(WUE, targetUnit, 7, ZCE)
	endif
	call SaveReal(HY, h, 23,((x)* 1.))
	call SaveReal(HY, h, 24,((y)* 1.))
	call SaveInteger(HY, h, 25,(G3I + 1))
	if UnitIsDead(targetUnit) then
		call UnitRemoveAbility(targetUnit,'A0IH')
		call UnitRemoveAbility(targetUnit,'B08L')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif G3I > 4 *(6 + level) then
		call UnitRemoveAbility(targetUnit,'A0IH')
		call UnitRemoveAbility(targetUnit,'B08L')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function G4I takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(WUE,'A0LH')
	call UnitAddPermanentAbility(targetUnit,'A0IH')
	call SetUnitAbilityLevel(targetUnit,'A0IH', level)
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", targetUnit, "chest"))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h, 23,((GetUnitX(targetUnit))* 1.))
	call SaveReal(HY, h, 24,((GetUnitY(targetUnit))* 1.))
	call SaveInteger(HY, h, 25, 0)
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerAddCondition(t, Condition(function G2I))
	call UnitDamageTargetEx(WUE, targetUnit, 6, 50 + 100 * level)
	set WUE = null
	set targetUnit = null
	set t = null
endfunction
function X9E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) and IsMessengerUnit(GetSpellTargetUnit())== false then
		call G4I()
	endif
endfunction
function G5I takes unit u returns boolean
	local real L2O
	local real WOV = .3
	if UnitIsDead(u) then
		return false
	endif
	if UnitIsDead(LRV)== false then
		set L2O = GetWidgetLife(u)/ GetUnitState(u, UNIT_STATE_MAX_LIFE)
		return .25 > L2O or(L2O < WOV and DOX(u)== false)
	endif
	return false
endfunction
function G6I takes unit u returns nothing
	local unit W_V
	local integer h = GetHandleId(u)
	if(LoadBoolean(K, h, 24)== false) then
		call SaveBoolean(K, h, 24, true)
		set W_V = CreateUnit(GetOwningPlayer(LRV),'hBST', GetUnitX(u), GetUnitY(u), 0)
		call SaveUnitHandle(K, h, 24, W_V)
		call SetUnitMoveSpeed(W_V, 522)
		call IssueTargetOrderById(W_V, 851986, u)
	else
		set W_V = LoadUnitHandle(K, h, 24)
		call SetUnitX(W_V, GetUnitX(u))
		call SetUnitY(W_V, GetUnitY(u))
		if DOX(u) then
			if GetUnitAbilityLevel(u,'A1HX')> 0 then
				call UnitRemoveAbility(W_V,'A30X')
			elseif GetUnitAbilityLevel(W_V,'A30X')== 0 then
				call UnitAddAbility(W_V,'A30X')
			endif
		else
			if GetUnitAbilityLevel(W_V,'A30X')> 0 then
				call UnitRemoveAbility(W_V,'A30X')
			endif
		endif
	endif
	set W_V = null
endfunction
function G7I takes unit u returns nothing
	local integer h = GetHandleId(u)
	if(LoadBoolean(K, h, 24)) then
		call SaveBoolean(K, h, 24, false)
		call SetUnitPosition(LoadUnitHandle(K, h, 24), 7536,-7632)
		call KillUnit(LoadUnitHandle(K, h, 24))
		call UnitRemoveAbility(u,'B0EY')
	endif
endfunction
function G8I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local integer level = GetUnitAbilityLevel(WUE,'A0I8')
	local integer CJR = level *$A-5
	local boolean G9I = LoadBoolean(HY, h, 0)
	local integer HVI = LoadInteger(HY, h, 0)
	local integer HEI = LoadInteger(HY, h, 2)
	local integer UYX = 0
	local integer HXI = 0
	local integer HOI = 1
	local integer HRI = 5
	local integer i
	local unit u
	local boolean b = IsSentinelsPlayer(GetOwningPlayer(WUE))
	local boolean br = GetUnitAbilityLevel(WUE,'A36D')== 1
	set i = HOI
	loop
		if b then
			set u = Player__Hero[GetPlayerId(Scourges[i])]
		else
			set u = Player__Hero[GetPlayerId(Sentinels[i])]
		endif
		if u != null then
			set LRV = WUE
			if(G5I(u)) and br == false then
				call G6I(u)
				set UYX = UYX + 1
			elseif(LoadBoolean(K, GetHandleId(u), 24)) then
				call G7I(u)
			endif
		endif
		set i = i + 1
	exitwhen i > HRI
	endloop
	if UYX == 0 then
		call SaveInteger(HY, h, 2, 0)
		call UnitRemoveAbility(WUE,'A214')
		if G9I then
			call LodSystem_ReduceUnitExtraState(WUE, HVI, STATE_SYSTEM_DAMAGE)
			call SaveBoolean(HY, h, 0, false)
		endif
		call SaveInteger(K, GetHandleId(WUE),'A214', 0)
	else
		set CJR = CJR * UYX
		if G9I == false then
			call LodSystem_AddUnitExtraState(WUE, CJR, STATE_SYSTEM_DAMAGE)
			call SaveBoolean(HY, h, 0, true)
			call SaveInteger(HY, h, 0, CJR)
		elseif HVI != CJR then
			call LodSystem_ReduceUnitExtraState(WUE, HVI, STATE_SYSTEM_DAMAGE)
			call LodSystem_AddUnitExtraState(WUE, CJR, STATE_SYSTEM_DAMAGE)
			call SaveInteger(HY, h, 0, CJR)
		endif
		set HXI = level * 7 * UYX
		if HXI != HEI then
			call SaveInteger(HY, h, 2, HXI)
		endif
		call SaveInteger(K, GetHandleId(WUE),'A214', UYX)
		call SaveInteger(K, GetHandleId(WUE),'A215', level)
		call UnitAddPermanentAbility(WUE,'A214')
	endif
	set t = null
	set WUE = null
	set u = null
	return false
endfunction
function HII takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer I2X = LoadInteger(HY, h, 0)
	local real x
	local real y
	local real dx
	local real dy
	local real radian
	local real ms
	local real d
	local real i = 1
	local real I4X = GetUnitDefaultMoveSpeed(u)+ U3V(u)
	if I4X >1000 then
		set I4X =1000-522
	endif
	if LoadBoolean(HY, h, 0) then
		set I2X = 100 
	endif
	call SaveReal(K, GetHandleId(u), 99, R2I(I4X * I2X / 100 ))
	if I2X > 0 and UnitAlive(u) then
		set x = GetUnitX(u)
		set y = GetUnitY(u)
		set dx = LoadReal(HY, h, 10)
		set dy = LoadReal(HY, h, 11)
		set d = GetDistanceBetween(dx, dy, x, y)
		if LoadBoolean(K, GetHandleId(u), 99)== false then
			if(d < 100  and d > 1) and GetUnitCurrentOrder(u)!=$D0019 and GetUnitCurrentOrder(u)!=$D0004 and GetUnitCurrentOrder(u)!=$D0005 then
				set radian = Atan2(y -dy, x -dx)
				set ms = I4X * I2X * YN / 100 
				call SaveReal(K, GetHandleId(u), 99, R2I(ms *(1 / YN)))
				call SetUnitX(u, CoordinateX50(x + ms * Cos(radian)))
				call SetUnitY(u, CoordinateY50(y + ms * Sin(radian)))
			endif
		else
			call SaveBoolean(K, GetHandleId(u), 99, false)
		endif
		call SaveReal(HY, h, 10, GetUnitX(u))
		call SaveReal(HY, h, 11, GetUnitY(u))
	endif
	set t = null
	set u = null
endfunction
function HAI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer i = 1
	local integer UYX = LoadInteger(K, GetHandleId(u),'A214')
	local integer level = LoadInteger(K, GetHandleId(u),'A215')
	local integer I2X =($A* level -5)* UYX
	loop
		if(LoadBoolean(K, GetHandleId(Player__Hero[i]), 24)) then
			call SetUnitX(LoadUnitHandle(K, GetHandleId(Player__Hero[i]), 24), GetUnitX(Player__Hero[i]))
			call SetUnitY(LoadUnitHandle(K, GetHandleId(Player__Hero[i]), 24), GetUnitY(Player__Hero[i]))
			call IssueTargetOrderById(LoadUnitHandle(K, GetHandleId(Player__Hero[i]), 24), 851986, Player__Hero[i])
		endif
		set i = i + 1
		if i == 6 then
			set i = 7
		endif
	exitwhen i >$B
	endloop
	call SetUnitImitateMoveSpeed(u, I2X, 0)
	set t = null
	set u = null
endfunction
function LME takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerAddCondition(t, Condition(function G8I))
	call SaveUnitHandle(HY, h, 2,(WUE))
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function HAI))
	call SaveUnitHandle(HY, GetHandleId(t), 0, WUE)
	set t = null
	set WUE = null
endfunction
function OVE takes nothing returns nothing
	local unit targetUnit
	local unit HNI
	if not UnitHasSpellShield(GetSpellTargetUnit()) or IsUnitAlly(GetSpellTargetUnit(), GetTriggerPlayer()) then
		set targetUnit = GetSpellTargetUnit()
		set HNI = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitAddAbility(HNI,'A2TN')
		call SaveUnitHandle(HY, GetHandleId(HNI), 0, GetTriggerUnit())
		call IssueTargetOrderById(HNI, 852111, targetUnit)
		call RemoveSavedHandle(HY, GetHandleId(HNI), 0)
	endif
	set targetUnit = null
	set HNI = null
endfunction
function JZE takes nothing returns nothing
	if GetSpellTargetUnit()!= GetTriggerUnit() and IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) and(LoadBoolean(HY, GetHandleId(GetOwningPlayer(GetSpellTargetUnit())),$8B)) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n038'))
	endif
endfunction
function HBI takes nothing returns boolean
	return GetUnitTypeId(GetSummonedUnit())=='o003'
endfunction
function HCI takes nothing returns nothing
	local unit HDI = GetSummonedUnit()
	local unit HFI = Player__Hero[GetPlayerId(GetOwningPlayer(GetSummoningUnit()))]
	local integer h = GetHandleId(HFI)
	local integer level = GetUnitAbilityLevel(HFI,'Z234')
	local integer HGI =(LoadInteger(HY, h, 279))
	local unit HHI =(LoadUnitHandle(HY, h,($578+ 1)))
	local integer x = 1
	set HGI = HGI + 1
	call SetUnitVertexColorBJ(HDI, 100, 100, 100, 85)
	call UnitAddPermanentAbility(HDI,'Aloc')
	call SaveUnitHandle(HY, h,($578+ HGI),(HDI))
	if(HGI > level * 2) then
		call KillUnit(HHI)
		loop
		exitwhen x == HGI
			call SaveUnitHandle(HY, h,($578+ x),((LoadUnitHandle(HY, h,($578+ x + 1)))))
			set x = x + 1
		endloop
		set HGI = HGI -1
	endif
	call SaveInteger(HY, h, 279,(HGI))
	call SetUnitAbilityLevel(HDI,'A0BF', level)
	set HDI = null
	set HFI = null
	set HHI = null
endfunction
function OEE takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'o003', GetSpellTargetX(), GetSpellTargetY(), 0)
	local unit u = Player__Hero[GetPlayerId(GetOwningPlayer(d))]
	local integer h = GetHandleId(u)
	local integer lv = GetUnitAbilityLevel(u,'Z234')
	local integer maxi =(LoadInteger(HY, h, 279))
	local unit HHI =(LoadUnitHandle(HY, h,(1400 + 1)))
	local integer x = 1
	call SetUnitAnimation(d, "birth")
	call QueueUnitAnimation(d, "stand")
	set maxi = maxi + 1
	call SetUnitVertexColorBJ(d, 100, 100, 100, 85)
	call UnitAddPermanentAbility(d,'Aloc')
	call SaveUnitHandle(HY, h,(1400 + maxi),(d))
	if(maxi > lv * 2) then
		call KillUnit(HHI)
		loop
		exitwhen x == maxi
			call SaveUnitHandle(HY, h,(1400 + x),((LoadUnitHandle(HY, h,(1400 + x + 1)))))
			set x = x + 1
		endloop
		set maxi = maxi -1
	endif
	call SaveInteger(HY, h, 279,(maxi))
	call SetUnitAbilityLevel(d,'A0BF', lv)
	set d = null
	set u = null
	set HHI = null
endfunction
function M5X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function HBI))
	call TriggerAddAction(t, function HCI)
	set t = null
endfunction
function HJI takes nothing returns boolean
	return GetOwningPlayer(GetFilterUnit())== GetOwningPlayer(XB) and(GetUnitAbilityLevel(GetFilterUnit(),'Aloc')== 0 and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0)
endfunction
function HKI takes nothing returns nothing
	local real x
	local real y
	local unit web
	local integer i = 1
	local unit u = GetEnumUnit()
	local boolean b = false
	if Player__Hero[GetPlayerId(GetOwningPlayer(u))] != null then
		loop
			set web = LoadUnitHandle(HY, GetHandleId(u), 1400 + i)
			if web != null then
				set x = GetUnitX(web)
				set y = GetUnitY(web)
				if(GetDistanceBetween(x, y, GetUnitX(u), GetUnitY(u))< 875) then
					set b = true
				endif
			else
				set i = 9
			endif
			set i = i + 1
		exitwhen i > 9 or b
		endloop
	endif
	if b == false then
		if IsUnitType(u, UNIT_TYPE_HERO) then
			call UnitRemoveAbility(u,'A021')
		else
			call UnitRemoveAbility(u,'A29C')
		endif
		call UnitRemoveAbility(u,'B01C')
		call SetUnitPathing(u, true)
	endif
	set web = null
	set u = null
endfunction
function HMI takes nothing returns nothing	//如果三秒内没被打则设置无视地形。
	local unit u = GetEnumUnit()
	if IsUnitType(u, UNIT_TYPE_HERO) then
		if GetUnitAbilityLevel(u,'A021')== 0 then
			call L6X(u)
			call UnitAddAbility(u,'A021')
		endif
	else
		if GetUnitAbilityLevel(u,'A29C')== 0 then
			call UnitAddAbility(u,'A29C')
		endif
	endif
	call SetUnitPathing(u, LoadReal(HY, GetHandleId(u), 785) + 3 > GetGameTime())
	set u = null
endfunction
function HPI takes nothing returns nothing//织网
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local group g
	local group gg = null
	local unit u
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		call DestroyGroup(LoadGroupHandle(HY, h, 1))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if LoadBoolean(HY, h, 0)== false then
			set g = CreateGroup()
			call SaveBoolean(HY, h, 0, true)
			call SaveGroupHandle(HY, h, 1, g)
		endif
		set u = LoadUnitHandle(HY, h, 0)
		set g = LoadGroupHandle(HY, h, 1)
		set gg = LoginGroup(312)
		set XB = u
		call GroupEnumUnitsInRange(gg, GetUnitX(u), GetUnitY(u), 900, Condition(function HJI))
		call GroupRemoveGroup(gg, g)
		set XB = u
		call ForGroup(g, function HKI)
		call ForGroup(gg, function HMI)
		call GroupClear(g)
		call GroupAddGroup(gg, g)
		call LogoutGroup(gg)
		set gg = null
	endif
	set t = null
	set g = null
	set u = null
endfunction
function HQI takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .3, true)
	call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function HPI))
	call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
	call SaveBoolean(HY, h, 0, false)
	set t = null
endfunction
function HSI takes nothing returns nothing
	if GetUnitTypeId(GetTriggerUnit())=='o003' then
		call HQI()
	endif
endfunction
// 蜘蛛网
function M6X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	call TriggerAddCondition(t, Condition(function HSI))
	set t = null
endfunction
function RQF takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 14))
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or GetUnitAbilityLevel(u,'A0WR')== 0 or GetTriggerEvalCount(t)>= 5 *$E then
		if UnitAlive(u) then
			call UnitRemoveAbility(u,'A0WR')
			call UnitRemoveAbility(u,'B01E')
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	return false
endfunction
function Brood_Hungerold takes nothing returns nothing
endfunction
function HTI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY,(h), 14))
	local integer c = LoadInteger(HY, h, 1)+ 1
	if GetUnitAbilityLevel(u,'A0WR')== 0 or c > 5 * 14 or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call LodSystem_ReduceUnitExtraState(u, LoadInteger(HY, h, 0), STATE_SYSTEM_DAMAGE)
		//if UnitAlive(u) then
		call UnitRemoveAbility(u,'A0WR')
		call UnitRemoveAbility(u,'B01E')
		//endif
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	else
		call SaveInteger(HY, h, 1, c)
	endif
	set t = null
	set u = null
	return false
endfunction
function SpellEffect__InsatiableHunger takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local integer lv = GetUnitAbilityLevel(u,'A0WQ')
	local integer ZCE
	if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) then
		set ZCE = 60 + 20 * lv
	else
		set ZCE = 50 + 10 * lv
	endif
	call FlushChildHashtable(HY, h)
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function HTI))
	call SaveUnitHandle(HY,(h), 14,(u))
	call UnitAddPermanentAbility(u,'A0WR')
	call UnitMakeAbilityPermanent(u, true,'A0WW')
	call UnitMakeAbilityPermanent(u, true,'A340')
	call LodSystem_AddUnitExtraState(u, ZCE, STATE_SYSTEM_DAMAGE)
	call SaveInteger(HY, h, 0, ZCE)
	call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A0WR', false)
	call EnableEffectByTime(EFFECT_KEY_INSATIABLE_HUNGER, 14)
	
	set t = null
	set u = null
endfunction
function HUI takes unit R8X, unit WLE returns nothing
	call AddAbilityToTimed(WLE,'A3PV'-1 + GetUnitAbilityLevel(R8X,'A0BK'), 1, 2,'B01D')
	call EnableEffectByTime(9, 2.5)
endfunction
function IncapacitatingBite_DE takes nothing returns nothing
	if(GetUnitAbilityLevel(DESourceUnit[DEI],'Q0BK')> 0) and not DESourceIsBreak[DEI] and GetUnitAbilityLevel(DETargetUnit[DEI],'A04R')== 0 then
		call HUI(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction

function HZI takes nothing returns boolean
	local unit u = U2
	local unit target = W2
	local integer level = GetUnitAbilityLevel(u,'A0BH')
	local boolean HGR = false
	if level == 0 then
		set level = GetUnitAbilityLevel(target,'A0BH')
		set HGR = true
	endif
	if level != 0 then
		call AddAbilityToTimed(target,'A3B8', level, 2,'B3B8')
		call EUX(target,'A3B8', GetPlayerId(GetOwningPlayer(u)), 2)
		call UnitDamageTargetEx(u, target, 1, level * 75)
		if GetUnitAbilityLevel(target,'A3E9')== 1 and IsUnitType(u, UNIT_TYPE_HERO) and HGR == false and not IsMagicImmuneUnit(u) then
			if UnitHasSpellShield(u)== false then
				call T4V(target)
				call NHX(target, u,'h07V', "HZI", 1200, true)
			else
				call AJO(u)
			endif
		endif
	endif
	set u = null
	set target = null
	return false
endfunction
function H_I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call NHX(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1),'h07V', "HZI", 1200, true)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function OOE takes nothing returns nothing
	local timer t = null
	local integer h
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		call TimerStart(t, 0, false, function H_I)
		set t = null
	endif
endfunction
// 小蜘蛛
function SpideriteEnterMapActions takes unit u returns nothing
	local integer i = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A0A8')
	if i > 0 then
		if GetUnitTypeId(u)=='n019'then
			// A3IT 0.05 * level 魔抗
			call UnitAddPermanentAbilitySetLevel(u,'A3IR', i)
			call AddUnitMagicResistance(u, 0.05 * i)
			//call UnitAddPermanentAbilitySetLevel(u,'A3IS', i -1)
		endif
	endif
endfunction
function H1I takes nothing returns boolean
	local texttag FHR
	local unit u
	local trigger HLR = GetTriggeringTrigger()
	local integer WFV = GetHandleId(HLR)
	local real i
	local real d
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED then
		call FlushChildHashtable(P, WFV)
		call CleanCurrentTrigger(HLR)
	elseif GetEventDamageSource()== LoadUnitHandle(P, WFV, 0) then
		call DisableTrigger(HLR)
		set FHR = CreateTextTag()
		set d = LoadReal(P, WFV, 1)
		set i = LoadReal(P, WFV, 0)
		set u = LoadUnitHandle(P, WFV, 2)
		if GetUnitAbilityLevel(u,'A3E9')== 1 and IsMagicImmuneUnit(LoadUnitHandle(P, WFV, 1))== false and GetUnitAbilityLevel(LoadUnitHandle(P, WFV, 1),'Aloc')== 0 then
			if LoadBoolean(P, WFV, 0)== false then
				call SaveUnitHandle(VV,'A3E9', 0, u)
				call SaveUnitHandle(VV,'A3E9', 1, LoadUnitHandle(P, WFV, 1))
				call SaveInteger(VV,'A3E9', 0, LoadInteger(P, WFV, 1))
				call ExecuteFunc("H2I")
			endif
		endif
		call CommonUnitAddStun(u, i, false)
		call SetTextTagText(FHR, "+" + I2S(R2I(d)), .025)
		call SetTextTagPosUnit(FHR, u, 10)
		call SetTextTagColor(FHR, 255, 0, 0, 255)
		call SetTextTagVelocity(FHR, 0, .0355)
		call SetTextTagFadepoint(FHR, 2)
		call SetTextTagPermanent(FHR, false)
		call SetTextTagLifespan(FHR, 2)
		call CommonTextTag(R2SW(i, 1, 1), i, u, .03,$7F,$7F, 255, 255)
		call UnitDamageTargetEx(LoadUnitHandle(P, WFV, 1), u, 1, d)
		call FlushChildHashtable(P, WFV)
		call CleanCurrentTrigger(HLR)
		set FHR = null
		set u = null
	endif
	set HLR = null
	return false
endfunction
function H3I takes unit u, unit t, integer WUV, boolean H4I returns nothing
	local unit d = CreateUnit(GetOwningPlayer(t),'e00E', GetWidgetX(u), GetWidgetY(u), 0)
	local trigger HLR = CreateTrigger()
	local integer WFV = GetHandleId(HLR)
	local real GEX
	set GEX = GetRandomInt(25 + 50 * WUV, 100 + 50 * WUV)* 1. / 100.
	call SaveReal(P, WFV, 1,(175 + 25 * WUV)* 1. -15.625 * R2I(RAbsBJ((25 + 50 * WUV)* 1. / 100. -GEX)* 10))
	call SaveUnitHandle(P, WFV, 0, d)
	call SaveUnitHandle(P, WFV, 1, u)
	call SaveUnitHandle(P, WFV, 2, t)
	call SaveReal(P, WFV, 0, GEX)
	call SaveInteger(P, WFV, 1, WUV)
	call SaveBoolean(P, WFV, 0, H4I)
	call TriggerRegisterTimerEvent(HLR, 10, false)
	call TriggerRegisterUnitEvent(HLR, t, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(HLR, Condition(function H1I))
	call UnitAddAbility(d,'A04U')
	call IssueTargetOrderById(d, 852095, t)
	set HLR = null
	set d = null
endfunction
function FTE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call H3I(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(),'A055')+ GetUnitAbilityLevel(GetTriggerUnit(),'QB00'), false)
	endif
endfunction
function H2I takes nothing returns nothing
	local unit WLE = LoadUnitHandle(VV,'A3E9', 1)
	call T4V(LoadUnitHandle(VV,'A3E9', 0))
	if UnitHasSpellShield(WLE)== false then
		call H3I(LoadUnitHandle(VV,'A3E9', 0), WLE, LoadInteger(VV,'A3E9', 0), true)
	else
		call AJO(WLE)
	endif
	set WLE = null
	call FlushChildHashtable(VV,'A3E9')
endfunction
function RAF takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	return false
endfunction
function H6I takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())== GetUnitTypeId(LNV) and GetOwningPlayer(GetFilterUnit())== GetOwningPlayer(LNV) and IsUnitIllusion(GetFilterUnit()) then
		call SetUnitX(GetFilterUnit(), LIV)
		call SetUnitY(GetFilterUnit(), LAV)
		call IssueTargetOrderById(GetFilterUnit(), 851983, LBV)
	endif
	return false
endfunction
function H7I takes unit WUE, unit targetUnit, integer level returns nothing
	local real WYE = GetUnitX(WUE)
	local real WZE = GetUnitY(WUE)
	local real W_E = GetUnitX(targetUnit)
	local real W0E = GetUnitY(targetUnit)
	local real a = AngleBetweenXY(WYE, WZE, W_E, W0E)
	local real GIX = GetDistanceBetween(WYE, WZE, W_E, W0E)
	local real d = GetRandomReal(GIX * .3, GIX * .8)
	local real NBX = WYE + d * Cos(a * bj_DEGTORAD)
	local real NCX = WZE + d * Sin(a * bj_DEGTORAD)
	local unit u = CreateUnit(GetOwningPlayer(WUE),'h06J', NBX, NCX, 0)
	local unit u2
	local group g
	local trigger t
	local integer h
	call SetUnitX(WUE, NBX)
	call SetUnitY(WUE, NCX)
	call SetUnitFacing(WUE,-a)
	call PlaySoundOnUnitBJ(OC, 100, targetUnit)
	if targetUnit != RoShan then
		call AddAbilityToTimed(WUE,'A3K9', level, 1.2, 0)
		set NBX = WYE +(d -25)* Cos(a * bj_DEGTORAD)
		set NCX = WZE +(d -25)* Sin(a * bj_DEGTORAD)
		call EPX(targetUnit, 4405, 1)
		call SetUnitX(targetUnit, NBX)
		call SetUnitY(targetUnit, NCX)
		call SetUnitFacing(targetUnit, a)
		call IssueTargetOrderById(WUE, 851983, targetUnit)
		set g = LoginGroup(313)
		set LIV = NBX
		set LAV = NCX
		set LNV = WUE
		set LBV = targetUnit
		call GroupEnumUnitsInRange(g, WYE, WZE,$578, Condition(function H6I))
		call LogoutGroup(g)
		call KillUnit(CreateUnit(GetOwningPlayer(WUE),'h06J', NBX, NCX, 0))
	endif
	call KillUnit(u)
	set WUE = null
	set targetUnit = null
	set u = null
	set u2 = null
	set g = null
endfunction
function H8I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	local integer level = GetUnitAbilityLevel(u,'A0RW')
	if GetUnitAbilityLevel(u,'Aloc')== 1 and HaveSavedHandle(HY, GetHandleId(u), 0) then
		set u = LoadUnitHandle(HY, GetHandleId(u), 0)
	endif
	if UnitHasSpellShield(WLE)== false then
		call H7I(u, WLE, level)
	endif
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set WLE = null
	set u = null
endfunction
function ORE takes nothing returns nothing
	local timer t = null
	local integer h
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		call TimerStart(t, 0, false, function H8I)
		set t = null
	endif
endfunction



function Naga_MirrorImage takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u, 'A063')
	local real dataB = 0.25 + level * 0.05
	local real dataC = 7. - level * 1
	local string sSpecialArt = "war3mapImported\\NagaSirenMirrorImage_4.mdx"
	local string sMissileArt = "Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageMissile.mdl"
	call UnitSpellImage(u, 'A063', 3, dataB, dataC, 0.3, 30, sSpecialArt, sMissileArt, 1000, 128, 0)
	set u = null
endfunction
function SpellEffect__Phantasm takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u, 'A03O')
	local real dataB = 0.9
	local real dataC = 2.
	local real dataA = level
	local string sSpecialArt = "war3mapImported\\MirrorImageCKCaster_7.mdx"
	local string sMissileArt = "Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageMissile.mdl"
	if GetPrdRandom(u, 'A03O', 50) then
		set dataA = dataA + 1
	endif
	call UnitSpellImage(u, 'A03O', dataA, dataB, dataC, 0.5, 34, sSpecialArt, sMissileArt, 1000, 128, 0)
	set u = null
endfunction

function JVI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local unit u = CreateUnit(GetOwningPlayer(triggerUnit),'h06J', GetUnitX(triggerUnit), GetUnitY(triggerUnit), 0)
	call PlaySoundOnUnitBJ(OC, 100, triggerUnit)
	call KillUnit(u)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set u = null
	set t = null
	set triggerUnit = null
	return false
endfunction
function K3E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerAddCondition(t, Condition(function JVI))
	call TriggerRegisterTimerEvent(t, .3, false)
	call SaveUnitHandle(HY, h, 14,(GetTriggerUnit()))
	set t = null
endfunction
function Q2E takes nothing returns nothing
	local integer level = GetUnitAbilityLevel(GetTriggerUnit(),'A303')
	if level == 1 then
		call UnitAddPermanentAbility(GetTriggerUnit(),'AHfa')
	endif
	call SetUnitAbilityLevel(GetTriggerUnit(),'AHfa', level)
endfunction
function JEI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local real hp = GetWidgetLife(WUE)
	local integer JXI = LoadInteger(HY, h, 10)
	local integer JOI = LoadInteger(HY, h, 11)
	call SaveInteger(HY, GetHandleId(WUE),'a272', LoadInteger(HY, GetHandleId(WUE),'a272')-JXI)
	call KVX(WUE)
	call UnitAddMaxLife(WUE,-1 * JOI)
	call SaveInteger(HY, GetHandleId(WUE),'h272', LoadInteger(HY, GetHandleId(WUE),'a272')-JOI)
	if LoadInteger(HY, GetHandleId(WUE),'a272')== 0 then
		call UnitRemoveAbility(WUE,'A1R0')
		call UnitRemoveAbility(WUE,'B0D5')
	endif
	call SetWidgetLife(WUE, hp)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	return false
endfunction
function JRI takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(WUE,'A04Q')
	local real JII = GetWidgetLife(targetUnit)
	local real JAI = GetWidgetLife(WUE)
	local integer JXI = R2I((.035 + .015 * level)* JII)
	local integer JOI = R2I((.35 + .15 * level)* JII)
	call SaveInteger(HY, h, 10, JXI)
	call SaveInteger(HY, h, 11, JOI)
	call SaveInteger(HY, GetHandleId(WUE),'a272', LoadInteger(HY, GetHandleId(WUE),'a272')+ JXI)
	call KVX(WUE)
	call SaveInteger(HY, GetHandleId(WUE),'h272', LoadInteger(HY, GetHandleId(WUE),'h272')+ JOI)
	call UnitAddMaxLife(WUE, JOI)
	call UnitAddPermanentAbility(WUE,'A1R0')
	call SetWidgetLife(targetUnit, 1)
	call UnitDamageTargetEx(WUE, targetUnit, 2, 20)
	call UnitDamageTargetEx(WUE, targetUnit, 1, 20)
	call UnitDamageTargetEx(WUE, targetUnit, 3, 20)
	call SetWidgetLife(WUE, JAI + JOI)
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", targetUnit, "chest"))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerRegisterTimerEvent(t, 35, false)
	call TriggerAddCondition(t, Condition(function JEI))
	set WUE = null
	set targetUnit = null
	set t = null
endfunction
function ONE takes nothing returns nothing
	if GetWidgetLife(GetTriggerUnit())> .5 and IsMessengerUnit(GetSpellTargetUnit())== false then
		call JRI()
	endif
endfunction

function JBI takes integer x returns boolean
	return x =='A3FJ' or x =='A06X' or x =='A0AQ' or x =='A14O' or x =='A0NE' or x =='A1C0' or x =='A0SB' or x =='A418'
endfunction
function JCI takes nothing returns boolean
	return GetUnitAbilityLevel(GetTriggerUnit(),'B06X')> 0 and JBI(GetSpellAbilityId())== false and LNX(GetSpellAbilityId())== false and X5R(GetSpellAbilityId())== false and IsNotItemAbility(GetSpellAbilityId())
endfunction
function JDI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer level = LoadInteger(HY, h, 0)
	local unit u = LoadUnitHandle(HY, h, 0)
	if not Mode__RearmCombos and(GetUnitAbilityLevel(u,'A14O')> 0 or GetUnitAbilityLevel(u,'A3FJ')> 0) then
		call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+(.06 + .02 * level)* GetUnitState(u, UNIT_STATE_MAX_MANA))
	else
		call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+(.05 + .05 * level)* GetUnitState(u, UNIT_STATE_MAX_MANA))
	endif
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction
function JFI takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit u = GetTriggerUnit()
	local unit JGI =(LoadUnitHandle(HY, h,$FE))
	local integer level = GetUnitAbilityLevel(JGI,'P347')
	local timer t
	if GetUnitAbilityLevel(JGI,'A36D')== 0 and GetDistanceBetweenUnits(u, JGI)<$578 and GetPrdRandom(u,'P347', 40) then
		set t = CreateTimer()
		call TimerStart(t, 0, false, function JDI)
		call SaveUnitHandle(HY, GetHandleId(t), 0, u)
		call SaveInteger(HY, GetHandleId(t), 0, level)
		set t = null
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCasterOverhead.mdl", u, "overhead"))
	endif
	set u = null
	set JGI = null
	set t = null
endfunction
function P5E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A0IF')
	local trigger t
	if(level == 1) then
		set t = CreateTrigger()
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
		call TriggerAddCondition(t, Condition(function JCI))
		call TriggerAddAction(t, function JFI)
		call SaveUnitHandle(HY, GetHandleId(t),$FE, u)
	endif

	call UnitAddMaxMana(u, 75)
	//if(level == 1) then
	//	call UnitAddPermanentAbility(u,'A0OL')
	//elseif(level == 2) then
	//	call UnitAddPermanentAbility(u,'A0OM')
	//elseif(level == 3) then
	//	call UnitAddPermanentAbility(u,'A0ON')
	//elseif(level == 4) then
	//	call UnitAddPermanentAbility(u,'A0OH')
	//endif
	set u = null
	set t = null
endfunction
// 秘法天球
function ArcaneOrbActions takes unit u, unit t returns nothing
	local real d = .01 *(5 + GetUnitAbilityLevel(u,'A0OI'))*(GetUnitState(u, UNIT_STATE_MANA)+ 100 )
	call UnitRemoveAbility(t,'B06Y')
	if(IsUnitType(t, UNIT_TYPE_SUMMONED) or DETargetIsIllusion[DEI]) and IsBearUnit(t)== false and IsInfernalUnit(t)== false then
		set d = d + 100 * GetUnitAbilityLevel(u,'A0OI')
	endif
	call CommonTextTag("+" + I2S(R2I(d)), 1, t, .023, 191, 64, 255,$D8)
	call UnitDamageTargetEx(u, t, 3, d)
	if GetPrdRandom(u,'P347', GetUnitAbilityLevel(u,'P347')* 10) then
		call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ .25 * GetUnitState(u, UNIT_STATE_MAX_MANA))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCasterOverhead.mdl", u, "overhead"))
	endif
endfunction
function JKI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer JLI =(LoadInteger(HY, h, 262))
	call SetHeroInt(targetUnit, GetHeroInt(targetUnit, false)+ JLI, true)
	call SetHeroInt(WUE, GetHeroInt(WUE, false)-JLI, true)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function JMI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	call SaveInteger(HY,(GetHandleId((targetUnit))),(4303), 2)
	call DestroyEffect((LoadEffectHandle(HY, h, 32)))

	call ImprisonedUnit(targetUnit, false)

	call ClearSelectionForPlayer(GetOwningPlayer(targetUnit))
	call SelectUnitAddForPlayer(targetUnit, GetOwningPlayer(targetUnit))
	call RemoveSavedHandle(HY,(GetHandleId(WUE)), 748)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
// 星体禁锢
function AstralImprisonmentActions takes unit WUE, unit targetUnit, integer level, boolean Q0X returns nothing
	local integer JLI = IMinBJ(GetHeroInt(targetUnit, false), 1 + level * 3)+ 2
	local trigger t
	local integer h
	local unit dummyUnit = CreateUnit(GetOwningPlayer(targetUnit),'o019', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local boolean b = UnitHasSpellShield(targetUnit)
	if GetUnitTypeId(WUE)=='e00E' then
		if HaveSavedHandle(HY, GetHandleId(WUE), 0) then
			set WUE = LoadUnitHandle(HY, GetHandleId(WUE), 0)
			if b then
				call AJO(targetUnit)
			endif
		else
			set WUE = Player__Hero[GetPlayerId(GetOwningPlayer(WUE))]
		endif
	endif
	if(IsUnitEnemy(targetUnit, GetOwningPlayer(WUE)))== false or b == false then
		call UnitApplyTimedLife(dummyUnit,'BTLF', level + 1)
		call SaveInteger(HY, GetHandleId(targetUnit), 4303, 1)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		
		call ImprisonedUnit(targetUnit, true)

		call SaveEffectHandle(HY, h, 32,(AddSpecialEffect("Abilities\\Spells\\Demon\\DarkConversion\\ZombifyTarget.mdl", GetUnitX(targetUnit), GetUnitY(targetUnit))))
		call SaveUnitHandle(HY, h, 2,(WUE))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call TriggerRegisterTimerEvent(t, level, false)
		call TriggerAddCondition(t, Condition(function JMI))
		if IsUnitEnemy(targetUnit, GetOwningPlayer(WUE)) then
			call SaveUnitHandle(HY, GetHandleId(WUE), 748, targetUnit)
			call SetHeroInt(targetUnit, GetHeroInt(targetUnit, false)-JLI, true)
			call SetHeroInt(WUE, GetHeroInt(WUE, false)+ JLI, true)
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call SaveUnitHandle(HY, h, 2,(WUE))
			call SaveUnitHandle(HY, h, 17,(targetUnit))
			call SaveInteger(HY, h, 262,(JLI))
			call TriggerRegisterTimerEvent(t, 50, false)
			call TriggerRegisterDeathEvent(t, WUE)
			call TriggerRegisterDeathEvent(t, targetUnit)
			call TriggerAddCondition(t, Condition(function JKI))
		endif
	endif
	if IsUnitAlly(targetUnit, GetOwningPlayer(WUE))== false and b and Q0X then
		call AJO(targetUnit)
	endif
	set dummyUnit = null
	set t = null
endfunction
function SpellEffect__AstralImprisonment takes nothing returns nothing
	call AstralImprisonmentActions(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(),'A0OJ'), false)
endfunction
function K4E takes nothing returns nothing
	if IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) and(LoadBoolean(HY, GetHandleId(GetOwningPlayer(GetSpellTargetUnit())),$8B)) and GetSpellTargetUnit()!= GetTriggerUnit() then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n038'))
	endif
endfunction
function JQI takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local unit WJE = GetTriggerUnit()
	local integer OJO
	local integer MFR
	local integer array SBF
	local integer level = GetUnitAbilityLevel(WJE,'A0OK')
	local integer FTX = 7 + 1 * level
	local integer i
	local boolean UDR = GetUnitAbilityLevel(WJE,'A1VW')> 0
	local unit d
	local unit JSI = targetUnit
	if IsUnitIllusion(targetUnit) then
		set JSI = Player__Hero[GetPlayerId(GetOwningPlayer(targetUnit))]
	endif
	if GetHeroInt(WJE, true)== 0 then
		set WJE = Player__Hero[GetPlayerId(GetOwningPlayer(WJE))]
	endif
	set i = GetHeroPrimaryAttributesType(WJE)
	if i == 2 then
		set OJO = GetHeroInt(WJE, true)-GetHeroInt(JSI, true)
	elseif i == 3 then
		set OJO = GetHeroAgi(WJE, true)-GetHeroAgi(JSI, true)
	else
		set OJO = GetHeroStr(WJE, true)-GetHeroStr(JSI, true)
	endif
	if UDR then
		set level = GetUnitAbilityLevel(WJE,'A1VW')
		set FTX = 7 + 1 * level + 1
	endif
	set MFR =-$A+ 20 * level
	if(OJO > 0) then
		call UnitDamageTargetEx(WJE, targetUnit, 1, OJO * FTX)
		call CommonTextTag(I2S(R2I(OJO * FTX)), 3, targetUnit, .023,$D8, 30, 30,$D8)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Feedback\\SpellBreakerAttack.mdl", targetUnit, "overhead"))
		call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)* .6)
		if UDR and UnitIsDead(targetUnit)== false then
			call AstralImprisonmentActions(WJE, targetUnit, 4, true)
		endif
	endif
	set targetUnit = null
	set WJE = null
endfunction
function JTI takes nothing returns boolean
	return IsUnitIdType(GetUnitTypeId(GetFilterUnit()), UNIT_TYPE_HERO) and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit()))
endfunction
function OCE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A0OK')
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local group g = LoginGroup(314)
	local integer IMX = 0
	local unit JUI =(LoadUnitHandle(HY,(GetHandleId(u)), 748))
	if level == 0 then
		set level = GetUnitAbilityLevel(u,'A1VW')
	endif
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosTarget.mdl", x, y))
	loop
	exitwhen IMX >= 360
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosTarget.mdl", x +($C8+ level * 50)* Cos(IMX * bj_DEGTORAD), y +($C8+ level * 50)* Sin(IMX * bj_DEGTORAD)))
		set IMX = IMX + 45
	endloop
	call GroupEnumUnitsInRange(g, x, y, 300 + level * 100 , Condition(function JTI))
	if JUI != null and GetDistanceBetween(x, y, GetUnitX(JUI), GetUnitY(JUI))<(300 + level * 100 ) then
		call SetUnitInvulnerable(JUI, false)
		call GroupAddUnit(g, JUI)
	endif
	call ForGroup(g, function JQI)
	if JUI != null and UnitIsDead(JUI)== false then
		call SetUnitInvulnerable(JUI, true)
	endif
	call LogoutGroup(g)
	set g = null
	set JUI = null
	set u = null
endfunction
function JWI takes nothing returns nothing
	call UnitDamageTargetEx(LCV, GetEnumUnit(), 1, LDV)
endfunction
function JYI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local group g
	local integer EVX = LoadInteger(HY, h, 34)
	if EVX >$FA or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call WHV(targetUnit,'D001')
		call DestroyEffect((LoadEffectHandle(HY, h, 31)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_PLAYER_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A0QG' and GetSpellTargetUnit()== targetUnit then
		call DestroyEffect((LoadEffectHandle(HY, h, 31)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if EVX == 1 then
			call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
		endif
		set EVX = EVX + 1
		call SaveInteger(HY, h, 34, EVX)
		set g = LoginGroup(315)
		set U2 = WUE
		set LCV = WUE
		set LDV = 1. + 2. * LoadInteger(HY, h, 0)
		call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 275, Condition(function DJX))
		call GroupRemoveUnit(g, targetUnit)
		call ForGroup(g, function JWI)
		call LogoutGroup(g)
		set targetUnit = null
	endif
	set t = null
	set WUE = null
	set g = null
	return false
endfunction
function ODE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call WJV(WLE,'C001','D001', 0)
	call PlaySoundAtPoint(LC, GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit()))
	call SaveUnitHandle(HY, h, 2, u)
	call SaveUnitHandle(HY, h, 17, WLE)
	call SaveEffectHandle(HY, h, 31, AddSpecialEffectTarget("war3mapImported\\NewSoulArmor.mdx", GetSpellTargetUnit(), "chest"))
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterDeathEvent(t, WLE)
	call TriggerAddCondition(t, Condition(function JYI))
	set u = null
	set t = null
	set WLE = null
endfunction
function JZI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local integer level
	local unit WUE
	local unit targetUnit
	local real x1
	local real y1
	local real d
	local real a
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call SetUnitPathing(LoadUnitHandle(HY, h, 17), true)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set targetUnit =(LoadUnitHandle(HY, h, 17))
		set d =(LoadReal(HY, h, 138))
		set x =(LoadReal(HY, h, 6))
		set y =(LoadReal(HY, h, 7))
		set a =(LoadReal(HY, h, 137))
		set x1 = GetUnitX(targetUnit)+ d / $F* Cos(a)
		set y1 = GetUnitY(targetUnit)+ d / $F* Sin(a)
		if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
			call SaveBoolean(K, GetHandleId(targetUnit), 99, true)
			call SetUnitPosition(targetUnit, x1, y1)
		else
			call SetUnitX(targetUnit, x1)
			call SetUnitY(targetUnit, y1)
		endif
		if GetTriggerEvalCount(t)>$F then
			set WUE =(LoadUnitHandle(HY, h, 2))
			set level =(LoadInteger(HY, h, 5))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call SetUnitPathing(targetUnit, true)
			call UnitDamageTargetEx(WUE, targetUnit, 1, level * 40)
			set WUE = null
		endif
		set targetUnit = null
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function J_I takes nothing returns nothing
	local trigger t = null
	local unit WUE = null
	local unit targetUnit = GetEnumUnit()
	local integer h
	if RFX(targetUnit) then
		set targetUnit = null
		return
	endif
	set t = CreateTrigger()
	set WUE = GetTriggerUnit()
	set h = GetHandleId(t)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function JZI))
	call SaveReal(HY, h, 6,((LFV)* 1.))
	call SaveReal(HY, h, 7,((LGV)* 1.))
	call SaveReal(HY, h, 138,((GetDistanceBetween(LFV, LGV, GetUnitX(targetUnit), GetUnitY(targetUnit)))* 1.))
	call SaveReal(HY, h, 137,((Atan2(LGV -GetUnitY(targetUnit), LFV -GetUnitX(targetUnit)))* 1.))
	call SaveInteger(HY, h, 5,(LHV))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SetUnitPathing(targetUnit, false)
	set t = null
	set WUE = null
	set targetUnit = null
endfunction
function OFE takes nothing returns nothing
	local group g = LoginGroup(316)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local integer lv = GetUnitAbilityLevel(GetTriggerUnit(),'A0QE')
	local real r = 175 + 100 * lv
	set U2 = GetTriggerUnit()
	call PlaySoundAtPoint(CE, x, y)
	call DestroyEffect(AddSpecialEffect("war3mapImported\\Star Aura.mdx", x, y))
	call GroupEnumUnitsInRange(g, x, y, r, Condition(function DQX))
	set LFV = x
	set LGV = y
	set LHV = lv
	call ForGroup(g, function J_I)
	call KillDestructablesInCircle(x, y, 200)
	call LogoutGroup(g)
	set g = null
endfunction
function K5E takes nothing returns nothing
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	if A4X(x, y)== false or(IsPointInRegion(R4,((x)* 1.),((y)* 1.))) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n03K'))
	endif
endfunction
function TFF takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	call UnitRemoveAbility(targetUnit,'B07W')
	call UnitRemoveAbility(targetUnit,'Bblo')
	call UnitRemoveAbility(targetUnit,'B062')
	call UnitRemoveAbility(targetUnit,'B065')
	call UnitRemoveAbility(targetUnit,'Bcrs')
	call UnitRemoveAbility(targetUnit,'B016')
	set t = null
	set targetUnit = null
	return false
endfunction
function OGE takes nothing returns nothing
	call AddAbilityToTimed(GetSpellTargetUnit(),'A3KB', 1, 1.5 + 1.5 * GetUnitAbilityLevel(GetTriggerUnit(),'A0R7'),'B07W')
	call PlaySoundAtPoint(DevourMagicSound, GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit()))
endfunction

function WallOfReplicaIllusionUnitDeath takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)

	call GroupRemoveUnit(LoadGroupHandle(HY, h, 257), LoadUnitHandle(HY, h, 261))
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
	
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction

function WallOfReplicaIllusionActions takes unit wallUnit, unit targetUnit, unit illusionUnit returns boolean
	local integer h = GetHandleId(wallUnit)
	local integer count =(LoadInteger(HY, h, 260))
	local trigger t = CreateTrigger()
	call SetUnitVertexColor(illusionUnit, 255, 255, 255, 100)
	call TriggerRegisterUnitEvent(t, illusionUnit, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function WallOfReplicaIllusionUnitDeath))
	call SaveGroupHandle(HY, GetHandleId(t), 257, LoadGroupHandle(HY, h, 257))
	call SaveUnitHandle(HY, GetHandleId(t), 261, targetUnit)
	set count = count + 1
	call SaveInteger(HY, h, 260, count)
	call SaveUnitHandle(HY, h, 2800 + count,(illusionUnit))
	call SaveTriggerHandle(HY, h, 2900 + count, t)
	call SetUnitX(illusionUnit, GetUnitX(targetUnit))
	call SetUnitY(illusionUnit, GetUnitY(targetUnit))
	set t = null
	return false
endfunction

function WallOfReplicaCreateIllusion takes boolean isScepterUpgrade returns boolean
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit wallUnit = LoadUnitHandle(HY, h, 259)
	local unit sourceUnit = LoadUnitHandle(HY, h, 260)
	local unit targetUnit = GetTriggerUnit()
	local integer level = LoadInteger(HY, h, 0)
	local real dataB
	local real dataC = 3.
	local unit illusionUnit = null
	local string targetArt = "Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl"
	if isScepterUpgrade then
		set dataB = 0.8 + level * 0.2
	else
		set dataB = 0.45 + level * 0.15
	endif

	set illusionUnit = SummonIllusion(targetUnit, sourceUnit, 65., dataB, dataC, 0., targetArt)

	if illusionUnit != null then
		call WallOfReplicaIllusionActions(wallUnit, targetUnit, illusionUnit)
	endif

	//call U1V(sourceUnit, 852274, targetUnit)
	call UnitDamageTargetEx(sourceUnit, targetUnit, 1, 150)

	set sourceUnit = null
	set targetUnit = null
	set illusionUnit = null
	return false
endfunction
function EnterWallOfReplica takes nothing returns boolean
	local unit enterUnit = GetFilterUnit()
	local integer h = GetHandleId(GetTriggeringTrigger())
	local group g
	if IsUnitType(enterUnit, UNIT_TYPE_HERO) and IsUnitEnemy(enterUnit, LoadPlayerHandle(HY, h, 250)) then
		set g = LoadGroupHandle(HY, h, 257)
		if not IsUnitInGroup(enterUnit, g) then
			call GroupAddUnit(g, enterUnit)
			call WallOfReplicaCreateIllusion(false)
		endif
		set g = null
	endif
	set enterUnit = null
	return false
endfunction
function EnterUpgradeWallOfReplica takes nothing returns boolean
	local unit enterUnit = GetFilterUnit()
	local integer h = GetHandleId(GetTriggeringTrigger())
	local group g
	if IsUnitType(enterUnit, UNIT_TYPE_HERO) and IsUnitEnemy(enterUnit, LoadPlayerHandle(HY, h, 250)) then
		set g = LoadGroupHandle(HY, h, 257)
		if not IsUnitInGroup(enterUnit, g) then
			call GroupAddUnit(g, enterUnit)
			call WallOfReplicaCreateIllusion(true)
		endif
		set g = null
	endif
	set enterUnit = null
	return false
endfunction

function KVI takes nothing returns nothing
	call RemoveUnit(GetEnumUnit())
endfunction

function WallOfReplicaEndActions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local trigger t2 = LoadTriggerHandle(HY, h, 255)
	local integer h2 = GetHandleId(t2)
	local group g1 = LoadGroupHandle(HY, h2, 257)
	local group g2 = LoadGroupHandle(HY, h2, 258)
	local unit u2 = LoadUnitHandle(HY, h2, 259)
	local integer uh = GetHandleId(u2)
	local integer J9I = LoadInteger(HY, uh, 260)
	local integer i
	local unit u
	call ForGroup(g2, function KVI)
	set i = 1
	loop
	exitwhen i > J9I
		set u = LoadUnitHandle(HY, uh, 2800 + i)
		call FlushChildHashtable(HY, GetHandleId(LoadTriggerHandle(HY, uh, 2900+ i)))
		call CleanCurrentTrigger(LoadTriggerHandle(HY, uh, 2900+ i))
		if IsUnitIllusion(u) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl", GetUnitX(u), GetUnitY(u)))
			call RemoveUnit(u)
		endif
		set i = i + 1
	endloop
	call FlushChildHashtable(HY, h)
	call FlushChildHashtable(HY, h2)
	call FlushChildHashtable(HY, uh)
	call RemoveUnit(u2)
	call LogoutGroup(g1)
	call LogoutGroup(g2)
	call CleanCurrentTrigger(t2)
	call CleanCurrentTrigger(t)
	set t = null
	set t2 = null
	set g1 = null
	set g2 = null
	set u2 = null
	set u = null
	return false
endfunction

function SpellEffect__WallOfReplica takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real face = GetUnitFacing(spellUnit)-45
	local unit wall = CreateUnit(GetOwningPlayer(spellUnit),'h00O', x, y, face)
	local unit u
	local real targetX
	local real targetY
	local integer i
	local trigger t = CreateTrigger()
	local group g1 = LoginGroup(317)
	local integer h = GetHandleId(t)
	local group wallGroup = LoginGroup(318)
	local trigger mainTrig = t
	local integer level = GetUnitAbilityLevel(spellUnit,'A0QK')
	local boolean isScepterUpgrade = false
	if level == 0 then
		set isScepterUpgrade = true
		set level = GetUnitAbilityLevel(spellUnit,'A21Q')
	endif
	call SaveInteger(HY, h, 0, level)
	call PlaySoundAtPoint(WallOfReplicaSound, x, y)
	call SaveGroupHandle(HY, h, 257, g1)
	call SaveGroupHandle(HY, GetHandleId(wall), 257, g1)
	call SaveGroupHandle(HY, h, 258, wallGroup)
	call SaveUnitHandle(HY, h, 259, wall)
	call SaveUnitHandle(HY, h, 260, spellUnit)
	call SaveInteger(HY, GetHandleId(wall), 260, 0)
	set i = 0
	loop
	exitwhen i > 39
		set targetX = x +(500 -25 * i)* Cos((face -45)* bj_DEGTORAD)
		set targetY = y +(500 -25 * i)* Sin((face -45)* bj_DEGTORAD)
		set u = CreateUnit(GetOwningPlayer(spellUnit),'h00P', targetX, targetY, face)
		call GroupAddUnit(wallGroup, u)
		call TriggerRegisterUnitInRange(t, u, 17, TrueBoolexprCondition)
		set i = i + 1
	endloop
	call SaveBoolean(HY, h, 0, isScepterUpgrade)
	if isScepterUpgrade then
		call TriggerAddCondition(t, Condition(function EnterUpgradeWallOfReplica))
	else
		call TriggerAddCondition(t, Condition(function EnterWallOfReplica))
	endif

	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 45, false)
	call TriggerAddCondition(t, Condition(function WallOfReplicaEndActions))
	call SaveTriggerHandle(HY, GetHandleId(t), 255, mainTrig)
	set spellUnit = null
	set u = null
	set t = null
	set mainTrig = null
	set g1 = null
	set wallGroup = null
	set wall = null
endfunction


function DrunkenBrawler__Effect__Actions takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local integer h
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		set h = GetHandleId(whichUnit)
		call DestroyEffect(LoadEffectHandle(ExtraHT, AEAttackerId[AEI], HTKEY_UNIT_DRUNKEN_BRAWLER_CS))
		set h = GetHandleId(GetTriggeringTrigger())
		call DestroyTimerAndFlushHT_HY(LoadTimerHandle(HY, h, 1))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(GetTriggeringTrigger())
		//call SingleDebug("醉拳已删除 " + GetUnitName(whichUnit))
	endif
	set whichUnit = null
endfunction
function DrunkenBrawler__Effect_Loop takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	local integer hu = GetHandleId(u)
	local real currentTime = GetGameTime()
	local string effPath = null
	if currentTime - LoadReal(ExtraHT, hu, HTKEY_UNIT_DRUNKEN_BRAWLER_CS)>= 10 and not LoadBoolean(ExtraHT, hu, HTKEY_UNIT_DRUNKEN_BRAWLER_CS) then
		set effPath = "war3mapImported\\DrunkenFX.mdx"
		call SaveEffectHandle(ExtraHT, hu, HTKEY_UNIT_DRUNKEN_BRAWLER_CS, AddSpecialEffectTarget(effPath, u, T2V(u) ) )
		call SaveBoolean(ExtraHT, hu, HTKEY_UNIT_DRUNKEN_BRAWLER_CS, true)
	endif
	if currentTime - LoadReal(ExtraHT, hu, HTKEY_UNIT_DRUNKEN_BRAWLER_MS)>= 10 and not LoadBoolean(ExtraHT, hu, HTKEY_UNIT_DRUNKEN_BRAWLER_MS) then
		call SaveBoolean(ExtraHT, hu, HTKEY_UNIT_DRUNKEN_BRAWLER_MS, true)
	endif
	//A34E
	set t = null
	set u = null
endfunction

function Add__DrunkenBrawler__Actions takes unit u returns nothing
	local trigger t
	local timer tt = CreateTimer()
	call EnableEffectByTime(1, 0)
	// 被攻击和 主动法球 - 闪避
	if not IsUnitType(u, UNIT_TYPE_HERO) then
		set t = CreateTrigger()
		call TriggerRegisterDeathEvent(t, u)
		call TriggerAddCondition(t, Condition(function DrunkenBrawler__Effect__Actions))
		call SaveUnitHandle(HY, GetHandleId(t), 0, u)
		call SaveTimerHandle(HY, GetHandleId(t), 1, tt)
		set t = null
	endif
	call TimerStart(tt, 0.5, true, function DrunkenBrawler__Effect_Loop)
	call SaveUnitHandle(HY, GetHandleId(tt), 0, u)
	set tt = null
endfunction

function LearnSkill__DrunkenBrawler takes nothing returns nothing
	call Add__DrunkenBrawler__Actions(GetTriggerUnit())
endfunction
function JOE takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local group g = null
	local unit u2 = null
	local integer level = GetUnitAbilityLevel(WJE, GetSpellAbilityId())-1 +'A3PR'
	if UnitHasSpellShield(WLE) then
		set WJE = null
		set WLE = null
		return
	endif
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\StrongDrink\\BrewmasterMissile.mdl", WLE, "origin"))
	set U2 = WJE
	set g = LoginGroup(319)
	call GroupEnumUnitsInRange(g, GetUnitX(WLE), GetUnitY(WLE),$E1, Condition(function DJX))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call GroupRemoveUnit(g, u2)
		if IsHeroUnitId(GetUnitTypeId(u2)) then
			call AddAbilityToTimed(u2, level, 1, 8.,'BNdh')
		else
			call AddAbilityToTimed(u2, level, 1, 12.,'BNdh')
		endif
	endloop
	call LogoutGroup(g)
	call EnableEffectByTime(8, 13)
	set WJE = null
	set WLE = null
endfunction
function KFI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer E6X = LoadInteger(HY, h, 29)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		if(LoadBoolean(HY, h, 276))== false and GetTriggerUnit()==(WUE) then
			call SaveBoolean(HY, h, 276, true)
			call SetHeroStr(WUE, GetHeroStr(WUE, false)-E6X, true)
			call SaveInteger(K, GetHandleId(WUE), 30, LoadInteger(K, GetHandleId(WUE), 30)-E6X)
		elseif(LoadBoolean(HY, h, 277))== false and GetTriggerUnit()== targetUnit then
			call SaveBoolean(HY, h, 277, true)
			call SetHeroStr(targetUnit, GetHeroStr(targetUnit, false)+ E6X, true)
		endif
	else
		if(LoadBoolean(HY, h, 276))== false then
			call SaveBoolean(HY, h, 276, true)
			call SetHeroStr(WUE, GetHeroStr(WUE, false)-E6X, true)
			call SaveInteger(K, GetHandleId(WUE), 30, LoadInteger(K, GetHandleId(WUE), 30)-E6X)
		endif
		if(LoadBoolean(HY, h, 277))== false then
			call SaveBoolean(HY, h, 277, true)
			call SetHeroStr(targetUnit, GetHeroStr(targetUnit, false)+ E6X, true)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function KGI takes nothing returns nothing
	local unit WUE = LMV
	local unit targetUnit = GetEnumUnit()
	local integer KHI
	local integer level = LPV
	local trigger t
	local integer h
	local integer KJI = 4
	if GetUnitAbilityLevel(WUE,'A3JX')> 0 then
		set KJI = 8
	endif
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		set KHI = IMinBJ(GetHeroStr(targetUnit, false)-1, KJI)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SetHeroStr(WUE, GetHeroStr(WUE, false)+ KHI, true)
		call SaveInteger(K, GetHandleId(WUE), 30, LoadInteger(K, GetHandleId(WUE), 30)+ KHI)
		call SetHeroStr(targetUnit, GetHeroStr(targetUnit, false)-KHI, true)
		call TriggerRegisterTimerEvent(t, 30, false)
		call TriggerRegisterDeathEvent(t, WUE)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function KFI))
		call SaveBoolean(HY, h, 276,(false))
		call SaveBoolean(HY, h, 277,(false))
		call SaveUnitHandle(HY, h, 2,(WUE))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SaveInteger(HY, h, 29,(KHI))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", WUE, "origin"))
	endif
	call UnitDamageTargetEx(WUE, targetUnit, 1, 40 * level -20)
	set WUE = null
	set targetUnit = null
	set t = null
endfunction
function OJE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local group g = LoginGroup(320)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer lv = GetUnitAbilityLevel(u,'A15S')+ GetUnitAbilityLevel(u,'A3JX')
	local unit d = CreateUnit(GetOwningPlayer(u),'h07J', x, y, 0)
	call DestroyEffect(AddSpecialEffect("effects\\DecayGreen_Groundonly_1.mdx", x, y))
	if IsUnitType(u, UNIT_TYPE_HERO)== false then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
	set U2 = u
	set LMV = u
	set LPV = lv
	call GroupEnumUnitsInRange(g, x, y, 350, Condition(function DQX))
	call ForGroup(g, function KGI)
	call EPX(u,'AFRZ', .03)
	call LogoutGroup(g)
	call KillUnit(d)
	set u = null
	set g = null
	set t = null
	set d = null
endfunction

// 创造噬魂的闪电效果
function SoulRipLighitEffect takes unit u, unit t returns nothing
	call AddLightningToTimed("SPLK", GetUnitX(u), GetUnitY(u), GetUnitX(t), GetUnitY(t), .1, .6, .44, .9, .6)
endfunction

function SoulRipActions takes unit spellUnit, unit targetUnit, boolean isAlly returns nothing
	local group g = LoginGroup(321)
	local integer level = GetUnitAbilityLevel(spellUnit,'A0R5')
	local integer soulRipEnumCount = 0
	local integer maxCount = 8 + level * 2
	local real soulRipValue = 10 + 4 * level // 噬魂的数值 治疗/伤害
	local unit firstUnit = null

	if GetUnitTypeId(spellUnit)=='e00E' then
		set spellUnit = LoadUnitHandle(HY, GetHandleId(spellUnit), 'REFL')
	endif
	set SoulRipTempGroup = LoginGroup(322)
	// 寻敌是以施法者为中心 而不是目标单位
	call GroupEnumUnitsInRange(g, GetUnitX(spellUnit), GetUnitY(spellUnit), 1325, null)
	// 不会抽取施法者 以及 主目标
	call GroupRemoveUnit(g, spellUnit)
	call GroupRemoveUnit(g, targetUnit)

	set Temp__Player = GetOwningPlayer(spellUnit)
	loop
		set firstUnit = FirstOfGroup(g)
		exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)

		// 非魔免(对友军魔免会抽) 存活 非建筑 非守卫 不是远古 但可以是熊灵 对施法者可见
		if ( not IsMagicImmuneUnit(firstUnit) or IsUnitAlly(firstUnit, Temp__Player) ) and IsAliveNotStrucNotWard(firstUnit) and IsNoAncientOrBear(firstUnit) and UnitVisibleToPlayer(firstUnit, Temp__Player) then
			if soulRipEnumCount < maxCount then
				set soulRipEnumCount = soulRipEnumCount + 1
				call GroupAddUnit(SoulRipTempGroup, firstUnit)
			endif
		endif

	endloop

	call LogoutGroup(g)
	set g = SoulRipTempGroup

	// 计数大于0再进入循环
	if soulRipEnumCount > 0 then

		if isAlly then

			// 如果对友军使用..
			loop
				set firstUnit = FirstOfGroup(g)
				exitwhen firstUnit == null
				call GroupRemoveUnit(g, firstUnit)

				// 是否是墓碑单位?
				if IsTombstoneUnit(targetUnit) then
					if soulRipEnumCount > 0 then
						set soulRipEnumCount = soulRipEnumCount -1
						// 如果对墓碑 每个魂会给墓碑回1点血
						call UnitRestoreHealth(targetUnit, 1)
						call SoulRipLighitEffect(firstUnit, targetUnit)
						if GetUnitTypeId(firstUnit)!='n0F5' then
							call NotLethalLifeRemoved(firstUnit, soulRipValue)
						endif
					endif
				else
					if GetUnitTypeId(firstUnit)!='n0F5' then
						call NotLethalLifeRemoved(firstUnit, soulRipValue)
					endif

					call SoulRipLighitEffect(firstUnit, targetUnit)
				endif

			endloop
			
			// 计数大于0 并且不是墓碑
			if not IsTombstoneUnit(targetUnit) then
				call UnitRestoreHealth(targetUnit, (soulRipValue) * soulRipEnumCount )
			endif

		else

			// 如果对敌方使用..
			loop
				set firstUnit = FirstOfGroup(g)
				exitwhen firstUnit == null
				call GroupRemoveUnit(g, firstUnit)

				if GetUnitTypeId(firstUnit)!='n0F5' then
					call NotLethalLifeRemoved(firstUnit, soulRipValue)
				endif
				call SoulRipLighitEffect(firstUnit, targetUnit)

			endloop

			// 造成魔法伤害
			call UnitDamageTargetEx(spellUnit, targetUnit, 1, (soulRipValue) * soulRipEnumCount)

		endif

	endif

	set firstUnit = null
	call LogoutGroup(g)
	set g = null

endfunction

function SpellEffect__SoulRip takes nothing returns nothing
	// 目标不是建筑 或者目标是友军墓碑单位
	local unit targetUnit = GetSpellTargetUnit()
	local unit spellUnit = GetTriggerUnit()
	local boolean isAlly = IsUnitAlly(targetUnit, GetOwningPlayer(spellUnit))
	if not IsUnitType(targetUnit, UNIT_TYPE_STRUCTURE) or ( isAlly and IsTombstoneUnit(targetUnit) ) then
		call SoulRipActions(spellUnit, targetUnit, isAlly)
	endif
	set spellUnit = null
	set targetUnit = null
endfunction
function KSI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local unit KTI =(LoadUnitHandle(HY, h, 269))
	if GetTriggerEventId()== EVENT_UNIT_DEATH or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if GetTriggerUnit()== targetUnit then
			call KillUnit(KTI)
		endif
	elseif OY then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call PauseUnit(KTI, true)
	elseif GetTriggerEventId()== EVENT_UNIT_ISSUED_ORDER or GetTriggerEventId()== EVENT_UNIT_ISSUED_POINT_ORDER or GetTriggerEventId()== EVENT_UNIT_ISSUED_TARGET_ORDER then
		call DisableTrigger(t)
		call IssueTargetOrderById(KTI, 851983, targetUnit)
		call EnableTrigger(t)
	elseif(GetWidgetLife(targetUnit)<( 100 * LYV) or GetWidgetLife(targetUnit)/ GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)< LYV * .05 + .15) and GetUnitAbilityLevel(KTI,'B0AN')== 0 then
		call IssueTargetOrderById(LZV[GetPlayerId(GetOwningPlayer(KTI))],$D0085, KTI)
	elseif UnitVisibleToPlayer(targetUnit, GetOwningPlayer(KTI))== false then
		if(LoadBoolean(HY, h, 270)) then
			if(LoadBoolean(HY, h, 271)) then
				if(LoadBoolean(HY, h, 272)) then
					call FlushChildHashtable(HY, h)
					call CleanCurrentTrigger(t)
					call KillUnit(KTI)
				else
					call SaveBoolean(HY, h, 272,(true))
				endif
			else
				call SaveBoolean(HY, h, 271,(true))
			endif
		else
			call SaveBoolean(HY, h, 270,(true))
		endif
	else
		call SaveBoolean(HY, h, 270,(false))
		call SaveBoolean(HY, h, 271,(false))
		call SaveBoolean(HY, h, 272,(false))
	endif
	set t = null
	set targetUnit = null
	set KTI = null
	return false
endfunction
function KUI takes nothing returns boolean
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = GetEnumUnit()
	local unit KTI = CreateUnit(LWV,'n0F5', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call IssueTargetOrderById(KTI, 851983, targetUnit)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterUnitEvent(t, KTI, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, KTI, EVENT_UNIT_ISSUED_ORDER)
	call TriggerRegisterUnitEvent(t, KTI, EVENT_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterUnitEvent(t, KTI, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function KSI))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))
	call SaveUnitHandle(HY, h, 269,(KTI))
	call SaveInteger(HY, h, 5,(LYV))
	set t = null
	set targetUnit = null
	set KTI = null
	return false
endfunction
function KWI takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='n0F5' and GetWidgetLife(GetFilterUnit())> 1 then
		call KillUnit(GetFilterUnit())
	endif
	return false
endfunction
function KYI takes player p returns nothing
	local group g = LoginGroup(323)
	call GroupEnumUnitsOfPlayer(g, p, Condition(function KWI))
	call LogoutGroup(g)
	set g = null
endfunction
function KZI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit K_I =(LoadUnitHandle(HY, h, 266))
	local unit K0I =(LoadUnitHandle(HY, h, 267))
	local unit K1I =(LoadUnitHandle(HY, h, 268))
	local integer level =(LoadInteger(HY, h, 5))
	local group g
	local player XSR
	if IsSentinelsPlayer(GetOwningPlayer(WUE)) then
		set XSR = Scourges[0]
	else
		set XSR = Sentinels[0]
	endif
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		if(LoadBoolean(HY, h, 265)) then
			call A8X(XSR, .4, GetUnitX(WUE), GetUnitY(WUE), 600)
		endif
		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UDeathMedium\\UDeath.mdl", GetUnitX(WUE), GetUnitY(WUE)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call S9V(WUE, 2)
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\Darksummoning\\DarkSummonTarget.mdl", GetUnitX(K_I), GetUnitY(K_I)))
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\Darksummoning\\DarkSummonTarget.mdl", GetUnitX(K0I), GetUnitY(K0I)))
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\Darksummoning\\DarkSummonTarget.mdl", GetUnitX(K1I), GetUnitY(K1I)))
		call RemoveUnit(K_I)
		call RemoveUnit(K0I)
		call RemoveUnit(K1I)
		call KYI(GetOwningPlayer(WUE))
	else
		if UnitVisibleToPlayer(WUE, XSR) then
			call SaveBoolean(HY, h, 265,(true))
		endif
		set g = LoginGroup(324)
		set U2 = WUE
		set LWV = GetOwningPlayer(WUE)
		set LYV = level
		call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 25 + 400 +$C8* level, Condition(function DGX))
		if OY == false then
			call ForGroup(g, function KUI)
		endif
		call LogoutGroup(g)
		set g = null
	endif
	set t = null
	set WUE = null
	set K_I = null
	set K0I = null
	set K1I = null
	set XSR = null
	return false
endfunction
function K2I takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call RemoveSavedBoolean(HY, h, 0)
		call CleanCurrentTrigger(GetTriggeringTrigger())
	elseif IsUnitIdType(GetUnitTypeId(GetEventDamageSource()), UNIT_TYPE_HERO)== false or GetUnitAbilityLevel(GetEventDamageSource(),'A1W4')> 0 then
		if(GetUnitTypeId(GetEventDamageSource())=='n01G' or GetUnitAbilityLevel(GetEventDamageSource(),'A1W4')> 0) then
			if LoadBoolean(HY, h, 0)== false then
				call SaveBoolean(HY, h, 0, true)
				call UnitDamageTargetEx(GetEventDamageSource(), GetTriggerUnit(), 10, 1)
				call SaveBoolean(HY, h, 0, false)
			endif
		else
			call SetUnitToReduceDamage(GetTriggerUnit(), .5)
		endif
	endif
endfunction
function OME takes nothing returns nothing
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit K3I
	local real dx
	local real dy
	local real K4I
	local unit K5I
	local unit K6I
	local unit K7I
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(GetTriggerUnit(),'A15V')
	local integer id
	local real a
	local string s
	local string ss
	local integer i = 1
	local integer LAR = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))],'A0A8')
	if level == 1 then
		set K3I = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'n0FJ', x, y, 0)
	elseif level == 2 then
		set K3I = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'n0FI', x, y, 0)
	elseif level == 3 then
		set K3I = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'n0F6', x, y, 0)
	else
		set K3I = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'n0FH', x, y, 0)
	endif
	call SetUnitAnimation(K3I, "birth")
	if LAR > 0 then
		call UnitAddPermanentAbility(K3I,'A1AC')
	endif
	call PlaySoundAtPoint(MF, x, y)
	set id = GetPlayerId(GetOwningPlayer(K3I))
	if LZV[id]== null then
		set LZV[id]= CreateUnit(GetOwningPlayer(K3I),'e01V', x, y, 0)
		call UnitAddPermanentAbility(LZV[id],'A176')
	endif
	call SetUnitPosition(K3I, CoordinateX50(x), CoordinateY50(y))
	call UnitApplyTimedLife(K3I,'BTLF',$A+ 5 * level)
	call KillDestructablesInCircle(x, y, 300)
	set dx = x +$C8* Cos(0 * bj_DEGTORAD)
	set dy = y +$C8* Sin(0 * bj_DEGTORAD)
	set K4I = AngleBetweenXY(dx, dy, x, y)
	set K5I = CreateUnit(GetOwningPlayer(K3I),'h07H', dx, dy, K4I)
	set ss = "Stand Work Gold"
	call SetUnitAnimation(K5I, ss)
	set dx = x +$C8* Cos( 120* bj_DEGTORAD)
	set dy = y +$C8* Sin( 120* bj_DEGTORAD)
	set K4I = AngleBetweenXY(dx, dy, x, y)
	set K6I = CreateUnit(GetOwningPlayer(K3I),'h07H', dx, dy, K4I)
	call SetUnitAnimation(K6I, ss)
	set dx = x +$C8* Cos($F0* bj_DEGTORAD)
	set dy = y +$C8* Sin($F0* bj_DEGTORAD)
	set K4I = AngleBetweenXY(dx, dy, x, y)
	set K7I = CreateUnit(GetOwningPlayer(K3I),'h07H', dx, dy, K4I)
	call SetUnitAnimation(K7I, ss)
	set s = "Stand Work"
	call SetUnitAnimation(K3I, s)
	set i = 1
	loop
		call QueueUnitAnimation(K5I, ss)
		call QueueUnitAnimation(K6I, ss)
		call QueueUnitAnimation(K7I, ss)
		call QueueUnitAnimation(K3I, s)
		set i = i + 1
	exitwhen i > 17
	endloop
	call TriggerRegisterUnitEvent(t, K3I, EVENT_UNIT_DEATH)
	if LAR > 0 then
		call TriggerRegisterTimerEvent(t, 3.1 -0.4 * LAR, true)
	else
		call TriggerRegisterTimerEvent(t, 3, true)
	endif
	call TriggerAddCondition(t, Condition(function KZI))
	call SaveUnitHandle(HY, h, 2,(K3I))
	call SaveUnitHandle(HY, h, 266,(K5I))
	call SaveUnitHandle(HY, h, 267,(K6I))
	call SaveUnitHandle(HY, h, 268,(K7I))
	call SaveInteger(HY, h, 5,(level))
	call SaveBoolean(HY, h, 265,(false))
	call TriggerEvaluate(t)
	set t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, K3I, EVENT_UNIT_DAMAGED)
	call TriggerRegisterDeathEvent(t, K3I)
	call TriggerAddCondition(t, Condition(function K2I))
	set K3I = null
	set K5I = null
	set K6I = null
	set K7I = null
	set t = null
endfunction
function K8I takes unit U6E returns boolean
	return LoadInteger(K, GetHandleId(U6E),'AGH1')=='QM03' or LoadInteger(K, GetHandleId(U6E),'AGH2')=='QM03'
endfunction
function K9I takes nothing returns nothing
	if IsUnitType(U2, UNIT_TYPE_HERO) then
		if K8I(W2) then
			call SetWidgetLife(W2, GetWidgetLife(W2)+ GetUnitState(W2, UNIT_STATE_MAX_LIFE)* .1)
		else
			call SetWidgetLife(W2, GetWidgetLife(W2)+ GetUnitState(W2, UNIT_STATE_MAX_LIFE)* .06)
		endif
	else
		if K8I(W2) then
			call SetWidgetLife(W2, GetWidgetLife(W2)+ GetUnitState(W2, UNIT_STATE_MAX_LIFE)* .03)
		else
			call SetWidgetLife(W2, GetWidgetLife(W2)+ GetUnitState(W2, UNIT_STATE_MAX_LIFE)* .02)
		endif
	endif
endfunction
function LVI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	call SaveBoolean(P, LoadInteger(P, GetHandleId(t), 0),'QM03', false)
	call DestroyTimerAndFlushHT_P(t)
	set t = null
endfunction
function LEI takes unit u returns nothing
	local timer t = CreateTimer()
	local integer WFV = GetHandleId(u)
	call SaveBoolean(P, WFV,'QM03', true)
	call SaveInteger(P, GetHandleId(t), 0, WFV)
	call TimerStart(t, .25, false, function LVI)
	set t = null
endfunction
function LXI takes unit IZX, group g returns nothing
	local group gg = LoginGroup(325)
	local unit u
	local real LJR
	local real d
	local real a
	call GroupAddGroup(g, gg)
	loop
		set u = FirstOfGroup(gg)
	exitwhen u == null
		set LJR = LoadReal(HY, GetHandleId(u),'ZMBI')
		set d = GetDistanceBetweenUnits(IZX, u)
		if d < 775 then
			set a = 20 + 5 * GetUnitAbilityLevel(IZX,'QM03')
			if K8I(IZX) then
				set a = a + 5
			endif
			if d >$C8 then
				set a = a -$F*((d -$96)/(775 -$96))
			endif
			set a = a / 100 
			if a != LJR then
				call SaveReal(HY, GetHandleId(u),'AMPL', LoadReal(HY, GetHandleId(u),'AMPL')-LJR + a)
				call SaveReal(HY, GetHandleId(u),'ZMBI', a)
			endif
		else
			call SaveReal(HY, GetHandleId(u),'AMPL', LoadReal(HY, GetHandleId(u),'AMPL')-LJR)
			call RemoveSavedReal(HY, GetHandleId(u),'ZMBI')
		endif
		call GroupRemoveUnit(gg, u)
	endloop
	call LogoutGroup(gg)
endfunction
function LOI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group g = LoadGroupHandle(HY, h, 0)
	call LXI(null, g)
	call LogoutGroup(g)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set g = null
endfunction
function LRI takes group g returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .0, false, function LOI)
	call SaveGroupHandle(HY, GetHandleId(t), 0, g)
	set t = null
endfunction
function LII takes nothing returns boolean
	local trigger t2 = GetTriggeringTrigger()
	local integer h2 = GetHandleId(t2)
	local trigger t1 = LoadTriggerHandle(HY, h2, 274)
	local integer h = GetHandleId(t1)
	local unit WUE = LoadUnitHandle(HY, h2, 2)
	local unit targetUnit
	local real d
	local real a
	local boolean b = LoadBoolean(HY, h2, 273)
	local real LAI = LoadReal(HY, h2, 30)
	if(GetTriggerEventId()== EVENT_UNIT_DEATH and GetTriggerUnit()== WUE) or(GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED and GetGameTime()> LAI) then
		call LEI(WUE)
		call LRI(LoadGroupHandle(HY, h2, 30))
		call FlushChildHashtable(HY, h)
		call FlushChildHashtable(HY, h2)
		call CleanCurrentTrigger(t1)
		call CleanCurrentTrigger(t2)
	elseif GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		call LXI(WUE, LoadGroupHandle(HY, h2, 30))
	elseif GetTriggerEventId()== EVENT_UNIT_DAMAGED then
	elseif GetTriggerEventId()== EVENT_UNIT_DEATH then
		if IsUnitIllusion(GetDyingUnit())== false then
			call NHX(GetDyingUnit(), WUE,'h07Y', "K9I", 9999, false)
		endif
	endif
	set t2 = null
	set t1 = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function LNI takes nothing returns boolean
	local trigger t1 = GetTriggeringTrigger()
	local integer L2R = GetHandleId(t1)
	local trigger t2 =(LoadTriggerHandle(HY,(L2R), 275))
	local integer DOO = GetHandleId(t2)
	local unit targetUnit = GetTriggerUnit()
	local unit WUE =(LoadUnitHandle(HY,(L2R), 2))
	if IsUnitEnemy(WUE, GetOwningPlayer(targetUnit)) and IsUnitType(targetUnit, UNIT_TYPE_STRUCTURE)== false and GetUnitAbilityLevel(targetUnit,'A04R')== 0 then
		if(LoadBoolean(HY,(DOO),(GetHandleId(targetUnit))))== false then
			call GroupAddUnit(LoadGroupHandle(HY, DOO, 30), targetUnit)
			call TriggerRegisterUnitEvent(t2, targetUnit, EVENT_UNIT_DEATH)
			call TriggerRegisterTimerEvent(t2, .1, true)
			call SaveBoolean(HY,(DOO),(GetHandleId(targetUnit)),(true))
		endif
	endif
	set t1 = null
	set t2 = null
	set targetUnit = null
	set WUE = null
	return false
endfunction
function LBI takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t1 = CreateTrigger()
	local integer L2R = GetHandleId(t1)
	local trigger t2 = CreateTrigger()
	local integer DOO = GetHandleId(t2)
	local integer level = GetUnitAbilityLevel(WUE,'QM03')
	call SetPlayerAbilityAvailable(GetOwningPlayer(WUE),'A17A', false)
	call TriggerRegisterUnitInRange(t1, WUE, 750, TrueBoolexprCondition)
	call TriggerAddCondition(t1, Condition(function LNI))
	call SaveTriggerHandle(HY,(L2R), 275,(t2))
	call SaveUnitHandle(HY,(L2R), 2,(WUE))
	call TriggerRegisterTimerEvent(t2, 30, false)
	call SaveReal(HY, DOO, 30, GetGameTime()+ 30.)
	call TriggerRegisterUnitEvent(t2, WUE, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t2, Condition(function LII))
	call SaveTriggerHandle(HY,(DOO), 274,(t1))
	call SaveUnitHandle(HY,(DOO), 2,(WUE))
	call SaveBoolean(HY,(DOO), 273,(false))
	call SaveGroupHandle(HY, DOO, 30, LoginGroup(326))
	set WUE = null
	set t1 = null
	set t2 = null
endfunction
function SpellEffect__FleshGolem takes nothing returns nothing
	if GetUnitTypeId(GetTriggerUnit())!='H07I' then
		call LBI()
		call GroupAddUnit(OX, GetTriggerUnit())
	else
		call GroupRemoveUnit(OX, GetTriggerUnit())
	endif
	if GetUnitAbilityLevel(GetTriggerUnit(),'QINV')== 1 then
		call UnitRemoveAbility(GetTriggerUnit(),'QINV')
	endif
endfunction
function LCI takes nothing returns nothing
	if not IsUnitInGroup(GetEnumUnit(), L_V) then
		call GroupAddUnit(L_V, GetEnumUnit())
		call AddAbilityToTimed(GetEnumUnit(), L0V, 1, 3.,'B05Q')
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\SpellShieldAmulet\\SpellShieldCaster.mdl", GetEnumUnit(), "overhead"))
	endif
endfunction
function LDI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local real x2 = LoadReal(HY, h, 66)
	local real y2 = LoadReal(HY, h, 67)
	local real a = LoadReal(HY, h, 137)
	local integer EVX = GetTriggerEvalCount(t)
	local real x = GetUnitX(triggerUnit)
	local real y = GetUnitY(triggerUnit)
	local real GXR = LoadReal(HY, h, 23)
	local real GOR = LoadReal(HY, h, 24)
	local unit dummyUnit = LoadUnitHandle(HY, h, 19)
	local group g = LoginGroup(327)
	local group D7R = LoadGroupHandle(HY, h, 187)
	local integer level = LoadInteger(HY, h, 5)
	if GetDistanceBetween(x, y, x2, y2)<= 53 then
		set x = x2
		set y = y2
	else
		set x = GXR + 60 * Cos(a * bj_DEGTORAD)
		set y = GOR + 60 * Sin(a * bj_DEGTORAD)
	endif
	set x = CoordinateX50(x)
	set y = CoordinateY50(y)
	if level == 1 then
		set L0V ='A294'
	elseif level == 2 then
		set L0V ='A295'
	elseif level == 3 then
		set L0V ='A296'
	elseif level == 4 then
		set L0V ='A297'
	endif
	set U2 = triggerUnit
	set L_V = D7R
	call GroupEnumUnitsInRange(g, x, y, 325, Condition(function DJX))
	call ForGroup(g, function LCI)
	call LogoutGroup(g)
	call SaveReal(HY, h, 23, x * 1.)
	call SaveReal(HY, h, 24, y * 1.)
	call SetUnitPosition(triggerUnit, x, y)
	if(x == x2 and y == y2) or EVX > LoadInteger(HY, h, 0) then
		if IsUnitType(dummyUnit, UNIT_TYPE_HERO) then
			call SaveBoolean(K, GetHandleId(dummyUnit), 99, true)
		endif
		call SetUnitX(dummyUnit, CoordinateX50(x))
		call SetUnitY(dummyUnit, CoordinateY50(y))
		call IssueImmediateOrderById(dummyUnit,$D0080)
		call LogoutGroup(D7R)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SetUnitAnimation(triggerUnit, "stand")
		call SetUnitPathing(triggerUnit, true)
		call SetUnitInvulnerableEx(triggerUnit, false)
		call ResetUnitVertexColor(triggerUnit)
		call SaveInteger(HY, GetHandleId(triggerUnit), 4261, 2)
	endif
	set t = null
	set triggerUnit = null
	set dummyUnit = null
	set D7R = null
	set g = null
	return false
endfunction
function OQE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x1 = GetUnitX(triggerUnit)
	local real y1 = GetUnitY(triggerUnit)
	local real x2
	local real y2
	local real a
	local unit dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'e00E', x1, y1, 0)
	if GetSpellTargetUnit()== null then
		set x2 = GetSpellTargetX()
		set y2 = GetSpellTargetY()
	else
		set x2 = GetUnitX(GetSpellTargetUnit())
		set y2 = GetUnitY(GetSpellTargetUnit())
	endif
	set a = AngleBetweenXY(x1, y1, x2, y2)
	call SetUnitAnimationByIndex(triggerUnit, 0)
	call SetUnitPathing(triggerUnit, false)
	call SetUnitInvulnerableEx(triggerUnit, true)
	call SetUnitVertexColorEx(triggerUnit, 0, 0, 0,-1)
	call SaveInteger(HY, GetHandleId(triggerUnit), 4261, 1)
	call SaveReal(HY, h, 66, x2 * 1.)
	call SaveReal(HY, h, 67, y2 * 1.)
	call SaveReal(HY, h, 23, x1 * 1.)
	call SaveReal(HY, h, 24, y1 * 1.)
	call SaveReal(HY, h, 137, a * 1.)
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(triggerUnit, GetSpellAbilityId()))
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	call SaveUnitHandle(HY, h, 19, dummyUnit)
	call SaveGroupHandle(HY, h, 187, LoginGroup(328))
	call SaveInteger(HY, h, 0, R2I((500 +$C8* GetUnitAbilityLevel(triggerUnit,'A0LK'))/ 60.))
	call UnitAddPermanentAbility(dummyUnit,'A0LA')
	call SetUnitAbilityLevel(dummyUnit,'A0LA', GetUnitAbilityLevel(triggerUnit,'A0LK'))
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function LDI))
	set triggerUnit = null
	set t = null
	set dummyUnit = null
endfunction
function LFI takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real d = GetEventDamage()
	if(d > 0) and GetWidgetLife(u)> 1 and FK and GetUnitAbilityLevel(u,'A36D')== 0 then
		if(d <= 20) then
			if GetRandomInt(0, 100)< 5 + 5 *(GetUnitAbilityLevel(u,'A0CZ')) then
				call SetWidgetLife(u, GetWidgetLife(u)+ d)
				call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\WingedSerpentMissile\\WingedSerpentMissile.mdl", u, "hand,left"))
			endif
		elseif GetPrdRandom(u,'A0CZ', 5 + 5 *(GetUnitAbilityLevel(u,'A0CZ'))) then
			call SetWidgetLife(u, GetWidgetLife(u)+ d)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\WingedSerpentMissile\\WingedSerpentMissile.mdl", u, "hand,left"))
		endif
	endif
	set u = null
endfunction
function LPE takes nothing returns nothing
	set HaveBacktrack = true
	//local trigger t = CreateTrigger()
	//call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_DAMAGED)
	//call TriggerAddCondition(t, Condition(function LFI))
	//set t = null
endfunction
function U1F takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit LHI =(LoadUnitHandle(HY, h, 19))
	call PauseTimer(t)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set LHI = null
endfunction
function LJI takes nothing returns boolean
	return GetUnitTypeId(GetFilterUnit()) != 'ewsp' and UnitIsDead(GetFilterUnit())== false and GetOwningPlayer(GetFilterUnit())!= GetOwningPlayer(U2) and GetOwningPlayer(GetFilterUnit())!= NeutralPassivePlayer 
endfunction
function LKI takes nothing returns boolean
	return GetUnitTypeId(GetTriggerUnit()) != 'ewsp' and UnitIsDead(GetTriggerUnit())== false and GetOwningPlayer(GetTriggerUnit())!= GetOwningPlayer(U2) and GetOwningPlayer(GetTriggerUnit())!= NeutralPassivePlayer 
endfunction
function LLI takes unit u returns nothing
	call SetUnitTimeScale(u, 0)
	call SaveBoolean(HY, GetHandleId(u), 4306, true)
	if IsHeroUnitId(GetUnitTypeId(u)) or IsUnitIllusion(u) then
		if IsUnitPaused(u)== false then
			if IssueTargetOrderById(LoadUnitHandle(VV,'CHRN', 0), 852095, u)== false then
				call UnitShareVision(u, GetOwningPlayer(LoadUnitHandle(VV,'CHRN', 0)), true)
				if IssueTargetOrderById(LoadUnitHandle(VV,'CHRN', 0), 852095, u)== false then
					if RCX(u)== false and RDX(u)== false then
						call PauseUnit(u, true)
					endif
				endif
				call UnitShareVision(u, GetOwningPlayer(LoadUnitHandle(VV,'CHRN', 0)), false)
			endif
		endif
	else
		call PauseUnit(u, true)
	endif
endfunction
function LMI takes nothing returns nothing
	call LLI(GetEnumUnit())
endfunction
function LPI takes nothing returns nothing
	local unit u = GetEnumUnit()
	call SaveBoolean(HY, GetHandleId(u), 4306, false)
	call PauseUnit(u, false)
	call SetUnitTimeScale(u, 1)
	set u = null
endfunction
function LQI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit d = LoadUnitHandle(HY, h, 19)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local integer level = LoadInteger(HY, h, 5)
	local group g = LoadGroupHandle(HY, h,$DC)
	local integer c = LoadInteger(HY, h, 28)
	local real W_E = GetUnitX(d)
	local real W0E = GetUnitY(d)
	local group gg
	local integer SYV = LoadInteger(HY, h, 6)
	call SaveUnitHandle(VV,'CHRN', 0, d)
	if GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		set c = c + 1
		call SaveInteger(HY, h, 28, c)
		if GetDistanceBetweenUnits(triggerUnit, d)< 435 then
			call SetUnitImitateMoveSpeed(triggerUnit, 999, 700)
		else
			call SetUnitImitateMoveSpeed(triggerUnit, 0, 0)
		endif
		set gg = LoginGroup(329)
		call ForGroup(g, function LPI)
		set U2 = triggerUnit
		call GroupEnumUnitsInRange(gg, W_E, W0E, 475, Condition(function LJI))
		call GroupClear(g)
		call GroupAddGroup(gg, g)
		call ForGroup(gg, function LMI)
		call LogoutGroup(gg)
	else
		set U2 = triggerUnit
		if LKI() and GetUnitAbilityLevel(GetTriggerUnit(),'Aloc')== 0 and GetUnitAbilityLevel(GetTriggerUnit(),'A04R')== 0 and IsUnitInGroup(GetTriggerUnit(), g)== false then
			call GroupAddUnit(g, GetTriggerUnit())
			call LLI(GetTriggerUnit())
		endif
	endif
	call RemoveSavedHandle(VV,'CHRN', 0)
	if c > SYV then
		if OY == false then
			call ForGroup(g, function LPI)
		endif
		call SetUnitImitateMoveSpeed(triggerUnit, 0, 0)
		call KillUnit(d)
		call RemoveUnit(d)
		call KillUnit(LoadUnitHandle(HY, h, 18))
		call LogoutGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set d = null
	set triggerUnit = null
	set g = null
	set gg = null
endfunction
function OSE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0J1')+ GetUnitAbilityLevel(triggerUnit,'A1D7')
	local real W_E = GetSpellTargetX()
	local real W0E = GetSpellTargetY()
	local unit d = CreateUnit(GetOwningPlayer(triggerUnit),'u00L', W_E, W0E, 0)
	local integer h
	local trigger tt
	local unit Q2R = CreateUnit(GetOwningPlayer(triggerUnit),'e00E', W_E, W0E, 0)
	call UnitAddAbility(Q2R,'A21K')
	set tt = CreateTrigger()
	set h = GetHandleId(tt)
	call SaveUnitHandle(HY, h, 19, d)
	call SaveUnitHandle(HY, h, 18, Q2R)
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	call SaveGroupHandle(HY, h,$DC, LoginGroup(330))
	call SaveInteger(HY, h, 28, 0)
	call SaveInteger(HY, h, 5, level)
	if GetUnitAbilityLevel(triggerUnit,'A1D7')> 0 then
		call SaveInteger(HY, h, 6, 33 + level * 2)
	else
		call SaveInteger(HY, h, 6, 28 + level * 2)
	endif
	call SavePlayerHandle(HY, h, 0, GetOwningPlayer(triggerUnit))
	call TriggerRegisterTimerEvent(tt, .1, true)
	call TriggerRegisterTimerEvent(tt, 0, false)
	call TriggerRegisterUnitInRange(tt, d, 425, Condition(function LJI))
	call TriggerAddCondition(tt, Condition(function LQI))
	call UnitAddAbility(d,'A45D')
	set triggerUnit = null
	set d = null
	set tt = null
	set Q2R = null
endfunction
function LSI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(P, GetHandleId(t), 0)
	if GetUnitAbilityLevel(u,'B0C2')== 0 then
		call RemoveSavedHandle(P, GetHandleId(u),'A081')
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		set u = null
		return
	endif
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl", u, "chest"))
	set t = null
	set u = null
endfunction
function LTI takes unit u, integer WFV returns nothing
	local timer t = CreateTimer()
	call SaveTimerHandle(P, WFV,'A081', t)
	call SaveUnitHandle(P, GetHandleId(t), 0, u)
	call TimerStart(t, .1, true, function LSI)
	set t = null
endfunction
function LWI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 30)
	local integer hu = GetHandleId(u)
	local integer c = LoadInteger(HY, h, 1)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or c == 1 then
		call LodSystem_AddUnitExtraState(u, LoadInteger(HY, h, 2), STATE_SYSTEM_ARMOUR)
		call RemoveSavedHandle(HY, hu,'A0VW')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SaveInteger(HY, h, 1, c -1)
	endif
	set t = null
	set u = null
endfunction
function LYI takes unit u returns nothing
	local trigger t
	local integer h
	local integer level
	local integer c
	if HaveSavedHandle(HY, GetHandleId(u),'A0VW') then
		set t = LoadTriggerHandle(HY, GetHandleId(u),'A0VW')
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 5, false)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, GetHandleId(u),'A0VW', t)
		call TriggerRegisterTimerEvent(t, 5, false)
		call TriggerRegisterDeathEvent(t, u)
		call SaveUnitHandle(HY, h, 30, u)
		call TriggerAddCondition(t, Condition(function LWI))
	endif
	set c = LoadInteger(HY, h, 2)
	if c <$A then
		call SaveInteger(HY, h, 2, c + 1)
		call LodSystem_ReduceUnitExtraState(u, 1, STATE_SYSTEM_ARMOUR)
	endif
	call SaveInteger(HY, h, 1, LoadInteger(HY, h, 1)+ 1)
	set t = null
endfunction
function LZI takes nothing returns boolean
	local real d
	if GetUnitAbilityLevel(GetTriggerUnit(),'B091')> 0 and GetUnitAbilityLevel(GetEventDamageSource(),'A0VV')> 0 and(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 2))== GetEventDamageSource() then
		call UnitRemoveAbility(GetTriggerUnit(),'B091')
		call DisableTrigger(GetTriggeringTrigger())
		call LYI(GetTriggerUnit())
		call FlushChildHashtable(HY,(GetHandleId(GetTriggeringTrigger())))
		call CleanCurrentTrigger(GetTriggeringTrigger())
	endif
	return false
endfunction
function L_I takes nothing returns nothing
	local trigger t
	local unit targetUnit
	local unit WUE
	if GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT then
		set targetUnit = GetSpellTargetUnit()
		set WUE = GetTriggerUnit()
	else
		set targetUnit = GetTriggerUnit()
		set WUE = GetAttacker()
	endif
	if IsUnitIllusion(WUE)== false then
		set t = CreateTrigger()
		call SaveUnitHandle(HY,(GetHandleId(t)), 2,(WUE))
		call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(t, Condition(function LZI))
	endif
	set t = null
	set targetUnit = null
	set WUE = null
endfunction
function L0I takes nothing returns boolean
	if GetTriggerEventId()== EVENT_PLAYER_UNIT_ATTACKED then
		if GetUnitAbilityLevel(GetAttacker(),'A0VV')> 0 and(LoadBoolean(HY,(GetHandleId(GetTriggeringTrigger())),$BC0)) and IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE)== false and GetAttacker()==(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 2)) then
			call L_I()
		endif
	elseif GetTriggerEventId()== EVENT_UNIT_ISSUED_ORDER then
		if(GetIssuedOrderId()==$D011F) then
			call SaveBoolean(HY,(GetHandleId(GetTriggeringTrigger())),$BC0,(true))
		elseif(GetIssuedOrderId()==$D0120) then
			call SaveBoolean(HY,(GetHandleId(GetTriggeringTrigger())),$BC0,(false))
		endif
	elseif GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A0VV' then
		call L_I()
	endif
	return false
endfunction
function L1I takes unit WUE returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_ISSUED_ORDER)
	call TriggerAddCondition(t, Condition(function L0I))
	call SaveUnitHandle(HY,(GetHandleId(t)), 2,(WUE))
	call SaveBoolean(HY,(GetHandleId(t)),$BC0,(true))
	set t = null
endfunction
function L2I takes nothing returns boolean
	if not InHeroSelection then
		if(IsPlayerHasSkill(GetOwningPlayer(GetTriggerUnit()), 316) or IsPlayerHasSkill(GetOwningPlayer(GetTriggerUnit()),$D4)) and IsUnitIllusion(GetTriggerUnit())== false then
			set U2 = GetTriggerUnit()
		elseif IsPlayerHasSkill(GetOwningPlayer(GetTriggerUnit()), 356) and IsUnitIllusion(GetTriggerUnit())== false and GetUnitTypeId(GetTriggerUnit())!='H00J' then
			set U2 = GetTriggerUnit()
			call ExecuteFunc("L3I")
		endif
	endif
	return false
endfunction

// 卡尔b缴械
// 缴械时间为 1 + lv * 0.5
// 可考虑用保持货物模拟缴械
function DeafeningBlastDisarmUnit takes unit targetUnit, integer level returns nothing
	local real dur = 1 + level * 0.5
	if not IsMagicImmuneUnit(targetUnit) then
		call DisarmUnitToTimed(targetUnit, 'A0VT', 'A0VW', 'B0VW' ,dur)
	endif
endfunction
function L5I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real a =(LoadReal(HY, h, 13))
	local real J0R =(LoadReal(HY, h,$C1))
	local integer level =(LoadInteger(HY, h, 5))
	local integer KLR = level * 40 / 3
	local real x
	local real y
	local integer EVX = GetTriggerEvalCount(t)
	if EVX > KLR / 3 then
		call SaveReal(HY, h,$C1,((J0R * .98)* 1.))
	endif
	if EVX > KLR or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if GetTriggerEventId()!= EVENT_WIDGET_DEATH then
			call DeafeningBlastDisarmUnit(targetUnit, level)
		endif
	else
		set x = CoordinateX50(GetUnitX(targetUnit)+ J0R * Cos(a))
		set y = CoordinateY50(GetUnitY(targetUnit)+ J0R * Sin(a))
		call KillDestructablesInCircle(x, y, 150)
		call SetUnitPosition(targetUnit, x, y)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction

// 超震声波 位移
function L6I takes unit WUE, unit targetUnit, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real a = Atan2(GetUnitY(targetUnit)-GetUnitY(WUE), GetUnitX(targetUnit)-GetUnitX(WUE))
	call UnitDamageTargetEx(WUE, targetUnit, 1, 20 + 60 * level)
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveReal(HY, h,$C1,(6 * 1.))
	call SaveInteger(HY, h, 5,(level))
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function L5I))
	set t = null
endfunction

function L7I takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), DK)== false and IsMagicImmuneUnit(GetEnumUnit())== false then
		call GroupAddUnit(DK, GetEnumUnit())
		call L6I(U2, GetEnumUnit(), Q2)
	endif
endfunction

function L8I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local real a =(LoadReal(HY, h, 137))
	local real x2 =(LoadReal(HY, h, 66))
	local real y2 =(LoadReal(HY, h, 67))
	local group g =(LoadGroupHandle(HY, h, 22))
	local integer level =(LoadInteger(HY, h, 5))
	local real x = GetUnitX(dummyUnit)
	local real y = GetUnitY(dummyUnit)
	local group g2
	if GetDistanceBetween(x, y, x2, y2)< 100 then
		set x = x2
		set y = y2
	else
		set x = x + 33 * Cos(a)
		set y = y + 33 * Sin(a)
	endif
	call SetUnitX(dummyUnit, CoordinateX50(x))
	call SetUnitY(dummyUnit, CoordinateY50(y))
	set g2 = LoginGroup(331)
	set U2 = dummyUnit
	set DK = g
	set Q2 = level
	call GroupEnumUnitsInRange(g2, x, y, 200, Condition(function DPX))
	call ForGroup(g2, function L7I)
	call LogoutGroup(g2)
	if(x == x2 and y == y2) or GetTriggerEvalCount(t)> 35 then
		set g2 = LoginGroup(332)
		set U2 = dummyUnit
		set DK = g
		set Q2 = level
		call GroupEnumUnitsInRange(g2, x, y,$FA, Condition(function DPX))
		call ForGroup(g2, function L7I)
		call LogoutGroup(g2)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(dummyUnit)
		call LogoutGroup(g)
	endif
	set t = null
	set dummyUnit = null
	set g = null
	set g2 = null
	return false
endfunction

function L9I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local group g =(LoadGroupHandle(HY,(h), 22))
	local integer i = 0
	local unit d
	local real a
	local real tx
	local real ty
	local real x
	local real y
	local group gg
	set gg = LoginGroup(333)
	loop
		set d = LoadUnitHandle(HY, h, 100 + i)
		set tx = LoadReal(HY, h, 200 + i)
		set ty = LoadReal(HY, h, 300 + i)
		set a = LoadReal(HY, h, 100 + i)
		set x = GetUnitX(d)
		set y = GetUnitY(d)
		if GetDistanceBetween(x, y, tx, ty)< 100  then
			set x = tx
			set y = ty
		else
			set x = x + 33 * Cos(a)
			set y = y + 33 * Sin(a)
		endif
		call SetUnitX(d, CoordinateX50(x))
		call SetUnitY(d, CoordinateY50(y))
		set U2 = d
		set DK = g
		set Q2 = 4
		call GroupEnumUnitsInRange(gg, x, y, 200, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call ForGroup(gg, function L7I)
		if GetTriggerEvalCount(t)> 30 then
			call GroupClear(gg)
			set U2 = d
			set DK = g
			set Q2 = 4
			call GroupEnumUnitsInRange(gg, x, y, 250, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
			call ForGroup(gg, function L7I)
			call GroupClear(gg)
			call KillUnit(d)
		endif
		call GroupClear(gg)
		set i = i + 1
	exitwhen i == 12
	endloop
	call LogoutGroup(gg)
	if GetTriggerEvalCount(t)> 33 then
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
		call LogoutGroup(g)
	endif
	set t = null
	set d = null
	set g = null
	set gg = null
	return false
endfunction

// 超震声波 - A
function MVI takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local real a = 0
	local unit d
	local integer i = 0
	local integer Z6X = 12
	loop
		set a = 30 * i
		set d = CreateUnit(GetOwningPlayer(whichUnit),'n01X', GetUnitX(whichUnit), GetUnitY(whichUnit), a)
		call SaveUnitHandle(HY, h, 100 + i, d)
		call SaveReal(HY, h, 100 + i, a * bj_DEGTORAD)
		call SetUnitX(d, GetUnitX(whichUnit))
		call SetUnitY(d, GetUnitY(whichUnit))
		call SaveReal(HY, h, 200 + i, CoordinateX50(GetUnitX(d)+ 1000 * Cos(a * bj_DEGTORAD)))
		call SaveReal(HY, h, 300 + i, CoordinateY50(GetUnitY(d)+ 1000 * Sin(a * bj_DEGTORAD)))
		set i = i + 1
	exitwhen i == Z6X
	endloop
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function L9I))
	call SaveGroupHandle(HY,(h), 22,(LoginGroup(334)))
	call SaveInteger(HY, h, 0, 10)
	set t = null
	set whichUnit = null
endfunction

function MEI takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = Atan2(y -GetUnitY(WUE), x -GetUnitX(WUE))
	local integer level = GetUnitAbilityLevel(WUE,'Z610')
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'n01X', GetUnitX(WUE), GetUnitY(WUE), a * bj_RADTODEG)
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function L8I))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveReal(HY, h, 137,((a)* 1.))
	call SaveReal(HY, h, 66,((GetUnitX(WUE)+1000* Cos(a))* 1.))
	call SaveReal(HY, h, 67,((GetUnitY(WUE)+1000* Sin(a))* 1.))
	call SaveGroupHandle(HY, h, 22,(LoginGroup(335)))
	call SaveInteger(HY, h, 5,(level))
	set t = null
	set WUE = null
	set dummyUnit = null
endfunction

// 超震声波
function OUE takes nothing returns nothing
	if GetSpellAbilityId()=='A3K5' then
		call MVI()
	else
		call MEI()
	endif
endfunction
function MXI takes unit WJE, unit WLE, integer MOI returns nothing
	local real MRI = RMaxBJ(RMinBJ(GetUnitState(WLE, UNIT_STATE_MANA), MOI), 0)
	local real MII = MRI * .5
	local real MAI = 0
	if IsMagicImmuneUnit(WLE)== false and MRI > 0 and RCX(WLE)== false then
		if IsUnitIllusion(WLE)== false then
			if GetUnitState(WLE, UNIT_STATE_MANA)> MRI then
				set MAI = MAI + MRI
			else
				set MAI = MAI + GetUnitState(WLE, UNIT_STATE_MANA)
			endif
		endif
		if GetWidgetLife(WLE)>(MII + .5) then
			call SetWidgetLife(WLE, GetWidgetLife(WLE)-MII)
		else
			call SetWidgetLife(WLE, 1)
			call UnitDamageTargetEx(L2V, WLE, 1, MII)
		endif
		call SetUnitState(WLE, UNIT_STATE_MANA, GetUnitState(WLE, UNIT_STATE_MANA)-MRI)
	endif
	set MAI = MAI / 2
	if IsUnitType(WJE, UNIT_TYPE_HERO) then
		call SetUnitState(WJE, UNIT_STATE_MANA, GetUnitState(WJE, UNIT_STATE_MANA)+ MAI)
	endif
endfunction
function MNI takes unit WUE, integer level, unit triggerUnit returns nothing
	local group g = LoginGroup(336)
	local unit u2
	set L2V = WUE
	set U2 = WUE
	set L1V = level * 100 
	set U2 = triggerUnit
	call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 700, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call GroupRemoveUnit(g, u2)
		call MXI(triggerUnit, u2, level * 100 )
	endloop
	call LogoutGroup(g)
	set g = null
endfunction
function MBI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer EVX = GetTriggerEvalCount(t)
	local integer level =(LoadInteger(HY, h, 5))
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit MCI
	local real MDI = 2.00
	local real MFI = 1 +(3.9 -1)* EVX /(MDI / .05)
	call SetUnitScale(dummyUnit, MFI, MFI, MFI)
	if EVX >(MDI / .05) then
		call MNI(dummyUnit, level, WUE)
		set MCI = CreateUnit(GetOwningPlayer(dummyUnit),'e01O', GetUnitX(dummyUnit), GetUnitY(dummyUnit), 0)
		call SetUnitTimeScale(MCI, .3)
		call RemoveUnit(dummyUnit)
		call KillUnit(MCI)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set dummyUnit = null
	set MCI = null
	set WUE = null
	return false
endfunction
function OWE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = Atan2(y -GetUnitY(WUE), x -GetUnitX(WUE))
	local integer level = GetUnitAbilityLevel(WUE,'Z609')
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e01M', x, y, a * bj_RADTODEG)
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function MBI))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveInteger(HY, h, 5,(level))
	set t = null
	set WUE = null
	set dummyUnit = null
endfunction
function MGI takes unit WUE, unit targetUnit, integer level returns nothing
	local unit dummyUnit = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local unit MHI = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddAbility(dummyUnit,'A0XK')
	call SetUnitAbilityLevel(dummyUnit,'A0XK', level)
	call UnitAddAbility(dummyUnit,'A3G2')
	call SetUnitAbilityLevel(dummyUnit,'A3G2', level)
	call SaveUnitHandle(HY, GetHandleId(dummyUnit), 0, WUE)
	call FJO(targetUnit, dummyUnit)
	call IOX(MHI, targetUnit, 1, 60. + level * 60., .8 + .3 * level)
	set dummyUnit = null
	set MHI = null
endfunction
function MJI takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), DK)== false then
		call GroupAddUnit(DK, GetEnumUnit())
		call MGI(U2, GetEnumUnit(), Q2)
	endif
endfunction
function MKI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local real x2 =(LoadReal(HY, h, 66))
	local real y2 =(LoadReal(HY, h, 67))
	local real a =(LoadReal(HY, h, 137))
	local integer level =(LoadInteger(HY, h, 5))
	local group g =(LoadGroupHandle(HY, h, 22))
	local real x = GetUnitX(dummyUnit)+ 25 * Cos(a)
	local real y = GetUnitY(dummyUnit)+ 25 * Sin(a)
	local group MLI = LoginGroup(337)
	local real GIX = GetDistanceBetween(x, y, x2, y2)
	if GIX <= 30 then
		set x = x2
		set y = y2
	endif
	call SetUnitX(dummyUnit, CoordinateX50(x))
	call SetUnitY(dummyUnit, CoordinateX50(y))
	set U2 = dummyUnit
	set DK = g
	set Q2 = level
	call GroupEnumUnitsInRange(MLI, x, y, 200, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	call ForGroup(MLI, function MJI)
	call LogoutGroup(MLI)
	if GIX <= 30 or GetTriggerEvalCount(t)> 125 then
		call LogoutGroup(g)
		call KillUnit(dummyUnit)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set dummyUnit = null
	set g = null
	set MLI = null
	return false
endfunction
function OYE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(WUE,'Z608')
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = Atan2(y -GetUnitY(WUE), x -GetUnitX(WUE))
	local unit dummyUnit
	if GetUnitTypeId(WUE)=='e00E' then
		if GetRandomInt(0, 1)== 1 then
			set a = a + GetRandomReal(0, bj_PI / 4)
		else
			set a = a -GetRandomReal(0, bj_PI / 4)
		endif
	endif
	set x = GetUnitX(WUE)
	set y = GetUnitY(WUE)
	set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'n01U', x, y, a * bj_RADTODEG)
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function MKI))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveReal(HY, h, 66,(x +(750 + 500. * level)* Cos(a)))
	call SaveReal(HY, h, 67,(y +(750 + 500. * level)* Sin(a)))
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h, 137,((a)* 1.))
	call SaveGroupHandle(HY, h, 22,(LoginGroup(338)))
	set t = null
	set WUE = null
	set dummyUnit = null
endfunction
function O_E takes nothing returns nothing
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(GetTriggerUnit(),'Z607')
	call AddAbilityToTimed(targetUnit,'A0VJ', level, 13, 0)
	call AddAbilityToTimed(targetUnit,'A109', level, 13, 0)
	set targetUnit = null
endfunction
function MMI takes unit WUE returns integer
	local integer level = GetUnitAbilityLevel(WUE,'Z606')+ 1
	if level == 1 then
		return'A230'
	elseif level == 2 then
		return'A22Z'
	elseif level == 3 then
		return'A22Y'
	elseif level == 4 then
		return'A22U'
	elseif level == 5 then
		return'A22V'
	elseif level == 6 then
		return'A22W'
	elseif level == 7 then
		return'A22X'
	endif
	return'A230'
endfunction
function MPI takes unit targetUnit returns nothing
	call UnitRemoveAbility(targetUnit,'A230')
	call UnitRemoveAbility(targetUnit,'A22Z')
	call UnitRemoveAbility(targetUnit,'A22Y')
	call UnitRemoveAbility(targetUnit,'A22U')
	call UnitRemoveAbility(targetUnit,'A22V')
	call UnitRemoveAbility(targetUnit,'A22W')
	call UnitRemoveAbility(targetUnit,'A22X')
	call UnitRemoveAbility(targetUnit,'B08Z')
endfunction
function MQI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real MSI =(LoadReal(HY,(GetHandleId(targetUnit)), 681))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or MSI <(GetGameTime()) then
		call MPI(targetUnit)
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function MTI takes nothing returns nothing
	local unit WUE = U2
	local unit targetUnit = GetEnumUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real MSI =(LoadReal(HY,(GetHandleId(targetUnit)), 681))
	if MSI <(GetGameTime()) then
		call UnitAddPermanentAbility(targetUnit, MMI(WUE))
	endif
	call SaveReal(HY,(GetHandleId(targetUnit)), 681,(((GetGameTime())+ 2)* 1.))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call TriggerRegisterTimerEvent(t, 2.01, false)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function MQI))
	set t = null
	set WUE = null
	set targetUnit = null
endfunction
function MUI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local real WYE =(LoadReal(HY, h, 6))
	local real WZE =(LoadReal(HY, h, 7))
	local real a =(LoadReal(HY, h, 137))
	local real MWI =(LoadReal(HY, h, 57))
	local real x
	local real y
	local integer i = 1
	local integer EVX = GetTriggerEvalCount(t)
	local group g
	if EVX * .1 > MWI then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set g = LoginGroup(339)
		set U2 = WUE
		loop
		exitwhen i > 7
			set x = WYE + 80 * i * Cos((a + 90)* bj_DEGTORAD)
			set y = WZE + 80 * i * Sin((a + 90)* bj_DEGTORAD)
			call GroupEnumUnitsInRange(g, x, y,'i', Condition(function DPX))
			call ForGroup(g, function MTI)
			set x = WYE + 80 * i * Cos((a -90)* bj_DEGTORAD)
			set y = WZE + 80 * i * Sin((a -90)* bj_DEGTORAD)
			call GroupEnumUnitsInRange(g, x, y,'i', Condition(function DPX))
			call ForGroup(g, function MTI)
			set i = i + 1
		endloop
		call LogoutGroup(g)
		set g = null
	endif
	set t = null
	set WUE = null
	return false
endfunction
function O0E takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local real a = GetUnitFacing(WUE)
	local integer i = 1
	local unit dummyUnit
	local real x
	local real y
	local real WYE = GetUnitX(WUE)+$E1* Cos(a * bj_DEGTORAD)
	local real WZE = GetUnitY(WUE)+$E1* Sin(a * bj_DEGTORAD)
	local integer level = GetUnitAbilityLevel(WUE,'Z606')
	local real MWI = 1.5 + 2 * level
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	if GetUnitTypeId(WUE)=='e00E' then
		set WUE = Player__Hero[GetPlayerId(GetOwningPlayer(WUE))]
		set a = GetRandomReal(0, 360)
		set WYE = GetUnitX(WUE)+$E1* Cos(a * bj_DEGTORAD)
		set WZE = GetUnitY(WUE)+$E1* Sin(a * bj_DEGTORAD)
	endif
	loop
	exitwhen i > 7
		set x = WYE + 80 * i * Cos((a + 90)* bj_DEGTORAD)
		set y = WZE + 80 * i * Sin((a + 90)* bj_DEGTORAD)
		set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'u00O', x, y, GetRandomReal(0, 360))
		call SetUnitAbilityLevel(dummyUnit,'A0XN', level)
		call SetUnitAnimation(dummyUnit, "birth")
		call QueueUnitAnimation(dummyUnit, "stand")
		call UnitApplyTimedLife(dummyUnit,'BTLF', MWI)
		set x = WYE + 80 * i * Cos((a -90)* bj_DEGTORAD)
		set y = WZE + 80 * i * Sin((a -90)* bj_DEGTORAD)
		set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'u00O', x, y, GetRandomReal(0, 360))
		call SetUnitAbilityLevel(dummyUnit,'A0XN', level)
		call SetUnitAnimation(dummyUnit, "birth")
		call QueueUnitAnimation(dummyUnit, "stand")
		call UnitApplyTimedLife(dummyUnit,'BTLF', MWI)
		set i = i + 1
	endloop
	call TriggerAddCondition(t, Condition(function MUI))
	call TriggerRegisterTimerEvent(t, .1, true)
	call SaveReal(HY, h, 6,((WYE)* 1.))
	call SaveReal(HY, h, 7,((WZE)* 1.))
	call SaveReal(HY, h, 137,((a)* 1.))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveReal(HY, h, 57,((MWI)* 1.))
	set dummyUnit = null
	set WUE = null
	set t = null
endfunction
function MYI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	if UnitAlive(u) then
		call UnitRemoveAbility(u,'QFZZ')
		if GetUnitAbilityLevel(u,'QFZZ')== 0 then
			call FlushChildHashtable(HY, GetHandleId(t))
			call DestroyTrigger(t)
		endif
	endif
	set t = null
	set u = null
	return false
endfunction
function MZI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local trigger tt
	if GetUnitAbilityLevel(triggerUnit,'B08X')== 0 then
		call S9E(GetOwningPlayer(triggerUnit),'Z605', true)
		call UnitRemoveAbility(triggerUnit,'QFZZ')
		if GetUnitAbilityLevel(triggerUnit,'QFZZ')> 0 then
			set tt = CreateTrigger()
			call TriggerRegisterTimerEvent(tt, 1, true)
			call TriggerAddCondition(tt, Condition(function MYI))
			call SaveUnitHandle(HY, GetHandleId(tt), 0, triggerUnit)
			set tt = null
		endif
		call KillUnit(dummyUnit)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SetUnitX(dummyUnit, GetUnitX(triggerUnit))
		call SetUnitY(dummyUnit, GetUnitY(triggerUnit))
	endif
	set t = null
	set dummyUnit = null
	set triggerUnit = null
	return false
endfunction
function SpellEffect__GhostWalk takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = GetTriggerUnit()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'e01V', GetUnitX(triggerUnit), GetUnitY(triggerUnit), 0)
	local integer level = GetUnitAbilityLevel(triggerUnit,'Z605')

	local real dataA = 0
	local real dataB = 0
	local real dataF = - 0.5 + ( 0.2 * level )
	local real dur = 100

	call UnitSpellEffectWindWalk(triggerUnit, dataA, dataB, dur, level, 'AW8X', 'B08X', 1, 0, dataF)

	call UnitAddPermanentAbility(dummyUnit,'QH50')
	call SetUnitAbilityLevel(dummyUnit,'QH50', level)
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function MZI))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call S9E(GetOwningPlayer(triggerUnit),'Z605', false)
	call UnitAddAbility(triggerUnit,'QFZZ')
	call SetUnitAbilityLevel(triggerUnit,'QFZZ', 1)
	set t = null
	set triggerUnit = null
	set dummyUnit = null
endfunction
function M_I takes unit WUE, unit targetUnit, integer level returns nothing
	local unit dummyUnit = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddPermanentAbility(dummyUnit,'A0VI')
	call IssueTargetOrderById(dummyUnit, 852095, targetUnit)
	if IsMagicImmuneUnit(targetUnit)== false then
		call UnitDamageTargetEx(WUE, targetUnit, 1, 25 + 5 * level)
	endif
	set dummyUnit = null
endfunction
function M0I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local integer level =(LoadInteger(HY, h, 5))
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if GetEventDamage()>$A and((LoadInteger(HY,(GetHandleId((t))),(4263)))== 1)== false and GetOwningPlayer(GetEventDamageSource())!= GetOwningPlayer(GetTriggerUnit()) and FK then
			call DisableTrigger(t)
			call M_I(WUE, targetUnit, level)
			call EnableTrigger(t)
			call EFX(t, 4263, .6)
		endif
	else
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	set WUE = null
	return false
endfunction
function O2E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(triggerUnit,'Z604')
	call TriggerRegisterTimerEvent(t, 2.5 + level * .5, false)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function M0I))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))
	call SaveInteger(HY, h, 5,(level))
	call SaveUnitHandle(HY, h, 2,(triggerUnit))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("Abilities\\Weapons\\SpiritOfVengeanceMissile\\SpiritOfVengeanceMissile.mdl", targetUnit, "overhead")))
	call M_I(triggerUnit, targetUnit, level)
	set t = null
	set triggerUnit = null
	set targetUnit = null
endfunction
function M1I takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='fRG1' or GetUnitTypeId(GetFilterUnit())=='fRG2' or GetUnitTypeId(GetFilterUnit())=='fRG3' or GetUnitTypeId(GetFilterUnit())=='fRG4' then
		call KillUnit(GetFilterUnit())
	endif
	return false
endfunction
function M2I takes player p returns nothing
	local group g = LoginGroup(340)
	call GroupEnumUnitsOfPlayer(g, p, Condition(function M1I))
	call LogoutGroup(g)
	set g = null
endfunction
function O4E takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit d
	local integer level = GetUnitAbilityLevel(WUE,'Z603')
	local integer LAR = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(WUE))],'A0A8')
	if GetUnitTypeId(WUE)!='e00E' then
		call M2I(GetOwningPlayer(WUE))
	endif
	set d = CreateUnit(GetOwningPlayer(WUE),'fRG0'+ level, GetUnitX(WUE), GetUnitY(WUE), GetUnitFacing(WUE))
	call SetUnitColor(d, GetPlayerColor(Sentinels[0]))
	call AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl", d, "chest")
	call UnitApplyTimedLife(d,'BTLF', 35)
	call SetUnitAbilityLevel(d,'A0VV', level)
	call L1I(d)
	if level > 1 and LAR > 0 then
		call UnitAddPermanentAbilitySetLevel(d,'A3J3', 1)
		call UnitAddPermanentAbilitySetLevel(d,'A3J4', 1)
		call UnitAddPermanentAbilitySetLevel(d,'A3J5', 1)
	endif
	call W1E(d)
	if level > 2 then
		set d = CreateUnit(GetOwningPlayer(WUE),'fRG0'+ level, GetUnitX(WUE), GetUnitY(WUE), GetUnitFacing(WUE))
		call SetUnitColor(d, GetPlayerColor(Sentinels[0]))
		call AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl", d, "chest")
		call UnitApplyTimedLife(d,'BTLF', 35)
		call SetUnitAbilityLevel(d,'A0VV', level)
		call L1I(d)
		call W1E(d)
		if LAR > 0 then
			call UnitAddPermanentAbilitySetLevel(d,'A3J3', 1)
			call UnitAddPermanentAbilitySetLevel(d,'A3J4', 1)
			call UnitAddPermanentAbilitySetLevel(d,'A3J5', 1)
		endif
	endif
	set WUE = null
	set d = null
endfunction
function M3I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local real IXX =(LoadReal(HY, h, 20))
	local effect FX =(LoadEffectHandle(HY, h, 32))
	local integer EVX = GetTriggerEvalCount(t)
	call UnitDamageTargetEx(WUE, targetUnit, 1, IXX)
	if GetUnitAbilityLevel(targetUnit,'A42R')== 0 or EVX == 3 then
		call SaveInteger(P, GetHandleId(targetUnit),'A42R', LoadInteger(P, GetHandleId(targetUnit),'A42R')-1)
		if LoadInteger(P, GetHandleId(targetUnit),'A42R')<= 0 then
			call UnitRemoveAbility(targetUnit,'A42R')
			call UnitRemoveAbility(targetUnit,'B0HI')
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call DestroyEffect(FX)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set FX = null
	return false
endfunction
function M4I takes unit WUE, unit targetUnit, real IXX, boolean M5I returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))
	call SaveReal(HY, h, 20,((IXX)* 1.))
	call SaveBoolean(HY, h, 0, M5I)
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("Environment\\SmallBuildingFire\\SmallBuildingFire2.mdl", targetUnit, "chest")))
	call TriggerRegisterTimerEvent(t, 1, true)
	call UnitAddPermanentAbility(targetUnit,'A42R')
	call SaveInteger(P, GetHandleId(targetUnit),'A42R', LoadInteger(P, GetHandleId(targetUnit),'A42R')+ 1)
	call TriggerAddCondition(t, Condition(function M3I))
	set t = null
endfunction
function M6I takes nothing returns nothing
	call M4I(U2, GetEnumUnit(), S2 / 5, X3)
	call UnitDamageTargetEx(U2, GetEnumUnit(), 1, S2)
endfunction
function M7I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local real a =(LoadReal(HY, h, 137))
	local integer level =(LoadInteger(HY, h, 5))
	local integer EVX = GetTriggerEvalCount(t)-26
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local real NBX
	local real NCX
	local unit dummyUnit
	local group g
	if EVX == 1 then
		set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e01L', x, y, a * bj_RADTODEG)
		call SaveUnitHandle(HY, h, 19,(dummyUnit))
	elseif EVX > 1 then
		set dummyUnit =(LoadUnitHandle(HY, h, 19))
	endif
	if EVX > 0 then
		set NBX = CoordinateX50(GetUnitX(dummyUnit)+$F* Cos(a))
		set NCX = CoordinateY50(GetUnitY(dummyUnit)+$F* Sin(a))
		call SetUnitX(dummyUnit, NBX)
		call SetUnitY(dummyUnit, NCX)
		if(EVX > 1 and ModuloInteger(EVX, 10)== 0) or EVX == 1 then
			set g = LoginGroup(341)
			set U2 = WUE
			set S2 = 40 + 20 * level
			call GroupEnumUnitsInRange(g, NBX, NCX, 300, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
			set X3 = EVX > LoadInteger(HY, h, 7)
			call ForGroup(g, function M6I)
			call LogoutGroup(g)
			call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", NBX, NCX))
		endif
		if EVX > LoadInteger(HY, h, 7) then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call KillUnit(dummyUnit)
		endif
	endif
	set t = null
	set g = null
	set dummyUnit = null
	set WUE = null
	return false
endfunction
function O5E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = Atan2(y -GetUnitY(WUE), x -GetUnitX(WUE))
	local unit M8I = CreateUnit(GetOwningPlayer(WUE),'e01K', x, y, a * bj_RADTODEG)
	local integer level = GetUnitAbilityLevel(WUE,'Z602')
	call SetUnitTimeScale(M8I, .58)
	call UnitApplyTimedLife(M8I,'BTLF', 1.75)
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function M7I))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call SaveReal(HY, h, 137,((a)* 1.))
	call SaveInteger(HY, h, 5, level)
	call SaveInteger(HY, h, 7, R2I((350 +$C8* level)/ 16.6))
	set t = null
	set WUE = null
	set M8I = null
endfunction
function M9I takes nothing returns nothing
	call UnitDamageTargetEx(U2, GetEnumUnit(), 3, S2)
endfunction
function PVI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local real IXX =(LoadReal(HY, h, 20))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local group g = LoginGroup(342)
	local integer EVX
	set U2 = triggerUnit
	call A8X(GetOwningPlayer(triggerUnit), 4, x, y, 400)
	call GroupEnumUnitsInRange(g, x, y, 200, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	set EVX = CountUnitsInGroup(g)
	if EVX > 0 then
		set S2 = IXX / EVX
		call ForGroup(g, function M9I)
	endif
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", x, y))
	call LogoutGroup(g)
	call DestroyEffect((LoadEffectHandle(HY, h, 32)))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set triggerUnit = null
	set g = null
	return false
endfunction
function O6E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real IXX = 100 + 75 * GetUnitAbilityLevel(triggerUnit,'Z601')
	local string s = ""
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(triggerUnit)) or(IsObserver) then
		set s = "war3mapImported\\SunStrike.mdx"
	endif
	call A8X(GetOwningPlayer(triggerUnit), 5.7, x, y, 400)
	call TriggerRegisterTimerEvent(t, 1.7, false)
	call TriggerAddCondition(t, Condition(function PVI))
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call SaveReal(HY, h, 20,((IXX)* 1.))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffect(s, x, y)))
	set t = null
	set triggerUnit = null
endfunction
function PEI takes nothing returns boolean
	local unit t = GetFilterUnit()
	local integer ZCE = 0
	local integer h = GetHandleId(t)
	local integer ETX =$54273
	local boolean b = false
	if IsUnitAlly(t, EG) and GetUnitAbilityLevel(t,'A04R')== 0 and UnitAlive(t) then
		if LoadBoolean(HY, h, ETX) then
			set ZCE = LoadInteger(HY, h, ETX)
			set b = true
		endif
		if IsUnitIdType(GetUnitTypeId(t), UNIT_TYPE_HERO) then
			if IsUnitType(t, UNIT_TYPE_RANGED_ATTACKER)== IsUnitType(VG, UNIT_TYPE_RANGED_ATTACKER) and IsUnitType(t, UNIT_TYPE_MELEE_ATTACKER)== IsUnitType(VG, UNIT_TYPE_MELEE_ATTACKER) then
				if b or GetUnitAbilityLevel(t,'D006')> 0 then
					if OG then
						if ZCE != XG then
							call LodSystem_ReduceUnitExtraState(t, ZCE, STATE_SYSTEM_DAMAGE)
							call SaveInteger(HY, h, ETX, XG)
							call LodSystem_AddUnitExtraState(t, XG, STATE_SYSTEM_DAMAGE)
						endif
					else
						call WHV(t,'D006')
						call LodSystem_ReduceUnitExtraState(t, ZCE, STATE_SYSTEM_DAMAGE)
						call SaveInteger(HY, h, ETX, 0)
						call SaveBoolean(HY, h, ETX, false)
					endif
				else
					if OG then
						call SaveInteger(HY, h, ETX, XG)
						call SaveBoolean(HY, h, ETX, true)
						call LodSystem_AddUnitExtraState(t, XG, STATE_SYSTEM_DAMAGE)
						call WJV(t,'C006','D006',-1)
					endif
				endif
			else
				if b then
					call LodSystem_ReduceUnitExtraState(t, ZCE, STATE_SYSTEM_DAMAGE)
					call SaveInteger(HY, h, ETX, 0)
					call SaveBoolean(HY, h, ETX, false)
					call WHV(t,'D006')
				endif
			endif
		else
			if IsUnitType(t, UNIT_TYPE_RANGED_ATTACKER) and IsUnitType(t, UNIT_TYPE_STRUCTURE)== false then
				if b then
					if OG and LoadInteger(HY, GetHandleId(VG),$54274)== 1 then
						if ZCE != XG then
							call SaveInteger(HY, h, ETX, XG)
							call LodSystem_ReduceUnitExtraState(t, ZCE, STATE_SYSTEM_DAMAGE)
							call LodSystem_AddUnitExtraState(t, XG, STATE_SYSTEM_DAMAGE)
						endif
					else
						call WHV(t,'D006')
						call LodSystem_ReduceUnitExtraState(t, ZCE, STATE_SYSTEM_DAMAGE)
						call SaveInteger(HY, h, ETX, 0)
						call SaveBoolean(HY, h, ETX, false)
					endif
				else
					if OG and LoadInteger(HY, GetHandleId(VG),$54274)== 1 then
						call SaveInteger(HY, h, ETX, XG)
						call SaveBoolean(HY, h, ETX, true)
						call LodSystem_AddUnitExtraState(t, XG, STATE_SYSTEM_DAMAGE)
						call WJV(t,'C006','D006',-1)
					endif
				endif
			endif
		endif
	endif
	set t = null
	return false
endfunction
function PXI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer level = GetUnitAbilityLevel(u,'A2O2')
	local real DRO = E3X(u)* 1.
	local integer ZCE = R2I(($C+ 6 * level)* DRO / 100.)
	local boolean POI = LoadBoolean(HY, h, 10) and LoadInteger(HY,(GetHandleId(u)), 704)!='A2O2'
	local player p = LoadPlayerHandle(HY, h, 10)
	local boolean PRI
	set VG = u
	set EG = GetOwningPlayer(u)
	set XG = ZCE
	set OG = true
	set PRI = p != EG
	if UnitIsDead(u) or u == null or GetUnitTypeId(u)< 1 or POI or PRI or GetUnitAbilityLevel(u,'A36D')== 1 then
		set XG = 0
		set OG = false
	endif
	if PRI then
		set EG = p
	endif
	call GroupEnumUnitsInRange(YF, 0, 0,$2EE0, Condition(function PEI))
	if PRI then
		call SavePlayerHandle(HY, h, 10, GetOwningPlayer(u))
	endif
	if POI then
		call RemoveSavedHandle(HY, GetHandleId(u),'TSHT')
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	endif
	set t = null
	set u = null
endfunction
function PII takes unit u returns nothing
	local timer t = null
	local integer h
	if HaveSavedHandle(HY, GetHandleId(u),'TSHT')== false then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, .5, true, function PXI)
		call SaveUnitHandle(HY, h, 0, u)
		call SaveTimerHandle(HY, GetHandleId(u),'TSHT', t)
		call SaveBoolean(HY, h, 10, LoadInteger(HY,(GetHandleId(u)), 704)=='A2O2')
		call SavePlayerHandle(HY, h, 10, GetOwningPlayer(u))
		set t = null
	endif
endfunction
function L4E takes nothing returns nothing
	call PII(GetTriggerUnit())
endfunction
function PAI takes nothing returns nothing
	call PII(U2)
endfunction
function F0E takes nothing returns nothing
	call EPX(GetTriggerUnit(),$54274, 30)
endfunction
function PNI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 2)
	local unit WLE = LoadUnitHandle(HY, h, 17)
	local real radian = LoadReal(HY, h, 13)
	local real distance = LoadReal(HY, h, 138)
	local real O3O = LoadInteger(HY, h, 0)
	local real PBI = distance / O3O
	local real M8R
	local real M9R
	local integer c = GetTriggerEvalCount(t)
	if c > O3O or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call KillDestructablesInCircle(GetUnitX(WLE), GetUnitY(WLE), 100)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set M8R = CoordinateX50(GetUnitX(WLE)+ PBI * Cos(radian))
		set M9R = CoordinateY50(GetUnitY(WLE)+ PBI * Sin(radian))
		call SetUnitX(WLE, M8R)
		call SetUnitY(WLE, M9R)
	endif
	set t = null
	set WJE = null
	set WLE = null
	return false
endfunction
function PCI takes unit W_V, unit WLE, unit WJE, real x, real y returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real radian = Atan2(GetUnitY(WLE)-GetUnitY(W_V), GetUnitX(WLE)-GetUnitX(W_V))
	local real distance = GetDistanceBetween(x, y, GetUnitX(WLE), GetUnitY(WLE))
	local real PDI = RMaxBJ(1, 350 *(1 -distance / 900))
	call SaveUnitHandle(HY, h, 2, WJE)
	call SaveUnitHandle(HY, h, 17, WLE)
	call SaveReal(HY, h, 13,(radian * 1.))
	call SaveReal(HY, h, 138,(PDI * 1.))
	call SaveInteger(HY, h, 0, 25 + 5 * GetUnitUserData(W_V))
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, WLE)
	call TriggerAddCondition(t, Condition(function PNI))
	set t = null
endfunction
function PFI takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), RN)== false and GetEnumUnit()!= RoShan then
		call GroupAddUnit(RN, GetEnumUnit())
		call PCI(U2, GetEnumUnit(), EN, XN, ON)
	endif
endfunction
function PGI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 2)
	local unit W_V = LoadUnitHandle(HY, h, 19)
	local real radian = LoadReal(HY, h, 137)
	local real PXR = LoadReal(HY, h, 64)
	local real POR = LoadReal(HY, h, 65)
	local real PRR = LoadReal(HY, h, 66)
	local real PIR = LoadReal(HY, h, 67)
	local group g = LoadGroupHandle(HY, h, 22)
	local real PHI = GetUnitX(W_V)
	local real PJI = GetUnitY(W_V)
	local group gg
	local unit PKI = LoadUnitHandle(HY, h, 0)
	if GetDistanceBetween(PHI, PJI, PRR, PIR)< 100  then
		set PHI = PRR
		set PJI = PIR
	else
		set PHI = PHI + 40 * Cos(radian)
		set PJI = PJI + 40 * Sin(radian)
	endif
	set PHI = CoordinateX50(PHI)
	set PJI = CoordinateY50(PJI)
	call SetUnitX(W_V, PHI)
	call SetUnitY(W_V, PJI)
	call SetUnitX(PKI, PHI)
	call SetUnitY(PKI, PJI)
	if ModuloInteger(GetTriggerEvalCount(t), 2)== 1 and GetTriggerEvalCount(t)< 20 then
		call IssuePointOrderById(PKI,$D0270, PHI, PJI)
	endif
	set gg = LoginGroup(343)
	set U2 = W_V
	set EN = WJE
	set XN = PXR
	set ON = POR
	set RN = g
	call GroupEnumUnitsInRange(gg, PHI, PJI, 275, Condition(function DJX))
	call ForGroup(gg, function PFI)
	call LogoutGroup(gg)
	if(PHI == PRR and PJI == PIR) or GetTriggerEvalCount(t)> 35 then
		set gg = LoginGroup(344)
		set U2 = W_V
		set EN = WJE
		set XN = PXR
		set ON = POR
		set RN = g
		call GroupEnumUnitsInRange(gg, PHI, PJI, 275, Condition(function DJX))
		call ForGroup(gg, function PFI)
		call LogoutGroup(gg)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(W_V)
		call LogoutGroup(g)
	endif
	set PKI = null
	set t = null
	set W_V = null
	set g = null
	set gg = null
	set WJE = null
	return false
endfunction
function O7E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local location l = GetSpellTargetLoc()
	local unit u = GetTriggerUnit()
	local real x = GetLocationX(l)
	local real y = GetLocationY(l)
	local real radian = Atan2(y -GetUnitY(u), x -GetUnitX(u))
	local unit d = CreateUnit(GetOwningPlayer(u),'h02J', GetUnitX(u), GetUnitY(u), radian * bj_RADTODEG)
	local unit PKI = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call UnitAddAbility(PKI,'A0QB')
	call SetUnitAbilityLevel(PKI,'A0QB', GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function PGI))
	call SaveUnitHandle(HY, h, 2, u)
	call SaveUnitHandle(HY, h, 19, d)
	call SetUnitUserData(d, GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call SaveUnitHandle(HY, h, 0, PKI)
	call SaveReal(HY, h, 137,(radian * 1.))
	call SaveReal(HY, h, 64, GetUnitX(u))
	call SaveReal(HY, h, 65, GetUnitY(u))
	call SaveReal(HY, h, 66, GetUnitX(u)+ 900 * Cos(radian))
	call SaveReal(HY, h, 67, GetUnitY(u)+ 900 * Sin(radian))
	call SaveGroupHandle(HY, h, 22, LoginGroup(345))
	call RemoveLocation(l)
	set t = null
	set PKI = null
	set l = null
	set d = null
	set u = null
endfunction
function PLI takes nothing returns nothing
	local unit t = GetFilterUnit()
	local unit u = Temp__ArrayUnit[0]
	if OK and IsUnitType(t, UNIT_TYPE_HERO) and IsUnitEnemy(u, GetOwningPlayer(t)) and IsAliveNotStrucNotWard(GetFilterUnit()) then
		set OK = false
	endif
	set t = null
	set u = null
endfunction
function PMI takes nothing returns nothing
	local integer level
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer id ='A0VC'
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetHandleId(u)> 0 then
		set Temp__ArrayUnit[0]= u
		set OK = true
		if LoadBoolean(HY, h, 0)== false then
			if GetUnitAbilityLevel(u, id)< GetUnitAbilityLevel(u,'QF88') then
				call SetUnitAbilityLevel(u, id, GetUnitAbilityLevel(u,'QF88'))
			endif
		endif
		call GroupEnumUnitsInRange(AK, GetWidgetX(u), GetWidgetY(u), 400 + 25, Condition(function PLI))
		if OK and GetUnitAbilityLevel(u,'A36D')== 0 then
			call SaveInteger(HY, h, 1, 0)
			if LoadBoolean(HY, h, 0) then
				set level = LoadInteger(HY, h, 0)
			else
				set level = GetUnitAbilityLevel(u,'QF88')
			endif
			if GetUnitAbilityLevel(u,'A2NX')!= level then
				call UnitAddPermanentAbility(u,'A2NX')
				call UnitAddPermanentAbility(u,'A3B6')
				call SetUnitAbilityLevel(u,'A2NX', level)
				if GetHeroPrimaryAttributesType(u)!= 3 then

					call UnitAddPermanentAbility(u,'A33L')
					call SetUnitAbilityLevel(u,'A33L', level)
				endif
			endif
			set u = null
			set t = null
			return
		elseif OK == false then
			call SaveInteger(HY, h, 1, LoadInteger(HY, h, 1)+ 1)
			if IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER) and LoadInteger(HY, h, 1)< 40 then
				set u = null
				set t = null
				return
			endif
		endif
		call UnitRemoveAbility(u,'A2NX')
		call UnitRemoveAbility(u,'A33L')
		call UnitRemoveAbility(u,'A3B6')
	else
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	endif
	set u = null
	set t = null
endfunction

function Q_A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetGameTime()> LoadReal(HY, h, 0) or GetUnitAbilityLevel(u,'B0DM')== 0 then
		call UnitRemoveAbility(u,'A2OV')
		call UnitRemoveAbility(u,'A2OU')
		call UnitRemoveAbility(u,'B0DM')
		call RemoveSavedHandle(HY, GetHandleId(u),'A2OV')
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	else
		call UnitDamageTargetEx(LoadUnitHandle(HY, h, 1), u, 1, 4)
	endif
	set u = null
	set t = null
endfunction
function Q0A takes unit u, unit sou, boolean b returns nothing
	local timer t = LoadTimerHandle(HY, GetHandleId(u),'A2OV')
	local integer h
	local integer id
	if b then
		set id = 'A2OV'
	else
		set id = 'A2OU'
	endif
	if t != null then
		set h = GetHandleId(t)
		if b != LoadBoolean(HY, h, 1) then
			call UnitRemoveAbility(u,'A2OV')
			call UnitRemoveAbility(u,'A2OU')
			call UnitRemoveAbility(u,'B0DM')
			call UnitAddPermanentAbility(u, id)
		endif
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, 1., true, function Q_A)
		call UnitAddPermanentAbility(u, id)
		call SaveUnitHandle(HY, h, 0, u)
		call SaveUnitHandle(HY, h, 1, sou)
		call SaveTimerHandle(HY, GetHandleId(u),'A2OV', t)
	endif
	call SaveBoolean(HY, h, 1, b)
	call SaveReal(HY, h, 0, GetGameTime()+ 4.)
	set t = null
endfunction

function EyeOfSkadiLoop takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	if GetGameTime()> LoadReal(HY, h, 0) or GetUnitAbilityLevel(LoadUnitHandle(HY, h, 0),'A40W')== 0 then
		call ResetUnitVertexColor(LoadUnitHandle(HY, h, 0))
		call UnitRemoveAbility(LoadUnitHandle(HY, h, 0),'A40W')
		call UnitRemoveAbility(LoadUnitHandle(HY, h, 0),'B0HF')
		call RemoveSavedHandle(HY, GetHandleId(LoadUnitHandle(HY, h, 0)),'A40W')
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	endif
	set t = null
endfunction
function EyeOfSkadiActions takes unit u, boolean ZOO returns nothing
	local timer t = LoadTimerHandle(HY, GetHandleId(u),'A40W')
	local integer h
	if t != null then
		set h = GetHandleId(t)
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, .1, true, function EyeOfSkadiLoop)
		call UnitAddPermanentAbility(u,'A40W')
		call SaveUnitHandle(HY, h, 0, u)
		call SaveTimerHandle(HY, GetHandleId(u),'A40W', t)
	endif
	if ZOO then
		call SaveReal(HY, h, 0, GetGameTime()+ 5)
	else
		call SaveReal(HY, h, 0, GetGameTime()+ 2.5)
	endif
	call SetUnitFrostVertexColor(u)
	set t = null
endfunction

function M2R takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit sourceUnit = (LoadUnitHandle(HY,(h), 2))
	local unit targetUnit = (LoadUnitHandle(HY,(h), 17))
	local integer sourceH = GetHandleId(sourceUnit)
	local integer targetH = GetHandleId(targetUnit)
	local real r = (LoadReal(HY, h, 0))
	if LoadBoolean(HY, h, 0) then
		call UnitDamageTargetEx(sourceUnit, targetUnit, 1, 0)
	else
		call UnitDamageTargetEx(sourceUnit, targetUnit, 1, 20)
	endif
	if (GetGameTime())>= r or not UnitAlive(targetUnit) then
		call RemoveSavedHandle(ExtraHT, targetH, sourceH + 'A0O4')
		call SaveInteger(ExtraHT, targetH, 'A0O4', LoadInteger(ExtraHT, targetH, 'A0O4') - 1)
	
		if LoadInteger(ExtraHT, sourceH, 'A0O4') == 0 then
			call UnitRemoveAbility(targetUnit,'A0O4')
			call UnitRemoveAbility(targetUnit,'B0O4')
			call RemoveSavedInteger(ExtraHT, targetH, 'A0O4')
		endif

		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set sourceUnit = null
	set targetUnit = null
	return false
endfunction

// 腐蚀吐息 'A0O4'
function CorrosiveBreath takes unit sourceUnit, unit targetUnit, boolean isIllusion returns nothing
	local integer sourceH = GetHandleId(sourceUnit)
	local integer targetH = GetHandleId(targetUnit)
	local trigger t = LoadTriggerHandle(ExtraHT, targetH, sourceH + 'A0O4')
	local integer h
	if t == null then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function M2R))
		call SaveUnitHandle(HY,(h), 2,(sourceUnit))
		call SaveUnitHandle(HY,(h), 17,(targetUnit))
		call SaveBoolean(HY, h, 0, isIllusion)
		
		call SaveTriggerHandle(ExtraHT, targetH, sourceH + 'A0O4', t)
		// 计数自增
		call SaveInteger(ExtraHT, targetH, 'A0O4', LoadInteger(ExtraHT, targetH, 'A0O4') + 1)
		if GetUnitAbilityLevel(targetUnit,'A0O4') <=0 then
			call UnitAddPermanentAbility(targetUnit,'A0O4')
		endif
	else
		set h = GetHandleId(t)
	endif
	call SaveReal(HY, h, 0, (GetGameTime()+ 5.)* 1. )
	set t = null
endfunction

function FrostBreathLoop takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	if GetGameTime()> LoadReal(HY, h, 0) or GetUnitAbilityLevel(LoadUnitHandle(HY, h, 0),'Adfb')== 0 then
		call ResetUnitVertexColor(LoadUnitHandle(HY, h, 0))
		call UnitRemoveAbility(LoadUnitHandle(HY, h, 0),'Adfb')
		call UnitRemoveAbility(LoadUnitHandle(HY, h, 0),'Bdfb')
		call RemoveSavedHandle(HY, GetHandleId(LoadUnitHandle(HY, h, 0)),'Adfb')
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	endif
	set t = null
endfunction
function FrostBreathActions takes unit u returns nothing
	local timer t = LoadTimerHandle(HY, GetHandleId(u),'Adfb')
	local integer h
	if t != null then
		set h = GetHandleId(t)
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, .1, true, function FrostBreathLoop)
		call UnitAddPermanentAbility(u,'Adfb')
		call SaveUnitHandle(HY, h, 0, u)
		call SaveTimerHandle(HY, GetHandleId(u),'Adfb', t)
	endif
	call SaveReal(HY, h, 0, GetGameTime()+ 3)
	call SetUnitFrostVertexColor(u)
	set t = null
endfunction

function TGA takes unit whichUnit, unit targetUnit, integer i returns nothing
	if i == 1 then
		call UnitDamageTargetEx(whichUnit, targetUnit, 2, 40 + 20 * GetUnitAbilityLevel(whichUnit,'A0JJ'))
		call CommonUnitAddStun(targetUnit, 1., true)
	elseif i == 2 then
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 30 + 10 * GetUnitAbilityLevel(whichUnit,'A081'))
	
	elseif i == 3 then
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 10 + 10 * GetUnitAbilityLevel(whichUnit,'A09E'))
		call CommonUnitAddStun(targetUnit, .4 + .4 * GetUnitAbilityLevel(whichUnit,'A09E'), true)
	elseif i == 4 then

	elseif i == 5 then
		call UnitDamageTargetEx(whichUnit, targetUnit, 1, 100)
		call CommonUnitAddStun(targetUnit, 0.01, true)
	elseif i == 6 then

	endif
endfunction

function TraverseOrbEffect takes unit u, unit t returns nothing
	
endfunction


function MarksmanshipActions takes nothing returns nothing
	local unit target = W2
	local integer h = GetHandleId(GetTriggeringTrigger())
	call UnitDamageTargetEx(LoadUnitHandle(HY, h,'xhts'), target, 2, LoadReal(HY, h,'xhts'))
	//call TraverseOrbEffect(LoadUnitHandle(HY, h,'xhts'), target)
	set target = null
endfunction

function Marksmanship_tsw takes unit u, unit u2, unit target, real damage returns nothing
	local trigger t = NHX(u2, target,'h30C', "MarksmanshipActions", 900, true)
	local integer h = GetHandleId(t)
	
	call SaveReal(HY, h,'xhts', damage)
	call SaveUnitHandle(HY, h,'xhts', u)
	set t = null
endfunction

function MarksmanshipEnumTarget takes nothing returns boolean
	return(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()) and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) ) != null
endfunction

function MarksmanshipEnum takes unit u, unit target returns nothing
	local unit fu
	local group g = LoginGroup(346) 
	local real damage
	local integer i = 1
	set U2 = u
	call GroupEnumUnitsInRange(g, GetUnitX(target), GetUnitY(target), 475, Condition(function MarksmanshipEnumTarget))
	set damage = (GetUnitState(u, UNIT_STATE_ATTACK1_DAMAGE_BASE) + GetUnitState(u, UNIT_STATE_ATTACK1_DAMAGE_BONUS) )* 0.5
	
	loop
		set fu = GroupPickRandomUnit(g)
	exitwhen(fu == null or i > 3)
		if target != fu then
			call Marksmanship_tsw(u, target, fu, damage)
			
			set i = i + 1
		endif
		call GroupRemoveUnit(g, fu)
	endloop
	call LogoutGroup(g)
	set fu = null
	set g = null
endfunction

function MarksmanshipAttackEffect takes nothing returns nothing
	if not DESourceIsBreak[DEI] and GetUnitAbilityLevel(DESourceUnit[DEI],'S3UR')> 0 and DEIsEnemy[DEI] then
		call MarksmanshipEnum(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction

function L5E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local timer t = CreateTimer()
	local integer id ='A0VC'

	call RegisterUnitAttackEvent("MarksmanshipAttackEffect", 0)
	
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveBoolean(HY, GetHandleId(u),$422CB5, false)
	call TimerStart(t, .1, true, function PMI)
	set t = null
	set u = null
endfunction

function PPI takes unit u, integer level returns nothing
	local timer t = CreateTimer()
	local integer TME = GetPlayerId(GetOwningPlayer(u))
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call TimerStart(t, .1, true, function PMI)
	call SaveInteger(HY, GetHandleId(t), 0, level)
	call SaveBoolean(HY, GetHandleId(t), 0, true)
	set t = null
endfunction
// 同步幻象的射手天赋技能
function SyncIllusionUnitMarksmanship takes nothing returns nothing
	local unit illusionUnit = Temp__ArrayUnit[2]
	local unit summoningUnit = Temp__ArrayUnit[3]
	if GetUnitAbilityLevel(summoningUnit,'A0VC')> 0 then
		call PPI(illusionUnit, GetUnitAbilityLevel(summoningUnit,'A0VC'))
	endif
	set illusionUnit = null
	set summoningUnit = null
endfunction
function PTI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 5)
	local real IXX
	if level == 1 then
		set IXX =$F
	elseif level == 2 then
		set IXX = 30
	elseif level == 3 then
		set IXX = 40
	elseif level == 4 then
		set IXX = 50
	endif
	if GetTriggerEvalCount(t)== 3 or GetTriggerEvalCount(t)== 4 then
		call UnitDamageTargetEx(WUE, targetUnit, 1, IXX)
	endif
	if GetTriggerEvalCount(t)== 4 then
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call UnitRemoveAbility(targetUnit,'A1VS')
		call UnitRemoveAbility(targetUnit,'B0DN')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function PUI takes unit IZX, unit WLE, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function PTI))
	call SaveUnitHandle(HY, h, 2, IZX)
	call SaveUnitHandle(HY, h, 17, WLE)
	call SaveInteger(HY, h, 5, level)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl", WLE, "chest"))
	call S9E(GetOwningPlayer(WLE),'A1VS', false)
	call UnitAddPermanentAbility(WLE,'A1VS')
	set t = null
endfunction
function PWI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if GetEventDamageSource()== LoadUnitHandle(HY, h, 0) then
			if GetUnitAbilityLevel(GetTriggerUnit(),'A3E9')== 1 and IsMagicImmuneUnit(LoadUnitHandle(HY, h, 1))== false and LoadBoolean(HY, h, 0)== false then
				call SaveUnitHandle(VV,'A3E9', 0, GetTriggerUnit())
				call SaveUnitHandle(VV,'A3E9', 1, LoadUnitHandle(HY, h, 1))
				call SaveInteger(VV,'A3E9', 0, R2I(LoadReal(HY, h, 0)))
				call ExecuteFunc("PYI")
			endif
			call CommonUnitAddStun(GetTriggerUnit(), 2., false)
			call UnitDamageTargetEx(LoadUnitHandle(HY, h, 1), GetTriggerUnit(), 1, 50 * LoadReal(HY, h, 0))
			call PUI(LoadUnitHandle(HY, h, 1), GetTriggerUnit(), R2I(LoadReal(HY, h, 0)))
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	endif
	set t = null
endfunction
function PZI takes unit WJE, unit WLE, integer level, boolean FAR returns nothing
	local trigger t
	local integer h
	local unit d = CreateUnit(GetOwningPlayer(WJE),'e00E', GetUnitX(WJE), GetUnitY(WJE), 0)
	call UnitAddAbility(d,'A42G')
	call B0R(d, WLE,$D007F)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 5, false)
	call TriggerRegisterUnitEvent(t, WLE, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function PWI))
	call SaveUnitHandle(HY, h, 0, d)
	call SaveUnitHandle(HY, h, 1, WJE)
	call SaveReal(HY, h, 0, level)
	call SaveBoolean(HY, h, 0, FAR)
	set t = null
	set d = null
endfunction
function O8E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call PZI(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()), false)
	endif
endfunction
function PYI takes nothing returns nothing
	local unit WJE = LoadUnitHandle(VV,'A3E9', 0)
	local unit WLE = LoadUnitHandle(VV,'A3E9', 1)
	local integer level = LoadInteger(VV,'A3E9', 0)
	call T4V(LoadUnitHandle(VV,'A3E9', 0))
	if UnitHasSpellShield(WLE)== false then
		call PZI(WJE, WLE, level, true)
	endif
	set WJE = null
	set WLE = null
	call FlushChildHashtable(VV,'A3E9')
endfunction
function P_I takes nothing returns boolean
	return IsPrimalTypeId(GetUnitTypeId(GetFilterUnit()))
endfunction

function P0I takes unit SYX, unit u returns nothing
	local group g = LoginGroup(347)
	local unit u2
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(u), Condition(function P_I))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call UnitRemoveAbility(u2,'Avul')
		if IsUnitType(u2, UNIT_TYPE_SUMMONED)== false then
			call UnitRemoveBuffs(u2, true, true)
		endif
		call UnitRemoveAbility(u2,'Aetl')
		call SetUnitInvulnerable(u2, false)
		call UnitDamageTargetEx(SYX, u2, 1, 99999999)
		call UnitDamageTargetEx(SYX, u2, 2, 99999999)
		call UnitDamageTargetEx(SYX, u2, 3, 99999999)
		call UnitDamageTargetEx(SYX, u2, 7, 99999999)
		call UnitDamageTargetEx(SYX, u2, 10, 99999999)
		call GroupRemoveUnit(g, u2)
	endloop
	call LogoutGroup(g)
	set u2 = null
	set g = null
endfunction

function K6E takes nothing returns nothing
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIfb\\AIfbSpecialArt.mdl", GetTriggerUnit(), T2V(GetTriggerUnit())))
endfunction

function AhalimReincarnation_Actions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		if GetUnitAbilityLevel(u,'A3DA')== 1 then
			call UnitRemoveAbility(u,'A3DA')
			call UnitRemoveAbility(u,'B3DA')
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call ResetUnitVertexColor(u)
			call BZR(u)
		elseif GetUnitAbilityLevel(u,'A3D9')== 1 then
			// 如果有盾或者自杀就倒闭
			if LoadBoolean(HY, GetHandleId(u),'suic') or GetUnitAbilityLevel(u,'AIrc')== 1 then
				call UnitRemoveAbility(u,'A3DK')
				call UnitRemoveAbility(u,'B3I9')
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			else
				// 正常死亡 0 0.1 4 秒计时器
				call TriggerRegisterTimerEvent(t, 0, false)
				call TriggerRegisterTimerEvent(t, .1, false)
				call TriggerRegisterTimerEvent(t, 4, false)
				call SaveUnitHandle(HY, h, 0, u)
				call SaveReal(HY, h, 10, GetUnitState(u, UNIT_STATE_MANA))
			endif
		else
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
		call RemoveSavedHandle(HY, GetHandleId(u),'Leor')
	else
		//============================================
		// 计时器到期事件	
		set u = LoadUnitHandle(HY, h, 0)
		if LoadInteger(HY, h, 0) == 0 then // 0秒 复活了
			call UnitRemoveAbility(u,'A3DK')
			call UnitRemoveAbility(u,'B3I9')
			call UnitAddPermanentAbility(u,'A3DA')
			call SaveInteger(HY, h, 0, 1)
			call SetUnitVertexColor(u, 140, 120, 100, 70)
			call DisableUnitBloodstone(u)
			if LoadInteger(HY, GetHandleId(u), 4333)== 1 then
				call EPX(u, 4334, 4.01)
			endif
			if LoadInteger(HY, GetHandleId(u), 4418)== 1 then
				call EPX(u, 4419, 4.01)
			endif
		elseif LoadInteger(HY, h, 0)== 1 then
			call SaveInteger(HY, h, 0, 2)
			call SelectUnitAddForPlayer(u, GetOwningPlayer(u))
			call SetUnitState(u, UNIT_STATE_MANA, LoadReal(HY, h, 10))
		else
			call UnitRemoveAbility(u,'A3DA')
			call UnitRemoveAbility(u,'B3DA')
			call ResetUnitVertexColor(u)
			call UnitRemoveAbility(u,'Avul')
			call SetUnitInvulnerable(u, false)
			if not IsUnitType(u, UNIT_TYPE_SUMMONED) then
				call UnitRemoveBuffs(u, true, true)
			endif
			call UnitRemoveAbility(u,'Aetl')
			call SetWidgetLife(u, 1)
			if LoadUnitHandle(HY, GetHandleId(u),'lstd')!= null then
				call UnitDamageTargetEx(LoadUnitHandle(HY, GetHandleId(u),'lstd'), u, 1, 99999999)
				call UnitDamageTargetEx(LoadUnitHandle(HY, GetHandleId(u),'lstd'), u, 2, 99999999)
				call UnitDamageTargetEx(LoadUnitHandle(HY, GetHandleId(u),'lstd'), u, 3, 99999999)
				call UnitDamageTargetEx(LoadUnitHandle(HY, GetHandleId(u),'lstd'), u, 7, 99999999)
				call UnitDamageTargetEx(LoadUnitHandle(HY, GetHandleId(u),'lstd'), u, 10, 99999999)
				if UnitAlive(u) then
					if GetHandleId(LoadUnitHandle(HY, GetHandleId(u),'lstd'))== 0 then
						call KillUnit(u)
					else
						if GetUnitAbilityLevel(u,'A0MQ')> 0 or GetUnitAbilityLevel(u,'A1B6')> 0 then
							call P0I(LoadUnitHandle(HY, GetHandleId(u),'lstd'), u)
						endif
					endif
				endif
			else
				call KillUnit(u)
			endif
			call BZR(u)
			if not UnitAlive(u) then
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			else
				call TriggerRegisterTimerEvent(t, .02, true)
			endif
		endif
	endif
	set t = null
	set u = null
	return false
endfunction

// 给单位添加效果
function register_AhalimReincarnation takes unit whichUnit returns nothing
	local trigger t
	local integer h
	local integer hu = GetHandleId(whichUnit)
	if not HaveSavedHandle(HY, hu,'Leor') and GetUnitAbilityLevel(whichUnit,'A3DA')== 0 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, hu,'Leor', t)
		call TriggerRegisterDeathEvent(t, whichUnit)
		call TriggerAddCondition(t, Condition(function AhalimReincarnation_Actions))
	endif
	set t = null
endfunction
// 绿翔光环 0.3秒粘滞时间
function EnumAddBuff_Reincarnation takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit skeletonKing = LoadUnitHandle(HY, h, 0)
	local group auraGroup = LoadGroupHandle(HY, h, 1)
	local group enumGroup
	local unit firstUnit
	// 单位死亡并且在重生 或者单位失去技能了
	if( not UnitAlive(skeletonKing) and LoadInteger(HY, GetHandleId(skeletonKing),'A1AZ')!= 1) or GetUnitAbilityLevel(skeletonKing,'A1AZ') == 0 then
		loop
			set firstUnit = FirstOfGroup(auraGroup)
		exitwhen firstUnit == null
			call UnitRemoveAbility(firstUnit,'A3DK')
			call UnitRemoveAbility(firstUnit,'B3I9')
			call GroupRemoveUnit(auraGroup, firstUnit)
		endloop
	else
		set U2 = skeletonKing
		set enumGroup = LoginGroup(348)
		call GroupEnumUnitsInRange(enumGroup, GetUnitX(skeletonKing), GetUnitY(skeletonKing), 1225, null)
		//=======================================
		// remove
		loop
			set firstUnit = FirstOfGroup(auraGroup)
		exitwhen firstUnit == null
			if not IsUnitInGroup(firstUnit, enumGroup) then
				call UnitRemoveAbility(firstUnit,'A3DK')
				call UnitRemoveAbility(firstUnit,'B3I9')
			endif
			call GroupRemoveUnit(auraGroup, firstUnit)
		endloop
		//=======================================
		// add
		loop
			set firstUnit = FirstOfGroup(enumGroup)
		exitwhen firstUnit == null
			call GroupRemoveUnit(enumGroup, firstUnit)
			// 友军 存活 非建筑 非守卫 英雄 并且没有绿翔光环
			if IsUnitAlly(U2, GetOwningPlayer(firstUnit)) and IsAliveNotStrucNotWard(firstUnit) and IsUnitType(firstUnit, UNIT_TYPE_HERO) and GetUnitAbilityLevel(firstUnit,'A3DA')== 0 then
				call GroupAddUnit(auraGroup, firstUnit)
				if GetUnitAbilityLevel(firstUnit,'A3DK')== 0 then
					call UnitAddPermanentAbility(firstUnit,'A3DK')
					call UnitMakeAbilityPermanent(firstUnit, true,'A3D9')
					call UnitMakeAbilityPermanent(firstUnit, true,'A3I9')
				endif
				call register_AhalimReincarnation(firstUnit)
			endif
		endloop
		call LogoutGroup(enumGroup)
		//=======================================
	endif
	set t = null
	set skeletonKing = null
	set auraGroup = null
	set enumGroup = null
	set firstUnit = null
	return false
endfunction

function P4I takes unit u returns nothing
	local trigger t
	local integer h
	local integer hu = GetHandleId(u)
	if HaveSavedHandle(HY, hu,'LeoR')== false then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, hu,'LeoR', t)
		call TriggerRegisterTimerEvent(t, .3, true)
		call SaveUnitHandle(HY, h, 0, u)
		call SaveGroupHandle(HY, h, 1, LoginGroup(349))
		call TriggerAddCondition(t, Condition(function EnumAddBuff_Reincarnation))
	endif
	call SetAllPlayerAbilityUnavailable('A3DK')
	set t = null
endfunction

function HRX takes nothing returns nothing
	call P4I(U2)
endfunction

/*function P5I takes unit u, unit t returns nothing	//吸血光环
	local integer lv
	local real i
	if GetUnitAbilityLevel(t,'A04R')== 0 and IsUnitIllusion(t)== false and IsUnitType(t, UNIT_TYPE_STRUCTURE)== false and IsUnitType(t, UNIT_TYPE_MECHANICAL)== false and IsUnitEnemy(u, GetOwningPlayer(t)) and(GetUnitAbilityLevel(u,'BVA1')> 0 or GetUnitAbilityLevel(u,'BVA2')> 0 or GetUnitAbilityLevel(u,'BVA3')> 0 or GetUnitAbilityLevel(u,'BVA4')> 0) and UnitAlive(u) then
		set lv = GetUnitAbilityLevel(u,'BVA1')+ GetUnitAbilityLevel(u,'BVA2')* 2 + GetUnitAbilityLevel(u,'BVA3')* 3 + GetUnitAbilityLevel(u,'BVA4')* 4
		set i = .1 + .05 * lv
		call SetWidgetLife(u, GetWidgetLife(u)+ GetEventDamage()* i)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl", u, "origin"))
	endif
endfunction*/
function P6I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	local integer id
	local integer lv
	local real c
	local unit d
	if GetTriggerEvalCount(t) == 1 then
		set id = LoadInteger(HY, h, 1)
		set lv = GetUnitAbilityLevel(u, id)
		set c = YDWEGetUnitAbilityState(u, id, 1)
		set id = 280 - 60 * lv
		if c == id or c == (id * 0.75) then
			set d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
			call UnitAddAbility(d,'A274')
			call IssueImmediateOrderById(d, 852096)
		endif
	else
		call SelectUnitForPlayerSingle(u, GetOwningPlayer(u))
		call KPX(u)
		if GetUnitTypeId(u) == 'N0MH' then
			call YDWEUnitTransform( u, LoadInteger(ExtraHT, GetHandleId(u), HTKEY_UNIT_ORIGIN_TYPEID ))
		endif
		// call FixUnitSkillsBug(u)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set h = GetHandleId(u)
		if LoadBoolean(P, h, StringHash("morphedburn")) then
			call RAX(u, LoadInteger(P, h, StringHash("second")))
			call RAX(u, LoadInteger(P, h, StringHash("first")))
			call SaveBoolean(P, h, StringHash("morphedburn"), false)
		endif
	endif
	set t = null
	set u = null
	set d = null
	return false
endfunction
function ReincarnationActions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	local integer pid = GetPlayerId(GetOwningPlayer(u))
	local boolean b = false
	local real cd
	local integer id = 'A01Y'
	local integer lv = GetUnitAbilityLevel(u, id)
	local timer tim = ESV[pid]

	// debug call SingleDebug("英雄单位死亡 包括重生ReincarnationActions")
	if lv == 0 then
		set lv = GetUnitAbilityLevel(u,'A1AZ')
		set id = 'A1AZ'
	endif
	if HeroCommonSkills[PlayerSkillIndex[pid * HL + 6]]=='A01Y' then
		set tim = ETV[pid]
	endif
	if YDWEGetUnitAbilityState(u, id, 1) == 0 and GetUnitState(u, UNIT_STATE_MANA)>= 120 + 40 * lv then
		if HeroCommonSkills[PlayerSkillIndex[pid * HL + 4]]=='A01Y' or HeroCommonSkills[PlayerSkillIndex[pid * HL + 6]]=='A01Y'  then
			set b = true
			if GetUnitAbilityLevel(u,'A39S')== 1 then
				if GetUnitAbilityLevel(u,'A01Y')> 0 then
					set cd = YDWEGetUnitAbilityDataReal(u, 'A01Y', lv, 105)
					call Japi_ReduceUnitAbilityCoolDown(u,'A01Y', cd * 0.25)
				else
					set cd = YDWEGetUnitAbilityDataReal(u, 'A1AZ', lv, 105)
					call Japi_ReduceUnitAbilityCoolDown(u,'A1AZ', cd * 0.25)
				endif
				call TimerStart(tim, (280 -lv * 60)*(1. -25 * 1. / 100.), false, null)
			else
				call TimerStart(tim, (280 -lv * 60), false, null)
			endif
		endif
	endif
	if b then
		if GetUnitAbilityLevel(u,'A3DK')!= 0 then
			call UnitRemoveAbility(u,'A3DK')
		endif
		call EPX(u,'A1AZ', 3.)
		// debug call SingleDebug("		call EPX(u,'A1AZ', 3.)")
		if IsTerrainPathable(GetUnitX(u), GetUnitY(u), PATHING_TYPE_WALKABILITY) then
			call Y_X(u)
		endif
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 0, false)
		call TriggerRegisterTimerEvent(t, 3 + .01, false)
		call TriggerAddCondition(t, Condition(function P6I))
		call SaveUnitHandle(HY, h, 2,(u))
		call SaveInteger(HY, h, 1, id)
	endif
	set t = null
	set u = null
	set tim = null
	return false
endfunction
function SKill_Learn_Reincarnation takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = GetTriggerUnit()
	call TriggerRegisterDeathEvent(t, triggerUnit)
	call TriggerAddCondition(t, Condition(function ReincarnationActions))
	call SaveUnitHandle(HY, h, 2,(triggerUnit))
	set t = null
	set triggerUnit = null
endfunction
function P8I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 2)
	local unit WLE = LoadUnitHandle(HY, h, 17)
	local integer level = GetUnitAbilityLevel(WJE,'A2S0')
	local real P9I = LoadReal(HY, h, 797)
	local real QVI = LoadReal(HY, h, 798)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call SaveInteger(HY, GetHandleId(WJE), 4338, 2)
		call SetPlayerAbilityAvailable(GetOwningPlayer(WJE),'AOcr', true)
		call DestroyEffect(LoadEffectHandle(HY, h, 175))
		call DestroyEffect(LoadEffectHandle(HY, h, 176))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif P9I > 0 then
		call SaveInteger(HY, GetHandleId(WJE), 4338, 2)
		call SetPlayerAbilityAvailable(GetOwningPlayer(WJE),'AOcr', true)
		call DestroyEffect(LoadEffectHandle(HY, h, 175))
		call DestroyEffect(LoadEffectHandle(HY, h, 176))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if UnitIsDead(WJE)== false then
			call SetWidgetLife(WJE, RMaxBJ(1, GetWidgetLife(WJE)-P9I))
		endif
		if UnitAlive(WLE) then
			call SetWidgetLife(WLE, GetWidgetLife(WLE)+ QVI)
		endif
	else
		set P9I = GetUnitState(WLE, UNIT_STATE_MAX_LIFE)* .2
		call SaveReal(HY, h, 798, P9I * 1.)
		if IsUnitType(WJE, UNIT_TYPE_HERO) then
			call SetWidgetLife(WLE, RMaxBJ(1, GetWidgetLife(WLE)-P9I))
		endif
		if P9I + GetWidgetLife(WJE)> GetUnitState(WJE, UNIT_STATE_MAX_LIFE) then
			set P9I = GetUnitState(WJE, UNIT_STATE_MAX_LIFE)-GetWidgetLife(WJE)
		endif
		if P9I == 0 then
			set P9I = .01
		endif
		call SetWidgetLife(WJE, GetWidgetLife(WJE)+ P9I)
		call SaveReal(HY, h, 797, P9I * 1.)
	endif
	set t = null
	set WJE = null
	set WLE = null
	return false
endfunction
function QEI takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerRegisterTimerEvent(t, 7, false)
	call TriggerRegisterDeathEvent(t, WJE)
	call TriggerAddCondition(t, Condition(function P8I))
	call SaveUnitHandle(HY, h, 2, WJE)
	call SaveUnitHandle(HY, h, 17, WLE)
	call SaveReal(HY, h, 797, 0)
	call SaveReal(HY, h, 798, 0)
	call SaveEffectHandle(HY, h, 175, AddSpecialEffectTarget("war3mapImported\\MortalStrikeCaster.mdx", WJE, "overhead"))
	call SaveEffectHandle(HY, h, 176, AddSpecialEffectTarget("war3mapImported\\MortalStrikeTarget.mdx", WLE, "overhead"))
	call SaveInteger(HY, GetHandleId(WJE), 4338, 1)
	call SetPlayerAbilityAvailable(GetOwningPlayer(WJE),'AOcr', false)
	set t = null
	set WJE = null
	set WLE = null
endfunction
function P9E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A2S0')
	//if level == 1 then
		//call UnitAddPermanentAbility(u,'Q251')
		//call UnitMakeAbilityPermanent(u, true,'AOcr')
	//endif
	//call SetUnitAbilityLevel(u,'AOcr', level)
	set u = null
endfunction
function O9E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call QEI()
	endif
endfunction
function QXI takes unit U6E returns boolean
	return(IsUnitIllusion(U6E)) and GetWidgetLife(U6E)> .5 and GetOwningPlayer(U6E)== GetOwningPlayer(GetTriggerUnit())
endfunction
function QOI takes nothing returns boolean
	return QXI(GetFilterUnit())
endfunction
function QRI takes nothing returns nothing
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Feedback\\ArcaneTowerAttack.mdl", GetEnumUnit(), "origin"))
	call UnitDamageTargetEx(GetTriggerUnit(), GetEnumUnit(), 1, JW)
endfunction
function RXE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local real x
	local real y
	local real WYE = GetUnitX(WUE)
	local real WZE = GetUnitY(WUE)
	local group g
	local boolean QII = false
	if targetUnit != null and QXI(targetUnit) then
		set QII = true
	else
		set g = LoginGroup(350)
		call GroupEnumUnitsInRange(g, 0, 0,$F423F, Condition(function QOI))
		call GroupAddUnit(g, WUE)
		set targetUnit = GetNearestUnitByGroup(g, GetSpellTargetX(), GetSpellTargetY())
		call LogoutGroup(g)
		set QII = targetUnit != null
	endif
	if QII then
		set x = GetUnitX(targetUnit)
		set y = GetUnitY(targetUnit)
		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\ToonBoom\\ToonBoom.mdl", WYE, WZE))
		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\ToonBoom\\ToonBoom.mdl", x, y))
		call SetUnitX(WUE, x)
		call SetUnitY(WUE, y)
		set JW = 60 + GetUnitAbilityLevel(GetTriggerUnit(),'A0N8')* 40
		set g = LoginGroup(351)
		set U2 = WUE
		call GroupEnumUnitsInRange(g, WYE, WZE, 400, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call ForGroup(g, function QRI)
		set U2 = WUE
		call GroupEnumUnitsInRange(g, x, y, 400, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call ForGroup(g, function QRI)
		call LogoutGroup(g)
	endif
	set g = null
	set WUE = null
	set targetUnit = null
endfunction
function QAI takes nothing returns boolean
	return(IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GW)) and IsMagicImmuneUnit(GetFilterUnit())== false and(DOX(GetFilterUnit())== false or IsUnitVisible(GetFilterUnit(), GetOwningPlayer(GW))) and IsAliveNotStrucNotWard(GetFilterUnit()) and GetFilterUnit()!= RoShan)!= null
endfunction
function QNI takes nothing returns nothing
	local unit dummyUnit = CreateUnit(GetOwningPlayer(GW),'e00E', GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()), 0)
	call UnitAddPermanentAbility(dummyUnit,'A0NC')
	call SetUnitAbilityLevel(dummyUnit,'A0NC', Q2)
	call B0R(dummyUnit, GetEnumUnit(),$D008A)
	if UnitHasSpellShield(GetEnumUnit())== false then
		call UnitDamageTargetEx(GW, GetEnumUnit(), 1, 75 + 25 * Q2)
	endif
	set dummyUnit = null
endfunction
function QBI takes unit NIX, real x, real y, integer level returns nothing
	local group g = LoginGroup(352)
	set GW = NIX
	set U2 = NIX
	call GroupEnumUnitsInRange(g, x, y, 325, Condition(function QAI))
	set JW = x
	set Q2 = level
	call ForGroup(g, function QNI)
	call LogoutGroup(g)
	set g = null
endfunction
function QCI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit NIX = LoadUnitHandle(HY, h, 45)
	local real W_E = LoadReal(HY, h, 47)
	local real W0E = LoadReal(HY, h, 48)
	local real a = LoadReal(HY, h, 13)
	local real NBX = GetUnitX(NIX)+ 30 * Cos(a)
	local real NCX = GetUnitY(NIX)+ 30 * Sin(a)
	if(NBX -W_E)*(NBX -W_E)+(NCX -W0E)*(NCX -W0E)< 1200 then
		call SetUnitX(NIX, W_E)
		call SetUnitY(NIX, W0E)
		call QBI(NIX, W_E, W0E, LoadInteger(HY, h, 0))
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call KillUnit(NIX)
		call DestroyTimer(t)
	else
		call SetUnitX(NIX, NBX)
		call SetUnitY(NIX, NCX)
	endif
	set t = null
	set NIX = null
endfunction
function RAE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local real W_E = CoordinateX50(GetSpellTargetX())
	local real W0E = CoordinateY50(GetSpellTargetY())
	local real WYE = CoordinateX50(GetUnitX(triggerUnit))
	local real WZE = CoordinateY50(GetUnitY(triggerUnit))
	local unit NIX = CreateUnit(GetOwningPlayer(triggerUnit),'h00C', WYE, WZE, 0)
	local real a = Atan2(W0E -WZE, W_E -WYE)
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SetUnitScale(NIX, 2, 2, 2)
	call SaveUnitHandle(HY, h, 45, NIX)
	call SaveReal(HY, h, 47, W_E * 1.)
	call SaveReal(HY, h, 48, W0E * 1.)
	call SaveReal(HY, h, 13, a * 1.)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(triggerUnit, GetSpellAbilityId()))
	call TimerStart(t, .035, true, function QCI)
	set triggerUnit = null
	set NIX = null
	set t = null
endfunction
function QDI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit QFI = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or LoadReal(HY, h, 0)< GetGameTime() or GetUnitAbilityLevel(WLE, LoadInteger(HY, h, 0))== 0 then
		call UnitRemoveAbility(WLE, LoadInteger(HY, h, 0))
		call UnitRemoveAbility(WLE,'B079')
		call RemoveSavedHandle(P, GetHandleId(WLE),'A40F')
		call FlushChildHashtable(HY, h)
		call DisableTrigger(t)
		call DestroyTrigger(t)
	else
		if ModuloInteger(GetTriggerEvalCount(t), 2)== 1 then
			call UnitDamageTargetEx(QFI, WLE, 1, LoadInteger(HY, h, 1)* 5 +$A)
		endif
	endif
	set QFI = null
	set WLE = null
	set t = null
endfunction
function QGI takes unit u returns boolean
	return GetUnitAbilityLevel(u,'A3A0')== 1 or GetUnitAbilityLevel(u,'A3A1')== 1 or GetUnitAbilityLevel(u,'A3A2')== 1 or GetUnitAbilityLevel(u,'A3A3')== 1 or GetUnitAbilityLevel(u,'A3A4')== 1 or GetUnitAbilityLevel(u,'A3A5')== 1 or GetUnitAbilityLevel(u,'A3A6')== 1 or GetUnitAbilityLevel(u,'A3A7')== 1
endfunction
function QHI takes unit u, unit WLE returns nothing
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(u,'A0N7')
	if QGI(WLE) then
		set t = LoadTriggerHandle(P, GetHandleId(WLE),'A40F')
		set h = GetHandleId(t)
		if IsUnitType(u, UNIT_TYPE_RANGED_ATTACKER) and IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER)== false then
			if GetUnitAbilityLevel(WLE,'A3A0'-1 + level)== 0 then
				call UnitRemoveAbility(WLE, LoadInteger(HY, h, 0))
				call UnitRemoveAbility(WLE,'B079')
				call UnitAddPermanentAbility(WLE,'A3A0'-1 + level)
				call SaveInteger(HY, h, 0,'A3A0'-1 + level)
			endif
		else
			if GetUnitAbilityLevel(WLE,'A3A4'-1 + level)== 0 then
				call UnitRemoveAbility(WLE, LoadInteger(HY, h, 0))
				call UnitRemoveAbility(WLE,'B079')
				call UnitAddPermanentAbility(WLE,'A3A4'-1 + level)
				call SaveInteger(HY, h, 0,'A3A4'-1 + level)
			endif
		endif
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(P, GetHandleId(WLE),'A40F', t)
		call TriggerRegisterTimerEvent(t, .5, true)
		call TriggerRegisterDeathEvent(t, WLE)
		call TriggerAddCondition(t, Condition(function QDI))
		call SaveUnitHandle(HY, h, 0, u)
		call SaveUnitHandle(HY, h, 1, WLE)
		if IsUnitType(u, UNIT_TYPE_RANGED_ATTACKER) and IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER)== false then
			call UnitAddPermanentAbility(WLE,'A3A0'-1 + level)
			call SaveInteger(HY, h, 0,'A3A0'-1 + level)
		else
			call UnitAddPermanentAbility(WLE,'A3A4'-1 + level)
			call SaveInteger(HY, h, 0,'A3A4'-1 + level)
		endif
		call SaveInteger(HY, h, 1, level)
	endif
	if Mode__BalanceOff == false and IsUnitType(u, UNIT_TYPE_RANGED_ATTACKER) and IsUnitType(u, UNIT_TYPE_MELEE_ATTACKER)== false then
		call SaveReal(HY, h, 0, GetGameTime()+ 2)
	else
		call SaveReal(HY, h, 0, GetGameTime()+ 4)
	endif
	set t = null
endfunction
function QJI takes unit U6E returns boolean
	return GetUnitTypeId(U6E)==('H00I') or GetUnitTypeId(U6E)==('H00J')
endfunction
function QKI takes nothing returns nothing
	local integer QLI = GetHandleId(GetTriggeringTrigger())
	local player p =(LoadPlayerHandle(HY,(QLI), 370))
	local integer QMI = GetHandleId(p)
	local unit S2X =(LoadUnitHandle(HY,(QMI), 699))
	local unit S3X =(LoadUnitHandle(HY,(QMI), 700))
	local unit S4X =(LoadUnitHandle(HY,(QMI), 701))
	local unit S5X =(LoadUnitHandle(HY,(QMI), 702))
	local unit S6X =(LoadUnitHandle(HY,(QMI), 703))
	local integer QPI = GetUnitAbilityLevel(S2X,'Aamk')* 2
	local integer VNI = GetHeroAgi(S2X, false)
	local integer QQI = GetHeroAgi(S2X, true)-VNI -QPI
	local integer VBI = GetHeroStr(S2X, false)
	local integer QSI = GetHeroStr(S2X, true)-VBI -QPI
	local integer QTI = GetHeroInt(S2X, false)
	local integer QUI = GetHeroInt(S2X, true)-QTI -QPI
	local real QWI = .25
	local integer QYI = R2I(VNI + QQI * QWI)
	local integer QZI = R2I(VBI + QSI * QWI)
	local integer Q_I = R2I(QTI + QUI * QWI)
	if GetWidgetLife(S2X)> 1 then
		if S3X != null then
			call SetHeroAgi(S3X, QYI, false)
			call SetHeroStr(S3X, QZI, false)
			call SetHeroInt(S3X, Q_I, false)
		endif
		if S4X != null then
			call SetHeroAgi(S4X, QYI, false)
			call SetHeroStr(S4X, QZI, false)
			call SetHeroInt(S4X, Q_I, false)
		endif
		if S5X != null then
			call SetHeroAgi(S5X, QYI, false)
			call SetHeroStr(S5X, QZI, false)
			call SetHeroInt(S5X, Q_I, false)
		endif
		if S6X != null then
			call SetHeroAgi(S6X, QYI, false)
			call SetHeroStr(S6X, QZI, false)
			call SetHeroInt(S6X, Q_I, false)
		endif
	endif
	set p = null
	set S2X = null
	set S3X = null
	set S4X = null
	set S5X = null
	set S6X = null
endfunction
function Q0I takes nothing returns nothing
	local integer QLI = GetHandleId(GetTriggeringTrigger())
	local player p =(LoadPlayerHandle(HY,(QLI), 370))
	local integer QMI = GetHandleId(p)
	local unit S2X =(LoadUnitHandle(HY,(QMI), 699))
	local unit S3X =(LoadUnitHandle(HY,(QMI), 700))
	local unit S4X =(LoadUnitHandle(HY,(QMI), 701))
	local unit S5X =(LoadUnitHandle(HY,(QMI), 702))
	local unit S6X =(LoadUnitHandle(HY,(QMI), 703))
	local integer Q1I = GetHandleId(S2X)
	local integer Q2I = GetHandleId(S3X)
	local integer Q3I = GetHandleId(S4X)
	local integer Q4I = GetHandleId(S5X)
	local integer Q5I = GetHandleId(S6X)
	local integer Q6I =(LoadInteger(HY,(Q1I), 367))
	local integer Q7I =(LoadInteger(HY,(Q1I), 368))
	local integer Q8I =(LoadInteger(HY,(Q2I), 367))
	local integer Q9I =(LoadInteger(HY,(Q2I), 368))
	local integer SVI =(LoadInteger(HY,(Q3I), 367))
	local integer SEI =(LoadInteger(HY,(Q3I), 368))
	local integer SXI =(LoadInteger(HY,(Q4I), 367))
	local integer SOI =(LoadInteger(HY,(Q4I), 368))
	local integer SRI =(LoadInteger(HY,(Q5I), 367))
	local integer SII =(LoadInteger(HY,(Q5I), 368))
	local integer SAI = GetHeroXP(S2X)
	local integer SNI = GetHeroXP(S3X)
	local integer SBI = GetHeroXP(S4X)
	local integer SCI = GetHeroXP(S5X)
	local integer SDI = GetHeroXP(S6X)
	local integer SFI = SAI -Q6I -Q7I
	local integer SGI = SNI -Q8I -Q9I
	local integer SHI = SBI -SVI -SEI
	local integer SJI = SCI -SXI -SOI
	local integer SKI = SDI -SRI -SII
	if GetWidgetLife(S2X)> 1 then
		set Q6I = Q6I + SFI
		set Q8I = Q8I + SGI
		set SVI = SVI + SHI
		set SXI = SXI + SJI
		set SRI = SRI + SKI
		if S2X != null then
			call AddHeroXPSimple(S3X, SFI, false)
			if GetHeroXP(S3X)!= SNI then
				set Q9I = Q9I + SFI
			endif
			call AddHeroXPSimple(S4X, SFI, false)
			if GetHeroXP(S4X)!= SBI then
				set SEI = SEI + SFI
			endif
			call AddHeroXPSimple(S5X, SFI, false)
			if GetHeroXP(S5X)!= SCI then
				set SOI = SOI + SFI
			endif
			call AddHeroXPSimple(S6X, SFI, false)
			if GetHeroXP(S6X)!= SDI then
				set SII = SII + SFI
			endif
		endif
		if S3X != null then
			call AddHeroXPSimple(S2X, SGI, false)
			if GetHeroXP(S2X)!= SAI then
				set Q7I = Q7I + SGI
			endif
			call AddHeroXPSimple(S4X, SGI, false)
			if GetHeroXP(S4X)!= SBI then
				set SEI = SEI + SGI
			endif
			call AddHeroXPSimple(S5X, SGI, false)
			if GetHeroXP(S5X)!= SCI then
				set SOI = SOI + SGI
			endif
			call AddHeroXPSimple(S6X, SGI, false)
			if GetHeroXP(S6X)!= SDI then
				set SII = SII + SGI
			endif
		endif
		if S4X != null then
			call AddHeroXPSimple(S3X, SHI, false)
			if GetHeroXP(S3X)!= SNI then
				set Q9I = Q9I + SHI
			endif
			call AddHeroXPSimple(S2X, SHI, false)
			if GetHeroXP(S2X)!= SAI then
				set Q7I = Q7I + SHI
			endif
			call AddHeroXPSimple(S5X, SHI, false)
			if GetHeroXP(S5X)!= SCI then
				set SOI = SOI + SHI
			endif
			call AddHeroXPSimple(S6X, SHI, false)
			if GetHeroXP(S6X)!= SDI then
				set SII = SII + SHI
			endif
		endif
		if S5X != null then
			call AddHeroXPSimple(S3X, SJI, false)
			if GetHeroXP(S3X)!= SNI then
				set Q9I = Q9I + SJI
			endif
			call AddHeroXPSimple(S4X, SJI, false)
			if GetHeroXP(S4X)!= SBI then
				set SEI = SEI + SJI
			endif
			call AddHeroXPSimple(S2X, SJI, false)
			if GetHeroXP(S2X)!= SAI then
				set Q7I = Q7I + SJI
			endif
			call AddHeroXPSimple(S6X, SJI, false)
			if GetHeroXP(S6X)!= SDI then
				set SII = SII + SJI
			endif
		endif
		if S6X != null then
			call AddHeroXPSimple(S3X, SKI, false)
			if GetHeroXP(S3X)!= SNI then
				set Q9I = Q9I + SKI
			endif
			call AddHeroXPSimple(S4X, SKI, false)
			if GetHeroXP(S4X)!= SBI then
				set SEI = SEI + SKI
			endif
			call AddHeroXPSimple(S2X, SKI, false)
			if GetHeroXP(S2X)!= SAI then
				set Q7I = Q7I + SKI
			endif
			call AddHeroXPSimple(S5X, SKI, false)
			if GetHeroXP(S5X)!= SCI then
				set SOI = SOI + SKI
			endif
		endif
		call SaveInteger(HY,(Q1I), 367,(Q6I))
		call SaveInteger(HY,(Q1I), 368,(Q7I))
		call SaveInteger(HY,(Q2I), 367,(Q8I))
		call SaveInteger(HY,(Q2I), 368,(Q9I))
		call SaveInteger(HY,(Q3I), 367,(SVI))
		call SaveInteger(HY,(Q3I), 368,(SEI))
		call SaveInteger(HY,(Q4I), 367,(SXI))
		call SaveInteger(HY,(Q4I), 368,(SOI))
		call SaveInteger(HY,(Q5I), 367,(SRI))
		call SaveInteger(HY,(Q5I), 368,(SII))
	endif
	set p = null
	set S2X = null
	set S3X = null
	set S4X = null
	set S5X = null
	set S6X = null
endfunction
function SLI takes nothing returns boolean
	return QJI(GetTriggerUnit()) and IsUnitIllusion(GetTriggerUnit())== false
endfunction
function SMI takes unit SPI, unit triggerUnit returns nothing
	local trigger t =(LoadTriggerHandle(HY,(GetHandleId(GetOwningPlayer(triggerUnit))), 369))
	local integer i = 0
	local boolean SQI = false
	local boolean SSI = false
	local boolean STI = false
	local boolean SUI = false
	local boolean SWI = false
	local boolean SYI = false
	local boolean SZI = false
	local boolean S_I = false
	local boolean S0I = false
	call DisableTrigger(t)
	call DisableTrigger(CUV)
	loop
	exitwhen i > 5
		if GetItemTypeId(UnitItemInSlot(triggerUnit, i))==(RealItemTypeId[XMV]) then
			set SQI = true
		endif
		if(GetItemTypeId(UnitItemInSlot(triggerUnit, i)))==(RealItemTypeId[IAV]) then
			set SSI = true
		endif
		if GetItemTypeId(UnitItemInSlot(triggerUnit, i))==(RealItemTypeId[IDV]) then
			set STI = true
		endif
		if GetItemTypeId(UnitItemInSlot(triggerUnit, i))==(RealItemTypeId[ICV]) then
			set SUI = true
		endif
		if GetItemTypeId(UnitItemInSlot(triggerUnit, i))==(RealItemTypeId[IBV]) then
			set SWI = true
		endif
		if GetItemTypeId(UnitItemInSlot(triggerUnit, i))==(RealItemTypeId[NKV]) then
			set SYI = true
		endif
		if GetItemTypeId(UnitItemInSlot(triggerUnit, i))==(RealItemTypeId[NZV]) then
			set SZI = true
		endif
		if GetItemTypeId(UnitItemInSlot(triggerUnit, i))==(RealItemTypeId[RNV]) then
			set S_I = true
		endif
		if GetItemTypeId(UnitItemInSlot(triggerUnit, i))==(RealItemTypeId[RBV]) then
			set S0I = true
		endif
		set i = i + 1
	endloop
	if S0I then
		call UnitAddItem(SPI, CreateItem((RealItemTypeId[RBV]), 0, 0))
	elseif S_I then
		call UnitAddItem(SPI, CreateItem((RealItemTypeId[RNV]), 0, 0))
	elseif SZI then
		call UnitAddItem(SPI, CreateItem((RealItemTypeId[NZV]), 0, 0))
	elseif SYI then
		call UnitAddItem(SPI, CreateItem((RealItemTypeId[NKV]), 0, 0))
	elseif SWI then
		call UnitAddItem(SPI, CreateItem((RealItemTypeId[IBV]), 0, 0))
	elseif SUI then
		call UnitAddItem(SPI, CreateItem((RealItemTypeId[ICV]), 0, 0))
	elseif STI then
		call UnitAddItem(SPI, CreateItem((RealItemTypeId[IDV]), 0, 0))
	elseif SSI then
		call UnitAddItem(SPI, CreateItem((RealItemTypeId[IAV]), 0, 0))
	elseif SQI then
		call UnitAddItem(SPI, CreateItem((RealItemTypeId[XMV]), 0, 0))
	endif
	call EnableTrigger(t)
	call EnableTrigger(CUV)
	set t = null
endfunction
function S1I takes nothing returns nothing
	local unit S3I = GetTriggerUnit()
	local integer i = 0
	local boolean SQI = false
	local boolean SSI = false
	local boolean STI = false
	local boolean SUI = false
	local boolean SWI = false
	local boolean SYI = false
	local boolean SZI = false
	local boolean S_I = false
	local boolean S0I = false
	local integer QMI = GetHandleId(GetOwningPlayer(S3I))
	local unit S2X =(LoadUnitHandle(HY,(QMI), 699))
	local unit S3X =(LoadUnitHandle(HY,(QMI), 700))
	local unit S4X =(LoadUnitHandle(HY,(QMI), 701))
	local unit S5X =(LoadUnitHandle(HY,(QMI), 702))
	local unit S6X =(LoadUnitHandle(HY,(QMI), 703))
	local integer JCX
	local boolean S4I = false
	local integer S5I = 0
	local integer S6I = 0
	local integer S7I = 0
	local integer S8I = 0
	local integer S9I = 0
	local integer TVI = 0
	local integer TEI = 0
	local integer TXI = 0
	local integer TOI = 0
	call DisableTrigger(GetTriggeringTrigger())
	if GetUnitTypeId(S3I)==('H00J') then
		call UnitRemoveItemFromSlot(S3I, 0)
		call EnableTrigger(GetTriggeringTrigger())
		return
	endif
	if not(GetItemTypeId(GetManipulatedItem())==(RealItemTypeId[XMV]) or(GetItemTypeId(GetManipulatedItem()))==(RealItemTypeId[IAV]) or GetItemTypeId(GetManipulatedItem())==(RealItemTypeId[IDV]) or GetItemTypeId(GetManipulatedItem())==(RealItemTypeId[ICV]) or GetItemTypeId(GetManipulatedItem())==(RealItemTypeId[IBV]) or(GetItemTypeId(GetManipulatedItem()))==(RealItemTypeId[NKV]) or GetItemTypeId(GetManipulatedItem())==(RealItemTypeId[NZV]) or GetItemTypeId(GetManipulatedItem())==(RealItemTypeId[RNV]) or GetItemTypeId(GetManipulatedItem())==(RealItemTypeId[RBV])) then
		call EnableTrigger(GetTriggeringTrigger())
		return
	endif
	call DisableTrigger(CUV)
	if GetTriggerEventId()== EVENT_PLAYER_UNIT_DROP_ITEM then
		set S4I = true
	endif
	loop
	exitwhen i > 5
		set JCX = GetItemTypeId(UnitItemInSlot(S3I, i))
		if JCX ==(RealItemTypeId[XMV]) then
			set S5I = S5I + 1
			if(not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(S5I > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set SQI = true
			endif
		endif
		if(JCX)==(RealItemTypeId[IAV]) then
			set S6I = S6I + 1
			if(not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(S6I > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set SSI = true
			endif
		endif
		if JCX ==(RealItemTypeId[IDV]) then
			set S7I = S7I + 1
			if(not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(S7I > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set STI = true
			endif
		endif
		if JCX ==(RealItemTypeId[ICV]) then
			set S8I = S8I + 1
			if(not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(S8I > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set SUI = true
			endif
		endif
		if JCX ==(RealItemTypeId[IBV]) then
			set S9I = S9I + 1
			if(not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(S9I > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set SWI = true
			endif
		endif
		if(JCX)==(RealItemTypeId[NKV]) then
			set TVI = TVI + 1
			if(not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(TVI > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set SYI = true
			endif
		endif
		if JCX ==(RealItemTypeId[NZV]) then
			set TEI = TEI + 1
			if(not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(TEI > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set SZI = true
			endif
		endif
		if JCX ==(RealItemTypeId[RNV]) then
			set TXI = TXI + 1
			if(not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(TXI > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set S_I = true
			endif
		endif
		if JCX ==(RealItemTypeId[RBV]) then
			set TOI = TOI + 1
			if(not(S4I and JCX == GetItemTypeId(GetManipulatedItem()))) or(TXI > 1 and JCX == GetItemTypeId(GetManipulatedItem())) then
				set S0I = true
			endif
		endif
		set i = i + 1
	endloop
	call RemoveItem(UnitRemoveItemFromSlot(S3X, 0))
	if S4X != null then
		call RemoveItem(UnitRemoveItemFromSlot(S4X, 0))
	endif
	if S5X != null then
		call RemoveItem(UnitRemoveItemFromSlot(S5X, 0))
	endif
	if S6X != null then
		call RemoveItem(UnitRemoveItemFromSlot(S6X, 0))
	endif
	if S0I then
		call UnitAddItem(S3X, CreateItem((RealItemTypeId[RBV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((RealItemTypeId[RBV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((RealItemTypeId[RBV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((RealItemTypeId[RBV]), 0, 0))
		endif
	elseif S_I then
		call UnitAddItem(S3X, CreateItem((RealItemTypeId[RNV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((RealItemTypeId[RNV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((RealItemTypeId[RNV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((RealItemTypeId[RNV]), 0, 0))
		endif
	elseif SZI then
		call UnitAddItem(S3X, CreateItem((RealItemTypeId[NZV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((RealItemTypeId[NZV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((RealItemTypeId[NZV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((RealItemTypeId[NZV]), 0, 0))
		endif
	elseif SYI then
		call UnitAddItem(S3X, CreateItem((RealItemTypeId[NKV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((RealItemTypeId[NKV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((RealItemTypeId[NKV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((RealItemTypeId[NKV]), 0, 0))
		endif
	elseif SWI then
		call UnitAddItem(S3X, CreateItem((RealItemTypeId[IBV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((RealItemTypeId[IBV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((RealItemTypeId[IBV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((RealItemTypeId[IBV]), 0, 0))
		endif
	elseif SUI then
		call UnitAddItem(S3X, CreateItem((RealItemTypeId[ICV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((RealItemTypeId[ICV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((RealItemTypeId[ICV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((RealItemTypeId[ICV]), 0, 0))
		endif
	elseif STI then
		call UnitAddItem(S3X, CreateItem((RealItemTypeId[IDV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((RealItemTypeId[IDV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((RealItemTypeId[IDV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((RealItemTypeId[IDV]), 0, 0))
		endif
	elseif SSI then
		call UnitAddItem(S3X, CreateItem((RealItemTypeId[IAV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((RealItemTypeId[IAV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((RealItemTypeId[IAV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((RealItemTypeId[IAV]), 0, 0))
		endif
	elseif SQI then
		call UnitAddItem(S3X, CreateItem((RealItemTypeId[XMV]), 0, 0))
		if S4X != null then
			call UnitAddItem(S4X, CreateItem((RealItemTypeId[XMV]), 0, 0))
		endif
		if S5X != null then
			call UnitAddItem(S5X, CreateItem((RealItemTypeId[XMV]), 0, 0))
		endif
		if S6X != null then
			call UnitAddItem(S6X, CreateItem((RealItemTypeId[XMV]), 0, 0))
		endif
	endif
	call EnableTrigger(GetTriggeringTrigger())
	call EnableTrigger(CUV)
	set S3I = null
	set S4X = null
	set S5X = null
	set S6X = null
	set S2X = null
	set S3X = null
endfunction
function TRI takes unit TII, integer TAI returns nothing
	local integer QMI = GetHandleId(GetOwningPlayer(TII))
	local unit S2X =(LoadUnitHandle(HY,(QMI), 699))
	local unit S3X =(LoadUnitHandle(HY,(QMI), 700))
	local unit S4X =(LoadUnitHandle(HY,(QMI), 701))
	local unit S5X =(LoadUnitHandle(HY,(QMI), 702))
	local unit S6X =(LoadUnitHandle(HY,(QMI), 703))
	if S2X != null and S2X != TII then
		call SelectHeroSkill(S2X, TAI)
	endif
	if S3X != null and S3X != TII then
		call SelectHeroSkill(S3X, TAI)
	endif
	if S4X != null and S4X != TII then
		call SelectHeroSkill(S4X, TAI)
	endif
	if S5X != null and S5X != TII then
		call SelectHeroSkill(S5X, TAI)
	endif
	if S6X != null and S6X != TII then
		call SelectHeroSkill(S6X, TAI)
	endif
	set S4X = null
	set S5X = null
	set S6X = null
	set S2X = null
	set S3X = null
endfunction
function TNI takes integer E8I, unit TBI, unit TCI returns nothing
	local integer O3X = 1
	local integer K0X = GetUnitAbilityLevel(TBI, E8I)
	loop
	exitwhen O3X > K0X
		call SelectHeroSkill(TCI, E8I)
		set O3X = O3X + 1
	endloop
endfunction
function TDI takes unit SPI, unit TFI returns nothing
	local integer i = GetPlayerId(GetOwningPlayer(TFI))
	local integer Z_E = HeroCommonSkills[PlayerSkillIndex[i * HL + 1]]
	local integer Z0E = HeroCommonSkills[PlayerSkillIndex[i * HL + 2]]
	local integer TGI = HeroCommonSkills[PlayerSkillIndex[i * HL + 3]]
	local integer THI = HeroCommonSkills[PlayerSkillIndex[i * HL + 4]]
	local integer TJI = HeroUpgradeSkills[PlayerSkillIndex[i * HL + 4]]
	call UnitAddPermanentAbility(SPI, HeroChangeAbilitySkills[PlayerSkillIndex[i * HL + 1]])
	call UnitAddPermanentAbility(SPI, HeroChangeAbilitySkills[PlayerSkillIndex[i * HL + 2]])
	call UnitAddPermanentAbility(SPI, HeroChangeAbilitySkills[PlayerSkillIndex[i * HL + 3]])
	call UnitAddPermanentAbility(SPI, HeroChangeAbilitySkills[PlayerSkillIndex[i * HL + 4]])
	call AddHeroXPSimple(SPI, GetHeroXP(TFI), false)
	call SaveInteger(HY,(GetHandleId(SPI)), 368,(GetHeroXP(TFI)))
	call SaveInteger(HY,(GetHandleId(SPI)), 367, 0)
	call TNI(Z_E, TFI, SPI)
	call TNI(Z0E, TFI, SPI)
	call TNI(TGI, TFI, SPI)
	call TNI('A0NR', TFI, SPI)
	call TNI(THI, TFI, SPI)
	call TNI(TJI, TFI, SPI)
endfunction
function TKI takes unit S3X, unit S4X, integer TAI, integer S5I, integer S6I returns nothing
	if S5I > S6I then
		call SelectHeroSkill(S4X, TAI)
	elseif S6I > S5I then
		call SelectHeroSkill(S3X, TAI)
	endif
endfunction
function TLI takes unit S3X, unit S4X returns nothing
	local integer SNI = GetHeroXP(S3X)
	local integer SBI = GetHeroXP(S4X)
	local integer Q2I = GetHandleId(S3X)
	local integer Q3I = GetHandleId(S4X)
	local integer Q9I =(LoadInteger(HY,(Q2I), 368))
	local integer SEI =(LoadInteger(HY,(Q3I), 368))
	local integer ZZO
	if SNI > SBI then
		set ZZO = SNI -SBI
		call AddHeroXPSimple(S4X, ZZO, true)
		if SBI != GetHeroXP(S4X) then
			call SaveInteger(HY,(Q3I), 368,(SEI + ZZO))
		endif
	elseif SNI < SBI then
		set ZZO = SBI -SNI
		call AddHeroXPSimple(S3X, ZZO, true)
		if SNI != GetHeroXP(S3X) then
			call SaveInteger(HY,(Q2I), 368,(Q9I + ZZO))
		endif
	endif
endfunction
function TMI takes unit S3X, unit S4X returns nothing
	local integer i = GetPlayerId(GetOwningPlayer(S3X))
	local integer Z_E = HeroCommonSkills[PlayerSkillIndex[i * HL + 1]]
	local integer Z0E = HeroCommonSkills[PlayerSkillIndex[i * HL + 2]]
	local integer TGI = HeroCommonSkills[PlayerSkillIndex[i * HL + 3]]
	local integer THI = HeroCommonSkills[PlayerSkillIndex[i * HL + 4]]
	local integer TJI = HeroUpgradeSkills[PlayerSkillIndex[i * HL + 4]]
	local integer TPI = GetUnitAbilityLevel(S3X, Z_E)
	local integer TQI = GetUnitAbilityLevel(S3X, Z0E)
	local integer TSI = GetUnitAbilityLevel(S3X, TGI)
	local integer TTI = GetUnitAbilityLevel(S3X, THI)
	local integer TUI = GetUnitAbilityLevel(S3X,'A0NR')
	local integer TWI = GetUnitAbilityLevel(S3X, TJI)
	local integer TYI = GetUnitAbilityLevel(S4X, Z_E)
	local integer TZI = GetUnitAbilityLevel(S4X, Z0E)
	local integer T_I = GetUnitAbilityLevel(S4X, TGI)
	local integer T0I = GetUnitAbilityLevel(S4X, THI)
	local integer T1I = GetUnitAbilityLevel(S4X,'A0NR')
	local integer T2I = GetUnitAbilityLevel(S4X, TJI)
	call TLI(S3X, S4X)
	call TKI(S3X, S4X, Z_E, TPI, TYI)
	call TKI(S3X, S4X, Z0E, TQI, TZI)
	call TKI(S3X, S4X, TGI, TSI, T_I)
	call TKI(S3X, S4X, THI, TTI, T0I)
	call TKI(S3X, S4X, TJI, TWI, T2I)
	call TKI(S3X, S4X,'A0NR', TUI, T1I)
endfunction
function T3I takes unit S3X, unit S4X returns nothing
	if S3X != null and S4X != null then
		call TMI(S3X, S4X)
	endif
endfunction
function T4I takes nothing returns nothing
	local integer QMI = GetHandleId((LoadPlayerHandle(HY,(GetHandleId(GetTriggeringTrigger())), 370)))
	local unit S2X =(LoadUnitHandle(HY,(QMI), 699))
	local unit S3X =(LoadUnitHandle(HY,(QMI), 700))
	local unit S4X =(LoadUnitHandle(HY,(QMI), 701))
	local unit S5X =(LoadUnitHandle(HY,(QMI), 702))
	local unit S6X =(LoadUnitHandle(HY,(QMI), 703))
	call DisableTrigger(L4V)
	call T3I(S2X, S3X)
	call T3I(S2X, S4X)
	call T3I(S2X, S5X)
	call T3I(S2X, S6X)
	call T3I(S3X, S4X)
	call T3I(S3X, S5X)
	call T3I(S3X, S6X)
	call T3I(S4X, S5X)
	call T3I(S4X, S6X)
	call T3I(S5X, S6X)
	call EnableTrigger(L4V)
	set S4X = null
	set S5X = null
	set S6X = null
	set S2X = null
	set S3X = null
endfunction
function T5I takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerAddAction(t, function T4I)
	call SavePlayerHandle(HY,(GetHandleId(t)), 370,(GetOwningPlayer(GetTriggerUnit())))
	set t = null
endfunction
function T6I takes unit WUE returns nothing
	local trigger t
	call SaveUnitHandle(HY,(GetHandleId(GetOwningPlayer(WUE))), 699,(WUE))
	call SaveInteger(HY,(GetHandleId(WUE)), 367,(GetHeroXP(WUE)))
	call SaveInteger(HY,(GetHandleId(WUE)), 368, 0)
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddAction(t, function Q0I)
	call SavePlayerHandle(HY,(GetHandleId(t)), 370,(GetOwningPlayer(WUE)))
	call SaveTriggerHandle(HY,(GetHandleId(GetOwningPlayer(WUE))), 371,(t))
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .3, true)
	call TriggerAddAction(t, function QKI)
	call SavePlayerHandle(HY,(GetHandleId(t)), 370,(GetOwningPlayer(WUE)))
	call SaveTriggerHandle(HY,(GetHandleId(GetOwningPlayer(WUE))), 372,(t))
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_DROP_ITEM)
	call TriggerAddAction(t, function S1I)
	call TriggerAddCondition(t, Condition(function SLI))
	call SaveTriggerHandle(HY,(GetHandleId(GetOwningPlayer(WUE))), 369,(t))
	call ExecuteFunc("T5I")
	set t = null
endfunction
function T7I takes unit WUE, boolean RFO returns nothing
	local player p = GetOwningPlayer(WUE)
	local integer h = GetHandleId(p)
	local unit SPI
	set L5V = L5V + 1
	if L5V == 1 then
		call T6I(WUE)
		call BJDebugMsg("dividedwestand start")
	endif
	call TriggerExecute((LoadTriggerHandle(HY,(GetHandleId(GetOwningPlayer(WUE))), 371)))
	call TriggerExecute((LoadTriggerHandle(HY,(GetHandleId(GetOwningPlayer(WUE))), 372)))
	if RFO == false then
		call TRI(WUE,'A0MW')
		call TRI(WUE,'A27C')
	endif
	set SPI = CreateUnit(GetOwningPlayer(WUE),'H00J', GetUnitX(WUE), GetUnitY(WUE), 0)
	call TDI(SPI, WUE)
	call SMI(SPI, WUE)
	call SaveUnitHandle(HY, h,(699 + L5V),(SPI))
	set p = null
	set SPI = null
endfunction
function T8I takes nothing returns boolean
	local integer i = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))
	local integer Z_E = HeroCommonSkills[PlayerSkillIndex[i * HL + 1]]
	local integer Z0E = HeroCommonSkills[PlayerSkillIndex[i * HL + 2]]
	local integer TGI = HeroCommonSkills[PlayerSkillIndex[i * HL + 3]]
	local integer THI = HeroCommonSkills[PlayerSkillIndex[i * HL + 4]]
	local integer TJI = HeroUpgradeSkills[PlayerSkillIndex[i * HL + 4]]
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	if IsUnitIllusion(GetTriggerUnit())== false and GetOwningPlayer(GetTriggerUnit())== GetOwningPlayer(WUE) then
		if GetLearnedSkill()=='A0MW' or GetLearnedSkill()=='A27C' then
			call DisableTrigger(GetTriggeringTrigger())
			call T7I(GetTriggerUnit(), false)
			call EnableTrigger(GetTriggeringTrigger())
		elseif GetLearnedSkill()=='A0NR' or GetLearnedSkill()== Z_E or GetLearnedSkill()== Z0E or GetLearnedSkill()== TGI or GetLearnedSkill()== THI or GetLearnedSkill()== TJI then
			call TriggerExecute((LoadTriggerHandle(HY,(GetHandleId(GetOwningPlayer(GetTriggerUnit()))), 371)))
			call TriggerExecute((LoadTriggerHandle(HY,(GetHandleId(GetOwningPlayer(GetTriggerUnit()))), 372)))
			call DisableTrigger(GetTriggeringTrigger())
			call TRI(GetTriggerUnit(), GetLearnedSkill())
			call EnableTrigger(GetTriggeringTrigger())
		endif
	endif
	set WUE = null
	set t = null
	return false
endfunction
function L3I takes nothing returns nothing
	local unit WUE = U2
	local integer h
	set L3V = CreateTrigger()
	set L4V = L3V
	set h = GetHandleId(L3V)
	call TriggerRegisterPlayerUnitEventBJ(L3V, EVENT_PLAYER_HERO_SKILL)
	call TriggerAddCondition(L3V, Condition(function T8I))
	call SaveUnitHandle(HY, h, 2,(WUE))
	set WUE = null
endfunction
function RNE takes nothing returns nothing
	local location l = GetSpellTargetLoc()
	local unit dummyUnit = CreateUnitAtLoc(GetOwningPlayer(GetTriggerUnit()),'e00E', l, 0)
	call UnitAddAbility(dummyUnit,'A06W')
	call SetUnitAbilityLevel(dummyUnit,'A06W', GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
	if IssuePointOrderByIdLoc(dummyUnit,$D0100, l)== false then
		call IssuePointOrderByIdLoc(dummyUnit,$D0108, l)
	endif
	call ABX("Abilities\\Spells\\Orc\\EarthQuake\\EarthQuakeTarget.mdl", GetLocationX(l), GetLocationY(l), 2)
	call TerrainDeformationRippleBJ(.3, false, l, 0, 300, 100, .4, 20)
	call RemoveLocation(l)
	set l = null
	set dummyUnit = null
endfunction
function LightningStormDE takes nothing returns nothing
	if GetUnitAbilityLevel(DESourceUnit[DEI],'A3A8')> 0 then
		call CNX(DETargetUnit[DEI],'A34I', 1, .6 + .1 * GetUnitAbilityLevel(DESourceUnit[DEI],'A3A8'),'B0H8')
	endif
endfunction
function UVI takes unit WJE, unit WLE returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetUnitFacing(GetTriggerUnit()))
	call UnitAddAbility(d,'A3A8')
	call TGV(10)
	call SetUnitAbilityLevel(d,'A3A8', GetUnitAbilityLevel(GetTriggerUnit(),'A06V'))
	call IssueTargetOrderById(d,$D0097, GetSpellTargetUnit())
	set d = null
endfunction
function RBE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call UVI(GetTriggerUnit(), GetSpellTargetUnit())
	endif
endfunction
function UEI takes nothing returns boolean
	return IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and UnitIsDead(GetFilterUnit())== false and GetUnitAbilityLevel(GetFilterUnit(),'Avul')== 0
endfunction
function UXI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local integer level =(LoadInteger(HY, h, 5))
	local group g
	local unit u
	local real d
	local real a
	local real x
	local real y
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	if GetTriggerEvalCount(t)> 40 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set g = LoginGroup(353)
		set U2 = triggerUnit
		call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), 500 +$C, Condition(function UEI))
		set u = GroupPickRandomUnit(g)
		if u == null then
			set d = GetRandomReal(175, 400)
			set a = GetRandomReal(0, 6)
			set x = GetUnitX(triggerUnit)+ d * Cos(a)
			set y = GetUnitY(triggerUnit)+ d * Sin(a)
			call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\SteamTank\\SteamTankImpact.mdl", x, y))
		else
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SteamTank\\SteamTankImpact.mdl", u, "origin"))
			call UnitDamageTargetEx(dummyUnit, u, 5, 12.5 * level)
		endif
		call LogoutGroup(g)
	endif
	set u = null
	set g = null
	set t = null
	set triggerUnit = null
	set dummyUnit = null
	return false
endfunction
function RCE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = GetTriggerUnit()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'e00E', GetUnitX(triggerUnit), GetUnitY(triggerUnit), 0)
	if GetUnitTypeId(triggerUnit)=='e00E' then
		set triggerUnit = Player__Hero[GetPlayerId(GetOwningPlayer(triggerUnit))]
	endif
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RocketMissile\\RocketMissile.mdl", triggerUnit, "hand right"))
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveInteger(HY, h, 5,(GetUnitAbilityLevel(triggerUnit,'A20T')))
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerAddCondition(t, Condition(function UXI))
	set t = null
	set triggerUnit = null
	set dummyUnit = null
endfunction
function UOI takes nothing returns nothing
	local unit WUE = L6V
	local unit targetUnit = GetEnumUnit()
	call UnitDamageTargetEx(WUE, targetUnit, 1, L7V)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", targetUnit, "origin"))
	set WUE = null
	set targetUnit = null
endfunction
// 脉冲新星动作
function URI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 2)
	local integer lv = GetUnitAbilityLevel(u,'A21F')
	local group g
	local boolean b = GetUnitAbilityLevel(u,'A21G') > 0
	if not b then
		set L7V = 70 + 30 * lv
	else
		set lv = GetUnitAbilityLevel(u,'A21G')
		set L7V = 140 + 20 * lv
	endif
	if GetTriggerEvalCount(t) == 1 and b then
		call UnitAddPermanentAbility(u,'A345')
	endif
	set b = false
	if LoadInteger(HY, GetHandleId(u), 704) == - 1 then
		if not PlayerHaveAbilityByActive(GetOwningPlayer(u), 'A21F') then
			set b = true //如果窃取技能丢失,则判断单位是否选择了该技能,如果没选择则设置b=true结束此触发
		endif
	endif
	//脉冲新星结束 事件==死亡 or 魔法不足 or 释放关闭技能 LoadInteger(HY, GetHandleId(u), 704) == -1 and not 
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or GetUnitState(u, UNIT_STATE_MANA)< 20 * lv or b or( GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT and( GetSpellAbilityId()=='A21H' or GetSpellAbilityId()=='A27H' or GetSpellAbilityId()=='A30J' )) then
		set b = Rubick_AbilityFilter(u, 'A21F')
		if b then
			call S9E(GetOwningPlayer(u),'A21F', true)
		endif
		if b or LoadInteger(HY, GetHandleId(u), 704)=='A21G' then
			call S9E(GetOwningPlayer(u),'A21G', true)
		endif
		call UnitRemoveAbility(u,'A345')
		call S9E(GetOwningPlayer(u),'A21H', false)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()!= EVENT_UNIT_SPELL_EFFECT then
		call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)-20 * lv)
		set U2 = u
		set L6V = u
		set g = LoginGroup(354)
		call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 475, Condition(function DPX))
		call ForGroup(g, function UOI)
		call LogoutGroup(g)
		set g = null
	endif
	set t = null
	set u = null
	return false
endfunction
//脉冲新星
function RQE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", u, "origin"))
	call S9E(GetOwningPlayer(u),'A21F', false)
	call S9E(GetOwningPlayer(u),'A21G', false)
	call S9E(GetOwningPlayer(u),'A21H', true)
	call UnitAddPermanentAbility(u,'A21H')
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function URI))
	call SaveUnitHandle(HY, h, 2,(u))
	call TriggerEvaluate(t)
	set u = null
	set t = null
endfunction
function UII takes nothing returns boolean
	return IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and(DOX(GetFilterUnit())== false or UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2))) and RFX(GetFilterUnit())== false
endfunction
function UAI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local unit UNI =(LoadUnitHandle(HY, h, 374))
	local integer level =(LoadInteger(HY, h, 5))
	local integer UBI =(LoadInteger(HY, h,$E9))
	local integer KLR =(LoadInteger(HY, h, 12))
	local unit dummyUnit
	local group g
	local real a
	local real x
	local real y
	local integer UCI =(LoadInteger(HY, h, 720))
	if UCI > 0 then
		set UCI = UCI -1
		call SaveInteger(HY, h, 720,(UCI))
		set WUE = null
		set t = null
		set targetUnit = null
		set UNI = null
		return false
	endif
	if GetDistanceBetween(GetUnitX(UNI), GetUnitY(UNI), GetUnitX(targetUnit), GetUnitY(targetUnit))> 20 then
		set a = AngleBetweenXY(GetUnitX(UNI), GetUnitY(UNI), GetUnitX(targetUnit), GetUnitY(targetUnit))
		call SetUnitFacing(UNI, a)
		set x = GetUnitX(UNI)+ 17 * Cos(a * bj_DEGTORAD)
		set y = GetUnitY(UNI)+ 17 * Sin(a * bj_DEGTORAD)
		call SetUnitX(UNI, x)
		call SetUnitY(UNI, y)
	else
		if UnitIsDead(targetUnit)== false then
			if IsMagicImmuneUnit(targetUnit)== false then
				set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
				call UnitAddPermanentAbility(dummyUnit,'A091')
				call SetUnitAbilityLevel(dummyUnit,'A091', LoadInteger(HY, h, 6))
				if B0R(dummyUnit, targetUnit,$D0102) then
					call AddAbilityToTimed(targetUnit,'A3JM', 1, 4, 0)
				endif
			endif
			if UBI == 1 and not LoadBoolean(HY, h, 0) then
				if GetUnitAbilityLevel(targetUnit,'A3E9')== 1 then
					if UnitHasSpellShield(WUE)== false then
						call SaveUnitHandle(VV,'A3E9', 0, targetUnit)
						call SaveUnitHandle(VV,'A3E9', 1, WUE)
						call SaveInteger(VV,'A3E9', 0, level)
						if KLR > 100  then
							call SaveInteger(VV,'A3E9', 1,'A08H')
						else
							call SaveInteger(VV,'A3E9', 1,'A05T')
						endif
						call ExecuteFunc("UDI")
					else
						call AJO(WUE)
					endif
				endif
			endif
		endif
		if UBI > KLR then
			call RemoveUnit(UNI)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			set g = LoginGroup(355)
			set U2 = WUE
			call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 600, Condition(function UII))
			call GroupRemoveUnit(g, targetUnit)
			set targetUnit = GroupPickRandomUnit(g)
			call LogoutGroup(g)
			if targetUnit == null then
				call RemoveUnit(UNI)
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			else
				call SaveInteger(HY, h, 720, 10)
				call SaveInteger(HY, h,$E9,(UBI + 1))
				call SaveUnitHandle(HY, h, 17,(targetUnit))
				if UBI > 60 then
					call UnitAddPermanentAbility(UNI,'A3C9')
				endif
			endif
		endif
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set UNI = null
	set dummyUnit = null
	set g = null
	return false
endfunction
function UFI takes nothing returns nothing
	local timer t2 = GetExpiredTimer()
	local integer h2 = GetHandleId(t2)
	local unit WUE = LoadUnitHandle(HY, h2, 0)
	local unit targetUnit = LoadUnitHandle(HY, h2, 1)
	local integer level = LoadInteger(HY, h2, 0)
	local integer KLR =$A
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit UNI
	local unit d
	local integer UGI = level
	if LoadInteger(HY, h2, 1)=='A08H' then
		set KLR = 99999
		set UGI = 1 + GetUnitAbilityLevel(WUE,'A08H')
	endif
	set UNI = CreateUnit(GetOwningPlayer(WUE),'e009', GetUnitX(WUE), GetUnitY(WUE), 0)
	if GetUnitTypeId(WUE)=='e00E' then
		call SaveUnitHandle(HY, h, 2, Player__Hero[GetPlayerId(GetOwningPlayer(WUE))])
	else
		call SaveUnitHandle(HY, h, 2,(WUE))
	endif
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveUnitHandle(HY, h, 374,(UNI))
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY,(h), 6,(UGI))
	call SaveInteger(HY, h,$E9, 1)
	call SaveInteger(HY, h, 12,(KLR))
	call SaveInteger(HY, h, 720, 0)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function UAI))
	if LoadBoolean(HY, h2, 0) then
		call SaveBoolean(HY, h, 0, true)
		set d = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitAddAbility(d,'A05T')
		call THV(d, "thunderbolt", targetUnit)
		set d = null
	endif
	call FlushChildHashtable(HY, h2)
	call DestroyTimer(t2)
	set WUE = null
	set targetUnit = null
	set UNI = null
	set t = null
	set t2 = null
endfunction
function UDI takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call T4V(LoadUnitHandle(VV,'A3E9', 0))
	call TimerStart(t, 0, false, function UFI)
	call SaveUnitHandle(HY, h, 0, LoadUnitHandle(VV,'A3E9', 0))
	call SaveUnitHandle(HY, h, 1, LoadUnitHandle(VV,'A3E9', 1))
	call SaveInteger(HY, h, 0, LoadInteger(VV,'A3E9', 0))
	call SaveInteger(HY, h, 1, LoadInteger(VV,'A3E9', 1))
	call SaveBoolean(HY, h, 0, true)
	set t = null
	call FlushChildHashtable(VV,'A3E9')
endfunction
function RTE takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, 0, false, function UFI)
	call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
	call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(GetTriggerUnit(),'A05T'))
	call SaveInteger(HY, h, 1, GetSpellAbilityId())
	set t = null
endfunction
function UHI takes unit u, integer d returns nothing
	local texttag t = CreateTextTag()
	call SetTextTagText(t, "+" + I2S(d)+ " " + GetObjectName('n0LQ'), .03)
	call SetTextTagPosUnit(t, u, 0)
	call SetTextTagColorBJ(t, 50, 75, 255, 15)
	call SetTextTagVelocity(t, 0, .035)
	call SetTextTagFadepoint(t, 3)
	call SetTextTagLifespan(t, 2.5)
	call SetTextTagPermanent(t, false)
	call SetTextTagVisibility(t, UnitVisibleToPlayer(u, LocalPlayer) or IsObserver)
	set t = null
endfunction
function UJI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local real mp = LoadReal(HY, h, 0)
	call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ mp)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set u = null
endfunction
function UKI takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t
	local integer h
	if GetUnitTypeId(WUE)=='e00C' then
		set WUE = Player__Hero[GetPlayerId(GetOwningPlayer(WUE))]
	endif
	if GetWidgetLife(WUE)> 1 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 0, false)
		call TriggerAddCondition(t, Condition(function UJI))
		call SaveUnitHandle(HY, h, 0, WUE)
		call SaveReal(HY, h, 0, GetWidgetLife(targetUnit)*(GetUnitAbilityLevel(WUE,'A053')*(.15)+ .1))
		call UHI(targetUnit, R2I(GetWidgetLife(targetUnit)*(GetUnitAbilityLevel(WUE,'A053')*(.15)+ .1)))
		set YB = true
		call UnitDamageTargetEx(WUE, targetUnit, 1, 99999)
		call UnitDamageTargetEx(WUE, targetUnit, 2, 99999)
		call UnitDamageTargetEx(WUE, targetUnit, 3, 99999)
		set t = null
	endif
	set WUE = null
	set targetUnit = null
endfunction
function R_E takes nothing returns nothing
	if IsMessengerUnit(GetSpellTargetUnit())== false then
		call UKI()
	endif
endfunction
function ULI takes nothing returns nothing
	call ResetUnitVertexColor(GetEnumUnit())
	call UnitRemoveAbility(GetEnumUnit(),'A30A')
	call UnitRemoveAbility(GetEnumUnit(),'B30A')
endfunction
function UMI takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local group g = LoadGroupHandle(HY, h, 1)
	call ForGroup(g, function ULI)
	call GroupClear(g)
	call DestroyGroup(g)
	set g = null
	set t = null
endfunction
function UPI takes nothing returns boolean
	return IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(Q5V)) and IsAliveNotStrucNotWard(GetFilterUnit()) and IsMagicImmuneUnit(GetFilterUnit())== false
endfunction
function UQI takes nothing returns nothing
	local unit u = GetEnumUnit()
	call UnitDamageTargetEx(LoadUnitHandle(VV,'A07F', 0), u, 1, 50 + 25 * Q2)
	if UnitAlive(u) then
		call UnitAddPermanentAbility(u,'A30A')
		call SetUnitFrostVertexColor(u)
	endif
	set u = null
endfunction
function USI takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local group g = CreateGroup()
	call TriggerRegisterTimerEvent(t, 4, false)
	call TriggerAddCondition(t, Condition(function UMI))
	call TriggerRegisterDeathEvent(t, WLE)
	call UnitDamageTargetEx(u, WLE, 1, 50 * GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl", WLE, "origin"))
	set Q5V = u
	call GroupEnumUnitsInRange(g, GetUnitX(WLE), GetUnitY(WLE),$E1, Condition(function UPI))
	call GroupAddUnit(g, WLE)
	call SaveUnitHandle(VV,'A07F', 0, u)
	set Q2 = GetUnitAbilityLevel(u,'A07F')
	call ForGroup(g, function UQI)
	call SaveGroupHandle(HY, h, 1, g)
	call RemoveSavedHandle(VV,'A07F', 0)
	set g = null
	set WLE = null
	set u = null
	set t = null
endfunction
function D8E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call USI()
	endif
endfunction
function UTI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	if UnitAlive(u) then
		call UnitRemoveAbility(u,'A308')
		call UnitRemoveAbility(u,'B308')
	endif
	if GetUnitAbilityLevel(u,'B308')== 0 then
		call SaveBoolean(HY, GetHandleId(u),$7C7, false)
		call RemoveSavedHandle(HY, GetHandleId(u),$7C7)
		call FlushChildHashtable(HY, GetHandleId(t))
		call DestroyTimer(t)
	else
		call TimerStart(t, 1, true, function UTI)
	endif
	set t = null
	set u = null
endfunction
function FrostArmorActions takes unit u, unit t returns nothing
	local timer tt
	if not IsMagicImmuneUnit(u) then
		call UnitAddPermanentAbility(u,'A308')
		if(LoadBoolean(HY, GetHandleId(u),$7C7)) then
			set tt = LoadTimerHandle(HY, GetHandleId(u),$7C7)
			call TimerStart(tt, 2, false, function UTI)
		else
			set tt = CreateTimer()
			call TimerStart(tt, 2, false, function UTI)
			call SaveUnitHandle(HY, GetHandleId(tt), 0, u)
			call SaveBoolean(HY, GetHandleId(u),$7C7, true)
			call SaveTimerHandle(HY, GetHandleId(u),$7C7, tt)
		endif
	endif
	set tt = null
endfunction
function RUE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x1 = GetUnitX(u)
	local real y1 = GetUnitY(u)
	local real a
	local real x2
	local real y2
	local integer lv = GetUnitAbilityLevel(u,'A0X5')
	local real damage
	local real dur
	local unit target = null
	if GetSpellTargetUnit()!= null then
		set x2 = GetUnitX(GetSpellTargetUnit())
		set y2 = GetUnitY(GetSpellTargetUnit())
	else
		set x2 = GetSpellTargetX()
		set y2 = GetSpellTargetY()
	endif
	set a = Atan2(y2 -y1, x2 -x1)
	set x2 = x1 + 700 * Cos(a)
	set y2 = y1 + 700 * Sin(a)
	if lv == 1 then
		set damage = 60
		set dur = .5
	elseif lv == 2 then
		set damage = 130
		set dur = 1
	elseif lv == 3 then
		set damage = 200
		set dur = 1.5
	elseif lv == 4 then
		set damage = 260
		set dur = 2
	endif
	if GetSpellTargetUnit()!= null and UnitHasSpellShield(GetSpellTargetUnit()) then
		set target = GetSpellTargetUnit()
	endif
	call UnitSpellEffectImpale(u, target, damage, dur, .52, x1, y1, x2, y2, 150, null, true, 1600)
	set u = null
	set target = null
endfunction

// 0秒后重置大小
function VoodooCallBack takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local unit whichUnit = LoadUnitHandle( HY, h, 0 )
	
	call SetUnitCurrentScaleEx(whichUnit, GetUnitCurrentScale(whichUnit))
	set whichUnit = null
	
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(trig)
	set trig = null
	return false
endfunction

function SpellEffect__Voodoo takes nothing returns nothing
	local integer h = CreateTimerEventTrigger( 0., false, function VoodooCallBack )
	local integer id = GetSpellAbilityId()
	local unit spellUnit = GetTriggerUnit()
	local real dur = YDWEGetUnitAbilityDataReal( spellUnit, id, GetUnitAbilityLevel(spellUnit, id), ABILITY_DATA_HERODUR )
	call SaveUnitHandle( HY, h, 0, GetSpellTargetUnit() )
	set h = CreateTimerEventTrigger( dur + 0.01, false, function VoodooCallBack )
	call SaveUnitHandle( HY, h, 0, GetSpellTargetUnit() )
	set spellUnit = null
endfunction

function UWI takes nothing returns nothing
	local real ZCE = 475 + 125 * GetUnitAbilityLevel(UA,'A09W')
	call UnitDamageTargetEx(UA, GetEnumUnit(), 1, ZCE)
endfunction
function UYI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	local integer level = LoadInteger(HY, h, 0)
	local group g = LoginGroup(356)
	set U2 = WJE
	call GroupEnumUnitsInRange(g, GetUnitX(WLE), GetUnitY(WLE), 300 + 25, Condition(function DQX))
	call GroupRemoveUnit(g, WLE)
	if FirstOfGroup(g)!= null then
		set UA = WJE
		call ForGroup(g, function UWI)
	endif
	call LogoutGroup(g)
	call DestroyTimerAndFlushHT_HY(t)
	set t = null
	set g = null
	set WLE = null
	set WJE = null
endfunction
function Z6V takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .25, false, function UYI)
	call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
	call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
	set t = null
endfunction
function LRE takes nothing returns nothing
	if IsMagicImmuneUnit(GetSpellTargetUnit()) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n0LR'))
	endif
endfunction
function UZI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 14))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosDone.mdl", whichUnit, "origin"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl", whichUnit, "origin"))
	call UnitRemoveAbility(whichUnit,'A0ZC')
	call UnitRemoveAbility(whichUnit,'B00V')
	//call UnitRemoveAbility(whichUnit,'A521')
	//call ResetUnitVertexColor(whichUnit)
	//call SetUnitVertexColorEx(whichUnit,-1,-1,-1, 255)
	call RemoveSavedInteger(ExtraHT, GetHandleId(whichUnit), 'QM02')
	call RemoveUnit(LoadUnitHandle(HY, h, 15))
	call SetUnitImitateMoveSpeed(whichUnit, 0, 0)
	call UnitAddMaxLife(whichUnit,-1 * LoadInteger(HY, h, 16))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction
function Shapeshift_CallBack takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 14))
	local unit d = LoadUnitHandle(HY, h, 15)
	local integer I2X = LoadInteger(HY, h, 16)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosDone.mdl", whichUnit, "origin"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl", whichUnit, "origin"))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 18 -0.1, false)
	call TriggerRegisterDeathEvent(t, whichUnit)
	call TriggerAddCondition(t, Condition(function UZI))
	call SaveUnitHandle(HY, h, 14,(whichUnit))
	call SaveUnitHandle(HY, h, 15, d)
	call SaveInteger(HY, h, 16, I2X)
	call SetUnitImitateMoveSpeed(whichUnit, 999, 650)
	set d = null
	set t = null
	set whichUnit = null
	return false
endfunction
// 变狼
function ShapeshiftActions takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = GetTriggerUnit()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(whichUnit),'e01V', 0, 0, 0)
	local real dur = 18
	local real hp = GetWidgetLife(whichUnit)
	local integer level = GetUnitAbilityLevel(whichUnit, GetSpellAbilityId())
	local real extraMaxLife = 100 * level
	call UnitAddMaxLife(whichUnit, R2I(extraMaxLife))
	call SaveInteger(HY, h, 16, R2I(extraMaxLife))
	call SetWidgetLife(whichUnit, hp + extraMaxLife)
	call UnitAddPermanentAbility(dummyUnit,'A0ZC')
	call UnitApplyTimedLife(dummyUnit,'BTLF', dur)
	call SaveInteger(ExtraHT, GetHandleId(whichUnit), 'QM02', level)
	//call SetUnitVertexColorEx(whichUnit, 255, 100, 255, 175)
	call TriggerRegisterTimerEvent(t, .1, false)
	call TriggerAddCondition(t, Condition(function Shapeshift_CallBack))
	call SaveUnitHandle(HY, h, 14,(whichUnit))
	call SaveUnitHandle(HY, h, 15, dummyUnit)
	set t = null
	set whichUnit = null
	set dummyUnit = null
endfunction
function SpellEffect__Shapeshift takes nothing returns nothing
	if GetUnitTypeId(GetTriggerUnit())!='E015' then
		call ShapeshiftActions()
	endif
endfunction
function R3E takes nothing returns nothing
	local unit U1I
	local integer id = 0
	local integer level = GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId())
	local real x = GetUnitX(GetTriggerUnit())
	local real y = GetUnitY(GetTriggerUnit())
	local real a = GetUnitFacing(GetTriggerUnit())
	if level == 1 then
		set id ='o005'
	elseif level == 2then
		set id ='o006'
	elseif level == 3 then
		set id ='o007'
	else
		set id ='o00F'
	endif
	set U1I = CreateUnit(GetTriggerPlayer(), id, x + 30 * Cos(a * bj_DEGTORAD), y + 30 * Sin(a * bj_DEGTORAD), a)
	call UnitApplyTimedLife(U1I,'BTLF', 55)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl", U1I, "origin"))
	set U1I = CreateUnit(GetTriggerPlayer(), id, x + 30 * Cos(a * bj_DEGTORAD), y + 30 * Sin(a * bj_DEGTORAD), a)
	call UnitApplyTimedLife(U1I,'BTLF', 55)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl", U1I, "origin"))
	call S9E(GetOwningPlayer(GetTriggerUnit()),'A03B', true)
	set U1I = null
endfunction
function Z0O takes nothing returns nothing
	local unit WUE = IM
	local unit targetUnit = AM
	local unit dummyUnit =(LoadUnitHandle(HY,(GetHandleId(WUE)),$DB))
	call SaveUnitHandle(HY,(GetHandleId(WUE)),$DB,(dummyUnit))
	call SetUnitOwner(dummyUnit, GetOwningPlayer(targetUnit), true)
	set WUE = null
	set targetUnit = null
	set dummyUnit = null
endfunction
function W4X takes nothing returns nothing
	local unit triggerUnit = VK
	local unit dummyUnit =(LoadUnitHandle(HY,(GetHandleId(triggerUnit)),$DB))
	if dummyUnit != null and GetUnitTypeId(dummyUnit)=='e01V' then
		call RemoveUnit(dummyUnit)
	endif
	set triggerUnit = null
	set dummyUnit = null
endfunction
function U2I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	if dummyUnit != null and GetUnitTypeId(dummyUnit)=='e01V' then
		if UnitIsDead(WUE)== false then
			call SetUnitX(dummyUnit, GetUnitX(WUE))
			call SetUnitY(dummyUnit, GetUnitY(WUE))
		endif
	endif
	set t = null
	set dummyUnit = null
	set WUE = null
	return false
endfunction
function PFE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(triggerUnit,'A03E')
	local unit dummyUnit
	local trigger t
	local integer h
	if level == 1 then
		set dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'e01V', 0, 0, 0)
		call UnitAddPermanentAbility(dummyUnit,'A0ZJ')
		call SaveUnitHandle(HY,(GetHandleId(triggerUnit)),$DB,(dummyUnit))
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerAddCondition(t, Condition(function U2I))
		call TriggerRegisterTimerEvent(t, .2, true)
		call SaveUnitHandle(HY, h, 2,(triggerUnit))
		call SaveUnitHandle(HY, h, 19,(dummyUnit))
		set t = null
	else
		set dummyUnit =(LoadUnitHandle(HY,(GetHandleId(triggerUnit)),$DB))
	endif
	if level == 2 then
		call UnitRemoveAbility(dummyUnit,'A0ZJ')
		call UnitAddPermanentAbility(dummyUnit,'A0ZI')
		call UnitRemoveAbility(triggerUnit,'B09B')
	elseif level == 3 then
		call UnitRemoveAbility(dummyUnit,'A0ZJ')
		call UnitRemoveAbility(dummyUnit,'A0ZI')
		call UnitRemoveAbility(triggerUnit,'B09A')
		call UnitRemoveAbility(triggerUnit,'B09B')
		call UnitAddPermanentAbility(dummyUnit,'A0ZH')
	elseif level == 4 then
		call UnitRemoveAbility(dummyUnit,'A0ZJ')
		call UnitRemoveAbility(dummyUnit,'A0ZI')
		call UnitRemoveAbility(dummyUnit,'A0ZH')
		call UnitRemoveAbility(triggerUnit,'B097')
		call UnitRemoveAbility(triggerUnit,'B09A')
		call UnitRemoveAbility(triggerUnit,'B09B')
		call UnitAddPermanentAbility(dummyUnit,'A0ZG')
	endif
	set triggerUnit = null
	set dummyUnit = null
endfunction
// 精灵狼
function LycanWolfEnterMapActions takes unit u returns nothing
	local integer i = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A0A8')
	if i > 0 then
		call UnitAddPermanentAbilitySetLevel(u,'A3IP', i)
		//call UnitAddPermanentAbilitySetLevel(u,'A3IQ', i)
	endif
endfunction
function IVE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local unit dummyUnit
	local integer i = 1
	local player p
	local integer TXE
	local integer TOE
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0ZF')
	if level == 1 then
		set TXE ='A104'
		set TOE ='A107'
	elseif level == 2 then
		set TXE ='A101'
		set TOE ='A106'
	elseif level == 3 then
		set TXE ='A102'
		set TOE ='A105'
	elseif level == 4 then
		set TXE ='A103'
		set TOE ='A108'
	endif
	loop
	exitwhen i > 5
		if IsSentinelsPlayer(GetOwningPlayer(triggerUnit)) then
			set p = Sentinels[i]
		else
			set p = Scourges[i]
		endif
		set dummyUnit = CreateUnit(p,'e01V', 0, 0, 0)
		call UnitAddPermanentAbility(dummyUnit, TXE)
		call UnitAddPermanentAbility(dummyUnit, TOE)
		call UnitApplyTimedLife(dummyUnit,'BTLF', 10)
		set i = i + 1
	endloop
	set triggerUnit = null
	set dummyUnit = null
	set p = null
endfunction
function IXE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer tl = GetHeroLevel(targetUnit)
	local integer level = GetUnitAbilityLevel(WUE,'A094')
	local real ZCE = 75 + 50 * level
	if(IsUnitType(WUE, UNIT_TYPE_HERO) or HaveSavedHandle(HY, GetHandleId(WUE), 0)) and(ModuloInteger(tl, 7 -level)== 0 or tl == 25) then
		set ZCE = ZCE + GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)* .2
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Demon\\DemonBoltImpact\\DemonBoltImpact.mdl", targetUnit, "chest"))
	endif
	call UnitDamageTargetEx(WUE, targetUnit, 1, ZCE)
	call TDV(targetUnit)
	set WUE = null
	set targetUnit = null
endfunction
function U4I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit U5I = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	if GetUnitAbilityLevel(WLE,'A464')== 0 or UnitIsDead(WLE) then
		call UnitRemoveSilenceAndLocked(WLE, 'A464','B464')
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	else
		call UnitDamageTargetEx(U5I, WLE, 7, LoadReal(HY, h, 0))
	endif
	if LoadBoolean(HY, h, 0) then
		call RemoveSavedBoolean(HY, h, 0)
		call TimerStart(t, 1, true, function U4I)
	endif
	set U5I = null
	set WLE = null
	set t = null
endfunction
function U6I takes unit u, unit WLE returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)

	call UnitAddSilenceAndLocked(WLE, 'A464','B464')

	call TimerStart(t, 0, false, function U4I)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveUnitHandle(HY, h, 1, WLE)
	call SaveReal(HY, h, 0, GetUnitAbilityLevel(u,'A0MU')* 25. + 5.)
	call SaveBoolean(HY, h, 0, true)
	set t = null
endfunction
function U7I takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local unit d
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		call AddAbilityToTimed(targetUnit,'A464', 1, 14,'B464')
		call U6I(spellUnit, targetUnit)
	else
		set d = CreateUnit(GetOwningPlayer(spellUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitAddAbility(d,'A465')
		call SetUnitAbilityLevel(d,'A465', GetUnitAbilityLevel(spellUnit,'A0MU'))
		call IssueTargetOrderById(d,$D0267, targetUnit)
		set d = null
	endif
	if S3V(targetUnit) then
		call IssueImmediateOrderById(targetUnit,$D0004)
	endif
	set spellUnit = null
	set targetUnit = null
endfunction
function IBE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call GCX(GetSpellTargetUnit())
		call U7I()
	endif
endfunction
function U8I takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetOrderTargetUnit()
	if IsUnitType(WLE, UNIT_TYPE_ANCIENT) and not IsBearUnit(WLE) then
		call EXStopUnit(WJE)
		call InterfaceErrorForPlayer(GetOwningPlayer(WJE), GetObjectName('n0K9'))
	endif
	set WJE = null
	set WLE = null
endfunction
function T_E takes nothing returns nothing
	local unit u = U2
	local integer hu = GetHandleId(u)
	local integer TXE = LoadInteger(K, hu,'DEVR'+ 0)
	local integer TOE = LoadInteger(K, hu,'DEVR'+ 1)
	local boolean U9I = LoadBoolean(K, hu,'DEVR'+ 0)
	local boolean WVI = LoadBoolean(K, hu,'DEVR'+ 1)
	if U9I == false then
		call UnitRemoveAbility(u, TXE)
		call UnitAddPermanentAbility(u, TXE)
	endif
	if WVI == false then
		call UnitRemoveAbility(u, TOE)
		call UnitAddPermanentAbility(u, TOE)
	endif
	set u = null
endfunction
function WEI takes unit u returns nothing
	call UnitRemoveAbility(u, LoadInteger(K, GetHandleId(u),'DEVR'+ 0))
	call UnitRemoveAbility(u, LoadInteger(K, GetHandleId(u),'DEVR'+ 1))
	call RemoveSavedInteger(K, GetHandleId(u),'DEVR'+ 0)
	call RemoveSavedInteger(K, GetHandleId(u),'DEVR'+ 1)
	call RemoveSavedBoolean(K, GetHandleId(u),'DEVR'+ 0)
	call RemoveSavedBoolean(K, GetHandleId(u),'DEVR'+ 1)
endfunction
function WXI takes unit u, integer WPV returns nothing
	local integer TXE = 0
	local integer TOE = 0
	local boolean U9I = false
	local boolean WVI = false
	local integer WOI = 0
	local integer WRI = 0
	local integer hu = GetHandleId(u)
	if WPV =='n0HX' then
		set TXE ='A1OQ'
	elseif WPV =='nomg' then
		set TXE ='A1OR'
	elseif WPV =='nfpu' then
		set TXE ='A1OS'
		set TOE ='QDP3'
		set WVI = true
		set WRI ='S00N'
	elseif WPV =='nstl' then
		set TXE ='A1OT'
	elseif WPV =='nsat' then
		set TXE ='A1OU'
	elseif WPV =='nsth' then
		set TXE ='A1OV'
		set TOE ='QDP0'
		set WVI = true
		set WRI ='A1OW'
	elseif WPV =='n00S' then
		set TXE ='QDP6'
		set WOI ='A1OX'
		set U9I = true
		// set WRI ='A1OY'
	elseif WPV =='nkol' then
		set TXE ='QDP1'
		set WOI ='S00M'
		set U9I = true
	elseif WPV =='nfsh' then
		set TXE ='A1OZ'
		set TOE ='QDP2'
		set WRI ='A2AG'
		set WVI = true
	elseif WPV =='ncnk' then
		set TXE ='A1P0'
	elseif WPV =='ngns' then
		set TXE ='QDP4'
		set WOI ='A1P1'
		set U9I = true
	elseif WPV =='ngh1' then
		set TXE ='QDP7'
		set WOI ='A1P7'
		set U9I = true
		set WRI ='A1PA'
	elseif WPV =='nowe' then
		set TXE ='QDP5'
		set WOI ='A1P3'
		set U9I = true
		set TOE ='A1P4'
	elseif WPV =='ndtw' then
		set TXE ='A1P5'
		set TOE ='A1P6'
	elseif WPV =='nwlg' then
		set TXE ='QDP8'
		set WOI ='A1OY'
		set U9I = true
	elseif WPV =='n026' then
		set TXE ='A36K'
		set TOE ='A36J'
	elseif WPV =='n127' then
		set TXE ='A36K'
	endif
	if TXE != 0 and(LoadInteger(K, hu,'DEVR'+ 0)!= TXE or LoadInteger(K, hu,'DEVR'+ 1)!= TOE) then
		call WEI(u)
		call UnitAddPermanentAbility(u, TXE)
		if U9I then
			call SetPlayerAbilityAvailable(GetOwningPlayer(u), TXE, false)
			call UnitMakeAbilityPermanent(u, true, WOI)
			call UnitMakeAbilityPermanent(u, true, WRI)
		endif
		if TOE != 0 then
			call UnitAddPermanentAbility(u, TOE)
			if WVI then
				call SetPlayerAbilityAvailable(GetOwningPlayer(u), TOE, false)
				call UnitMakeAbilityPermanent(u, true, WOI)
				call UnitMakeAbilityPermanent(u, true, WRI)
			endif
		endif
		call SaveInteger(K, hu,'DEVR'+ 0, TXE)
		call SaveBoolean(K, hu,'DEVR'+ 0, U9I)
		call SaveInteger(K, hu,'DEVR'+ 1, TOE)
		call SaveBoolean(K, hu,'DEVR'+ 1, WVI)
	endif
endfunction
function WII takes real r returns string
	local string c1 = "|c00ff0303"
	local string c = "||"
	local string p = " "
	local string s = c1 + c + "|r"
	local string JVX
	if r > 85 then
		set JVX = s + p + s + p + s + p + s + p + s + p + s + p + s
	elseif r > 70 then
		set JVX = s + p + s + p + s + p + s + p + s + p + s + p + c
	elseif r > 55 then
		set JVX = s + p + s + p + s + p + s + p + s + p + c + p + c
	elseif r > 40 then
		set JVX = s + p + s + p + s + p + s + p + c + p + c + p + c
	elseif r > 25 then
		set JVX = s + p + s + p + s + p + c + p + c + p + c + p + c
	elseif r >$A then
		set JVX = s + p + s + p + c + p + c + p + c + p + c + p + c
	elseif r > 0 then
		set JVX = s + p + c + p + c + p + c + p + c + p + c + p + c
	else
		set JVX = c + p + c + p + c + p + c + p + c + p + c + p + c
	endif
	return JVX
endfunction
function WAI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local integer level =(LoadInteger(HY, h, 5))
	local real HP =(LoadReal(HY, h,$E8))
	local texttag tt =(LoadTextTagHandle(HY, h,$E7))
	local integer EVX = GetTriggerEvalCount(t)
	local real WNI = RMaxBJ(HP -EVX, 0)
	call SetTextTagText(tt, WII( 100 * WNI / HP), .018)
	call SetTextTagPosUnit(tt, triggerUnit, 0)
	call SetTextTagVisibility(tt, UnitVisibleToPlayer(triggerUnit, LocalPlayer) or IsObserver)
	if WNI == 0 then
		call BMX(GetOwningPlayer(triggerUnit), triggerUnit, 25 * level)
	endif
	if WNI == 0 or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call S9E(GetOwningPlayer(triggerUnit),'A10R', true)
		call UnitRemoveAbility(triggerUnit,'A10S')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call DestroyTextTag(tt)
	endif
	set t = null
	set triggerUnit = null
	set tt = null
	return false
endfunction
function IOE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(triggerUnit,'A10R')
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real HP = GetWidgetLife(targetUnit)
	local texttag tt = CreateTextTag()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'e00E', 0, 0, 0)
	call AddLightningToTimed("SPLK", GetUnitX(triggerUnit), GetUnitY(triggerUnit), GetUnitX(targetUnit), GetUnitY(targetUnit), .1, .1, .2, .9, .5)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\Devour\\DevourEffectArt.mdl", GetUnitX(targetUnit), GetUnitY(targetUnit)))
	call SetTextTagText(tt, WII( 100 ), .018)
	call SetTextTagPosUnit(tt, triggerUnit, 0)
	call SetTextTagVisibility(tt, UnitVisibleToPlayer(triggerUnit, LocalPlayer))
	call SetTextTagPermanent(tt, true)
	call S9E(GetOwningPlayer(triggerUnit),'A10R', false)
	call UnitAddPermanentAbility(triggerUnit,'A10S')
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call SaveTextTagHandle(HY, h,$E7,(tt))
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h,$E8,((HP)* 1.))
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterDeathEvent(t, triggerUnit)
	call TriggerAddCondition(t, Condition(function WAI))
	call WXI(triggerUnit, GetUnitTypeId(targetUnit))
	if IsUnitType(targetUnit, UNIT_TYPE_SUMMONED)== false then
		call UnitRemoveBuffs(targetUnit, true, true)
	endif
	call UnitRemoveAbility(targetUnit,'Aetl')
	call UnitDamageTargetEx(dummyUnit, targetUnit, 4,$5F5E100)
	call ShowUnit(targetUnit, false)
	set t = null
	set triggerUnit = null
	set targetUnit = null
	set tt = null
	set dummyUnit = null
endfunction
function SWE takes nothing returns nothing
	call UnitAddPermanentAbility(GetTriggerUnit(),'A10R')
	call SetUnitAbilityLevel(GetTriggerUnit(),'A10R', GetUnitAbilityLevel(GetTriggerUnit(),'A32Z'))
endfunction
function WBI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local integer level = LoadInteger(HY, h, 3)
	local integer bookabil
	local integer WCI
	local integer WDI
	if GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT then
		if level == 1 then
			set WCI ='A1OE'
			set WDI ='A1OJ'
		elseif level == 2 then
			set WCI ='A1OF'
			set WDI ='A1OH'
		elseif level == 3 then
			set WCI ='A1OG'
			set WDI ='A1OK'
		elseif level == 4 then
			set WCI ='A1OD'
			set WDI ='A1OF'
		endif
		call SetUnitAbilityLevel(WUE, WCI, 1)
		call UnitMakeAbilityPermanent(WUE, true, WCI)
		call SetUnitAbilityLevel(WUE, WDI, 1)
		call UnitMakeAbilityPermanent(WUE, true, WDI)
	else
		if LoadInteger(HY, h, 0)< 1 then
			call UnitRemoveAbility(WUE,'A1OL')
			call UnitRemoveAbility(WUE,'A1ON')
			call UnitRemoveAbility(WUE,'A1OO')
			call UnitRemoveAbility(WUE,'A1OM')
			call UnitRemoveAbility(WUE,'B04J')
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call RemoveSavedHandle(HY, GetHandleId(WUE),'SCRD')
		else
			call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)-1)
		endif
	endif
	set t = null
	set WUE = null
	return false
endfunction
function IRE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(WUE,'A1OP')
	local integer T0V = 0
	local integer WFI = 0
	local integer WGI = 0
	if level == 1 then
		set T0V ='A1OL'
		set WFI ='A1OE'
		set WGI ='A1OJ'
	elseif level == 2 then
		set T0V ='A1ON'
		set WFI ='A1OF'
		set WGI ='A1OH'
	elseif level == 3 then
		set T0V ='A1OO'
		set WFI ='A1OG'
		set WGI ='A1OK'
	elseif level == 4 then
		set T0V ='A1OM'
		set WFI ='A1OD'
		set WGI ='A0FF'
	endif
	if HaveSavedHandle(HY, GetHandleId(WUE),'SCRD') then
		set t = LoadTriggerHandle(HY, GetHandleId(WUE),'SCRD')
		set h = GetHandleId(t)
		call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 1)
		if LoadInteger(HY, h, 3)!= level then
			call UnitRemoveAbility(WUE,'A1OL')
			call UnitRemoveAbility(WUE,'A1ON')
			call UnitRemoveAbility(WUE,'A1OO')
			call UnitRemoveAbility(WUE,'A1OM')
			call UnitRemoveAbility(WUE,'B04J')
			call SaveInteger(HY, h, 3, level)
		endif
		call TriggerRegisterTimerEvent(t, 6 + 2 * level, false)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 6 + 2 * level, false)
		call TriggerRegisterDeathEvent(t, WUE)
		call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_EFFECT)
		call TriggerAddCondition(t, Condition(function WBI))
		call SaveUnitHandle(HY, h, 2, WUE)
		call SaveInteger(HY, h, 3, level)
		call SaveTriggerHandle(HY, GetHandleId(WUE),'SCRD', t)
	endif
	call UnitAddPermanentAbility(WUE, T0V)
	call S9E(GetOwningPlayer(WUE), T0V, false)
	call UnitMakeAbilityPermanent(WUE, true, WFI)
	call UnitMakeAbilityPermanent(WUE, true, WGI)
	call UnitMakeAbilityPermanent(WUE, true,'A33I')
	set WUE = null
	set t = null
endfunction	//call UnitAddBreakToTimed(WLE, 3.) //末日A
function WHI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 2)
	local unit stg_u = LoadUnitHandle(HY, h, 17)
	local integer WIE = LoadInteger(HY, h, 34)
	if GetDistanceBetweenUnits(WJE, stg_u)> 900 or UnitIsDead(WJE) then
		set WIE = WIE + 1
		call SaveInteger(HY, h, 34, WIE)
	endif
	if ModuloInteger(GetTriggerEvalCount(t), 10)== 1 then
		call UnitDamageTargetEx(WJE, stg_u, 7, LoadReal(HY, h, 5))
	endif
	if WIE > 150 or(GetUnitAbilityLevel(stg_u,'BNdo')== 0 and GetTriggerEvalCount(t)> 2) then
		call UnitRemoveAbility(stg_u,'BNdo')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call UnitAddBreakToTimed(stg_u, 0.10)
	endif
	set t = null
	set WJE = null
	set stg_u = null
	return false
endfunction
function WJI takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(WLE), GetUnitY(WLE), 0)
	call UnitRemoveAbility(WLE,'A464')
	call UnitRemoveAbility(WLE,'B464')
	call UnitRemoveAbility(WLE,'BNdo')
	call GCX(GetSpellTargetUnit())
	call TriggerRegisterTimerEvent(t, .1, true)
	call UnitAddBreakToTimed(WLE, 0.11)
	call TriggerAddCondition(t, Condition(function WHI))
	call SaveUnitHandle(HY,(h), 2,(u))
	call SaveUnitHandle(HY,(h), 17,(WLE))
	call SaveInteger(HY,(h), 34, 0)
	call SaveReal(HY, h, 5, 20 + 30 * GetUnitAbilityLevel(u,'A0A2'))
	call UnitAddAbility(d,'A466')
	call SetUnitAbilityLevel(d,'A466', GetUnitAbilityLevel(u,'A0A2'))
	call IssueTargetOrderById(d,$D0267, WLE)
	set d = null
	set u = null
	set WLE = null
	set t = null
endfunction
function IAE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call WJI()
	endif
endfunction
function WKI takes nothing returns boolean
	local real x
	local real y
	if(IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit()))) and GetFilterUnit()!= RoShan then
		set x = L8V + GetRandomReal(20, 70)* Cos(GetUnitFacing(GetTriggerUnit())* bj_DEGTORAD)
		set y = L9V + GetRandomReal(20, 70)* Sin(GetUnitFacing(GetTriggerUnit())* bj_DEGTORAD)
		call SetUnitPosition(GetFilterUnit(), x, y)
	endif
	return false
endfunction
function ICE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local group g = LoginGroup(357)
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', x, y, 0)
	local integer level = GetUnitAbilityLevel(u,'A29L')+ GetUnitAbilityLevel(u,'A447')
	local real a = GetUnitFacing(u)
	set L8V = GetUnitX(u)+ 100 * Cos(a * bj_DEGTORAD)
	set L9V = GetUnitY(u)+ 100 * Sin(a * bj_DEGTORAD)
	call GroupEnumUnitsInRange(g, x, y, 410 + 24, Condition(function WKI))
	call LogoutGroup(g)
	call UnitAddPermanentAbility(d,'A06F')
	call SetUnitAbilityLevel(d,'A06F', level)
	call IssueImmediateOrderById(d,$D009F)
	if GetUnitAbilityLevel(u,'A447')> 0 then
		call UnitAddPermanentAbility(d,'A446')
		call SetUnitAbilityLevel(d,'A446', level)
		call IssuePointOrderById(d,$D00FA, x + 100 * Cos((a +$F)* bj_DEGTORAD), y + 100 * Sin((a +$F)* bj_DEGTORAD))
		call IssuePointOrderById(d,$D00FA, x + 100 * Cos((a -$F)* bj_DEGTORAD), y + 100 * Sin((a -$F)* bj_DEGTORAD))
		call IssuePointOrderById(d,$D00FA, x + 100 * Cos(a * bj_DEGTORAD), y + 100 * Sin(a * bj_DEGTORAD))
	endif
	set u = null
	set g = null
	set d = null
endfunction
function LTF takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	if GetUnitAbilityLevel(targetUnit,'B00U')== 0 or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call UnitRemoveAbility(targetUnit,'A1Q0')
		call UnitRemoveAbility(targetUnit,'A1Q1')
		call UnitRemoveAbility(targetUnit,'A1Q2')
		call UnitRemoveAbility(targetUnit,'A1Q3')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function SpellEffect__Empower takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(WUE,'A037')

	call SaveInteger(ExtraHT, HTKEY_UNIT_EMPOWER_LEVEL, GetHandleId(targetUnit), level)
	call EnableEffectByTime(EFFECT_KEY_EMPOWER, 40)

	//call AddAbilityToTimed(targetUnit, N0X, 1, 40, 0)
	set WUE = null
	set targetUnit = null
endfunction

function IME takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetUnitFacing(GetTriggerUnit()))
	call UnitAddAbility(d,'A3IH')
	call SetUnitAbilityLevel(d,'A3IH', GetUnitAbilityLevel(GetTriggerUnit(),'A02S'))
	if GetSpellTargetUnit()== GetTriggerUnit() then
		call B1R(d, "carrionswarm", GetUnitX(GetTriggerUnit())+ 1 * Cos(bj_DEGTORAD * GetUnitFacing(GetTriggerUnit())), GetUnitY(GetTriggerUnit())+ 1 * Sin(bj_DEGTORAD * GetUnitFacing(GetTriggerUnit())))
	else
		call B1R(d, "carrionswarm", GetSpellTargetX(), GetSpellTargetY())
	endif
	set d = null
endfunction

function LWF takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	call UnitRemoveAbility(targetUnit,'A1Q6')
	call UnitRemoveAbility(targetUnit,'B0CX')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set targetUnit = null
	return false
endfunction



function WSI takes nothing returns nothing
	local unit u = GetEnumUnit()
	local location l
	local real x
	local real y
	if IsPointInRegion(R4, GetUnitX(u), GetUnitY(u)) then
		set l = DEX(GetUnitX(u), GetUnitY(u))
		set x = CoordinateX75(GetLocationX(l))
		set y = CoordinateY75(GetLocationY(l))
		call SaveBoolean(K, GetHandleId(u), 99, true)
		call SetUnitX(u, x)
		call SetUnitY(u, y)
		call RemoveLocation(l)
		set l = null
	endif
	call SetUnitPathing(u, true)
	call KillDestructablesInCircle(GetUnitX(u), GetUnitY(u), 300)
	set u = null
endfunction

function SkewerMoveTimer takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local unit skewerUnit =(LoadUnitHandle(HY, h, 2))
	local integer level =(LoadInteger(HY, h, 5))
	local real radian =(LoadReal(HY, h,$D))
	local real moveX = CoordinateX75(GetUnitX(skewerUnit) + 19 * Cos(radian))
	local real moveY = CoordinateY75(GetUnitY(skewerUnit) + 19 * Sin(radian))
	local real targetX = CoordinateX75(moveX + 125 * Cos(radian))
	local real targetY = CoordinateY75(moveY + 125 * Sin(radian))
	local group enumGroup = null
	local group targetGroup = LoadGroupHandle(HY, h, 0)
	local group tempGroup = null
	local integer maxEvalCount =(LoadInteger(HY, h, 12))
	local integer evalCount = GetTriggerEvalCount(trig)
	local unit firstUnit = null

	if GetTriggerEventId()== EVENT_WIDGET_DEATH or evalCount> maxEvalCount then
		call DestroyEffect((LoadEffectHandle(HY, h, 175)))
		call SetUnitAnimationByIndex(skewerUnit, 0)
		call SetUnitTimeScale(skewerUnit, 1.)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(trig)

		call KillDestructablesInCircle(targetX, targetY, 400)

		call YDWEUnitRemoveStun(skewerUnit)
		call EXSetUnitPathing(skewerUnit, true)
		call DzSetUnitPosition(skewerUnit, moveX, moveY)
		// 结束 清除效果
		loop
			set firstUnit = FirstOfGroup(targetGroup)
		exitwhen firstUnit == null
			call GroupRemoveUnit(targetGroup, firstUnit)
	
			call YDWEUnitRemoveStun(firstUnit)
			call EXSetUnitPathing(firstUnit, true)
			call DzSetUnitPosition(firstUnit, targetX, targetY)

			call AddAbilityToTimed(firstUnit,'A1Q5', 1, 2.5,'B0CX')
			call UnitDamageTargetEx(skewerUnit, firstUnit, 1, 70 * level)

		endloop
		set firstUnit = null
		call LogoutGroup(targetGroup)
		set targetGroup = null

		set trig = null
		set skewerUnit = null
		return false
	endif

    // 位移进行摧毁树木
	if ModuloInteger(evalCount, 3)== 0 then
		call KillDestructablesInCircle(targetX, targetY,$C8)
	endif

	call SetUnitX(skewerUnit, moveX)
	call SetUnitY(skewerUnit, moveY)
	call SetUnitFacing(skewerUnit, radian * bj_RADTODEG)


	if ModuloInteger(evalCount, 4)== 0 then
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl", targetX, targetY))
	endif
	if evalCount == 2 then
		call SetUnitAnimationByIndex(skewerUnit, 3)
	endif

	set enumGroup = LoginGroup(358)
	call GroupEnumUnitsInRange(enumGroup, targetX, targetY, $96+ 25, null)
	set Temp__Player = GetOwningPlayer(skewerUnit)
	loop
		set firstUnit = FirstOfGroup(enumGroup)
	exitwhen firstUnit == null
		call GroupRemoveUnit(enumGroup, firstUnit)
		// 选取敌对英雄单位 视幻象和英雄级单位为英雄。
		if UnitAlive(firstUnit) and not IsUnitInGroup(firstUnit, targetGroup) and IsUnitEnemy(firstUnit, Temp__Player) and IsHeroLevelUnit(firstUnit)  then
			call GroupAddUnit(targetGroup, firstUnit)
			// 添加完全控制状态
			call YDWEUnitAddStun(firstUnit)
			// 无碰撞
			call EXSetUnitPathing(firstUnit, false)
		endif
	endloop
	call LogoutGroup(enumGroup)
	set enumGroup = null

	set tempGroup = LoginGroup(506)
	loop
		set firstUnit = FirstOfGroup(targetGroup)
	exitwhen firstUnit == null
		call GroupRemoveUnit(targetGroup, firstUnit)
		call GroupAddUnit(tempGroup, firstUnit) // 把单位加回去 tempGroup将代替targetGroup

		call SetUnitX(firstUnit, targetX)
		call SetUnitY(firstUnit, targetY)

	endloop

	call LogoutGroup(targetGroup)
	set targetGroup = null
	call SaveGroupHandle(HY, h, 0, tempGroup)
	set tempGroup = null

	set trig = null
	set skewerUnit = null
	return false
endfunction

function SpellEffect__Skewer takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real targetX = CoordinateX75(GetSpellTargetX())
	local real targetY = CoordinateY75(GetSpellTargetY())
	local unit spellUnit = GetTriggerUnit()
	local real startX = GetUnitX(spellUnit)
	local real startY = GetUnitY(spellUnit)
	local integer level = GetUnitAbilityLevel(spellUnit,'A1RD')
	local real radian = RadianBetweenXY(startX, startY, targetX, targetY)
	local real maxDistance = level *$96+ 625
	if GetDistanceBetween(startX, startY, targetX, targetY)> maxDistance then
		set targetX = CoordinateX75(startX + maxDistance * Cos(radian))
		set targetY = CoordinateY75(startY + maxDistance * Sin(radian))
	endif

	call EXSetUnitPathing(spellUnit, false)
	call SetUnitAnimationByIndex(spellUnit, 3)
	call SetUnitTimeScale(spellUnit, 1.5)

	// 0 秒后再施加完全控制状态 防止技能失效
	call EXUnitAddStunWait0s(spellUnit)

	call TriggerRegisterTimerEvent(t, .0, false)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, spellUnit) // 死亡驱散
	call TriggerAddCondition(t, Condition(function SkewerMoveTimer))
	call SaveUnitHandle(HY, h, 2,(spellUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveUnitHandle(HY, h, 393,(null))
	call SaveUnitHandle(HY, h, 394,(null))
	call SaveUnitHandle(HY, h, 395,(null))
	call SaveUnitHandle(HY, h, 396,(null))
	call SaveUnitHandle(HY, h, 397,(null))
	//call SaveReal(HY, h, 47,((targetX)* 1.))
	//call SaveReal(HY, h, 48,((targetY)* 1.))
	call SaveGroupHandle(HY, h, 0, LoginGroup(359))
	call SaveReal(HY, h, 6,((startX)* 1.))
	call SaveReal(HY, h, 7,((startY)* 1.))
	call SaveReal(HY, h, 13,( radian )* 1.)
	call SaveInteger(HY, h, 12,(R2I(GetDistanceBetween(startX, startY, targetX, targetY)/ 19.)))
	call SaveEffectHandle(HY, h, 175,(AddSpecialEffectTarget("war3mapImported\\SkewerTuskGlow_1.mdx", spellUnit, "head")))
	set t = null
	set spellUnit = null
endfunction

function TIRUP takes real RYIIO, real TIRPP, real TIRIP, real PPPTO, real PURRO returns nothing
	local real tx
	local real ty
	if GetSpellTargetUnit()!= GetTriggerUnit() then
		call UAII(RYIIO, TIRPP, TIRIP, PPPTO, PURRO, null, GetTriggerUnit(), GetSpellTargetX(), GetSpellTargetY(), 1)
	else
		set tx = GetUnitX(GetTriggerUnit())+ 50 * Cos(GetUnitFacing(GetTriggerUnit())* bj_DEGTORAD)
		set ty = GetUnitY(GetTriggerUnit())+ 50 * Sin(GetUnitFacing(GetTriggerUnit())* bj_DEGTORAD)
		call UAII(RYIIO, TIRPP, TIRIP, PPPTO, PURRO, null, GetTriggerUnit(), tx, ty, 1)
	endif
endfunction

function a_shockwave takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local real sx = LoadReal(HY, h, 2)
	local real sy = LoadReal(HY, h, 3)
	local real tx = LoadReal(HY, h, 0)
	local real ty = LoadReal(HY, h, 1)
	local real a = bj_RADTODEG * Atan2(ty -sy, tx -sx)
	local real x = sx + 1200. * Cos(a * bj_DEGTORAD)
	local real y = sy + 1200. * Sin(a * bj_DEGTORAD)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', x, y, 0)
	local real range = SquareRoot((sx -GetUnitX(d))*(sx -GetUnitX(d))+(sy -GetUnitY(d))*(sy -GetUnitY(d)))
	if range > 1200 then
		set range = 1200.
	endif
	call UAII(range, 150., 150., 0, 1575., "ShockWaveActions", d, sx, sy, GetUnitAbilityLevel(u,'A02S')+ GetUnitAbilityLevel(u,'A3Y8'))
	set u = null
	set d = null
	//call P8E()
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction

function amengmaw takes nothing returns nothing
	local integer h = TimerStartSingle(1200. / 1525., function a_shockwave)
	call TIRUP(1200., 150., 150., 75. * GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()), 1575.)
	call SetUnitVertexColor(IR, 255, 100, 0, 255)
	call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
	call SaveReal(HY, h, 0, GetSpellTargetX())
	call SaveReal(HY, h, 1, GetSpellTargetY())
	call SaveReal(HY, h, 2, GetUnitX(GetTriggerUnit()))
	call SaveReal(HY, h, 3, GetUnitY(GetTriggerUnit()))
endfunction

function WWI takes nothing returns boolean
	local real d
	if IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false and UnitIsDead(GetFilterUnit())== false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and IsUnitAlly(GetFilterUnit(), GetOwningPlayer(MEV)) and IsUnitInGroup(GetFilterUnit(), MOV)== false and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(MXV)) then
		set d = GetDistanceBetween(GetUnitX(GetFilterUnit()), GetUnitY(GetFilterUnit()), GetUnitX(MEV), GetUnitY(MEV))
		if d < MRV then
			set MVV = GetFilterUnit()
			set MRV = d
		endif
	endif
	return false
endfunction
function WYI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local integer level =(LoadInteger(HY, h, 5))
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local group D7R =(LoadGroupHandle(HY, h, 187))
	local real WZI =(LoadReal(HY, h,$DE))
	local real W_I =(LoadReal(HY, h,$DF))
	local real W0I =(LoadReal(HY, h,$E0))
	local real W5R
	local group g
	local real a
	local real x
	local real y
	local boolean b = false
	set a = Atan2(GetUnitY(targetUnit)-GetUnitY(dummyUnit), GetUnitX(targetUnit)-GetUnitX(dummyUnit))
	if WUE == targetUnit then
		set x = GetUnitX(dummyUnit)+ 25 * Cos(a)
		set y = GetUnitY(dummyUnit)+ 25 * Sin(a)
	else
		set x = GetUnitX(dummyUnit)+ 24 * Cos(a)
		set y = GetUnitY(dummyUnit)+ 24 * Sin(a)
	endif
	call SetUnitX(dummyUnit, x)
	call SetUnitY(dummyUnit, y)
	if GetDistanceBetween(x, y, GetUnitX(targetUnit), GetUnitY(targetUnit))< 60 then
		call SetUnitX(dummyUnit, GetUnitX(targetUnit))
		call SetUnitY(dummyUnit, GetUnitY(targetUnit))
		if WUE == targetUnit then
			call SetUnitState(WUE, UNIT_STATE_MANA, GetUnitState(WUE, UNIT_STATE_MANA)+ WZI)
			call KillUnit(dummyUnit)
			call LogoutGroup(D7R)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			if UnitVisibleToPlayer(targetUnit, GetOwningPlayer(dummyUnit)) then
				set b = UnitHasSpellShield(targetUnit)
				if b == false then
					if GetUnitAbilityLevel(targetUnit,'A2S5')> 0 then
						call UnitDamageTargetEx(WUE, targetUnit, 3,(.35 * W0I + 1.)*(40 + 40 * level))
					else
						call UnitDamageTargetEx(WUE, targetUnit, 1,(.35 * W0I + 1.)*(40 + 40 * level))
					endif
					set W0I = W0I + 1
					if GetUnitState(targetUnit, UNIT_STATE_MANA)> 0 then
						set W5R = RMinBJ(GetUnitState(targetUnit, UNIT_STATE_MANA),(.35 * W_I + 1.)*(5 +$F* level))
						call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)-W5R)
						call PlaySoundAtPoint(NE, GetUnitX(targetUnit), GetUnitY(targetUnit))
						set WZI = WZI + W5R
						set W_I = W_I + 1
					endif
				else
					call AJO(targetUnit)
				endif
			endif
			call SaveReal(HY, h,$DE,((WZI)* 1.))
			call SaveReal(HY, h,$E0,((W0I)* 1.))
			call SaveReal(HY, h,$DF,((W_I)* 1.))
			set g = LoginGroup(360)
			set MVV = null
			set MEV = targetUnit
			set MOV = D7R
			set MRV = 99999
			set MXV = WUE
			call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 500, Condition(function WWI))
			call LogoutGroup(g)
			if MVV == null or W0I ==(2 + level) or b then
				call SaveUnitHandle(HY, h, 30,((WUE)))
			else
				call SaveUnitHandle(HY, h, 30,((MVV)))
				call GroupAddUnit(D7R, MVV)
			endif
		endif
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set dummyUnit = null
	set g = null
	set D7R = null
	return false
endfunction
function W1I takes unit WUE, unit targetUnit, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local group g = LoginGroup(361)
	local real W0I = 0
	local real W_I = 0
	local real W5R = 0
	local real WZI = 0
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'h090', GetUnitX(WUE), GetUnitY(WUE), GetUnitFacing(WUE))
	call PlaySoundAtPoint(ME, GetUnitX(WUE), GetUnitY(WUE))
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function WYI))
	call SaveGroupHandle(HY, h, 187,(g))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveUnitHandle(HY, h, 30,((targetUnit)))
	call SaveInteger(HY, h, 34, 0)
	call SaveReal(HY, h,$DE,((WZI)* 1.))
	call SaveReal(HY, h,$E0,((W0I)* 1.))
	call SaveReal(HY, h,$DF,((W_I)* 1.))
	call GroupAddUnit(g, targetUnit)
	set dummyUnit = null
	set t = null
endfunction
function IPE takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(WJE,'A0G2')
	if GetUnitAbilityLevel(WJE,'Aloc')== 1 and HaveSavedHandle(HY, GetHandleId(WJE), 0) then
		set WJE = LoadUnitHandle(HY, GetHandleId(WJE), 0)
	endif
	if UnitHasSpellShield(WLE)== false then
		call W1I(WJE, WLE, level)
	endif
	set WJE = null
	set WLE = null
endfunction

globals
	integer				SplitShotCount				= 0
endglobals
function CancelSplitShot takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer i = GetUnitAbilityLevel(u,'A418')
	set SplitShotCount = SplitShotCount - 1
	call UnitRemoveAbility(u,'A419')
	//call SetUnitAbilityLevel(u,'A1C0', i)
	call SaveInteger(ExtraHT, GetHandleId(u), 'A1C0', 0)
	//call ReduceAttackLaunchingTrigCount(u)
	call RemoveUnitBEim(u)
	set u = null
endfunction
function EnableSplitShot takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A1C0')
	set SplitShotCount = SplitShotCount + 1
	call UnitAddPermanentAbility(u,'A419')
	call SaveInteger(ExtraHT, GetHandleId(u), 'A1C0', level)
	call AddAttackLaunchingTrigCount(u)
	call RemoveUnitBEim(u)
	set u = null
endfunction
function W2I takes nothing returns nothing
	local unit u = GetEnumUnit()
	call SaveReal(HY, GetHandleId(u), 799, .0)
	set u = null
endfunction
function W3I takes nothing returns nothing
	local unit u = GetEnumUnit()
	call UnitRemoveAbility(u,'A2S3')
	call UnitRemoveAbility(u,'A2TM')
	call UnitRemoveAbility(u,'B0BQ')
	call SetUnitTurnSpeed(u, GetUnitDefaultTurnSpeed(u))
	set u = null
endfunction
function W4I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 2)
	local unit SZX = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 0)

	call SetUnitImmunityMagicDamage(SZX, false)
	call DestroyEffect(LoadEffectHandle(HY, h, 32))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call UnitRemoveAbility(SZX,'A2TL')

	set t = null
	set u = null
	set SZX = null
	return false
endfunction
function W6I takes unit u, unit SZX, integer level returns nothing
	local trigger t
	local integer h
	local unit W_V
	local real W5I
	if IsUnitIllusion(SZX) then
		call KillUnit(SZX)
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	set W_V = CreateUnit(GetOwningPlayer(SZX),'e00E', GetUnitX(SZX), GetUnitY(SZX), 0)
	call UnitAddAbility(W_V,'A2S4')
	call IssueTargetOrderById(W_V, 852095, SZX)
	call TriggerRegisterDeathEvent(t, SZX)
	call TriggerRegisterTimerEvent(t, 3, false)
	call TriggerAddCondition(t, Condition(function W4I))

	call SaveUnitHandle(HY, h, 2, u)
	call SaveUnitHandle(HY, h, 17, SZX)
	call SaveInteger(HY, h, 0, level)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("Abilities\\Spells\\Orc\\EtherealForm\\SpiritWalkerChange.mdl", SZX, "chest"))
	set W5I = .2 + .1 * level

	call SetUnitImmunityMagicDamage(SZX, true)
	call SaveReal(ExtraHT, GetHandleId(SZX), 'A1AT', W5I)
	
	call SaveReal(HY, h, 0, W5I)
	call EnableEffectByTime(EFFECT_KEY_STONE_GAZE, 3.)
	//call UnitAddPermanentAbility(SZX,'A2S1')
	call UnitAddPermanentAbility(SZX,'A2TL')
	//call SetPlayerAbilityAvailable(GetOwningPlayer(SZX),'A2S1', false)
	set t = null
	set W_V = null
endfunction
function W7I takes nothing returns nothing
	local unit u = GetEnumUnit()
	call SaveReal(HY, GetHandleId(u), 799,(LoadReal(HY, GetHandleId(u), 799)+ .02)* 1.)
	if GetUnitAbilityLevel(u,'A2S3')== 0 then
		call UnitAddPermanentAbility(u,'A2S3')
		call UnitAddPermanentAbility(u,'A2TM')
		call SetUnitTurnSpeed(u, GetUnitDefaultTurnSpeed(u)* .5)
	endif
	if(LoadReal(HY, GetHandleId(u), 799))== 2. then
		call W6I(DG, u, Q2)
	endif
	set u = null
endfunction
function W8I takes unit u, unit SZX returns boolean
	local real radian = AngleBetweenUnit(SZX, u)
	local real angle = GetUnitFacing(SZX)
	local real W9I
	local real YVI
	local real YEI =-1.
	local real YXI =-1.
	local real YOI
	local real YRI
	local real YII =-1.
	local real YAI =-1.
	set W9I = RMaxBJ(angle -85, 0)
	set YVI = angle
	if angle -85 <= 0 then
		set YEI = 360 -(85 -(YVI -W9I))
		set YXI = 360
	endif
	set YOI = angle
	set YRI = RMinBJ(angle + 85, 360)
	if angle + 85 >= 360 then
		set YII = 0
		set YAI = 0 +(85 -(YRI -YOI))
	endif
	if radian < 0 then
		set radian = radian + 360
	elseif radian > 360 then
		set radian = radian -360
	endif
	if(radian > W9I and radian < YVI) or(YEI !=-1 and radian > YEI and radian < YXI) or(radian > YOI and radian < YRI) or(YII !=-1 and radian > YII and radian < YAI) then
		return true
	endif
	return false
endfunction
function YNI takes nothing returns boolean
	return IsEnemyAliveNotStrucNotWardNotInvulnerable() and W8I(U2, GetFilterUnit())
endfunction
function YBI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 2)
	local integer level = LoadInteger(HY, h, 0)
	local group g = LoginGroup(362)
	local group gg = LoginGroup(363)
	local group ag = LoadGroupHandle(HY, h, 187)
	set DG = WJE
	set U2 = WJE
	set Q2 = level
	call GroupEnumUnitsInRange(g, GetUnitX(WJE), GetUnitY(WJE),$401, Condition(function YNI))
	call ForGroup(g, function W7I)
	call GroupAddGroup(g, ag)
	call GroupAddGroup(ag, gg)
	call GroupRemoveGroup(g, gg)
	call LogoutGroup(g)
	call LogoutGroup(gg)
	call DestroyEffect(LoadEffectHandle(HY, h, 32))
	if GetTriggerEvalCount(t)> R2I(6 / .02) then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call ForGroup(ag, function W3I)
		call ForGroup(ag, function W2I)
		call LogoutGroup(ag)
	else
		call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("Abilities\\Spells\\Orc\\EtherealForm\\SpiritWalkerChange.mdl", WJE, "chest"))
	endif
	set WJE = null
	set g = null
	set gg = null
	set ag = null
	set t = null
	return false
endfunction
// 石化凝视
function SpellEffect__StoneGaze takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterTimerEvent(t, .0, false)
	call TriggerAddCondition(t, Condition(function YBI))
	call SaveUnitHandle(HY, h, 2, GetTriggerUnit())
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("Abilities\\Spells\\Orc\\EtherealForm\\SpiritWalkerChange.mdl", GetTriggerUnit(), "chest"))
	call SaveGroupHandle(HY, h, 187, LoginGroup(364))
	set t = null
endfunction
function YCI takes integer Y6R, unit R3O, unit R4O returns nothing
	if Y6R == 0 then
		call IssueTargetOrderById(R3O, 851983, R4O)
	endif
	if GetUnitAbilityLevel(R4O,'A3EC')== 1 and IsMagicImmuneUnit(R4O)== false then
		if Y6R < 3 then
			call AddAbilityToTimed(R4O,'A3ED', 1, 1.,'B3ED')
		elseif Y6R == 3 then
			call AddAbilityToTimed(R4O,'A3EE', 1, 1.,'B3EE')
		elseif Y6R == 4 then
			call AddAbilityToTimed(R4O,'A3EF', 1, 1.,'B3EF')
		elseif Y6R == 5 then
			call AddAbilityToTimed(R4O,'A3EG', 1, 1.,'B3EG')
		else
			call AddAbilityToTimed(R4O,'A3EH', 1, 1.,'B3EH')
		endif
	endif
endfunction
function OpenWoundsEnd takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer level =(LoadInteger(HY, h, 5))
	local integer EVX =(LoadInteger(HY, h, 34))
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local real YFI = .5
	local unit u = GetEventDamageSource()
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED then
		set EVX = EVX + 1
		call YCI(EVX, WUE, targetUnit)
		if EVX == 9 then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			call SaveInteger(HY, h, 34,(EVX))
		endif
	elseif IsEffectiveDamage(GetEventDamage()) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(u)) and IsUnitType(u, UNIT_TYPE_STRUCTURE)== false then
		if IsUnitType(u, UNIT_TYPE_HERO) or GetUnitAbilityLevel(u,'A04R')== 0 then
			call SetWidgetLife(u, GetWidgetLife(u)+ GetEventDamage()* YFI)
		else
			set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
			call SetWidgetLife(u, GetWidgetLife(u)+ GetEventDamage()* YFI)
		endif
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl", u, "origin"))
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set u = null
	return false
endfunction
function OpenWoundsAdd takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call YCI(0, WUE, targetUnit)
	call UnitAddPermanentAbility(targetUnit,'A3EC')
	call SaveInteger(HY, h, 375, 0)
	call SaveInteger(HY, h, 5,(GetUnitAbilityLevel(WUE,'A194')))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 30, targetUnit)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function OpenWoundsEnd))
	set t = null
	set WUE = null
	set targetUnit = null
endfunction
function SpellEffect__OpenWounds takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call OpenWoundsAdd()
	endif
endfunction
function PPX takes nothing returns nothing
	call RegisterBuffAbility('A3EC','PRGE')
	call RegisterBuffAbility('A3ED','PRGE')
	call RegisterBuffAbility('A3EE','PRGE')
	call RegisterBuffAbility('A3EF','PRGE')
	call RegisterBuffAbility('A3EG','PRGE')
	call RegisterBuffAbility('A3EH','PRGE')
	call RegisterBuffAbility('B3ED','PRGE')
	call RegisterBuffAbility('B3EE','PRGE')
	call RegisterBuffAbility('B3EF','PRGE')
	call RegisterBuffAbility('B3EG','PRGE')
	call RegisterBuffAbility('B3EH','PRGE')
endfunction
function YHI takes nothing returns nothing
	local unit WUE = MIV
	local unit targetUnit = GetEnumUnit()
	local integer level = MAV
	local trigger t = NHX(WUE, targetUnit,'h0DF', "YJI", 600, false)
	local integer h = GetHandleId(t)
	call SaveReal(HY, h, 20,((level * 125 + 25)* 1.))
	set WUE = null
	set targetUnit = null
	set t = null
endfunction
function YKI takes unit WUE, unit targetUnit, integer level returns nothing
	local group g = LoginGroup(365)
	set U2 = WUE
	set MIV = WUE
	set MAV = level
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 725, Condition(function DKX))
	call ForGroup(g, function YHI)
	call LogoutGroup(g)
	set g = null
endfunction
//u=施法者 target=施法目标 ghoul = 噬魂鬼(马甲)
function Infest_Actions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit target =(LoadUnitHandle(HY, h, 17))
	local unit u =(LoadUnitHandle(HY, h, 14))
	local unit ghoul =(LoadUnitHandle(HY, h, 19))
	local integer lv =(LoadInteger(HY, h, 5))
	local player p = GetOwningPlayer(u)
	//call BJDebugMsg(I2S( GetIssuedOrderId() ))
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call UnitShareVision(target, p, false)
		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Human\\HumanLargeDeathExplode\\HumanLargeDeathExplode.mdl", GetUnitX(target), GetUnitY(target)))
		call SetUnitPosition(u, GetUnitX(target), GetUnitY(target))
		call ShowUnit(u, true)
		call SetUnitPathing(u, true)
		call EXPauseUnit(u, false)
		call ClearSelectionForPlayer(p)
		call SelectUnitForPlayerSingle(u, p)
		call SetUnitInvulnerableEx(u, false)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call DestroyEffect((LoadEffectHandle(HY, h,$B1)))
		call RemoveUnit(ghoul)
		call UnitRemoveAbility(u,'A3L7')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call YKI(u, target, lv)
		call SaveInteger(HY,(GetHandleId((u))),(4310), 2)
	elseif IsUnitType(target, UNIT_TYPE_HERO) and IsUnitEnemy(target, p) then
		call UnitShareVision(target, p, false)
		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Human\\HumanLargeDeathExplode\\HumanLargeDeathExplode.mdl", GetUnitX(target), GetUnitY(target)))
		call SetUnitPosition(u, GetUnitX(target), GetUnitY(target))
		call ShowUnit(u, true)
		call EXPauseUnit(u, false)
		call UnitRemoveAbility(u,'A3L7')
		call SetUnitPathing(u, true)
		call ClearSelectionForPlayer(p)
		call SelectUnitForPlayerSingle(u, p)
		call SetUnitInvulnerableEx(u, false)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call DestroyEffect((LoadEffectHandle(HY, h,$B1)))
		call RemoveUnit(ghoul)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call YKI(u, target, lv)
		call SaveInteger(HY,(GetHandleId((u))),(4310), 2)
	elseif GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT or(GetTriggerEventId()== EVENT_UNIT_ISSUED_ORDER and GetIssuedOrderId()== 852129) then
		if GetSpellAbilityId()=='A0SX' or GetSpellAbilityId()=='A459' or GetTriggerEventId()== EVENT_UNIT_ISSUED_ORDER then
			call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Human\\HumanLargeDeathExplode\\HumanLargeDeathExplode.mdl", GetUnitX(target), GetUnitY(target)))
			if IsUnitEnemy(target, p) then
				call SetWidgetLife(u, GetWidgetLife(u)+ GetWidgetLife(target))
			endif
			call UnitShareVision(target, p, false)
			call SetUnitPosition(u, GetUnitX(target), GetUnitY(target))
			call ShowUnit(u, true)
			call EXPauseUnit(u, false)
			call UnitRemoveAbility(u,'A3L7')
			call SetUnitPathing(u, true)
			call SetUnitAnimation(u, "Stand Victory")
			call BAX(u, 1.5)
			call ClearSelectionForPlayer(p)
			call SelectUnitForPlayerSingle(u, p)
			call SetUnitInvulnerableEx(u, false)
			call DestroyEffect((LoadEffectHandle(HY, h, 32)))
			call DestroyEffect((LoadEffectHandle(HY, h,$B1)))
			call RemoveUnit(ghoul)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call YKI(u, target, lv)
			if IsUnitType(target, UNIT_TYPE_HERO)== false then
				if IsUnitType(target, UNIT_TYPE_SUMMONED)== false then
					call UnitRemoveBuffs(target, true, true)
				endif
				call UnitDamageTargetEx(u, target, 1,$186A0)
				call UnitDamageTargetEx(u, target, 2,$186A0)
				call UnitDamageTargetEx(u, target, 3,$186A0)
			endif
			call SaveInteger(HY,(GetHandleId((u))),(4310), 2)
		elseif GetSpellAbilityId()=='A44H' then
			call SetUnitOwner(target, p, false)
			call I8X(target)
			if LoadBoolean(HY, h,'{')== false then
				call SaveBoolean(HY, h,'{', true)
				call TriggerRegisterUnitEvent(t, target, EVENT_UNIT_SPELL_EFFECT)
				if GetUnitTypeId(target)=='ncnk' or GetUnitTypeId(target)=='nowe' then
					call UnitAddPermanentAbility(target,'A459')
				else
					call UnitAddPermanentAbility(target,'A0SX')
				endif
			endif
			call SetUnitMoveSpeed(target, GetUnitMoveSpeed(u))
			call ClearSelectionForPlayer(p)
			call SelectUnitAddForPlayer(target, p)
		endif
	elseif GetTriggerEventId()== EVENT_PLAYER_UNIT_SELECTED and GetTriggerUnit()== target and GetOwningPlayer(target)!= p then
		call ClearSelectionForPlayer(p)
		call SelectUnitAddForPlayer(ghoul, p)
	else
		if GetOwningPlayer(target)== p then
			call SetUnitMoveSpeed(target, GetUnitMoveSpeed(u))
		endif
		call SetUnitPosition(u, GetUnitX(target), GetUnitY(target))
	endif
	set t = null
	set target = null
	set u = null
	set ghoul = null
	return false
endfunction
function Infest takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit target = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit ghoul = CreateUnit(GetOwningPlayer(u),'e010', 7260,-7732, 0)
	local string YMI = "Objects\\Spawnmodels\\Naga\\NagaBlood\\NagaBloodWindserpent.mdl"
	local string YPI = "Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBase.mdl"
	local string YQI = "Abilities\\Spells\\Other\\Aneu\\AneuTarget.mdl"
	// call PingMinimap(7260, -7732, 5)
	if IsPlayerEnemy(LocalPlayer, GetOwningPlayer(u)) and IsObserver== false then
		set YMI = ""
		set YPI = ""
		set YQI = ""
	endif
	call RemoveUnitBuff(u, false)
	if IsUnitType(u, UNIT_TYPE_SUMMONED)== false then
		call UnitRemoveBuffs(u, true, true)
	endif
	call SetUnitInvulnerableEx(ghoul, true)
	call UnitAddPermanentAbility(ghoul,'A0SX')
	if IsUnitType(target, UNIT_TYPE_HERO)== false and GetOwningPlayer(target)!= GetOwningPlayer(u) then
		call UnitAddPermanentAbility(ghoul,'A44H')
		call TriggerRegisterUnitEvent(t, target, EVENT_UNIT_ISSUED_ORDER)
	endif
	call ClearSelectionForPlayer(GetOwningPlayer(u))
	if GetOwningPlayer(target)== GetOwningPlayer(u) then
		if GetUnitTypeId(target)=='ncnk' or GetUnitTypeId(target)=='nowe' then
			call UnitAddPermanentAbility(target,'A459')
		else
			call UnitAddPermanentAbility(target,'A0SX')
		endif
		call TriggerRegisterUnitEvent(t, target, EVENT_UNIT_SPELL_EFFECT)
		call SelectUnitForPlayerSingle(target, GetOwningPlayer(u))
	else
		call SelectUnitForPlayerSingle(ghoul, GetOwningPlayer(u))
	endif
	call UnitShareVision(target, GetOwningPlayer(u), true)
	call SetUnitInvulnerableEx(u, true)
	call ShowUnit(u, false)
	call EXPauseUnit(u, true)
	call UnitAddPermanentAbility(u,'A3L7')
	call SetUnitPathing(u, false)
	call DestroyEffect(AddSpecialEffectTarget(YMI, target, "overhead"))
	call SaveUnitHandle(HY, h, 17,(target))
	call SaveUnitHandle(HY, h, 14,(u))
	call SaveUnitHandle(HY, h, 19,(ghoul))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget(YPI, target, "overhead")))
	call SaveEffectHandle(HY, h,$B1,(AddSpecialEffectTarget(YQI, target, "overhead")))
	call SaveInteger(HY, h, 5,(GetUnitAbilityLevel(u,'A0SW')))
	call TriggerRegisterDeathEvent(t, u)
	call TriggerRegisterDeathEvent(t, target)
	call TriggerRegisterPlayerUnitEvent(t, GetOwningPlayer(u), EVENT_PLAYER_UNIT_SELECTED, TrueBoolexprCondition)
	call TriggerRegisterUnitEvent(t, ghoul, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerAddCondition(t, Condition(function Infest_Actions))
	call SaveInteger(HY, GetHandleId(u), 4310, 1)
	set t = null
	set u = null
	set target = null
	set ghoul = null
endfunction

//感染目标条件
function InfestTargetCondition takes unit u returns boolean
	return ( IsUnitEnemy(u, GetOwningPlayer(GetTriggerUnit())) and( IsUnitType(u, UNIT_TYPE_HERO) or IsUnitIllusion(u) or u== RoShan or IsBearUnit(u) ) ) or IsMessengerUnit(u) 
endfunction

function JYE takes nothing returns nothing
	if InfestTargetCondition(GetSpellTargetUnit()) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n0LV'))
	endif
endfunction
function YSI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	call ResetUnitVertexColor(triggerUnit)
	call UnitRemoveAbility(triggerUnit,'A0SR')
	call UnitRemoveAbility(triggerUnit,'A0ST')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set triggerUnit = null
	return false
endfunction
function IYE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0T2')
	local integer i = 0
	call SetUnitVertexColorEx(triggerUnit, 0, 0, 0,-1)
	call SetPlayerAbilityAvailable(GetOwningPlayer(triggerUnit),'A0ST', false)
	call UnitAddPermanentAbility(triggerUnit,'A0ST')
	call UnitAddPermanentAbility(triggerUnit,'A0SR')
	call SetUnitAbilityLevel(triggerUnit,'A0SR', level)
	call RemoveUnitBuff(triggerUnit, false)
	call SkillImmunityDispel(triggerUnit)
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	call TriggerRegisterTimerEvent(t, 2 + level, false)
	call TriggerAddCondition(t, Condition(function YSI))
	set triggerUnit = null
	set t = null
endfunction
function FeastFilter takes nothing returns boolean
	return (DEIsEnemy[DEI] and(GetUnitAbilityLevel(DESourceUnit[DEI],'A0SS')> 0) and DETargetUnit[DEI] != RoShan and GetUnitTypeId(DETargetUnit[DEI])!='n0F5' and IsFamiliarsTypeId(GetUnitTypeId(DETargetUnit[DEI]))== false and not DESourceIsBreak[DEI] and IsUnitType(DETargetUnit[DEI], UNIT_TYPE_STRUCTURE)== false and GetUnitAbilityLevel(DETargetUnit[DEI],'A04R')== 0)
endfunction
// 盛宴
function FeastActions takes unit sourceUnit, unit targetUnit returns nothing
	local integer level = GetUnitAbilityLevel(sourceUnit,'A0SS')
	local real value
	if(not(Mode__BalanceOff)) and(IsUnitType(sourceUnit, UNIT_TYPE_RANGED_ATTACKER)) then
		set value =(.0175 + .01 * level)* GetWidgetLife(targetUnit)
	else
		set value =(.03 + .01 * level)* GetWidgetLife(targetUnit)
	endif
	call UnitRestoreHealth(sourceUnit, value)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl", sourceUnit, "origin"))
endfunction
function YWI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call LodSystem_ReduceUnitExtraState(LoadUnitHandle(P, h, 0), LoadInteger(P, h, 0), STATE_SYSTEM_DAMAGE)
	call RemoveSavedHandle(P, GetHandleId(LoadUnitHandle(P, h, 0)),'A0SS')
	call FlushChildHashtable(P, h)
	call DestroyTimer(t)
	set t = null
endfunction
function FeastAddDamage takes unit u, unit WLE, integer level returns nothing
	local timer t
	local integer h
	local integer d
	local real r = GetWidgetLife(WLE)
	local boolean b = HaveSavedHandle(P, GetHandleId(u),'A0SS')
	if b then
		set t = LoadTimerHandle(P, GetHandleId(u),'A0SS')
		set h = GetHandleId(t)
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveTimerHandle(P, GetHandleId(u),'A0SS', t)
		call SaveUnitHandle(P, h, 0, u)
	endif
	call TimerStart(t, 2, false, function YWI)
	if(not(Mode__BalanceOff)) and(IsUnitType(u, UNIT_TYPE_RANGED_ATTACKER)) then
		set d = R2I((.0175 + .01 * level)* r)
	else
		set d = R2I((.03 + .01 * level)* r)
	endif
	if b then
		if d != LoadInteger(P, h, 0) then
			call LodSystem_AddUnitExtraState(u, d -LoadInteger(P, h, 0), STATE_SYSTEM_DAMAGE)
		endif
		//call BJDebugMsg(I2S(LoadInteger(P, h, 0)))
	else
		call LodSystem_AddUnitExtraState(u, d, STATE_SYSTEM_DAMAGE)
		//call BJDebugMsg(I2S(d))
	endif
	call SaveInteger(P, h, 0, d)
	call SaveUnitHandle(P, h, 0, u)
	set t = null
endfunction
function YZI takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local real hp = GetWidgetLife(targetUnit)-1
	local real Y_I = GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)
	local real ZCE = .003 * MBV * Y_I / 2
	call UnitDamageTargetEx(MNV, targetUnit, 11, ZCE)
	set targetUnit = null
endfunction
function Y0I takes nothing returns boolean
	return DKX() and GetUnitAbilityLevel(GetFilterUnit(),'B084')> 0
endfunction
function Y1I takes nothing returns nothing
	local integer h = GetHandleId(GetExpiredTimer())
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local group g
	if UnitIsDead(WUE)== false and GetUnitAbilityLevel(WUE,'A36D')== 0 then
		set g = LoginGroup(366)
		set MNV = WUE
		set MBV = GetUnitAbilityLevel(WUE,'P302')+ 1
		call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 1225, Condition(function Y0I))
		call ForGroup(g, function YZI)
		call LogoutGroup(g)
	endif
	set g = null
	set WUE = null
endfunction
function MAE takes nothing returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .5, true, function Y1I)
	call SaveUnitHandle(HY, GetHandleId(t), 2, GetTriggerUnit())
	set t = null
endfunction
function Y2I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local unit u = LoadUnitHandle(P, WFV, 0)
	local integer c = LoadInteger(P, WFV, 2)+ 1
	if UnitIsDead(u) or c > 6 *$A then
		call DestroyTimerAndFlushHT_P(t)
	else
		call SetWidgetLife(u, GetWidgetLife(u)+ LoadInteger(P, WFV, 0)* .1)
		call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ LoadInteger(P, WFV, 1)* .1)
		call SaveInteger(P, WFV, 2, c)
	endif
	set t = null
	set u = null
endfunction
function Y3I takes unit u, integer WUV, boolean b returns nothing
	local timer t = CreateTimer()
	local integer WFV = GetHandleId(t)
	local integer mp = 2 * WUV
	local integer hp = WUV
	if WUV == 4 then
		set mp =$C
		set hp = 6
	endif
	if b then
		set mp = mp *$A
		set hp = hp *$A
	endif
	call WJV(u,'C012','D012', 6)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl", u, "origin"))
	call SaveUnitHandle(P, WFV, 0, u)
	call SaveInteger(P, WFV, 0, hp)
	call SaveInteger(P, WFV, 1, mp)
	call TimerStart(t, .1, true, function Y2I)
	set t = null
endfunction
function Y4I takes unit SYX, unit SZX returns nothing
	local unit u
	local integer WUV
	if IsUnitIllusion(SZX) or GetUnitTypeId(SZX)=='u00S' then
		set u = null
		return
	endif
	if LoadInteger(HY, GetHandleId(SZX), 4333)== 1 then
		set u = Player__Hero[GetPlayerId(LoadPlayerHandle(HY, GetHandleId(SZX), 4333))]
	elseif GetUnitAbilityLevel(SYX,'Aloc')== 1 then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(SYX))]
	else
		set u = SYX
	endif
	set WUV = GetUnitAbilityLevel(u,'P303')
	if WUV > 0 and UnitAlive(u) and GetUnitAbilityLevel(u,'A36D')== 0 then
		call Y3I(u, WUV, IsUnitType(SZX, UNIT_TYPE_HERO))
	endif
	set u = null
endfunction
function YJI takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit WUE = U2
	local unit targetUnit = W2
	local real IXX =(LoadReal(HY, h, 20))
	local real OCI =(LoadReal(HY, h, 21))
	if IsUnitAlly(targetUnit, GetOwningPlayer(WUE)) then
		call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+ OCI)
	else
		call UnitDamageTargetEx(WUE, targetUnit, 1, IXX)
	endif
	set WUE = null
	set targetUnit = null
endfunction
function Y5I takes nothing returns nothing
	local trigger t = NHX(U2, GetEnumUnit(),'h00W', "YJI", 400, false)
	local integer h = GetHandleId(t)
	call SaveReal(HY, h, 20,((S2)* 1.))
	call SaveReal(HY, h, 21,((TJ)* 1.))
	set t = null
endfunction
function Y6I takes nothing returns nothing
	if UnitVisibleToPlayer(GetEnumUnit(), GetOwningPlayer(U2)) or(IsUnitFogged(GetEnumUnit(), GetOwningPlayer(U2)) and DOX(GetEnumUnit())== false) then
		call Y5I()
	endif
endfunction
function IZE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local group g = LoginGroup(367)
	local integer level = GetUnitAbilityLevel(triggerUnit,'A05V')
	local real r = 500
	local real IXX
	if level == 1 then
		set IXX = 125
	elseif level == 2 then
		set IXX = 175
	elseif level == 3 then
		set IXX =$E1
	elseif level == 4 then
		set IXX = 275
	endif
	set U2 = triggerUnit
	set S2 = IXX
	set TJ = 50 + 20 * level
	call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), r, Condition(function FVX))
	call GroupRemoveUnit(g, triggerUnit)
	call ForGroup(g, function Y6I)
	call LogoutGroup(g)
	call SetWidgetLife(triggerUnit, GetWidgetLife(triggerUnit)+ TJ)
	set triggerUnit = null
	set g = null
endfunction
function Y7I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real YFI =(LoadReal(HY, h, 680))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl", targetUnit, "origin"))
	call UnitDamageTargetEx(WUE, targetUnit, 1, YFI *(GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)-GetWidgetLife(targetUnit)))
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function Y8I takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer Y9I = GetUnitAbilityLevel(WUE,'A067')
	local integer ZVI = GetUnitAbilityLevel(WUE,'A08P')
	local real YFI
	if GetUnitAbilityLevel(WUE,'Aloc')== 1 and HaveSavedHandle(HY, GetHandleId(WUE), 0) then
		set WUE = LoadUnitHandle(HY, GetHandleId(WUE), 0)
	endif
	if Y9I == 1 then
		set YFI = .4
	elseif Y9I == 2 or ZVI == 1 then
		set YFI = .6
	elseif Y9I == 3 or ZVI == 2 then
		set YFI = .9
	elseif ZVI == 3 then
		set YFI = 1.2
	endif
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveReal(HY, h, 680,((YFI)* 1.))
	call TriggerRegisterTimerEvent(t, 1., false)
	call TriggerAddCondition(t, Condition(function Y7I))
	call EPX(targetUnit, 4333, 1.5)
	call SavePlayerHandle(HY, GetHandleId(targetUnit), 4333, GetOwningPlayer(WUE))
	if ZVI > 0 then
		call EPX(targetUnit, 4418, 1.51)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
endfunction
function I_E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call Y8I()
	endif
endfunction
function I0E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x1 = GetUnitX(u)
	local real y1 = GetUnitY(u)
	local real a
	local real x2
	local real y2
	local integer lv = GetUnitAbilityLevel(u,'A0X7')
	local real damage
	local real dur
	local unit target = null
	if GetSpellTargetUnit()!= null then
		set x2 = GetUnitX(GetSpellTargetUnit())
		set y2 = GetUnitY(GetSpellTargetUnit())
	else
		set x2 = GetSpellTargetX()
		set y2 = GetSpellTargetY()
	endif
	set a = Atan2(y2 -y1, x2 -x1)
	set x2 = x1 + 700 * Cos(a)
	set y2 = y1 + 700 * Sin(a)
	if lv == 1 then
		set damage = 80
		set dur = .75
	elseif lv == 2 then
		set damage = 140
		set dur = 1.25
	elseif lv == 3 then
		set damage = 200
		set dur = 1.75
	elseif lv == 4 then
		set damage = 260
		set dur = 2.25
	endif
	if GetSpellTargetUnit()!= null and UnitHasSpellShield(GetSpellTargetUnit()) then
		set target = GetSpellTargetUnit()
	endif
	call UnitSpellEffectImpale(u, target, damage, dur, .52, x1, y1, x2, y2, 150, null, true, 1600)
	set u = null
	set target = null
endfunction
function ZEI takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local real r = GetHeroInt(targetUnit, true)*(3 + .5 * GetUnitAbilityLevel(WUE,'A1H5'))
	local integer ZXI = IMinBJ(R2I(r), R2I(GetUnitState(targetUnit, UNIT_STATE_MANA)))
	call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)-ZXI)
	call UnitDamageTargetEx(WUE, targetUnit, 1, ZXI)
	call CHX("MBUR", WUE, targetUnit, 1, 1, 1, 1, .5)
	call CommonTextTag("-" + I2S(ZXI), 3, targetUnit, .023, 82, 82, 255, 255)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ManaBurn\\ManaBurnTarget.mdl", targetUnit, "chest"))
	set WUE = null
	set targetUnit = null
endfunction
function I1E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call ZEI()
	endif
endfunction

// 清除尖刺外壳
function SpikedCarapaceRemove takes trigger HLR, unit u, integer WFV returns nothing
	call RemoveSavedHandle(HY, GetHandleId(u),'A2KO')
	call DestroyEffect(LoadEffectHandle(HY, WFV, 3))
	call DestroyEffect(LoadEffectHandle(HY, WFV, 4))
	call DestroyEffect(LoadEffectHandle(HY, WFV, 5))
	call DestroyEffect(LoadEffectHandle(HY, WFV, 6))
	call LogoutGroup(LoadGroupHandle(HY, WFV, 7))
	call FlushChildHashtable(HY, WFV)
	call CleanCurrentTrigger(HLR)
endfunction

globals
	integer 						SpikedCarapaceCount = 0
	boolean 		array 			SpikedCarapaceBlock
endglobals

function SpikedCarapaceTransmittedActions takes nothing returns nothing
	local integer h = GetHandleId(LoadTriggerHandle(HY, DETargetId[DEI], 'A2KO'))
	local group g = LoadGroupHandle(HY, h, 7)
	if not IsUnitInGroup(DESourceUnit[DEI], g) then
		call GroupAddUnit(g, DESourceUnit[DEI])
		set SpikedCarapaceBlock[DEI] = true
		call CommonUnitAddStun(DESourceUnit[DEI], .6 * LoadInteger(HY, h, 0), false)
		set TransmittedDamage = true
		call UnitDamageTargetEx(DETargetUnit[DEI], DESourceUnit[DEI], 3, GetAllDamage())
		set TransmittedDamage = false
	endif
	set g = null
endfunction
// 尖刺外壳事件
function SpikedCarapaceEnd takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit
	local integer count = LoadInteger(HY, h, 1) - 1
	set SpikedCarapaceCount = SpikedCarapaceCount - 1
	if count == 0 then
		call SpikedCarapaceRemove(t, whichUnit, h)
	else
		// 这里没 - 1 可能是导致出bug的原因
		call SaveInteger(HY, h, 1, count )
	endif
	set t = null
	set whichUnit = null
	set targetUnit = null
	return false
endfunction

// 尖刺外壳
function SpellEffect__SpikedCarapace takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local trigger t
	local integer h
	set SpikedCarapaceCount = SpikedCarapaceCount + 1
	if HaveSavedHandle(HY, GetHandleId(whichUnit),'A2KO') then
		set t = LoadTriggerHandle(HY, GetHandleId(whichUnit),'A2KO')
		set h = GetHandleId(t)
		call GroupClear(LoadGroupHandle(HY, h, 7))
		call TriggerRegisterTimerEvent(t, 2.25, false)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 2.25, false)
		call TriggerAddCondition(t, Condition(function SpikedCarapaceEnd))
		call SaveUnitHandle(HY, h, 2,(whichUnit))
		call SaveInteger(HY, h, 0, GetUnitAbilityLevel(whichUnit, GetSpellAbilityId()))
		call SaveGroupHandle(HY, h, 7, LoginGroup(368))
		call SaveEffectHandle(HY, h, 3, AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ThornyShield\\ThornyShieldTargetChestLeft.mdl", whichUnit, "chest,left"))
		call SaveEffectHandle(HY, h, 4, AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ThornyShield\\ThornyShieldTargetChestRight.mdl", whichUnit, "chest,right"))
		call SaveEffectHandle(HY, h, 5, AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ThornyShield\\ThornyShieldTargetChestMountLeft.mdl", whichUnit, "mount,left"))
		call SaveEffectHandle(HY, h, 6, AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ThornyShield\\ThornyShieldTargetChestMountRight.mdl", whichUnit, "mount,right"))
		call SaveTriggerHandle(HY, GetHandleId(whichUnit),'A2KO', t)
	endif
	call SaveInteger(HY, h, 1, LoadInteger(HY, h, 1)+ 1)
	set whichUnit = null
	set t = null
endfunction

function WIO takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit WUE = W2
	local unit targetUnit = U2
	local integer ZII
	local integer ZAI
	local integer level
	if GetUnitAbilityLevel(WUE,'A04R')!= 0 then
		set WUE = Player__Hero[GetPlayerId(GetOwningPlayer(WUE))]
	endif
	set ZII = GetUnitAbilityLevel(WUE,'A0CQ')
	set level = GetUnitAbilityLevel(WUE,'A0BR')
	if level == 1 then
		set ZAI = 12
	elseif level == 2 then
		set ZAI = 20
	elseif level == 3 then
		set ZAI = 28
	else
		set ZAI = 36
	endif
	set ZAI = ZAI + 1
	if IsUnitType(targetUnit, UNIT_TYPE_HERO)== false then
		set ZII = ZII + 1
	else
		set ZII = ZII + 12
	endif
	set ZII = IMinBJ(ZAI, ZII)
	call SetUnitAbilityLevel(WUE,'A0CQ', ZII)
	call SaveInteger(HY,(GetHandleId(WUE)), 710,(ZII))
	set WUE = null
	set targetUnit = null
endfunction
function ZNI takes nothing returns nothing
	local integer ZII
	local integer level
	local integer ZAI
	local trigger t
	local integer h
	local unit WUE = GetKillingUnit()
	if GetUnitTypeId(WUE)=='e00E' then
		set WUE = Player__Hero[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]
	endif
	set ZII = GetUnitAbilityLevel(WUE,'A0CQ')
	set level = GetUnitAbilityLevel(WUE,'A0BR')
	set ZAI = 8 + 7 * level
	if ZII <= ZAI then
		set t = NHX(GetTriggerUnit(), WUE,'h0CR', "WIO", 3000, false)
		set h = GetHandleId(t)
		set t = null
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\ZigguratMissile\\ZigguratMissile.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
	endif
	set WUE = null
endfunction
function ZBI takes nothing returns nothing
	local integer i = R2I(GetUnitAbilityLevel(GetTriggerUnit(),'A0CQ')* .5)+ 1
	call SaveInteger(HY, GetHandleId(GetTriggerUnit()), 710, R2I(GetUnitAbilityLevel(GetTriggerUnit(),'A0CQ')* .5)+ 1)
	call UnitRemoveAbility(GetTriggerUnit(), 'A0CQ')
	call UnitAddAbility(GetTriggerUnit(), 'A0CQ')
	call UnitMakeAbilityPermanent(GetTriggerUnit(), true, 'A0CQ')
	call SetUnitAbilityLevel(GetTriggerUnit(),'A0CQ', i)
endfunction
function ZCI takes unit SYX, unit SZX returns nothing
	if IsUnitIllusion(SZX) then
		return
	endif
	if IsUnitType(SYX, UNIT_TYPE_HERO)== false then
		set SYX = Player__Hero[GetPlayerId(GetOwningPlayer(SYX))]
	endif
	if GetUnitAbilityLevel(SYX,'A0BR')> 0 then
		call ZNI()
	endif
	if GetUnitAbilityLevel(SZX,'A0BR')> 0 then
		call ZBI()
	endif
endfunction
function ZDI takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0)!= null
endfunction
function ZFI takes nothing returns nothing
	call UnitDamageTargetEx(TK, GetEnumUnit(), 1, 25 + 75 * UK)
endfunction
function I3E takes nothing returns boolean
	local unit triggerUnit = GetTriggerUnit()
	local real ZRO
	local real a
	local real x
	local real y
	local group g = LoginGroup(369)
	if GetUnitAbilityLevel(triggerUnit,'A04R')> 0 then
		set triggerUnit = Player__Hero[GetPlayerId(GetOwningPlayer(triggerUnit))]
	endif
	if GetSpellAbilityId()=='A0EY'then
		set ZRO = 200
	elseif GetSpellAbilityId()=='A0FH'then
		set ZRO = 450
	elseif GetSpellAbilityId()=='A0F0'then
		set ZRO = 700
	endif
	set a = GetUnitFacing(triggerUnit)
	set x = GetWidgetX(triggerUnit)+ ZRO * Cos(a * bj_DEGTORAD)
	set y = GetWidgetY(triggerUnit)+ ZRO * Sin(a * bj_DEGTORAD)
	set TK = triggerUnit
	set UK = GetUnitAbilityLevel(triggerUnit, GetSpellAbilityId())
	call UnitApplyTimedLife(CreateUnit(GetOwningPlayer(triggerUnit),'e006', x, y, 0),'BTLF', 2)
	call GroupEnumUnitsInRange(g, x, y, 275, Condition(function ZDI))
	call ForGroup(g, function ZFI)
	call LogoutGroup(g)
	set triggerUnit = null
	set g = null
	return false
endfunction
function MNE takes nothing returns nothing
	call UnitAddPermanentAbility(GetTriggerUnit(),'A0CQ')
endfunction
function PDE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer WUV = GetUnitAbilityLevel(u,'A0EY')
	if WUV == 1 then
		call UnitAddPermanentAbility(u,'A0F0')
		call UnitAddPermanentAbility(u,'A0FH')
	else
		call SetUnitAbilityLevel(u,'A0F0', WUV)
		call SetUnitAbilityLevel(u,'A0FH', WUV)
	endif
	set u = null
endfunction
function ZGI takes nothing returns boolean
	return IsAliveNotStrucNotWard(GetFilterUnit()) and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(U2))
endfunction
function ZHI takes unit u returns nothing
	local group g
	local unit u2
	local integer level
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call UnitAddAbility(d,'A0HH')
	set g = LoginGroup(370)
	set U2 = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 700, Condition(function ZGI))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call SetUnitX(d, GetUnitX(u2))
		call SetUnitY(d, GetUnitY(u2))
		call SetUnitOwner(d, GetOwningPlayer(u2), false)
		call IssueTargetOrderById(d,$D00DD, u2)
		call GroupRemoveUnit(g, u2)
	endloop
	call UnitRemoveAbility(d,'A0HH')
	set d = null
	call LogoutGroup(g)
endfunction

function IYRPI takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer OTRTO = LoadInteger(HY, h, 1)
	local integer IYRUI = LoadInteger(HY, h, 0)
	local integer i
	local integer k
	local real a
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local real r
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', x, y, 0)
	local real dx
	local real dy
	local integer id ='S0HG'
	call UnitAddAbility(d, id)
	call SetUnitAbilityLevel(d, id, OTRTO)
	set a = 360. /(IYRUI * 1.)
	set i = 1
	set k = IYRUI
	loop
	exitwhen i > k
		set r = i * a * bj_DEGTORAD
		set dx = CoordinateX50(x +(1060)*(Cos(r)))
		set dy = CoordinateY50(y +(1060)*(Sin(r)))
		call SetUnitX(d, dx)
		call SetUnitY(d, dy)
		call IssuePointOrderById(d, 852218, x, y)
		set i = i + 1
	endloop
	set d = null
	call PauseTimer(t)
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTimer(t)
	set u = null
	set t = null
endfunction

function IYRYI takes unit u, integer IYRII, integer OTRTO returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveInteger(HY, h, 0, IYRII)
	call SaveInteger(HY, h, 1, OTRTO)
	call TimerStart(t, 1.4, false, function IYRPI)
	set t = null
endfunction

function ZJI takes unit u, integer UJV returns nothing
	local real x = GetWidgetX(u)
	local real y = GetWidgetY(u)
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', x, y, 0)
	local integer WVV = 0
	local integer radian = 360 / UJV
	local integer WUV = GetUnitAbilityLevel(u,'A29J')
	local boolean is_a = GetUnitAbilityLevel(u,'A3OJ')> 0
	call UnitAddAbility(d,'A0HG')
	call SetUnitAbilityLevel(d,'A0HG', WUV)
	loop
	exitwhen WVV > UJV
		call IssuePointOrderById(d,$D00FA, x + 50 * Cos(bj_DEGTORAD * WVV * radian), y + 50 * Sin(bj_DEGTORAD * WVV * radian))
		set WVV = WVV + 1
	endloop
	call ZHI(u)
	if is_a then
		call IYRYI(u, UJV, WUV)
	endif
	set d = null
endfunction
function ZKI takes nothing returns nothing
	if GetUnitAbilityLevel(GetTriggerUnit(),'A29J')> 0 then
		call ZJI(GetTriggerUnit(), 9)
	endif
endfunction
function F4E takes nothing returns nothing
	call ZJI(GetTriggerUnit(), 18)
endfunction
function I5E takes nothing returns nothing
	local unit dummyUnit
	if(IsDayTime()== false) then
		set dummyUnit = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit()), bj_UNIT_FACING)
		call UnitAddPermanentAbility(dummyUnit,'A02R')
		call IssueTargetOrderById(dummyUnit, 852075, GetSpellTargetUnit())
	else
		set dummyUnit = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit()), bj_UNIT_FACING)
		call UnitAddPermanentAbility(dummyUnit,'A1H1')
		call IssueTargetOrderById(dummyUnit, 852075, GetSpellTargetUnit())
	endif
	set dummyUnit = null
endfunction
function ZLI takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit dummyUnit = LoadUnitHandle(HY, h, 19)
	call ResetUnitAnimation(WUE)
	call RemoveUnit(dummyUnit)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set WUE = null
	set dummyUnit = null
	set t = null
	return false
endfunction
function ZMI takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'u01I', GetUnitX(WUE), GetUnitY(WUE), GetUnitFacing(WUE))
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call EnableEffectByTime(A, 4 + GetUnitAbilityLevel(WUE,'A08Q'))
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function ZLI))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 19, dummyUnit)
	call SetUnitVertexColorBJ(dummyUnit, 0, 0, 0, 75)
	call SetUnitAnimation(dummyUnit, "spell third")
	set WUE = null
	set dummyUnit = null
	set t = null
endfunction
function bsckj takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call EnableEffectByTime(A, 3)
	endif
endfunction
function LXE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call ZMI()
	endif
endfunction



function PNE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A086')
	call UnitAddPermanentAbility(u,'P247')
	if(IsDayTime() or GetUnitAbilityLevel(u,'A36D')== 1) then
		call SetUnitAbilityLevel(u,'P247', 5)
	else
		call SetUnitAbilityLevel(u,'P247', level)
	endif
	set u = null
endfunction
function sckj takes unit u, boolean b returns nothing
	if b then
		call UnitAddAbility(u,'A08w')	//A08c 变晚上
		call UnitRemoveAbility(u,'A08w')
		call SetUnitAbilityLevel(u,'A08Q', GetUnitAbilityLevel(u,'A08E'))
	else
		call SetUnitAbilityLevel(u,'A08Q', 1)
		call UnitAddAbility(u,'A08q')	//A08Q 变白天
		call UnitRemoveAbility(u,'A08q')
	endif
endfunction
function SME takes nothing returns nothing
	local unit u = GetTriggerUnit()
	if GetUnitAbilityLevel(u,'A08E') == 1 then
		call UnitAddPermanentAbility(u,'A08Q')
	endif
	call SetUnitAbilityLevel(u,'A08Q', GetUnitAbilityLevel(u,'A08E'))
	if(IsDayTime()) then
		call sckj(u, false)
	else
		call sckj(u, true)
	endif
	set u = null
endfunction
function ZSI takes nothing returns nothing
	local real ZTI
	local real ZUI = 800
	local integer id
	local integer i
	local integer ZWI = 0
	local integer level
	local integer ZYI
	if LoadInteger(M, GetUnitTypeId(GetEnumUnit()), GC)> 0 then
		set ZUI = LoadInteger(M, GetUnitTypeId(GetEnumUnit()), GC)* 1.
	endif
	if GetPlayerTechResearched(GetOwningPlayer(GetEnumUnit()),'R00I', true) then
		set ZUI = 1800.
	endif
	set ZYI = R2I(ZUI /$80)
	if ZYI > 5 then
		set ZWI = IMinBJ(ZYI -5, 8)
	endif
	if ZWI > 0 then
		set id ='DRK0'-1 + ZWI
		if GetUnitAbilityLevel(GetEnumUnit(), id)== 0 then
			call UnitRemoveAbility(GetEnumUnit(),'DRK0')
			call UnitRemoveAbility(GetEnumUnit(),'DRK1')
			call UnitRemoveAbility(GetEnumUnit(),'DRK2')
			call UnitRemoveAbility(GetEnumUnit(),'DRK3')
			call UnitRemoveAbility(GetEnumUnit(),'DRK4')
			call UnitRemoveAbility(GetEnumUnit(),'DRK5')
			call UnitRemoveAbility(GetEnumUnit(),'DRK6')
			call UnitRemoveAbility(GetEnumUnit(),'DRK7')
			call UnitAddPermanentAbility(GetEnumUnit(), id)
		endif
	endif
endfunction
function ZZI takes nothing returns nothing
	if GetUnitAbilityLevel(GetEnumUnit(),'DRK0')> 0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK1')> 0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK2')> 0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK3')> 0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK4')> 0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK5')> 0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK6')> 0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK7')> 0 then
		call UnitRemoveAbility(GetEnumUnit(),'DRK0')
		call UnitRemoveAbility(GetEnumUnit(),'DRK1')
		call UnitRemoveAbility(GetEnumUnit(),'DRK2')
		call UnitRemoveAbility(GetEnumUnit(),'DRK3')
		call UnitRemoveAbility(GetEnumUnit(),'DRK4')
		call UnitRemoveAbility(GetEnumUnit(),'DRK5')
		call UnitRemoveAbility(GetEnumUnit(),'DRK6')
		call UnitRemoveAbility(GetEnumUnit(),'DRK7')
	endif
endfunction
function Z_I takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player p = LoadPlayerHandle(HY, h, 0)
	local real WOV = LoadReal(HY, h, 0)-0.5
	local group g = LoginGroup(371)
	local group gg = LoginGroup(372)
	local player p2
	local integer i = 0
	loop
		set p2 = Player(i)
		if IsPlayerEnemy(p, p2) then
			call GroupEnumUnitsOfPlayer(gg, p2, TrueBoolexprCondition)
			call GroupAddGroup(gg, g)
		endif
		set i = i + 1
	exitwhen i >$F
	endloop
	call SaveReal(HY, h, 0, WOV)
	set E3 = p
	if WOV > 0 then
		call ForGroup(g, function ZSI)
	else
		call ForGroup(g, function ZZI)
	endif
	if WOV <-20 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	call LogoutGroup(g)
	call LogoutGroup(gg)
	set t = null
endfunction
function Z0I takes unit u, real SYV returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function Z_I))
	call SavePlayerHandle(HY, h, 0, GetOwningPlayer(u))
	call SaveReal(HY, h, 0, SYV)
	set t = null
endfunction
function YSV takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real SYV = 50.
	local unit d = CreateUnit(Sentinels[1],'e00E', 0, 0, 0)
	call YHR(SYV, false)
	call UnitAddAbility(d,'A1T6')
	call IssueImmediateOrderById(d,$D028D)
	if Mode__BalanceOff then
		call Z0I(u, SYV)
	endif
	set d = null
	set u = null
endfunction

function StiflingDaggerLaunchAnAttack takes unit sourceUnit, unit targetUnit, unit dummyUnit, real data returns nothing
	local real damage = GetUnitState(sourceUnit, UNIT_STATE_ATTACK1_DAMAGE_BONUS) + GetUnitState(sourceUnit, UNIT_STATE_ATTACK1_DAMAGE_BASE) + GetUnitState(sourceUnit, UNIT_STATE_ATTACK1_DAMAGE_DICE) * GetRandomInt(1, R2I(GetUnitState(sourceUnit, UNIT_STATE_ATTACK1_DAMAGE_SIDE)) )
	local integer index = DEI + 1
	set IsAnAttack = true
	set DEDummyUnit[index] = dummyUnit
	set DEDummyAttack[index] = true
	call UnitDamageTargetEx(sourceUnit, targetUnit, 12, damage * data)
	set DEDummyUnit[index] = null
	set DEDummyAttack[index] = false
	set IsAnAttack = false
endfunction

function StiflingDaggerActions takes nothing returns nothing

	local missile m = GetHitMissile()
	local unit targetUnit = m.target
	local unit sourceUnit = m.owner
	local unit dummyUnit = CreateUnit(GetOwningPlayer(sourceUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local integer level = m.level
	local real data = 0.1 + 0.15 * level

	// 减速
	call UnitAddPermanentAbility(dummyUnit,'A0YL')
	call SetUnitAbilityLevel(dummyUnit,'A0YL', level)
	call IssueTargetOrderById(dummyUnit, 852075, targetUnit)
	
	call StiflingDaggerLaunchAnAttack(sourceUnit, targetUnit, m.missileUnit, data)
	
	// 图腾
	if GetUnitAbilityLevel(sourceUnit,'Broa')> 0 then
		call UnitRemoveAbility(sourceUnit, 'Broa')
	endif

	set sourceUnit = null
	set targetUnit = null
	set dummyUnit = null
endfunction
function StiflingDaggerLaunch takes unit triggerUnit, unit targetUnit, integer level returns nothing
	local missile m
	local real data
	if GetUnitAbilityLevel(triggerUnit,'Aloc') > 0 then
		set triggerUnit = Player__Hero[GetPlayerId(GetOwningPlayer(triggerUnit))]
	endif

	set m = m.create(triggerUnit, targetUnit, 1200.)
	set m.missileFile = "Abilities\\Weapons\\WardenMissile\\WardenMissile.mdl"
	set m.level = level
	set m.startUnit = triggerUnit
	set m.damageValue = 65
	set m.damageType = 3
	set m.canCountered = true
	set m.hitActions = "StiflingDaggerActions"
	call m.LaunchMissile()

endfunction
// 窒息之刃
function SpellEffect__StiflingDagger takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call StiflingDaggerLaunch(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(),'A0YM'))
	endif
endfunction
function Z5I takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local integer EVX = LoadInteger(HY, h, 34)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or GetUnitAbilityLevel(WUE,'A1CO')== 0 then
		call UnitRemoveAbility(WUE,'A1CO')
		call UnitRemoveAbility(WUE,'B1CO')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_PLAYER_UNIT_ATTACKED then
		if GetAttacker()== WUE then
			if GetTriggerUnit()!= targetUnit then
				call UnitRemoveAbility(WUE,'A1CO')
				call UnitRemoveAbility(WUE,'B1CO')
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			else
				set EVX = EVX + 1
				call SaveInteger(HY, h, 34,(EVX))
				if EVX == 4 then
					call UnitRemoveAbility(WUE,'A1CO')
					call UnitRemoveAbility(WUE,'B1CO')
					call FlushChildHashtable(HY, h)
					call CleanCurrentTrigger(t)
				endif
			endif
		endif
	else
		call UnitRemoveAbility(WUE,'A1CO')
		call UnitRemoveAbility(WUE,'B1CO')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function Z6I takes unit u, unit targetUnit returns nothing
	local trigger t
	local integer h
	call DestroyEffect(AddSpecialEffect("war3mapImported\\PhantomStrike.mdx", GetUnitX(u), GetUnitY(u)))
	call SetUnitX(u, GetUnitX(targetUnit))
	call SetUnitY(u, GetUnitY(targetUnit))
	if IsUnitEnemy(u, GetOwningPlayer(targetUnit)) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call UnitAddPermanentAbility(u,'A1CO')
		call WPE(u, targetUnit)
		call TriggerRegisterTimerEvent(t, 3, false)
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function Z5I))
		call SaveUnitHandle(HY, h, 2, u)
		call SaveUnitHandle(HY, h, 30, targetUnit)
	endif
	set t = null
endfunction
function Z7I takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	if GetUnitAbilityLevel(u,'Aloc')== 1 and HaveSavedHandle(HY, GetHandleId(u), 0) then
		set u = LoadUnitHandle(HY, GetHandleId(u), 0)
	endif
	call Z6I(u, WLE) // GetUnitAbilityLevel(u,'A0PL')
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set WLE = null
	set u = null
endfunction
function I7E takes nothing returns nothing
	local timer t = null
	local integer h
	if IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) or not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		call TimerStart(t, 0, false, function Z7I)
		set t = null
	endif
endfunction
function Z8I takes unit WUE, boolean Z9I returns nothing
	local integer level = GetUnitAbilityLevel(WUE,'P239')
	if Z9I == false then
		call UnitRemoveAbility(WUE,'A13F')
		call UnitRemoveAbility(WUE,'B0A2')
	else
		call UnitAddPermanentAbility(WUE,'A13F')
	endif
endfunction
function VVA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local group g
	local integer EVX =(LoadInteger(HY, h, 34))
	local boolean VEA =(LoadBoolean(HY, h, 674))
	set EVX = EVX + 1
	call SaveInteger(HY, h, 34,(EVX))
	if WUE != null and UnitIsDead(WUE)== false and GetUnitAbilityLevel(WUE,'P239')> 0 then
		set U2 = WUE
		set g = LoginGroup(373)
		if GetUnitAbilityLevel(WUE,'A36D')== 0 then
			call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE),$659, Condition(function DLX))
		else
			call GroupAddUnit(g, WUE)
		endif
		if FirstOfGroup(g)!= null then
			if VEA then
				set VEA = false
				call SaveBoolean(HY, h, 674,(VEA))
				set EVX = 0
				call SaveInteger(HY, h, 34,(EVX))
			else
				set EVX = 0
				call SaveInteger(HY, h, 34,(EVX))
				call SaveInteger(HY,(GetHandleId((WUE))),(4302), 2)
				call Z8I(WUE, true)
				call SetUnitVertexColorEx(WUE,-1,-1,-1, 255)
				if GetUnitAbilityLevel(WUE,'A20S')== 0 then
					call UnitSetUsesAltIcon(WUE, false)
				endif
			endif
		else
			if VEA == false then
				set VEA = true
				set EVX = 0
				call SaveBoolean(HY, h, 674,(VEA))
				call SaveInteger(HY, h, 34,(EVX))
			else
				set EVX = 0
				call SaveInteger(HY, h, 34,(EVX))
				call SaveInteger(HY,(GetHandleId((WUE))),(4302), 1)
				call Z8I(WUE, false)
				call SetUnitVertexColorEx(WUE,-1,-1,-1, 64)
				call UnitSetUsesAltIcon(WUE, IsPlayerEnemy(GetOwningPlayer(WUE), LocalPlayer) and IsUnitFogged(WUE, LocalPlayer)== false and IsObserver== false)
			endif
		endif
		call LogoutGroup(g)
		set g = null
	endif
	set t = null
	set WUE = null
	return false
endfunction
function MBE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function VVA))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveInteger(HY, h, 34, 0)
	call EnableEffectByTime(4, 99999)
	call SaveBoolean(HY, h, 674,(false))
	set t = null
	set WUE = null
endfunction
function VXA takes nothing returns nothing
	local unit dummyUnit
	if IsUnitInGroup(GetEnumUnit(), DK)== false and UnitVisibleToPlayer(GetEnumUnit(), GetOwningPlayer(MCV)) then
		set dummyUnit = CreateUnit(GetOwningPlayer(MCV),'e00E', GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()), 0)
		call UnitAddPermanentAbility(dummyUnit,'A0RI')
		call SetUnitAbilityLevel(dummyUnit,'A0RI', GetUnitAbilityLevel(MCV,'A0RA'))
		if IssueTargetOrderById(dummyUnit,$D008A, GetEnumUnit()) then
			call GroupAddUnit(DK, GetEnumUnit())
			call UnitDamageTargetEx(MCV, GetEnumUnit(), 1, 100)
		endif
		call UnitRemoveAbility(dummyUnit,'A0RI')
		set dummyUnit = null
	endif
endfunction
function VOA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer i
	local group g =(LoadGroupHandle(HY, h, 22))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local group F5X = LoginGroup(374)
	local unit K4X =(LoadUnitHandle(HY, h,$DD))
	set U2 = K4X
	set MCV = K4X
	call GroupEnumUnitsInRange(F5X, x, y, 300, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	set DK = g
	call ForGroup(F5X, function VXA)
	call LogoutGroup(F5X)
	if GetTriggerEvalCount(t)> 7 *$A then
		set i = 1
		loop
		exitwhen i > 16
			call DestroyEffect((LoadEffectHandle(HY, h,($A8C+ i))))
			set i = i + 1
		endloop
		call LogoutGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set g = null
	set F5X = null
	set K4X = null
	return false
endfunction
function I8E takes nothing returns nothing
	local integer i = 1
	local real VRA = GetSpellTargetX()
	local real VIA = GetSpellTargetY()
	local real x
	local real y
	local integer VAA = 16
	local string fx = "Abilities\\Spells\\Undead\\Graveyard\\GraveMarker.mdl"
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local group g = LoginGroup(375)
	call A8X(GetOwningPlayer(GetTriggerUnit()), 7, VRA, VIA, 300 + 500)
	call PlaySoundAtPoint(BC, VRA, VIA)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function VOA))
	call SaveGroupHandle(HY, h, 22,(g))
	call SaveUnitHandle(HY, h,$DD,(GetTriggerUnit()))
	call SaveReal(HY, h, 6,((VRA)* 1.))
	call SaveReal(HY, h, 7,((VIA)* 1.))
	call CreateCorpse(GetOwningPlayer(GetTriggerUnit()),'ugho', VRA, VIA, 0)
	loop
	exitwhen i > VAA
		set x = VRA + 300 * Cos(i * 360 / VAA * bj_DEGTORAD)
		set y = VIA + 300 * Sin(i * 360 / VAA * bj_DEGTORAD)
		call SaveEffectHandle(HY, h,($A8C+ i),(AddSpecialEffect(fx, x, y)))
		if i == 1 or i == 5 or i == 9 or i ==$D then
			set x = VRA + 275 * Cos(i * 360 / VAA * bj_DEGTORAD)
			set y = VIA + 275 * Sin(i * 360 / VAA * bj_DEGTORAD)
			call CreateCorpse(GetOwningPlayer(GetTriggerUnit()),'ugho', x, y, 0)
		endif
		set i = i + 1
	endloop
	set t = null
	set g = null
endfunction
function VBA takes nothing returns nothing
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl", GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit())))
	call EPX(GetEnumUnit(), 4406, 1)
	call SetUnitPosition(GetEnumUnit(), S2, TJ)
	call PanCameraToTimedForPlayer(GetOwningPlayer(GetEnumUnit()), S2, TJ, 0)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl", GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit())))
endfunction

function VCA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(P, GetHandleId(t), 0)
	call UnitRemoveAbility(u,'A2MB')
	call UnitAddPermanentAbility(u,'A2MB')
	call DestroyTimerAndFlushHT_P(t)
	set t = null
	set u = null
endfunction

function VDA takes unit u returns nothing
	local timer t = CreateTimer()
	call SaveUnitHandle(P, GetHandleId(t), 0, u)
	call TimerStart(t, 0, false, function VCA)
	set t = null
endfunction

function VFA takes nothing returns boolean
	return IsUnitAlly(GetFilterUnit(), GetOwningPlayer(U2)) and GetUnitAbilityLevel(GetFilterUnit(),'Aloc')== 0 and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and UnitIsDead(GetFilterUnit())== false and XFX(GetOwningPlayer(GetFilterUnit()))
endfunction

function VGA takes unit WUE, unit targetUnit returns nothing
	local group g = LoginGroup(376)
	local player p = GetOwningPlayer(WUE)
	local real x1 = GetWidgetX(WUE)
	local real y1 = GetWidgetY(WUE)
	local real x2 = GetWidgetX(targetUnit)
	local real y2 = GetWidgetY(targetUnit)
	call DestroyEffect(AddSpecialEffect("Doodads\\Cinematic\\ShimmeringPortal\\ShimmeringPortal.mdl", x1, y1))
	call DestroyEffect(AddSpecialEffect("Doodads\\Cinematic\\ShimmeringPortal\\ShimmeringPortal.mdl", x2, y2))
	set S2 = x2
	set TJ = y2
	set U2 = WUE
	call GroupEnumUnitsInRange(g, x1, y1, 475, Condition(function VFA))
	call ForGroup(g, function VBA)
	call LogoutGroup(g)
	call UnitRemoveAbility(WUE,'A2MB')
	call S9E(p,'A2MB', false)
	call S9E(p,'A0R0', true)
	set g = null
	set p = null
endfunction

function VHA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local player p = GetOwningPlayer(WUE)
	local boolean b = GetSpellAbilityId()=='A2MB'
	if UnitIsDead(targetUnit) or UnitIsDead(WUE) or targetUnit == null or WUE == null or b then
		if b then
			call VDA(WUE)
		else
			call InterfaceErrorForPlayer(p, GetObjectName('n03F'))
		endif
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call SetUnitPeonType(targetUnit, false)
		
		call S9E(p,'A2MB', false)
		call S9E(p,'A0R0', true)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set t = null
		set WUE = null
		set targetUnit = null
		return false
	endif
	if GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call VGA(WUE, targetUnit)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set p = null
	return false
endfunction

function VJA takes nothing returns boolean
	local real d
	if IsUnitAlly(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit()))== false or GetUnitAbilityLevel(GetFilterUnit(),'A04R')> 0 or GetOwningPlayer(GetFilterUnit())== NeutralPassivePlayer or UnitIsDead(GetFilterUnit()) then
		return false
	endif
	if IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE) or(LWO(GetFilterUnit())) then
		set d = GetDistanceBetween(TJ, RJ, GetUnitX(GetFilterUnit()), GetUnitY(GetFilterUnit()))
		if d < S2 then
			set S2 = d
			set U2 = GetFilterUnit()
		endif
	endif
	return false
endfunction

function DarkRift_EnumUnit takes unit WUE returns unit
	local group g
	local real x
	local real y
	set x = GetSpellTargetX()
	set y = GetSpellTargetY()
	set g = LoginGroup(377)
	set U2 = null
	set S2 = 9999
	set TJ = x
	set RJ = y
	call GroupEnumUnitsInRange(g, x, y,$FA0, Condition(function VJA))
	call LogoutGroup(g)
	set g = null
	return U2
endfunction

function VNA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit dummyUnit =(LoadUnitHandle(HY, h, 393))
	local integer level =(LoadInteger(HY, h, 5))
	local integer FTR = 90
	local integer EVX = GetTriggerEvalCount(t)
	if GetTriggerEventId() == EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId() == 'A2MB' then
		call KillUnit(dummyUnit)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set t = null
		set dummyUnit = null
		set WUE = null
		return false
	endif
	if level == 1 then
		set FTR = 160
	elseif level == 2 then
		set FTR = 120
	endif
	call SetUnitX(dummyUnit, GetUnitX(WUE))
	call SetUnitY(dummyUnit, GetUnitY(WUE))
	if EVX > FTR then
		call KillUnit(dummyUnit)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif EVX == 30 then
		call UnitRemoveAbility(dummyUnit, 'Aloc')
		call ShowUnit(dummyUnit, true)
		call UnitAddAbility(dummyUnit,'Aloc')
	endif
	set t = null
	set dummyUnit = null
	set WUE = null
	return false
endfunction

function Effect_DarkRift takes unit triggerUnit returns nothing
	local trigger t
	local integer h
	local unit stg_u = GetSpellTargetUnit()
	local real x
	local real y
	if stg_u == null then
		set stg_u = DarkRift_EnumUnit(triggerUnit)
	endif
	if stg_u == null then
		call InterfaceErrorForPlayer(GetOwningPlayer(triggerUnit), GetObjectName('n03H'))
		return
	endif
	call S9E(GetOwningPlayer(triggerUnit),'A0R0', false)
	call S9E(GetOwningPlayer(triggerUnit),'A2MB', true)
	call UnitAddPermanentAbility(triggerUnit,'A2MB')
	set t = CreateTrigger()
	set h = GetHandleId(t)
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(triggerUnit)) or IsObserver then
		call PingMinimapEx(GetUnitX(stg_u), GetUnitY(stg_u), 3, 255, 255, 255, false)
	endif
	call TriggerRegisterTimerEvent(t, 7 -GetUnitAbilityLevel(triggerUnit,'A0R0'), false)
	call TriggerRegisterDeathEvent(t, stg_u)
	call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function VHA))
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("war3mapImported\\DarkHands.mdl", stg_u, "overhead"))
	call SaveUnitHandle(HY, h, 2, triggerUnit)
	call SaveUnitHandle(HY, h, 17, stg_u)
	call SetUnitPeonType(stg_u, true)
	
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function VNA))
	call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_SPELL_EFFECT)
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(triggerUnit,'A0R0'))
	call SaveUnitHandle(HY, h, 2, triggerUnit)
	set stg_u = CreateUnit(GetOwningPlayer(triggerUnit),'h098', GetUnitX(triggerUnit), GetUnitY(triggerUnit), 0)
	call SaveUnitHandle(HY, h, 393, stg_u)
	call UnitRemoveAbility(stg_u,'Aloc')
	call ShowUnit(stg_u, false)
	
	set t = null
	set stg_u = null
endfunction

function K7E takes nothing returns nothing
	local unit stg_u = GetSpellTargetUnit()
	local unit triggerUnit = GetTriggerUnit()
	if stg_u != null then
		if IsUnitEnemy(stg_u, GetOwningPlayer(triggerUnit)) or LWO(stg_u)== false then
			call EXStopUnit(triggerUnit)
			call InterfaceErrorForPlayer(GetOwningPlayer(triggerUnit), GetObjectName('n041'))
		endif
	else
		set stg_u = DarkRift_EnumUnit(triggerUnit)
	endif
	if stg_u == null then
		call EXStopUnit(triggerUnit)
		call InterfaceErrorForPlayer(GetOwningPlayer(triggerUnit), GetObjectName('n040'))
	endif
	set stg_u = null
	set triggerUnit = null
endfunction

function DarkRift takes nothing returns nothing
	call Effect_DarkRift(GetTriggerUnit())
endfunction

function PJX takes nothing returns nothing
	call B6X('h094')
	call B6X('h095')
	call B6X('h096')
endfunction
function VMA takes nothing returns nothing
	local unit t = GetEnumUnit()
	if GetUnitAbilityLevel(t,'D009')== 1 then
		if IsUnitType(t, UNIT_TYPE_STRUCTURE) then
			call UnitDamageTargetEx(Temp__ArrayUnit[0], t, 1, XK[0]/ 3)
		else
			call UnitDamageTargetEx(Temp__ArrayUnit[0], t, 1, XK[0])
		endif
	endif
	set t = null
endfunction
function VPA takes nothing returns boolean
	local unit t = GetFilterUnit()
	local unit u = Temp__ArrayUnit[0]
	if IsUnitEnemy(u, GetOwningPlayer(t)) and UnitAlive(t) and GetUnitAbilityLevel(t,'A04R')== 0 and IsMagicImmuneUnit(t)== false then
		if IsUnitType(t, UNIT_TYPE_STRUCTURE) then
			call UnitDamageTargetEx(u, t, 1, XK[0]/ 3)
		else
			call UnitDamageTargetEx(u, t, 1, XK[0])
		endif
		call WJV(t,'C009','D009', 2)
		call GroupAddUnit(LoadGroupHandle(P, XK[1], 1), t)
	endif
	set u = null
	set t = null
	return false
endfunction
function VQA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WVV = 0
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(P, WFV, 0)
	local real x = LoadReal(P, WFV, 0)
	local real y = LoadReal(P, WFV, 1)
	local group g = LoadGroupHandle(P, WFV, 1)
	set Temp__ArrayUnit[0]= LoadUnitHandle(P, WFV, 0)
	set XK[0]= LoadInteger(P, WFV, 1)
	call ForGroup(g, function VMA)
	call SaveInteger(P, WFV, 0, UYX -1)
	if UYX > 2 then
		set XK[0]= LoadInteger(P, WFV, 2)
		set XK[1]= WFV
		call GroupEnumUnitsInRange(AK, x, y, 425, Condition(function VPA))
		if UYX == 3 then
			set t = null
			set g = null
			return
		endif
		loop
		exitwhen WVV ==$C
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Demon\\RainOfFire\\RainOfFireTarget.mdl", x + GetRandomReal(50, 275)* Cos(WVV * 30 * bj_DEGTORAD), y + GetRandomReal(50, 275)* Sin(WVV * 30 * bj_DEGTORAD)))
			set WVV = WVV + 1
		endloop
	elseif UYX == 1 then
		call LogoutGroup(g)
		call DestroyTimerAndFlushHT_P(t)
	endif
	set g = null
	set t = null
endfunction
function YVV takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local group g = LoginGroup(378)
	local integer WVV = 0
	local integer WFV = GetHandleId(t)
	local integer WUV = GetUnitAbilityLevel(u,'A01I')
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	loop
	exitwhen WVV ==$C
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Demon\\RainOfFire\\RainOfFireTarget.mdl", x + GetRandomReal(50, 275)* Cos(WVV * 30 * bj_DEGTORAD), y + GetRandomReal(50, 275)* Sin(WVV * 30 * bj_DEGTORAD)))
		set WVV = WVV + 1
	endloop
	call SaveInteger(P, WFV, 0, 8)
	call SaveInteger(P, WFV, 1, WUV * 5)
	call SaveInteger(P, WFV, 2,$A+$F* WUV)
	call SaveReal(P, WFV, 0, x)
	call SaveReal(P, WFV, 1, y)
	call SaveUnitHandle(P, WFV, 0, u)
	call SaveGroupHandle(P, WFV, 1, g)
	call TimerStart(t, .9, true, function VQA)
	set g = null
	set u = null
	set t = null
endfunction
function VSA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	call LodSystem_ReduceUnitExtraState(LoadUnitHandle(P, WFV, 0), LoadInteger(P, WFV, 0), STATE_SYSTEM_DAMAGE)
	call DestroyTimerAndFlushHT_P(t)
	set t = null
endfunction
function VTA takes unit u, boolean b returns nothing
	local timer t = CreateTimer()
	local integer WFV = GetHandleId(t)
	local integer CJR = 5
	local integer level = GetUnitAbilityLevel(u,'AIcd')
	if b then
		set CJR = 20
	endif
	call SaveUnitHandle(P, WFV, 0, u)
	call SaveInteger(P, WFV, 0, CJR)
	call LodSystem_AddUnitExtraState(u, CJR, STATE_SYSTEM_DAMAGE)
	call TimerStart(t, level * 5 + 25, false, function VSA)
	set t = null
endfunction
function VUA takes nothing returns boolean
	local unit t = GetFilterUnit()
	if LoadBoolean(P, GetHandleId(t),'AIcd') and UnitAlive(t) and IsUnitEnemy(t, Temp__Player) then
		call VTA(t, IsUnitType(Temp__ArrayUnit[0], UNIT_TYPE_HERO))
	endif
	set t = null
	return false
endfunction
function VWA takes nothing returns boolean
	local unit u = GetTriggerUnit()
	local integer id = GetUnitTypeId(u)
	if GetUnitAbilityLevel(u,'A04R')== 0 and id !='n0F5' and id !='N0MM' and IsUnitIllusion(u)== false and UnitIsDead(u) then
		set Temp__Player = GetOwningPlayer(u)
		set Temp__ArrayUnit[0]= u
		call GroupEnumUnitsInRange(AK, GetWidgetX(Temp__ArrayUnit[0]), GetWidgetY(Temp__ArrayUnit[0]), 925, Condition(function VUA))
	endif
	set u = null
	return false
endfunction
function L0E takes nothing returns nothing
	local trigger HLR = null
	call SaveBoolean(P, GetHandleId(GetTriggerUnit()),'AIcd', true)
	if LoadBoolean(P,'AIcd', 0) then
		return
	endif
	set HLR = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(HLR, EVENT_PLAYER_UNIT_DEATH)
	call TriggerAddCondition(HLR, Condition(function VWA))
	call SaveBoolean(P,'AIcd', 0, true)
	set HLR = null
endfunction
function VYA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer hu = GetHandleId(u)
	local group g
	local unit u2
	local real ZCE
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call DestroyTrigger(t)
		call FlushChildHashtable(HY, h)
		call RemoveSavedHandle(HY, hu,'A0AZ')
	elseif IsUnitHidden(u)== false then
		set g = LoginGroup(379)
		set U2 = u
		call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 300, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		set ZCE = 7 * GetUnitAbilityLevel(u,'A06K')
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			call UnitDamageTargetEx(u, u2, 1, ZCE)
			call GroupRemoveUnit(g, u2)
		endloop
		call UnitDamageTargetEx(u, u, 1, ZCE)
		call LogoutGroup(g)
	endif
	set t = null
	set u = null
	return false
endfunction
function VZA takes boolean b returns nothing
	local trigger t = null
	local integer h = 0
	local unit u = GetTriggerUnit()
	local integer hu = GetHandleId(u)
	if HaveSavedHandle(HY, hu,'A0AZ') then
		set t = LoadTriggerHandle(HY, hu,'A0AZ')
		set h = GetHandleId(t)
	elseif b then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, hu,'A0AZ', t)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerRegisterTimerEvent(t, .2, true)
		call TriggerRegisterTimerEvent(t, .0, false)
		call TriggerAddCondition(t, Condition(function VYA))
		call SaveUnitHandle(HY, h, 0, u)
	endif
	if b == false then
		if t != null then
			call DestroyTrigger(t)
			call FlushChildHashtable(HY, h)
			call RemoveSavedHandle(HY, hu,'A0AZ')
		endif
	endif
	set t = null
	set u = null
endfunction
function V_A takes nothing returns boolean
	return GetUnitAbilityLevel(GetTriggerUnit(),'A06K')> 0
endfunction
function V0A takes nothing returns nothing
	if(GetIssuedOrderId()==$D00D1) then
		call UnitAddPermanentAbility(GetTriggerUnit(),'A0AZ')
		call VZA(true)
	elseif(GetIssuedOrderId()==$D00D2) then
		call UnitRemoveAbility(GetTriggerUnit(),'A0AZ')
		call VZA(false)
	endif
endfunction
function M7X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call A1X(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call TriggerAddCondition(t, Condition(function V_A))
	call TriggerAddAction(t, function V0A)
	set t = null
endfunction
function W2X takes nothing returns nothing
	local unit SZX = U2
	local unit SYX = W2
	local integer i = 1
	local integer k = 5
	local integer TME
	if IsSentinelsPlayer(GetOwningPlayer(SZX)) then
		loop
			set TME = GetPlayerId(Scourges[i])
			if UnitIsDead(Player__Hero[TME])== false and(GetPlayerId(GetOwningPlayer(SYX))== TME or GetDistanceBetweenUnits(SZX, Player__Hero[TME])< 725) then
				set SI[TME]= SI[TME]+ 1
			endif
			set i = i + 1
		exitwhen i > k
		endloop
	elseif IsScourgesPlayer(GetOwningPlayer(SZX)) then
		loop
			set TME = GetPlayerId(Sentinels[i])
			if UnitIsDead(Player__Hero[TME])== false and(GetPlayerId(GetOwningPlayer(SYX))== TME or GetDistanceBetweenUnits(SZX, Player__Hero[TME])< 725) then
				set SI[TME]= SI[TME]+ 1
			endif
			set i = i + 1
		exitwhen i > k
		endloop
	endif
	set SYX = null
	set SZX = null
endfunction
function V1A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	if GetTriggerEvalCount(t)== 1 then
		call ShowUnit(u, false)
	elseif GetTriggerEvalCount(t)> 80 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	return false
endfunction
function Rot_Suicide takes nothing returns nothing
	local unit u = null
	local trigger t
	local integer h
	local unit SZX = GetTriggerUnit()
	local unit SYX = GetKillingUnit()
	if GetUnitAbilityLevel(SYX,'A06K')> 0 then
		if SZX == SYX then
			set u = CreateUnit(GetOwningPlayer(SZX),'h0BB', GetUnitX(SZX), GetUnitY(SZX), GetUnitFacing(SZX))
			call SetUnitTimeScale(u, .75)
			call UnitApplyTimedLife(u,'BTLF', 1.)
			call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodAbomination.mdl", u, "origin"))
			set u = null
			call SetSoundPosition(SE, GetUnitX(SZX), GetUnitY(SZX), 50)
			call SetSoundVolumeBJ(SE, 100)
			call PlaySoundBJ(SE)
			call SetSoundPosition(RE, GetUnitX(SZX), GetUnitY(SZX), 50)
			call SetSoundVolumeBJ(RE, 100)
			call PlaySoundBJ(RE)
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call TriggerRegisterTimerEvent(t, .1, true)
			call TriggerAddCondition(t, Condition(function V1A))
			call SaveUnitHandle(HY, h, 2, SZX)
			set t = null
		endif
	endif
	set SZX = null
	set SYX = null
endfunction
//设置被动的充能点数，模板必须为照明弹或哨兵，用lua屏蔽点击技能按钮。
function SetAbilitydataD takes unit u, integer ab, integer i returns nothing
	local integer lv = GetUnitAbilityLevel(u, ab)
	call YDWESetUnitAbilityDataReal(u, ab, 1, 111, i * 1.)
	call UnitRemoveAbility(u, ab)
	call UnitAddPermanentAbilitySetLevel(u, ab, lv)
endfunction
function V2A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local unit u =(LoadUnitHandle(HY,(GetHandleId(t)), 2))
	local integer h = GetHandleId(u)
	local integer V3A = LoadInteger(P, h,'A06D')
	local integer lv = GetUnitAbilityLevel(u,'A06D')
	local integer V4A = R2I(I2R(SI[GetPlayerId(GetOwningPlayer(u))])*(.5 * lv))
	if u == null then
		call FlushChildHashtable(HY, GetHandleId(t))
		call CleanCurrentTrigger(t)
	endif
	if V4A > V3A then
		call ModifyHeroStat(0, u, 0, V4A -V3A)
		call SetAbilitydataD(u,'QP13', V4A)
		call SaveInteger(P, h,'A06D', V4A)
		call CommonTextTag("+" + I2S(V4A -V3A)+ " " + GetObjectName('n0MJ'), 3, u, .023, 0, 255, 0,$E6)
		if GetHeroPrimaryAttributesType(u)!= 1 then
			call SaveInteger(HY, GetHandleId(u),'axxx', V4A)
			call KVX(u)
		endif
	endif
	set t = null
	set u = null
	return false
endfunction
function LearnSkill__FleshHeap takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u, 'A06D')
	if level == 1 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .5, true)
		call TriggerAddCondition(t, Condition(function V2A))
		call SaveUnitHandle(HY, h, 2,(u))
		set t = null
		if not IsUnitBreak(u) then
			call AddUnitMagicResistance(u, 0.04 + level * 0.02)
		endif
	elseif not IsUnitBreak(u) then
		call ReduceUnitMagicResistance(u, 0.04 + ( level - 1 ) * 0.02)
		call AddUnitMagicResistance(u, 0.04 + level * 0.02)
	endif
	set u = null
endfunction
function V5A takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	call SetUnitPathing(u, true)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set u = null
	set t = null
endfunction
function V6A takes unit u, unit t returns nothing
	local unit d1 = CreateUnit(GetOwningPlayer(t),'e00E', GetUnitX(t), GetUnitY(t), 0)
	local unit d2 = CreateUnit(GetOwningPlayer(u),'e02A', GetUnitX(t), GetUnitY(t), 0)
	call UnitAddPermanentAbility(d1,'A0PZ')
	call IssueTargetOrderById(d1, 852095, t)
	call UnitApplyTimedLife(d1,'BTLF', 1)
	call UnitApplyTimedLife(d2,'BTLF', 1)
	set d1 = null
	set d2 = null
endfunction
function V7A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer V8A =(LoadInteger(HY, h, 376))
	local boolean V9A =(LoadBoolean(HY, h, 377))
	local unit u =(LoadUnitHandle(HY, h, 17))
	local unit EVA =(LoadUnitHandle(HY, h,($834+ V8A)))
	local real x
	local real y
	local trigger tt
	if V9A then
		set x = GetUnitX(EVA)
		set y = GetUnitY(EVA)
		if GetDistanceBetween(GetUnitX(EVA), GetUnitY(EVA), GetUnitX(u), GetUnitY(u))< 1200 then
			if IsUnitType(u, UNIT_TYPE_HERO) then
				call SaveBoolean(K, GetHandleId(u), 99, true)
			endif
			call SetUnitX(u, x)
			call SetUnitY(u, y)
			if ModuloInteger(GetTriggerEvalCount(t), 3) == 0 and IsUnitEnemy(u, GetOwningPlayer(EVA)) then
				call FYX(u , .1)
			endif
		else
			call SaveBoolean(HY, h, 377, false)
		endif
		if u == null then
			call SaveBoolean(HY, h, 377, false)
		endif
	endif
	call RemoveUnit(EVA)
	set V8A = V8A -1
	call SaveInteger(HY, h, 376,(V8A))
	if V8A <= 0 then
		if(A4X(x, y)== false or IsPointInRegion(R4, x, y)) and IsUnitType(u, UNIT_TYPE_HERO) then
			set tt = CreateTrigger()
			call SaveUnitHandle(HY, GetHandleId(tt), 0, u)
			call TriggerRegisterTimerEvent(tt, 5, false)
			call TriggerAddCondition(tt, Condition(function V5A))
			set tt = null
		else
			call SetUnitPathing(u, true)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	set EVA = null
	return false
endfunction
function EEA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer i =(LoadInteger(HY, h, 376))
	local integer lv =(LoadInteger(HY, h, 5))
	local real a =(LoadReal(HY, h, 13))
	local unit u =(LoadUnitHandle(HY, h, 14))
	local trigger trg2 =(LoadTriggerHandle(HY, h, 11))
	local integer h2 = GetHandleId(trg2)
	local group g
	local unit target
	local real x
	local real y
	local real z
	local integer hp = GetHandleId(GetOwningPlayer(u))
	local real QTR = 110
	if i < 22.5 + 2.5 * lv then
		set i = i + 1
		if i == 1 then
			set QTR = 50
		elseif i == 2 then
			set QTR = 75
		endif
		call SaveInteger(HY, h, 376,(i))
		set x = GetUnitX(u)+ i * 40 * Cos(a * bj_DEGTORAD)
		set y = GetUnitY(u)+ i * 40 * Sin(a * bj_DEGTORAD)
		call SaveUnitHandle(HY,(h2),($834+ i),(CreateUnit(GetOwningPlayer(u),'u00H', x, y, a)))
		set g = LoginGroup(380)
		call GroupEnumUnitsInRange(g, x, y, QTR, Condition(function D9X))
		call GroupRemoveUnit(g, u)
		if GetUnitTypeId(u)=='e00E' then
			call GroupRemoveUnit(g, Player__Hero[GetPlayerId(GetOwningPlayer(u))])
		endif
		set target = GroupPickRandomUnit(g)
		call LogoutGroup(g)
		if target != null then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call TriggerRegisterTimerEvent(trg2, .025, true)
			call TriggerRegisterDeathEvent(trg2, target)
			call TriggerAddCondition(trg2, Condition(function V7A))
			call SaveInteger(HY,(h2), 376,(i))
			call SaveBoolean(HY,(h2), 377,(true))
			call SaveUnitHandle(HY,(h2), 17,(target))
			call SetUnitPathing(target, false)
			if IsUnitEnemy(target, GetOwningPlayer(u)) then
				if IsUnitType(target, UNIT_TYPE_HERO) then
					call SaveInteger(K, hp,'HK_H', LoadInteger(K, hp,'HK_H')+ 1)
					call JSX("HA_Hits" + I2S(GetPlayerId(GetOwningPlayer(u))), LoadInteger(K, hp,'HK_H'))
					call EPX(u, 4400, 1.5)
				endif
				call V6A(u, target)
				call UnitDamageTargetEx(u, target, 7, 90 * lv)
				call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl", target, "origin"))
			endif
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call TriggerRegisterTimerEvent(trg2, .025, true)
		call TriggerAddCondition(trg2, Condition(function V7A))
		call SaveInteger(HY,(h2), 376,(i))
		call SaveBoolean(HY,(h2), 377,(false))
	endif
	set t = null
	set u = null
	set trg2 = null
	set g = null
	set target = null
	return false
endfunction
function I9E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real a = AngleBetweenXY(GetUnitX(u), GetUnitY(u), GetSpellTargetX(), GetSpellTargetY())
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer hp = GetHandleId(GetOwningPlayer(u))
	call SaveUnitHandle(HY, h, 14,(u))
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(u,'A06I') )
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveInteger(HY, h, 376, 0)
	call SaveTriggerHandle(HY, h, 11,(CreateTrigger()))
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function EEA))
	call SaveInteger(K, hp,'HK_T', LoadInteger(K, hp,'HK_T')+ 1)
	call JSX("HA_Total" + I2S(GetPlayerId(GetOwningPlayer(u))), LoadInteger(K, hp,'HK_T'))
	set u = null
	set t = null
endfunction
function dismember_upgraded_effect takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	local unit target =(LoadUnitHandle(HY, h, 17))
	local integer lv =(LoadInteger(HY, h, 5))
	local real damage =(75 + 50 * lv)+ E3X(u)
	local integer c =(LoadInteger(HY, h, 34))
	if GetTriggerEventId()== EVENT_UNIT_DEATH or GetTriggerEventId()== EVENT_UNIT_SPELL_ENDCAST then
		if GetTriggerEventId()== EVENT_UNIT_DEATH or(GetTriggerEventId()== EVENT_UNIT_SPELL_ENDCAST and GetSpellAbilityId()=='A1CX') then
			call FIX(target)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	elseif GetTriggerEvalCount(t)> 7 then
		call FIX(target)
		call EXStopUnit(u)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if lv > 0 then
			set c = c + 1
			if(c < 4 and IsUnitType(target, UNIT_TYPE_HERO)) or(c < 7 and IsUnitType(target, UNIT_TYPE_HERO)== false) then
				call SetWidgetLife(u, GetWidgetLife(u)+ damage)
				call UnitDamageTargetEx(u, target, 1, damage)
			endif
			call SaveInteger(HY, h, 34,(c))
		endif
		if UnitIsDead(target)== false and GetUnitAbilityLevel(target,'Bdet')==0 then
			call FAX(u,target)
		endif
	endif
	set t = null
	set u = null
	set target = null
	return false
endfunction
function dismember_upgraded_actions takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local unit target = GetSpellTargetUnit()
	local integer lv = GetUnitAbilityLevel(u,'A1CX')
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterUnitEvent(t, target, EVENT_UNIT_DEATH)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function dismember_upgraded_effect))
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveUnitHandle(HY, h, 17,(target))
	call SaveInteger(HY, h, 5,(lv))
	call SaveInteger(HY, h, 34, 0)
	call FAX(u, target)
	call TriggerEvaluate(t)
	set t = null
	set u = null
	set target = null
endfunction
function Dismember_Upgraded takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call dismember_upgraded_actions()
	endif
endfunction
function dismember_effect takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	local unit target =(LoadUnitHandle(HY, h, 17))
	local integer lv =(LoadInteger(HY, h, 5))
	local real damage =(50 + 50 * lv)
	local integer c =(LoadInteger(HY, h, 34))
	if GetTriggerEventId()== EVENT_UNIT_DEATH or GetTriggerEventId()== EVENT_UNIT_SPELL_ENDCAST then
		if GetTriggerEventId()== EVENT_UNIT_DEATH or(GetTriggerEventId()== EVENT_UNIT_SPELL_ENDCAST and GetSpellAbilityId()=='A0FL') then
			call FIX(target)
			call FlushChildHashtable(HY,(h))
			call CleanCurrentTrigger(t)
		endif
	elseif GetTriggerEvalCount(t)> 7 then
		call FIX(target)
		call EXStopUnit(u)
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	else
		if lv > 0 then
			set c = c + 1
			if(c < 4 and IsUnitType(target, UNIT_TYPE_HERO)) or(c < 7 and IsUnitType(target, UNIT_TYPE_HERO)== false) then
				call UnitDamageTargetEx(u, target, 1, damage)
			endif
			call SaveInteger(HY, h, 34,(c))
		endif
		if UnitIsDead(target)== false and GetUnitAbilityLevel(target,'Bdet')== 0 then
			call FAX(u, target)
		endif
	endif
	set t = null
	set u = null
	set target = null
	return false
endfunction
function dismember_actions takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local unit target = GetSpellTargetUnit()
	local integer lv = GetUnitAbilityLevel(u,'A0FL')
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterUnitEvent(t, target, EVENT_UNIT_DEATH)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function dismember_effect))
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveUnitHandle(HY, h, 17,(target))
	call SaveInteger(HY, h, 5,(lv))
	call SaveInteger(HY, h, 34, 0)
	call FAX(u, target)
	call TriggerEvaluate(t)
	set t = null
	set u = null
	set target = null
endfunction
function Dismember takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call dismember_actions()
	endif
endfunction
function EAA takes unit FAO, real ENA returns nothing
	local real IQX = GetUnitState(FAO, UNIT_STATE_MAX_LIFE)
	local real ISX = GetWidgetLife(FAO)
	if ENA > 0 then
		if ENA >(IQX -ISX) then
			if ENA >= ISX then
				call SetWidgetLife(FAO, IQX)
				call SetUnitToReduceDamage(FAO, ENA -(IQX -ISX))
			else
				call SetUnitToReduceDamage(FAO, ENA)
			endif
		else
			call SetWidgetLife(FAO, GetWidgetLife(FAO)+ ENA)
		endif
	endif
endfunction
function EBA takes nothing returns nothing
	local real ZCE = .25
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if IsUnitType(GetEventDamageSource(), UNIT_TYPE_HERO)== false then
			call EAA(GetTriggerUnit(), GetEventDamage()-0.25)
		else
			call EAA(GetTriggerUnit(), GetEventDamage()-1)
		endif
	elseif GetTriggerEventId()== EVENT_UNIT_DEATH then
		call CleanCurrentTrigger(GetTriggeringTrigger())
	endif
endfunction
function ECA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit FAO =(LoadUnitHandle(HY, h, 19))
	local integer level =(LoadInteger(HY, h, 5))
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call SetUnitAnimation(FAO, "death")
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if IsUnitIdType(GetUnitTypeId(GetEventDamageSource()), UNIT_TYPE_HERO) then
			call SetUnitToReduceDamage(FAO, GetEventDamage()-1)
		else
			call SetUnitToReduceDamage(FAO, GetEventDamage()-0.25)
		endif
	endif
	set t = null
	set FAO = null
	return false
endfunction
function W8V takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(WJE,'A09D')
	local real x = CoordinateX50(GetSpellTargetX())
	local real y = CoordinateY50(GetSpellTargetY())
	local unit FAO
	local integer id = 0
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	if level == 1 then
		set id ='o00M'
	elseif level == 2 then
		set id ='o00L'
	elseif level == 3 then
		set id ='o00O'
	else
		set id ='o00N'
	endif
	set FAO = CreateUnit(GetTriggerPlayer(), id, x, y, 0)
	call TriggerRegisterDeathEvent(t, FAO)
	call TriggerRegisterUnitEvent(t, FAO, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function ECA))
	call SaveUnitHandle(HY, h, 19,(FAO))
	call SaveInteger(HY, h, 5, level)
	call SetUnitAbilityLevel(FAO,'A08T', level)
	call SetUnitAbilityLevel(FAO,'A0CF', level)
	call IssueImmediateOrderById(FAO,$D0220)
	call UnitApplyTimedLife(FAO,'BTLF', 30)
	set WJE = null
	set FAO = null
	set t = null
endfunction
function EDA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	local real level = LoadInteger(HY, h, 0)
	local boolean isScepterUpgrade = LoadBoolean(HY, h, 0)
	local real EFA = 0
	local real targetsMana = 0
	if GetUnitAbilityLevel(u,'Bdcl')== 0 or(GetTriggerEventId()== EVENT_UNIT_SPELL_ENDCAST and(GetSpellAbilityId()=='A0CC' or GetSpellAbilityId()=='A02Z')) then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if isScepterUpgrade then
			set EFA = 30 +$F* level
		else
			set EFA = 20 +$A* level
		endif
		if(GetWidgetLife(u)+ EFA >= GetUnitState(u, UNIT_STATE_MAX_LIFE)) then
			call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ EFA)
		endif
	endif
	set u = null
	set WLE = null
	set t = null
endfunction
function D9E takes nothing returns nothing
	local unit u
	local unit WLE
	local trigger t
	local integer h
	local boolean isScepterUpgrade
	if IsUnitType(GetSpellTargetUnit(), UNIT_TYPE_HERO) then
		set isScepterUpgrade = GetSpellAbilityId()=='A02Z'
		set t = CreateTrigger()
		set h = GetHandleId(t)
		set WLE = GetSpellTargetUnit()
		set u = GetTriggerUnit()
		call TriggerRegisterTimerEvent(t, .25, true)
		call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_ENDCAST)
		call SaveInteger(HY, h, 0, GetUnitAbilityLevel(u, GetSpellAbilityId()))
		call SaveBoolean(HY, h, 0, isScepterUpgrade)
		call SaveUnitHandle(HY, h, 0, u)
		call SaveUnitHandle(HY, h, 1, WLE)
		call TriggerAddCondition(t, Condition(function EDA))
	endif
	set t = null
	set WLE = null
	set u = null
endfunction
function EGA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WLE =(LoadUnitHandle(HY, h, 17))
	call SetUnitVertexColor(WLE, 255, 255, 255, 255)
	call DestroyEffect((LoadEffectHandle(HY, h, 32)))
	//call UnitRemoveAbility(WLE,'A30D')
	call UnitRemoveAbility(WLE,'A30E')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WLE = null
	return false
endfunction
function EHA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetUnitAbilityLevel(u,'B01N')== 0 or UnitIsDead(u) then
		call ReduceUnitMagicResistance(u, LoadReal(HY, h, 0))
		call UnitRemoveAbility(u, LoadInteger(HY, h, 1))
		call UnitRemoveAbility(u,'B0HM')
		call UnitRemoveAbility(u,'B38G')
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	endif
	set u = null
	set t = null
endfunction
function EJA takes unit WJE, unit WLE, integer level returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local integer QMX
	local real data
	if IsPlayerAlly(GetOwningPlayer(WJE), GetOwningPlayer(WLE)) then
		call UnitAddPermanentAbility(WLE,'A44I')
		set QMX ='A44I'
		set data = - 0.25
	else
		call AddAbilityToTimed(WLE,'A3C0'-1 + level, 1, 3.5,'B38G')
		set QMX ='A3C0'-1 + level
		set data = - 0.5
	endif
	call AddUnitMagicResistance(WLE, data)
	call SaveReal(HY, h, 0, data)
	call TimerStart(t, .1, true, function EHA)
	call SaveUnitHandle(HY, h, 0, WLE)
	call SaveInteger(HY, h, 1, QMX)
	set t = null
endfunction
function SpellEffect__Decrepify takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local unit W_V = CreateUnit(GetOwningPlayer(WJE),'e00E', GetUnitX(WLE), GetUnitY(WLE), 0)
	local integer level = GetUnitAbilityLevel(WJE,'A2TD')
	local trigger t
	local integer h
	call UnitAddAbility(W_V,'A0CE')
	call SetUnitAbilityLevel(W_V,'A0CE', level)
	call IssueTargetOrderById(W_V,$D0206, WLE)
	if GetUnitTypeId(WLE)=='n0FJ' or GetUnitTypeId(WLE)=='n0FI' or GetUnitTypeId(WLE)=='n0F6' or GetUnitTypeId(WLE)=='n0FH' then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 1.5 + .5 * level, false)
		call TriggerRegisterDeathEvent(t, WLE)
		call TriggerAddCondition(t, Condition(function EGA))
		call SaveUnitHandle(HY, h, 17,(WLE))
		call SetUnitVertexColor(WLE, 50, 255, 50, 150)
		call SaveEffectHandle(HY, h, 32,(AddSpecialEffect("Abilities\\Spells\\Undead\\Cripple\\CrippleTarget.mdl", GetUnitX(WLE), GetUnitY(WLE))))
		set t = null
	else
		call EJA(WJE, WLE, level)
	endif
	set WJE = null
	set WLE = null
	set W_V = null
endfunction
function LOE takes nothing returns nothing
	local unit u = GetSpellTargetUnit()
	if not((IsUnitType(u, UNIT_TYPE_STRUCTURE)== false and not IsMagicImmuneUnit(u)) or GetUnitTypeId(u)=='n0FJ' or GetUnitTypeId(u)=='n0FI' or GetUnitTypeId(u)=='n0F6' or GetUnitTypeId(u)=='n0FH') then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "非法目标")
	endif
	set u = null
endfunction
function EKA takes unit WUE, unit targetUnit returns nothing
	local real ELA = 20 + 40 * MFV
	local real H0X = 70 + 30 * MFV
	local real F0X = ELA +(H0X -ELA)* MHV / 700
	call UnitDamageTargetEx(WUE, targetUnit, 1, F0X)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\ChimaeraLightningMissile\\ChimaeraLightningMissile.mdl", targetUnit, "chest"))
endfunction
function EMA takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local group CNO = MDV
	local unit WUE = MGV
	if IsUnitInGroup(targetUnit, CNO)== false then
		call GroupAddUnit(CNO, targetUnit)
		call EKA(WUE, targetUnit)
	endif
	set targetUnit = null
	set CNO = null
	set WUE = null
endfunction
function EPA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit dummyUnit = LoadUnitHandle(HY, h, 19)
	local group CNO = LoadGroupHandle(HY, h,$85)
	local effect fx
	local integer EVX = GetTriggerEvalCount(t)
	local real x
	local real x0 = GetUnitX(WUE)
	local real y
	local real y0 = GetUnitY(WUE)
	local integer i
	local integer d
	local group g = LoginGroup(381)
	call SetUnitX(dummyUnit, GetUnitX(WUE))
	call SetUnitY(dummyUnit, GetUnitY(WUE))
	set MDV = CNO
	set MGV = WUE
	set MFV = LoadInteger(HY, h, 0)
	if EVX > 20 then
		set d = 21 * 36 +(20 -EVX)* 36
		set MHV = d
		set i = 0
		loop
		exitwhen i > 36
			set x = x0 + d * Cos(360 * i / 36 * bj_DEGTORAD)
			set y = y0 + d * Sin(360 * i / 36 * bj_DEGTORAD)
			set U2 = WUE
			call GroupEnumUnitsInRange(g, x, y, 100, Condition(function DUX))
			call ForGroup(g, function EMA)
			set i = i + 1
		endloop
	else
		set d = EVX * 36
		set MHV = d
		set i = 0
		loop
		exitwhen i > 36
			set x = x0 + d * Cos(360 * i / 36 * bj_DEGTORAD)
			set y = y0 + d * Sin(360 * i / 36 * bj_DEGTORAD)
			set U2 = WUE
			call GroupEnumUnitsInRange(g, x, y, 100, Condition(function DUX))
			call ForGroup(g, function EMA)
			set i = i + 1
		endloop
	endif
	call LogoutGroup(g)
	if EVX == 40 then
		call KillUnit(dummyUnit)
		call LogoutGroup(CNO)
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif EVX == 20 then
		call GroupClear(CNO)
		set fx = null
	endif
	set t = null
	set dummyUnit = null
	set CNO = null
	set WUE = null
	set g = null
	return false
endfunction
function ABE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local real x = GetUnitX(triggerUnit)
	local real y = GetUnitY(triggerUnit)
	local unit dummyUnit
	local integer i = 0
	local integer XMR = 36
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	if GetUnitTypeId(triggerUnit)=='e00E'then
		set triggerUnit = Player__Hero[GetPlayerId(GetOwningPlayer(triggerUnit))]
	endif
	set dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'h092', x, y, 0)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("effects\\Lightning_Ball_Tail_FX.mdx", triggerUnit, "origin"))
	call SaveGroupHandle(HY, h,$85, LoginGroup(382))
	call SaveUnitHandle(HY, h, 2, triggerUnit)
	call SaveUnitHandle(HY, h, 19, dummyUnit)
	call TriggerRegisterTimerEvent(t, .06, true)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(triggerUnit, GetSpellAbilityId()))
	call TriggerAddCondition(t, Condition(function EPA))
	set t = null
	set dummyUnit = null
	set triggerUnit = null
endfunction
function EQA takes integer ESA returns boolean
	return ESA !='A09V' and ESA !='A026' and ESA !='A0LZ' and ESA !='A0OI' and ESA !='A0DY' and ESA !='A1WB' and ESA !='AHfa'
endfunction
function ETA takes unit EUA, unit WUE, unit targetUnit, integer level returns nothing
	local unit dummyUnit = CreateUnit(GetOwningPlayer(EUA),'e00E', GetUnitX(WUE), GetUnitY(WUE), 0)
	call UnitAddPermanentAbility(dummyUnit,'A1AK')
	call SetUnitAbilityLevel(dummyUnit,'A1AK', level)
	call IssueTargetOrderById(dummyUnit,$D0097, targetUnit)
	call UnitAddPermanentAbility(dummyUnit,'A18D')
	call SetUnitAbilityLevel(dummyUnit,'A18D', level)
	call IssueTargetOrderById(dummyUnit, 852111, targetUnit)
	set dummyUnit = null
endfunction
function EWA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local integer level
	if GetSpellTargetUnit()== WUE and GetUnitAbilityLevel(WUE,'A36D')== 0 and EQA(GetSpellAbilityId()) and IsUnitAlly(GetTriggerUnit(), GetOwningPlayer(WUE))== false and IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) then
		set level = GetUnitAbilityLevel(WUE,'P283')
		call ETA(WUE, WUE, GetTriggerUnit(), level)
	endif
	set t = null
	set WUE = null
	return false
endfunction
function MWE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function EWA))
	call SaveUnitHandle(HY, h, 2,(WUE))
	set WUE = null
	set t = null
endfunction
function EYA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer i = LoadInteger(P, WFV, 1)
	call LodSystem_AddUnitExtraState(LoadUnitHandle(P, WFV, 1), i, STATE_SYSTEM_DAMAGE)
	call LodSystem_ReduceUnitExtraState(LoadUnitHandle(P, WFV, 0), i, STATE_SYSTEM_DAMAGE)
	call DestroyTimerAndFlushHT_P(t)
	set t = null
endfunction
function EZA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(P, WFV, 0)+ 1
	local integer O3O = LoadInteger(P, WFV, 1)
	local unit u1 = LoadUnitHandle(P, WFV, 0)
	local unit u2 = LoadUnitHandle(P, WFV, 1)
	local unit W_V = LoadUnitHandle(P, WFV, 33)
	local real x2 = GetWidgetX(u2)
	local real y2 = GetWidgetY(u2)
	local real x1 = GetWidgetX(u1)
	local real y1 = GetWidgetY(u1)
	if UYX == 320 or UnitIsDead(u1) or UnitIsDead(u2) or(x1 -x2)*(x1 -x2)+(y1 -y2)*(y1 -y2)>$77A10 then
		call DestroyLightning(LoadLightningHandle(P, WFV, 2))
		call WJV(u1,'C023','D023', 18)
		call WJV(u2,'C024','D024', 18)
		call TimerStart(t, 18, false, function EYA)
		call RemoveUnit(W_V)
		set u2 = null
		set u1 = null
		set t = null
		set W_V = null
		return
	endif
	call SaveInteger(P, WFV, 0, UYX)
	call MoveLightning(LoadLightningHandle(P, WFV, 2), false, x1, y1, x2, y2)
	call SetUnitPosition(W_V, GetUnitX(u2), GetUnitY(u2))
	set UYX = R2I(LoadInteger(P, WFV, 2)* UYX * 1. / 40.)
	if LoadInteger(P, WFV, 1)<= UYX then
		call LodSystem_ReduceUnitExtraState(u2, UYX -LoadInteger(P, WFV, 1), STATE_SYSTEM_DAMAGE)
		call LodSystem_AddUnitExtraState(u1, UYX -LoadInteger(P, WFV, 1), STATE_SYSTEM_DAMAGE)
		call SaveInteger(P, WFV, 1, UYX)
	endif
	set W_V = null
	set u2 = null
	set u1 = null
	set t = null
endfunction
function YFV takes nothing returns nothing
	local lightning l = null
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local unit d = GetSpellTargetUnit()
	local integer WFV = GetHandleId(t)
	local integer i = GetUnitAbilityLevel(u,'A1DP')
	local unit W_V
	if GetUnitTypeId(u)=='e00E'then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
	set W_V = CreateUnit(GetOwningPlayer(u),'h088', GetUnitX(d), GetUnitY(d), 0)
	set l = AddLightning("CLSB", true, GetWidgetX(u), GetWidgetY(u), GetWidgetX(d), GetWidgetY(d))
	set i = 7 * i
	call SetLightningColor(l, .3, .5, 1, 1)
	call SaveUnitHandle(P, WFV, 0, u)
	call SaveUnitHandle(P, WFV, 1, d)
	call SaveUnitHandle(P, WFV, 33, W_V)
	call SaveLightningHandle(P, WFV, 2, l)
	call SaveInteger(P, WFV, 0, 0)
	call SaveInteger(P, WFV, 2, i)
	call TimerStart(t, .025, true, function EZA)
	set d = null
	set u = null
	set l = null
	set t = null
	set W_V = null
endfunction
function E_A takes integer h returns nothing
	local integer i = 1
	local integer D_R = LoadInteger(HY, h,$88)
	local unit targetUnit
	if D_R == 0 then
		return
	endif
	loop
	exitwhen i > D_R
		set targetUnit = LoadUnitHandle(HY, h,$898+ i)
		call UnitRemoveAbility(targetUnit, O4[0])
		call UnitRemoveAbility(targetUnit, O4[1])
		call UnitRemoveAbility(targetUnit, O4[2])
		call UnitRemoveAbility(targetUnit, O4[3])
		call UnitRemoveAbility(targetUnit, O4[4])
		call UnitRemoveAbility(targetUnit, O4[5])
		set i = i + 1
	endloop
	set targetUnit = null
endfunction
function E0A takes unit targetUnit, integer h returns nothing
	local integer D_R = LoadInteger(HY, h,$88)
	set D_R = D_R + 1
	call SaveInteger(HY, h,$88, D_R)
	call SaveUnitHandle(HY, h,$898+ D_R, targetUnit)
endfunction
function E1A takes unit u returns integer
	return GetUnitAbilityLevel(u, O4[0])* 1 + GetUnitAbilityLevel(u, O4[1])* 2 + GetUnitAbilityLevel(u, O4[2])* 4 + GetUnitAbilityLevel(u, O4[3])* 8 + GetUnitAbilityLevel(u, O4[4])* 16
endfunction
function E2A takes unit u, integer d returns nothing
	local integer array b
	local integer a = d
	local integer c = 1
	local integer i = 0
	local integer H0X
	if d < 1 then
		call UnitRemoveAbility(u, O4[0])
		call UnitRemoveAbility(u, O4[1])
		call UnitRemoveAbility(u, O4[2])
		call UnitRemoveAbility(u, O4[3])
		call UnitRemoveAbility(u, O4[4])
		call UnitRemoveAbility(u, O4[5])
		return
	endif
	loop
	exitwhen c == 0
		set c = a / 2
		set b[i]= a -c * 2
		set a = c
		set i = i + 1
	endloop
	set H0X = i
	set i = 0
	loop
	exitwhen i > H0X
		if b[i]== 1 then
			call UnitAddPermanentAbility(u, O4[i])
		else
			call UnitRemoveAbility(u, O4[i])
		endif
		set i = i + 1
	endloop
endfunction
function E3A takes unit u, integer d returns nothing
	if IsUnitType(u, UNIT_TYPE_STRUCTURE)== false then
		call E2A(u, d + E1A(u))
		call E0A(u, MLV)
	endif
endfunction
function E4A takes unit WUE, unit dummyUnit, unit targetUnit, integer level returns nothing
	call IssueTargetOrderById(dummyUnit,$D0097, targetUnit)
	call IOX(I_X(WUE), targetUnit, 2,(50 + 25 * level)/ 2, .3)
	call E3A(targetUnit, 1)
endfunction
function E5A takes nothing returns boolean
	if(UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit()))) and GetUnitTypeId(GetFilterUnit())!='n00L' then
		if GetWidgetLife(GetFilterUnit())< MKV then
			set MKV = GetWidgetLife(GetFilterUnit())
			set MJV = GetFilterUnit()
		endif
	endif
	return false
endfunction
function E6A takes nothing returns boolean
	if(UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and UnitIsDead(GetFilterUnit())== false)) and GetUnitTypeId(GetFilterUnit())!='emow' and GetUnitTypeId(GetFilterUnit())!='uzig' and GetUnitTypeId(GetFilterUnit())!='n00L' then
		if GetWidgetLife(GetFilterUnit())< MKV then
			set MKV = GetWidgetLife(GetFilterUnit())
			set MJV = GetFilterUnit()
		endif
	endif
	return false
endfunction
function E7A takes unit WUE, unit dummyUnit, integer level returns nothing
	local group g = LoginGroup(383)
	set MJV = null
	set MKV =$F423F
	set U2 = WUE
	if GetUnitAbilityLevel(WUE,'A1UV')> 0 then
		call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 525, Condition(function E6A))
	else
		call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 525, Condition(function E5A))
	endif
	call LogoutGroup(g)
	if MJV != null then
		call E4A(WUE, dummyUnit, MJV, level)
	endif
	set g = null
endfunction
function E8A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local integer level =(LoadInteger(HY, h, 5))
	local integer EVX = GetTriggerEvalCount(t)
	local integer interval
	local real S7V
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call E_A(h)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if GetTriggerUnit()== WUE then
			call KillUnit(dummyUnit)
		endif
	else
		if GetUnitAbilityLevel(WUE,'A1UV')> 0 then
			if level == 1 then
				set S7V = .6
			elseif level == 2 then
				set S7V = .5
			else
				set S7V = .4
			endif
		else
			if level == 1 then
				set S7V = .7
			elseif level == 2 then
				set S7V = .6
			else
				set S7V = .5
			endif
		endif
		set S7V = S7V / .05
		if ModuloInteger(EVX, R2I(S7V))== 0 or EVX == 1 then
			set MLV = h
			call E7A(WUE, dummyUnit, level)
		endif
		call SetUnitX(dummyUnit, GetUnitX(WUE))
		call SetUnitY(dummyUnit, GetUnitY(WUE))
	endif
	set t = null
	set WUE = null
	set dummyUnit = null
	return false
endfunction
function AME takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(WUE,'A1AO')+ GetUnitAbilityLevel(WUE,'A1UV')
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'h081', GetUnitX(WUE), GetUnitY(WUE), 0)
	if GetUnitTypeId(WUE)=='e00E' then
		set WUE = Player__Hero[GetPlayerId(GetOwningPlayer(WUE))]
	endif
	call UnitApplyTimedLife(dummyUnit,'BTLF', 30)
	call SetUnitAbilityLevel(dummyUnit,'A1DJ', level)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerRegisterDeathEvent(t, dummyUnit)
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function E8A))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveInteger(HY, h, 5,(level))
	set WUE = null
	set dummyUnit = null
	set t = null
endfunction
function PHX takes nothing returns nothing
	set O4[0]='A1DK'
	set O4[1]='A1DL'
	set O4[2]='A1DN'
	set O4[3]='A1DM'
	set O4[4]='A1DO'
endfunction
function E9A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit whichUnit =(LoadUnitHandle(HY, h, 14))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	call DzSetUnitPosition(whichUnit, CoordinateX50(x), CoordinateY50(y))
	call SetUnitAnimation(whichUnit, "morph ALTERNATE")
	call QueueUnitAnimation( whichUnit, "stand" )

	call YDWEUnitRemoveStun( whichUnit )

	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set whichUnit = null
	return false
endfunction



function APE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer lv = GetUnitAbilityLevel(u,'A06O')+ GetUnitAbilityLevel(u,'A3NX')
	local real a
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local real tx
	local real ty
	local integer h
	local unit target = GetSpellTargetUnit()
	if target != null then
		set tx = GetUnitX(target)
		set ty = GetUnitY(target)
	else
		set tx = GetSpellTargetX()
		set ty = GetSpellTargetY()
	endif
	set a = AngleBetweenXY(x, y, tx, ty)
	set h = CreateTimerEventTrigger( GetDistanceBetween(x, y, tx, ty)/ 2000, false, function E9A )
	call EXUnitAddStunWait0s( u )
	call SaveUnitHandle(HY, h, 14,(u))
	call SaveReal(HY, h, 6,((tx)* 1.))
	call SaveReal(HY, h, 7,((ty)* 1.))

	if GetDistanceBetween(x, y, tx, ty)< 150 then
		set tx = x + 150 * Cos(a * bj_DEGTORAD)
		set ty = y + 150 * Sin(a * bj_DEGTORAD)
	endif
	if target != null and not UnitHasSpellShield(target) then
		set target = null
	endif
	call UnitSpellEffectImpale(u, target, 40 + 60 * lv, 1.65, .52, x, y, tx, ty, 175, null, true, 1600)
	set u = null
	set target = null
endfunction
function XXA takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetEnumUnit()),'e00E', GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()), 0)
	call UnitAddAbility(d,'A33J')
	call IssueTargetOrderById(d, 852095, GetEnumUnit())
	set d = null
	call UnitDamageTargetEx(MPV, GetEnumUnit(), 1, 130)
	call IssueTargetOrderById(MQV, 852075, GetEnumUnit())
endfunction
function XOA takes unit WUE, real x, real y, integer level, integer XRA returns nothing
	local group g = LoginGroup(384)
	local real r
	local string fx
	if XRA == 8 then
		set r = 675
	elseif XRA == 9 then
		set r = 700
	elseif XRA ==$A then
		set r = 725
	else
		set r =$FA+ 50 * XRA
	endif
	if XRA < 4 then
		set fx = "war3mapImported\\EpiPulse_1_4.mdx"
	elseif XRA < 8 then
		set fx = "war3mapImported\\EpiPulse_5_8.mdx"
	else
		set fx = "war3mapImported\\EpiPulse_9_12.mdx"
	endif
	call DestroyEffect(AddSpecialEffect(fx, x, y))
	set U2 = WUE
	set MPV = WUE
	set MQV = MMV[GetPlayerId(GetOwningPlayer(WUE))]
	call GroupEnumUnitsInRange(g, x, y, r, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	call ForGroup(g, function XXA)
	call LogoutGroup(g)
	call BNX(.03, false, x, y, 150 + 100 * XRA, 150 + 100 * XRA, 72, .03, 512)
	set g = null
endfunction
function XIA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local player p = LoadPlayerHandle(HY, h, 54)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local real GXR = LoadReal(HY, h, 23)
	local real GOR = LoadReal(HY, h, 24)
	local boolean isScepterUpgrade = LoadBoolean(HY, h, 15)
	local integer level = LoadInteger(HY, h, 5)
	local integer WWR = LoadInteger(HY, h, 25)
	local integer XAA = 4 + level * 2
	local real x = GXR
	local real y = GOR
	if isScepterUpgrade then
		set XAA = XAA + 2
	endif
	if WWR > XAA then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if triggerUnit != null and UnitAlive(triggerUnit) then
			set x = GetUnitX(triggerUnit)
			set y = GetUnitY(triggerUnit)
		endif
		call XOA(triggerUnit, x, y, level, WWR)
		call SaveInteger(HY, h, 25, WWR + 1)
		call SaveReal(HY, h, 23, x * 1.)
		call SaveReal(HY, h, 24, y * 1.)
	endif
	set t = null
	set p = null
	set triggerUnit = null
	return false
endfunction
function XNA takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local player p = GetOwningPlayer(triggerUnit)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(triggerUnit,'A06R')
	local boolean isScepterUpgrade = false
	if level == 0 then
		set isScepterUpgrade = true
		set level = GetUnitAbilityLevel(triggerUnit,'A1B4')
	endif
	if GetUnitAbilityLevel(triggerUnit,'Aloc') > 0 then
		set triggerUnit = Player__Hero[GetPlayerId(GetOwningPlayer(triggerUnit))]
	endif
	if IsSentinelsPlayer(p) then
		set MMV[GetPlayerId(p)]= CreateUnit(Scourges[0],'e00E', GetUnitX(triggerUnit), GetUnitY(triggerUnit), 0)
	else
		set MMV[GetPlayerId(p)]= CreateUnit(Sentinels[0],'e00E', GetUnitX(triggerUnit), GetUnitY(triggerUnit), 0)
	endif
	call UnitAddPermanentAbility(MMV[GetPlayerId(p)],'A17B')
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	call SavePlayerHandle(HY, h, 54, GetOwningPlayer(triggerUnit))
	call SaveReal(HY, h, 23, GetUnitX(triggerUnit))
	call SaveReal(HY, h, 24, GetUnitY(triggerUnit))
	call SaveInteger(HY, h, 5, level)
	call SaveInteger(HY, h, 25, 2)
	call SaveBoolean(HY, h, 15,(isScepterUpgrade))
	call TriggerRegisterTimerEvent(t, .35, true)
	call TriggerAddCondition(t, Condition(function XIA))
	call XOA(triggerUnit, GetUnitX(triggerUnit), GetUnitY(triggerUnit), level, 1)
	set triggerUnit = null
	set p = null
	set t = null
endfunction
function XBA takes nothing returns boolean
	if GetSpellAbilityId()=='A06R' or GetSpellAbilityId()=='A1B4' then
		call XNA()
	endif
	return false
endfunction
function M8X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_FINISH)
	call TriggerAddCondition(t, Condition(function XBA))
	call AddAbilityIDToPreloadQueue('A17B')
	set t = null
endfunction
function XCA takes nothing returns boolean
	if(IsMagicImmuneUnit(GetFilterUnit())== false and IsUnitEnemy(GA, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())))!= null then
		call UnitDamageTargetEx(GA, GetFilterUnit(), 1, HA)
		call AddAbilityToTimed(GetFilterUnit(),'A38I', 1, 3,'B38I')
	endif
	return false
endfunction
function XDA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	call DestroyEffect(LoadEffectHandle(HY, GetHandleId(t), 0))
	call DestroyTimerAndFlushHT_HY(t)
	set t = null
endfunction
function XFA takes unit SZX returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, 1, false, function XDA)
	call SaveEffectHandle(HY, GetHandleId(t), 0, AddSpecialEffectTarget("Abilities\\Spells\\Undead\\PlagueCloud\\PlagueCloudCaster.mdl", SZX, "chest"))
	set t = null
endfunction
function XGA takes unit sk, unit SZX, integer level, boolean XHA returns nothing
	local group g = LoginGroup(385)
	local real ZCE = 50 + 40 * level
	if level == 4 then
		set ZCE =$DC
	endif
	if XHA then
		set ZCE = ZCE / 2
	endif
	set GA = sk
	set HA = ZCE
	call XFA(SZX)
	call GroupEnumUnitsInRange(g, GetUnitX(SZX), GetUnitY(SZX), 425, Condition(function XCA))
	call LogoutGroup(g)
	set g = null
endfunction
function XJA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit SZX = LoadUnitHandle(HY, h, 1)
	local unit sk = LoadUnitHandle(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call XGA(sk, SZX, level, false)
		call DestroyEffect(LoadEffectHandle(HY, h, 10))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call RemoveSavedHandle(HY, GetHandleId(SZX),'CFNL')
		call RemoveSavedBoolean(HY, GetHandleId(SZX),'CFNL')
	elseif GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		if GetGameTime()> LoadReal(HY, h, 0) then
			call XGA(sk, SZX, level, true)
			call UnitRemoveAbility(SZX,'A348')
			call UnitRemoveAbility(SZX,'B03F')
			call DestroyEffect(LoadEffectHandle(HY, h, 10))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call RemoveSavedHandle(HY, GetHandleId(SZX),'CFNL')
			call RemoveSavedBoolean(HY, GetHandleId(SZX),'CFNL')
		endif
	else
		call XGA(sk, SZX, level, true)
	endif
	set t = null
	set sk = null
	set SZX = null
endfunction
function CausticFinaleActions takes unit sk, unit WLE returns nothing
	local trigger t
	local integer h
	local integer ht = GetHandleId(WLE)
	if LoadBoolean(HY, ht,'CFNL')== false then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterDeathEvent(t, WLE)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function XJA))
		call SaveBoolean(HY, ht,'CFNL', true)
		call SaveTriggerHandle(HY, ht,'CFNL', t)
		call SaveUnitHandle(HY, h, 1, WLE)
		call SaveEffectHandle(HY, h, 10, AddSpecialEffectTarget("Abilities\\Spells\\Other\\AcidBomb\\BottleImpact.mdl", WLE, "chest"))
		call UnitAddPermanentAbility(WLE,'A348')
		call SaveBoolean(HY, h, 0, IsUnitType(sk, UNIT_TYPE_MELEE_ATTACKER))
	else
		set t = LoadTriggerHandle(HY, ht,'CFNL')
		set h = GetHandleId(t)
	endif
	call SaveReal(HY, h, 0, GetGameTime()+ 8)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(sk,'A0FA'))
	call SaveUnitHandle(HY, h, 0, sk)
	if(LoadBoolean(HY, h, 0) and LoadInteger(HY, h, 1)== 2) or LoadInteger(HY, h, 1)== 4 then
		call SaveInteger(HY, h, 1, 0)
		call TriggerEvaluate(t)
	else
		call SaveInteger(HY, h, 1, LoadInteger(HY, h, 1)+ 1)
	endif
	set t = null
endfunction
function XLA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	if((LoadInteger(HY,(GetHandleId((triggerUnit))),(4299)))== 1)== false then
		call UnitRemoveAbility(triggerUnit,'B04R')
	endif
	call RemoveUnit((LoadUnitHandle(HY, h, 379)))
	call RemoveUnit((LoadUnitHandle(HY, h, 380)))
	call RemoveUnit((LoadUnitHandle(HY, h, 381)))
	call RemoveUnit((LoadUnitHandle(HY, h, 382)))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set triggerUnit = null
	return false
endfunction
function XMA takes unit triggerUnit, integer level, unit XPA, unit XQA, unit XSA, unit XTA returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real N5O = 1.5
	call SaveInteger(HY,(GetHandleId((triggerUnit))),(4299), 2)
	call TriggerRegisterTimerEvent(t, N5O, false)
	call TriggerAddCondition(t, Condition(function XLA))
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call SaveUnitHandle(HY, h, 379,(XPA))
	call SaveUnitHandle(HY, h, 380,(XQA))
	call SaveUnitHandle(HY, h, 381,(XSA))
	call SaveUnitHandle(HY, h, 382,(XTA))
	set t = null
endfunction
function XUA takes nothing returns boolean
	if(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit())) then
		call UnitDamageTargetEx(U2, GetFilterUnit(), 1, S2)
	endif
	return false
endfunction
function XWA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local unit XPA =(LoadUnitHandle(HY, h, 379))
	local unit XQA =(LoadUnitHandle(HY, h, 380))
	local unit XSA =(LoadUnitHandle(HY, h, 381))
	local unit XTA =(LoadUnitHandle(HY, h, 382))
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0H0')
	local integer EVX = GetTriggerEvalCount(t)
	local group g
	local integer XYA = 550
	if GetTriggerEventId()== EVENT_UNIT_SPELL_ENDCAST or EVX > level * 40 then
		call XMA(triggerUnit, level, XPA, XQA, XSA, XTA)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set g = LoginGroup(386)
		set U2 = triggerUnit
		set S2 = level * 25 / 2
		call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), XYA, Condition(function XUA))
		call LogoutGroup(g)
	endif
	set t = null
	set triggerUnit = null
	set XPA = null
	set XQA = null
	set XSA = null
	set XTA = null
	set g = null
	return false
endfunction
function AQE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit XPA = CreateUnit(GetOwningPlayer(triggerUnit),'e00Q', GetUnitX(triggerUnit)+$96, GetUnitY(triggerUnit)+$96, 0)
	local unit XQA = CreateUnit(GetOwningPlayer(triggerUnit),'e00Q', GetUnitX(triggerUnit)+$96, GetUnitY(triggerUnit)-$96, 0)
	local unit XSA = CreateUnit(GetOwningPlayer(triggerUnit),'e00Q', GetUnitX(triggerUnit)-$96, GetUnitY(triggerUnit)+$96, 0)
	local unit XTA = CreateUnit(GetOwningPlayer(triggerUnit),'e00Q', GetUnitX(triggerUnit)-$96, GetUnitY(triggerUnit)-$96, 0)
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0H0')
	local unit dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'e00E', GetUnitX(triggerUnit), GetUnitY(triggerUnit), 0)
	call UnitAddAbility(XPA,'A45U')
	call UnitAddAbility(XPA,'A45V')
	call UnitAddAbility(XQA,'A45U')
	call UnitAddAbility(XQA,'A45V')
	call UnitAddAbility(XSA,'A45U')
	call UnitAddAbility(XSA,'A45V')
	call UnitAddAbility(XTA,'A45U')
	call UnitAddAbility(XTA,'A45V')
	call SaveInteger(HY, GetHandleId(triggerUnit), 4299, 1)
	call UnitAddPermanentAbility(dummyUnit,'A0HO')
	call SetUnitAbilityLevel(dummyUnit,'A0HO', level)
	call IssueTargetOrderById(dummyUnit,$D0065, triggerUnit)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function XWA))
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call SaveUnitHandle(HY, h, 379,(XPA))
	call SaveUnitHandle(HY, h, 380,(XQA))
	call SaveUnitHandle(HY, h, 381,(XSA))
	call SaveUnitHandle(HY, h, 382,(XTA))
	call SetUnitTimeScale(XPA, 0)
	call SetUnitTimeScale(XQA, 0)
	call SetUnitTimeScale(XSA, 0)
	call SetUnitTimeScale(XTA, 0)
	set t = null
	set triggerUnit = null
	set dummyUnit = null
	set XPA = null
	set XQA = null
	set XSA = null
	set XTA = null
endfunction
function ATE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local real x = GetUnitX(WUE)
	local real y = GetUnitY(WUE)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', x, y, 0)
	local group g = LoginGroup(387)
	local integer level = GetUnitAbilityLevel(WUE, GetSpellAbilityId())
	local unit u
	call UnitAddPermanentAbility(dummyUnit,'A0M9')
	call SetUnitAbilityLevel(dummyUnit,'A0M9', level)
	call IssueImmediateOrderById(dummyUnit,$D0080)
	set U2 = WUE
	call GroupEnumUnitsInRange(g, x, y, 350 + 25, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call UnitDamageTargetEx(dummyUnit, u, 2, 50 * level)
		call CommonUnitAddStun(u, .5 + level * 1. * .5, false)
		call GroupRemoveUnit(g, u)
	endloop
	call LogoutGroup(g)
	set WUE = null
	set dummyUnit = null
	set g = null
endfunction

function XZA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer hu = GetHandleId(u)
	local real X_A = LoadReal(HY, h, 0)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or(GetUnitAbilityLevel(u,'B013')== 0 and GetTriggerEvalCount(t)> 2) or GetGameTime()>= X_A then
		call RemoveSavedHandle(HY, hu,'A05C')
		//call UnitRemoveAbility(u,'B3JQ')
		call SetUnitPhaseMove( u, false )
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	else
		//if GetUnitAbilityLevel(u,'B3JQ')==0 and GetUnitAbilityLevel(u,'B07T')==0 and GetUnitAbilityLevel(u,'B39C')==0 then
		//		call UZV(u,'I0T9')
		//	endif
	endif
	set t = null
	set u = null
endfunction
function ASE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local trigger t
	local integer h
	local integer hu = GetHandleId(u)
	if HaveSavedHandle(HY, hu,'A05C') then
		set t = LoadTriggerHandle(HY, hu,'A05C')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		//call UnitRemoveAbility(u,'B3JQ')
		call SetUnitPhaseMove( u, true )
		//if not IsUnitType(u, UNIT_TYPE_FLYING) then
		//	call EXSetUnitMoveType(u, MOVE_TYPE_FOOT )
	//		call EXSetUnitCollisionType(false, u, COLLISION_TYPE_UNIT)
	//	endif
		call TriggerRegisterTimerEvent(t, .02, true)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerAddCondition(t, Condition(function XZA))
		call SaveTriggerHandle(HY, hu,'A05C', t)
		//call UZV(u,'I0T9')
		call SaveUnitHandle(HY, h, 0, u)
	endif
	call SaveReal(HY, h, 0, GetGameTime()+ 12.)
	set u = null
	set t = null
endfunction
function X0A takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WLE = LoadUnitHandle(HY, h, 0)
	local real WIE = GetGameTime()
	local real WOV = LoadReal(P, GetHandleId(WLE),'A034')
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		call UnitRemoveAbility(WLE,'A310')
		call UnitRemoveAbility(WLE,'B30Z')
		call FlushChildHashtable(HY, h)
		call RemoveSavedHandle(P, GetHandleId(WLE),'A034')
		call CleanCurrentTrigger(t)
	else
		if WIE > WOV then
			call UnitRemoveAbility(WLE,'A310')
			call UnitRemoveAbility(WLE,'B30Z')
			call FlushChildHashtable(HY, h)
			call RemoveSavedHandle(P, GetHandleId(WLE),'A034')
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set WLE = null
endfunction
function Slardar_AmplifyDamage takes nothing returns nothing
	local trigger t = null
	local integer h
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local real WLV
	local integer level = GetUnitAbilityLevel(WJE, GetSpellAbilityId())
	if(UnitHasSpellShield(WLE)) then
		set WJE = null
		set WLE = null
		return
	endif
	if IsUnitType(WLE, UNIT_TYPE_HERO) or IsUnitIllusion(WLE) then
		set WLV = 30
	else
		set WLV = 120
	endif
	call SaveReal(P, GetHandleId(WLE),'A034', GetGameTime()+ WLV)
	call UnitAddPermanentAbility(WLE,'A310')
	call SetPlayerAbilityAvailable(GetOwningPlayer(WLE),'A310', false)
	call UnitMakeAbilityPermanent(WLE, true,'A30Y')
	call UnitMakeAbilityPermanent(WLE, true,'A30Z')
	call SetUnitAbilityLevel(WLE,'A30Y', level)
	call GHX(WLE, WJE,'A310')
	call GQX(WLE,'A310','B30Z')
	if LoadTriggerHandle(P, GetHandleId(WLE),'A304')== null then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerRegisterUnitEvent(t, WLE, EVENT_UNIT_DEATH)
		call TriggerAddCondition(t, Condition(function X0A))
		call SaveUnitHandle(HY, h, 0, WLE)
		call SaveTriggerHandle(P, GetHandleId(WLE),'A034', t)
		set t = null
	endif
	set WJE = null
	set WLE = null
endfunction
function X1A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h,$DD)
	local unit X2A = LoadUnitHandle(HY, h, 383)
	local unit dummyUnit
	local real N5O = LoadReal(HY, h, 57)
	local integer level = LoadInteger(HY, h, 0)
	local real X3A =(LoadReal(HY, h, 6))
	local real X4A =(LoadReal(HY, h, 7))
	local real NBX = GetUnitX(u)
	local real NCX = GetUnitY(u)
	if(NBX -X3A)*(NBX -X3A)+(NCX -X4A)*(NCX -X4A)> 900 then
		set dummyUnit = CreateUnit(GetOwningPlayer(X2A),('h002'), GetUnitX(u), GetUnitY(u), 0)
		call SetUnitAbilityLevel(dummyUnit,('A0I2'), level)
		call SetUnitAbilityLevel(dummyUnit,('A0HY'), level)
		call UnitApplyTimedLife(dummyUnit,'BTLF', 7)
		call SaveReal(HY, h, 6,((NBX)* 1.))
		call SaveReal(HY, h, 7,((NCX)* 1.))
	endif
	set N5O = N5O + .2
	call SaveReal(HY, h, 57,((N5O)* 1.))
	if N5O > 7 or GetWidgetLife(u)< 1 then
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
	endif
	set t = null
	set u = null
	set X2A = null
	set dummyUnit = null
endfunction
function X5A takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local sound X6A
	local timer t
	local integer h
	call UnitDamageTargetEx(GW, targetUnit, 1, JW)
	call GroupAddUnit(LW, targetUnit)
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		set X6A = CreateSound("Sounds\\Spectral Dagger.mp3", false, true, true, 10, 10, "DefaultEAXON")
		call SetSoundPosition(X6A, GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call SetSoundDistanceCutoff(X6A, 700)
		call StartSound(X6A)
		call KillSoundWhenDone(X6A)
		call SaveUnitHandle(HY, h,$DD,(targetUnit))
		call SaveUnitHandle(HY, h, 383,(GW))
		call SaveReal(HY, h, 6,((GetUnitX(targetUnit))* 1.))
		call SaveReal(HY, h, 7,((GetUnitY(targetUnit))* 1.))
		call SaveInteger(HY, h, 0, Q2)
		call TimerStart(t, .2, true, function X1A)
	endif
	set targetUnit = null
	set t = null
endfunction
function X7A takes nothing returns boolean
	return((IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GW)) and IsUnitInGroup(GetFilterUnit(), LW)== false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and GetWidgetLife(GetFilterUnit())> 1 and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false))
endfunction
function X8A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group gg = LoadGroupHandle(HY, h,$85)
	local group g = LoginGroup(388)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local unit NIX = LoadUnitHandle(HY, h, 45)
	local unit targetUnit = LoadUnitHandle(HY, h, 30)
	local real W_E = GetUnitX(targetUnit)
	local real W0E = GetUnitY(targetUnit)
	local real WYE = GetUnitX(NIX)
	local real WZE = GetUnitY(NIX)
	local real radian = Atan2(W0E -WZE, W_E -WYE)
	local real NBX = CoordinateX50(GetUnitX(NIX)+ 30 * Cos(radian))
	local real NCX = CoordinateY50(GetUnitY(NIX)+ 30 * Sin(radian))
	local unit dummyUnit
	local integer level = LoadInteger(HY, h, 0)
	if(LoadBoolean(HY, h, 384)) then
		call SaveBoolean(HY, h, 384, false)
		set dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'h002', WYE, WZE, 0)
		call SetUnitAbilityLevel(dummyUnit,'A0I2', level)
		call SetUnitAbilityLevel(dummyUnit,'A0HY', level)
		call UnitApplyTimedLife(dummyUnit,'BTLF', 12)
	else
		call SaveBoolean(HY, h, 384, true)
	endif
	call SetUnitX(NIX, NBX)
	call SetUnitY(NIX, NCX)
	call SetUnitFacing(NIX, radian * bj_RADTODEG)
	set LW = gg
	set GW = triggerUnit
	set JW = 50 * level
	set Q2 = level
	call GroupEnumUnitsInRange(g, NBX, NCX, 150, Condition(function X7A))
	call ForGroup(g, function X5A)
	call LogoutGroup(g)
	if(NBX -W_E)*(NBX -W_E)+(NCX -W0E)*(NCX -W0E)<$640 then
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call KillUnit(NIX)
		call LogoutGroup(gg)
	endif
	set gg = null
	set t = null
	set g = null
	set triggerUnit = null
	set NIX = null
	set targetUnit = null
	set dummyUnit = null
endfunction
function X9A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group gg =(LoadGroupHandle(HY, h,$85))
	local group g = LoginGroup(389)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local unit NIX =(LoadUnitHandle(HY, h, 45))
	local real W_E =(LoadReal(HY, h, 47))
	local real W0E =(LoadReal(HY, h, 48))
	local real WYE = GetUnitX(NIX)
	local real WZE = GetUnitY(NIX)
	local real radian =(LoadReal(HY, h, 13))
	local real nX = CoordinateX50(GetUnitX(NIX)+ 30 * Cos(radian))
	local real nY = CoordinateY50(GetUnitY(NIX)+ 30 * Sin(radian))
	local unit dummyUnit
	local integer level = LoadInteger(HY, h, 0)
	if(LoadBoolean(HY, h, 384)) then
		call SaveBoolean(HY, h, 384,(false))
		set dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),('h002'), WYE, WZE, 0)
		call SetUnitAbilityLevel(dummyUnit,('A0I2'), level)
		call SetUnitAbilityLevel(dummyUnit,('A0HY'), level)
		call UnitApplyTimedLife(dummyUnit,'BTLF', 12)
	else
		call SaveBoolean(HY, h, 384,(true))
	endif
	call SetUnitX(NIX, nX)
	call SetUnitY(NIX, nY)
	set LW = gg
	set GW = triggerUnit
	set JW = 50 * GetUnitAbilityLevel(triggerUnit,'A0HW')+ 50
	call GroupEnumUnitsInRange(g, nX, nY,$A5, Condition(function X7A))
	call ForGroup(g, function X5A)
	call LogoutGroup(g)
	if(nX -W_E)*(nX -W_E)+(nY -W0E)*(nY -W0E)<$640 then
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call KillUnit(NIX)
		call LogoutGroup(gg)
	endif
	set gg = null
	set t = null
	set g = null
	set triggerUnit = null
	set NIX = null
	set dummyUnit = null
endfunction
function OVA takes unit K4X, integer ADX returns boolean
	return(GetItemTypeId(UnitItemInSlot(K4X, ADX))=='pspd') or(GetItemTypeId(UnitItemInSlot(K4X, ADX))=='oflg')
endfunction
function OEA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local real N5O = LoadReal(HY, h, 57)
	local integer O3X = 0
	loop
	exitwhen O3X > 5
		if OVA(triggerUnit, O3X) then
			if GetUnitAbilityLevel(triggerUnit,('B047'))== 0 then
				call SetItemDropOnDeath(UnitItemInSlot(triggerUnit, O3X), true)
				if GetItemTypeId(UnitItemInSlot(triggerUnit, O3X))=='oflg' then
					call SetItemDroppable(UnitItemInSlot(triggerUnit, O3X), true)
				endif
			else
				call SetItemDropOnDeath(UnitItemInSlot(triggerUnit, O3X), false)
				if GetItemTypeId(UnitItemInSlot(triggerUnit, O3X))=='oflg' then
					call SetItemDroppable(UnitItemInSlot(triggerUnit, O3X), false)
				endif
			endif
		endif
		set O3X = O3X + 1
	endloop
	set N5O = N5O + .2
	call SaveReal(HY, h, 57, N5O * 1.)
	if GetUnitAbilityLevel(triggerUnit,('B047'))== 0 then
		call SetUnitPathing(triggerUnit, true)
	else
		call SetUnitPathing(triggerUnit, false)
	endif
	if N5O > 30 then
		call PauseTimer(t)
		call FlushChildHashtable(HY, h)
		call SetUnitPathing(triggerUnit, true)
		set O3X = 0
		loop
		exitwhen O3X > 5
			if OVA(triggerUnit, O3X) then
				call SetItemDropOnDeath(UnitItemInSlot(triggerUnit, O3X), true)
				if GetItemTypeId(UnitItemInSlot(triggerUnit, O3X))=='oflg' then
					call SetItemDroppable(UnitItemInSlot(triggerUnit, O3X), true)
				endif
			endif
			set O3X = O3X + 1
		endloop
	endif
	set t = null
	set triggerUnit = null
endfunction
function OXA takes unit triggerUnit, integer level returns nothing
	local unit targetUnit = GetSpellTargetUnit()
	local real WYE = CoordinateX50(GetUnitX(triggerUnit))
	local real WZE = CoordinateY50(GetUnitY(triggerUnit))
	local unit NIX = CreateUnit(GetOwningPlayer(triggerUnit),('h003'), WYE, WZE, 0)
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local group CNO = LoginGroup(390)
	local real a
	local real W_E
	local real W0E
	call SetUnitPathing(NIX, false)
	call SaveGroupHandle(HY, h,$85, CNO)
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	call SaveUnitHandle(HY, h, 45, NIX)
	if targetUnit != null then
		call SaveUnitHandle(HY, h, 30, targetUnit)
		call SaveInteger(HY, h, 0, level)
		call TimerStart(t, .035, true, function X8A)
	else
		set W_E = GetSpellTargetX()
		set W0E = GetSpellTargetY()
		set a = Atan2(W0E -WZE, W_E -WYE)
		call SetUnitFacing(NIX, a * bj_RADTODEG)
		set W_E = CoordinateX50(WYE +$834* Cos(a))
		set W0E = CoordinateY50(WZE +$834* Sin(a))
		call SaveReal(HY, h, 47, W_E * 1.)
		call SaveReal(HY, h, 48, W0E * 1.)
		call SaveReal(HY, h, 13, a * 1.)
		call SaveInteger(HY, h, 0, level)
		call TimerStart(t, .035, true, function X9A)
	endif
	set t = CreateTimer()
	set h = GetHandleId(t)
	call SetUnitPathing(triggerUnit, false)
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	call TimerStart(t, .2, true, function OEA)
	set targetUnit = null
	set NIX = null
	set t = null
	set CNO = null
endfunction
function AUE takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(WJE,'A0HW')
	if GetUnitAbilityLevel(WJE,'Aloc')== 1 and HaveSavedHandle(HY, GetHandleId(WJE), 0) then
		set WJE = LoadUnitHandle(HY, GetHandleId(WJE), 0)
	endif
	call OXA(WJE, level)
	set WJE = null
endfunction
function PreloadSpectralDagger takes nothing returns nothing
	call CreateSound("Sounds\\Spectral Dagger.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call AddAbilityIDToPreloadQueue('A0I2')
	call AddAbilityIDToPreloadQueue('A0HY')
endfunction
function OOA takes nothing returns boolean
	return(IsUnitAlly(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()))!= null
endfunction
function DesolateActions takes unit R8X, unit WLE returns nothing
	local group g = LoginGroup(391)
	local real d = 20 * GetUnitAbilityLevel(R8X,'P338')
	local real cool = 0.3
	call GroupEnumUnitsInRange(g, GetUnitX(WLE), GetUnitY(WLE), 275, Condition(function OOA))
	call GroupRemoveUnit(g, WLE)
	if FirstOfGroup(g)== null then
		if IsUnitIllusion(R8X) or IsUnitType(R8X, UNIT_TYPE_MELEE_ATTACKER)== false then
			set d = 0 +$A* GetUnitAbilityLevel(R8X,'P338')
			if GetUnitAbilityLevel(R8X,'B06L')> 0 then
				set d = d * .75
			endif
		endif
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayTarget.mdl", WLE, "overhead"))
		call UnitDamageTargetEx(R8X, WLE, 3, d)
		//call BJDebugMsg("荒芜伤害")
	endif
	call LogoutGroup(g)
	set g = null
endfunction

function Spectre_Dispersion_Spread takes nothing returns nothing
	local real d = GetDistanceBetweenUnits(GetTriggerUnit(), GetEnumUnit())-25
	local real ENI =(1000-d)/ 700
	if ENI > 1. then
		set ENI = 1.
	endif
	if ENI > 0 then
		call UnitDamageTargetEx(GetTriggerUnit(), GetEnumUnit(), 11, MSV * ENI)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayDamage.mdl", GetEnumUnit(), "chest"))
	endif
endfunction

function DispersionActions takes nothing returns boolean
	local integer level = GetUnitAbilityLevel(DETargetUnit[DEI],'A0NA')
	local group g = null
	local real d
	local real ENI
	local real ONA
	local real damage = GetAllDamage()
	local unit firstUnit = null
	if IsEffectiveDamage(damage) and FK and UnitAlive(DETargetUnit[DEI]) then
		//call SingleDebug(R2S(damage))
		set g = LoginGroup(392)
		if not Mode__RearmCombos and GetHeroPrimaryAttributesType(DETargetUnit[DEI])== 1 then
			set ONA = damage *(.06 + .02 * level)
		else
			set ONA = damage *(.06 + .04 * level)
		endif
		call GroupEnumUnitsInRange(g, GetUnitX(DETargetUnit[DEI]), GetUnitY(DETargetUnit[DEI]), 1025, null)
		loop
			set firstUnit = FirstOfGroup(g)
		exitwhen firstUnit == null
			call GroupRemoveUnit(g, firstUnit)
			// 敌对单位 存活 不是建筑不是守卫 不是魔免
			if IsUnitEnemy(firstUnit, DETargetPlayer[DEI]) and IsAliveNotStrucNotWard(firstUnit) and not IsMagicImmuneUnit(firstUnit) then
				set d = GetDistanceBetweenUnits(DETargetUnit[DEI], firstUnit)-25
				set ENI =( 1000 - d ) / 700
				if ENI > 1. then
					set ENI = 1.
				endif
				if ENI > 0 then
					call UnitTransmittedSourceTypeDamage(DETargetUnit[DEI], firstUnit, ONA * ENI)
					call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayDamage.mdl", firstUnit, "chest"))
				endif
			endif
		endloop
		set firstUnit = null
		call LogoutGroup(g)
		set g = null
	endif
	return false
endfunction

function GetManaShieldBlock takes real value, real data returns real
	local real block = GetUnitState(DETargetUnit[DEI], UNIT_STATE_MANA) * data
	local real newValue = block - value
	if ( newValue ) >= 0. then
		call SetUnitState(DETargetUnit[DEI], UNIT_STATE_MANA, newValue / data)
		return value
	else
		call SetUnitState(DETargetUnit[DEI], UNIT_STATE_MANA, 0.)
		return block
	endif
endfunction

// 
function ManaShieldActions takes nothing returns nothing
	local integer level = LoadInteger(ExtraHT, DETargetId[DEI],'A0NA')
	local real data = 1.3 + level * 0.3
	if DEDamageValue[DEI] > 0. then
		set DEDamageValue[DEI] = DEDamageValue[DEI] - GetManaShieldBlock(DEDamageValue[DEI] * 0.5, data)
	endif
	if DEPhysicsDamage[DEI] > 0. then
		set DEPhysicsDamage[DEI] = DEPhysicsDamage[DEI] - GetManaShieldBlock(DEPhysicsDamage[DEI] * 0.5, data)
	endif
	if DEMagicalDamage[DEI] > 0. then
		set DEMagicalDamage[DEI] = DEMagicalDamage[DEI] - GetManaShieldBlock(DEMagicalDamage[DEI] * 0.5, data)
	endif

	if DEPureDamage[DEI] > 0. then
		set DEPureDamage[DEI] = DEPureDamage[DEI] - GetManaShieldBlock(DEPureDamage[DEI] * 0.5, data)
	endif
endfunction

function FatalBondsLoopActions takes nothing returns nothing
	local unit enumUnit = GetEnumUnit()
	local real damage = GetAllDamage() * 0.2
	if enumUnit == DETargetUnit[DEI] then
		set enumUnit = null
		return
	endif
	if GetWidgetLife(enumUnit)< damage then
		set TransmittedDamage = true
		call UnitDamageTargetEx(DESourceUnit[DEI], enumUnit, 3, damage)
		set TransmittedDamage = false
	else
		call NotLethalLifeRemoved(enumUnit, damage)
	endif
	set enumUnit = null
endfunction

function FatalBondsTransmittedActions takes nothing returns nothing
	local integer i = 1
	loop
	exitwhen i > FatalBondsCount
		if IsUnitInGroup(DETargetUnit[DEI], FatalBondsGroups[i]) then
			call ForGroup(FatalBondsGroups[i], function FatalBondsLoopActions)
		endif
		set i = i + 1
	endloop
endfunction

function DeathFraudTransmittedActions takes nothing returns nothing
	local integer level = GetUnitAbilityLevel(DETargetUnit[DEI],'A34A')
	local real hp = GetWidgetLife(DETargetUnit[DEI])
	local real maxLife = GetUnitState(DETargetUnit[DEI], UNIT_STATE_MAX_LIFE)
	local real percentLife = hp / maxLife
	local real damage = GetAllDamage()
	local real data = 0.55 + level * 0.05
	local real value
	
	// 伤害 > 最大生命值的一半  生命值 > 20% 伤害 > 300
	if damage > maxLife * 0.5 and percentLife > 0.2 and damage > 300. then
	
		set value = damage * data
		//set DEDamageValue[DEI] = DEDamageValue[DEI] - value

		set DeathFraudMode[DEI] = 1
		set DeathFraudValue[DEI] = data

		set TransmittedDamage = true
		call UnitDamageTargetEx(DETargetUnit[DEI], DESourceUnit[DEI], 3, value)
		set TransmittedDamage = false

		call CommonTextTag(GetUnitName(DETargetUnit[DEI])+ " just Cheated Death!!", 5, DETargetUnit[DEI], .03, 255, 0, 0, 255)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\DispelMagic\\DispelMagicTarget.mdl", DETargetUnit[DEI], "overhead"))

	elseif damage > 1000. then
		set DeathFraudMode[DEI] = 2
	endif


endfunction

function LivingArmorActions takes nothing returns nothing


endfunction

function GetDispersion takes nothing returns nothing
	set HaveDispersion = true
endfunction

function HauntIllusionActions takes nothing returns nothing
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local unit illusionUnit =(LoadUnitHandle(HY, h, 386))
	local unit targetUnit =(LoadUnitHandle(HY, h, 387))
	local integer count =(LoadInteger(HY, h, 385))
	if GetTriggerEventId()!= EVENT_WIDGET_DEATH and GetTriggerEventId()!= EVENT_UNIT_ISSUED_TARGET_ORDER and GetTriggerEventId()!= EVENT_UNIT_ISSUED_POINT_ORDER then
		set count = count + 1
		call SaveInteger(HY, h, 385,(count))
	endif
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call DisableTrigger(GetTriggeringTrigger())
		call FlushChildHashtable(HY,(GetHandleId(trig)))
		call SaveInteger(HY, h, 385,(count))
		if targetUnit == GetTriggerUnit() then
			call KillUnit(illusionUnit)
		endif
		call CleanCurrentTrigger(trig)
	elseif not IsUnitPaused(illusionUnit) then
		if count == 2 then
			call SetUnitVertexColor(illusionUnit, 255, 255, 255, 255)
		endif
		if count > 1 then
			call DisableTrigger(trig)
			if IsUnitInRange(illusionUnit, targetUnit, 1200) then
				call IssueTargetOrderById(illusionUnit, 851983, targetUnit)
			endif
			call EnableTrigger(trig)
		else
			call DisableTrigger(trig)
			if IsUnitInRange(illusionUnit, targetUnit, 1200) then
				call IssueTargetOrderById(illusionUnit, 851986, targetUnit)
			endif
			call EnableTrigger(trig)
		endif
	endif
	set targetUnit = null
	set trig = null
	set illusionUnit = null
endfunction

function RegisterHauntIllusion takes unit trigUnit, unit targetUnit, unit illusionUnit returns nothing

	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(ExtraHT, GetHandleId(illusionUnit), 'A0H9', targetUnit)
	call EXSetUnitPathing(illusionUnit, false)
	call SetUnitMoveSpeed(illusionUnit, 400)
	call SetUnitX(illusionUnit, GetUnitX(targetUnit))
	call SetUnitY(illusionUnit, GetUnitY(targetUnit))
	call IssueTargetOrderById(illusionUnit, 851986, targetUnit)
	call SetUnitVertexColor(illusionUnit, 255, 255, 255, 50)
	call TriggerRegisterUnitEvent(t, illusionUnit, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterUnitEvent(t, illusionUnit, EVENT_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterDeathEvent(t, illusionUnit)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddAction(t, function HauntIllusionActions)
	call DestroyEffect(AddSpecialEffect("units\\nightelf\\SpiritOfVengeance\\SpiritOfVengeance.mdl", GetUnitX(illusionUnit), GetUnitY(illusionUnit)))
	call SaveUnitHandle(HY, h, 387, targetUnit)
	call SaveUnitHandle(HY, h, 386, illusionUnit)
	call SaveInteger(HY, h, 385, 0)

	set t = null
endfunction

function HauntActions takes unit trigUnit, unit targetUnit, integer level returns nothing
	local real dur = 4 + level
	local real dataB = 0.7
	local real dataC = 2.
	local unit illusionUnit = SummonIllusion(trigUnit, trigUnit, dur, dataB, dataC, 58., null)

	if illusionUnit != null then
		call RegisterHauntIllusion(trigUnit, targetUnit, illusionUnit)
	endif

	set illusionUnit = null
endfunction

function SpellEffect__Haunt takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local group g = LoginGroup(393)
	local sound s
	local unit firstUnit
	local player trigPlayer = GetOwningPlayer(triggerUnit)
	local integer count = 0
	local integer level = GetUnitAbilityLevel(triggerUnit, GetSpellAbilityId())
	call UnitAddPermanentAbility(triggerUnit,'A0HA')
	call EXSetUnitPathing(triggerUnit, false)
	call GroupEnumUnitsInRect(g, bj_mapInitialPlayableArea, null)
	
	loop
		set firstUnit = FirstOfGroup(g)
		exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)
		if UnitAlive(firstUnit) and IsUnitType(firstUnit, UNIT_TYPE_HERO) and IsUnitEnemy(firstUnit, trigPlayer) then
			set count = count + 1
			call HauntActions(triggerUnit, firstUnit, level)
		endif
	endloop

	set firstUnit = null
	call EXSetUnitPathing(triggerUnit, true)
	if count > 0 then
		set s = CreateSound("Abilities\\Spells\\Other\\ANsa\\SacrificeUnit.wav", false, false, false, 10, 10, "DefaultEAXON")
		call StartSound(s)
		call KillSoundWhenDone(s)
	endif
	call LogoutGroup(g)
	set g = null
	set triggerUnit = null
endfunction
function MPE takes nothing returns nothing
	call UnitAddPermanentAbility(GetTriggerUnit(),'A0HA')
endfunction
function PreloadSpectralHaunt takes nothing returns nothing

	call CreateSound("Abilities\\Spells\\Other\\ANsa\\SacrificeUnit.wav", false, false, false, 10, 10, "DefaultEAXON")
	call AddAbilityIDToPreloadQueue('A0N9')

endfunction
function OJA takes nothing returns boolean
	return GetUnitAbilityLevel(GetFilterUnit(),('B06L'))> 0
endfunction
function OKA takes nothing returns nothing
	local unit K4X
	local real GIX = I0X(GetEnumUnit(), GetSpellTargetLoc())
	if GIX < JW then
		set GW = GetEnumUnit()
		set JW = GIX
	endif
	set K4X = null
endfunction
function GetRealityUnit takes player p, real x, real y returns unit
	local group g = LoginGroup(394)
	local unit firstUnit = null
	local real distance = 99999.
	local unit pickUnit = null
	local real r = .0

	set lastRealityUnit = null
	call GroupEnumUnitsOfPlayer(g, p, null)

	loop
		set firstUnit = FirstOfGroup(g)
	exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)
		if UnitAlive(firstUnit) and HaveSavedHandle(ExtraHT, GetHandleId(firstUnit), 'A0H9') then
			set r = GetDistanceBetween(GetUnitX(firstUnit), GetUnitY(firstUnit), x, y)
			if r < distance then
				set pickUnit = firstUnit
				set distance = r
			endif
		endif
	endloop

	set lastRealityUnit = pickUnit
	set pickUnit = null
	set firstUnit = null
	call LogoutGroup(g)
	set g = null
	return lastRealityUnit
endfunction
function OMA takes nothing returns nothing
	if LoadInteger(ExtraHT, GetHandleId(GetEnumUnit()),'A0H9')!= 1 then
		call EPX(GetEnumUnit(),'A0H9', 6)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\SpiritLink\\SpiritLinkZapTarget.mdl", GetEnumUnit(), "chest"))
		call UnitDamageTargetEx(JA, GetEnumUnit(), 1, GetUnitAbilityLevel(JA,'A0H9')* 50 + 50)
	endif
endfunction
function OPA takes unit KKX, unit PQI returns nothing
	local group g = LoginGroup(395)
	set U2 = KKX
	call GroupEnumUnitsInRange(g, GetUnitX(PQI), GetUnitY(PQI), 375, Condition(function DJX))
	set JA = KKX
	call KillUnit(PQI)
	call ForGroup(g, function OMA)
	call LogoutGroup(g)
	set g = null
endfunction
function SpellEffect__Reality takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local player p = GetOwningPlayer(triggerUnit)
	local unit targetUnit = GetRealityUnit(p, x, y)
	local unit hauntTarget = LoadUnitHandle(ExtraHT, GetHandleId(targetUnit), 'A0H9')
	if targetUnit == null then
		call InterfaceErrorForPlayer(GetOwningPlayer(triggerUnit), GetObjectName('n03Z'))
	else
		set x = GetUnitX(targetUnit)
		set y = GetUnitY(targetUnit)
		call OPA(triggerUnit, targetUnit)
		call SetUnitX(targetUnit, GetUnitX(triggerUnit))
		call SetUnitY(targetUnit, GetUnitY(triggerUnit))
		call SetUnitX(triggerUnit, x)
		call SetUnitY(triggerUnit, y)
		if GetDistanceBetween(GetCameraEyePositionX(), GetCameraEyePositionY(), x, y) > 1400 then
			call PanCameraToTimedForPlayer(GetOwningPlayer(triggerUnit), x, y, 0)
		endif
		call IssueTargetOrderById(triggerUnit, 851983, hauntTarget)
	endif
	set triggerUnit = null
	set targetUnit = null
	set hauntTarget = null
endfunction
function OSA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit target =(LoadUnitHandle(HY, h, 17))
	local unit u =(LoadUnitHandle(HY, h, 2))
	local real radian =(LoadReal(HY, h, 13))
	local real x = GetUnitX(target)
	local real y = GetUnitY(target)
	local integer c = GetTriggerEvalCount(t)
	local real distance = LoadReal(HY, h,$C1)
	local integer WOV =(LoadInteger(HY, h, 12))
	local integer i
	if c > 35 then
		call SaveReal(HY, h,$C1, distance * .98)
	endif
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or c > WOV then
		set i = LoadInteger(P, h,'A0G5')-1
		call SaveInteger(P, h,'A0G5', i)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl", x, y))
		call KillDestructablesInCircle(x, y, 150)
		set x = CoordinateX50(x + distance * Cos(radian))
		set y = CoordinateY50(y + distance * Sin(radian))
		if(IsPointInRegion(R4,((x)* 1.),((y)* 1.)))== false then
			if IsUnitType(target, UNIT_TYPE_HERO) then
				call SaveBoolean(K, GetHandleId(target), 99, true)
			endif
			call SetUnitX(target, x)
			call SetUnitY(target, y)
		endif
		if c == 1 and LoadBoolean(HY, h, 0) then
			call IssueTargetOrderById(u, 851983, target)
		endif
	endif
	set t = null
	set target = null
	set u = null
	return false
endfunction
function OTA takes unit u, unit target, integer lv, boolean OUA returns nothing
	local trigger t = null
	local integer h
	call AddAbilityToTimed(u,'A24G', 1, 3,'B0EC')
	if target == RoShan then
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .01, true)
	call TriggerRegisterDeathEvent(t, target)
	call TriggerAddCondition(t, Condition(function OSA))
	call SaveInteger(HY, h, 12, 80 + 20 * lv)
	call SaveUnitHandle(HY, h, 2, u)
	call SaveUnitHandle(HY, h, 17, target)
	call SaveBoolean(HY, h, 0, OUA)
	call SaveReal(HY, h,$C1, 2.)
	call SaveReal(HY, h, 13, Atan2(GetUnitY(target)-GetUnitY(u), GetUnitX(target)-GetUnitX(u)))
	call UnitDamageTargetEx(u, target, 1, GetUnitMoveSpeedEx(u)* .1 * lv)
	call SaveInteger(P, GetHandleId(u),'A0G5', LoadInteger(P, GetHandleId(u),'A0G5')+ 1)
	set t = null
endfunction
function OWA takes unit u, unit t, boolean b, integer i returns nothing
	local unit d = null
	local integer lv
	if GetUnitAbilityLevel(u,'A36D')== 1 then
		return
	endif
	set lv = GetUnitAbilityLevel(u,'A0G5')
	set d = CreateUnit(GetOwningPlayer(t),'e00E', GetUnitX(t), GetUnitY(t), 0)
	if lv == 0 then
		if i == 2 then
			set lv = 4
		elseif i == 3 then
			set lv = GetUnitAbilityLevel(u,'A1P8')
		endif
	endif
	call UnitAddAbility(d,'A1WQ')
	call SetUnitAbilityLevel(d,'A1WQ', lv)
	if t == RoShan or IssueTargetOrderById(d, 852095, t) then
		call OTA(u, t, lv, b)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl", u, T2V(u)))
	endif
	call KillUnit(d)
	set d = null
endfunction
function GreaterBashActions takes unit u, unit t returns nothing
	if IsUnitIllusion(u)== false and(Mode__BalanceOff or LoadReal(P, GetHandleId(u),'A0G5')< GetGameTime()) then
		if GetUnitAbilityLevel(u,'A36D')== 0 and GetUnitAbilityLevel(u,'A3L2')== 0 and GetPrdRandom(u,'A0G5', 17) then
			call SaveReal(P, GetHandleId(u),'A0G5', GetGameTime()+ 1.5)
			call OWA(u, t, true, 1)
		endif
	endif
endfunction
function OZA takes nothing returns boolean
	local unit t = GetFilterUnit()
	local unit u = Temp__ArrayUnit[0]
	local real x1
	local real y1
	local real x2
	local real y2
	local real O_A
	if IsUnitEnemy(u, GetOwningPlayer(t)) and IsUnitType(t, UNIT_TYPE_STRUCTURE)== false and GetUnitAbilityLevel(t,'A04R')== 0 and UnitVisibleToPlayer(t, GetOwningPlayer(u)) and UnitAlive(t) and(IsUnitType(t, UNIT_TYPE_ANCIENT)== false or IsBearUnit(t)) and IsMagicImmuneUnit(t)== false then
		set u = Temp__ArrayUnit[2]
		set x1 = GetWidgetX(u)
		set y1 = GetWidgetY(u)
		set x2 = GetWidgetX(t)
		set y2 = GetWidgetY(t)
		set O_A = SquareRoot((x1 -x2)*(x1 -x2)+(y1 -y2)*(y1 -y2))
		if Temp__ArrayReal[0]> O_A then
			set Temp__ArrayUnit[1]= t
			set Temp__ArrayReal[0]= O_A
		endif
	endif
	set t = null
	set u = null
	return false
endfunction
function O0A takes unit u, unit t, integer i returns boolean
	local string s = ""
	set Temp__ArrayUnit[0]= u
	set Temp__ArrayUnit[1]= null
	set Temp__ArrayUnit[2]= t
	set Temp__ArrayReal[0]= 99999.
	call GroupEnumUnitsInRange(AK, GetWidgetX(t), GetWidgetY(t),$FA0, Condition(function OZA))
	if Temp__ArrayUnit[1]== null then
		call IssueImmediateOrderById(u,$D0004)
		return true
	endif
	if Temp__ArrayUnit[1]!= null then
		call UnitAddPermanentAbility(Temp__ArrayUnit[1],'A315')
		call GHX(Temp__ArrayUnit[1], u,'A315')
		call SaveUnitHandle(P, GetHandleId(u), StringHash("ChargedUnit"), Temp__ArrayUnit[1])
	endif
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(u)) or IsObserver then
		set s = "Abilities\\Spells\\Other\\HowlOfTerror\\HowlTarget.mdl"
	endif
	call DestroyEffect(LoadEffectHandle(P, i, 5))
	call DestroyEffect(LoadEffectHandle(P, i, 4))
	call SaveEffectHandle(P, i, 4, AddSpecialEffectTarget(s, Temp__ArrayUnit[1], "overhead"))
	call SaveEffectHandle(P, i, 5, AddSpecialEffectTarget(s, Temp__ArrayUnit[1], "overhead"))
	call SaveUnitHandle(P, i, 1, Temp__ArrayUnit[1])
	call UnitRemoveAbility(Temp__ArrayUnit[2],'A315')
	return false
endfunction
function O1A takes timer t, unit u, unit WLE, integer WFV returns nothing
	call SetUnitTimeScale(u, 1)
	call SetUnitPathing(u, true)
	call SetUnitAnimation(u, "stand")
	call SetUnitVertexColorEx(u,-1,-1,-1, 255)
	if LoadUnitHandle(P, GetHandleId(u), StringHash("ChargedUnit"))!= null then
		call UnitRemoveAbility(LoadUnitHandle(P, GetHandleId(u), StringHash("ChargedUnit")),'A315')
	endif
	call UnitRemoveAbility(WLE,'A315')
	call SaveBoolean(P, GetHandleId(u),'A1P8', false)
	call DestroyEffect(LoadEffectHandle(P, WFV, 5))
	call DestroyEffect(LoadEffectHandle(P, WFV, 4))
	call DestroyEffect(LoadEffectHandle(P, WFV, 3))
	call LogoutGroup(LoadGroupHandle(P, WFV, 2))
	call DestroyTimerAndFlushHT_P(t)
endfunction
function O2A takes nothing returns boolean
	local unit t = GetFilterUnit()
	local unit u = Temp__ArrayUnit[0]
	local group g = LoadGroupHandle(P, XK[0], 2)
	if IsUnitEnemy(u, GetOwningPlayer(t)) and IsUnitInGroup(t, g)== false and t != Temp__ArrayUnit[1]and IsUnitType(t, UNIT_TYPE_STRUCTURE)== false and GetUnitAbilityLevel(t,'A04R')== 0 and UnitAlive(t) and(IsUnitType(t, UNIT_TYPE_ANCIENT)== false or IsBearUnit(t)) then
		call GroupAddUnit(g, t)
		call OWA(u, t, false, 3)
	endif
	set t = null
	set u = null
	set g = null
	return false
endfunction
function O3A takes nothing returns nothing
	local timer WIE = GetExpiredTimer()
	local integer WFV = GetHandleId(WIE)
	local unit u = LoadUnitHandle(P, WFV, 0)
	local unit t = LoadUnitHandle(P, WFV, 1)
	local real x1 = GetWidgetX(u)
	local real y1 = GetWidgetY(u)
	local real O_A
	local real radian
	local real N3X
	local real x2
	local real y2
	if LoadBoolean(P, GetHandleId(u),'A1P8')== false or(UnitIsDead(t) and O0A(u, t, WFV)) then
		call O1A(WIE, u, t, WFV)
		set WIE = null
		set t = null
		set u = null
		return
	endif
	set x2 = GetWidgetX(t)
	set y2 = GetWidgetY(t)
	set N3X = LoadReal(P, WFV, 0)
	set O_A = SquareRoot((x1 -x2)*(x1 -x2)+(y1 -y2)*(y1 -y2))
	if  100 > O_A then
		call O1A(WIE, u, t, WFV)
		call IssueTargetOrderById(u, 851983, t)
		call SetUnitAnimation(u, "attack")
		call OWA(u, t, true, 3)
		set u = CreateUnit(GetOwningPlayer(t),'e00E', GetWidgetX(t), GetWidgetY(t), 0)
		call CommonUnitAddStun(u,(.4 * LoadInteger(P, WFV, 0))+ .8, false)
		set WIE = null
		set t = null
		set u = null
		return
	endif
	set radian = Atan2(y2 -y1, x2 -x1)
	set XK[0]= WFV
	set x2 = x1 + N3X * Cos(radian)
	set y2 = y1 + N3X * Sin(radian)
	set Temp__ArrayUnit[0]= u
	set Temp__ArrayUnit[1]= t
	call SetUnitFacing(u, radian * bj_RADTODEG)
	call SetUnitX(u, x2)
	call SetUnitY(u, y2)
	call GroupEnumUnitsInRange(AK, x2, y2, 325, Condition(function O2A))
	set WIE = null
	set t = null
	set u = null
endfunction
function JRE takes nothing returns nothing
	local unit WLE = LoadUnitHandle(P, GetHandleId(GetTriggerUnit()), StringHash("ChargedUnit"))
	call SaveBoolean(P, GetHandleId(GetTriggerUnit()),'A1P8', false)
	call UnitRemoveAbility(WLE,'A315')
	set WLE = null
endfunction
function O4A takes unit WJE, integer WUV returns nothing
	local timer WIE = CreateTimer()
	local unit WLE = GetSpellTargetUnit()
	local integer WFV = GetHandleId(WIE)
	local integer W0V = GetHandleId(WJE)
	local string s = ""
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(WJE)) or IsObserver then
		set s = "Abilities\\Spells\\Other\\HowlOfTerror\\HowlTarget.mdl"
		call PingMinimapEx(GetWidgetX(WLE), GetWidgetY(WLE), 2, 255, 255, 255, false)
	endif
	call SetUnitPathing(WJE, false)
	call SetUnitTimeScale(WJE, 2.5)
	call SetUnitAnimationByIndex(WJE, LoadInteger(P, GetUnitTypeId(WJE),'A1P8'))
	call SetUnitVertexColorEx(WJE,-1,-1,-1, 100)
	call UnitAddPermanentAbility(WLE,'A315')
	call GHX(WLE, WJE,'A315')
	call SaveBoolean(P, W0V,'A1P8', true)
	call SaveUnitHandle(P, WFV, 0, WJE)
	call SaveUnitHandle(P, WFV, 1, WLE)
	call SaveUnitHandle(P, GetHandleId(WJE), StringHash("ChargedUnit"), WLE)
	call SaveGroupHandle(P, WFV, 2, LoginGroup(396))
	call SaveEffectHandle(P, WFV, 3, AddSpecialEffectTarget("war3mapImported\\ShockwaveMissilePurple.mdx", WJE, "origin"))
	call SaveEffectHandle(P, WFV, 4, AddSpecialEffectTarget(s, WLE, "overhead"))
	call SaveEffectHandle(P, WFV, 5, AddSpecialEffectTarget(s, WLE, "overhead"))
	call SaveInteger(P, WFV, 0, WUV)
	call SaveReal(P, WFV, 0, WUV * 1.25 + 13.75)
	call TimerStart(WIE, .025, true, function O3A)
	set WJE = null
	set WLE = null
	set WIE = null
endfunction
function W9V takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(WJE,'A1P8')
	if GetUnitAbilityLevel(WJE,'Aloc')== 1 and HaveSavedHandle(HY, GetHandleId(WJE), 0) then
		set WJE = LoadUnitHandle(HY, GetHandleId(WJE), 0)
	endif
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call O4A(WJE, level)
	endif
	set WJE = null
endfunction
function LKE takes nothing returns nothing
	call S9E(GetOwningPlayer(GetTriggerUnit()),'A179', false)
endfunction
function O5A takes nothing returns nothing
	local integer i = 1
	local integer O6A
	local integer V4A
	local unit u
	loop
		set u = Player__Hero[i]
		if GetUnitAbilityLevel(u,'P310')> 0 and u != null and UnitAlive(u) and M2[i]== false then
			set O6A = LoadInteger(P, GetHandleId(u),'P310')
			set V4A = R2I(.03 * GetUnitAbilityLevel(u,'P310')* GetUnitMoveSpeedEx(u))
			if O6A != V4A then
				if O6A > V4A then
					call LodSystem_ReduceUnitExtraState(u, O6A -V4A, STATE_SYSTEM_DAMAGE)
					call SaveInteger(P, GetHandleId(u),'P310', V4A)
				else
					call LodSystem_AddUnitExtraState(u, V4A -O6A, STATE_SYSTEM_DAMAGE)
					call SaveInteger(P, GetHandleId(u),'P310', V4A)
				endif
			endif
		endif
		set i = i + 1
		if i == 6 then
			set i = 7
		endif
	exitwhen i >$B
	endloop
	set u = null
endfunction
function PMX takes nothing returns nothing
	call TimerStart(CreateTimer(), .5, true, function O5A)
endfunction
function Spiritbreaker_EmpoweringHaste_PostEnd takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer level = LoadInteger(HY, h, 0)
	call UnitRemoveAbility(u,'A44L')
	call UnitRemoveAbility(u,'B03Y')
	call SetPlayerAbilityAvailable(GetOwningPlayer(u),'P310', true)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set u = null
	set t = null
endfunction
function O7A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	call UnitRemoveAbility(u,'A44M')
	call UnitRemoveAbility(u,'B44M')
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set u = null
	set t = null
endfunction
function O8A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	call UnitRemoveAbility(u,'A44K')
	call UnitRemoveAbility(u,'B44K')
	if UnitAlive(u) then
		call UnitAddPermanentAbilitySetLevel(u,'A44M', GetUnitAbilityLevel(u,'A0ES'))
		call TimerStart(t, 6, false, function O7A)
	else
		call FlushChildHashtable(HY, h)
		call DestroyTimer(t)
	endif
	set u = null
	set t = null
endfunction
function W6V takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	call TimerStart(t, 6, false, function O8A)
	call SaveUnitHandle(HY, h, 0, u)
	call UnitAddPermanentAbilitySetLevel(u,'A44K', GetUnitAbilityLevel(u,'A0ES'))
	set u = null
	set t = null
endfunction
function O9A takes unit WUE, unit targetUnit returns nothing
	call OWA(WUE, targetUnit, true, 2)
endfunction
function RVA takes nothing returns nothing
	call OWA(MTV, GetEnumUnit(), false, 2)
endfunction
function REA takes unit WUE, unit Targer returns nothing
	local group g = LoginGroup(397)
	set U2 = WUE
	set MTV = WUE
	call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 275, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	call ForGroup(g, function RVA)
	call LogoutGroup(g)
	set g = null
endfunction
function RXA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer EVX = GetTriggerEvalCount(t)
	local integer ROA
	local integer level
	local real a
	local real GXR =(LoadReal(HY, h, 23))
	local real GOR =(LoadReal(HY, h, 24))
	local real x = GetUnitX(targetUnit)
	local real y = GetUnitY(targetUnit)
	local real d = GetDistanceBetween(x, y, GXR, GOR)
	call SaveReal(HY, h, 23,((x)* 1.))
	call SaveReal(HY, h, 24,((y)* 1.))
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or d >$708 or EVX > 100  then
		call SetUnitVertexColorEx(WUE,-1,-1,-1, 255)
		call UnitRemoveAbility(targetUnit,'A314')
		call UnitRemoveAbility(WUE,'A179')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set ROA = 50 + EVX * 2
		call SetUnitVertexColorEx(WUE,-1,-1,-1, ROA)
		if EVX == 1 then
			set level =(LoadInteger(HY, h, 5))
			set a = Atan2(GetUnitY(targetUnit)-GetUnitY(WUE), GetUnitX(targetUnit)-GetUnitX(WUE))
			call SetUnitPosition(WUE, GetUnitX(targetUnit)+ 80 * Cos(a), GetUnitY(targetUnit)+ 80 * Sin(a))
			call SetUnitAnimation(WUE, "attack")
			call IssueTargetOrderById(WUE, 851983, targetUnit)
			if LoadBoolean(HY, h, 0) then
				call REA(WUE, targetUnit)
			else
				call O9A(WUE, targetUnit)
			endif
			call UnitDamageTargetEx(WUE, targetUnit, 1, 50 + 100 * level)
			if GetUnitAbilityLevel(targetUnit,'A3E9')== 1 and UnitIsDead(targetUnit)== false and UnitIsDead(WUE)== false then
				call SaveUnitHandle(VV,'A3E9', 0, targetUnit)
				call SaveUnitHandle(VV,'A3E9', 1, WUE)
				call SaveInteger(VV,'A3E9', 0, LoadInteger(HY, h, 4))
				call SaveInteger(VV,'A3E9', 0, level)
				call ExecuteFunc("RRA")
			endif
		endif
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function RIA takes unit WUE, unit targetUnit, integer T0V, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local boolean b = T0V =='A1D8'
	call UnitAddPermanentAbility(targetUnit,'A314')
	call GHX(targetUnit, WUE,'A314')
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY, h, 4, T0V)
	call SaveBoolean(HY, h, 0, b)
	call SaveReal(HY, h, 23,((GetUnitX(targetUnit))* 1.))
	call SaveReal(HY, h, 24,((GetUnitY(targetUnit))* 1.))
	call TriggerRegisterTimerEvent(t, .01, true)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function RXA))
	if b then
		call UnitAddPermanentAbility(WUE,'A179')
		call S9E(GetOwningPlayer(WUE),'A179', false)
	endif
	set t = null
endfunction
function AZE takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local integer T0V = GetSpellAbilityId()
	local integer level = GetUnitAbilityLevel(WJE, T0V)
	if GetUnitAbilityLevel(WJE,'Aloc')== 1 and HaveSavedHandle(HY, GetHandleId(WJE), 0) then
		set WJE = LoadUnitHandle(HY, GetHandleId(WJE), 0)
	endif
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call RIA(WJE, GetSpellTargetUnit(), T0V, level)
	endif
	set WJE = null
endfunction
function RRA takes nothing returns nothing
	local unit WLE = LoadUnitHandle(VV,'A3E9', 1)
	call T4V(LoadUnitHandle(VV,'A3E9', 0))
	if UnitHasSpellShield(WLE)== false then
		call RIA(LoadUnitHandle(VV,'A3E9', 0), WLE, LoadInteger(VV,'A3E9', 0), LoadInteger(VV,'A3E9', 1))
	else
		call AJO(WLE)
	endif
	set WLE = null
	call FlushChildHashtable(VV,'A3E9')
endfunction
function RAA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real RNA =(LoadReal(HY, h, 295))
	local real RBA =(LoadReal(HY, h, 296))
	local integer level = LoadInteger(HY, h, 2)
	local real RCA = .25
	if GetSpellTargetUnit()== WUE then
		call EPX(WUE,'AFRZ', .03)
		call SetWidgetLife(WUE, RMaxBJ(GetUnitState(WUE, UNIT_STATE_MAX_LIFE)* RBA * .01, GetUnitState(WUE, UNIT_STATE_MAX_LIFE)* RCA))
	endif
	if GetSpellTargetUnit()== targetUnit and GetWidgetLife(targetUnit)> .5 then
		call EPX(targetUnit,'AFRZ', .03)
		call SetUnitLifePercentBJ(targetUnit, RNA)
		if GetUnitLifePercent(targetUnit)< 25 then
			call SetUnitLifePercentBJ(targetUnit, 25.)
		endif
	endif
	if GetTriggerEvalCount(t)== 2 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set WUE = null
	set targetUnit = null
	set t = null
endfunction
function RDA takes nothing returns boolean
	if GetSpellAbilityId()=='A07R' then
		call RAA()
	endif
	return false
endfunction
function RFA takes unit WUE, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = GetSpellTargetUnit()
	local unit dummyUnit
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveInteger(HY, h, 2, level)
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveReal(HY, h, 295,((GetUnitLifePercent(WUE))* 1.))
	call SaveReal(HY, h, 296,((GetUnitLifePercent(targetUnit))* 1.))
	call TriggerAddCondition(t, Condition(function RDA))
	set dummyUnit = CreateUnit(GetOwningPlayer(targetUnit),'e00Y', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call TriggerRegisterUnitEvent(t, dummyUnit, EVENT_UNIT_SPELL_EFFECT)
	call UnitAddPermanentAbility(dummyUnit,'A07R')
	call IssueTargetOrderById(dummyUnit, 852095, WUE)
	call ShowUnit(dummyUnit, false)
	call SetUnitPathing(dummyUnit, false)
	call SetUnitInvulnerable(dummyUnit, true)
	call UnitApplyTimedLife(dummyUnit,'BTLF', .2)
	set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00Y', GetUnitX(WUE), GetUnitY(WUE), 0)
	call TriggerRegisterUnitEvent(t, dummyUnit, EVENT_UNIT_SPELL_EFFECT)
	call UnitAddPermanentAbility(dummyUnit,'A07R')
	call IssueTargetOrderById(dummyUnit, 852095, targetUnit)
	call ShowUnit(dummyUnit, false)
	call SetUnitPathing(dummyUnit, false)
	call SetUnitInvulnerable(dummyUnit, true)
	call UnitApplyTimedLife(dummyUnit,'BTLF', .2)
	set t = null
	set targetUnit = null
	set dummyUnit = null
endfunction

function MJN takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit DKO =(LoadUnitHandle(HY, h, 2))
	local unit UBT =(LoadUnitHandle(HY, h, 17))
	local real MKN = GetUnitLifePercent(DKO)
	local real MLN = GetUnitLifePercent(UBT)
	local integer NMX = LoadInteger(HY, h, 5)
	local real FAR = 0.25
	//call H9O(DKO,'AFRZ',0.12)
	//call H9O(UBT,'AFRZ',0.12)
	call SetWidgetLife(DKO, RMaxBJ(GetUnitState(DKO, UNIT_STATE_MAX_LIFE)* MLN * 0.01, GetUnitState(DKO, UNIT_STATE_MAX_LIFE)* FAR))
	call SetUnitLifePercentBJ(UBT, MKN)
	if GetUnitLifePercent(UBT)< 25. and GetWidgetLife(UBT)> 1 then
		call SetUnitLifePercentBJ(UBT, 25.)
	endif
	call FlushChildHashtable(HY, h)
	set DKO = null
	set UBT = null
	set t = null
endfunction

function ATG takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(u,'A07Q'))
	call SaveUnitHandle(HY, h, 17, GetSpellTargetUnit())
	if GetUnitTypeId(u)=='e00E' then
		set u = LoadUnitHandle(HY, GetHandleId(u), 0)
	endif
	call SaveUnitHandle(HY, h, 2,(u))
	call TimerStart(t, 0., false, function MJN)
	set t = null
	set u = null
endfunction

function ATB takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) or IsUnitAlly(GetTriggerUnit(), GetOwningPlayer(GetSpellTargetUnit())) then
		call ATG()
	endif
endfunction

function A_E takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(WJE, GetSpellAbilityId())
	if GetUnitAbilityLevel(WJE,'Aloc')== 1 and HaveSavedHandle(HY, GetHandleId(WJE), 0) then
		set WJE = LoadUnitHandle(HY, GetHandleId(WJE), 0)
	endif
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call RFA(WJE, level)
	endif
	set WJE = null
endfunction
function ReflectionIllusionUnitAcionts takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit d = LoadUnitHandle(HY, h, 0)
	local unit u = LoadUnitHandle(HY, h, 1)
	if UnitIsDead(u) or UnitIsDead(d) then
		call DestroyEffect(LoadEffectHandle(HY, h, 2))
		call KillUnit(d)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	call IssueTargetOrderById(d, 851983, u)
	set d = null
	set u = null
	set t = null
endfunction

// 倒影
function SpellEffect__Reflection takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	local unit firstUnit
	local integer level = GetUnitAbilityLevel(spellUnit,'A2KZ')
	local integer h
	local group g = LoginGroup(398)
	local real x = GetUnitX(spellUnit)
	local real y = GetUnitY(spellUnit)
	local unit illusionUnit
	local string targetArt = "Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl"
	local real dur = 1.5 + level * 1.
	local real dataB = 0.2 + level * 0.2
	local player trigPlayer = GetOwningPlayer(spellUnit)

	call GroupEnumUnitsInRange(g, x, y, 900 + MAX_UNIT_COLLISION, null)
	loop
		set firstUnit = FirstOfGroup(g)
	exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)
		// 游戏 存活 可见 敌对 英雄 非魔免
		if IsUnitInRangeXY(firstUnit, x, y, 900) and IsUnitType(firstUnit, UNIT_TYPE_HERO) and IsUnitEnemy(firstUnit, trigPlayer) and UnitAlive(firstUnit) and not IsMagicImmuneUnit(firstUnit) and UnitVisibleToPlayer(firstUnit, trigPlayer) then
			set illusionUnit = SummonIllusion(firstUnit, spellUnit, dur, dataB, 1., 200., targetArt)
			if illusionUnit != null then
				//call ChangeOwnerIllusionUnit(illusionUnit, spellUnit)
				call SetUnitMoveSpeed(illusionUnit, 522)
				call UnitAddAbility(illusionUnit,'Aloc')
				call IssueTargetOrderById(illusionUnit, 851983, firstUnit)
				call SetUnitX(illusionUnit, GetWidgetX(firstUnit)+ 100 * Cos(GetRandomReal(-1.8, 1.8)))
				call SetUnitY(illusionUnit, GetWidgetY(firstUnit)+ 100 * Sin(GetRandomReal(-1.8, 1.8)))
			endif

			set h = CreateTimerEventTrigger(0.2, true, function ReflectionIllusionUnitAcionts)
			call SaveUnitHandle(HY, h, 0, illusionUnit)
			call SaveUnitHandle(HY, h, 1, firstUnit)
			call SaveEffectHandle(HY, h, 2, AddSpecialEffectTarget("war3mapImported\\UnholyPresence.mdx", firstUnit, "overhead"))

			call AddAbilityToTimed(firstUnit,'A26T', 1, 1.5 + level,'B0EJ')

		endif
	endloop
	set illusionUnit = null
	call LogoutGroup(g)
	call PlaySoundAtPoint(ZigguratUpgradeSound, GetUnitX(spellUnit), GetUnitY(spellUnit))
	set spellUnit = null
	set firstUnit = null
	set trigPlayer = null
	set g = null
endfunction
function RJA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE =(LoadUnitHandle(HY, h, 2))
	local unit WLE =(LoadUnitHandle(HY, h, 17))
	local unit d =(LoadUnitHandle(HY, h, 19))
	local integer level =(LoadInteger(HY, h, 5))
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or GetTriggerEvalCount(t)> 28or X3X(WJE) or GetDistanceBetweenUnits(WJE, WLE)> 600 or UnitVisibleToPlayer(WLE, GetOwningPlayer(WJE))== false then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(d)
	elseif GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT then
		if GetTriggerEvalCount(t)> 1 and GetSpellAbilityId()=='A1RA' then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call UnitRemoveAbility(WJE,'A1RA')
			call KillUnit(d)
		endif
	else
		if IsUnitEnemy(WJE, GetOwningPlayer(WLE)) then
			call SetWidgetLife(WJE, GetWidgetLife(WJE)+ level * 25. / 4.)
		else
			call SetWidgetLife(WLE, GetWidgetLife(WLE)+ level * 25. / 4.)
		endif
	endif
	set t = null
	set WJE = null
	set WLE = null
	set d = null
	return false
endfunction
function RKA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE =(LoadUnitHandle(HY, h, 2))
	local unit WLE =(LoadUnitHandle(HY, h, 17))
	local unit d =(LoadUnitHandle(HY, h, 19))
	local boolean b = HaveSavedHandle(HY, h, 21)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call UnitRemoveAbility(WJE,'A1RA')
		if b then
			call RemoveUnit(LoadUnitHandle(HY, h, 21))
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if GetTriggerEvalCount(t)== 1 then
			call IssueImmediateOrderById(WJE,$D0019)
		endif
		if IsUnitEnemy(WJE, GetOwningPlayer(WLE)) then
			call SetUnitX(d, GetUnitX(WJE))
			call SetUnitY(d, GetUnitY(WJE))
			call SetUnitX(LoadUnitHandle(HY, h, 21), GetUnitX(WLE))
			call SetUnitY(LoadUnitHandle(HY, h, 21), GetUnitY(WLE))
		else
			call SetUnitX(d, GetUnitX(WLE))
			call SetUnitY(d, GetUnitY(WLE))
		endif
	endif
	set t = null
	set WJE = null
	set WLE = null
	set d = null
	return false
endfunction
function RLA takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(WJE,'A1PH')
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit d
	if GetUnitTypeId(WJE)=='e00E' then
		if HaveSavedHandle(HY, GetHandleId(WJE), 0) then
			set WJE = LoadUnitHandle(HY, GetHandleId(WJE), 0)
		else
			set WJE = Player__Hero[GetPlayerId(GetOwningPlayer(WJE))]
		endif
	endif
	if IsUnitEnemy(WJE, GetOwningPlayer(WLE)) then
		set d = CreateUnit(GetOwningPlayer(WJE),'u01G', 0, 0, 0)
		call UnitAddAbility(d,'A04L')
		call SetUnitAbilityLevel(d,'A04L', level)
		call SetUnitX(d, GetUnitX(WJE))
		call SetUnitY(d, GetUnitY(WJE))
		call IssueTargetOrderById(d,$D0207, WLE)
	else
		call UnitAddPermanentAbility(WJE,'A1RA')
		set d = CreateUnit(BW,'u01G', 0, 0, 0)
		call SetUnitUserData(d, GetPlayerId(GetOwningPlayer(WJE)))
		call UnitAddAbility(d,'A04L')
		call SetUnitAbilityLevel(d,'A04L', level)
		call SetUnitX(d, GetUnitX(WLE))
		call SetUnitY(d, GetUnitY(WLE))
		call U1V(d,$D0207, WJE)
	endif
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerRegisterDeathEvent(t, WJE)
	call TriggerRegisterDeathEvent(t, WLE)
	call TriggerRegisterUnitEvent(t, WJE, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function RJA))
	call SaveUnitHandle(HY, h, 2,(WJE))
	call SaveUnitHandle(HY, h, 17,(WLE))
	call SaveUnitHandle(HY, h, 19,(d))
	call SaveInteger(HY, h, 5,(level))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .01, true)
	call TriggerRegisterDeathEvent(t, d)
	call TriggerAddCondition(t, Condition(function RKA))
	call SaveUnitHandle(HY, h, 2,(WJE))
	call SaveUnitHandle(HY, h, 17,(WLE))
	call SaveUnitHandle(HY, h, 19,(d))
	if IsUnitEnemy(WLE, GetOwningPlayer(WJE)) then
		call SaveUnitHandle(HY, h, 21, CreateUnit(GetOwningPlayer(WJE),'hBST', GetUnitX(WLE), GetUnitY(WLE), 0))
	endif
	set WJE = null
	set WLE = null
	set t = null
	set d = null
endfunction
function DRE takes nothing returns boolean
	if GetUnitTypeId(GetSpellTargetUnit())!='n00L' and(IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) or(not UnitHasSpellShield(GetSpellTargetUnit()))) then
		call RLA()
	endif
	return false
endfunction
// 魔法镜像
function SpellEffect__ConjureImage takes nothing returns nothing
	local unit targetUnit = GetTriggerUnit()
	local integer lv = GetUnitAbilityLevel(targetUnit,'A0H4')
	local unit illusionUnit = null
	local real dataB = 0.2 + lv * 0.1
	local real dataC = 3.
	local real dur = 25.
	local real area = 200.
	local string targetArt = "Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl"

	if GetUnitTypeId(targetUnit)=='e00E' then
		set targetUnit = Player__Hero[GetPlayerId(GetOwningPlayer(targetUnit))]
	endif
	
	set illusionUnit = SummonIllusion(targetUnit, targetUnit, dur, dataB, dataC, area, targetArt)

	//call SetUnitVertexColor(illusionUnit, 150, 150, 150, 200)

	set targetUnit = null
	set illusionUnit = null
endfunction
function Q5E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A0H4')
	local integer id ='A275'+ level
	if level == 1 then
		call UnitAddPermanentAbility(u,'A33N')
	else
		call SetUnitAbilityLevel(u,'A33N', level)
		call UnitRemoveAbility(u, id -1)
	endif
	call UnitAddPermanentAbility(u, id)
	set u = null
endfunction
function RMA takes nothing returns nothing
	local unit WJE = U2
	local unit WLE = W2
	local integer level = GetUnitAbilityLevel(WJE,'A046')
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl", WLE, "chest"))
	call AddAbilityToTimed(WLE,'A3JR', level, 4, 0)
	call AddAbilityToTimed(WLE,'A3JS', 1, 4,'B3JS')
	call UnitDamageTargetEx(WJE, WLE, 1, 60. + level * 50.)
	set WJE = null
	set WLE = null
endfunction

function a_chaoxi takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer lv = GetUnitAbilityLevel(u, GetSpellAbilityId())
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local real range = 1200.
	call Wave(u,'h08O', 60 + 50 * lv, range, 240, 240, x, y, GetSpellTargetX(), GetSpellTargetY(), 1500, 1, false, "GushUpgraded_Actions", lv)
	set u = null
endfunction
function NXE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call NHX(GetTriggerUnit(), GetSpellTargetUnit(),'h0EN', "RMA",$FA0, false)
	endif
endfunction
function RPA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = GetEventDamageSource()
	local real d = GetEventDamage()
	local real RQA = LoadReal(HY, h, 412)
	local real WIE = LoadReal(HY, h, 411)
	local integer level = GetUnitAbilityLevel(WUE,'A04E')
	if XFX(GetOwningPlayer(targetUnit)) and GetUnitAbilityLevel(WUE,'A36D')== 0 then
		if(WIE + 6)<(GetGameTime()) then
			set RQA = 0
		endif
		set WIE = GetGameTime()
		set RQA = RQA + d
		if RQA > 400 then
			set RQA = 0
			call GBX(WUE)
			call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl", WUE, "origin"))
		endif
		call SaveReal(HY, h, 412, RQA)
		call SaveReal(HY, h, 411, WIE)
	endif
	//if AD > 0 and(GX == 2 or GX == 3) then
	//	call SetUnitToReduceDamage(WUE, RMinBJ(12. * level, GetEventDamage()))
	//endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function MDE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function RPA))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveReal(HY, h, 412, .0)
	call SaveReal(HY, h, 411, GetGameTime())
	set t = null
	set WUE = null
endfunction
function KrakenShellActions takes unit u, unit t returns nothing
	local integer level = GetUnitAbilityLevel(t,'A04E')*(1 -GetUnitAbilityLevel(t,'A36D'))
	// debug call SingleDebug(I2S(level))
	if level == 0 then
		call UnitRemoveAbility(u,'A3LB')
	else
		call AddAbilityToTimed(u,'A3LB', level, 2, 0)
	endif
endfunction
function RTA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call LogoutGroup(LoadGroupHandle(HY, h, 22))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function RUA takes group g returns nothing
	local trigger t = CreateTrigger()
	call SaveGroupHandle(HY, GetHandleId(t), 22,(g))
	call TriggerRegisterTimerEvent(t, 10, false)
	call TriggerAddCondition(t, Condition(function RTA))
	set t = null
endfunction
function NNE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer i = 1
	local real x1 = GetUnitX(u)
	local real y1 = GetUnitY(u)
	local real x2
	local real y2
	local real damage
	local real dur
	local integer lv = GetUnitAbilityLevel(u,'A29I')
	local group g = LoginGroup(399)
	local real r = 725 + lv * 100
	if lv == 1 then
		set dur = 1.5
		set damage = 200
	elseif lv == 2 then
		set dur = 1.8
		set damage = 290
	elseif lv == 3 then
		set dur = 2.25
		set damage = 380
	endif
	loop
	exitwhen i > 16
		set x2 = x1 + r * Cos(22.5 * i * bj_DEGTORAD)
		set y2 = y1 + r * Sin(22.5 * i * bj_DEGTORAD)
		call UnitSpellEffectImpale(u, null, damage, dur, .52, x1, y1, x2, y2, 250, g, false, 775)
		set i = i + 1
	endloop
	call RUA(g)
	set u = null
	set g = null
endfunction
function NCE takes nothing returns nothing
	local group g = LoginGroup(400)
	local unit u = GetTriggerUnit()
	local integer lv = GetUnitAbilityLevel(u,'A226')
	local real dmg = 50 * lv + 25
	local unit fu
	if GetUnitTypeId(u)=='e00E' then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))]
	endif
	set U2 = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 500, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	loop
		set fu = FirstOfGroup(g)
	exitwhen fu == null
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\CrushingWave\\CrushingWaveDamage.mdl", fu, "chest"))
		call UnitDamageTargetEx(u, fu, 2, dmg)
		call AddAbilityToTimed(fu,'A228', 1, 6,'B0E8')
		call UnitMakeAbilityPermanent(fu, true,'A227')
		call GroupRemoveUnit(g, fu)
	endloop
	call LogoutGroup(g)
	set g = null
	set fu = null
	set u = null
endfunction
function RWA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call SetUnitTimeScale(WUE, 1)
	set t = null
	set WUE = null
	return false
endfunction
function K9E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	call TriggerRegisterTimerEvent(t, .3, false)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerAddCondition(t, Condition(function RWA))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SetUnitTimeScale(WUE, 2)
	set t = null
	set WUE = null
endfunction
function RYA takes nothing returns boolean
	return((IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GW)) and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0))
endfunction
function RZA takes nothing returns nothing
	call UnitDamageTargetEx(I_X(GW), GetEnumUnit(), 2, JW)
endfunction
function R_A takes unit WUE, unit targetUnit, real IXX returns nothing
	local group g = LoginGroup(401)
	set GW = WUE
	set JW = IXX
	call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit),$D2, Condition(function RYA))
	call ForGroup(g, function RZA)
	call LogoutGroup(g)
	set g = null
endfunction
function R0A takes nothing returns boolean
	return((IsUnitInGroup(GetFilterUnit(), LW)== false and IsUnitAlly(GetFilterUnit(), GetOwningPlayer(GW)) and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and UnitIsDead(GetFilterUnit())== false and GetFilterUnit()!= MUV))
endfunction
function R1A takes group R2A, unit R3A, unit WUE, unit OriginalTargetreturns returns unit
	local group g = LoginGroup(402)
	local unit R4A = null
	local unit u
	set LW = R2A
	set GW = WUE
	call GroupEnumUnitsInRange(g, GetUnitX(R3A), GetUnitY(R3A), 500, Condition(function R0A))
	set u = FirstOfGroup(g)
	set R4A = u
	loop
	exitwhen u == null
		if GetWidgetLife(u)!= GetUnitState(u, UNIT_STATE_MAX_LIFE) then
			if u != WUE and IsUnitType(u, UNIT_TYPE_HERO) and IsUnitType(R4A, UNIT_TYPE_HERO)== false then
				set R4A = u
			elseif u != WUE and GetWidgetLife(u)< GetWidgetLife(R4A) and IsUnitType(u, UNIT_TYPE_HERO) and IsUnitType(R4A, UNIT_TYPE_HERO) then
				set R4A = u
			elseif u != WUE and IsUnitType(R4A, UNIT_TYPE_HERO)== false and GetWidgetLife(u)< GetWidgetLife(R4A) then
				set R4A = u
			elseif u == WUE then
				set R4A = u
			endif
		endif
		call GroupRemoveUnit(g, u)
		set u = FirstOfGroup(g)
	endloop
	call LogoutGroup(g)
	set g = null
	set u = null
	set Q5V = R4A
	set R4A = null
	return Q5V
endfunction
function NFE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local string R5A = "Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCaster.mdl"
	local string R6A = "origin"
	local unit array R7A
	local integer x
	local integer i = 1
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0OR')
	local real IXX = 60 + level * 20
	local group R8A = LoginGroup(403)
	local integer WOV = level + 2
	local boolean R9A = false
	set MUV = triggerUnit
	call SetWidgetLife(triggerUnit, GetWidgetLife(triggerUnit)+ IXX)
	call R_A(triggerUnit, triggerUnit, IXX)
	call GroupAddUnit(R8A, triggerUnit)
	call AddSpecialEffectTargetToTimed(R5A, triggerUnit, R6A, 2)
	if targetUnit == triggerUnit then
		set R7A[i]= R1A(R8A, triggerUnit, triggerUnit, targetUnit)
	else
		set R7A[i]= targetUnit
	endif
	if R7A[i]== null then
		call LogoutGroup(R8A)
		set triggerUnit = null
		set targetUnit = null
		return
	endif
	call SetWidgetLife(R7A[i], GetWidgetLife(R7A[i])+ IXX)
	call R_A(triggerUnit, R7A[i], IXX)
	call GroupAddUnit(R8A, R7A[i])
	call AddSpecialEffectTargetToTimed(R5A, R7A[i], R6A, 2)
	call AddLightningToTimed("SPLK", GetUnitX(triggerUnit), GetUnitY(triggerUnit), GetUnitX(R7A[i]), GetUnitY(R7A[i]), .3, .5, .9, 1, .7)
	set i = 2
	loop
	exitwhen i > WOV or R9A
		set R7A[i]= R1A(R8A, R7A[i -1], triggerUnit, targetUnit)
		if R7A[i]== null then
			set R9A = true
		else
			call GroupAddUnit(R8A, R7A[i])
			call AddSpecialEffectTargetToTimed(R5A, R7A[i], R6A, 2)
			call SetWidgetLife(R7A[i], GetWidgetLife(R7A[i])+ IXX)
			call R_A(triggerUnit, R7A[i], IXX)
			call AddLightningToTimed("SPLK", GetUnitX(R7A[i -1]), GetUnitY(R7A[i -1]), GetUnitX(R7A[i]), GetUnitY(R7A[i]), .3, .5, .9, 1, .7)
			set i = i + 1
		endif
	endloop
	call LogoutGroup(R8A)
	set R8A = null
	set triggerUnit = null
	set targetUnit = null
endfunction
function IVA takes unit WUE, unit targetUnit, integer level returns nothing
	local unit dummyUnit = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddPermanentAbility(dummyUnit,'A0NJ')
	call SetUnitAbilityLevel(dummyUnit,'A0NJ', level)
	call IssueTargetOrderById(dummyUnit, 852075, targetUnit)
	call UnitRemoveAbility(dummyUnit,'A0NJ')
	set dummyUnit = null
endfunction
function IEA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 0)
	local integer c = GetTriggerEvalCount(t)
	local real IXX = 8 + 6 * level
	local unit dummyUnit = LoadUnitHandle(HY, h, 19)
	if GetUnitAbilityLevel(targetUnit,'A0OW')== 0 or c > 6 then
		call UnitRemoveAbility(targetUnit,'A0OW')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call UnitDamageTargetEx(dummyUnit, targetUnit, 2, IXX)
		if level == 1 then
			if c <= 3 then
				call IVA(WUE, targetUnit, 1)
			endif
		elseif level == 2 then
			if c <= 2 then
				call IVA(WUE, targetUnit, 1)
			elseif c == 3 then
				call IVA(WUE, targetUnit, 2)
			endif
		elseif level == 3 then
			if c <= 3 then
				call IVA(WUE, targetUnit, c)
			endif
		else
			if c < 3 then
				call IVA(WUE, targetUnit, c)
			elseif c == 3 then
				call CommonUnitAddStun(targetUnit, 1., false)
			endif
		endif
	endif
	set dummyUnit = null
	set WUE = null
	set targetUnit = null
	set t = null
endfunction
function IXA takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(U2),'e00E', GetUnitX(W2), GetUnitY(W2), 0)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function IEA))
	call SaveUnitHandle(HY, h, 2, U2)
	call SaveUnitHandle(HY, h, 17, W2)
	call SaveUnitHandle(HY, h, 19, dummyUnit)
	call SaveInteger(HY, h, 0, LoadInteger(HY, GetHandleId(GetTriggeringTrigger()), 5))
	call UnitAddPermanentAbility(W2,'A0OW')
	if GetUnitAbilityLevel(W2,'A3E9')== 1 and LoadBoolean(HY, GetHandleId(GetTriggeringTrigger()), 0)== false and IsMagicImmuneUnit(W2)== false then
		call SaveUnitHandle(VV,'A3E9', 0, W2)
		call SaveUnitHandle(VV,'A3E9', 1, U2)
		call SaveInteger(VV,'A3E9', 0, LoadInteger(HY, GetHandleId(GetTriggeringTrigger()), 5))
		call ExecuteFunc("IOA")
	endif
	call TriggerEvaluate(t)
	set dummyUnit = null
	set t = null
endfunction
function IRA takes unit WJE, unit WLE, integer level, boolean FAR returns nothing
	local trigger t = NHX(WJE, WLE,'e00E', "IXA",$514, true)
	call SaveInteger(HY, GetHandleId(t), 5, level)
	call SaveBoolean(HY, GetHandleId(t), 0, FAR)
	set t = null
endfunction
function NGE takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(WJE,'A0NQ')
	if UnitHasSpellShield(WLE)== false then
		call IRA(WJE, WLE, level, false)
	endif
	set WJE = null
	set WLE = null
endfunction
function IOA takes nothing returns nothing
	local unit WJE = LoadUnitHandle(VV,'A3E9', 0)
	local unit WLE = LoadUnitHandle(VV,'A3E9', 1)
	local integer level = LoadInteger(VV,'A3E9', 0)
	call T4V(LoadUnitHandle(VV,'A3E9', 0))
	if UnitHasSpellShield(WLE)== false then
		call IRA(WJE, WLE, level, true)
	endif
	set WJE = null
	set WLE = null
endfunction
function PGX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A0NJ')
endfunction
function IIA takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local integer HCR = LoadInteger(K, GetHandleId(targetUnit), GetHandleId(GetTriggeringTrigger()))
	if not IsUnitAlly(targetUnit, E3) then
		call LodSystem_AddUnitExtraState(targetUnit, HCR, STATE_SYSTEM_ARMOUR)
	else
		call LodSystem_ReduceUnitExtraState(targetUnit, HCR, STATE_SYSTEM_ARMOUR)
	endif
	call SaveInteger(K, GetHandleId(targetUnit), GetHandleId(GetTriggeringTrigger()), 0)
	set targetUnit = null
endfunction
function IAA takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local integer HCR = R2I(Q2 * S2)
	local integer INA
	if Q2 > 0 then
		set INA = R2I((Q2 -1)* S2)
		if IsUnitAlly(targetUnit, E3)== false then
			call LodSystem_AddUnitExtraState(targetUnit, INA, STATE_SYSTEM_ARMOUR)
		else
			call LodSystem_ReduceUnitExtraState(targetUnit, INA, STATE_SYSTEM_ARMOUR)
		endif
	endif
	if not IsUnitAlly(targetUnit, E3) then
		call LodSystem_ReduceUnitExtraState(targetUnit, HCR, STATE_SYSTEM_ARMOUR)
		call SaveInteger(K, GetHandleId(targetUnit), GetHandleId(GetTriggeringTrigger()), HCR)
	else
		call LodSystem_AddUnitExtraState(targetUnit, HCR, STATE_SYSTEM_ARMOUR)
		call SaveInteger(K, GetHandleId(targetUnit), GetHandleId(GetTriggeringTrigger()), HCR)
	endif

	set targetUnit = null
endfunction
function IBA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local group g =(LoadGroupHandle(HY, h, 22))
	local player p =(LoadPlayerHandle(HY, h, 54))
	local integer EVX = GetTriggerEvalCount(t)
	local integer N5O =(LoadInteger(HY, h,$BC))
	local real HCR = LoadReal(HY, h, 0)
	set E3 = p
	set Q2 = EVX
	set S2 = HCR
	if EVX == N5O then
		call ForGroup(g, function IIA)
		call LogoutGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call ForGroup(g, function IAA)
	endif
	set t = null
	set g = null
	set p = null
	return false
endfunction
function ICA takes nothing returns nothing
	call AddSpecialEffectTargetToTimed("Abilities\\Weapons\\AvengerMissile\\AvengerMissile.mdl", GetEnumUnit(), "chest", 3)
	call AddSpecialEffectTargetToTimed("Abilities\\Weapons\\AvengerMissile\\AvengerMissile.mdl", GetEnumUnit(), "chest", 3)
	call AddSpecialEffectTargetToTimed("Abilities\\Weapons\\AvengerMissile\\AvengerMissile.mdl", GetEnumUnit(), "right hand", 3)
	call AddSpecialEffectTargetToTimed("Abilities\\Weapons\\AvengerMissile\\AvengerMissile.mdl", GetEnumUnit(), "left hand", 3)
endfunction
// 编织
function SpellEffect__Weave takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local group g = LoginGroup(404)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(triggerUnit,'A10Q')
	local integer N5O = 24
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'h007', x, y, 0)
	local integer a = 0
	local boolean isScepterUpgrade = false
	local real HCR = level * .25 + .5
	if level == 0 then
		set level = GetUnitAbilityLevel(triggerUnit,'A1DB')
		set N5O = 20
		set isScepterUpgrade = true
		set HCR = level * .25 + 1.
	endif
	set Q2 = N5O
	set a = 255
	call SetUnitVertexColor(dummyUnit, 255, 255, 255, a)
	call UnitApplyTimedLife(dummyUnit,'BTLF', 5)
	if isScepterUpgrade then
		call GroupEnumUnitsInRange(g, x, y, 800, Condition(function FEX))
	else
		call GroupEnumUnitsInRange(g, x, y, 600, Condition(function FEX))
	endif
	call ForGroup(g, function ICA)
	call SaveGroupHandle(HY, h, 22,(g))
	call SavePlayerHandle(HY, h, 54,(GetOwningPlayer(triggerUnit)))
	call SaveInteger(HY, h,$BC,(N5O))
	call SaveReal(HY, h, 0, HCR)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function IBA))
	call TriggerEvaluate(t)
	set triggerUnit = null
	set g = null
	set t = null
	set dummyUnit = null
endfunction
function IDA takes string ATX, unit targetUnit, unit triggerUnit returns nothing
	local texttag tt = CreateTextTag()
	if GetHandleId(tt)> 0 then
		call SetTextTagText(tt, ATX, .033)
		call SetTextTagPosUnit(tt, targetUnit, 64)
		call SetTextTagColor(tt,$A0, 0, 255, 255)
		call SetTextTagVelocity(tt, 0, .0355)
		call SetTextTagFadepoint(tt, .15)
		call SetTextTagPermanent(tt, false)
		call SetTextTagLifespan(tt, .65)
		call SetTextTagVisibility(tt, IsUnitAlly(triggerUnit, LocalPlayer) or IsObserver)
	else
		call DestroyTextTag(tt)
	endif
	set tt = null
endfunction
function IFA takes real N5O returns string
	if N5O > 4.5 then
		return"5.0"
	elseif N5O > 4. then
		return"4.5"
	elseif N5O > 3.5 then
		return"4.0"
	elseif N5O > 3. then
		return"3.5"
	elseif N5O > 2.5 then
		return"3.0"
	elseif N5O > 2. then
		return"2.5"
	elseif N5O > 1.5 then
		return"2.0"
	elseif N5O > 1. then
		return"1.5"
	elseif N5O > .5 then
		return"1.0"
	elseif N5O > .0 then
		return"0.5"
	else
		return"0.0"
	endif
	return" "
endfunction
function IGA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer EVX = GetTriggerEvalCount(t)
	if EVX >$B then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call IDA(IFA(5.5 -0.5 * EVX), targetUnit, targetUnit)
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function IHA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real IXX =(LoadReal(HY, h, 20))
	local real IJA = RMaxBJ(GetWidgetLife(targetUnit)-IXX, 1)
	local real IKA =(LoadReal(HY,(GetHandleId(targetUnit)),$F3))
	call SetWidgetLife(targetUnit, IJA)
	call SaveReal(HY,(GetHandleId(targetUnit)),$F3,((IKA -IXX)* 1.))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set targetUnit = null
	return false
endfunction
function ILA takes unit targetUnit, real IXX returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real IKA =(LoadReal(HY,(GetHandleId(targetUnit)),$F3))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveReal(HY, h, 20,((IXX)* 1.))
	call SaveReal(HY,(GetHandleId(targetUnit)),$F3,((IKA + IXX)* 1.))
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function IHA))
	set t = null
endfunction
function IMA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit
	local real D0I
	local real IXX
	local integer EVX = GetTriggerEvalCount(t)
	local real IKA
	local real IPA =(LoadReal(HY, h, 389))
	local real IQA =(LoadReal(HY, h, 390))
	if IPA !=(GetGameTime()) then
		set IPA =(GetGameTime())
		set IQA = 0
		call SaveReal(HY, h, 389,((IPA)* 1.))
		call SaveReal(HY, h, 390,((IQA)* 1.))
	endif
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if FK then
			set targetUnit = GetTriggerUnit()
			set IKA =(LoadReal(HY,(GetHandleId(targetUnit)),$F3))
			set D0I = GetWidgetLife(targetUnit)
			set IXX = GetEventDamage()
			if((D0I -IKA -IQA)-IXX)< 1 then
				call SetWidgetLife(targetUnit, D0I + IXX + IQA)
				call ILA(targetUnit, IXX)
			else
				set IQA = IQA + IXX
				call SaveReal(HY, h, 390,((IQA)* 1.))
			endif
		endif
	else
		call SaveInteger(HY,(GetHandleId(((LoadUnitHandle(HY, h, 17))))),($9B5), 2)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call UnitRemoveAbility((LoadUnitHandle(HY, h, 17)),'A21I')
		call UnitRemoveAbility((LoadUnitHandle(HY, h, 17)),'B07D')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set targetUnit = null
	set t = null
	return false
endfunction
function NKE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	call UnitAddPermanentAbility(targetUnit,'A21I')
	call TriggerRegisterTimerEvent(t, 5, false)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function IMA))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\DarkHands.mdx", targetUnit, "overhead")))
	call SaveReal(HY,(GetHandleId(targetUnit)),$F3,(0 * 1.))
	call SaveReal(HY, h, 389,(((GetGameTime()))* 1.))
	call SaveReal(HY, h, 390,(0 * 1.))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY,(GetHandleId((targetUnit))),($9B5), 1)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function IGA))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	set t = null
	set WUE = null
	set targetUnit = null
endfunction
function ISA takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), DK)== false then
		set MWV = CreateUnit(GetOwningPlayer(U2),'e00E', GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()), 0)
		call UnitAddPermanentAbility(MWV,'A17N')
		call SetUnitAbilityLevel(MWV,'A17N', MYV)
		if IssueTargetOrderById(MWV,$D022F, GetEnumUnit())== false then
			call UnitShareVision(GetEnumUnit(), GetOwningPlayer(U2), true)
			call IssueTargetOrderById(MWV,$D022F, GetEnumUnit())
			call UnitShareVision(GetEnumUnit(), GetOwningPlayer(U2), false)
		endif
		call GroupAddUnit(DK, GetEnumUnit())
		set MWV = null
	endif
endfunction
function ITA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local group g =(LoadGroupHandle(HY, h, 22))
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local integer level =(LoadInteger(HY, h, 5))
	local real a =(LoadReal(HY, h, 13))
	local group T7R
	local real x
	local real y
	local real IUA
	local real IWA
	local real J0R = 30
	set MYV = level
	if GetTriggerEvalCount(t)> 28 then
		call LogoutGroup(g)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call ShowUnit(dummyUnit, false)
		call KillUnit(dummyUnit)
	else
		set x = GetUnitX(dummyUnit)
		set y = GetUnitY(dummyUnit)
		set T7R = LoginGroup(405)
		set DK = g
		set U2 = dummyUnit
		set S2 = level * 70
		call GroupEnumUnitsInRange(T7R, x, y, 150, Condition(function DUX))
		call ForGroup(T7R, function ISA)
		call LogoutGroup(T7R)
		set IUA = CoordinateX50(x + J0R * Cos(a * bj_DEGTORAD))
		set IWA = CoordinateY50(y + J0R * Sin(a * bj_DEGTORAD))
		call SetUnitX(dummyUnit, IUA)
		call SetUnitY(dummyUnit, IWA)
	endif
	set t = null
	set g = null
	set T7R = null
	set dummyUnit = null
	return false
endfunction
function NLE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local group g = LoginGroup(406)
	local unit triggerUnit = GetTriggerUnit()
	local real x1 = GetUnitX(triggerUnit)
	local real y1 = GetUnitY(triggerUnit)
	local real x2 = GetSpellTargetX()
	local real y2 = GetSpellTargetY()
	local real a = AngleBetweenXY(x1, y1, x2, y2)
	local integer level = GetUnitAbilityLevel(triggerUnit,'A173')
	local unit dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'h07K', x1, y1, a)
	call PlaySoundAtPoint(GE, x1, y1)
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveGroupHandle(HY, h, 22,(g))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call TriggerRegisterTimerEvent(t, .025, true)
	call TriggerAddCondition(t, Condition(function ITA))
	set t = null
	set dummyUnit = null
	set g = null
	set triggerUnit = null
endfunction
function IYA takes nothing returns nothing
	call ShowUnit(GetTriggerUnit(), false)
	call DestroyTrigger(GetTriggeringTrigger())
endfunction
function IZA takes nothing returns nothing
	local integer id = GetUnitTypeId(GetSummonedUnit())
	local integer level
	local trigger t
	local integer h
	local unit u
	if id =='o00T' or id =='o00U' or id =='o00V' or id =='o00W' then
		set u = GetSummonedUnit()
		set t = CreateTrigger()
		call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
		call TriggerAddCondition(t, Condition(function IYA))
		set t = null
		set level = id -'o00T'
		if level > 0 then
			call UnitAddPermanentAbility(u,'QVEN')
			call SetUnitAbilityLevel(u,'QVEN', level)
		endif
		if RectContainsUnit(XO, u) then
			call UnitAddAbility(u,'Aeth')
		endif
		if GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A0A8')> 0 then
			call UnitAddPermanentAbilitySetLevel(u,'A3JB', GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A0A8'))
		endif
		set u = null
	endif
endfunction
function M9X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function IZA))
	set t = null
	set XO = Rect(-$450,-7248,-$5C2,-6668)
endfunction
function I_A takes unit R8X, unit WLE, real ZCE returns nothing
	if GetWidgetLife(WLE)> ZCE then
		call UnitDamageTargetEx(R8X, WLE, 1, ZCE)
	else
		call UnitDamageTargetEx(R8X, WLE, 1, RMaxBJ(GetWidgetLife(WLE)-1, 0))
	endif
endfunction
function Veno_PoisonNova_Act takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit d
	local integer i = 1
	local real radian
	local real x
	local real y
	local real dx
	local real dy
	local real SYV = LoadReal(HY, h, 0)
	if LoadInteger(HY, h, 0)> 50 * SYV then
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
		set t = null
		return
	endif
	loop
		set d = LoadUnitHandle(HY, h, i)
		set x = GetUnitX(d)
		set y = GetUnitY(d)
		set radian = i * 20 * bj_DEGTORAD
		set dx = CoordinateX50(x +$A* Cos(radian))
		set dy = CoordinateY50(y +$A* Sin(radian))
		call SetUnitX(d, dx)
		call SetUnitY(d, dy)
		set i = i + 1
	exitwhen i > 18
	endloop
	call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)+ 1)
	set d = null
	set t = null
endfunction
function I0A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit YTR
	local unit SZX = LoadUnitHandle(HY, h, 2)
	local integer SYV = LoadInteger(HY, h, 0)
	local unit I1A
	if UnitIsDead(SZX) or SYV < 1 or GetUnitAbilityLevel(SZX,'A42O')== 0 then
		call RemoveSavedHandle(P, GetHandleId(SZX),'A0A6')
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
		call UnitRemoveAbility(SZX,'A42O')
		call UnitRemoveAbility(SZX,'B028')
	else
		set YTR = LoadUnitHandle(HY, h, 0)
		set I1A = LoadUnitHandle(HY, h, 1)
		if UnitIsDead(YTR) and YTR != I1A then
			set YTR = I1A
		endif
		call I_A(YTR, SZX, LoadReal(HY, h, 0))
		call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)-1)
	endif
	set I1A = null
	set YTR = null
	set SZX = null
	set t = null
endfunction
function I2A takes unit WJE, unit u, real ZCE, real SYV, boolean b returns nothing
	local timer t
	local integer h
	if HaveSavedHandle(P, GetHandleId(u),'A0A6') then
		set t = LoadTimerHandle(P, GetHandleId(u),'A0A6')
		set h = GetHandleId(t)
		call SaveInteger(HY, h, 0, R2I(SYV))
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, 1, true, function I0A)
		call SaveReal(HY, h, 0, ZCE)
		call SaveInteger(HY, h, 0, R2I(SYV))
		call SaveUnitHandle(HY, h, 0, WJE)
		call SaveUnitHandle(HY, h, 2, u)
		call SaveUnitHandle(HY, h, 1, Player__Hero[GetPlayerId(GetOwningPlayer(WJE))])
		call SaveTimerHandle(P, GetHandleId(u),'A0A6', t)
		call UnitAddPermanentAbility(u,'A42O')
		if b and IsUnitType(u, UNIT_TYPE_HERO) then
			call CXR(u, SYV)
		endif
	endif
	set t = null
endfunction
function I3A takes nothing returns boolean
	return(IsAliveNotStrucNotWard(GetFilterUnit()) and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(U2)) and IsUnitInGroup(GetFilterUnit(), LB)== false and IsUnitType(GetFilterUnit(), UNIT_TYPE_MECHANICAL)== false)!= null
endfunction
function I4A takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local group g2 = LoadGroupHandle(HY, h, 1)
	local group g = LoginGroup(407)
	local integer c = GetTriggerEvalCount(t)
	local unit u2
	if c > 23 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call LogoutGroup(g2)
	else
		set U2 = u
		set LB = g2
		call GroupEnumUnitsInRange(g, LoadReal(HY, h, 1), LoadReal(HY, h, 2), 25 * c +$FF, Condition(function I3A))
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			call GroupAddUnit(g2, u2)
			call I2A(u, u2, LoadReal(HY, h, 0), 16, LoadBoolean(HY, h, 0))
			call GroupRemoveUnit(g, u2)
		endloop
	endif
	call LogoutGroup(g)
	set u = null
	set u2 = null
	set t = null
	set g = null
	set g2 = null
endfunction
function NPE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer lv = GetUnitAbilityLevel(u, GetSpellAbilityId())
	local boolean b = GetSpellAbilityId()=='A0A6'
	local real dmg
	local integer i = 1
	local unit d
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	loop
	exitwhen i > 18
		set d = CreateUnit(GetOwningPlayer(u),'e017', x, y, 0)
		call IssuePointOrderById(d, 851986, x + 675 * Cos(i * 20 * bj_DEGTORAD), y + 675 * Sin(i * 20 * bj_DEGTORAD))
		call UnitApplyTimedLife(d,'BTLF', 1.15)
		set i = i + 1
	endloop
	if b then
		set dmg = 35 + 25 * lv
	else
		set dmg = 5 + 25 * lv
	endif
	call SetUnitAnimation(u, "attack")
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function I4A))
	call SaveUnitHandle(HY, h, 0, u)
	call SaveGroupHandle(HY, h, 1, LoginGroup(408))
	call SaveReal(HY, h, 0, dmg)
	call SaveReal(HY, h, 1, x)
	call SaveReal(HY, h, 2, y)
	call SaveBoolean(HY, h, 0, b)
	set t = null
	set u = null
	set d = null
endfunction
function I5A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	call LodSystem_ReduceUnitExtraState(LoadUnitHandle(P, WFV, 0), LoadInteger(P, WFV, 0), STATE_SYSTEM_DAMAGE)
	call SaveBoolean(P, LoadInteger(P, WFV, 1),'A1A3', false)
	call DestroyTimerAndFlushHT_P(t)
	set t = null
endfunction
function I6A takes unit u, unit d, integer WUV returns nothing
	local timer t = CreateTimer()
	local integer WFV = GetHandleId(t)
	local integer O3O = 0
	local real dr = 2.5 * WUV
	local real r = 100 * GetWidgetLife(d)/ GetUnitState(d, UNIT_STATE_MAX_LIFE)
	if r > 80 then
	elseif r > 60 then
		set dr = dr * 2
	elseif r > 40 then
		set dr = dr * 4
	elseif r > 20 then
		set dr = dr * 8
	else
		set dr = dr * 16
	endif
	if IsUnitIdType(GetUnitTypeId(d), UNIT_TYPE_HERO)== false and IsUnitType(d, UNIT_TYPE_STRUCTURE)== false then
		set dr = dr / 2
	endif
	set O3O = R2I(dr)
	call LodSystem_AddUnitExtraState(u, O3O, STATE_SYSTEM_DAMAGE)
	call SaveUnitHandle(P, WFV, 0, u)
	call SaveInteger(P, WFV, 0, O3O)
	call SaveInteger(P, WFV, 1, GetHandleId(u))
	call SaveBoolean(P, GetHandleId(u),'A1A3', true)
	call TimerStart(t, .5, false, function I5A)
	set t = null
endfunction
function NethertoxinActions takes unit R8X, unit WLE returns nothing
	local integer WUV = GetUnitAbilityLevel(R8X,'A1A3')*(1 -GetUnitAbilityLevel(R8X,'A36D'))
	if WUV == 0 or LoadBoolean(P, GetHandleId(R8X),'A1A3') then
		return
	endif
	if IsUnitEnemy(R8X, GetOwningPlayer(WLE)) then
		call I6A(R8X, WLE, WUV)
	endif
endfunction
function I8A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 5)
	local real MSI = LoadReal(HY, GetHandleId(targetUnit), 684)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or MSI <(GetGameTime()) or IsMagicImmuneUnit(targetUnit) then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SaveReal(HY, GetHandleId(targetUnit), 684, .0)
		call UnitRemoveAbility(targetUnit,'A23S')
		call UnitRemoveAbility(targetUnit,'A23P')
		call UnitRemoveAbility(targetUnit,'A23Q')
		call UnitRemoveAbility(targetUnit,'A23R')
		call UnitRemoveAbility(targetUnit,'B0EA')
	else
		set OB = true
		call UnitDamageTargetEx(WUE, targetUnit, 1, 5 + 5 * level)
		set OB = false
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function I9A takes nothing returns nothing
	local trigger t
	local integer h
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetEventDamageSource()
	local real MSI = LoadReal(HY, GetHandleId(targetUnit), 684)
	local integer level = GetUnitAbilityLevel(WUE,'A0MM')
	if MSI <=(GetGameTime()) then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function I8A))
		call SaveUnitHandle(HY, h, 2, WUE)
		call SaveUnitHandle(HY, h, 17, targetUnit)
		call SaveInteger(HY, h, 5, level)
		if DVX(targetUnit)== false then
			if level == 1 then
				call UnitAddPermanentAbility(targetUnit,'A23S')
			elseif level == 2 then
				call UnitAddPermanentAbility(targetUnit,'A23P')
			elseif level == 3 then
				call UnitAddPermanentAbility(targetUnit,'A23Q')
			elseif level == 4 then
				call UnitAddPermanentAbility(targetUnit,'A23R')
			endif
		endif
	endif
	call SaveReal(HY, GetHandleId(targetUnit), 684, GetGameTime()+ 4)
	set t = null
	set WUE = null
	set targetUnit = null
endfunction
function AVA takes nothing returns boolean
	if GetUnitAbilityLevel(GetTriggerUnit(),'A0MM')> 0 and IsAliveNotStrucNotWard(GetEventDamageSource()) and IsUnitEnemy(GetEventDamageSource(), GetOwningPlayer(GetTriggerUnit())) and IsMagicImmuneUnit(GetEventDamageSource())== false and GetDistanceBetweenUnits(GetEventDamageSource(), GetTriggerUnit())<=$578 then
		if GetUnitAbilityLevel(GetTriggerUnit(),'A36D')== 0 and OB == false then
			call I9A()
		endif
	endif
	return false
endfunction
function LearnSkill__CorrosiveSkin takes nothing returns nothing
	local trigger t
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u, 'A0MM')
	if level == 1 then
		set t = CreateTrigger()
		call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(t, Condition(function AVA))
		set t = null
		if not IsUnitBreak(u) then
			call AddUnitMagicResistance(u, 0.05 + level * 0.05)
		endif
	elseif not IsUnitBreak(u) then
		call ReduceUnitMagicResistance(u, 0.05 + ( level - 1 ) * 0.05)
		call AddUnitMagicResistance(u, 0.05 + level * 0.05)
	endif
	set u = null
endfunction
function AEA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit IZX = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	if UnitIsDead(WLE) or GetUnitAbilityLevel(WLE,'B06D')== 0 then
		call RemoveSavedHandle(HY, LoadInteger(HY, h,-1),'A09V')
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	else
		call UnitDamageTargetEx(IZX, WLE, 1, 8 + 6 * LoadInteger(HY, h, 0))
	endif
	set IZX = null
	set WLE = null
	set t = null
endfunction
function PoisonAttackActions takes unit R8X, unit WLE returns nothing
	local timer t
	local integer h
	local integer hu = GetHandleId(WLE)
	if HaveSavedHandle(HY, hu,'A09V') then
		set t = LoadTimerHandle(HY, hu,'A09V')
		set h = GetHandleId(t)
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveTimerHandle(HY, hu,'A09V', t)
		call TimerStart(t, 1, true, function AEA)
		call SaveUnitHandle(HY, h, 0, R8X)
		call SaveUnitHandle(HY, h, 1, WLE)
		call SaveInteger(HY, h,-1, hu)
	endif
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(R8X,'A09V'))
	set t = null
endfunction
function NYE takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetUnitFacing(GetTriggerUnit()))
	call UnitAddAbility(d,'A3IF')
	call SetUnitAbilityLevel(d,'A3IF', GetUnitAbilityLevel(GetTriggerUnit(),'A080'))
	call UnitRemoveAbility(GetSpellTargetUnit(),'BEsh')
	call UnitRemoveAbility(GetSpellTargetUnit(),'B0AQ')
	call IssueTargetOrderById(d,$D022F, GetSpellTargetUnit())
	set d = null
endfunction
function NQE takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetUnitFacing(GetTriggerUnit()))
	call UnitAddAbility(d,'A3IG')
	call SetUnitAbilityLevel(d,'A3IG', GetUnitAbilityLevel(GetTriggerUnit(),'A1UZ'))
	call UnitRemoveAbility(GetSpellTargetUnit(),'BEsh')
	call UnitRemoveAbility(GetSpellTargetUnit(),'B0AQ')
	call IssueTargetOrderById(d,$D022F, GetSpellTargetUnit())
	set d = null
endfunction
function GraveChillOff takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	call LodSystem_ReduceUnitExtraState(u, 64, STATE_SYSTEM_ATTACK)
	call J8X(u, 32)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set u = null
	set t = null
endfunction
function AOA takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(WJE,'A08X')
	call AddAbilityToTimed(WJE,'A3KH', 1, 2 + level,'B3KH')
	set WJE = null
endfunction
function N_E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call AOA()
	endif
endfunction
function LearnSkill__GravekeeperCloak takes nothing returns nothing
	local unit whichUnit = GetTriggerUnit()
	local integer level = GetLearnedSkillLevel()
	set HaveGravekeeperCloak = true
	if level == 1 then
		call SaveInteger(ExtraHT, GetHandleId(whichUnit), 'A0VX', 4)
	endif
	set whichUnit = null
endfunction

function ADA takes nothing returns nothing
	local integer level
	local unit WUE = GetTriggerUnit()
	local unit dummyUnit
	if GetUnitTypeId(WUE)=='u017' or GetUnitTypeId(WUE)=='u019' or GetUnitTypeId(WUE)=='u018' or GetUnitTypeId(WUE)=='u01A' or GetUnitTypeId(WUE)=='u01B' or GetUnitTypeId(WUE)=='u01C' or GetUnitTypeId(WUE)=='u01U' or GetUnitTypeId(WUE)=='u01V' or GetUnitTypeId(WUE)=='u01W' then
		return
	endif
	set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(WUE), GetUnitY(WUE), 0)
	if GetUnitTypeId(WUE)=='u014' or GetUnitTypeId(WUE)=='u01D' or GetUnitTypeId(WUE)=='u01R' then
		set level = 1
	elseif GetUnitTypeId(WUE)=='u015' or GetUnitTypeId(WUE)=='u01E' or GetUnitTypeId(WUE)=='u01S' then
		set level = 2
	else
		set level = 3
	endif
	call UnitAddPermanentAbility(dummyUnit,'A1NF')
	call SetUnitAbilityLevel(dummyUnit,'A1NF', level)
	call IssueImmediateOrderById(dummyUnit,$D009F)
	set WUE = null
	set dummyUnit = null
endfunction
function AFA takes unit AGA, integer Y2X, integer level returns nothing
	local integer AHA
	if level == 1 then
		set AHA = 8
	elseif level == 2 then
		set AHA =$E
	elseif level == 3 then
		set AHA = 22
	endif
	call J9X(AGA, Y2X * AHA)
endfunction
function AJA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit AGA =(LoadUnitHandle(HY, h, 2))
	local unit WUE = AGA
	local integer level =(LoadInteger(HY, h, 5))
	local integer S4R =(LoadInteger(HY, h, 28))
	local integer Y2X =(LoadInteger(HY, h,$C2))
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_PLAYER_UNIT_ATTACKED then
		if GetAttacker()== AGA then
			set Y2X = IMaxBJ(Y2X -1, 0)
			call SaveInteger(HY, h,$C2,(Y2X))
			call AFA(AGA, Y2X, level)
		endif
	else
		set S4R = S4R + 1
		call SaveInteger(HY, h, 28,(S4R))
		if ModuloInteger(S4R, 15)== 0 then
			set Y2X = IMinBJ(Y2X + 1, 7)
			call SaveInteger(HY, h,$C2,(Y2X))
		endif
		if GetUnitTypeId(WUE)=='u017' or GetUnitTypeId(WUE)=='u019' or GetUnitTypeId(WUE)=='u018' or GetUnitTypeId(WUE)=='u01A' or GetUnitTypeId(WUE)=='u01B' or GetUnitTypeId(WUE)=='u01C' or GetUnitTypeId(WUE)=='u01U' or GetUnitTypeId(WUE)=='u01V' or GetUnitTypeId(WUE)=='u01W' then
			set Y2X = 7
			call SaveInteger(HY, h,$C2,(Y2X))
		endif
		call AFA(AGA, Y2X, level)
		if GetUnitTypeId(AGA)=='u017' or GetUnitTypeId(AGA)=='u019' or GetUnitTypeId(AGA)=='u018' or GetUnitTypeId(AGA)=='u01A' or GetUnitTypeId(AGA)=='u01B' or GetUnitTypeId(AGA)=='u01C' or GetUnitTypeId(AGA)=='u01U' or GetUnitTypeId(AGA)=='u01V' or GetUnitTypeId(AGA)=='u01W' then
			call SetWidgetLife(AGA, GetWidgetLife(AGA)+ 31.25 + 18.75 * level)
		endif
	endif
	set t = null
	set AGA = null
	set WUE = null
	return false
endfunction
function AKA takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='u014' or GetUnitTypeId(GetFilterUnit())=='u015' or GetUnitTypeId(GetFilterUnit())=='u016' or GetUnitTypeId(GetFilterUnit())=='u01D' or GetUnitTypeId(GetFilterUnit())=='u01E' or GetUnitTypeId(GetFilterUnit())=='u01F' or GetUnitTypeId(GetFilterUnit())=='u01R' or GetUnitTypeId(GetFilterUnit())=='u01S' or GetUnitTypeId(GetFilterUnit())=='u01T' or GetUnitTypeId(GetFilterUnit())=='u017' or GetUnitTypeId(GetFilterUnit())=='u019' or GetUnitTypeId(GetFilterUnit())=='u018' or GetUnitTypeId(GetFilterUnit())=='u01A' or GetUnitTypeId(GetFilterUnit())=='u01B' or GetUnitTypeId(GetFilterUnit())=='u01C' or GetUnitTypeId(GetFilterUnit())=='u01U' or GetUnitTypeId(GetFilterUnit())=='u01V' or GetUnitTypeId(GetFilterUnit())=='u01W' then
		call KillUnit(GetFilterUnit())
	endif
	return false
endfunction
function N0E takes nothing returns nothing
	local group g = LoginGroup(409)
	local unit WUE = GetTriggerUnit()
	local real x = GetUnitX(WUE)
	local real y = GetUnitY(WUE)
	local integer level = GetUnitAbilityLevel(WUE,'A1NE')
	local unit ALA
	local unit AMA
	local unit APA = null
	local trigger t
	local integer h
	local boolean FKI = false
	local integer i
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(WUE), Condition(function AKA))
	call LogoutGroup(g)
	if level == 0 then
		set level = GetUnitAbilityLevel(WUE,'A2IG')
		set FKI = true
	endif
	if level == 1 then
		set ALA = CreateUnit(GetOwningPlayer(WUE),'u014', x + 75, y + 75, GetUnitFacing(WUE))
		set AMA = CreateUnit(GetOwningPlayer(WUE),'u01D', x -75, y -75, GetUnitFacing(WUE))
	elseif level == 2 then
		set ALA = CreateUnit(GetOwningPlayer(WUE),'u015', x + 75, y + 75, GetUnitFacing(WUE))
		set AMA = CreateUnit(GetOwningPlayer(WUE),'u01E', x -75, y -75, GetUnitFacing(WUE))
	elseif level == 3 then
		set ALA = CreateUnit(GetOwningPlayer(WUE),'u016', x + 75, y + 75, GetUnitFacing(WUE))
		set AMA = CreateUnit(GetOwningPlayer(WUE),'u01F', x -75, y -75, GetUnitFacing(WUE))
	endif
	set i = GetUnitAbilityLevel(WUE,'A0A8')
	call SelectUnitAddForPlayer(ALA, GetOwningPlayer(WUE))
	call SelectUnitAddForPlayer(AMA, GetOwningPlayer(WUE))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", ALA, "origin"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", AMA, "origin"))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterDeathEvent(t, ALA)
	call TriggerAddCondition(t, Condition(function AJA))
	call SaveUnitHandle(HY, h, 2,(ALA))
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY, h, 28, 0)
	call SaveInteger(HY, h,$C2, 7)
	call AFA(ALA, 7, level)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterDeathEvent(t, AMA)
	call TriggerAddCondition(t, Condition(function AJA))
	call SaveUnitHandle(HY, h, 2,(AMA))
	call SaveInteger(HY, h, 5,(level))
	call SaveInteger(HY, h, 28, 0)
	call SaveInteger(HY, h,$C2, 7)
	call AFA(AMA, 7, level)
	if FKI then
		if level == 1 then
			set APA = CreateUnit(GetOwningPlayer(WUE),'u01R', x + 75, y, GetUnitFacing(WUE))
		elseif level == 2 then
			set APA = CreateUnit(GetOwningPlayer(WUE),'u01S', x + 75, y, GetUnitFacing(WUE))
		elseif level == 3 then
			set APA = CreateUnit(GetOwningPlayer(WUE),'u01T', x + 75, y, GetUnitFacing(WUE))
		endif
		call SelectUnitAddForPlayer(APA, GetOwningPlayer(WUE))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", APA, "origin"))
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerRegisterDeathEvent(t, APA)
		call TriggerAddCondition(t, Condition(function AJA))
		call SaveUnitHandle(HY, h, 2,(APA))
		call SaveInteger(HY, h, 5,(level))
		call SaveInteger(HY, h, 28, 0)
		call SaveInteger(HY, h,$C2, 7)
		call AFA(APA, 7, level)
	endif
	if i > 0 then
		call RGX(ALA, i)
		call RGX(AMA, i)
		call RGX(APA, i)
	endif
	set g = null
	set WUE = null
	set ALA = null
	set AMA = null
	set APA = null
	set t = null
endfunction
function AQA takes nothing returns boolean
	if GetSpellAbilityId()=='A1NB' or GetSpellAbilityId()=='A1NC' or GetSpellAbilityId()=='A1ND' or GetSpellAbilityId()=='A1NL' or GetSpellAbilityId()=='A1NM' or GetSpellAbilityId()=='A1NN' or GetSpellAbilityId()=='A2IZ' or GetSpellAbilityId()=='A2J0' or GetSpellAbilityId()=='A2J1' then
		call ADA()
	endif
	return false
endfunction
function PEX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function AQA))
	set t = null
endfunction
function ASA takes unit WUE, integer CHO, integer ATA returns nothing
	local string c1 = "|c0000cc00"
	local string c = "||"
	local string p = " "
	local string s = c1 + "|||r"
	local string JVX
	local texttag tt =(LoadTextTagHandle(HY,(GetHandleId(WUE)), 451))
	if CHO == 0 then
		set JVX = " "
	elseif ATA == 1 then
		if CHO == 0 then
			set JVX = c + p + c + p + c
		elseif CHO == 1 then
			set JVX = s + p + c + p + c
		elseif CHO == 2 then
			set JVX = s + p + s + p + c
		elseif CHO == 3 then
			set JVX = s + p + s + p + s
		endif
	elseif ATA == 2 then
		if CHO == 0 then
			set JVX = c + p + c + p + c + p + c
		elseif CHO == 1 then
			set JVX = s + p + c + p + c + p + c
		elseif CHO == 2 then
			set JVX = s + p + s + p + c + p + c
		elseif CHO == 3 then
			set JVX = s + p + s + p + s + p + c
		elseif CHO == 4 then
			set JVX = s + p + s + p + s + p + s
		endif
	elseif ATA == 3 then
		if CHO == 0 then
			set JVX = c + p + c + p + c + p + c + p + c
		elseif CHO == 1 then
			set JVX = s + p + c + p + c + p + c + p + c
		elseif CHO == 2 then
			set JVX = s + p + s + p + c + p + c + p + c
		elseif CHO == 3 then
			set JVX = s + p + s + p + s + p + c + p + c
		elseif CHO == 4 then
			set JVX = s + p + s + p + s + p + s + p + c
		elseif CHO == 5 then
			set JVX = s + p + s + p + s + p + s + p + s
		endif
	elseif ATA == 4 then
		if CHO == 0 then
			set JVX = c + p + c + p + c + p + c + p + c + p + c
		elseif CHO == 1 then
			set JVX = s + p + c + p + c + p + c + p + c + p + c
		elseif CHO == 2 then
			set JVX = s + p + s + p + c + p + c + p + c + p + c
		elseif CHO == 3 then
			set JVX = s + p + s + p + s + p + c + p + c + p + c
		elseif CHO == 4 then
			set JVX = s + p + s + p + s + p + s + p + c + p + c
		elseif CHO == 5 then
			set JVX = s + p + s + p + s + p + s + p + s + p + c
		elseif CHO == 6 then
			set JVX = s + p + s + p + s + p + s + p + s + p + s
		endif
	endif
	call SetTextTagText(tt, JVX, .023)
	call SetTextTagPosUnit(tt, WUE, 0)
	call SetTextTagVisibility(tt, GetOwningPlayer(WUE)== LocalPlayer and UnitIsDead(WUE)== false)
	call SetTextTagPermanent(tt, true)
	set tt = null
endfunction
function AUA takes unit triggerUnit, integer level returns nothing
	local integer ATA = GetUnitAbilityLevel(triggerUnit,'A1NA')
	call ASA(triggerUnit, level, ATA)
	if level == 0 or((LoadInteger(HY,(GetHandleId((triggerUnit))),($9B4)))== 1) then
		call UnitRemoveAbility(triggerUnit,'A1O7')
		call UnitRemoveAbility(triggerUnit,'A1O8')
		call UnitRemoveAbility(triggerUnit,'A1O9')
		call UnitAddPermanentAbility(triggerUnit,'A1O1')
		call UnitRemoveAbility(triggerUnit,'A1O2')
		call UnitRemoveAbility(triggerUnit,'A1NZ')
		call UnitRemoveAbility(triggerUnit,'A1N9')
		call UnitRemoveAbility(triggerUnit,'A1NY')
		call UnitRemoveAbility(triggerUnit,'A1O0')
		call UnitRemoveAbility(triggerUnit,'A1O3')
		call UnitRemoveAbility(triggerUnit,'A0LR')
		call UnitRemoveAbility(triggerUnit,'A0YP')
		call UnitRemoveAbility(triggerUnit,'A0OG')
		call UnitRemoveAbility(triggerUnit,'A0YO')
		call UnitRemoveAbility(triggerUnit,'A0NF')
		call UnitRemoveAbility(triggerUnit,'A0MD')
	elseif level == 1 then
		call UnitRemoveAbility(triggerUnit,'A1O7')
		call UnitRemoveAbility(triggerUnit,'A1O8')
		call UnitRemoveAbility(triggerUnit,'A1O9')
		call UnitRemoveAbility(triggerUnit,'A1O1')
		call UnitAddPermanentAbility(triggerUnit,'A1O2')
		call UnitRemoveAbility(triggerUnit,'A1NZ')
		call UnitRemoveAbility(triggerUnit,'A1N9')
		call UnitRemoveAbility(triggerUnit,'A1NY')
		call UnitRemoveAbility(triggerUnit,'A1O0')
		call UnitRemoveAbility(triggerUnit,'A1O3')
		call UnitAddPermanentAbility(triggerUnit,'A0LR')
		call UnitRemoveAbility(triggerUnit,'A0YP')
		call UnitRemoveAbility(triggerUnit,'A0OG')
		call UnitRemoveAbility(triggerUnit,'A0YO')
		call UnitRemoveAbility(triggerUnit,'A0NF')
		call UnitRemoveAbility(triggerUnit,'A0MD')
	elseif level == 2 then
		call UnitRemoveAbility(triggerUnit,'A1O7')
		call UnitRemoveAbility(triggerUnit,'A1O8')
		call UnitRemoveAbility(triggerUnit,'A1O9')
		call UnitRemoveAbility(triggerUnit,'A1O1')
		call UnitRemoveAbility(triggerUnit,'A1O2')
		call UnitAddPermanentAbility(triggerUnit,'A1NZ')
		call UnitRemoveAbility(triggerUnit,'A1N9')
		call UnitRemoveAbility(triggerUnit,'A1NY')
		call UnitRemoveAbility(triggerUnit,'A1O0')
		call UnitRemoveAbility(triggerUnit,'A1O3')
		call UnitRemoveAbility(triggerUnit,'A0LR')
		call UnitAddPermanentAbility(triggerUnit,'A0YP')
		call UnitRemoveAbility(triggerUnit,'A0OG')
		call UnitRemoveAbility(triggerUnit,'A0YO')
		call UnitRemoveAbility(triggerUnit,'A0NF')
		call UnitRemoveAbility(triggerUnit,'A0MD')
	elseif level == 3 then
		call UnitRemoveAbility(triggerUnit,'A1O7')
		call UnitRemoveAbility(triggerUnit,'A1O8')
		call UnitRemoveAbility(triggerUnit,'A1O9')
		call UnitRemoveAbility(triggerUnit,'A0LR')
		call UnitRemoveAbility(triggerUnit,'A0YP')
		call UnitAddPermanentAbility(triggerUnit,'A0OG')
		call UnitRemoveAbility(triggerUnit,'A0YO')
		call UnitRemoveAbility(triggerUnit,'A0NF')
		call UnitRemoveAbility(triggerUnit,'A0MD')
		call UnitRemoveAbility(triggerUnit,'A1O1')
		call UnitRemoveAbility(triggerUnit,'A1O2')
		call UnitRemoveAbility(triggerUnit,'A1NZ')
		call UnitRemoveAbility(triggerUnit,'A1N9')
		call UnitRemoveAbility(triggerUnit,'A1NY')
		call UnitRemoveAbility(triggerUnit,'A1O0')
		call UnitRemoveAbility(triggerUnit,'A1O3')
		if ATA == 1 then
			call UnitAddPermanentAbility(triggerUnit,'A1O7')
		else
			call UnitAddPermanentAbility(triggerUnit,'A1N9')
		endif
	elseif level == 4 then
		call UnitRemoveAbility(triggerUnit,'A1O7')
		call UnitRemoveAbility(triggerUnit,'A1O8')
		call UnitRemoveAbility(triggerUnit,'A1O9')
		call UnitRemoveAbility(triggerUnit,'A0LR')
		call UnitRemoveAbility(triggerUnit,'A0YP')
		call UnitRemoveAbility(triggerUnit,'A0OG')
		call UnitAddPermanentAbility(triggerUnit,'A0YO')
		call UnitRemoveAbility(triggerUnit,'A0NF')
		call UnitRemoveAbility(triggerUnit,'A0MD')
		call UnitRemoveAbility(triggerUnit,'A1O1')
		call UnitRemoveAbility(triggerUnit,'A1O2')
		call UnitRemoveAbility(triggerUnit,'A1NZ')
		call UnitRemoveAbility(triggerUnit,'A1N9')
		call UnitRemoveAbility(triggerUnit,'A1NY')
		call UnitRemoveAbility(triggerUnit,'A1O0')
		call UnitRemoveAbility(triggerUnit,'A1O3')
		if ATA == 2 then
			call UnitAddPermanentAbility(triggerUnit,'A1O8')
		else
			call UnitAddPermanentAbility(triggerUnit,'A1NY')
		endif
	elseif level == 5 then
		call UnitRemoveAbility(triggerUnit,'A1O7')
		call UnitRemoveAbility(triggerUnit,'A1O8')
		call UnitRemoveAbility(triggerUnit,'A1O9')
		call UnitRemoveAbility(triggerUnit,'A1O1')
		call UnitRemoveAbility(triggerUnit,'A1O2')
		call UnitRemoveAbility(triggerUnit,'A1NZ')
		call UnitRemoveAbility(triggerUnit,'A1N9')
		call UnitRemoveAbility(triggerUnit,'A1NY')
		call UnitAddPermanentAbility(triggerUnit,'A1O0')
		call UnitRemoveAbility(triggerUnit,'A1O3')
		call UnitRemoveAbility(triggerUnit,'A0LR')
		call UnitRemoveAbility(triggerUnit,'A0YP')
		call UnitRemoveAbility(triggerUnit,'A0OG')
		call UnitRemoveAbility(triggerUnit,'A0YO')
		call UnitAddPermanentAbility(triggerUnit,'A0NF')
		call UnitRemoveAbility(triggerUnit,'A0MD')
		call UnitRemoveAbility(triggerUnit,'A1O1')
		call UnitRemoveAbility(triggerUnit,'A1O2')
		call UnitRemoveAbility(triggerUnit,'A1NZ')
		call UnitRemoveAbility(triggerUnit,'A1N9')
		call UnitRemoveAbility(triggerUnit,'A1NY')
		call UnitRemoveAbility(triggerUnit,'A1O0')
		call UnitRemoveAbility(triggerUnit,'A1O3')
		if ATA == 3 then
			call UnitAddPermanentAbility(triggerUnit,'A1O9')
		else
			call UnitAddPermanentAbility(triggerUnit,'A1O0')
		endif
	elseif level == 6 then
		call UnitRemoveAbility(triggerUnit,'A1O7')
		call UnitRemoveAbility(triggerUnit,'A1O8')
		call UnitRemoveAbility(triggerUnit,'A1O9')
		call UnitRemoveAbility(triggerUnit,'A1O1')
		call UnitRemoveAbility(triggerUnit,'A1O2')
		call UnitRemoveAbility(triggerUnit,'A1NZ')
		call UnitRemoveAbility(triggerUnit,'A1N9')
		call UnitRemoveAbility(triggerUnit,'A1NY')
		call UnitRemoveAbility(triggerUnit,'A1O0')
		call UnitAddPermanentAbility(triggerUnit,'A1O3')
		call UnitRemoveAbility(triggerUnit,'A0LR')
		call UnitRemoveAbility(triggerUnit,'A0YP')
		call UnitRemoveAbility(triggerUnit,'A0OG')
		call UnitRemoveAbility(triggerUnit,'A0YO')
		call UnitRemoveAbility(triggerUnit,'A0NF')
		call UnitAddPermanentAbility(triggerUnit,'A0MD')
	endif
	if(GetUnitAbilityLevel(triggerUnit,'A1NA')+ 2)== level then
		call UnitAddPermanentAbility(triggerUnit,'A1NJ')
	else
		call UnitRemoveAbility(triggerUnit,'A1NJ')
	endif
endfunction
function AWA takes unit WUE, real IXX returns nothing
	local integer level = 0
	local real AYA = 110
	if IXX > AYA * 6 then
		set level = 6
	elseif IXX > AYA * 5 then
		set level = 5
	elseif IXX > AYA * 4 then
		set level = 4
	elseif IXX > AYA * 3 then
		set level = 3
	elseif IXX > AYA * 2 then
		set level = 2
	elseif IXX > AYA * 1 then
		set level = 1
	endif
	set level = IMinBJ(level, 2 + GetUnitAbilityLevel(WUE,'A1NA'))
	call SaveInteger(HY,(GetHandleId(WUE)), 450,(level))
	call AUA(WUE, level)
endfunction
function AZA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local integer ATA = GetUnitAbilityLevel(WUE,'A1NA')
	call ASA(WUE,(LoadInteger(HY,(GetHandleId((WUE))), 450)), ATA)
	call AWA(WUE,(LoadReal(HY,(GetHandleId(WUE)), 443)))
	set t = null
	set WUE = null
	return false
endfunction
function A_A takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit WUE = U2
	local unit targetUnit = W2
	local real IXX =(LoadReal(HY, h, 20))
	set M_V = true
	call UnitDamageTargetEx(WUE, targetUnit, 1, IXX)
	set M_V = false
	if LoadBoolean(HY, h, 20)== false and GetUnitAbilityLevel(targetUnit,'A3E9')== 1 and IsMagicImmuneUnit(WUE)== false then
		call SaveUnitHandle(VV,'A3E9', 0, targetUnit)
		call SaveUnitHandle(VV,'A3E9', 1, WUE)
		call SaveInteger(VV,'A3E9', 0, LoadInteger(HY, h, 20))
		call ExecuteFunc("A0A")
	endif
	call FlushChildHashtable(HY, h)
	set WUE = null
	set targetUnit = null
endfunction
function A1A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	call AWA(WUE,(LoadReal(HY,(GetHandleId(WUE)), 443)))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	return false
endfunction
function A2A takes unit WUE, unit targetUnit, integer level, boolean FAR returns nothing
	local trigger t = NHX(WUE, targetUnit,'h0BE', "A_A", 1000, false)
	local integer h = GetHandleId(t)
	call SaveReal(HY, h, 20,((20 + level * 65)* 1.))
	call SaveInteger(HY, h, 20, level)
	call SaveBoolean(HY, h, 20, FAR)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AntiMagicShell\\AntiMagicShell.mdl", WUE, "chest"))
	call SaveReal(HY,(GetHandleId(WUE)), 443,(0 * 1.))
	call AWA(WUE, 0)
	call EPX(WUE,$9B4, 4)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerAddCondition(t, Condition(function A1A))
	call TriggerRegisterTimerEvent(t, 4, false)
	call SaveUnitHandle(HY, h, 2,(WUE))
	set t = null
endfunction
function N1E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call A2A(GetTriggerUnit(), GetSpellTargetUnit(), LoadInteger(HY, GetHandleId(GetTriggerUnit()), 450), false)
	endif
endfunction
function A0A takes nothing returns nothing
	local unit WJE = LoadUnitHandle(VV,'A3E9', 0)
	local unit WLE = LoadUnitHandle(VV,'A3E9', 1)
	local integer level = LoadInteger(VV,'A3E9', 0)
	call T4V(LoadUnitHandle(VV,'A3E9', 0))
	if UnitHasSpellShield(WLE)== false then
		call A2A(WJE, WLE, level, true)
	endif
	set WJE = null
	set WLE = null
	call FlushChildHashtable(VV,'A3E9')
endfunction


//function PXX takes nothing returns nothing
//	call MDO("SoulAssumptionDE")
//endfunction
function A9A takes nothing returns boolean
	return((IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GW)) and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')== 0 and GetWidgetLife(GetFilterUnit())> 1))
endfunction
function NVA takes unit WLE, integer level returns nothing
	local unit d = CreateUnit(GetOwningPlayer(WLE),'e00E', GetUnitX(WLE), GetUnitY(WLE), 0)
	local integer HNR
	local integer NEA
	local integer i
	if level >$C then
		set level =$C
	elseif level < 1 then
		set level = 1
	endif
	set HNR ='A3HN'+(level -1)/ 4
	set NEA = ModuloInteger(level, 4)
	if NEA == 0 then
		set NEA = 4
	endif
	call UnitAddAbility(d, HNR)
	call SetUnitAbilityLevel(d, HNR, NEA)
	call IssueTargetOrderById(d, 852075, WLE)
	call EXPauseUnit( d, false )
	set d = null
endfunction
function NXA takes nothing returns nothing
	call NVA(GetEnumUnit(), HW)
endfunction
function NOA takes unit dummyUnit, unit triggerUnit returns nothing
	local group g = LoginGroup(410)
	set GW = triggerUnit
	call GroupEnumUnitsInRange(g, GetUnitX(dummyUnit), GetUnitY(dummyUnit), 675, Condition(function A9A))
	call ForGroup(g, function NXA)
	call LogoutGroup(g)
	set g = null
endfunction
function NRA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit
	local unit dummyUnit = LoadUnitHandle(HY, h, 19)
	//if GetTriggerEventId()== EVENT_UNIT_SPELL_ENDCAST then
	//call KillUnit(dummyUnit)
	//call FlushChildHashtable(HY, h)
	//call CleanCurrentTrigger(t)
	//elseif GetTriggerEvalCount(t)> 22 then
	if GetTriggerEvalCount(t)> 22 then
		call KillUnit(dummyUnit)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call EXStopUnit(LoadUnitHandle(HY, h, 14))
	else
		call SetUnitAnimation(dummyUnit, "birth")
		set triggerUnit = LoadUnitHandle(HY, h, 14)
		set HW = GetTriggerExecCount(t)* LoadInteger(HY, h, 0)/ 2
		call NOA(dummyUnit, triggerUnit)
	endif
	set t = null
	set dummyUnit = null
	set triggerUnit = null
endfunction
function SpellEffect__Upheaval takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(triggerUnit),'e01G', GetSpellTargetX(), GetSpellTargetY(), 0)
	//call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddAction(t, function NRA)
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	call SaveUnitHandle(HY, h, 19, dummyUnit)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(triggerUnit, GetSpellAbilityId()))
	set triggerUnit = null
	set dummyUnit = null
	set t = null
endfunction
function PCX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A0JE')
endfunction

function NAA takes nothing returns nothing
	call UnitRemoveAbility(GetEnumUnit(),('A0P2'))
endfunction
function FatalBondsLightingEffect takes unit NBA, unit NCA returns nothing
	if NBA != null and NCA != null then
		call AddLightningToTimed("CLPB", GetUnitX(NBA), GetUnitY(NBA), GetUnitX(NCA), GetUnitY(NCA), .7, .1, .9, 1, .3)
	endif
endfunction
function NDA takes nothing returns nothing
	local unit triggerUnit =(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 14))
	local real IXX = .2 * GetEventDamage()
	set IXX = RMinBJ(IXX, GetWidgetLife(GetTriggerUnit()))
	if GetWidgetLife(GetEnumUnit())> 1 and GetEnumUnit()!= GetTriggerUnit() then
		if GetWidgetLife(GetEnumUnit())< IXX then
			call UnitDamageTargetEx(triggerUnit, GetEnumUnit(), 3, IXX)
		else
			call NotLethalLifeRemoved(GetEnumUnit(), IXX)
		endif
	endif
	set triggerUnit = null
endfunction

function FatalBondsEnd takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local group g =(LoadGroupHandle(HY, h, 0))
	local unit firstUnit
	local integer i = 1
	local integer uh
	local integer count
	loop
		set firstUnit = FirstOfGroup(g)
	exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)

		set uh = GetHandleId(firstUnit)
		set count = LoadInteger(ExtraHT, uh, 'A0P2') - 1
		if count == 0 then
			call UnitRemoveAbility(firstUnit,('A0P2'))
			call UnitRemoveAbility(firstUnit,('B048'))
		else
			call SaveInteger(ExtraHT, uh, 'A0P2', count)
		endif

	endloop
	set firstUnit = null

	loop
	exitwhen i > FatalBondsCount
		if FatalBondsGroups[i] == g then

			if i != 1 then
				set FatalBondsGroups[i] = FatalBondsGroups[FatalBondsCount]
			endif
			set FatalBondsCount = FatalBondsCount - 1

			exitwhen true
		endif
		set i = i + 1
	endloop


	set firstUnit = null

	call FlushChildHashtable(HY, h)
	call LogoutGroup(g)
	call CleanCurrentTrigger((t))

	set t = null
	set g = null
endfunction

globals

	integer					FatalBondsCount			= 0
	group		array 		FatalBondsGroups

endglobals

function SpellEffect__FatalBonds takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local group g = LoginGroup(411)
	local integer level = GetUnitAbilityLevel(triggerUnit,('A0J5'))
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer i = 2
	local group targetGroup = LoginGroup(412)
	local real distance
	local real lastDistance
	local unit lastUnit = null
	local real x
	local real y
	local unit firstUnit
	local player trigPlayer = GetOwningPlayer(triggerUnit)
	local integer uh
	local integer count
	
	local string FX = "Abilities\\Spells\\Undead\\Curse\\CurseTarget.mdl"
	if GetUnitAbilityLevel(triggerUnit,'Aloc')== 1 and HaveSavedHandle(HY, GetHandleId(triggerUnit), 0) then
		set triggerUnit = LoadUnitHandle(HY, GetHandleId(triggerUnit), 0)
	endif

	call FatalBondsLightingEffect(triggerUnit, targetUnit)
	call AddSpecialEffectTargetToTimed(FX, targetUnit, "overhead", 25.)
	call GroupAddUnit(targetGroup, targetUnit)

	set uh = GetHandleId(targetUnit)
	set count = LoadInteger(ExtraHT, uh, 'A0P2') + 1
	if count == 1 then
		call UnitAddPermanentAbility(targetUnit,('A0P2'))
	endif
	call SaveInteger(ExtraHT, uh, 'A0P2', count)

	
	set lastDistance = 99999.
	loop
	exitwhen i >(1 + 2 * level)

		set x = GetUnitX(targetUnit)
		set y = GetUnitY(targetUnit)
		call GroupEnumUnitsInRange(g, x, y, 700 + MAX_UNIT_COLLISION, null)
		call GroupRemoveUnit(g, targetUnit)
		loop
			set firstUnit = FirstOfGroup(g)
		exitwhen firstUnit == null
			call GroupRemoveUnit(g, firstUnit)
			if IsUnitInRangeXY(firstUnit, x, y, 700.) and not IsUnitInGroup(firstUnit, targetGroup) and IsUnitEnemy(firstUnit, trigPlayer) and IsAliveNotStrucNotWardNotInvulnerable(firstUnit) and UnitVisibleToPlayer(firstUnit, trigPlayer) then
				
				set distance = GetDistanceBetweenUnits(targetUnit, firstUnit)
				if lastDistance > distance then
					set lastDistance = distance
					set lastUnit = firstUnit
				endif

			endif
		endloop

		exitwhen lastUnit == null

		call FatalBondsLightingEffect(targetUnit, lastUnit)
		call AddSpecialEffectTargetToTimed(FX, lastUnit, "overhead", 25.)
		set targetUnit = lastUnit
		set lastUnit = null
		set lastDistance = 9999.
		call GroupAddUnit(targetGroup, targetUnit)

		set uh = GetHandleId(targetUnit)
		set count = LoadInteger(ExtraHT, uh, 'A0P2') + 1
		if count == 1 then
			call UnitAddPermanentAbility(targetUnit,('A0P2'))
		endif
		call SaveInteger(ExtraHT, uh, 'A0P2', count)

		set i = i + 1

	endloop

	call LogoutGroup(g)
	set firstUnit = null
	set lastUnit = null

	set FatalBondsCount = FatalBondsCount + 1
	set FatalBondsGroups[FatalBondsCount] = targetGroup

	call SaveGroupHandle(HY, h, 0, targetGroup)
	set targetGroup = null

	call TriggerRegisterTimerEvent(t, 25., false)
	call TriggerAddAction(t, function FatalBondsEnd)
	call EnableEffectByTime(EFFECT_KEY_FATAL_BONDS, 25.)

	set trigPlayer = null
	set g = null
	set t = null
	set triggerUnit = null
	set targetUnit = null

endfunction
function NKA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEvalCount(t)> LoadInteger(HY, h, 1) or GetTriggerEventId()== EVENT_WIDGET_DEATH or GetUnitAbilityLevel(targetUnit,'A17K')== 0 then
		call UnitRemoveAbility(targetUnit,'A17K')
		call UnitRemoveAbility(targetUnit,'B0AP')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call UnitDamageTargetEx(WUE, targetUnit, 1, level *$A+$A)
	endif
	set WUE = null
	set targetUnit = null
	set t = null
	return false
endfunction
function NLA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEvalCount(t)> LoadInteger(HY, h, 1) or GetTriggerEventId()== EVENT_WIDGET_DEATH or GetUnitAbilityLevel(targetUnit,'A0P0')== 0 then
		call UnitRemoveAbility(targetUnit,'A0P0')
		call UnitRemoveAbility(targetUnit,'B073')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+ level *$A+$A)
	endif
	set WUE = null
	set targetUnit = null
	set t = null
	return false
endfunction
function N5E takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	call SaveInteger(HY, h, 1, 11)
	if IsUnitAlly(targetUnit, GetOwningPlayer(WUE)) then
		call TriggerAddCondition(t, Condition(function NLA))
		call UnitAddPermanentAbility(targetUnit,'A0P0')
	elseif not UnitHasSpellShield(GetSpellTargetUnit()) then
		call TriggerAddCondition(t, Condition(function NKA))
		call UnitAddPermanentAbility(targetUnit,'A17K')
	endif
	set WUE = null
	set targetUnit = null
	set t = null
endfunction
function JWE takes nothing returns nothing
	if IsUnitEnemy(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) and IsMagicImmuneUnit(GetSpellTargetUnit()) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "无法作用于魔免的敌人")
	endif
endfunction
function PDX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A0P0')
	call AddAbilityIDToPreloadQueue('A17K')
endfunction
function QZG takes nothing returns nothing
	call UnitDamageTargetEx(M0V, GetEnumUnit(), 1, 20 +$A* M1V)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Immolation\\ImmolationDamage.mdl", GetEnumUnit(), "head"))
endfunction
function NMA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local integer level
	local integer OVX = GetUnitTypeId(WUE)
	local group g
	local unit u
	local integer i = 1
	if OVX =='n00U' or OVX =='n0KU' then
		set level = 1
	elseif OVX =='n00Y' or OVX =='n0KV' then
		set level = 2
	elseif OVX =='n00Z' or OVX =='n0KW' then
		set level = 3
	endif
	if GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(WUE))],'A0A8')> 0 then
		set i = 2
	endif
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		set WUE = GetTriggerUnit()
		set i = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(WUE))],'A0A8')
		if i > 0 and GetUnitAbilityLevel(WUE,'A3J0')== 0 and(GetUnitTypeId(WUE)=='n0KU' or GetUnitTypeId(WUE)=='n0KV' or GetUnitTypeId(WUE)=='n0KW') then
			set g = LoginGroup(413)
			set U2 = WUE
			call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 275, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
			call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", GetUnitX(WUE), GetUnitY(WUE)))
			loop
				set u = FirstOfGroup(g)
			exitwhen u == null
				call UnitDamageTargetEx(WUE, u, 1, 50 + 50 * i)
				call GroupRemoveUnit(g, u)
			endloop
			call LogoutGroup(g)
		endif
		set WUE = null
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set U2 = WUE
		set M0V = WUE
		set M1V = level
		set g = LoginGroup(414)
		call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 325, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			call UnitDamageTargetEx(WUE, u, 1,(20 +$A* level)* i)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Immolation\\ImmolationDamage.mdl", u, "head"))
			call GroupRemoveUnit(g, u)
		endloop
		call LogoutGroup(g)
		set g = null
	endif
	set t = null
	set WUE = null
	return false
endfunction
function NPA takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function NMA))
	call SaveUnitHandle(HY, h, 2,(u))
	if GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A0A8')> 0 then
		if GetUnitTypeId(u)=='n00U' then
			call UnitAddPermanentAbility(u,'A3IX')
		elseif GetUnitTypeId(u)=='n00Y' then
			call UnitAddPermanentAbility(u,'A3IY')
		elseif GetUnitTypeId(u)=='n00Z' then
			call UnitAddPermanentAbility(u,'A3IZ')
		elseif GetUnitAbilityLevel(u,'BNin')== 0 then
			call UnitApplyTimedLife(u,'BTLF', 60)
			call UnitAddPermanentAbility(u,'A3J0')
		endif
	endif
	set t = null
endfunction
function NQA takes nothing returns boolean
	local integer OVX = GetUnitTypeId(GetTriggerUnit())
	if OVX =='n00U' or OVX =='n0KU' or OVX =='n00Y' or OVX =='n0KV' or OVX =='n00Z' or OVX =='n0KW' then
		call NPA(GetTriggerUnit())
	endif
	return false
endfunction
function NSA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local real JBR =(LoadReal(HY, h, 191))
	local real JCR =(LoadReal(HY, h, 192))
	local integer level = GetUnitAbilityLevel(WUE,'S00U')
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', JBR, JCR, 0)
	call UnitAddPermanentAbility(dummyUnit,'S00U')
	call SetUnitAbilityLevel(dummyUnit,'S00U', level)
	call IssuePointOrderById(dummyUnit,$D0100, x, y)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set WUE = null
	set dummyUnit = null
	set t = null
	return false
endfunction
function NTA takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .3, false)
	call TriggerAddCondition(t, Condition(function NSA))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveReal(HY, h, 6,((GetSpellTargetX())* 1.))
	call SaveReal(HY, h, 7,((GetSpellTargetY())* 1.))
	call SaveReal(HY, h, 191,((GetUnitX(WUE))* 1.))
	call SaveReal(HY, h, 192,((GetUnitY(WUE))* 1.))
	set WUE = null
	set t = null
endfunction
function SpellEffect__RainOfChaos takes nothing returns nothing
	if IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) then
		call NTA()
	endif
endfunction
// 地狱火
function PFX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	call TriggerAddCondition(t, Condition(function NQA))
	set t = null
endfunction
function FlamingFistsActions takes unit R8X, unit WLE returns nothing
	local group g
	local unit u
	local real a
	local real damage
	if GetRandomReal(0, 100)< 40 then
		set g = LoginGroup(415)
		set a = AngleBetweenUnit(R8X, WLE)* bj_DEGTORAD
		if GetUnitAbilityLevel(R8X,'A0IM')== 1 then
			set damage = 80
		elseif GetUnitAbilityLevel(R8X,'A0IQ')== 1 then
			set damage = 115
		else
			set damage = 150
		endif
		set U2 = R8X
		call GroupEnumUnitsInRange(g, GetUnitX(WLE)+150* Cos(a), GetUnitY(WLE)+150* Sin(a), 325, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			call UnitDamageTargetEx(R8X, u, 7, damage)
			call GroupRemoveUnit(g, u)
		endloop
		call LogoutGroup(g)
	endif
	set g = null
	set u = null
endfunction
function FlamingFists_DE takes nothing returns nothing
	if IsInfernalUnit(DESourceUnit[DEI]) and not DETargetIsStructure[DEI] then
		call FlamingFistsActions(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
function NYA takes nothing returns boolean
	local unit t = GetFilterUnit()
	local unit u = LoadUnitHandle(VV,'A0CA', 0)
	local group g = LoadGroupHandle(P, GetHandleId(u), StringHash("ShukuGroup"))
	if u != null and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(u)) and(t != u) and IsUnitInGroup(t, g)== false and GetUnitAbilityLevel(t,'A04R')== 0 and IsMagicImmuneUnit(t)== false and UnitAlive(t) and IsUnitType(t, UNIT_TYPE_STRUCTURE)== false and(IsUnitType(t, UNIT_TYPE_ANCIENT)== false or IsBearUnit(t)) then
		call GroupAddUnit(g, t)
		call UnitDamageTargetEx(u, t, 1, LoadInteger(P, GetHandleId(u), StringHash("ShukuDamage")))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl", t, "chest"))
	endif
	set g = null
	set u = null
	set t = null
	return false
endfunction
function NZA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local unit u = LoadUnitHandle(P, WFV, 0)
	local group g
	if GetUnitAbilityLevel(u,'BHfs')== 0 then
		call LogoutGroup(LoadGroupHandle(P, GetHandleId(u), StringHash("ShukuGroup")))
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		set u = null
		return
	endif
	call SaveUnitHandle(VV,'A0CA', 0, u)
	set g = LoginGroup(416)
	call GroupEnumUnitsInRange(g, GetWidgetX(u), GetWidgetY(u), 200, Condition(function NYA))
	call LogoutGroup(g)
	call RemoveSavedHandle(VV,'A0CA', 0)
	set g = null
	set t = null
	set u = null
endfunction
function SpellEffect__Shukuchi takes nothing returns nothing

	local unit trigUnit = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(trigUnit, GetSpellAbilityId())
	local real dataA = 0
	local real dataB = 0.25
	local real dataF = 10
	local real dur = 3.5

	local timer t = CreateTimer()
	local integer WFV = GetHandleId(t)
	local integer WUV = GetUnitAbilityLevel(trigUnit,'A0CA')+ GetUnitAbilityLevel(trigUnit,'QB01')
	call SaveUnitHandle(P, WFV, 0, trigUnit)
	call SaveGroupHandle(P, GetHandleId(trigUnit), StringHash("ShukuGroup"), LoginGroup(417))
	call SaveInteger(P, GetHandleId(trigUnit), StringHash("ShukuDamage"), WUV * 25 + 50)
	call TimerStart(t, .05, true, function NZA)
	set t = null

	call UnitSpellEffectWindWalk(trigUnit, dataA, dataB, dur, level, 'AWfs', 'BHfs', 1, 0, dataF)

	set trigUnit = null
endfunction
function GeminateAttack__HitActions takes nothing returns nothing
	local missile m = GetHitMissile()
	local real damage = m.dataA
	local integer index = DEI + 1
	set IsAnAttack = true
	call UnitDamageTargetEx(m.owner, m.target, 12, damage)
	set IsAnAttack = false
endfunction

function Delayed__GeminateAttack takes nothing returns nothing
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local unit source = LoadUnitHandle(HY, h, 0)
	local unit target = LoadUnitHandle(HY, h, 1)
	local real damage = GetUnitState(source, UNIT_STATE_ATTACK1_DAMAGE_BONUS) + GetUnitState(source, UNIT_STATE_ATTACK1_DAMAGE_BASE) + GetUnitState(source, UNIT_STATE_ATTACK1_DAMAGE_DICE) * GetRandomInt(1, R2I(GetUnitState(source, UNIT_STATE_ATTACK1_DAMAGE_SIDE)) )
	local missile m = missile.create(source, target, 900.)
	set m.missileFile = "Abilities\\Weapons\\CryptFiendMissile\\CryptFiendMissile.mdl"
	set m.dataA = damage
	set m.usePlayerColor = true
	set m.hitActions = "GeminateAttack__HitActions"
	//set m.arc = 0.08
	set m.startUnit = source
	call m.LaunchMissile()

	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(trig)

	set trig = null
	set source = null
	set target = null
endfunction

function GeminateAttack_RL takes nothing returns nothing

	local integer level = GetUnitAbilityLevel(ARSourceUnit[ARI], 'A0CG')
	local real cool
	local real damage
	local integer h 
	if level > 0 and YDWEGetUnitAbilityState(ARSourceUnit[ARI], 'A0CG', 1) == 0. and GetUnitAbilityLevel(ARTargetUnit[ARI],'A04R')== 0 then
		set h = CreateTimerEventTrigger(0.25, false, function Delayed__GeminateAttack)
		call SaveUnitHandle(HY, h, 0, ARSourceUnit[ARI])
		call SaveUnitHandle(HY, h, 1, ARTargetUnit[ARI])
		
		if level == 4 then
			set cool = 2.5
		else
			set cool = 7 - level
		endif
		if GetUnitAbilityLevel(ARSourceUnit[ARI], 'A39S') == 1 then
			set cool = cool * 0.75
		endif
		call YDWESetUnitAbilityState(ARSourceUnit[ARI], 'A0CG', 1, cool)

	endif
endfunction
// 学习连击
function LearnSkill__GeminateAttack takes nothing returns nothing
	call Learn_HaveCoolDownSkill()
	call AddAttackLaunchingTrigCount(GetTriggerUnit())
	call RegisterUnitAttackEvent("GeminateAttack_RL", DE_ATTACK_READY_LAUNCHING) // 攻击出手
endfunction
function SXE takes nothing returns nothing
	call UnitMakeAbilityPermanent(GetTriggerUnit(), true,'A0BM')
	call UnitMakeAbilityPermanent(GetTriggerUnit(), true,'A0BL')
	call UnitMakeAbilityPermanent(GetTriggerUnit(), true,'A0BN')
	call UnitMakeAbilityPermanent(GetTriggerUnit(), true,'A0BO')
endfunction
function N_A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	call SetUnitState((LoadUnitHandle(HY, h, 26)), UNIT_STATE_MANA,(LoadReal(HY, h,$F2)))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function N0A takes unit u, real N1A returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function N_A))
	call SaveUnitHandle(HY, h, 26,(u))
	call SaveReal(HY, h,$F2,((N1A)* 1.))
	set t = null
endfunction
// 时光倒流
function N7E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer h
	local real hp
	local real mp
	local real x
	local real y
	if GetSpellAbilityId()=='A3DM' then
		set u = GetSpellTargetUnit()
	endif
	set h = GetHandleId(GetTriggerUnit())
	set hp = RMaxBJ((LoadReal(HY, h,(7200 + 1))), 1)
	set mp = RMaxBJ((LoadReal(HY, h,(7250 + 1))), 1)
	set x =(LoadReal(HY, h,(7300 + 1)))
	set y =(LoadReal(HY, h,(7350 + 1)))
	if(LoadReal(HY, h,(7200 + 1)))> 1 and GetWidgetLife(u)> 1 then
		call AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkTarget.mdl", GetUnitX(u), GetUnitY(u))
		call SetUnitX(u, x)
		call SetUnitY(u, y)
		call EPX(u,'AFRZ', .03)
		call SetWidgetLife(u, hp)
		call SetUnitState(u, UNIT_STATE_MANA, mp)
		if IsUnitType(u, UNIT_TYPE_SUMMONED)== false then
			call UnitRemoveBuffs(u, false, true)
		endif
		call GBX(u)
		call N0A(u, mp)
	endif
	set u = null
endfunction
function KXE takes nothing returns nothing
	if IsUnitIllusion(GetSpellTargetUnit()) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "无法作用于幻象.")
	elseif LoadBoolean(HY, GetHandleId(GetOwningPlayer(GetSpellTargetUnit())),$8B) and GetOwningPlayer(GetSpellTargetUnit())!= GetOwningPlayer(GetTriggerUnit()) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "目标拒绝了队友的帮助.")
	endif
endfunction

function Weaver_TimeLapse_Learn takes nothing returns nothing
	//local trigger t = CreateTrigger()
	//call TriggerRegisterTimerEventPeriodic(t, .5)
	//call TriggerAddAction(t, function N2A)
	//call SaveUnitHandle(HY, GetHandleId(t),$DD, GetTriggerUnit())
	//set t = null
endfunction
function N3A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer c = LoadInteger(HY, h, 2)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call LodSystem_AddUnitExtraState(targetUnit, c, STATE_SYSTEM_ARMOUR)
		call SaveInteger(HY,(GetHandleId((targetUnit))),(4290), 2)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if GetTriggerUnit()== targetUnit then
			call KillUnit(WUE)
		endif
	elseif GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if GetEventDamageSource()== WUE then
			call LodSystem_ReduceUnitExtraState(targetUnit, 1, STATE_SYSTEM_ARMOUR)
			call SaveInteger(HY, h, 2, c + 1)
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SkeletalMageMissile\\SkeletalMageMissile.mdl", targetUnit, "chest"))
		endif
	else
		call SetUnitX(WUE, GetUnitX(targetUnit)-40)
		call SetUnitY(WUE, GetUnitY(targetUnit)-40)
		if DOX(targetUnit) and UnitVisibleToPlayer(targetUnit, GetOwningPlayer(WUE))== false then
			call KillUnit(WUE)
		elseif ModuloInteger(GetTriggerEvalCount(t), 5)== 0 then
			call IssueTargetOrderById(WUE, 851983, targetUnit)
		endif
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function N4A takes unit N5A, unit targetUnit, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer id = GetUnitTypeId(N5A)
	local player p = GetOwningPlayer(N5A)
	local real x = GetUnitX(N5A)
	local real y = GetUnitY(N5A)
	local real a = GetUnitFacing(N5A)
	call KillUnit(N5A)
	set N5A = CreateUnit(p, id, x, y, a)
	call UnitRemoveAbility(N5A,'Avul')
	call SaveUnitHandle(HY, h, 2,(N5A))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterDeathEvent(t, N5A)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function N3A))
	call TriggerEvaluate(t)
	call UnitApplyTimedLife(N5A,'BTLF', 16)
	set t = null
endfunction
function N6A takes nothing returns boolean
	return IsEnemyAliveNotStrucNotWardNotInvulnerable() and LoadInteger(HY, GetHandleId(GetFilterUnit()), 4290)!= 1 and(UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) or DOX(GetFilterUnit())== false)
endfunction
function N7A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local group g
	local integer i = 1
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local real a = LoadReal(HY, h, 137)
	local unit N5A
	local unit targetUnit
	local real W_E = LoadReal(HY, h, 47)
	local real W0E = LoadReal(HY, h, 48)
	set x = CoordinateX50(x + 18 * Cos(a))
	set y = CoordinateY50(y + 18 * Sin(a))
	call SaveReal(HY, h, 6, x * 1.)
	call SaveReal(HY, h, 7, y * 1.)
	if GetTriggerEvalCount(t)>$A6 then
		loop
		exitwhen i >$C
			if(LoadBoolean(HY, h, 511 + i -1))== false then
				call KillUnit(LoadUnitHandle(HY, h, 393 + i -1))
			endif
			set i = i + 1
		endloop
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set g = LoginGroup(418)
		set U2 = WUE
		call GroupEnumUnitsInRange(g, x, y, 400, Condition(function N6A))
		loop
		exitwhen i >$C
			if(LoadBoolean(HY, h, 511 + i -1))== false then
				set N5A = LoadUnitHandle(HY, h, 393 + i -1)
				set x = LoadReal(HY, h, 549 + i -1)
				set y = LoadReal(HY, h, 567 + i -1)
				set x = CoordinateX50(x + 18 * Cos(a))
				set y = CoordinateY50(y + 18 * Sin(a))
				call SaveReal(HY, h, 549 + i -1, x * 1.)
				call SaveReal(HY, h, 567 + i -1, y * 1.)
				call SetUnitX(N5A, x)
				call SetUnitY(N5A, y)
				set targetUnit = FirstOfGroup(g)
				if targetUnit != null then
					call GroupRemoveUnit(g, targetUnit)
					call SaveInteger(HY, GetHandleId(targetUnit), 4290, 1)
					call SaveBoolean(HY, h, 511 + i -1, true)
					call N4A(N5A, targetUnit, LoadInteger(HY, h, 0))
				endif
			endif
			set i = i + 1
		endloop
		call LogoutGroup(g)
		set g = null
		set N5A = null
		set targetUnit = null
	endif
	set t = null
	set WUE = null
	return false
endfunction
function N8E takes nothing returns nothing
	local real W_E = GetSpellTargetX()
	local real W0E = GetSpellTargetY()
	local unit WUE = GetTriggerUnit()
	local real x = GetUnitX(WUE)
	local real y = GetUnitY(WUE)
	local real a = AngleBetweenXY(x, y, W_E, W0E)* bj_DEGTORAD
	local unit dummyUnit
	local real NBX = CoordinateX50(x +$BB8* Cos(a))
	local real NCX = CoordinateY50(y +$BB8* Sin(a))
	local integer i = 1
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real IMX
	local integer level = GetUnitAbilityLevel(WUE,'A1QW')
	local integer OVX
	if level == 1 then
		set OVX ='u01K'
	elseif level == 2 then
		set OVX ='u01H'
	elseif level == 3 then
		set OVX ='u01J'
	elseif level == 4 then
		set OVX ='u01L'
	endif
	loop
	exitwhen i >$C
		set dummyUnit = CreateUnit(GetOwningPlayer(WUE), OVX, x + GetRandomInt(-300, 300), y + GetRandomInt(-300, 300), a * bj_RADTODEG)
		call SaveUnitHandle(HY, h, 393 + i -1, dummyUnit)
		call SaveBoolean(HY, h, 511 + i -1, false)
		call SaveReal(HY, h, 549 + i -1, GetUnitX(dummyUnit)* 1.)
		call SaveReal(HY, h, 567 + i -1, GetUnitY(dummyUnit)* 1.)
		call UnitAddAbility(dummyUnit,'Aloc')
		call UnitAddAbility(dummyUnit,'Abun')
		set i = i + 1
	endloop
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function N7A))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveReal(HY, h, 6, x * 1.)
	call SaveReal(HY, h, 7, y * 1.)
	call SaveReal(HY, h, 137, a * 1.)
	call SaveReal(HY, h, 47, NBX * 1.)
	call SaveReal(HY, h, 48, NCX * 1.)
	call SaveInteger(HY, h, 0, level)
	set WUE = null
	set dummyUnit = null
	set t = null
endfunction
function PRX takes nothing returns nothing
	call B6X('u01K')
	call B6X('u01H')
	call B6X('u01J')
	call B6X('u01L')
endfunction
function N8A takes unit WUE, unit A2O returns unit
	local group g = LoginGroup(419)
	set U2 = WUE
	call GroupEnumUnitsInRange(g, GetUnitX(A2O), GetUnitY(A2O), 600, Condition(function DQX))
	call GroupRemoveUnit(g, A2O)
	set U2 = GroupPickRandomUnit(g)
	call LogoutGroup(g)
	set g = null
	return U2
endfunction
function N9A takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit W_V = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	local unit IZX = LoadUnitHandle(HY, h, 2)
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if GetEventDamageSource()== W_V then
			if LoadUnitHandle(HY, h,-1)== LoadUnitHandle(HY, h, 2) then
				if GetUnitAbilityLevel(WLE,'A3E9')== 1 and IsMagicImmuneUnit(IZX) and LoadBoolean(HY, h, 0)== false then
					if UnitHasSpellShield(IZX)== false then
						call SaveUnitHandle(VV,'A3E9', 0, WLE)
						call SaveUnitHandle(VV,'A3E9', 1, IZX)
						call SaveInteger(VV,'A3E9', 0, LoadInteger(HY, h, 0))
						call ExecuteFunc("BVA")
					else
						call AJO(IZX)
					endif
				endif
			endif
			if IsHeroLevelUnit(WLE) then
				call CommonUnitAddStun(WLE, 1, false)
				call UnitDamageTargetEx(IZX, WLE, 1, 75)
			else
				call CommonUnitAddStun(WLE, 5, false)
				call UnitDamageTargetEx(IZX, WLE, 1, 50 + 25 * LoadInteger(HY, h, 0))
			endif
			if LoadInteger(HY, h, 1)> 0 then
				call SaveUnitHandle(VV,'cask', 0, WLE)
				call RemoveSavedHandle(VV,'cask', 1)
				call SaveUnitHandle(VV,'cask', 2, IZX)
				call SaveInteger(VV,'cask', 0, LoadInteger(HY, h, 0))
				call SaveInteger(VV,'cask', 1, LoadInteger(HY, h, 1))
				call ExecuteFunc("BEA")
			else
				call FlushChildHashtable(VV,'cask')
			endif
			call CleanCurrentTrigger(t)
			call FlushChildHashtable(HY, h)
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set W_V = null
	set WLE = null
	set t = null
endfunction
function BXA takes unit WUE, unit BOA, unit BRA, integer level, integer c, boolean FAR returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(BOA), GetUnitY(BOA), 0)
	local boolean b = IsUnitType(BRA, UNIT_TYPE_HERO)
	call TriggerRegisterUnitEvent(t, BRA, EVENT_UNIT_DAMAGED)
	call TriggerRegisterTimerEvent(t, 15, false)
	call SaveUnitHandle(HY, h, 0, dummyUnit)
	call SaveUnitHandle(HY, h,-1, BOA)
	call SaveUnitHandle(HY, h, 1, BRA)
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveInteger(HY, h, 0, level)
	call SaveBoolean(HY, h, 0, FAR)
	call SaveInteger(HY, h, 1, c -1)
	call TriggerAddCondition(t, Condition(function N9A))
	call UnitAddAbility(dummyUnit,'A0WY')
	call B0R(dummyUnit, BRA,$D007F)
	set t = null
	set dummyUnit = null
endfunction
function BEA takes nothing returns nothing
	local unit BOA = LoadUnitHandle(VV,'cask', 0)
	local unit BRA = LoadUnitHandle(VV,'cask', 1)
	local unit WUE = LoadUnitHandle(VV,'cask', 2)
	local integer level = LoadInteger(VV,'cask', 0)
	local integer c = LoadInteger(VV,'cask', 1)
	if BRA == null then
		set BRA = N8A(WUE, BOA)
	endif
	if BRA != null then
		call BXA(WUE, BOA, BRA, level, c, LoadBoolean(VV,'cask', 0))
	endif
	set BOA = null
	set WUE = null
endfunction
function BIA takes unit triggerUnit, unit WLE, integer level, boolean FAR returns nothing
	call SaveUnitHandle(VV,'cask', 0, triggerUnit)
	call SaveUnitHandle(VV,'cask', 1, WLE)
	call SaveUnitHandle(VV,'cask', 2, triggerUnit)
	call SaveInteger(VV,'cask', 0, level)
	call SaveInteger(VV,'cask', 1, level * 2 + 1)
	call SaveBoolean(VV,'cask', 0, FAR)
	call BEA()
endfunction
function N9E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call BIA(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(),'A0NM'), false)
	endif
endfunction
function BVA takes nothing returns nothing
	local unit WJE = LoadUnitHandle(VV,'A3E9', 0)
	local unit WLE = LoadUnitHandle(VV,'A3E9', 1)
	local integer level = LoadInteger(VV,'A3E9', 0)
	call T4V(WJE)
	call BIA(WJE, WLE, level, true)
	call FlushChildHashtable(VV,'A3E9')
	set WJE = null
	set WLE = null
endfunction
function BAA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0NE')
	call UnitRemoveAbility(triggerUnit,'A0NE')
	call UnitAddPermanentAbility(triggerUnit,'A0NE')
	call SetUnitAbilityLevel(triggerUnit,'A0NE', level)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set triggerUnit = null
	return false
endfunction
function BNA takes unit targetUnit, integer level returns nothing
	local real BBA =(8 + level * 8)/ 3
	call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+ BBA)
endfunction
function BCA takes nothing returns boolean
	if(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit()))== false and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit())) then
		call BNA(GetFilterUnit(), Q2)
	endif
	return false
endfunction
function BDA takes unit triggerUnit returns nothing
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0NE')
	local group g = LoginGroup(420)
	set U2 = triggerUnit
	set Q2 = level
	call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit), 525, Condition(function BCA))
	call LogoutGroup(g)
	set g = null
endfunction
function BFA takes unit triggerUnit returns nothing
	local integer level = GetUnitAbilityLevel(triggerUnit,'A0NE')
	local real BGA = 4 + 4 * level
	call SetUnitState(triggerUnit, UNIT_STATE_MANA, GetUnitState(triggerUnit, UNIT_STATE_MANA)-(BGA / 3))
	if GetUnitState(triggerUnit, UNIT_STATE_MANA)< BGA then
		if((LoadInteger(HY,(GetHandleId((triggerUnit))),(4265)))== 1)== false then
			call IssueImmediateOrderById(triggerUnit,$D00D2)
		endif
	endif
endfunction
function BHA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit =(LoadUnitHandle(HY, h, 14))
	if GetTriggerEventId()== EVENT_UNIT_ISSUED_ORDER then
		if GetIssuedOrderId()==$D00D2 then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call SaveUnitHandle(HY, h, 14,(triggerUnit))
			call TriggerRegisterTimerEvent(t, 0, false)
			call TriggerAddCondition(t, Condition(function BAA))
		endif
	else
		call BDA(triggerUnit)
		call BFA(triggerUnit)
	endif
	set t = null
	set triggerUnit = null
	return false
endfunction
function BEE takes nothing returns nothing
	local unit triggerUnit = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 14, triggerUnit)
	call TriggerRegisterTimerEvent(t, .33, true)
	call TriggerRegisterUnitEvent(t, triggerUnit, EVENT_UNIT_ISSUED_ORDER)
	call TriggerAddCondition(t, Condition(function BHA))
	set triggerUnit = null
	set t = null
endfunction
function BJA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 0)
	local integer EVX = GetTriggerEvalCount(t)
	local real BKA = LoadReal(HY, h, 392)
	local real BLA = 0
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call WHV(targetUnit,'D002')
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if EVX == 4 or EVX == 8 or EVX ==$C then
			call DestroyEffect(LoadEffectHandle(HY, h, 32))
			if EVX ==$C then
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			elseif EVX == 4 or EVX == 8 then
				call DestroyEffect(LoadEffectHandle(HY, h, 32))
				call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("effects\\NetherInferno.mdx", targetUnit, "origin"))
			endif
			set BLA =(level * .08 + .08)* RMaxBJ(BKA -GetWidgetLife(targetUnit), 0)
			if BLA > 0 then
				call CommonTextTag("+" + I2S(R2I(BLA)), 2, targetUnit, .023, 68, 0, 187,$D8)
			endif
		endif
		call UnitDamageTargetEx(WUE, targetUnit, 1, level * 5 + BLA)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function BMA takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetEnumUnit()
	call WJV(targetUnit,'C002','D002', 12.)
	call DestroyEffect(AddSpecialEffectTarget("effects\\NetherInferno.mdx", targetUnit, "origin"))
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function BJA))
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	call SaveReal(HY, h, 392, GetWidgetLife(targetUnit)* 1.)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("effects\\NetherInferno.mdx", targetUnit, "origin"))
	set t = null
	set WUE = null
	set targetUnit = null
endfunction
function BPA takes nothing returns boolean
	return(IsUnitIdType(GetUnitTypeId(GetFilterUnit()), UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())))!= null
endfunction
function BRE takes nothing returns nothing
	local group g = LoginGroup(421)
	call GroupEnumUnitsInRange(g, GetSpellTargetX(), GetSpellTargetY(), 190, Condition(function BPA))
	call ForGroup(g, function BMA)
	call LogoutGroup(g)
	set g = null
endfunction
function BQA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	if GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		call EXStopUnit(WUE)
	endif
	set WUE = null
	set t = null
	return false
endfunction
function BIE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2,(u))
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_FINISH)
	call TriggerRegisterTimerEvent(t, 10, false)
	call TriggerAddCondition(t, Condition(function BQA))
	call FVO(u, false)
	set t = null
	set u = null
endfunction
function BSA takes nothing returns boolean
	if GetUnitTypeId(GetSummonedUnit())=='o000' or GetUnitTypeId(GetSummonedUnit())=='o001' or GetUnitTypeId(GetSummonedUnit())=='o00A' or GetUnitTypeId(GetSummonedUnit())=='o00X' then
		call EPX(GetSummoningUnit(), 4265, 8)
	endif
	return false
endfunction
function PNX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function BSA))
	set t = null
endfunction
function SIG takes nothing returns boolean
	local integer id = 0
	local unit u
	local real WIE = GetGameTime()
	local real hp
	local integer BTA
	loop
	exitwhen id >$C
		set u = Player__Hero[id]
		set BTA = GetUnitAbilityLevel(u,'B0CD')
		if u != null and BTA == 0 and M2V[id]> WIE then
			set M2V[id]= 0
		endif
		if u != null and BTA > 0 then
			if M2V[id]> WIE and UnitAlive(u) then
				set hp = GetWidgetLife(u)
				if hp < M3V[id]or LoadInteger(HY, GetHandleId(u),'AFRZ')== 1 then
					set M3V[id]= hp
				endif
				call SetWidgetLife(u, M3V[id])
				set M5V[id]= M5V[id]+ 1
				if M5V[id]==$A and BTA > 0 then
					set M5V[id]= 0
					call UnitDamageTargetEx(M4V[id], u, 1, 5 +$A* M6V[id])
				endif
			elseif M2V[id]> WIE and UnitIsDead(u) then
				set M2V[id]= 0
				set M3V[id]= 99999
			endif
			if(BTA > 0 and M2V[id]< WIE) then
				call UnitRemoveAbility(u,'A1JA')
				call UnitRemoveAbility(u,'B0CD')
			endif
		endif
		set id = id + 1
	endloop
	set u = null
	return false
endfunction
function BUA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 5)
	local unit dummyUnit
	local string s
	local real BWA = LoadReal(HY, h, 0)
	local integer c = LoadInteger(HY, h, 0)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call UnitRemoveAbility(targetUnit,'A1JA')
		call UnitRemoveAbility(targetUnit,'B0CD')
		call RemoveSavedHandle(HY, GetHandleId(targetUnit),'A1MI')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		// debug call SingleDebug("dest 1")
	elseif GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		if GetGameTime()> BWA then
			call UnitRemoveAbility(targetUnit,'A1JA')
			call UnitRemoveAbility(targetUnit,'B0CD')
			call RemoveSavedHandle(HY, GetHandleId(targetUnit),'A1MI')
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		else
			set c = c + 1
			call SaveInteger(HY, h, 0, c)
			if ModuloInteger(c, 10)== 0 then
				call UnitDamageTargetEx(LoadUnitHandle(HY, h, 0), targetUnit, 1, 5 +$A* level)
			endif
		endif
	else
		if GetUnitAbilityLevel(targetUnit,'A1JA')== 0 then
			if GetTriggerEvalCount(t)> 4 then
				call UnitRemoveAbility(targetUnit,'A1JA')
				call UnitRemoveAbility(targetUnit,'B0CD')
				call RemoveSavedHandle(HY, GetHandleId(targetUnit),'A1MI')
				call FlushChildHashtable(HY, h)
				call DestroyTrigger(t)
			endif
		elseif GetOwningPlayer(targetUnit)!= GetOwningPlayer(GetEventDamageSource()) and GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE)*(.09 + .01 * level)> GetWidgetLife(targetUnit) and((LoadInteger(HY,(GetHandleId((targetUnit))),($9B5)))!= 1) then
			call RemoveSavedHandle(HY, GetHandleId(targetUnit),'A1MI')
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
			call UnitRemoveAbility(targetUnit,'A1JA')
			call UnitRemoveAbility(targetUnit,'B0CD')
			set s = "Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl"
			call DestroyEffect(AddSpecialEffectTarget(s, targetUnit, "overhead"))
			call DestroyEffect(AddSpecialEffectTarget(s, targetUnit, "chest"))
			call DestroyEffect(AddSpecialEffectTarget(s, targetUnit, "origin"))
			set dummyUnit = CreateUnit(GetOwningPlayer(GetEventDamageSource()),'e00E', 0, 0, 0)
			if IsUnitType(targetUnit, UNIT_TYPE_SUMMONED)== false then
				call UnitRemoveBuffs(targetUnit, true, true)
			endif
			call UnitRemoveAbility(targetUnit,'Aetl')
			call UnitDamageTargetEx(dummyUnit, targetUnit, 4, 100000000.)
			set dummyUnit = null
		endif
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function BYA takes unit WUE, unit targetUnit returns nothing
	local integer level = GetUnitAbilityLevel(WUE,'A1MI')+ GetUnitAbilityLevel(WUE,'A2QE')
	local integer id = GetPlayerId(GetOwningPlayer(targetUnit))
	local trigger t
	local integer h
	local real BZA = 7 + level
	if GetUnitAbilityLevel(WUE,'A2QE')> 0 then
		set BZA = 17
	endif
	if level > 0 and IsUnitType(targetUnit, UNIT_TYPE_HERO) and GetUnitAbilityLevel(targetUnit,'A04R')== 0 then
		if HaveSavedHandle(HY, GetHandleId(targetUnit),'A1MI') then
			set t = LoadTriggerHandle(HY, GetHandleId(targetUnit),'A1MI')
			set h = GetHandleId(t)
		else
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call FlushChildHashtable(HY, h)
			call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
			call TriggerAddCondition(t, Condition(function BUA))
			call TriggerRegisterDeathEvent(t, targetUnit)
			call TriggerRegisterTimerEvent(t, .1, true)
			call SaveReal(HY, h, 0, GetGameTime()+ BZA * 1.)
			call SaveUnitHandle(HY, h, 17,(targetUnit))
			call UnitAddPermanentAbility(targetUnit,'A1JA')
			call SaveTriggerHandle(HY, GetHandleId(targetUnit),'A1MI', t)
		endif
		call SaveInteger(HY, h, 5,(level))
		call SaveUnitHandle(HY, h, 0, WUE)
		call CXR(targetUnit, BZA)
	endif
	set t = null
endfunction


function iceVortexAuraActions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit iceVortex = LoadUnitHandle(HY, h, 19)

	local real x = GetUnitX(iceVortex)
	local real y = GetUnitY(iceVortex)
	local unit firstUnit

	local group lastGroup = LoadGroupHandle(HY, h, 340)
	local group tempGroup
	local group targetGroup
	local real range = LoadReal(HY, h, 1)
	local integer auraLevel = LoadInteger(HY, h, 0)
	local integer targetLevel
	local player sourcePlayer = GetOwningPlayer(iceVortex)
	local real dataA = - 0.14 - 0.04 * auraLevel
	local real dataB = - 0.10 - 0.05 * auraLevel

	if GetTriggerEventId()== EVENT_WIDGET_DEATH then

		loop
			set firstUnit = FirstOfGroup(lastGroup)
			exitwhen firstUnit == null
			call GroupRemoveUnit(lastGroup, firstUnit)
	
			set targetLevel = GetUnitAbilityLevel(firstUnit, 'A1HT')
			if targetLevel > 0 then
				call LodSystem_ReduceUnitExtraState(firstUnit, - 0.14 - 0.04 * targetLevel, STATE_SYSTEM_PERCENT_MOVE)
				call ReduceUnitMagicResistance(firstUnit, - 0.10 - 0.05 * targetLevel)
				call UnitRemoveAbility(firstUnit, 'A1HT')
				call UnitRemoveAbility(firstUnit, 'B0C5')
			endif
	
		endloop

		call LogoutGroup(lastGroup)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call ShowUnit(iceVortex, false)
		set t = null
		set iceVortex = null
		set iceVortex = null
		set lastGroup = null
		set firstUnit = null
		return false
	endif

	// 选取周围单位, 并将符合条件的单位添加到targetGroup
	set tempGroup = LoginGroup(422)
	set targetGroup = LoginGroup(600)
	call GroupEnumUnitsInRange(tempGroup, x, y, range, null)
	loop
		set firstUnit = FirstOfGroup(tempGroup)
		exitwhen firstUnit == null
		call GroupRemoveUnit(tempGroup, firstUnit)
		if IsUnitInRangeXY(firstUnit, x, y, range) and IsUnitEnemy(firstUnit, sourcePlayer) and IsAliveNotStrucNotWardNotInvulnerable(firstUnit) then
			call GroupAddUnit(targetGroup, firstUnit)

			// 如果目标的光环等级, 小于当前技能光环等级, 则进行覆盖.
			set targetLevel = GetUnitAbilityLevel(firstUnit, 'A1HT')
			if targetLevel <= 0 then
				//call LodSystem_AddUnitExtraState(firstUnit, dataA, STATE_SYSTEM_PERCENT_MOVE)
				call AddUnitMagicResistance(firstUnit, dataB)
				call UnitAddPermanentAbilitySetLevel(firstUnit, 'A1HT', auraLevel)

			elseif targetLevel < auraLevel then

				//call LodSystem_ReduceUnitExtraState(firstUnit, - 0.14 - 0.04 * targetLevel, STATE_SYSTEM_PERCENT_MOVE)
				call ReduceUnitMagicResistance(firstUnit, - 0.10 - 0.05 * targetLevel)

				//call LodSystem_AddUnitExtraState(firstUnit, dataA, STATE_SYSTEM_PERCENT_MOVE)
				call AddUnitMagicResistance(firstUnit, dataB)

				call SetUnitAbilityLevel(firstUnit, 'A1HT', auraLevel)
			endif

		endif
	endloop
	call LogoutGroup(tempGroup)
	set tempGroup = null

	// 遍历上一次选取的单位(即被本技能传染BUFF的单位)
	loop
		set firstUnit = FirstOfGroup(lastGroup)
		exitwhen firstUnit == null
		call GroupRemoveUnit(lastGroup, firstUnit)

		if not IsUnitInGroup(firstUnit, targetGroup) then
			set targetLevel = GetUnitAbilityLevel(firstUnit, 'A1HT')
			if targetLevel > 0 then
				//call LodSystem_ReduceUnitExtraState(firstUnit, - 0.14 - 0.04 * targetLevel, STATE_SYSTEM_PERCENT_MOVE)
				call ReduceUnitMagicResistance(firstUnit, - 0.10 - 0.05 * targetLevel)
				call UnitRemoveAbility(firstUnit, 'A1HT')
				call UnitRemoveAbility(firstUnit, 'B0C5')
			endif

		endif

	endloop
	call LogoutGroup(lastGroup)
	set lastGroup = null

	call SaveGroupHandle(HY, h, 340, targetGroup)
	set tempGroup = null

	set t = null
	set iceVortex = null
	set lastGroup = null
	return false
endfunction
// 冰霜漩涡
function SpellEffect__IceVortex takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'n0HQ', GetSpellTargetX(), GetSpellTargetY(), 0)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(WUE,'A1HS')
	local real range = 300
	call UnitApplyTimedLife(dummyUnit,'BTLF', 16)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerRegisterDeathEvent(t, dummyUnit)
	call TriggerAddCondition(t, Condition(function iceVortexAuraActions))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 19, dummyUnit)
	call SaveGroupHandle(HY, h, 340, LoginGroup(423))
	call SaveInteger(VV,'MULT', 0,'A1HS')
	call SaveReal(HY, h, 1, range)
	call SaveInteger(HY, h, 0, level)
	set U2 = WUE
	call ExecuteFunc("EBI")
	if Q2 > 0 then
		call SaveReal(HY, h, 1, 300 + 100 *(Q2 -1))
		call SetUnitScale(dummyUnit, 1. + .33 *(Q2 -1), 1, 1)
	endif
	//call TriggerRegisterUnitInRange(t, dummyUnit, range)
	set WUE = null
	set dummyUnit = null
	set t = null
endfunction

function B2A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local integer level = LoadInteger(HY, h, 5)
	local real IXX =( 100 + 50 * level)/ 4
	local integer i = GetTriggerEvalCount(t)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or GetDistanceBetween(x, y, GetUnitX(targetUnit), GetUnitY(targetUnit))> 765 or GetUnitAbilityLevel(targetUnit,'B0CC')== 0 then
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call DestroyEffect(LoadEffectHandle(HY, h, 176))
		call UnitRemoveAbility(targetUnit,'A1J9')
		call UnitRemoveAbility(targetUnit,'B0CC')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif i == 8 or i == 16 or i == 25 or i == 34 then
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("war3mapImported\\ShivasEnchantment.mdx", targetUnit, "overhead"))
		call UnitDamageTargetEx(WUE, targetUnit, 1, IXX)
	elseif i > 39 then
		call DestroyEffect(LoadEffectHandle(HY, h, 176))
		call UnitRemoveAbility(targetUnit,'A1J9')
		call UnitRemoveAbility(targetUnit,'B0CC')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call CommonUnitAddStun(targetUnit, .5 + .75 * level, false)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function B3A takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(WUE,'A1MG')
	local string s = "Doodads\\Cinematic\\GlowingRunes\\GlowingRunes4.mdl"
	if GetUnitTypeId(WUE)=='e00E' then
		set WUE = Player__Hero[GetPlayerId(GetOwningPlayer(WUE))]
	endif
	call UnitAddPermanentAbility(targetUnit,'A1J9')
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveReal(HY, h, 6, GetUnitX(targetUnit)* 1.)
	call SaveReal(HY, h, 7, GetUnitY(targetUnit)* 1.)
	call SaveInteger(HY, h, 5, level)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("war3mapImported\\ShivasEnchantment.mdx", targetUnit, "overhead"))
	call SaveEffectHandle(HY, h, 176, AddSpecialEffect(s, GetUnitX(targetUnit), GetUnitY(targetUnit)))
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function B2A))
	set WUE = null
	set targetUnit = null
	set t = null
endfunction
function BCE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call B3A()
	endif
endfunction
function B4A takes nothing returns nothing
	local unit WUE = M9V
	local unit targetUnit = GetEnumUnit()
	local integer level = M8V
	call BYA(WUE, targetUnit)
	call UnitDamageTargetEx(WUE, targetUnit, 1, 150 + 100 * level)
	call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\PlasmaShot.mdl", targetUnit, "chest"))
	set WUE = null
	set targetUnit = null
endfunction
function B5A takes nothing returns nothing
	local unit WUE = M9V
	local unit targetUnit = GetEnumUnit()
	local integer level = M8V
	call BYA(WUE, targetUnit)
	set WUE = null
	set targetUnit = null
endfunction
function B6A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit NIX = LoadUnitHandle(HY, h, 45)
	local real W_E = LoadReal(HY, h, 47)
	local real W0E = LoadReal(HY, h, 48)
	local real a = LoadReal(HY, h, 13)
	local real KJR = LoadReal(HY, h, 432)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local integer level = LoadInteger(HY, h, 5)
	local real x = GetUnitX(NIX)+ 30 * Cos(a)
	local real y = GetUnitY(NIX)+ 30 * Sin(a)
	local group g
	local fogmodifier fm
	if GetDistanceBetween(x, y, W_E, W0E)< 35 or x != CoordinateX50(x) or y != CoordinateY50(y) then
		set x = W_E
		set y = W0E
		call SetUnitX(NIX, x)
		call SetUnitY(NIX, y)
		call DestroyEffect(LoadEffectHandle(HY, h, 14))
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		set fm = LoadFogModifierHandle(HY, h, 440)
		call FogModifierStop(fm)
		call DestroyFogModifier(fm)
		set fm = null
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(NIX)
		set U2 = WUE
		set M9V = WUE
		set M8V = level
		set g = LoginGroup(424)
		call GroupEnumUnitsInRange(g, x, y, KJR + 25, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call ForGroup(g, function B4A)
		call LogoutGroup(g)
		set g = null
	else
		call SetUnitX(NIX, x)
		call SetUnitY(NIX, y)
		set U2 = WUE
		set M9V = WUE
		set M8V = level
		set g = LoginGroup(425)
		call GroupEnumUnitsInRange(g, x, y, 300, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call ForGroup(g, function B5A)
		call LogoutGroup(g)
		set g = null
	endif
	set t = null
	set NIX = null
	set WUE = null
	return false
endfunction
function B7A takes unit WUE, real x, real y, real DRI, effect FX, fogmodifier fm, integer level, real PJZ  returns nothing
	local real a = Atan2(y -GetUnitY(WUE), x -GetUnitX(WUE))
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit NIX = CreateUnit(GetOwningPlayer(WUE),'h0B6', GetUnitX(WUE), GetUnitY(WUE), a * bj_RADTODEG)
	local real KJR = RMinBJ(275 + 25 * DRI * 2, 1000)
	local real GIX = GetDistanceBetween(GetUnitX(WUE), GetUnitY(WUE), x, y)
	local string s = ""
	local effect eff = null
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(WUE)) or IsObserver then
		set s = "H\\AA\\IceBlastAoE.mdx"
	endif
	set eff= AddSpecialEffect(s, x,y)
	call EXSetEffectSize(eff ,0.25*PJZ/100.)
	call SaveEffectHandle(HY, h, 14, eff)
	set eff = null
	if IsUnitEnemy(NIX, LocalPlayer) and IsObserver== false then
		call UnitSetUsesAltIcon(NIX, true)
	endif
	call TriggerRegisterTimerEvent(t, RMinBJ(2. /(GIX / 30), .04), true)
	call TriggerAddCondition(t, Condition(function B6A))
	call SaveUnitHandle(HY, h, 45, NIX)
	call SaveReal(HY, h, 47, x * 1.)
	call SaveReal(HY, h, 48, y * 1.)
	call SaveReal(HY, h, 13, a * 1.)
	call SaveReal(HY, h, 432, KJR * 1.)
	call SaveInteger(HY, h, 5, level)
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveFogModifierHandle(HY, h, 440, fm)
	call SaveEffectHandle(HY, h, 32, FX)
	call S9E(GetOwningPlayer(WUE),'A1MI', true)
	call S9E(GetOwningPlayer(WUE),'A2QE', true)
	call S9E(GetOwningPlayer(WUE),'A1MN', false)
	set t = null
	set NIX = null
endfunction
function B8A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit NIX = LoadUnitHandle(HY, h, 45)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local real a = LoadReal(HY, h, 13)
	local real x
	local real y
	local real DRI = GetGameTime()-LoadReal(HY, h, 431)
	local real PJZ
	local string s
	local fogmodifier fm
	local effect FX
	local real B9A = GetUnitX(NIX)+ 30 * Cos(a)
	local real CVA = GetUnitY(NIX)+ 30 * Sin(a)
	local integer level = LoadInteger(HY, h, 0)
	set x = CoordinateX50(B9A)
	set y = CoordinateY50(CVA)
	call SetUnitX(NIX, x)
	call SetUnitY(NIX, y)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or(GetTriggerEventId()== EVENT_PLAYER_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A1MN') or x != B9A or y != CVA then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call RemoveUnit(NIX)
		set PJZ= RMinBJ(25+250+50*DRI,1000)
		set s = ""
		if IsPlayerAlly(GetOwningPlayer(WUE), LocalPlayer) or IsObserver then
			set s = "war3mapImported\\IceWindGroundFX.mdl"
		endif
		set fm = CreateFogModifierRadius(GetOwningPlayer(WUE), FOG_OF_WAR_VISIBLE, x, y, 500, true, true)
		call FogModifierStart(fm)
		set FX = AddSpecialEffect(s, x, y)
		call B7A(WUE, x, y, DRI, FX, fm, level, PJZ)
		set fm = null
		set FX = null
	endif
	set t = null
	set NIX = null
	set WUE = null
	return false
endfunction
//冰晶爆轰
function BDE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = Atan2(y -GetUnitY(WUE), x -GetUnitX(WUE))
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit NIX = CreateUnit(GetOwningPlayer(WUE),'H0B8', GetUnitX(WUE), GetUnitY(WUE), a * bj_RADTODEG)
	if IsUnitEnemy(NIX, LocalPlayer) and IsObserver== false then
		call UnitSetUsesAltIcon(NIX, true)
	endif
	call SaveUnitHandle(HY, h, 45, NIX)
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveReal(HY, h, 13, a * 1.)
	call SaveReal(HY, h, 431, GetGameTime()* 1.)
	call TriggerRegisterTimerEvent(t, .02, true)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	call SaveInteger(HY, h, 1, GetSpellAbilityId())
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerAddCondition(t, Condition(function B8A))
	call SetUnitColor(NIX, GetPlayerColor(Player($E)))
	call S9E(GetOwningPlayer(WUE),'A1MI', false)
	call S9E(GetOwningPlayer(WUE),'A2QE', false)
	call S9E(GetOwningPlayer(WUE),'A1MN', true)
	call UnitAddPermanentAbility(WUE,'A1MN')
	set WUE = null
	set t = null
	set NIX = null
endfunction
function CEA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local integer level =(LoadInteger(HY, h, 5))
	local integer CXA =(LoadInteger(HY,(GetHandleId(WUE)), 449))
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if GetEventDamageSource()== WUE and GetEventDamage()> 1 and FK then
			call DisableTrigger(t)
			if CXA > 0 then
				call SaveInteger(HY,(GetHandleId(WUE)), 449,(CXA -1))
				call CommonTextTag("+" + I2S(40 +$A* level), 1, WUE, .024, 100, 200, 255, 255)
				call UnitDamageTargetEx(WUE, targetUnit, 1, 40 +$A* level)
			endif
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function COA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local integer level = LoadInteger(HY, h, 5)
	if GetTriggerEventId()!= EVENT_PLAYER_UNIT_ATTACKED or(LoadInteger(HY, GetHandleId(WUE), 449))== 0 or GetUnitAbilityLevel(WUE,'A1HN')== 0 then
		call SaveInteger(HY, GetHandleId(WUE), 449, 0)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(WUE,'A1HN')
		call UnitRemoveAbility(WUE,'B0CJ')
	elseif GetAttacker()== WUE and(LoadInteger(HY, GetHandleId(WUE), 4289)!= 1) then
		call EPX(WUE, 4289, .4)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_DAMAGED)
		call TriggerRegisterTimerEvent(t, 2., false)
		call TriggerAddCondition(t, Condition(function CEA))
		call SaveUnitHandle(HY, h, 17, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 2, WUE)
		call SaveInteger(HY, h, 5, level)
	endif
	set t = null
	set WUE = null
	return false
endfunction
function T7G takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetEnumUnit()
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(WUE,'A1HQ')
	if LoadInteger(HY, GetHandleId(targetUnit), 449)> 0 and GetUnitAbilityLevel(targetUnit,'A1HN')== 1 then
		call SaveInteger(HY, GetHandleId(targetUnit), 449, 2 + level + LoadInteger(HY, GetHandleId(targetUnit), 449))
		set WUE = null
		set targetUnit = null
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call UnitAddPermanentAbility(targetUnit,'A1HN')
	call SaveUnitHandle(HY, h, 2, targetUnit)
	call SaveInteger(HY, h, 5, level)
	call TriggerRegisterTimerEvent(t, 30, false)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerAddCondition(t, Condition(function COA))
	set WUE = null
	set targetUnit = null
	set t = null
endfunction
function ChillingTouch_DE takes nothing returns nothing
	local trigger t
	local integer h
	if GetUnitAbilityLevel(DESourceUnit[DEI],'A1HN')== 1 then
		set t = LoadTriggerHandle(HY, DESourceId[DEI],'A1HN')
		set h = GetHandleId(t)
		call CommonTextTag("+" + I2S(R2I(LoadReal(HY, h, 1))), 1, DESourceUnit[DEI], .024, 100, 200, 255, 255)
		call UnitDamageTargetEx(DESourceUnit[DEI], DETargetUnit[DEI], 1, LoadReal(HY, h, 1))
		call SaveInteger(HY, h, 0, LoadInteger(HY, h, 0)-1)
		set t = null
	endif
endfunction
function CIA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or GetUnitAbilityLevel(u,'A1HN')== 0 or GetGameTime()> LoadReal(HY, h, 0) or LoadInteger(HY, h, 0)<= 0 then
		call RemoveSavedHandle(HY, GetHandleId(u),'A1HN')
		call UnitRemoveAbility(u,'A1HN')
		call UnitRemoveAbility(u,'B0CJ')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set u = null
	set t = null
endfunction
function CAA takes nothing returns nothing
	local unit WLE = GetEnumUnit()
	local integer hu = GetHandleId(WLE)
	local trigger t
	local integer h
	if HaveSavedHandle(HY, hu,'A1HN') then
		set t = LoadTriggerHandle(HY, hu,'A1HN')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call FlushChildHashtable(HY, h)
		call SaveTriggerHandle(HY, hu,'A1HN', t)
		call TriggerRegisterTimerEvent(t, .2, true)
		call TriggerRegisterDeathEvent(t, WLE)
		call TriggerAddCondition(t, Condition(function CIA))
		call SaveUnitHandle(HY, h, 0, WLE)
	endif
	call UnitAddPermanentAbility(WLE,'A1HN')
	call SaveInteger(HY, h, 0, Q2 + 2 + LoadInteger(HY, h, 0))
	call SaveReal(HY, h, 0, GetGameTime()+ 30)
	call SaveReal(HY, h, 1, Q2 *$A+ 40)
	set t = null
	set WLE = null
endfunction
function BFE takes nothing returns nothing
	local group g = LoginGroup(426)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	call DestroyEffect(AddSpecialEffect("war3mapImported\\IcyWind.mdl", x, y))
	call GroupEnumUnitsInRange(g, x, y, 550, Condition(function D3X))
	call GroupAddUnit(g, GetTriggerUnit())
	set Q2 = GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId())
	call ForGroup(g, function CAA)
	call LogoutGroup(g)
	set g = null
endfunction
function CNA takes unit u, real ZCE returns nothing
	if GetWidgetLife(u)<= ZCE * .75 then
		set ZCE = GetWidgetLife(u)/ .75 -$A
	endif
	call UnitDamageTargetEx(u, u, 1, ZCE)
endfunction
function CBA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local real x = GetUnitX(WUE)
	local real y = GetUnitY(WUE)
	local group g
	local integer i = GetTriggerEvalCount(t)
	local unit u
	local real ZCE
	local boolean b = LoadBoolean(HY, h, 0)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set WUE = null
		return false
	else
		set ZCE = LoadReal(HY, h, 0)
		if i == 1 then
			call UnitApplyTimedLife(CreateUnit(GetOwningPlayer(WUE),'h0B2', x, y, 0),'BTLF', 1)
			call TriggerRegisterTimerEvent(t, .1, true)
		elseif i ==$A then
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
		call GBX(WUE)
		set g = LoginGroup(427)
		set U2 = WUE
		call GroupEnumUnitsInRange(g, x, y, 350, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		loop
			set u = FirstOfGroup(g)
		exitwhen u == null
			call UnitDamageTargetEx(WUE, u, 1, ZCE)
			call GroupRemoveUnit(g, u)
		endloop
		if b then
			call CNA(WUE, ZCE / 2)
		endif
		call LogoutGroup(g)
	endif
	set t = null
	set g = null
	set WUE = null
	return false
endfunction
function BJE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	call SaveBoolean(HY, h, 0, true)
	if GetUnitTypeId(WUE)=='e00E'then
		set WUE = Player__Hero[GetPlayerId(GetOwningPlayer(WUE))]
		call SaveBoolean(HY, h, 0, false)
	endif
	call TriggerRegisterTimerEvent(t, 1.5, false)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerAddCondition(t, Condition(function CBA))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveReal(HY, h, 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId())* 7.5)
	set t = null
	set WUE = null
endfunction
function CCA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local player p
	local integer level = GetUnitAbilityLevel(WUE,'A1IN')
	local real KGX = GetGameTime()
	local real CDA = LoadReal(HY, h, 415)
	local real CFA = LoadReal(HY, h, 416)
	local integer FTX
	if UnitIsDead(WUE) then
		set t = null
		set WUE = null
		return false
	endif
	if IsSentinelsPlayer(GetOwningPlayer(WUE)) then
		set p = Scourges[1]
	else
		set p = Sentinels[1]
	endif
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED and GetOwningPlayer(GetEventDamageSource())== BW then
		if GetUnitAbilityLevel(WUE,'A1IE')> 0 then
			call UnitRemoveAbility(WUE,'A1IE')
			call UnitRemoveAbility(WUE,'B0C9')
		endif
		if GetUnitAbilityLevel(WUE,'A1IF')> 0 then
			call UnitRemoveAbility(WUE,'A1IF')
			call UnitRemoveAbility(WUE,'B0C9')
		endif
		if GetUnitAbilityLevel(WUE,'A1IG')> 0 then
			call UnitRemoveAbility(WUE,'A1IG')
			call UnitRemoveAbility(WUE,'B0C9')
		endif
		call SaveReal(HY, h, 414,(KGX + 2)* 1.)
		set t = null
		set WUE = null
		return false
	endif
	if(LoadReal(HY, h, 414))> KGX then
		set t = null
		set WUE = null
		return false
	endif
	if(UnitVisibleToPlayer(WUE, p) and GetUnitAbilityLevel(WUE,'A1HX')== 0) or GetUnitAbilityLevel(WUE,'A36D')== 1 then
		set CFA = 0
		if GetUnitAbilityLevel(WUE,'A1IE')> 0 or GetUnitAbilityLevel(WUE,'A1IF')> 0 or GetUnitAbilityLevel(WUE,'A1IG')> 0 then
			set CDA = CDA + .1
			if CDA > .4 then
				set CDA = 0
				if GetUnitAbilityLevel(WUE,'A1IE')> 0 then
					call UnitRemoveAbility(WUE,'A1IE')
					call UnitRemoveAbility(WUE,'B0C9')
				endif
				if GetUnitAbilityLevel(WUE,'A1IF')> 0 then
					call UnitRemoveAbility(WUE,'A1IF')
					call UnitRemoveAbility(WUE,'B0C9')
				endif
				if GetUnitAbilityLevel(WUE,'A1IG')> 0 then
					call UnitRemoveAbility(WUE,'A1IG')
					call UnitRemoveAbility(WUE,'B0C9')
				endif
			endif
		endif
		call SaveReal(HY, h, 415, CDA * 1.)
		call SaveReal(HY, h, 416, CFA * 1.)
	elseif(UnitVisibleToPlayer(WUE, p)== false or GetUnitAbilityLevel(WUE,'A1HX')> 0) and GetUnitAbilityLevel(WUE,'A36D')== 0 then
		set CDA = 0
		if(GetUnitAbilityLevel(WUE,'A1IE'-1 + level)== 0) then
			set CFA = CFA + .1
			if CFA > .4 then
				set CFA = 0
				if level == 1 then
					if GetUnitAbilityLevel(WUE,'A1IE')== 0 then
						call UnitAddPermanentAbility(WUE,'A1IE')
						call UnitMakeAbilityPermanent(WUE, true,'A1I7')
						call UnitMakeAbilityPermanent(WUE, true,'A1I8')
					endif
				endif
				if level == 2 then
					if GetUnitAbilityLevel(WUE,'A1IE')> 0 then
						call UnitRemoveAbility(WUE,'A1IE')
						call UnitRemoveAbility(WUE,'B0C9')
					endif
					if GetUnitAbilityLevel(WUE,'A1IF')== 0 then
						call UnitAddPermanentAbility(WUE,'A1IF')
						call UnitMakeAbilityPermanent(WUE, true,'A1I7')
						call UnitMakeAbilityPermanent(WUE, true,'A1I9')
					endif
				endif
				if level == 3 then
					if GetUnitAbilityLevel(WUE,'A1IE')> 0 then
						call UnitRemoveAbility(WUE,'A1IE')
						call UnitRemoveAbility(WUE,'B0C9')
					endif
					if GetUnitAbilityLevel(WUE,'A1IF')> 0 then
						call UnitRemoveAbility(WUE,'A1IF')
						call UnitRemoveAbility(WUE,'B0C9')
					endif
					if GetUnitAbilityLevel(WUE,'A1IG')== 0 then
						call UnitAddPermanentAbility(WUE,'A1IG')
						call UnitMakeAbilityPermanent(WUE, true,'A1I7')
						call UnitMakeAbilityPermanent(WUE, true,'A1IA')
					endif
				endif
			endif
		elseif UnitIsDead(WUE)== false then
			set FTX = 2 + level
			call SetWidgetLife(WUE, GetWidgetLife(WUE)+ GetUnitState(WUE, UNIT_STATE_MAX_LIFE)/1000* FTX)
		endif
		call SaveReal(HY, h, 415, CDA * 1.)
		call SaveReal(HY, h, 416, CFA * 1.)
	endif
	set t = null
	set WUE = null
	return false
endfunction
function M9E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveReal(HY, h, 415, .0)
	call SaveReal(HY, h, 416, .0)
	call SaveReal(HY, h, 414, GetGameTime())
	call SaveUnitHandle(HY, h, 2, GetTriggerUnit())
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterUnitEvent(t, GetTriggerUnit(), EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function CCA))
	set t = null
endfunction
function CGA takes unit R8X, unit SZX returns boolean
	if GetUnitAbilityLevel(SZX,'A1HX')> 0 then
		call IssueImmediateOrderById(R8X,$D0004)
		call InterfaceErrorForPlayer(GetOwningPlayer(R8X), "不能攻击该单位")
		return true
	endif
	return false
endfunction
function CHA takes nothing returns nothing
	local unit WLE = GetSpellTargetUnit()
	local unit u = GetTriggerUnit()
	if GetUnitAbilityLevel(WLE,'A1HX')> 0 and((IsUnitEnemy(WLE, GetOwningPlayer(u)) and GetUnitAbilityLevel(u,'Aloc')== 0) or IsUnitType(u, UNIT_TYPE_HERO)== false and GetUnitTypeId(u)!='u00L') then
		call IssueImmediateOrderById(u,$D0004)
		if IsUnitType(u, UNIT_TYPE_HERO)== false then
			call InterfaceErrorForPlayer(GetOwningPlayer(u), "不能以该单位为目标")
		endif
	endif
	set WLE = null
	set u = null
endfunction
function PLX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_CAST)
	call TriggerAddCondition(t, Condition(function CHA))
	set t = null
endfunction
function CJA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer E5X = LoadInteger(HY, h, 422)
	local integer E6X = LoadInteger(HY, h, 423)
	local integer E4X = LoadInteger(HY, h, 424)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		if(LoadBoolean(HY, h, 276))== false and GetTriggerUnit()== WUE then
			call SaveBoolean(HY, h, 276,(true))
			call SetHeroAgi(WUE, GetHeroAgi(WUE, false)-E5X -E6X -E4X, true)
			call SaveInteger(K, GetHandleId(WUE), 31, LoadInteger(K, GetHandleId(WUE), 31)-E5X -E6X -E4X)
			call SetAbilitydataD(WUE,'QP1F', LoadInteger(K, GetHandleId(WUE), 31))
			if LoadInteger(HY, h, 0)> 0 then
				call LodSystem_ReduceUnitExtraState(WUE, LoadInteger(HY, h, 0), STATE_SYSTEM_DAMAGE)
			endif
		elseif(LoadBoolean(HY, h, 277))== false and GetTriggerUnit()== targetUnit then
			call SaveBoolean(HY, h, 277,(true))
			call SetHeroAgi(targetUnit, GetHeroAgi(targetUnit, false)+ E5X, true)
			call SetHeroStr(targetUnit, GetHeroStr(targetUnit, false)+ E6X, true)
			call SetHeroInt(targetUnit, GetHeroInt(targetUnit, false)+ E4X, true)
		endif
	else
		if(LoadBoolean(HY, h, 276))== false then
			call SaveBoolean(HY, h, 276,(true))
			call SetHeroAgi(WUE, GetHeroAgi(WUE, false)-E5X -E6X -E4X, true)
			call SaveInteger(K, GetHandleId(WUE), 31, LoadInteger(K, GetHandleId(WUE), 31)-E5X -E6X -E4X)
			call SetAbilitydataD(WUE,'QP1F', LoadInteger(K, GetHandleId(WUE), 31))
			if LoadInteger(HY, h, 0)> 0 then
				call LodSystem_ReduceUnitExtraState(WUE, LoadInteger(HY, h, 0), STATE_SYSTEM_DAMAGE)
			endif
		endif
		if(LoadBoolean(HY, h, 277))== false then
			call SaveBoolean(HY, h, 277,(true))
			call SetHeroAgi(targetUnit, GetHeroAgi(targetUnit, false)+ E5X, true)
			call SetHeroStr(targetUnit, GetHeroStr(targetUnit, false)+ E6X, true)
			call SetHeroInt(targetUnit, GetHeroInt(targetUnit, false)+ E4X, true)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function CKA takes unit u, unit targetUnit returns nothing
	local trigger t
	local integer h
	local integer agi
	local integer str
	local integer int
	local integer i = LoadInteger(P, GetHandleId(u), QL)+ 1
	local integer TME = GetPlayerId(GetOwningPlayer(u))
	set agi = IMinBJ(GetHeroAgi(targetUnit, false)-1, 1)
	set str = IMinBJ(GetHeroStr(targetUnit, false)-1, 1)
	set int = IMinBJ(GetHeroInt(targetUnit, false)-1, 1)
	if i > 3 then
		set i = 1
	endif
	call SaveInteger(P, GetHandleId(u), QL, i)
	if((not(Mode__BalanceOff)) and(i < 3 or IsUnitIdType(GetUnitTypeId(u), UNIT_TYPE_RANGED_ATTACKER)== false)) or Mode__BalanceOff then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SetHeroAgi(u, GetHeroAgi(u, false)+ agi + str + int, true)
		call SaveInteger(K, GetHandleId(u), 31, LoadInteger(K, GetHandleId(u), 31)+ agi + str + int)
		call SetAbilitydataD(u,'QP1F', LoadInteger(K, GetHandleId(u), 31))
		if GetHeroPrimaryAttributesType(u)!= 3 then
			call LodSystem_AddUnitExtraState(u, agi + str + int, STATE_SYSTEM_DAMAGE)
			call SaveInteger(HY, h, 0, agi + str + int)
		endif
		call SetHeroAgi(targetUnit, GetHeroAgi(targetUnit, false)-agi, true)
		call SetHeroStr(targetUnit, GetHeroStr(targetUnit, false)-str, true)
		call SetHeroInt(targetUnit, GetHeroInt(targetUnit, false)-int, true)
		call SaveInteger(HY, h, 422, agi)
		call SaveInteger(HY, h, 424, str)
		call SaveInteger(HY, h, 423, int)
		call SaveUnitHandle(HY, h, 2, u)
		call SaveUnitHandle(HY, h, 17, targetUnit)
		call SaveBoolean(HY, h, 276, false)
		call SaveBoolean(HY, h, 277, false)
		call TriggerRegisterTimerEvent(t, 20 * GetUnitAbilityLevel(u,'A1HR') , false)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function CJA))
		set t = null
	endif
	set t = null
endfunction
function CLA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 2)
	local unit target = LoadUnitHandle(HY, h, 17)
	if GetTriggerEventId()!= EVENT_WIDGET_DEATH then
		call CKA(u, target)
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set target = null
	return false
endfunction
function CMA takes unit u, unit target returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerAddCondition(t, Condition(function CLA))
	call TriggerRegisterDeathEvent(t, u)
	call TriggerRegisterDeathEvent(t, target)
	call SaveUnitHandle(HY, h, 2, u)
	call SaveUnitHandle(HY, h, 17, target)
	set t = null
endfunction
function CPA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 2)
	local unit d = LoadUnitHandle(HY, h, 19)
	if GetUnitAbilityLevel(u,'A1HX') == 0 then
		call KillUnit(d)
		call SetUnitState(u, UNIT_STATE_TYPE, 2)	//恢复目标类型为地面
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SetUnitX(d, GetUnitX(u))
		call SetUnitY(d, GetUnitY(u))
	endif
	set t = null
	set u = null
	set d = null
	return false
endfunction
function BKE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit d = CreateUnit(GetOwningPlayer(u),'h0B1', GetUnitX(u), GetUnitY(u), 0)
	local integer lv = GetUnitAbilityLevel(u,'A1IN')
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer i = 3
	call EXShowHideUnit(u)
	if lv > 1 then
		set i = 4
	endif
	call CXX(u,'A1HW', 1, i)
	call CXX(u,'A1HX', 1, i)
	call SetUnitState(u, UNIT_STATE_TYPE, 0)
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function CPA))
	call SaveUnitHandle(HY, h, 19,(d))
	call SaveUnitHandle(HY, h, 2,(u))
	set u = null
	set d = null
	set t = null
endfunction
function CSA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer EVX = GetTriggerEvalCount(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local lightning APX = LoadLightningHandle(HY, h,$C4)
	local integer level = LoadInteger(HY, h, 5)
	local real WYE = LoadReal(HY, h, 189)
	local real WZE = LoadReal(HY, h,$BE)
	local real W_E = GetUnitX(targetUnit)
	local real W0E = GetUnitY(targetUnit)
	local real NBX
	local real NCX
	local real GXR = LoadReal(HY, h, 23)
	local real GOR = LoadReal(HY, h, 24)
	local real a
	local real GIX = GetDistanceBetween(GXR, GOR, W_E, W0E)
	call SaveReal(HY, h, 23,((W_E)* 1.))
	call SaveReal(HY, h, 24,((W0E)* 1.))
	if GIX > 100  or EVX >(3.5 / .03) or IsMagicImmuneUnit(targetUnit) or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call DestroyLightning(APX)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call MoveLightning(APX, true, WYE, WZE, W_E, W0E)
		if GetDistanceBetween(WYE, WZE, W_E, W0E)> 325 then
			set a = Atan2(W0E -WZE, W_E -WYE)
			set NBX = WYE + 325 * Cos(a)
			set NCX = WZE + 325 * Sin(a)
			call SetUnitX(targetUnit, NBX)
			call SetUnitY(targetUnit, NCX)
		endif
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set APX = null
	return false
endfunction
function CTA takes unit WUE, unit targetUnit, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local lightning APX = AddLightning("PONC", true, GetUnitX(WUE), GetUnitY(WUE), GetUnitX(targetUnit), GetUnitY(targetUnit))
	call SetLightningColor(APX, 1, 1, 1, 1)
	call SaveLightningHandle(HY, h,$C4,(APX))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h, 189,((GetUnitX(WUE))* 1.))
	call SaveReal(HY, h, 190,((GetUnitY(WUE))* 1.))
	call SaveReal(HY, h, 23,((GetUnitX(targetUnit))* 1.))
	call SaveReal(HY, h, 24,((GetUnitY(targetUnit))* 1.))
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function CSA))
	call UnitDamageTargetEx(WUE, targetUnit, 1, 60 * level)
	call IssueTargetOrderById(WUE, 851983, targetUnit)
	set t = null
	set APX = null
endfunction
function CUA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer EVX = GetTriggerEvalCount(t)
	local integer level = LoadInteger(HY, h, 5)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local real a = LoadReal(HY, h, 13)
	local real JBR = LoadReal(HY, h, 189)
	local real JCR = LoadReal(HY, h,$BE)
	local real W_E = LoadReal(HY, h, 47)
	local real W0E = LoadReal(HY, h, 48)
	local real NBX = JBR +(30 *(20 + 4 * 2)/ 30)* EVX * Cos(a * bj_DEGTORAD)
	local real NCX = JCR +(30 *(20 + 4 * 2)/ 30)* EVX * Sin(a * bj_DEGTORAD)
	local real ZNR = SquareRoot((NBX -W_E)*(NBX -W_E)+(NCX -W0E)*(NCX -W0E))
	local real ZBR = 700
	local real ZCR = 175
	local real ZDR =(1 -ZNR / ZBR)* ZCR * 2
	local group g = LoginGroup(428)
	local unit targetUnit
	if EVX == 1 then
		call SetUnitTimeScale(WUE, 1.5)
	endif
	if ZDR > ZCR then
		set ZDR = ZCR * 2 -ZDR
	endif
	if O0X(WUE)== false then
		call SetUnitFlyHeight(WUE, GetUnitDefaultFlyHeight(WUE)+ RMaxBJ(ZDR, 0), 0)
	endif
	if IsUnitType(WUE, UNIT_TYPE_HERO) then
		call SaveBoolean(K, GetHandleId(WUE), 99, true)
	endif
	call SetUnitX(WUE, CoordinateX50(NBX))
	call SetUnitY(WUE, CoordinateY50(NCX))
	call EXSetUnitFacing(WUE, a)
	set U2 = WUE
	call GroupEnumUnitsInRange(g, NBX, NCX, 120, Condition(function D8X))
	set targetUnit = FirstOfGroup(g)
	call LogoutGroup(g)
	if ZNR < 30 or targetUnit != null or GetTriggerEvalCount(t)> 75 then
		if O0X(WUE)== false then
			call SetUnitFlyHeight(WUE, GetUnitDefaultFlyHeight(WUE), 0)
		endif
		call SetUnitFacing(WUE, a)
		call SetUnitTimeScale(WUE, 1)
		call SetUnitAnimation(WUE, "stand")
		call SetUnitPathing(WUE, true)
		call UnitRemoveAbility(WUE,'A1J6')
		call KillDestructablesInCircle(GetUnitX(WUE), GetUnitY(WUE), 100)
		if targetUnit != null and IsMagicImmuneUnit(targetUnit)== false then
			call EPX(targetUnit, 4408, 5)
			call CTA(WUE, targetUnit, level)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set g = null
	return false
endfunction
function BLE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u,'A1J7')
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real GIX = 700
	local real a
	local real WYE
	local real WZE
	local real W_E
	local real W0E
	if GetUnitTypeId(u)=='e00E' then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))] 
	endif
	set a = GetUnitFacing(u)
	set WYE = GetUnitX(u)
	set WZE = GetUnitY(u)
	set W_E = CoordinateX50(WYE + GIX * Cos(a * bj_DEGTORAD))
	set W0E = CoordinateY50(WZE + GIX * Sin(a * bj_DEGTORAD))
	call UnitAddAbility(u,'Amrf')
	call UnitRemoveAbility(u,'Amrf')
	call SetUnitPathing(u, false)
	call UnitAddPermanentAbility(u,'A1J6')
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerAddCondition(t, Condition(function CUA))
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveReal(HY, h, 189,((WYE)* 1.))
	call SaveReal(HY, h, 190,((WZE)* 1.))
	call SaveReal(HY, h, 47,((W_E)* 1.))
	call SaveReal(HY, h, 48,((W0E)* 1.))
	set u = null
	set t = null
endfunction
function CWA takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit WUE = U2
	local unit targetUnit = W2
	local real IXX = LoadReal(HY, h, 20)
	call UnitDamageTargetEx(WUE, targetUnit, 1, IXX)
	set WUE = null
	set targetUnit = null
endfunction
function CYA takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetEnumUnit()
	local trigger t = NHX(WUE, targetUnit,'h0BP', "CWA", 700, false)
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(WUE,'A04A')
	local real IXX
	if level == 1 then
		set IXX = 135
	elseif level == 2 then
		set IXX = 215
	elseif level == 3 then
		set IXX = 275
	elseif level == 4 then
		set IXX = 350
	endif
	call SaveReal(HY, h, 20,((IXX)* 1.))
	set WUE = null
	set targetUnit = null
	set t = null
endfunction
function BPE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local group g = LoginGroup(429)
	local integer level = GetUnitAbilityLevel(WUE,'A04A')
	call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 500, Condition(function DDX))
	call ForGroup(g, function CYA)
	call LogoutGroup(g)
	call PlaySoundOnUnitBJ(QE, 100, WUE)
	set WUE = null
	set g = null
endfunction
function CZA takes unit u, unit W_V returns boolean
	return(IsUnitEnemy(W_V, GetOwningPlayer(u)) and(IsAliveNotStrucNotWard(u)))!= null
endfunction
function C_A takes unit u, unit SZX, integer dt, real ZCE, boolean C0A returns nothing
	if CZA(SZX, u) then
		if IsMagicImmuneUnit(SZX)== false then
			call UnitDamageTargetEx(u, SZX, dt, ZCE)
		elseif C0A then
			call UnitDamageTargetEx(u, SZX, 7, ZCE)
		endif
	endif
endfunction
function C1A takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local real ZCE = LoadReal(HY, h, 0)
	local real radian = LoadReal(HY, h, 3)* bj_DEGTORAD
	local real N3X = LoadReal(HY, h, 4)
	local real tX = LoadReal(HY, h, 5)
	local real tY = LoadReal(HY, h, 6)
	local real C2A = LoadReal(HY, h, 8)
	local real LMR = LoadReal(HY, h, 9)
	local unit SZX
	local group g
	local group gg
	local boolean C3A = LoadBoolean(HY, h, 10)
	local boolean C4A = false
	local integer dt = LoadInteger(HY, h, 1)
	local boolean C0A = LoadBoolean(HY, h, 0)
	if GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		call SetUnitX(u, GetUnitX(u)+ N3X * Cos(radian))
		call SetUnitY(u, GetUnitY(u)+ N3X * Sin(radian))
		call SaveInteger(HY, h, 12, LoadInteger(HY, h, 12)+ 1)
		if GetDistanceBetween(GetUnitX(u), GetUnitY(u), tX, tY)< 100  or LoadInteger(HY, h, 12)> LoadInteger(HY, h, 13) then
			set C4A = true
			call SetUnitX(u, tX)
			call SetUnitY(u, tY)
		endif
	else
		set SZX = GetTriggerUnit()
	endif
	if C3A then
		set g = LoadGroupHandle(HY, h, 2)
		set gg = LoginGroup(430)
		set U2 = u
		call GroupEnumUnitsInRange(gg, GetUnitX(u), GetUnitY(u), C2A + LMR *(GetTriggerEvalCount(t)-1), Condition(function DUX))
		call GroupRemoveGroup(g, gg)
		loop
			set SZX = FirstOfGroup(gg)
		exitwhen SZX == null
			call GroupRemoveUnit(gg, SZX)
			call GroupAddUnit(g, SZX)
			call C_A(LoadUnitHandle(HY, h, 17), SZX, dt, ZCE, C0A)
		endloop
		call LogoutGroup(gg)
		set gg = null
		if C4A then
			call LogoutGroup(g)
		endif
	else
		call C_A(LoadUnitHandle(HY, h, 17), SZX, dt, ZCE, C0A)
	endif
	if C4A then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(u)
	endif
	set u = null
	set g = null
	set gg = null
	set t = null
endfunction
function C5A takes unit WJE, integer WPV, real ZCE, real O_A, real C2A, real QTR, real fX, real fY, real tX, real tY, real N3X, integer dt, boolean C0A returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real radian = AngleBetweenXY(fX, fY, tX, tY)
	local unit u = CreateUnit(GetOwningPlayer(WJE), WPV, fX, fY, radian)
	local real C6A = .02
	call SetUnitX(u, fX + C2A * Cos(radian * bj_DEGTORAD))
	call SetUnitY(u, fY + C2A * Sin(radian * bj_DEGTORAD))
	call SaveUnitHandle(HY, h, 0, u)
	call SaveReal(HY, h, 0, ZCE)
	call SaveReal(HY, h, 1, O_A)
	call SaveReal(HY, h, 2, QTR)
	call SaveUnitHandle(HY, h, 17, WJE)
	if C2A != QTR then
		call SaveReal(HY, h, 8, C2A)
		call SaveReal(HY, h, 9,(QTR -C2A)* C6A)
		call SaveGroupHandle(HY, h, 2, LoginGroup(431))
		call SaveBoolean(HY, h, 10, true)
	else
		call TriggerRegisterUnitInRange(t, u, QTR + 25, TrueBoolexprCondition)
	endif
	call SaveReal(HY, h, 3, radian)
	call SaveReal(HY, h, 4, N3X * C6A)
	call SaveInteger(HY, h, 13, R2I(O_A / LoadReal(HY, h, 4))+ 1)
	call SaveReal(HY, h, 5, GetUnitX(u)+ O_A * Cos(radian * bj_DEGTORAD))
	call SaveReal(HY, h, 6, GetUnitY(u)+ O_A * Sin(radian * bj_DEGTORAD))
	call SaveInteger(HY, h, 1, dt)
	call SaveBoolean(HY, h, 0, C0A)
	call TriggerRegisterTimerEvent(t, C6A, true)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerAddCondition(t, Condition(function C1A))
	set u = null
	set t = null
endfunction
function BSE takes nothing returns nothing
	local real ZCE = 325
	if GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId())== 3 then
		set ZCE = 555
	elseif GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId())== 2 then
		set ZCE = 440
	endif
	call C5A(GetTriggerUnit(),'h02C', ZCE, 800, 100, 450, GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetSpellTargetX(), GetSpellTargetY(), 800, 7, true)
endfunction
function BQE takes nothing returns nothing
	local real ZCE =$C8+ 90 * GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId())
	call C5A(GetTriggerUnit(),'h02C', ZCE, 800, 100, 450, GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetSpellTargetX(), GetSpellTargetY(), 800, 7, true)
endfunction
function C7A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE =(LoadUnitHandle(HY, h, 2))
	local unit WLE = LoadUnitHandle(HY, h, 3)
	local real r = LoadReal(HY, h, 0)-0.1
	local unit d
	if GetTriggerEventId()== EVENT_UNIT_SPELL_ENDCAST then
		call FIX(WLE)
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	elseif r <= 0 then
		call FIX(WLE)
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
		call EXStopUnit(WJE)
	else
		call SaveReal(HY, h, 0, r)
		call UnitDamageTargetEx(WJE, WLE, 1, LoadReal(HY, h, 1))
		if GetUnitAbilityLevel(WLE,'Bdet')== 0 then
			call FAX(WJE, WLE)
		endif
	endif
	set t = null
	set WJE = null
	set WLE = null
	return false
endfunction
function B3E takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(WJE,'A00P')
	local unit WLE = GetSpellTargetUnit()
	local real ZCE = 0
	local unit d
	if level == 1 then
		set ZCE = 4.28
	elseif level == 2 then
		set ZCE = 5.14
	elseif level == 3 then
		set ZCE = 5.58
	else
		set ZCE = 6.
	endif
	call TriggerRegisterTimerEvent(t, .1, true)
	call SaveReal(HY, h, 0, 2.75 + .75 * level)
	call SaveReal(HY, h, 1, ZCE)
	call TriggerRegisterUnitEvent(t, WJE, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function C7A))
	call SaveUnitHandle(HY, h, 2,(WJE))
	call SaveUnitHandle(HY, h, 3, WLE)
	call FAX(WJE, WLE)
	set WLE = null
	set WJE = null
	set t = null
endfunction
function SerpentWardEnterMapActions takes unit u returns nothing
	local integer level = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A0A8')
	if level > 0 then
		call UnitAddPermanentAbilitySetLevel(u,'A3IO', level)
	endif
endfunction
function B4E takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetUnitFacing(GetTriggerUnit()))
	call UnitAddAbility(d,'A3IB')
	call SetUnitAbilityLevel(d,'A3IB', GetUnitAbilityLevel(GetTriggerUnit(),'A010'))
	call IssueTargetOrderById(d,$D026B, GetSpellTargetUnit())
	set d = null
endfunction
function C9A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit WLE = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 5)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or GetTriggerEvalCount(t)== 4 or IsMagicImmuneUnit(WUE) then
		call WHV(WLE,'D011')
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	if GetTriggerEventId()!= EVENT_WIDGET_DEATH then
		call UnitDamageTargetEx(WUE, WLE, 1,$A+(level -1)* 20)
	endif
	set t = null
	set WLE = null
	set WUE = null
	return false
endfunction
function DVA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer c = LoadInteger(HY, h, 0)+ 1
	if IsMagicImmuneUnit(u) or c > 20 or UnitIsDead(u) then
		call UnitRemoveAbility(u,'A43V')
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	else
		call SaveInteger(HY, h, 0, c)
	endif
	set u = null
	set t = null
endfunction
function DEA takes unit u returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .1, true, function DVA)
	call UnitAddPermanentAbility(u,'A43V')
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	set t = null
endfunction
function DXA takes unit u, unit WUE, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerAddCondition(t, Condition(function C9A))
	call WJV(WUE,'C011','D011', 4)
	if IsUnitType(WUE, UNIT_TYPE_HERO) then
		call DEA(WUE)
	endif
	call SaveUnitHandle(HY, h, 2, u)
	call SaveUnitHandle(HY, h, 17, WUE)
	call SaveInteger(HY, h, 5,(level))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl", WUE, "chest")))
	set t = null
endfunction
function DOA takes nothing returns boolean
	local unit u = GetEnumUnit()
	if IsUnitInGroup(u, PVV)== false and not IsMagicImmuneUnit(u) then
		call GroupAddUnit(PVV, u)
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\FireBlast.mdx", u, "chest"))
		call DXA(PXV, u, PEV)
	endif
	set u = null
	return false
endfunction
function DRA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer EVX =(LoadInteger(HY, h, 34))
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local real WYE =(LoadReal(HY, h, 189))
	local real WZE =(LoadReal(HY, h,$BE))
	local real W_E =(LoadReal(HY, h, 47))
	local real W0E =(LoadReal(HY, h, 48))
	local real a =(LoadReal(HY, h, 13))
	local real DIA =(1 -I2R(EVX)/ 50)* bj_PI
	local real DAA =$578/ 2 * Cos(DIA)
	local real DNA = 500 / 2 * Sin(DIA)
	local real x = CoordinateX50(W_E + DAA * Cos(a)-DNA * Sin(a))
	local real y = CoordinateY50(W0E + DAA * Sin(a)+ DNA * Cos(a))
	local group CNO =(LoadGroupHandle(HY, h,$85))
	local group g
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or(GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()!='A1Z2' and EVX > 0) or EVX > 100  or C6X(WUE) then
		call KillDestructablesInCircle(x, y, 300)
		call SetUnitVertexColorEx(WUE,-1,-1,-1, 255)
		if  Rubick_AbilityFilter(WUE , 'A1RJ') then
			call S9E(GetOwningPlayer(WUE),'A1RJ', true)
		endif
		call S9E(GetOwningPlayer(WUE),'A20N', false)
		call SetUnitPathing(WUE, true)
		call LogoutGroup(CNO)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		if ModuloInteger(EVX, 10)== 0 then
			call KillDestructablesInCircle(x, y, 200)
		endif
		call SaveInteger(HY, h, 34,(EVX + 1))
		if IsUnitType(WUE, UNIT_TYPE_HERO) then
			call SaveBoolean(K, GetHandleId(WUE), 99, true)
		endif
		call SetUnitX(WUE, x)
		call SetUnitY(WUE, y)
		call SetUnitFacing(WUE,(a + DIA -bj_PI / 2)* bj_RADTODEG)
		set g = LoginGroup(432)
		set PVV = CNO
		set U2 = WUE
		set PXV = WUE
		set PEV = level
		call GroupEnumUnitsInRange(g, x, y, 325, Condition(function DQX))
		call ForGroup(g, function DOA)
		call LogoutGroup(g)
	endif
	set t = null
	set WUE = null
	set g = null
	set CNO = null
	return false
endfunction
function B6E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local real WYE = GetUnitX(WUE)
	local real WZE = GetUnitY(WUE)
	local real a = AngleBetweenXY(WYE, WZE, GetSpellTargetX(), GetSpellTargetY())* bj_DEGTORAD
	local real W_E = WYE +$578/ 2 * Cos(a)
	local real W0E = WZE +$578/ 2 * Sin(a)
	local real L2O = GetWidgetLife(WUE)
	call SetWidgetLife(WUE, L2O -L2O * .15)
	call EPX(WUE, 4301, 2)
	call EPX(WUE, 4415, 2)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function DRA))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveReal(HY, h, 189,((WYE)* 1.))
	call SaveReal(HY, h, 190,((WZE)* 1.))
	call SaveReal(HY, h, 47,((W_E)* 1.))
	call SaveReal(HY, h, 48,((W0E)* 1.))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	call SaveGroupHandle(HY, h,$85,(LoginGroup(433)))
	call SetUnitPathing(WUE, false)
	call SetUnitVertexColorEx(WUE,-1,-1,-1, 50)
	call UnitAddPermanentAbility(WUE,'A20N')
	call S9E(GetOwningPlayer(WUE),'A1RJ', false)
	call S9E(GetOwningPlayer(WUE),'A20N', true)
	set t = null
	set WUE = null
endfunction
function DBA takes nothing returns nothing
	local unit WUE = POV
	local unit targetUnit = GetEnumUnit()
	call UnitDamageTargetEx(WUE, targetUnit, 1, 40 + 20 * PRV)
	call AddSpecialEffectTargetToTimed("Doodads\\Cinematic\\FireTrapUp\\FireTrapUp.mdl", targetUnit, "origin", 1)
	set WUE = null
	set targetUnit = null
endfunction
function DCA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local integer level = LoadInteger(HY, h, 0)
	local group g
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set U2 = WUE
		set POV = WUE
		set PRV = level
		set g = LoginGroup(434)
		call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE),$401, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call ForGroup(g, function DBA)
		call LogoutGroup(g)
		set g = null
	endif
	set t = null
	set WUE = null
	return false
endfunction
function DDA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit DFA = LoadUnitHandle(HY, h, 589)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit WLE = LoadUnitHandle(HY, h, 3)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if AD > 0 or IsUnitIllusion(GetEventDamageSource()) then
			call SetUnitToReduceDamage(DFA, GetEventDamage())
		endif
	else
		if GetUnitX(DFA)!= x or GetUnitY(DFA)!= y then
			call SetUnitPosition(DFA, x, y)
		endif
		call IssueImmediateOrderById(WLE,$D0004)
		if GetUnitX(WLE)!= x or GetUnitY(WLE)!= y then
			call SetUnitPosition(WLE, x, y)
		endif
		if GetUnitY(WUE)!= x or GetUnitY(WUE)!= y then
			call SetUnitPosition(WUE, x, y)
		endif
		set DFA = LoadUnitHandle(HY, h, 19)
		call SetUnitX(DFA, GetWidgetX(WUE))
		call SetUnitY(DFA, GetWidgetY(WUE))
	endif
	if GetTriggerEvalCount(t)== 1 then
		call PauseUnit(WUE, true)
	endif
	set t = null
	set DFA = null
	set WUE = null
	return false
endfunction
function DGA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit WLE = LoadUnitHandle(HY, h, 3)
	local unit DHA = LoadUnitHandle(HY, h, 588)
	local unit DFA = LoadUnitHandle(HY, h, 589)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local unit DJA = LoadUnitHandle(HY, h,$EF)
	local integer level = LoadInteger(HY, h, 0)
	local group g
	local unit dummyUnit
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		call StopSound(IF, false, false)
		call ShowUnit(DHA, false)
		call ShowUnit(DJA, false)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call ShowUnit(WUE, true)
		call UnitRemoveAbility(WUE,'A04R')
		call SetUnitInvulnerableEx(WUE, false)
		call PauseUnit(WUE, false)
		if WLE != null and WLE != WUE then
			call ShowUnit(WLE, true)
			call UnitRemoveAbility(WLE,'A04R')
			call SetUnitInvulnerableEx(WLE, false)
			call PauseUnit(WLE, false)
			if LocalPlayer== GetOwningPlayer(WLE) then
				call ClearSelection()
				call SelectUnit(WLE, true)
			endif
			call SetWidgetLife(WLE, 1)
			set dummyUnit = CreateUnit(GetOwningPlayer(GetKillingUnit()),'e00E', 0, 0, 0)
			if IsUnitType(WLE, UNIT_TYPE_SUMMONED)== false then
				call UnitRemoveBuffs(WLE, true, true)
			endif
			call UnitRemoveAbility(WLE,'Aetl')
			call UnitDamageTargetEx(dummyUnit, WLE, 4,$5F5E100)
		endif
		if LocalPlayer== GetOwningPlayer(WUE) then
			call ClearSelection()
			call SelectUnit(WUE, true)
		endif
		call SetWidgetLife(WUE, 1)
		set dummyUnit = CreateUnit(GetOwningPlayer(GetKillingUnit()),'e00E', 0, 0, 0)
		if IsUnitType(WUE, UNIT_TYPE_SUMMONED)== false then
			call UnitRemoveBuffs(WUE, true, true)
		endif
		call UnitRemoveAbility(WUE,'Aetl')
		call UnitDamageTargetEx(dummyUnit, WUE, 4,$5F5E100)
		set dummyUnit = null
	else
		if GetTriggerEvalCount(t)== 1 then
			call SetUnitFlyHeight(DFA, 0, 200)
		elseif GetTriggerEvalCount(t)== 2 then
			call PauseUnit(DFA, false)
			call UnitApplyTimedLife(DFA,'BTLF', .1)
			call StopSound(IF, false, false)
			call StartSound(OF)
			call DestroyEffect(AddSpecialEffect("war3mapImported\\FireNova2.mdx", GetUnitX(DHA), GetUnitY(DHA)))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call ShowUnit(WUE, true)
			call UnitRemoveAbility(WUE,'A04R')
			call GBX(WLE)
			call TWE(WUE, false)
			call FixUnitSkillsBug(WUE)
			call SetUnitInvulnerableEx(WUE, false)
			call SetUnitAnimationByIndex(WUE, 8)
			call QueueUnitAnimation(WUE, "idle")
			call PauseUnit(WUE, false)
			if LocalPlayer== GetOwningPlayer(WUE) then
				call ClearSelection()
				call SelectUnit(WUE, true)
			endif
			if WLE != null and WLE != WUE then
				call ShowUnit(WLE, true)
				call UnitRemoveAbility(WLE,'A04R')
				call SetUnitInvulnerableEx(WLE, false)
				call SetUnitAnimationByIndex(WLE, 8)
				call QueueUnitAnimation(WLE, "idle")
				call PauseUnit(WLE, false)
				call TWE(WLE, false)
				call FixUnitSkillsBug(WLE)
				call GBX(WLE)
				if LocalPlayer== GetOwningPlayer(WLE) and IsUnitIllusion(WLE)== false then
					call ClearSelection()
					call SelectUnit(WLE, true)
				endif
				call EPX(WLE,'AFRZ', .03)
				call SetWidgetLife(WLE, GetUnitState(WLE, UNIT_STATE_MAX_LIFE))
				call SetUnitState(WLE, UNIT_STATE_MANA, GetUnitState(WLE, UNIT_STATE_MAX_MANA))
			endif
			call ShowUnit(DHA, false)
			call ShowUnit(DJA, false)
			call EPX(WUE,'AFRZ', .03)
			call SetWidgetLife(WUE, GetUnitState(WUE, UNIT_STATE_MAX_LIFE))
			call SetUnitState(WUE, UNIT_STATE_MANA, GetUnitState(WUE, UNIT_STATE_MAX_MANA))
			set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(WUE), GetUnitY(WUE), 0)
			call UnitAddPermanentAbility(dummyUnit,'A1ZT')
			call SetUnitAbilityLevel(dummyUnit,'A1ZT', level)
			call IssueImmediateOrderById(dummyUnit,$D009F)
			set dummyUnit = null
		endif
	endif
	set t = null
	set WUE = null
	set DHA = null
	set DJA = null
	set DFA = null
	set g = null
	set WLE = null
	return false
endfunction
function DKA takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local real x = GetUnitX(WUE)
	local real y = GetUnitY(WUE)
	local unit DHA
	local unit DFA
	local unit DJA = CreateUnit(GetOwningPlayer(WUE),'h0CL', GetUnitX(WUE), GetUnitY(WUE), 0)
	local integer level = GetUnitAbilityLevel(WUE,'A1RK')+ GetUnitAbilityLevel(WUE,'A43H')
	local unit dummyUnit
	local unit WLE = GetSpellTargetUnit()
	set DHA = CreateUnit(GetOwningPlayer(WUE),'h0BX', x, y, 0)
	if level == 1 then
		set DFA = CreateUnit(GetOwningPlayer(WUE),'h0CV', x, y, 0)
	elseif level == 2 then
		set DFA = CreateUnit(GetOwningPlayer(WUE),'h0CX', x, y, 0)
	elseif level == 3 then
		set DFA = CreateUnit(GetOwningPlayer(WUE),'h0CW', x, y, 0)
	endif
	call AddSpecialEffectTarget("war3mapImported\\PhoenixDown_2.mdl", DHA, "origin")
	if LocalPlayer== GetOwningPlayer(WUE) then
		call ClearSelection()
		call SelectUnit(DFA, true)
	endif
	call KillDestructablesInCircle(x, y, 400)
	call SetUnitInvulnerableEx(WUE, true)
	call ShowUnit(WUE, false)
	call UnitAddPermanentAbility(WUE,'A04R')
	if WLE != null and WLE != WUE then
		call ShowUnit(WLE, false)
		call UnitAddPermanentAbility(WLE,'A04R')
		call SetUnitX(WLE, x)
		call SetUnitY(WLE, y)
	endif
	call StartSound(IF)
	call UnitRemoveAbility(DFA,'Arav')
	call EXPauseUnit(DFA,true)
	call UnitApplyTimedLife(DHA,'BTLF', 6.1)
	call UnitApplyTimedLife(DJA,'BTLF', 6.1)
	call UnitApplyTimedLife(DFA,'BTLF', 6.1)
	call TriggerRegisterTimerEvent(t, 5.2, false)
	call TriggerRegisterTimerEvent(t, 6, false)
	call TriggerAddCondition(t, Condition(function DGA))
	call TriggerRegisterUnitEvent(t, DFA, EVENT_UNIT_DEATH)
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 3, WLE)
	call SaveUnitHandle(HY, h, 588, DHA)
	call SaveUnitHandle(HY, h, 589, DFA)
	call SaveUnitHandle(HY, h,$EF, DJA)
	call SaveReal(HY, h, 6, GetUnitX(WUE)* 1.)
	call SaveReal(HY, h, 7, GetUnitY(WUE)* 1.)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterUnitEvent(t, DFA, EVENT_UNIT_DEATH)
	call TriggerAddCondition(t, Condition(function DCA))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterUnitEvent(t, DFA, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, DFA, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function DDA))
	call SaveUnitHandle(HY, h, 589, DFA)
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 3, WLE)
	call SaveReal(HY, h, 6, GetUnitX(WUE)* 1.)
	call SaveReal(HY, h, 7, GetUnitY(WUE)* 1.)
	if GYX(WUE,'I0A8') then
		set dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', x, y, 0)
		call UnitAddPermanentAbility(dummyUnit,'A04I')
		call SaveUnitHandle(HY, h, 19, dummyUnit)
		set dummyUnit = null
	endif
	set DJA = null
	set t = null
	set WUE = null
	set DHA = null
	set DFA = null
	set WLE = null
endfunction
function SpellEffect__Supernova takes nothing returns nothing
	if LoadInteger(HY, GetHandleId(GetTriggerUnit()),$10F447)!= 1 then
		call DKA()
	endif
endfunction
function PWX takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A1ZT')
endfunction
function DLA takes unit u, timer t, integer WFV returns nothing
	local player p = GetOwningPlayer(u)
	local integer W0V = GetHandleId(u)
	call DestroyLightning(LoadLightningHandle(P, WFV, 6))
	call DestroyLightning(LoadLightningHandle(P, WFV, 5))
	call DestroyLightning(LoadLightningHandle(P, WFV, 4))
	call DestroyLightning(LoadLightningHandle(P, WFV, 3))
	call DestroyLightning(LoadLightningHandle(P, WFV, 2))
	call LogoutGroup(LoadGroupHandle(P, WFV, 1))
	call SaveInteger(HY, W0V, 4312, 2)
	if Rubick_AbilityFilter(u , 'A1YY') then
		call S9E(p,'A1YY', true)
	endif
	if LoadInteger(HY, W0V, 4311)!= 1 then
		call UnitRemoveAbility(u,'Abun')
	endif
	call S9E(p,'A1YY', true)
	call SaveBoolean(P, W0V,'A1YY', false)
	call SaveBoolean(P, W0V,'A205', false)
	call UnitRemoveAbility(u,'A205')
	call UnitRemoveAbility(u,'A1Z3')
	call EXSetUnitPathing(u, true)
	call SetUnitAnimation(u, "stand")
	call StopSound(WF, false, true)
	call DestroyTimerAndFlushHT_P(t)
	set p = null
endfunction
function DMA takes nothing returns boolean
	local unit t = GetFilterUnit()
	if GetUnitAbilityLevel(t,'A04R')== 0 and UnitAlive(t) and IsUnitType(t, UNIT_TYPE_STRUCTURE)== false and t != Temp__ArrayUnit[0]and(IsUnitType(t, UNIT_TYPE_ANCIENT)== false or IsBearUnit(t)!= null) then
		call GroupAddUnit(LoadGroupHandle(P, XK[0], 1), t)
	endif
	set t = null
	return false
endfunction
function DPA takes nothing returns nothing
	local unit t = GetEnumUnit()
	local real O3O =(Temp__ArrayReal[0]+ Temp__ArrayReal[1]* GetUnitState(t, UNIT_STATE_MAX_LIFE))/ 5.
	if IsUnitAlly(Temp__ArrayUnit[0], GetOwningPlayer(t)) then
		call SetWidgetLife(t, GetWidgetLife(t)+ O3O * .5)
	else
		call UnitDamageTargetEx(Temp__ArrayUnit[0], t, 3, O3O)
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\FireRayTarget.mdx", t, "origin"))
		call A8X(GetOwningPlayer(t), 2, GetUnitX(Temp__ArrayUnit[0]), GetUnitY(Temp__ArrayUnit[0]), 500)
	endif
	set t = null
endfunction
function DQA takes unit u, integer WTV returns nothing
	if WTV =='A1Z3' or WTV =='A1RK' or WTV =='A43H' or WTV =='A27H' or WTV =='A30J' then
		call SaveBoolean(P, GetHandleId(u),'A1YY', true)
	endif
endfunction
function DSA takes unit u, integer S6V returns nothing
	local integer WFV
	local real x2
	local real y2
	local real x1
	local real y1
	if GetUnitAbilityLevel(u,'A205')> 0 then
		if S6V ==$D000F then
			call DisableTrigger(JJ)
			call EXStopUnit(u)
			call SetUnitAnimationByIndex(u, LoadInteger(P, GetUnitTypeId(u),'A1P8'))
			call EnableTrigger(JJ)
			return
		endif
		set WFV = LoadInteger(P, GetHandleId(u),'A1YY')
		if S6V == 852177 then
			call SaveBoolean(P, WFV, 1, true)
			call SetUnitAnimationByIndex(u, LoadInteger(P, GetUnitTypeId(u),'A1P8'))
		elseif S6V == 852178 then
			call SaveBoolean(P, WFV, 1, false)
			call SetUnitAnimation(u, "stand")
		endif
		if S6V ==851971 then
			set x1 = GetWidgetX(u)
			set y1 = GetWidgetY(u)
			if GetTriggerEventId()== EVENT_UNIT_ISSUED_TARGET_ORDER then
				set x2 = GetWidgetX(GetOrderTargetUnit())
				set y2 = GetWidgetY(GetOrderTargetUnit())
			else
				set x2 = GetOrderPointX()
				set y2 = GetOrderPointY()
			endif
			set x1 = Atan2(y2 -y1, x2 -x1)
			if 0 > x1 then
				set x1 = x1 + 6.28318
			endif
			call SaveBoolean(P, WFV, 0, true)
			call SaveReal(P, WFV, 0, x1)
			call SaveReal(P, WFV, 1, GetUnitFacing(u)* bj_DEGTORAD)
			call DisableTrigger(JJ)
			call EXStopUnit(u)
			call EnableTrigger(JJ)
		endif
	endif
endfunction
// 烈日炙烤
function DTA takes nothing returns nothing
	local group g = null
	local lightning l = null
	local timer t = GetExpiredTimer()
	local integer DSR
	local integer WUV
	local integer WVV = 2
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(P, WFV, 0)
	local unit u = LoadUnitHandle(P, WFV, 0)
	local boolean active = false
	local real IMX
	local real radian
	local real DUA
	local real DWA
	local real DYA
	local real DZA
	local real x2
	local real y2
	local real z2
	local real x1
	local real y1
	local real z1
	if LoadInteger(HY, GetHandleId(u), 704) == -1 then//同等脉冲新星,进行二次判断
		if not PlayerHaveAbilityByActive(GetOwningPlayer(u), 'A1YY') then
			set active = true
		endif
	endif 
	set DSR = GetHandleId(u)
	if UnitIsDead(u) or C5X(u) or X3X(u) or IsUnitPaused(u) or RCX(u) or active or UYX >$EF or LoadBoolean(P, DSR,'A1YY') then
		call DLA(u, t, WFV)
		set t = null
		set u = null
		return
	endif
	set x1 = GetWidgetX(u)
	set y1 = GetWidgetY(u)
	set DUA = GetWidgetLife(u)
	set radian = GetUnitFacing(u)* bj_DEGTORAD
	call SetWidgetLife(u, DUA -DUA * .0015)
	if LoadBoolean(P, WFV, 0) then
		set radian = LoadReal(P, WFV, 0)
		set DWA = radian -GetUnitFacing(u)* bj_DEGTORAD
		set IMX = LoadReal(P, WFV, 1)
		set DUA = radian -IMX
		if DUA > 0 then
			set DYA = bj_DEGTORAD / 2
		else
			set DYA =-bj_DEGTORAD / 2
		endif
		if -$B4* bj_DEGTORAD > DUA or DUA >$B4* bj_DEGTORAD then
			set DYA =-DYA
		endif
		set radian = IMX + DYA
		call SaveReal(P, WFV, 1, radian)
		if HaveSavedReal(P, WFV, 2) then
			if 0 > DWA then
				set DWA =-DWA
			endif
			if .02 > DWA then
				call SaveBoolean(P, WFV, 0, false)
				call RemoveSavedReal(P, WFV, 2)
			endif
		endif
		if LoadBoolean(P, WFV, 0) then
			call SaveReal(P, WFV, 2, DWA)
		endif
		if LoadInteger(HY, DSR, 4301)!= 1 then
			call SetUnitFacing(u, radian * bj_RADTODEG)
		endif
	endif
	if LoadBoolean(P, WFV, 1) then
		set x1 = CoordinateX50(x1 + 5 * Cos(radian))
		set y1 = CoordinateY50(y1 + 5 * Sin(radian))
		call KillDestructablesInCircle(x1, y1, 200)
		if IsUnitType(u, UNIT_TYPE_HERO) then
			call SaveBoolean(K, GetHandleId(u), 99, true)
		endif
		call SetUnitX(u, x1)
		call SetUnitY(u, y1)
	endif
	if UYX == 1 then
		call DisableTrigger(JJ)
		call EXStopUnit(u)
		call EnableTrigger(JJ)
	endif
	set DYA = Cos(radian)
	set DZA = Sin(radian)
	set radian =(GetUnitFacing(u)+ 90)* bj_DEGTORAD
	set DUA = Cos(radian)
	set DWA = Sin(radian)
	set x1 = GetWidgetX(u)+ 50 * DYA
	set y1 = GetWidgetY(u)+ 50 * DZA
	call MoveLocation(Temp__Location, x1, y1)
	set z1 = GetUnitFlyHeight(u)
	if 50 > z1 then
		set z1 = 50
	endif
	set z1 = z1 + GetLocationZ(Temp__Location)
	set x2 = x1 +$47E* DYA
	set y2 = y1 +$47E* DZA
	call MoveLocation(Temp__Location, x2, y2)
	set z2 = GetLocationZ(Temp__Location)
	loop
	exitwhen WVV == 7
		set radian = 30 *(WVV / 5)* Pow(-1, WVV)
		set IMX = 30 *((8 -WVV)/ 5)* Pow(-1, WVV)
		set l = LoadLightningHandle(P, WFV, WVV)
		call MoveLightningEx(l, false, x1 + radian * DUA, y1 + radian * DWA, z1 + IMX, x2, y2, z2)
		set WVV = WVV + 1
	endloop
	call DestroyEffect(AddSpecialEffect("war3mapImported\\FireRayTarget.mdx", x2, y2))
	call SaveInteger(P, WFV, 0, UYX + 1)
	if UYX /$A== UYX / 10. then
		set x2 = x1
		set y2 = y1
		set WVV = 0
		set g = LoadGroupHandle(P, WFV, 1)
		set Temp__ArrayUnit[0]= u
		set XK[0]= WFV
		loop
		exitwhen WVV == 26
			set x2 = x2 + 50 * DYA
			set y2 = y2 + 50 * DZA
			call GroupEnumUnitsInRange(AK, x2, y2, 100, Condition(function DMA))
			if WVV / 3 == WVV / 3.then
				call A8X(GetOwningPlayer(u), 2, x2, y2,$E1)
			endif
			set WVV = WVV + 1
		endloop
		set WUV = LoadInteger(P, WFV,-1)
		set radian = UYX / 239.
		set IMX = 8 * WUV + 8
		set Temp__ArrayReal[0]= IMX + IMX * radian
		set Temp__ArrayReal[1]=(WUV * 1.25 + radian *(WUV * 1.25))/ 100 
		call ForGroup(g, function DPA)
		call GroupClear(g)
	endif
	set g = null
	set u = null
	set t = null
	set l = null
endfunction
function SpellEffect__SunRay takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local timer t = CreateTimer()
	local integer WVV = 2
	local integer WFV = GetHandleId(t)
	local integer W0V = GetHandleId(u)
	call UnitAddPermanentAbility(u,'Abun') // 保持货物 缴械
	call UnitAddPermanentAbility(u,'A205') // 添加飘动技能
	call UnitAddPermanentAbility(u,'A1Z3') // 停止技能
	call S9E(GetOwningPlayer(u),'A1YY', false) // 禁用技能让其无法升级
	call EXSetUnitPathing(u, false)
	call SaveInteger(P, W0V,'A1YY', WFV)
	call SaveBoolean(P, W0V,'A1YY', false)
	call SaveUnitHandle(P, WFV, 0, u)
	call SaveGroupHandle(P, WFV, 1, LoginGroup(435))
	call SaveBoolean(P, WFV, 0, false)
	call SaveBoolean(P, WFV, 1, false)
	call SaveInteger(P, WFV,-1, GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call StartSound(WF)
	call SetSoundPosition(WF, GetWidgetX(u), GetWidgetY(u), 100)
	call SetUnitAnimationByIndex(u, LoadInteger(P, GetUnitTypeId(u),'A1P8'))
	loop
	exitwhen WVV == 7
		call SaveLightningHandle(P, WFV, WVV, AddLightning("SRAY", false, 0, 0, 0, 0))
		set WVV = WVV + 1
	endloop
	call TimerStart(t, .025, true, function DTA)
	set u = null
	set t = null
endfunction
function SYE takes nothing returns nothing
	call UnitAddPermanentAbility(GetTriggerUnit(),'A1YX')
	call SetUnitAbilityLevel(GetTriggerUnit(),'A1YX', GetUnitAbilityLevel(GetTriggerUnit(),'A331'))
endfunction
function D_A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(P, WFV, 0)
	local unit WLE = LoadUnitHandle(P, WFV, 0)
	if UYX <= 1 or IsMagicImmuneUnit(WLE) or UnitIsDead(WLE) then
		call RemoveSavedHandle(P, GetHandleId(WLE),'A1YX')
		call DestroyEffect(LoadEffectHandle(P, WFV, 2))
		call DestroyTimerAndFlushHT_P(t)
		call UnitRemoveAbility(WLE,'C010')
		call UnitRemoveAbility(WLE,'D010')
		set t = null
		set WLE = null
		return
	endif
	if UYX / 4 == UYX / 4. then
		call UnitDamageTargetEx(LoadUnitHandle(P, WFV, 1), WLE, 1, LoadInteger(P, WFV, 1))
	endif
	call SaveInteger(P, WFV, 0, UYX -1)
	set t = null
	set WLE = null
endfunction
function D0A takes unit WJE, unit WLE, integer level returns nothing
	local timer WIE = LoadTimerHandle(P, GetHandleId(WLE),'A1YX')
	local integer WFV
	if WIE != null then
		call SaveInteger(P, GetHandleId(WIE), 0, 16)
	else
		set WIE = CreateTimer()
		set WFV = GetHandleId(WIE)
		call SaveUnitHandle(P, WFV, 0, WLE)
		call SaveUnitHandle(P, WFV, 1, WJE)
		call SaveEffectHandle(P, WFV, 2, AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl", WLE, "chest"))
		call SaveInteger(P, WFV, 0, 16)
		call SaveInteger(P, WFV, 1, level * 20 -5)
		call TimerStart(WIE, .25, true, function D_A)
		call SaveTimerHandle(P, GetHandleId(WLE),'A1YX', WIE)
	endif
	set WIE = null
endfunction
function D1A takes unit WLE, integer level returns nothing
	call D0A(Temp__ArrayUnit[0], WLE, level)
	call UnitAddPermanentAbility(WLE,'C010')
endfunction
function D2A takes nothing returns boolean
	local unit t = GetFilterUnit()
	local unit u = Temp__ArrayUnit[0]
	if IsAliveNotStrucNotWard(t) and IsUnitEnemy(u, GetOwningPlayer(t)) and IsMagicImmuneUnit(t)== false then
		call AddAbilityToTimed(t,'A45O'-1 + WC, 1, 4, 0)
		call D1A(t, WC)
	endif
	set t = null
	set u = null
	return false
endfunction
function D3A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local unit u = LoadUnitHandle(HY, GetHandleId(t), 0)
	call ShowUnit(u, false)
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTimer(t)
	set u = null
	set t = null
endfunction
function D4A takes unit u, real d returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, d, false, function D3A)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	set t = null
endfunction
function D5A takes unit WUE, unit NIX, real x, real y, integer level returns nothing
	set Temp__ArrayUnit[0]= WUE
	set WC = level
	call GroupEnumUnitsInRange(AK, x, y, 200, Condition(function D2A))
	call DestroyEffect(AddSpecialEffect("war3mapImported\\Firaga_2.mdx", x, y))
	call KillUnit(NIX)
	call D4A(NIX, 1.)
endfunction
function D6A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer EVX = LoadInteger(HY, h, 34)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local unit D7A = LoadUnitHandle(HY, h, 393)
	local real D8A = LoadReal(HY, h, 685)
	local real W_E
	local real W0E
	local real x
	local real y
	local real a
	local real r = 18
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		set W_E = GetUnitX(targetUnit)
		set W0E = GetUnitY(targetUnit)
		call SaveReal(HY, h, 47, W_E * 1.)
		call SaveReal(HY, h, 48, W0E * 1.)
		call RemoveSavedHandle(HY, h, 17)
		call SaveUnitHandle(HY, h, 17, null)
	elseif targetUnit == null then
		set W_E = LoadReal(HY, h, 47)
		set W0E = LoadReal(HY, h, 48)
	else
		set W_E = GetUnitX(targetUnit)
		set W0E = GetUnitY(targetUnit)
	endif
	set a = AngleBetweenXY(GetUnitX(D7A), GetUnitY(D7A), W_E, W0E)
	call SetUnitFacing(D7A, a)
	set a = a * bj_DEGTORAD
	set x = GetWidgetX(D7A)+ r * Cos(a)
	set y = GetWidgetY(D7A)+ r * Sin(a)
	call SetUnitX(D7A, x)
	call SetUnitY(D7A, y)
	if GetDistanceBetween(x, y, W_E, W0E)< r * 2 then
		call D5A(WUE, D7A, x, y, level)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set D7A = null
	return false
endfunction
function D9A takes unit WUE, unit D7A, unit targetUnit, real D8A, unit dummyUnit returns nothing
	local trigger t = null
	local integer h
	if WUE == targetUnit then
		call KillUnit(D7A)
		call ShowUnit(D7A, false)
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SetUnitVertexColor(D7A, 255, 255, 255, 255)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function D6A))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveUnitHandle(HY, h, 393, D7A)
	call SaveReal(HY, h, 47, GetSpellTargetX()* 1.)
	call SaveReal(HY, h, 48, GetSpellTargetY()* 1.)
	call SaveReal(HY, h, 685, D8A * 1.)
	call SaveInteger(HY, h, 0, PI)
	set t = null
endfunction
function FVA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer EVX = LoadInteger(HY, h, 34)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local real WYE = GetUnitX(WUE)
	local real WZE = GetUnitY(WUE)
	local unit FEA = LoadUnitHandle(HY, h, 393)
	local unit FXA = LoadUnitHandle(HY, h, 394)
	local unit FOA = LoadUnitHandle(HY, h, 395)
	local unit FRA = LoadUnitHandle(HY, h, 396)
	local integer level = LoadInteger(HY, h, 0)
	local real a = GetUnitFacing(WUE)
	local real x
	local real y
	local group g
	local group g2
	local real VEI =-1 * 360 * .02 / 4
	local real a2
	local real IMX
	local real D8A = LoadReal(HY, h, 685)
	local real REI
	local unit dummyUnit = LoadUnitHandle(HY, h, 19)
	set PI = level
	if GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT then
		if GetSpellAbilityId()=='A1Z2' then
			if UnitIsDead(FEA)== false then
				call D9A(WUE, FEA, GetSpellTargetUnit(), D8A, dummyUnit)
				call RemoveSavedHandle(HY, h, 393)
			elseif UnitIsDead(FXA)== false then
				call D9A(WUE, FXA, GetSpellTargetUnit(), D8A, dummyUnit)
				call RemoveSavedHandle(HY, h, 394)
			elseif UnitIsDead(FOA)== false then
				call D9A(WUE, FOA, GetSpellTargetUnit(), D8A, dummyUnit)
				call RemoveSavedHandle(HY, h, 395)
			elseif UnitIsDead(FRA)== false then
				call D9A(WUE, FRA, GetSpellTargetUnit(), D8A, dummyUnit)
				call RemoveSavedHandle(HY, h, 396)
				call S9E(GetOwningPlayer(WUE),'A1Z2', false)
				if Rubick_AbilityFilter(WUE , 'A1YX') then
					call S9E(GetOwningPlayer(WUE),'A1YX', true)
				endif
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(t)
			endif
		elseif GetSpellAbilityId()=='A1RK' or GetSpellAbilityId()=='A43H' then
			if FEA != null and UnitIsDead(FEA)== false then
				call D9A(WUE, FEA, WUE, D8A, dummyUnit)
			endif
			if FXA != null and UnitIsDead(FXA)== false then
				call D9A(WUE, FXA, WUE, D8A, dummyUnit)
			endif
			if FOA != null and UnitIsDead(FOA)== false then
				call D9A(WUE, FOA, WUE, D8A, dummyUnit)
			endif
			if FRA != null and UnitIsDead(FRA)== false then
				call D9A(WUE, FRA, WUE, D8A, dummyUnit)
			endif
			call S9E(GetOwningPlayer(WUE),'A1Z2', false)
			if Rubick_AbilityFilter(WUE , 'A1YX') then
				call S9E(GetOwningPlayer(WUE),'A1YX', true)
			endif
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	else
		set EVX = EVX + 1
		call SaveInteger(HY, h, 34, EVX)
		if FEA != null and UnitIsDead(FEA)== false then
			set IMX = 360 * 4 / 4.
			set a2 = IMX + VEI * EVX
			set x = CoordinateX50(WYE +$C8* Cos(a2 * bj_DEGTORAD))
			set y = CoordinateY50(WZE +$C8* Sin(a2 * bj_DEGTORAD))
			call SetUnitFacing(FEA, a2 -90)
			call SetUnitX(FEA, x)
			call SetUnitY(FEA, y)
		endif
		if FXA != null and UnitIsDead(FXA)== false then
			set IMX = 360 * 3 / 4.
			set a2 = IMX + VEI * EVX
			set x = CoordinateX50(WYE +$C8* Cos(a2 * bj_DEGTORAD))
			set y = CoordinateY50(WZE +$C8* Sin(a2 * bj_DEGTORAD))
			call SetUnitFacing(FXA, a2 -90)
			call SetUnitX(FXA, x)
			call SetUnitY(FXA, y)
		endif
		if FOA != null and UnitIsDead(FOA)== false then
			set IMX = 360 * 2 / 4.
			set a2 = IMX + VEI * EVX
			set x = CoordinateX50(WYE +$C8* Cos(a2 * bj_DEGTORAD))
			set y = CoordinateY50(WZE +$C8* Sin(a2 * bj_DEGTORAD))
			call SetUnitFacing(FOA, a2 -90)
			call SetUnitX(FOA, x)
			call SetUnitY(FOA, y)
		endif
		if FRA != null and UnitIsDead(FRA)== false then
			set IMX = 360 * 1 / 4.
			set a2 = IMX + VEI * EVX
			set x = CoordinateX50(WYE +$C8* Cos(a2 * bj_DEGTORAD))
			set y = CoordinateY50(WZE +$C8* Sin(a2 * bj_DEGTORAD))
			call SetUnitFacing(FRA, a2 -90)
			call SetUnitX(FRA, x)
			call SetUnitY(FRA, y)
		endif
		if EVX > 800 or GetTriggerEventId()== EVENT_WIDGET_DEATH then
			if FEA != null and UnitIsDead(FEA)== false then
				call D9A(WUE, FEA, WUE, D8A, dummyUnit)
			endif
			if FXA != null and UnitIsDead(FXA)== false then
				call D9A(WUE, FXA, WUE, D8A, dummyUnit)
			endif
			if FOA != null and UnitIsDead(FOA)== false then
				call D9A(WUE, FOA, WUE, D8A, dummyUnit)
			endif
			if FRA != null and UnitIsDead(FRA)== false then
				call D9A(WUE, FRA, WUE, D8A, dummyUnit)
			endif
			call S9E(GetOwningPlayer(WUE),'A1Z2', false)
			if Rubick_AbilityFilter(WUE , 'A1YX') then
				call S9E(GetOwningPlayer(WUE),'A1YX', true)
			endif
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			call SaveReal(HY, h, 685, RMinBJ(.25 + .75 *(I2R(EVX)/ 500.), 1))
			if EVX == 625 then
				call BYX(XF, GetOwningPlayer(WUE))
			endif
			if EVX > 600 then
				if ModuloInteger(EVX, 10)== 0 or ModuloInteger(EVX, 10)== 1 or ModuloInteger(EVX, 10)== 2 or ModuloInteger(EVX, 10)== 3 or ModuloInteger(EVX, 10)== 4 then
					call SetUnitVertexColor(FEA, 255, 0, 0, 255)
					call SetUnitVertexColor(FXA, 255, 0, 0, 255)
					call SetUnitVertexColor(FOA, 255, 0, 0, 255)
					call SetUnitVertexColor(FRA, 255, 0, 0, 255)
				else
					call SetUnitVertexColor(FEA, 255, 255, 255, 255)
					call SetUnitVertexColor(FXA, 255, 255, 255, 255)
					call SetUnitVertexColor(FOA, 255, 255, 255, 255)
					call SetUnitVertexColor(FRA, 255, 255, 255, 255)
				endif
			endif
		endif
	endif
	set t = null
	set WUE = null
	set FEA = null
	set FXA = null
	set FOA = null
	set FRA = null
	set g = null
	set g2 = null
	set dummyUnit = null
	return false
endfunction
function CFE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local real WYE = GetUnitX(WUE)
	local real WZE = GetUnitY(WUE)
	local real x
	local real y
	local unit FEA
	local unit FXA
	local unit FOA
	local unit FRA
	local real a = GetUnitFacing(WUE)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', WYE, WZE, 0)
	call SetWidgetLife(WUE, GetWidgetLife(WUE)-GetWidgetLife(WUE)* .15)
	call UnitAddPermanentAbility(WUE,'A1Z2')
	call S9E(GetOwningPlayer(WUE),'A1Z2', true)
	call S9E(GetOwningPlayer(WUE),'A1YX', false)
	set x = GetUnitX(WUE)+$C8* Cos(bj_DEGTORAD * 360 * 4 / 4. *-1.)
	set y = GetUnitY(WUE)+$C8* Sin(bj_DEGTORAD * 360 * 4 / 4. *-1.)
	set FEA = CreateUnit(GetOwningPlayer(WUE),'h0CU', x, y, 360 * 4 / 4. *-1.)
	set x = GetUnitX(WUE)+$C8* Cos(bj_DEGTORAD * 360 * 3 / 4. *-1.)
	set y = GetUnitY(WUE)+$C8* Sin(bj_DEGTORAD * 360 * 3 / 4. *-1.)
	set FXA = CreateUnit(GetOwningPlayer(WUE),'h0CU', x, y, 360 * 3 / 4. *-1.)
	set x = GetUnitX(WUE)+$C8* Cos(bj_DEGTORAD * 360 * 2 / 4. *-1.)
	set y = GetUnitY(WUE)+$C8* Sin(bj_DEGTORAD * 360 * 2 / 4. *-1.)
	set FOA = CreateUnit(GetOwningPlayer(WUE),'h0CU', x, y, 360 * 2 / 4. *-1.)
	set x = GetUnitX(WUE)+$C8* Cos(bj_DEGTORAD * 360 * 1 / 4. *-1.)
	set y = GetUnitY(WUE)+$C8* Sin(bj_DEGTORAD * 360 * 1 / 4. *-1.)
	set FRA = CreateUnit(GetOwningPlayer(WUE),'h0CU', x, y, 360 * 1 / 4. *-1.)
	call SetUnitScale(FEA, 2.25, 2.25, 2.25)
	call SetUnitScale(FXA, 2.25, 2.25, 2.25)
	call SetUnitScale(FOA, 2.25, 2.25, 2.25)
	call SetUnitScale(FRA, 2.25, 2.25, 2.25)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerAddCondition(t, Condition(function FVA))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 393, FEA)
	call SaveUnitHandle(HY, h, 394, FXA)
	call SaveUnitHandle(HY, h, 395, FOA)
	call SaveUnitHandle(HY, h, 396, FRA)
	call SaveUnitHandle(HY, h, 19, dummyUnit)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	set t = null
	set WUE = null
	set FEA = null
	set FXA = null
	set FOA = null
	set FRA = null
	set dummyUnit = null
endfunction
function FIA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer EVX =(LoadInteger(HY,(GetHandleId(targetUnit)), 627))
	local real FAA =(LoadReal(HY,(GetHandleId(targetUnit)), 628))
	local integer level = GetUnitAbilityLevel(WUE,'A1S4')
	local real IXX =(5 + level *$F)* Pow(2, IMinBJ(EVX, 5)-1)
	if EVX == 0 then
		set IXX = 0
	else
		set IXX = IXX + IMaxBJ(EVX -5, 0)* 50
	endif
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SaveInteger(HY,(GetHandleId(targetUnit)), 627, 0)
		call SaveReal(HY,(GetHandleId(targetUnit)), 628,(0 * 1.))
	elseif GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT then
		if GetSpellAbilityId()=='A1S9' then
			call DestroyEffect((LoadEffectHandle(HY, h, 32)))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call SaveInteger(HY,(GetHandleId(targetUnit)), 627, 0)
			call SaveReal(HY,(GetHandleId(targetUnit)), 628,(0 * 1.))
			if((LoadInteger(HY,(GetHandleId((targetUnit))),(4293)))== 1) then
				call SetUnitInvulnerable(targetUnit, false)
			endif
			call UnitDamageTargetEx(WUE, targetUnit, 1, IXX)
			if((LoadInteger(HY,(GetHandleId((targetUnit))),(4293)))== 1) then
				call SetUnitInvulnerable(targetUnit, true)
			endif
			call CommonTextTag(I2S(R2I(IXX))+ "!", 2, targetUnit, .025, 100, 0, 200,$D8)
		endif
	elseif(GetGameTime())> FAA then
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SaveInteger(HY,(GetHandleId(targetUnit)), 627, 0)
		call SaveReal(HY,(GetHandleId(targetUnit)), 628,(0 * 1.))
		if((LoadInteger(HY,(GetHandleId((targetUnit))),(4293)))== 1) then
			call SetUnitInvulnerable(targetUnit, false)
		endif
		call UnitDamageTargetEx(WUE, targetUnit, 1, IXX)
		if((LoadInteger(HY,(GetHandleId((targetUnit))),(4293)))== 1) then
			call SetUnitInvulnerable(targetUnit, true)
		endif
		call CommonTextTag(I2S(R2I(IXX))+ "!", 2, targetUnit, .025, 100, 0, 200,$D8)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function FNA takes unit WUE, unit targetUnit returns nothing
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(WUE,'A1S4')
	local unit NIX
	if(LoadInteger(HY,(GetHandleId(targetUnit)), 627))> 0 then
		call SaveInteger(HY,(GetHandleId(targetUnit)), 627,((LoadInteger(HY,(GetHandleId(targetUnit)), 627))+ 1))
		call SaveReal(HY,(GetHandleId(targetUnit)), 628,(((GetGameTime())+$A)* 1.))
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(WUE))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SaveInteger(HY,(GetHandleId(targetUnit)), 627, 1)
		if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
			call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\shamanyouranus-ShadowyMissile.mdl", targetUnit, "chest")))
		else
			call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("war3mapImported\\shamanyouranus-ShadowyMissile.mdl", targetUnit, "origin")))
		endif
		call SaveReal(HY,(GetHandleId(targetUnit)), 628,(((GetGameTime())+$A)* 1.))
		call TriggerRegisterTimerEvent(t, .05, true)
		call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_EFFECT)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function FIA))
		set NIX = null
	endif
	call CommonTextTag("+" + I2S((LoadInteger(HY,(GetHandleId(targetUnit)), 627))), 3, targetUnit, .025, 100, 0, 200,$D8)
	call UnitDamageTargetEx(WUE, targetUnit, 1, 50)
	set t = null
endfunction
function FBA takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), PAV)== false then
		call GroupAddUnit(PAV, GetEnumUnit())
		call FNA(PIV, GetEnumUnit())
	endif
endfunction
function FCA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit NIX =(LoadUnitHandle(HY, h, 45))
	local integer EVX = GetTriggerEvalCount(t)
	local real a =(LoadReal(HY, h, 137))
	local real x = CoordinateX50(GetUnitX(NIX)+ 20 * Cos(a))
	local real y = CoordinateY50(GetUnitY(NIX)+ 20 * Sin(a))
	local group g
	local group CNO =(LoadGroupHandle(HY, h,$85))
	local unit targetUnit
	if EVX == 75 then
		call LogoutGroup(CNO)
		call KillUnit(NIX)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set U2 = WUE
		set PIV = WUE
		set PAV = CNO
		call SetUnitX(NIX, x)
		call SetUnitY(NIX, y)
		set g = LoginGroup(436)
		call GroupEnumUnitsInRange(g, x, y,$D7, Condition(function DPX))
		set targetUnit =(LoadUnitHandle(ExtraHT,(GetHandleId(WUE)), HTKEY_DISRUPTION_UNIT))
		if targetUnit != null then
			if GetDistanceBetween(GetUnitX(targetUnit), GetUnitY(targetUnit), x, y)<$D7 and IsUnitEnemy(targetUnit, GetOwningPlayer(WUE)) then
				call GroupAddUnit(g, targetUnit)
			endif
		endif
		call ForGroup(g, function FBA)
		set targetUnit = FirstOfGroup(g)
		call LogoutGroup(g)
	endif
	set t = null
	set WUE = null
	set NIX = null
	set g = null
	set targetUnit = null
	set CNO = null
	return false
endfunction
function CGE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = AngleBetweenXY(GetUnitX(WUE), GetUnitY(WUE), x, y)* bj_DEGTORAD
	local unit NIX = CreateUnit(GetOwningPlayer(WUE),'h0C2', GetUnitX(WUE), GetUnitY(WUE), a * bj_RADTODEG)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function FCA))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 45,(NIX))
	call SaveReal(HY, h, 137,((a)* 1.))
	call SaveGroupHandle(HY, h,$85,(LoginGroup(437)))
	call UnitAddPermanentAbility(WUE,'A1S9')
	set t = null
	set WUE = null
	set NIX = null
endfunction

globals
	constant key HTKEY_DISRUPTION_UNIT
endglobals

function DisruptionEnd takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit sourceUnit = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 0)
	local unit illusionUnit
	local real dur = 4. + level
	local real dataB = 0.2 + level * 0.1
	local real dataC = 1.5

	call DestroyEffect(LoadEffectHandle(HY, h, 32))
	call SaveInteger(HY, GetHandleId(targetUnit), 4293, 2)

	call RemoveSavedHandle(ExtraHT, GetHandleId(targetUnit), HTKEY_DISRUPTION_UNIT)

	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	if GetTriggerEventId()!= EVENT_WIDGET_DEATH then

		call PlaySoundAtPoint(MirrorImageSound, GetUnitX(targetUnit), GetUnitY(targetUnit))

		set illusionUnit = SummonIllusion(targetUnit, sourceUnit, dur, dataB, dataC, 0., null)
		call IssueTargetOrderById(illusionUnit, 851983, targetUnit)
		call SetUnitOwner(illusionUnit, GetOwningPlayer(sourceUnit), false)
		set illusionUnit = SummonIllusion(targetUnit, sourceUnit, dur, dataB, dataC, 0., null)
		call IssueTargetOrderById(illusionUnit, 851983, targetUnit)
		call SetUnitOwner(illusionUnit, GetOwningPlayer(sourceUnit), false)

		call ClearSelectionForPlayer(GetOwningPlayer(targetUnit))
		call SelectUnitAddForPlayer(targetUnit, GetOwningPlayer(targetUnit))
	endif

	call ImprisonedUnit(targetUnit, false)


	set t = null
	set sourceUnit = null
	set illusionUnit = null
	set targetUnit = null
	return false
endfunction
function DisruptionActions takes nothing returns nothing
	local unit spellUnit = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit fovDummy = CreateUnit(GetOwningPlayer(targetUnit),'o019', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitApplyTimedLife(fovDummy,'BTLF', 2.6)
	if not IsUnitAlly(targetUnit, GetOwningPlayer(spellUnit)) then
		set fovDummy = CreateUnit(GetOwningPlayer(spellUnit),'o019', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
		call UnitApplyTimedLife(fovDummy,'BTLF', 2.6)
	endif

	call ImprisonedUnit(targetUnit, true)

	call SaveEffectHandle(HY, h, 32, AddSpecialEffect("war3mapImported\\WILLTHEALMIGHTY-Void5.mdx", GetUnitX(targetUnit), GetUnitY(targetUnit)))
	call SaveUnitHandle(HY, h, 2, spellUnit)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(spellUnit, GetSpellAbilityId()))
	call TriggerRegisterTimerEvent(t, 2.5, false)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerAddCondition(t, Condition(function DisruptionEnd))
	call SaveUnitHandle(ExtraHT, GetHandleId(spellUnit), HTKEY_DISRUPTION_UNIT, targetUnit)
	call SaveInteger(HY, GetHandleId(targetUnit), 4293, 1)
	set spellUnit = null
	set targetUnit = null
	set t = null
	set fovDummy = null
endfunction
// 崩裂禁锢
function SpellEffect__Disruption takes nothing returns nothing
	if(IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) or not UnitHasSpellShield(GetSpellTargetUnit())) then
		call DisruptionActions()
	endif
endfunction
function LNE takes nothing returns nothing
	if GetSpellTargetUnit()!= GetTriggerUnit() and IsUnitAlly(GetSpellTargetUnit(), GetOwningPlayer(GetTriggerUnit())) and LoadBoolean(HY, GetHandleId(GetOwningPlayer(GetSpellTargetUnit())),$8B) then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n038'))
	endif
endfunction
function SoulCatcherEnd takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local real data = LoadReal(HY, h, 0)
	local integer hu = LoadInteger(HY, h, 0)

	set data = LoadReal(ExtraHT, hu, 'A1SB') - data
	call SaveReal(ExtraHT, hu, 'A1SB', data)
	if data == 0. then
		//call BJDebugMsg("灵魂猎手"+R2S(data))
		call RemoveSavedReal(ExtraHT, hu, 'A1SB')
	endif

	call DestroyEffect(LoadEffectHandle(HY, h, 32))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	return false
endfunction
function SpellEffect__SoulCatcher takes nothing returns nothing
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local group g = LoginGroup(438)
	local unit spellUnit = GetTriggerUnit()
	local unit targetUnit
	local trigger t
	local integer h
	local integer hu
	local real data = .1 + .1 * GetUnitAbilityLevel(spellUnit, GetSpellAbilityId())
	set U2 = spellUnit
	call GroupEnumUnitsInRange(g, x, y, 500, Condition(function DQX))
	set targetUnit = LoadUnitHandle(ExtraHT, GetHandleId(spellUnit), HTKEY_DISRUPTION_UNIT)
	if targetUnit != null then
		if IsUnitInRangeXY(targetUnit, x, y, 500) and IsUnitEnemy(targetUnit, GetOwningPlayer(spellUnit)) then
			call GroupAddUnit(g, targetUnit)
		endif
	endif
	set targetUnit = GroupPickRandomUnit(g)
	call LogoutGroup(g)
	call DestroyEffect(AddSpecialEffect("war3mapImported\\Desecrate.mdx", x, y))
	if targetUnit != null then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 12, false)
		call TriggerAddCondition(t, Condition(function SoulCatcherEnd))
		call SaveReal(HY, h, 0, data)
		call SaveInteger(HY, h, 0, GetHandleId(targetUnit))

		set hu = GetHandleId(targetUnit)
		call SaveReal(ExtraHT, hu, 'A1SB', LoadReal(ExtraHT, hu, 'A1SB') + data)
		call EnableEffectByTime(EFFECT_KEY_SOUL_CATCHER, 12.)

		call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("war3mapImported\\void.mdx", targetUnit, "chest"))
	endif
	set g = null
	set spellUnit = null
	set targetUnit = null
	set t = null
endfunction
function time_effect_demonic_purge takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 2)
	local unit stg_u = LoadUnitHandle(HY, h, 17)
	local integer tri_ec = GetTriggerEvalCount(t)
	if tri_ec == 5 then
		if(LoadInteger(HY, GetHandleId(stg_u), 4293)== 1) then
			call SetUnitInvulnerable(stg_u, false)
		endif
		call UnitDamageTargetEx(triggerUnit, stg_u, 1, 4 *(25 + 25 * LoadInteger(HY, h, 0)))
		if(LoadInteger(HY, GetHandleId(stg_u), 4293)== 1) then
			call SetUnitInvulnerable(stg_u, true)
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set triggerUnit = null
	set stg_u = null
	return false
endfunction
function effect_demonic_purge takes unit u, unit stg_u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(stg_u), GetUnitY(stg_u), 0)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function time_effect_demonic_purge))
	call SaveUnitHandle(HY, h, 2, u)
	call SaveUnitHandle(HY, h, 17, stg_u)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call UnitAddAbility(d,'A1SA')
	call SetUnitAbilityLevel(d,'A1SA', GetUnitAbilityLevel(u,'A343')+ GetUnitAbilityLevel(u,'A34J'))
	call IssueTargetOrderById(d, 852111, stg_u)
	call TriggerEvaluate(t)
	if GetUnitAbilityLevel(u,'A34J')> 0 then
		call UnitAddBreakToTimed(stg_u, 5.)
	endif
	set t = null
	set d = null
endfunction
function enum_demonic_purge takes nothing returns boolean
	if(IsUnitEnemy(LoadUnitHandle(VV,'A1SA','cast'), GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'Aloc')== 0 and IsAliveNotStrucNotWard(GetFilterUnit())))!= null then
		call effect_demonic_purge(LoadUnitHandle(VV,'A1SA','cast'), GetFilterUnit())
	endif
	return false
endfunction
function CUE takes nothing returns nothing
	local group g = LoginGroup(439)
	set U2 = GetTriggerUnit()
	call SaveUnitHandle(VV,'A1SA','cast', GetTriggerUnit())
	call GroupEnumUnitsInRange(g, GetSpellTargetX(), GetSpellTargetY(), 265, Condition(function enum_demonic_purge))
	call RemoveSavedHandle(VV,'A1SA','cast')
	call LogoutGroup(g)
	set g = null
endfunction
function timer_charges_demonic_purge takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local real cool_down_time = LoadReal(HY, h, 0)
	local integer ab_charges = LoadInteger(HY, GetHandleId(u),'A34J')
	if ab_charges < 3 then
		set cool_down_time = cool_down_time -0.2
		if cool_down_time <= 0.00 then
			call SaveInteger(HY, GetHandleId(u),'A34J', ab_charges + 1)
			call SaveReal(HY, h, 0, 40.)
		else
			call SaveReal(HY, h, 0, cool_down_time * 1.)
		endif
	endif
	set u = null
	set t = null
	return false
endfunction
function charges_demonic_purge takes unit u returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerAddCondition(t, Condition(function timer_charges_demonic_purge))
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveReal(HY, GetHandleId(t), 0, 40.)
	call SaveInteger(HY, GetHandleId(u),'A34J', 3)
	call SaveTriggerHandle(HY, GetHandleId(u),'A34J', t)
	call DisplayTimedTextToPlayer(GetOwningPlayer(u), 0, 0, 10, "|c00FF0000提示|r: 你可以输入指令|c00bd2222-charges|r来开启或关闭充能计数面板")
	set t = null
endfunction
function demonic_purge_charges0 takes nothing returns nothing //0充能邪恶净化
	local unit u = GetTriggerUnit()
	if HaveSavedHandle(HY, GetHandleId(u),'A34J')== false then
		call charges_demonic_purge(u)
	endif
	if LoadInteger(HY, GetHandleId(u),'A34J')< 1 then
		call InterfaceErrorForPlayer(GetOwningPlayer(u), "邪恶净化能量点数不足.")
		call EXStopUnit(u)
	endif
	set u = null
endfunction
function hystr_demonic_purge takes nothing returns nothing
	call CUE()
	call SaveInteger(HY, GetHandleId(GetTriggerUnit()),'A34J', LoadInteger(HY, GetHandleId(GetTriggerUnit()),'A34J')-1)
endfunction
function LZE takes nothing returns nothing
	local integer h = GetHandleId(GetTriggerUnit())
	if HaveSavedHandle(HY, h,'A34J')== false then
		call charges_demonic_purge(GetTriggerUnit())
	endif
endfunction
function G9X takes nothing returns nothing
	local integer h = GetHandleId(U2)
	if HaveSavedHandle(HY, h,'A34J')== false then
		call charges_demonic_purge(U2)
	endif
endfunction
function FSA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer EVX = GetTriggerEvalCount(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	call UnitRemoveAbility(WUE,'A1SP')
	set t = null
	set WUE = null
	return false
endfunction
function Gyro_RocketBarrageOld takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	call UnitAddPermanentAbility(WUE,'A1SP')
	call UnitMakeAbilityPermanent(WUE, true,'A1SP')
	call SetUnitAbilityLevel(WUE,'A1SP', GetUnitAbilityLevel(WUE,'A1SO'))
	call TriggerRegisterTimerEvent(t, 3, false)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerAddCondition(t, Condition(function FSA))
	call SaveUnitHandle(HY, h, 2, WUE)
	set t = null
	set WUE = null
endfunction
function FTA takes nothing returns nothing
	if GetUnitAbilityLevel(GetTriggerUnit(),'B1SP')> 0 then
		call UnitRemoveAbility(GetTriggerUnit(),'B1SP')
	endif
endfunction
function FUA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or GetTriggerEvalCount(t)> 3 / .05 then
		call UnitRemoveAbility(LoadUnitHandle(HY, h, 2),'A1SP')
		call KillUnit(LoadUnitHandle(HY, h, 19))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call SetUnitX(LoadUnitHandle(HY, h, 19), GetUnitX(LoadUnitHandle(HY, h, 2)))
		call SetUnitY(LoadUnitHandle(HY, h, 19), GetUnitY(LoadUnitHandle(HY, h, 2)))
		call SetUnitFlyHeight(LoadUnitHandle(HY, h, 19), GetUnitFlyHeight(LoadUnitHandle(HY, h, 2)), 0)
	endif
	set t = null
	return false
endfunction
function C_E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit u = GetTriggerUnit()
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	if GetUnitTypeId(u)=='e00E' then
		set u = Player__Hero[GetPlayerId(GetOwningPlayer(u))] 
	endif
	call TGV(10)
	call UnitAddPermanentAbility(d,'A1SP')
	call SetUnitAbilityLevel(d,'A1SP', GetUnitAbilityLevel(u,'A1SO'))
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function FUA))
	call SaveUnitHandle(HY,(h), 2,(u))
	call SaveUnitHandle(HY,(h), 19, d)
	set t = null
	set d = null
	set u = null
endfunction
function FWA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer EVX = GetTriggerEvalCount(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local unit NIX = LoadUnitHandle(HY, h, 45)
	local real x
	local real y
	local real d
	local real F0X
	local real GXR = GetUnitX(NIX)
	local real GOR = GetUnitY(NIX)
	local real a = AngleBetweenXY(GXR, GOR, GetUnitX(targetUnit), GetUnitY(targetUnit))* bj_DEGTORAD
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call UnitShareVision(NIX, GetOwningPlayer(targetUnit), false)
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if GetTriggerUnit()!= NIX then
			call KillUnit(NIX)
		endif
	elseif GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		call UnitRemoveBuffs(NIX, true, true)
	elseif EVX < 3 / .02 then
		call SetUnitFacing(NIX, a * bj_RADTODEG)
	else
		if EVX == 4 / .02 then
			call UnitShareVision(NIX, GetOwningPlayer(targetUnit), true)
		endif
		call SetUnitFacing(NIX, a * bj_RADTODEG)
		set x = GXR +(280 + 20 * EVX * .02)* .02 * Cos(a)
		set y = GOR +(280 + 20 * EVX * .02)* .02 * Sin(a)
		call SetUnitPosition(NIX, x, y)
		call SaveReal(HY, h, 23, x * 1.)
		call SaveReal(HY, h, 24, y * 1.)
		if GetDistanceBetween(x, y, GetUnitX(targetUnit), GetUnitY(targetUnit))< 20 then
			set d = RMinBJ(GetDistanceBetween(x, y, LoadReal(HY, h, 6), LoadReal(HY, h, 7)),$5DC)
			set x = LoadInteger(HY, h, 0)
			set F0X = d / $5DC*(125 * x)
			set F0X = RMaxBJ(F0X, 50)
			call KillUnit(NIX)
			call DestroyEffect(LoadEffectHandle(HY, h, 32))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call UnitDamageTargetEx(WUE, targetUnit, 1, F0X)
			call CommonUnitAddStun(targetUnit, 2 + .2 * x, false)
		endif
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set NIX = null
	return false
endfunction
function FYA takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local real a = AngleBetweenXY(GetUnitX(WUE), GetUnitY(WUE), GetUnitX(targetUnit), GetUnitY(targetUnit))* bj_DEGTORAD
	local real x = CoordinateX50(GetUnitX(WUE)+$96* Cos(a))
	local real y = CoordinateY50(GetUnitY(WUE)+$96* Sin(a))
	local integer level = GetUnitAbilityLevel(WUE,'A1SQ')
	local unit NIX
	local integer OVX
	local string s = "effects\\Snipe Target.mdx"
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(WUE))== false and IsObserver== false then
		set s = ""
	endif
	if level == 1 then
		set OVX ='h0CG'
	elseif level == 2 then
		set OVX ='h0C1'
	elseif level == 3 then
		set OVX ='h0CF'
	elseif level == 4 then
		set OVX ='h0CH'
	endif
	set NIX = CreateUnit(GetOwningPlayer(WUE), OVX, x, y, a * bj_RADTODEG)
	call UnitRemoveAbility(NIX,'Amov')
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterDeathEvent(t, NIX)
	call TriggerRegisterUnitEvent(t, NIX, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function FWA))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveInteger(HY, h, 0, level)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveUnitHandle(HY, h, 45, NIX)
	call SaveReal(HY, h, 6, GetUnitX(WUE)* 1.)
	call SaveReal(HY, h, 7, GetUnitY(WUE)* 1.)
	call SaveReal(HY, h, 23, GetUnitX(NIX)* 1.)
	call SaveReal(HY, h, 24, GetUnitY(NIX)* 1.)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget(s, targetUnit, "overhead"))
	set t = null
	set WUE = null
	set targetUnit = null
	set NIX = null
endfunction
function C1E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call FYA()
	endif
endfunction
function FZA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local group g
	local integer EVX = GetTriggerEvalCount(t)
	local fogmodifier fm = LoadFogModifierHandle(HY, h, 42)
	local integer level = LoadInteger(HY, h, 0)
	local unit u2
	if EVX == 1 then
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Calldown_FlyUp.mdx", WUE, "chest"))
	elseif EVX == 2 then
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Calldown_FlyUp.mdx", WUE, "chest"))
	elseif EVX == 3 then
		call DestroyEffect(AddSpecialEffect("war3mapImported\\Calldown_FlyDown.mdx", x, y))
	elseif EVX == 4 then
		set g = LoginGroup(440)
		set U2 = WUE
		call GroupEnumUnitsInRange(g, x, y, 625, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			call UnitDamageTargetEx(WUE, u2, 1, level * 50 +$C8)
			call AddAbilityToTimed(u2,'A1T3', 1, 2,'B0DG')
			call GroupRemoveUnit(g, u2)
		endloop
		call LogoutGroup(g)
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\DemolisherFireMissile\\DemolisherFireMissile.mdl", x, y))
	elseif EVX == 5 then
		call DestroyEffect(AddSpecialEffect("war3mapImported\\Calldown_FlyDown.mdx", x, y))
	elseif EVX == 6 then
		set g = LoginGroup(441)
		set U2 = WUE
		call GroupEnumUnitsInRange(g, x, y, 625, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			if LoadBoolean(HY, h, 0) then
				call UnitDamageTargetEx(WUE, u2, 1, level * 50 + 50 + 75)
			else
				call UnitDamageTargetEx(WUE, u2, 1, level * 50 + 50)
			endif
			call AddAbilityToTimed(u2,'A1ST', 1, 4,'B0DE')
			call GroupRemoveUnit(g, u2)
		endloop
		call LogoutGroup(g)
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\DemolisherFireMissile\\DemolisherFireMissile.mdl", x, y))
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FogModifierStop(fm)
		call DestroyFogModifier(fm)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	set g = null
	set fm = null
	return false
endfunction
function C3E takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local string s = ""
	local fogmodifier fm = CreateFogModifierRadius(GetOwningPlayer(WUE), FOG_OF_WAR_VISIBLE, x, y, 450, true, true)
	call FogModifierStart(fm)
	if IsPlayerAlly(LocalPlayer, GetOwningPlayer(WUE)) or IsObserver then
		set s = "war3mapImported\\CallDown_4.mdx"
	endif
	call TriggerRegisterTimerEvent(t, .1, false)
	call TriggerRegisterTimerEvent(t, .8, false)
	call TriggerRegisterTimerEvent(t, 1.6, false)
	call TriggerRegisterTimerEvent(t, 2, false)
	call TriggerRegisterTimerEvent(t, 3.6, false)
	call TriggerRegisterTimerEvent(t, 4, false)
	call TriggerAddCondition(t, Condition(function FZA))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	call SaveBoolean(HY, h, 0, GetSpellAbilityId()=='A235')
	call SaveReal(HY, h, 6, x * 1.)
	call SaveReal(HY, h, 7, y * 1.)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffect(s, x, y))
	call SaveFogModifierHandle(HY, h, 42, fm)
	set t = null
	set WUE = null
	set fm = null
endfunction
function F_A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer F0A = LoadInteger(HY, h, 375)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local integer EVX
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if GetEventDamageSource()== WUE and(GetEventDamage()> 20 or IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE)) and FK then
			set EVX = LoadInteger(HY, F0A, 34)
			if EVX > 0 then
				call SaveInteger(HY, F0A, 34, EVX + 1)
			endif
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	return false
endfunction
function F1A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	if R5X(WUE)== false then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(WUE,'A237')
		call UnitAddAbility(WUE,'A22B')
		call UnitRemoveAbility(WUE,'A22B')
	endif
	set t = null
	set WUE = null
	return false
endfunction
function F2A takes unit WUE returns nothing
	local trigger t
	local integer h
	if R5X(WUE)== false then
		call UnitRemoveAbility(WUE,'A237')
		call UnitAddAbility(WUE,'A22B')
		call UnitRemoveAbility(WUE,'A22B')
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(WUE))
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerAddCondition(t, Condition(function F1A))
		set t = null
	endif
endfunction
function FlakCannonEnd takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 2)
	local timer tim = LoadTimerHandle(HY, h, 0)
	call RemoveSavedInteger(ExtraHT, GetHandleId(u), 'A229')
	//call ReduceAttackLaunchingTrigCount(u)
	call DestroyTimer(tim)

	//call UnitRemoveAbility(u,'A1TW')

	call RemoveSavedHandle(ExtraHT, GetHandleId(u), 'A229')

	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set tim = null
	set t = null
	set u = null
	return false
endfunction
// 高射火炮
function SpellEffect__FlakCannon takes nothing returns nothing
	local trigger trig
	local integer h
	local unit u = GetTriggerUnit()
	local integer count = 2 + GetUnitAbilityLevel(u, 'A229')
	local timer tim

	if not HaveSavedHandle(ExtraHT, GetHandleId(u), 'A229') then
		set trig = CreateTrigger()
		set h = GetHandleId(trig)
		set tim = CreateTimer()

		call SaveTriggerHandle(ExtraHT, GetHandleId(u), 'A229', trig)
		//call UnitAddAbility(u,'A1TW')
		//call UnitMakeAbilityPermanent(u, true,'A1TW')

		call AddAttackLaunchingTrigCount(u)

		call TriggerRegisterDeathEvent(trig, u)
		call TriggerRegisterTimerExpireEvent(trig, tim)

		call TriggerAddCondition(trig, Condition(function FlakCannonEnd))
		call SaveUnitHandle(HY, h, 2, u)
		call SaveTimerHandle(HY, h, 0, tim)

		set trig = null
	else
		set trig = LoadTriggerHandle(ExtraHT, GetHandleId(u), 'A229')
		set h = GetHandleId(trig)
		set tim = LoadTimerHandle(HY, h, 0)
	endif
	call SaveInteger(ExtraHT, GetHandleId(u), 'A229', count)
	call TimerStart(tim, 15, false, null)
	set trig = null
	set u = null
	set tim = null
endfunction
function F4A takes nothing returns boolean
	local unit targetUnit = GetFilterUnit()
	local unit WUE = PNV
	local real WYE = PBV
	local real WZE = PCV
	local real GRR = PDV
	local real GIR = PFV
	local real x
	local real y
	local real a
	local real d
	if(IsMagicImmuneUnit(GetFilterUnit())== false and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit())) then
		set d = GetDistanceBetween(WYE, WZE, GetUnitX(targetUnit), GetUnitY(targetUnit))
		set a = AngleBetweenXY(WYE, WZE, GetUnitX(targetUnit), GetUnitY(targetUnit))* bj_DEGTORAD
		if d > PGV then
			set x = GetUnitX(targetUnit)+$B* Cos(a)
			set y = GetUnitY(targetUnit)+$B* Sin(a)
		else
			set x = GetUnitX(targetUnit)-$B* Cos(a)
			set y = GetUnitY(targetUnit)-$B* Sin(a)
		endif
		call SetUnitX(targetUnit, x)
		call SetUnitY(targetUnit, y)
	endif
	set targetUnit = null
	set WUE = null
	return false
endfunction
function F5A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local real WYE = LoadReal(HY, h, 6)
	local real WZE = LoadReal(HY, h, 7)
	local real x
	local real y
	local integer i = 0
	local group g
	local integer level = LoadInteger(HY, h, 0)
	if GetTriggerEvalCount(t)>(50 *(2 + .6 * level)) then
		loop
		exitwhen i > 16
			set i = i + 1
		endloop
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set g = LoginGroup(442)
		set PBV = WYE
		set PCV = WZE
		set PNV = WUE
		set U2 = WUE
		loop
		exitwhen i > 16
			set x = WYE + PGV * Cos(bj_DEGTORAD * 360. * i / 16.)
			set y = WZE + PGV * Sin(bj_DEGTORAD * 360. * i / 16.)
			set PDV = x
			set PFV = y
			call GroupEnumUnitsInRange(g, x, y, 75, Condition(function F4A))
			set i = i + 1
		endloop
		call LogoutGroup(g)
		set g = null
	endif
	set t = null
	set WUE = null
	return false
endfunction
function F6A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local real WYE = LoadReal(HY, h, 6)
	local real WZE = LoadReal(HY, h, 7)
	local real x
	local real y
	local integer i = 0
	local integer level = LoadInteger(HY, h, 0)
	call DestroyEffect(LoadEffectHandle(HY, h, 32))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	loop
	exitwhen i > 16
		set x = WYE + PGV * Cos(bj_DEGTORAD * 360. * i / 16.)
		set y = WZE + PGV * Sin(bj_DEGTORAD * 360. * i / 16.)
		set i = i + 1
	endloop
	call SaveEffectHandle(HY, h, 32, AddSpecialEffect("war3mapImported\\KineticField_FX_Stand.mdx", WYE, WZE))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveReal(HY, h, 6, WYE * 1.)
	call SaveReal(HY, h, 7, WZE * 1.)
	call SaveInteger(HY, h, 0, level)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function F5A))
	set t = null
	set WUE = null
	return false
endfunction
function C9E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local real WYE = GetSpellTargetX()
	local real WZE = GetSpellTargetY()
	call SaveEffectHandle(HY, h, 32, AddSpecialEffect("war3mapImported\\KineticField_FX_Start.mdx", WYE, WZE))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveReal(HY, h, 6, WYE * 1.)
	call SaveReal(HY, h, 7, WZE * 1.)
	call TriggerRegisterTimerEvent(t, 1.2, false)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(WUE,'A1SU'))
	call TriggerAddCondition(t, Condition(function F6A))
	call A8X(GetOwningPlayer(WUE), 5.5, WYE, WZE, 325)
	set t = null
	set WUE = null
endfunction
function F7A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local unit NIX =(LoadUnitHandle(HY, h, 45))
	local real W_E =(LoadReal(HY, h, 6))
	local real W0E =(LoadReal(HY, h, 7))
	local real x = GetUnitX(NIX)
	local real y = GetUnitY(NIX)
	local real a = AngleBetweenXY(x, y, W_E, W0E)
	local real d = GetDistanceBetween(x, y, W_E, W0E)
	local real r =(LoadReal(HY, h, 671))
	call SetUnitFacing(NIX, a)
	set x = x + r * Cos(a * bj_DEGTORAD)
	set y = y + r * Sin(a * bj_DEGTORAD)
	call SetUnitX(NIX, x)
	call SetUnitY(NIX, y)
	if d < 40 then
		call KillUnit(NIX)
		call DestroyEffect((LoadEffectHandle(HY, h, 175)))
		call DestroyEffect((LoadEffectHandle(HY, h, 176)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call EPX(targetUnit, 4411, 1)
		call SetUnitPosition(targetUnit, W_E, W0E)
		call PanCameraToTimedForPlayer(GetOwningPlayer(targetUnit), W_E, W0E, 0)
	elseif IsMagicImmuneUnit(targetUnit) then
		call KillUnit(NIX)
		call DestroyEffect((LoadEffectHandle(HY, h, 175)))
		call DestroyEffect((LoadEffectHandle(HY, h, 176)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	set NIX = null
	return false
endfunction
function F8A takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local real x =(LoadReal(HY,(GetHandleId(targetUnit)), 7400))
	local real y =(LoadReal(HY,(GetHandleId(targetUnit)), 7500))
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit NIX = CreateUnit(GetOwningPlayer(WUE),'h0C6', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local real d = GetDistanceBetween(x, y, GetUnitX(targetUnit), GetUnitY(targetUnit))
	local real r = .02 *(RMaxBJ(d / 1.8, 600))
	call TriggerAddCondition(t, Condition(function F7A))
	call TriggerRegisterTimerEvent(t, .02, true)
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveUnitHandle(HY, h, 45,(NIX))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call SaveReal(HY, h, 671,((r)* 1.))
	call SaveEffectHandle(HY, h, 175,(AddSpecialEffectTarget("effects\\Lightning_Ball_Tail_FX.mdx", targetUnit, "overhead")))
	call SaveEffectHandle(HY, h, 176,(AddSpecialEffect("effects\\Lightning_Ball_Tail_FX.mdx", x, y)))
	call TriggerEvaluate(t)
	set WUE = null
	set targetUnit = null
	set NIX = null
	set t = null
endfunction
function DVE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		if IsUnitIllusion(GetSpellTargetUnit()) then
			call KillUnit(GetSpellTargetUnit())
		else
			call F8A()
		endif
	endif
endfunction
function F9A takes nothing returns nothing
	local unit targetUnit = GetEnumUnit()
	local integer h = GetHandleId(targetUnit)
	local integer i = 1
	loop
	exitwhen i >$E
		call SaveReal(HY, h, 7400 + i -1, LoadReal(HY, h, 7400 + i)* 1.)
		call SaveReal(HY, h, 7500 + i -1, LoadReal(HY, h, 7500 + i)* 1.)
		set i = i + 1
	endloop
	call SaveReal(HY, h, 7400 +$E, GetUnitX(targetUnit)* 1.)
	call SaveReal(HY, h, 7500 +$E, GetUnitY(targetUnit)* 1.)
	set targetUnit = null
endfunction
function GVA takes nothing returns boolean
	local group g = LoginGroup(443)
	call GroupEnumUnitsInRange(g, 0, 0, 99999, Condition(function FEX))
	call ForGroup(g, function F9A)
	call LogoutGroup(g)
	set g = null
	return false
endfunction
function PYX takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .25, true)
	call TriggerAddCondition(t, Condition(function GVA))
	set t = null
endfunction
function GEA takes nothing returns nothing
	if PHV != GetEnumUnit() then
		call UnitDamageTargetEx(PJV, GetEnumUnit(), 1, PKV * 20 + 20)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Bolt\\BoltImpact.mdl", GetEnumUnit(), "chest"))
	endif
endfunction
function GXA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local unit dummyUnit = LoadUnitHandle(HY, h, 19)
	local integer level = LoadInteger(HY, h, 5)
	local group g
	local integer EVX = GetTriggerEvalCount(t)
	local unit d = null
	call SetUnitX(dummyUnit, GetUnitX(targetUnit))
	call SetUnitY(dummyUnit, GetUnitY(targetUnit))
	if EVX == 1 or EVX == 100  or EVX ==$C8 or EVX == 300 then
		set g = LoginGroup(444)
		if UnitIsDead(targetUnit) then
			set d = CreateUnit(GetOwningPlayer(targetUnit),'e00C', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
			call UnitApplyTimedLife(d,'BTLF', .2)
			call IssueTargetOrderById(dummyUnit,$D0097, d)
			set d = null
		else
			call IssueTargetOrderById(dummyUnit,$D0097, targetUnit)
			call UnitDamageTargetEx(WUE, targetUnit, 1, level * 20 + 20)
		endif
		call AddSpecialEffectTargetToTimed("war3mapImported\\ThunderStorm_Groundeffect.mdx", targetUnit, "origin", .6)
		set U2 = WUE
		set PJV = WUE
		set PHV = targetUnit
		set PKV = level
		call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 265, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call ForGroup(g, function GEA)
		call LogoutGroup(g)
		set g = null
	endif
	if GetUnitAbilityLevel(targetUnit,'A42Q')== 0 or GetTriggerEvalCount(t)== 300 then
		call UnitRemoveAbility(targetUnit,'A42Q')
		call UnitRemoveAbility(targetUnit,'B0HH')
		call KillUnit(dummyUnit)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set dummyUnit = null
	return false
endfunction
function GOA takes unit WUE, unit targetUnit returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(WUE,'A1TV')
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e02P', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	call UnitAddPermanentAbility(dummyUnit,'A1U7')
	call SetUnitAbilityLevel(dummyUnit,'A1U7', level)
	call UnitAddPermanentAbility(dummyUnit,'Aloc')
	call UnitAddPermanentAbility(targetUnit,'A42Q')
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function GXA))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveUnitHandle(HY, h, 19, dummyUnit)
	call SaveInteger(HY, h, 5, level)
	set dummyUnit = null
	set t = null
endfunction
function GRA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call GOA(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function DEE takes nothing returns nothing
	local timer t
	local integer h
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, 0, false, function GRA)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		set t = null
	endif
endfunction

function StaticStormActions takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local integer level =(LoadInteger(HY, h, 5))
	local unit spellUnit =(LoadUnitHandle(HY, h, 2))
	local unit stormUnit =(LoadUnitHandle(HY, h, 45))
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	local group g
	local integer evalCount = GetTriggerEvalCount(trig)
	local boolean isScepterUpgrade = LoadBoolean(HY, h, 0)
	local integer maxCount = 20
	local real damage = 0.
	local unit firstUnit = null
	local player p = GetOwningPlayer(spellUnit)
	if isScepterUpgrade then
		set maxCount = 28
	endif
	if evalCount > maxCount then
		call StopSound(StaticStormTargetSound, false, true)
		call KillUnit(stormUnit)
		call ShowUnit(stormUnit, false)
		call KillUnit(dummyUnit)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(trig)
	else
		set g = LoginGroup(445)

		set damage = .25 *($96+ 50 * level)*(evalCount / 20.)

		call GroupEnumUnitsInRange(g, GetUnitX(stormUnit), GetUnitY(stormUnit), 475, null)
		loop
			set firstUnit = FirstOfGroup(g)
			exitwhen firstUnit == null
			call GroupRemoveUnit(g, firstUnit)

			// 敌对 存活 非建筑非守卫 非魔免
			if IsUnitEnemy(firstUnit, p) and IsAliveNotStrucNotWard(firstUnit) and not IsMagicImmuneUnit(firstUnit) then
				
				call UnitDamageTargetEx(spellUnit, firstUnit, 1, damage)
				call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Purge_NoBirth.mdx", firstUnit, "origin"))

			endif

		endloop

		set p= null
		set firstUnit = null
		call LogoutGroup(g)
		set g = null

	endif
	set trig = null
	set spellUnit = null
	set stormUnit = null
	set dummyUnit = null
	return false
endfunction

// 静态风暴
function SpellEffect__StaticStorm takes nothing returns nothing
	local trigger trig = CreateTrigger()
	local integer h = GetHandleId(trig)
	local unit spellUnit = GetTriggerUnit()
	local real targetX = GetSpellTargetX()
	local real targetY = GetSpellTargetY()
	local unit stormUnit = CreateUnit(GetOwningPlayer(spellUnit),'h0CK', targetX, targetY, 0)
	local integer level = GetUnitAbilityLevel(spellUnit,'A1U6')+ GetUnitAbilityLevel(spellUnit,'A30N')
	local unit dummyUnit = CreateUnit(GetOwningPlayer(spellUnit),'e00E', targetX, targetY, 0)
	local boolean isScepterUpgrade = GetSpellAbilityId()=='A30N'
	local integer id = 0
	call SetSoundVolume(StaticStormTargetSound, 200)
	call StartSound(StaticStormTargetSound)
	call SetSoundPosition(StaticStormTargetSound, targetX, targetY, 100)


	// 乌云技能的Bug 目标允许仅计算玩家1 所以要有2个技能
	if IsScourgesPlayer(GetOwningPlayer(spellUnit)) then
		set id = 'A1U5'
	else
		set id = 'A1U4'
	endif
	call UnitAddPermanentAbility(dummyUnit, id)
	if isScepterUpgrade then
		call EnableEffectByTime(EFFECT_KEY_STATICSTORM, 7)
		call SetUnitAbilityLevel(dummyUnit, id, 2)
	endif
	
	call IssuePointOrderById(dummyUnit,$D01F9, targetX, targetY)
	call SaveUnitHandle(HY, h, 2,(spellUnit))
	call SaveUnitHandle(HY, h, 45,(stormUnit))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveBoolean(HY, h, 0, isScepterUpgrade)
	call TriggerRegisterTimerEvent(trig, .25, true)
	call TriggerAddCondition(trig, Condition(function StaticStormActions))

	set trig = null
	set spellUnit = null
	set dummyUnit = null
	set stormUnit = null
endfunction
function GBA takes nothing returns nothing
	local integer GCA = PWV
	local unit targetUnit = GetEnumUnit()
	local integer GDA = 662 -1 + GCA
	local real GFA =(LoadReal(HY,(GetHandleId(targetUnit)),(GDA)))
	local real ECX =(GetGameTime())
	if GFA < ECX then
		call SaveReal(HY,(GetHandleId(targetUnit)),(GDA),((ECX + 2)* 1.))
		if IsUnitType(GetEnumUnit(), UNIT_TYPE_STRUCTURE)== false then
			call UnitDamageTargetEx(PQV, targetUnit, 1, 2 + 6 * PUV)
		endif
	endif
	set targetUnit = null
endfunction
function GGA takes nothing returns nothing
	if IsUnitType(GetEnumUnit(), UNIT_TYPE_STRUCTURE)== false then
		call UnitDamageTargetEx(PQV, GetEnumUnit(), 1, PSV)
		if IsMagicImmuneUnit(GetEnumUnit())== false then
			call CNX(GetEnumUnit(),'A437', 3, 1,'B0DI')
			call GQX(GetEnumUnit(),'A437','B0DI')
		endif
	endif
endfunction
function GHA takes unit WUE, unit GJA returns nothing
	local group g = LoginGroup(446)
	set U2 = WUE
	set PSV = 25 * PUV
	set PQV = WUE
	call GroupEnumUnitsInRange(g, GetUnitX(GJA), GetUnitY(GJA), 325, Condition(function DZX))
	call ForGroup(g, function GGA)
	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathMissile.mdl", GetUnitX(GJA), GetUnitY(GJA)))
	call KillUnit(GJA)
	call LogoutGroup(g)
	call UnitApplyTimedLife(CreateUnit(GetOwningPlayer(WUE),'o00Q', GetUnitX(GJA), GetUnitY(GJA), 0),'BTLF', 2)
	set g = null
endfunction
function GKA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit GLA =(LoadUnitHandle(HY, h, 393))
	local unit GMA =(LoadUnitHandle(HY, h, 394))
	local unit GPA =(LoadUnitHandle(HY, h, 395))
	local unit GQA =(LoadUnitHandle(HY, h, 396))
	local unit GSA =(LoadUnitHandle(HY, h, 397))
	local real x
	local real y
	local real a
	local real d =(LoadReal(HY, h, 138))
	local real WYE = GetUnitX(WUE)
	local real WZE = GetUnitY(WUE)
	local real VEI
	local integer EVX = GetTriggerEvalCount(t)
	local real IMX
	local group g
	local integer GTA = 0
	local real WIE = 2.25
	local real GUA
	local integer level = LoadInteger(HY, h, 5)
	if UnitIsDead(GLA)== false then
		set GTA = GTA + 1
	endif
	if UnitIsDead(GMA)== false then
		set GTA = GTA + 1
	endif
	if UnitIsDead(GPA)== false then
		set GTA = GTA + 1
	endif
	if UnitIsDead(GQA)== false then
		set GTA = GTA + 1
	endif
	if UnitIsDead(GSA)== false then
		set GTA = GTA + 1
	endif
	if GTA == 5 then
		set WIE = 2.25
	elseif GTA == 4 then
		set WIE = 2.1
	elseif GTA == 3 then
		set WIE = 1.95
	elseif GTA == 2 then
		set WIE = 1.8
	elseif GTA == 1 then
		set WIE = 1.65
	endif
	set VEI =-1 * 360 * .02 / WIE
	set GUA =(LoadReal(HY, h, 137))+ VEI
	call SaveReal(HY, h, 137,((GUA)* 1.))
	set PUV = level
	set PQV = WUE
	if EVX == 50 then
		call ShowUnit(GMA, true)
		call SaveBoolean(HY, h, 512,(true))
		call UnitAddPermanentAbility(GMA,'Aloc')
	endif
	if EVX == 100  then
		call ShowUnit(GPA, true)
		call SaveBoolean(HY, h, 513,(true))
		call UnitAddPermanentAbility(GPA,'Aloc')
	endif
	if EVX ==$96 then
		call ShowUnit(GQA, true)
		call SaveBoolean(HY, h, 514,(true))
		call UnitAddPermanentAbility(GQA,'Aloc')
	endif
	if EVX ==$C8 then
		call ShowUnit(GSA, true)
		call SaveBoolean(HY, h, 515,(true))
		call UnitAddPermanentAbility(GSA,'Aloc')
	endif
	if GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT then
		if GetSpellAbilityId()=='A24A' then
			if(LoadBoolean(HY, h, 655)) then
				call SaveBoolean(HY, h, 655,(false))
				call SaveBoolean(HY, h, 656,(false))
			else
				call SaveBoolean(HY, h, 655,(true))
				call SaveBoolean(HY, h, 656,(false))
			endif
		elseif GetSpellAbilityId()=='A24B' then
			if(LoadBoolean(HY, h, 656)) then
				call SaveBoolean(HY, h, 655,(false))
				call SaveBoolean(HY, h, 656,(false))
			else
				call SaveBoolean(HY, h, 655,(false))
				call SaveBoolean(HY, h, 656,(true))
			endif
		endif
	endif
	if(LoadBoolean(HY, h, 655)) then
		set d = RMaxBJ(d -5, 100)
		call SaveReal(HY, h, 138,((d)* 1.))
	elseif(LoadBoolean(HY, h, 656)) then
		set d = RMinBJ(d + 5, 875)
		call SaveReal(HY, h, 138,((d)* 1.))
	endif
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or EVX == 950 or(UnitIsDead(GLA) and UnitIsDead(GMA) and UnitIsDead(GPA) and UnitIsDead(GQA) and UnitIsDead(GSA)) or(EVX > 1 and GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A1T8') then
		if GetTriggerEventId()!= EVENT_UNIT_SPELL_EFFECT then
			call UnitRemoveAbility(WUE,'A24A')
			call UnitRemoveAbility(WUE,'A24B')
		endif
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if UnitIsDead(GLA)== false then
			call GHA(WUE, GLA)
		endif
		if UnitIsDead(GMA)== false then
			call GHA(WUE, GMA)
		endif
		if UnitIsDead(GPA)== false then
			call GHA(WUE, GPA)
		endif
		if UnitIsDead(GQA)== false then
			call GHA(WUE, GQA)
		endif
		if UnitIsDead(GSA)== false then
			call GHA(WUE, GSA)
		endif
	else
		set g = LoginGroup(447)
		if UnitIsDead(GLA)== false and(LoadBoolean(HY, h, 511)) then
			set IMX = 360 * 5 / 5.
			set a = IMX + GUA
			set x = CoordinateX50(WYE + d * Cos(a * bj_DEGTORAD))
			set y = CoordinateY50(WZE + d * Sin(a * bj_DEGTORAD))
			call SetUnitX(GLA, x)
			call SetUnitY(GLA, y)
			set U2 = WUE
			call GroupEnumUnitsInRange(g, x, y, 95, Condition(function D8X))
			if FirstOfGroup(g)!= null then
				call GHA(WUE, GLA)
			endif
			call GroupClear(g)
			set PTV = GLA
			set PWV = 1
			set PQV = WUE
			call GroupEnumUnitsInRange(g, x, y, 175, Condition(function DYX))
			call ForGroup(g, function GBA)
			call GroupClear(g)
		endif
		if UnitIsDead(GMA)== false and(LoadBoolean(HY, h, 512)) then
			set IMX = 360 * 4 / 5.
			set a = IMX + GUA
			set x = CoordinateX50(WYE + d * Cos(a * bj_DEGTORAD))
			set y = CoordinateY50(WZE + d * Sin(a * bj_DEGTORAD))
			call SetUnitX(GMA, x)
			call SetUnitY(GMA, y)
			set U2 = WUE
			call GroupEnumUnitsInRange(g, x, y, 95, Condition(function D8X))
			if FirstOfGroup(g)!= null then
				call GHA(WUE, GMA)
			endif
			call GroupClear(g)
			set PTV = GMA
			set PWV = 2
			set PQV = WUE
			call GroupEnumUnitsInRange(g, x, y, 175, Condition(function DYX))
			call ForGroup(g, function GBA)
			call GroupClear(g)
		endif
		if UnitIsDead(GPA)== false and(LoadBoolean(HY, h, 513)) then
			set IMX = 360 * 3 / 5.
			set a = IMX + GUA
			set x = CoordinateX50(WYE + d * Cos(a * bj_DEGTORAD))
			set y = CoordinateY50(WZE + d * Sin(a * bj_DEGTORAD))
			call SetUnitX(GPA, x)
			call SetUnitY(GPA, y)
			set U2 = WUE
			call GroupEnumUnitsInRange(g, x, y, 95, Condition(function D8X))
			if FirstOfGroup(g)!= null then
				call GHA(WUE, GPA)
			endif
			call GroupClear(g)
			set PTV = GPA
			set PWV = 3
			set PQV = WUE
			call GroupEnumUnitsInRange(g, x, y, 175, Condition(function DYX))
			call ForGroup(g, function GBA)
			call GroupClear(g)
		endif
		if UnitIsDead(GQA)== false and(LoadBoolean(HY, h, 514)) then
			set IMX = 360 * 2 / 5.
			set a = IMX + GUA
			set x = CoordinateX50(WYE + d * Cos(a * bj_DEGTORAD))
			set y = CoordinateY50(WZE + d * Sin(a * bj_DEGTORAD))
			call SetUnitX(GQA, x)
			call SetUnitY(GQA, y)
			set U2 = WUE
			call GroupEnumUnitsInRange(g, x, y, 95, Condition(function D8X))
			if FirstOfGroup(g)!= null then
				call GHA(WUE, GQA)
			endif
			call GroupClear(g)
			set PTV = GQA
			set PWV = 4
			set PQV = WUE
			call GroupEnumUnitsInRange(g, x, y, 175, Condition(function DYX))
			call ForGroup(g, function GBA)
			call GroupClear(g)
		endif
		if UnitIsDead(GSA)== false and(LoadBoolean(HY, h, 515)) then
			set IMX = 360 * 1 / 5.
			set a = IMX + GUA
			set x = CoordinateX50(WYE + d * Cos(a * bj_DEGTORAD))
			set y = CoordinateY50(WZE + d * Sin(a * bj_DEGTORAD))
			call SetUnitX(GSA, x)
			call SetUnitY(GSA, y)
			set U2 = WUE
			call GroupEnumUnitsInRange(g, x, y, 95, Condition(function D8X))
			if FirstOfGroup(g)!= null then
				call GHA(WUE, GSA)
			endif
			call GroupClear(g)
			set PTV = GSA
			set PWV = 5
			set PQV = WUE
			call GroupEnumUnitsInRange(g, x, y, 175, Condition(function DYX))
			call ForGroup(g, function GBA)
			call GroupClear(g)
		endif
		call LogoutGroup(g)
	endif
	set t = null
	set WUE = null
	set GLA = null
	set GMA = null
	set GPA = null
	set GQA = null
	set GSA = null
	set g = null
	return false
endfunction
function DIE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit GLA
	local unit GMA
	local unit GPA
	local unit GQA
	local unit GSA
	local real x
	local real y
	set x = GetUnitX(WUE)+$FA* Cos(bj_DEGTORAD * 360 * 5 / 5. *-1.)
	set y = GetUnitY(WUE)+$FA* Sin(bj_DEGTORAD * 360 * 5 / 5. *-1.)
	set GLA = CreateUnit(GetOwningPlayer(WUE),'h0CJ', x, y, 360 * 5 / 5. *-1.)
	call UnitAddPermanentAbility(GLA,'Aloc')
	set x = GetUnitX(WUE)+$FA* Cos(bj_DEGTORAD * 360 * 4 / 5. *-1.)
	set y = GetUnitY(WUE)+$FA* Sin(bj_DEGTORAD * 360 * 4 / 5. *-1.)
	set GMA = CreateUnit(GetOwningPlayer(WUE),'h0CJ', x, y, 360 * 4 / 5. *-1.)
	call ShowUnit(GMA, false)
	call SetUnitInvulnerable(GMA, true)
	set x = GetUnitX(WUE)+$FA* Cos(bj_DEGTORAD * 360 * 3 / 5. *-1.)
	set y = GetUnitY(WUE)+$FA* Sin(bj_DEGTORAD * 360 * 3 / 5. *-1.)
	set GPA = CreateUnit(GetOwningPlayer(WUE),'h0CJ', x, y, 360 * 3 / 5. *-1.)
	call ShowUnit(GPA, false)
	call SetUnitInvulnerable(GMA, true)
	set x = GetUnitX(WUE)+$FA* Cos(bj_DEGTORAD * 360 * 2 / 5. *-1.)
	set y = GetUnitY(WUE)+$FA* Sin(bj_DEGTORAD * 360 * 2 / 5. *-1.)
	set GQA = CreateUnit(GetOwningPlayer(WUE),'h0CJ', x, y, 360 * 2 / 5. *-1.)
	call ShowUnit(GQA, false)
	call SetUnitInvulnerable(GQA, true)
	set x = GetUnitX(WUE)+$FA* Cos(bj_DEGTORAD * 360 * 1 / 5. *-1.)
	set y = GetUnitY(WUE)+$FA* Sin(bj_DEGTORAD * 360 * 1 / 5. *-1.)
	set GSA = CreateUnit(GetOwningPlayer(WUE),'h0CJ', x, y, 360 * 1 / 5. *-1.)
	call ShowUnit(GSA, false)
	call SetUnitInvulnerable(GSA, true)
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 393,(GLA))
	call SaveUnitHandle(HY, h, 394,(GMA))
	call SaveUnitHandle(HY, h, 395,(GPA))
	call SaveUnitHandle(HY, h, 396,(GQA))
	call SaveUnitHandle(HY, h, 397,(GSA))
	call SaveBoolean(HY, h, 511,(true))
	call SaveBoolean(HY, h, 512,(false))
	call SaveBoolean(HY, h, 513,(false))
	call SaveBoolean(HY, h, 514,(false))
	call SaveBoolean(HY, h, 515,(false))
	call SaveBoolean(HY, h, 655,(false))
	call SaveBoolean(HY, h, 656,(false))
	call SaveReal(HY, h, 138,($96* 1.))
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(WUE,'A1T8'))
	call UnitAddPermanentAbility(WUE,'A24B')
	call UnitAddPermanentAbility(WUE,'A24A')
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function GKA))
	set WUE = null
	set t = null
	set GLA = null
	set GMA = null
	set GPA = null
	set GQA = null
	set GSA = null
endfunction
function GWA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local integer level =(LoadInteger(HY, h, 5))
	if FK then
		call SetUnitToReduceDamage(WUE, GetEventDamage()* .05 * level)
	endif
	set t = null
	set WUE = null
	return false
endfunction
function GYA takes unit u returns nothing
	call UnitRemoveAbility(u,'A1VM')
	if LoadBoolean(ExtraHT, GetHandleId(u), HTKEY_DAMAGE_OVERCHARGE) then
		call SaveBoolean(ExtraHT, GetHandleId(u), HTKEY_DAMAGE_OVERCHARGE,(false))
		//set t =(LoadTriggerHandle(HY,(GetHandleId(u)), 709))
		//call FlushChildHashtable(HY,(GetHandleId(t)))
		//call CleanCurrentTrigger(t)
		//call RemoveSavedHandle(HY,(GetHandleId(u)), 709)
		//set t = null
	endif
endfunction
function GZA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	call GYA(WUE)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	return false
endfunction
function G_A takes unit u, integer i returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2,(u))
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function GZA))
	call UnitAddPermanentAbilitySetLevel(u,'A1VM', i)
	if not LoadBoolean(ExtraHT, GetHandleId(u), HTKEY_DAMAGE_OVERCHARGE) then
		call SaveBoolean(ExtraHT, GetHandleId(u), HTKEY_DAMAGE_OVERCHARGE, true )
		//set t = CreateTrigger()
		//set h = GetHandleId(t)
		//call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DAMAGED)
		//call TriggerAddCondition(t, Condition(function GWA))
		//call SaveTriggerHandle(HY,(GetHandleId(u)), 709,(t))
		//call SaveUnitHandle(HY,(GetHandleId(t)), 2,(u))
		//call SaveInteger(HY,(GetHandleId(t)), 5,(i))
	endif
	set t = null
endfunction
// 过载
function G0A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local integer EVX =(LoadInteger(HY, h, 34))
	local integer level = GetUnitAbilityLevel(WUE,'A28Q')
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local unit G1A =(LoadUnitHandle(HY,(GetHandleId(WUE)), 652))
	local boolean I1O = false
	local real G2A = .2 *(GetWidgetLife(WUE)* .025)
	local real G3A = .2 *(GetUnitState(WUE, UNIT_STATE_MANA)* .025)
	if GetTriggerEventId()== EVENT_UNIT_ISSUED_ORDER then
		if GetIssuedOrderId()== 852589 then
			call G_A(WUE, level)
		elseif GetIssuedOrderId()== 852590 then
			call GYA(WUE)
		endif
	endif
	if GetUnitAbilityLevel(WUE,'A1VM')> 0 then
		set I1O = true
		call SetWidgetLife(WUE, RMaxBJ(GetWidgetLife(WUE)-G2A, 1))
		call SetUnitState(WUE, UNIT_STATE_MANA, RMaxBJ(GetUnitState(WUE, UNIT_STATE_MANA)-G3A, 1))
	endif
	if G1A == null then
		if targetUnit != null then
			call GYA(targetUnit)
			set targetUnit = null
			call SaveUnitHandle(HY, h, 17,(targetUnit))
		endif
	else
		if targetUnit == null then
			set targetUnit = G1A
			if I1O then
				call SaveUnitHandle(HY, h, 17,(targetUnit))
				call G_A(targetUnit, level)
			else
				call GYA(targetUnit)
			endif
		elseif targetUnit != G1A then
			call GYA(targetUnit)
			if I1O then
				set targetUnit = G1A
				call SaveUnitHandle(HY, h, 17,(targetUnit))
				call G_A(targetUnit, level)
			endif
		elseif I1O == false then
			call GYA(targetUnit)
		elseif targetUnit == G1A then
			if I1O then
				set targetUnit = G1A
				call SaveUnitHandle(HY, h, 17,(targetUnit))
				call G_A(targetUnit, level)
			endif
		endif
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set G1A = null
	return false
endfunction
function PVE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(WUE,'A28Q')
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 17,(null))
	call TriggerRegisterTimerEvent(t, .2, true)
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_ISSUED_ORDER)
	call TriggerAddCondition(t, Condition(function G0A))
	set WUE = null
	set t = null
endfunction
function G4A takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), PYV)== false then
		call GroupAddUnit(PYV, GetEnumUnit())
		call AddAbilityToTimed(GetEnumUnit(),'A304', 1, .25 + .5 * PZV,'B304')
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\DragonHawkMissile\\DragonHawkMissile.mdl", GetEnumUnit(), "chest"))
	endif
endfunction
function G5A takes unit WUE, unit targetUnit, group CNO, integer level returns nothing
	local real x1 = GetUnitX(WUE)
	local real y1 = GetUnitY(WUE)
	local real x2 = GetUnitX(targetUnit)
	local real y2 = GetUnitY(targetUnit)
	local real a = AngleBetweenXY(x1, y1, x2, y2)* bj_DEGTORAD
	local real x
	local real y
	local real d = GetDistanceBetween(x1, y1, x2, y2)
	local group g = LoginGroup(448)
	local integer i = 1
	set PYV = CNO
	set PZV = level
	loop
	exitwhen i > 8
		set U2 = WUE
		set x = x1 + d * i / 8 * Cos(a)
		set y = y1 + d * i / 8 * Sin(a)
		call GroupEnumUnitsInRange(g, x, y, 100, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call ForGroup(g, function G4A)
		call GroupClear(g)
		set i = i + 1
	endloop
	call LogoutGroup(g)
	set g = null
endfunction
function G6A takes unit WUE, unit targetUnit returns boolean
	return((LoadInteger(HY,(GetHandleId((WUE))),(4294)))== 1)
endfunction
function G7A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real d = GetDistanceBetweenUnits(WUE, targetUnit)
	local real a = AngleBetweenUnit(WUE, targetUnit)* bj_DEGTORAD
	local real x = GetUnitX(WUE)+ 20 * Cos(a)
	local real y = GetUnitY(WUE)+ 20 * Sin(a)
	local location l
	if ( d < 300 or d >$866 ) or not IsUnitCanMove(WUE) then
		set l = DEX(x, y)
		set x = GetLocationX(l)
		set y = GetLocationY(l)
		if IsUnitType(WUE, UNIT_TYPE_HERO) then
			call SaveBoolean(K, GetHandleId(WUE), 99, true)
		endif
		call SetUnitX(WUE, CoordinateX50(x))
		call SetUnitY(WUE, CoordinateY50(y))
		call KillDestructablesInCircle(x, y, 350)
		call RemoveLocation(l)
		set l = null
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call SaveInteger(HY,(GetHandleId((WUE))),(4295), 2)
	else
		if IsUnitType(WUE, UNIT_TYPE_HERO) then
			call SaveBoolean(K, GetHandleId(WUE), 99, true)
		endif
		call SetUnitX(WUE, x)
		call SetUnitY(WUE, y)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function G8A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local group CNO =(LoadGroupHandle(HY, h,$85))
	local lightning APX =(LoadLightningHandle(HY, h,$C4))
	local integer EVX = GetTriggerEvalCount(t)
	local real d = GetDistanceBetweenUnits(WUE, targetUnit)
	local real a = 1
	local real G9A = GetWidgetLife(WUE)
	local real DDO = GetUnitState(WUE, UNIT_STATE_MANA)
	local real HVA =(LoadReal(HY, h, 670))
	local real HEA =(LoadReal(HY, h, 667))
	local real HXA
	local real HOA
	if targetUnit == null or WUE == null or UnitIsDead(WUE) or(EVX > 600 and G6A(WUE, targetUnit)== false and((LoadInteger(HY,(GetHandleId((WUE))),(4295)))== 1)== false) or(d > 925 and((LoadInteger(HY,(GetHandleId((WUE))),(4295)))!= 1)) or GetTriggerEventId()== EVENT_WIDGET_DEATH or(GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A1TU') then
		call LogoutGroup(CNO)
		call DestroyLightning(APX)
		call UnitRemoveAbility(targetUnit,'A1TM')
		call UnitRemoveAbility(targetUnit,'A1TL')
		call UnitRemoveAbility(targetUnit,'A1TK')
		call UnitRemoveAbility(targetUnit,'A1TN')
		call UnitRemoveAbility(targetUnit,'B0DH')
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(WUE,'A1TM')
		call UnitRemoveAbility(WUE,'A1TL')
		call UnitRemoveAbility(WUE,'A1TK')
		call UnitRemoveAbility(WUE,'A1TN')
		call UnitRemoveAbility(WUE,'B0DH')
		call UnitRemoveAbility(WUE,'A1TU')
		if Rubick_AbilityFilter(WUE , 'A1TA') then
			call S9E(GetOwningPlayer(WUE),'A1TA', true)
		endif
		call RemoveSavedHandle(HY, GetHandleId(WUE), 652)
	else
		set HXA = G9A / GetUnitState(WUE, UNIT_STATE_MAX_LIFE)
		set HOA = DDO / GetUnitState(WUE, UNIT_STATE_MAX_MANA)
		if HXA -HVA > 0 and(HXA -HVA)< .5 then
			if((LoadInteger(HY,(GetHandleId((WUE))),(4298)))== 1)== false then
				call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+(HXA -HVA)* GetUnitState(WUE, UNIT_STATE_MAX_LIFE)* 1.5)
			endif
		endif
		if HOA -HEA > 0 and(HOA -HEA)< .5 then
			call SetUnitState(targetUnit, UNIT_STATE_MANA, GetUnitState(targetUnit, UNIT_STATE_MANA)+(HOA -HEA)* GetUnitState(WUE, UNIT_STATE_MAX_MANA)* 1.5)
		endif
		call SaveReal(HY, h, 670,((GetWidgetLife(WUE)/ GetUnitState(WUE, UNIT_STATE_MAX_LIFE))* 1.))
		call SaveReal(HY, h, 667,((GetUnitState(WUE, UNIT_STATE_MANA)/ GetUnitState(WUE, UNIT_STATE_MAX_MANA))* 1.))
		call MoveLightning(APX, true, GetUnitX(WUE), GetUnitY(WUE), GetUnitX(targetUnit), GetUnitY(targetUnit))
		call G5A(WUE, targetUnit, CNO, LoadInteger(HY, h, 0))
		if UnitVisibleToPlayer(WUE, LocalPlayer)== false and UnitVisibleToPlayer(targetUnit, LocalPlayer)== false then
			set a = 0
		endif
		if IsObserver then
			set a = 1
		endif
		if d < 700 or((LoadInteger(HY,(GetHandleId((WUE))),(4295)))== 1) then
			call SetLightningColor(APX, .0, 1., 1., a)
		else
			call SetLightningColor(APX, .8, .7, .4, a)
		endif
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set CNO = null
	set APX = null
	return false
endfunction
function DAE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local lightning APX = AddLightning("CHIM", true, GetUnitX(WUE), GetUnitY(WUE), GetUnitX(targetUnit), GetUnitY(targetUnit))
	local integer level = GetUnitAbilityLevel(WUE,'A1TA')
	local integer HRA
	local real d = GetDistanceBetweenUnits(WUE, targetUnit)
	local real a = AngleBetweenUnit(WUE, targetUnit)* bj_DEGTORAD
	local location l
	local real x
	local real y
	call SetLightningColor(APX, .0, 1., 1., 1)
	call UnitAddPermanentAbility(WUE,'A1TU')
	if level == 1 then
		set HRA ='A1TM'
	elseif level == 2 then
		set HRA ='A1TL'
	elseif level == 3 then
		set HRA ='A1TK'
	elseif level == 4 then
		set HRA ='A1TN'
	endif
	call S9E(GetOwningPlayer(WUE),'A1TA', false)
	call UnitAddPermanentAbility(WUE, HRA)
	call UnitAddPermanentAbility(targetUnit, HRA)
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveInteger(HY, h, 0, level)
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveGroupHandle(HY, h,$85,(LoginGroup(449)))
	call SaveLightningHandle(HY, h,$C4,(APX))
	call SaveReal(HY, h, 670,((GetWidgetLife(WUE)/ GetUnitState(WUE, UNIT_STATE_MAX_LIFE))* 1.))
	call SaveReal(HY, h, 667,((GetUnitState(WUE, UNIT_STATE_MANA)/ GetUnitState(WUE, UNIT_STATE_MAX_MANA))* 1.))
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function G8A))
	call SaveUnitHandle(HY,(GetHandleId(WUE)), 652,(targetUnit))
	if d > 700 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(WUE))
		call SaveUnitHandle(HY, h, 17,(targetUnit))
		call SaveEffectHandle(HY, h, 32,(AddSpecialEffectTarget("Abilities\\Weapons\\DragonHawkMissile\\DragonHawkMissile.mdl", WUE, "chest")))
		call TriggerRegisterTimerEvent(t, .02, true)
		call TriggerAddCondition(t, Condition(function G7A))
		call SaveInteger(HY,(GetHandleId((WUE))),(4295), 1)
	endif
	set WUE = null
	set targetUnit = null
	set APX = null
	set t = null
	set l = null
endfunction
function HIA takes unit WUE, real x, real y returns boolean
	local boolean JVX = false
	local player p = GetOwningPlayer(WUE)
	local unit dummyUnit = CreateUnit(p,'e02Q', GetUnitX(WUE), GetUnitY(WUE), 0)
	call UnitAddPermanentAbility(dummyUnit,'A1V4')
	if IssuePointOrderById(dummyUnit,$D022D, x, y) then
		call KillUnit(dummyUnit)
		set dummyUnit = null
		set p = null
		return true
	else
		call KillUnit(dummyUnit)
		set dummyUnit = null
		set p = null
		return false
	endif
endfunction
function HAA takes string ATX, unit targetUnit returns nothing
	local texttag tt = CreateTextTag()
	call SetTextTagText(tt, ATX, .033)
	call SetTextTagPosUnit(tt, targetUnit, 64)
	call SetTextTagColor(tt, 0, 50, 255, 255)
	call SetTextTagVelocity(tt, 0, .0355)
	call SetTextTagFadepoint(tt, .15)
	call SetTextTagPermanent(tt, false)
	call SetTextTagLifespan(tt, .85)
	call SetTextTagVisibility(tt, IsPlayerAlly(LocalPlayer, GetOwningPlayer(targetUnit)))
	set tt = null
endfunction
function HNA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local integer EVX = GetTriggerEvalCount(t)
	if UnitIsDead(WUE)== false and EVX <$C then
		call HAA(I2S($C-EVX), WUE)
	endif
	if EVX ==$C then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	return false
endfunction
function HBA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY,(GetHandleId(WUE)), 652))
	local real W_E =(LoadReal(HY, h, 47))
	local real W0E =(LoadReal(HY, h, 48))
	local real WYE =(LoadReal(HY, h, 189))
	local real WZE =(LoadReal(HY, h,$BE))
	local fogmodifier fm =(LoadFogModifierHandle(HY, h, 42))
	local string s
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call SaveInteger(HY,(GetHandleId((WUE))),(4294), 2)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FogModifierStop(fm)
		call DestroyFogModifier(fm)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call KillDestructablesInCircle(W_E, W0E,$FA)
		call KillDestructablesInCircle(WYE, WZE,$FA)
		set s = "Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl"
		if GetTriggerEvalCount(t)== 1 then
			if UnitIsDead(WUE)== false then
				call DestroyEffect(AddSpecialEffect(s, GetUnitX(WUE), GetUnitY(WUE)))
				call SetUnitPosition(WUE, W_E, W0E)
				call PanCameraToTimedForPlayer(GetOwningPlayer(WUE), W_E, W0E, 0)
				call DestroyEffect(AddSpecialEffect(s, GetUnitX(WUE), GetUnitY(WUE)))
			endif
			if targetUnit != null and UnitIsDead(targetUnit)== false and GetOwningPlayer(targetUnit)!= Sentinels[0]and GetOwningPlayer(targetUnit)!= Scourges[0]and(LoadBoolean(HY, GetHandleId(GetOwningPlayer(targetUnit)),$8B)== false) then
				call DestroyEffect(AddSpecialEffect(s, GetUnitX(targetUnit), GetUnitY(targetUnit)))
				call EPX(targetUnit, 4402, 1)
				call SetUnitPosition(targetUnit, W_E, W0E)
				if IsUnitType(targetUnit, UNIT_TYPE_HERO) and UnitIsDead(targetUnit)== false then
					call PanCameraToTimedForPlayer(GetOwningPlayer(targetUnit), W_E, W0E, 0)
				endif
				call DestroyEffect(AddSpecialEffect(s, GetUnitX(targetUnit), GetUnitY(targetUnit)))
			endif
		else
			if UnitIsDead(WUE)== false then
				call DestroyEffect(AddSpecialEffect(s, GetUnitX(WUE), GetUnitY(WUE)))
				call SetUnitPosition(WUE, WYE, WZE)
				call PanCameraToTimedForPlayer(GetOwningPlayer(WUE), WYE, WZE, 0)
				call DestroyEffect(AddSpecialEffect(s, GetUnitX(WUE), GetUnitY(WUE)))
			endif
			if targetUnit != null and UnitIsDead(targetUnit)== false and GetOwningPlayer(targetUnit)!= Sentinels[0]and GetOwningPlayer(targetUnit)!= Scourges[0]and(LoadBoolean(HY, GetHandleId(GetOwningPlayer(targetUnit)),$8B)== false) then
				call DestroyEffect(AddSpecialEffect(s, GetUnitX(targetUnit), GetUnitY(targetUnit)))
				call EPX(targetUnit, 4402, 1)
				call SetUnitPosition(targetUnit, WYE, WZE)
				if IsUnitType(targetUnit, UNIT_TYPE_HERO) and UnitIsDead(targetUnit)== false then
					call PanCameraToTimedForPlayer(GetOwningPlayer(targetUnit), WYE, WZE, 0)
				endif
				call DestroyEffect(AddSpecialEffect(s, GetUnitX(targetUnit), GetUnitY(targetUnit)))
			endif
			call SaveInteger(HY,(GetHandleId((WUE))),(4294), 2)
			call DestroyEffect((LoadEffectHandle(HY, h, 32)))
			call FogModifierStop(fm)
			call DestroyFogModifier(fm)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set fm = null
	return false
endfunction
function HCA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local real W_E =(LoadReal(HY, h, 47))
	local real W0E =(LoadReal(HY, h, 48))
	local fogmodifier fm = null
	local integer level = GetUnitAbilityLevel(WUE,'A1TB')+ GetUnitAbilityLevel(WUE,'A3FQ')
	if C5X(WUE) or C4X(WUE) or UnitIsDead(WUE) then
		call SaveInteger(HY,(GetHandleId((WUE))),(4294), 2)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEvalCount(t)==(2.75 -0.25 * level)/ .05 then
		set fm = null
		call FogModifierStart(fm)
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(WUE))
		call TriggerRegisterTimerEvent(t, .01, false)
		call TriggerRegisterTimerEvent(t, 12, false)
		call TriggerRegisterDeathEvent(t, WUE)
		call TriggerAddCondition(t, Condition(function HBA))
		call SaveReal(HY, h, 189,((GetUnitX(WUE))* 1.))
		call SaveReal(HY, h, 190,((GetUnitY(WUE))* 1.))
		call SaveReal(HY, h, 47,((W_E)* 1.))
		call SaveReal(HY, h, 48,((W0E)* 1.))
		call SaveEffectHandle(HY, h, 32,(AddSpecialEffect("war3mapImported\\EarthlyEminence.mdl", GetUnitX(WUE), GetUnitY(WUE))))
		call SaveFogModifierHandle(HY, h, 42,(fm))
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(WUE))
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function HNA))
	endif
	set WUE = null
	set t = null
	set fm = null
	return false
endfunction
function DNE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit targetUnit =(LoadUnitHandle(HY,(GetHandleId(WUE)), 652))
	local integer id = GetPlayerId(GetOwningPlayer(WUE))
	local integer level = GetUnitAbilityLevel(WUE,'A1TB')+ GetUnitAbilityLevel(WUE,'A3FQ')
	//local boolean b = false
	call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl", WUE, "chest"))
	//if IsPlayerAlly(GetOwningPlayer(WUE), LocalPlayer) or(MW and IsObserver) or IsVisibleToPlayer(x, y, LocalPlayer) then
		//set b = true
		call PingMinimapEx(x, y, 4., 255, 0, 0, false)
	//endif
	call A8X(GetOwningPlayer(WUE), 2.5, x, y, 300)
	call SaveUnitHandle(HY, h, 2,(WUE))
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function HCA))
	call SaveReal(HY, h, 47,((x)* 1.))
	call SaveReal(HY, h, 48,((y)* 1.))
	call SaveEffectHandle(HY, h, 32,(AddSpecialEffect("war3mapImported\\EarthlyEminence.mdl", x, y)))
	call SaveInteger(HY,(GetHandleId((WUE))),(4294), 1)
	set WUE = null
	set targetUnit = null
	set t = null
endfunction
function LBE takes nothing returns nothing
	if HIA(GetTriggerUnit(), GetSpellTargetX(), GetSpellTargetY())== false then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n0KX'))
	else
		if IsSentinelsPlayer(GetOwningPlayer(GetTriggerUnit())) then
			if IsPointInRegion(P0V, GetSpellTargetX(), GetSpellTargetY()) then
				call EXStopUnit(GetTriggerUnit())
				call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n03Y'))
			endif
		else
			if IsPointInRegion(P_V, GetSpellTargetX(), GetSpellTargetY()) then
				call EXStopUnit(GetTriggerUnit())
				call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n03Y'))
			endif
		endif
	endif
endfunction
function PZX takes nothing returns nothing
	set P_V = CreateRegion()
	call RegionAddRect(P_V, G4)
	call RegionAddRect(P_V, O0)
	set P0V = CreateRegion()
	call RegionAddRect(P0V, F4)
	call RegionAddRect(P0V, R0)
endfunction
function HDA takes unit WUE, unit targetUnit, real WYE, real WZE, real a2 returns nothing
	local integer i = 0
	local real W_E
	local real W0E = GetUnitY(targetUnit)
	local real a
	local real x
	local real y
	local real HFA
	set a = a2
	set W_E = WYE + 50 * Cos(a * bj_DEGTORAD)
	set W0E = WZE + 50 * Sin(a * bj_DEGTORAD)
	set HFA = a
	set x = W_E +$C8* Cos(HFA * bj_DEGTORAD)
	set y = W0E +$C8* Sin(HFA * bj_DEGTORAD)
	call BRX(CreateDestructable('B006', x, y,-1 * HFA, .6, 1), 7)
	call KillDestructablesInCircle(x, y, 300)
	set HFA = a -40
	set x = W_E +$C8* Cos(HFA * bj_DEGTORAD)
	set y = W0E +$C8* Sin(HFA * bj_DEGTORAD)
	call BRX(CreateDestructable('B006', x, y,-1 * HFA, .6, 1), 7)
	call KillDestructablesInCircle(x, y, 300)
	set HFA = a -80
	set x = W_E +$C8* Cos(HFA * bj_DEGTORAD)
	set y = W0E +$C8* Sin(HFA * bj_DEGTORAD)
	call BRX(CreateDestructable('B006', x, y,-1 * HFA, .6, 1), 7)
	call KillDestructablesInCircle(x, y, 300)
	set HFA = a + 40
	set x = W_E +$C8* Cos(HFA * bj_DEGTORAD)
	set y = W0E +$C8* Sin(HFA * bj_DEGTORAD)
	call BRX(CreateDestructable('B006', x, y,-1 * HFA, .6, 1), 7)
	call KillDestructablesInCircle(x, y, 300)
	set HFA = a + 80
	set x = W_E +$C8* Cos(HFA * bj_DEGTORAD)
	set y = W0E +$C8* Sin(HFA * bj_DEGTORAD)
	call BRX(CreateDestructable('B006', x, y,-1 * HFA, .6, 1), 7)
	call KillDestructablesInCircle(x, y, 300)
endfunction
function HGA takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), P3V)== false then
		call GroupAddUnit(P3V, GetEnumUnit())
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\ChainFreeze_F6.mdx", GetEnumUnit(), "chest"))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl", GetEnumUnit(), "chest"))
		call UnitDamageTargetEx(P1V, GetEnumUnit(), 1, P2V * 70)
	endif
endfunction
function HHA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local unit HJA = LoadUnitHandle(HY, h, 45)
	local real HKA = LoadReal(HY, h, 683)
	local real HLA = LoadReal(HY, h, 684)
	local real WYE = GetUnitX(HJA)
	local real WZE = GetUnitY(HJA)
	local real radian = Atan2(HLA -WZE, HKA -WYE)
	local real targetX = WYE + 22 * Cos(radian)
	local real targetY = WZE + 22 * Sin(radian)
	local group gg = LoadGroupHandle(HY, h,$85)
	local integer level = LoadInteger(HY, h, 0)
	local group g = LoginGroup(450)
	set U2 = WUE
	set P1V = WUE
	set P3V = gg
	set P2V = level
	call GroupEnumUnitsInRange(g, targetX, targetY,$E1, Condition(function DJX))
	call ForGroup(g, function HGA)
	call LogoutGroup(g)
	call SetUnitPosition(HJA, targetX, targetY)
	if GetDistanceBetween(targetX, targetY, HKA, HLA)< 40 then
		call KillUnit(HJA)
		call SetUnitPathing(HJA, true)
		call HDA(WUE, null, targetX, targetY, radian * bj_RADTODEG)
		call LogoutGroup(gg)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set WUE = null
	set targetUnit = null
	set t = null
	set HJA = null
	set gg = null
	set g = null
	return false
endfunction
function DBE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit HJA = CreateUnit(GetOwningPlayer(WUE),'h0CS', GetUnitX(WUE), GetUnitY(WUE), 0)
	local real WYE = GetUnitX(WUE)
	local real WZE = GetUnitY(WUE)
	local real W_E = GetSpellTargetX()
	local real W0E = GetSpellTargetY()
	local real radian = Atan2(W0E -WZE, W_E -WYE)
	local real HKA = CoordinateX50(W_E)
	local real HLA = CoordinateY50(W0E)
	call SetUnitFacing(HJA, radian * bj_RADTODEG)
	call SetUnitPathing(HJA, false)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function HHA))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveReal(HY, h, 683, HKA * 1.)
	call SaveReal(HY, h, 684, HLA * 1.)
	call SaveReal(HY, h, 13, radian * 1.)
	call SaveUnitHandle(HY, h, 45, HJA)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	call SaveGroupHandle(HY, h,$85, LoginGroup(451))
	set WUE = null
	set HJA = null
	set t = null
endfunction
function HMA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 0)
	local integer EVX = GetTriggerEvalCount(t)
	local real y =(EVX -50)*(EVX -50)/ 4.3
	local real IXX
	if level == 1 then
		set IXX = 75
	elseif level == 2 then
		set IXX =$96
	else
		set IXX =$E1
	endif
	if EVX == 1 then
		call IssueTargetOrderById(WUE, 851983, targetUnit)
	endif
	if EVX < 50 then
		if O0X(targetUnit)== false then
			call SetUnitFlyHeight(targetUnit, 700 * EVX / 50, 0)
		endif
	elseif EVX < 100  then
		if O0X(targetUnit)== false then
			call SetUnitFlyHeight(targetUnit, 700 -700 *(EVX -50)/ 50, 0)
		endif
	else
		if O0X(targetUnit)== false then
			call SetUnitFlyHeight(targetUnit, GetUnitDefaultFlyHeight(targetUnit), 0)
		endif
		call DestroyEffect(LoadEffectHandle(HY, h, 175))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call CNX(targetUnit,'A204', 1, 1 + level,'B0DY')
		call S9E(GetOwningPlayer(targetUnit),'A204', false)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function WalrusPunchHitActions takes unit WUE, unit targetUnit, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call CommonTextTag("WALRUS PUNCH !!", 3.5, WUE, .03, 255, 0, 0, 255)
	call PlaySoundAtPoint(WalrusPunchSound, GetUnitX(targetUnit), GetUnitY(targetUnit))
	call CommonUnitAddStun(targetUnit, 1., false)
	if O0X(targetUnit)== false then
		call UnitAddPermanentAbility(targetUnit,'Amrf')
		call UnitRemoveAbility(targetUnit,'Amrf')
	endif
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl", targetUnit, "overhead"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl", targetUnit, "head"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl", targetUnit, "left,hand"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl", targetUnit, "right,hand"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl", targetUnit, "chest"))
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl", targetUnit, "origin"))
	call TriggerRegisterTimerEvent(t, .01, true)
	call TriggerAddCondition(t, Condition(function HMA))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveInteger(HY, h, 0, level)
	call SaveEffectHandle(HY, h, 175, AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathMissile.mdl", targetUnit, "chest"))
	set t = null
endfunction

function WalrusPunch__RemoveBuff__Actions takes nothing returns nothing
	local custombuff b = GetTriggerBuff()
	local integer h = GetHandleId(b.source)
	call DestroyEffect(LoadEffectHandle(ExtraHT, h, 'A1YQ'))
	call RemoveSavedHandle(ExtraHT, h, 'A1YQ')
endfunction

function WalrusPunch__AddBuff__Actions takes nothing returns nothing
	local custombuff b = GetTriggerBuff()
	local integer h = GetHandleId(b.source)
	call DestroyEffect(LoadEffectHandle(ExtraHT, h, 'A1YQ'))
	call RemoveSavedHandle(ExtraHT, h, 'A1YQ')
endfunction

// 海象挥击
function SpellEffect__WalrusPunch takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local custombuff b

	set b = b.create(u, u)
	set b.aid = 'AWPR'
	set b.bid = 'BWPR'
	set b.dur = 10.
	set b.overlayDur = true
	set b.level = GetUnitAbilityLevel(u, GetSpellAbilityId())
	set b.removeActions = "WalrusPunch__RemoveBuff__Actions"
	set b.addActions = "WalrusPunch__AddBuff__Actions"
	call b.add_buff()

	set u = null
endfunction
function HOX takes nothing returns nothing
	call UnitAddPermanentAbility(U2,'A3DF')
	call SetPlayerAbilityAvailable(GetOwningPlayer(U2),'A3DF', true)
endfunction
function HCX takes nothing returns nothing
	call SetPlayerAbilityAvailable(GetOwningPlayer(U2),'A3DF', false)
endfunction
function HWA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE =(LoadUnitHandle(HY,(h), 2))
	local unit WLE =(LoadUnitHandle(HY,(h), 17))
	local real HYA =(LoadReal(HY,(h), 6))
	local real HZA =(LoadReal(HY,(h), 7))
	local real a = LoadReal(HY, h, 1)
	local real H_A =(LoadReal(HY,(h), 23))
	local real H0A =(LoadReal(HY,(h), 24))
	local real nX
	local real nY
	local boolean X_A = false
	local real LMR = LoadReal(HY, h, 0)
	set nX = H_A + LMR * Cos(a)
	set nY = H0A + LMR * Sin(a)
	if GetDistanceBetween(nX, nY, HYA, HZA)<(5 + LMR) then
		set nX = HYA
		set nY = HZA
		set X_A = true
	endif
	set nX = CoordinateX50(nX)
	set nY = CoordinateY50(nY)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or GetUnitAbilityLevel(WLE,'B08V')> 0 or GetTriggerEvalCount(t)>$C8 then
		set X_A = true
	else
		call SetUnitPosition(WLE, nX, nY)
		call SetUnitX(WLE, nX)
		call SetUnitY(WLE, nY)
		call KillDestructablesInCircle(nX, nY, 120)
		call SaveReal(HY,(h), 23,((nX)* 1.))
		call SaveReal(HY,(h), 24,((nY)* 1.))
	endif
	if X_A then
		call SetUnitPathing(WLE, true)
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	endif
	set WLE = null
	set t = null
	set WJE = null
	return false
endfunction
function H1A takes nothing returns nothing
	local unit WLE = GetSpellTargetUnit()
	local unit WJE = GetTriggerUnit()
	local integer level = 1
	local trigger t
	local integer h
	local real angle
	local real x = GetUnitX(WJE)
	local real y = GetUnitY(WJE)
	local integer i =-1
	local boolean H2A = false
	local real distance = 900
	set angle = AngleBetweenUnit(WJE, WLE)* bj_DEGTORAD
	set t = CreateTrigger()
	set h = GetHandleId(t)
	loop
	exitwhen H2A or i == 23
		set i = i + 1
		set x = CoordinateX50(GetUnitX(WLE)+(distance -i * 25)* Cos(angle))
		set y = CoordinateY50(GetUnitY(WLE)+(distance -i * 25)* Sin(angle))
		if(IsPointInRegion(R4,((x)* 1.),((y)* 1.)))== false then
			set H2A = true
		endif
	endloop
	call SetUnitPathing(WLE, false)
	call TriggerRegisterTimerEvent(t, .03, true)
	call TriggerRegisterDeathEvent(t, WLE)
	call TriggerAddCondition(t, Condition(function HWA))
	call SaveUnitHandle(HY,(h), 2,(WJE))
	call SaveUnitHandle(HY,(h), 17,(WLE))
	call SaveReal(HY,(h), 6,((x)* 1.))
	call SaveReal(HY,(h), 7,((y)* 1.))
	call SaveReal(HY,(h), 23,((GetUnitX(WLE))* 1.))
	call SaveReal(HY,(h), 24,((GetUnitY(WLE))* 1.))
	call SaveInteger(HY,(h), 34, 0)
	call SaveReal(HY, h, 0, 900 * .03)
	call SaveReal(HY, h, 1, angle)
	call AddAbilityToTimed(WLE,'A3DG', 1, 5,'B3DG')
	call UnitDamageTargetEx(WJE, WLE, 1, 200)
	set WLE = null
	set WJE = null
	set t = null
endfunction
function KNE takes nothing returns nothing
	if GetSpellTargetUnit()== RoShan then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), GetObjectName('n0K9'))
	else
		call EYX("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl", GetTriggerUnit(), "hand", .2)
	endif
endfunction
function DDE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call H1A()
	endif
endfunction
function H3A takes nothing returns nothing
	local unit u = GetEnumUnit()
	call ShowUnit(u, true)
	call UnitRemoveAbility(u,'A04R')
	call SetUnitInvulnerableEx(u, false)
	call PauseUnit(u, false)
	if IsUnitType(u, UNIT_TYPE_HERO) then
		call SetUnitPosition(u, P9V, QVV)
		call SelectUnitForPlayerSingle(u, GetOwningPlayer(u))
	else
		call SetUnitX(u, P9V)
		call SetUnitY(u, QVV)
	endif
	if u == P5V and P6V != null then
		call IssueTargetOrderById(P5V, 851983, P6V)
	endif
	call DestroyEffect(AddSpecialEffect("war3mapImported\\ChainFreeze_F6.mdx", GetUnitX(u), GetUnitY(u)))
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl", GetUnitX(u), GetUnitY(u)))
	set u = null
endfunction
function H4A takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), P4V)== false then
		call GroupAddUnit(P4V, GetEnumUnit())
		call UnitDamageTargetEx(P5V, GetEnumUnit(), 1, 40 * P8V + 40)
		call CommonUnitAddStun(GetEnumUnit(), .25 * P8V + .25, false)
	endif
endfunction
function H5A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY,(h), 2))
	local unit targetUnit =(LoadUnitHandle(HY,(h), 17))
	local unit d =(LoadUnitHandle(HY,(h), 45))
	local real W_E = GetUnitX(targetUnit)
	local real W0E = GetUnitY(targetUnit)
	local real r =(LoadReal(HY,(h), 671))
	local real a = AngleBetweenXY(GetUnitX(d), GetUnitY(d), W_E, W0E)* bj_DEGTORAD
	local real x = GetUnitX(d)+ r * Cos(a)
	local real y = GetUnitY(d)+ r * Sin(a)
	local group CNO =(LoadGroupHandle(HY,(h),$85))
	local group g
	local integer c = GetTriggerEvalCount(t)
	local real REI = RMinBJ(2.5 +(c * .02), 10)
	local real KJR =$E1+ 40 *(c * .02)
	set P8V = GetUnitAbilityLevel(u,'A1S7')
	set U2 = u
	set P4V = CNO
	set P5V = u
	set P6V = targetUnit
	set P7V =(LoadUnitHandle(HY,(h), 19))
	call SetUnitX(d, x)
	call SetUnitY(d, y)
	call SetUnitFacing(d, a * bj_RADTODEG -$B4)
	call SetUnitScale(d, REI, REI, REI)
	if GetDistanceBetween(x, y, W_E, W0E)< r * 2 or c == 150 then
		call KillDestructablesInCircle(x, y, 200)
		set g = LoginGroup(452)
		call GroupEnumUnitsInRange(g, x, y, KJR, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call ForGroup(g, function H4A)
		call LogoutGroup(g)
		set g = null
		set P9V = x
		set QVV = y
		set g = LoadGroupHandle(HY,(h), 22)
		call ForGroup((g), function H3A)
		call LogoutGroup(g)
		call LogoutGroup(CNO)
		call KillUnit(d)
		call CleanCurrentTrigger(t)
		if GetUnitAbilityLevel(targetUnit,'A3E9')== 1 and not IsMagicImmuneUnit(u) then
			call SaveUnitHandle(VV,'A3E9', 0, targetUnit)
			call SaveUnitHandle(VV,'A3E9', 1, u)
			call SaveInteger(VV,'A3E9', 0, LoadInteger(HY, h, 5))
			call ExecuteFunc("H6A")
		endif
		call FlushChildHashtable(HY,(h))
	else
		if ModuloInteger(GetTriggerEvalCount(t), 5)== 0 then
			call KillDestructablesInCircle(x, y, 200)
			set g = LoginGroup(453)
			call GroupEnumUnitsInRange(g, x, y, KJR, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
			call ForGroup(g, function H4A)
			call LogoutGroup(g)
			set g = null
		endif
	endif
	set t = null
	set u = null
	set d = null
	set CNO = null
	set targetUnit = null
	return false
endfunction
function Web_removestate takes unit u returns nothing
	if IsUnitType(u, UNIT_TYPE_HERO) then//防止蜘蛛网检测不到，先删了蜘蛛网隐身。
		call UnitRemoveAbility(u,'A021')
	else
		call UnitRemoveAbility(u,'A29C')
	endif
	call UnitRemoveAbility(u,'B01C')
endfunction
function H7A takes nothing returns nothing
	local unit u = GetEnumUnit()
	call DestroyEffect(AddSpecialEffect("war3mapImported\\ChainFreeze_F6.mdx", GetUnitX(u), GetUnitY(u)))
	call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl", GetUnitX(u), GetUnitY(u)))
	call ShowUnit(u, false)
	call UnitAddPermanentAbility(u,'A04R')
	call SetUnitInvulnerableEx(u, true)
	call PauseUnit(u, true)
	call Web_removestate(u)
	set u = null
endfunction
function H8A takes nothing returns boolean
	local unit t = GetFilterUnit()
	local player p = GetOwningPlayer(t)
	local boolean b = false
	if IsUnitAlly(P5V, p) and(p == GetOwningPlayer(P5V) or(LoadBoolean(HY, GetHandleId(p),$8B)== false and IsUnitType(t, UNIT_TYPE_HERO))) and IsAliveNotStrucNotWard(t) then
		set b = true
	endif
	set t = null
	return b
endfunction
function H9A takes unit u, unit target, integer lv returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real x1 = GetUnitX(u)
	local real y1 = GetUnitY(u)
	local real x2 = GetUnitX(target)
	local real y2 = GetUnitY(target)
	local real a = AngleBetweenXY(x1, y1, x2, y2)* bj_DEGTORAD
	local unit d = CreateUnit(GetOwningPlayer(u),'h0C3', GetUnitX(u), GetUnitY(u), GetUnitFacing(u))
	local group g = LoginGroup(454)
	set HV = 0
	set P5V = u
	set HV = 675
	call GroupEnumUnitsInRange(g, x1, y1, 255, Condition(function H8A))
	call ForGroup(g, function H7A)
	set P7V = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call SetUnitTimeScale(d, 2)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function H5A))
	call SaveUnitHandle(HY,(h), 2,(u))
	call SaveInteger(HY, h, 5, lv)
	call SaveUnitHandle(HY,(h), 17,(target))
	call SaveUnitHandle(HY,(h), 19,(P7V))
	call SaveUnitHandle(HY,(h), 45,(d))
	call SaveReal(HY,(h), 137,((a)* 1.))
	call SaveReal(HY,(h), 671,((HV * .02)* 1.))
	call SaveReal(HY,(h), 47,((x2)* 1.))
	call SaveReal(HY,(h), 48,((y2)* 1.))
	call SaveGroupHandle(HY,(h), 22,(g))
	call SaveGroupHandle(HY,(h),$85,(LoginGroup(455)))
	set t = null
	set d = null
endfunction
function DFE takes nothing returns nothing
	call H9A(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(),'A1S7'))
endfunction
function H6A takes nothing returns nothing
	call T4V(LoadUnitHandle(VV,'A3E9', 0))
	call H9A(LoadUnitHandle(VV,'A3E9', 0), LoadUnitHandle(VV,'A3E9', 0), LoadInteger(VV,'A3E9', 0))
	call FlushChildHashtable(VV,'A3E9')
endfunction
function JVA takes unit u returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call TriggerAddCondition(t, Condition(function EBA))
	set t = null
endfunction
function JEA takes nothing returns boolean
	if IsUnitEnemy(GetFilterUnit(), E3) and IsAliveNotStrucNotWard(GetFilterUnit()) and IsMagicImmuneUnit(GetFilterUnit())== false then
		call AddAbilityToTimed(GetFilterUnit(), Q2, 1, 2, Q22)
	endif
	return false
endfunction
function JXA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit JOA =(LoadUnitHandle(HY, h, 2))
	local unit WJE =(LoadUnitHandle(HY, h, 17))
	local group g
	local integer level = LoadInteger(HY, h, 5)
	if GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		if GetTriggerEvalCount(t)== 1 then
			call IssueTargetOrderById(JOA, 851986, WJE)
			call TriggerRegisterDeathEvent(t, JOA)
		endif
		set E3 = GetOwningPlayer(JOA)
		if level == 1 then
			set Q2 = 'A3JT'
			set Q22 ='B0DT'
		elseif level == 2 then
			set Q2 = 'A3JU'
			set Q22 ='B0DU'
		elseif level == 3 then
			set Q2 = 'A3JV'
			set Q22 = 'B0DS'
		elseif level == 4 then
			set Q2 ='A3JW'
			set Q22 = 'B0DR'
		endif
		//set Q2='A3JT'+level-1
		set g = LoginGroup(456)
		call GroupEnumUnitsInRange(g, GetUnitX(JOA), GetUnitY(JOA), 1200, Condition(function JEA))
		call LogoutGroup(g)
	else
		call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl", GetUnitX(JOA), GetUnitY(JOA)))
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set JOA = null
	set WJE = null
	return false
endfunction
function JRA takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerAddCondition(t, Condition(function JXA))
	call TriggerRegisterTimerEvent(t, .2, true)
	call SaveUnitHandle(HY, h, 2, GetSummonedUnit())
	call SaveUnitHandle(HY, h, 17, GetSummoningUnit())
	call SaveInteger(HY, h, 5, GetUnitAbilityLevel(GetSummoningUnit(),'A1YR'))
	set t = null
endfunction
function JIA takes nothing returns boolean
	local integer id = GetUnitTypeId(GetSummonedUnit())
	if id =='o01J' or id =='o01K' or id =='o01L' or id =='o01M' then
		call JVA(GetSummonedUnit())
		call JRA()
	endif
	return false
endfunction
function P_X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function JIA))
	set t = null
endfunction
function JAA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local unit dummyUnit =(LoadUnitHandle(HY, h, 19))
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_UNIT_DAMAGED and FK then
		set QEV = GetEventDamageSource()
	else
		call SetUnitX(WUE, GetUnitX(targetUnit))
		call SetUnitY(WUE, GetUnitY(targetUnit))
		call SetUnitX(dummyUnit, GetUnitX(targetUnit))
		call SetUnitY(dummyUnit, GetUnitY(targetUnit))
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set dummyUnit = null
	return false
endfunction
function JNA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	if GetTriggerEventId()== EVENT_UNIT_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		set QEV = GetEventDamageSource()
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function JBA takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetSummoningUnit()
	local unit targetUnit = GetSummonedUnit()
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(WUE), GetUnitY(WUE), 0)
	local integer level
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function JAA))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveUnitHandle(HY, h, 19,(dummyUnit))
	if GYX(WUE,'I0A8') then
		call UnitAddAbility(dummyUnit,'A04I')
	endif
	if GetUnitAbilityLevel(WUE,'A14K')> 0 then
		call UnitAddAbility(dummyUnit,'A14K')
	endif
	set level = GetUnitAbilityLevel(WUE,'A06M')
	if level == 0 then
		set level = 4
	endif
	if GetUnitAbilityLevel(WUE,'A1B6')> 0 then
		call UnitAddPermanentAbility(targetUnit,'A06M')
		call SetUnitAbilityLevel(targetUnit,'A06M', level)
	endif
	call SaveInteger(HY, GetHandleId(WUE), 4500, 1)
	set t = null
	set WUE = null
	set targetUnit = null
	set dummyUnit = null
endfunction
function JCA takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetSummoningUnit()
	local unit targetUnit = GetSummonedUnit()
	local integer level = 4
	local integer id
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function JNA))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	
	call SingleDebug("元素进入地图")
	if GetUnitAbilityLevel(WUE,'A1B6')> 0 then
		if GetUnitTypeId(targetUnit)=='npn2' or GetUnitTypeId(targetUnit)=='npn5' or GetUnitTypeId(targetUnit)=='n012' then
			set id ='Acdh'
			/*set level = GetUnitAbilityLevel(WUE,'Acdh')
			if level == 0 then
				set level = 4
			endif*/
		else
			set id ='A0MX'
			call Add__DrunkenBrawler__Actions(targetUnit)
			call UnitAddPermanentAbility(targetUnit, 'QP0H')
			call SetUnitAbilityLevel(targetUnit, 'QP0H', level)
			/*set level = GetUnitAbilityLevel(WUE,'A0MX')
			if level == 0 then
				set level = 4
			endif*/
		endif
		call UnitAddPermanentAbility(targetUnit, id)
		call SetUnitAbilityLevel(targetUnit, id, level)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
endfunction
function JDA takes nothing returns boolean
	local integer OVX = GetUnitTypeId(GetSummonedUnit())
	if OVX =='npn3' or OVX =='npn6' or OVX =='n010' or OVX =='n0GZ' then
		call JBA()
	elseif IsPrimalTypeId(OVX) then
		call JCA()
	endif
	return false
endfunction
function P0X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function JDA))
	set t = null
endfunction
function JFA takes nothing returns boolean
	if UnitIsDead(GetFilterUnit())== false and IsAliveNotStrucNotWard(GetFilterUnit()) then
		call RemoveUnitBuff(GetFilterUnit(), IsUnitEnemy(GetFilterUnit(), E3))
	endif
	return false
endfunction
function JXE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local group g = LoginGroup(457)
	set E3 = GetOwningPlayer(u)
	call GroupEnumUnitsInRange(g, GetSpellTargetX(), GetSpellTargetY(), 625, Condition(function JFA))
	call LogoutGroup(g)
	set u = null
endfunction
function F6E takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0)
	call UnitAddAbility(d,'A3ID')
	call SetUnitAbilityLevel(d,'A3ID', GetUnitAbilityLevel(GetTriggerUnit(),'A06M'))
	call IssueImmediateOrderById(d,$D0080)
	set d = null
endfunction
function JGA takes nothing returns nothing
	call CommonUnitAddStun(GetEnumUnit(), .75 + .25 * LI, false)
endfunction
function JHA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local real a = LoadReal(HY, h, 137)
	local real W_E = LoadReal(HY, h, 47)
	local real W0E = LoadReal(HY, h, 48)
	local real WYE = LoadReal(HY, h, 189)
	local real WZE = LoadReal(HY, h,$BE)
	local group g
	local real d = GetDistanceBetween(WYE, WZE, W_E, W0E)/ 25
	local location l
	local integer EVX = GetTriggerEvalCount(t)
	local real x = WYE + d * EVX * Cos(a)
	local real y = WZE + d * EVX * Sin(a)
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		call SaveBoolean(K, GetHandleId(targetUnit), 99, true)
	endif
	call SetUnitX(targetUnit, CoordinateX50(x))
	call SetUnitY(targetUnit, CoordinateY50(y))
	if O0X(targetUnit)== false then
		call SetUnitFlyHeight(targetUnit, 325 -$D* EVX, 0)
	endif
	if EVX == 25 then
		if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
			call SaveBoolean(K, GetHandleId(targetUnit), 99, true)
		endif
		call SetUnitX(targetUnit, CoordinateX50(W_E))
		call SetUnitY(targetUnit, CoordinateY50(W0E))
		if IsPointInRegion(R4, GetUnitX(targetUnit), GetUnitY(targetUnit)) then
			set l = DEX(GetUnitX(targetUnit), GetUnitY(targetUnit))
			if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
				call SaveBoolean(K, GetHandleId(targetUnit), 99, true)
			endif
			call SetUnitX(targetUnit, CoordinateX75(GetLocationX(l)))
			call SetUnitY(targetUnit, CoordinateY75(GetLocationY(l)))
			call RemoveLocation(l)
			set l = null
		endif
		set U2 = WUE
		set g = LoginGroup(458)
		call GroupEnumUnitsInRange(g, GetUnitX(targetUnit), GetUnitY(targetUnit), 350, Condition(function DKX))
		call GroupRemoveUnit(g, targetUnit)
		set LI = LoadInteger(HY, h, 0)
		call ForGroup(g, function JGA)
		call LogoutGroup(g)
		call KillDestructablesInCircle(GetUnitX(targetUnit), GetUnitY(targetUnit), 150)
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl", GetUnitX(targetUnit), GetUnitY(targetUnit)))
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call DestroyEffect(LoadEffectHandle(HY, h, 176))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		if O0X(targetUnit)== false then
			call SetUnitFlyHeight(targetUnit, GetUnitDefaultFlyHeight(targetUnit), 0)
		endif
		call SetUnitPathing(targetUnit, true)
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	set g = null
	return false
endfunction
function JJA takes unit WUE, unit targetUnit, unit Target2, real JKA, real JLA, effect FX, effect JMA, integer level returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local real W_E = JKA
	local real W0E = JLA
	local real a = AngleBetweenXY(GetUnitX(targetUnit), GetUnitY(targetUnit), JKA, JLA)* bj_DEGTORAD
	if GetDistanceBetween(GetUnitX(targetUnit), GetUnitY(targetUnit), JKA, JLA)> 375 then
		set W_E = GetUnitX(targetUnit)+ 375 * Cos(a)
		set W0E = GetUnitY(targetUnit)+ 375 * Sin(a)
	endif
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveReal(HY, h, 137, a * 1.)
	call SaveReal(HY, h, 47, W_E * 1.)
	call SaveReal(HY, h, 48, W0E * 1.)
	call SaveReal(HY, h, 189, GetUnitX(targetUnit)* 1.)
	call SaveReal(HY, h, 190, GetUnitY(targetUnit)* 1.)
	call SaveEffectHandle(HY, h, 32, FX)
	call SaveEffectHandle(HY, h, 176, JMA)
	call SaveInteger(HY, h, 0, level)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function JHA))
	set t = null
endfunction
function JPA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer EVX = LoadInteger(HY, h, 34)
	local integer KLR = LoadInteger(HY, h, 12)
	local real W_E = LoadReal(HY, h, 47)
	local real W0E = LoadReal(HY, h, 48)
	local integer JQA = LoadInteger(HY, h, 706)
	local real a
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or(GetTriggerEventId()!= EVENT_UNIT_SPELL_EFFECT and C5X(targetUnit)== false) then
		call S9E(GetOwningPlayer(WUE),'A27F', true)
		call S9E(GetOwningPlayer(WUE),'A27X', false)
		call JJA(WUE, targetUnit, LoadUnitHandle(HY, h, 711), W_E, W0E, LoadEffectHandle(HY, h, 32), LoadEffectHandle(HY, h, 176), LoadInteger(HY, h, 0))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT then
		if GetSpellAbilityId()=='A27X' then
			call DestroyEffect((LoadEffectHandle(HY, h, 176)))
			set a = AngleBetweenXY(GetUnitX(targetUnit), GetUnitY(targetUnit), GetSpellTargetX(), GetSpellTargetY())* bj_DEGTORAD
			if GetDistanceBetween(GetUnitX(targetUnit), GetUnitY(targetUnit), GetSpellTargetX(), GetSpellTargetY())> 375 then
				set W_E = GetUnitX(targetUnit)+ 375 * Cos(a)
				set W0E = GetUnitY(targetUnit)+ 375 * Sin(a)
			else
				set W_E = GetSpellTargetX()
				set W0E = GetSpellTargetY()
			endif
			call SaveEffectHandle(HY, h, 176, AddSpecialEffect("Abilities\\Spells\\Other\\GeneralAuraTarget\\GeneralAuraTarget.mdl", W_E, W0E))
			call SaveReal(HY, h, 47, W_E * 1.)
			call SaveReal(HY, h, 48, W0E * 1.)
			call SaveUnitHandle(HY, h, 711, GetSpellTargetUnit())
			call SaveEffectHandle(HY, h, 176, AddSpecialEffectTarget("Abilities\\Spells\\Other\\GeneralAuraTarget\\GeneralAuraTarget.mdl", GetSpellTargetUnit(), "origin"))
		endif
	else
		set EVX = EVX + 1
		call SaveInteger(HY, h, 34, EVX)
		call SetUnitPathing(targetUnit, false)
		if(LoadInteger(HY, h, 707))== 1 then
			set JQA = JQA + 3
		else
			set JQA = JQA -3
		endif
		call SaveInteger(HY, h, 706, JQA)
		if JQA == 30 then
			call SaveInteger(HY, h, 707,-1)
		elseif JQA ==-30 then
			call SaveInteger(HY, h, 707, 1)
		endif
		if O0X(targetUnit)== false then
			if EVX <$F then
				call SetUnitFlyHeight(targetUnit, EVX * 20, 0)
			else
				call SetUnitFlyHeight(targetUnit, 300 + JQA, 0)
			endif
		endif
		if EVX >(KLR -25) then
			if O0X(targetUnit)== false then
				call SetUnitFlyHeight(targetUnit, 300, 0)
			endif
			call S9E(GetOwningPlayer(WUE),'A27F', true)
			call S9E(GetOwningPlayer(WUE),'A27X', false)
			call JJA(WUE, targetUnit, LoadUnitHandle(HY, h, 711), W_E, W0E, LoadEffectHandle(HY, h, 32), LoadEffectHandle(HY, h, 176), LoadInteger(HY, h, 0))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	endif
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function JSA takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(WUE,'A27F')
	local real TXR = 1.25 + .25 * level
	local unit dummyUnit = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	set TXR = CommonUnitAddStun(targetUnit, TXR, false)
	call S9E(GetOwningPlayer(WUE),'A27F', false)
	call S9E(GetOwningPlayer(WUE),'A27X', true)
	call UnitAddAbility(WUE,'A27X')
	call SetUnitPathing(targetUnit, false)
	if O0X(targetUnit)== false then
		call UnitAddPermanentAbility(targetUnit,'Amrf')
		call UnitRemoveAbility(targetUnit,'Amrf')
	endif
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveUnitHandle(HY, h, 711, targetUnit)
	call SaveInteger(HY, h, 12, R2I(TXR / .02))
	call SaveInteger(HY, h, 34, 0)
	call SaveInteger(HY, h, 0, level)
	call SaveInteger(HY, h, 706, 0)
	call SaveInteger(HY, h, 707, 1)
	call SaveReal(HY, h, 47, GetUnitX(targetUnit)* 1.)
	call SaveReal(HY, h, 48, GetUnitY(targetUnit)* 1.)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("war3mapImported\\AntiGravityTarget.mdx", targetUnit, "origin"))
	call SaveEffectHandle(HY, h, 176, AddSpecialEffect("Abilities\\Spells\\Other\\GeneralAuraTarget\\GeneralAuraTarget.mdl", GetUnitX(targetUnit), GetUnitY(targetUnit)))
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function JPA))
	set WUE = null
	set targetUnit = null
	set t = null
	set dummyUnit = null
endfunction
function DGE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call JSA()
	endif
endfunction
function P1X takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A282')
endfunction
function JTA takes unit WUE, unit targetUnit, integer level returns nothing
	local integer id
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		if level == 1 then
			set id ='A27W'
		elseif level == 2 then
			set id ='A286'
		elseif level == 3 then
			set id ='A285'
		else
			set id ='A287'
		endif
	else
		if level == 1 then
			set id ='A291'
		elseif level == 2 then
			set id ='A28Z'
		elseif level == 3 then
			set id ='A292'
		else
			set id ='A290'
		endif
	endif
	call CXX(targetUnit, id, 1, 10)
	call PlaySoundAtPoint(SF, GetUnitX(targetUnit), GetUnitY(targetUnit))
endfunction
function JUA takes nothing returns nothing
	local real d
	if IsUnitInGroup(GetEnumUnit(), QRV)== false then
		set d = GetDistanceBetweenUnits(GetEnumUnit(), QOV)
		if d < QIV then
			set QIV = d
			set QXV = GetEnumUnit()
		endif
	endif
endfunction
function JWA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local group D7R = LoadGroupHandle(HY, h, 187)
	local real x = GetUnitX(targetUnit)
	local real y = GetUnitY(targetUnit)
	local group g = LoginGroup(459)
	call GroupAddUnit(D7R, targetUnit)
	call JTA(WUE, targetUnit, LoadInteger(HY, h, 0))
	set U2 = WUE
	set QXV = null
	set QOV = targetUnit
	set QRV = D7R
	set QIV =$F423F
	call GroupEnumUnitsInRange(g, x, y, 465, Condition(function DSX))
	call ForGroup(g, function JUA)
	call LogoutGroup(g)
	if QXV == null or GetTriggerEvalCount(t)> 26 then
		call LogoutGroup(D7R)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set targetUnit = QXV
		call SaveUnitHandle(HY, h, 17, targetUnit)
	endif
	set g = null
	set t = null
	set WUE = null
	set targetUnit = null
	set D7R = null
	return false
endfunction
function JYA takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local group D7R = LoginGroup(460)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(WUE), GetUnitY(WUE), GetUnitFacing(WUE))
	call PlaySoundAtPoint(SF, GetUnitX(WUE), GetUnitY(WUE))
	call UnitAddPermanentAbility(dummyUnit,'A284')
	call SetUnitAbilityLevel(dummyUnit,'A284', GetUnitAbilityLevel(WUE,'A27G'))
	call IssueTargetOrderById(dummyUnit,$D0097, targetUnit)
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveGroupHandle(HY, h, 187, D7R)
	call TriggerRegisterTimerEvent(t, .25, true)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	call TriggerAddCondition(t, Condition(function JWA))
	set WUE = null
	set targetUnit = null
	set t = null
	set dummyUnit = null
	set D7R = null
endfunction
function DHE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call JYA()
	endif
endfunction
function JZA takes integer id returns nothing
	set QAV[QNV]= id
	set QNV = QNV + 1
endfunction
function J_A takes integer id returns boolean
	local integer i = 0
	if IsNotItemAbility(id)== false then
		return true
	endif
	loop
	exitwhen i == QNV
		if id == QAV[i]then
			return true
		endif
		set i = i + 1
	endloop
	return false
endfunction
function J0A takes nothing returns boolean
	local unit u = GetTriggerUnit()
	local integer id = GetSpellAbilityId()
	local integer h
	if IsUnitType(u, UNIT_TYPE_HERO) and J_A(id)== false and GetUnitAbilityLevel(u,'A04R')== 0 then
		set h = GetHandleId(u)
		call SaveInteger(HY, h, 705, id)
		call SaveInteger(HY, h, 712, GetUnitAbilityLevel(u, id))
	endif
	set u = null
	return false
endfunction
function J1A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = (LoadUnitHandle(HY, h, 2))
	local integer id = (LoadInteger(HY, h, 704))
	local integer time = (LoadInteger(HY, h, 713))
	if id ==(LoadInteger(HY,(GetHandleId(u)), 704) ) then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif GetTriggerEvalCount(t)>(15 - time) and UnitAlive(u) then
		call UnitRemoveAbility(u, id)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set u = null
	return false
endfunction
function J4A takes unit u, integer id, real r returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function J1A))
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveInteger(HY, h, 704,(id))
	call SaveInteger(HY,(GetHandleId(u)), 704,(-1))
	call SaveInteger(HY, h, 713,(R2I(GetGameTime()-r)))
	set t = null
endfunction
function J5A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	local integer id =(LoadInteger(HY, h, 704))
	local integer c =(LoadInteger(HY, h, 34))
	local real r =(LoadReal(HY, h, 411))
	if GetTriggerEventId()!= EVENT_UNIT_SPELL_EFFECT and GetTriggerEventId()!= EVENT_WIDGET_DEATH then
		if c == 0 then
			call SaveInteger(HY, h, 34, 1)
			call DisplayTimedTextToPlayer(GetOwningPlayer(u), 0, 0, 10, "|c00ff0303" + GetObjectName('n0LW')+ "|r")
		else
			//call BYR(u)
			call S9E(GetOwningPlayer(u), id, false)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			call J4A(u, id, r)
		endif
	elseif GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT then
		if(GetSpellAbilityId()=='A27H' or GetSpellAbilityId()=='A30J') then
			if LoadInteger(HY,(GetHandleId(GetSpellTargetUnit())), 705) != id then
				call S9E(GetOwningPlayer(u), id, false)
				call J4A(u, id, r)
			endif
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		elseif GetSpellAbilityId()== id then
		//if GetSpellAbilityId()== id then
			call SaveReal(HY, h, 411, GetGameTime()* 1.)
		endif
	elseif GetTriggerEventId()== EVENT_WIDGET_DEATH then
		//call BYR(u)
		call S9E(GetOwningPlayer(u), id, false)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call J4A(u, id, r)
	endif
	set t = null
	set u = null
	return false
endfunction
function J6A takes unit u, integer id, integer level returns nothing
	if id =='A2O2'then
		set U2 = u
		call ExecuteFunc("PAI")
	endif
endfunction
function J7A takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	local unit target =(LoadUnitHandle(HY, h, 17))
	local integer J2A =(LoadInteger(HY, h, 704))
	local integer lv =(LoadInteger(HY, h, 5))
	local real J8A = 60 *(2 + IMaxBJ(GetUnitAbilityLevel(u,'A27H'), GetUnitAbilityLevel(u,'A30J')))
	local integer id = GetPlayerId(GetOwningPlayer(u))
	local boolean J9A = (GetUnitAbilityLevel(u, J2A)== 0) or J2A == LoadInteger(HY,(GetHandleId(u)), 704)
	local integer i = 1
	call PlaySoundAtPoint(LF, GetUnitX(u), GetUnitY(u))
	loop
	exitwhen i > 4 + ExtraAbilitiesNum  or J9A == false
		if HeroCommonSkills[PlayerSkillIndex[id * HL + i]] == J2A then
			set J9A = false
		endif
		if HeroUpgradeSkills[PlayerSkillIndex[id * HL + i]] == J2A then
			set J9A = false
		endif
		set i = i + 1
	endloop
	if J9A then
		if(LoadInteger(HY,(GetHandleId(target)), 710))> 0 then
			call SaveInteger(HY,(GetHandleId(u)), 710,((LoadInteger(HY,(GetHandleId(target)), 710))))
		endif
		call CommonTextTag(GetObjectName(J2A), 3.5, u, .024, 170, 0, 255,$D8)
		call SaveInteger(HY,(GetHandleId(u)), 704,(J2A))
		call S9E(GetOwningPlayer(u), J2A, true)
		call UnitAddPermanentAbility(u, J2A)
		call SetUnitAbilityLevel(u, J2A, lv)
		call J6A(u, J2A, lv)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(u))
		call SaveInteger(HY, h, 34, 0)
		call SaveInteger(HY, h, 704,(J2A))
		call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_EFFECT)
		call TriggerRegisterTimerEvent(t, J8A, false)
		call TriggerRegisterDeathEvent(t, u)
		call TriggerRegisterTimerEvent(t, J8A -20, false)
		call TriggerAddCondition(t, Condition(function J5A))
	else
		call CommonTextTag("窃取失败 ;(", 3.5, u, .024, 170, 0, 255,$D8)
	endif
	set t = null
	set u = null
	set target = null
endfunction
function KVA takes unit u, unit target, integer id, integer lv returns nothing
	local trigger t = NHX(target, u,'h0DB', "J7A", 900, false)
	local integer h = GetHandleId(t)
	call PlaySoundAtPoint(KF, GetUnitX(target), GetUnitY(target))
	call CommonTextTag(GetObjectName(id), 3.75, target, .024, 170, 0, 255,$D8)
	call SaveUnitHandle(HY, h, 2,(u))
	call SaveUnitHandle(HY, h, 17,(target))
	call SaveInteger(HY, h, 704,(id))
	call SaveInteger(HY, h, 5,(lv))
	set t = null
endfunction
function KXA takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit t = GetSpellTargetUnit()
	local integer id = LoadInteger(HY,(GetHandleId(t)), 705)
	local boolean b = GetSpellAbilityId()=='A30J'
	local integer key = 0
	if id != 0 then
		set key = GetSkillAghanimUpgradeIndex(id)
		if b then
			if key> 0 and CF[key]> 0 then
				set id = CF[key]
			endif
		else
			if key> 0 and NF[key]> 0 then
				set id = NF[key]
			endif
		endif
		call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Nebula.mdx", t, "origin"))
		call KVA(u, t, id, LoadInteger(HY, GetHandleId(t), 712))
	endif
	set u = null
	set t = null
endfunction
function DJE takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call KXA()
	endif
endfunction
//lbk 不能偷的技能
function KOA takes nothing returns nothing
	call JZA('QB0L')
	call JZA('A0A5')
	call JZA('A0AG')
	call JZA('A0BG')
	call JZA('A0DY')
	call JZA('A0ES')
	call JZA('A0FH')
	call JZA('A0GC')
	call JZA('A0NS')
	call JZA('A0Q5')
	call JZA('A0TE')
	call JZA('A0TK')
	call JZA('A0WP')
	call JZA('A0WQ')
	call JZA('A03G')
	call JZA('A03J')
	call JZA('A04J')
	call JZA('A04M')
	call JZA('A04N')
	call JZA('A073')
	call JZA('A1C0')
	call JZA('A1DA')
	call JZA('A1EA')
	call JZA('A1FQ')
	call JZA('A1MN')
	call JZA('A1NA')
	call JZA('A1NH')
	call JZA('A1RI')
	call JZA('A1S9')
	call JZA('A1T8')
	call JZA('A1TU')
	call JZA('A1TX')
	call JZA('A1VG')
	//call JZA('A1VH')
	call JZA('A1VU')
	call JZA('A1WF')
	call JZA('A1WO')
	call JZA('A1Z2')
	call JZA('A1Z3')
	call JZA('A2FX')
	call JZA('A2JL')
	call JZA('A2JO')
	call JZA('A2JP')
	call JZA('A2JQ')
	call JZA('A2JR')
	call JZA('A2K9')
	call JZA('A2KE')
	call JZA('A2KH')
	call JZA('A10R')
	//call JZA('A11N')
	call JZA('A11T')
	call JZA('A20N')
	call JZA('A21H')
	call JZA('A21J')
	call JZA('A24A')
	call JZA('A24B')
	call JZA('A24E')
	call JZA('A27F')
	call JZA('A27G')
	call JZA('A27H')
	call JZA('A27X')
	call JZA('A28Q')
	call JZA('A30J')
	call JZA('A32D')
	call JZA('A43D')
	call JZA('A43P')
	call JZA('A121')
	call JZA('A205')
	call JZA('A229')
	call JZA('A418')
	call JZA('ANcr')
	call JZA('QB0K')
	call JZA('QB03')
	call JZA('QM00')
	call JZA('QM01')
	call JZA('QM02')
	call JZA('QM03')
	call JZA('QM04')
	call JZA('Z234')
endfunction
function P2X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function J0A))
	set t = null
	call KOA()
endfunction

// 失效立场 抗拒叠加.
// 每次查询单位身上的Buff来源, 如果来源不是自己, 则不做动作.
// 如果没有来源, 则将来源设置为自己.
function NullFieldLoopActions takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local unit trigUnit =(LoadUnitHandle(HY, h, 2))
	local group lastGroup =(LoadGroupHandle(HY, h, 340))
	local real x = GetUnitX(trigUnit)
	local real y = GetUnitY(trigUnit)
	local real value
	local group tempGroup
	local unit firstUnit = null
	local integer uh
	local unit sourceUnit = null
	local integer level = 0
	local real data 
	local boolean addXP = ModuloInteger(GetTriggerEvalCount(trig), 2) == 0

	// 如果单位消失则关闭触发器
	if trigUnit == null or GetUnitTypeId(trigUnit) == 0 then //or GetUnitTypeId(trigUnit)!='E02X' 
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(trig)

		// 清空数据
		loop
			set firstUnit = FirstOfGroup(lastGroup)
		exitwhen firstUnit == null
			call GroupRemoveUnit(lastGroup, firstUnit) 
			set uh = GetHandleId(firstUnit)
			if LoadUnitHandle(ExtraHT, uh, 'A27V') == trigUnit then 
				call ReduceUnitMagicResistance(firstUnit, 0.05 * LoadInteger(ExtraHT, uh, 'A27V') )
				call RemoveSavedHandle(ExtraHT, uh, 'A27V')
				call RemoveSavedInteger(ExtraHT, uh, 'A27V')
			endif
		endloop

		call LogoutGroup(lastGroup)
		set trig = null
		set trigUnit = null
		set lastGroup = null
		return false
	endif

	if UnitAlive(trigUnit) and not IsUnitBreak(trigUnit) then

		if LoadBoolean(HY, h, 0) then
			call RemoveSavedBoolean(HY, h, 0)
		endif

		set Temp__Player = GetOwningPlayer(trigUnit)
		set level = GetUnitAbilityLevel(trigUnit, 'A27V')
		set data = 0.05 * level
		set tempGroup = LoginGroup(268)
		set EnumUnitMaximum = 0
		call GroupEnumUnitsInRange(tempGroup, x, y, 900 + MAX_UNIT_COLLISION, null)
		loop
			set firstUnit = FirstOfGroup(tempGroup)
		exitwhen firstUnit == null
			call GroupRemoveUnit(tempGroup, firstUnit)
			// 友军 存活 非建筑 非守卫
			if IsUnitInRangeXY(firstUnit, x, y, 900) and IsUnitAlly(firstUnit, Temp__Player) and IsAliveNotStrucNotWard(firstUnit) then
				set uh = GetHandleId(firstUnit)
				set sourceUnit = LoadUnitHandle(ExtraHT, uh, 'A27V') // 获取目标单位的Buff来源
				if sourceUnit == null then // 如果没有来源, 则将来源设置为自己.
					call SaveUnitHandle(ExtraHT, uh, 'A27V', trigUnit)
					call SaveInteger(ExtraHT, uh, 'A27V', level)
					call AddUnitMagicResistance(firstUnit, data)
				elseif sourceUnit != trigUnit or level > LoadInteger(ExtraHT, uh, 'A27V') then
					if level > LoadInteger(ExtraHT, uh, 'A27V') then // 如果等级>原有光环 则进行覆盖
						call ReduceUnitMagicResistance(firstUnit, 0.05 * LoadInteger(ExtraHT, uh, 'A27V') )
						call SaveUnitHandle(ExtraHT, uh, 'A27V', trigUnit)
						call SaveInteger(ExtraHT, uh, 'A27V', level)
						call AddUnitMagicResistance(firstUnit, data)
					endif
				endif
				if addXP then
					call AddHeroXPSimple(firstUnit, level, true)
				endif
				set EnumUnitMaximum = EnumUnitMaximum + 1
				set EnumUnits[EnumUnitMaximum] = firstUnit
			endif
		endloop
	
		call GroupAddEnumUnits(tempGroup)
		loop
			set firstUnit = FirstOfGroup(lastGroup)
		exitwhen firstUnit == null
			call GroupRemoveUnit(lastGroup, firstUnit)
			if not IsUnitInGroup(firstUnit, tempGroup) then // 如果不在组内 就表示离开了Buff范围
				set uh = GetHandleId(firstUnit)
				if LoadUnitHandle(ExtraHT, uh, 'A27V') == trigUnit then
					call ReduceUnitMagicResistance(firstUnit, 0.05 * LoadInteger(ExtraHT, uh, 'A27V') )
					call RemoveSavedHandle(ExtraHT, uh, 'A27V')
					call RemoveSavedInteger(ExtraHT, uh, 'A27V')
				endif
			endif
		endloop

		set sourceUnit = null
		call SaveGroupHandle(HY, h, 340,(tempGroup))
		call LogoutGroup(lastGroup)

	elseif not LoadBoolean(HY, h, 0) then
		call SaveBoolean(HY, h, 0, true)

		// 清空数据
		loop
			set firstUnit = FirstOfGroup(lastGroup)
		exitwhen firstUnit == null
			call GroupRemoveUnit(lastGroup, firstUnit) 
			set uh = GetHandleId(firstUnit)
			if LoadUnitHandle(ExtraHT, uh, 'A27V') == trigUnit then
				call ReduceUnitMagicResistance(firstUnit, 0.05 * LoadInteger(ExtraHT, uh, 'A27V') )
				call RemoveSavedHandle(ExtraHT, uh, 'A27V')
				call RemoveSavedInteger(ExtraHT, uh, 'A27V')
			endif
		endloop

		set tempGroup = LoginGroup(268)
		call SaveGroupHandle(HY, h, 340,(tempGroup))
		call LogoutGroup(lastGroup)

	endif

	set firstUnit = null
	
	set trig = null
	set trigUnit = null
	set lastGroup = null
	set tempGroup = null
	return false
endfunction
function GetSkill_NullField takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit souceUnit = GetTriggerUnit()
	local trigger t1 = CreateTrigger()
	local integer h1 = GetHandleId(t1)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function NullFieldLoopActions))
	call SaveUnitHandle(HY, h, 2,(souceUnit))
	call SaveGroupHandle(HY, h, 340,(LoginGroup(463)))
	
	set t = null
	set souceUnit = null
endfunction
function KNA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit KKX = LoadUnitHandle(HY, h, 1)
	local unit d = LoadUnitHandle(HY, h, 0)
	local real KBA = LoadReal(HY, h, 0)
	local integer c = LoadInteger(HY, h, 0)+ 1
	if UnitIsDead(KKX) and LoadBoolean(HY, h, 0)== false then
		call SaveBoolean(HY, h, 0, true)
	endif
	if LoadBoolean(HY, h, 0)== false then
		call SetUnitPosition(d, GetUnitX(KKX), GetUnitY(KKX))
		if GetWidgetLife(d)> KBA then
			call SetWidgetLife(KKX, GetWidgetLife(KKX)+(GetWidgetLife(d)-KBA))
			call SaveReal(HY, h, 0, GetWidgetLife(d))
		endif
	endif
	if c > 50 * 50 or UnitIsDead(KKX) or UnitIsDead(d) then
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
		call KillUnit(d)
	else
		call SaveInteger(HY, h, 0, c)
	endif
	set d = null
	set KKX = null
	set t = null
endfunction
function DLE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit d = CreateUnit(GetOwningPlayer(u),'e01V', GetUnitX(u), GetUnitY(u), 0)
	local timer t = CreateTimer()
	call KillUnit(LoadUnitHandle(HY, GetHandleId(u),'EXOR'))
	call UnitAddPermanentAbility(d,'A44C')
	call SetUnitAbilityLevel(d,'A44C', GetUnitAbilityLevel(u, GetSpellAbilityId()))
	call IssueImmediateOrderById(d,$D024C)
	call SetWidgetLife(d, 1)
	call TimerStart(t, .02, true, function KNA)
	call SaveUnitHandle(HY, GetHandleId(t), 0, d)
	call SaveUnitHandle(HY, GetHandleId(t), 1, u)
	call SaveReal(HY, GetHandleId(t), 0, 1)
	call SaveUnitHandle(HY, GetHandleId(u),'EXOR', d)
	set t = null
	set u = null
	set d = null
endfunction
function DKE takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetUnitFacing(GetTriggerUnit()))
	call UnitAddAbility(d,'A3II')
	call SetUnitAbilityLevel(d,'A3II', GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
	if GetSpellTargetUnit()== GetTriggerUnit() then
		call B1R(d, "carrionswarm", GetUnitX(GetTriggerUnit())+ 1 * Cos(bj_DEGTORAD * GetUnitFacing(GetTriggerUnit())), GetUnitY(GetTriggerUnit())+ 1 * Sin(bj_DEGTORAD * GetUnitFacing(GetTriggerUnit())))
	else
		call B1R(d, "carrionswarm", GetSpellTargetX(), GetSpellTargetY())
	endif
	set d = null
endfunction
function KCA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer id = LoadInteger(HY, h, 0)
	local timer tt = LoadTimerHandle(HY, h, 0)
	if YDWEGetUnitAbilityState(u, id, 1) > 0.5 then
		call Japi_SetUnitAbilityCoolDown1(u, id, 0.5)
		//call RefreshUnitAbilityCoolDownTimer(u, id, 0.5)
		call CommonTextTag("傻了吧!爷还有!", 3.5, u, .03, 255, 0, 0, 255)
	endif
	call DestroyTimer(tt)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set tt = null
	set t = null
endfunction
function KDA takes unit u, integer id returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local timer tt = CreateTimer()
	call TimerStart(tt, 0., false, null)
	call SaveBoolean(HY, h, 0, true)
	call TriggerRegisterTimerExpireEvent(t, tt)
	call SaveTimerHandle(HY, h, 0, tt)
	call TriggerAddCondition(t, Condition(function KCA))
	call SaveUnitHandle(HY, h, 0, u)
	call SaveInteger(HY, h, 0, id)
	set t = null
	set tt = null
endfunction
function KFA takes nothing returns nothing
	local integer probability
	local unit u = GetTriggerUnit()
	local integer id = GetSpellAbilityId()	
	if GetUnitAbilityLevel(GetTriggerUnit(),'A02C')!= 0 and YDWEGetUnitAbilityDataReal(u, id, GetUnitAbilityLevel(GetTriggerUnit(), id), 105)> 0.5 then
		set u = GetTriggerUnit()
		if IsUltimateSkill(id) then
			set probability = GetUnitAbilityLevel(u,'A02C')* 5 -5
		else
			set probability = GetUnitAbilityLevel(u,'A02C')* 5 + 5
		endif
		if probability > 0 and IsMetamorphosisSkill(id)== false and X8R(id) then
			if GetPrdRandom(u,'A02C', probability) or JE then
				call KDA(u, id)
			endif
		endif
		set u = null
	endif
endfunction
function KGA takes nothing returns nothing
	local unit u = GetTriggerUnit()
	if GetUnitTypeId(u)=='H00S' then
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl", u, "origin"))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl", u, "origin"))
	endif
	set u = null
endfunction
function KHA takes nothing returns nothing
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\ImmolationRed\\ImmolationRedDamage.mdl", GetEnumUnit(), "chest"))
	call UnitDamageTargetEx(QCV, GetEnumUnit(), 1,(20 +$A* QDV)/ 5)
endfunction
function KJA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local integer level = LoadInteger(HY, h, 0)
	local group g
	if(GetUnitAbilityLevel(WUE,'B0FP')== 0 and GetUnitAbilityLevel(WUE,'B0FQ')== 0) or(GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A2HS') then
		call DestroyEffect(LoadEffectHandle(HY, h, 32))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call UnitRemoveAbility(WUE,'A2H7')
		call UnitRemoveAbility(WUE,'B0FO')
		call UnitRemoveAbility(WUE,'A2IX')
		call UnitRemoveAbility(WUE,'A2IW')
		call UnitRemoveAbility(WUE,'A2IV')
		call UnitRemoveAbility(WUE,'A2IY')
	else
		set U2 = WUE
		set QCV = WUE
		set QDV = level
		set g = LoginGroup(464)
		call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE), 400 + 25, Condition(function DJX))
		call ForGroup(g, function KHA)
		call LogoutGroup(g)
	endif
	set g = null
	set t = null
	set WUE = null
	return false
endfunction
function DME takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(WUE),'e00E', GetUnitX(WUE), GetUnitY(WUE), 0)
	local integer level = GetUnitAbilityLevel(WUE,'A2HS')
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_EFFECT)
	call UnitAddAbility(dummyUnit,'A2H5')
	call SetUnitAbilityLevel(dummyUnit,'A2H5', level)
	call IssueTargetOrderById(dummyUnit,$D00DA, WUE)
	call TriggerRegisterTimerEvent(t, .2, true)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	call TriggerAddCondition(t, Condition(function KJA))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveEffectHandle(HY, h, 32, AddSpecialEffectTarget("war3mapImported\\FlameGuard.mdx", WUE, "origin"))
	set WUE = null
	set dummyUnit = null
	set t = null
endfunction
function KKA takes unit WUE returns nothing
	call UnitRemoveAbility(WUE,'BOhx')
	call UnitRemoveAbility(WUE,'B00H')
endfunction
function KLA takes unit WUE returns nothing
	call UnitRemoveAbility(WUE,'A2H9')
	call UnitRemoveAbility(WUE,'B0FM')
endfunction
function KMA takes unit WUE returns nothing
	call UnitRemoveAbility(WUE,'A2JH')
	call UnitRemoveAbility(WUE,'A2JG')
	call UnitRemoveAbility(WUE,'A2JJ')
	call UnitRemoveAbility(WUE,'A2JI')
	call UnitRemoveAbility(WUE,'B0FL')
endfunction
function KPA takes unit WUE returns nothing
	local integer TME = GetPlayerId(GetOwningPlayer(WUE))
	local boolean KQA
	local integer level
	if GetUnitAbilityLevel(WUE,'A0CY')> 0 then
		set KQA = YVE(WUE, TME * HL)
		if GetUnitAbilityLevel(WUE,'A0CY')> 0 then
			set level = GetUnitAbilityLevel(WUE,'A0CY')
		endif
		if KQA == false then
			call UnitAddPermanentAbility(WUE,'QF90'-1 + level)
		else
			call UnitAddPermanentAbility(WUE,'QF92'+ level)
		endif
	endif
endfunction
function KSA takes unit WUE returns nothing
	call UnitAddPermanentAbility(WUE,'A2H9')
	call S9E(GetOwningPlayer(WUE),'A2H9', false)
endfunction
function KTA takes unit WUE, integer level returns nothing
	if level < 1 then
		return
	endif
	if level == 1 then
		call UnitAddPermanentAbility(WUE,'A2JH')
	elseif level == 2 then
		call UnitAddPermanentAbility(WUE,'A2JG')
	elseif level == 3 then
		call UnitAddPermanentAbility(WUE,'A2JJ')
	else
		call UnitAddPermanentAbility(WUE,'A2JI')
	endif
endfunction
function KUA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit KWA = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	local group g = LoadGroupHandle(HY, h, 2)
	local group gg = LoadGroupHandle(HY, h, 3)
	if GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if GetEventDamageSource()== KWA and AD < 1 then
			call GroupAddUnit(g, WLE)
			call GroupRemoveUnit(gg, WLE)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		endif
	else
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set KWA = null
	set WLE = null
	set t = null
endfunction
// A2JF 待实现 伤害减少50%
function KYA takes unit KWA, unit WLE, integer level returns nothing
	local real a = GetRandomReal(0, 360)
	local real x = GetUnitX(WLE)+ 50 * Cos(a * bj_DEGTORAD)
	local real y = GetUnitY(WLE)+ 50 * Sin(a * bj_DEGTORAD)
	local trigger t = null
	local integer h
	call SetUnitPosition(KWA, x, y)
	call SetUnitFacing(KWA, bj_RADTODEG * Atan2(GetUnitY(WLE)-GetUnitY(KWA), GetUnitX(WLE)-GetUnitX(KWA)))
	call SetUnitAnimation(KWA, "Attack")
	call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Fire_Blink_2.mdx", KWA, "chest"))
	call KMA(KWA)
	if IsUnitType(WLE, UNIT_TYPE_HERO) or IsUnitIllusion(WLE) then
		call KTA(KWA, level)
		//call UnitRemoveAbility(KWA,'A2JF')
		if Mode__BalanceOff == false then
			if(GetUnitAbilityLevel(KWA,'A1J2')> 0) then
				call SetUnitAbilityLevel(KWA,'A1J2', 2)
			elseif(GetUnitAbilityLevel(KWA,'A1IT')> 0) then
				call SetUnitAbilityLevel(KWA,'A1IT', 2)
			elseif(GetUnitAbilityLevel(KWA,'A1J1')> 0) then
				call SetUnitAbilityLevel(KWA,'A1J1', 2)
			elseif(GetUnitAbilityLevel(KWA,'A1J0')> 0) then
				call SetUnitAbilityLevel(KWA,'A1J0', 2)
			endif
		endif
	else
		//call UnitAddPermanentAbility(KWA,'A2JF')
		//call S9E(GetOwningPlayer(KWA),'A2JF', false)
	endif
	if IssueTargetOrderById(KWA, 851983, WLE) then
		set t = CreateTrigger()
		call TriggerRegisterUnitEvent(t, WLE, EVENT_UNIT_DAMAGED)
		call TriggerRegisterTimerEvent(t, .2, false)
		call TriggerAddCondition(t, Condition(function KUA))
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 0, KWA)
		call SaveUnitHandle(HY, h, 1, WLE)
		call SaveGroupHandle(HY, h, 2, LoadGroupHandle(HY, GetHandleId(GetTriggeringTrigger()), 187))
		call SaveGroupHandle(HY, h, 3, LoadGroupHandle(HY, GetHandleId(GetTriggeringTrigger()), 22))
		set t = null
	else
		call GroupAddUnit(LoadGroupHandle(HY, GetHandleId(GetTriggeringTrigger()), 187), WLE)
		call GroupRemoveUnit(LoadGroupHandle(HY, GetHandleId(GetTriggeringTrigger()), 22), WLE)
	endif
endfunction
function KZA takes unit u returns nothing//移除所有缠绕效果
	call FHX(u)
endfunction
function K_A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 2)
	local real x = LoadReal(HY, h, 6)
	local real y = LoadReal(HY, h, 7)
	local group D7R = LoadGroupHandle(HY, h, 187)
	local group g = LoadGroupHandle(HY, h, 22)
	local unit target = null
	local boolean b = false
	local fogmodifier fm = LoadFogModifierHandle(HY, h, 42)
	local trigger tt
	loop
	exitwhen FirstOfGroup(g)== null or b
		set target = FirstOfGroup(g)
		call GroupRemoveUnit(g, target)
		if UnitIsDead(target) then
			call GroupRemoveUnit(g, target)
		elseif IsUnitInGroup(target, D7R) and target != null then
			set target = null
			set b = false
		else
			set b = true
		endif
	endloop
	call KZA(u)
	if b == false or(LoadInteger(HY, GetHandleId(u), 4319))== 1 or UnitIsDead(u) then
		call SaveInteger(HY, GetHandleId(u), 4318, 2)
		call KLA(u)
		call UnitRemoveAbility(u,'QF90')
		call UnitRemoveAbility(u,'QF91')
		call UnitRemoveAbility(u,'QF92')
		call UnitRemoveAbility(u,'QF93')
		call UnitRemoveAbility(u,'QF94')
		call UnitRemoveAbility(u,'QF95')
		//call UnitRemoveAbility(u,'A2JF')
		call KMA(u)
		call KZA(u)
		call KKA(u)
		//	call UnitAddAbility(u,'A2H2')
		//	call UnitRemoveAbility(u,'A2H2')
		call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A1UL', true)
		//	call RAX(u, LoadInteger(HY, h, 25))
		call YDWEUnitTransform( u, LoadInteger(ExtraHT, GetHandleId(u), HTKEY_UNIT_ORIGIN_TYPEID ) )
		call SetUnitCurrentScaleEx(u, GetUnitCurrentScale(u))
		//call FixUnitSkillsBug(u)
		if(LoadInteger(HY, GetHandleId(u), 4319)== 1)== false then
			call SetUnitX(u, LoadReal(HY, h, 189))
			call SetUnitY(u, LoadReal(HY, h,$BE))
		endif
		call ResetUnitVertexColor(u)
		call SetUnitVertexColorEx(u,-1,-1,-1, 255)
		call EXSetUnitPathing(u, true)
		call SetUnitInvulnerableEx(u, false)
		if GetUnitAbilityLevel(u,'A0MQ')+ GetUnitAbilityLevel(u,'A1B6')> 0 then
			call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A0MQ', true)
			call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A1B6', true)
		endif
		call SetUnitTimeScale(u, 1)
		call LogoutGroup(D7R)
		call LogoutGroup(g)
		call RemoveUnit((LoadUnitHandle(HY, h, 19)))
		call FogModifierStop(fm)
		call DestroyFogModifier(fm)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		call GroupAddUnit(D7R, target)
		call KYA(u, target, LoadInteger(HY, h, 0) )
	endif
	set fm = null
	set t = null
	set u = null
	set target = null
	set g = null
	set tt = null
	set D7R = null
	return false
endfunction
function K0A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local real x = LoadReal(HY, h, 1)
	local real y = LoadReal(HY, h, 2)
	local integer lv = LoadInteger(HY, h, 0)
	local trigger tt = CreateTrigger()
	local integer th = GetHandleId(tt)
	local fogmodifier fm = CreateFogModifierRadius(GetOwningPlayer(u), FOG_OF_WAR_VISIBLE, x, y, 600, true, true)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(u),'h0E7', GetUnitX(u), GetUnitY(u), GetUnitFacing(u))
	local group g = LoginGroup(465)
	local integer id = O5X(GetUnitTypeId(u))
	local real modelScale
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	if not Mode__RearmCombos then
		call KPA(u)
	endif
	call UnitRemoveAbility(u,'B01N')
	call UnitRemoveAbility(u,'Aetl')
	call SetUnitVertexColor(dummyUnit, 255, 255, 255, 100)
	call FogModifierStart(fm)
	call SaveInteger(HY, GetHandleId(u), 4318, 1)
	set U2 = u
	call GroupEnumUnitsInRange(g, x, y, 150 + 100 * lv + 25, Condition(function DTX))
	call KZA(u)
	call KKA(u)
	if GetUnitAbilityLevel(u,'A0MQ')+ GetUnitAbilityLevel(u,'A1B6')> 0 then
		call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A0MQ', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A1B6', false)
	endif
	call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A1UL', false)
	
	//	call UnitAddAbility(u,'A2H1')
	//	call UnitRemoveAbility(u,'A2H1')
	call YDWEUnitTransform(u,'N0MH')
	// 获取火猫的模型缩放后
	set modelScale = SetUnitCurrentScaleEx(u, GetUnitCurrentScale(u))
	call SetUnitScale(dummyUnit, modelScale, modelScale, modelScale)
	//call FixUnitSkillsBug(u)
	call SetUnitVertexColorEx(u,-1,-1,-1, 125)
	call EXSetUnitPathing(u, false)
	call SetUnitInvulnerableEx(u, true)
	call SetUnitTimeScale(u, 3)
	call TriggerRegisterTimerEvent(tt, .2, true)
	call TriggerAddCondition(tt, Condition(function K_A))
	call SaveUnitHandle(HY, th, 2, u)
	call SaveInteger(HY, th, 0, lv)
	call SaveReal(HY, th, 6, x * 1.)
	call SaveReal(HY, th, 7, y * 1.)
	call SaveReal(HY, th, 189, GetUnitX(u)* 1.)
	call SaveReal(HY, th, 190, GetUnitY(u)* 1.)
	call SaveGroupHandle(HY, th, 187, LoginGroup(466))
	call SaveGroupHandle(HY, th, 22, g)
	call SaveFogModifierHandle(HY, th, 42, fm)
	call SaveUnitHandle(HY, th, 19, dummyUnit)
	call KSA(u)
	call TriggerEvaluate(tt)
	set u = null
	set t = null
	set fm = null
	set dummyUnit = null
	set g = null
	set tt = null
endfunction
function SleightOfFist takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local integer level = GetUnitAbilityLevel(u,'A2H0')+ GetUnitAbilityLevel(u,'QB0L')
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveReal(HY, h, 1, x)
	call SaveReal(HY, h, 2, y)
	call SaveInteger(HY, h, 0, level)
	call TimerStart(t, 0, false, function K0A)
	set t = null
	set u = null
endfunction
function K1A takes nothing returns boolean
	local unit TJX = GetSummonedUnit()
	if IsUnitIllusion(TJX) and GetUnitTypeId(TJX)=='N0MH' then
		call KLA(TJX)
		//call UnitRemoveAbility(TJX,'A2JF')
		call KMA(TJX)
		call UnitAddAbility(TJX,'A2H2')
		call UnitRemoveAbility(TJX,'A2H2')
	endif
	set TJX = null
	return false
endfunction
function LCE takes nothing returns nothing
	if GetUnitTypeId(GetTriggerUnit())=='N0MH' or LoadInteger(HY, GetHandleId(GetTriggerUnit()), 4319) == 1 or GetUnitAbilityLevel(GetTriggerUnit(),'Aetl')> 0 or GetUnitAbilityLevel(GetTriggerUnit(),'B01N')> 0 or GetUnitAbilityLevel(GetTriggerUnit(),'B15V')> 0 or GetUnitAbilityLevel(GetTriggerUnit(),'Abun')> 0 or GetUnitAbilityLevel(GetTriggerUnit(),'B08Y')> 0 then
		call EXStopUnit(GetTriggerUnit())
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "现在无法使用。")
	endif
endfunction
function P3X takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function K1A))
	set t = null
endfunction
function K2A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer level = LoadInteger(HY, h, 0)
	local integer KLR = 2
	if level > 2 then
		set KLR = 3
	endif
	if GetTriggerEvalCount(t)== KLR then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	call UnitDamageTargetEx(WUE, targetUnit, 1, 20 + 20 * level)
	set t = null
	set WUE = null
	set targetUnit = null
	return false
endfunction
function K3A takes nothing returns nothing
	local unit WUE = U2
	local unit targetUnit = W2
	local unit dummyUnit = CreateUnit(GetOwningPlayer(targetUnit),'e00E', GetUnitX(targetUnit), GetUnitY(targetUnit), 0)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = LoadInteger(HY, GetHandleId(GetTriggeringTrigger()), 0)
	call UnitAddAbility(dummyUnit,'A2H4')
	call IssueTargetOrderById(dummyUnit,$D008A, targetUnit)
	call TriggerAddCondition(t, Condition(function K2A))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	call SaveInteger(HY, h, 0, level)
	call TriggerRegisterTimerEvent(t, 0, false)
	call TriggerRegisterTimerEvent(t, 1, true)
	set dummyUnit = null
	set WUE = null
	set targetUnit = null
	set t = null
endfunction
function DQE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local group g = LoginGroup(467)
	local real x = GetUnitX(WUE)
	local real y = GetUnitY(WUE)
	local unit u1 = null
	local unit u2 = null
	local unit u3 = null
	local integer XMR = 0
	local unit u
	local trigger t
	set U2 = WUE
	call GroupEnumUnitsInRange(g, x, y, 425, Condition(function DSX))
	loop
	exitwhen FirstOfGroup(g)== null or XMR == 2
		set u = GroupPickRandomUnit(g)
		if u != null then
			if XMR == 0 then
				set u1 = u
			elseif XMR == 1 then
				set u2 = u
			elseif XMR == 2 then
				set u3 = u
			endif
			set XMR = XMR + 1
			call GroupRemoveUnit(g, u)
		endif
	endloop
	call LogoutGroup(g)
	if u1 != null then
		set t = NHX(WUE, u1,'h0E0', "K3A", 9000, false)
		call SaveInteger(HY, GetHandleId(t), 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	endif
	if u2 != null then
		set t = NHX(WUE, u2,'h0E0', "K3A", 9000, false)
		call SaveInteger(HY, GetHandleId(t), 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	endif
	if u3 != null then
		set t = NHX(WUE, u3,'h0E0', "K3A", 9000, false)
		call SaveInteger(HY, GetHandleId(t), 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
	endif
	set g = null
	set WUE = null
	set u = null
	set u1 = null
	set u2 = null
	set u3 = null
	set t = null
endfunction
function K4A takes nothing returns boolean
	local unit WUE =(LoadUnitHandle(HY,(GetHandleId(GetTriggeringTrigger())), 2))
	local integer h = GetHandleId(WUE)
	local integer i = 0
	local real ECX =(GetGameTime())
	local integer K5A =(LoadInteger(HY, h, 749))
	local real x
	local real y
	local real t
	loop
	exitwhen i > K5A
		set t =(LoadReal(HY, h,($2710+ i)))
		if t +$A> ECX then
			set x =(LoadReal(HY, h,($2AF8+ i)))
			set y =(LoadReal(HY, h,($2EE0+ i)))
		endif
		set i = i + 1
	endloop
	set WUE = null
	return false
endfunction
function K6A takes integer h, integer K5A, real NBX, real NCX returns boolean
	local real x
	local real y
	local real t
	local integer i = 0
	local real ECX =(GetGameTime())
	loop
	exitwhen i > K5A
		set t =(LoadReal(HY, h,($2710+ i)))
		if t +$A> ECX then
			set x =(LoadReal(HY, h,($2AF8+ i)))
			set y =(LoadReal(HY, h,($2EE0+ i)))
			if GetDistanceBetween(x, y, NBX, NCX)< 75 then
				return true
			endif
		endif
		set i = i + 1
	endloop
	return false
endfunction
function K7A takes integer h, integer K5A returns integer
	local real t
	local integer i = 0
	local real ECX =(GetGameTime())
	loop
	exitwhen i > K5A
		set t =(LoadReal(HY, h,($2710+ i)))
		if t +$A< ECX then
			return i
		endif
		set i = i + 1
	endloop
	return -1
endfunction
function K8A takes unit WUE, integer K9A, real x, real y returns nothing
	local integer h = GetHandleId(WUE)
	local integer K5A =(LoadInteger(HY, h, 749))
	local integer LVA
	if K6A(h, K5A, x, y) then
		return
	endif
	set LVA = K7A(h, K5A)
	if LVA ==-1 then
		set LVA = K5A
		set K5A = K5A + 1
		call SaveInteger(HY, h, 749,(K5A))
	endif
	call SaveInteger(HY, h,$32C8,(K9A))
	call SaveReal(HY, h,$2710,(((GetGameTime()))* 1.))
	call SaveReal(HY, h,$2AF8,((x)* 1.))
	call SaveReal(HY, h,$2AF8,((y)* 1.))
endfunction
function LEA takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function K4A))
	call SaveUnitHandle(HY, h, 2,(WUE))
	set WUE = null
	set t = null
endfunction
function LXA takes nothing returns nothing
	call UnitDamageTargetEx(QGV, GetEnumUnit(), 1, 50 + QFV * 50)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\LordofFlameMissile\\LordofFlameMissile.mdl", GetEnumUnit(), "origin"))
endfunction
function LOA takes unit WUE, unit L3R, real x, real y returns nothing
	local group g
	call KillUnit(L3R)
	call ABX("war3mapImported\\Firaga_2.mdx", x, y, 2)
	set g = LoginGroup(468)
	set U2 = WUE
	set QGV = WUE
	set QFV = GetUnitAbilityLevel(WUE,'A2JK')
	call GroupEnumUnitsInRange(g, x, y, 450 + 25, Condition(function DJX))
	call UnitRemoveAbility(WUE,'A04R')
	call ForGroup(g, function LXA)
	call UnitAddPermanentAbility(WUE,'A04R')
	call LogoutGroup(g)
	set g = null
endfunction
function LRA takes unit WUE, unit LIA returns nothing
	local integer h = GetHandleId(WUE)
	local integer LAA =(LoadInteger(HY, h, 746))
	local unit LNA
	local integer i = 1
	local integer x
	loop
	exitwhen i > LAA
		set LNA =(LoadUnitHandle(HY, h,($5AA+ i)))
		if LNA == LIA then
			set LAA = LAA -1
			call SaveUnitHandle(HY, h,($5AA+ i),((LoadUnitHandle(HY, h,($5AA+ i + 1)))))
			call SaveInteger(HY, h, 746,(LAA))
			set x = i + 1
			loop
			exitwhen x > LAA
				call SaveUnitHandle(HY, h,($5AA+ x),((LoadUnitHandle(HY, h,($5AA+ x + 1)))))
				set x = x + 1
			endloop
		endif
		set i = i + 1
	endloop
	set LNA = null
endfunction

function FireRemnatTimeText takes unit u, real s returns nothing
	local texttag tt = LoadTextTagHandle(HY, GetHandleId(u), 'time')
	local unit d
	call SetTextTagText(tt, I2S(R2I(s)), .025)
	
	call SetTextTagPosUnit(tt, u, -32)
	call SetTextTagColor(tt, 255, 200, 0, 255)
	call SetTextTagVelocity(tt, 0, 0)
	call SetTextTagVisibility(tt, IsUnitAlly(u, LocalPlayer) or IsObserver)
	call SetTextTagPermanent(tt, true)
	
	set tt = null
endfunction

function LBA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local unit L3R =(LoadUnitHandle(HY, h, 19))
	local real GRR = GetUnitX(L3R)
	local real GIR = GetUnitY(L3R)
	local real W_E =(LoadReal(HY, h, 47))
	local real W0E =(LoadReal(HY, h, 48))
	local real a = AngleBetweenXY(GRR, GIR, W_E, W0E)* bj_DEGTORAD
	local real NBX
	local real NCX
	local real d = GetDistanceBetween(GRR, GIR, W_E, W0E)
	local real VEI = GetUnitMoveSpeedEx(WUE)* 2.5 * .02
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call LRA(WUE, L3R)
		
		call DestroyTextTag(LoadTextTagHandle(HY, GetHandleId(L3R), 'time'))
		
		call DestroyEffect((LoadEffectHandle(HY, h, 175)))
		call DestroyEffect((LoadEffectHandle(HY, h, 176)))
		call DestroyEffect((LoadEffectHandle(HY, h,$B1)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif d < 2 then
		call FireRemnatTimeText(L3R , 45 - GetTriggerEvalCount(t) * .02)
		call SetUnitAnimationByIndex(L3R, 1)
	else
		if d < VEI then
			set NBX = W_E
			set NCX = W0E
		else
			set NBX = GRR + VEI * Cos(a)
			set NCX = GIR + VEI * Sin(a)
		endif
		call SetUnitX(L3R, NBX)
		call SetUnitY(L3R, NCX)
	endif
	set t = null
	set WUE = null
	set L3R = null
	return false
endfunction
function LCA takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local real a = AngleBetweenXY(GetUnitX(WUE), GetUnitY(WUE), GetSpellTargetX(), GetSpellTargetY())* bj_DEGTORAD
	local integer h = GetHandleId(WUE)
	local integer LAA =(LoadInteger(HY, h, 746))
	local integer level = GetUnitAbilityLevel(WUE,'A2JK')
	local unit d = CreateUnit(GetOwningPlayer(WUE),'h0E8', GetUnitX(WUE), GetUnitY(WUE), a * bj_RADTODEG)
	local trigger t
	local integer i = 1
	set LAA = LAA + 1
	call SaveUnitHandle(HY, h,($5AA+ LAA),(d))
	call SaveInteger(HY, h, 746,(LAA))
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SetUnitVertexColor(d, 255, 255, 255, 75)
	call SetUnitTimeScale(d, 2)
	call SetUnitAnimationByIndex(d, 0)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function LBA))
	call TriggerRegisterDeathEvent(t, d)
	call UnitApplyTimedLife(d,'BTLF', 45)
	
	call SaveTextTagHandle(HY, GetHandleId(d), 'time', CreateTextTag())
	
	call SaveEffectHandle(HY, h, 175,(AddSpecialEffectTarget("war3mapImported\\Phoenix_Missile_smaller.mdx", d, "hand right alternate")))
	call SaveEffectHandle(HY, h, 176,(AddSpecialEffectTarget("war3mapImported\\Phoenix_Missile_smaller.mdx", d, "hand left alternate")))
	call SaveEffectHandle(HY, h,$B1,(AddSpecialEffectTarget("war3mapImported\\FlameDash_Ground.mdx", d, "origin")))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveUnitHandle(HY, h, 19,(d))
	call SaveReal(HY, h, 47, CoordinateX50((GetSpellTargetX())* 1.))
	call SaveReal(HY, h, 48, CoordinateY50((GetSpellTargetY())* 1.))
	set WUE = null
	set t = null
	set d = null
endfunction
function DSE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local integer CHO =(LoadInteger(HY,(GetHandleId(WUE)), 747))
	if CHO > 0 then
		call LCA()
		call UnitRemoveAbility(WUE, QMV[CHO])
		set CHO = CHO -1
		call SaveInteger(HY,(GetHandleId(WUE)), 747,(CHO))
		call UnitAddPermanentAbility(WUE, QMV[CHO])
	else
		call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "充能点数不足")
	endif
	set WUE = null
endfunction
function LDA takes nothing returns boolean
	return GetUnitTypeId(GetFilterUnit())=='h0E8'
endfunction
function LFA takes nothing returns nothing
	local real GIX = GetDistanceBetween(GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit()), QHV, QJV)
	if GIX > QKV and UnitIsDead(GetEnumUnit())== false then
		set QLV = GetEnumUnit()
		set QKV = GIX
	endif
endfunction
function LGA takes unit WUE, real x, real y returns unit
	local group g = LoginGroup(469)
	set QLV = null
	set QKV =-1
	set QHV = x
	set QJV = y
	call GroupEnumUnitsOfPlayer(g, GetOwningPlayer(WUE), Condition(function LDA))
	call ForGroup(g, function LFA)
	call LogoutGroup(g)
	set g = null
	return QLV
endfunction
function LHA takes unit u1, unit u2 returns real
	local real LJA = GetDistanceBetweenUnits(u1, u2)
	local real WIE = LJA / 1300.
	if WIE > .4 then
		return LJA / .4
	endif
	return 1300.
endfunction
function LKA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local real XVA =(LoadReal(HY, h, 47))
	local real XEA =(LoadReal(HY, h, 48))
	local unit L3R =(LoadUnitHandle(HY, h, 19))
	local real GRR = GetUnitX(WUE)
	local real GIR = GetUnitY(WUE)
	local real W_E =(LoadReal(HY, h, 6))
	local real W0E =(LoadReal(HY, h, 7))
	local real a
	local real NBX
	local real NCX
	local real d
	local real NRX =(LoadReal(HY, h, 44))
	local real VEI = NRX * .02
	local group g
	local integer EVX =(LoadInteger(HY, h, 34))
	if L3R != null then
		set W_E = GetUnitX(L3R)
		set W0E = GetUnitY(L3R)
		call SaveReal(HY, h, 6,((W_E)* 1.))
		call SaveReal(HY, h, 7,((W0E)* 1.))
	endif
	set a = AngleBetweenXY(GRR, GIR, W_E, W0E)* bj_DEGTORAD
	set d = GetDistanceBetween(GRR, GIR, W_E, W0E)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call SaveInteger(HY, GetHandleId(WUE), 4319, 2)
		call ResetUnitVertexColor(WUE)
		call SetUnitVertexColorEx(WUE,-1,-1,-1, 255)
		call SetUnitTimeScale(WUE, 1)
		call SetUnitAnimationByIndex(WUE, 0)
		call SetUnitPathing(WUE, true)
		call SetUnitInvulnerable(WUE, false)
		call UnitRemoveAbility(WUE,'A04R')
		call DestroyEffect((LoadEffectHandle(HY, h, 175)))
		call DestroyEffect((LoadEffectHandle(HY, h, 176)))
		call DestroyEffect((LoadEffectHandle(HY, h,$B1)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif d < VEI then
		call SetUnitX(WUE, W_E)
		call SetUnitY(WUE,(W0E))
		call KillDestructablesInCircle(W_E, W0E, 100)
		call SaveBoolean(K, GetHandleId(WUE), 99, true)
		call LOA(WUE, L3R, W_E, W0E)
		set L3R = LGA(WUE, XVA, XEA)
		if L3R == null then
			call SaveInteger(HY, GetHandleId(WUE), 4319, 2)
			call ResetUnitVertexColor(WUE)
			call SetUnitVertexColorEx(WUE,-1,-1,-1, 255)
			call SetUnitTimeScale(WUE, 1)
			call SetUnitAnimationByIndex(WUE, 1)
			call SetUnitPathing(WUE, true)
			call SetUnitInvulnerable(WUE, false)
			call UnitRemoveAbility(WUE,'A04R')
			call DestroyEffect((LoadEffectHandle(HY, h, 175)))
			call DestroyEffect((LoadEffectHandle(HY, h, 176)))
			call DestroyEffect((LoadEffectHandle(HY, h,$B1)))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			call SaveInteger(HY, h, 34,(EVX + 1))
			call SaveUnitHandle(HY, h, 19,(L3R))
			call SaveReal(HY, h, 44,((LHA(WUE, L3R))* 1.))
			call SaveReal(HY, h, 6,((GetUnitX(L3R))* 1.))
			call SaveReal(HY, h, 7,((GetUnitY(L3R))* 1.))
		endif
	else
		call SetUnitAnimationByIndex(WUE, 0)
		call SetUnitPathing(WUE, false)
		set NBX = GRR + VEI * Cos(a)
		set NCX = GIR + VEI * Sin(a)
		if IsUnitType(WUE, UNIT_TYPE_HERO) then
			call SaveBoolean(K, GetHandleId(WUE), 99, true)
		endif
		call SetUnitX(WUE,(NBX))
		call SetUnitY(WUE, NCX)
		call SaveBoolean(K, GetHandleId(WUE), 99, true)
		call KillDestructablesInCircle(NBX, NCX, 100)
		call SetUnitFacing(WUE, a * bj_RADTODEG)
	endif
	call K8A(WUE, EVX, GetUnitX(WUE), GetUnitY(WUE))
	set t = null
	set WUE = null
	set L3R = null
	set g = null
	return false
endfunction
function LLA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	call SetUnitState(WUE, UNIT_STATE_MANA, GetUnitState(WUE, UNIT_STATE_MANA)+ 100)
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	return false
endfunction
function DTE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t
	local integer h = GetHandleId(WUE)
	local integer LAA =(LoadInteger(HY, h, 746))
	local unit L3R
	if LAA > 0 and LoadInteger(HY, GetHandleId(WUE), 4319)!= 1 then
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SetUnitVertexColorEx(WUE, 255, 0, 0, 75)
		call SetUnitTimeScale(WUE, 2)
		call SetUnitAnimationByIndex(WUE, 0)
		call SetUnitPathing(WUE, false)
		call SetUnitInvulnerable(WUE, true)
		call UnitAddPermanentAbility(WUE,'A04R')
		call Web_removestate(WUE) //删除蜘蛛网状态
		call SaveInteger(HY, GetHandleId(WUE), 4319, 1)
		call TriggerRegisterTimerEvent(t, .02, true)
		call TriggerAddCondition(t, Condition(function LKA))
		call TriggerRegisterDeathEvent(t, WUE)
		call SaveEffectHandle(HY, h, 175,(AddSpecialEffectTarget("war3mapImported\\Phoenix_Missile_smaller.mdx", WUE, "hand right alternate")))
		call SaveEffectHandle(HY, h, 176,(AddSpecialEffectTarget("war3mapImported\\Phoenix_Missile_smaller.mdx", WUE, "hand left alternate")))
		call SaveEffectHandle(HY, h,$B1,(AddSpecialEffectTarget("war3mapImported\\FlameDash_Ground.mdx", WUE, "origin")))
		call SaveUnitHandle(HY, h, 2,(WUE))
		call SaveReal(HY, h, 47,((GetSpellTargetX())* 1.))
		call SaveReal(HY, h, 48,((GetSpellTargetY())* 1.))
		set L3R = LGA(WUE, GetSpellTargetX(), GetSpellTargetY())
		call SaveUnitHandle(HY, h, 19,(L3R))
		call SaveReal(HY, h, 44,((LHA(WUE, L3R))* 1.))
		call SaveReal(HY, h, 6,((GetUnitX(L3R))* 1.))
		call SaveReal(HY, h, 7,((GetUnitY(L3R))* 1.))
		call SaveInteger(HY, h, 34, 1)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .0, false)
		call TriggerAddCondition(t, Condition(function LLA))
		call SaveUnitHandle(HY, h, 2,(WUE))
	endif
	set t = null
	set WUE = null
	set L3R = null
endfunction
function LMA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local integer CHO =(LoadInteger(HY,(GetHandleId(WUE)), 747))
	local integer EVX =(LoadInteger(HY, h, 34))
	if CHO < 3 then
		set EVX = EVX -1
		call SaveInteger(HY, h, 34,(EVX))
		if EVX == 0 then
			call UnitRemoveAbility(WUE, QMV[CHO])
			set EVX = 35
			call SaveInteger(HY, h, 34,(EVX))
			set CHO = CHO + 1
			call SaveInteger(HY,(GetHandleId(WUE)), 747,(CHO))
			call UnitAddPermanentAbility(WUE, QMV[CHO])
		endif
	endif
	set t = null
	set WUE = null
	return false
endfunction
function LPA takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call SaveInteger(HY,(GetHandleId(WUE)), 747, 3)
	call UnitAddPermanentAbility(WUE, QMV[3])
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function LMA))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveInteger(HY, h, 34, 30)
	set WUE = null
	set t = null
endfunction
function SAE takes nothing returns nothing
	call UnitAddPermanentAbility(GetTriggerUnit(),'A2JL')
	call SetUnitAbilityLevel(GetTriggerUnit(),'A2JL', GetUnitAbilityLevel(GetTriggerUnit(),'A2JK'))
	if GetUnitAbilityLevel(GetTriggerUnit(),'A2JK')== 1 then
		call LPA()
		call LEA()
	endif
endfunction
function P4X takes nothing returns nothing
	set QMV[0]='A2JO'
	set QMV[1]='A2JQ'
	set QMV[2]='A2JP'
	set QMV[3]='A2JR'
endfunction
function LQA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local integer CVX =(LoadInteger(HY, h, 59))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call UnitRemoveAbility(WUE, CVX)
	call UnitRemoveAbility(WUE,'B0FJ')
	set t = null
	set WUE = null
	return false
endfunction
function MomentOfCourage_AES_Actions takes nothing returns nothing
	local trigger t
	local integer h
	local integer level = GetUnitAbilityLevel(AETargetUnit[AEI],'A2EY')
	local integer id
	local integer probability = 25
	local real cool
	if IsUnitType(AEAttackerUnit[DEI], UNIT_TYPE_HERO) then
		set probability = 35
	endif
	if GetPrdRandom(AETargetUnit[AEI],'A2EY', probability) then
		set cool = 3.3 -0.6 * level
		if GetUnitAbilityLevel(AETargetUnit[AEI], 'A39S') == 1 then
			set cool = cool * 0.75
		endif
		call EPX(AETargetUnit[AEI], 4316, cool)
		call YDWESetUnitAbilityState(AETargetUnit[AEI], 'QP1O', 1, cool)
		call UnitAddPermanentAbility(AETargetUnit[AEI], 'A2G7')
		call SetUnitAbilityLevel(AETargetUnit[AEI], 'A2G7', level)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterDeathEvent(t, AETargetUnit[AEI])
		call TriggerRegisterTimerEvent(t, .5, false)	
		call EnableEffectByTime(EFFECT_MOMENT_OF_COURAGE, 0.5)
		call TriggerAddCondition(t, Condition(function LQA))
		call SaveUnitHandle(HY, h, 2, AETargetUnit[AEI])
		call SaveInteger(HY, h, 59, 'A2G7')
		set t = null
	endif
endfunction

function DuelVictory takes unit victoryUnit, integer level, unit targetUnit returns nothing
	local integer ph = GetHandleId(GetOwningPlayer(victoryUnit))
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		set ph = GetHandleId(GetOwningPlayer(victoryUnit))
		call SaveInteger(K, ph,'DUEL', LoadInteger(K, ph,'DUEL')+ 1)
		call SaveInteger(K, ph,'DDUE', LoadInteger(K, ph,'DDUE')+ 6 + 4 * level)
		call CommonTextTag(GetUnitName(victoryUnit)+ " 获得了胜利!!", 5, victoryUnit, .03, 255, 0, 0, 255)
		call KVX(victoryUnit)
	endif
endfunction

function DuelActions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit spellUnit =(LoadUnitHandle(HY, h, 2))
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 5))
	local real targetTime =(LoadReal(HY, h, 442))
	local unit tempU
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or targetTime <(GetGameTime()) or not IsUnitInRange(spellUnit, targetUnit, 2000) then
		if GetTriggerEventId()== EVENT_WIDGET_DEATH then
			if GetTriggerUnit()== spellUnit then
				set tempU = targetUnit
			else
				set tempU = spellUnit
			endif
			call DuelVictory(tempU, level, GetTriggerUnit())
		endif
		call SaveBoolean(HY, GetHandleId(LoadTriggerHandle(HY, GetHandleId(spellUnit),'STFU')),'SLDR', true)
		call SaveBoolean(HY, GetHandleId(LoadTriggerHandle(HY, GetHandleId(targetUnit),'STFU')),'SLDR', true)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		// 恢复相位状态
		call EXSetUnitPathing(spellUnit, true)
		call EXSetUnitPathing(targetUnit, true)
		call UnitRemoveSilenceAndLocked(spellUnit, 'A467','B467')
		call UnitRemoveSilenceAndLocked(targetUnit, 'A467','B467')
	elseif GetIssuedOrderId()!= 851973 then
		call DisableTrigger(t)
		// 重新发布进攻命令
		call IssueTargetOrderById(spellUnit, 851983, targetUnit)
		call IssueTargetOrderById(targetUnit, 851983, spellUnit)
		call EnableTrigger(t)
	//else
		// 强制清除所有缴械技能
		//if GetUnitAbilityLevel(spellUnit,'Abun')> 0 then
		//	call UnitRemoveAbility(spellUnit,'NOAT')
		//	call UnitRemoveAbility(spellUnit,'Abun')
		//endif
		//if GetUnitAbilityLevel(targetUnit,'Abun')> 0 then
		//	call UnitRemoveAbility(targetUnit,'NOAT')
		//	call UnitRemoveAbility(targetUnit,'Abun')
		//endif
	endif
	set t = null
	set tempU = null
	set spellUnit = null
	set targetUnit = null
	return false
endfunction
function DuelStart takes unit spellUnit, unit targetUnit returns nothing
	local integer level = GetUnitAbilityLevel(spellUnit,'A2CI')+ GetUnitAbilityLevel(spellUnit,'A38C')
	local trigger t
	local integer h
	local boolean isScepterUpgrade = GetUnitAbilityLevel(spellUnit,'A38C')> 0
	if GetUnitAbilityLevel(spellUnit,'Aloc')== 1 and HaveSavedHandle(HY, GetHandleId(spellUnit), 0) then
		set spellUnit = LoadUnitHandle(HY, GetHandleId(spellUnit), 0)
	endif
	// 添加相位移动, 锁闭, 沉默
	call EXSetUnitPathing(spellUnit, false)
	call EXSetUnitPathing(targetUnit, false)
	call UnitAddSilenceAndLocked(spellUnit, 'A467','B467')
	call UnitAddSilenceAndLocked(targetUnit, 'A467','B467')
	call IssueTargetOrderById(spellUnit, 851983, targetUnit)
	call IssueTargetOrderById(targetUnit, 851983, spellUnit)
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2,(spellUnit))
	call SaveUnitHandle(HY, h, 17,(targetUnit))
	call SaveInteger(HY, h, 5,(level))
	if isScepterUpgrade then
		call SaveReal(HY, h, 442,(((GetGameTime())+ 9999)* 1.))
		call SaveBoolean(HY, h, 0, true)
	else
		call SaveReal(HY, h, 442,(((GetGameTime())+ .75 * level + 3.25)* 1.))
	endif
	call TriggerAddCondition(t, Condition(function DuelActions))
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerRegisterDeathEvent(t, spellUnit)
	call TriggerRegisterDeathEvent(t, targetUnit)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterUnitEvent(t, targetUnit, EVENT_UNIT_ISSUED_ORDER)
	call TriggerRegisterUnitEvent(t, spellUnit, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call TriggerRegisterUnitEvent(t, spellUnit, EVENT_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterUnitEvent(t, spellUnit, EVENT_UNIT_ISSUED_ORDER)
	set t = null
endfunction
function DuelWait0s takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call DuelStart(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function SpellEffect__Duel takes nothing returns nothing
	local timer t
	local integer h
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		set t = CreateTimer()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
		call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
		call TimerStart(t, 0, false, function DuelWait0s)
		set t = null
	endif
endfunction
function L1A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 5))
	local integer EVX =(LoadInteger(HY, h, 34))
	set EVX = EVX + 1
	call SaveInteger(HY, h, 34,(EVX))
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or EVX > 50 or GetUnitAbilityLevel(targetUnit,'A2J4')== 0 then
		call UnitRemoveAbility(targetUnit,'A2J4')
		call FlushChildHashtable(HY, h)
		call RemoveSavedHandle(HY, GetHandleId(targetUnit),'A2J2')
		call CleanCurrentTrigger(t)
	else
		call SetWidgetLife(targetUnit, GetWidgetLife(targetUnit)+ 2 + 1 * level)
		if ModuloInteger(EVX, 10)== 1 then
			call AddSpecialEffectTargetToTimed("Abilities\\Spells\\Orc\\SpiritLink\\SpiritLinkZapTarget.mdl", targetUnit, "chest", 1.9)
		endif
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function DWE takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(WUE,'A2J2')
	local trigger t
	local integer h
	if HaveSavedHandle(HY, GetHandleId(targetUnit),'A2J2') then
		set t = LoadTriggerHandle(HY, GetHandleId(targetUnit),'A2J2')
		set h = GetHandleId(t)
	else
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveTriggerHandle(HY, GetHandleId(targetUnit),'A2J2', t)
		call TriggerRegisterTimerEvent(t, .1, true)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function L1A))
		call SaveUnitHandle(HY, h, 17, targetUnit)
	endif
	call GBX(targetUnit)
	call UnitAddPermanentAbilitySetLevel(targetUnit,'A2J4', level)
	call SaveInteger(HY, h, 5, level)
	call SaveInteger(HY, h, 34, 0)
	call TriggerEvaluate(t)
	set WUE = null
	set targetUnit = null
	set t = null
endfunction
function Legion_PtA_Init takes nothing returns nothing
	set QPV[1]='A2J4'
	set QPV[2]='A2J5'
	set QPV[3]='A2J3'
	set QPV[4]='A2J6'
endfunction
function L2A takes nothing returns nothing
	if(IsUnitType(GetEnumUnit(), UNIT_TYPE_SUMMONED) and IsPrimalUnit(GetEnumUnit())== false and GetUnitAbilityLevel(GetEnumUnit(),'ACrk')== 0 and GetUnitAbilityLevel(GetEnumUnit(),'A12G')== 0) or IsUnitIllusion(GetEnumUnit()) then
		call UnitDamageTargetEx(GetTriggerUnit(), GetEnumUnit(), 1, GetUnitState(GetEnumUnit(), UNIT_STATE_MAX_LIFE)* .5)
	endif
	call UnitDamageTargetEx(GetTriggerUnit(), GetEnumUnit(), 1, 50 * QTV +($C+ QTV * 2)* QQV +(5 + QTV *$F)* QSV)
endfunction
function L3A takes nothing returns nothing
	if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
		set QSV = QSV + 1
	else
		set QQV = QQV + 1
	endif
endfunction
function L4A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer c = LoadInteger(HY, h, 0)
	local unit u = LoadUnitHandle(HY, h, 0)
	if c >= 5 * 7 or GetUnitAbilityLevel(u,'C020')== 0 then
		call UnitRemoveAbility(u,'C020')
		call UnitRemoveAbility(u,'D020')
		call J8X(u, LoadInteger(HY, h, 1))
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
		call RemoveSavedHandle(HY, GetHandleId(u),'A2JB')
	else
		call SaveInteger(HY, h, 0, c + 1)
	endif
	set u = null
	set t = null
endfunction
function DYE takes nothing returns nothing
	local timer t
	local unit WUE = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local integer level = GetUnitAbilityLevel(WUE,'A2JB')
	local group g = LoginGroup(470)
	local integer h
	call DestroyEffect(AddSpecialEffect("war3mapImported\\OverwhelmingOdds.mdx", x, y))
	set U2 = WUE
	call GroupEnumUnitsInRange(g, x, y, 330 + 25, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	set QQV = 0
	set QSV = 0
	set QTV = level
	call ForGroup(g, function L3A)
	call ForGroup(g, function L2A)
	call LogoutGroup(g)
	set x =(9 * QSV + 3 * QQV)
	if x > 0 then
		call J6X(WUE, R2I(x))
		call UnitAddPermanentAbility(WUE,'C020')
		if HaveSavedHandle(HY, GetHandleId(WUE),'A2JB') then
			set t = LoadTimerHandle(HY, GetHandleId(WUE),'A2JB')
			set h = GetHandleId(t)
		else
			set t = CreateTimer()
			set h = GetHandleId(t)
			call SaveTimerHandle(HY, GetHandleId(WUE),'A2JB', t)
			call TimerStart(t, .2, true, function L4A)
		endif
		call SaveInteger(HY, h, 0, 0)
		call SaveUnitHandle(HY, h, 0, WUE)
		call SaveInteger(HY, h, 1, LoadInteger(HY, h, 1)+ R2I(x))
	endif
	set WUE = null
	set t = null
endfunction
function MysticFlareFilterHeroes takes nothing returns boolean
	return((IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and RFX(GetFilterUnit())== false) and IsMagicImmuneUnit(GetFilterUnit()))
endfunction
function L5A takes nothing returns boolean
	return IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) or IsUnitIllusion(GetFilterUnit()))
endfunction
function L6A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY, h, 2))
	local real x =(LoadReal(HY, h, 6))
	local real y =(LoadReal(HY, h, 7))
	local group g = null
	local unit u2
	local integer level
	local integer c
	if GetTriggerEvalCount(t)> 20 then
		call DestroyEffect((LoadEffectHandle(HY, h, 32)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	else
		set g = LoginGroup(471)
		set U2 = u
		call GroupEnumUnitsInRange(g, x, y,$AA+ 25, Condition(function D7X))
		set level = GetUnitAbilityLevel(u,'A2BG')+ GetUnitAbilityLevel(u,'A30H')
		set c = CountUnitsInGroup(g)
		if c == 0 then
			call GroupEnumUnitsInRange(g, x, y,$AA+ 25, Condition(function L5A))
			set c = CountUnitsInGroup(g)
		endif
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			call UnitDamageTargetEx(u, u2, 1,(($C8+ 400 * level)/ c)/ 20)
			call GroupRemoveUnit(g, u2)
		endloop
		call LogoutGroup(g)
		set g = null
	endif
	set t = null
	set u = null
	set u2 = null
	return false
endfunction
function DZE takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local string s = "war3mapImported\\DivineWrathTarget.mdx"
	local location l = GetSpellTargetLoc()
	call PlaySoundAtPointBJ(QUV, 100, l, 0)
	call RemoveLocation(l)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function L6A))
	call SaveUnitHandle(HY, h, 2,(WUE))
	call SaveReal(HY, h, 6,((x)* 1.))
	call SaveReal(HY, h, 7,((y)* 1.))
	call DestroyEffect(AddSpecialEffect(s, x, y))
	set t = null
	set WUE = null
	set l = null
endfunction
function P5X takes nothing returns nothing
	set QUV = CreateSound("Abilities\\Spells\\Demon\\RainOfFire\\RainOfFireTarget2.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(QUV, "StarfallTarget")
	call SetSoundDuration(QUV,$BB8)
endfunction
function L7A takes nothing returns nothing
	local unit WUE = U2
	local unit targetUnit = W2
	local integer level = LoadInteger(HY, GetHandleId(GetTriggeringTrigger()), 0)
	local integer i = E3X(WUE)
	local real IXX = 40 + 20 * level + 1.6 * i
	if GetUnitAbilityLevel(targetUnit,'A3E9')== 1 and IsMagicImmuneUnit(WUE)== false then
		call SaveUnitHandle(VV,'A3E9', 0, targetUnit)
		call SaveUnitHandle(VV,'A3E9', 1, WUE)
		call SaveInteger(VV,'A3E9', 0, level)
		call ExecuteFunc("L8A")
	endif
	if i == 0 then
		set IXX = 40 + 20 * level + 1.6 * E3X(Player__Hero[GetPlayerId(GetOwningPlayer(WUE))])
	endif
	call UnitDamageTargetEx(WUE, targetUnit, 1, IXX)
	set WUE = null
	set targetUnit = null
endfunction
function L9A takes unit WUE, unit targetUnit, integer level returns nothing
	call SaveInteger(HY, GetHandleId(NHX(WUE, targetUnit,'h0DQ', "L7A", 500, false)), 0, level)
endfunction
function L8A takes nothing returns nothing
	call T4V(LoadUnitHandle(VV,'A3E9', 0))
	if UnitHasSpellShield(LoadUnitHandle(VV,'A3E9', 1))== false then
		call L9A(LoadUnitHandle(VV,'A3E9', 0), LoadUnitHandle(VV,'A3E9', 1), LoadInteger(VV,'A3E9', 0))
	endif
	call FlushChildHashtable(VV,'A3E9')
endfunction
function D_E takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call L9A(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
	endif
endfunction
function MVA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local real d = LoadReal(HY, h, 0)

	call ReduceUnitMagicResistance(targetUnit, d)

	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set targetUnit = null
	set t = null
	return false
endfunction
function MEA takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(WUE,'A2HN')
	local real dur = 2 + level
	local real data = 0.25 + 0.05 * level

	call AddUnitMagicResistance(WUE, data)
	call SaveReal(HY, h, 0, data)
	call TriggerRegisterTimerEvent(t, dur, false)
	call TriggerAddCondition(t, Condition(function MVA))
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveUnitHandle(HY, h, 17, targetUnit)
	set WUE = null
	set targetUnit = null
	set t = null
endfunction
function SpellEffect__AncientSeal takes nothing returns nothing
	if IsUnitType(GetSpellTargetUnit(), UNIT_TYPE_HERO) and not UnitHasSpellShield(GetSpellTargetUnit()) then
		call MEA()
	endif
endfunction
function MXA takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local real x = GetUnitX(W2)
	local real y = GetUnitY(W2)
	local unit dummyUnit = CreateUnit(GetOwningPlayer(U2),'e00E', x, y, 0)
	call UnitAddAbility(dummyUnit,'A2IU')
	call SetUnitAbilityLevel(dummyUnit,'A2IU', LoadInteger(HY, h, 0))
	call IssueImmediateOrderById(dummyUnit,$D0080)
	set dummyUnit = null
endfunction
function MOA takes unit WUE, group g returns unit
	local unit MRA = null
	local real d = 99999
	local unit MIA = FirstOfGroup(g)
	call GroupRemoveUnit(g, MIA)
	loop
	exitwhen MIA == null
		if GetDistanceBetweenUnits(WUE, MIA)< d then
			set d = GetDistanceBetweenUnits(WUE, MIA)
			set MRA = MIA
		endif
		set MIA = FirstOfGroup(g)
		call GroupRemoveUnit(g, MIA)
	endloop
	set MIA = null
	set Q5V = MRA
	set MRA = null
	return Q5V
endfunction
function D1E takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = null
	local group g = LoginGroup(472)
	local trigger t
	set U2 = WUE
	call GroupEnumUnitsInRange(g, GetUnitX(WUE), GetUnitY(WUE),$640+ 25, Condition(function D6X))
	set targetUnit = MOA(WUE, g)
	call LogoutGroup(g)
	if targetUnit != null then
		set t = NHX(WUE, targetUnit,'h0E6', "MXA", 800, false)
		call SaveInteger(HY, GetHandleId(t), 0, GetUnitAbilityLevel(WUE, GetSpellAbilityId()))
		set t = null
	endif
	set g = null
	set targetUnit = null
	set WUE = null
endfunction
function MAA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit targetUnit =(LoadUnitHandle(HY, h, 17))
	local integer MNA =(LoadInteger(HY, h, 422))
	local integer MBA =(LoadInteger(HY, h, 423))
	local integer JLI =(LoadInteger(HY, h, 424))
	if GetUnitAbilityLevel(targetUnit,'A42S')== 0 or GetTriggerEvalCount(t)> 35 or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call SetHeroAgi(targetUnit, GetHeroAgi(targetUnit, false)+ MNA, true)
		call SetHeroStr(targetUnit, GetHeroStr(targetUnit, false)+ MBA, true)
		call SetHeroInt(targetUnit, GetHeroInt(targetUnit, false)+ JLI, true)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set targetUnit = null
	return false
endfunction
function MCA takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local unit targetUnit = GetEnumUnit()
	local integer level = GetUnitAbilityLevel(WUE,'A2FK')
	local trigger t
	local integer h
	local integer MDA
	local integer E5X
	local integer E6X
	local integer E4X
	local real VEI
	if IsUnitType(targetUnit, UNIT_TYPE_HERO) then
		set MDA = GetHeroPrimaryAttributesType(targetUnit)
		set VEI = .15
		call AddAbilityToTimed(targetUnit,'A42S', 1, 7,'B0HJ')
		if MDA == 3 then
			set E5X = R2I(VEI * GetHeroAgi(targetUnit, false))-1
			set E6X = 0
			set E4X = 0
		elseif MDA == 1 then
			set E5X = 0
			set E6X = R2I(VEI * GetHeroStr(targetUnit, false))-1
			set E4X = 0
		elseif MDA == 2 then
			set E5X = 0
			set E6X = 0
			set E4X = R2I(VEI * GetHeroInt(targetUnit, false))-1
		endif
		call SetHeroAgi(targetUnit, GetHeroAgi(targetUnit, false)-E5X, true)
		call SetHeroStr(targetUnit, GetHeroStr(targetUnit, false)-E6X, true)
		call SetHeroInt(targetUnit, GetHeroInt(targetUnit, false)-E4X, true)
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, .2, true)
		call TriggerRegisterDeathEvent(t, targetUnit)
		call TriggerAddCondition(t, Condition(function MAA))
		call SaveInteger(HY, h, 422, E5X)
		call SaveInteger(HY, h, 424, E4X)
		call SaveInteger(HY, h, 423, E6X)
		call SaveUnitHandle(HY, h, 17, targetUnit)
		set t = null
	endif
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", targetUnit, "chest"))
	call UnitDamageTargetEx(WUE, targetUnit, QWV, 50 + 50 * level)
	set WUE = null
	set targetUnit = null
endfunction
function D2E takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local group g = LoginGroup(473)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = AngleBetweenXY(GetUnitX(WUE), GetUnitY(WUE), x, y)* bj_DEGTORAD
	set x = GetUnitX(WUE)
	set y = GetUnitY(WUE)
	if KillDestructablesInCircle(x, y, 300)> 0 then
		set QWV = 3
	else
		set QWV = 1
	endif
	call GroupEnumUnitsInRange(g, x, y, 300 + 25, Condition(function DDX))
	call ForGroup(g, function MCA)
	call LogoutGroup(g)
	call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\WhirlingDeath_01.mdx", WUE, "origin"))
	set WUE = null
	set g = null
endfunction
function MFA takes unit WUE, unit targetUnit returns nothing
	local integer level = KI
	call UnitDamageTargetEx(WUE, targetUnit, 3, 60 + 40 * level)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", targetUnit, "origin"))
endfunction
function MGA takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), DK)== false then
		call GroupAddUnit(DK, GetEnumUnit())
		call MFA(U2, GetEnumUnit())
	endif
endfunction
function MHA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local unit targetUnit = LoadUnitHandle(HY, h, 17)
	local integer KFR = LoadInteger(HY, h, 18)
	local integer EVX = GetTriggerEvalCount(t)
	local unit KGR
	local group KHR = LoadGroupHandle(HY, h, 16)
	local group g
	local boolean SKX = LoadBoolean(HY, h, 727)
	local boolean MJA = LoadBoolean(HY, h, 740)
	set KI = LoadInteger(HY, h, 0)
	if C5X(triggerUnit) then
		set MJA = true
		call SaveBoolean(HY, h, 740, MJA)
	endif
	if SKX == false then
		set KGR = LoadUnitHandle(HY, h, 700 + KFR + 1 -EVX)
		call RemoveUnit(KGR)
	else
		set KGR = LoadUnitHandle(HY, h, 700 + EVX)
		if MJA == false then
			if IsUnitType(triggerUnit, UNIT_TYPE_HERO) then
				call SaveBoolean(K, GetHandleId(triggerUnit), 99, true)
			endif
			call SetUnitX(triggerUnit, GetUnitX(KGR))
			call SetUnitY(triggerUnit, GetUnitY(KGR))
		endif
		call RemoveUnit(KGR)
		set g = LoginGroup(474)
		set U2 = triggerUnit
		set DK = KHR
		call GroupEnumUnitsInRange(g, GetUnitX(triggerUnit), GetUnitY(triggerUnit),$FA, Condition(function DMX))
		call ForGroup(g, function MGA)
		call LogoutGroup(g)
	endif
	if EVX ==(KFR) then
		call KillDestructablesInCircle(GetUnitX(triggerUnit), GetUnitY(triggerUnit), 90)
		call LogoutGroup(KHR)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set triggerUnit = null
	set targetUnit = null
	set KGR = null
	set KHR = null
	set g = null
	return false
endfunction
function MKA takes nothing returns nothing
	if IsTreeDestructable(GetEnumDestructable()) and IsDestructableDeadBJ(GetEnumDestructable())== false then
		set QYV = QYV + 1
	endif
endfunction
function MLA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = LoadUnitHandle(HY, h, 14)
	local real a = LoadReal(HY, h, 13)
	local integer KLR = LoadInteger(HY, h, 12)
	local integer EVX = GetTriggerEvalCount(t)
	local real x = LoadReal(HY, h, 6)+ EVX * 50 * Cos(a * bj_DEGTORAD)
	local real y = LoadReal(HY, h, 7)+ EVX * 50 * Sin(a * bj_DEGTORAD)
	local boolean isScepterUpgrade = LoadBoolean(HY, h, 15)
	local unit KPR
	local trigger KQR = LoadTriggerHandle(HY, h, 11)
	local integer KSR = GetHandleId(KQR)
	local integer ID ='u01Q'
	local real KJR =$FA
	local rect r
	local real d = 90
	local integer level = LoadInteger(HY, h, 0)
	set r = Rect(x -d, y -d, x + d, y + d)
	set QYV = 0
	call EnumDestructablesInRect(r, TrueBoolexprCondition, function MKA)
	if QYV > 0 or EVX == KLR or EVX ==(KLR -1) or EVX ==(KLR -2) then
		set ID ='u01P'
	endif
	set KPR = CreateUnit(GetOwningPlayer(triggerUnit), ID, x, y, a)
	call SaveUnitHandle(HY, KSR, 700 + EVX, KPR)
	if QYV > 0 then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call TriggerRegisterTimerEvent(KQR, .5 / KLR, true)
		call TriggerAddCondition(KQR, Condition(function MHA))
		call SaveInteger(HY, KSR, 18, EVX)
		call SaveInteger(HY, KSR, 0, level)
		call SaveBoolean(HY, KSR, 727, true)
		call SaveUnitHandle(HY, KSR, 14, triggerUnit)
		call SaveGroupHandle(HY, KSR, 16, LoginGroup(475))
		call SaveReal(HY, KSR, 6, x * 1.)
		call SaveReal(HY, KSR, 7, y * 1.)
		call SaveBoolean(HY, KSR, 740, false)
	elseif EVX > KLR then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call TriggerRegisterTimerEvent(KQR, .5 / KLR, true)
		call TriggerAddCondition(KQR, Condition(function MHA))
		call SaveInteger(HY, KSR, 18, EVX)
		call SaveInteger(HY, KSR, 0, level)
		call SaveBoolean(HY, KSR, 727, false)
		call SaveUnitHandle(HY, KSR, 14, triggerUnit)
		call SaveGroupHandle(HY, KSR, 16, LoginGroup(476))
		call SaveBoolean(HY, KSR, 740, false)
	endif
	set t = null
	set triggerUnit = null
	set KPR = null
	set KQR = null
	return false
endfunction
function D3E takes nothing returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit triggerUnit = GetTriggerUnit()
	local real a = AngleBetweenXY(GetUnitX(triggerUnit), GetUnitY(triggerUnit), GetSpellTargetX(), GetSpellTargetY())
	local integer level = GetUnitAbilityLevel(triggerUnit,'A2E3')
	local integer KTR
	local integer KLR
	local trigger KUR = CreateTrigger()
	set KTR = 600 +$C8* level
	set KLR = KTR / 50
	call SaveUnitHandle(HY, h, 14,(triggerUnit))
	call SaveInteger(HY, h, 5,(level))
	call SaveReal(HY, h, 13,((a)* 1.))
	call SaveInteger(HY, h, 12,(KLR))
	call SaveTriggerHandle(HY, h, 11,(KUR))
	call SaveReal(HY, h, 6,((GetUnitX(triggerUnit))* 1.))
	call SaveReal(HY, h, 7,((GetUnitY(triggerUnit))* 1.))
	call TriggerRegisterTimerEvent(t, .5 / KLR, true)
	call TriggerAddCondition(t, Condition(function MLA))
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(triggerUnit, GetSpellAbilityId()))
	set t = null
	set triggerUnit = null
	set KUR = null
endfunction
function ReactiveArmorEnd takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 2)
	local integer uh = GetHandleId(u)
	call SaveInteger(HY, uh,'A2E4', LoadInteger(HY, uh,'A2E4')-1)
	if 4 *(GetUnitAbilityLevel(u,'A2E4'))> LoadInteger(HY, uh,'A2E4') then
		call LodSystem_ReduceUnitExtraState(u, 1, STATE_SYSTEM_REGEN)
		call LodSystem_ReduceUnitExtraState(u, 1, STATE_SYSTEM_ARMOUR)
		call SaveInteger(HY, uh,'A2E5', LoadInteger(HY, uh,'A2E5')-1)
		call SetAbilitydataD(u,'QP1P', LoadInteger(HY, uh,'A2E5'))
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set u = null
	return false
endfunction
function ReactiveArmorAddState takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(u)
	if LoadInteger(HY, h,'A2E5')< 4 *(GetUnitAbilityLevel(u,'A2E4')) then
		call LodSystem_AddUnitExtraState(u, 1, STATE_SYSTEM_REGEN)
		call LodSystem_AddUnitExtraState(u, 1, STATE_SYSTEM_ARMOUR)
		call SaveInteger(HY, h,'A2E5', LoadInteger(HY, h,'A2E5')+ 1)
		call SetAbilitydataD(u,'QP1P', LoadInteger(HY, h,'A2E5'))
	endif
	call SaveInteger(HY, h,'A2E4', LoadInteger(HY, h,'A2E4')+ 1)
	set h = GetHandleId(t)
	call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\ReactiveArmor.mdx", u, "chest"))
	call TriggerRegisterTimerEvent(t, 16, false)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerAddCondition(t, Condition(function ReactiveArmorEnd))
	call SaveUnitHandle(HY, h, 2, u)
	set t = null
endfunction
function ReactiveArmorActions takes unit R8X, unit WLE returns nothing
	if GetUnitAbilityLevel(WLE,'A2E4')> 0 and not DETargetIsBreak[DEI] and IsUnitEnemy(R8X, GetOwningPlayer(WLE)) then
		call ReactiveArmorAddState(WLE)
	endif
endfunction
function MTA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	call UnitRemoveAbility(WUE,'Bpig')
	call UnitRemoveAbility(WUE,'BEia')
	call UnitRemoveAbility(WUE,'BNms')
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WUE = null
	return false
endfunction
function MUA takes unit t returns unit
	if HaveSavedHandle(VV,'A3GA', 0) and GetUnitState(LoadUnitHandle(VV,'A3GA', 0), UNIT_STATE_LIFE)> .5 then
		call SetUnitX(LoadUnitHandle(VV,'A3GA', 0), GetUnitX(t))
		call SetUnitY(LoadUnitHandle(VV,'A3GA', 0), GetUnitY(t))
		call SetUnitOwner(LoadUnitHandle(VV,'A3GA', 0), GetOwningPlayer(t), false)
	else
		call SaveUnitHandle(VV,'A3GA', 0, CreateUnit(GetOwningPlayer(t),'e00E', GetUnitX(t), GetUnitY(t), 0))
	endif
	return LoadUnitHandle(VV,'A3GA', 0)
endfunction
function MWA takes unit WUE, unit targetUnit returns nothing
	local unit dummyUnit = MUA(targetUnit)
	local integer MYA = R2I( 100 * GetWidgetLife(targetUnit)/ GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE))
	local integer level = IMaxBJ(IMinBJ(R2I( 100 -MYA)/ 5, 20), 1)
	call UnitAddAbility(dummyUnit,'A3GA'-1 + level)
	call IssueTargetOrderById(dummyUnit, 852075, targetUnit)
	call UnitRemoveAbility(dummyUnit,'A3GA'-1 + level)
	set dummyUnit = null
endfunction
function MZA takes nothing returns nothing
	if OY == false then
		call UnitDamageTargetEx(Q_V, GetEnumUnit(), 3,(25 + 25 * Q0V)* .5)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", GetEnumUnit(), "origin"))
		call MWA(Q_V, GetEnumUnit())
	endif
endfunction
function M_A takes nothing returns nothing
	if IsUnitInGroup(GetEnumUnit(), QZV)== false then
		call GroupAddUnit(QZV, GetEnumUnit())
		call UnitDamageTargetEx(Q_V, GetEnumUnit(), 3, 60 + 40 * Q0V)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", GetEnumUnit(), "origin"))
		call MWA(Q_V, GetEnumUnit())
	endif
endfunction
function M0A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call UnitRemoveAbility(LoadUnitHandle(HY, h, 0),'A43P')
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
endfunction
function M1A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE = LoadUnitHandle(HY, h, 2)
	local unit NIX = LoadUnitHandle(HY, h, 45)
	local real W_E = LoadReal(HY, h, 6)
	local real W0E = LoadReal(HY, h, 7)
	local real x
	local real y
	local real a
	local integer M2A = LoadInteger(HY, h, 33)
	local group D7R = LoadGroupHandle(HY, h, 187)
	local group g
	local integer EVX = LoadInteger(HY, h, 34)
	local real M3A
	local integer FJI = LoadInteger(HY, h, 2)
	local integer M4A = LoadInteger(HY, h, 3)
	local integer M5A = LoadInteger(HY, h, 4)
	local boolean b = false
	if LoadInteger(HY, GetHandleId(WUE), 704) == -1 then//同等脉冲新星,进行二次判断
		if not PlayerHaveAbilityByActive(GetOwningPlayer(WUE), 'A2E5') then
			set b = true
		endif
	endif
	call UnitAddPermanentAbility(WUE, M4A)
	if GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT then //释放技能结束
		if GetSpellAbilityId()== M5A then
			call SaveInteger(HY, h, 33, 2)
			call GroupClear(D7R) //
			call S9E(GetOwningPlayer(WUE), M5A, false)
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call TriggerRegisterTimerEvent(t, 0, false)
			call TriggerAddCondition(t, Condition(function MTA))
			call SaveUnitHandle(HY, h, 2,(WUE))
			call UnitRemoveAbilityToTimed(WUE, M5A, 0)
		endif
	//单位死亡或拉比克大窃取的技能换了
	elseif GetTriggerEventId()== EVENT_WIDGET_DEATH or b then
		call UnitRemoveAbilityToTimed(WUE, M5A, 0)
		set b = Rubick_AbilityFilter(WUE , 'A2E5')
		if b or (LoadInteger(HY, GetHandleId(WUE), 704))== FJI then
			if FJI =='A43Q' then
				if LoadBoolean(P, GetHandleId(U2),'A43Q') then
					call S9E(GetOwningPlayer(WUE), FJI, true)
				endif
			else
				call S9E(GetOwningPlayer(WUE), FJI, true)
			endif
		endif
		call S9E(GetOwningPlayer(WUE), M5A, false)
		if b and FJI !='A43Q' then
			call S9E(GetOwningPlayer(WUE),'A2E5', true)
			call S9E(GetOwningPlayer(WUE),'A43S', true)
		endif
		call RemoveUnitBEim(WUE)
		call UnitRemoveAbility(WUE,'BNms')
		call KillUnit(NIX)
		call LogoutGroup(D7R)
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	elseif M2A == 0 then //前进
		set a = AngleBetweenXY(GetUnitX(NIX), GetUnitY(NIX), W_E, W0E)* bj_DEGTORAD
		set x = GetUnitX(NIX)+ 18 * Cos(a)
		set y = GetUnitY(NIX)+ 18 * Sin(a)
		call KillDestructablesInCircle(x, y, 175)
		if GetDistanceBetween(x, y, W_E, W0E)< 40 then
			set x = W_E
			set y = W0E
		endif
		call SetUnitX(NIX, x)
		call SetUnitY(NIX, y)
		set U2 = WUE
		set Q_V = WUE
		set Q0V = LoadInteger(HY, h, 0)
		set QZV = D7R
		set g = LoginGroup(477)
		call GroupEnumUnitsInRange(g, x, y,$C8+ 25, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call ForGroup(g, function M_A)
		call LogoutGroup(g)
		if x == W_E and y == W0E then
			call SaveInteger(HY, h, 33, 1)
			call GroupClear(D7R)
		endif
	elseif M2A == 1 then //停留
		set EVX = EVX + 1
		if EVX == 25 then
			set x = GetUnitX(NIX)
			set y = GetUnitY(NIX)
			call KillDestructablesInCircle(x, y, 175)
			set EVX = 0
			set U2 = WUE
			set Q_V = WUE
			set Q0V = LoadInteger(HY, h, 0)
			set g = LoginGroup(478)
			call GroupEnumUnitsInRange(g, x, y,$C8+ 25, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
			call ForGroup(g, function MZA)
			call LogoutGroup(g)
			set M3A =($F+ 5 * Q0V)/ 2
			if GetUnitState(WUE, UNIT_STATE_MANA)< M3A or GetDistanceBetweenUnits(WUE, NIX)>$7D0 then
				call SaveInteger(HY, h, 33, 2)
				call GroupClear(D7R)
				call UnitRemoveAbility(WUE, M5A)
				call RemoveUnitBEim(WUE)
				call UnitRemoveAbility(WUE,'BNms')
			else
				call SetUnitState(WUE, UNIT_STATE_MANA, GetUnitState(WUE, UNIT_STATE_MANA)-M3A)
			endif
		endif
		call SaveInteger(HY, h, 34,(EVX))
	elseif M2A == 2 then //收回
		set a = AngleBetweenXY(GetUnitX(NIX), GetUnitY(NIX), GetUnitX(WUE), GetUnitY(WUE))* bj_DEGTORAD
		set x = GetUnitX(NIX)+ 16 * Cos(a)
		set y = GetUnitY(NIX)+ 16 * Sin(a)
		call KillDestructablesInCircle(x, y, 175)
		call SetUnitX(NIX, x)
		call SetUnitY(NIX, y)
		set U2 = WUE
		set Q_V = WUE
		set Q0V = LoadInteger(HY, h, 0)
		set QZV = D7R
		set g = LoginGroup(479)
		call GroupEnumUnitsInRange(g, x, y,$C8+ 25, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
		call ForGroup(g, function M_A)
		call LogoutGroup(g)
		if GetDistanceBetween(x, y, GetUnitX(WUE), GetUnitY(WUE))< 40 then
			call UnitRemoveAbility(WUE, M4A)
			call KillUnit(NIX)
			call LogoutGroup(D7R)
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
			if Rubick_AbilityFilter(WUE , 'A2E5') or(LoadInteger(HY,(GetHandleId(WUE)), 704))== FJI then
				if FJI =='A43Q' then
					//这里判断一下是否选了此技能 没选并且是偷的就可以重新显示
					if LoadBoolean(P, GetHandleId(U2),'A43Q') or ( not PlayerHaveAbilityByActive(GetOwningPlayer(WUE), 'A2E5') and LoadInteger(HY, GetHandleId(WUE), 704) == 'A43Q' ) then
						call S9E(GetOwningPlayer(WUE), FJI, true)
					endif
				else
					call S9E(GetOwningPlayer(WUE), FJI, true)
				endif
			endif
			call S9E(GetOwningPlayer(WUE), M5A, false)
			if FJI !='A43Q' then
				call S9E(GetOwningPlayer(WUE),'A2E5', true)
				call S9E(GetOwningPlayer(WUE),'A43S', true)
			endif
			call UnitRemoveAbility(WUE, M5A)
		endif
	endif
	set t = null
	set WUE = null
	set NIX = null
	set D7R = null
	set g = null
	return false
endfunction
function D4E takes nothing returns nothing
	local unit WUE = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local real a = AngleBetweenXY(GetUnitX(WUE), GetUnitY(WUE), x, y)* bj_DEGTORAD
	local unit NIX = CreateUnit(GetOwningPlayer(WUE),'h0DS', GetUnitX(WUE), GetUnitY(WUE), a * bj_RADTODEG)
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer M4A
	local integer M5A
	local integer FJI = GetSpellAbilityId()
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerRegisterDeathEvent(t, WUE)
	call TriggerRegisterUnitEvent(t, WUE, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function M1A))
	call SaveUnitHandle(HY, h, 45, NIX)
	call SaveUnitHandle(HY, h, 2, WUE)
	call SaveReal(HY, h, 6, x * 1.)
	call SaveReal(HY, h, 7, y * 1.)
	call SaveInteger(HY, h, 33, 0)
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(WUE, FJI))
	call SaveGroupHandle(HY, h, 187, LoginGroup(480))
	call SaveInteger(HY, h, 2, FJI)
	if FJI =='A2E5' or FJI =='A43S' then
		set M4A ='A43N'
		set M5A ='A2FX'
	else
		set M4A ='A43O'
		set M5A ='A43P'
	endif
	call UnitAddPermanentAbility(WUE, M4A)
	call UnitAddPermanentAbility(WUE, M5A)
	call S9E(GetOwningPlayer(WUE), FJI, false)
	if FJI !='A43Q' then
		call S9E(GetOwningPlayer(WUE),'A2E5', false)
		call S9E(GetOwningPlayer(WUE),'A43S', false)
	endif
	call S9E(GetOwningPlayer(WUE), M5A, true)
	call SaveInteger(HY, h, 3, M4A)
	call SaveInteger(HY, h, 4, M5A)
	set WUE = null
	set t = null
	set NIX = null
endfunction
function PBE takes nothing returns nothing
	if GetUnitAbilityLevel(GetTriggerUnit(),'A43Q')> 0 then
		call SetUnitAbilityLevel(GetTriggerUnit(),'A43Q', GetUnitAbilityLevel(GetTriggerUnit(),'A2E5')+ GetUnitAbilityLevel(GetTriggerUnit(),'A43S'))
	endif
endfunction
function addXL takes nothing returns nothing
	local unit u = U2
	call UnitAddAbility(u,'A3UF')
	call UnitMakeAbilityPermanent(u, true,'A3UF')
	if HaveSavedHandle(W, GetHandleId(u),'PACD') == false then
		call PasSkillCoolDownTrigger(u)
	endif
	if not HaveSavedHandle(HY, GetHandleId(u),'A3UF') then
		call XJVXX()
	endif
	set u = null
endfunction
function delXL takes nothing returns nothing
	call UnitRemoveAbility(U2,'A3UF')
endfunction
function HEX takes nothing returns nothing
	call UnitAddPermanentAbility(U2,'A43Q')
	call S9E(GetOwningPlayer(U2),'A43Q', GetUnitAbilityLevel(U2,'A43O')== 0)
	call SaveBoolean(P, GetHandleId(U2),'A43Q', true)
	call SetUnitAbilityLevel(U2,'A43Q', GetUnitAbilityLevel(U2,'A2E5')+ GetUnitAbilityLevel(U2,'A43S'))
endfunction
function HNX takes nothing returns nothing
	call S9E(GetOwningPlayer(U2),'A43Q', false)
	call SaveBoolean(P, GetHandleId(U2),'A43Q', false)
endfunction
function P6X takes nothing returns nothing
	call AddAbilityIDToPreloadQueue('A2DV')
endfunction
function M6A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	local integer T0V = LoadInteger(HY, h, 1)
	local integer hu = GetHandleId(u)
	local integer c = LoadInteger(HY, h, 100)+ 1
	local integer JOX
	if c ==$F0 or T0V =='DRKN' or T0V =='DRKU' or T0V =='A29J' then
		if LoadInteger(P, hu,'A40K')!= T0V and LoadInteger(P, hu,'A40K'+ 1)!= T0V and LoadInteger(P, hu,'A40K'+ 2)!= T0V and LoadInteger(P, hu,'A40K'+ 3)!= T0V then
			call UnitRemoveAbility(u, T0V)
			set JOX = LoadInteger(HY, h, 2)
			if(LoadBoolean(P, hu,'A40K'+ JOX)) then
				call RemoveSavedBoolean(P, hu,'A40K'+ JOX)
			endif
		endif
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
	else
		call SaveInteger(HY, h, 100, c)
		if LoadInteger(P, hu,'A40K')!= T0V and LoadInteger(P, hu,'A40K'+ 1)!= T0V and LoadInteger(P, hu,'A40K'+ 2)!= T0V and LoadInteger(P, hu,'A40K'+ 3)!= T0V then
			call SetPlayerAbilityAvailable(GetOwningPlayer(u), T0V, false)
		endif
	endif
	set t = null
	set u = null
endfunction
function M7A takes unit u, integer Z_E, integer JOX returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .5, true, function M6A)
	call SetPlayerAbilityAvailable(GetOwningPlayer(u), Z_E, false)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call SaveInteger(HY, GetHandleId(t), 1, Z_E)
	call SaveInteger(HY, GetHandleId(t), 2, JOX)
	call SaveInteger(P, GetHandleId(u),'A40K'+ JOX, 0)
	call BYR(u)
	set t = null
endfunction
function M8A takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = null
	local integer level = LoadInteger(HY, h, 2)
	local integer i = LoadInteger(HY, h, 3)
	if GetTriggerEventId()== EVENT_UNIT_SPELL_ENDCAST and GetSpellAbilityId()== LoadInteger(HY, h, 0) then
		set i = i + 1
		if i >= LoadInteger(HY, h, 4) then
			set u = LoadUnitHandle(HY, h, 0)
			call M7A(u, LoadInteger(HY, h, 0), LoadInteger(HY, h, 1))
			call UnitRemoveAbility(u, LoadInteger(HY, h, 1)+'A40O')
			call SetPlayerAbilityAvailable(GetOwningPlayer(u), LoadInteger(HY, h, 0), false)
			set u = null
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		else
			call SaveInteger(HY, h, 3, i)
		endif
	else
		set u = LoadUnitHandle(HY, h, 0)
		if GetUnitAbilityLevel(u,'A40S'+ LoadInteger(HY, h, 1))!= GetUnitAbilityLevel(u, LoadInteger(HY, h, 0)) then
			call SetUnitAbilityLevel(u, LoadInteger(HY, h, 0), GetUnitAbilityLevel(u,'A40S'+ LoadInteger(HY, h, 1)))
		endif
		set u = null
	endif
	set t = null
endfunction
function M9A takes unit u, integer TPE, integer PVA, integer level returns nothing
	local trigger t = null
	local integer h
	if not UnitAddPermanentAbility(u, HeroCommonSkills[PlayerSkillIndex[TPE]]) and GetUnitAbilityLevel(u, HeroCommonSkills[PlayerSkillIndex[TPE]])== 0 then
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function M8A))
	call SaveUnitHandle(HY, h, 0, u)
	call SaveInteger(HY, h, 0, HeroCommonSkills[PlayerSkillIndex[TPE]])
	call SetUnitAbilityLevel(u, HeroCommonSkills[PlayerSkillIndex[TPE]], level)
	call SetPlayerAbilityAvailable(GetOwningPlayer(u), HeroCommonSkills[PlayerSkillIndex[TPE]], true)
	call SaveInteger(P, GetHandleId(u),'A40K'+ PVA, HeroCommonSkills[PlayerSkillIndex[TPE]])
	call SaveInteger(HY, h, 1, PVA)
	call SaveInteger(HY, h, 2, level)
	if TEE(Z9E(TPE),-1, "metamorphosis", null) then
		call SaveBoolean(P, GetHandleId(u),'A40K'+ PVA, true)
	endif
	if PVA == 3 then
		call SaveInteger(HY, h, 4, level)
	else
		call SaveInteger(HY, h, 4, level + 1)
	endif
	if(PVA == 3 and level < 3) or(PVA < 3 and level < 4) then
		call TriggerRegisterTimerEvent(t, 1, true)
	endif
	call UnitAddPermanentAbility(u, PVA +'A40O')
	set t = null
endfunction
function PEA takes unit u, integer TPE, integer PXA returns boolean
	local integer i = GetPlayerId(GetOwningPlayer(u))
	local integer xx
	local integer k
	if X6R(TPE) or IsAttackSpecialEffectsId(TPE) or LNX(TPE) then
		return false
	endif
	if TPE =='A3FQ' or TPE =='A3FJ' or TPE =='A0KX' or TPE =='A0G8' or TPE =='A07U' or TPE =='A38E' or TPE =='A0A5' or TPE =='A0AG' or TPE =='QM01' or TPE =='A0BE' or TPE =='A0EY' or TPE =='A0NS' or TPE =='A0H9' or TPE =='A0NE' or TPE =='A32E' or TPE =='A21F' or TPE =='A1S4' or TPE =='A1NA' or TPE =='A2QM' or TPE =='A2TJ' or TPE =='A2QI' or TPE =='A2TI' or TPE =='A06K' or TPE =='A1T8' or TPE =='A28Q' or TPE =='A1TB' or TPE =='A0MQ' or TPE =='A2O2' or TPE =='A0OO' or TPE =='A14O' or TPE =='A1EA' or TPE =='QB03' or TPE =='A27H' or TPE =='A2JR' or TPE =='Z234' or TPE =='A0WQ' or TPE =='A1C0' or TPE =='A0MP' or TPE =='A01Y' or TPE =='A32Z' or TPE =='A0SW' or TPE =='A0LV' or TPE =='A21M' or TPE =='A40B' or TPE =='A418' or TPE =='A0ES' then
		return false
	endif
	set xx = 1
	loop
		if HeroCommonSkills[PlayerSkillIndex[i * HL + xx]]== TPE or TEE(PXA, PlayerSkillIndex[i * HL + xx], null, null) then
			return false
		endif
		set xx = xx + 1
	exitwhen xx > 6
	endloop
	if TEE(PXA,-1, "metamorphosis", null) and(UnitTypeIsMetamorphosis(u) or LoadBoolean(P, GetHandleId(u),'A40K') or LoadBoolean(P, GetHandleId(u),'A40K'+ 1) or LoadBoolean(P, GetHandleId(u),'A40K'+ 2) or LoadBoolean(P, GetHandleId(u),'A40K'+ 3)) then
		return false
	endif
	if(LoadInteger(P, GetHandleId(u),'A40K')== TPE or LoadInteger(P, GetHandleId(u),'A40K'+ 1)== TPE or LoadInteger(P, GetHandleId(u),'A40K'+ 2)== TPE or LoadInteger(P, GetHandleId(u),'A40K'+ 3)== TPE) then
		return false
	endif
	return true
endfunction
// 无形复制技能
function F2E takes nothing returns nothing
	local integer i = 0
	local integer iu = 0
	local integer array a
	local integer array b
	local integer k = 1
	local integer TME = 0
	local integer xx = 0
	local unit u = GetTriggerUnit()
	local integer playerId = GetPlayerId(GetOwningPlayer(u))
	local integer PVA = GetSpellAbilityId()-'A40K'
	local integer F2O = 0
	local integer c = 0
	if k == playerId then
		set k = 2
	endif
	loop
		set xx = 1
		loop
			if PlayerSkillIndex[k * HL + xx]!= 0 then
				if IsPassiveSkill[PlayerSkillIndex[k * HL + xx]]== false and PEA(u, HeroCommonSkills[PlayerSkillIndex[k * HL + xx]], PlayerSkillIndex[k * HL + xx]) then
					if xx == 4 or xx == 6 then
						set b[iu]= k * HL + xx
						set iu = iu + 1
					else
						set a[i]= k * HL + xx
						set i = i + 1
					endif
				endif
			endif
			set xx = xx + 1
		exitwhen xx > HL
		endloop
		set k = k + 1
		if k == playerId then
			set k = k + 1
		endif
		if k == 6 then
			set k = 7
		endif
	exitwhen k > 11
	endloop
	if PVA == 3 then
		if iu > 0 then
			set F2O = b[GetRandomInt(0, iu -1)]
		endif
	else
		if i > 0 then
			set F2O = a[GetRandomInt(0, i -1)]
		endif
	endif
	if F2O == 0 then
		call InterfaceErrorForPlayer(GetOwningPlayer(u), "复制失败")
	else
		call M9A(u, F2O, PVA, GetUnitAbilityLevel(u, GetSpellAbilityId()))
	endif
	set u = null
endfunction
function PRA takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	if UnitIsDead(W2)== false then
		call SetWidgetLife(W2, GetWidgetLife(W2)+ LoadReal(HY, h,'n020')* .2)
	endif
endfunction
function PIA takes unit u returns nothing
	local trigger t
	if GetUnitTypeId(u)=='n020' and UnitIsDead(Player__Hero[GetPlayerId(GetOwningPlayer(u))])== false then
		set t = NHX(u, Player__Hero[GetPlayerId(GetOwningPlayer(u))],'h00W', "PRA", 400, false)
		call SaveReal(HY, GetHandleId(t),'n020', GetUnitState(u, UNIT_STATE_MAX_LIFE))
		set t = null
	endif
endfunction
function SCE takes nothing returns nothing
	local integer i
	local integer k
	if IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) then
		set i = GetHeroPrimaryAttributesType(GetTriggerUnit())
		if GetUnitAbilityLevel(GetTriggerUnit(),'A440')> 1 then
			set k =$A
		else
			set k =$F
		endif
		if i == 2 then
			call SetHeroInt(GetTriggerUnit(), GetHeroInt(GetTriggerUnit(), false)+ k, true)
		elseif i == 3 then
			call SetHeroAgi(GetTriggerUnit(), GetHeroAgi(GetTriggerUnit(), false)+ k, true)
		elseif i == 1 then
			call SetHeroStr(GetTriggerUnit(), GetHeroStr(GetTriggerUnit(), false)+ k, true)
		endif
	endif
endfunction
// 目标非英雄, 非镜像, 非远古, 
function SuperAttributeBonusActions takes unit source, unit target returns nothing
	if not DETargetIsHero[DEI] and not IsUnitType(target, UNIT_TYPE_ANCIENT) and not DETargetIsIllusion[DEI] and GetPrdRandom(source,'A43Z', 10) then
		call UnitDamageTargetEx(source, target, 1, $2710)
	endif
endfunction
function PNA takes nothing returns boolean
	if(GetUnitTypeId(GetFilterUnit())=='u012' or GetUnitTypeId(GetFilterUnit())=='u013') and UnitIsDead(GetFilterUnit())== false then
		set Q2 = Q2 -1
		return true
	endif
	return false
endfunction
function ScarabEnterMapActions takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local real a = GetUnitFacing(u)
	local group g
	local integer level = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A00T')
	local real WIE = 99999
	local unit u2 = null
	if GetUnitAbilityLevel(u,'BFig')== 1 then
		call KillUnit(u)
		call RemoveUnit(u)
		set Q2 = 1 + level
		set g = LoginGroup(481)
		call GroupEnumUnitsOfPlayer(g, p, Condition(function PNA))
		if Q2 < 1 then
			loop
				set u = FirstOfGroup(g)
			exitwhen u == null
				if LoadReal(HY, GetHandleId(u),'spwn')< WIE then
					set u2 = u
					set WIE = LoadReal(HY, GetHandleId(u),'spwn')
				endif
				call GroupRemoveUnit(g, u)
			endloop
		endif
		call KillUnit(u2)
		call LogoutGroup(g)
		set u = CreateUnit(p,'u012', x, y, a)
		call TriggerRegisterUnitEvent(JJ, u, EVENT_UNIT_SPELL_EFFECT)
		if GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A0A8')> 0 then
			call UnitAddPermanentAbility(u,'A1HW')
		endif
		call SaveReal(HY, GetHandleId(u),'spwn', GetGameTime())
		set u = null
	endif
endfunction
function PCA takes nothing returns boolean
	if GetUnitTypeId(GetFilterUnit())=='ushd' and UnitIsDead(GetFilterUnit())== false then
		set Q2 = Q2 -1
		return true
	endif
	return false
endfunction
function WarderEnterMapActions takes unit u returns nothing
	local player p = GetOwningPlayer(u)
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local real a = GetUnitFacing(u)
	local group g
	local integer level = GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A43Y')
	local real WIE = 99999
	local unit u2 = null
	if GetUnitAbilityLevel(u,'BFig')== 1 then
		call KillUnit(u)
		call RemoveUnit(u)
		set Q2 = 1 + level * 2
		set g = LoginGroup(482)
		call GroupEnumUnitsOfPlayer(g, p, Condition(function PCA))
		if Q2 < 1 then
			loop
				set u = FirstOfGroup(g)
			exitwhen u == null
				if LoadReal(HY, GetHandleId(u),'spwn')< WIE then
					set u2 = u
					set WIE = LoadReal(HY, GetHandleId(u),'spwn')
				endif
				call GroupRemoveUnit(g, u)
			endloop
		endif
		call KillUnit(u2)
		call LogoutGroup(g)
		set u = CreateUnit(p,'ushd', x, y, a)
		call SaveReal(HY, GetHandleId(u),'spwn', GetGameTime())
		set u = null
	endif
endfunction

// Lod的触发器
function CreateLodTrigger takes nothing returns nothing
	local trigger t
	// 伤害显示和镜头晃动
	// set t = CreateTrigger()
	// call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	// call TriggerAddAction(t, function ZGE)

	// 等级上限
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_HERO_LEVEL)
	call TriggerAddAction(t, function Y9E)

	// 选择技能
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddAction(t, function RDR)

	// 取消技能
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddAction(t, function RCR)

	// 禁止选择技能马甲释放技能
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
	call TriggerAddAction(t, function YAE)

	// 英雄升级时增加技能
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_HERO_LEVEL)
	call TriggerAddAction(t, function HeroLevelUp)

	if LOD_DEBUGMODE then
		return
		// debug Order
		set t = CreateTrigger()
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
		call TriggerAddAction(t, function T4E)
		// debug skillName
		set t = CreateTrigger()
		call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
		call TriggerAddAction(t, function T3E)
		// debg unitName
		set t = CreateTrigger()
		call TriggerRegisterPlayerSelectionEventBJ(t, Player(1), true)
		call TriggerAddAction(t, function T2E)
	endif
	call Y3E()
	// call TriggerSleepAction(1)
	set t = null
endfunction
function PGA takes nothing returns boolean
	local unit t = GetFilterUnit()
	if UnitAlive(t) and IsUnitAlly(Temp__ArrayUnit[0], GetOwningPlayer(t)) and GetUnitAbilityLevel(t,'A04R')== 0 and IsUnitType(t, UNIT_TYPE_STRUCTURE)== false and t != Temp__ArrayUnit[0]then
		call SaveBoolean(P, 99999, 99999, false)
		set t = null
	endif
	set t = null
	return false
endfunction
function PHA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(P, WFV, 0)
	local unit u = LoadUnitHandle(P, WFV, 0)
	if UYX == 120 or UnitIsDead(u) then
		call DestroyEffect(LoadEffectHandle(P, WFV, 2))
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		set u = null
		return
	endif
	call SaveInteger(P, WFV, 0, UYX + 1)
	set Temp__ArrayUnit[0]= u
	call SaveBoolean(P, 99999, 99999, true)
	call GroupEnumUnitsInRange(AK, GetWidgetX(u), GetWidgetY(u),$FA, Condition(function PGA))
	if LoadBoolean(P, 99999, 99999) then
		if GetUnitAbilityLevel(u,'D027')== 0 then
			call WJV(u,'C027','D027', 6 -UYX * .05)
		endif
		if UYX /$A== UYX / 10. then
			call UnitDamageTargetEx(LoadUnitHandle(P, WFV, 1), u, 1, LoadReal(P, WFV, 0))
		endif
	else
		call WHV(u,'D027')
	endif
	set t = null
	set u = null
endfunction
function YLV takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local unit d = GetSpellTargetUnit()
	local integer WFV = GetHandleId(t)
	call SaveUnitHandle(P, WFV, 0, d)
	call SaveUnitHandle(P, WFV, 1, u)
	call SaveEffectHandle(P, WFV, 2, AddSpecialEffectTarget("war3mapImported\\Flux3.mdx", d, "origin"))
	call SaveInteger(P, WFV, 0, 0)
	call SaveReal(P, WFV, 0, GetUnitAbilityLevel(u,'A2M1')* 7.5)
	call TimerStart(t, .05, true, function PHA)
	call WJV(d,'C027','D027', 6)
	set d = null
	set u = null
	set t = null
endfunction
function PJA takes nothing returns nothing
	local integer ETX
	local integer WFV
	local unit u = GetFilterUnit()
	if IsUnitAlly(u, Temp__Player) and(IsUnitType(u, UNIT_TYPE_HERO) or IsUnitType(u, UNIT_TYPE_STRUCTURE)) and GetUnitAbilityLevel(u,'A04R')== 0 and UnitAlive(u) then
		call GroupAddUnit(BK, u)
		if IsUnitInGroup(u, IK)== false then
			set WFV = GetHandleId(u)
			set ETX = StringHash("field_count")
			call WJV(u,'C028','D028',-1)
			if IsUnitType(u, UNIT_TYPE_HERO) then
				call LodSystem_AddUnitExtraState(u, XK[0], STATE_SYSTEM_ATTACK)
			else
				call LodSystem_AddUnitExtraState(u, XK[1], STATE_SYSTEM_ATTACK)
			endif
			call SaveInteger(P, WFV, ETX, LoadInteger(P, WFV, ETX)+ 1)
			call UnitAddAbility(u,'A515')
			call UnitMakeAbilityPermanent(u, true,'A515')
			call UnitMakeAbilityPermanent(u, true,'ACes')
			set u = null
			return
		endif
		call GroupRemoveUnit(IK, u)
	endif
	set u = null
endfunction
function PKA takes nothing returns nothing
	local unit u = null
	local timer t = GetExpiredTimer()
	local integer ETX = StringHash("field_count")
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(P, WFV, 0)
	local integer O3O = LoadInteger(P, WFV, 1)
	set IK = LoadGroupHandle(P, WFV, 1)
	if UYX == 0 then
		call DestroyEffect(LoadEffectHandle(P, WFV, 2))
		loop
			set u = FirstOfGroup(IK)
		exitwhen u == null
			set WFV = GetHandleId(u)
			set UYX = LoadInteger(P, WFV, ETX)
			if UYX == 1 then
				call UnitRemoveAbility(u,'A515')
				call WHV(u,'D028')
			endif
			call SaveInteger(P, WFV, ETX, UYX -1)
			call LodSystem_ReduceUnitExtraState(u, O3O, STATE_SYSTEM_ATTACK)
			call GroupRemoveUnit(IK, u)
		endloop
		call LogoutGroup(IK)
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		return
	endif
	call SaveInteger(P, WFV, 0, UYX -1)
	set Temp__Player = LoadPlayerHandle(P, WFV, 0)
	set XK[0]= O3O
	set XK[1]= O3O / 2
	call GroupEnumUnitsInRange(AK, LoadReal(P, WFV, 0), LoadReal(P, WFV, 1), 325, Condition(function PJA))
	loop
		set u = FirstOfGroup(IK)
	exitwhen u == null
		set WFV = GetHandleId(u)
		set UYX = LoadInteger(P, WFV, ETX)
		if UYX == 1 then
			call UnitRemoveAbility(u,'A515')
			call WHV(u,'D028')
		endif
		call SaveInteger(P, WFV, ETX, UYX -1)
		call LodSystem_ReduceUnitExtraState(u, O3O, STATE_SYSTEM_ATTACK)
		call GroupRemoveUnit(IK, u)
	endloop
	loop
		set u = FirstOfGroup(BK)
	exitwhen u == null
		call GroupRemoveUnit(BK, u)
		call GroupAddUnit(IK, u)
	endloop
	set u = null
	set t = null
endfunction
function YMV takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local integer WFV = GetHandleId(t)
	local integer WUV = GetUnitAbilityLevel(u,'A2LM')
	call SavePlayerHandle(P, WFV, 0, GetOwningPlayer(u))
	call SaveGroupHandle(P, WFV, 1, LoginGroup(483))
	call SaveEffectHandle(P, WFV, 2, AddSpecialEffect("war3mapImported\\MagneticField04.mdl", x, y))
	call SaveInteger(P, WFV, 0, 30 + 5 * WUV)
	call SaveInteger(P, WFV, 1, 40 +$A* WUV)
	call SaveReal(P, WFV, 0, x)
	call SaveReal(P, WFV, 1, y)
	call TimerStart(t, .1, true, function PKA)
	call EnableEffectByTime(0, 6)
	set t = null
	set u = null
endfunction
function PLA takes unit u returns nothing
	local real x = GetWidgetX(u)-Temp__ArrayReal[0]
	local real y = GetWidgetY(u)-Temp__ArrayReal[1]
	local real d = SquareRoot(x * x + y * y)
	if Temp__ArrayReal[2]> d then
		set Temp__ArrayReal[2]= d
		set Temp__ArrayUnit[0]= u
	endif
endfunction
function PMA takes nothing returns boolean
	local unit t = GetFilterUnit()
	if IsUnitEnemy(t, Temp__Player) and GetUnitAbilityLevel(t,'A04R')== 0 and IsMagicImmuneUnit(t)== false and UnitAlive(t) and IsUnitType(t, UNIT_TYPE_STRUCTURE)== false and(IsUnitType(t, UNIT_TYPE_ANCIENT)== false or IsBearUnit(t)) then
		call PLA(t)
	endif
	set t = null
	return false
endfunction
function PPA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local unit u1 = LoadUnitHandle(P, WFV, 0)
	local unit u2 = LoadUnitHandle(P, WFV, 1)
	local real x2
	local real y2
	local real x1
	local real y1
	if UnitIsDead(u2) then
		call KillUnit(u1)
		call DestroyTimerAndFlushHT_P(t)
		set u2 = null
		set u1 = null
		set t = null
		return
	endif
	set x1 = GetWidgetX(u1)
	set y1 = GetWidgetY(u1)
	set x2 = x1 -GetWidgetX(u2)
	set y2 = y1 -GetWidgetY(u2)
	if $F> SquareRoot(x2 * x2 + y2 * y2) then
		call UnitDamageTargetEx(LoadUnitHandle(P, WFV, 3), u2, 1, LoadInteger(P, WFV, 1))
		call KillUnit(u1)
		call DestroyTimerAndFlushHT_P(t)
		set u2 = null
		set u1 = null
		set t = null
		return
	endif
	set x2 = Atan2(-y2,-x2)
	call SetUnitX(u1, x1 + 10.625 * Cos(x2))
	call SetUnitY(u1, y1 + 10.625 * Sin(x2))
	set u2 = null
	set u1 = null
	set t = null
endfunction
function PQA takes nothing returns nothing
	local unit u = null
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(P, WFV, 0)
	if UYX ==1000 then
		call KillUnit(LoadUnitHandle(P, WFV, 0))
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		return
	endif
	set Temp__Player = LoadPlayerHandle(P, WFV, 2)
	set Temp__ArrayUnit[0]= null
	set Temp__ArrayReal[0]= LoadReal(P, WFV, 0)
	set Temp__ArrayReal[1]= LoadReal(P, WFV, 1)
	set Temp__ArrayReal[2]= 450
	call GroupEnumUnitsInRange(AK, Temp__ArrayReal[0], Temp__ArrayReal[1], 400, Condition(function PMA))
	call SaveInteger(P, WFV, 0, UYX + 1)
	if Temp__ArrayUnit[0]!= null then
		set u = LoadUnitHandle(P, WFV, 0)
		call SetUnitAnimationByIndex(u, 2)
		call SetUnitVertexColorEx(u,-1,-1,-1, 150)
		call SaveUnitHandle(P, WFV, 1, Temp__ArrayUnit[0])
		call TimerStart(t, .025, true, function PPA)
		set u = null
	endif
	set t = null
endfunction
function PSA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	call TimerStart(t, .05, true, function PQA)
	call SetUnitAnimationByIndex(LoadUnitHandle(P, WFV, 0), 1)
	set t = null
endfunction
function YPV takes nothing returns nothing
	local timer t = CreateTimer()
	local unit u = GetTriggerUnit()
	local player p = GetOwningPlayer(u)
	local real x = GetSpellTargetX()
	local real y = GetSpellTargetY()
	local unit d = CreateUnit(p,'h0EG', x, y, 270)
	local integer WFV = GetHandleId(t)
	call UnitAddAbility(d,'Aloc')
	call UnitAddAbility(d,'A04R')
	call UnitAddAbility(d,'Arav')
	call SaveUnitHandle(P, WFV, 0, d)
	call SaveUnitHandle(P, WFV, 3, u)
	call SavePlayerHandle(P, WFV, 2, p)
	call SaveInteger(P, WFV, 0, 0)
	call SaveInteger(P, WFV, 1, 100 + 50 * GetUnitAbilityLevel(u,'A2LL'))
	call SaveReal(P, WFV, 0, x)
	call SaveReal(P, WFV, 1, y)
	call SetUnitAnimationByIndex(d, 0)
	call TimerStart(t, 3, false, function PSA)
	set p = null
	set d = null
	set u = null
	set t = null
endfunction
function PTA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit PUA =(LoadUnitHandle(HY, h, 17))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call FlushChildHashtable(HY,(GetHandleId(PUA)))
	call RemoveUnit(PUA)
	set t = null
	set PUA = null
	return false
endfunction
function PWA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit PUA =(LoadUnitHandle(HY, h, 2))
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	call FlushChildHashtable(HY,(GetHandleId(PUA)))
	call ShowUnit(PUA, false)
	set t = null
	set PUA = null
	return false
endfunction
function PYA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE =(LoadUnitHandle(HY, h, 2))
	local unit PUA =(LoadUnitHandle(HY, h, 17))
	local integer level = GetUnitAbilityLevel(WJE,'A2M0')
	if GetTriggerEvalCount(t)==$C8 or GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
		call KillUnit(PUA)
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl", GetUnitX(PUA), GetUnitX(PUA)))
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(PUA))
		call TriggerRegisterTimerEvent(t, 0, false)
		call TriggerAddCondition(t, Condition(function PWA))
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call TriggerRegisterTimerEvent(t, 3, false)
		call TriggerAddCondition(t, Condition(function PTA))
		call SaveUnitHandle(HY, h, 17,(PUA))
	else
		call SuspendHeroXP(PUA, true)
		call UnitModifySkillPoints(PUA,-25)
	endif
	set t = null
	set WJE = null
	set PUA = null
	return false
endfunction
// 风暴双雄
function YUV takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit PUA
	local integer level = GetUnitAbilityLevel(WJE,'A2M0')
	local integer i = 0
	local item it
	local integer PZA ='I02M'
	local integer TME = GetPlayerId(GetOwningPlayer(WJE))
	set QV = true
	call DisableTrigger(hChooseHeroTrigger)
	set PUA = CreateUnit(GetOwningPlayer(WJE), GetUnitTypeId(WJE), GetUnitX(WJE), GetUnitY(WJE), 0)
	call EnableTrigger(hChooseHeroTrigger)
	call SetUnitVertexColorEx(PUA,-1,-1,-1, 130)
	call SaveBoolean(HY, GetHandleId(PUA), QR, true)
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl", PUA, "chest"))
	call SelectUnitAddForPlayer(PUA, GetOwningPlayer(WJE))
	call DisableTrigger(CUV)
	loop
	exitwhen i > 5
		if UnitItemInSlot(WJE, i)!= null and GetItemTypeId(UnitItemInSlot(WJE, i))!= RealItemTypeId[AIV]and GetItemTypeId(UnitItemInSlot(WJE, i))!= RealItemTypeId[A6V]and GetItemTypeId(UnitItemInSlot(WJE, i))!= RealItemTypeId[R2V]and GetItemTypeId(UnitItemInSlot(WJE, i))!= RealItemTypeId[R3V]and GetItemTypeId(UnitItemInSlot(WJE, i))!= RealItemTypeId[IVV]then
			set it = CreateItem(GetItemTypeId(UnitItemInSlot(WJE, i)), 0, 0)
			if GetItemCharges(UnitItemInSlot(WJE, i))> 0 then
				call SetItemCharges(it, GetItemCharges(UnitItemInSlot(WJE, i)))
			endif
			call UnitAddItem(PUA, it)
			call SetItemPlayer(it, GetOwningPlayer(PUA), false)
			if GetItemTypeId(it)== RealItemTypeId[ASV]or GetItemTypeId(it)== RealItemTypeId[ATV]or GetItemTypeId(it)== RealItemTypeId[X4V]then
				call SetItemDropOnDeath(it, false)
			endif
		else
			call UnitAddItem(PUA, CreateItem(PZA, 0, 0))
		endif
		set i = i + 1
	endloop
	call EnableTrigger(CUV)
	call SetHeroLevel(PUA, GetHeroLevel(WJE), false)
	set i = 1
	loop
	exitwhen i > GetUnitAbilityLevel(WJE,'Aamk')
		call SelectHeroSkill(PUA,'Aamk')
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > GetUnitAbilityLevel(WJE,'A0NR')
		call SelectHeroSkill(PUA,'A0NR')
		set i = i + 1
	endloop
	call UnitAddPermanentAbility(PUA, HeroChangeAbilitySkills[PlayerSkillIndex[TME * HL + 1]])
	call UnitAddPermanentAbility(PUA, HeroChangeAbilitySkills[PlayerSkillIndex[TME * HL + 2]])
	call UnitAddPermanentAbility(PUA, HeroChangeAbilitySkills[PlayerSkillIndex[TME * HL + 3]])
	call UnitAddPermanentAbility(PUA, HeroChangeAbilitySkills[PlayerSkillIndex[TME * HL + 4]])
	set i = 1
	loop
	exitwhen i > GetUnitAbilityLevel(WJE, HeroCommonSkills[PlayerSkillIndex[TME * HL + 1]])
		call SelectHeroSkill(PUA, HeroCommonSkills[PlayerSkillIndex[TME * HL + 1]])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > GetUnitAbilityLevel(WJE, HeroCommonSkills[PlayerSkillIndex[TME * HL + 2]])
		call SelectHeroSkill(PUA, HeroCommonSkills[PlayerSkillIndex[TME * HL + 2]])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > GetUnitAbilityLevel(WJE, HeroCommonSkills[PlayerSkillIndex[TME * HL + 3]])
		call SelectHeroSkill(PUA, HeroCommonSkills[PlayerSkillIndex[TME * HL + 3]])
		set i = i + 1
	endloop
	set i = 1
	loop
	exitwhen i > GetUnitAbilityLevel(WJE, HeroCommonSkills[PlayerSkillIndex[TME * HL + 4]])
		call SelectHeroSkill(PUA, HeroCommonSkills[PlayerSkillIndex[TME * HL + 4]])
		set i = i + 1
	endloop
	call UnitRemoveAbility(PUA,'A2M0')
	call UnitModifySkillPoints(PUA,-25)
	call SuspendHeroXP(PUA, true)
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterDeathEvent(t, PUA)
	call TriggerAddCondition(t, Condition(function PYA))
	call SaveUnitHandle(HY, h, 2,(WJE))
	call SaveUnitHandle(HY, h, 17,(PUA))
	call SetWidgetLife(WJE, GetWidgetLife(WJE)*(1 -(.45 -0.15 * level)))
	call SetUnitState(WJE, UNIT_STATE_MANA, GetUnitState(WJE, UNIT_STATE_MANA)*(1 -(.45 -0.15 * level)))
	call SetWidgetLife(PUA, GetWidgetLife(WJE))
	call SetUnitState(PUA, UNIT_STATE_MANA, GetUnitState(WJE, UNIT_STATE_MANA))
	set QV = false
	set WJE = null
	set PUA = null
	set t = null
	set it = null
endfunction
function P_A takes unit u returns boolean
	return GetUnitAbilityLevel(u,'D100')== 1 or GetUnitAbilityLevel(u,'D101')== 1 or GetUnitAbilityLevel(u,'D102')== 1 or GetUnitAbilityLevel(u,'D103')== 1
endfunction
function ArcticBurnTimerLoop takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(P, WFV, 0)
	local unit u = LoadUnitHandle(P, WFV, 0)
	local real L2O
	if UYX == 4 or UnitIsDead(u) or P_A(u)== false then
		call DestroyEffect(LoadEffectHandle(P, WFV, 1))
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		set u = null
		return
	endif
	set L2O = GetWidgetLife(u)
	set L2O = L2O -L2O * .09
	if .405 > L2O then
		set L2O = .406
	endif
	call SetWidgetLife(u, L2O)
	call SaveInteger(P, WFV, 0, UYX + 1)
	set t = null
	set u = null
endfunction
function ArcticBurnAdd takes unit u, unit d, integer WUV returns nothing
	local timer t = CreateTimer()
	local integer WFV = GetHandleId(t)
	call WJV(d,'C100'+ WUV,'D100'+ WUV, 5)
	call SaveUnitHandle(P, WFV, 0, d)
	call SaveEffectHandle(P, WFV, 1, AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostDamage\\FrostDamage.mdl", d, "chest"))
	call SaveInteger(P, WFV, 0, 0)
	call TimerStart(t, 1, true, function ArcticBurnTimerLoop)
	set t = null
endfunction
function P2A takes nothing returns nothing
	local unit u = null
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	if GetTriggerEventId()!= EVENT_UNIT_DAMAGED then
		call CleanCurrentTrigger(t)
		call FlushChildHashtable(P, h)
		set t = null
		return
	endif
	set u = GetEventDamageSource()
	if u == LoadUnitHandle(P, h, 0) and GetEventDamage()> 5 then
		if P_A(GetTriggerUnit())== false then

		endif
		call CleanCurrentTrigger(t)
		call FlushChildHashtable(P, h)
	endif
	set t = null
	set u = null
endfunction
function P3A takes unit u, unit t returns nothing
	local trigger HLR = CreateTrigger()
	call SaveUnitHandle(P, GetHandleId(HLR), 0, u)
	call TriggerRegisterUnitEvent(HLR, t, EVENT_UNIT_DAMAGED)
	call TriggerRegisterTimerEvent(HLR, 3, false)
	call SaveInteger(P, GetHandleId(HLR), 0, GetUnitAbilityLevel(u,'A332'))
	call TriggerAddCondition(HLR, Condition(function P2A))
	set HLR = null
endfunction
function ArcticBurnActions takes unit u, unit t returns nothing
	if GetUnitAbilityLevel(u,'D029')== 1 and GetUnitAbilityLevel(t,'A04R')== 0 and P_A(t)== false and IsNotRoshan(t) then
		call ArcticBurnAdd(u, t, GetUnitAbilityLevel(u,'A332') -1)
	endif
endfunction
// 看起来像是逆变身
function P5A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local unit u = LoadUnitHandle(P, WFV, 0)
	local integer level
	local integer h
	if UnitAlive(u) and LoadBoolean(P, GetHandleId(u), StringHash("morphedburn")) then
		call RAX(u, LoadInteger(P, WFV, 1))
		call RAX(u, LoadInteger(P, WFV, 0))
		call KillDestructablesInCircle(GetWidgetX(u), GetWidgetY(u), 150)
		call SaveBoolean(P, GetHandleId(u), StringHash("morphedburn"), false)
		call SaveInteger(P, GetHandleId(u), StringHash("morphedburn"), 0)
		call FixUnitSkillsBug(u)
		if GetUnitAbilityLevel(u,'A2AI')> 0 then
			call UnitRemoveAbility(u,'QF0O')
			call SetUnitAbilityLevel(u,'QB0G', GetUnitAbilityLevel(u,'A2AI'))
		endif
		call DestroyTimerAndFlushHT_P(t)
	elseif UnitIsDead(u) and LoadBoolean(P, GetHandleId(u), StringHash("morphedburn")) then
		call TimerStart(t, 1, true, function P5A)
	endif
	set t = null
	set u = null
endfunction
function YQV takes nothing returns nothing
	local unit u = GetTriggerUnit()
	if GetUnitTypeId(u)!='N0MA' and GetUnitTypeId(u)!='N0MO' and GetUnitTypeId(u)!='N0MB' and GetUnitTypeId(u)!='N0MC' then
		call FixUnitSkillsBug(u)
		call WJV(u,'C029','D029', 6)
	else
		call KillDestructablesInCircle(GetUnitX(u), GetUnitY(u), 200)
	endif
	set u = null
endfunction
function P6A takes nothing returns boolean
	return IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and(IsAliveNotStrucNotWard(GetFilterUnit())) and IsNoAncientOrBear(GetFilterUnit())
endfunction
function P7A takes nothing returns nothing
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit WJE = LoadUnitHandle(HY, h, 2)
	local unit WLE = ZG
	local integer level = LoadInteger(HY, h, 0)
	if IsMagicImmuneUnit(WLE)== false then
		call UnitDamageTargetEx(WJE, WLE, 1, 20 + 80 * level)
		call WJV(WLE,'C030','D030', 4)
		call CXX(WLE,'A2MJ', 1, 4)
	endif
	set WJE = null
	set WLE = null
endfunction
function P8A takes nothing returns nothing
	local unit u = UG
	local unit WLE = GetEnumUnit()
	local trigger t = N6X(WG, WLE,'h0EC', "P7A", 600)
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 2, u)
	call SaveInteger(HY, h, 0, Q2)
	set u = null
	set WLE = null
	set t = null
endfunction
function P9A takes unit WJE, unit WLE, integer level, boolean FAR returns nothing
	local group g = LoginGroup(484)
	set U2 = WJE
	set UG = WJE
	set WG = WLE
	set Q2 = level
	call GroupEnumUnitsInRange(g, GetUnitX(WLE), GetUnitY(WLE), 525, Condition(function P6A))
	call GroupRemoveUnit(g, WLE)
	call ForGroup(g, function P8A)
	call LogoutGroup(g)
	if GetUnitAbilityLevel(WLE,'A3E9')== 1 and FAR == false and IsMagicImmuneUnit(WJE) then
		call SaveUnitHandle(VV,'A3E9', 0, WLE)
		call SaveUnitHandle(VV,'A3E9', 1, WJE)
		call SaveInteger(VV,'A3E9', 0, level)
		call ExecuteFunc("QVA")
	endif
	set WJE = null
	set WLE = null
	set g = null
endfunction
function QEA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 2)
	local unit WLE = LoadUnitHandle(HY, h, 17)
	local unit HJA = LoadUnitHandle(HY, h, 45)
	local real px = GetUnitX(HJA)
	local real py = GetUnitY(HJA)
	local real tx = GetUnitX(WLE)
	local real ty = GetUnitY(WLE)
	local real O_A = GetDistanceBetween(tx, ty, px, py)
	local integer UYX = GetTriggerEvalCount(t)
	local real radian = AngleBetweenXY(px, py, tx, ty)
	local real M8R
	local real M9R
	local real N3X = O_A /((1. / .02)-UYX)
	if N3X < 650 * .02 then
		set N3X = 650 * .02
	endif
	set M8R = px + N3X * Cos(radian * bj_DEGTORAD)
	set M9R = py + N3X * Sin(radian * bj_DEGTORAD)
	call SetUnitX(HJA, M8R)
	call SetUnitY(HJA, M9R)
	call SetUnitFacing(HJA, radian)
	if GetDistanceBetween(tx, ty, M8R, M9R)<= N3X then
		call KillUnit(HJA)
		call P9A(WJE, WLE, LoadInteger(HY, h, 0), LoadBoolean(HY, h, 0))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WLE = null
	set WJE = null
	set HJA = null
	return false
endfunction
function QXA takes unit WJE, unit WLE, integer level, boolean FAR returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local unit HJA = CreateUnit(GetOwningPlayer(WJE),'e01E', GetUnitX(WJE), GetUnitY(WJE), 0)
	call TriggerRegisterTimerEvent(t, .02, true)
	call TriggerAddCondition(t, Condition(function QEA))
	call SaveUnitHandle(HY, h, 2, WJE)
	call SaveInteger(HY, h, 0, level)
	call SaveBoolean(HY, h, 0, FAR)
	call SaveUnitHandle(HY, h, 17, WLE)
	call SaveUnitHandle(HY, h, 45, HJA)
	set HJA = null
	set t = null
endfunction
function YTV takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local unit WLE = GetSpellTargetUnit()
	local integer level = GetUnitAbilityLevel(WJE, GetSpellAbilityId())
	if UnitHasSpellShield(WLE)== false then
		call QXA(WJE, WLE, level, false)
	endif
	set WJE = null
	set WLE = null
endfunction
function QVA takes nothing returns nothing
	local unit WJE = LoadUnitHandle(VV,'A3E9', 0)
	local unit WLE = LoadUnitHandle(VV,'A3E9', 1)
	local integer level = LoadInteger(VV,'A3E9', 0)
	call T4V(LoadUnitHandle(VV,'A3E9', 0))
	if UnitHasSpellShield(WLE)== false then
		call QXA(WJE, WLE, level, true)
	endif
	set WJE = null
	set WLE = null
	call FlushChildHashtable(VV,'A3E9')
endfunction
function QOA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer WFV = GetHandleId(t)
	local integer UYX = LoadInteger(P, WFV, 0)
	local unit u = LoadUnitHandle(P, WFV, 0)
	if UYX == 40 or UnitIsDead(u) or IsUnitHidden(u) or(C5X(u)== false and UYX > 4) then
		set UYX = 1
		loop
		exitwhen UYX ==$A
			call DestroyEffect(LoadEffectHandle(P, WFV, UYX))
			set UYX = UYX + 1
		endloop
		set WFV = GetHandleId(u)
		set UYX = LoadInteger(P, WFV,'A516')
		if UYX == 1 then
			call UnitRemoveAbility(u,'A516')
		endif
		call SaveInteger(P, WFV,'A516', UYX -1)
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		set u = null
		return
	endif
	call SetWidgetLife(u, GetWidgetLife(u)+ 2 + GetUnitState(u, UNIT_STATE_MAX_LIFE)* LoadReal(P, WFV, 0))
	call SaveInteger(P, WFV, 0, UYX + 1)
	set t = null
	set u = null
endfunction
function FLE takes nothing returns nothing
	local timer t = null
	local integer WFV
	local unit u = GetTriggerUnit()
	local unit u2 = GetSpellTargetUnit()
	local unit W_V = CreateUnit(GetOwningPlayer(u2),'e00E', GetUnitX(u2), GetUnitY(u2), 0)
	call UnitAddAbility(W_V,'A2LG')
	if IssueTargetOrderById(W_V, 852095, u2) then
		set t = CreateTimer()
		set WFV = GetHandleId(t)
		call SaveUnitHandle(P, WFV, 0, u2)
		call SaveReal(P, WFV, 0, GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetOwningPlayer(u))],'A2LB')* .001 + .002)
		call SaveInteger(P, WFV, 0, 0)
		call SaveEffectHandle(P, WFV, 1, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, "hand right"))
		call SaveEffectHandle(P, WFV, 2, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, "hand left"))
		call SaveEffectHandle(P, WFV, 3, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, "foot right"))
		call SaveEffectHandle(P, WFV, 4, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, "foot left"))
		call SaveEffectHandle(P, WFV, 5, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, "foot right mount rear"))
		call SaveEffectHandle(P, WFV, 6, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, "foot left mount rear"))
		call SaveEffectHandle(P, WFV, 7, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, "head"))
		call SaveEffectHandle(P, WFV, 8, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, "chest"))
		call SaveEffectHandle(P, WFV, 9, AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx", u2, T2V(u2)))
		call UnitAddAbility(u2,'A516')
		call SaveInteger(P, GetHandleId(u2),'A516', LoadInteger(P, GetHandleId(u2),'A516')+ 1)
		call TimerStart(t, .1, true, function QOA)
		set t = null
	endif
	set W_V = null
	set u2 = null
	set u = null
	set t = null
endfunction
function QRA takes unit u returns nothing
	if GetUnitAbilityLevel(u,'D031')> 0 and UnitIsSleeping(u)== false and GetUnitAbilityLevel(u,'B008')== 0 and K0V == false then
		call DisableTrigger(JJ)
		call IssueTargetOrderById(u, 851983, LoadUnitHandle(P, GetHandleId(u),'A0Z0'))
		call EnableTrigger(JJ)
	endif
endfunction
function QIA takes nothing returns nothing
	local unit u = GetEnumUnit()
	call DisableTrigger(FG)
	call UnitWakeUp(u)
	call IssueTargetOrderById(u, 851983, GG)
	call EnableTrigger(FG)
	set u = null
endfunction
function QAA takes nothing returns nothing
	call EPX(GetEnumUnit(), 4328, .75)
	if IsUnitType(GetEnumUnit(), UNIT_TYPE_HERO) then
		call SelectUnitAddForPlayer(GetEnumUnit(), GetOwningPlayer(GetEnumUnit()))
	endif
endfunction
function QNA takes nothing returns nothing
	local unit u = GetEnumUnit()
	if IsUnitInGroup(u, HG)== false then
		call GroupAddUnit(HG, u)
		call TriggerRegisterUnitEvent(FG, u, EVENT_UNIT_ISSUED_TARGET_ORDER)
		call TriggerRegisterUnitEvent(FG, u, EVENT_UNIT_ISSUED_POINT_ORDER)
		call TriggerRegisterUnitEvent(FG, u, EVENT_UNIT_ISSUED_TARGET_ORDER)
		call SaveInteger(HY, GetHandleId(u), 4328, 1)
	endif
	set u = null
endfunction
function QBA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE =(LoadUnitHandle(HY, h, 2))
	local unit WLE =(LoadUnitHandle(HY, h, 17))
	local integer level =(LoadInteger(HY, h, 5))
	local integer C2R =(LoadInteger(HY, h, 34))
	local group g =(LoadGroupHandle(HY, h, 22))
	local group gg
	if GetTriggerEventId()!= EVENT_UNIT_ISSUED_TARGET_ORDER and GetTriggerEventId()!= EVENT_UNIT_ISSUED_POINT_ORDER and GetTriggerEventId()!= EVENT_UNIT_ISSUED_TARGET_ORDER then
		set C2R = C2R + 1
		call SaveInteger(HY, h, 34,(C2R))
		set HG = g
		set FG = t
		set gg = LoginGroup(485)
		set U2 = WJE
		call GroupEnumUnitsInRange(gg, GetUnitX(WLE), GetUnitY(WLE), 375, Condition(function DQX))
		call GroupRemoveUnit(gg, WLE)
		call ForGroup(gg, function QNA)
		call LogoutGroup(gg)
		if C2R ==(2.25 + .25 * level)* 20 or UnitIsDead(WLE) then
			call ForGroup(g, function QAA)
			call UnitRemoveAbility(WLE,'A342')
			call LogoutGroup(g)
			call DestroyEffect((LoadEffectHandle(HY, h, 176)))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(t)
		else
			set FG = t
			set GG = WLE
			call ForGroup(g, function QIA)
		endif
	else
		if UnitIsSleeping(GetTriggerUnit())== false and GetUnitAbilityLevel(GetTriggerUnit(),'B008')== 0 and GetIssuedOrderId()!=$D0005 then
			call DisableTrigger(t)
			call ClearSelectionForPlayer(GetOwningPlayer(GetTriggerUnit()))
			call IssueTargetOrderById(GetTriggerUnit(), 851983, WLE)
			call EnableTrigger(t)
		endif
	endif
	set t = null
	set WJE = null
	set WLE = null
	set g = null
	set gg = null
	return false
endfunction
function QCA takes nothing returns nothing
	local unit WJE = GetTriggerUnit()
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	local integer level = GetUnitAbilityLevel(WJE,'A0Z0')
	local unit WLE = GetSpellTargetUnit()
	local unit W_V = CreateUnit(GetOwningPlayer(WJE),'e00E', GetUnitX(WLE), GetUnitY(WLE), 0)
	if GetUnitAbilityLevel(WJE,'Aloc')== 1 and HaveSavedHandle(HY, GetHandleId(WJE), 0) then
		set WJE = LoadUnitHandle(HY, GetHandleId(WJE), 0)
	endif
	set PG = WJE
	call UnitAddPermanentAbility(WLE,'A342')
	call UnitAddAbility(W_V,'A2NJ')
	call SetUnitAbilityLevel(W_V,'A2NJ', level)
	call IssueTargetOrderById(W_V, 852095, WLE)
	call TriggerRegisterTimerEvent(t, .05, true)
	call SaveUnitHandle(HY, h, 2,(WJE))
	call SaveUnitHandle(HY, h, 17,(WLE))
	call SaveInteger(HY, h, 5,(level))
	call SaveGroupHandle(HY, h, 22,(LoginGroup(486)))
	call SaveEffectHandle(HY, h, 176,(AddSpecialEffect("war3mapImported\\WintersCurseAoE.mdx", GetUnitX(WLE), GetUnitY(WLE))))
	call TriggerAddCondition(t, Condition(function QBA))
	set WJE = null
	set WLE = null
	set W_V = null
	set t = null
endfunction
function FME takes nothing returns nothing
	if not UnitHasSpellShield(GetSpellTargetUnit()) then
		call QCA()
	endif
endfunction
function ShadowAmulet__AddBuff__Actions takes nothing returns nothing
	local custombuff b = GetTriggerBuff()
	call UnitAddWindWalk(b.target)
endfunction
function ShadowAmulet__RemoveBuff__Actions takes nothing returns nothing
	local custombuff b = GetTriggerBuff()
	call UnitRemoveWindWalk(b.target)
endfunction
function ShadowAmuletEndCondition takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u
	if GetTriggerEventId()== EVENT_UNIT_SPELL_CAST then
		set u = GetTriggerUnit()
		call UnitRemoveCustomBuffEx(u, 'B0G8')
	elseif GetTriggerEventId()== EVENT_PLAYER_UNIT_ATTACKED then
		if GetAttacker()== LoadUnitHandle(HY, h, 0) then
			set u = GetAttacker()
			call UnitRemoveCustomBuffEx(u, 'B0G8')
		endif
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set u = null
endfunction
function ShadowAmuletEffectLoop takes nothing returns nothing
	local unit d = null
	local timer t = GetExpiredTimer()
	local trigger trig
	local integer h = GetHandleId(t)
	local integer count = LoadInteger(HY, h, 0)
	local unit u = LoadUnitHandle(HY, h, 0)
	local custombuff b
	if UnitIsDead(u) or(GetUnitAbilityLevel(u,'B0G8')== 0 and count > LoadInteger(HY, h, 2)) or(LoadBoolean(HY, h, 0) and(LoadReal(HY, h, 0)!= GetWidgetX(u) or LoadReal(HY, h, 1)!= GetWidgetY(u))) then
		call SaveBoolean(HY, GetHandleId(u),'A2N5', false)
		set trig = LoadTriggerHandle(ExtraHT, GetHandleId(u), 'B0G8')
		call FlushChildHashtable(HY, GetHandleId(trig))
		call CleanCurrentTrigger(trig)
		set trig = null
		call UnitRemoveCustomBuffEx(u,'B0G8')
		call DestroyTimerAndFlushHT_P(t)
		set t = null
		set u = null
		return
	endif
	if count == LoadInteger(HY, h, 2) then
		if IsUnitIllusion(d) then
			set d = CreateUnit(NeutralPassivePlayer,'e00E', 0, 0, 0)
			call UnitAddAbility(d,'A2N5')
			call IssueTargetOrderById(d,$D0065, u)
			set d = null
		else
			set b = custombuff.create(u, u)
			set trig = CreateTrigger()
			call SaveUnitHandle(HY, GetHandleId(trig), 0, u)
			call SaveTriggerHandle(ExtraHT, GetHandleId(u), 'B0G8', trig)
			call TriggerRegisterPlayerUnitEventBJ(trig, EVENT_PLAYER_UNIT_ATTACKED)
			call TriggerRegisterUnitEvent(trig, u, EVENT_UNIT_SPELL_CAST)
			call TriggerAddCondition(trig, Condition(function ShadowAmuletEndCondition))
			set trig = null
			set b.aid = 'AWG8'
			set b.bid = 'B0G8'
			set b.dur = 3600.
			set b.overlayDur = true
			set b.level = 1
			set b.basicDispel = false
			set b.removeActions = "ShadowAmulet__RemoveBuff__Actions"
			set b.addActions = "ShadowAmulet__AddBuff__Actions"
			call b.add_buff()
		
			call SaveBoolean(HY, GetHandleId(u),'A2N5', false)
			call IssueImmediateOrderById(u,$D0019)
			call SaveReal(HY, h, 0, GetWidgetX(u))
			call SaveReal(HY, h, 1, GetWidgetY(u))
			call SaveBoolean(HY, h, 0, true)
		endif
	endif
	call SaveInteger(HY, h, 0, count + 1)
	set t = null
	set u = null
endfunction
function ShadowAmuletEffectAdd takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	call SaveInteger(HY, h, 0, 0)
	call SaveInteger(HY, h, 2, R2I(1.5 / .05))
	call TimerStart(t, .05, true, function ShadowAmuletEffectLoop)
	set t = null
	set u = null
endfunction
function ShadowAmuletDealy takes unit u returns nothing
	local timer t = CreateTimer()
	local string s = ""
	if GetOwningPlayer(u)== LocalPlayer then
		set s = "Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayTarget.mdl"
	endif
	call DestroyEffect(AddSpecialEffectTarget(s, u, "chest"))
	call DestroyEffect(AddSpecialEffectTarget(s, u, "hand,left"))
	call DestroyEffect(AddSpecialEffectTarget(s, u, "hand,right"))
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call TimerStart(t, .01, false, function ShadowAmuletEffectAdd)
	set t = null
endfunction
function Item_SpellEffect_ShadowAmulet takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit target = GetSpellTargetUnit()
	local integer h = GetHandleId(target)
	if target == null and GetSpellTargetItem()!= null then
		set target = u
		set h = GetHandleId(target)
	endif
	if target != null then
		if LoadBoolean(HY, h,'A2N5')== false then
			call SaveBoolean(HY, h,'A2N5', true)
			call ShadowAmuletDealy(target)
		endif
	endif
	set target = null
	set u = null
endfunction
function QHA takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitAlly(GetFilterUnit(), GetOwningPlayer(U2)) and UnitIsDead(GetFilterUnit())== false and LoadInteger(HY, GetHandleId(GetFilterUnit()),'CRMS')!= 1)!= null
endfunction
function QJA takes nothing returns nothing
	call EPX(GetEnumUnit(),'CRMS', 70)
	call CNX(GetEnumUnit(),'A42N', 1, 10,'B0HG')
endfunction
function GOE takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local group g = LoginGroup(487)
	set U2 = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 900 + 25, Condition(function QHA))
	call ForGroup(g, function QJA)
	call LogoutGroup(g)
	set u = CreateUnit(GetOwningPlayer(u),'e00E', GetUnitX(u), GetUnitY(u), 0)
	call UnitAddAbility(u,'AIda')
	call IssueImmediateOrderById(u,$D012D)
	call EnableEffectByTime(EFFECT_KEY_CRIMSON_GUARD, 10)
	set g = null
	set u = null
endfunction

function GAE takes nothing returns nothing
	if GetSpellTargetItem()!= null then
		call SetUnitState(GetTriggerUnit(), UNIT_STATE_MANA, GetUnitState(GetTriggerUnit(), UNIT_STATE_MANA)+$96)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\MoonWell\\MoonWellCasterArt.mdx", GetTriggerUnit(), "origin"))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", GetTriggerUnit(), "origin"))
	else
		call SetUnitState(GetSpellTargetUnit(), UNIT_STATE_MANA, GetUnitState(GetSpellTargetUnit(), UNIT_STATE_MANA)+$96)
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\MoonWell\\MoonWellCasterArt.mdx", GetSpellTargetUnit(), "origin"))
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", GetSpellTargetUnit(), "origin"))
	endif
endfunction
function QLA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetTriggerEventId()== EVENT_WIDGET_DEATH then
		call UnitRemoveAbility(u,'A38X')
		call UnitRemoveAbility(u,'A3G1')
		call UnitRemoveAbility(u,'B3G1')
		//call ModifyUnitMagicResistance(u)
		call ReduceUnitMagicResistance(u, 0.45)
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	elseif GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		if GetGameTime()>= LoadReal(HY, h, 1) then
			call UnitRemoveAbility(u,'A38X')
			call UnitRemoveAbility(u,'A3G1')
			call UnitRemoveAbility(u,'B3G1')
			call ReduceUnitMagicResistance(u, 0.45)
			//call ModifyUnitMagicResistance(u)
			call FlushChildHashtable(HY, h)
			call DestroyTrigger(t)
		elseif GetGameTime()>= LoadReal(HY, h, 0) then
			if GetUnitAbilityLevel(u, 'B3G1') <= 0 then
				call UnitAddPermanentAbility(u,'A3G1')
				call AddUnitMagicResistance(u, 0.45)
			endif
		endif
	else
		if(GetTriggerEventId()== EVENT_PLAYER_UNIT_ATTACKED and u == GetAttacker()) or GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT then
			call SaveReal(HY, h, 0, GetGameTime()+ .4)
			if GetUnitAbilityLevel(u, 'B3G1') > 0 then
				call UnitRemoveAbility(u,'A3G1')
				call UnitRemoveAbility(u,'B3G1')
				call ReduceUnitMagicResistance(u, 0.45)
			endif
			//call ModifyUnitMagicResistance(u)
		endif
	endif
	set t = null
	set u = null
	return false
endfunction
function QMA takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterDeathEvent(t, u)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerRegisterTimerEvent(t, .1, true)
	call L6X(u)
	call UnitAddPermanentAbility(u,'A38X')
	call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Invisibility\\InvisibilityTarget.mdl", u, "origin"))
	call TriggerAddCondition(t, Condition(function QLA))
	call SaveUnitHandle(HY, h, 0, u)
	call SaveReal(HY, h, 1, GetGameTime()+ 5.)
	call SaveReal(HY, h, 0, GetGameTime()+ .4)
	set t = null
endfunction
function GNE takes nothing returns nothing
	local unit WLE
	if GetSpellTargetItem()!= null then
		set WLE = GetTriggerUnit()
	else
		set WLE = GetSpellTargetUnit()
	endif
	call QMA(WLE)
	set WLE = null
endfunction
function QPA takes nothing returns boolean
	return IsUnitAlly(GetFilterUnit(), GetOwningPlayer(U2)) and IsAliveNotStrucNotWard(GetFilterUnit())
endfunction
function GDE takes nothing returns nothing
	local group g = LoginGroup(488)
	local unit u
	call RemoveUnitBuff(GetTriggerUnit(), false)
	set U2 = GetTriggerUnit()
	call GroupEnumUnitsInRange(g, GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 775, Condition(function QPA))
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		if LoadInteger(HY, GetHandleId(u), 4258)!= 1 then
			if IsUnitType(u, UNIT_TYPE_HERO) then
				call EPX(u, 4258, 25)
			endif
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIre\\AIreTarget.mdl", u, "origin"))
			call DestroyEffect(AddSpecialEffectTarget("Unleash.mdx", u, "chest"))
			call SetWidgetLife(u, GetWidgetLife(u)+$FA)
		endif
		if GetUnitState(u, UNIT_STATE_MANA)< GetUnitState(u, UNIT_STATE_MAX_MANA) then
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", u, "origin"))
			call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+$A0)
		endif
		call GroupRemoveUnit(g, u)
	endloop
	call LogoutGroup(g)
endfunction

function GBE takes nothing returns nothing
	local unit WLE
	if GetSpellTargetItem()!= null then
		set WLE = GetTriggerUnit()
	else
		set WLE = GetSpellTargetUnit()
	endif
	call AddAbilityToTimed(WLE,'A3E9', 1, 5.,'B3E9')
	call RemoveUnitBuff(WLE, false)
	set WLE = null
endfunction
function QSA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WJE = LoadUnitHandle(HY, h, 0)
	local unit QTA = LoadUnitHandle(HY, h, 1)
	local unit d
	if GetTriggerEventId()== EVENT_UNIT_SPELL_ENDCAST then
		set d = CreateUnit(GetOwningPlayer(WJE),'e00E', GetUnitX(WJE), GetUnitY(WJE), 0)
		call UnitAddAbility(d,'A33T')
		call SetUnitAbilityLevel(d,'A33T', GetUnitAbilityLevel(QTA,'A33O'))
		call IssueTargetOrderById(d,$D0269, WJE)
		set d = null
	endif
	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(t)
	set t = null
	set WJE = null
	set QTA = null
endfunction
function QUA takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and UnitIsDead(GetFilterUnit())== false and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit())) and GetUnitAbilityLevel(GetFilterUnit(),'A33O')> 0)!= null
endfunction
function QWA takes unit WJE, integer T0V returns nothing
	local trigger t
	local integer h
	local group g
	local unit QTA
	if OER(T0V)== false then
		return
	endif
	set t = CreateTrigger()
	set h = GetHandleId(t)
	set g = LoginGroup(489)
	call GroupEnumUnitsInRange(g, GetUnitX(WJE), GetUnitY(WJE), 800, Condition(function QUA))
	set QTA = FirstOfGroup(g)
	call LogoutGroup(g)
	set g = null
	call TriggerRegisterTimerEvent(t, 10, false)
	call TriggerRegisterUnitEvent(t, WJE, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function QSA))
	call SaveUnitHandle(HY, h, 0, WJE)
	call SaveUnitHandle(HY, h, 1, QTA)
	set QTA = null
	set t = null
endfunction
function F_E takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local unit d = CreateUnit(GetOwningPlayer(u),'e00E', x, y, 0)
	local group g = LoginGroup(490)
	local unit u2
	call UnitAddAbility(d,'A1GG')
	if GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetTriggerPlayer())],'A0A8')> 0 then
		call SetUnitAbilityLevel(d,'A1GG', GetUnitAbilityLevel(Player__Hero[GetPlayerId(GetTriggerPlayer())],'A0A8'))
	endif
	set U2 = u
	call GroupEnumUnitsInRange(g, x, y, 300, Condition(function IsEnemyAliveNotStrucNotWardNotInvulnerable))
	loop
		set u2 = FirstOfGroup(g)
	exitwhen u2 == null
		call IssueTargetOrderById(d,$D02BC, u2)
		call GroupRemoveUnit(g, u2)
	endloop
	call LogoutGroup(g)
	call KillUnit(u)
	call SetUnitAnimation(u, "death")
	call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UndeadLargeDeathExplode\\UndeadLargeDeathExplode.mdl", x, y))
	set u = null
	set d = null
	set g = null
endfunction
function UrnaSwarmInfest takes nothing returns boolean
	if GetSpellAbilityId()=='A1HH' then
		call F_E()
	endif
	return false
endfunction
function Q1A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local integer level = LoadInteger(HY, h, 0)
	local unit Q2A = LoadUnitHandle(HY, h, 0)
	local unit WLE = LoadUnitHandle(HY, h, 1)
	if GetUnitAbilityLevel(WLE,'Bpoi')+ GetUnitAbilityLevel(WLE,'Bpsd')== 0 then
		call RemoveSavedHandle(P, GetHandleId(WLE),'Pois')
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
	else
		call UnitDamageTargetEx(Q2A, WLE, 11, 6 * level * .75)
	endif
	set Q2A = null
	set WLE = null
	set t = null
endfunction
function PoisonStingActions takes unit R8X, unit WLE returns nothing
	local timer t
	local integer h
	local integer hu = GetHandleId(WLE)
	if HaveSavedHandle(P, hu,'Pois') then
		set t = LoadTimerHandle(P, hu,'Pois')
		set h = GetHandleId(t)
	else
		set t = CreateTimer()
		set h = GetHandleId(t)
		call TimerStart(t, 1, true, function Q1A)
		call SaveUnitHandle(HY, h, 0, R8X)
		call SaveUnitHandle(HY, h, 1, WLE)
		call SaveTimerHandle(P, hu,'Pois', t)
	endif
	call SaveInteger(HY, h, 0, GetUnitAbilityLevel(R8X,'P418'))
	set t = null
endfunction

function CustomUnitBountyAllyFilter takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitAlly(GetFilterUnit(), GetOwningPlayer(SB)) and UnitIsDead(GetFilterUnit())== false and R5X(GetFilterUnit())== false)!= null
endfunction
function CustomUnitBountyEnemyFilter takes nothing returns boolean
	return(IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) and IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(SB)) and UnitIsDead(GetFilterUnit())== false and R5X(GetFilterUnit())== false)!= null
endfunction
function Q6A takes unit SYX, unit Q7A returns nothing
	local integer i = 0
	local integer Y_E = 0
	local integer xp = 0
	local group g = null
	local group gg = null
	local integer UYX = 0
	local boolean b = false
	local integer Q8A = 0
	local integer Q9A = 0
	local player p
	if IsUnitType(Q7A, UNIT_TYPE_HERO) or IsUnitIllusion(Q7A) or SYX == null then
		set Q7A = null
		set SYX = null
		return
	endif
	set b = IsUnitAlly(SYX, GetOwningPlayer(Q7A))
	if b then
		set i = GetUnitTypeId(Q7A)
		if YB then
			set xp = 0
		else
			set xp = LoadInteger(M, i, HC)/ 2
		endif
		if xp > 0 then
			set SB = SYX
			call UDX()
			if(FirstOfGroup(IV)!= null) then
				set WB = R2I(xp / CountUnitsInGroup(IV))
				call ForGroup(IV, function Y3X)
			endif
			set SB = null
		endif
	endif
	if b == false or YB then
		set i = GetUnitTypeId(Q7A)
		set p = GetOwningPlayer(SYX)
		if(YB == false) and(p != Sentinels[0]and p != Scourges[0]and p != BW) then
			if GetUnitAbilityLevel(SYX,'Aloc')== 1 then
				set SYX = Player__Hero[GetPlayerId(p)]
			endif
			set Q9A = GetUnitAbilityLevel(SYX,'P155')
			if Q9A > 0 and GetUnitAbilityLevel(SYX,'A36D')== 0 then
				set UYX = GetHandleId(SYX)
				if IsUnitType(Q7A, UNIT_TYPE_STRUCTURE)== false and(GetUnitAbilityLevel(Q7A,'A04R')== 0) then
					set Q8A = IMinBJ(LoadInteger(P, UYX,'A0O3')* 2 + Q9A * 2 + 2, 8 * Q9A)
					call SaveInteger(P, GetHandleId(p),'A0O3', LoadInteger(P, GetHandleId(p),'A0O3')+ Q8A)
					call DestroyEffect(AddSpecialEffect("war3mapImported\\GoblinCoin.mdx", GetUnitX(Q7A), GetUnitY(Q7A)))
				endif
			endif
			set Y_E = GetRandomInt(LoadInteger(M, i, CC), LoadInteger(M, i, DC))+ Q8A
			if Y_E > 0 then
				call BMX(p, Q7A, Y_E)
			endif
		endif
		set xp = LoadInteger(M, i, HC)
		if(xp > 0 and p != BW) then
			call Y4X(xp, p, SYX)
		endif
		set YB = false
	endif
	set g = null
	set gg = null
endfunction
function SVA takes nothing returns nothing
	if IsUnitType(DESourceUnit[DEI], UNIT_TYPE_HERO) or IsUnitType(DESourceUnit[DEI], UNIT_TYPE_STRUCTURE) or GetUnitAbilityLevel(DETargetUnit[DEI],'AZ00')== 1 then
		call KillUnit(DETargetUnit[DEI])
	else
		call UnitAddAbility(DETargetUnit[DEI],'AZ00')
	endif
endfunction
function ZombieAttack_DE takes nothing returns nothing
	if GetUnitTypeId(DETargetUnit[DEI])=='n0F5' then
		call SVA()
	endif
endfunction
function FamiliarsActions takes nothing returns nothing
	local real YJX = GetWidgetLife(DETargetUnit[DEI])
	local real ZCE =$9C4
	if IsUnitType(DESourceUnit[DEI], UNIT_TYPE_HERO) then
		set ZCE =$2710
	elseif IsUnitType(DESourceUnit[DEI], UNIT_TYPE_STRUCTURE) then
		set ZCE = 5000
	endif
	if YJX > ZCE + 100.5 then
		call SetWidgetLife(DETargetUnit[DEI], YJX -ZCE + GetEventDamage())
	else
		call UnitDamageTargetEx(DESourceUnit[DEI], DETargetUnit[DEI], 2,$98967F)
	endif
endfunction
function Familiars_DE takes nothing returns nothing
	if IsFamiliarsTypeId(GetUnitTypeId(DETargetUnit[DEI])) then
		call FamiliarsActions()
	endif
endfunction
// 毒性攻击
function PoisonAttack_DE takes nothing returns nothing	
	if GetUnitAbilityLevel(DESourceUnit[DEI],'A09V')> 0 and GetUnitAbilityLevel(DETargetUnit[DEI],'B06D')> 0 then
		call PoisonAttackActions(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
// 冰甲
function FrostArmor_DE takes nothing returns nothing	
	if GetUnitAbilityLevel(DETargetUnit[DEI],'B0H6')> 0 and not DESourceIsMelee[DEI] then
		call FrostArmorActions(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
/*function VampiricAura_DE takes nothing returns nothing	//吸血光环
	call P5I(DESourceUnit[DEI], DETargetUnit[DEI])
endfunction*/


function TranquilBootsActions takes unit WUE returns nothing
	local integer h = GetHandleId(WUE)
	call SaveReal(HY, h, 730, GetGameTime())
endfunction

function hyzrcd takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 1)
	call SaveInteger(HY, GetHandleId(u), 'echs', 0)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction

function hrzycd takes unit u returns nothing
	local timer t = CreateTimer()
	local real cool = 5

	call SaveInteger(HY, GetHandleId(u), 'echs', 1)
	call SaveUnitHandle(HY, GetHandleId(t), 1, u)
	if GetUnitAbilityLevel(u,'A39S') == 1 then
		set cool = cool * 0.75
	endif
	call YDWESetUnitAbilityState(u,'A3TY', 1, cool)
	call TimerStart(t, cool, false, function hyzrcd)
	set t = null
endfunction

function EchoSaber_Actions takes unit u , unit t returns nothing
	call UnitAddAbility(u,'A3TW')
	call hrzycd(u)
	if not IsUnitType(u, UNIT_TYPE_STRUCTURE) and not R_X(t) then
		call AddAbilityToTimed(t,'A3TX', 1, 0.8,'a3TX')
	endif
endfunction
// 回音战刃
function EchoSaber_DE takes nothing returns nothing
	if(GetUnitAbilityLevel(DESourceUnit[DEI],'A3TY')> 0) and LoadInteger(HY, DESourceId[DEI],'echs')== 0 and IsUnitType(DESourceUnit[DEI], UNIT_TYPE_MELEE_ATTACKER) and not DESourceIsIllusion[DEI] then
		call EchoSaber_Actions(DESourceUnit[DEI], DETargetUnit[DEI])
	elseif GetUnitAbilityLevel(DESourceUnit[DEI],'A3TW')> 0 then
		call UnitRemoveAbility(DESourceUnit[DEI],'A3TW')
	endif
endfunction
// 静谧之鞋
function TranquilBoots_DE takes nothing returns nothing	
	if IsUnitType(DETargetUnit[DEI], UNIT_TYPE_HERO) or IsBearUnit(DETargetUnit[DEI]) then
		call TranquilBootsActions(DETargetUnit[DEI])
	endif
endfunction
// 雷神之锤 漩涡
function ChainLightning_DE takes nothing returns nothing	
	if (GetUnitAbilityLevel(DESourceUnit[DEI],'A0JH')> 0 or GetUnitAbilityLevel(DESourceUnit[DEI],'A0FJ')> 0) then
		call ChainLightningActions(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
// 强化图腾 - 伤害事件
function EnchantTotem_DE takes nothing returns nothing
	if GetUnitAbilityLevel(DESourceUnit[DEI],'Broa')> 0 and DESourceIsMelee[DEI] then
		call UnitRemoveAbility(DESourceUnit[DEI],'Broa')
		//call ReduceAttackLaunchingTrigCount(DESourceUnit[DEI])
	endif
endfunction
// 强化图腾 - 弹道发射
function EnchantTotem_RL takes nothing returns nothing
	local integer h
	if GetUnitAbilityLevel(ARSourceUnit[ARI],'Broa')> 0 and not IsUnitType(ARSourceUnit[ARI], UNIT_TYPE_MELEE_ATTACKER) then
		call UnitRemoveAbilityToTimed(ARSourceUnit[ARI],'Broa', 0.)
		//call UnitRemoveAbility(ARSourceUnit[DEI],'Broa')
		//call ReduceAttackLaunchingTrigCount(ARSourceUnit[ARI])
	endif
endfunction

// 勇气之霎 - 开始攻击
function MomentOfCourage_AED takes nothing returns nothing
	call SaveBoolean(HY, AEAttackerId[AEI], 120, GetUnitAbilityLevel(AEAttackerUnit[AEI],'B0FJ')> 0)
	if GetUnitAbilityLevel(AEAttackerUnit[AEI],'B0FJ')> 0 then
		call SaveInteger(HY, AEAttackerId[AEI], 120, LoadInteger(HY, AEAttackerId[AEI], 120)+ 1)
	endif
endfunction
// 腐尸毒
function CausticFinale_DE takes nothing returns nothing
	if(GetUnitAbilityLevel(DESourceUnit[DEI],'A0FA')> 0) and not DESourceIsBreak[DEI] then
		if not IsUnitType(DESourceUnit[DEI], UNIT_TYPE_MELEE_ATTACKER) and GetRandomInt(0, 1)== 0 then
			return
		endif
		call CausticFinaleActions(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
// 高级黄点
function SuperAttributeBonus_DE takes nothing returns nothing
	if GetUnitAbilityLevel(DESourceUnit[DEI],'A43Z')> 0 and not DESourceIsBreak[DEI] then
		call SuperAttributeBonusActions(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
// 推进
function ImpetusDamageEvent takes nothing returns nothing
	if GetUnitAbilityLevel(DETargetUnit[DEI],'B03U')> 0 then
		call ImpetusActions(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
// 盛宴被攻击
function Feast_AE_Filter takes nothing returns boolean
	return AEIsEnemy[AEI] and(GetUnitAbilityLevel(AEAttackerUnit[AEI],'A0SS')> 0) and AETargetUnit[AEI] != RoShan and GetUnitTypeId(AETargetUnit[AEI])!='n0F5' and IsFamiliarsTypeId(GetUnitTypeId(AETargetUnit[AEI]))== false and not IsUnitBreak(AEAttackerUnit[AEI]) and IsUnitType(AETargetUnit[AEI], UNIT_TYPE_STRUCTURE)== false and GetUnitAbilityLevel(AETargetUnit[AEI],'A04R')== 0
endfunction
function Feast_AE takes nothing returns nothing
	if Feast_AE_Filter() then
		call FeastAddDamage(AEAttackerUnit[AEI], AETargetUnit[AEI], GetUnitAbilityLevel(AEAttackerUnit[AEI],'A0SS'))
	endif
endfunction
// 盛宴回血
function Feast_DE takes nothing returns nothing
	if FeastFilter() then
		call FeastActions(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
// 秘法天球
function ArcaneOrb_DE takes nothing returns nothing
	if GetUnitAbilityLevel(DETargetUnit[DEI],'B06Y')> 0 then
		call ArcaneOrbActions(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
// 智慧之刃
function GlaivesOfWisdom_DE takes nothing returns nothing
	if GetUnitAbilityLevel(DETargetUnit[DEI],'B05X')> 0 then
		call GlaivesOfWisdomActions(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
// 能量转移
function EssenceShift_DE takes nothing returns nothing
	if(GetUnitAbilityLevel(DESourceUnit[DEI],'A1HR')> 0) and IsUnitType(DETargetUnit[DEI], UNIT_TYPE_HERO) and not DESourceIsBreak[DEI] then
		call CMA(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
// 巨力重击
function GreaterBash_DE takes nothing returns nothing
	if(GetUnitAbilityLevel(DESourceUnit[DEI],'A0G5')> 0) and not DESourceIsBreak[DEI] then
		call GreaterBashActions(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
// 淬毒之珠
function OrbOfVenom_DE takes nothing returns nothing
	if GetUnitAbilityLevel(DESourceUnit[DEI],'A1V7') > 0 then
		call Q0A(DETargetUnit[DEI], DESourceUnit[DEI], IsUnitType(DESourceUnit[DEI], UNIT_TYPE_MELEE_ATTACKER))
	endif
endfunction
// 斯嘉蒂之眼
function EyeOfSkadiRecipe_DE takes nothing returns nothing	
	if GetUnitAbilityLevel(DESourceUnit[DEI],'A2KV')> 0 then
		call EyeOfSkadiActions(DETargetUnit[DEI], IsUnitType(DESourceUnit[DEI], UNIT_TYPE_MELEE_ATTACKER))
	endif
endfunction
// 散华
function SangeCrippleEffect_DE takes nothing returns nothing
	if ( GYX(DESourceUnit[DEI], RealItemTypeId[Item_Sange]) or GYX(DESourceUnit[DEI], RealItemTypeId[Item_SilverEdge]) or GYX(DESourceUnit[DEI], RealItemTypeId[Item_HeavenHalberd]) ) and GetPrdRandom(DESourceUnit[DEI],'A264', 20) then
		call AddAbilityToTimed(DETargetUnit[DEI],'A264', 1, 4,'B02I')
	endif
endfunction
// 散夜对剑
function GetSangeAndYashaCrippleEffect_DE takes nothing returns nothing
	if GYX(DESourceUnit[DEI], RealItemTypeId[Item_SangeAndYasha]) and GetPrdRandom(DESourceUnit[DEI],'A263', 16) then
		call AddAbilityToTimed(DETargetUnit[DEI],'A263', 1, 5,'B08N')
	endif
endfunction
function PoisonSting_DE takes nothing returns nothing
	if GetUnitAbilityLevel(DESourceUnit[DEI],'P418')> 0 and GetUnitAbilityLevel(DETargetUnit[DEI],'Bpsd')> 0 and IsAliveNotStrucNotWard(DETargetUnit[DEI]) and DEIsEnemy[DEI] and not DESourceIsBreak[DEI] then
		call PoisonStingActions(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
// 荒芜 
function Desolate_DE takes nothing returns nothing
	// 来源是英雄或幻象 目标不是建筑 不是守卫 不是肉山 技能冷却中 没有被破坏
	if ( DESourceIsHero[DEI] or DESourceIsIllusion[DEI] ) and not DETargetIsStructure[DEI] and not DETargetIsWard[DEI] and GetUnitAbilityLevel(DESourceUnit[DEI],'P338')> 0  and not DESourceIsBreak[DEI] and DETargetUnit[DEI] != RoShan then
		call DesolateActions(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
// 霜之哀伤
function Frostmourne_DE takes nothing returns nothing
	if not DESourceIsBreak[DEI] and(GetUnitAbilityLevel(DESourceUnit[DEI],'A0MG')> 0) then
		call FrostmourneActions(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
function SpiritBearAttack_DE takes nothing returns nothing
	if IsBearUnit(DESourceUnit[DEI]) and not DESourceIsIllusion[DEI] then
		call SpiritBearAttackActions(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
function BurningSpear_DE takes nothing returns nothing
	call UQR(DESourceUnit[DEI], DETargetUnit[DEI])
endfunction
function Geostrike_DE takes nothing returns nothing
	if(GetUnitAbilityLevel(DESourceUnit[DEI],'A0N7')> 0) and not DESourceIsBreak[DEI] then
		call QHI(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
function BurningSpear_AED takes nothing returns nothing
	call USR(AEAttackerUnit[AEI], AETargetUnit[AEI])
endfunction

function ArcticBurn_AED takes nothing returns nothing
	call ArcticBurnActions(DESourceUnit[DEI], DETargetUnit[DEI])
endfunction
function NatureGuise_AE takes nothing returns nothing
	call NatureGuiseAEActions(AEAttackerUnit[AEI])
endfunction
function Frostmourne_AE takes nothing returns nothing
	call FrostmourneAEActions(AEAttackerUnit[AEI], AETargetUnit[AEI])
endfunction

// 并列
function JuxtaposeDamageEvevt takes nothing returns nothing
	// 来源是攻击或幻象 目标不是建筑 不是守卫
	if ( DESourceIsHero[DEI] or DESourceIsIllusion[DEI] ) and not DETargetIsStructure[DEI] and not DETargetIsWard[DEI] then
		call JuxtaposeDEFilter()
	endif
endfunction
// 背刺
function Backstab_AE takes nothing returns nothing
	call BackstabActions(AEAttackerUnit[AEI], AETargetUnit[AEI])
endfunction
// 热血战魂
function Fervor_AE takes nothing returns nothing
	call N2I(AEAttackerUnit[AEI], AETargetUnit[AEI])
endfunction
// 反击螺旋
function CounterHelix_DE takes nothing returns nothing
	if IsHeroUnitId(DETargetTypeId[DEI]) and not DETargetIsBreak[DEI] and DEIsEnemy[DEI] and GetUnitAbilityLevel(DETargetUnit[DEI],'B03P')> 0 and ( not IsUnitType(DESourceUnit[DEI], UNIT_TYPE_STRUCTURE) and GetUnitAbilityLevel(DESourceUnit[DEI],'A04R')== 0 or IsFortDefenseTypeUnit(DESourceUnit[DEI]) ) then
		call CounterHelixActions(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
// 幽冥剧毒
function Nethertoxin_AED takes nothing returns nothing
	call NethertoxinActions(AEAttackerUnit[AEI], AETargetUnit[AEI])
endfunction
// 海妖外壳
function KrakenShell_DE takes nothing returns nothing
	call KrakenShellActions(AEAttackerUnit[AEI], AETargetUnit[AEI])
endfunction

// 反击 - 伤害事件
function CWReturn_DE takes nothing returns nothing
	if GetUnitAbilityLevel(DETargetUnit[DEI],'P123')> 0 and not R_X(DESourceUnit[DEI]) and GetUnitAbilityLevel(DESourceUnit[DEI],'A04R')== 0 and not DETargetIsBreak[DEI] then
		call CWReturnActions(DESourceUnit[DEI], DETargetUnit[DEI])
	endif
endfunction
// 活性护甲
function ReactiveArmor_DE takes nothing returns nothing
	call ReactiveArmorActions(DESourceUnit[DEI], DETargetUnit[DEI])
endfunction
function MomentOfCourage_AES takes nothing returns nothing
	if GetUnitAbilityLevel(AETargetUnit[AEI],'A2EY')> 0 and LoadInteger(HY, AETargetId[AEI], 4316) != 1 and AEIsEnemy[AEI] and not IsUnitBreak(AETargetUnit[AEI]) then
		call MomentOfCourage_AES_Actions()
	endif
endfunction
function FiendGrip_AE takes nothing returns nothing
	call F_I(AEAttackerUnit[AEI], AETargetUnit[AEI])
endfunction

globals
	integer ARI = 0
	unit array ARSourceUnit
	unit array ARTargetUnit
endglobals
// 单位攻击出手
function AttackReadyLaunching takes unit whichUnit, unit targetUnit returns nothing
	set ARI = ARI + 1
	set ARSourceUnit[ARI] = whichUnit
	set ARTargetUnit[ARI] = targetUnit
	call ExecuteAttackEvent(DE_ATTACK_READY_LAUNCHING)
	set ARI = ARI - 1
endfunction

function UnitAttackLaunchingFilter takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local unit whichUnit = LoadUnitHandle(HY, h, 1)
	local integer orederId
	local eventid triggerEventId = GetTriggerEventId()
	if triggerEventId == EVENT_GAME_TIMER_EXPIRED then
		//if GetUnitAbilityLevel(whichUnit, 'a3PQ') == 0 then
			call AttackReadyLaunching(whichUnit, LoadUnitHandle(HY, h, 2))
		//endif
		if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
			call DisableTrigger(trig)
			call PauseTimer(LoadTimerHandle(HY, h, 0))
		else
			// 非英雄单位就立即销毁触发器
			call RemoveSavedHandle(ExtraHT, GetHandleId(whichUnit), HTKEY_GET_ATTACK_READY_TRIGGER)
			call DestroyTimer(LoadTimerHandle(HY, h, 0))
			call FlushChildHashtable(HY, h)
			call CleanCurrentTrigger(trig)
		endif
	else
		set orederId = GetIssuedOrderId()
		// 是攻击特效 或者 攻击命令 但命令发布目标并不是之前的单位
		if triggerEventId == EVENT_UNIT_ISSUED_TARGET_ORDER and ( IsAttackSpecialEffectsId(orederId) or IsAttackOrdersId(orederId) ) and GetOrderTargetUnit() != LoadUnitHandle(HY, h, 2) then
			//call BJDebugMsg("非法操作，打断攻击")
			if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
				call DisableTrigger(trig)
				call PauseTimer(LoadTimerHandle(HY, h, 0))
			else
				// 非英雄单位就立即销毁触发器
				call RemoveSavedHandle(ExtraHT, GetHandleId(whichUnit), HTKEY_GET_ATTACK_READY_TRIGGER)
				call DestroyTimer(LoadTimerHandle(HY, h, 0))
				call FlushChildHashtable(HY, h)
				call CleanCurrentTrigger(trig)
			endif
			set h = GetHandleId(whichUnit)
			if HaveSavedInteger(ExtraHT, h, WIND_WALK_ATTACK_BUFF_ID) then
				call RemoveSavedReal(ExtraHT, h, WIND_WALK_ATTACK_DAMAGE)
				call RemoveSavedInteger(ExtraHT, h, WIND_WALK_ATTACK_BUFF_ID)
			endif
		elseif not IsONorOFFOrderId(orederId) or orederId < 1000000 then // <1000000代表正常命令 如果超出900000可能是学习技能
			if not ( triggerEventId == EVENT_UNIT_ISSUED_ORDER and ( orederId >= 852008 and orederId <= 852013) ) then
				//call BJDebugMsg("非法Id，打断攻击1") 
				if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
					call DisableTrigger(trig)
					call PauseTimer(LoadTimerHandle(HY, h, 0))
				else
					// 非英雄单位就立即销毁触发器
					call RemoveSavedHandle(ExtraHT, GetHandleId(whichUnit), HTKEY_GET_ATTACK_READY_TRIGGER)
					call DestroyTimer(LoadTimerHandle(HY, h, 0))
					call FlushChildHashtable(HY, h)
					call CleanCurrentTrigger(trig)
				endif
				set h = GetHandleId(whichUnit)
				if HaveSavedInteger(ExtraHT, h, WIND_WALK_ATTACK_BUFF_ID) then
					call RemoveSavedReal(ExtraHT, h, WIND_WALK_ATTACK_DAMAGE)
					call RemoveSavedInteger(ExtraHT, h, WIND_WALK_ATTACK_BUFF_ID)
				endif
			endif
		endif
	endif
	set triggerEventId = null
	set whichUnit = null
	set trig = null
	return false
endfunction

// 捕捉攻击出手
function GetUnitAttackLaunching takes unit whichUnit, unit targetUnit returns nothing
	local trigger trig = null
	local timer pointTimer = null
	local integer h = GetHandleId(whichUnit)
	local real attackSpeed = GetUnitAttackSpeed(whichUnit)
	local real damagePoint

	if HaveSavedHandle(ExtraHT, h, HTKEY_GET_ATTACK_READY_TRIGGER) then
		set trig = LoadTriggerHandle(ExtraHT, h, HTKEY_GET_ATTACK_READY_TRIGGER)
		set h = GetHandleId(trig)
		set pointTimer = LoadTimerHandle(HY, h, 0)
		call EnableTrigger(trig)
	else
		set trig = CreateTrigger()
		call SaveTriggerHandle(ExtraHT, h, HTKEY_GET_ATTACK_READY_TRIGGER, trig)
		set h = GetHandleId(trig)
		set pointTimer = CreateTimer()
		call SaveTimerHandle(HY, h, 0, pointTimer)
		call SaveUnitHandle(HY, h, 1, whichUnit)
		call TriggerAddCondition(trig, Condition( function UnitAttackLaunchingFilter ))
		call TriggerRegisterTimerExpireEvent(trig, pointTimer) // 计时器到期事件
		call TriggerRegisterUnitEvent(trig, whichUnit, EVENT_UNIT_ISSUED_TARGET_ORDER)
		call TriggerRegisterUnitEvent(trig, whichUnit, EVENT_UNIT_ISSUED_POINT_ORDER)
		call TriggerRegisterUnitEvent(trig, whichUnit, EVENT_UNIT_ISSUED_ORDER)
	endif
	call SaveUnitHandle(HY, h, 2, targetUnit)
	// 攻击速度
	set damagePoint = GetUnitDefaultDamagePoint1(whichUnit) / attackSpeed
	
	call TimerStart(pointTimer, damagePoint, false, null)
	set trig = null
	set pointTimer = null
endfunction

function SetUnitAttackMiss takes nothing returns nothing
	//call setmiss(DESourceUnit[DEI], DETargetUnit[DEI])
	local integer probability = 0
	local integer TYA = 0
	local unit d
	// 破隐一击结算
	/*if HaveSavedInteger(ExtraHT, AEAttackerId[AEI], WIND_WALK_ATTACK_BUFF_ID) then
		call RemoveSavedReal(ExtraHT, AEAttackerId[AEI], WIND_WALK_ATTACK_DAMAGE)
		call RemoveSavedInteger(ExtraHT, AEAttackerId[AEI], WIND_WALK_ATTACK_BUFF_ID)
	endif*/
	if UnitIsInWindWalk(AEAttackerUnit[AEI]) then
		call UnitWindWalkAttackAcionts(AEAttackerUnit[AEI], true)
		set IsDodgeAttack = false
		return
	endif
	// 有金箍棒
	if(IsEffectEnabled[17]and GetUnitAbilityLevel(AEAttackerUnit[AEI],'A1FO')== 1 and(not IsUnitType(AETargetUnit[AEI], UNIT_TYPE_STRUCTURE) or(GetOwningPlayer(AETargetUnit[AEI])!= Scourges[0]and GetOwningPlayer(AETargetUnit[AEI])!= Sentinels[0]))) or GetUnitAbilityLevel(AETargetUnit[AEI],'A3Q3')== 1 then
		call UnitRemoveAbility(AEAttackerUnit[AEI],'a3PQ')
		set IsDodgeAttack = false
		return
	endif
	// 大隐刀
	if(IsEffectEnabled[19]and GetUnitAbilityLevel(AEAttackerUnit[AEI],'B39C')== 1) then
		call UnitRemoveAbility(AEAttackerUnit[AEI],'a3PQ')
		set IsDodgeAttack = false
		return
	endif
	// 攻击者不是近战单位 和 飞行单位
	if not IsUnitType(AEAttackerUnit[AEI], UNIT_TYPE_MELEE_ATTACKER) and not IsUnitType(AEAttackerUnit[AEI], UNIT_TYPE_FLYING) then
		// 如果悬崖高就有 25% 几率丢失
		if GetTerrainCliffLevel(GetUnitX(AEAttackerUnit[AEI]), GetUnitY(AEAttackerUnit[AEI]))< GetTerrainCliffLevel(GetUnitX(AETargetUnit[AEI]), GetUnitY(AETargetUnit[AEI])) then
			set TYA = 25
		endif
	endif
	// 查各种丢失 风行者 磁场 和 醉拳百分百闪避
	if(IsEffectEnabled[0]and GetUnitAbilityLevel(AETargetUnit[AEI],'ACes')> 0) or(IsEffectEnabled[1]and LoadBoolean(ExtraHT, AETargetId[AEI], HTKEY_UNIT_DRUNKEN_BRAWLER_MS) and GetUnitAbilityLevel(AETargetUnit[AEI],'A36D')== 0) then

		set probability = 100
	else
		set probability = GetUnitMissProbability(AETargetUnit[AEI])
	endif
	// 醉拳
	if IsEffectEnabled[1]and LoadBoolean(ExtraHT, AETargetId[AEI], HTKEY_UNIT_DRUNKEN_BRAWLER_MS)  then
		if LoadBoolean(ExtraHT, AETargetId[AEI], HTKEY_UNIT_DRUNKEN_BRAWLER_MS) then
			call RemoveSavedBoolean(ExtraHT, AETargetId[AEI], HTKEY_UNIT_DRUNKEN_BRAWLER_MS)
		endif
		call SaveReal(ExtraHT, AETargetId[AEI], HTKEY_UNIT_DRUNKEN_BRAWLER_MS, GetGameTime())
	endif
	set TYA = UUE(TYA, GetUnitBlind(AEAttackerUnit[AEI]))
	if IsEffectEnabled[18]and GetUnitAbilityLevel(AETargetUnit[AEI],'B0F5')== 1 then
		set probability = R2I(probability * .6)
		set TYA = R2I(TYA * .6)
	endif
	if(probability > 0 or TYA > 0) and(GetRandomInt(1, 100)< probability or GetRandomInt(1, 100)< TYA) then
		set d = IYX(AEAttackerUnit[AEI])
		call SetUnitX(d, GetUnitX(AEAttackerUnit[AEI]))
		call SetUnitY(d, GetUnitY(AEAttackerUnit[AEI]))
		call UnitAddAbility(d,'A3PQ')
		if not IssueTargetOrderById(d, 852190, AEAttackerUnit[AEI]) then
			if GetUnitState(AEAttackerUnit[AEI], UNIT_STATE_TYPE) == 0 then
				call SetUnitState(AEAttackerUnit[AEI], UNIT_STATE_TYPE, 2) 
				call IssueTargetOrderById(d, 852190, AEAttackerUnit[AEI])
				call SetUnitState(AEAttackerUnit[AEI], UNIT_STATE_TYPE, 0) 
			endif
		endif
		call UnitRemoveAbility(d,'A3PQ')
		set d = null
		set IsDodgeAttack = true
	else
		call UnitRemoveAbility(AEAttackerUnit[AEI],'a3PQ')
		set IsDodgeAttack = false
	endif
endfunction

function SetUnitCriticalStrike takes unit attacker, boolean isMelee returns real

	local real value = 0.
	local real cs = 0.
	local integer id = 0
	local integer level = 0
	local boolean isHeroSource = IsUnitType(attacker, UNIT_TYPE_HERO) or IsBearUnit(attacker)
	local integer index = 0
	local integer inventorySize = 0
	local integer i = 0
	local item it = null
	// 致命一击结算流程

	// 同时触发取最高值, 海象挥击除外

	//===================================
	// 狼人(30, 35, 40) * (1.7)
	// 剑舞(20, 25, 30, 35) * (2.0) 
	// 醉拳(10, 15, 20, 25) * (2.0)
	// 头狼(20) * (2.0) - ACct

	// 致死打击(15) * (1.5, 2.0, 2.5, 3.0)
	// 混沌一击(15) * (1.5, 2.0, 2.5, 3.0)
	// 恩赐解脱(15) * (2.5, 3.5, 4.5)
	//===================================

	// 以上均计算破坏效果

	// 海象挥击(最高优先级/克敌机先) * (3.5)

	// 物品
	// 水晶剑/血棘(20) * (1.75)
	// 大炮(25) * (2.4)
	if isHeroSource then

		// 来源单位没有被破坏
		if not IsUnitBreak(attacker) then

			// 忍术
			if JinadaCount > 0 then
				set level = GetUnitAbilityLevel(attacker,'A1IQ')
				if level > 0 and YDWEGetUnitAbilityState(attacker, 'A1IQ', 1) == 0. then
					set cs = 1.25 + 0.25 * level
					if (value < cs) then
						set value = cs
						set id = 'A1IQ'
					endif
				endif
			endif

			// 剑舞
			set level = GetUnitAbilityLevel(attacker,'A00K')
			if level > 0 and GetPrdRandom(attacker, 'A00K', 15. + level * 5.) then
				set cs = 2.0
				if (value < cs) then
					set value = cs
					set id = 'A00K'
				endif
			endif

			// 狼人
			set level = LoadInteger(ExtraHT, AEAttackerId[AEI], 'QM02')
			if level > 0 and GetPrdRandom(attacker, 'QM02', 25. + level * 5.) then
				set cs = 1.7
				if (value < cs) then
					set value = cs
					set id = 'QM02'
				endif
			endif

			// 头狼
			set level = GetUnitAbilityLevel(attacker,'A1OX')
			if level > 0 and GetPrdRandom(attacker, 'A1OX', 20.) then
				set cs = 2.0
				if (value < cs) then
					set value = cs
					set id = 'A1OX'
				endif
			endif

			// 致死打击
			set level = GetUnitAbilityLevel(attacker,'A2S0')
			if level > 0 and GetPrdRandom(attacker, 'A2S0', 15) then
				set cs = 1.0 + level * 0.
				if (value < cs) then
					set value = cs
					set id = 'A2S0'
				endif
			endif

			// 恩赐解脱
			set level = GetUnitAbilityLevel(attacker,'A03Q')
			if level > 0 and GetPrdRandom(attacker, 'A03Q', 15) then
				set cs = 1.5 + level * 1.0
				if (value < cs) then
					set value = cs
					set id = 'A03Q'
				endif
			endif

			// 混沌一击
			set level = GetUnitAbilityLevel(attacker,'A03N')
			if level > 0 and GetPrdRandom(attacker, 'A03N', 15) then
				set cs = 1.0 + level * 0.5
				if (value < cs) then
					set value = cs
					set id = 'A03N'
				endif
			endif

		endif

		// 海象挥击 无视破坏效果 最高优先级
		if LoadBoolean(ExtraHT, AEAttackerId[AEI], 'BWPR') then
			set value = 3.5
			set id = 'BWPR'
		endif
	

	elseif not IsUnitBreak(attacker) then
		// 头狼和巨狼 20% 2
		set level = GetUnitAbilityLevel(attacker, 'ACct')
		if level > 0 and GetPrdRandom(attacker, 'ACct', 20) then
			set cs = 2.
			if (value < cs) then
				set value = cs
				set id = 'ACct'
			endif
		endif
		// 精灵狼 30% 1.7
		set level = GetUnitAbilityLevel(attacker, 'A03B')
		if level > 0 and GetPrdRandom(attacker, 'A03B', 30) then
			set cs = 1.7
			if (value < cs) then
				set value = cs
				set id = 'A03B'
			endif
		endif
	endif

	// 醉拳 如果被破坏效果作用, 那么必定暴击也不会触发
	set level = GetUnitAbilityLevel(attacker,'A0MX')
	if level > 0 then
		call SaveReal(ExtraHT, AEAttackerId[AEI], HTKEY_UNIT_DRUNKEN_BRAWLER_CS, GetGameTime())
		if LoadBoolean(ExtraHT, AEAttackerId[AEI], HTKEY_UNIT_DRUNKEN_BRAWLER_CS) or GetPrdRandom(attacker, 'A0MX', 5. + level * 5.) then
			set cs = 2.0
			if (value < cs) then
				set value = cs
				set id = 'A0MX'
			endif
			if LoadBoolean(ExtraHT, AEAttackerId[AEI], HTKEY_UNIT_DRUNKEN_BRAWLER_CS) then
				call DestroyEffect(LoadEffectHandle(ExtraHT, AEAttackerId[AEI], HTKEY_UNIT_DRUNKEN_BRAWLER_CS))
				call RemoveSavedHandle(ExtraHT, AEAttackerId[AEI], HTKEY_UNIT_DRUNKEN_BRAWLER_CS)
				call RemoveSavedBoolean(ExtraHT, AEAttackerId[AEI], HTKEY_UNIT_DRUNKEN_BRAWLER_CS)
			endif
		endif
	endif

	// 物品暴击 I8V AUV
	if isHeroSource and (ItemsCount[I8V] > 0 or ItemsCount[it_xj] > 0 or ItemsCount[AUV] > 0) then
		set inventorySize = UnitInventorySize(attacker)
		loop
		exitwhen i > inventorySize
			set it = UnitItemInSlot(attacker, i)
			if it != null then

				set index = GetItemIndex(it)

				if index == I8V and GetPrdRandom(attacker, 'I09C' + i, 20) then
					set cs = 1.75
					if (value < cs) then
						set value = cs
						set id = 'I09C'
					endif
				endif
				
				if index == it_xj and GetPrdRandom(attacker, 'I0VK' + i, 20) then
					set cs = 1.75
					if (value < cs) then
						set value = cs
						set id = 'I0VK'
					endif
				endif
					
				if index == AUV and GetPrdRandom(attacker, 'I0A3' + i, 25) then
					set cs = 2.1
					if (value < cs) then
						set value = cs
						set id = 'I0A3'
					endif
				endif
	
			endif
			set i = i + 1
		endloop
		set it = null
	endif

	// 暴击数值 > 0. 则播放暴击动画
	if value > 0. and isMelee then
		call SetUnitAnimation(attacker, "Attack slam") //播放暴击动画
		call QueueUnitAnimation(attacker, "Stand Ready") //不把Stand Ready加入队列的话 动作会很僵硬
	endif
	call SaveReal(ExtraHT, AEAttackerId[AEI], HTKEY_UNIT_CS_VALUE, value)
	call SaveInteger(ExtraHT, AEAttackerId[AEI], HTKEY_UNIT_CS_ID, id)

	return value
endfunction

globals
	integer                     AEI			= 0
	boolean			array 		AEIsEnemy
	unit 			array 		AEAttackerUnit				
	integer			array 		AEAttackerId		
	unit 			array 		AETargetUnit
	integer 		array 		AETargetId	
	boolean 		array 		AEIsAbility
endglobals

// 动态注册伤害事件
function AttackEventActions takes unit attackerUnit, unit targetUnit, boolean isAbility returns nothing
	set AEI = AEI + 1
	set AEAttackerUnit[AEI] = attackerUnit
	set AEAttackerId[AEI] = GetHandleId(attackerUnit)
	set AETargetUnit[AEI] = targetUnit
	set AETargetId[AEI] = GetHandleId(targetUnit)
	set AEIsAbility[AEI] = isAbility
	set AEIsEnemy[AEI] = IsUnitEnemy(AEAttackerUnit[AEI], GetOwningPlayer(AETargetUnit[AEI]))
	// 遍历 单位被攻击 事件 会第一时间运行闪避类
	call SetUnitAttackMiss()
	// 近战单位在攻击时出手时结算暴击, 远程单位在造成伤害时结算暴击
	if IsUnitType(AEAttackerUnit[AEI], UNIT_TYPE_MELEE_ATTACKER) and not IsUnitType(AETargetUnit[AEI], UNIT_TYPE_STRUCTURE) then
		call SetUnitCriticalStrike(AEAttackerUnit[AEI], true)
	endif

	call ExecuteAttackEvent(AE_ATTACKED)

	// 是玩家单位 或者 有吸血光环 则继续 否则返回
	if ( XFX(GetOwningPlayer(attackerUnit)) or XFX(GetOwningPlayer(targetUnit)) )  then

		// 允许单位开启攻击发动捕捉触发
		//call BJDebugMsg(I2S(LoadInteger(ExtraHT, AEAttackerId[AEI], HTKEY_ATTACK_LAUNCHING_COUNT)))
		if LoadInteger(ExtraHT, AEAttackerId[AEI], HTKEY_ATTACK_LAUNCHING_COUNT) > 0 then
			call GetUnitAttackLaunching(attackerUnit, targetUnit)
		endif

		if IsUnitType(attackerUnit, UNIT_TYPE_HERO) then
			call ExecuteAttackEvent(AE_END_ATTACKED)
		endif

	endif

	set AEI = AEI - 1
endfunction

// 塔防
function T2A takes nothing returns nothing
	local real ZCE = GetEventDamage()
	local player p = GetOwningPlayer(GetEventDamageSource())
	local unit u = GetTriggerUnit()
	if IsUnitEnemy(u, GetOwningPlayer(GetEventDamageSource())) then
		if GetUnitAbilityLevel(u,'A17R')== 1 then
			call SetUnitToReduceDamage(u, ZCE)
		else
			if IsUnitIllusion(GetEventDamageSource()) then
				call SetUnitToReduceDamage(u, .25 * ZCE)
				call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl", u, "origin"))
				set ZCE = ZCE * .75
			endif
			set LE[GetPlayerId(p)]= LE[GetPlayerId(p)]+ R2I(ZCE)
		endif
	endif
	set u = null
endfunction
function T3A takes nothing returns nothing
	set JO = CreateTrigger()
	call TriggerAddAction(JO, function T2A)
	/*call TriggerRegisterUnitEvent(JO, W5, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, Y5, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, Z5, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, V6, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, X6, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, O6, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, R6, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, I6, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, N6, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, B6, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, C6, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, D6, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, F6, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, G6, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, H6, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, J6, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, K6, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, U5, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, U7, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, W7, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, Y7, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, Z7, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, V8, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, E8, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, X8, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, O8, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, R8, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, I8, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, A8, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, N8, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, B8, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, C8, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, D8, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, F8, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, G8, EVENT_UNIT_DAMAGED)
	call TriggerRegisterUnitEvent(JO, T7, EVENT_UNIT_DAMAGED) */
endfunction

function SplitShot_A takes nothing returns nothing
	local unit u = U2
	local unit t = W2
	local integer h = GetHandleId(GetTriggeringTrigger())
	call UnitDamageTargetEx(u, t, 2, LoadReal(HY, h, 0))
	set u = null
	set t = null
endfunction
function SplitShot_EnumUnit takes nothing returns boolean
	return(IsUnitEnemy(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit()) and UnitVisibleToPlayer(GetFilterUnit(), GetOwningPlayer(U2)) ) != null
endfunction
function SplitShot takes unit u returns nothing
	local real r = GetUnitState(u, UNIT_STATE_ATTACK1_RANGE)+ 125
	local real d = (GetUnitState(u, UNIT_STATE_ATTACK1_DAMAGE_BASE) + GetUnitState(u, UNIT_STATE_ATTACK1_DAMAGE_BONUS) )* 0.8
	local group g = LoginGroup(491)
	local unit t
	local trigger trg
	local integer i = 0
	local integer h
	local integer maxi = GetUnitAbilityLevel(u,'A418') + 1
	set U2 = u
	call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), r, Condition(function SplitShot_EnumUnit))
	call GroupRemoveUnit(g, LoadUnitHandle(HY, GetHandleId(u),'A09J'))
	loop
		set t = GetNearestUnitByGroup(g, GetUnitX(u), GetUnitY(u))
	exitwhen t == null
		call GroupRemoveUnit(g, t)
		set trg = NHX(u, t,'h30C', "SplitShot_A", 900, true)
		set h = GetHandleId(trg)
		call SaveReal(HY, h, 0, d)
		set i = i + 1
	exitwhen i == maxi
	endloop
	call LogoutGroup(g)
	set t = null
	set trg = null
	set g = null
endfunction

function Learn__SplitShot takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local integer level = GetUnitAbilityLevel(u, 'A1C0') + GetUnitAbilityLevel(u, 'A418')
	local integer data = LoadInteger(ExtraHT, GetHandleId(u), 'A1C0')
	if data > 0 then
		call SaveInteger(ExtraHT, GetHandleId(u), 'A1C0', level)
	endif
	set u = null
endfunction

function ZNE takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call CameraClearNoiseForPlayer(LoadPlayerHandle(HY, h, 0) )
	call RemoveSavedHandle(K, GetHandleId(LoadPlayerHandle(HY, h, 0)),'CAMS')
	call FlushChildHashtable(HY, h)
	call PauseTimer(t)
	call DestroyTimer(t)
	set t = null
endfunction

function ZBE takes unit u, real ZCE returns nothing
	local timer t
	local integer h
	local player p = GetOwningPlayer(u)
	local integer hp = GetHandleId(p)
	local real ZDE = RMinBJ(ZCE, 1000)/ 100 
	if HaveSavedHandle(K, hp,'CAMS') then
		set t = LoadTimerHandle(K, hp,'CAMS')
		set h = GetHandleId(t)
		if LoadReal(HY, h, 0)< ZDE then
			call CameraClearNoiseForPlayer(p)
		endif
		call CameraSetEQNoiseForPlayer(p, ZDE)
	else
		set t = CreateTimer()
		call TimerStart(t, .3, false, function ZNE)
		set h = GetHandleId(t)
		call SavePlayerHandle(HY, h, 0, p)
		call SaveReal(HY, h, 0, ZDE)
		call CameraSetEQNoiseForPlayer(p, ZDE)
		call SaveTimerHandle(K, hp,'CAMS', t)
	endif
	set t = null
endfunction

//function MFO takes nothing returns boolean
	//call ExecuteFunc("SoulAssumptionDE")
	//call ExecuteFunc("ICO")
	//return false
//endfunction

//function MGO takes unit u returns nothing	//英雄单位挨打
//	local trigger t = CreateTrigger()
//	call SaveBoolean(HY, GetHandleId(u), 38, true)
//	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DAMAGED)
//	call TriggerAddCondition(t, Condition(function MFO))
//	set t = null
//endfunction
//function MHO takes nothing returns boolean
//	if not InHeroSelection and IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) and GetUnitTypeId(GetTriggerUnit())!='H0B8' and GetUnitTypeId(GetTriggerUnit())!='H00M' and GetUnitTypeId(GetTriggerUnit())!='H07G' and GetUnitTypeId(GetTriggerUnit())!='H00Y' and IsUnitIllusion(GetTriggerUnit())== false and HaveSavedBoolean(HY, GetHandleId(GetTriggerUnit()), 38)== false then
		//if(GetUnitTypeId(GetTriggerUnit())!='O00P') then
			// 注册英雄单位受伤
//			call MGO(GetTriggerUnit())
		//endif
//	endif
//	return false
//endfunction

// 镜头震动和伤害显示
function OtherDE takes unit damageTarget, unit damageSource, real rDamageValue returns nothing
	local texttag tt = null
	local string d = I2S(R2I(rDamageValue))
	local player t = GetOwningPlayer(damageTarget)
	local player a = GetOwningPlayer(damageSource)
	// 镜头震动
	if IsPlaying(t) and DETargetIsHero[DEI] and rDamageValue>= 5 and ZR[GetPlayerId(t)]then
		call ZBE(damageTarget, rDamageValue)
	endif
	if d == "0" or( not EnableMapSetUp__ShowDamageTextTag[GetPlayerId(t)] and not EnableMapSetUp__ShowDamageTextTag[GetPlayerId(a)]) then
		return
	endif
	set tt = CreateTextTag()
	call SetTextTagText(tt, d, 0.0276)
	// Local__TextTagzOffset
	call SetTextTagPosUnit(tt, damageTarget, Local__TextTagzOffset)
	set Local__TextTagzOffset = Local__TextTagzOffset + 20
	if Local__TextTagzOffset > 500 then
		set Local__TextTagzOffset = 0
	endif
    call SetTextTagVelocity(tt, 0, 0.006)
	call SetTextTagLifespan(tt, 3)
	call SetTextTagPermanent(tt, false)
	call SetTextTagFadepoint(tt, 2)
	call SetTextTagVisibility(tt, false)
	if EnableMapSetUp__ShowDamageTextTag[GetPlayerId(t)] and LocalPlayer == t then
		call SetTextTagColor(tt, 250, 0, 0, 255)
		call SetTextTagVisibility(tt, true)
	endif
	if EnableMapSetUp__ShowDamageTextTag[GetPlayerId(a)] and LocalPlayer == a and UnitVisibleToPlayer(damageTarget, a) then
		call SetTextTagColor(tt, 0, 0, 250, 255 )
		call SetTextTagVisibility(tt, true)
	endif
	set tt = null
	set t = null
	set a = null
endfunction

function SpellLifesteal takes nothing returns nothing
	if DETargetIsHero[DEI] then
		call SetWidgetLife(DESourceUnit[DEI], DEDamageValue[DEI] * .25 + GetWidgetLife(DESourceUnit[DEI]))
	else
		call SetWidgetLife(DESourceUnit[DEI], DEDamageValue[DEI] * .05 + GetWidgetLife(DESourceUnit[DEI]))
	endif
	call DestroyEffect(AddSpecialEffectTarget("SpellFizzle.mdx", DESourceUnit[DEI], "overhead"))
endfunction

// 获取英雄的减伤值
function GerHeroReducedDamage takes nothing returns real
	local real rReducedDamage = .0
	// 树甲
	if GetUnitAbilityLevel(DETargetUnit[DEI],'A3KF') == 1 then
		set MC = RMinBJ(OII(), DEDamageValue[DEI])
		if MC > 0 then
			set rReducedDamage = rReducedDamage + MC
			// set DEDamageValue[DEI] = DEDamageValue[DEI] - MC
		endif
	endif
	// 其实这一块应该是末端伤害减免 互相独立计算



        // 不是完全减免的
	return RMinBJ( rReducedDamage, DEDamageValue[DEI] )
endfunction

// 设置助攻
function SetAssistList takes nothing returns nothing
	set AssistTime[AssistListCurrentMaxNumber]= (GetGameTime())
	set EYV[AssistListCurrentMaxNumber] = GetPlayerId(DESourcePlayer[DEI])
	set EZV[AssistListCurrentMaxNumber] = GetPlayerId(DETargetPlayer[DEI])
	set AssistListCurrentMaxNumber = AssistListCurrentMaxNumber + 1
	if AssistListCurrentMaxNumber == 8000 then
		set AssistListCurrentMaxNumber = 1
	endif
endfunction

// 学习 1 级技能 - 灵魂超度
function LearnLevel1Skill_SoulAssumption takes nothing returns nothing
	// 因为 有 2 个事件可能触发， 升级事件和 学习事件 所以用TriggerUnit
	local unit whichUnit = GetTriggerUnit()
	local integer h = GetHandleId(whichUnit)
	local texttag tt = CreateTextTag()
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .05, true)
	call TriggerAddCondition(t, Condition(function AZA))
	call SaveUnitHandle(HY,(GetHandleId(t)), 2,(whichUnit))
	// 灵魂超度 漂浮文字
	call SetTextTagText(tt, " ", .023)
	call SetTextTagPosUnit(tt, whichUnit, 0)
	call SetTextTagVisibility(tt, GetOwningPlayer(whichUnit) == LocalPlayer)
	call SetTextTagPermanent(tt, true)
	call SaveTextTagHandle(HY, h, 451,(tt))
	set MZV[GetPlayerId(GetOwningPlayer(whichUnit))] = whichUnit
	call SaveReal(HY, h, 443,(0 * 1.))

	call AWA(whichUnit, 0)

	set whichUnit = null
	set t = null
	set tt = null
endfunction
function A3A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit WUE =(LoadUnitHandle(HY, h, 2))
	local real IXX =(LoadReal(HY, h, 20))
	if GetTriggerEventId()!= EVENT_UNIT_SPELL_EFFECT or(GetTriggerEventId()== EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A1NA') then
		if GetTriggerEventId()!= EVENT_UNIT_SPELL_EFFECT then
			call SaveReal(HY,(GetHandleId(WUE)), 443,(((LoadReal(HY,(GetHandleId(WUE)), 443))-IXX)* 1.))
		endif
		call AWA(WUE,(LoadReal(HY,(GetHandleId(WUE)), 443)))
		call FlushChildHashtable(HY, h)
		call CleanCurrentTrigger(t)
	endif
	set t = null
	set WUE = null
	return false
endfunction
// 灵魂超度
function A4A takes unit visageUnit returns nothing
	local integer level = GetUnitAbilityLevel(visageUnit,'A1NA')
	local real A7A =(LoadReal(HY,(GetHandleId(visageUnit)), 443))
	local trigger t
	local integer h
	if IsEffectiveDamage(DEDamageValue[DEI]) and ( XFX( Player( GetPlayerId(DESourcePlayer[DEI]) ) ) or DESourceUnit[DEI] == RoShan ) then
		set A7A = A7A + DEDamageValue[DEI]
		call SaveReal(HY,(GetHandleId(visageUnit)), 443,((A7A)* 1.))
		set t = CreateTrigger()
		set h = GetHandleId(t)
		call SaveUnitHandle(HY, h, 2,(visageUnit))
		call SaveReal(HY, h, 20,((DEDamageValue[DEI])* 1.))
		call TriggerRegisterTimerEvent(t, 6, false)
		call TriggerRegisterDeathEvent(t, visageUnit)
		call TriggerRegisterUnitEvent(t, visageUnit, EVENT_UNIT_SPELL_EFFECT)
		call TriggerAddCondition(t, Condition(function A3A))
		call AWA(visageUnit, A7A)
	endif
	set t = null
endfunction

function SoulAssumptionDE takes nothing returns nothing
	local integer i = 1
	loop
		if MZV[i] != null and IsUnitInRange(MZV[i], DETargetUnit[DEI], 1400) then
			call A4A(MZV[i])
		endif
		exitwhen i == 12
		set i = i + 1
	endloop
endfunction

function CommonDamageBlock takes nothing returns nothing
	local integer index = 0
	local integer i = 0
	local integer inventorySize = 0
	local item it = null
	local real value = 0.
	// 传统格挡 物理伤害格挡，可格挡物理攻击、分裂、溅射、反弹伤害，仅最高者生效
	// 海妖外壳已经不再是伤害格挡 而是伤害减少
	// 伪随机
	if IsEffectEnabled[EFFECT_KEY_CRIMSON_GUARD] and GetUnitAbilityLevel(DETargetUnit[DEI], 'B0HG') > 0 then
		set value = 55
	endif
	
	if ItemsCount[Vanguard_ranged] > 0 or ItemsCount[Vanguard_melee] > 0 or ItemsCount[StoutShield_ranged] > 0 or ItemsCount[StoutShield_melee] > 0 then
		set inventorySize = UnitInventorySize(DETargetUnit[DEI])
		loop
		exitwhen i > inventorySize
			set it = UnitItemInSlot(DETargetUnit[DEI], i)
			if it != null then

				set index = GetItemTypeId(it)
				if (index == RealItemTypeId[Vanguard_ranged] or index == RealItemTypeId[Vanguard_melee]) and GetPrdRandom(DETargetUnit[DEI], 'I0BA' + i, 75.) then  
					if index == Vanguard_melee then
						set value = RMaxBJ(value, 40)
					else
						set value = RMaxBJ(value, 20)
					endif
					//call BJDebugMsg("VanguardCount " + I2S(VanguardCount))
				endif
				
				if (index == RealItemTypeId[StoutShield_ranged] or index == RealItemTypeId[StoutShield_melee]) and GetPrdRandom(DETargetUnit[DEI], 'I051' + i, 50.) then
					if index == Vanguard_melee then
						set value = RMaxBJ(value, 16)
					else
						set value = RMaxBJ(value, 8)
					endif
					//call BJDebugMsg("StoutShieldCount " + I2S(StoutShieldCount))
				endif
				
			endif
			set i = i + 1
		endloop
		set it = null

	endif

	if value > 0. then
		set DEDamageValue[DEI] = DEDamageValue[DEI] - value
		//call BJDebugMsg("格挡伤害 " + R2S(value))
	endif

endfunction


// 敌对 存活 非建筑 非守卫 非无敌
function CleaveEnumUnitCondition takes unit whichUnit returns boolean
	return IsAliveNotStrucNotWardNotInvulnerable(whichUnit)
endfunction

function SplitShotActions takes nothing returns nothing
	local group g = LoginGroup(558)
	local unit firstUnit = null
	local real x = GetUnitX(ARSourceUnit[ARI])
	local real y = GetUnitY(ARSourceUnit[ARI])
	local real range = GetUnitState(ARSourceUnit[ARI], UNIT_STATE_ATTACK1_RANGE)
	local integer level = LoadInteger(ExtraHT, GetHandleId(ARSourceUnit[ARI]), 'A1C0')
	local real data = 0.8
	local real damage
	local player sourcePlayer = GetOwningPlayer(ARSourceUnit[ARI])
	local integer count = 1 + level 
	local missile m

	call GroupEnumUnitsInRange(g, x, y, range + MAX_UNIT_COLLISION, null)
	call GroupRemoveUnit(g, ARSourceUnit[ARI])
	call GroupRemoveUnit(g, ARTargetUnit[ARI])

	set EnumUnitMaximum = 0
	loop	
		set firstUnit = FirstOfGroup(g)
	exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)

		if IsUnitEnemy(firstUnit, sourcePlayer) and UnitVisibleToPlayer(firstUnit, sourcePlayer) and CleaveEnumUnitCondition(firstUnit) and IsUnitInRangeXY(firstUnit, x, y, range) then
	
			set EnumUnitMaximum = EnumUnitMaximum + 1
			set EnumUnits[EnumUnitMaximum] = firstUnit

		endif

	endloop

	call GroupAddEnumUnits(g)

	// 优先选取最近的单位
	loop	
		set firstUnit = GetNearestUnitByGroup(g, x, y)
	exitwhen count == 0 or firstUnit == null
		call GroupRemoveUnit(g, firstUnit)

		set damage = data * GetUnitState(ARSourceUnit[ARI], UNIT_STATE_ATTACK1_DAMAGE_BONUS) + GetUnitState(ARSourceUnit[ARI], UNIT_STATE_ATTACK1_DAMAGE_BASE) + GetUnitState(ARSourceUnit[ARI], UNIT_STATE_ATTACK1_DAMAGE_DICE) * GetRandomInt(1, R2I(GetUnitState(ARSourceUnit[ARI], UNIT_STATE_ATTACK1_DAMAGE_SIDE)) )
		set m = m.create(ARSourceUnit[ARI], firstUnit, 1200.)
		set m.missileFile = "Abilities\\Weapons\\NagaArrowMissile\\NagaArrowMissile.mdl"
		set m.damageValue = damage
		set m.damageType = 12
		set m.usePlayerColor = true
		//set m.arc = 0.08
		set m.startUnit = ARSourceUnit[ARI]
		call m.LaunchMissile()
	
		set count = count - 1

	endloop

	set firstUnit = null
	call LogoutGroup(g)
	set g = null
endfunction

function SplitShot_RL takes nothing returns nothing
	if LoadInteger(ExtraHT, GetHandleId(ARSourceUnit[ARI]), 'A1C0') > 0 then
		call SplitShotActions()
	endif
endfunction

function FlakCannonActions takes nothing returns nothing
	local group g = LoginGroup(558)
	local unit firstUnit = null
	local real x = GetUnitX(ARSourceUnit[ARI])
	local real y = GetUnitY(ARSourceUnit[ARI])
	local real range = 1000.
	local real damage = GetUnitState(ARSourceUnit[ARI], UNIT_STATE_ATTACK1_DAMAGE_BASE) + GetUnitState(ARSourceUnit[ARI], UNIT_STATE_ATTACK1_DAMAGE_BONUS)
	local player sourcePlayer = GetOwningPlayer(ARSourceUnit[ARI])
	local missile m

	call GroupEnumUnitsInRange(g, x, y, range + MAX_UNIT_COLLISION, null)
	call GroupRemoveUnit(g, ARSourceUnit[ARI])
	call GroupRemoveUnit(g, ARTargetUnit[ARI])

	set EnumUnitMaximum = 0
	loop	
		set firstUnit = FirstOfGroup(g)
	exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)

		if IsUnitEnemy(firstUnit, sourcePlayer) and UnitVisibleToPlayer(firstUnit, sourcePlayer) and CleaveEnumUnitCondition(firstUnit) and IsUnitInRangeXY(firstUnit, x, y, range) then
	
			set m = m.create(ARSourceUnit[ARI], firstUnit, 800.)
			set m.missileFile = "Abilities\\Weapons\\RocketMissile\\RocketMissile.mdl"
			set m.damageValue = damage
			set m.damageType = 12
			set m.usePlayerColor = true
			//set m.arc = 0.08
			set m.startUnit = ARSourceUnit[ARI]
			call m.LaunchMissile()

		endif

	endloop

	set firstUnit = null
	call LogoutGroup(g)
	set g = null

endfunction

function FlakCannon_RL takes nothing returns nothing
	local integer count = LoadInteger(ExtraHT, GetHandleId(ARSourceUnit[ARI]), 'A229')
	if count > 0 then
		call FlakCannonActions()
		call SaveInteger(ExtraHT, GetHandleId(ARSourceUnit[ARI]), 'A229', count - 1)
		if count == 1 then
			call TriggerEvaluate(LoadTriggerHandle(ExtraHT, GetHandleId(ARSourceUnit[ARI]), 'A229'))
		endif
	endif
endfunction

function UnitCleave takes unit sourceUnit, unit targetUnit, real range, real value, string effPath, string attachPointName returns nothing
	local group g = LoginGroup(556)
	local unit firstUnit = null
	local real radian
	local real x
	local real y

	if DEDummyAttack[DEI] then
		set x = GetUnitX(DEDummyUnit[DEI])
		set y = GetUnitY(DEDummyUnit[DEI])
	else
		set x = GetUnitX(sourceUnit)
		set y = GetUnitY(sourceUnit)
	endif

	set radian = RadianBetweenUnit(sourceUnit, targetUnit)
	set x = x + range * Cos(radian)
	set y = y + range * Sin(radian)

	call GroupEnumUnitsInRange(g, x, y, range + MAX_UNIT_COLLISION, null)
	call GroupRemoveUnit(g, targetUnit)
	call GroupRemoveUnit(g, sourceUnit)

	loop	
		set firstUnit = FirstOfGroup(g)
	exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)

		if IsUnitEnemy(firstUnit, DESourcePlayer[DEI]) and CleaveEnumUnitCondition(firstUnit) and IsUnitInRange(firstUnit, targetUnit, range) then
			call UnitDamageTargetEx(sourceUnit, firstUnit, 10, value)
			if effPath != null then
				call DestroyEffect(AddSpecialEffectTarget(effPath, firstUnit, attachPointName))
			endif
		endif

	endloop

	set firstUnit = null
	call LogoutGroup(g)
	set g = null
endfunction

function DragonAttackActions takes unit sourceUnit, unit targetUnit, real range, real value, integer level, boolean isIllusion returns nothing
	local group g = LoginGroup(556)
	local unit firstUnit = null
	local real x = GetUnitX(targetUnit)
	local real y = GetUnitY(targetUnit)

	call GroupEnumUnitsInRange(g, x, y, range + MAX_UNIT_COLLISION, null)
	call GroupRemoveUnit(g, targetUnit)
	call GroupRemoveUnit(g, sourceUnit)

	loop	
		set firstUnit = FirstOfGroup(g)
	exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)

		if IsUnitEnemy(firstUnit, DESourcePlayer[DEI]) and CleaveEnumUnitCondition(firstUnit) and IsUnitInRange(firstUnit, targetUnit, range) then
			if level == 3 then
				call FrostBreathActions(firstUnit)
			endif
			//call BJDebugMsg("溅射伤害"+ R2S(value))
			call CorrosiveBreath(sourceUnit, firstUnit, isIllusion)
			call UnitDamageTargetEx(sourceUnit, firstUnit, 12, value)
		endif
	endloop

	set firstUnit = null
	call LogoutGroup(g)
	set g = null
endfunction

function DragonSplashActions takes integer typeId returns nothing
	// 龙骑
	local boolean isSplash = typeId != 'H00F' 
	local integer level = 1
	if typeId == 'H00E' then
		set level = 2
	elseif typeId == 'H00G' then
		set level = 3
		call FrostBreathActions(DETargetUnit[DEI])
	endif
	call CorrosiveBreath(DESourceUnit[DEI], DETargetUnit[DEI], DESourceIsIllusion[DEI])
	if isSplash then
		call DragonAttackActions(DESourceUnit[DEI], DETargetUnit[DEI], 300, DEDamageValue[DEI], level, DESourceIsIllusion[DEI])
	endif
endfunction

// 蛇棒溅射
function UnitSplashAttackActions takes real range, real data returns nothing
	local group g = LoginGroup(557)
	local unit firstUnit = null
	local real x = GetUnitX(DETargetUnit[DEI])
	local real y = GetUnitY(DETargetUnit[DEI])
	local real damage = DEDamageValue[DEI] * data

	call GroupEnumUnitsInRange(g, x, y, range + MAX_UNIT_COLLISION, null)
	call GroupRemoveUnit(g, DETargetUnit[DEI])

	loop	
		set firstUnit = FirstOfGroup(g)
	exitwhen firstUnit == null
		call GroupRemoveUnit(g, firstUnit)

		if IsUnitEnemy(firstUnit, DESourcePlayer[DEI]) and CleaveEnumUnitCondition(firstUnit) and IsUnitInRange(firstUnit, DETargetUnit[DEI], range) then

			call UnitDamageTargetEx(DESourceUnit[DEI], firstUnit, 12, damage)

		endif

	endloop

	set firstUnit = null
	call LogoutGroup(g)
	set g = null
endfunction

function BattleFuryActions takes nothing returns nothing

	local integer itTypeId = 0
	local integer i = 0
	local integer inventorySize = 0
	local item it = null
	local string modelName = null
	local string attachPointName = null

	set inventorySize = UnitInventorySize(DESourceUnit[DEI])
	loop
	exitwhen i > inventorySize
		set it = UnitItemInSlot(DESourceUnit[DEI], i)
		if it != null then

			set itTypeId = GetItemTypeId(it)
			if itTypeId == RealItemTypeId[Item_BattleFury] then
				set modelName = "Abilities\\Spells\\Other\\Cleave\\CleaveDamageTarget.mdl"
				set attachPointName = "chest"
				call UnitCleave(DESourceUnit[DEI], DETargetUnit[DEI], 225, DEDamageValue[DEI] * 0.35, modelName, attachPointName)
			endif
			
		endif
		set i = i + 1
	endloop
	set it = null

endfunction

function CleaveActions takes nothing returns nothing
	local integer level = 0
	local string modelName = null
	local string attachPointName = null

	// 潮汐使者
	if HaveTidebringer and DESourceIsHero[DEI] and not DESourceIsBreak[DEI] and IsUnitTidebringerAvailable(DESourceUnit[DEI]) then
		set level = GetUnitAbilityLevel(DESourceUnit[DEI], 'A13T')
		if level > 0 then
			if not DETargetIsStructure[DEI] then
				set modelName = "Abilities\\Weapons\\WaterElementalMissile\\WaterElementalMissile.mdl"
				set attachPointName = "chest"
				if level == 4 then
					call UnitCleave(DESourceUnit[DEI], DETargetUnit[DEI], 600, DEDamageValue[DEI], modelName, attachPointName)
				else
					call UnitCleave(DESourceUnit[DEI], DETargetUnit[DEI], 500, DEDamageValue[DEI], modelName, attachPointName)
				endif
			endif
			call Tidebringer_Actions(DESourceUnit[DEI], DETargetUnit[DEI], DEDamageValue[DEI])
		endif	
	endif

	if not DETargetIsStructure[DEI] then

		if DESourceIsMelee[DEI] then
			// 授予力量
			if IsEffectEnabled[EFFECT_KEY_EMPOWER] and GetUnitAbilityLevel(DESourceUnit[DEI], 'B00U') > 0 then
				set level = LoadInteger(ExtraHT, HTKEY_UNIT_EMPOWER_LEVEL, DESourceId[DEI])
				set modelName = "Abilities\\Spells\\Other\\Cleave\\CleaveDamageTarget.mdl"
				set attachPointName = "chest"
				call UnitCleave(DESourceUnit[DEI], DETargetUnit[DEI], 250, DEDamageValue[DEI] * (0.1 + level * 0.1), modelName, attachPointName)
			endif

			if DESourceIsHero[DEI] then
			// 巨力挥舞
				if not DESourceIsBreak[DEI] then
					set level = GetUnitAbilityLevel(DESourceUnit[DEI], 'A01K')
					if level > 0 then
						set modelName = null
						set attachPointName = null
						call UnitCleave(DESourceUnit[DEI], DETargetUnit[DEI], 300, DEDamageValue[DEI] * (0.05 + level * 0.15), modelName, attachPointName)
					endif
				endif

				// A杖长大
				if HaveGrow and not DESourceIsBreak[DEI] and GetUnitAbilityLevel(DESourceUnit[DEI], 'A2KK') > 0 then
					set modelName = "Abilities\\Spells\\Other\\Cleave\\CleaveDamageTarget.mdl"
					set attachPointName = "chest"
					call UnitCleave(DESourceUnit[DEI], DETargetUnit[DEI], 400, DEDamageValue[DEI] * (0.5), modelName, attachPointName)
				endif

			
				// 狂战斧
				if ItemsCount[Item_BattleFury] > 0 and GetHandleItemCount(DESourceId[DEI], RealItemTypeId[Item_BattleFury])> 0 then

					call BattleFuryActions()
					
				endif

			endif

		endif

	endif
endfunction

function PhysicalLifestealActions takes nothing returns nothing
	local real r = GetUnitItemPhysicalLifesteal(DESourceUnit[DEI]) // 物品吸血
	local real level
	// 吸血光环
	if HaveVampiricAura then
		set level = GetUnitAbilityLevel(DESourceUnit[DEI],'BVA1')+ GetUnitAbilityLevel(DESourceUnit[DEI],'BVA2')* 2 + GetUnitAbilityLevel(DESourceUnit[DEI],'BVA3')* 3 + GetUnitAbilityLevel(DESourceUnit[DEI],'BVA4')* 4
		if level > 0 then
			set r = r + .1 + .05 * level
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl", DESourceUnit[DEI], "origin"))
		endif
	endif
	// 祭品吸血
	if HaveVladmirOffering and GetUnitAbilityLevel(DESourceUnit[DEI],'B3B5') > 0 then
		if DESourceIsMelee[DEI] then
			set r = r + 0.15
		else
			set r = r + 0.10
		endif
		call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl", DESourceUnit[DEI], "origin"))
	endif
	// 极度饥渴
	if IsEffectEnabled[EFFECT_KEY_INSATIABLE_HUNGER] and DESourceIsHero[DEI] and GetUnitAbilityLevel(DESourceUnit[DEI],'A340')> 0 then
		if DESourceIsMelee[DEI] then
			set r = r + GetUnitAbilityLevel(DESourceUnit[DEI],'A0WR')* .2 + .4
		else
			set r = r + GetUnitAbilityLevel(DESourceUnit[DEI],'A0WR')* .1 + .4
		endif
	endif
	// 勇气之霎
	if IsEffectEnabled[EFFECT_MOMENT_OF_COURAGE] then
		set level = GetUnitAbilityLevel(DESourceUnit[DEI], 'A2G7')
		if level > 0 then
			set r = r + .45 + .10 * level
			call UnitRemoveAbility(DESourceUnit[DEI], 'A2G7')
		endif
	endif
	if r != 0. and not DESourceIsIllusion[DEI] and not DETargetIsIllusion[DEI] then
		call UnitRestoreHealth(DESourceUnit[DEI], DEDamageValue[DEI] * r)
	endif
endfunction

function GravekeeperCloakAddCount takes nothing returns boolean
	local trigger trig = GetTriggeringTrigger()
	local integer h = GetHandleId(trig)
	local unit whichUnit = LoadUnitHandle(HY, h, 0)
	local integer count = LoadInteger(ExtraHT, GetHandleId(whichUnit), 'A0VX') + 1

	call SaveInteger(ExtraHT, GetHandleId(whichUnit), 'A0VX', count)

	call FlushChildHashtable(HY, h)
	call CleanCurrentTrigger(trig)
	set whichUnit = null
	set trig = null
	return false
	return false
endfunction

// 陵卫斗篷
function GravekeeperCloakReduceDamage takes integer count returns nothing
	local real data = 0.04 + 0.04 * GetUnitAbilityLevel(DETargetUnit[DEI], 'A0VX') // 每层的减伤值
	local integer h = CreateTimerEventTrigger(3., false, function GravekeeperCloakAddCount)
	call SaveUnitHandle(HY, h, 0, DETargetUnit[DEI])
	set DEDamageValue[DEI] = DEDamageValue[DEI] * ( 1 - count * data )
	call SaveInteger(ExtraHT, DETargetId[DEI], 'A0VX', count - 1)
endfunction
// 被动晕眩
function SetPassiveStun takes nothing returns nothing
	local real tempReal
	local integer probability
	local boolean isMeleeAttacker = IsUnitType(DESourceUnit[DEI], UNIT_TYPE_MELEE_ATTACKER)
	if GetUnitAbilityLevel(DESourceUnit[DEI],'A3L2')> 0 then	//碎颅锤and深渊之刃
		if isMeleeAttacker then
			set probability = 25
		else
			set probability = 10
		endif
		if LoadInteger(HY, DESourceId[DEI],'bash')!= 1 and GetPrdRandom(DESourceUnit[DEI],'A3L2', probability) then
			if GetUnitAbilityLevel(DESourceUnit[DEI],'A3TZ') == 1 then
				call YDWESetUnitAbilityState(DESourceUnit[DEI],'A3TZ', 1, 2.3)
			endif
			call EPX(DESourceUnit[DEI],'bash', 2.3)
			call CommonUnitAddStun(DETargetUnit[DEI], 1.4, true)
		endif
	elseif not DESourceIsBreak[DEI] then
		if GetUnitAbilityLevel(DESourceUnit[DEI],'A0JJ')> 0 then	//深海重击
			if isMeleeAttacker then
				set probability = 5 + 5 * GetUnitAbilityLevel(DESourceUnit[DEI],'A0JJ')
			else
				set probability = 5 * GetUnitAbilityLevel(DESourceUnit[DEI],'A0JJ')
			endif
			if GetPrdRandom(DESourceUnit[DEI],'A0JJ', probability) then
				set DEPhysicsDamage[DEI] = DEPhysicsDamage[DEI] + 40 + 20 * GetUnitAbilityLevel(DESourceUnit[DEI],'A0JJ')
				call CommonUnitAddStun(DETargetUnit[DEI], 1., true)
			endif
		elseif GetUnitAbilityLevel(DESourceUnit[DEI],'A081')> 0 then	//时间锁定
			if isMeleeAttacker then
				set tempReal = 5 + 5 * GetUnitAbilityLevel(DESourceUnit[DEI],'A081')
			else
				set tempReal = 5 * GetUnitAbilityLevel(DESourceUnit[DEI],'A081')
			endif
			if GetPrdRandom(DESourceUnit[DEI],'A081', tempReal) then
				set tempReal = 30 + 10 * GetUnitAbilityLevel(DESourceUnit[DEI],'A081')
				set DEMagicalDamage[DEI] = DEMagicalDamage[DEI] + tempReal
				call CommonUnitAddStun(DETargetUnit[DEI], 1., true)
				call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl", DETargetUnit[DEI], "chest"))
			endif
		elseif GetUnitAbilityLevel(DESourceUnit[DEI],'A09E')> 0 then	//狂战士之怒
			if GetPrdRandom(DESourceUnit[DEI],'A09E', 10) then
				set tempReal = 10 + 10 * GetUnitAbilityLevel(DESourceUnit[DEI],'A09E')
				set DEMagicalDamage[DEI] = DEMagicalDamage[DEI] + tempReal
				call CommonUnitAddStun(DETargetUnit[DEI], .4 + .4 * GetUnitAbilityLevel(DESourceUnit[DEI],'A09E'), true)
			endif
		elseif GetUnitAbilityLevel(DESourceUnit[DEI],'A340')> 0 then	//极度饥渴
			if isMeleeAttacker then
				set probability = 20
			else
				set probability = 10
			endif
			if GetPrdRandom(DESourceUnit[DEI],'A340', probability) then
				call CommonUnitAddStun(DETargetUnit[DEI], 1., true)
			endif
		endif
	endif
endfunction

// 
function IMO takes nothing returns nothing

endfunction

// 标枪和金箍棒 魔法攻击特效
function PierceActions takes nothing returns nothing
	local integer max = UnitInventorySize(DESourceUnit[DEI])
	local integer x = 0
	local item it
	local integer id
	local boolean isMonkeyKingBar = false
	loop
	exitwhen x > max
		set it = UnitItemInSlot(DESourceUnit[DEI], x)
		if it != null then
			set id = GetItemTypeId(it)

			if id== RealItemTypeId[Item_Javelin] and GetPrdRandom(DESourceUnit[DEI],'JAVL', 20) then
				set DEMagicalDamage[DEI] = DEMagicalDamage[DEI] + 40
			endif

			// 多个金箍棒不叠加
			if id== RealItemTypeId[Item_MonkeyKingBar] and GetPrdRandom(DESourceUnit[DEI],'I0A5', 35) then
				set isMonkeyKingBar = true
			endif
		endif
		set x = x + 1
	endloop
	if isMonkeyKingBar then
		call CommonUnitAddStun(DETargetUnit[DEI], 0.01, true)
		set DEMagicalDamage[DEI] = DEMagicalDamage[DEI] + 100
	endif
	set it = null
endfunction

globals

	boolean 				TransmittedDamage		= false
	boolean					IsAnAttack				= false
	integer 	DEI 								= 0

	boolean		array       DEDummyAttack
	unit 		array       DEDummyUnit

	integer 	array 		DETriggerPlayerId
	// 伤害来源的玩家的Id
	integer 	array 		DESourcePlayerId

	player      array       DESourcePlayer
	player 		array       DETargetPlayer

	unit 		array 		DETargetUnit
	// 伤害来源
	unit 		array		DESourceUnit
	integer 	array		DESourceId 
	integer 	array		DETargetId 

	integer     array       DETargetTypeId
	integer     array       DESourceTypeId

	boolean 	array		DETargetIsHero
	boolean 	array		DESourceIsHero

	boolean 	array		DESourceIsIllusion
	boolean 	array		DETargetIsIllusion

	boolean 	array 		DESourceIsBreak
	boolean 	array 		DETargetIsBreak
	boolean     array       DESourceIsMelee
	boolean     array       DETargetIsStructure
	boolean     array       DETargetIsWard
	boolean     array       DESourceIsWard
	boolean     array       DETargetIsMagicImmune
	boolean     array       DEIsEnemy

	boolean		array 		DEIsAttackDamage
	integer     array       DESourceDamageType
	integer     array       DESourceAttackType

	integer		array       DeathFraudMode
	real	    array       DeathFraudValue

	// 伤害值
	real 		array		DEDamageValue
	real        array       DEMagicalDamage
	real 		array 		DEPhysicsDamage
	real        array       DEPureDamage
	// 减少的伤害值
	real 		array		DEReducedDamage

endglobals

// 任意单位受到伤害事件
// 确保此触发器是单位最先被注册的触发器 这样修改伤害值后 动态注册的触发器获取到的是修改后的值
// 进一步优化可以减少传参，直接用全局变量传参 总感觉现在会到字节码上限
function AnyUnitDE takes nothing returns boolean

	local real criticalStrikeValue = 0.
	local real tempReal = 0.
	local integer tempInt = 0
	local boolean isPhysicalDamage
	local boolean isSpellDamage
	local integer targetDefenseTypeId

	local real originalPhysicalDamage
	local boolean transmitted = false
	local boolean isAnAttack = false

	local player p = null
	//local real DEReducedDamage[DEI] = 0
	if not FK then
		return false
	endif
	if TransmittedDamage then
		set TransmittedDamage = false
		set transmitted = true
	endif
	set DEI = DEI + 1

	set originalPhysicalDamage = 0
	set DEReducedDamage[DEI] = 0.
	set DETargetUnit[DEI] = GetTriggerUnit()
	if GetTriggerEventId() == EVENT_UNIT_DAMAGED then
		set DESourceUnit[DEI] = GetEventDamageSource()
		set DEDamageValue[DEI] = GetEventDamage()
		if IsAnAttack and DEDamageValue[DEI] > 0. then
			set isPhysicalDamage = true
			set isAnAttack = true
			set IsAnAttack = false
		else
			set isPhysicalDamage = YDWEIsEventPhysicalDamage()
		endif
		set DEIsAttackDamage[DEI] = YDWEIsEventAttackDamage()
		set isSpellDamage = YDWEIsEventRangedDamage() and not DEIsAttackDamage[DEI]


		set DEPhysicsDamage[DEI] = 0.
		set DEMagicalDamage[DEI] = 0.
		set DEPureDamage[DEI] = 0.
		set DESourcePlayer[DEI] = GetOwningPlayer(DESourceUnit[DEI])
		set DETargetPlayer[DEI] = GetOwningPlayer(DETargetUnit[DEI])
		// =======================================================================
		// 设置助攻列表
		call SetAssistList()
		// =======================================================================
		// 捕捉马甲伤害
		if UE and GetUnitTypeId(DESourceUnit[DEI])=='e00E' then
			// 机器人的进军
			call MarchOfTheMachinesDE()
			// 火焰气息
			call BreatheFireDE()
			// 闪电风暴
			call LightningStormDE()
			// 马蹄践踏
			call HoofStompDE()
			// 冰火交加
			call DualBreathDE()
			// 自然之怒
			call WrathOfNatureDE()
			// call FTA()
		endif
		// =======================================================================
		// 永久的隐身在保持原位情况下 命令ID是0 会响应救援, 再次发布保持原位命令使其呆在原地.
		/*if InvisibleCount > 0 and LoadInteger(ExtraHT, DESourceId[DEI], WIND_WALK_COUNT) > 0 and GetUnitCurrentOrder(DESourceUnit[DEI]) == 0 then
			call IssueImmediateOrderById(DESourceUnit[DEI], 851993)
		endif*/
		if DEDamageValue[DEI] > 0 and DEDamageValue[DEI] < 9000 then
			set DESourceDamageType[DEI] = EXGetEventDamageData(4)
			set DESourceAttackType[DEI] = EXGetEventDamageData(6)
			set DETargetId[DEI] = GetHandleId(DETargetUnit[DEI])
			set DETargetTypeId[DEI] = GetUnitTypeId(DETargetUnit[DEI])
			set DESourceTypeId[DEI] = GetUnitTypeId(DESourceUnit[DEI])
			// 设置真正的伤害来源 排除掉马甲
			if (GetUnitAbilityLevel(DESourceUnit[DEI],'Aloc')== 1 and not IsHeroUnitId(DESourceTypeId[DEI])) then
				set DESourceUnit[DEI] = Player__Hero[GetPlayerId(DESourcePlayer[DEI])]
			endif
			set DESourceId[DEI] = GetHandleId(DESourceUnit[DEI])
			set DESourceIsIllusion[DEI] = IsUnitIllusion(DESourceUnit[DEI])
			set DETargetIsIllusion[DEI] = IsUnitIllusion(DETargetUnit[DEI])
			set DETargetIsHero[DEI] = IsUnitType(DETargetUnit[DEI], UNIT_TYPE_HERO) or IsBearUnit(DETargetUnit[DEI])
			set DESourceIsHero[DEI] = IsUnitType(DESourceUnit[DEI], UNIT_TYPE_HERO) or IsBearUnit(DESourceUnit[DEI])
			set DESourceIsBreak[DEI] = HaveSavedHandle(ExtraHT, DESourceId[DEI], HTKEY_UNIT_BREAK)
			set DETargetIsBreak[DEI] = HaveSavedHandle(ExtraHT, DETargetId[DEI], HTKEY_UNIT_BREAK)
			set DESourceIsMelee[DEI] = IsUnitType(DESourceUnit[DEI], UNIT_TYPE_MELEE_ATTACKER)
			set DETargetIsStructure[DEI] = IsUnitType(DETargetUnit[DEI], UNIT_TYPE_STRUCTURE)

			set DETargetIsWard[DEI] = GetUnitAbilityLevel(DETargetUnit[DEI], 'A04R') > 0
			set DETargetIsMagicImmune[DEI] = IsMagicImmuneUnit(DETargetUnit[DEI])
			set DEIsEnemy[DEI] = IsPlayerEnemy(DESourcePlayer[DEI], DETargetPlayer[DEI])

			// 物理伤害
			if isPhysicalDamage then

				// 如果有黯灭，就在这里添加减甲效果。
				if DESourceIsHero[DEI] and DEIsEnemy[DEI] and DESourceIsHero[DEI] and (ItemsCount[Item_StygianDesolator] > 0 and GetHandleItemCount(DESourceId[DEI], RealItemTypeId[Item_StygianDesolator])> 0) or (ItemsCount[it_fj] > 0 and GetHandleItemCount(DESourceId[DEI], RealItemTypeId[it_fj])> 0) then
					call StygianDesolatorActions(DETargetUnit[DEI])
				endif

				// 如果有隐匿，就在这里施加效果。
				if MeldCount > 0 and LoadBoolean(ExtraHT, DESourceId[DEI], MELD_STATE) then
					if LoadUnitHandle(ExtraHT, DESourceId[DEI], MELD_STATE) == DETargetUnit[DEI] then
						call MeldAttackHitAcionts(DESourceUnit[DEI], DETargetUnit[DEI], LoadInteger(ExtraHT, DESourceId[DEI], MELD_STATE))
					endif
					call RemoveSavedInteger(ExtraHT, DESourceId[DEI], MELD_STATE)
					call RemoveSavedBoolean(ExtraHT, DESourceId[DEI], MELD_STATE)
					call RemoveSavedHandle(ExtraHT, DESourceId[DEI], MELD_STATE)
					set MeldCount = MeldCount - 1
				endif

				// 如果有晕眩, 就在这里结算晕眩.
				if HavePassiveStun and DEIsEnemy[DEI] and not DETargetIsWard[DEI] and not DETargetIsStructure[DEI] then
					call SetPassiveStun()
				endif

				// 原始伤害
				set originalPhysicalDamage = DEDamageValue[DEI]
				
				if DESourceIsHero[DEI] and DEIsEnemy[DEI] and not DETargetIsWard[DEI] and not DETargetIsStructure[DEI] then	

					// 等效额外攻击力
					// 补刀斧
					// 目标非幻象 非建筑 非肉山
					if not DETargetIsIllusion[DEI] and IsNotRoshan(DETargetUnit[DEI]) then
						if (ItemsCount[QuellingBlade_Melee] > 0 or ItemsCount[QuellingBlade_Ranged] > 0)  then
							if DESourceIsMelee[DEI] and GetHandleItemCount(DESourceId[DEI], RealItemTypeId[QuellingBlade_Melee])> 0 then
								set DEDamageValue[DEI] = DEDamageValue[DEI] * 1.32
							elseif GetHandleItemCount(DESourceId[DEI], RealItemTypeId[QuellingBlade_Ranged])> 0 then
								set DEDamageValue[DEI] = DEDamageValue[DEI] * 1.12
							endif
						endif
						// 狂战斧
						if ItemsCount[Item_BattleFury] > 0 and GetHandleItemCount(DESourceId[DEI], RealItemTypeId[Item_BattleFury])> 0 then
							if DESourceIsMelee[DEI] then
								set DEDamageValue[DEI] = DEDamageValue[DEI] * 1.64
							else
								set DEDamageValue[DEI] = DEDamageValue[DEI] * 1.32
							endif
						endif
					endif
					// 背刺
					if HaveBackstab then
						set tempReal = LoadReal(ExtraHT, DESourceId[DEI] , HTKEY_UNIT_BACKSTAB_VALUE)
						if tempReal > 0. then
							call SaveReal(ExtraHT, DESourceId[AEI], HTKEY_UNIT_BACKSTAB_VALUE, 0.)
							set DEDamageValue[DEI] = DEDamageValue[DEI] + tempReal
							call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", DETargetUnit[DEI], "chest"))
						endif
					endif

				endif
				
				// 攻击伤害调整

				// 特效伤害调整 
				// 火焰气息 
				if IsEffectEnabled[EFFECT_KEY_BREATHE_FIRE] then
					set tempReal = GetUnitAbilityLevel(DESourceUnit[DEI], 'A3KS')
					if tempReal > 0. then
						set DEDamageValue[DEI] = DEDamageValue[DEI] * ( 0.75 - tempReal * 0.05 )
					endif
				endif
				// 集中火力
				if IsEffectEnabled[EFFECT_KEY_FOCUS_FIRE] and GetUnitAbilityLevel(DESourceUnit[DEI], 'A12R') > 0 then
					set tempReal = LoadReal(HY, DESourceId[DEI], 'A12P')
					if tempReal > 0. then
						set DEDamageValue[DEI] = DEDamageValue[DEI] * ( 0.75 - tempReal * 0.05 )
					endif
				endif

				// 分裂箭主目标伤害调整
				if SplitShotCount > 0 and GetUnitAbilityLevel(DESourceUnit[DEI], 'A419') > 0 then
					set DEDamageValue[DEI] = DEDamageValue[DEI] * 0.8
				endif
				
				// 幻象攻击调整
				if DESourceIsIllusion[DEI] then
					set tempReal = LoadReal(ExtraHT, DESourceId[DEI] , IllusionUnitDataB)
					//call SingleDebug(R2S(tempReal)+"幻象伤害比例")
					set DEDamageValue[DEI] = DEDamageValue[DEI] * tempReal
				endif	

				// 致命一击
				// 因为限制, 没办法给远程单位攻击弹道绑定数据, 远程伤害时立即结算暴击好了.
				if not DETargetIsWard[DEI] and not DETargetIsStructure[DEI] and DEIsEnemy[DEI] then
					if DESourceIsMelee[DEI] and not isAnAttack then
						set criticalStrikeValue = LoadReal(ExtraHT, DESourceId[DEI] , HTKEY_UNIT_CS_VALUE)
					else
						set AEI = AEI + 1
						set AEAttackerId[AEI] = DESourceId[DEI]
						set criticalStrikeValue = SetUnitCriticalStrike(DESourceUnit[DEI], false)
						set AEI = AEI - 1
					endif
					// 先一步执行暴击附带的动作 混沌一击的减甲效果(在护甲结算之前) 和 海象挥击的滞空效果
					if criticalStrikeValue > 0. then
						set tempInt = LoadInteger(ExtraHT, DESourceId[DEI], HTKEY_UNIT_CS_ID)
						if tempInt == 'BWPR' then
							// 海象挥击
							call WalrusPunchHitActions(DESourceUnit[DEI], DETargetUnit[DEI], GetUnitCustomBuffLevel(DESourceUnit[DEI], 'BWPR'))
							call UnitRemoveCustomBuffEx(DESourceUnit[DEI], 'BWPR')
						elseif tempInt == 'A1IQ' then
							// 忍术
							call UnitAttackJinadaActions()
						elseif tempInt == 'A03N' then
							// 混沌暴击
							call AddAbilityToTimed(DETargetUnit[DEI],'A3JG', 1, 8,'B3JG')
							call AddAbilityToTimed(DETargetUnit[DEI],'A3JH', 1, 8, 0)
						endif
					endif

					// 破隐一击
					set tempReal = LoadReal(ExtraHT, DESourceId[DEI], WIND_WALK_ATTACK_DAMAGE)
					set tempInt = LoadInteger(ExtraHT, DESourceId[DEI], WIND_WALK_ATTACK_BUFF_ID)
					if tempInt > 0 then
						if tempInt == 'B39C' then
							if not DETargetIsMagicImmune[DEI] then
								call AddAbilityToTimed(DETargetUnit[DEI],'A39D', 1, 5.,'B39D')
								call UnitAddBreakToTimed(DETargetUnit[DEI], 5.)
							endif
						elseif tempInt == 'B00K' then
							call UnitDamageTargetEx(DESourceUnit[DEI], DETargetUnit[DEI], 3, tempReal)
							call RemoveSavedReal(ExtraHT, DESourceId[DEI], WIND_WALK_ATTACK_DAMAGE)
							set tempReal = 0.
						endif
						call RemoveSavedInteger(ExtraHT, DESourceId[DEI], WIND_WALK_ATTACK_BUFF_ID)
						//call UnitWindWalkAttackAcionts(DESourceUnit[DEI])
					endif
					if tempReal > 0. then
						call RemoveSavedReal(ExtraHT, DESourceId[DEI], WIND_WALK_ATTACK_DAMAGE)
					endif
					if criticalStrikeValue > 0. and tempReal > 0. then
						// 红字暴击
						set DEDamageValue[DEI] = DEDamageValue[DEI] * criticalStrikeValue + tempReal
						call CriticalStrikeTextTag(DESourceUnit[DEI], originalPhysicalDamage * criticalStrikeValue + tempReal)
					elseif criticalStrikeValue > 0. then
						set DEDamageValue[DEI] = DEDamageValue[DEI] * criticalStrikeValue
						call CriticalStrikeTextTag(DESourceUnit[DEI], originalPhysicalDamage * criticalStrikeValue)
					elseif tempReal > 0. then
						set DEDamageValue[DEI] = DEDamageValue[DEI] + tempReal
						call CriticalStrikeTextTag(DESourceUnit[DEI], tempReal)
					endif

				endif

				// 长大A杖效果 粉碎 对建筑造成1.75倍伤害
				if HaveGrow and not DESourceIsBreak[DEI] and DETargetIsStructure[DEI] and GetUnitAbilityLevel(DESourceUnit[DEI], 'A2KK') > 0 then
					set DEDamageValue[DEI] = DEDamageValue[DEI] * 1.75
				endif
				
				// 攻击目标非建筑, 非友军
				if DEIsEnemy[DEI] and not DETargetIsWard[DEI] then
					// (攻击者是 英雄 or 幻象)
					if DESourceIsHero[DEI] or DESourceIsIllusion[DEI] then
						// 溅射 变龙
						if HaveElderDragonForm and ( DESourceTypeId[DEI] == 'H00F' or DESourceTypeId[DEI] == 'H00E' or DESourceTypeId[DEI] == 'H00G' ) then
							call DragonSplashActions(DESourceTypeId[DEI])
						endif

						// 伤害来源没有受到破坏效果, 目标不是守卫
						if HaveMoonGlaive and not DESourceIsBreak[DEI] and not DETargetIsWard[DEI] and GetUnitAbilityLevel(DESourceUnit[DEI], 'A041') > 0 then
							call MoonGlaiveActions()
						endif
					
					elseif HaveMassSerpentWard and LoadBoolean(ExtraHT, DESourceId[DEI], 'A00H') then
						// 蛇棒
						call UnitSplashAttackActions(175., 0.75)
					elseif DESourceTypeId[DEI] == 'nbwm' then
						call UnitSplashAttackActions(250., 1.)
					endif

					if not DETargetIsStructure[DEI] then
				
						// 物理攻击特效 伤害增加
						if not DESourceIsBreak[DEI] then // 这些都是会被禁用的被动技能

							if HaveManaBreak then // 法力损毁
								call ManaBreakActions()
							endif

							// 爆头
							if HaveHeadshot and GetUnitAbilityLevel(DESourceUnit[DEI],'P102') > 0 then
								call HeadshotActions()
							endif

							// 怒意狂击
							if HaveFurySwipes and IsNotRoshan(DETargetUnit[DEI]) and GetUnitAbilityLevel(DESourceUnit[DEI],'P067')> 0 then
								call FurySwipesActions()
							endif

						endif

						if HaveDiffusalBlade then // 净魂之刃
							call DiffusalBladeActions()
						endif

						// 魔法攻击特效
						// 穿刺
						if ( ItemsCount[Item_Javelin] > 0 or ItemsCount[Item_MonkeyKingBar] > 0 ) then
							call PierceActions()
						endif

					endif

					// 分裂
					if not DESourceIsIllusion[DEI] then
						call CleaveActions()
					endif
				endif
		
			endif

			if not DETargetIsWard[DEI] and not DETargetIsStructure[DEI] then

				// 物理伤害增加 赎罪 影响全性质伤害
				if IsEffectEnabled[EFFECT_KEY_PENITENCE] then
					set tempReal = LoadReal(ExtraHT, DETargetId[DEI], 'A0KM')
					if tempReal > 0. then
						//call BJDebugMsg("赎罪追加伤害比例"+R2S(tempReal))
						set DEPhysicsDamage[DEI] = GetAllDamage() * tempReal
					endif
				endif
				
				// 纯粹伤害增加 加法叠加
				set tempReal = 0.
				// 嗜血狂暴 2个D为乘法叠加
				if IsEffectEnabled[EFFECT_KEY_BLOODRAGE] then
					set tempReal = LoadReal(ExtraHT, DETargetId[DEI], 'A2X9')
					if LoadReal(ExtraHT, DESourceId[DEI], 'A2X9') > 0. then
						set tempReal = ( 1. + tempReal ) * ( 1. + LoadReal(ExtraHT, DESourceId[DEI], 'A2X9') ) - 1.
					endif
				endif
				// 灵魂猎手
				if IsEffectEnabled[EFFECT_KEY_SOUL_CATCHER] then
					set tempReal = tempReal + LoadReal(ExtraHT, DETargetId[DEI], 'A1SB')
				endif
				// 命运敕令
				if not DETargetIsMagicImmune[DEI] and IsEffectEnabled[EFFECT_KEY_FATE_EDICT] then
					set tempInt = GetUnitAbilityLevel(DETargetUnit[DEI], 'A3KD')
					if tempInt > 0. then
						set tempReal = tempReal + 0.5
					endif
				endif

				if tempReal > 0. then
					set DEPureDamage[DEI] = GetAllDamage() * tempReal
					//call BJDebugMsg("纯粹伤害追加伤害比例"+R2S(tempReal) + "额外纯粹伤害"+R2S(DEPureDamage[DEI]))
				endif

				// 传递的伤害 此类伤害均带有不反弹标记
				// 致命连接传递伤害
				if IsEffectEnabled[EFFECT_KEY_FATAL_BONDS] and not transmitted then
					call FatalBondsTransmittedActions()
				endif
				// 折射传递伤害
				if HaveDispersion and not transmitted and DETargetIsHero[DEI] and DEIsEnemy[DEI] and not DETargetIsBreak[DEI] and GetUnitAbilityLevel(DETargetUnit[DEI],'A0NA') > 0 then
					call DispersionActions()
				endif
				// 刃甲传递伤害
				if BladeMailCount > 0 and not transmitted and DETargetIsHero[DEI] and DEIsEnemy[DEI] and XFX(DESourcePlayer[DEI]) and LoadBoolean(HY, DETargetId[DEI],'BMON') and not R_X(DESourceUnit[DEI])  then
					call BladeMailTransmittedActions()
				endif
				// 死亡欺诈传递伤害
				if HaveDeathFraud and not transmitted and DETargetIsHero[DEI] and DEIsEnemy[DEI] and not DETargetIsBreak[DEI] and GetUnitAbilityLevel(DETargetUnit[DEI],'A34D') > 0 then
					call DeathFraudTransmittedActions()
				endif
				// 尖刺外壳传递伤害
				if SpikedCarapaceCount > 0 and not transmitted and DETargetIsHero[DEI] and DEIsEnemy[DEI] and XFX(DESourcePlayer[DEI]) and HaveSavedHandle(HY, DETargetId[DEI], 'A2KO') then
					call SpikedCarapaceTransmittedActions()
				endif
				// 致命创伤
				if HaveMortalWounds and DESourceIsHero[DEI] and not transmitted and not DESourceIsBreak[DEI] and DEIsEnemy[DEI] and GetUnitAbilityLevel(DESourceUnit[DEI],'A460') > 0 then
					call MortalWoundsTransmittedActions()
				endif

				// 魔法护盾格挡 可格挡全类型全性质伤害
				if HaveManaShield and DETargetIsHero[DEI] and LoadInteger(ExtraHT, DETargetId[DEI],'A0MP') > 0 then
					call ManaShieldActions()
				endif

			endif

			// 树甲格挡 可格挡全类型全性质伤害
			if IsEffectEnabled[EFFECT_KEY_LIVING_ARMOR] then
				call LivingArmorActions()
			endif

			// 普通伤害 或加强伤害
			if DESourceDamageType[DEI] == 4 or DESourceDamageType[DEI] == 5 then
				call CommonDamageBlock()		
				if DESourceDamageType[DEI] == 4 or DEIsAttackDamage[DEI] then
					// 传统伤害调整Ⅰ

					// 护甲减免
					set tempReal = GetUnitState(DETargetUnit[DEI], UNIT_STATE_ARMOR)
					if tempReal >= 0. then
						set tempReal = 1. / ( 1. + tempReal * 0.06 )
					else
						set tempReal = 2. - Pow( 1. - 0.06, RMinBJ(20., 0. - tempReal))
					endif

					set DEDamageValue[DEI] = DEDamageValue[DEI] * tempReal

					//if DESourceIsHero[DEI] then
					//	call SingleDebug(R2S(tempReal)+" 护甲减免后受伤比例")
					//endif
				endif
			endif

			if DEPhysicsDamage[DEI] > 0. then
				set tempReal = GetUnitState(DETargetUnit[DEI], UNIT_STATE_ARMOR)
				if tempReal >= 0. then
					set tempReal = 1. / ( 1. + tempReal * 0.06 )
				else
					set tempReal = 2. - Pow( 1. - 0.06, RMinBJ(20., 0. - tempReal))
				endif
				set DEPhysicsDamage[DEI] = DEPhysicsDamage[DEI] * tempReal
			endif
			//endif

			set targetDefenseTypeId = R2I(GetUnitState(DETargetUnit[DEI], UNIT_STATE_ARMOR_TYPE))
			set tempReal = LoadReal(AttackDefense, DESourceAttackType[DEI], targetDefenseTypeId)
			set DEDamageValue[DEI] = DEDamageValue[DEI] * tempReal
			//call SingleDebug(R2S(tempReal)+" 攻防比例")

			// 石化凝视伤害调整，影响物理攻击伤害
			if IsEffectEnabled[EFFECT_KEY_STONE_GAZE] and isPhysicalDamage then
				set tempReal = LoadReal(ExtraHT, DETargetId[DEI], 'A1AT')
				if tempReal > 0. then
					set DEDamageValue[DEI] = DEDamageValue[DEI] + DEDamageValue[DEI] * tempReal
				endif
			endif

			// 物理伤害无效化，影响全性质物理伤害 极寒之拥, 守护天使 其他虚无技能自带免疫


			// 魔法抗性伤害调整，影响全性质魔法伤害
			if DETargetIsMagicImmune[DEI] then // 魔法免疫时, 魔法抗性无条件为100%
				if DESourceAttackType[DEI] == 0 then // 源伤害是法术伤害
					set DEDamageValue[DEI] = 0.
				endif
				set DEMagicalDamage[DEI] = 0.	
			else
				set tempReal = LoadReal(ExtraHT, DETargetId[DEI], HTKEY_UNIT_ACTULA_MAGIC_RESISTANCE)

				if DESourceAttackType[DEI] == 0 then // 源伤害是法术伤害
					if tempReal != 0. then
						set DEDamageValue[DEI] = DEDamageValue[DEI] * tempReal
					endif
				endif
				if tempReal != 0. then
					set DEMagicalDamage[DEI] = DEMagicalDamage[DEI] * tempReal
				endif
			endif

			// 追加额外物理伤害 魔法伤害 纯粹伤害
			set DEDamageValue[DEI] = DEDamageValue[DEI] + DEMagicalDamage[DEI] + DEPhysicsDamage[DEI] + DEPureDamage[DEI]
			// 因为后面的减免都将影响全性质伤害

			// 传统伤害调整Ⅱ
			// 幻象攻击
			if DESourceIsIllusion[DEI] then
				if DETargetUnit[DEI] == RoShan then
					// 幻象对肉山伤害降低80%
					set DEDamageValue[DEI] = DEDamageValue[DEI] * 0.2
				endif
				if DETargetIsStructure[DEI] and IsUnitInGroup(DETargetUnit[DEI], UR) and GetUnitAbilityLevel(DETargetUnit[DEI],'A17R')== 0 then
					if LoadBoolean(P, DETargetId[DEI],'isBD') and DEIsEnemy[DEI] then
						// 幻象对有偷塔保护建筑伤害降低75%
						if Mode__AntiBackdoor then
							set DEDamageValue[DEI] = 0.
						else
							set DEDamageValue[DEI] = DEDamageValue[DEI] * 0.25
						endif
					else
						// 幻象对建筑伤害降低60%
						set DEDamageValue[DEI] = DEDamageValue[DEI] * 0.4
					endif
				endif
			endif

			// 六技能模式下 一些召唤物对防御塔的伤害将会被降低
			if Mode__SixSkills and DETargetIsStructure[DEI] and not DESourceIsHero[DEI] then
				if GetUnitAbilityLevel(DESourceUnit[DEI], 'A3J6') > 0 then
					set DEDamageValue[DEI] = DEDamageValue[DEI] * 0.75
				endif
			endif

			// 防御符文 全伤害无效化
			if DETargetIsStructure[DEI] and GetUnitAbilityLevel(DETargetUnit[DEI], 'A17R') > 0 then
				set DEDamageValue[DEI] = 0.
			endif

			// 灵能之刃飞溅伤害
			if HavePsiBlades and isPhysicalDamage and not DETargetIsStructure[DEI] and not DESourceIsIllusion[DEI] and not DESourceIsBreak[DEI] and GetUnitAbilityLevel(DESourceUnit[DEI],'A0RO') > 0 then
				call PsiBlades_Actions()
			endif

			// 攻击吸血 不是守卫单位 对建筑无效
			if not DETargetIsStructure[DEI] and not DETargetIsWard[DEI] and isPhysicalDamage and ( ( HaveVampiricAura or HaveVladmirOffering ) or ( DESourceIsHero[DEI] or DESourceIsIllusion[DEI] ) ) then 
				call PhysicalLifestealActions()
			endif

			// 核心伤害调整
			set tempReal = 1.

			// 死亡欺诈伤害调整
			if HaveDeathFraud and DeathFraudMode[DEI] > 0 then
				if DeathFraudMode[DEI] == 1 then
					set DEDamageValue[DEI] = DEDamageValue[DEI] - DEDamageValue[DEI] * DeathFraudValue[DEI]
				elseif DEDamageValue[DEI] > 1000. then
					set DEDamageValue[DEI] = 1000.
					call CommonTextTag(GetUnitName(DETargetUnit[DEI])+ " just Cheated Death!!", 5, DETargetUnit[DEI], .03, 255, 0, 0, 255)
					call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\DispelMagic\\DispelMagicTarget.mdl", DETargetUnit[DEI], "overhead"))
				endif
				set DeathFraudMode[DEI] = 0
				set DeathFraudValue[DEI] = 0.
			endif

			if HaveDispersion and DETargetIsHero[DEI] then

				//if IsUnitType(DESourceUnit[DEI], UNIT_TYPE_HERO) then
					// debug call SingleDebug( "伤害值:" + R2S(DEDamageValue[DEI]) +" 减免伤害值:"  + R2S(DEReducedDamage[DEI]) + " 比例：" + R2S( ( DEReducedDamage[DEI] / DEDamageValue[DEI] ) * 100.0 ) )
				//endif

				// 折射 需要检查是否被破被动 而且还会根据模型主属性和谐减伤值
				if not DETargetIsBreak[DEI] and GetUnitAbilityLevel(DETargetUnit[DEI],'A0NA') > 0  then
					if not Mode__RearmCombos and GetHeroPrimaryAttributesType(DETargetUnit[DEI])== 1 then
						set tempReal = tempReal - (.06 + .02 * GetUnitAbilityLevel(DETargetUnit[DEI],'A0NA'))
						//set DEDamageValue[DEI] = DEDamageValue[DEI] - DEDamageValue[DEI] *(.06 + .02 * GetUnitAbilityLevel(DETargetUnit[DEI],'A0NA'))
					else
						set tempReal = tempReal - (.06 + .04 * GetUnitAbilityLevel(DETargetUnit[DEI],'A0NA'))
						//set DEDamageValue[DEI] = DEDamageValue[DEI] - DEDamageValue[DEI] *(.06 + .04 * GetUnitAbilityLevel(DETargetUnit[DEI],'A0NA'))
					endif
				endif
	
			endif

			// 奔袭冲撞 0.6
			if LoadBoolean(ExtraHT, DETargetId[DEI], HTKEY_HAS_STAMPDE_UPGRADE_BUFF) then
				set tempReal = tempReal - 0.6
				//set DEDamageValue[DEI] = DEDamageValue[DEI] - DEDamageValue[DEI] * .6
			endif
			// 血肉傀儡
			if LoadReal(HY, DETargetId[DEI], 'AMPL') > 0. then
				set tempReal = tempReal + LoadReal(HY, DETargetId[DEI], 'AMPL')
			endif
			// 冰龙大的减伤 被诅咒的单位被攻击时 0.7
			if LoadInteger(HY, GetHandleId(DESourceUnit[DEI]), 4328) == 1 then
				set tempReal = tempReal - 0.7
				//set DEDamageValue[DEI] = DEDamageValue[DEI] - DEDamageValue[DEI] * .7
			endif
			// 过载
			if LoadBoolean(ExtraHT, GetHandleId(DETargetUnit[DEI]), HTKEY_DAMAGE_OVERCHARGE) then
				set tempReal = tempReal - (.05 * GetUnitAbilityLevel(DETargetUnit[DEI],'A1VM'))
				// set DEDamageValue[DEI] = DEDamageValue[DEI] -DEDamageValue[DEI] *(.05 * GetUnitAbilityLevel(DETargetUnit[DEI],'A1VM'))
			endif
			// 大隐刀 造成的伤害减少40%
			if GetUnitAbilityLevel(DESourceUnit[DEI],'A39D')== 1 then
				set tempReal = tempReal - .4
				//set DEDamageValue[DEI] = DEDamageValue[DEI] - DEDamageValue[DEI] * .4
			endif

			// 偷塔保护
			if DETargetIsStructure[DEI] then
				if IsUnitInGroup(DETargetUnit[DEI], UR) and GetUnitAbilityLevel(DETargetUnit[DEI],'A17R')== 0 then
					if LoadBoolean(P, DETargetId[DEI],'isBD') and DEIsEnemy[DEI] then
						if Mode__AntiBackdoor then
							set DEDamageValue[DEI] = 0.
						else
							set tempReal = tempReal - 0.5
						endif
					else
						call SaveReal(P, DETargetId[DEI],'DMGR', LoadReal(P, DETargetId[DEI],'DMGR') + DEDamageValue[DEI] * tempReal)
					endif
				endif
			endif
			set DEDamageValue[DEI] = DEDamageValue[DEI] * tempReal

			// 尾端伤害调整

			if DETargetIsHero[DEI] then

				// 折光 需要伤害 > 5 才减免 
				if GetUnitAbilityLevel(DETargetUnit[DEI],'A0RN') > 0 and DEDamageValue[DEI] > 5 then
					set DEDamageValue[DEI] = 0
					call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\PriestMissile\\PriestMissile.mdl", DETargetUnit[DEI], "right hand"))
					set tempInt = LoadInteger(HY, DETargetId[DEI], 'A0RN') - 1
					if tempInt <= 0 then
						call RemoveSavedInteger(HY, DETargetId[DEI], 'A0RN')
						call UnitRemoveAbility(DETargetUnit[DEI],'A0RN')
						call UnitRemoveAbility(DETargetUnit[DEI],'B08J')
					else
						call SaveInteger(HY, DETargetId[DEI], 'A0RN', tempInt)
					endif
				endif

				// 回到过去
				if HaveBacktrack and GetUnitAbilityLevel(DETargetUnit[DEI],'A0CZ') > 0 and not DETargetIsBreak[DEI] then
					if GetPrdRandom(DETargetUnit[DEI],'A0CZ', 5 + 5 *(GetUnitAbilityLevel(DETargetUnit[DEI],'A0CZ'))) then
						call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\WingedSerpentMissile\\WingedSerpentMissile.mdl", DETargetUnit[DEI], "hand,left"))
						set DEDamageValue[DEI] = 0
					endif
				endif

				if SpikedCarapaceBlock[DEI] then
					set DEDamageValue[DEI] = 0.
					set SpikedCarapaceBlock[DEI] = false
				endif

				// 虚妄诺言
				if GetUnitAbilityLevel(DETargetUnit[DEI],'A3KN') == 1 then
					set DEDamageValue[DEI] = 0.
				endif
		
				// 回光返照
				if GetUnitAbilityLevel(DETargetUnit[DEI],'C022') == 1 then
					call SetUnitToReduceDamage(DETargetUnit[DEI], DEDamageValue[DEI])
					set DEDamageValue[DEI] = 0.
				endif

				// 回光返照的A杖光环 0.5
				//if GetUnitAbilityLevel(DETargetUnit[DEI],'A3KG') == 1 then
				//	set rReducedDamage = rReducedDamage + DEDamageValue[DEI] * .5
				//	call SetUnitToReduceDamage(LoadUnitHandle(HY, GetHandleId(DETargetUnit[DEI]),'A3KG'), DEDamageValue[DEI] * .5)
					//set DEDamageValue[DEI] = DEDamageValue[DEI] - DEDamageValue[DEI] * .5
				//endif

			endif

			// 末端伤害格挡

			// 陵卫斗篷 要伤害 > 40. 才能被触发
			if HaveGravekeeperCloak and DETargetIsHero[DEI] and DEDamageValue[DEI] > 40. and not DETargetIsBreak[DEI] then

				set tempInt = LoadInteger(ExtraHT, DETargetId[DEI], 'A0VX')
				if tempInt > 0 then
					call GravekeeperCloakReduceDamage(tempInt)
				endif

			endif

			// 无光之盾

			// 船油 0.5
			if GetUnitAbilityLevel(DETargetUnit[DEI],'A12D') == 1 then
				set DEDamageValue[DEI] = DEDamageValue[DEI] * .5
				//set DEDamageValue[DEI] = DEDamageValue[DEI] - DEDamageValue[DEI] * .5
			endif

			// 技能吸血
			if HaveSpellLifesteal and not DEIsAttackDamage[DEI] then
				set p = DESourcePlayer[DEI]
				// 伤害来源是否是 非电脑 玩家的单位
				if p != Sentinels[0] and p != Scourges[0] and p != BW then
					if GetUnitAbilityLevel(DESourceUnit[DEI],'A39S')== 1 and not DETargetIsIllusion[DEI] and UnitAlive(DESourceUnit[DEI]) then
						call SpellLifesteal()
					endif
				endif
			endif

			// 幻象承受伤害调整
			if DETargetIsIllusion[DEI] then
				set tempReal = LoadReal(ExtraHT, DETargetId[DEI] , IllusionUnitDataC)
				//call SingleDebug(R2S(tempReal)+"幻象受伤比例")
				set DEDamageValue[DEI] = DEDamageValue[DEI] * tempReal
			endif

			//if DEReducedDamage[DEI] > 0 then
				// 判断受伤者有没有资格减免伤害
				// 墓碑 蝗虫 冰球 追踪导弹 一类的单位不接受伤害减免
			//	if not(CMX(targetUnitTypeId) or RQX(targetUnitTypeId) or IsPhoenixSunTypeId(targetUnitTypeId) or IsTombstoneTypeId(targetUnitTypeId) or R3X(targetUnitTypeId) or IsBeetleUnitTypeId(targetUnitTypeId) or R1X(targetUnitTypeId)) then
					// 给受伤者减免伤害
			//		call SetUnitToReduceDamage(DETargetUnit[DEI], DEReducedDamage[DEI])
			//	endif
			//endif
		
			// 运行物理攻击特效
			if isPhysicalDamage then
				call ExecuteAttackEvent(DE_NONE)
				if DESourceIsHero[DEI] then
					call ExecuteAttackEvent(DE_SH)
					if not DETargetIsWard[DEI] and not DETargetIsStructure[DEI] then
						call ExecuteAttackEvent(DE_SH_T_NS_NW)
						if DEIsEnemy[DEI] then
							call ExecuteAttackEvent(DE_SH_TE_NS_NW)
							if not DETargetIsMagicImmune[DEI] then
								call ExecuteAttackEvent(DE_SH_TE_NM_NS_NW)
							endif
						endif
					endif
				endif
			endif

			// 灵魂超度
			if HaveSoulAssumption and not M_V then
				call SoulAssumptionDE()
			endif


			if DETargetIsHero[DEI] and GetUnitAbilityLevel(DETargetUnit[DEI],'A3D9')== 1 then
				call SaveUnitHandle(HY, DETargetId[DEI],'lstd', DESourceUnit[DEI])
			endif

			// 攻击次数型守卫
			// 凤凰蛋
			if DETargetIsWard[DEI] and IsPhoenixSunTypeId(DETargetTypeId[DEI]) then

				// 如果是英雄的攻击 则强制伤害为1
				if isPhysicalDamage and IsUnitType(DESourceUnit[DEI], UNIT_TYPE_HERO) then
					set DEDamageValue[DEI] = 1.
				else
					set DEDamageValue[DEI] = 0
				endif

			endif

			// 数值减少
			// 伤害清零区
			if DEDamageValue[DEI] <= 0 then
				set DEDamageValue[DEI] = 0
			elseif GetUnitAbilityLevel(DETargetUnit[DEI],'A3DA') == 1 then
				// 预回血 薄葬 冥魂 
				call SetUnitToReduceDamage(DETargetUnit[DEI], DEDamageValue[DEI])
			endif
	
			// 额外的伤害事件 关于镜头震动和伤害显示 要在额外伤害打出之前运行
			if KB then
				call OtherDE(DETargetUnit[DEI], DESourceUnit[DEI], DEDamageValue[DEI] - DEReducedDamage[DEI])
			endif
			// 打断物品
			if DETargetIsHero[DEI] and ( DEDamageValue[DEI] ) > 10 and (XFX( GetOwningPlayer( DESourceUnit[DEI] ) ) or  DESourceUnit[DEI] == RoShan ) then
				// 这里计算了减伤再打断
				call SaveReal(HY, GetHandleId( DETargetUnit[DEI] ), 785, GetGameTime())
			endif

	
			call EXSetEventDamage(DEDamageValue[DEI]) // 一定要在伤害事件运行完毕后执行, 否则可能会有蜜汁BUG

			//if DESourceIsHero[DEI] then
			//	call SingleDebug(R2S(DEDamageValue[DEI])+" 结算伤害")
			//endif

			// 还缺少致命创伤和死亡欺诈
		endif
		if JE then
			call AQX("+" + I2S(R2I(DEDamageValue[DEI])), 1, DETargetUnit[DEI], .028, 64, 255, 0, 0,$D8)
		endif
	endif
	//set DETargetUnit[DEI] = null
	//set DESourceUnit[DEI] = null
	//set DESourceUnit[DEI] = null
	set DEI = DEI - 1
	return false
endfunction


function InitAttackDefense takes nothing returns nothing

	// 0, 法术
	// 1, 普通
	// 2, 穿刺
	// 3, 攻城
	// 4, 魔法
	// 5, 混乱
	// 6, 英雄

	// 0, 无甲
	// 1, 中甲
	// 2, 重甲
	// 3, 城甲
	// 4, 普通
	// 5, 英雄
	// 6, 神圣
	// 7, 轻甲 
	call SaveReal(AttackDefense, 0, 7, 1.0) 		// 法术无甲
	call SaveReal(AttackDefense, 0, 1, 1.0) 		// 法术中甲
	call SaveReal(AttackDefense, 0, 2, 1.0) 		// 法术重甲
	call SaveReal(AttackDefense, 0, 3, 1.0) 		// 法术城甲
	call SaveReal(AttackDefense, 0, 5, 1.0) 		// 法术英雄甲

	call SaveReal(AttackDefense, 1, 7, 1.0) 		// 普攻无甲
	call SaveReal(AttackDefense, 1, 1, 1.5) 		// 普攻中甲
	call SaveReal(AttackDefense, 1, 2, 1.25) 		// 普攻重甲
	call SaveReal(AttackDefense, 1, 3, 0.70) 		// 普攻城甲
	call SaveReal(AttackDefense, 1, 5, 0.75) 		// 普攻英雄甲

	call SaveReal(AttackDefense, 2, 7, 1.50) 		// 穿刺无甲
	call SaveReal(AttackDefense, 2, 1, 0.75) 		// 穿刺中甲
	call SaveReal(AttackDefense, 2, 2, 0.75) 		// 穿刺重甲
	call SaveReal(AttackDefense, 2, 3, 0.35) 		// 穿刺城甲
	call SaveReal(AttackDefense, 2, 5, 0.50) 		// 穿刺英雄甲

	call SaveReal(AttackDefense, 3, 7, 1.0) 		// 攻城无甲
	call SaveReal(AttackDefense, 3, 1, 0.50) 		// 攻城中甲
	call SaveReal(AttackDefense, 3, 2, 0.75) 		// 攻城重甲
	call SaveReal(AttackDefense, 3, 3, 1.50) 		// 攻城城甲
	call SaveReal(AttackDefense, 3, 5, 0.75) 		// 攻城英雄甲

	call SaveReal(AttackDefense, 5, 7, 1.0) 		// 混乱无甲
	call SaveReal(AttackDefense, 5, 1, 1.0) 		// 混乱中甲
	call SaveReal(AttackDefense, 5, 2, 1.0) 		// 混乱重甲
	call SaveReal(AttackDefense, 5, 3, 0.40) 		// 混乱城甲
	call SaveReal(AttackDefense, 5, 5, 1.0) 		// 混乱英雄甲

	call SaveReal(AttackDefense, 6, 7, 1.0) 		// 英雄无甲
	call SaveReal(AttackDefense, 6, 1, 1.0) 		// 英雄中甲
	call SaveReal(AttackDefense, 6, 2, 1.0) 		// 英雄重甲
	call SaveReal(AttackDefense, 6, 3, 0.50) 		// 英雄城甲
	call SaveReal(AttackDefense, 6, 5, 1.0) 		// 英雄英雄甲
endfunction


function UWA takes unit sourceUnit, unit targetUnit returns nothing	//单位被攻击

	//if CGA(u, t) then
	//	return
	//endif
	call AttackEventActions(sourceUnit, targetUnit, false)

	// 无敌泉水
	if GetUnitTypeId(sourceUnit)=='ndfl' or GetUnitTypeId(sourceUnit)=='nfoh' then 
		if IsUnitType(sourceUnit, UNIT_TYPE_HERO) then
			call DisplayTextToPlayer(GetOwningPlayer(sourceUnit), 0, 0, "你这是在自寻死路")
		endif
		call AddAbilityToTimed(targetUnit,'A39D', 1, 5.,'B39D')
		call UnitAddBreakToTimed(targetUnit, 5.)	
		call UnitDamageTargetEx(sourceUnit, targetUnit, 6, 1000)
	endif
endfunction

function N2A takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local unit u =(LoadUnitHandle(HY,(GetHandleId(t)),$DD))
	local integer h = GetHandleId(u)
	local integer i = 1
	local integer k =$A
	if h == 0 then
		call FlushChildHashtable(HY, LoadInteger(HY, GetHandleId(t), 0))
		call DestroyTrigger(t)
		return
	endif
	loop
	exitwhen i > k
		call SaveReal(HY, h,(7300 +(i -1)),(((LoadReal(HY, h,(7300 +(i)))))* 1.))
		call SaveReal(HY, h,(7350 +(i -1)),(((LoadReal(HY, h,(7350 +(i)))))* 1.))
		call SaveReal(HY, h,(7200 +(i -1)),(((LoadReal(HY, h,(7200 +(i)))))* 1.))
		call SaveReal(HY, h,(7250 +(i -1)),(((LoadReal(HY, h,(7250 +(i)))))* 1.))
		set i = i + 1
	endloop
	call SaveReal(HY, h,(7300 +$A),((GetUnitX(u))* 1.))
	call SaveReal(HY, h,(7350 +$A),((GetUnitY(u))* 1.))
	call SaveReal(HY, h,(7200 +$A),((GetWidgetLife(u))* 1.))
	call SaveReal(HY, h,(7250 +$A),((GetUnitState(u, UNIT_STATE_MANA))* 1.))
	set t = null
	set u = null
endfunction

// 单位的视野马甲
function ZPI takes nothing returns boolean
	local integer h = GetHandleId(GetTriggeringTrigger())
	local unit ZQI = LoadUnitHandle(HY, h, 304)
	local unit W_V = LoadUnitHandle(HY, h, 305)
	if GetTriggerEvalCount(GetTriggeringTrigger())== 1 then
		call UnitAddAbility(W_V,'Aloc')
	endif
	if ZQI == null or not UnitAlive(ZQI) or IsDayTime() or GetUnitAbilityLevel(ZQI,'DRKN')+ GetUnitAbilityLevel(ZQI,'DRKU')== 0 then
		call ShowUnit(W_V, false)
		call SetUnitX(W_V, GetUnitX(ZQI))
		call SetUnitY(W_V, GetUnitY(ZQI))
		call UnitRemoveAbility(ZQI,'A1VA')
	else
		call ShowUnit(W_V, true)
		call UnitRemoveAbility(W_V, 'Aloc')
		call UnitAddAbility(W_V, 'Aloc')
		call SetUnitX(W_V, GetUnitX(ZQI))
		call SetUnitY(W_V, GetUnitY(ZQI))
		call UnitAddPermanentAbility(ZQI,'A1VA')
	endif
	if GetOwningPlayer(W_V)!= GetOwningPlayer(ZQI) then
		call SetUnitOwner(W_V, GetOwningPlayer(ZQI), true)
	endif
	set ZQI = null
	set W_V = null
	return false
endfunction

// 视野马甲和状态记录
function RegisterHeroVisionAndState takes unit u returns nothing
	local trigger t = CreateTrigger()
	local unit d = null
	local integer h
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddAction(t, function N2A)
	call SaveUnitHandle(HY, GetHandleId(t),$DD, u)
	call SaveInteger(HY, GetHandleId(t), 0, GetHandleId(u))
	// 创建视野马甲
	set t = CreateTrigger()
	set h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function ZPI))
	call SaveUnitHandle(HY, h, 304, u)
	set d = CreateUnit(GetOwningPlayer(u),'o01A', GetUnitX(u), GetUnitY(u), 0)
	call SaveUnitHandle(HY, h, 305, d)
	call SaveUnitHandle(K, GetHandleId(u),'DUMM', d)
	// debug call SingleDebug("给" + GetUnitName( u ) + YDWEId2S(GetUnitTypeId( u )) + " 注册视野和坐标记录触发器。")
	set d = null
	set t = null
endfunction

// 土猫的四个技能
// AddEarthSpiritManaStone
function AddEarthSpiritManaStone takes unit whichUnit returns nothing
	local integer iPlayerId = GetPlayerId(GetOwningPlayer(whichUnit))
	local integer loop_Index = 1
	local boolean b = false
	loop
		if PlayerSkillIndex[iPlayerId * HL + loop_Index]>= 441 and PlayerSkillIndex[iPlayerId * HL + loop_Index]<= 444 then
			set b = true
		endif
		set loop_Index = loop_Index + 1
	exitwhen b or loop_Index > 4 + ExtraAbilitiesNum  
	endloop
	if not LoadBoolean(HY, GetHandleId(whichUnit), StringHash("rolling stones")) and b then
		call UnitAddPermanentAbility(whichUnit,'A2TH')
		call P_R(whichUnit)
		call SaveBoolean(HY, GetHandleId(whichUnit), StringHash("rolling stones"), true)
	endif
endfunction

function RegisterOtherEvent takes unit whichUnit returns nothing
	local integer level
	local trigger trig
	local integer i
	// 给英雄注册学习技能事件
	set trig = CreateTrigger()
	call TriggerRegisterUnitEvent(trig, whichUnit, EVENT_UNIT_HERO_SKILL)
	call TriggerAddCondition(trig, Condition(function W5E))
	// 给英雄注册变身事件
	set trig = CreateTrigger()
	//call TriggerRegisterUnitEvent(trig, u, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterUnitEvent(trig, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(trig, Condition(function RVX))
	call SaveUnitHandle(HY, GetHandleId(trig), 0, whichUnit)
	set i = 1
	loop
		set level = GetUnitAbilityLevel(whichUnit, PassiveSkills_Learned[i])
		if level == 0 and PassiveSkills_SpellBook[i]> 0 then
			//call UnitRemoveAbility(whichUnit, PassiveSkills_SpellBook[i])
			//call UnitRemoveAbility(whichUnit, PassiveSkills_Buff[i])
		endif
		set i = i + 1
	exitwhen i > MaxPassiveSkillsNum
	endloop
	set trig = null
endfunction

// 英雄死亡的触发器
function RegisterHeroDeathEvent takes unit u returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DEATH)
	// 击杀
	call TriggerAddCondition(t, Condition(function U7X))

	// 一血
	call TriggerAddCondition(t, Condition(function W8X))
	// 如果是蓝猫 则会有个特效
	if GetUnitTypeId(u)=='H00S' then
		call TriggerAddCondition(t, Condition(function KGA))
	endif
	// 火猫有倒地动作
	if GetUnitTypeId(u)=='N0M0' then
		call TriggerAddCondition(t, Condition(function L_R))
	endif
	// 土猫也有倒地动作
	if GetUnitTypeId(u)=='N0MU' then
		call TriggerAddCondition(t, Condition(function QZR))
	endif
	// 血精石
	call TriggerAddCondition(t, Condition(function R_O))
	// 魂之挽歌
	call TriggerAddCondition(t, Condition(function ZKI))
	// 追踪术 赏金
	call TriggerAddCondition(t, Condition(function GCR))
	set t = null
endfunction

// 0秒后修正路径可通行状态
function U3A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call FixUnitSkillsBug(LoadUnitHandle(HY, h, 0))
	call SetTerrainPathable(LoadReal(HY, h, 0), LoadReal(HY, h, 1), PATHING_TYPE_WALKABILITY, false)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction

function U4A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	call FixUnitSkillsBug(u)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set u = null
endfunction

function WaitToFixUnitSkills takes unit whichUnit, real timeout returns nothing
	local integer h = TimerStartSingle(timeout, function U4A)
	call SaveUnitHandle(HY, h, 0, whichUnit)
endfunction

// 英雄单位死亡
function HeroReincarnationEvent takes nothing returns boolean
	local unit whichUnit = GetTriggerUnit()
	local integer iHandleId
	local real x
	local real y
	local real duration = .0
	local integer reincarnationLevel = GetUnitAbilityLevel(whichUnit,'A01Y')+ GetUnitAbilityLevel(whichUnit,'A1AZ')
	
	// debug call SingleDebug("英雄单位死亡 包括重生U6A" + GetUnitName( whichUnit ) + YDWEId2S(GetUnitTypeId( whichUnit )) )
	// 清除一些buff
	call GBX(whichUnit)
	// 不朽盾(AIrc) 骷髅王冥魂(A3DK) 重生和A杖(A01Y,A1AZ) 真实视野(A14K)?
	if reincarnationLevel > 0 or GetUnitAbilityLevel(whichUnit,'AIrc')== 1 or GetUnitAbilityLevel(whichUnit,'A3DK')> 0 or GetUnitAbilityLevel(whichUnit,'A46S')== 1 or GetUnitAbilityLevel(whichUnit,'A14K')== 1 then
		if GetUnitAbilityLevel(whichUnit,'AIrc')== 1 then
			set duration = 5.01
		elseif reincarnationLevel > 0 and GetUnitState(whichUnit, UNIT_STATE_MANA) >= 120 + 40 * reincarnationLevel and ( YDWEGetUnitAbilityState(whichUnit, 'A01Y', 1) + YDWEGetUnitAbilityState(whichUnit, 'A1AZ', 1) ) == 0 then
			set duration = 3.01
		// 骷髅王绿魂 秒活
		elseif GetUnitAbilityLevel(whichUnit,'A3DK')> 0 then
			set duration = .01
		endif
		// 等待一段时间后修正单位的技能
		call WaitToFixUnitSkills(whichUnit, duration)
		set x = GetUnitX(whichUnit)
		set y = GetUnitY(whichUnit)
		// 视野马甲修正
		call KPX(whichUnit)
		if IsTerrainPathable(x, y, PATHING_TYPE_WALKABILITY) then
			call Y_X(whichUnit)
		endif
	endif
	set whichUnit = null
	return false
endfunction

function RegisterHeroUnitCommonEvent takes unit whichUnit returns nothing
	if LoadBoolean(P, GetHandleId(whichUnit), 2) then
		return
	endif
	call TriggerRegisterUnitEvent(JJ, whichUnit, EVENT_UNIT_HERO_SKILL)
	call TriggerRegisterUnitEvent(JJ, whichUnit, EVENT_UNIT_SPELL_CAST)
	call TriggerRegisterUnitEvent(JJ, whichUnit, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterUnitEvent(JJ, whichUnit, EVENT_UNIT_SPELL_FINISH)
	call TriggerRegisterUnitEvent(JJ, whichUnit, EVENT_UNIT_SPELL_CHANNEL)
	call TriggerRegisterUnitEvent(JJ, whichUnit, EVENT_UNIT_SPELL_ENDCAST)
	call TriggerRegisterUnitEvent(JJ, whichUnit, EVENT_UNIT_ISSUED_ORDER)
	call TriggerRegisterUnitEvent(JJ, whichUnit, EVENT_UNIT_ISSUED_POINT_ORDER)
	call TriggerRegisterUnitEvent(JJ, whichUnit, EVENT_UNIT_ISSUED_TARGET_ORDER)
	call SaveBoolean(P, GetHandleId(whichUnit), 2, true)
endfunction

// 注册英雄单位的事件
function RegisterHeroEventFilter takes unit whichUnit returns nothing
	// 视野和状态记录
	call RegisterHeroVisionAndState(whichUnit)
	// 土猫的召唤巨石
	call AddEarthSpiritManaStone(whichUnit)

	// 从别的触发器合并来的
	// 修正重生事件的触发器
	call TriggerRegisterDeathEvent(HeroReincarnationTrigger, whichUnit)
	// 大概是减伤事件
	// call ExecuteFunc("T1A") 弃用 移动至任意单位受伤事件
	// 给英雄单位注册常用事件
	call RegisterHeroUnitCommonEvent(whichUnit)

	// debug call SingleDebug("给" + GetUnitName( whichUnit ) + YDWEId2S(GetUnitTypeId( whichUnit )) + " RegisterHeroUnitCommonEvent")
	// debug call SingleDebug("给 " + GetUnitName(whichUnit) + " 英雄注册任意单位受伤事件 以及状态记录和视野" )
	call GroupAddUnit(AllHerosGroup, whichUnit)
	// 英雄阵亡
	call RegisterHeroDeathEvent(whichUnit)

	// 从其他触发器合来的事件
	call RegisterOtherEvent(whichUnit)
	
	// 存单位的原始Id
	call SaveInteger( ExtraHT, GetHandleId(whichUnit), HTKEY_UNIT_ORIGIN_TYPEID, GetUnitTypeId(whichUnit) )
	// 初始化单位的缩放
	// call SaveReal( ExtraHT, GetHandleId(whichUnit), HTKEY_UNIT_CURRENT_PERCENT_SCALE, 1. )
	if IsTriggerEnabled( hChooseHeroTrigger ) then
		call PlayerChooseHeroUnit( whichUnit )
	endif

	// 伤害事件
	
endfunction

function GVE takes nothing returns nothing
	local unit d = CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetUnitFacing(GetTriggerUnit()))
	call UnitAddAbility(d,'A3IK')
	call SetUnitAbilityLevel(d,'A3IK', GetUnitAbilityLevel(GetTriggerUnit(), GetSpellAbilityId()))
	call IssueTargetOrderById(d,$D02B6, GetSpellTargetUnit())
	set d = null
endfunction
function T8A takes unit u, integer level returns nothing
	call SetUnitAbilityLevel(u,'A11F', level)
	call SetUnitAbilityLevel(u,'A3BP', level)
	call SetUnitAbilityLevel(u,'A1R5', level)
	call SetUnitAbilityLevel(u,'A11E', level)
	call SetUnitAbilityLevel(u,'A0S3', level)
	call SetUnitAbilityLevel(u,'A11D', level)
	call SetUnitAbilityLevel(u,'A11G', level)
	call SetUnitAbilityLevel(u,'A11H', level)
	call SetUnitAbilityLevel(u,'A0T9', level)
	call SetUnitAbilityLevel(u,'A2TK', level)
	call SetUnitAbilityLevel(u,'A1WE', level)
	call SetUnitAbilityLevel(u,'A0B8', level)
	call SetUnitAbilityLevel(u,'AChx', level)
	call SetUnitAbilityLevel(u,'A0FD', level)
	call SetUnitAbilityLevel(u,'A1T7', level)
	call SetUnitAbilityLevel(u,'A19M', level)
	call SetUnitAbilityLevel(u,'A02O', level)
	call SetUnitAbilityLevel(u,'A08Y', level)
	call SetUnitAbilityLevel(u,'A08Z', level)
	call SetUnitAbilityLevel(u,'A090', level)
	call SetUnitAbilityLevel(u,'A092', level)
	call SetUnitAbilityLevel(u,'A0HB', level)
	call SetUnitAbilityLevel(u,'A0D3', level)
	call SetUnitAbilityLevel(u,'A0DF', level)
	call SetUnitAbilityLevel(u,'A02W', level)
	call SetUnitAbilityLevel(u,'A28D', level)
	call SetUnitAbilityLevel(u,'A2EA', level)
	call SetUnitAbilityLevel(u,'A0CK', level)
	call SetUnitAbilityLevel(u,'A0K7', level)
	call SetUnitAbilityLevel(u,'A1EW', level)
	call SetUnitAbilityLevel(u,'A1MO', level)
	call SetUnitAbilityLevel(u,'A1ZW', level)
	call SetUnitAbilityLevel(u,'A2K7', level)
	call SetUnitAbilityLevel(u,'A017', level)
	call SetUnitAbilityLevel(u,'A1QD', level)
	call SetUnitAbilityLevel(u,'A1FP', level)
	call SetUnitAbilityLevel(u,'AIxk', level)
	call SetUnitAbilityLevel(u,'A0JL', level)
	call SetUnitAbilityLevel(u,'AIpg', level)
	call SetUnitAbilityLevel(u,'A2K4', level)
	call SetUnitAbilityLevel(u,'A231', level)
	call SetUnitAbilityLevel(u,'A28Y', level)
	call SetUnitAbilityLevel(u,'A12W', level)
	call SetUnitAbilityLevel(u,'A1Q8', level)
	call SetUnitAbilityLevel(u,'A0JY', level)
	call SetUnitAbilityLevel(u,'AIbk', level)
	call SetUnitAbilityLevel(u,'A1AC', level)
	call SetUnitAbilityLevel(u,'AItb', level)
	call SetUnitAbilityLevel(u,'A38V', level)
	call SetUnitAbilityLevel(u,'A395', level)
	call SetUnitAbilityLevel(u,'A39C', level)
	call SetUnitAbilityLevel(u,'A3AG', level)
	call SetUnitAbilityLevel(u,'A42I', level)
endfunction
function I8O takes nothing returns nothing
	//	call T8A(U2, 1)
endfunction
function T9A takes integer id returns boolean
	return id =='A04C' or id =='A0A2' or id =='A0MU' or id =='A0I7' or id =='Z604' or id =='A07F' or id =='A0MN' or id =='A0G6' or id =='A08Q' or id =='A1H5' or id =='A0OJ' or id =='A27G' or id =='A1S8' or id =='A010' or id =='A0RX' or id =='A2HN' or id =='A14R' or id =='A049' or id =='A33G' or id =='A26N' or id =='A0R5' or id =='A020' or id =='A0EC' or id =='A04Y' or id =='AChx' or id =='A1T7' or id =='A02O' or id =='A08Y' or id =='A08Z' or id =='A090' or id =='A092' or id =='A094'
endfunction
function UVA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call B0R(LoadUnitHandle(HY, h, 0), LoadUnitHandle(HY, h, 1), LoadInteger(HY, h, 0))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function UEA takes unit d, unit WLE, integer S6V returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, 0, false, function UVA)
	call SaveUnitHandle(HY, h, 0, d)
	call SaveUnitHandle(HY, h, 1, WLE)
	call SaveInteger(HY, h, 0, S6V)
	set t = null
endfunction
// 莲花的反弹流程
function UXA takes nothing returns nothing
	local unit t = GetSpellTargetUnit()
	local integer id = GetSpellAbilityId()
	local unit WJE = GetTriggerUnit()
	local unit u = CreateUnit(GetOwningPlayer(t),'e00E', GetUnitX(t), GetUnitY(t), 0)
	// 获取施法者的命令
	local integer S6V = GetUnitCurrentOrder(WJE)
	local integer i
	// 给马甲注册释放技能事件
	call TriggerRegisterUnitEvent(JJ, u, EVENT_UNIT_SPELL_EFFECT)
	call TriggerRegisterUnitEvent(JJ, u, EVENT_UNIT_SPELL_CAST)
	call TriggerRegisterUnitEvent(JJ, u, EVENT_UNIT_SPELL_CHANNEL)
	call TriggerRegisterUnitEvent(JJ, u, EVENT_UNIT_SPELL_ENDCAST)
	call SaveUnitHandle(HY, GetHandleId(u), 0, t)
	call T4V(t)
	call UnitAddAbility(u, id)
	call SetUnitAbilityLevel(u, id, GetUnitAbilityLevel(WJE, id))
	if id =='A04P' then
		call UnitRemoveAbility(u, id)
		set id ='A3E3'
		call UnitAddAbility(u, id)
		call SetUnitAbilityLevel(u, id, GetUnitAbilityLevel(WJE,'A04P'))
		set S6V =$D007F
	endif
	if LoadBoolean(HY, GetHandleId(WJE),'REFL') then
		set WJE = LoadUnitHandle(HY, GetHandleId(WJE),'REFL')
	endif
	// 如果在使用技能 则读取物品技能表里面的技能
	if S6V >=852008 and S6V <=852013 then
		call UnitRemoveAbility(u, id)
		set i = GetItemTypeId(UnitItemInSlot(WJE, S6V -852008))
		set id = LoadInteger(Q,'A3E9', i)
		call UnitAddAbility(u, id)
		if LoadBoolean(Q,'A3E9', i) then
			set S6V = S2I(LoadStr(Q,'A3E9', i))
		else
			set S6V = OrderId(LoadStr(Q,'A3E9', i))
		endif
	endif
	if T9A(id) then
		call UEA(u, WJE, S6V)
	else
		call B0R(u, WJE, S6V)
	endif
	set u = null
	set t = null
	set WJE = null
endfunction
function UOA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	call UnitRemoveAbility(GetTriggerUnit(), LoadInteger(HY, GetHandleId(t), 0))
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTrigger(t)
	set t = null
endfunction
function URA takes nothing returns nothing
	local unit UIA = GetSpellTargetUnit()
	local unit WJE = GetTriggerUnit()
	local integer id = GetSpellAbilityId()
	local integer level = GetUnitAbilityLevel(WJE, id)
	local trigger t
	local integer h
	if GetUnitAbilityLevel(UIA, id)== 0 then
		call UnitAddPermanentAbilitySetLevel(UIA, id, level)
		set HE = true
		if IssueTargetOrderById(UIA,$D0207, WJE) then
			set t = CreateTrigger()
			set h = GetHandleId(t)
			call TriggerRegisterUnitEvent(t, UIA, EVENT_UNIT_SPELL_ENDCAST)
			call TriggerRegisterUnitEvent(t, UIA, EVENT_UNIT_ISSUED_ORDER)
			call TriggerRegisterUnitEvent(t, UIA, EVENT_UNIT_ISSUED_TARGET_ORDER)
			call TriggerRegisterUnitEvent(t, UIA, EVENT_UNIT_ISSUED_POINT_ORDER)
			call TriggerAddCondition(t, Condition(function UOA))
			call SaveInteger(HY, h, 0, id)
			set t = null
		else
			call UnitRemoveAbility(UIA, id)
		endif
		set HE = false
	endif
	set UIA = null
	set WJE = null
endfunction
function UAA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	call EXStopUnit(LoadUnitHandle(HY, h, 0))
	call T4V(LoadUnitHandle(HY, h, 1))
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
endfunction
function UNA takes nothing returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call SaveUnitHandle(HY, h, 0, GetTriggerUnit())
	call SaveUnitHandle(HY, h, 1, GetSpellTargetUnit())
	call TimerStart(t, 0, false, function UAA)
	set t = null
endfunction
function IsSpecialAbility takes integer id returns boolean
	return id =='A06B' or id =='A471' or id =='A0LK' or id =='A27H' or id =='A05S' or id =='A08V' or id =='A1MO' or id =='A1ZI' or id =='A0FN' or id =='A0K9' or id =='A06I' or id =='A0O7' or id =='A0O6' or id =='A0O5' or id =='A1B1' or id =='A0N8' or id =='A01F' or id =='A02S' or id =='A085' or id =='QB06' or id =='A078' or id =='A1OV'
endfunction
// abilityIsDrain
function IsDrainAbility takes integer id returns boolean
	return id =='A02N' or id =='A0CC' or id =='A02Z'
endfunction
function UDA takes integer id returns boolean
	return id =='A10R'
endfunction
function UFA takes integer id returns boolean
	return id =='A02Q' or id =='A1D9'
endfunction
// 是枷锁技能
function UGA takes integer id returns boolean
	return id =='A0FL' or id =='A1CX' or id =='A00P' or id =='A02Q' or id =='A1D9'
endfunction
function UHA takes integer id returns boolean
	return id =='A0IN' or id =='A1AW' or id =='A05T' or id =='A08H' or id =='A0BZ' or id =='A004' or id =='A0FW' or id =='A0BH' or id =='A055' or id =='QB00' or id =='A0YM' or id =='A2QT' or id =='A10D' or id =='A0G4' or id =='A1D8' or id =='A190' or id =='A1NH' or id =='A2BE' or id =='A02A' or id =='A1NA' or id =='A0NM' or id =='A2LA' or id =='AHtb' or id =='QB0H' or id =='A0JC' or id =='A3FR' or id =='A0NQ'
endfunction
function UJA takes nothing returns nothing
	local integer k = 0
	loop
	exitwhen HaveSavedString(Q,'SPLL', k)== false
		call ExecuteFunc(LoadStr(Q,'SPLL', k))
		set k = k + 1
	endloop
endfunction
function RegisterUnitSpellEvent takes string s returns nothing
	local integer i = 0
	loop
	exitwhen HaveSavedString(Q,'SPLL', i)== false
		if LoadStr(Q,'SPLL', i)== s then
			return
		endif
		set i = i + 1
	endloop
	call SaveStr(Q,'SPLL', i, s)
endfunction
function ULA takes nothing returns nothing
	call DKI(GetTriggerUnit(), GetSpellAbilityId())
endfunction
function UMA takes nothing returns nothing
	call SHR(GetTriggerUnit(), GetSpellAbilityId())
endfunction
function UPA takes nothing returns nothing
	call G3R(GetTriggerUnit(), GetSpellAbilityId())
endfunction
function UQA takes nothing returns nothing
	call DQA(GetTriggerUnit(), GetSpellAbilityId())
endfunction
function USA takes nothing returns nothing
	if GetUnitAbilityLevel(GetTriggerUnit(),'B0H0')> 0 then
		call QWA(GetTriggerUnit(), GetSpellAbilityId())
	endif
endfunction

// 获取单位的冷却缩减数值
function GetUnitCoolDownReduce takes unit whichUnit, integer id returns real
	// ChakraMagicCoolDownReduce
	local real rReduceCoolDown = 0.
	local real abilityCoolDown = YDWEGetUnitAbilityDataReal(whichUnit, id, GetUnitAbilityLevel(whichUnit, id), ABILITY_DATA_COOL)
	if abilityCoolDown <= 0. then
		return rReduceCoolDown
	endif
	if GetUnitAbilityLevel(whichUnit,'A39S')== 1 then
		set rReduceCoolDown = abilityCoolDown * 0.25
	endif
	if GetUnitAbilityLevel(whichUnit,'B3DU')== 1 then
		// 是物品技能就不减cd
		if not IsNotItemAbility(id) then
			return rReduceCoolDown
		endif
		if GetUnitAbilityLevel(whichUnit,'A3DU')== 1 then
				//	call LFX(whichUnit, id, false, 2)
			set rReduceCoolDown = rReduceCoolDown + 2
			call UnitRemoveAbility(whichUnit,'A3DU')
		elseif GetUnitAbilityLevel(whichUnit,'A3DV')== 1 then
			//	call LFX(whichUnit, id, false, 3)
			set rReduceCoolDown = rReduceCoolDown + 3
			call UnitRemoveAbility(whichUnit,'A3DV')
		elseif GetUnitAbilityLevel(whichUnit,'A3DW')== 1 then
				//	call LFX(whichUnit, id, false, 4)
			set rReduceCoolDown = rReduceCoolDown + 4
			call UnitRemoveAbility(whichUnit,'A3DW')
		elseif GetUnitAbilityLevel(whichUnit,'A3DX')== 1 then
				//	call LFX(whichUnit, id, false, 5)
			set rReduceCoolDown = rReduceCoolDown + 5
			call UnitRemoveAbility(whichUnit,'A3DX')
		endif
		call UnitRemoveAbility(whichUnit,'B3DU')
	endif
	return rReduceCoolDown
endfunction

// 释放技能事件
function UTA takes unit whichUnit, integer id returns nothing
	local integer lv = GetUnitAbilityLevel(whichUnit, id)
	local unit targetUnit = GetSpellTargetUnit()
	local real rReduceCoolDown = GetUnitCoolDownReduce(whichUnit, id)
	local integer h = GetHandleId(whichUnit)
	if rReduceCoolDown > 0. and YDWEGetUnitAbilityState(whichUnit, id, 1) == 0.00 then
		call Japi_ReduceUnitAbilityCoolDown(whichUnit, id, rReduceCoolDown)
	endif
	/*if HaveSavedInteger(ExtraHT, h, WIND_WALK_ATTACK_BUFF_ID) then
		call RemoveSavedReal(ExtraHT, h, WIND_WALK_ATTACK_DAMAGE)
		call RemoveSavedInteger(ExtraHT, h, WIND_WALK_ATTACK_BUFF_ID)
	endif*/
	if UnitIsInWindWalk(whichUnit) then
		call UnitWindWalkAttackAcionts(whichUnit, false)
		call RemoveSavedInteger(ExtraHT, h, WIND_WALK_BUFF_ID)
	endif
	// 技能施法目标 不等于没有 并且是技能目标的敌对玩家 有莲花 而且施法者不是蝗虫
	// 莲花的判断
	if targetUnit!= null and IsUnitEnemy(whichUnit, GetOwningPlayer(targetUnit)) and GetUnitAbilityLevel(targetUnit,'A3E9')== 1 and(GetUnitAbilityLevel(whichUnit,'Aloc')== 0 or LoadBoolean(HY, GetHandleId(whichUnit),'REFL')) then
		// 技能不等于攻击特效 不等于汲取技能(生命魔法) 不等于吞噬技能 不是特殊技能 不是莲花技能 还有一些奇怪的技能不能被反弹
		if not IsAttackSpecialEffectsId(id) and not UDA(id) and not IsSpecialAbility(id) and not HE and not UHA(id) then
			if IsDrainAbility(id) then
				call URA()
			else
				// 不是枷锁技能
				if not UGA(id) then
					call UXA()
				// 不是恶魔的掌握
				elseif not UFA(id) then
					call UNA()
				endif
			endif
		endif
	endif
	// 遍历释放技能事件 ExecuteFunc(func) 感觉效率有点低
	call UJA()

	if X2R(id) then
		call X3R(whichUnit, id)
	endif
	if IsAttackSpecialEffectsId(id) then
		call AttackEventActions(whichUnit, targetUnit, true)
	endif
	call SXX()
	set targetUnit = null
endfunction
function UUA takes unit u, integer S6V, eventid id returns nothing
	if id == EVENT_UNIT_ISSUED_ORDER then
		if GetUnitAbilityLevel(u,'A0QN')> 0 then
			if S6V ==$D011F or S6V ==$D01EA then
				call SaveBoolean(P, GetHandleId(u),'A0QN', true)
				call UnitAddPermanentAbility(u,'A40H')
			elseif S6V ==$D0120 or S6V ==$D01EB then
				call SaveBoolean(P, GetHandleId(u),'A0QN', false)
				call UnitRemoveAbility(u,'A40H')
			endif
		endif
		if S6V ==852129 and(C5X(u) or RCX(u)) then
			if GetUnitAbilityLevel(u,'A0NS')> 0 or GetUnitAbilityLevel(u,'A1DA')> 0 then
				if YDWEGetUnitAbilityState(u, 'A0NS', 1) == 0. and YDWEGetUnitAbilityState(u, 'A1DA', 1) == 0. then
					call UnitSpellEffect__BorrowedTime(u, GetHandleId(u))
				//else
				//	call InterfaceErrorForPlayer(GetOwningPlayer(GetTriggerUnit()), "技能尚未就绪。")
				endif
			endif
		endif
	endif
	if id == EVENT_UNIT_ISSUED_TARGET_ORDER then
		if GetUnitAbilityLevel(u,'A0QN')> 0 then
			if S6V ==852225 then
				call EXStopUnit(u)
				set EI = true
				call IssueTargetOrderById(u,$D0011, GetOrderTargetUnit())
				set EI = false
				call UnitAddPermanentAbility(u,'A40H')
				call SaveBoolean(P, GetHandleId(u),'A0QN'+ 1, true)
				call SaveUnitHandle(P, GetHandleId(u),'A0QN'+ 1, GetOrderTargetUnit())
			endif
		endif
	endif
	call DSA(u, S6V)
	call QRA(u)
endfunction

function UYA takes nothing returns nothing
	local integer i = GetUnitAbilityLevel(SV,'A3B8')
	local real x = GetUnitX(SV)
	local real y = GetUnitY(SV)
	local player p = Player(LoadInteger(HY, GetHandleId(SV),'A3B8'))
	local unit u
	if p == Player(0) then
		return
	endif
	if i == 0 then
		set i = GetUnitAbilityLevel(Player__Hero[LoadInteger(HY, GetHandleId(SV),'A3B8')],'A0BH')
	endif
	if i == 0 then
		set i = 4
	endif
	loop
		set u = CreateUnit(p,'n019', x, y, 0)
		call UnitApplyTimedLife(u,'BTLF', 60)
		set i = i -1
	exitwhen i == 0
	endloop
endfunction
function UZA takes nothing returns nothing
	if LoadInteger(HY, GetHandleId(SV),'A3B8')> 0 then
		call UYA()
	endif
endfunction

function U0A takes nothing returns boolean
	return GetUnitAbilityLevel(GetFilterUnit(),'B3JF')> 0 and IsUnitAlly(GetFilterUnit(), E3) and IsAliveNotStrucNotWard(GetFilterUnit()) and GetFilterUnit()!= RoShan
endfunction

function DragonHideAura__Actions takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local group AIR = LoadGroupHandle(HY, h, 1)
	local unit u = LoadUnitHandle(HY, h, 0)
	local unit u2
	local group g
	local group gg
	local integer AAR
	local integer ANR
	if not UnitAlive(u) or u == null then
		call FlushChildHashtable(HY, h)
		call PauseTimer(t)
		call DestroyTimer(t)
		loop
			set u2 = FirstOfGroup(AIR)
		exitwhen u2 == null
			call GroupRemoveUnit(AIR, u2)
			call LodSystem_ReduceUnitExtraState(u2, 2, STATE_SYSTEM_ARMOUR)
		endloop
		call LogoutGroup(AIR)
	else
		set g = LoginGroup(492)
		set E3 = GetOwningPlayer(u)
		call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 925, Condition(function U0A))
		set gg = LoginGroup(493)
		call GroupAddGroup(AIR, gg)
		loop
			set u2 = FirstOfGroup(gg)
		exitwhen u2 == null
			if IsUnitInGroup(u2, g)== false then
				call GroupRemoveUnit(AIR, u2)
				call LodSystem_ReduceUnitExtraState(u2, 2, STATE_SYSTEM_ARMOUR)
			endif
			call GroupRemoveUnit(gg, u2)
		endloop
		call LogoutGroup(gg)
		loop
			set u2 = FirstOfGroup(g)
		exitwhen u2 == null
			if IsUnitInGroup(u2, AIR)== false then
				call LodSystem_AddUnitExtraState(u2, 2, STATE_SYSTEM_ARMOUR)
			endif
			call GroupRemoveUnit(g, u2)
			call GroupAddUnit(AIR, u2)
		endloop
		call LogoutGroup(g)
	endif
	set t = null
	set AIR = null
	set u = null
	set g = null
	set gg = null
endfunction

// 龙隐光环
function UnitAddDragonHideAura takes unit u returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .5, true, function DragonHideAura__Actions)
	call SaveUnitHandle(HY, h, 0, u)
	call SaveGroupHandle(HY, h, 1, LoginGroup(494))
	set t = null
endfunction

// 任意单位进入地图2
function CommonUnitEnterMapActions takes unit whichUnit returns nothing
	local player whichPlayer = GetOwningPlayer(whichUnit)
	local integer typeId = GetUnitTypeId(whichUnit)
	local integer level = 0
	// 召唤 幽魂 DP大
	if typeId =='u00G' then
		call GhoulEnterMapActions(whichUnit)
	// 召唤树人(应该是先知的)
	elseif typeId =='efon' or typeId =='efo2' then
		call TreantEnterMapActions(whichUnit)
	// 召唤小蜘蛛
	elseif typeId =='n01E' or typeId =='n019' then
		call SpideriteEnterMapActions(whichUnit)
	// 召唤小狼
	elseif typeId =='o005' or typeId =='o006' or typeId =='o007' or typeId =='o00F' then
		call LycanWolfEnterMapActions(whichUnit)
	// 召唤蛇棒
	elseif typeId =='osp4' or typeId =='o008' or typeId =='o009' or typeId =='o01C' or typeId =='o01D' or typeId =='o01E'then
		call SerpentWardEnterMapActions(whichUnit)
		call SaveBoolean(ExtraHT, GetHandleId(whichUnit), 'A00H', true)
	// 召唤守望者(宇宙兽人)
	elseif typeId =='ushd' then
		call WarderEnterMapActions(whichUnit)
	// 召唤甲虫(宇宙兽人)
	elseif typeId =='u012' then
		call ScarabEnterMapActions(whichUnit)
	// 真假眼
	elseif typeId =='o004' or typeId =='oeye' then
		call R2O(whichUnit, whichUnit)
		// 真眼额外设置视野
		if typeId =='oeye' then
			call A8X(whichPlayer, 12, GetUnitX(whichUnit), GetUnitY(whichUnit), 150)
		endif
	elseif typeId =='n020' then
		// 活死人
		set level = GetUnitAbilityLevel(Player__Hero[GetPlayerId(whichPlayer)],'A0A8')
		// 活死人协同升级
		if level > 0 then
			call UnitAddPermanentAbilitySetLevel(whichUnit,'A3J8', level)
			call UnitAddPermanentAbilitySetLevel(whichUnit,'A3J9', level)
		endif
		// Japi设置最大生命值 节省一下效率
		call UnitAddMaxLife(whichUnit, R2I(GetUnitState(Player__Hero[GetPlayerId(whichPlayer)], UNIT_STATE_MAX_LIFE)*(.2 + .05 * level)))
		// call UnitAddMaxLife(u, R2I(GetUnitState(Player__Hero[GetPlayerId(whichPlayer)], UNIT_STATE_MAX_LIFE)*(.2 + .05 * i)))
	endif
	//if IsUnitIllusion(whichUnit) then
	//	call W1E(whichUnit)
	//endif
	// 野怪进入
	if whichPlayer == BW or whichPlayer == Sentinels[0] or whichPlayer == Scourges[0]then
		// 反低级开图者 错误的图标坐标 然并卵 并且还与网易平台的观战系统冲突

		// 待优化 都是二进制属性系统增加的属性
		// 如果有宝石傀儡光环
		if GetUnitAbilityLevel(whichUnit,'A44G')> 0 then
			call UnitAddGraniteAura(whichUnit)
		endif
		// 龙隐光环
		if GetUnitAbilityLevel(whichUnit,'A3JF')> 0 then
			call UnitAddDragonHideAura(whichUnit)
		endif
	endif
	if not Mode__SixSkills and GetUnitAbilityLevel(whichUnit, 'A3J6') > 0 then
		call UnitRemoveAbility(whichUnit, 'A3J6')
	endif
endfunction

// 注册任意单位事件 过滤
function AnyUnitEventRegisterFilter takes nothing returns boolean
	local unit whichUnit = GetEnteringUnit()
	local integer typeId = GetUnitTypeId(whichUnit)
	if whichUnit != null and GetUnitAbilityLevel(whichUnit,'Aloc')== 0 and UnitIsCanRegisterUnitEvent(whichUnit) then
		if IsUnitType(whichUnit, UNIT_TYPE_HERO) then
			if InHeroSelection then
				set whichUnit = null
				return false
			else
				call RegisterHeroEventFilter(whichUnit)
			endif
		else
			call CommonUnitEnterMapActions(whichUnit)
		endif

		if IsHeroUnitId(typeId) then
			call SaveReal(ExtraHT, GetHandleId(whichUnit), HTKEY_UNIT_ACTULA_MAGIC_RESISTANCE, 0.75)
		else
			call SaveReal(ExtraHT, GetHandleId(whichUnit), HTKEY_UNIT_ACTULA_MAGIC_RESISTANCE, GetUnitBaseMagicResistanceByType(typeId))
		endif

		//call SingleDebug("给 " + GetUnitName(whichUnit) + " " + YDWEId2S(typeId)  + " 单位注册任意单位受伤事件" )
		call TriggerRegisterUnitEvent(AnyUnitDamagedTrigger, whichUnit, EVENT_UNIT_DAMAGED)
	endif
	set whichUnit = null
	return false
endfunction

function NYR takes nothing returns nothing
	local trigger t = CreateTrigger()

	// 幻象被召唤
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function SummonedIllusionUnitEvnet))
	// 初始化被动技能表
	call ExecuteFunc("InitPassiveSkills")
	set t = null
endfunction
function WEA takes string s returns nothing
	local integer i = 0
	loop
	exitwhen HaveSavedString(Q,'DEAD', i)== false
		if LoadStr(Q,'DEAD', i)== s then
			return
		endif
		set i = i + 1
	endloop
	call SaveStr(Q,'DEAD', i, s)
endfunction
function WXA takes nothing returns nothing
endfunction
function OnDeath_Rot_SuicideWrapper takes nothing returns nothing
	call WEA("WXA")
endfunction
function WOA takes nothing returns nothing
endfunction
function OnDeath_BH_TrackKillWrapper takes nothing returns nothing
	call WEA("WOA")
endfunction
function WRA takes nothing returns nothing
	call OSI(TV, SV)
endfunction
function WIA takes nothing returns nothing
	call WEA("WRA")
endfunction
function WAA takes nothing returns nothing
	call QWR(SV)
endfunction
function WNA takes nothing returns nothing
	call WEA("WAA")
endfunction
function WBA takes nothing returns nothing
	if IsUnitType(SV, UNIT_TYPE_HERO) and GetUnitAbilityLevel(SV,'ACac')> 0 and XFX(GetOwningPlayer(TV)) and IsUnitEnemy(TV, GetOwningPlayer(SV)) then
		if IsUnitType(TV, UNIT_TYPE_HERO) then
			call BPI(GetUnitAbilityLevel(SV,'ACac'), TV, SV)
		else
			if UnitIsDead(Player__Hero[GetPlayerId(GetOwningPlayer(TV))])== false then
				call BPI(GetUnitAbilityLevel(SV,'ACac'), Player__Hero[GetPlayerId(GetOwningPlayer(TV))], SV)
			endif
		endif
	endif
endfunction
function WCA takes nothing returns nothing
	call WEA("WBA")
endfunction
function WDA takes nothing returns nothing
	call AJI(SV)
endfunction
function WFA takes nothing returns nothing
	call WEA("WDA")
endfunction
function WGA takes nothing returns nothing
	call PIA(SV)
endfunction
function WHA takes nothing returns nothing
	call WEA("WGA")
endfunction
function WJA takes nothing returns nothing
	call B4I(SV)
endfunction
function WKA takes nothing returns nothing
	call WEA("WJA")
endfunction
function OnDeath_CourierDeath takes nothing returns nothing
	call ZRX(SV)
endfunction
function WLA takes nothing returns nothing
	call III(TV, SV)
	call R9I(SV)
endfunction
function WMA takes nothing returns nothing
	call WEA("WLA")
endfunction
function WPA takes nothing returns nothing
	call UZA()
endfunction
function WQA takes nothing returns nothing
	call WEA("WPA")
endfunction
function WSA takes nothing returns nothing
	call WEA("UNR")
endfunction
function WTA takes nothing returns nothing
	call FJR(TV, SV)
endfunction
function WUA takes nothing returns nothing
	call WEA("WTA")
endfunction
function WWA takes nothing returns nothing
	call G1I(TV, SV)
endfunction
function WYA takes nothing returns nothing
	call WEA("WWA")
endfunction
function WZA takes nothing returns nothing
	call Y4I(TV, SV)
endfunction
function W_A takes nothing returns nothing
	call WEA("WZA")
endfunction
function W0A takes nothing returns nothing
	call ZCI(TV, SV)
endfunction
function W1A takes nothing returns nothing
	call WEA("W0A")
endfunction
function W2A takes nothing returns nothing
	local integer k = 0
	loop
	exitwhen HaveSavedString(Q,'DEAD', k)== false
		call ExecuteFunc(LoadStr(Q,'DEAD', k))
		set k = k + 1
	endloop
endfunction
function W3A takes unit SYX, unit SZX returns nothing
	local unit deathUnit = GetTriggerUnit()
	local integer h
	if LoadBoolean(M, GetUnitTypeId(SZX), 0) or IsUnitIllusion(SZX) then
		return
	endif
	set SV = SZX
	set TV = SYX
	if IsUnitType(SZX, UNIT_TYPE_HERO) and LoadBoolean(HY, GetHandleId(SZX), QR)== false then
	else
		call SWX(SYX, SZX)
		call ZRX(SZX)
		call I6O(SYX, SZX)
		call Q6A(SYX, SZX)
	endif
	call W2A()

	set deathUnit = null
endfunction
function W4A takes unit u, unit t, real d returns nothing
	if d > 0 then
		call D6I(t, d)
	endif
endfunction
function W5A takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local unit WJE = LoadUnitHandle(HY, GetHandleId(t), 0)
	local unit u = CreateUnit(GetOwningPlayer(WJE),'e00E', GetUnitX(WJE), GetUnitY(WJE), 0)
	local integer id ='QFZX'
	call UnitRemoveAbility(WJE,'Broa')
	if Mode__BalanceOff == false and((GetUnitAbilityLevel(WJE,'A0CG')> 0 and IsUnitType(WJE, UNIT_TYPE_MELEE_ATTACKER)) or GetUnitAbilityLevel(WJE,'A1IQ')> 0 or GetUnitAbilityLevel(WJE,'A13T')> 0 or GetUnitAbilityLevel(WJE,'A1YQ')> 0 or GetUnitAbilityLevel(WJE,'A3DE')> 0 or GetUnitAbilityLevel(WJE,'A2H0')> 0 or GetUnitAbilityLevel(WJE,'QB0L')> 0 or GetUnitAbilityLevel(WJE,'A0KX')> 0) then
		set id ='QFZY'
	endif
	call UnitAddAbility(u, id)
	call SetUnitAbilityLevel(u, id, GetUnitAbilityLevel(WJE,'A0DL'))
	call IssueImmediateOrderById(u,$D00C4)
	call FlushChildHashtable(HY, GetHandleId(t))
	call DestroyTrigger(t)
	set t = null
	set u = null
	set WJE = null
	return false
endfunction
function SpellEffect__EnchantTotem takes nothing returns nothing
	local unit WJE
	local trigger t
	set WJE = GetTriggerUnit()
	set t = CreateTrigger()

	call AddAttackLaunchingTrigCount(WJE)

	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerAddCondition(t, Condition(function W5A))
	call SaveUnitHandle(HY, GetHandleId(t), 0, WJE)
	set t = null
	set WJE = null
endfunction
function W6A takes unit u returns nothing
	if GetUnitAbilityLevel(u,'Aetl')> 0 or GetUnitAbilityLevel(u,'B017')> 0 then
		call EXStopUnit(u)
	endif
endfunction
function W7A takes nothing returns boolean
	local unit u = null
	local integer i = GetSpellAbilityId()
	local integer l
	local eventid id = GetTriggerEventId()
	if i != 0 then
		if id == EVENT_UNIT_SPELL_EFFECT then
			// 发动技能效果
			//	if WQV()== false then
			if G then
				call BJDebugMsg(GetUnitName(u)+ " has used " + GetObjectName(i)+ " [" + UGV(i)+ "]")
			endif
			call UTA(GetTriggerUnit(), i)
			if HaveSavedString(P, i, 0) then
				call ExecuteFunc(LoadStr(P, i, 0))
			endif
			//	endif
		elseif id == EVENT_UNIT_SPELL_ENDCAST then
			// 停止施法
			if HaveSavedString(P, i, 1) then
				call ExecuteFunc(LoadStr(P, i, 1))
			endif
		elseif id == EVENT_UNIT_SPELL_FINISH then
			// 结束施法
			if HaveSavedString(P, i, 2) then
				call ExecuteFunc(LoadStr(P, i, 2))
			endif
		elseif id == EVENT_UNIT_SPELL_CAST then
			// 开始施法
			if IsAttackSpecialEffectsId(i) then
				call W6A(GetTriggerUnit())
				call NethertoxinActions(GetTriggerUnit(), GetSpellTargetUnit())
				call KrakenShellActions(GetTriggerUnit(), GetSpellTargetUnit())
			endif
			if HaveSavedString(P, i, 3) then
				call ExecuteFunc(LoadStr(P, i, 3))
			endif
		elseif id == EVENT_UNIT_SPELL_CHANNEL then
			// 准备施法
			if HaveSavedString(P, i, 7) then
				call ExecuteFunc(LoadStr(P, i, 7))
			endif
		endif
	endif
	if id == EVENT_UNIT_HERO_SKILL then
		// 学技能
		set u = GetTriggerUnit()
		set i = GetLearnedSkill()
		set l = GetLearnedSkillLevel()
		call W1V(u, i, l)
		if HaveSavedString(P, i, 5) then
			call ExecuteFunc(LoadStr(P, i, 5))
		endif
		if l == 1 then
			// 学习 1 级技能
			if HaveSavedString(P, i, 4) then
				call ExecuteFunc(LoadStr(P, i, 4))
			endif
		endif
		set u = null

	elseif id == EVENT_PLAYER_UNIT_ATTACKED then
		// 单位被攻击
		call UWA(GetAttacker(), GetTriggerUnit())
	elseif id == EVENT_UNIT_ISSUED_ORDER or id == EVENT_UNIT_ISSUED_POINT_ORDER or id == EVENT_UNIT_ISSUED_TARGET_ORDER then
		// 发布无目标 指定点目标 指定单位目标
		call UUA(GetTriggerUnit(), GetIssuedOrderId(), id)
	elseif id == EVENT_PLAYER_UNIT_DEATH then
		// 单位死亡
		call W3A(GetKillingUnit(), GetTriggerUnit())
	elseif id == EVENT_UNIT_SUMMON then
		// 单位被召唤
		set u = GetSummoningUnit()
		if HaveSavedString(P, LoadInteger(P, GetHandleId(u),'SPEL'), 9) then
			call ExecuteFunc(LoadStr(P, LoadInteger(P, GetHandleId(u),'SPEL'), 9))
		endif
		set u = null
	elseif id == EVENT_UNIT_DAMAGED then
		// 单位被伤害
		call W4A(GetEventDamageSource(), GetTriggerUnit(), GetEventDamage())
	endif
	set u = null
	set id = null
	return false
endfunction
function W8A takes nothing returns boolean
	if HaveSavedString(P, StringHash(GetEventPlayerChatString()), 10) then
		call ExecuteFunc(LoadStr(P, StringHash(GetEventPlayerChatString()), 10))
	endif
	return false
endfunction

function W9A takes integer LQO, integer r, integer g, integer b, integer a, real x, real y, integer h returns nothing
	local string s = I2S(LQO)
	local integer i1
	local integer i2
	local integer i3
	if LQO > 99 then
		set Q3V[1]= true
		set Q3V[2]= true
		set Q3V[3]= true
		call TXV("Fonts\\" + SubString(s, 0, 1)+ ".blp", 61, 61, x -50, y, 0, true)
		call SaveImageHandle(HY, h,$5F0, R3)
		call SetImageColor(R3, r, g, b, a)
		call TXV("Fonts\\" + SubString(s, 1, 2)+ ".blp", 61, 61, x -20, y, 0, true)
		call SaveImageHandle(HY, h,$5F1, R3)
		call SetImageColor(R3, r, g, b, a)
		call TXV("Fonts\\" + SubString(s, 2, 3)+ ".blp", 61, 61, x + 20, y, 0, true)
		call SaveImageHandle(HY, h,$5F2, R3)
		call SetImageColor(R3, r, g, b, a)
	elseif LQO > 9 then
		set Q3V[2]= true
		set Q3V[3]= true
		call TXV("Fonts\\" + SubString(s, 0, 1)+ ".blp", 61, 61, x -33, y, 0, true)
		call SaveImageHandle(HY, h,$5F1, R3)
		call SetImageColor(R3, r, g, b, a)
		call TXV("Fonts\\" + SubString(s, 1, 2)+ ".blp", 61, 61, x -3, y, 0, true)
		call SaveImageHandle(HY, h,$5F2, R3)
		call SetImageColor(R3, r, g, b, a)
	else
		set Q3V[2]= true
		set Q3V[3]= true
		call PlaySoundBJ(AN)
		call TXV("Fonts\\0.blp", 61, 61, x -33, y, 0, true)
		call SaveImageHandle(HY, h,$5F1, R3)
		call SetImageColor(R3, r, g, b, a)
		call TXV("Fonts\\" + s + ".blp", 61, 61, x -3, y, 0, true)
		call SaveImageHandle(HY, h,$5F2, R3)
		call SetImageColor(R3, r, g, b, a)
	endif
endfunction
function YVA takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local integer i = R2I(TimerGetRemaining(NK))
	local image im
	local integer k = 1
	loop
		set TQ[k]= GetGameTime()
		set k = k + 1
	exitwhen k >$B
	endloop
	if Q3V[1]then
		set im = LoadImageHandle(HY, h,$5F0)
		call DestroyImage(im)
		set Q3V[1]= false
	endif
	if Q3V[2]then
		set im = LoadImageHandle(HY, h,$5F1)
		call DestroyImage(im)
		set Q3V[2]= false
	endif
	if Q3V[3]then
		set im = LoadImageHandle(HY, h,$5F2)
		call DestroyImage(im)
		set Q3V[3]= false
	endif
	if i == 0 or GP then
		call FlushChildHashtable(HY, h)
		call DestroyTrigger(t)
	else
		if(GKV or Mode__MirrorDraft) and(Mode__Draft30 or Mode__Draft40 or Mode__Draft50) then
			call W9A(i, 255, 2, 2, 255,-6454, 6945, h)
		else
			call W9A(i, 255, 2, 2, 255,-6970, 6726, h)
		endif
	endif
	set t = null
endfunction
function X1R takes nothing returns nothing
	local real x
	local real y
	set Q4V = CreateTrigger()
	set AN = CreateSound("Sound\\Interface\\BattleNetTick.wav", false, false, false, 10, 10, "")
	call SetSoundParamsFromLabel(AN, "ChatroomTimerTick")
	call SetSoundDuration(AN, 476)
	call TriggerRegisterTimerEvent(Q4V, 1, true)
	call TriggerAddCondition(Q4V, Condition(function YVA))
	call TriggerEvaluate(Q4V)
	if GKV or Mode__MirrorDraft then
		set HR = CreateUnit(NeutralPassivePlayer,'h302',-7200, 7300, 270)
		set JR = CreateUnit(NeutralPassivePlayer,'h302',-7400, 7300, 270)
		set KR = CreateUnit(NeutralPassivePlayer,'h303',-6600, 7300, 270)
		set LR = CreateUnit(NeutralPassivePlayer,'h303',-6800, 7300, 270)
		set IR = CreateUnit(NeutralPassivePlayer,'h306',-6995, 7300, 270)
	else
		set HR = CreateUnit(NeutralPassivePlayer,'h302',-7070, 6936, 270)
		set JR = CreateUnit(NeutralPassivePlayer,'h302',-7070, 6616, 270)
		set KR = CreateUnit(NeutralPassivePlayer,'h303',-6920, 6616, 270)
		set LR = CreateUnit(NeutralPassivePlayer,'h303',-6920, 6936, 270)
		set IR = CreateUnit(NeutralPassivePlayer,'h306',-6995, 7200, 270)
	endif
endfunction
function YEA takes nothing returns boolean
	local integer i = 1
	local integer k = 0
	local item it = null
	local boolean f = false
	local integer h = GetHandleId(GetTriggeringTrigger())
	local real WIE = GetGameTime()
	loop
		if UnitAlive(Player__Hero[i]) and TimerGetRemaining(PS[i])<= 0 and WIE -LoadReal(HY, h, GetHandleId(Player__Hero[i]))> 2 then
			call SaveReal(HY, h, GetHandleId(Player__Hero[i]), WIE)
			set k = 0
			loop
			exitwhen k > 5
				set it = UnitItemInSlot(Player__Hero[i], k)
				if it != null then
					if UUV(it)==-1 then
						call UnitRemoveItem(Player__Hero[i], it)
					else
						call XKO(Player__Hero[i], it)
					endif
				endif
				set k = k + 1
			endloop
		endif
		set i = i + 1
		if i == 6 then
			set i = 7
		endif
	exitwhen i >$C
	endloop
	set it = null
	return false
endfunction


function YNA takes nothing returns nothing
	local unit KKX
	local unit W_V
	local integer i = 1
	local integer level = 0
	local boolean b = Mode__FiveSkills or Mode__SixSkills
	if InHeroSelection then
		set KKX = null
		set W_V = null
		return
	endif
	loop
		set KKX = Player__Hero[i]
		set W_V = VB[i]
		set level = GetUnitAbilityLevel(KKX,'A086')
		if level == 0 and b then
			if HeroCommonSkills[PlayerSkillIndex[i * HL + 5]]=='P247' then
				set level = IP[i * 2 + 1]
			endif
		endif
		if level > 0 then
			if IsDayTime() or GetUnitAbilityLevel(KKX,'A36D')== 1 then
				if GetUnitAbilityLevel(W_V,'A330')!= 0 then
					call UnitRemoveAbility(W_V,'A330')
				endif
				if M2[GetPlayerId(GetOwningPlayer(KKX))]== false then
					if GetUnitAbilityLevel(KKX,'P247')> 0 and GetUnitAbilityLevel(KKX,'P247')!= 5 then
						call SetUnitAbilityLevel(KKX,'P247', 5)
					endif
					if GetUnitAbilityLevel(KKX,'A116')> 0 then
						call UnitRemoveAbility(KKX,'A116')
						call UnitRemoveAbility(KKX,'A117')
					endif
				endif
			else
				if GetUnitAbilityLevel(W_V,'A330')!= level then
					call UnitAddPermanentAbility(W_V,'A330')
					call SetUnitAbilityLevel(W_V,'A330', level)
				endif
				if M2[GetPlayerId(GetOwningPlayer(KKX))]== false then
					if GetUnitAbilityLevel(KKX,'P247')!= level then
						call SetUnitAbilityLevel(KKX,'P247', level)
					endif
					if GetUnitAbilityLevel(KKX,'A116')== 0 then
						call UnitAddPermanentAbility(KKX,'A116')
						call UnitAddPermanentAbility(KKX,'A117')
					endif
				endif
			endif
		elseif GetUnitAbilityLevel(W_V,'A330')> 0 then
			call UnitRemoveAbility(W_V,'A330')
		endif
		if UnitIsDead(KKX)== false and M2[GetPlayerId(GetOwningPlayer(KKX))]== false and(GetUnitAbilityLevel(KKX,'A08E')> 0 or HeroCommonSkills[PlayerSkillIndex[GetPlayerId(GetOwningPlayer(KKX))* HL + 5]]=='A08Q') then
			if IsDayTime()== false then
				if GetUnitAbilityLevel(KKX,'A08E')> 0 then
					call sckj(KKX, true)
				else
					call sckj(KKX, true)
				endif
			else
				call sckj(KKX, false)
			endif
		endif
		set i = i + 1
		if i == 6 then
			set i = 7
		endif
	exitwhen i >$B
	endloop
	set KKX = null
	set W_V = null
endfunction
function MFX takes nothing returns nothing
	local timer t = CreateTimer()
	local integer i = 1
	loop
		set VB[i]= CreateUnit(Player(i),'e00C', 0, 0, 0)
		call UnitAddPermanentAbility(VB[i],'Aloc')
		set i = i + 1
		if i == 6 then
			set i = 7
		endif
	exitwhen i >$B
	endloop
	call TimerStart(t, 1, true, function YNA)
	set t = null
endfunction
function YBA takes nothing returns nothing
	local unit t = GetEnumUnit()
	if LoadInteger(HY, GetHandleId(t), 4341)!= 1 then
		call EPX(t, 4341, .99)
		call UnitDamageTargetEx(SQX(H), t, 1, 50)
	endif
	call AddAbilityToTimed(t,'A3Q1', 1, 1.,'B3DJ')
	set t = null
endfunction
function YCA takes nothing returns boolean //辉耀，此物品本身自带龙卷风破坏光环'A04I'，看情况可删除。
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 14)
	local group g = null
	if GetTriggerEventId()== EVENT_UNIT_DROP_ITEM then
		if GetManipulatedItem()== LoadItemHandle(HY, h , 96) then
			call FlushChildHashtable(HY,(h))
			call CleanCurrentTrigger(t)
		endif
	else
		if u == null then
			call FlushChildHashtable(HY,(h))
			call CleanCurrentTrigger(t)
		endif
		if UnitAlive(u) then
			set g = LoginGroup(495)
			set U2 = u
			call GroupEnumUnitsInRange(g, GetUnitX(u), GetUnitY(u), 725, Condition(function DPX))
			set H = u
			call EnableEffectByTime(N, 2.)
			//set bj_makeUnitRescuableUnit = CreateUnit(GetOwningPlayer(u),'e00E', 0, 0, 0)
			//call UnitAddAbility(bj_makeUnitRescuableUnit,'A3DJ')
			call ForGroup(g, function YBA)
			//call UnitRemoveAbility(bj_makeUnitRescuableUnit,'A3DJ')
			call LogoutGroup(g)
			set g = null
		endif
	endif
	set t = null
	set u = null
	return false
endfunction
// 获得辉耀
function PickRadianceItem takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DROP_ITEM)
	call TriggerAddCondition(t, Condition(function YCA))
	call SaveUnitHandle(HY, h, 14, u)
	call SaveItemHandle(HY, h, 96, GetManipulatedItem() )
	set t = null
endfunction
function YFA takes nothing returns boolean
	return IsUnitAlly(U2, GetOwningPlayer(GetFilterUnit())) and IsAliveNotStrucNotWard(GetFilterUnit())
endfunction
function YGA takes nothing returns nothing
	call UnitRemoveAbility(GetEnumUnit(),'A393')
	call UnitRemoveAbility(GetEnumUnit(),'A394')
	call UnitRemoveAbility(GetEnumUnit(),'A3E2')
endfunction
function YHA takes nothing returns nothing
	if GetUnitAbilityLevel(GetEnumUnit(),'A393')== 0 then
		call UnitAddPermanentAbility(GetEnumUnit(),'A393')
		call UnitAddPermanentAbility(GetEnumUnit(),'A394')
	endif
	if IsHeroUnitId(GetUnitTypeId(GetEnumUnit())) then
		if GetWidgetLife(GetEnumUnit())/ GetUnitState(GetEnumUnit(), UNIT_STATE_MAX_LIFE)<= .2 then
			call SetUnitAbilityLevel(GetEnumUnit(),'A393', 2)
			call UnitAddPermanentAbility(GetEnumUnit(),'A3E2')
		elseif GetUnitAbilityLevel(GetEnumUnit(),'A393')== 2 then
			call SetUnitAbilityLevel(GetEnumUnit(),'A393', 1)
			call UnitRemoveAbility(GetEnumUnit(),'A3E2')
		endif
	endif
endfunction
function YJA takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u =(LoadUnitHandle(HY,(h), 2))
	local group g =(LoadGroupHandle(HY,(h), 340))
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	local group gg
	if u == null or(GetTriggerEventId()== EVENT_UNIT_DROP_ITEM and GetManipulatedItem()== LoadItemHandle(HY,(h), 96)) then
		call FlushChildHashtable(HY,(h))
		call CleanCurrentTrigger(t)
		call ForGroup(g, function YGA)
		call LogoutGroup(g)
		set t = null
		return false
	endif
	set gg = LoginGroup(496)
	set U2 = u
	if UnitAlive(u) then
		set U2 = u
		call GroupEnumUnitsInRange(gg, x, y, 925, Condition(function YFA))
	endif
	call GroupRemoveGroup(gg, g)
	call ForGroup(g, function YGA)
	if UnitAlive(u) then
		call ForGroup(gg, function YHA)
	endif
	call SaveGroupHandle(HY,(h), 340,(gg))
	call LogoutGroup(g)
	set t = null
	set u = null
	set g = null
	set gg = null
	return false
endfunction
// 获得 卫士胫甲
function PickGuardianGreavesItem takes unit u returns nothing
	local trigger t = CreateTrigger()
	local integer h = GetHandleId(t)
	call TriggerRegisterTimerEvent(t, .3, true)
	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_DROP_ITEM)
	call TriggerAddCondition(t, Condition(function YJA))
	call SaveItemHandle(HY,(h), 96,(GetManipulatedItem()))
	call SaveUnitHandle(HY,(h), 2,(u))
	call SaveGroupHandle(HY,(h), 340,(LoginGroup(497)))
	set t = null
endfunction


// 获取物品和单位被召唤
function YTA takes nothing returns boolean
	if GetTriggerEventId()== EVENT_PLAYER_UNIT_PICKUP_ITEM then
		if GetItemType(GetManipulatedItem())== ITEM_TYPE_PERMANENT then
			if GetItemIndex(GetManipulatedItem())== AZV then
				call PickRadianceItem(GetTriggerUnit())
			elseif GetItemIndex(GetManipulatedItem())== RTV then
				// 卫士胫甲
				call PickGuardianGreavesItem(GetTriggerUnit())
			elseif GetItemIndex(GetManipulatedItem())== Item_KhadgarPipeOfInsight then
				//call SetAllPlayerAbilityUnavailable('A3AX')
				//call PickPipeItem(GetTriggerUnit())
			endif
		endif
	elseif UnitInventorySize(GetSummonedUnit())> 0 and GetItemOfTypeFromUnit(GetSummonedUnit(), RealItemTypeId[AZV])!= null then
		// 幻象获得辉耀
		call PickRadianceItem(GetSummonedUnit())
	endif
	return false
endfunction
function YUA takes unit u, item it, integer JOX returns nothing
	local integer YWA = 1
	local integer YYA = 0
	local integer i = 0
	local item YZA
	local integer SQV = UUV(it)
	local player p
	loop
		if UnitItemInSlot(u, i)== null then
			set YWA = YWA + 1
		endif
		set i = i + 1
	exitwhen i > 5
	endloop
	if SQV == it_hyzr or SQV == IEV or SQV == Item_MoonShard or SQV == Item_HeavenHalberd or SQV == IRV or SQV == IIV or SQV == NZV or SQV == I_V or SQV == I0V or SQV == ROV or SQV == Item_SangeAndYasha or SQV == RUV or SQV == RWV or SQV == N2V or SQV == Item_GlimmerCape or SQV == RJV or SQV == I1V then
		set YYA = 2
	elseif SQV == Item_DragonLance or SQV == NGV or SQV == IBV or SQV == ICV or SQV == IDV or SQV == NHV or SQV == NEV or SQV == ANV or SQV == ABV or SQV == NKV or SQV == Vanguard_melee or SQV == Vanguard_ranged or SQV == NQV or SQV == NSV or SQV == RNV or SQV == RCV or SQV == ISV or SQV == A5V or SQV == Item_MonkeyKingBar then
		set YYA = 3
	elseif SQV == Item_HoodOfDefiance or SQV == Item_BattleFury or SQV == RGV then
		set YYA = 4
	endif
	if YWA >= YYA then
		call DisableTrigger(CUV)
		set p = GetItemPlayer(it)
		call RemoveItem(it)
		if SQV == IEV then
			call TDE(u, RealItemTypeId[OFV], p, false, 1)
			call TDE(u, RealItemTypeId[OWV], p, false, 1)
		elseif SQV == IRV or SQV == IIV then
			call TDE(u, RealItemTypeId[OGV], p, false, 1)
			call TDE(u, RealItemTypeId[OMV], p, false, 1)
		elseif SQV == it_hyzr then //回音战刃
			call TDE(u, RealItemTypeId[IHV], p, false, 1)
			call TDE(u, RealItemTypeId[OAV], p, false, 1)
		elseif SQV == Item_DragonLance then //魔龙枪
			call TDE(u, RealItemTypeId[OAV], p, false, 1)
			call TDE(u, RealItemTypeId[XQV], p, false, 1)
			call TDE(u, RealItemTypeId[XQV], p, false, 1)
		elseif SQV == NGV or SQV == NHV then
			call TDE(u, RealItemTypeId[OBV], p, false, 1)
			call TDE(u, RealItemTypeId[OIV], p, false, 1)
			call TDE(u, RealItemTypeId[B_V], p, false, 1)
		elseif SQV == NEV then
			call TDE(u, RealItemTypeId[X7V], p, false, 1)
			call TDE(u, RealItemTypeId[ITV], p, false, 1)
			call TDE(u, RealItemTypeId[B3V], p, false, 1)
		elseif SQV == NZV then
			call TDE(u, RealItemTypeId[XMV], p, false, 1)
			call TDE(u, RealItemTypeId[X2V], p, false, 1)
		elseif SQV == A5V then //蝴蝶
			call TDE(u, RealItemTypeId[X1V], p, false, 1)
			call TDE(u, RealItemTypeId[RXV], p, false, 1)
			call TDE(u, RealItemTypeId[ODV], p, false, 1)
		elseif SQV == Item_MonkeyKingBar then //金箍棒
			call TDE(u, RealItemTypeId[X0V], p, false, 1)
			call TDE(u, RealItemTypeId[Item_Javelin], p, false, 1)
			call TDE(u, RealItemTypeId[Item_Javelin], p, false, 1)
		elseif SQV == ISV then //刃甲
			call TDE(u, RealItemTypeId[XYV], p, false, 1)
			call TDE(u, RealItemTypeId[OJV], p, false, 1)
			call TDE(u, RealItemTypeId[XZV], p, false, 1)
		elseif SQV == RCV then //阿托斯之棍
			call TDE(u, RealItemTypeId[OUV], p, false, 1)
			call TDE(u, RealItemTypeId[OPV], p, false, 1)
			call TDE(u, RealItemTypeId[OPV], p, false, 1)
		elseif SQV == RNV then //绿鞋
			call TDE(u, RealItemTypeId[OGV], p, false, 1)
			call TDE(u, RealItemTypeId[XMV], p, false, 1)
			call TDE(u, RealItemTypeId[OHV], p, false, 1)
		elseif SQV == I_V or SQV == I0V then
			call TDE(u, RealItemTypeId[X6V], p, false, 1)
			call TDE(u, RealItemTypeId[OXV], p, false, 1)
		elseif SQV == ANV or SQV == ABV then //分身斧
			call TDE(u, RealItemTypeId[IMV], p, false, 1)
			call TDE(u, RealItemTypeId[OTV], p, false, 1)
			call TDE(u, RealItemTypeId[BGV], p, false, 1)
		elseif SQV == NQV or SQV == NSV then
			call TDE(u, RealItemTypeId[StoutShield_melee], p, false, 1)
			call TDE(u, RealItemTypeId[OLV], p, false, 1)
			call TDE(u, RealItemTypeId[OLV], p, false, 1)
		elseif SQV == ROV then
			call TDE(u, RealItemTypeId[X1V], p, false, 1)
			call TDE(u, RealItemTypeId[Item_GhostScepter], p, false, 1)
		elseif SQV == Item_SangeAndYasha then
			call TDE(u, RealItemTypeId[Item_Sange], p, false, 1)
			call TDE(u, RealItemTypeId[IMV], p, false, 1)
		elseif SQV == RUV or SQV == RWV then
			call TDE(u, RealItemTypeId[IKV], p, false, 1)
			call TDE(u, RealItemTypeId[IRV], p, false, 1)
		elseif SQV == N2V then
			call TDE(u, RealItemTypeId[IQV], p, false, 1)
			call TDE(u, RealItemTypeId[OKV], p, false, 1)
		elseif SQV == RGV then
			call TDE(u, RealItemTypeId[IEV], p, false, 1)
			call TDE(u, RealItemTypeId[XZV], p, false, 1)
			call TDE(u, RealItemTypeId[XZV], p, false, 1)
			call TDE(u, RealItemTypeId[RHV], p, false, 1)
		elseif SQV == Item_GlimmerCape then
			call TDE(u, RealItemTypeId[Item_PlaneswalkerCloak], p, false, 1)
			call TDE(u, RealItemTypeId[XGV], p, false, 1)
		elseif SQV == RJV then
			call TDE(u, RealItemTypeId[RXV], p, false, 1)
			call TDE(u, RealItemTypeId[N_V], p, false, 1)
		elseif SQV == Item_HeavenHalberd then
			call TDE(u, RealItemTypeId[RXV], p, false, 1)
			call TDE(u, RealItemTypeId[Item_Sange], p, false, 1)
		elseif SQV == Item_MoonShard then
			call TDE(u, RealItemTypeId[X7V], p, false, 1)
			call TDE(u, RealItemTypeId[X7V], p, false, 1)
		elseif SQV == I1V then
			call TDE(u, RealItemTypeId[ODV], p, false, 1)
			call TDE(u, RealItemTypeId[OXV], p, false, 1)
		elseif SQV == NKV then
			call TDE(u, RealItemTypeId[XWV], p, false, 1)
			call TDE(u, RealItemTypeId[XWV], p, false, 1)
			call TDE(u, RealItemTypeId[XMV], p, false, 1)
		elseif SQV == Vanguard_melee or SQV == Vanguard_ranged then
			call TDE(u, RealItemTypeId[OUV], p, false, 1)
			call TDE(u, RealItemTypeId[OFV], p, false, 1)
			call TDE(u, RealItemTypeId[StoutShield_ranged], p, false, 1)
		elseif SQV == Item_BattleFury then
			call TDE(u, RealItemTypeId[IEV], p, false, 1)
			call TDE(u, RealItemTypeId[XYV], p, false, 1)
			call TDE(u, RealItemTypeId[X_V], p, false, 1)
			call TDE(u, RealItemTypeId[QuellingBlade_Ranged], p, false, 1)
		elseif SQV == Item_HoodOfDefiance then
			call TDE(u, RealItemTypeId[OHV], p, false, 1)
			call TDE(u, RealItemTypeId[OHV], p, false, 1)
			call TDE(u, RealItemTypeId[OFV], p, false, 1)
			call TDE(u, RealItemTypeId[Item_PlaneswalkerCloak], p, false, 1)
		elseif SQV == IBV or SQV == IDV or SQV == ICV then
			call TDE(u, RealItemTypeId[XMV], p, false, 1)
			call TDE(u, RealItemTypeId[XPV], p, false, 1)
			if SQV == IBV then
				call TDE(u, RealItemTypeId[XQV], p, false, 1)
			elseif SQV == ICV then
				call TDE(u, RealItemTypeId[XTV], p, false, 1)
			else
				call TDE(u, RealItemTypeId[OJV], p, false, 1)
			endif
		endif
		call EnableTrigger(CUV)
	else
		call InterfaceErrorForPlayer(GetOwningPlayer(u), "没有足够的空间，拆分装备需要至少 " + I2S(YYA)+ " 个格子.")
	endif
	set YZA = null
endfunction
function Bke takes item it returns boolean
	local integer id = UUV(it)
	if id == it_hyzr or id == Item_DragonLance or id == IEV or id == IBV or id == ICV or id == IDV or id == Item_MoonShard or id == IRV or id == IIV or id == NGV or id == NHV or id == NEV or id == NZV or id == Item_HeavenHalberd or id == I_V or id == I0V or id == ANV or id == ABV or id == ROV or id == Item_SangeAndYasha or id == RUV or id == RWV or id == N2V or id == RGV or id == Item_GlimmerCape or id == RJV or id == NKV or id == I1V or id == Item_BattleFury or id == Vanguard_melee or id == Vanguard_ranged or id == Item_HoodOfDefiance or id == NQV or id == NSV or id == RNV or id == RCV or id == ISV or id == A5V or id == Item_MonkeyKingBar then
		return true
	endif
	return false
endfunction
function BMe takes nothing returns nothing
	local trigger trg = GetTriggeringTrigger()
	local integer key = GetHandleId(trg)
	local unit u = LoadUnitHandle(HY, key, 0)
	call RemoveSavedHandle( ExtraHT, GetHandleId(u), HTKEY_UNIT_SPLIT_ITEM0+ LoadInteger(HY, key, 0) )
	call FlushChildHashtable(HY, key)
	call CleanCurrentTrigger(trg)
	set u = null
	set trg = null
endfunction
// 右键双击物品
function RightDoubleClickItem takes unit u, item it, integer Ez returns nothing
	local trigger trg = null
	local integer key
	if not Bke(it) then
		return
	endif
	if HaveSavedHandle( ExtraHT, GetHandleId(u), HTKEY_UNIT_SPLIT_ITEM0+ Ez ) then
		set trg = LoadTriggerHandle(ExtraHT, GetHandleId(u), HTKEY_UNIT_SPLIT_ITEM0+ Ez)
		set key = GetHandleId(trg)
		if Ez == LoadInteger(HY, key, 0) and it == LoadItemHandle(HY, key, 1) then
			call FlushChildHashtable(HY, key)
			call CleanCurrentTrigger(trg)
			call RemoveSavedHandle(ExtraHT, GetHandleId(u), HTKEY_UNIT_SPLIT_ITEM0+ Ez)
			call YUA(u , it , Ez)
		endif
	else
		set trg = CreateTrigger()
		set key = GetHandleId(trg)
		call SaveUnitHandle(HY, key, 0, u)
		call SaveItemHandle(HY, key, 1, it)
		call SaveInteger(HY, key, 0, Ez)
		call SaveTriggerHandle(ExtraHT, GetHandleId(u), HTKEY_UNIT_SPLIT_ITEM0+ Ez,  trg)
		call TriggerRegisterTimerEvent(trg, 1, false)
		call TriggerAddCondition(trg, Condition(function BMe))
	endif
	set trg = null
endfunction
function Y_A takes nothing returns nothing
	local integer id = GetIssuedOrderId()
	if id >= 852002 and id <= 852007 then
		if GetOrderTargetItem()== UnitItemInSlot(GetTriggerUnit(), id -852002) then
			call RightDoubleClickItem(GetTriggerUnit(), GetOrderTargetItem(), id -852002)
		endif
	endif
endfunction
function Y0A takes nothing returns nothing
	local trigger t = CreateTrigger()
	call A1X(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
	call TriggerAddCondition(t, Condition(function Y_A))
	set t = null
endfunction
function Y1A takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	if GetUnitTypeId(u)!='hfoo' and GetUnitAbilityLevel(u,'Aloc')== 0 then
		if CoordinateX50(x)!= x then
			call SetUnitX(u, CoordinateX50(x))
		endif
		if CoordinateY50(y)!= y then
			call SetUnitY(u, CoordinateY50(y))
		endif
	endif
	set u = null
endfunction
function Y2A takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local real x = GetUnitX(u)
	local real y = GetUnitY(u)
	if GetUnitAbilityLevel(u,'Aloc')== 0 and GetOwningPlayer(u)!= NeutralPassivePlayer then
		call SetUnitPosition(u, x, y)
	endif
	set u = null
endfunction
// 似乎是某种和谐机制 为了让蝗虫可以被选取?
function Y3A takes nothing returns nothing
	local trigger t = CreateTrigger()
	set BX = CreateRegion()
	set CX = CreateRegion()
	call RegionAddRect(BX, Rect(-6424,-7473,-7500,-7885))
	call RegionAddRect(CX, Rect(5744, 6860, 7502, 7240))
	call RegionAddRect(CX, Rect(7300, 5400, 7502, 6800))
	call TriggerRegisterEnterRegion(t, BX, TrueBoolexprCondition)
	call TriggerRegisterEnterRegion(t, CX, TrueBoolexprCondition)
	call TriggerAddCondition(t, Condition(function Y2A))
	set t = null
endfunction
function Y4A takes nothing returns nothing
	call SetDestructableOccluderHeight(GetEnumDestructable(), 9999)
endfunction
function Y5A takes nothing returns boolean
	return IsTreeDestructable(GetFilterDestructable())== false
endfunction

function Y6A takes integer i, integer h returns nothing
	local player p = Player(i)
	local integer k = i * 100 
	local unit u = CreateUnit(p, LoadInteger(HY, h, k + 80), LoadReal(HY, h, k), LoadReal(HY, h, k + 1), 90)
	local item it = null
	if LoadInteger(HY, h, k + 1) != 0 then
		set it = CreateItem(LoadInteger(HY, h, k + 1), 0, 0)
		call SetItemPlayer(it, LoadPlayerHandle(HY, h, k + 1), true)
		call UnitAddItem(u, it)
		if LoadInteger(HY, h, k + 11)> 0 then
			call SetItemCharges(it, LoadInteger(HY, h, k + 11))
		endif
	endif
	if LoadInteger(HY, h, k + 2) != 0 then
		set it = CreateItem(LoadInteger(HY, h, k + 2), 0, 0)
		call SetItemPlayer(it, LoadPlayerHandle(HY, h, k + 2), true)
		call UnitAddItem(u, it)
		if LoadInteger(HY, h, k + 12)> 0 then
			call SetItemCharges(it, LoadInteger(HY, h, k + 12))
		endif
	endif
	if LoadInteger(HY, h, k + 3) != 0 then
		set it = CreateItem(LoadInteger(HY, h, k + 3), 0, 0)
		call SetItemPlayer(it, LoadPlayerHandle(HY, h, k + 3), true)
		call UnitAddItem(u, it)
		if LoadInteger(HY, h, k + 13)> 0 then
			call SetItemCharges(it, LoadInteger(HY, h, k + 13))
		endif
	endif
	if LoadInteger(HY, h, k + 4) != 0 then
		set it = CreateItem(LoadInteger(HY, h, k + 4), 0, 0)
		call SetItemPlayer(it, LoadPlayerHandle(HY, h, k + 4), true)
		call UnitAddItem(u, it)
		if LoadInteger(HY, h, k + 14)> 0 then
			call SetItemCharges(it, LoadInteger(HY, h, k + 14))
		endif
	endif
	if LoadInteger(HY, h, k + 5) != 0 then
		set it = CreateItem(LoadInteger(HY, h, k + 5), 0, 0)
		call SetItemPlayer(it, LoadPlayerHandle(HY, h, k + 5), true)
		call UnitAddItem(u, it)
		if LoadInteger(HY, h, k + 15)> 0 then
			call SetItemCharges(it, LoadInteger(HY, h, k + 15))
		endif
	endif
	if LoadInteger(HY, h, k + 6) != 0 then
		set it = CreateItem(LoadInteger(HY, h, k + 6), 0, 0)
		call SetItemPlayer(it, LoadPlayerHandle(HY, h, k + 6), true)
		call UnitAddItem(u, it)
		if LoadInteger(HY, h, k + 16)> 0 then
			call SetItemCharges(it, LoadInteger(HY, h, k + 16))
		endif
	endif
	set IP[GetPlayerId(p)* 2 + 1]= 0
	set IP[GetPlayerId(p)* 2 + 2]= 0
	call SetHeroLevelAndXP(u, LoadInteger(HY, h, k + 30), false, 0)
	call DisplayTimedTextToPlayer(p, 0, 0, 60, "|c00ff0000  你的英雄因为某错误已重置。|r")
	set u = null
	set it = null
endfunction
function Y7A takes nothing returns nothing
	local trigger t = GetTriggeringTrigger()
	local integer h = GetHandleId(t)
	local unit u
	local item it
	local integer i = 1
	local integer k
	local boolean Y8A = false
	loop
		if IN[i]and XHX(Player(i))== false then
			set Y8A = false
			set u = Player__Hero[i]
			if u == null or GetUnitTypeId(u)< 1 or GetHandleId(u)< 1 then
				set Y8A = true
			endif
			set k = i * 100
			if Y8A == false then
				call SaveBoolean(HY, h, k, true)
				call SaveInteger(HY, h, k + 80, GetUnitTypeId(u))
				set it = UnitItemInSlot(u, 0)
				call SaveInteger(HY, h, k + 1, GetItemTypeId(it))
				call SavePlayerHandle(HY, h, k + 1, GetItemPlayer(it))
				call SaveInteger(HY, h, k +$B, GetItemCharges(it))
				set it = UnitItemInSlot(u, 1)
				call SaveInteger(HY, h, k + 2, GetItemTypeId(it))
				call SavePlayerHandle(HY, h, k + 2, GetItemPlayer(it))
				call SaveInteger(HY, h, k +$C, GetItemCharges(it))
				set it = UnitItemInSlot(u, 2)
				call SaveInteger(HY, h, k + 3, GetItemTypeId(it))
				call SavePlayerHandle(HY, h, k + 3, GetItemPlayer(it))
				call SaveInteger(HY, h, k +$D, GetItemCharges(it))
				set it = UnitItemInSlot(u, 3)
				call SaveInteger(HY, h, k + 4, GetItemTypeId(it))
				call SavePlayerHandle(HY, h, k + 4, GetItemPlayer(it))
				call SaveInteger(HY, h, k +$E, GetItemCharges(it))
				set it = UnitItemInSlot(u, 4)
				call SaveInteger(HY, h, k + 5, GetItemTypeId(it))
				call SavePlayerHandle(HY, h, k + 5, GetItemPlayer(it))
				call SaveInteger(HY, h, k +$F, GetItemCharges(it))
				set it = UnitItemInSlot(u, 5)
				call SaveInteger(HY, h, k + 6, GetItemTypeId(it))
				call SavePlayerHandle(HY, h, k + 6, GetItemPlayer(it))
				call SaveInteger(HY, h, k + 16, GetItemCharges(it))
				call SaveReal(HY, h, k, GetUnitX(u))
				call SaveReal(HY, h, k + 1, GetUnitY(u))
				call SaveInteger(HY, h, k + 30, GetHeroLevel(u))
			endif
			if Y8A and LoadBoolean(HY, h, k) then
				call Y6A(i, h)
			endif
		endif
		set i = i + 1
		if i == 6 then
			set i = 7
		endif
	exitwhen i >$B
	endloop
	set u = null
	set it = null
	set t = null
endfunction
function Y9A takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local unit u = LoadUnitHandle(HY, h, 0)
	if GetUnitX(u)!= LoadReal(HY, h, 0) or GetUnitY(u)!= LoadReal(HY, h, 1) or UnitIsDead(u) then
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(HY, h)
		call UnitRemoveAbility(u,'A40E')
	else
		call UnitRemoveAbility(u,'A40E')
		call UnitAddPermanentAbility(u,'A40E')
	endif
	set u = null
	set t = null
endfunction
function ZVA takes unit u returns nothing
	local timer t = CreateTimer()
	call TimerStart(t, .2, true, function Y9A)
	call SaveUnitHandle(HY, GetHandleId(t), 0, u)
	call UnitAddPermanentAbility(u,'A40E')
	call SaveReal(HY, GetHandleId(t), 0, GetUnitX(u))
	call SaveReal(HY, GetHandleId(t), 1, GetUnitY(u))
	set t = null
endfunction
function ZEA takes unit u, item it returns nothing
	if GetOrderPointX()== GetItemX(it) and GetOrderPointY()== GetItemY(it) then
		if IsSentinelsPlayer(GetOwningPlayer(u)) then
			if RectContainsUnit(WA, u) then
				call EXStopUnit(u)
				call InterfaceErrorForPlayer(GetOwningPlayer(u), GetObjectName('TX0Y'))
			endif
		elseif IsScourgesPlayer(GetOwningPlayer(u)) then
			if RectContainsUnit(YA, u) then
				call EXStopUnit(u)
				call InterfaceErrorForPlayer(GetOwningPlayer(u), GetObjectName('TX0Y'))
			endif
		endif
	endif
endfunction
function UnitIssuedItemOrder takes nothing returns nothing // 发布物品命令
	local unit whichUnit = GetTriggerUnit()
	local unit targetUnit = GetOrderTargetUnit()
	local item it = UnitItemInSlot(whichUnit, GetIssuedOrderId() - 852008)
	local integer id = UUV(it)
	local integer i
	local boolean b
	local player trigPlayer = GetTriggerPlayer()

	if targetUnit == null then

		// 不指向单位的操作
		if id == R4V or id == IAV or id == INV then // tp
			call ZEA(whichUnit, it)
		elseif id == OVV or id == AQV or id == RBV or id == A1V then // 禁止使用破碎的物品?
			if GetUnitTypeId(whichUnit) !='e00E'then 
				call EXStopUnit(whichUnit)
			endif
		elseif id == Item_GhostScepter and IsMagicImmuneUnit(whichUnit) then
			call EXStopUnit(whichUnit)
			call InterfaceErrorForPlayer(trigPlayer, "不能在魔法免疫状态下使用")
		endif

	else	
		
		// 指向单位
		if id == R0V or id == R1V then
			call SetUnitAbilityLevel(whichUnit,'Aeat', 1)
			call SetUnitAbilityLevel(whichUnit,'A2VG', 1)
			// 如果吃了 真眼或者假眼 技能提升为2级 双倍恢复效果
			if GetUnitTypeId(targetUnit)=='oeye' or GetUnitTypeId(targetUnit)=='o004' then
				if IsUnitEnemy(targetUnit, trigPlayer) then
					call SetUnitAbilityLevel(whichUnit,'Aeat', 2)
					call SetUnitAbilityLevel(whichUnit,'A2VG', 2)
				else
					call EXStopUnit(whichUnit)
					call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX0Z'))
				endif
			else
				if IsUnitEnemy(targetUnit, trigPlayer) then
					call EXStopUnit(whichUnit)
					call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX10'))
				elseif not (IsUnitType(targetUnit, UNIT_TYPE_HERO) or IsBearUnit(targetUnit)) then
					call EXStopUnit(whichUnit)
					call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX11'))
				else
					set i = 0
					set b = false
					loop
						if UnitItemInSlot(targetUnit, i)== null then
							set b = true
							exitwhen true
						endif
						set i = i + 1
					exitwhen i > 5
					endloop
					if not b then
						call EXStopUnit(whichUnit)
						call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX12'))
					endif
				endif
			endif
		elseif id == QuellingBlade_Melee or id == QuellingBlade_Ranged or id == Item_BattleFury then
			// 拆地雷 真假眼时 射程提高
			if (GetUnitTypeId(targetUnit)=='oeye' or GetUnitTypeId(targetUnit)=='o004' or RMX(targetUnit)) then
				call SetUnitAbilityLevel(whichUnit,'A1FD', 2)
			else
				call SetUnitAbilityLevel(whichUnit,'A1FD', 1)
			endif
		elseif id == Item_EulScepterOfDivinity then
			// 吹风 不能对魔免敌对单位使用
			if IsUnitEnemy(targetUnit, trigPlayer) and IsMagicImmuneUnit(targetUnit) then
				call EXStopUnit(whichUnit)
				call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX13'))
			endif
		elseif id == NMV or id == Item_HurricanePike then
			// 推推 不能对肉山和敌对魔免单位使用
			call SetUnitAbilityLevel(whichUnit,'A3U8', 1)
			if GetOwningPlayer(targetUnit)!= trigPlayer then
				if targetUnit == RoShan then
					call EXStopUnit(whichUnit)
					call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX14'))
				elseif IsUnitAlly(whichUnit, GetOwningPlayer(targetUnit)) and LoadBoolean(HY, GetHandleId(GetOwningPlayer(targetUnit)),$8B) then
					call EXStopUnit(whichUnit)
					call InterfaceErrorForPlayer(trigPlayer, GetObjectName('n038'))
				elseif IsUnitEnemy(whichUnit, GetOwningPlayer(targetUnit)) then
					if IsMagicImmuneUnit(targetUnit) then
						call EXStopUnit(whichUnit)
						call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX13'))
					elseif id == Item_HurricanePike then
						call SetUnitAbilityLevel(whichUnit,'A3U8', 2)
					endif
				endif
			endif
			if R4X(targetUnit) or IsBeetleUnitTypeId(GetUnitTypeId(targetUnit)) then // 不能对守卫单位使用
				if not R3X(GetUnitTypeId(targetUnit)) then // 但可以对追踪导弹使用?
					call EXStopUnit(whichUnit)
					call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX15'))
				endif
			endif
		elseif id == NUV then
			// 骨灰 不能对魔免敌对单位使用
			if IsUnitEnemy(targetUnit, trigPlayer) and IsMagicImmuneUnit(targetUnit) then
				call EXStopUnit(whichUnit)
				call InterfaceErrorForPlayer(trigPlayer, GetObjectName('n0LR'))
			endif
		elseif id == IFV then
			// 迈达斯之手
			if IsNecronomiconUnit(targetUnit) then // 不能对死灵书单位使用
				call EXStopUnit(whichUnit)
				call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX19'))
			endif
		elseif id == APV then
			// 林肯法球 不能作用于幻象
			if IsUnitIllusion(targetUnit) then
				call EXStopUnit(whichUnit)
				call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX0V'))
			endif
		elseif id == Item_MoonShard then
			if IsUnitIllusion(targetUnit) or not ( IsUnitType(targetUnit, UNIT_TYPE_HERO) or IsBearUnit( targetUnit ) ) then
				call InterfaceErrorForPlayer( trigPlayer, "不能给目标使用银月之晶")
				call EXStopUnit(whichUnit)
			elseif GetUnitAbilityLevel(targetUnit,'A398') == 1 then
				call InterfaceErrorForPlayer( trigPlayer, "该单位已经有银月之晶了")
				call EXStopUnit(whichUnit)
			endif
		endif

	endif

 	// 放置真假眼
	if id == R2V or id == R3V then
		if targetUnit != null then
			// 如果目标是英雄 或者不是熊灵
			if (IsUnitType(targetUnit, UNIT_TYPE_HERO) or not IsBearUnit(targetUnit)) then
				call EXStopUnit(whichUnit)
				call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX16'))
			else
				set i = 0
				set b = false
				loop
					if UnitItemInSlot(targetUnit, i)== null then
						set b = true
					exitwhen true
					endif
					set i = i + 1
				exitwhen i > 5
				endloop
				if b == false then // 格子满了
					call EXStopUnit(whichUnit)
					call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX12'))
				endif
			endif
		else
			if IsTerrainPathable(GetOrderPointX(), GetOrderPointY(), PATHING_TYPE_WALKABILITY) then
				call EXStopUnit(whichUnit)
				call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX17'))
			elseif RectContainsCoords(WA, GetOrderPointX(), GetOrderPointY()) or RectContainsCoords(YA, GetOrderPointX(), GetOrderPointY()) then
				call EXStopUnit(whichUnit)
				call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX18'))
			elseif IsPointInRegion(FLV, GetOrderPointX(), GetOrderPointY()) then
				call EXStopUnit(whichUnit)
				call InterfaceErrorForPlayer(trigPlayer, GetObjectName('TX17'))
			endif
		endif
	endif

	set trigPlayer = null
	set targetUnit = null
	set whichUnit = null
	set it = null
endfunction
function ZOA takes nothing returns nothing
	local unit whichUnit
	local integer h
	local integer id
	// 必须是玩家单位
	if not XFX(GetTriggerPlayer()) or IsUnitIllusion(GetTriggerUnit()) then
		return
	endif
	set id = GetIssuedOrderId()
	set whichUnit = GetTriggerUnit()
	set h = GetHandleId(whichUnit)
	// 发布物品命令
	if id >=852008 and id <=852013 then
		// 目前包含锁闭效果的技能
		// 末日 决斗 否决 黑洞 静态风暴
		if LoadBoolean(ExtraHT, h, HTKEY_LOCKED_BUFF_TRIGGER) or ( IsEffectEnabled[EFFECT_KEY_BLACKHOLE] and GetUnitAbilityLevel(whichUnit, 'B08V') > 0 ) or ( IsEffectEnabled[EFFECT_KEY_STATICSTORM] and GetUnitAbilityLevel(whichUnit, 'B0SD') > 0 ) then
			call InterfaceErrorForPlayer(GetOwningPlayer(whichUnit), "不能在锁闭状态下使用物品")
			call EXStopUnit(whichUnit)
		else
			call UnitIssuedItemOrder()
		endif
	elseif id == 852583 then // 末日不能对 非熊灵的远古单位使用
		if GetUnitAbilityLevel(whichUnit,'A0A2')> 0 or GetUnitAbilityLevel(whichUnit,'A0MU')> 0 then
			call U8I()
		endif
	endif
	/*call SaveInteger(ExtraHT, h, LAST_ISSUED_ORDER, id)*/
	if id == 851993 then
		if LoadBoolean(HY, h,'ACQR')== false then
			if LoadInteger(HY, h,'ACQR')!= 1 then
				call EPX(whichUnit,'ACQR', .2)
			else
				call EPX(whichUnit,'ACQR', 0)
				call ZVA(whichUnit)
				if IsScourgesPlayer(GetOwningPlayer(whichUnit)) then
					call SetPlayerAlliance(GetOwningPlayer(whichUnit), Scourges[0], ALLIANCE_HELP_RESPONSE, false)
				else
					call SetPlayerAlliance(GetOwningPlayer(whichUnit), Sentinels[0], ALLIANCE_HELP_RESPONSE, false)
				endif
			endif
		endif
	else
		if GetUnitAbilityLevel(whichUnit,'A40E')> 0 then
			if IsScourgesPlayer(GetOwningPlayer(whichUnit)) then
				call SetPlayerAlliance(GetOwningPlayer(whichUnit), Scourges[0], ALLIANCE_HELP_RESPONSE, true)
			else
				call SetPlayerAlliance(GetOwningPlayer(whichUnit), Sentinels[0], ALLIANCE_HELP_RESPONSE, true)
			endif
		endif
	endif
	set whichUnit = null
endfunction
function ZRA takes nothing returns nothing
	if GetWidgetLife(GetEnumItem())> 0 and ZNX(GetItemTypeId(GetEnumItem())) and GetDistanceBetween(GetWidgetX(GetEnumItem()), GetWidgetY(GetEnumItem()), GetUnitX(GetOrderTargetUnit()), GetUnitY(GetOrderTargetUnit()))<$96 then
		call IssueTargetOrderById(GetTriggerUnit(),851971, GetEnumItem())
	endif
endfunction
function ZIA takes nothing returns boolean
	if GetIssuedOrderId()==851971 and GetOrderTargetUnit()!= null and O4X(GetTriggerUnit()) then
		if(RectContainsUnit(IZ, GetOrderTargetUnit())) then
			call EnumItemsInRect(IZ, TrueBoolexprCondition, function ZRA)
		elseif RectContainsUnit(RZ, GetOrderTargetUnit()) then
			call EnumItemsInRect(RZ, TrueBoolexprCondition, function ZRA)
		endif
	endif
	return false
endfunction
function ZAA takes nothing returns nothing
	if InHeroSelection then
		if GetUnitTypeId(GetFilterUnit())=='hfoo' then
			if GetTriggerPlayer()== LocalPlayer then
				call ClearSelection()
				call SelectUnit(LoadUnitHandle(HY, GetHandleId(GetFilterUnit()), 0), true)
			endif
		endif
	endif
endfunction
function ZNA takes nothing returns nothing
	local group g
	if InHeroSelection then
		set g = LoginGroup(500)
		call GroupEnumUnitsSelected(g, GetTriggerPlayer(), Condition(function ZAA))
		call LogoutGroup(g)
		set g = null
	endif
	call EDR()
endfunction
function ZBA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local destructable d = LoadDestructableHandle(HY, h, 0)
	call SetDestructableAnimationSpeed(d, 1)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set d = null
	set t = null
endfunction
function ZCA takes destructable d returns nothing
	local timer t = CreateTimer()
	local integer h = GetHandleId(t)
	call TimerStart(t, 2, false, function ZBA)
	if GetDestructableTypeId(d)=='NTtw' then
		call SetDestructableAnimation(d, "birth")
		call SetDestructableAnimationSpeed(d, 600)
	else
		call SetDestructableAnimation(d, "birth")
		call SetDestructableAnimationSpeed(d, 3)
	endif
	call SaveDestructableHandle(HY, h, 0, d)
	set t = null
endfunction
function ZDA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	local integer h = GetHandleId(t)
	local destructable d = LoadDestructableHandle(HY, h, 0)
	call DestructableRestoreLife(d, GetDestructableMaxLife(d), false)
	call ZCA(d)
	call PauseTimer(t)
	call FlushChildHashtable(HY, h)
	call DestroyTimer(t)
	set t = null
	set d = null
endfunction
function ZFA takes nothing returns nothing
	local timer t = CreateTimer()
	local real WIE = GetRandomReal($B4, 300)
	call TimerStart(t, WIE, false, function ZDA)
	call SaveDestructableHandle(HY, GetHandleId(t), 0, GetTriggerDestructable())
	set t = null
endfunction
function ZGA takes nothing returns boolean
	if IsTreeDestructable(GetFilterDestructable()) then
		call TriggerRegisterDeathEvent(YR, GetFilterDestructable())
	endif
	return false
endfunction
function ZHA takes nothing returns nothing
	local timer t = GetExpiredTimer()
	call RemoveItem(CreateItem('I006'+ GetRandomInt(0, 2), GetLocationX(WU), GetLocationY(WU)))
	call RemoveItem(CreateItem('I006'+ GetRandomInt(0, 2), GetLocationX(YU), GetLocationY(YU)))
	call RemoveItem(CreateItem(PowerUpItemTypeId[ASV], GetRandomReal(-6000, 6000), GetRandomReal(-6000, 6000)))
	call RemoveItem(CreateItem(PowerUpItemTypeId[X4V], GetRandomReal(-6000, 6000), GetRandomReal(-6000, 6000)))
	call TimerStart(t, GetRandomReal(1.5, 3), false, function ZHA)
	set t = null
endfunction
function HeroTrasher takes nothing returns nothing
endfunction
function ZJA takes nothing returns nothing
	local timer t = CreateTimer()
	set t = null
endfunction
function ZKA takes unit u, integer TME returns nothing
	local player p = Player(TME)
	call UnitAddAbility(u,'A141')
	if LocalPlayer== p then
		call ClearSelection()
		call SelectUnit(u, true)
		call SetUnitVertexColor(u, 255, 255, 255, 255)
	else
		call SetUnitVertexColor(u, 255, 255, 255, 25)
	endif
	set Circle[TME]= u
	set VHV[TME]= GetUnitX(u)
	set VJV[TME]= GetUnitY(u)
endfunction
function ZLA takes nothing returns nothing
	local integer h = GetHandleId(GetExpiredTimer())
	local player p = LoadPlayerHandle(HY, h, 0)
	if GetPlayerSlotState(p)== PLAYER_SLOT_STATE_LEFT then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, JS[GetPlayerId(p)]+ GetPlayerName(p)+ "|r: Maphack detected, kicked.")
	endif
	call FlushChildHashtable(HY, GetHandleId(GetExpiredTimer()))
	call DestroyTimer(GetExpiredTimer())
endfunction
function ZMA takes nothing returns nothing
	local timer t = CreateTimer()
	local player p = GetTriggerPlayer()
	local integer h = GetHandleId(t)
	call TimerStart(t, .1, false, function ZLA)
	call SavePlayerHandle(HY, h, 0, p)
	set t = null
endfunction
function ZPA takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local player p = GetTriggerPlayer()
	local integer id = GetPlayerId(p)
	if u == HO then
		set FO[id]= true
		set GO[id]= true
	endif
	if u == KO then
		if(GetPlayerController(p)== MAP_CONTROL_USER) and(GetPlayerSlotState(p)== PLAYER_SLOT_STATE_PLAYING) then
			if FO[id]== false or GO[id] then
				if UnitVisibleToPlayer(LO, p)== false then
					set AO[id]= AO[id]+ 1
					if ModuloInteger(AO[id], 30)== 3 then
						call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, JS[id]+ GetPlayerName(p)+ "|r: 作弊检测 " + I2S(AO[id])+ " 秒")
					endif
					if GV and ModuloInteger(AO[id], 60)== 5 then
						call JSX("MH" + I2S(id), R2I(GetGameTime()))
					endif
				endif
				call SelectUnit(HO, false)
			endif
			set FO[id]= false
			set GO[id]= false
		endif
	endif
	if HO != u and KO != u then
		set DO[id]= DO[id]+ 1
		if DO[id]==$C then
			set NO[id]= u
		endif
		if DO[id]== 11 then
			set CO[id]= u
		endif
		if DO[id]>$C then
			set DO[id]=$C
		endif
	endif
	call ZMA()
endfunction
function ZQA takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local player p = GetTriggerPlayer()
	local integer id = GetPlayerId(p)
	if HO != u and KO != u then
		set DO[id]= DO[id]-1
		if NO[id]== u then
			set NO[id]= null
		endif
		if CO[id]== u then
			set CO[id]= null
		endif
	endif
	if u == HO then
		set GO[id]= false
	endif
endfunction
function DetectMh takes nothing returns nothing
	if UO then
		call SetUnitX(HO, GetRectMinX(bj_mapInitialPlayableArea)+ 600)
		call SetUnitY(HO, GetRectMaxY(bj_mapInitialPlayableArea)-600)
	endif
	if DO[GetPlayerId(GetTriggerPlayer())]<=$A then
		call SelectUnit(HO, true)
		call SelectUnit(KO, true)
		call SelectUnit(KO, false)
		call SelectUnit(HO, false)
	else
		call DisableTrigger(PO)
		call DisableTrigger(QO)
		call SelectUnit(NO[LocalId], false)
		call SelectUnit(CO[LocalId], false)
		call SelectUnit(HO, true)
		call SelectUnit(KO, true)
		call SelectUnit(KO, false)
		call SelectUnit(HO, false)
		call SelectUnit(NO[LocalId], true)
		call SelectUnit(CO[LocalId], true)
		call EnableTrigger(PO)
		call EnableTrigger(QO)
	endif
	if UO then
		call SetUnitX(HO, GetRectMaxX(bj_mapInitialPlayableArea))
		call SetUnitY(HO, GetRectMinY(bj_mapInitialPlayableArea))
		set UO = false
	else
		set UO = true
	endif
endfunction
function ZSA takes nothing returns nothing
	local integer i = 1
	set HO = CreateUnit(Player($C),'hfoo', GetRectMaxX(bj_mapInitialPlayableArea), GetRectMinY(bj_mapInitialPlayableArea), .0)
	set KO = CreateUnit(Player($C),'hfoo', GetRectMinX(bj_mapInitialPlayableArea)+ 600, GetRectMaxY(bj_mapInitialPlayableArea)-600, .0)
	set LO = CreateUnit(Player($C),'hfoo', GetRectMaxX(bj_mapInitialPlayableArea), GetRectMinY(bj_mapInitialPlayableArea), .0)
	set PO = CreateTrigger()
	set QO = CreateTrigger()
	loop
	exitwhen i >$C
		call TriggerRegisterPlayerUnitEvent(PO, Player(i), EVENT_PLAYER_UNIT_SELECTED, null)
		call TriggerRegisterPlayerUnitEvent(QO, Player(i), EVENT_PLAYER_UNIT_DESELECTED, null)
		set i = i + 1
	endloop
	call TriggerAddAction(PO, function ZPA)
	call TriggerAddAction(QO, function ZQA)
	set TO = CreateTimer()
endfunction
function NWR takes nothing returns nothing
	local trigger t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .1, false)
	call TriggerAddAction(t, function ZSA)
	//call ZJA()
	set t = null
endfunction
function ZTA takes unit u returns nothing
	local integer i = 0
	local item it
	local integer id
	local integer k = UnitInventorySize(u)
	loop
	exitwhen i > k
		set it = UnitItemInSlot(u, i)
		set id = UUV(it)
		if(id == O_V or id == O0V or id == O1V) and GetItemUserData(it)> 0 then
			call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl", u, "overhead"))
			call IRX(GetOwningPlayer(u), "Abilities\\Spells\\Human\\Heal\\HealTarget.wav")
			set E3 = GetItemPlayer(it)
			call HZX(it)
			set Z2 = JIX(u, RealItemTypeId[O2V], i)
			call SetItemPlayer(Z2, E3, false)
			call SetItemUserData(Z2, 1)
			call UnitRemoveAbility(u,'B0GI')
		endif
		set i = i + 1
	endloop
	set it = null
endfunction
function ZUA takes nothing returns nothing
	local unit u = GetEnumUnit()
	local integer hu = GetHandleId(u)
	if UnitAlive(u) and(HaveSavedReal(HY, hu,'FnLv')== false or GetGameTime()-LoadReal(HY, hu,'FnLv')< 2.5) then
		if GetWidgetLife(u)< GetUnitState(u, UNIT_STATE_MAX_LIFE) then
			if GetUnitAbilityLevel(u,'A35Y')== 0 then
				call UnitAddPermanentAbility(u,'A35Y')
			endif
			call SetWidgetLife(u, GetWidgetLife(u)+ .004 * GetUnitState(u, UNIT_STATE_MAX_LIFE))
		else
			if GetUnitAbilityLevel(u,'A35Y')== 1 then
				call UnitRemoveAbility(u,'A35Y')
			endif
		endif
		if GetUnitState(u, UNIT_STATE_MANA)< GetUnitState(u, UNIT_STATE_MAX_MANA) then
			if GetUnitAbilityLevel(u,'A35Z')== 0 then
				call UnitAddPermanentAbility(u,'A35Z')
			endif
			call SetUnitState(u, UNIT_STATE_MANA, GetUnitState(u, UNIT_STATE_MANA)+ .004 * GetUnitState(u, UNIT_STATE_MAX_MANA)+ 1.4)
		else
			if GetUnitAbilityLevel(u,'A35Z')== 1 then
				call UnitRemoveAbility(u,'A35Z')
			endif
		endif
		if HaveSavedReal(HY, hu,'FnLv')== false and UnitInventorySize(u)> 0 and ModuloInteger(GetTriggerEvalCount(GetTriggeringTrigger()), 2)== 1 then
			call ZTA(u)
		endif
	else
		call UnitRemoveAbility(u,'A35Y')
		call UnitRemoveAbility(u,'A35Z')
		call GroupRemoveUnit(bj_lastCreatedGroup, u)
		call GroupRemoveUnit(AV, u)
	endif
	if IsMessengerUnit(u) then
		if HaveSavedReal(HY, hu,'FnLv') then
			call UnitRemoveAbility(u,'Avul')
		elseif GetUnitAbilityLevel(u,'Avul')== 0 then
			call UnitAddPermanentAbility(u,'Avul')
		endif
	endif
	set u = null
endfunction
function ZWA takes nothing returns boolean
	return(GetPlayerTeam(GetOwningPlayer(GetFilterUnit())) == 0 and GetWidgetLife(GetFilterUnit())> .5 and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false and GetUnitAbilityLevel(GetFilterUnit(),'Aloc')== 0)!= null
endfunction
function ZYA takes nothing returns boolean
	return(GetPlayerTeam(GetOwningPlayer(GetFilterUnit())) == 1 and GetWidgetLife(GetFilterUnit())> .5 and IsUnitType(GetFilterUnit(), UNIT_TYPE_STRUCTURE)== false and GetUnitAbilityLevel(GetFilterUnit(),'Aloc')== 0)!= null
endfunction
function ZZA takes nothing returns boolean
	return GetUnitPointValue(GetTriggerUnit())!=$C8
endfunction
function Z_A takes nothing returns nothing
	local group g
	local unit u
	if GetTriggerEventId()== EVENT_GAME_LEAVE_REGION then
		if GetUnitAbilityLevel(GetTriggerUnit(),'Aloc')== 0 then
			if(GetTriggeringRegion()== HX and GetPlayerTeam(GetOwningPlayer(GetTriggerUnit())) == 0) or(GetTriggeringRegion()== JX and GetPlayerTeam(GetOwningPlayer(GetTriggerUnit())) == 1) then
				call SaveReal(HY, GetHandleId(GetTriggerUnit()),'FnLv', GetGameTime())
				call GroupAddUnit(AV, GetTriggerUnit())
			endif
		endif
		return
	endif
	set g = LoginGroup(501)
	call GroupClear(ZA)
	call GroupEnumUnitsInRect(g, WA, Condition(function ZWA))
	call GroupAddGroup(g, ZA)
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call RemoveSavedReal(HY, GetHandleId(u),'FnLv')
		call GroupRemoveUnit(AV, u)
		call GroupRemoveUnit(g, u)
	endloop
	call GroupClear(g)
	call GroupClear(VN)
	call GroupEnumUnitsInRect(g, YA, Condition(function ZYA))
	call GroupAddGroup(g, VN)
	loop
		set u = FirstOfGroup(g)
	exitwhen u == null
		call RemoveSavedReal(HY, GetHandleId(u),'FnLv')
		call GroupRemoveUnit(AV, u)
		call GroupRemoveUnit(g, u)
	endloop
	set S2 = GetGameTime()
	set bj_lastCreatedGroup = ZA
	call ForGroup(ZA, function ZUA)
	set bj_lastCreatedGroup = VN
	call ForGroup(VN, function ZUA)
	call ForGroup(AV, function ZUA)
	call LogoutGroup(g)
endfunction
function Z0A takes nothing returns nothing
	if IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) then
		if GetTriggerEventId()!= EVENT_PLAYER_UNIT_SPELL_ENDCAST then
			call S2V(GetTriggerUnit(), true)
		else
			call S2V(GetTriggerUnit(), false)
		endif
	endif
endfunction
function InitSomeLists takes nothing returns nothing
endfunction
function Z1A takes integer id returns nothing
	set SR = SR + 1
	set U4[SR]= id
	set Y4[SR]= 50 * SR + 50
endfunction
function InitBuyBack takes nothing returns nothing
	call Z1A('h09G')
	call Z1A('h09T')
	call Z1A('h09F')
	call Z1A('h09H')
	call Z1A('h09E')
	call Z1A('h09D')
	call Z1A('h09C')
	call Z1A('h09B')
	call Z1A('h099')
	call Z1A('h09A')
	call Z1A('h09J')
	call Z1A('h09K')
	call Z1A('h09L')
	call Z1A('h09M')
	call Z1A('h09N')
	call Z1A('h09O')
	call Z1A('h09P')
	call Z1A('h09Q')
	call Z1A('h09R')
	call Z1A('h09S')
	call Z1A('h09I')
	call Z1A('h09Z')
	call Z1A('h09X')
	call Z1A('h0A1')
	call Z1A('h0A2')
	call Z1A('h0A6')
	call Z1A('h0A3')
	call Z1A('h0A4')
	call Z1A('h09Y')
	call Z1A('h09V')
	call Z1A('h0A0')
	call Z1A('h09U')
	call Z1A('h0AF')
	call Z1A('h0AD')
	call Z1A('h0AE')
	call Z1A('h0AC')
	call Z1A('h0AB')
	call Z1A('h0AA')
	call Z1A('h0A9')
	call Z1A('h0AG')
	call Z1A('h0A7')
	call Z1A('h0AO')
	call Z1A('h0AY')
	call Z1A('h0AH')
	call Z1A('h0AI')
	call Z1A('h0AJ')
	call Z1A('h0AP')
	call Z1A('h0AQ')
	call Z1A('h0AK')
	call Z1A('h0AR')
	call Z1A('h0AL')
	call Z1A('h0AS')
	call Z1A('h09W')
	call Z1A('h0AM')
	call Z1A('h0A8')
	call Z1A('h0AT')
	call Z1A('h0AU')
	call Z1A('h0AN')
	call Z1A('h0AV')
	call Z1A('h0AW')
	set W4[0]= U4[0]
	set W4[1]= U4[0]
	set W4[2]= U4[0]
	set W4[3]= U4[0]
	set W4[4]= U4[0]
	set W4[5]= U4[0]
	set W4[6]= U4[0]
	set W4[7]= U4[0]
	set W4[8]= U4[0]
	set W4[9]= U4[0]
	set W4[10]= U4[0]
	set W4[11]= U4[0]
	set W4[12]= U4[0]
	set W4[$D]= U4[0]
	set W4[$E]= U4[0]
endfunction
function SaveHeroModelData takes integer id, integer XQX, integer KLX, integer cmid, string Z4A, real Z5A returns nothing
	set VUV[id]= XQX
	set RX[id]= KLX
	if XQX > 0 then
		set V9V[id]= GetAbilitySoundById(XQX, SOUND_TYPE_EFFECT_LOOPED)
	endif
	call XRX(XQX, Z4A)
	call SaveHeroModelScale(XQX, Z5A, KLX)
	if IsUnitIdType(XQX, UNIT_TYPE_MELEE_ATTACKER) then
		set V8V = V8V + 1
		set V7V[V8V]= XQX
	else
		set V6V = V6V + 1
		set V5V[V6V]= XQX
	endif
endfunction
function Z6A takes nothing returns nothing
	call RegisterBuffAbility('A3K2','PRGE')
	call RegisterBuffAbility('A3K3','PRGE')
	call RegisterBuffAbility('BIcb','PRGE')
	call RegisterBuffAbility('A2EC','PRGE')
	call RegisterBuffAbility('B0F5','PRGE')
	call RegisterBuffAbility('B08N','PRGE')
	call RegisterBuffAbility('B02I','PRGE')
	call RegisterBuffAbility('A3FL','PRGA')
	call RegisterBuffAbility('B01P','PRGA')
endfunction
function Z7A takes nothing returns nothing
	call Z6A()
	// 一些buff
	call RegisterPhysicalBuffAbility('BPSE')
	call RegisterPhysicalBuffAbility('BSTN')
	call RegisterPhysicalBuffAbility('B0BM')
	call RegisterPhysicalBuffAbility('B0CF')
	call RegisterPhysicalBuffAbility('B07N')
	call RegisterPhysicalBuffAbility('B00Q')
	call RegisterPhysicalBuffAbility('B095')
	call RegisterPhysicalBuffAbility('B0C2')
	call RegisterPhysicalBuffAbility('B02S')
	call RegisterPhysicalBuffAbility('B02F')
	call RegisterPhysicalBuffAbility('BUsp')
	call RegisterPhysicalBuffAbility('Bust')
	call RegisterPhysicalBuffAbility('B0AQ')
	call RegisterPhysicalBuffAbility('BUan')
	call RegisterPhysicalBuffAbility('B0GG')
	call RegisterBuffAbility('C010','PRGE')
	call RegisterBuffAbility('D010','PRGE')
	call RegisterBuffAbility('A45O','PRGE')
	call RegisterBuffAbility('A45P','PRGE')
	call RegisterBuffAbility('A45Q','PRGE')
	call RegisterBuffAbility('A45R','PRGE')
	call RegisterBuffAbility('A44Y','PRGC')
	call RegisterBuffAbility('B44Y','PRGC')
	call RegisterBuffAbility('A45Y','PRGS')
	call RegisterBuffAbility('A45Z','PRGS')
	call RegisterBuffAbility('B45Y','PRGS')
	call RegisterBuffAbility('A32F','PRGS')
	call RegisterBuffAbility('B32F','PRGS')
	call RegisterBuffAbility('A3A0','PRGS')
	call RegisterBuffAbility('A3A1','PRGS')
	call RegisterBuffAbility('A3A2','PRGS')
	call RegisterBuffAbility('A3A3','PRGS')
	call RegisterBuffAbility('A3A4','PRGS')
	call RegisterBuffAbility('A3A5','PRGS')
	call RegisterBuffAbility('A3A6','PRGS')
	call RegisterBuffAbility('A3A7','PRGS')
	call RegisterBuffAbility('B079','PRGS')
	call RegisterBuffAbility('C016','PRGS')
	call RegisterBuffAbility('D016','PRGS')
	call RegisterBuffAbility('B09Q','PRGS')
	call RegisterBuffAbility('B06Q','PRGS')
	call RegisterBuffAbility('C000','PRGA')
	call RegisterBuffAbility('D000','PRGA')
	call RegisterBuffAbility('C108','PRGA')
	call RegisterBuffAbility('C109','PRGA')
	call RegisterBuffAbility('C10:','PRGA')
	call RegisterBuffAbility('C10;','PRGA')
	call RegisterBuffAbility('D105','PRGA')
	call RegisterBuffAbility('A2IB','PRGA')
	call RegisterBuffAbility('B0FV','PRGA')
	call RegisterBuffAbility('A44Y','PRGC')
	call RegisterBuffAbility('B44Y','PRGC')
	call RegisterBuffAbility('A0WR','PRGA')
	call RegisterBuffAbility('B01E','PRGA')
	call RegisterBuffAbility('A3K9','PRGA')
	call RegisterBuffAbility('A3KA','PRGA')
	call RegisterBuffAbility('B00S','PRGA')
	call RegisterBuffAbility('A3KB','PRGA')
	call RegisterBuffAbility('B07W','PRGA')
	call RegisterBuffAbility('Broa','PRGA')
	call RegisterBuffAbility('A3DU','PRGA')
	call RegisterBuffAbility('A3DV','PRGA')
	call RegisterBuffAbility('A3DW','PRGA')
	call RegisterBuffAbility('A3DX','PRGA')
	call RegisterBuffAbility('B3DU','PRGA')
	call RegisterBuffAbility('C020','PRGA')
	call RegisterBuffAbility('D020','PRGA')
	call RegisterBuffAbility('B0H6','PRGA')
	call RegisterBuffAbility('B016','PRGA')
	call RegisterBuffAbility('B019','PRGA')
	call RegisterBuffAbility('B00U','PRGA')
	call RegisterBuffAbility('A1Q0','PRGA')
	call RegisterBuffAbility('A1Q1','PRGA')
	call RegisterBuffAbility('A1Q2','PRGA')
	call RegisterBuffAbility('A1Q3','PRGA')
	// ======================================================
	// 缴械类

	//call RegisterBuffAbility('A0VT', BUFF_TYPE_DISARM) // 超震声波
	//call RegisterBuffAbility('A3KD', BUFF_TYPE_DISARM) // 命运敕令
	
	// ======================================================

	call RegisterBuffAbility('A3KE','PRGE')
	call RegisterBuffAbility('B3KE','PRGE')
	call RegisterBuffAbility('A3KD','PRGE')
	call RegisterBuffAbility('A2T4','PRGE')
	call RegisterBuffAbility('A1CO','PRGA')
	call RegisterBuffAbility('B1CO','PRGA')
	call RegisterBuffAbility('A46F','PRGA')
	call RegisterBuffAbility('B46F','PRGA')
	call RegisterBuffAbility('B01N','PRGC')
	//call RegisterBuffAbility('A30D','PRGC')
	call RegisterBuffAbility('A44I','PRGC')
	call RegisterBuffAbility('A30E','PRGC')
	call RegisterBuffAbility('A3C0','PRGC')
	call RegisterBuffAbility('A3C1','PRGC')
	call RegisterBuffAbility('A3C2','PRGC')
	call RegisterBuffAbility('A3C3','PRGC')
	call RegisterBuffAbility('B38G','PRGC')
	call RegisterBuffAbility('A24G','PRGA')
	call RegisterBuffAbility('B0EC','PRGA')
	call RegisterBuffAbility('A23N','PRGA')
	call RegisterBuffAbility('B0E9','PRGA')
	call RegisterBuffAbility('A1GA','PRGA')
	call RegisterBuffAbility('B021','PRGA')
	call RegisterBuffAbility('A3KF','PRGA')
	call RegisterBuffAbility('B3KF','PRGA')
	call RegisterBuffAbility('A1N3','PRGA')
	call RegisterBuffAbility('A1N7','PRGA')
	call RegisterBuffAbility('B0CH','PRGA')
	call RegisterBuffAbility('B02H','PRGA')
	call RegisterBuffAbility('A1ZY','PRGA')
	call RegisterBuffAbility('B0DX','PRGA')
	call RegisterBuffAbility('B0CG','PRGA')
	call RegisterBuffAbility('Bcyc','PRGA')
	call RegisterBuffAbility('Bcy2','PRGA')
	call RegisterBuffAbility('Aetl','PRGA')
	call RegisterBuffAbility('A42L','PRGA')
	call RegisterBuffAbility('A42N','PRGA')
	call RegisterBuffAbility('B0HG','PRGA')
	call RegisterBuffAbility('B07S','PRGA')
	call RegisterBuffAbility('A3KI','PRGA')
	call RegisterBuffAbility('B3KI','PRGA')
	call RegisterBuffAbility('B06Z','PRGS')
	call RegisterBuffAbility('B08Q','PRGS')
	call RegisterBuffAbility('B031','PRGI')
	call RegisterBuffAbility('B0C1','PRGN')
	call RegisterBuffAbility('BEer','PRGN')
	call RegisterBuffAbility('BHca','PRGS')
	call RegisterBuffAbility('Bcsd','PRGS')
	call RegisterBuffAbility('B0BQ','PRGS')
	call RegisterBuffAbility('Bprg','PRGS')
	call RegisterBuffAbility('Bcri','PRGS')
	call RegisterBuffAbility('B090','PRGE')
	call RegisterBuffAbility('B008','PRGE')
	call RegisterBuffAbility('B04B','PRGE')
	call RegisterBuffAbility('B03J','PRGS')
	call RegisterBuffAbility('Bslo','PRGS')
	call RegisterBuffAbility('BNdh','PRGS')
	call RegisterBuffAbility('B07U','PRGI')
	call RegisterBuffAbility('BNsi','PRGI')
	call RegisterBuffAbility('BNso','PRGI')
	call RegisterBuffAbility('B01N','PRGE')
	call RegisterBuffAbility('B033','PRGE')
	call RegisterBuffAbility('Bpoi','PRGS')
	call RegisterBuffAbility('B00H','PRGE')
	call RegisterBuffAbility('BOhx','PRGE')
	call RegisterBuffAbility('A3B8','PRGE')
	call RegisterBuffAbility('B3B8','PRGE')
	call RegisterBuffAbility('B06D','PRGS')
	call RegisterBuffAbility('B0BN','PRGS')
	call RegisterBuffAbility('B071','PRGS')
	call RegisterBuffAbility('B02W','PRGE')
	call RegisterBuffAbility('A294','PRGS')
	call RegisterBuffAbility('A295','PRGS')
	call RegisterBuffAbility('A296','PRGS')
	call RegisterBuffAbility('A297','PRGS')
	call RegisterBuffAbility('B05Q','PRGS')
	call RegisterBuffAbility('B0GT','PRGS')
	call RegisterBuffAbility('A37T','PRGE')
	call RegisterBuffAbility('B37T','PRGE')
	call RegisterBuffAbility('QH00','PRGS')
	call RegisterBuffAbility('A1W2','PRGS')
	call RegisterBuffAbility('B0DO','PRGS')
	call RegisterBuffAbility('A42R','PRGE')
	call RegisterBuffAbility('B0HI','PRGE')
	call RegisterBuffAbility('B00L','PRGE')
	call RegisterBuffAbility('A30Y','PRGE')
	call RegisterBuffAbility('B307','PRGE')
	call RegisterBuffAbility('A334','PRGS')
	call RegisterBuffAbility('B083','PRGS')
	call RegisterBuffAbility('B079','PRGS')
	call RegisterBuffAbility('A335','PRGS')
	call RegisterBuffAbility('B08B','PRGS')
	call RegisterBuffAbility('B0GR','PRGE')
	call RegisterBuffAbility('Bdet','PRGE')
	call RegisterBuffAbility('B0GK','PRGS')
	call RegisterBuffAbility('B06Q','PRGS')
	call RegisterBuffAbility('BHtc','PRGS')
	call RegisterBuffAbility('B0BR','PRGS')
	call RegisterBuffAbility('A37U','PRGS')
	call RegisterBuffAbility('A37V','PRGS')
	call RegisterBuffAbility('A37W','PRGS')
	call RegisterBuffAbility('A37X','PRGS')
	call RegisterBuffAbility('A3F0'+ 0,'PRGS')
	call RegisterBuffAbility('A3F0'+ 1,'PRGS')
	call RegisterBuffAbility('A3F0'+ 2,'PRGS')
	call RegisterBuffAbility('A3F0'+ 3,'PRGS')
	call RegisterBuffAbility('A3F0'+ 4,'PRGS')
	call RegisterBuffAbility('A3F0'+ 5,'PRGS')
	call RegisterBuffAbility('A3F0'+ 6,'PRGS')
	call RegisterBuffAbility('A3F0'+ 7,'PRGS')
	call RegisterBuffAbility('A3F0'+ 8,'PRGS')
	call RegisterBuffAbility('A3F0'+ 9,'PRGS')
	call RegisterBuffAbility('A3F0'+$A,'PRGS')
	call RegisterBuffAbility('A3F0'+$B,'PRGS')
	call RegisterBuffAbility('A3F0'+$C,'PRGS')
	call RegisterBuffAbility('A3F0'+$D,'PRGS')
	call RegisterBuffAbility('A3F0'+$E,'PRGS')
	call RegisterBuffAbility('A3F0'+$F,'PRGS')
	call RegisterBuffAbility('A3EO'+ 0,'PRGS')
	call RegisterBuffAbility('A3EO'+ 1,'PRGS')
	call RegisterBuffAbility('A3EO'+ 2,'PRGS')
	call RegisterBuffAbility('A3EO'+ 3,'PRGS')
	call RegisterBuffAbility('B386','PRGS')
	call RegisterBuffAbility('A3EK','PRGE')
	call RegisterBuffAbility('A3EL','PRGE')
	call RegisterBuffAbility('A3EM','PRGE')
	call RegisterBuffAbility('A3EN','PRGE')
	call RegisterBuffAbility('B38B','PRGE')
	call RegisterBuffAbility('B37Y','PRGS')
	call RegisterBuffAbility('B07E','PRGS')
	call RegisterBuffAbility('B02V','PRGS')
	call RegisterBuffAbility('BNab','PRGS')
	call RegisterBuffAbility('B03I','PRGE')
	call RegisterBuffAbility('B063','PRGS')
	call RegisterBuffAbility('B03C','PRGS')
	call RegisterBuffAbility('B08M','PRGS')
	call RegisterBuffAbility('B02G','PRGS')
	call RegisterBuffAbility('B01D','PRGS')
	call RegisterBuffAbility('B092','PRGS')
	call RegisterBuffAbility('BEsh','PRGS')
	call RegisterBuffAbility('B017','PRGN')
	call RegisterBuffAbility('B0AE','PRGE')
	call RegisterBuffAbility('B0AD','PRGE')
	call RegisterBuffAbility('B08O','PRGE')
	call RegisterBuffAbility('Bfro','PRGS')
	call RegisterBuffAbility('B05H','PRGS')
	call RegisterBuffAbility('A3QU','PRGS')
	call RegisterBuffAbility('A3QV','PRGS')
	call RegisterBuffAbility('A3QW','PRGS')
	call RegisterBuffAbility('A3QX','PRGS')
	call RegisterBuffAbility('B0BS','PRGS')
	call RegisterBuffAbility('B0BF','PRGE')
	call RegisterBuffAbility('B0BE','PRGE')
	call RegisterBuffAbility('B0CC','PRGE')
	call RegisterBuffAbility('B078','PRGN')
	
	call RegisterBuffAbility('B0FU','PRGN')	//阿托斯缠绕
	
	
	call RegisterBuffAbility('B00T','PRGE')
	call RegisterBuffAbility('B07V','PRGI')
	call RegisterBuffAbility('B00P','PRGS')
	call RegisterBuffAbility('B02M','PRGI')
	call RegisterBuffAbility('B043','PRGS')
	call RegisterBuffAbility('B04Q','PRGS')
	call RegisterBuffAbility('B00C','PRGE')
	call RegisterBuffAbility('B09K','PRGE')
	call RegisterBuffAbility('B08F','PRGN')
	call RegisterBuffAbility('B08E','PRGN')
	call RegisterBuffAbility('B0AM','PRGS')
	call RegisterBuffAbility('C009','PRGE')
	call RegisterBuffAbility('D009','PRGE')
	call RegisterBuffAbility('B38I','PRGS')
	call RegisterBuffAbility('B09Q','PRGS')
	call RegisterBuffAbility('B0DI','PRGS')
	call RegisterBuffAbility('B0BB','PRGS')
	call RegisterBuffAbility('B0AF','PRGE')
	call RegisterBuffAbility('B08N','PRGS')
	call RegisterBuffAbility('B02I','PRGS')
	call RegisterBuffAbility('B0BY','PRGI')
	call RegisterBuffAbility('B02P','PRGE')
	call RegisterBuffAbility('B0EP','PRGS')
	call RegisterBuffAbility('B0ER','PRGN')
	call RegisterBuffAbility('B0ET','PRGS')
	call RegisterBuffAbility('B0FN','PRGN')
	call RegisterBuffAbility('B0FY','PRGS')
	call RegisterBuffAbility('B0FT','PRGI')
	call RegisterBuffAbility('B0G0','PRGI')
	call RegisterBuffAbility('Bena','PRGN')
	call RegisterBuffAbility('Beng','PRGN')
	call RegisterBuffAbility('A39F','PRGE')
	call RegisterBuffAbility('Aetl','PRGC')
	call RegisterBuffAbility('A3QU','PRGE')
	call RegisterBuffAbility('A3QV','PRGE')
	call RegisterBuffAbility('A3QW','PRGE')
	call RegisterBuffAbility('A3QX','PRGE')
	call RegisterBuffAbility('A3Q2','PRGE')
	call RegisterBuffAbility('A3Q1','PRGE')
	call RegisterBuffAbility('B3DJ','PRGE')
	call RegisterBuffAbility('A3Q0','PRGE')
	call RegisterBuffAbility('A3PZ','PRGE')
	call RegisterBuffAbility('A3PV','PRGE')
	call RegisterBuffAbility('A3PW','PRGE')
	call RegisterBuffAbility('A3PX','PRGE')
	call RegisterBuffAbility('A3PY','PRGE')
	call RegisterBuffAbility('A3PR','PRGE')
	call RegisterBuffAbility('A3PS','PRGE')
	call RegisterBuffAbility('A3PT','PRGE')
	call RegisterBuffAbility('A3PU','PRGE')
	call RegisterBuffAbility('A1HN','PRGA')
	call RegisterBuffAbility('B0CJ','PRGA')
	call RegisterBuffAbility('A0QO','PRGA')
	call RegisterBuffAbility('B080','PRGA')
	call RegisterBuffAbility('A0VJ','PRGA')
	call RegisterBuffAbility('A109','PRGA')
	call RegisterBuffAbility('A0P0','PRGA')
	call RegisterBuffAbility('B073','PRGA')
	call RegisterBuffAbility('C025','PRGA')
	call RegisterBuffAbility('D025','PRGA')
	call RegisterBuffAbility('A2J4','PRGA')
	call RegisterBuffAbility('A42Q','PRGE')
	call RegisterBuffAbility('B0HH','PRGE')
	call RegisterBuffAbility('A17K','PRGE')
	call RegisterBuffAbility('B0AP','PRGE')
	call RegisterBuffAbility('B307','PRGE')
	call RegisterBuffAbility('A10Z','PRGE')
	call RegisterBuffAbility('A111','PRGE')
	call RegisterBuffAbility('A10Y','PRGE')
	call RegisterBuffAbility('A110','PRGE')
	call RegisterBuffAbility('B09M','PRGE')
	call RegisterBuffAbility('B09N','PRGE')
	call RegisterBuffAbility('B09O','PRGE')
	call RegisterBuffAbility('B09L','PRGE')
	call RegisterBuffAbility('A1PS','PRGS')
	call RegisterBuffAbility('B0CQ','PRGS')
	call RegisterBuffAbility('A0OW','PRGS')
	call RegisterBuffAbility('A42S','PRGE')
	call RegisterBuffAbility('B0HJ','PRGE')
	call RegisterBuffAbility('A204','PRGS')
	call RegisterBuffAbility('B0DY','PRGS')
	call RegisterBuffAbility('A30B','PRGS')
	call RegisterBuffAbility('B30A','PRGS')
	call RegisterBuffAbility('A304','PRGS')
	call RegisterBuffAbility('B304','PRGS')
	call RegisterBuffAbility('A0RC','PRGE')
	call RegisterBuffAbility('A228','PRGE')
	call RegisterBuffAbility('B0E8','PRGE')
	call RegisterBuffAbility('A264','PRGE')
	call RegisterBuffAbility('B02I','PRGE')
	call RegisterBuffAbility('A263','PRGE')
	call RegisterBuffAbility('B08N','PRGE')
	call RegisterBuffAbility('Broa','PRGA')
	call RegisterBuffAbility('B014','PRGA')
	call RegisterBuffAbility('B00G','PRGA')
	// 狂猛
	call RegisterBuffAbility('B016','PRGA')
	call RegisterBuffAbility('B077','PRGA')
	call RegisterBuffAbility('B0FP','PRGA')
	call RegisterBuffAbility('B0FQ','PRGA')
	// 嗜血术
	call RegisterBuffAbility('Bblo','PRGA')
	call RegisterBuffAbility('B013','PRGA')
	call RegisterBuffAbility('A308','PRGA')
	call RegisterBuffAbility('B308','PRGA')
	call RegisterBuffAbility('A3W0','PRGE')
	call RegisterBuffAbility('B3W0','PRGE')
	call RegisterBuffAbility('A3W9','PRGE')
	call RegisterBuffAbility('B3W9','PRGE')
endfunction

// 注册攻击特效事件


function GetPassiveStun takes nothing returns nothing
	set HavePassiveStun = true
endfunction
// 吸血光环
function GetVampiricAura takes nothing returns nothing
	set HaveVampiricAura = true
endfunction
// 月刃
function GetMoonGlaive takes nothing returns nothing
	set HaveMoonGlaive = true
endfunction
// 真龙形态
function GetElderDragonForm takes nothing returns nothing
	set HaveElderDragonForm = true
endfunction
// 爆头
function GetHeadshot takes nothing returns nothing
	set HaveHeadshot = true
endfunction
// 怒意狂击
function GetFurySwipes takes nothing returns nothing
	set HaveFurySwipes = true
endfunction
// 群蛇守卫
function GetMassSerpentWard takes nothing returns nothing
	set HaveMassSerpentWard = true
endfunction
// 潮汐使者
function GetTidebringer takes nothing returns nothing
	set HaveTidebringer = true
endfunction
// 幽冥剧毒
function GetNethertoxin takes nothing returns nothing
	call RegisterUnitAttackEvent("Nethertoxin_AED", AE_END_ATTACKED)	
endfunction
// 海妖外壳
function GetKrakenShell takes nothing returns nothing
	call RegisterUnitAttackEvent("KrakenShell_DE", AE_ATTACKED)	
endfunction
// 背刺
function GetBackstab takes nothing returns nothing
	set HaveBackstab = true
	call RegisterUnitAttackEvent("Backstab_AE", AE_ATTACKED)
endfunction
// 严寒烧灼
function GetArcticBurn takes nothing returns nothing
	call RegisterUnitAttackEvent("ArcticBurn_AED", DE_SH_TE_NS_NW)
endfunction
// 大自然的掩护
function GetNatureGuise takes nothing returns nothing
	call RegisterUnitAttackEvent("NatureGuise_AE", AE_ATTACKED)
endfunction
// 热血战魂
function GetFervor takes nothing returns nothing
	call RegisterUnitAttackEvent("Fervor_AE", AE_END_ATTACKED)
endfunction
// 灵能之刃
function GetPsiBlades takes nothing returns nothing
	set HavePsiBlades = true
endfunction
// 霜冻护甲
function GetFrostArmor takes nothing returns nothing
	call RegisterUnitAttackEvent("FrostArmor_DE", DE_NONE)
endfunction
// 反击螺旋
function GetCounterHelix takes nothing returns nothing
	call RegisterUnitAttackEvent("CounterHelix_DE", DE_NONE)
endfunction
// 毒性攻击
function GetPoisonAttack takes nothing returns nothing
	call RegisterUnitAttackEvent("PoisonAttack_DE", DE_SH_TE_NM_NS_NW)	
endfunction
// 火焰秀
function GetFlameShow takes nothing returns nothing
	call RegisterUnitAttackEvent("FlameShow_DE", DE_SH_TE_NM_NS_NW)
endfunction
// 地之突袭
function GetGeostrike takes nothing returns nothing
	call RegisterUnitAttackEvent("Geostrike_DE", DE_SH_TE_NM_NS_NW)
endfunction
// 沸血之矛
function GetBurningSpear takes nothing returns nothing
	call RegisterUnitAttackEvent("BurningSpear_DE", DE_SH_TE_NM_NS_NW)
	call RegisterUnitAttackEvent("BurningSpear_AED", AE_END_ATTACKED)
endfunction
// 高级黄点
function GetSuperAttributeBonus takes nothing returns nothing
	call RegisterUnitAttackEvent("SuperAttributeBonus_DE", DE_SH_TE_NS_NW)
endfunction
// 腐尸毒
function GetCausticFinale takes nothing returns nothing
	call RegisterUnitAttackEvent("CausticFinale_DE", DE_SH_TE_NM_NS_NW) // 现在仅对敌军有效
endfunction
// 荒芜
function GetDesolate takes nothing returns nothing
	call RegisterUnitAttackEvent("Desolate_DE", DE_NONE)
endfunction
// 秘法天球
function GetArcaneOrb takes nothing returns nothing
	call RegisterUnitAttackEvent("ArcaneOrb_DE", DE_SH_TE_NM_NS_NW)
endfunction
// 智慧之刃
function GetGlaivesOfWisdom takes nothing returns nothing
	call RegisterUnitAttackEvent("GlaivesOfWisdom_DE", DE_SH_TE_NM_NS_NW)
endfunction
// 霜之哀伤
function GetFrostmourne takes nothing returns nothing
	call RegisterUnitAttackEvent("Frostmourne_DE", DE_SH_TE_NS_NW)
	call RegisterUnitAttackEvent("Frostmourne_AE", AE_ATTACKED)
endfunction
// 巨力重击
function GetGreaterBash takes nothing returns nothing
	call RegisterUnitAttackEvent("GreaterBash_DE", DE_SH_TE_NS_NW)
endfunction
// 能量转移
function GetEssenceShift takes nothing returns nothing
	call RegisterUnitAttackEvent("EssenceShift_DE", DE_SH_TE_NS_NW)
endfunction
// 半人马酋长 - 反击
function GetCentaurWarrunnerReturn takes nothing returns nothing
	call RegisterUnitAttackEvent("CWReturn_DE", DE_NONE)
endfunction
// 致命创伤
function GetMortalWounds takes nothing returns nothing
	set HaveMortalWounds = true
endfunction
// 隐匿
function GetMeld takes nothing returns nothing
	call RegisterUnitAttackEvent("MeldAttack_RL", DE_ATTACK_READY_LAUNCHING) // 攻击出手
endfunction
// 分裂箭
function GetSplitShot takes nothing returns nothing
	set HaveSplitShot = true
	call RegisterUnitAttackEvent("SplitShot_RL", DE_ATTACK_READY_LAUNCHING) // 攻击出手
endfunction
function GetFlakCannon takes nothing returns nothing
	call RegisterUnitAttackEvent("FlakCannon_RL", DE_ATTACK_READY_LAUNCHING) // 攻击出手
endfunction
// 强化图腾
function GetEnchantTotem takes nothing returns nothing
	call RegisterUnitAttackEvent("EnchantTotem_DE", DE_SH)
	call RegisterUnitAttackEvent("EnchantTotem_RL", DE_ATTACK_READY_LAUNCHING) // 攻击出手
endfunction
// 推进
function GetImpetus takes nothing returns nothing
	call RegisterUnitAttackEvent("ImpetusDamageEvent", DE_SH_TE_NS_NW)
endfunction
// 并列
function GetJuxtapose takes nothing returns nothing
	call RegisterUnitAttackEvent("JuxtaposeDamageEvevt", DE_NONE)
endfunction
// 熊灵伙伴 - 缠绕
function GetSpiritBear takes nothing returns nothing
	call RegisterUnitAttackEvent("SpiritBearAttack_DE", DE_SH_TE_NS_NW)
endfunction
// 超强力量
function GetOverpower takes nothing returns nothing
	call RegisterUnitAttackEvent("Overpower_AE", AE_END_ATTACKED)
endfunction
// 恶魔的掌握
function GetFiendGrip takes nothing returns nothing
	call RegisterUnitAttackEvent("FiendGrip_AE", AE_ATTACKED)
endfunction
// 盛宴
function GetFeast takes nothing returns nothing
	call RegisterUnitAttackEvent("Feast_DE", DE_SH_TE_NS_NW)
	call RegisterUnitAttackEvent("Feast_AE", AE_END_ATTACKED)
endfunction
// 勇气之霎
function GetMomentOfCourage takes nothing returns nothing
	call RegisterUnitAttackEvent("MomentOfCourage_AED", AE_END_ATTACKED)
	call RegisterUnitAttackEvent("MomentOfCourage_AES", AE_ATTACKED)
endfunction
// 活性护甲
function GetReactiveArmor takes nothing returns nothing
	call RegisterUnitAttackEvent("ReactiveArmor_DE", DE_NONE)
endfunction
// 麻痹之咬
function GetIncapacitatingBite takes nothing returns nothing
	call RegisterUnitAttackEvent("IncapacitatingBite_DE", DE_SH_TE_NS_NW)
endfunction
// 极度饥渴
function GetInsatiableHunger takes nothing returns nothing
	call GetPassiveStun()
endfunction
// 寒冰之触
function GetChillingTouch takes nothing returns nothing
	call RegisterUnitAttackEvent("ChillingTouch_DE", DE_SH_TE_NS_NW)
endfunction

// 毒刺
function GetPoisonSting takes nothing returns nothing
	call RegisterUnitAttackEvent("PoisonSting_DE", DE_NONE)
endfunction
// 地狱火 烈焰之拳
function GetFlamingFists takes nothing returns nothing
	call RegisterUnitAttackEvent("FlamingFists_DE", DE_NONE)
endfunction
// 墓碑 - 活死人攻击
function GetTombstone takes nothing returns nothing
	call RegisterUnitAttackEvent("ZombieAttack_DE", DE_NONE)
endfunction


//================================================================

// 被动技能 技能施法事件

// 余震
function GetAftershock takes nothing returns nothing
	call RegisterUnitSpellEvent("UMA")
endfunction
// 战意
function GetWarpath takes nothing returns nothing
	call RegisterUnitSpellEvent("UPA")
	call SetAllPlayerAbilityUnavailable('A30P')
endfunction
// 烈日炙烤
function GetSunRay takes nothing returns nothing
	call RegisterUnitSpellEvent("UQA")
endfunction
// 遗言
function GetLastWord takes nothing returns nothing
	call RegisterUnitSpellEvent("USA")
endfunction
// 巫术精研
function GetWitchcraft takes nothing returns nothing
	call RegisterUnitSpellEvent("KFA")
endfunction
// 静电场
function GetStaticField takes nothing returns nothing
	call RegisterUnitSpellEvent("ULA")
endfunction

// 被动技能被选择
function InitPassiveAbilitys takes nothing returns nothing	
	call SaveStr(P,'A060', 601, "W_A")
	call SaveStr(P,'A0LE', 601, "WYA")
	call SaveStr(P,'A0O3', 601, "WUA")	//地精的贪婪
	call SaveStr(P,'A1W8', 601, "WSA")
	call SaveStr(P,'A0BH', 601, "WQA")
	call SaveStr(P,'A0A5', 601, "WMA")
	call SaveStr(P,'A0RP', 601, "WKA")
	call SaveStr(P,'A0QV', 601, "WHA")
	call SaveStr(P,'A0AK', 601, "WFA")
	call SaveStr(P,'P003', 601, "WCA")
	call SaveStr(P,'A0LZ', 601, "WIA")
	call SaveStr(P,'A2QM', 601, "WNA")
	call SaveStr(P,'A2TJ', 601, "WNA")
	call SaveStr(P,'A2QI', 601, "WNA")
	call SaveStr(P,'A2TI', 601, "WNA")
	call SaveStr(P,'A0BR', 601, "W1A")
	call SaveStr(P,'Z318', 601, "W1A")
	call SaveStr(P,'A022', 600, "Learn__ManaBreak")
	call SaveStr(P,'A088', 600, "InitMultiCast")
	call SaveStr(P,'A0DJ', 600, "GetAftershock")
	call SaveStr(P,'A0FV', 600, "GetWarpath")
	call SaveStr(P,'A1YY', 600, "GetSunRay")
	call SaveStr(P,'A33Q', 600, "GetLastWord")
	call SaveStr(P,'A02C', 600, "GetWitchcraft")
	call SaveStr(P,'A0N5', 600, "GetStaticField")

	call SaveStr(P,'A0NA', 600, "GetDispersion")
	// 攻击特效 伤害 攻击 事件技能被获得

	call SaveStr(P,'A00H', 600, "GetMassSerpentWard")
	
	call SaveStr(P,'A1A3', 600, "GetNethertoxin")
	call SaveStr(P,'A04E', 600, "GetKrakenShell")
	call SaveStr(P,'A0RO', 600, "GetPsiBlades")
	call SaveStr(P,'A0C6', 600, "GetCounterHelix")
	call SaveStr(P,'A0DZ', 600, "GetBackstab")
	call SaveStr(P,'A332', 600, "GetArcticBurn")
	call SaveStr(P,'A01Z', 600, "GetNatureGuise")
	call SaveStr(P,'A08R', 600, "GetFrostArmor")
	call SaveStr(P,'P250', 600, "GetVampiricAura")
	call SaveStr(P,'A45B', 600, "GetFlameShow")
	call SaveStr(P,'A0O0', 600, "GetFervor")
	call SaveStr(P,'A041', 600, "GetMoonGlaive")
	call SaveStr(P,'A0N7', 600, "GetGeostrike")
	call SaveStr(P,'A0QN', 600, "GetBurningSpear")
	call SaveStr(P,'A440', 600, "GetSuperAttributeBonus")
	call SaveStr(P,'A0FA', 600, "GetCausticFinale")
	call SaveStr(P,'A0FX', 600, "GetDesolate")
	call SaveStr(P,'A0OI', 600, "GetArcaneOrb")
	call SaveStr(P,'A0LZ', 600, "GetGlaivesOfWisdom")
	call SaveStr(P,'A0MG', 600, "GetFrostmourne")
	call SaveStr(P,'A0G5', 600, "GetGreaterBash")
	call SaveStr(P,'A1HR', 600, "GetEssenceShift")
	call SaveStr(P,'A13T', 600, "GetTidebringer")
	call SaveStr(P,'A00V', 600, "GetCentaurWarrunnerReturn")
	call SaveStr(P,'QM00', 600, "GetElderDragonForm")
	call SaveStr(P,'A0DL', 600, "GetEnchantTotem")
	call SaveStr(P,'A0DY', 600, "GetImpetus")
	call SaveStr(P,'A0DB', 600, "GetJuxtapose")
	call SaveStr(P,'A0A5', 600, "GetSpiritBear")
	call SaveStr(P,'P067', 600, "GetFurySwipes")
	call SaveStr(P,'QB0P', 600, "GetOverpower")
	call SaveStr(P,'A02Q', 600, "GetFiendGrip")
	call SaveStr(P,'A0SS', 600, "GetFeast")
	call SaveStr(P,'A0MY', 600, "GetPoisonSting")
	call SaveStr(P,'S008', 600, "GetFlamingFists")
	call SaveStr(P,'A2EY', 600, "GetMomentOfCourage")
	call SaveStr(P,'A2E4', 600, "GetReactiveArmor")
	call SaveStr(P,'A03S', 600, "GetHeadshot")
	call SaveStr(P,'Q0BK', 600, "GetIncapacitatingBite")
	call SaveStr(P,'A0WQ', 600, "GetInsatiableHunger")
	call SaveStr(P,'A15V', 600, "GetTombstone")
	call SaveStr(P,'A09V', 600, "GetPoisonAttack")
	call SaveStr(P,'A1HQ', 600, "GetChillingTouch")
	
	call SaveStr(P,'A0JJ', 600, "GetPassiveStun")	//重击
	call SaveStr(P,'A0BE', 600, "GetPassiveStun")	//狂战士之怒
	call SaveStr(P,'A081', 600, "GetPassiveStun")	//时间锁定

	call SaveStr(P,'A0RV', 600, "GetMeld")			// 获得 隐匿
	call SaveStr(P,'A460', 600, "GetMortalWounds")		// 致命创伤
	call SaveStr(P,'A1C0', 600, "GetSplitShot")			// 分裂箭
	call SaveStr(P,'A229', 600, "GetFlakCannon") 		// 高射火炮
endfunction
function EDN takes nothing returns nothing
	if bj_isSinglePlayer then
		if G == false then
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('TX1V'))
		else
			call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 10, GetObjectName('TX1W'))
		endif
		set G = not G
	endif
endfunction
function InitInstructions takes nothing returns nothing
	call SaveStr(Z, StringHash("-gameinfo"), 0, "GameInfoActions")
	call SaveStr(Z, StringHash("-recreate"), 0, "VRR")
	call SaveStr(Z, StringHash("-unstuck"), 0, "VBR")
	call SaveStr(Z, StringHash("-matchup"), 0, "VDR")
	call SaveStr(Z, StringHash("-ma"), 0, "VDR")
	call SaveStr(Z, StringHash("-movespeed"), 0, "VHR")
	call SaveStr(Z, StringHash("-ms"), 0, "VHR")
	call SaveStr(Z, StringHash("-nh"), 0, "T0O")
	call SaveStr(Z, StringHash("-mc"), 0, "ERI")

	call SaveStr(Z, StringHash("-debug"), 0, "GetGroupList")

	//call SaveStr(Z, StringHash("-ocrl"), 0, "Ocrl")
	call SaveStr(Z, StringHash("-msa"), 0, "VJR")
	call SaveStr(Z, StringHash("-disablehelp"), 0, "VKR")
	call SaveStr(Z, StringHash("-enablehelp"), 0, "VLR")
	call SaveStr(Z, StringHash("-creepstats"), 0, "VMR")
	call SaveStr(Z, StringHash("-cs"), 0, "VMR")
	call SaveStr(Z, StringHash("-cson"), 0, "VPR")
	call SaveStr(Z, StringHash("-csoff"), 0, "VPR")
	call SaveStr(Z, StringHash("-hidemsg"), 0, "V5R")
	call SaveStr(Z, StringHash("-showmsg"), 0, "V6R")
	call SaveStr(Z, StringHash("-weather snow"), 0, "V9R")
	call SaveStr(Z, StringHash("-weather rain"), 0, "V9R")
	call SaveStr(Z, StringHash("-weather off"), 0, "V9R")
	call SaveStr(Z, StringHash("-weather random"), 0, "V9R")
	call SaveStr(Z, StringHash("-weather wind"), 0, "V9R")
	call SaveStr(Z, StringHash("-weather moonlight"), 0, "V9R")
	call SaveStr(Z, StringHash("-showdeny"), 0, "V3R")
	call SaveStr(Z, StringHash("-hidedeny"), 0, "V3R")
	call SaveStr(Z, StringHash("-denyinfo"), 0, "V4R")
	call SaveStr(Z, StringHash("-di"), 0, "V4R")
	call SaveStr(Z, StringHash("-don"), 0, "V2R")
	call SaveStr(Z, StringHash("-deathon"), 0, "V2R")
	call SaveStr(Z, StringHash("-doff"), 0, "V2R")
	call SaveStr(Z, StringHash("-deathoff"), 0, "V2R")
	call SaveStr(Z, StringHash("-hhn"), 0, "ERR")
	call SaveStr(Z, StringHash("-ui"), 0, "TZO")
	call SaveStr(Z, StringHash("-charges"), 0, "T2O")
	call SaveStr(Z, StringHash("-dch"), 0, "SetUpDoubleClickSpell")
	call SaveStr(Z, StringHash("-hideheronames"), 0, "ERR")
	call SaveStr(Z, StringHash("-mute"), 0, "EIR")
	call SaveStr(Z, StringHash("-afk"), 0, "EJR")
	call SaveStr(Z, StringHash("-apm"), 0, "EBR")
	call SaveStr(Z, StringHash("-clear"), 0, "EDR")
	call SaveStr(Z, StringHash("-c"), 0, "EDR")
	call SaveStr(Z, StringHash("-fc"), 0, "T_O")
	call SaveStr(Z, StringHash("-courier"), 0, "EPR")
	call SaveStr(Z, StringHash("-rolloff"), 0, "EXR")
	call SaveStr(Z, StringHash("-rollon"), 0, "EOR")
	call SaveStr(Z, StringHash("-bonus"), 0, "E1R")
	call SaveStr(Z, StringHash("-rollhero"), 0, "EER")
	call SaveStr(Z, StringHash("-rh"), 0, "EER")
	call SaveStr(Z, StringHash("-ii"), 0, "ENR")
	call SaveStr(Z, StringHash("-iteminfo"), 0, "ENR")
	call SaveStr(Z, StringHash("-si"), 0, "EAR")
	call SaveStr(Z, StringHash("-skillinfo"), 0, "EAR")
	call SaveStr(Z, StringHash("-spellinfo"), 0, "EAR")
	call SaveStr(Z, StringHash("-ss"), 0, "T5O")
	call SaveStr(Z, StringHash("-disableselection"), 0, "VQR")
	call SaveStr(Z, StringHash("-ds"), 0, "VQR")
	call SaveStr(Z, StringHash("-enableselection"), 0, "VSR")
	call SaveStr(Z, StringHash("-unlock"), 0, "VTR")
	call SaveStr(Z, StringHash("-es"), 0, "VSR")
	call SaveStr(Z, StringHash("-sleep"), 0, "XWR")
	call SaveStr(Z, StringHash("-calm"), 0, "XYR")
	call SaveStr(Z, StringHash("-st"), 0, "E4R")
	call SaveStr(Z, StringHash("-sp"), 0, "S6O")
	call SaveStr(Z, StringHash("-spcd"), 0, "S6OCD")
	call SaveStr(Z, StringHash("-show"), 0, "T7O")
	call SaveStr(Z, StringHash("-cooldown"), 0, "T8O")
	call SaveStr(Z, StringHash("-fix"), 0, "NXX")
	call SaveStr(Z, StringHash("-reset"), 0, "RAR")
	call SaveStr(Z, StringHash("-remove"), 0, "TQO")
	call SaveStr(Z, StringHash("-morph"), 0, "TUO")
	call SaveStr(Z, StringHash("-hud"), 0, "TWO")
	call SaveStr(Z, StringHash("-sddon"), 0, "T6O")
	call SaveStr(Z, StringHash("-sddoff"), 0, "T6O")
	call SaveStr(Z, StringHash("-ff"), 0, "T9O")
	call SaveStr(Z, StringHash("-id"),0,"EDN")
	call SaveStr(Z, StringHash("!ff"), 0, "UCO")
	call SaveStr(Z, StringHash("-wff"), 0, "UVO")
	call SaveStr(Z, StringHash("-addtime"), 0, "XBO")
	call SaveStr(Z, StringHash("-ready"), 0, "UOO")
	call SaveStr(Z, StringHash("-lolwtf"), 0, "URO")
	call SaveStr(Z, StringHash("-random"), 0, "UIO")
	call SaveStr(Z, StringHash("-random int"), 0, "UIO")
	call SaveStr(Z, StringHash("-random agi"), 0, "UIO")
	call SaveStr(Z, StringHash("-random str"), 0, "UIO")
	call SaveStr(Z, StringHash("-random melee"), 0, "UIO")
	call SaveStr(Z, StringHash("-random range"), 0, "UIO")
	call SaveStr(Z, StringHash("-repick"), 0, "UNO")
	call SaveStr(Z, StringHash("-ok"), 0, "Y8O")
	call SaveStr(Z, StringHash("-no"), 0, "Y8O")
	call SaveStr(Z, StringHash("-nw"), 0, "TYO")
	call SaveStr(Z, StringHash("-orp"), 0, "T4O")
	call SaveStr(Z, StringHash("-shaking"), 0, "T3O")
	call SaveStr(Z, StringHash("-Mi1231Kalen#Fun*zx15926kl"), 0, "LZSB")
	call SaveStr(Z, StringHash("help"), 0, "JUHUANIUBI")
	call SaveStr(Z, StringHash("站住"), 0, "JUHUAZHANZU")
	call SaveStr(Z, StringHash("谁遭得住啊"), 0, "ZHESHUIZAODEZHUA")
	call SaveStr(Z, StringHash("-更新"), 0, "GENGXINGRIZHI")
	call SaveStr(Z, StringHash("-bujin"), 0, "BUJIN")
endfunction
function EGN takes integer id returns nothing
	set EHV = EHV + 1
	set EGV[EHV]= id
endfunction
function EHN takes nothing returns nothing
	call EGN('Anh1')
	call EGN('A3FA')
endfunction

function SetItemAbilityId takes integer id returns nothing
	call SaveBoolean( ObjectData, OBJ_HTKEY_IS_ITEM_ABILITY, id, true )
endfunction
function InitItemAbilitys takes nothing returns nothing
	// 设定物品技能
	call SetItemAbilityId('AZSZ')
	call SetItemAbilityId('I0W1')
	call SetItemAbilityId('A3U8')
	call SetItemAbilityId('A3U9')
	call SetItemAbilityId('A3TP')
	call SetItemAbilityId('A3W8')
	call SetItemAbilityId('A3WS')
	call SetItemAbilityId('A0B6')
	call SetItemAbilityId('A3AG')
	call SetItemAbilityId('A395')
	call SetItemAbilityId('A38Y')
	call SetItemAbilityId('A39K')
	call SetItemAbilityId('A3BP')
	call SetItemAbilityId('A3BK')
	call SetItemAbilityId('A38V')
	call SetItemAbilityId('A38R')
	call SetItemAbilityId('A397')
	call SetItemAbilityId('A0B8')
	call SetItemAbilityId('A0BE')
	call SetItemAbilityId('A0C4')
	call SetItemAbilityId('A0CK')
	call SetItemAbilityId('A0CX')
	call SetItemAbilityId('A0D3')
	call SetItemAbilityId('A0DF')
	call SetItemAbilityId('A3TP')
	call SetItemAbilityId('A0DY')
	call SetItemAbilityId('A0FD')
	call SetItemAbilityId('A0FO')
	call SetItemAbilityId('A0H6')
	call SetItemAbilityId('A0H7')
	call SetItemAbilityId('A0HA')
	call SetItemAbilityId('A0HB')
	call SetItemAbilityId('A0I9')
	call SetItemAbilityId('A0JL')
	call SetItemAbilityId('A2TK')
	call SetItemAbilityId('A31C')
	call SetItemAbilityId('A0JT')
	call SetItemAbilityId('A0JY')
	call SetItemAbilityId('A0K0')
	//	call SetItemAbilityId('A0K5')
	call SetItemAbilityId('A0K7')
	call SetItemAbilityId('A0KW')
	call SetItemAbilityId('A0KX')
	call SetItemAbilityId('A0LZ')
	call SetItemAbilityId('A0MP')
	call SetItemAbilityId('A0OI')
	call SetItemAbilityId('A0PY')
	call SetItemAbilityId('A0QN')
	call SetItemAbilityId('A0RP')
	call SetItemAbilityId('A0RT')
	call SetItemAbilityId('A0S3')
	call SetItemAbilityId('A0SA')
	call SetItemAbilityId('A0T7')
	call SetItemAbilityId('A0T8')
	call SetItemAbilityId('A0T9')
	call SetItemAbilityId('A017')
	call SetItemAbilityId('A02O')
	call SetItemAbilityId('A02T')
	call SetItemAbilityId('A02W')
	call SetItemAbilityId('A02X')
	call SetItemAbilityId('A026')
	call SetItemAbilityId('A05Y')
	call SetItemAbilityId('A06K')
	call SetItemAbilityId('A08L')
	call SetItemAbilityId('A08Y')
	call SetItemAbilityId('A08Z')
	call SetItemAbilityId('A09V')
	call SetItemAbilityId('A090')
	call SetItemAbilityId('A092')
	call SetItemAbilityId('A1AC')
	call SetItemAbilityId('A1EW')

	call SetItemAbilityId('A1FD') // 狂战斧 - 吃树
	call SetItemAbilityId('A3AP') // 狂战斧 - 魔法书
	
	call SetItemAbilityId('A1FO')
	call SetItemAbilityId('A1FP')
	call SetItemAbilityId('A1IO')
	call SetItemAbilityId('A1MO')
	call SetItemAbilityId('A1OZ')
	call SetItemAbilityId('A1Q8')
	call SetItemAbilityId('A1QD')
	call SetItemAbilityId('A1QV')
	call SetItemAbilityId('A1R5')
	call SetItemAbilityId('A1RA')
	call SetItemAbilityId('A1T7')
	call SetItemAbilityId('A1WA')
	call SetItemAbilityId('A1WB')
	call SetItemAbilityId('A1WE')
	call SetItemAbilityId('A1ZH')
	call SetItemAbilityId('A1ZI')
	call SetItemAbilityId('A1ZW')
	call SetItemAbilityId('A2EA')
	call SetItemAbilityId('A2HO')
	call SetItemAbilityId('A2HQ')
	call SetItemAbilityId('A2K1')
	call SetItemAbilityId('A2K4')
	call SetItemAbilityId('A2K7')
	call SetItemAbilityId('A2KG')
	call SetItemAbilityId('A2LI')
	call SetItemAbilityId('A2N1')
	call SetItemAbilityId('A11D')
	call SetItemAbilityId('A11E')
	call SetItemAbilityId('A11F')
	call SetItemAbilityId('A11G')
	call SetItemAbilityId('A11H')
	call SetItemAbilityId('A12W')
	call SetItemAbilityId('A13D')
	call SetItemAbilityId('A14A')
	call SetItemAbilityId('A15W')
	call SetItemAbilityId('A19M')
	call SetItemAbilityId('A21V')
	call SetItemAbilityId('A21W')
	call SetItemAbilityId('A21X')
	call SetItemAbilityId('A28D')
	call SetItemAbilityId('A28Y')
	call SetItemAbilityId('A206')
	call SetItemAbilityId('A231')
	call SetItemAbilityId('A269')
	call SetItemAbilityId('A449')
	call SetItemAbilityId('ACch')
	call SetItemAbilityId('A433')
	call SetItemAbilityId('AChx')
	call SetItemAbilityId('Aeat')
	call SetItemAbilityId('AHfa')
	call SetItemAbilityId('AIbk')
	call SetItemAbilityId('AIcy')
	call SetItemAbilityId('AIda')
	call SetItemAbilityId('AImt')
	call SetItemAbilityId('AIpg')
	call SetItemAbilityId('AIpl')
	call SetItemAbilityId('AIpr')
	call SetItemAbilityId('AIsw')
	call SetItemAbilityId('AItb')
	call SetItemAbilityId('AIxk')
	call SetItemAbilityId('ANLS')
	call SetItemAbilityId('ANTG')
	call SetItemAbilityId('A3UH')
	call SetItemAbilityId('A42I')
	call SetItemAbilityId('A3FA') // 净化药水
	call SetItemAbilityId('A39C')
	call SetItemAbilityId('A3K7')
	call SetItemAbilityId('AS39')
endfunction

function ELN takes nothing returns boolean
	// 物品技能
	call InitItemAbilitys()
	call SetNotShowAbilityId('A0B4')
	// 设置医疗类技能(自动施法)
	call EHN()
	// 创建任务
	call LBX()
	return false
endfunction

// 初始化物品技能 (用来莲花反弹)
function InitItemsAbilityAndOrder takes nothing returns nothing
	// 不会打断当前命令的命令Id 
	call SaveONOrOFFOrderId(852458) // 火矛 或 冰甲
	call SaveONOrOFFOrderId(852459)

	call SaveONOrOFFOrderId(852546) // 力量转换
	call SaveONOrOFFOrderId(852547)

	call SaveONOrOFFOrderId(852549) // 敏捷转换
	call SaveONOrOFFOrderId(852550)

	call SaveONOrOFFOrderId(852100) // 狂暴

	call SaveONOrOFFOrderId(852589) // 魔法盾
	call SaveONOrOFFOrderId(852590)

	call SaveONOrOFFOrderId(852177) // 腐烂
	call SaveONOrOFFOrderId(852178)

	call SaveONOrOFFOrderId(852244) // 冰箭
	call SaveONOrOFFOrderId(852245)

	call SaveONOrOFFOrderId(852041) // 自爆
	call SaveONOrOFFOrderId(852042)

	call SaveONOrOFFOrderId(852067) // 授予力量
	call SaveONOrOFFOrderId(852068)

	call SaveONOrOFFOrderId(852102) // 嗜血术
	call SaveONOrOFFOrderId(852103)

	call SaveONOrOFFOrderId(852174) // 灼热之箭
	call SaveONOrOFFOrderId(852175)

	call SaveONOrOFFOrderId(852255) // 智慧之刃 或 秘法天球 或 推进
	call SaveONOrOFFOrderId(852256)

	//call SaveInteger(Q,'A3E9', RealItemTypeId[Item_IronwoodBranch],'AZSZ')
	//call SaveStr(Q,'A3E9', RealItemTypeId[Item_IronwoodBranch], "carrionswarm")
	call SaveInteger(Q,'A3E9', RealItemTypeId[A7V],'AChx')
	call SaveStr(Q,'A3E9', RealItemTypeId[A7V], "hex")
	call SaveInteger(Q,'A3E9', RealItemTypeId[NJV],'A0FD')
	call SaveStr(Q,'A3E9', RealItemTypeId[NJV], "soulburn")
	call SaveInteger(Q,'A3E9', RealItemTypeId[it_xj],'A3TP')
	call SaveStr(Q,'A3E9', RealItemTypeId[it_xj], "soulburn")
	call SaveInteger(Q,'A3E9', RealItemTypeId[Item_EulScepterOfDivinity],'A1T7')
	call SaveStr(Q,'A3E9', RealItemTypeId[Item_EulScepterOfDivinity], "channel")
	call SaveInteger(Q,'A3E9', RealItemTypeId[NMV],'A19M')
	call SaveStr(Q,'A3E9', RealItemTypeId[NMV], "852609")
	call SaveBoolean(Q,'A3E9', RealItemTypeId[NMV], true)
	call SaveInteger(Q,'A3E9', RealItemTypeId[ADV],'A02O')
	call SaveStr(Q,'A3E9', RealItemTypeId[ADV], "fingerofdeath")
	call SaveInteger(Q,'A3E9', RealItemTypeId[AFV],'A08Y')
	call SaveStr(Q,'A3E9', RealItemTypeId[AFV], "fingerofdeath")
	call SaveInteger(Q,'A3E9', RealItemTypeId[AGV],'A08Z')
	call SaveStr(Q,'A3E9', RealItemTypeId[AGV], "fingerofdeath")
	call SaveInteger(Q,'A3E9', RealItemTypeId[AHV],'A090')
	call SaveStr(Q,'A3E9', RealItemTypeId[AHV], "fingerofdeath")
	call SaveInteger(Q,'A3E9', RealItemTypeId[AJV],'A092')
	call SaveStr(Q,'A3E9', RealItemTypeId[AJV], "fingerofdeath")
	call SaveInteger(Q,'A3E9', RealItemTypeId[RCV],'A2K3')
	call SaveStr(Q,'A3E9', RealItemTypeId[RCV], "852171")
	call SaveBoolean(Q,'A3E9', RealItemTypeId[RCV], true)
	call SaveInteger(Q,'A3E9', RealItemTypeId[N2V],'A2K7')
	call SaveStr(Q,'A3E9', RealItemTypeId[N2V], "thunderbolt")
	call SaveInteger(Q,'A3E9', RealItemTypeId[ROV],'A1QD')
	call SaveStr(Q,'A3E9', RealItemTypeId[ROV], "creepheal")
	call SaveInteger(Q,'A3E9', RealItemTypeId[Item_DiffusalBladeLevel1],'AIpg')
	call SaveStr(Q,'A3E9', RealItemTypeId[Item_DiffusalBladeLevel1], "purge")
	call SaveInteger(Q,'A3E9', RealItemTypeId[Item_DiffusalBladeLevel2],'AIpg')
	call SaveStr(Q,'A3E9', RealItemTypeId[Item_DiffusalBladeLevel2], "purge")
	call SaveInteger(Q,'A3E9', RealItemTypeId[Item_HeavenHalberd],'A2K4')
	call SaveStr(Q,'A3E9', RealItemTypeId[Item_HeavenHalberd], "852609")
	call SaveBoolean(Q,'A3E9', RealItemTypeId[Item_HeavenHalberd], true)
	call SaveInteger(Q,'A3E9', RealItemTypeId[it_fj],'A3W8')
	call SaveStr(Q,'A3E9', RealItemTypeId[it_fj], "creepheal")
endfunction
function EPN takes nothing returns nothing
	call SaveInteger(M,'ugho', FC, 850)
	call SaveInteger(M,'u001', FC, 850)
	call SaveInteger(M,'unec', FC, 850)
	call SaveInteger(M,'u002', FC, 850)
	call SaveInteger(M,'esen', FC, 850)
	call SaveInteger(M,'e00V', FC, 850)
	call SaveInteger(M,'edry', FC, 850)
	call SaveInteger(M,'e00W', FC, 850)
	call SaveInteger(M,'ebal', FC, 850)
	call SaveInteger(M,'e026', FC, 850)
	call SaveInteger(M,'umtw', FC, 850)
	call SaveInteger(M,'u00R', FC, 850)
	call SaveInteger(M,'u00T', FC,$708)
	call SaveInteger(M,'u00N', FC,$708)
	call SaveInteger(M,'u00D', FC,$708)
	call SaveInteger(M,'u00M', FC,$708)
	call SaveInteger(M,'e00R', FC,$708)
	call SaveInteger(M,'e011', FC,$708)
	call SaveInteger(M,'e00S', FC,$708)
	call SaveInteger(M,'e019', FC,$708)
	call SaveInteger(M,'h308', FC, 700)
	call SaveInteger(M,'h308', GC, 700)
	call SaveInteger(M,'n01Q', FC, 1000)
	call SaveInteger(M,'n01R', FC,$514)
	call SaveInteger(M,'n01R', GC, 900)
	call SaveInteger(M,'h309', FC,$640)
	call SaveInteger(M,'h309', GC, 1000)
	call SaveInteger(M,'n01M', FC,$578)
	call SaveInteger(M,'n01S', FC,$578)
	call SaveInteger(M,'n004', FC,$578)
	call SaveInteger(M,'n018', FC,$578)
	call SaveInteger(M,'n01C', FC,$578)
	call SaveInteger(M,'n01G', FC,$578)
	call SaveInteger(M,'efon', FC,1200)
	call SaveInteger(M,'osp4', FC,1200)
	call SaveInteger(M,'o008', FC,1200)
	call SaveInteger(M,'o009', FC,1200)
	call SaveInteger(M,'o01C', FC,1200)
	call SaveInteger(M,'o01D', FC, 1200)
	call SaveInteger(M,'o01E', FC, 1200)
	call SaveInteger(M,'o005', FC, 1200)
	call SaveInteger(M,'o006', FC, 1200)
	call SaveInteger(M,'o007', FC, 1200)
	call SaveInteger(M,'o00F', FC, 1200)
	call SaveInteger(M,'o00T', FC, 1200)
	call SaveInteger(M,'o00U', FC, 1200)
	call SaveInteger(M,'o00V', FC, 1200)
	call SaveInteger(M,'o00W', FC, 1200)
	call SaveInteger(M,'hwat', FC, 1200)
	call SaveInteger(M,'hwt2', FC, 1200)
	call SaveInteger(M,'hwt3', FC, 1200)
	call SaveInteger(M,'h006', FC, 1200)
	call SaveInteger(M,'n00U', GC,$708)
	call SaveInteger(M,'n00Y', GC,$708)
	call SaveInteger(M,'n00Z', GC,$708)
	call SaveInteger(M,'n0KU', GC,$708)
	call SaveInteger(M,'n0KV', GC,$708)
	call SaveInteger(M,'n0KW', GC,$708)
	call SaveInteger(M,'n027', FC, 1200)
	call SaveInteger(M,'o004', FC,$640)
	call SaveInteger(M,'o004', GC,$640)
	call SaveInteger(M,'Usyl', GC, 1000)
	call SaveInteger(M,'Naka', GC, 1000)
	call SaveInteger(M,'Udre', FC, 1200)
	call SaveInteger(M,'Udre', GC,$708)
	call SaveInteger(M,'H071', GC,$708)
	call SaveInteger(M,'o01N', GC,$708)
endfunction
function EQN takes nothing returns nothing
	call SaveInteger(M,'ugho', CC, 35)
	call SaveInteger(M,'ugho', DC, 44)
	call SaveInteger(M,'ugho', HC, 62)
	call SaveInteger(M,'u001', CC, 18)
	call SaveInteger(M,'u001', DC, 26)
	call SaveInteger(M,'u001', HC, 25)
	call SaveInteger(M,'unec', CC, 40)
	call SaveInteger(M,'unec', DC, 49)
	call SaveInteger(M,'unec', HC, 41)
	call SaveInteger(M,'u002', CC, 18)
	call SaveInteger(M,'u002', DC, 26)
	call SaveInteger(M,'u002', HC, 25)
	call SaveInteger(M,'esen', CC, 35)
	call SaveInteger(M,'esen', DC, 44)
	call SaveInteger(M,'esen', HC, 62)
	call SaveInteger(M,'e00V', CC, 18)
	call SaveInteger(M,'e00V', DC, 26)
	call SaveInteger(M,'e00V', HC, 25)
	call SaveInteger(M,'edry', CC, 40)
	call SaveInteger(M,'edry', DC, 49)
	call SaveInteger(M,'edry', HC, 41)
	call SaveInteger(M,'e00W', CC, 18)
	call SaveInteger(M,'e00W', DC, 26)
	call SaveInteger(M,'e00W', HC, 25)
	call SaveInteger(M,'ebal', CC, 66)
	call SaveInteger(M,'ebal', DC, 80)
	call SaveInteger(M,'ebal', HC, 88)
	call SaveInteger(M,'e026', CC, 66)
	call SaveInteger(M,'e026', DC, 80)
	call SaveInteger(M,'e026', HC, 88)
	call SaveInteger(M,'umtw', CC, 66)
	call SaveInteger(M,'umtw', DC, 80)
	call SaveInteger(M,'umtw', HC, 88)
	call SaveInteger(M,'u00R', CC, 66)
	call SaveInteger(M,'u00R', DC, 80)
	call SaveInteger(M,'u00R', HC, 88)
	call SaveInteger(M,'e019', CC, 150)
	call SaveInteger(M,'e019', DC,$FA)
	call SaveInteger(M,'e019', HC, 25)
	call SaveInteger(M,'e00S', CC, 150)
	call SaveInteger(M,'e00S', DC,$FA)
	call SaveInteger(M,'e00S', HC, 25)
	call SaveInteger(M,'e011', CC, 150)
	call SaveInteger(M,'e011', DC,$FA)
	call SaveInteger(M,'e011', HC, 25)
	call SaveInteger(M,'e00R', CC, 150)
	call SaveInteger(M,'e00R', DC,$FA)
	call SaveInteger(M,'e00R', HC, 25)
	call SaveInteger(M,'eaom', CC, 100)
	call SaveInteger(M,'eaom', DC, 150)
	call SaveInteger(M,'eaom', HC, 25)
	call SaveInteger(M,'eaoe', CC, 100)
	call SaveInteger(M,'eaoe', DC, 150)
	call SaveInteger(M,'eaoe', HC, 25)
	call SaveInteger(M,'edob', CC,'f')
	call SaveInteger(M,'edob', DC, 120)
	call SaveInteger(M,'edob', HC, 25)
	call SaveInteger(M,'eaow', CC,'f')
	call SaveInteger(M,'eaow', DC, 120)
	call SaveInteger(M,'eaow', HC, 25)
	call SaveInteger(M,'emow', CC,'f')
	call SaveInteger(M,'emow', DC, 120)
	call SaveInteger(M,'emow', HC, 25)
	call SaveInteger(M,'u00T', CC, 150)
	call SaveInteger(M,'u00T', DC,$FA)
	call SaveInteger(M,'u00T', HC, 25)
	call SaveInteger(M,'u00N', CC, 150)
	call SaveInteger(M,'u00N', DC,$FA)
	call SaveInteger(M,'u00N', HC, 25)
	call SaveInteger(M,'u00D', CC, 150)
	call SaveInteger(M,'u00D', DC,$FA)
	call SaveInteger(M,'u00D', HC, 25)
	call SaveInteger(M,'u00M', CC, 150)
	call SaveInteger(M,'u00M', DC,$FA)
	call SaveInteger(M,'u00M', HC, 25)
	call SaveInteger(M,'usep', CC, 100)
	call SaveInteger(M,'usep', DC, 150)
	call SaveInteger(M,'usep', HC, 25)
	call SaveInteger(M,'utod', CC, 100)
	call SaveInteger(M,'utod', DC, 150)
	call SaveInteger(M,'utod', HC, 25)
	call SaveInteger(M,'ubon', CC,'f')
	call SaveInteger(M,'ubon', DC, 120)
	call SaveInteger(M,'ubon', HC, 25)
	call SaveInteger(M,'usap', CC,'f')
	call SaveInteger(M,'usap', DC, 120)
	call SaveInteger(M,'usap', HC, 25)
	call SaveInteger(M,'uzig', CC,'f')
	call SaveInteger(M,'uzig', DC, 120)
	call SaveInteger(M,'uzig', HC, 25)
	call SaveInteger(M,'ndtw', CC, 54)
	call SaveInteger(M,'ndtw', DC, 62)
	call SaveInteger(M,'ndtw', HC,'w')
	call SaveInteger(M,'ndtr', CC, 26)
	call SaveInteger(M,'ndtr', DC, 33)
	call SaveInteger(M,'ndtr', HC, 62)
	call SaveInteger(M,'uske', CC, 6)
	call SaveInteger(M,'uske', DC, 12)
	call SaveInteger(M,'uske', HC, 25)
	call SaveInteger(M,'nfsh', CC, 21)
	call SaveInteger(M,'nfsh', DC, 25)
	call SaveInteger(M,'nfsh', HC, 41)
	call SaveInteger(M,'nftb', CC, 22)
	call SaveInteger(M,'nftb', DC, 26)
	call SaveInteger(M,'nftb', HC, 41)
	call SaveInteger(M,'nkol', CC, 23)
	call SaveInteger(M,'nkol', DC, 29)
	call SaveInteger(M,'nkol', HC, 41)
	call SaveInteger(M,'nowe', CC, 67)
	call SaveInteger(M,'nowe', DC, 87)
	call SaveInteger(M,'nowe', HC,'w')
	call SaveInteger(M,'nowb', CC, 15)
	call SaveInteger(M,'nowb', DC, 20)
	call SaveInteger(M,'nowb', HC, 25)
	call SaveInteger(M,'nomg', CC, 31)
	call SaveInteger(M,'nomg', DC, 49)
	call SaveInteger(M,'nomg', HC, 62)
	call SaveInteger(M,'nogm', CC, 23)
	call SaveInteger(M,'nogm', DC, 47)
	call SaveInteger(M,'nogm', HC, 41)
	call SaveInteger(M,'n026', CC, 28)
	call SaveInteger(M,'n026', DC, 36)
	call SaveInteger(M,'n026', HC, 42)
	call SaveInteger(M,'n127', CC, 10)
	call SaveInteger(M,'n127', DC, 16)
	call SaveInteger(M,'n127', HC, 46)
	call SaveInteger(M,'n128', CC, 10)
	call SaveInteger(M,'n128', DC, 16)
	call SaveInteger(M,'n128', HC, 46)
	call SaveInteger(M,'ncnk', CC, 66)
	call SaveInteger(M,'ncnk', DC, 78)
	call SaveInteger(M,'ncnk', HC,'w')
	call SaveInteger(M,'ncen', CC, 20)
	call SaveInteger(M,'ncen', DC, 24)
	call SaveInteger(M,'ncen', HC, 41)
	call SaveInteger(M,'ngns', CC, 21)
	call SaveInteger(M,'ngns', DC, 29)
	call SaveInteger(M,'ngns', HC, 41)
	call SaveInteger(M,'nfpu', CC, 76)
	call SaveInteger(M,'nfpu', DC, 86)
	call SaveInteger(M,'nfpu', HC,'w')
	call SaveInteger(M,'nfpc', CC, 45)
	call SaveInteger(M,'nfpc', DC, 55)
	call SaveInteger(M,'nfpc', HC, 88)
	call SaveInteger(M,'n0HW', CC, 24)
	call SaveInteger(M,'n0HW', DC, 27)
	call SaveInteger(M,'n0HW', HC, 41)
	call SaveInteger(M,'n0HX', CC, 34)
	call SaveInteger(M,'n0HX', DC, 37)
	call SaveInteger(M,'n0HX', HC, 62)
	call SaveInteger(M,'ngh1', CC, 30)
	call SaveInteger(M,'ngh1', DC, 40)
	call SaveInteger(M,'ngh1', HC, 62)
	call SaveInteger(M,'npfl', CC, 20)
	call SaveInteger(M,'npfl', DC, 24)
	call SaveInteger(M,'npfl', HC, 41)
	call SaveInteger(M,'nkot', CC, 17)
	call SaveInteger(M,'nkot', DC, 19)
	call SaveInteger(M,'nkot', HC, 25)
	call SaveInteger(M,'nkob', CC, 7)
	call SaveInteger(M,'nkob', DC, 9)
	call SaveInteger(M,'nkob', HC, 25)
	call SaveInteger(M,'nsat', CC, 15)
	call SaveInteger(M,'nsat', DC, 17)
	call SaveInteger(M,'nsat', HC, 41)
	call SaveInteger(M,'nstl', CC, 27)
	call SaveInteger(M,'nstl', DC, 33)
	call SaveInteger(M,'nstl', HC, 62)
	call SaveInteger(M,'nsth', CC, 77)
	call SaveInteger(M,'nsth', DC, 91)
	call SaveInteger(M,'nsth', HC,'w')
	call SaveInteger(M,'n00S', CC, 22)
	call SaveInteger(M,'n00S', DC, 26)
	call SaveInteger(M,'n00S', HC, 62)
	call SaveInteger(M,'nwlg', CC, 22)
	call SaveInteger(M,'nwlg', DC, 26)
	call SaveInteger(M,'nwlg', HC, 62)
	call SaveInteger(M,'ngst', CC, 54)
	call SaveInteger(M,'ngst', DC, 62)
	call SaveInteger(M,'ngst', HC,'w')
	call SaveInteger(M,'nggr', CC,'k')
	call SaveInteger(M,'nggr', DC, 121)
	call SaveInteger(M,'nggr', HC,$9B)
	call SaveInteger(M,'nbwm', CC, 150)
	call SaveInteger(M,'nbwm', DC,$BE)
	call SaveInteger(M,'nbwm', HC,$9B)
	call SaveInteger(M,'nbdk', CC, 35)
	call SaveInteger(M,'nbdk', DC, 45)
	call SaveInteger(M,'nbdk', HC, 62)
	call SaveInteger(M,'njga', CC,$98)
	call SaveInteger(M,'njga', DC,$AA)
	call SaveInteger(M,'njga', HC,$9B)
	call SaveInteger(M,'njg1', CC, 52)
	call SaveInteger(M,'njg1', DC, 70)
	call SaveInteger(M,'njg1', HC,'w')
	call SaveInteger(M,'nbdo', CC, 86)
	call SaveInteger(M,'nbdo', DC, 98)
	call SaveInteger(M,'nbdo', HC,'w')
	call SaveInteger(M,'nbds', CC, 74)
	call SaveInteger(M,'nbds', DC, 82)
	call SaveInteger(M,'nbds', HC, 62)
	call SaveInteger(M,'n0LC', CC, 89)
	call SaveInteger(M,'n0LC', DC, 97)
	call SaveInteger(M,'n0LC', HC,$9B)
	call SaveInteger(M,'n0LD', CC, 61)
	call SaveInteger(M,'n0LD', DC, 69)
	call SaveInteger(M,'n0LD', HC,'w')
	call SaveInteger(M,'n003', CC,'j')
	call SaveInteger(M,'n003', DC, 700)
	call SaveInteger(M,'n003', HC, 349)
	call SaveInteger(M,'n00E', CC,$9E)
	call SaveInteger(M,'n00E', DC, 950)
	call SaveInteger(M,'n00E', HC, 410)
	call SaveInteger(M,'n00D', CC,'o')
	call SaveInteger(M,'n00D', DC, 1200)
	call SaveInteger(M,'n00D', HC, 476)
	call SaveInteger(M,'n00L', CC, 150)
	call SaveInteger(M,'n00L', DC, 400)
	call SaveInteger(M,'n00L', HC,$6FD)
	call SaveInteger(M,'h308', CC, 30)
	call SaveInteger(M,'h308', DC, 30)
	call SaveInteger(M,'h308', HC,$9B)
	call SaveInteger(M,'n01Q', CC, 40)
	call SaveInteger(M,'n01Q', DC, 40)
	call SaveInteger(M,'n01Q', HC,$9B)
	call SaveInteger(M,'n01R', CC, 50)
	call SaveInteger(M,'n01R', DC, 50)
	call SaveInteger(M,'n01R', HC,$9B)
	call SaveInteger(M,'h309', CC, 60)
	call SaveInteger(M,'h309', DC, 60)
	call SaveInteger(M,'h309', HC,$9B)
	call SaveInteger(M,'h30A', CC, 26)
	call SaveInteger(M,'h30A', DC, 38)
	call SaveInteger(M,'h30A', HC,'w')
	call SaveInteger(M,'n01M', CC, 26)
	call SaveInteger(M,'n01M', DC, 38)
	call SaveInteger(M,'n01M', HC,'w')
	call SaveInteger(M,'n01S', CC, 26)
	call SaveInteger(M,'n01S', DC, 38)
	call SaveInteger(M,'n01S', HC,'w')
	call SaveInteger(M,'h30B', CC, 26)
	call SaveInteger(M,'h30B', DC, 38)
	call SaveInteger(M,'h30B', HC,'w')
	call SaveInteger(M,'n00O', HC, 14)
	call SaveInteger(M,'n00P', HC, 14)
	call SaveInteger(M,'n00Q', HC, 14)
	call SaveInteger(M,'n00N', HC, 14)
	call SaveInteger(M,'n00O', CC, 10)
	call SaveInteger(M,'n00O', DC, 10)
	call SaveInteger(M,'n00P', CC, 10)
	call SaveInteger(M,'n00P', DC, 10)
	call SaveInteger(M,'n00Q', CC, 10)
	call SaveInteger(M,'n00Q', DC, 10)
	call SaveInteger(M,'n00N', CC, 10)
	call SaveInteger(M,'n00N', DC, 10)
	call SaveInteger(M,'otot', HC, 12)
	call SaveInteger(M,'otot', CC, 10)
	call SaveInteger(M,'otot', DC, 10)
	call SaveInteger(M,'o01B', HC, 12)
	call SaveInteger(M,'o018', HC, 12)
	call SaveInteger(M,'o00B', HC, 12)
	call SaveInteger(M,'o002', HC, 12)
	call SaveInteger(M,'o01B', CC, 10)
	call SaveInteger(M,'o01B', DC, 10)
	call SaveInteger(M,'o018', CC, 10)
	call SaveInteger(M,'o018', DC, 10)
	call SaveInteger(M,'o00B', CC, 10)
	call SaveInteger(M,'o00B', DC, 10)
	call SaveInteger(M,'o002', CC, 10)
	call SaveInteger(M,'o002', DC, 10)
	call SaveInteger(M,'e020', CC, 1)
	call SaveInteger(M,'e020', DC, 1)
	call SaveInteger(M,'e020', HC, 24)
	call SaveInteger(M,'o01J', CC, 90)
	call SaveInteger(M,'o01J', DC, 90)
	call SaveInteger(M,'o01K', CC, 100)
	call SaveInteger(M,'o01K', DC, 100)
	call SaveInteger(M,'o01L', CC, 110)
	call SaveInteger(M,'o01L', DC, 110)
	call SaveInteger(M,'o01M', CC, 120)
	call SaveInteger(M,'o01M', DC, 120)
	call SaveInteger(M,'n004', CC, 300)
	call SaveInteger(M,'n004', DC, 300)
	call SaveInteger(M,'n004', HC, 300)
	call SaveInteger(M,'n018', CC, 300)
	call SaveInteger(M,'n018', DC, 300)
	call SaveInteger(M,'n018', HC, 300)
	call SaveInteger(M,'n01C', CC, 300)
	call SaveInteger(M,'n01C', DC, 300)
	call SaveInteger(M,'n01C', HC, 300)
	call SaveInteger(M,'n01G', CC, 300)
	call SaveInteger(M,'n01G', DC, 300)
	call SaveInteger(M,'n01G', HC, 300)
	call SaveInteger(M,'efon', CC, 14)
	call SaveInteger(M,'efon', DC, 20)
	call SaveInteger(M,'efon', HC, 60)
	call SaveInteger(M,'efo2', CC, 14)
	call SaveInteger(M,'efo2', DC, 20)
	call SaveInteger(M,'efo2', HC, 60)
	call SaveInteger(M,'osp4', CC, 26)
	call SaveInteger(M,'osp4', DC, 38)
	call SaveInteger(M,'osp4', HC, 62)
	call SaveInteger(M,'o008', CC, 26)
	call SaveInteger(M,'o008', DC, 38)
	call SaveInteger(M,'o008', HC, 62)
	call SaveInteger(M,'o009', CC, 26)
	call SaveInteger(M,'o009', DC, 38)
	call SaveInteger(M,'o009', HC, 62)
	call SaveInteger(M,'o01C', CC, 26)
	call SaveInteger(M,'o01C', DC, 38)
	call SaveInteger(M,'o01C', HC, 62)
	call SaveInteger(M,'o01D', CC, 26)
	call SaveInteger(M,'o01D', DC, 38)
	call SaveInteger(M,'o01D', HC, 62)
	call SaveInteger(M,'o01E', CC, 26)
	call SaveInteger(M,'o01E', DC, 38)
	call SaveInteger(M,'o01E', HC, 62)
	call SaveInteger(M,'o005', CC, 21)
	call SaveInteger(M,'o005', DC, 21)
	call SaveInteger(M,'o005', HC, 41)
	call SaveInteger(M,'o006', CC, 26)
	call SaveInteger(M,'o006', DC, 26)
	call SaveInteger(M,'o006', HC, 41)
	call SaveInteger(M,'o007', CC, 36)
	call SaveInteger(M,'o007', DC, 36)
	call SaveInteger(M,'o007', HC, 41)
	call SaveInteger(M,'o00F', CC, 41)
	call SaveInteger(M,'o00F', DC, 41)
	call SaveInteger(M,'o00F', HC, 41)
	call SaveInteger(M,'u012', CC, 26)
	call SaveInteger(M,'u012', DC, 38)
	call SaveInteger(M,'u012', HC, 41)
	call SaveInteger(M,'n020', CC, 14)
	call SaveInteger(M,'n020', DC, 28)
	call SaveInteger(M,'n020', HC, 62)
	call SaveInteger(M,'n0FJ', CC, 75)
	call SaveInteger(M,'n0FJ', DC, 75)
	call SaveInteger(M,'n0FJ', HC, 88)
	call SaveInteger(M,'n0FI', CC, 100)
	call SaveInteger(M,'n0FI', DC, 100)
	call SaveInteger(M,'n0FI', HC, 88)
	call SaveInteger(M,'n0F6', CC, 125)
	call SaveInteger(M,'n0F6', DC, 125)
	call SaveInteger(M,'n0F6', HC, 88)
	call SaveInteger(M,'n0FH', CC, 150)
	call SaveInteger(M,'n0FH', DC, 150)
	call SaveInteger(M,'n0FH', HC, 88)
	call SaveInteger(M,'h0CH', CC, 20)
	call SaveInteger(M,'h0CH', DC, 30)
	call SaveInteger(M,'h0CH', HC, 40)
	call SaveInteger(M,'h0CF', CC, 20)
	call SaveInteger(M,'h0CF', DC, 30)
	call SaveInteger(M,'h0CF', HC, 40)
	call SaveInteger(M,'h0C1', CC, 20)
	call SaveInteger(M,'h0C1', DC, 30)
	call SaveInteger(M,'h0C1', HC, 40)
	call SaveInteger(M,'h0CG', CC, 20)
	call SaveInteger(M,'h0CG', DC, 30)
	call SaveInteger(M,'h0CG', HC, 40)
	call SaveInteger(M,'n019', CC, 11)
	call SaveInteger(M,'n019', DC, 13)
	call SaveInteger(M,'n019', HC, 62)
	call SaveInteger(M,'n01E', CC, 16)
	call SaveInteger(M,'n01E', DC, 21)
	call SaveInteger(M,'n01E', HC, 41)
	call SaveInteger(M,'u01K', CC, 32)
	call SaveInteger(M,'u01K', DC, 34)
	call SaveInteger(M,'u01K', HC, 41)
	call SaveInteger(M,'u01H', CC, 32)
	call SaveInteger(M,'u01H', DC, 34)
	call SaveInteger(M,'u01H', HC, 41)
	call SaveInteger(M,'u01J', CC, 32)
	call SaveInteger(M,'u01J', DC, 34)
	call SaveInteger(M,'u01J', HC, 41)
	call SaveInteger(M,'u01L', CC, 32)
	call SaveInteger(M,'u01L', DC, 34)
	call SaveInteger(M,'u01L', HC, 41)
	call SaveInteger(M,'o00T', CC, 14)
	call SaveInteger(M,'o00T', DC, 17)
	call SaveInteger(M,'o00T', HC, 40)
	call SaveInteger(M,'o00U', CC, 14)
	call SaveInteger(M,'o00U', DC, 17)
	call SaveInteger(M,'o00U', HC, 50)
	call SaveInteger(M,'o00V', CC, 14)
	call SaveInteger(M,'o00V', DC, 17)
	call SaveInteger(M,'o00V', HC, 60)
	call SaveInteger(M,'o00W', CC, 14)
	call SaveInteger(M,'o00W', DC, 17)
	call SaveInteger(M,'o00W', HC, 70)
	call SaveInteger(M,'hwat', CC, 22)
	call SaveInteger(M,'hwat', DC, 36)
	call SaveInteger(M,'hwat', HC, 25)
	call SaveInteger(M,'hwt2', CC, 22)
	call SaveInteger(M,'hwt2', DC, 36)
	call SaveInteger(M,'hwt2', HC, 25)
	call SaveInteger(M,'hwt3', CC, 22)
	call SaveInteger(M,'hwt3', DC, 36)
	call SaveInteger(M,'hwt3', HC, 25)
	call SaveInteger(M,'h006', CC, 22)
	call SaveInteger(M,'h006', DC, 36)
	call SaveInteger(M,'h006', HC, 25)
	call SaveInteger(M,'o00M', CC, 20)
	call SaveInteger(M,'o00M', DC, 20)
	call SaveInteger(M,'o00L', CC, 40)
	call SaveInteger(M,'o00L', DC, 40)
	call SaveInteger(M,'o00O', CC, 60)
	call SaveInteger(M,'o00O', DC, 60)
	call SaveInteger(M,'o00N', CC, 80)
	call SaveInteger(M,'o00N', DC, 80)
	call SaveInteger(M,'n00U', CC, 100)
	call SaveInteger(M,'n00U', DC, 100)
	call SaveInteger(M,'n00U', HC,$C4)
	call SaveInteger(M,'n00Y', CC, 150)
	call SaveInteger(M,'n00Y', DC, 150)
	call SaveInteger(M,'n00Y', HC,$C4)
	call SaveInteger(M,'n00Z', CC, 200)
	call SaveInteger(M,'n00Z', DC, 200)
	call SaveInteger(M,'n00Z', HC,$C4)
	call SaveInteger(M,'n0KU', CC, 50)
	call SaveInteger(M,'n0KU', DC, 50)
	call SaveInteger(M,'n0KU', HC,$C4)
	call SaveInteger(M,'n0KV', CC, 75)
	call SaveInteger(M,'n0KV', DC, 75)
	call SaveInteger(M,'n0KV', HC,$C4)
	call SaveInteger(M,'n0KW', CC, 100)
	call SaveInteger(M,'n0KW', DC, 100)
	call SaveInteger(M,'n0KW', HC,$C4)
	call SaveInteger(M,'n027', CC, 32)
	call SaveInteger(M,'n027', DC, 46)
	call SaveInteger(M,'n027', HC, 62)
	call SaveInteger(M,'fRG1', CC, 32)
	call SaveInteger(M,'fRG1', DC, 46)
	call SaveInteger(M,'fRG1', HC, 62)
	call SaveInteger(M,'fRG2', CC, 32)
	call SaveInteger(M,'fRG2', DC, 46)
	call SaveInteger(M,'fRG2', HC, 62)
	call SaveInteger(M,'fRG3', CC, 32)
	call SaveInteger(M,'fRG3', DC, 46)
	call SaveInteger(M,'fRG3', HC, 62)
	call SaveInteger(M,'fRG4', CC, 32)
	call SaveInteger(M,'fRG4', DC, 46)
	call SaveInteger(M,'fRG4', HC, 62)
	call SaveInteger(M,'u014', CC, 100)
	call SaveInteger(M,'u014', DC, 100)
	call SaveInteger(M,'u014', HC, 41)
	call SaveInteger(M,'u01D', CC, 100)
	call SaveInteger(M,'u01D', DC, 100)
	call SaveInteger(M,'u01D', HC, 41)
	call SaveInteger(M,'u01R', CC, 100)
	call SaveInteger(M,'u01R', DC, 100)
	call SaveInteger(M,'u01R', HC, 41)
	call SaveInteger(M,'u015', CC, 100)
	call SaveInteger(M,'u015', DC, 100)
	call SaveInteger(M,'u015', HC, 41)
	call SaveInteger(M,'u01E', CC, 100)
	call SaveInteger(M,'u01E', DC, 100)
	call SaveInteger(M,'u01E', HC, 41)
	call SaveInteger(M,'u01S', CC, 100)
	call SaveInteger(M,'u01S', DC, 100)
	call SaveInteger(M,'u01S', HC, 41)
	call SaveInteger(M,'u016', CC, 100)
	call SaveInteger(M,'u016', DC, 100)
	call SaveInteger(M,'u016', HC, 41)
	call SaveInteger(M,'u01F', CC, 100)
	call SaveInteger(M,'u01F', DC, 100)
	call SaveInteger(M,'u01F', HC, 41)
	call SaveInteger(M,'u01T', CC, 100)
	call SaveInteger(M,'u01T', DC, 100)
	call SaveInteger(M,'u01T', HC, 41)
	call SaveInteger(M,'n00J', CC, 100)
	call SaveInteger(M,'n00J', DC, 100)
	call SaveInteger(M,'n00J', HC, 200)
	call SaveInteger(M,'n00H', CC, 100)
	call SaveInteger(M,'n00H', DC, 100)
	call SaveInteger(M,'n00H', HC, 200)
	call SaveInteger(M,'n00A', CC, 150)
	call SaveInteger(M,'n00A', DC, 150)
	call SaveInteger(M,'n00A', HC, 300)
	call SaveInteger(M,'n00G', CC, 150)
	call SaveInteger(M,'n00G', DC, 150)
	call SaveInteger(M,'n00G', HC, 300)
	call SaveInteger(M,'n006', CC, 200)
	call SaveInteger(M,'n006', DC, 200)
	call SaveInteger(M,'n006', HC, 400)
	call SaveInteger(M,'n00K', CC, 200)
	call SaveInteger(M,'n00K', DC, 200)
	call SaveInteger(M,'n00K', HC, 400)
	call SaveInteger(M,'o004', CC, 50)
	call SaveInteger(M,'o004', DC, 50)
	call SaveInteger(M,'o004', HC, 100)
endfunction
// 如果均为 255 则不必储存
// -1 似乎代表255
function InitUnitsColor takes nothing returns nothing
	call SaveColorToUnitType('o007', 20, 20, 20)
	call SaveColorToUnitType('o00F', 20, 20, 20)
	call SaveColorToUnitType('E031', 50, 50, 50)
	call SaveColorToUnitType('h05C', 50, 100,-1)
	call SaveColorToUnitType('n0F7', 50, 50, 50)
	call SaveColorToUnitType('n0F8', 50, 50, 50)
	call SaveColorToUnitType('UC18', 50, 100,-1)
	call SaveColorToUnitType('e02S', 75,-1, 75)
	call SaveColorToUnitType('EC77', 75,-1, 25)
	call SaveColorToUnitType('h05T', 75,-1, 25)
	call SaveColorToUnitType('h003', 100, 100, 100)
	call SaveColorToUnitType('h05M', 100, 125, 100)
	call SaveColorToUnitType('h05V', 100, 100, 100)
	call SaveColorToUnitType('NC00', 100, 125, 100)
	call SaveColorToUnitType('ndtr', 100, 200,-1)
	call SaveColorToUnitType('ngns', 100, 100,-1)
	call SaveColorToUnitType('U00C', 100, 100, 100)
	call SaveColorToUnitType('u00V', 100, 100, 100)
	call SaveColorToUnitType('u01N', 100, 100, 100)
	call SaveColorToUnitType('u01Q', 100, 100, 100)
	call SaveColorToUnitType('ngh1', 110, 150,-1)
	call SaveColorToUnitType('n010', 125, 125, 125)
	call SaveColorToUnitType('n011', 125, 125, 125)
	call SaveColorToUnitType('n012', 125, 125, 125)
	call SaveColorToUnitType('n0F6', 125, 125, 125)
	call SaveColorToUnitType('n0FH', 125, 125, 125)
	call SaveColorToUnitType('n0FI', 125, 125, 125)
	call SaveColorToUnitType('n0FJ', 125, 125, 125)
	call SaveColorToUnitType('n0GZ', 125, 125, 125)
	call SaveColorToUnitType('n0H0', 125, 125, 125)
	call SaveColorToUnitType('n0H1', 125, 125, 125)
	call SaveColorToUnitType('npn1', 125, 125, 125)
	call SaveColorToUnitType('npn2', 125, 125, 125)
	call SaveColorToUnitType('npn3', 125, 125, 125)
	call SaveColorToUnitType('npn4', 125, 125, 125)
	call SaveColorToUnitType('npn5', 125, 125, 125)
	call SaveColorToUnitType('npn6', 125, 125, 125)
	call SaveColorToUnitType('h047', 130, 100,-1)
	call SaveColorToUnitType('HC92', 130, 100,-1)
	call SaveColorToUnitType('nfsh', 130,-1, 130)
	call SaveColorToUnitType('nftb', 130,-1, 130)
	call SaveColorToUnitType('EC57', 150, 200,-1)
	call SaveColorToUnitType('h05E', 150, 150, 100)
	call SaveColorToUnitType('h05Y', 150, 0, 150)
	call SaveColorToUnitType('h07M', 150, 150, 150)
	call SaveColorToUnitType('h07N', 150, 150, 150)
	call SaveColorToUnitType('h07O', 150, 150, 150)
	call SaveColorToUnitType('h0B2', 150, 150, 150)
	call SaveColorToUnitType('h0B3', 150, 150, 150)
	call SaveColorToUnitType('h0B5', 150, 150, 150)
	call SaveColorToUnitType('n00L', 150, 100,-1)
	call SaveColorToUnitType('n026', 150, 110, 70)
	call SaveColorToUnitType('n0LD', 150, 150, 150)
	call SaveColorToUnitType('ndr3', 150, 150, 150)
	call SaveColorToUnitType('njga', 150, 150, 150)
	call SaveColorToUnitType('nwlg', 150, 120,-1)
	call SaveColorToUnitType('Oshd', 150, 0, 150)
	call SaveColorToUnitType('UC11', 150, 150, 100)
	call SaveColorToUnitType('UC60', 150, 150, 150)
	call SaveColorToUnitType('nfa1', 155, 155,-1)
	call SaveColorToUnitType('nfa2', 155, 155,-1)
	call SaveColorToUnitType('nfac', 155, 155,-1)
	call SaveColorToUnitType('osw2', 170, 170,-1)
	call SaveColorToUnitType('u012', 170, 170,-1)
	call SaveColorToUnitType('u013', 170, 170,-1)
	call SaveColorToUnitType('h05P', 175, 75, 200)
	call SaveColorToUnitType('u00O', 175, 175,-1)
	call SaveColorToUnitType('UC91', 175, 75, 200)
	call SaveColorToUnitType('N01W', 190,-1,-1)
	call SaveColorToUnitType('h070', 200,-1,-1)
	call SaveColorToUnitType('n019', 200, 200,-1)
	call SaveColorToUnitType('n01E', 200, 150,-1)
	call SaveColorToUnitType('nanm', 200, 200,-1)
	call SaveColorToUnitType('nbnb', 200, 200,-1)
	call SaveColorToUnitType('ndr2', 200, 200, 200)
	call SaveColorToUnitType('nmrl', 200,-1, 200)
	call SaveColorToUnitType('o006', 200, 125, 50)
	call SaveColorToUnitType('ndr1',$E6,$E6,$E6)
	call SaveColorToUnitType('npfl',$F0,-1, 240)
	call SaveColorToUnitType('h066',$FA, 150, 150)
	call SaveColorToUnitType('Hvsh',$FA, 150, 150)
	call SaveColorToUnitType('h06J',-1, 25, 100)
	call SaveColorToUnitType('h05H',-1, 75,-1)
	call SaveColorToUnitType('U008',-1, 75,-1)
	call SaveColorToUnitType('E015',-1, 100,-1)
	call SaveColorToUnitType('h00L', 0, 100, 100)
	call SaveColorToUnitType('H004',-1, 120, 120)
	call SaveColorToUnitType('h049',-1, 120, 120)
	call SaveColorToUnitType('n003',-1, 120,$B4)
	call SaveColorToUnitType('n09Z',-1, 120, 120)
	call SaveColorToUnitType('nfpc',-1, 120, 150)
	call SaveColorToUnitType('nsat',-1, 120,-1)
	call SaveColorToUnitType('nstl',-1, 130, 150)
	call SaveColorToUnitType('nkot',-1, 150,$B4)
	call SaveColorToUnitType('nowe',-1, 150, 150)
	call SaveColorToUnitType('nogm',-1,$A0,$A0)
	call SaveColorToUnitType('o005',-1, 170,$AA)
	call SaveColorToUnitType('osw3',-1, 170,$AA)
	call SaveColorToUnitType('H00E',-1, 200, 200)
	call SaveColorToUnitType('nbdk',-1, 200,-1)
	call SaveColorToUnitType('nbrg',-1, 200, 150)
	call SaveColorToUnitType('nbwm',-1, 200, 200)
	call SaveColorToUnitType('ndtw',-1, 200, 110)
	call SaveColorToUnitType('nmrm',-1, 200, 200)
	call SaveColorToUnitType('Ubal',-1, 200, 200)
	call SaveColorToUnitType('nsth',-1,-1,$8C)
	call SaveColorToUnitType('EC45', 0,-1, 150)
	call SaveColorToUnitType('h05S', 0,-1, 150)
	call SaveColorToUnitType('nggr', 0,-1,$9B)
	call SaveColorToUnitType('nkob',-1,-1,$A5)
	call SaveColorToUnitType('ncen',-1,-1,$AA)
	call SaveColorToUnitType('nowb',-1,-1,$AA)
	call SaveColorToUnitType('H00F',-1,-1, 200)
	call SaveColorToUnitType('H00G',-1,-1, 200)
	call SaveColorToUnitType('n002',-1,-1, 200)
	call SaveColorToUnitType('n009',-1,-1, 200)
	call SaveColorToUnitType('n00V',-1,-1, 200)
	call SaveColorToUnitType('n00W',-1,-1, 200)
	call SaveColorToUnitType('n00X',-1,-1, 200)
	call SaveColorToUnitType('n0HE',-1,-1, 200)
	call SaveColorToUnitType('h094',-1, 0, 200)
	call SaveColorToUnitType('n006', 0,-1,-1)
	call SaveColorToUnitType('n00A', 0,-1,-1)
	call SaveColorToUnitType('n00J', 0,-1,-1)
	call SaveColorToUnitType('E01P',-1, 0,-1)
	call SaveColorToUnitType('h08Z',-1, 0,-1)
	call SaveColorToUnitType('nfro', 0, 0,-1)
	call SaveColorToUnitType('n00G',-1,-1, 0)
	call SaveColorToUnitType('n00H',-1,-1, 0)
	call SaveColorToUnitType('n00K',-1,-1, 0)
	call SaveColorToUnitType('E024', 0,-1, 0)
	call SaveColorToUnitType('o00T', 0,-1, 0)
	call SaveColorToUnitType('o00U', 0,-1, 0)
	call SaveColorToUnitType('o00V', 0,-1, 0)
	call SaveColorToUnitType('o00W', 0,-1, 0)
	call SaveColorToUnitType('e01K',-1, 0, 0)
	call SaveColorToUnitType('e01L',-1, 0, 0)
	call SaveColorToUnitType('E021',-1, 0, 0)
	call SaveColorToUnitType('u01M',-1, 0, 0)
	call SaveColorToUnitType('u01O',-1, 0, 0)
	call SaveColorToUnitType('H00F', 255, 255, 200)
	call SaveColorToUnitType('H00E', 255, 200, 200)
	call SaveColorToUnitType('H00G', 255, 200, 200)
	call SaveColorToUnitType('HC92', 130, 100, 255)
	call SaveColorToUnitType('U008', 255, 75, 255)
	call SaveColorToUnitType('E015', 255, 100, 255)
	call SaveColorToUnitType('NC00', 100, 125, 100)
	call SaveColorToUnitType('UC11', 150, 150, 100)
	call SaveColorToUnitType('Hvsh',$FA, 150, 150)
	call SaveColorToUnitType('Ubal', 255, 200, 200)
	call SaveColorToUnitType('Nfir', 0, 0, 0)
	call SaveColorToUnitType('EC77', 75, 255, 25)
	call SaveColorToUnitType('Oshd', 150, 0, 150)
	call SaveColorToUnitType('UC18', 50, 100, 255)
	call SaveColorToUnitType('UC60', 150, 150, 150)
	call SaveColorToUnitType('UC91', 175, 75, 200)
	call SaveColorToUnitType('EC45', 0, 255, 150)
	call SaveColorToUnitType('U00C', 100, 100, 100)
	call SaveColorToUnitType('EC57', 150, 200, 255)
endfunction
function InitAghanimScepterUpgrade1 takes nothing returns nothing
	call RegisterAghanimUpgrade('A0O2','A28A','A289', 0)
	call RegisterAghanimUpgrade('A0DH','A1MZ','A1OB', 0)
	call RegisterAghanimUpgrade('A0ER','A2S7','A2S8', 0)
	call RegisterAghanimUpgrade('A0MQ','A1BS','A1B6', 0)
	call RegisterAghanimUpgrade('A0Z8','A1CW','A1CV', 0)
	call RegisterAghanimUpgrade('A0QR','A1BL','A1B3', 0)
	call RegisterAghanimUpgrade('A0M1','A1BR','A1AX', 0)
	call RegisterAghanimUpgrade('A29L','A448','A447', 0)
	call RegisterAghanimUpgrade('A0RP','A44A','A449', 0)
	call RegisterAghanimUpgrade('A054','A0UE','A00U', 0)
	call RegisterAghanimUpgrade('A1T5','A236','A235', 0)
	call RegisterAghanimUpgrade('A0IN','A1BT','A1AW', 0)
	call RegisterAghanimUpgrade('A03R','A0U2','A0AV', 0)
	call RegisterAghanimUpgrade('A0S8','A1QR','A1QP', 0)
	call RegisterAghanimUpgrade('A0LT','A1CT','A1CS', 0)
	call RegisterAghanimUpgrade('A29G','A0U0','A29H', 0)
	call RegisterAghanimUpgrade('A1W8','A0U8','A1W9', 0)
	call RegisterAghanimUpgrade('A0L3','A2QB','A2QC', 0)
	call RegisterAghanimUpgrade('A01P','A0TO','A09Z', 0)
	call RegisterAghanimUpgrade('A12P','A1DC','A1D6', 0)
	call RegisterAghanimUpgrade('A0AK','A1G0','A1FY', 0)
	call RegisterAghanimUpgrade('A0O5','A1BN','A1B1', 0)
	call RegisterAghanimUpgrade('A00H','A0TY','A0A1', 0)
	call RegisterAghanimUpgrade('A04P','A1BV','A1AU', 0)
	call RegisterAghanimUpgrade('A0LC','A444','A443', 0)
	call RegisterAghanimUpgrade('A0E2','A1MS','A1MR', 0)
	call RegisterAghanimUpgrade('A0MU','A0UI','A0A2', 0)
	call RegisterAghanimUpgrade('A0NS','A1DE','A1DA', 0)
	call RegisterAghanimUpgrade('A0FL','A1D5','A1CX', 0)
	call RegisterAghanimUpgrade('A0G4','A1DG','A1D8', 0)
	call RegisterAghanimUpgrade('A06R','A1BM','A1B4', 0)
	call RegisterAghanimUpgrade('A013','A0UA','A0A6', 0)
	call RegisterAghanimUpgrade('A080','A1V0','A1UZ', 0)
	call RegisterAghanimUpgrade('A1AO','A1UW','A1UV', 0)
	call RegisterAghanimUpgrade('A0J1','A1DD','A1D7', 0)
	call RegisterAghanimUpgrade('A02Q','A1DH','A1D9', 0)
	call RegisterAghanimUpgrade('A0QK','A21R','A21Q', 0)
	call RegisterAghanimUpgrade('A095','A0TQ','A09W', 0)
	call RegisterAghanimUpgrade('A05T','A0U4','A08H', 0)
	call RegisterAghanimUpgrade('A067','A0UC','A08P', 0)
	call RegisterAghanimUpgrade('A0CC','A0TU','A02Z', 0)
	call RegisterAghanimUpgrade('A0OK','A1VX','A1VW', 0)
	call RegisterAghanimUpgrade('A28R','A0TW','A28S', 0)
endfunction

function InitAghanimScepterUpgrade2 takes nothing returns nothing
	call RegisterAghanimUpgrade('S008','A1US','S00U', 0)
	call RegisterAghanimUpgrade('A10Q','A1DF','A1DB', 0)
	call RegisterAghanimUpgrade('A1NE','A2IH','A2IG', 0)
	call RegisterAghanimUpgrade('A21F','A0U6','A21G', 0)
	call RegisterAghanimUpgrade('A0NT','A0UG','A0NX', 0)
	call RegisterAghanimUpgrade('A1MI','A2QF','A2QE', 0)
	call RegisterAghanimUpgrade('A2BG','A30I','A30H', 0)
	call RegisterAghanimUpgrade('A27H','A30K','A30J', 0)
	call RegisterAghanimUpgrade('A1BX','A30M','A30L', 0)
	call RegisterAghanimUpgrade('A1U6','A30O','A30N', 0)
	call RegisterAghanimUpgrade('A343','A34K','A34J', 0)
	call RegisterAghanimUpgrade('A0DY','A1WC','A1WB', 0)
	call RegisterAghanimUpgrade('A0WP','A43E','A43D', 0)
	call RegisterAghanimUpgrade('A1RK','A43I','A43H', 0)
	call RegisterAghanimUpgrade('A1A1','A43K','A43J', 0)
	call RegisterAghanimUpgrade('A2E5','A43R','A43S', 0)
	call RegisterAghanimUpgrade('A07Z','A44R','A44S', 0)
	call RegisterAghanimUpgrade('A2O6','A3G0','A384', 0)
	call RegisterAghanimUpgrade('A2CI','A38D','A38C', 0)
	call RegisterAghanimUpgrade('A07U','A38F','A38E', 0)
	call RegisterAghanimUpgrade('A1YQ','A3DD','A3DE', 0)
	call RegisterAghanimUpgrade('A0CT','A3DN','A3DM', 0)
	call RegisterAghanimUpgrade('A01Y','A1BP','A1AZ', 0)
	call RegisterAghanimUpgrade('A14O','A3FP','A3FJ', 0)
	call RegisterAghanimUpgrade('A19O','A1MW','A1MV', 0)
	call RegisterAghanimUpgrade('A06B','A472','A471', 0)
	call RegisterAghanimUpgrade('A15S','A3JY','A3JX', 0)
	call RegisterAghanimUpgrade('A05E','A3JZ','A33F', 0)
	call RegisterAghanimUpgrade('A049','A33H','A33G', 0)
	call RegisterAghanimUpgrade('A28T','A3JA','A361', 0)
	call RegisterAghanimUpgrade('Z610','A3K4','A3K5', 0)
	
	
	
	call RegisterAghanimUpgrade('A0FW','S3OD','A3OD', 0) //刚被兽 粘稠鼻液
	call RegisterAghanimUpgrade('A0KV','S3UG','A3UG', 0) //
	call RegisterAghanimUpgrade('A11K','S31K','Z31K', 0) //舰队统帅 幽灵船
	call RegisterAghanimUpgrade('A046','S3OH','A3OH', 0) //潮汐猎人 巨浪
	call RegisterAghanimUpgrade('A06O','S3NX','A3NX', 0) //沙王 掘地穿刺
	call RegisterAghanimUpgrade('A02S','A3Y7','A3Y8', 0) //猛犸 震荡波
	call RegisterAghanimUpgrade('A14R','S3WT','A3WT', 0) //蓝猫 电子漩涡
	call RegisterAghanimUpgrade('A29J','S3OJ','A3OJ', 0) //影魔r
	
	call RegisterAghanimUpgrade('A1TB','A470','A3FQ', 0)
	call RegisterAghanimUpgrade('A0O3', 0,'A0O3', 0)
	call RegisterAghanimUpgrade('QM03', 0, 0, 0)
	call RegisterAghanimUpgrade('A0A5', 0, 0, 0)
	call RegisterAghanimUpgrade('A0CY', 0, 0, 0)
	call RegisterAghanimUpgrade('A088', 0, 0, 0)
	call RegisterAghanimUpgrade('A085', 0, 0, 0)
endfunction
function InitPassiveSkills takes nothing returns nothing
	// 注意：第五个参数的技能Id最好不要为光环类 (因为这只是用作于显示技能 模板应该为AEev)
	// 2022/1/1 将ability.slk的
	// 替换为
	// C;X2;K"AOac"  |   C;X2;K"AEev"
	// C;X11;K4      |	 C;X11;K4
	// C;X10;K1      |	 C;X10;K1
	// C;Y     		 |	 C;Y
	// AOac的父级Id为ACac  命令光环 如果更改以此为模板的技能等级 在单位死亡时候会导致崩溃
	// 所以将其全部更改为AEev 闪避 与命令光环相同一样可以修改技能等级
	 
	call RegisterPassiveSkills( 0, 0,'A524', 0,'A1IQ', 0) // 忍术
	call RegisterPassiveSkills('ACac','Q003','P003','BOac','QP03','QP03')
	call RegisterPassiveSkills(0, 0,'A0DW', 0,'QP04', 0)
	call RegisterPassiveSkills('AHab','Q019','P019','B07M','QP05', 0)
	call RegisterPassiveSkills( 0, 0,'A01K', 0,'QP06', 0)
	call RegisterPassiveSkills('P035','Q035','A0DZ', 0,'QP07', 0)
	call RegisterPassiveSkills(0, 0, 'A0MB', 0,'QP08','QP08')
	call RegisterPassiveSkills(0, 0, 'A00K', 0,'QP09','QP09')
	call RegisterPassiveSkills(0,'Q067','P067', 0,'QP0A', 0)
	call RegisterPassiveSkills('P083','Q083','A0DB','B03B','QP0B','QP0B')
	call RegisterPassiveSkills(0,0,'A041', 0,'QP0D','QP0D') //月刃
	call RegisterPassiveSkills('P099','Q099','A062','B01W','QP0E', 0)
	call RegisterPassiveSkills('P102','Q102','A03S', 0,'QP0F', 0)
	call RegisterPassiveSkills('P107','Q107','A0O0', 0,'QP0G', 0)
	call RegisterPassiveSkills( 0, 0,'A0MX', 0,'QP0H','QP0H')
	call RegisterPassiveSkills('P123','Q123','A00V','B00M','QP0I','QP0I')
	call RegisterPassiveSkills('P131','Q131','A0CL','B04D','QP0J', 0)
	call RegisterPassiveSkills('P133','Q133','A022', 0,'QP0K','QP0K')
	call RegisterPassiveSkills( 0, 0,'A0KY', 0,'QP0L','QP0L')
	call RegisterPassiveSkills('P143','Q143','A06A','B01B','QP0M','QP0M')
	call RegisterPassiveSkills('P147','Q147','A0BD','B00E','QP0N','QP0N')
	call RegisterPassiveSkills('P155','Q155','A0O3','B00X','QP0O', 0)
	call RegisterPassiveSkills('P211','Q211','A27V','B0EO','QP0P', 0)
	call RegisterPassiveSkills('P231','Q231','A03E','B096','QP0Q', 0)
	call RegisterPassiveSkills('P239','Q239','A03P', 0,'QP0R','QP0R')
	call RegisterPassiveSkills(0 ,0,'A03Q', 0,'QP0S','QP0S')
	call RegisterPassiveSkills(0, 0,'A086','B02L','P247', 0)
	call RegisterPassiveSkills('AUav','Q250','P250','BVA1','QP0U','QP0U')
	call RegisterPassiveSkills(0, 0,'A2S0', 0,'QP0W','QP0W') // 'AOcr'
	call RegisterPassiveSkills(0, 0,'A0JJ', 0,'QP0V','QP0V')
	call RegisterPassiveSkills(0, 0,'A081', 0,'QP0X','QP0X')
	call RegisterPassiveSkills(0, 0,'A0MM', 0,'QP0Y', 0)
	call RegisterPassiveSkills('P283','Q283','A1E6','B03X','QP0Z', 0)
	call RegisterPassiveSkills('P294','Q294','A04E', 0,'QP10', 0)
	call RegisterPassiveSkills('P302','Q302','A01N','B084','QP11', 0)
	call RegisterPassiveSkills('P303','Q303','A060', 0,'QP12', 0)
	call RegisterPassiveSkills( 0, 0,'A06D', 0,'QP13', 0)
	call RegisterPassiveSkills('P310','Q310','A0ES','B03Y','QP14','QP14')
	call RegisterPassiveSkills('P319','Q319','A0FU', 0,'QP15','QP15')
	call RegisterPassiveSkills(0, 0,'A0FA', 0,'QP16','QP16')
	call RegisterPassiveSkills('P327','Q327','A0C6','B03P','QP17','QP17')
	set PassiveSkills_IllusionInherit[MaxPassiveSkillsNum] = true
	call RegisterPassiveSkills(0, 0,'A0MG', 0,'QP18', 0)
	call RegisterPassiveSkills('P338','Q338','A0FX', 0,'QP19','QP19')
	call RegisterPassiveSkills('P347','Q347','A0IF','B06X','QP1A', 0)
	call RegisterPassiveSkills('P355','Q355','A0N7', 0,'QP1B', 0)
	call RegisterPassiveSkills('P363','Q363','AIcd', 0,'QP1C','QP1C')
	call RegisterPassiveSkills('P418','Q418','A0MY', 0,'QP1D', 0)
	call RegisterPassiveSkills(0,0,'A03N', 0,'QP1E','QP1E')
	call RegisterPassiveSkills(0, 0,'A1HR', 0,'QP1F', 0)
	call RegisterPassiveSkills(0, 0,'A0DJ', 0,'QP1G', 0)
	call RegisterPassiveSkills(0, 0,'QF85', 0,'QP1H', 0)
	call RegisterPassiveSkills(0, 0,'A1CD', 0,'QP1I', 0)
	call RegisterPassiveSkills(0, 0,'A19Q', 0,'QP1J', 0)
	call RegisterPassiveSkills(0, 0,'A0CY', 0,'QP1K', 0)
	call RegisterPassiveSkills(0, 0,'A0QQ', 0,'QP1L', 0)
	call RegisterPassiveSkills(0, 0,'A0M3', 0,'QP1M', 0)
	call RegisterPassiveSkills(0, 0,'A0FV', 0,'QP1N', 0)
	call RegisterPassiveSkills(0, 0,'A2EY', 0,'QP1O', 'QP1O')
	set PassiveSkills_IllusionInherit[MaxPassiveSkillsNum] = true
	call RegisterPassiveSkills(0, 0,'A13T', 0,'A522', 0)
	call RegisterPassiveSkills(0, 0,'A2E4', 0,'QP1P', 0)
	call RegisterPassiveSkills(0, 0,'A03U', 0,'QP1Q', 0)
	call RegisterPassiveSkills(0, 0,'A0RO', 0,'QP1S', 0)
	call RegisterPassiveSkills(0, 0,'A0N5', 0,'QP1T', 0)
	call RegisterPassiveSkills(0, 0,'A18X', 0,'QP1U', 0)
	call RegisterPassiveSkills(0, 0,'A0QW', 0,'QP1V', 0)
	call RegisterPassiveSkills(0, 0,'A0SS', 0,'QP1W', 0)
	call RegisterPassiveSkills(0, 0,'A0G5', 0,'QP1X', 0)
	call RegisterPassiveSkills(0, 0,'A0LE', 0,'QP1Y', 0)
	call RegisterPassiveSkills(0, 0,'A0I8', 0,'QP1Z', 0)
	call RegisterPassiveSkills(0, 0,'A0NA', 0,'QP20', 0)
	call RegisterPassiveSkills(0, 0,'A1A3', 0,'QP21', 0)
	call RegisterPassiveSkills(0, 0,'A0CZ', 0,'QP22', 0)
	call RegisterPassiveSkills(0, 0,'A0VX', 0,'QP23', 0)
	call RegisterPassiveSkills(0, 0,'A088', 0,'QP24', 0)
	call RegisterPassiveSkills('A33O','A33P','A33Q', 0,'A33R', 0)
	call RegisterPassiveSkills('A43Z','A442','A440', 0,'QP25', 0)
	call RegisterPassiveSkills(0, 0,'QF88', 0,'A0VC', 0)
	call RegisterPassiveSkills('A455','A45C','A45B', 0,'QP26', 0)
	call RegisterPassiveSkills(0, 0,'A460', 0,'QP27', 0)
	call RegisterPassiveSkills(0, 0,'A34A', 0,'QP28', 0)
	call RegisterPassiveSkills(0, 0,'Q0BK', 0,'QP29', 0)
	call RegisterPassiveSkills(0, 0,'A0A8', 0,'QP2A', 0)
	call RegisterPassiveSkills('A3J7','A3J7','A02C', 0,'QP2B', 0)
endfunction
function InitHeroSkillsData takes nothing returns nothing
	local integer i = 0
	local string s
	call RegisterHeroSkill(0, null, 0, 0, 0, null)
	set HeroSkillsIcon[0]= "UI\\Widgets\\Console\\Undead\\undead-inventory-slotfiller.blp"
	set i = 1 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "thunderbolt"),'A02A', 0,'Y001', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "volcano"),'A17O', 0,'Y002', "e")
	call RegisterHeroSkill(i * 4 + 3, null,'P003','QP03','Y003', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "forkedlightning"),'A0IN','A1AW','Y004', "w")
	set i = 2 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "chainlightning"),'A020', 0,'Y005', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "thunderbolt"),'A0JC', 0,'Y006', "g")
	call RegisterHeroSkill(i * 4 + 3, null,'A0N5','QP1T','Y007', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "roar")+ SaveSkillOrder(i * 4 + 4, "r1"),'A29G','A29H','Y008', "w")
	set i = 3 -1
	call RegisterHeroSkill(i * 4 + 1, null,'A0DW','QP04','Y009', null)
	set IsPassiveSkill[i * 4 + 1]= true
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "slow"),'A0DX', 0,'Y010', "c")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "locustswarm"),'A01B', 0,'Y011', "r")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "arrows")+ SaveSkillOrder(i * 4 + 4, "range only")+ SaveSkillOrder(i * 4 + 4, "shuashecheng"),'A0DY','A1WB','Y012', "t")
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXBinglongTuijin")
	endif
	//set IsNoDeathMatchSkill[i * 4 + 4]= true
	set i = 4 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "carrionswarm"),'QB02', 0,'QY02', "w")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "acidbomb"),'A0G6', 0,'Y014', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "replenishmana")+ SaveSkillOrder(i * 4 + 3, "replenishlife")+ SaveSkillOrder(i * 4 + 3, "abuz agi")+ SaveSkillOrder(i * 4 + 3, "str bug"),'A0KX', 0,'Y015', null)
	set IsMultiIconSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "item 16")+ SaveSkillOrder(i * 4 + 4, "coldarrows"),'A0G8', 0,'Y016', "r")
	set i = 5 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "mounthippogryph"),'A1E9', 0,'Y017', "v")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "entanglingroots"),'A04C', 0,'Y018', "e")
	call RegisterHeroSkill(i * 4 + 3, null,'P019','QP05','Y019', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "autoharvestlumber"),'A03R','A0AV','Y020', "f")
	set i = 6 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "spellshieldaoe"),'A190', 0,'Y021', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "melee only"),'A01K','QP06','Y022', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "fanofknives"),'A2IS', 0,'Y023', "w")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "roar"),'A0WP','A43D','Y024', "r")
	set i = 7 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "mirrorimage"),'A063', 0,'Y025', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "unavatar"),'A24D', 0,'Y026', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "fanofknives"),'A2KU', 0,'Y027', "d")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "awaken")+ SaveSkillOrder(i * 4 + 4, "avengerform")+ SaveSkillOrder(i * 4 + 4, "r2"),'A07U','A38E','Y028', "g")
	set i = 8 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "barkskinoff"),'A0SK', 0,'Y029', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "roar"),'A0DL', 0,'Y030', "e")
	set NoBalanceOffTips[i * 4 + 2]= "图腾在与水刀、连击、海象挥击、忍术、转属性和无影拳的时候只会 +100/140/180/220% 的攻击力"
	call Z6E(i * 4 + 2, "ET-Drunken")
	call Z1E(i * 4 + 2, "bgdmg1")
	call Z1E(i * 4 + 2, "bgdmg2")
	call RegisterHeroSkill(i * 4 + 3, null,'A0DJ','QP1G','Y031', null)
	set ZTP[i * 4 + 3]= "余震有6/4.5/3.0/1.5秒的冷却时间"
	set IsPassiveSkill[i * 4 + 3]= true
	if Mode__SixSkills and(not Mode__RearmCombos) then
		//	set IsDisabledSkill[i * 4 + 3]= true
		set IsDisabledSkill[i * 4 + 2]= true
	endif
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "fanofknives"),'A0DH','A1OB','Y032', "c")
	set i = 9 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "neutralinteract"),'A0RG', 0,'Y033', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "inv bug 1")+ SaveSkillOrder(i * 4 + 2, "ibug")+ SaveSkillOrder(i * 4 + 2, "yongjiu1")+ SaveSkillOrder(i * 4 + 2, "yongjiu2")+ SaveSkillOrder(i * 4 + 2, "yongjiu3"),'A0MB','QP08','Y036', null)
	set IsPassiveSkill[i * 4 + 2]= true
	set ZTP[i * 4 + 2]= "永久隐身效果会在攻击、施法或使用物品后消失"
	call RegisterHeroSkill(i * 4 + 3, null,'A0DZ','QP07','Y035', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "barkskinon"),'A0K9', 0,'Y034', "b")
	set i = CB -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "summongrizzly"),'A0A5', 0,'Y037', "b")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives"),'A1EG', 0,'Y038', "r")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "youjimaoyong"),'A0A8', 0,'Y039', null) //协同
	if Mode__SixSkills and(not Mode__RearmCombos) then
		set IsDisabledSkill[i * 4 + 3]= true
	endif
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "bearform")+ SaveSkillOrder(i * 4 + 4, "unbearform")+ SaveSkillOrder(i * 4 + 4, "battleroar")+ SaveSkillOrder(i * 4 + 4, "metamorphosis")+ SaveSkillOrder(i * 4 + 4, "melee morph"),'A0AG', 0,'Y040', "f")
	set IsMultiIconSkill[i * 4 + 4]= true
	set i = DB -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "carrionswarm"),'A01F', 0,'Y041', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "restorationoff"),'QB0E', 0,'QY0E', "t")
	call RegisterHeroSkill(i * 4 + 3, null,'A18X','QP1U','Y043', null)
	set IsPassiveSkill[i * 4 + 3]= true
	set NoRearmCombosTips[i * 4 + 3]= "冷却时间3秒及以下的技能每施放2次才会触发1次炽魂"
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "chainlightning"),'A01P','A09Z','Y044', "g")
	set i = FB -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "whirlwind"),'A05G', 0,'Y045', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "healingward"),'A047', 0,'Y046', "g")
	call RegisterHeroSkill(i * 4 + 3, null,'A00K','QP09','Y047', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "thunderbolt"),'A0M1','A1AX','Y048', "e")
	set i = GB -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "neutralspell"),'A14L', 0,'Y049', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "arrows")+ SaveSkillOrder(i * 4 + 2, "range only"),'A0LZ', 0,'Y050', "w")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "transmute"),'A2NT', 0,'Y051', "t")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "battlestations")+ SaveSkillOrder(i * 4 + 4, "r4"),'A0L3','A2QC','Y052', "e")
	set i = HB -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "invisibility"),'A01Z', 0,'Y053', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "unavengerform"),'A26N', 0,'Y054', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "spiritlink"),'A2ML', 0,'Y055', "v")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "blight"),'A07Z','A44S','Y056', "r")
	set i = JB -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "Locustswarm"),'A1AA', 0,'Y057', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "loadcorpse")+ SaveSkillOrder(i * 4 + 2, "whirlwind"),'A1A8', 0,'Y058', "c")
	call RegisterHeroSkill(i * 4 + 3, null,'A1CD','QP1I','Y059', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "board"),'A1A1','A43J','Y060', "e")
	set i = 16 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "carrionscarabs")+ SaveSkillOrder(i * 4 + 1, "carrionscarabsinstant"),'A085', 0,'Y061', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "spellsteal"),'A10X', 0,'Y062', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "frenzy"),'A112', 0,'Y063', "c")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "range morph")+ SaveSkillOrder(i * 4 + 4, "metamorphosis")+ SaveSkillOrder(i * 4 + 4, "phoenixfire")+ SaveSkillOrder(i * 4 + 4, "creepheal"),'QM01', 0,'Y064', "f")
	set IsMultiIconSkill[i * 4 + 4]= true
	set i = 17 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "thunderclap"),'A03Y', 0,'Y065', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives"),'QB0P', 0,'QY0P', "v")
	call RegisterHeroSkill(i * 4 + 3, null,'P067','QP0A','Y067', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "berserk"),'A0LC','A443','Y068', "r")
	set i = 18 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "thunderbolt"),'QB0J', 0,'QY0J', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "acidbomb"),'A011', 0,'Y070', "g")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "bloodlust"),'A083', 0,'Y071', "b")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "carrionscarabsoff"),'A088','QP24','Y072', null)
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXmines")
	endif
	set IsPassiveSkill[i * 4 + 4]= true
	set NoBalanceOffTips[i * 4 + 4]= "多重施法的触发几率调整为：18%/29.5%/39.5%概率x2，0%/13%/14.5%概率x3，0%/0/%5.5%概率x4"
	set NoRearmCombosTips[i * 4 + 4]= "多重施法会额外消耗50%/75%/100%的魔法值。"
	set i = 19 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "drunkenhaze"),'A049','A33G','Y073', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives"),'A05E','A33F','Y074', "t")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "manaflareoff")+ SaveSkillOrder(i * 4 + 3, "stampede"),'A0BQ', 0,'Y075', "c")
	set i = i * 4 + 4
	call RegisterHeroSkill(i, SaveSkillOrder(i, "monsoon")+ SaveSkillOrder(i, "channel")+ SaveSkillOrder(i, "magicundefense"),'A065', 0,'Y076', "r")
	//	set IsDisabledSkill[i * 4 + 4]= true
	set NoBalanceOffTips[i]= "再装填有9/6/3的冷却时间"
	set s = SaveSkillOrder(i, "r1")+ SaveSkillOrder(i, "r4")+ SaveSkillOrder(i, "r55")+ SaveSkillOrder(i, "r18")
	//if Mode__SixSkills and(not Mode__RearmCombos) then
	if ExtraAbilitiesNum  != 0 then
		set IsDisabledSkill[i]= true
	endif
	if Mode__RearmCombos == false then
		set s = SaveSkillOrder(i, "r44")+ SaveSkillOrder(i, "r95")+ SaveSkillOrder(i, "r2")+ SaveSkillOrder(i, "r3")+ SaveSkillOrder(i, "r14")+ SaveSkillOrder(i, "r17")
		set s = SaveSkillOrder(i, "r6")+ SaveSkillOrder(i, "r7")+ SaveSkillOrder(i, "r8")+ SaveSkillOrder(i, "r9")+ SaveSkillOrder(i, "r123")+ SaveSkillOrder(i, "r11")+ SaveSkillOrder(i, "r12")+ SaveSkillOrder(i, "r15")+ SaveSkillOrder(i, "r16")
		set s = SaveSkillOrder(i, "r19")+ SaveSkillOrder(i, "r20")+ SaveSkillOrder(i, "r21")+ SaveSkillOrder(i, "r22")+ SaveSkillOrder(i, "r23")+ SaveSkillOrder(i, "r24")+ SaveSkillOrder(i, "r25")
		set s = SaveSkillOrder(i, "r26")+ SaveSkillOrder(i, "r27")+ SaveSkillOrder(i, "r28")
	endif
	call Z1E(i, "r29")
	call Z1E(i, "r30")
	call Z1E(i, "r31")
	set i = 20 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "carrionswarm"),'A21E', 0,'Y077', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "blink"),'A01O', 0,'Y078', "r")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "forceofnature"),'AEfn', 0,'Y079', "f")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "stampede")+ SaveSkillOrder(i * 4 + 4, "r55"),'A1W8','A1W9','Y080', "w")
	set i = 21 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "spellstealoff"),'A10D', 0,'Y081', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "animatedead"),'A46H', 0,'Y082', "d")
	call RegisterHeroSkill(i * 4 + 3, null,'A46E','A46D','Y084', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, null,'A0DB','QP0B','Y083', null)
	set IsPassiveSkill[i * 4 + 4]= true
	set i = 22 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "phoenixmorph"),'A0LL', 0,'Y085', "v")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "carrionscarabson"),'A0BZ', 0,'Y086', "t")
	call RegisterHeroSkill(i * 4 + 3, null,'A19Q','QP1J','Y087', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, null,'A0CY','QP1K','Y088', null)
	set IsNoDeathMatchSkill[i * 4 + 4]= true
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXzhangdahaimin")
	endif
	set IsPassiveSkill[i * 4 + 4]= true
	set NoRearmCombosTips[i * 4 + 4]= "远程模型只增加 40/80/120 点攻击力"
	call Z1E(i * 4 + 4, "bgdmg1")
	call Z1E(i * 4 + 4, "bgdmg2")
	//set IsNoDeathMatchSkill[i * 4 + 4]= true
	set i = 23 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "item 89"),'A05J', 0,'Y089', "e")
	//if(not Mode__RearmCombos) then
	//	set s=SaveSkillOrder(i*4+1,"HXmines")
	//endif
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "stasistrap"),'A06H', 0,'Y090', "t")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "selfdestruct"),'A06B','A471','Y091', "c")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "ward")+ SaveSkillOrder(i * 4 + 4, "chainlightning"),'A0AK','A1FY','Y092', "r")
	set IsMultiIconSkill[i * 4 + 4]= true
	set i = 24 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "drunkenhaze"),'A0KM', 0,'Y093', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "ancestralspirittarget")+ SaveSkillOrder(i * 4 + 2, "build"),'A0LV', 0,'Y094', "t")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "ambush"),'A28T','A361','Y095', "r")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "controlmagic")+ SaveSkillOrder(i * 4 + 4, "r6"),'A0LT','A1CS','Y096', "d")
	set i = 25 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "firebolt"),'A042', 0,'Y097', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "arrows"),'A041','QP0D','Y098', null)
	
	//set IsNoDeathMatchSkill[i * 4 + 2]= true
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, null,'A062','QP0E','Y099', null)
	set IsPassiveSkill[i * 4 + 3]= true
	set IsNoDeathMatchSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "corporealform")+ SaveSkillOrder(i * 4 + 4, "r28"),'A054','A00U','Y100', "e")
	set i = 26 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "possession")+ SaveSkillOrder(i * 4 + 1, "metamorphosis"),'A064', 0,'Y101', "r")
	//set IsDisabledSkill[i*4+1]=true
	call RegisterHeroSkill(i * 4 + 2, null,'A03S','QP0F','Y102', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "range only"),'A03U','QP1Q','Y103', null)
	set IsPassiveSkill[i * 4 + 3]= true
	//set IsNoDeathMatchSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "thunderbolt"),'A04P','A1AU','Y104', "t")
	set i = 27 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "metamorphosis")+ SaveSkillOrder(i * 4 + 1, "bearform")+ SaveSkillOrder(i * 4 + 1, "unbearform")+ SaveSkillOrder(i * 4 + 1, "melee morph")+ SaveSkillOrder(i * 4 + 1, "bash")+ SaveSkillOrder(i * 4 + 1, "yongjiu2"),'A0BE', 0,'Y105', "g")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "autodispel")+ SaveSkillOrder(i * 4 + 2, "loadarcher"),'A21M','A21N','Y106', "e")
	set IsMultiIconSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, null,'A0O0','QP0G','Y107', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "fanofknives"),'A1EJ', 0,'Y108', "r")
	set i = 28 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "forkedlightning"),'A010', 0,'Y109', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "hex"),'A0RX', 0,'Y110', "d")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "magicleash"),'A00P', 0,'Y111', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "ward")+ SaveSkillOrder(i * 4 + 4, "r7"),'A00H','A0A1','Y112', "w")
	if ExtraAbilitiesNum  == 2 then
		set ZTP[i * 4 + 4]= "该技能在此模式下会减少对建筑25%伤害"
	endif
	set i = 29 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "chainlightning")+ SaveSkillOrder(i * 4 + 1, "frenzyoff"),'A1TA', 0,'Y113', "t")
	//set IsDisabledSkill[i * 4 + 1]= true
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives")+ SaveSkillOrder(i * 4 + 2, "battleroar")+ SaveSkillOrder(i * 4 + 2, "roar"),'A1T8', 0,'Y114', "w")
	set IsMultiIconSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "manashieldon")+ SaveSkillOrder(i * 4 + 3, "manashieldoff"),'A28Q', 0,'Y115', "v")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "spellstealon"),'A1TB','A3FQ','Y116', "r")
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXballl")
	endif
	call Z1E(i * 4 + 4, "r30")
	set i = 30 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "thunderclap"),'A06M', 0,'Y117', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "drunkenhaze"),'Acdh', 0,'Y118', "d")
	call RegisterHeroSkill(i * 4 + 3, null,'A0MX','QP0H','Y119', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call Z6E(i * 4 + 3, "ET-Drunken")
	call Z6E(i * 4 + 3, "Tide-Drunken")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "elementalfury"),'A0MQ','A1B6','Y120', "r")
	set i = 31 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "stomp"),'A00S', 0,'Y121', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "firebolt"),'A00L', 0,'Y122', "d")
	call RegisterHeroSkill(i * 4 + 3, null,'A00V','QP0I','Y123', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "fanofknives")+ SaveSkillOrder(i * 4 + 4, "r8"),'A2O6','A384','Y124', "t")
	set i = 32 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "thunderbolt"),'A004', 0,'Y125', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "nagabuild")+ SaveSkillOrder(i * 4 + 2, "r9"),'A524', 0,'Y126', null)
	//set IsDisabledSkill[i*4+2]=true // 暂时禁用忍术 A524 A1IQ
	//set IsDisabledSkill[i*4+3]=true // 暂时禁用疾风步 
	
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 2, "HXshuidaorenshu")
	endif
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 2, "HXrenshuhaimin")
	endif
	set IsPassiveSkill[i * 4 + 2]= true
	set NoRearmCombosTips[i * 4 + 2]= "如果同时选择了无影拳或长大！，忍术只会造成 1.25/1.45/1.65/1.85倍 的伤害"
	call Z6E(i * 4 + 2, "Tide-Jinada")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "windwalk"),'A07A', 0,'Y127', "w")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "faeriefire"),'A0B4', 0,'Y128', "r")
	set i = 33 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "breathoffire"),'A03F', 0,'Y129', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "thunderbolt"),'A0AR', 0,'Y130', "t")
	set s = SaveSkillOrder(i * 4 + 2, "HXLongqilanmao")
	call RegisterHeroSkill(i * 4 + 3, null,'A0CL','QP0J','Y131', null)
	set IsPassiveSkill[i * 4 + 3]= true
	//set IsNoDeathMatchSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "metamorphosis")+ SaveSkillOrder(i * 4 + 4, "range morph"),'QM00', 0,'Y132', "r")
	set i = 34 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "orb effect"),'A022','QP0K','Y133', null)
	set IsPassiveSkill[i * 4 + 1]= true
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "blink"),'AEbl', 0,'Y134', "b")
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 2, "HXshijianmanbu")
	endif
	call RegisterHeroSkill(i * 4 + 3, null,'A0KY','QP0L','Y135', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "thunderbolt"),'A0E3', 0,'Y136', "v")
	set i = 35 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "arrows")+ SaveSkillOrder(i * 4 + 1, "range only"),'A026', 0,'Y137', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "silence"),'A33A', 0,'Y138', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "defend"),'A2O2', 0,'Y139', "t")
	set NoRearmCombosTips[i * 4 + 3]= "强击光环效果只作用于远程单位，无论你选择的是近战或远程"
	call RegisterHeroSkill(i * 4 + 4, null,'QF88', 0,'QY88', null)
	set IsPassiveSkill[i * 4 + 4]= true
	set i = 36 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "channel"),'A08N', 0,'Y141', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "antimagicshell"),'A08V', 0,'Y142', "e")
	call RegisterHeroSkill(i * 4 + 3, null,'A06A','QP0M','Y143', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "battleroar"),'A0ER','A2S8','Y144', "g")
	set i = 37 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "massteleport"),'A0O1', 0,'Y145', "w")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "awaken")+ SaveSkillOrder(i * 4 + 2, "unsummon"),'A0OO', 0,'Y146', "d")
	set IsMultiIconSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, null,'A0BD','QP0N','Y147', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "thunderbolt"),'A0O2','A289','Y148', "r")
	set i = 38 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "carrionswarm"),'A0O7', 0,'Y149', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "breathoffire"),'A0O6', 0,'Y150', "t")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "acidbomb"),'A30T', 0,'Y151', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "shockwave"),'A0O5','A1B1','Y152', "r")
	set i = 39 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "preservation"),'A0IL', 0,'Y153', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives")+ SaveSkillOrder(i * 4 + 2, "corrosivebreath"),'A1NI', 0,'Y154', "e")
	call RegisterHeroSkill(i * 4 + 3, null,'A0O3','QP0O','Y155', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "metamorphosis")+ SaveSkillOrder(i * 4 + 4, "melee morph")+ SaveSkillOrder(i * 4 + 4, "r25"),'QB0K', 0,'QY0K', "r")
	set i = 40 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "coupleinstant"),'A0KV', 'A3UG','Y157', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "spies"),'A0L8', 0,'Y158', "r")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "windwalk"),'A0LN', 0,'Y159', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "corporealform")+ SaveSkillOrder(i * 4 + 4, "r11"),'A0KU', 0,'Y160', "w")
	set i = 41 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "fanofknives"),'A14P', 0,'Y161', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "chainlightning"),'A14R','A3WT','Y162', "e")
	call RegisterHeroSkill(i * 4 + 3, null,'A0QW','QP1V','Y163', null)
	set IsPassiveSkill[i * 4 + 3]= true
	set NoRearmCombosTips[i * 4 + 3]= "冷却时间3秒及以下的技能每施放2次才会触发1次超负荷（球形闪电除外）"
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "channel"),'A14O','A3FJ','Y164', "g")
	set s = SaveSkillOrder(i * 4 + 4, "HXLongqilanmao")
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXballl")
	endif
	set i = 42 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "holybolt"),'A0QP', 0,'Y165', "v")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "arrows"),'A0QN', 0,'Y166', "r")
	call RegisterHeroSkill(i * 4 + 3, null,'A0QQ','QP1L','Y167', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "firebolt"),'A0QR','A1B3','Y168', "f")
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "yidaonimane")
	endif
	set i = 43 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "fanofknives"),'A1EA', 0,'Y169', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "windwalk"),'A0RV', 0,'Y170', "w")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "range only"),'A0RO','QP1S','Y171', null)
	set IsPassiveSkill[i * 4 + 3]= true
	//set IsNoDeathMatchSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "curse")+ SaveSkillOrder(i * 4 + 4, "spiritwolf"),'A0RP','A449','Y172', "c")
	//	set IsDisabledSkill[i*4+4]=true
	set IsMultiIconSkill[i * 4 + 4]= true
	set i = 44 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "spiritlink")+ SaveSkillOrder(i * 4 + 1, "coupletarget"),'A0S9', 0,'Y173', "r")
	set IsMultiIconSkill[i * 4 + 1]= true
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "creepanimatedead"),'A0SC', 0,'Y174', "w")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "phaseshift"),'A0SB', 0,'Y175', "f")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "rainofchaos"),'A0S8','A1QP','Y176', "c")
	set i = 45 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "creepdevour"),'A0Z4', 0,'Y177', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "neutraldetectaoe"),'A0Z5', 0,'Y178', "c")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "blizzard"),'A0Z6', 0,'Y179', "r")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "clusterrockets"),'A0Z8','A1CV','Y180', "t")
	set i = 46 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "rejuvination"),'A136', 0,'Y181', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "r12"),'A13T', 0,'Y182', null)
	set IsPassiveSkill[i * 4 + 2]= true
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 2, "HXshuidaohaimin")
	endif
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 2, "HXshuidaorenshu")
	endif
	set IsPassiveSkill[i * 4 + 2]= true
	//set NoRearmCombosTips[i * 4 + 2]= "远程模型使用水刀只造成80%的范围伤害"
	call Z1E(i * 4 + 2, "bgdmg2")
	call Z6E(i * 4 + 2, "Tide-Jinada")
	call Z6E(i * 4 + 2, "Tide-Drunken")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "incineratearrow")+ SaveSkillOrder(i * 4 + 3, "incineratearrowoff"),'A11N', 0,'Y183', "x")
	call Z1E(i * 4 + 3, "r29")
	set IsMultiIconSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "spiritofvengeance"),'A11K','Z31K','Y184', "t")
	set i = 47 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "chainlightning"),'A12J', 0,'Y185', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "spirittroll"),'A12K', 0,'Y186', "r")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "fanofknives"),'A14I', 0,'Y187', "w")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "incineratearrowon"),'A12P','A1D6','Y188', "f")
	set i = 48 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "creepthunderbolt"),'A1SO', 0,'Y189', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "chainlightning"),'A1SQ', 0,'Y190', "g")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "orb effect")+ SaveSkillOrder(i * 4 + 3, "range only")+ SaveSkillOrder(i * 4 + 3, "fanofknives")+ SaveSkillOrder(i * 4 + 3, "multi-attack"),'A229', 0,'Y191', "f")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "silence"),'A1T5','A235','Y192', "c")
	set i = 49 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "autodispel"),'A1TV', 0,'Y193', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "chainlightning"),'A1SW', 0,'Y194', "d")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "rechargeoff"),'A1SU', 0,'Y195', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "deathpact"),'A1U6','A30N','Y196', "r")
	set i = 50 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "standdown"),'A1YO', 0,'Y197', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "frenzyon"),'A1S7', 0,'Y198', "w")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "summongrizzly"),'A1YR', 0,'Y199', "f")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "fanofknives")+ SaveSkillOrder(i * 4 + 4, "autoharvestlumber"),'A1YQ','A3DE','Y200', "r")
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXzhangdahaimin")
	endif
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXrenshuhaimin")
	endif
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXshuidaohaimin")
	endif
	call Z1E(i * 4 + 4, "bgdmg2")
	set i = 51 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "creepthunderclap"),'A1RJ', 0,'Y201', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "gold2lumber")+ SaveSkillOrder(i * 4 + 2, "harvest"),'A1YX', 0,'Y202', "f")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "charm")+ SaveSkillOrder(i * 4 + 3, "immolation")+ SaveSkillOrder(i * 4 + 3, "unimmolation")+ SaveSkillOrder(i * 4 + 3, "animatedead"),'A1YY', 0,'Y203', "r")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "rechargeon")+ SaveSkillOrder(i * 4 + 4, "r123")+ SaveSkillOrder(i * 4 + 4, "locust"),'A1RK','A43H','Y204', "v")
	//set IsDisabledSkill[i*4+4]=true // 暂时禁用凤凰蛋
	set i = 52 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "darkritual"),'A0FW','A3OD','Y205', "g")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives"),'A0GP', 0,'Y206', "r")
	call RegisterHeroSkill(i * 4 + 3, null,'A0M3','QP1M','Y207', null)
	set IsDisabledSkill[i*4+3]=true // 暂时禁用刚被皮
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, null,'A0FV','QP1N','Y208', null)
	set IsPassiveSkill[i * 4 + 4]= true
	set NoRearmCombosTips[i * 4 + 4]= "冷却时间在3秒及以下的技能每使用2次才触发1次战意（刺针扫射和粘稠鼻液除外）"
	set i = 53 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "wispharvest"),'A27F', 0,'Y209', "z")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "tranquility"),'A27G', 0,'Y210', "x")
	call RegisterHeroSkill(i * 4 + 3, null,'A27V','QP0P','Y211', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "transmute")+ SaveSkillOrder(i * 4 + 4, "shbug"),'A27H','A30J','Y212', "q")
	set IsMultiIconSkill[i * 4 + 4]= true
	set i = 54 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "fanofknives"),'A2H3', 0,'Y213', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "recharge")+ SaveSkillOrder(i * 4 + 2, "metamorphosis")+ SaveSkillOrder(i * 4 + 2, "shuashecheng")+ SaveSkillOrder(i * 4 + 2, "yongjiu1"),'QB0L', 0,'QY0L', "t")
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 2, "HXLianji")//+ SaveSkillOrder(i * 4 + 2, "melee morph")
	endif
	set NoRearmCombosTips[i * 4 + 2]= "长大！只为无影拳提供少量的攻击加成效果"
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "darksummoning")+ SaveSkillOrder(i * 4 + 2, "r27"),'A2HS', 0,'Y215', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "ancestralspirit")+ SaveSkillOrder(i * 4 + 4, "acolyteharvest")+ SaveSkillOrder(i * 4 + 4, "acidbomb"),'A2JR','A2JL','Y216', "f")
	set IsMultiIconSkill[i * 4 + 4]= true
	//	set IsDisabledSkill[i * 4 + 4]= true
	set i = 55 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "steal"),'A2JB', 0,'Y217', "w")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "creepheal"),'A2J2', 0,'Y218', "t")
	call RegisterHeroSkill(i * 4 + 3, null,'A2EY','QP1O','Y219', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "autodispeloff"),'A2CI','A38C','Y220', "d")
	set i = 56 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "chainlightning"),'A2BE', 0,'Y221', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives"),'A2IT', 0,'Y222', "t")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "soulburn"),'A2HN', 0,'Y223', "d")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "submerge"),'A2BG','A30H','Y224', "e")
	set i = 57 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "fanofknives"),'A2FK', 0,'Y225', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "summonfactory"),'A2E3', 0,'Y226', "t")
	call RegisterHeroSkill(i * 4 + 3, null,'A2E4','QP1P','Y227', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "immolation")+ SaveSkillOrder(i * 4 + 4, "unimmolation")+ SaveSkillOrder(i * 4 + 4, "windwalk")+ SaveSkillOrder(i * 4 + 4, "auraunholy"),'A2E5','A43S','Y228', "r")
	set i = 58 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "spiritwolf"),'A03D', 0,'Y229', "v")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "deathcoil"),'A0ZF', 0,'Y230', "w")
	call RegisterHeroSkill(i * 4 + 3, null,'A03E','QP0Q','Y231', null)
	set IsPassiveSkill[i * 4 + 3]= true
	set IsNoDeathMatchSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "metamorphosis")+ SaveSkillOrder(i * 4 + 4, "melee morph")+ SaveSkillOrder(i * 4 + 4, "r95"),'QM02', 0,'Y232', "f")
	set i = 59 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "parasite"),'A0BH', 0,'Y233', "w")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "restoration")+ SaveSkillOrder(i * 4 + 2, "inv bug 1"),'Z234', 0,'Y234', "b")
	set IsNoDeathMatchSkill[i * 4 + 2]= true
	//set IsDisabledSkill[i * 4 + 2]= true	//暂时禁用织网
	call RegisterHeroSkill(i * 4 + 3, null,'Q0BK','QP29','Y235', null)
	set IsDisabledSkill[i * 4 + 3]= true
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "bash")+ SaveSkillOrder(i * 4 + 4, "roar"),'A0WQ', 0,'Y236', "t")
	set i = 60 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "summonphoenix"),'A0YM', 0,'Y237', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "deathcoil"),'A0PL', 0,'Y238', "b")
	call RegisterHeroSkill(i * 4 + 3, null,'A03P','QP0R','Y239', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, null,'A03Q','QP0S','Y240', null)
	set IsPassiveSkill[i * 4 + 4]= true
	set i = 61 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "range only")+ SaveSkillOrder(i * 4 + 1, "immolation")+ SaveSkillOrder(i * 4 + 1, "unimmolation"),'A1C0','A418','Y241', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "chainlightning"),'A0G2', 0,'Y242', "c")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "manashieldon")+ SaveSkillOrder(i * 4 + 3, "manashieldoff")+ SaveSkillOrder(i * 4 + 3, "shbug"),'A0MP', 0,'Y243', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "lavamonster"),'A1AT', 0,'Y244', "g")
	set i = 62 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "thunderbolt"),'A02H', 0,'Y245', "v")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "drunkenhaze"),'A08Q', 0,'Y246', "f")
	call RegisterHeroSkill(i * 4 + 3, null,'P247','A086','Y247', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "battlestations")+ SaveSkillOrder(i * 4 + 4, "r14"),'DRKN', 0,'Y248', "r")
	set IsNoDeathMatchSkill[i * 4 + 4]= true
	set i = 63 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "thunderbolt"),'QB0H', 0,'QY0H', "t")
	call RegisterHeroSkill(i * 4 + 2, null,'P250','QP0U','Y250', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "wispharvest"),'A2S0','QP0W','Y251', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "reincarnation")+ SaveSkillOrder(i * 4 + 4, "r15"),'A01Y','A1AZ','Y252', null)
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXqwew")
	endif
	set IsPassiveSkill[i * 4 + 4]= true
	set i = 64 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "channel")+ SaveSkillOrder(i * 4 + 1, "animatedead")+ SaveSkillOrder(i * 4 + 1, "stomp")+ SaveSkillOrder(i * 4 + 1, "tornado")+ SaveSkillOrder(i * 4 + 1, "ensnare")+ SaveSkillOrder(i * 4 + 1, "thunderclap")+ SaveSkillOrder(i * 4 + 1, "purge"),'A10R','A32Z','Y253', "e")
	set s = SaveSkillOrder(i * 4 + 1, "shockwave")+ SaveSkillOrder(i * 4 + 1, "frostarmor")+ SaveSkillOrder(i * 4 + 1, "manaburn")+ SaveSkillOrder(i * 4 + 1, "heal")+ SaveSkillOrder(i * 4 + 1, "chainlightning")+ SaveSkillOrder(i * 4 + 1, "raisedead")+ SaveSkillOrder(i * 4 + 1, "thunderbolt")
	set IsMultiIconSkill[i * 4 + 1]= true
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives"),'A1OP', 0,'Y254', "t")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "firebolt"),'A094', 0,'Y255', "v")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "doom"),'A0MU','A0A2','Y256', "d")
	set i = 65 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "impale"),'A0X7', 0,'Y257', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "creepheal"),'A1H5', 0,'Y258', "r")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "fanofknives"),'A2KO', 0,'Y259', "d")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "windwalk"),'A09U', 0,'Y260', "v")
	//set IsDisabledSkill[i * 4 + 4]= true // 暂时禁用仇杀
	set i = 66 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "berserk"),'A05C', 0,'Y261', "w")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "roar"),'A29K', 0,'Y262', "r")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "bash"),'A0JJ', 0,'Y263', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "faeriefire"),'QB0C', 0,'QY0C', "g")
	set i = 67 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "shadowstrike"),'A0Q7', 0,'Y265', "d")
	
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "blink"),'A0ME', 0,'Y266', "b")
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 2, "HXshijianmanbu")
	endif
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "fanofknives"),'A04A', 0,'Y267', "f")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "shockwave"),'A28R','A28S','Y268', "w")
	set i = 68 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "berserk"),'A030', 0,'Y269', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "arrows")+ SaveSkillOrder(i * 4 + 2, "range only")+ SaveSkillOrder(i * 4 + 2, "channel"),'AHfa', 0,'Y270', "r")
	set IsDisabledSkill[i*4+2]=true // 暂时禁用灼热之箭
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "windwalk"),'QB0A', 0,'QY0A', "w")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "innerfire"),'A04Q', 0,'Y272', "e")
	set i = 69 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "carrionswarm"),'A0LK', 0,'Y273', "w")
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 1, "HXshijianmanbu")
	endif
	call RegisterHeroSkill(i * 4 + 2, null,'A0CZ','QP22','Y274', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "bash"),'A081','QP0X','Y275', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "clusterrockets")+ SaveSkillOrder(i * 4 + 4, "r16"),'A0J1','A1D7','Y276', "c")
	set i = 70 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "arrows")+ SaveSkillOrder(i * 4 + 1, "range only"),'A09V', 0,'Y277', "c")
	call RegisterHeroSkill(i * 4 + 2, null,'A1A3','QP21','Y278', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, null,'A0MM','QP0Y','Y279', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "shadowstrike"),'A080','A1UZ','Y280', "d")
	set i = 71 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "fanofknives"),'A1E7', 0,'Y281', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "tankdroppilot"),'A1DP', 0,'Y282', "c")
	call RegisterHeroSkill(i * 4 + 3, null,'A1E6','QP0Z','Y283', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "darkportal"),'A1AO','A1UV','Y284', "e")
	set i = 72 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "852273"),'A0T2', 0,'Y285', "r")
	set s = SaveSkillOrder(i * 4 + 1, "HXMomianwange")
	call RegisterHeroSkill(i * 4 + 2, null,'A0SS','QP1W','Y286', null)
	set IsPassiveSkill[i * 4 + 2]= true
	set NoBalanceOffTips[i * 4 + 2]= "远程模型使用盛宴只造成/回复 1.75/2.75/3.75/4.75% 生命值的伤害"
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "chainlightning"),'A194', 0,'Y287', "w")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "decouple"),'A0SW', 0,'Y288', "t")
	set i = 73 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "rainoffire"),'A0MT', 0,'Y289', "b")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "banish"),'A2TD', 0,'Y290', "c")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "tornado"),'A09D', 0,'Y291', "w")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "drain"),'A0CC','A02Z','Y292', "d")
	set HeroSkillsIcon[i * 4 + 4]= "ReplaceableTextures\\CommandButtons\\BTNLifeDrain.blp"
	set i = 74 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "acidbomb"),'A046','A3OH','Y293', "g")
	call RegisterHeroSkill(i * 4 + 2, null,'A04E','QP10','Y294', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "roar"),'A226', 0,'Y295', "c")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "howlofterror"),'A29I', 0,'Y296', "v")
	set i = 75 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "innerfire"),'A04V', 0,'Y297', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "chainlightning"),'A0GK', 0,'Y298', "b")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "sleep"),'A04Y', 0,'Y299', "t")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "magicleash"),'A02Q','A1D9','Y300', "f")
	set i = 76 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "fanofknives"),'A05V', 0,'Y301', "d")
	call RegisterHeroSkill(i * 4 + 2, null,'A01N','QP11','Y302', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, null,'A060','QP12','Y303', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "thunderbolt")+ SaveSkillOrder(i * 4 + 4, "yidaonimane"),'A067','A08P','Y304', "r")
	set i = 77 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "detectaoe"),'A06I', 0,'Y305', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "unimmolation"),'A06K', 0,'Y306', "r")
	call RegisterHeroSkill(i * 4 + 3, null,'A06D','QP13','Y307', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "magicleash"),'A0FL','A1CX','Y308', "d")
	set i = 78 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "detonate"),'A1P8', 0,'Y309', "c")
	call RegisterHeroSkill(i * 4 + 2, null,'A0ES','QP14','Y310', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "bash"),'A0G5','QP1X','Y311', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "creepheal"),'A0G4','A1D8','Y312', "e")
	set i = 79 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "tankloadpilot"),'A1QW', 0,'Y313', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "windwalk"),'A0CA', 0,'Y314', "c")
	
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "orb effect")+ SaveSkillOrder(i * 4 + 3, "range only"),'A0CG', 0,'Y315', null)
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 3, "HXLianji")
	endif
	set IsPassiveSkill[i * 4 + 3]= true
	call Z1E(i * 4 + 3, "bgdmg2")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "disassociate"),'A0CT','A3DM','Y316', "t")
	call Z1E(i * 4 + 4, "r31")
	set i = 80 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "roar")+ SaveSkillOrder(i * 4 + 1, "howlofterror")+ SaveSkillOrder(i * 4 + 1, "battleroar"),'A0EY', 0,'Y317', "z")
	set IsMultiIconSkill[i * 4 + 1]= true
	call RegisterHeroSkill(i * 4 + 2, null,'Z318','A0BR','Y318', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, null,'A0FU','QP15','Y319', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 1, "852273"),'A29J','A3OJ','Y320', "r")
	set s = SaveSkillOrder(i * 4 + 4, "HXMomianwange")
	set i = 81 -1
	//call RegisterHeroSkill(i*4+1,SaveSkillOrder(i*4+1,"disenchant"),'A06O',0,'Y321',"m")
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "disenchant"),'A06O','A3NX','Y321', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "voodoo"),'A0H0', 0,'Y322', "r")
	call RegisterHeroSkill(i * 4 + 3, null,'A0FA','QP16','Y323', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "lightningshield"),'A06R','A1B4','Y324', "c")
	set i = 82 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "dismount"),'A0I6', 0,'Y325', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "creepheal"),'A0S1', 0,'Y326', "r")
	call RegisterHeroSkill(i * 4 + 3, null,'A0C6','QP17','Y327', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "chainlightning"),'A0E2','A1MR','Y328', "c")
	set i = 83 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "farsight"),'A44X', 0,'Y61A', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "creepheal"),'A44Z', 0,'Y61B', "b")
	call RegisterHeroSkill(i * 4 + 3, null,'A0I8','QP1Z','Y331', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "shadowsight"),'A0LH', 0,'Y332', "r")
	set i = 84 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "townbelloff"),'A0I3', 0,'Y333', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "chainlightning"),'A0MF', 0,'Y334', "g")
	call RegisterHeroSkill(i * 4 + 3, null,'A0MG','QP18','Y335', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "windwalk")+ SaveSkillOrder(i * 4 + 4, "r17"),'A0NS','A1DA','Y336', "b")
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 4, "HXqwew")
	endif
	set i = 85 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "impale"),'A0HW', 0,'Y337', "d")
	call RegisterHeroSkill(i * 4 + 2, null,'A0FX','QP19','Y338', null)
	set IsPassiveSkill[i * 4 + 2]= true
	set NoRearmCombosTips[i * 4 + 2]= "远程英雄和幻象只造成一半的荒芜伤害"
	call RegisterHeroSkill(i * 4 + 3, null,'A0NA','QP20','Y339', null)
	set IsPassiveSkill[i * 4 + 3]= true
	set NoRearmCombosTips[i * 4 + 3]= "力量模型只折射 8/10/12/14% 的伤害"
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "healingspray")+ SaveSkillOrder(i * 4 + 4, "healingwave")+ SaveSkillOrder(i * 4 + 4, "r18"),'A0H9', 0,'Y340', "t")
	set IsMultiIconSkill[i * 4 + 4]= true
	set i = 86 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "chainlightning"),'A0NM', 0,'Y341', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "unimmolation"),'A0NE', 0,'Y342', "v")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "renew"),'A0NO', 0,'Y343', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "tornado"),'A0NT','A0NX','Y344', "d")
	set i = 87 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "arrows")+ SaveSkillOrder(i * 4 + 1, "range only"),'A0OI', 0,'Y345', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "chainlightning"),'A0OJ', 0,'Y346', "t")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "r19"),'A0IF','QP1A','Y347', null)
	set IsPassiveSkill[i * 4 + 3]= true
	set NoRearmCombosTips[i * 4 + 3]= "若同时学习了球状闪电，则精气光环触发时只恢复8/10/12/14%的最大魔法"
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "blizzard"),'A0OK','A1VW','Y348', "c")
	set i = 88 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "autodispelon"),'A0J5', 0,'Y349', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "creepheal"),'A0AS', 0,'Y350', "w")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "blizzard"),'A06P', 0,'Y351', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "inferno")+ SaveSkillOrder(i * 4 + 4, "r20"),'S008','S00U','Y352', "r")
	set i = 89 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "renewon"),'A0NB', 0,'Y353', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "carrionscarabsoff"),'A0N8', 0,'Y354', "f")
	call RegisterHeroSkill(i * 4 + 3, null,'A0N7','QP1B','Y355', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, null,'A0MW','A27C','Y356', null)
	set IsDisabledSkill[i * 4 + 4]= true
	set i = 90 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "thunderbolt"),'A0NQ', 0,'Y357', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "devourmagic"),'A10L', 0,'Y358', "g")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "darkportal"),'A0OR', 0,'Y359', "d")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "renewoff"),'A10Q','A1DB','Y360', "w")
	set i = 91 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "rainoffire"),'A01I', 0,'Y361', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "flamestrike"),'A0RA', 0,'Y362', "t")
	call RegisterHeroSkill(i * 4 + 3, null,'AIcd','QP1C','Y363', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "divineshield")+ SaveSkillOrder(i * 4 + 4, "whirlwind"),'A0R0', 0,'Y364', "d")
	set i = 92 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "repair, str bug"),'A15S','A3JX','Y365', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "lumber2gold"),'A0R5', 0,'Y366', "r")
	//set IsDisabledSkill[i*4+2]=true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "soulpreservation")+ SaveSkillOrder(i * 4 + 3, "r21"),'A15V', 0,'Y367', "t")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "metamorphosis")+ SaveSkillOrder(i * 4 + 4, "melee morph")+ SaveSkillOrder(i * 4 + 4, "r24"),'QM03', 0,'Y368', "f")
	set IsMultiIconSkill[i * 4 + 4]= true
	set i = 93 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "repairoff"),'A0QE', 0,'Y369', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "autoentangle")+ SaveSkillOrder(i * 4 + 2, "r26"),'A0QG', 0,'Y370', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "bloodlust"),'A0R7', 0,'Y371', "r")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "manaflareon"),'A0QK','A21Q','Y372', "w")
	set i = 94 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "tranquility"),'A32A', 0,'A32T', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "curse"),'A32C', 0,'A32U', "w")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "eattree")+ SaveSkillOrder(i * 4 + 3, "controlmagic"),'A32E', 0,'A32V', "d")
	set IsMultiIconSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "absorb"),'A32G', 0,'A32W', "r")
	set i = 95 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "townbellon"),'A0I7', 0,'Y377', "f")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "autoentangleinstant"),'A180', 0,'Y378', "c")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "load"),'A0B1', 0,'Y379', "d")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "cannibalize"),'A1BX','A30L','Y380', "b")
	set i = 96 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "repairon"),'A1EL', 0,'Y381', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "autoharvestgold"),'A19V', 0,'Y382', "r")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "metamorphosis")+ SaveSkillOrder(i * 4 + 3, "range morph")+ SaveSkillOrder(i * 4 + 3, "r3"),'QM04', 0,'Y383', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "chainlightning"),'A19O','A1MV','Y384', "f")
	set i = 97 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "etherealform"),'A1MG', 0,'Y385', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "replenish"),'A1HS', 0,'Y386', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "berserk"),'A1HQ', 0,'Y387', "g")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "taunt")+ SaveSkillOrder(i * 4 + 4, "fanofknives")+ SaveSkillOrder(i * 4 + 4, "r22"),'A1MI','A2QE','Y388', "t")
	set i = 98 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "fanofknives"),'A1IM', 0,'Y389', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "whirlwind"),'A1J7', 0,'Y390', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "abuz agi") ,'A1HR','QP1F','Y391', null)
	set IsPassiveSkill[i * 4 + 3]= true
	set NoBalanceOffTips[i * 4 + 3]= "远程模型使用能量转移只有2/3的效果"
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "windwalk")+ SaveSkillOrder(i * 4 + 4, "ibug"),'A1IN', 0,'Y392', "d")
	set i = 99 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "replenishoff"),'A2KZ', 0,'Y393', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "board"),'A0H4', 0,'Y394', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "metamorphosis")+ SaveSkillOrder(i * 4 + 3, "range morph")+ SaveSkillOrder(i * 4 + 3, "chemicalrage"),'A1RI', 0,'Y395', "t")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "chainlightning"),'A07Q', 0,'Y396', "r")
	set i = 100 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "requestsacrifice"),'QB0F', 0,'QY0F', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "fanofknives"),'A20T', 0,'Y398', "c")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "chainlightning"),'A06V', 0,'Y399', "g")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "berserk"),'A21F','A21G','Y400', "v")
	set i ='e'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "chainlightning"),'A1S8', 0,'Y401', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "replenishon"),'A1SB', 0,'Y402', "c")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "fingerofdeath")+ SaveSkillOrder(i * 4 + 3, "flare"),'A1S4', 0,'Y403', "w")
	set IsMultiIconSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "blizzard"),'A343','A34J','Y404', "g")
	set i ='f'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "frostnova"),'A07F', 0,'Y405', "v")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "frostarmor"),'A08R', 0,'Y406', "f")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "innerfire"),'A053', 0,'Y407', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "thunderbolt"),'A05T','A08H','Y408', "c")
	set i ='g'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "carrionswarm"),'A078', 0,'Y409', "r")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "silence"),'A07M', 0,'Y410', "e")
	call RegisterHeroSkill(i * 4 + 3, null,'A02C', 0,'Y411', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "locustswarm"),'A04N', 0,'Y412', "x")
	if ExtraAbilitiesNum  == 2 then
		set ZTP[i * 4 + 4]= "该技能在此模式下会减少对建筑25%伤害"
	endif
	set HeroSkillsIcon[i * 4 + 4]= "ReplaceableTextures\\CommandButtons\\BTNExorcism.blp"
	set i ='h'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "freezingbreath"),'A0X5', 0,'Y413', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "hex"),'A0MN', 0,'Y414', "d")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "drain"),'A02N', 0,'Y415', "r")
	set HeroSkillsIcon[i * 4 + 3]= "ReplaceableTextures\\CommandButtons\\BTNManaDrain.blp"
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "chainlightning"),'A095','A09W','Y416', "f")
	set i ='i'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "magicdefense"),'A173', 0,'Y417', "e")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "buff placer"),'A0MY','QP1D','Y418', null)
	set IsPassiveSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "ward"),'A0MS', 0,'Y419', "w")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "summongrizzly"),'A013','A0A6','Y420', "v")
	set i ='j'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "carrionswarm"),'A02S','A3Y8','Y421', "w")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "innerfire"),'A037', 0,'Y422', "e")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "blackarrowon"),'A1RD', 0,'Y423', "d")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "roar"),'A29L','A447','Y424', "v")
	set i ='k'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "cripple"),'A08X', 0,'Y425', "g")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "creepheal"),'A1NA', 0,'Y426', "c")
	set IsMultiIconSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, null,'A0VX','QP23','Y427', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "fanofknives"),'A1NE','A2IG','Y428', "t")
	set i ='l'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "tankpilot"),'A055', 0,'Y429', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "forceboard"),'A0RW', 0,'Y430', "e")
	call RegisterHeroSkill(i * 4 + 3, null,'A03N','QP1E','Y431', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "mirrorimage"),'A03O', 0,'Y432', "t")
	set i ='m'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "stomp")+ SaveSkillOrder(i * 4 + 1, "range morph")+ SaveSkillOrder(i * 4 + 1, "r44")+ SaveSkillOrder(i * 4 + 1, "metamorphosis")+ SaveSkillOrder(i * 4 + 1, "yongjiu3"),'A332', 0,'Y437', "r")
	if(not Mode__RearmCombos) then
		set s = SaveSkillOrder(i * 4 + 1, "HXBinglongTuijin")
	endif
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "unstoneform"),'A2LA', 0,'Y438', "t")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "townbellon"),'A2LB', 0,'Y439', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "unwindwalk"),'A0Z0', 0,'Y440', "w")
	set i = 110 -1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "unravenform"),'A2M1', 0,'Y433', "c")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "unrobogoblin"),'A2LM', 0,'Y434', "f")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "undeadbuild"),'A2LL', 0,'Y435', "r")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "metamorphosis")+ SaveSkillOrder(i * 4 + 4, "summongrizzly"),'A2M0', 0,'Y436', "d")
	set IsDisabledSkill[i * 4 + 4]= true
	set i ='o'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "cripple"),'A2QM', 0,'Y443', "d")
	set IsMultiIconSkill[i * 4 + 1]= true
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "unsubmerge"),'A2TJ', 0,'Y444', "f")
	set IsMultiIconSkill[i * 4 + 2]= true
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "unflamingarrows"),'A2QI', 0,'Y445', "r")
	set IsMultiIconSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "summonwareagle"),'A2TI', 0,'Y446', "t")
	set IsMultiIconSkill[i * 4 + 4]= true
	set i ='p'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "webon"),'A2QT', 0,'Y453', "t")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "chainlightning"),'A2T5', 0,'Y454', "f")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "avengerform"),'A2SG', 0,'Y455', "e")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "lavamonster"),'A2TF', 0,'Y456', "r")
	set i ='q'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "acidbomb"),'A1PH', 0,'Y458', "e")
	call RegisterHeroSkill(i * 4 + 2, null,'A33Q','A33R','Y459', null)
	set IsPassiveSkill[i * 4 + 2]= true
	//	if(not Mode__RearmCombos) then
	//		set IsDisabledSkill[i * 4 + 2]= true
	//	endif
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "magicdefense"),'A34A','QP28','A34B', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "barkskinoff"),'A33U', 0,'Y460', "g")
	if(GKV or Mode__MirrorDraft or VT)== false then
		set i = 114 -1
		call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "request_hero")+ SaveSkillOrder(i * 4 + 1, "r23"),'Z601', 0,'Y601', "t")
		call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "mechanicalcritter"),'Z602', 0,'Y602', "d")
		call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "militia"),'Z603', 0,'Y603', "f")
		call RegisterHeroSkill(i * 4 + 4, null, 0, 0, 0, null)
		set IsDisabledSkill[i * 4 + 4]= true
		set i = 115 -1
		call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "militiaconvert"),'Z604', 0,'Y604', "y")
		call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "windwalk"),'Z605', 0,'Y605', "v")
		call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "militiaoff"),'Z606', 0,'Y606', "g")
		call RegisterHeroSkill(i * 4 + 4, null, 0, 0, 0, null)
		set IsDisabledSkill[i * 4 + 4]= true
		set i = 116 -1
		call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "militiaunconvert"),'Z607', 0,'Y607', "Z")
		call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "mindrot"),'Z608', 0,'Y608', "x")
		call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "monsoon"),'Z609', 0,'Y609', "c")
		call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "mount"),'Z610','A3K5','Y610', "b")
		call RZR(i * 4 + 4)
		call ExecuteFunc("PreloadKael_Ability")
	endif
	set i ='u'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "unload"),'A40K','A40S','Y500', "j")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "unloadall"),'A40L','A40T','Y501', "k")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "unloadallcorpses"),'A40M','A40U','Y502', "l")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "undeadbuild"),'A40N','A40V','Y503', "i")
	//set IsDisabledSkill[i * 4 + 4]= true	无形
	set i ='v'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "lavamonster"),'A0QV', 0,'Y614', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "carrionscarabs")+ SaveSkillOrder(i * 4 + 2, "carrionscarabsoff")+ SaveSkillOrder(i * 4 + 2, "carrionscarabson"),'A43Y', 0,'Y615', "q")
	call RegisterHeroSkill(i * 4 + 3, SaveSkillOrder(i * 4 + 3, "carrionscarabs")+ SaveSkillOrder(i * 4 + 3, "carrionscarabsoff")+ SaveSkillOrder(i * 4 + 3, "carrionscarabson"),'A00T', 0,'Y616', "q")
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "renew"),'A46J', 0,'Y61K', "c")
	set i ='w'-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "soulburn"),'A0EC', 0,'Y329', "d")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "lumber2gold"),'A44U', 0,'Y618', "e")
	//set IsDisabledSkill[i * 4 + 2]= true	下注
	if Mode__SixSkills and(not Mode__RearmCombos) then
		set IsDisabledSkill[i * 4 + 2]= true
	endif
	call RegisterHeroSkill(i * 4 + 3, null,'A0LE','QP1Y','Y330', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, null,'A440','QP25','Y617', null)
	set IsPassiveSkill[i * 4 + 4]= true
	set i = 120-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "volcano"),'A451', 0,'Y61C', "w")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "stomp"),'A454', 0,'Y61D', "t")
	call RegisterHeroSkill(i * 4 + 3, null,'A45B','QP26','Y61E', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "fanofknives"),'A456', 0,'Y61F', "r")
	set i = 121-1
	call RegisterHeroSkill(i * 4 + 1, SaveSkillOrder(i * 4 + 1, "curse"),'A45W', 0,'Y61G', "q")
	call RegisterHeroSkill(i * 4 + 2, SaveSkillOrder(i * 4 + 2, "volcano"),'A45X', 0,'Y61H', "w")
	call RegisterHeroSkill(i * 4 + 3, null,'A460','QP27','Y61I', null)
	set IsPassiveSkill[i * 4 + 3]= true
	call RegisterHeroSkill(i * 4 + 4, SaveSkillOrder(i * 4 + 4, "creepthunderclap"),'A461', 0,'Y61J', "d")
	set GL = 121
	if GKV or Mode__MirrorDraft or VT then
		call ExecuteFunc("R1R")
	endif
endfunction

function RegisterItem takes integer powerUpItemId, integer realItemId, integer sellItemId, integer invalidItemId returns integer
	set ItemMaxNum = ItemMaxNum + 1
	set PowerUpItemTypeId[ItemMaxNum]= powerUpItemId
	set RealItemTypeId[ItemMaxNum] = realItemId
	set SellItemTypeId[ItemMaxNum] = sellItemId
	call SaveBoolean(M, SellItemTypeId[ItemMaxNum], 0, true)
	call SaveInteger(ObjectData, OBJ_ITEM_INDEX, powerUpItemId, ItemMaxNum)
	call SaveInteger(ObjectData, OBJ_ITEM_INDEX, realItemId, ItemMaxNum)
	set InvalidItemTypeId[ItemMaxNum]= invalidItemId
	if realItemId > 0 then
		set itemIconPath[ItemMaxNum]= GetAbilitySoundById(realItemId, SOUND_TYPE_EFFECT_LOOPED)
		if StringLength(itemIconPath[ItemMaxNum])< 20 then
		endif
	endif
	return ItemMaxNum
endfunction
function InitItemsSystem takes nothing returns nothing
	local string s = ""
	call RegisterItem('I0FF','I0FG', 0, 0)
	set Item_DragonLance = RegisterItem('I0UB','I0UC', 0,'I0UD')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'n12V', 0), Item_DragonLance)
	set it_xj = RegisterItem('I0VJ','I0VK', 0,'I0VL')
	set jz_xj = RegisterItem('I0VG','I0VH','h0EU','I0VI')
	set Recipe_HurricanePike = RegisterItem('I0VX','I0VY','n138','I0VZ')
	set Item_HurricanePike = RegisterItem('I0W0','I0W1', 0,'I0W2')
	set it_hyzr = RegisterItem('I0VM','I0VN', 0,'I0VO')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'n134', 0), it_hyzr)
	set it_jys = RegisterItem('I0RC','I0RD','n139', 0)
	set it_fj = RegisterItem('IZPS','IZPD', 0,'IZPE')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'n125', 0), it_fj)//否决一键购买
	set XMV = RegisterItem('I02Q','I02O','h011','I00A')
	set XPV = RegisterItem('I02S','I02P','h012','I0CA')
	set XQV = RegisterItem('I02N','I02R','h013','I0CS')
	set XSV = RegisterItem('I02X','I02Y','h015','I0D4')
	set XTV = RegisterItem('I02Z','I043','h016','I0CV')
	set XUV = RegisterItem('I030','I044','h017','I0D2')
	set XWV = RegisterItem('I031','I045','h018','I0D5')
	set XYV = RegisterItem('I032','I046','h019','I0CZ')
	set XZV = RegisterItem('I033','I047','h01A','I0D7')
	set X_V = RegisterItem('I034','I048','h01B','I0CX')
	set X0V = RegisterItem('I035','I049','h01C','I0CI')
	set X1V = RegisterItem('I036','I04A','h01D','I0CH')
	set X2V = RegisterItem('I037','I04B','h01E','I0CR')
	set X3V = RegisterItem('I038','I04C','h01F','I0CJ')
	set X4V = RegisterItem('I039','I04D','h01G','I0DG')
	set X5V = RegisterItem('I0MS','I0MR', 0,'I0MT')
	set X6V = RegisterItem('I03B','I04E','h01H','I0DA')
	set X7V = RegisterItem('I03C','I04F','h01I','I0CQ')
	set Item_IronwoodBranch = RegisterItem('I03D','I04G','h01J','I0CU')
	set X9V = RegisterItem('I03E','I04H','h01K','I0C7')
	set OVV = RegisterItem('I03E','I04I','h01K','I0DH')
	set OEV = RegisterItem('I03F','I04J','h01L','I0CM')
	set OXV = RegisterItem('I03G','I04K','h01M','I0CD')
	set OOV = RegisterItem('I03H','I04L','h01N','I0CG')
	set ORV = RegisterItem('I03I','I04M','h01O','I0D0')
	set OIV = RegisterItem('I03J','I04N','h01P','I0CN')
	set OAV = RegisterItem('I03K','I04O','h01Q','I0D8')
	set Item_PlaneswalkerCloak = RegisterItem('I03L','I04P','h01R','I0CE')
	set OBV = RegisterItem('I03M','I04Q','h01S','I0DB')
	set OCV = RegisterItem('I03N','I04R','h01T','I0CL')
	set ODV = RegisterItem('I03P','I04S','h01U','I0CY')
	set OFV = RegisterItem('I03Q','I04T','h01V','I0DI')
	set OGV = RegisterItem('I03R','I04U','h01W','I0CW')
	set OHV = RegisterItem('I03S','I04V','h01X','I0DJ')
	set OJV = RegisterItem('I03T','I04W','h01Y','I0CP')
	set OKV = RegisterItem('I03U','I04X','h01Z','I0CC')
	set OLV = RegisterItem('I03V','I04Y','h020','I0C5')
	set OMV = RegisterItem('I03W','I04Z','h021','I0DK')
	set OPV = RegisterItem('I03X','I050','h022','I0D1')
	set StoutShield_melee = RegisterItem('I03A','I051','h023','I0D9')
	set StoutShield_ranged = RegisterItem('I0KB','I0KA', 0,'I0KC')
	set OTV = RegisterItem('I03Y','I052','h024','I0C9')
	set OUV = RegisterItem('I03Z','I053','h025','I0CK')
	set OWV = RegisterItem('I040','I054','h026','I0DL')
	set Item_Javelin = RegisterItem('I041','I055','h027','I0D6')
	set OZV = RegisterItem('I00L','I0AV','h02B', 0)
	set O_V = RegisterItem('I05E','I0AM', 0,'I0DN')
	set O0V = RegisterItem('I0AU','I0AN', 0,'I0DO')
	set O1V = RegisterItem('I0AS','I0AO', 0,'I0DP')
	set O2V = RegisterItem('I0AT','I0AP', 0,'I0DQ')
	set O7V = RegisterItem('I0GW','I0GY', 0,'I0H3')
	set O6V = RegisterItem('I0H2','I0GX', 0,'I0DR')
	set O5V = RegisterItem('I0GV','I0H1', 0,'I0H4')
	set O8V = RegisterItem('I0Q8','I0Q7', 0,'I0Q9')
	set O4V = RegisterItem('I0AR','I0H0', 0,'I0H6')
	set O3V = RegisterItem('I0AQ','I0GZ', 0,'I0H5')
	set Item_MagicStick = RegisterItem('I0GD','I0GC','h074','I0GE')
	set Item_MagicWand = RegisterItem('I0HC','I0HB', 0,'I0HA')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h07S', 0), Item_MagicWand)
	set QuellingBlade_Melee = RegisterItem('I0HT','I0HR','h07W','I0HV')
	set QuellingBlade_Ranged = RegisterItem('I0HU','I0HP', 0,'I0HW')
	set RXV = RegisterItem('I0J7','I0J6','h083','I0J8')
	set Item_GhostScepter = RegisterItem('I0JJ','I0JI','h087','I0JK')
	set XKV = RegisterItem('I0MA','I0M9','h0CM','I0MB')
	set XLV = RegisterItem('I0MD','I0ME', 0,'I0MC')
	set R0V = RegisterItem('I057','I05C','h02A','ITGB')
	set XHV = RegisterItem('I0QI','I0QH', 0,'I0QJ')
	set XJV = RegisterItem('I0QL','I0QK','ho02','I0QM')
	set R1V = RegisterItem('INTD','INTG', 0, 0)
	set RYV = RegisterItem('I042','I05D','h028','INCP')
	set RZV = RegisterItem('I0HO','I0HN','h07V', 0)
	set R_V = RegisterItem('I056','I05F','h029','INHS')
	set R2V = RegisterItem('I058','I05G','h02C', 0)
	set R3V = RegisterItem('I059','I05H','h02D', 0)
	set R4V = RegisterItem('I05A','I05I','h02E', 0)
	set R5V = RegisterItem('I05B','I05J','h02F', 0)
	set R6V = RegisterItem('I0B0','I0B1', 0, 0)
	set R7V = RegisterItem('I0TC','I0TD', 0, 0)
	set R8V = RegisterItem('I0GI','I0GH','h076', 0)
	set R9V = RegisterItem('I0KT','I0KS','h0B9', 0)
	set IVV = RegisterItem('I0NF','I0NG','h0D3', 0)
	set IEV = RegisterItem('I061','I062', 0,'I01J')
	set IXV = RegisterItem('I064','I063', 0,'I01K')
	set IOV = RegisterItem('I065','I066', 0,'I01L')
	set IRV = RegisterItem('I068','I067', 0,'I01M')
	set IIV = RegisterItem('I069','I06A', 0,'I0C6')
	set IAV = RegisterItem('I06C','I06B', 0,'I01P')
	set IBV = RegisterItem('I03O','I02T', 0,'I01R')
	set ICV = RegisterItem('I02U','I05Y', 0,'I01Q')
	set IDV = RegisterItem('I060','I05Z', 0,'I01S')
	set IFV = RegisterItem('I06E','I06D', 0,'I01T')
	set IGV = RegisterItem('I0NO','I0NN', 0,'I0NP')
	set IHV = RegisterItem('I06G','I06F', 0,'I01U')
	set IJV = RegisterItem('I06I','I06H', 0,'I01V')
	set IKV = RegisterItem('I06K','I06J', 0,'I01W')
	set ILV = RegisterItem('I06M','I06L', 0,'I01X')
	set IMV = RegisterItem('I08F','I08G', 0,'I01Y')
	set Item_Sange = RegisterItem('I08I','I08H', 0,'I01Z')
	set IQV = RegisterItem('I08J','I08K', 0,'I020')
	set ISV = RegisterItem('I08N','I08O', 0,'I021')
	set ITV = RegisterItem('I08Q','I08P', 0,'I022')
	set Item_DiffusalBladeLevel1 = RegisterItem('I08S','I08R', 0,'I023')
	set Item_DiffusalBladeLevel2 = RegisterItem('I0JB','I0J9', 0,'I0JD')
	set Item_DiffusalBladeLevel1_Empty = RegisterItem('I0EW','I0EV', 0,'I0EX')
	set IZV = RegisterItem('I0JC','I0JA', 0,'I0JE')
	set I_V = RegisterItem('I08U','I08T', 0,'I024')
	set I0V = RegisterItem('I08W','I08V', 0,'I0CO')
	set I1V = RegisterItem('I08X','I08Y', 0,'I025')
	set Item_EulScepterOfDivinity = RegisterItem('I090','I08Z', 0,'I026')
	set I3V = RegisterItem('I092','I091', 0,'I027')
	set I4V = RegisterItem('I094','I093', 0,'I028')
	set Item_SangeAndYasha = RegisterItem('I096','I095', 0,'I029')
	set Item_StygianDesolator = RegisterItem('I098','I097', 0,'I02A')
	set Item_BattleFury = RegisterItem('I09A','I099', 0,'I02B')
	set I8V = RegisterItem('I09B','I09C', 0,'I02C')
	// BKB 6 种
	set I9V = RegisterItem('I0G2','I0FZ', 0,'I0G8')// 10
	set AVV = RegisterItem('I0G6','I0G0', 0,'I0G9')// 9
	set AEV = RegisterItem('I09E','I0FY', 0,'I0G7')// 8
	set AXV = RegisterItem('I0G5','I0FS', 0,'I02D')// 7
	set AOV = RegisterItem('I0G3','I09D', 0,'I0GB')// 6
	set ARV = RegisterItem('I0G4','I0G1', 0,'I0GA')// 5
	set AIV = RegisterItem('I0AX','I0AW', 0, 0)
	set AAV = RegisterItem('I0TE','I0TF', 0, 0)
	set ANV = RegisterItem('I09G','I09F', 0,'I02E')	//近战分身斧
	set ABV = RegisterItem('I0MV','I0MU', 0,'I0MW')	//远程分身斧
	set ACV = RegisterItem('I09I','I09H', 0,'I02F')
	set ADV = RegisterItem('I09K','I09M', 0,'I01G')//1
	set AFV = RegisterItem('I09J','I09P', 0,'I02G')//2
	set AGV = RegisterItem('I09Q','I09N', 0,'I0DC')//3
	set AHV = RegisterItem('I09S','I09O', 0,'I0DD')//4
	set AJV = RegisterItem('I09R','I09L', 0,'I0D3')//5级大根
	set AKV = RegisterItem('I09U','I09T', 0,'I02H')
	set ALV = RegisterItem('I09V','I09X', 0,'I02I')
	set AMV = RegisterItem('I09W','I09Y', 0,'I02J')
	set APV = RegisterItem('I0A0','I09Z', 0,'I0BO')
	set AQV = RegisterItem('I0HK','I0HJ', 0,'I0HL')
	set ASV = RegisterItem('I0A2','I0A1', 0,'I0BP')
	set ATV = RegisterItem('I0LI','I0LJ', 0,'I0LK')
	set AUV = RegisterItem('I0A4','I0A3', 0,'I0BQ')
	set Item_MonkeyKingBar = RegisterItem('I0A6','I0A5', 0,'I0BR')
	set AYV = RegisterItem('I0K8','I0K7', 0,'I0K9')
	set AZV = RegisterItem('I0A7','I0A8', 0,'I0BS')
	set A_V = RegisterItem('I0KQ','I0KP', 0,'I0KR')
	set A0V = RegisterItem('I0AA','I0A9', 0,'I0BT')
	set A1V = RegisterItem('I0AA','I0KL', 0,'I0KM')
	set A2V = RegisterItem('I0AC','I0AB', 0,'I0BU')
	set A3V = RegisterItem('I0AD','I0AE', 0,'I0BV')
	set A4V = RegisterItem('I0AG','I0AF', 0,'I0CT')
	set A5V = RegisterItem('I0AH','I0AI', 0,'I0BW')
	set XFV = RegisterItem('I0B8','I0AY', 0,'I00B')
	set XCV = RegisterItem('I0QT','I0QS', 0,'I0QU')
	set XDV = RegisterItem('I0QT','I0TB', 0,'I0QU')
	set A6V = RegisterItem('I0AK','I0AJ', 0,'I0BX')
	set A7V = RegisterItem('I07K','I0AL', 0,'I0BY')
	set Vanguard_melee = RegisterItem('I0BB','I0BA', 0,'I0BZ')
	set Vanguard_ranged = RegisterItem('I0LE','I0LC', 0,'I0LD')
	set NVV = RegisterItem('I0BC','I0BD', 0,'I00C')
	set NEV = RegisterItem('I0BF','I0BE', 0,'I0C0')
	set NXV = RegisterItem('I014','I01D', 0, 0)
	set NOV = RegisterItem('I0BH','I0BG', 0,'I0C1')
	set NRV = RegisterItem('I0BI','I0BJ', 0,'I0C2')
	set NIV = RegisterItem('I0BL','I0BK', 0,'I0C3')
	set Item_HoodOfDefiance = RegisterItem('I0BN','I0BM', 0,'I0C4')
	set NBV = RegisterItem('I00S','I00M', 0,'I01C')
	set NCV = RegisterItem('I00T','I00Q', 0,'I01E')
	set NDV = RegisterItem('I00V','I00N', 0,'I01F')
	set NFV = RegisterItem('I00W','I00R', 0,'I0DE')
	set NGV = RegisterItem('I00X','I00Z', 0,'I0CF')
	set NHV = RegisterItem('I00Y','I010', 0,'I0DF')
	set NJV = RegisterItem('I013','I012', 0,'I0CB')
	set NKV = RegisterItem('I0GK','I0GJ', 0,'I0GL')
	set NMV = RegisterItem('I0HG','I0HI', 0,'I0HH')
	set Item_KhadgarPipeOfInsight = RegisterItem('I0I0','I0K6', 0,'I0I2')
	set NQV = RegisterItem('I0JG','I0JF', 0,'I0JH')
	set NSV = RegisterItem('I0KD','I0KF', 0,'I0KE')
	set NUV = RegisterItem('I0KX','I0KY', 0,'I0KZ')
	set NWV = RegisterItem('I0LG','I0LF', 0,'I0LH')
	set NYV = RegisterItem('I0LP','I0LL', 0,'I0LQ')
	set ROV = RegisterItem('I0LR','I0LT', 0,'I0LS')
	set NZV = RegisterItem('I0MJ','I0MI', 0,'I0MK')
	set N_V = RegisterItem('I0N1','I0N0', 0,'I0N2')
	set RRV = RegisterItem('I0ND','I0NE', 0,'I0NC')
	set RIV = RegisterItem('I0NL','I0NK', 0,'I0NM')
	set N0V = RegisterItem('I0O2','I0O3', 0,'I0O4')
	set RAV = RegisterItem('I0OC','I0OE', 0,'I0OD')
	set RNV = RegisterItem('I0OF','I0OG', 0,'I0OH')
	set RBV = RegisterItem('I0OJ','I0OI', 0,'I0OK')
	set RCV = RegisterItem('I0OM','I0OL', 0,'I0ON')
	set Item_MoonShard = RegisterItem('I0SI','I0SJ', 0,'I0SK')
	set RFV = RegisterItem('I0SU','I0SV', 0,'I0SW')
	set Item_SilverEdge = RegisterItem('I0SL','I0SM', 0,'I0SN')
	set RJV = RegisterItem('I0SR','I0SS', 0,'I0ST')
	set RGV = RegisterItem('I0T5','I0T6', 0,'I0T7')
	set RPV = RegisterItem('I0S6','I0S7','n12A','I0S8')
	set RTV = RegisterItem('I0SC','I0SD', 0,'I0SE')
	set Item_GlimmerCape = RegisterItem('I0S9','I0SA', 0,'I0SB')
	set INV = RegisterItem('I0SZ','I0T0', 0,'I0T1')
	set XGV = RegisterItem('I0P9','I0PB','h0EI','I0PA')
	set Item_HeavenHalberd = RegisterItem('I0OU','I0OV', 0,'I0OW')
	set N2V = RegisterItem('I0OY','I0OX', 0,'I0OZ')
	set RUV = RegisterItem('I0P0','I0P1', 0,'I0P2')
	set RWV = RegisterItem('I0P3','I0P4', 0,'I0P5')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h02G', 0), IEV)
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h086', 0), NQV)
	set s = "ReplaceableTextures\\CommandButtons\\BTNSnazzyScroll.blp"
	set RKV = RegisterItem(0, 0,'h0DY', 0)
	set RHV = RegisterItem('I0T2','I0T3','n12H','I0T4')
	set RMV = RegisterItem('I0SO','I0SP','n12D','I0SQ')
	set RSV = RegisterItem('I0SF','I0SG','n12C','I0SH')
	set N3V = RegisterItem('I05L','I05R','h02H','I0DS')
	set N4V = RegisterItem('I05M','I05S','h02I','I0DT')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h02J', 0), IIV)
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h014', 0), IBV)
	set N5V = RegisterItem('I05O','I05T','h02K','I0DU')
	set N6V = RegisterItem('I05P','I05U','h02L','I0DW')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h02M', 0), IHV)
	set N7V = RegisterItem('I05K','I05V','h02N','I0DX')
	set N8V = RegisterItem('I05N','I05W','h02O','I0DY')
	set N9V = RegisterItem('I05Q','I05X','h02P','I0DZ')
	set BVV = RegisterItem('I06N','I06O','h02Q','I0E0')
	set BEV = RegisterItem('I06Q','I06P','h02R','I0E1')
	set BXV = RegisterItem('I06R','I06S','h02S','I0E2')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h02T', 0), ISV)
	set BOV = RegisterItem('I06W','I06V','h02U','I0E4')
	set BRV = RegisterItem('I06X','I06Y','h02V','I0E5')
	//	set BIV = RegisterItem('I070','I06Z','h02X','I0E6')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h02W', 0), I_V)
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h02X', 0), I1V) //疯脸
	set BAV = RegisterItem('I071','I072','h02Y','I0E7')
	call RegisterItem(0, 0,'h02Z', 0)
	set BNV = RegisterItem('I074','I073','h030','I0E8')
	set BBV = RegisterItem(0, 0,'h031', 0)
	call SaveInteger(HY,'ITDB', BBV, Item_SangeAndYasha)
	set BCV = RegisterItem('I076','I07V','h032','I0EA')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h033', 0), Item_BattleFury)


	set BDV = RegisterItem('I077','I07W','h034','I0EB')
	// 黑皇杖
	set BFV = RegisterItem('I078','I07X','h035','I0EC')
	
	set BGV = RegisterItem('I079','I07Y','h036','I0ED')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h037', 0), ACV)
	set BHV = RegisterItem('I07B','I080','h038','I0EF')
	set BJV = RegisterItem('I07C','I081','h039','I0EG')
	set BKV = RegisterItem('I07D','I082','h03A','I0EH')
	call RegisterItem(0, 0,'h03C', 0)
	set BLV = RegisterItem('I07E','I083','h03D','I0EI')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h03E', 0), Item_MonkeyKingBar)
	set BMV = RegisterItem('I07G','I07F','h03F','I0EJ')
	set BPV = RegisterItem('I07H','I084','h03G','I0EK')
	set BQV = RegisterItem('I07O','I085','h03H','I0EL')
	set B2V = RegisterItem(0, 0,'h03K', 0)
	call SaveInteger(HY,'ITDB', B2V, XFV)
	set BSV = RegisterItem('I07J','I088','h03L','I0EO')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h03M', 0), A7V)
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h03N', 0), Vanguard_melee)
	set BTV = RegisterItem('I07M','I089','h03O','I0EP')
	set BUV = RegisterItem('I07P','I08A','h03Q','I0EQ')
	set BWV = RegisterItem('I07Q','I08B','h03R','I0ER')
	set BYV = RegisterItem('I07R','I08C','h03S','I0ES')
	set NAV = RegisterItem('I0QQ','I0QN','h03T','I0QR')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h03U', 0), Item_HoodOfDefiance)
	set BZV = RegisterItem('I07S','I08D','h03V','I0ET')
	set B_V = RegisterItem('I07T','I08E','h03W','I0EU')
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h079', 0), NKV)
	set B0V = RegisterItem('I0HD','I0HF','h07T','I0HE')
	set B1V = RegisterItem('I0HX','I0HZ','h07X','I0HY')
	set B3V = RegisterItem('I07L','I0KN','h03P','I0KO')
	set B4V = RegisterItem('I0KW','I0KV','h0BA','I0KU')
	set B5V = RegisterItem('I0LM','I0LN','h0BQ','I0LO')
	set B6V = RegisterItem('I0N9','I0NA','h0D1','I0NB')
	set B7V = RegisterItem('I0NH','I0NI','h0CY','I0NJ')
	set B8V = RegisterItem('I0O5','I0O6','h0DD','I0O7')
	set B9V = RegisterItem('I0OB','I0OA','h03X','I0O9')
	set CVV = RegisterItem(0, 0,'h0DU', 0)
	call SaveInteger(HY,'ITDB', CVV, RNV)
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h0E9', 0), Item_HeavenHalberd)
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h0DV', 0), RCV)
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h0EN', 0), Item_GlimmerCape)
	call RegisterItem(0, 0,'h0EA', 0)
	call SaveInteger(HY,'ITDB', RegisterItem(0, 0,'h0EC', 0), RWV)

	call SaveInteger(Y, RealItemTypeId[ARV],'00CD', 55)
	call SaveInteger(Y, RealItemTypeId[NGV],'00CD', 30)
	call SaveInteger(Y, RealItemTypeId[ISV],'00CD', 15)
	call SaveInteger(Y, RealItemTypeId[ANV],'00CD', 50)
	call SaveInteger(Y, RealItemTypeId[ABV],'00CD', 50)
	call SaveInteger(Y, RealItemTypeId[A7V],'00CD', 30)
	call SaveInteger(Y, RealItemTypeId[NJV],'00CD', 18)
	call SaveInteger(Y, RealItemTypeId[Item_EulScepterOfDivinity],'00CD', 23)
	call SaveInteger(Y, RealItemTypeId[NMV],'00CD', 20)
	call SaveInteger(Y, RealItemTypeId[ADV],'00CD', 35)
	call SaveInteger(Y, RealItemTypeId[AFV],'00CD', 30)
	call SaveInteger(Y, RealItemTypeId[AGV],'00CD', 25)
	call SaveInteger(Y, RealItemTypeId[AHV],'00CD', 20)
	call SaveInteger(Y, RealItemTypeId[AJV],'00CD', 15)
	call SaveInteger(Y, RealItemTypeId[AKV],'00CD', 95)
	call SaveInteger(Y, RealItemTypeId[ALV],'00CD', 95)
	call SaveInteger(Y, RealItemTypeId[AMV],'00CD', 95)
	call SaveInteger(Y, RealItemTypeId[N0V],'00CD', 30)
	call SaveInteger(Y, RealItemTypeId[RCV],'00CD', 16)
	call SaveInteger(Y, RealItemTypeId[I4V],'00CD', 45)
	call SaveInteger(Y, RealItemTypeId[Item_KhadgarPipeOfInsight],'00CD', 60)
	call SaveInteger(Y, RealItemTypeId[N_V],'00CD', 7)
	call SaveInteger(Y, RealItemTypeId[ROV],'00CD', 30)
	call SaveInteger(Y, RealItemTypeId[N2V],'00CD', 60)
	call SaveInteger(Y, RealItemTypeId[ACV],'00CD', 28)
	call SaveInteger(Y, RealItemTypeId[A2V],'00CD', 35)
	call SaveInteger(Y, RealItemTypeId[NEV],'00CD', 35)
	call SaveInteger(Y, RealItemTypeId[I1V],'00CD', 25)
	call SaveInteger(Y, RealItemTypeId[I_V],'00CD', 60)
	call SaveInteger(Y, RealItemTypeId[Item_HeavenHalberd],'00CD', 30)
	call SaveInteger(Y, RealItemTypeId[IAV],'00CD', 45)
	call SaveInteger(Y, RealItemTypeId[INV],'00CD', 45)
	call SaveInteger(Y, RealItemTypeId[IFV],'00CD', 100)
	call SaveInteger(Y, RealItemTypeId[R8V],'00CD', 50)
	call SaveInteger(Y, RealItemTypeId[RTV],'00CD', 40)
	call SaveInteger(Y, RealItemTypeId[Item_GlimmerCape],'00CD', 16)
	call SaveInteger(Y, RealItemTypeId[RJV],'00CD', 7)
	call SaveInteger(Y, RealItemTypeId[Item_SilverEdge],'00CD', 28)
	call SaveInteger(Y, RealItemTypeId[RGV],'00CD', 15)
	
	set XNV[RegisterItem('I03A','I051','h08K','I0D9')]= StoutShield_melee
	set XNV[RegisterItem('I03Y','I052','h08X','I0C9')]= OTV
	set XNV[RegisterItem('I02S','I02P','h08S','I0CA')]= XPV
	set XNV[RegisterItem('I02N','I02R','h08P','I0CS')]= XQV
	set XNV[RegisterItem('I02Z','I043','h08Q','I0CV')]= XTV
	set XNV[RegisterItem('I031','I045','h08T','I0D5')]= XWV
	set XNV[RegisterItem('I03B','I04E','h08N','I0DA')]= X6V
	set XNV[RegisterItem('I03E','I04H','h08W','I0C7')]= X9V
	set XNV[RegisterItem('I03G','I04K','h08O','I0CD')]= OXV
	set XNV[RegisterItem('I03P','I04S','h08U','I0CY')]= ODV
	set XNV[RegisterItem('I03Q','I04T','h08G','I0DI')]= OFV
	set XNV[RegisterItem('I03S','I04V','h08L','I0DJ')]= OHV
	set XNV[RegisterItem('I03T','I04W','h08R','I0CP')]= OJV
	set XNV[RegisterItem('I03V','I04Y','h08E','I0C5')]= OLV
	set XNV[RegisterItem('I03W','I04Z','h08J','I0DK')]= OMV
	set XNV[RegisterItem('I0GD','I0GC','h08I','I0GE')]= Item_MagicStick
	set XNV[RegisterItem('I0HT','I0HR','h08F','I0HW')]= QuellingBlade_Melee
	set XNV[RegisterItem('I0J7','I0J6','h08V','I0J8')]= RXV
	set XNV[RegisterItem('I040','I054','h08M','I0DL')]= OWV
	set XNV[RegisterItem('I05A','I05I','h08H', 0)]= R4V
	set XNV[RegisterItem('I037','I04B','h093','I0CR')]= X2V
	set XNV[RegisterItem('I02Q','I02O','h0BO','I00A')]= XMV
	set XNV[RegisterItem('I0MA','I0M9','h0CN','I0MB')]= XKV
	set XNV[RegisterItem('I033','I047','h0D0','I0D7')]= XZV
	set XNV[RegisterItem('I032','I046','u025','I0CZ')]= XYV
	set CCV = CCV + 1
	set COV[CCV]= OFV
	set CRV[CCV]= OWV
	set CBV[CCV]= IEV
	set CCV = CCV + 1
	set COV[CCV]= IEV
	set CRV[CCV]= XZV
	set CIV[CCV]= RHV
	set CAV[CCV]= XZV
	set CBV[CCV]= RGV
	set CCV = CCV + 1
	set COV[CCV]= X7V
	set CRV[CCV]= X7V
	set CBV[CCV]= Item_MoonShard
	set CCV = CCV + 1
	set COV[CCV]= Item_PlaneswalkerCloak
	set CRV[CCV]= XGV
	set CBV[CCV]= Item_GlimmerCape
	set CCV = CCV + 1
	set COV[CCV]= N_V
	set CRV[CCV]= RXV
	set CBV[CCV]= RJV
	set CCV = CCV + 1
	set COV[CCV]= OHV
	set CRV[CCV]= Item_IronwoodBranch
	set CIV[CCV]= N3V
	set CBV[CCV]= IXV
	set CCV = CCV + 1
	set COV[CCV]= XZV
	set CRV[CCV]= Item_IronwoodBranch
	set CIV[CCV]= N4V
	set CBV[CCV]= IOV
	set CCV = CCV + 1
	set COV[CCV]= OGV
	set CRV[CCV]= OMV
	set CBV[CCV]= IIV
	set CCV = CCV + 1
	set COV[CCV]= XMV
	set CRV[CCV]= N5V
	set CBV[CCV]= IAV
	set CCV = CCV + 1
	set COV[CCV]= IAV
	set CRV[CCV]= N5V
	set CBV[CCV]= INV
	set CCV = CCV + 1
	set COV[CCV]= I3V
	set CRV[CCV]= OIV
	set CBV[CCV]= RFV
	set CCV = CCV + 1
	set COV[CCV]= XMV
	set CRV[CCV]= XQV
	set CIV[CCV]= XPV
	set CBV[CCV]= IBV
	set CCV = CCV + 1
	set COV[CCV]= XMV
	set CRV[CCV]= XTV
	set CIV[CCV]= XPV
	set CBV[CCV]= ICV
	set CCV = CCV + 1
	set COV[CCV]= XMV
	set CRV[CCV]= OJV
	set CIV[CCV]= XPV
	set CBV[CCV]= IDV
	set CCV = CCV + 1
	set COV[CCV]= XPV
	set CRV[CCV]= N6V
	set CBV[CCV]= IFV
	set CCV = CCV + 1
	set COV[CCV]= ODV
	set CRV[CCV]= OJV
	set CIV[CCV]= OMV
	set CBV[CCV]= IHV
	set CCV = CCV + 1
	set COV[CCV]= XSV
	set CRV[CCV]= X3V
	set CIV[CCV]= N7V
	set CBV[CCV]= IJV
	set CCV = CCV + 1
	set COV[CCV]= XSV
	set CRV[CCV]= OLV
	set CIV[CCV]= N8V
	set CBV[CCV]= IKV
	set CCV = CCV + 1
	set COV[CCV]= XSV
	set CRV[CCV]= OEV
	set CIV[CCV]= N9V
	set CBV[CCV]= ILV
	set CCV = CCV + 1
	set COV[CCV]= XUV
	set CRV[CCV]= XQV
	set CIV[CCV]= BVV
	set CBV[CCV]= IMV
	set CCV = CCV + 1
	set COV[CCV]= OAV
	set CRV[CCV]= XTV
	set CIV[CCV]= BEV
	set CBV[CCV]= Item_Sange
	set CCV = CCV + 1
	set COV[CCV]= Item_Javelin
	set CRV[CCV]= XTV
	set CIV[CCV]= BXV
	set CBV[CCV]= IQV
	set CCV = CCV + 1
	set COV[CCV]= ACV	//大隐刀
	set CRV[CCV]= Item_Sange
	set CIV[CCV]= RMV
	set CBV[CCV]= Item_SilverEdge
	set CCV = CCV + 1
	set COV[CCV]= I4V
	set CRV[CCV]= NZV
	set CIV[CCV]= RSV
	set CBV[CCV]= RTV
	set CCV = CCV + 1
	set COV[CCV]= XYV
	set CRV[CCV]= XZV
	set CIV[CCV]= OJV
	set CBV[CCV]= ISV
	set CCV = CCV + 1
	set COV[CCV]= ORV
	set CRV[CCV]= XPV
	set CIV[CCV]= BOV
	set CBV[CCV]= ITV
	set CCV = CCV + 1
	set COV[CCV]= XUV
	set CRV[CCV]= XUV
	set CIV[CCV]= OJV
	set CAV[CCV]= BRV
	set CBV[CCV]= Item_DiffusalBladeLevel1
	set CCV = CCV + 1
	set COV[CCV]= Item_DiffusalBladeLevel1
	set CRV[CCV]= BRV
	set CBV[CCV]= Item_DiffusalBladeLevel2
	set CCV = CCV + 1
	set COV[CCV]= Item_DiffusalBladeLevel1_Empty
	set CRV[CCV]= BRV
	set CBV[CCV]= Item_DiffusalBladeLevel2
	set CCV = CCV + 1
	set COV[CCV]= X6V
	set CRV[CCV]= OXV
	set CBV[CCV]= I_V
	set CCV = CCV + 1
	set COV[CCV]= OXV
	set CRV[CCV]= ODV
	set CBV[CCV]= I1V
	set CCV = CCV + 1
	set COV[CCV]= OMV
	set CRV[CCV]= OPV
	set CIV[CCV]= OWV
	set CAV[CCV]= BAV
	set CBV[CCV]= Item_EulScepterOfDivinity
	set CCV = CCV + 1
	set COV[CCV]= OCV
	set CRV[CCV]= X2V
	set CIV[CCV]= OUV
	set CBV[CCV]= I3V
	set CCV = CCV + 1
	set COV[CCV]= IXV
	set CRV[CCV]= IOV
	set CIV[CCV]= BNV
	set CBV[CCV]= I4V
	set CCV = CCV + 1
	set COV[CCV]= Item_Sange
	set CRV[CCV]= IMV
	set CBV[CCV]= Item_SangeAndYasha
	set CCV = CCV + 1
	set COV[CCV]= ORV
	set CRV[CCV]= ORV
	set CIV[CCV]= BCV
	set CBV[CCV]= Item_StygianDesolator
	set CCV = CCV + 1
	set COV[CCV]= IEV
	set CRV[CCV]= XYV
	set CIV[CCV]= X_V
	set CAV[CCV]= QuellingBlade_Melee
	set CBV[CCV]= Item_BattleFury
	set CCV = CCV + 1
	set COV[CCV]= IEV
	set CRV[CCV]= XYV
	set CIV[CCV]= X_V
	set CAV[CCV]= QuellingBlade_Ranged
	set CBV[CCV]= Item_BattleFury
	set CCV = CCV + 1
	set COV[CCV]= XWV
	set CRV[CCV]= XYV
	set CIV[CCV]= BDV
	set CBV[CCV]= I8V
	set CCV = CCV + 1
	set COV[CCV]= ORV
	set CRV[CCV]= OAV
	set CIV[CCV]= BFV
	set CBV[CCV]= I9V
	set CCV = CCV + 1
	set COV[CCV]= IMV
	set CRV[CCV]= OTV
	set CIV[CCV]= BGV
	set CBV[CCV]= ABV
	set CCV = CCV + 1
	set COV[CCV]= XGV
	set CRV[CCV]= X_V
	set CBV[CCV]= ACV
	set CCV = CCV + 1
	set COV[CCV]= OPV
	set CRV[CCV]= ILV
	set CIV[CCV]= BHV
	set CBV[CCV]= ADV
	set CCV = CCV + 1
	set COV[CCV]= ADV
	set CRV[CCV]= BHV
	set CBV[CCV]= AFV
	set CCV = CCV + 1
	set COV[CCV]= AFV
	set CRV[CCV]= BHV
	set CBV[CCV]= AGV
	set CCV = CCV + 1
	set COV[CCV]= AGV
	set CRV[CCV]= BHV
	set CBV[CCV]= AHV
	set CCV = CCV + 1
	set COV[CCV]= AHV
	set CRV[CCV]= BHV
	set CBV[CCV]= AJV
	set CCV = CCV + 1
	set COV[CCV]= OPV
	set CRV[CCV]= XTV
	set CIV[CCV]= BJV
	set CBV[CCV]= AKV
	set CCV = CCV + 1
	set COV[CCV]= AKV
	set CRV[CCV]= BJV
	set CBV[CCV]= ALV
	set CCV = CCV + 1
	set COV[CCV]= ALV
	set CRV[CCV]= BJV
	set CBV[CCV]= AMV
	set CCV = CCV + 1
	set COV[CCV]= OTV
	set CRV[CCV]= IEV
	set CIV[CCV]= BKV
	set CBV[CCV]= APV
	set CCV = CCV + 1
	set COV[CCV]= X0V
	set CRV[CCV]= OKV
	set CBV[CCV]= ASV
	set CCV = CCV + 1
	set COV[CCV]= I8V
	set CRV[CCV]= X0V
	set CIV[CCV]= BLV
	set CBV[CCV]= AUV
	set CCV = CCV + 1
	set COV[CCV]= X0V
	set CRV[CCV]= Item_Javelin
	set CIV[CCV]= Item_Javelin
	set CBV[CCV]= Item_MonkeyKingBar
	set CCV = CCV + 1
	set COV[CCV]= OKV
	set CRV[CCV]= BMV
	set CBV[CCV]= AZV
	set CCV = CCV + 1
	set COV[CCV]= OOV
	set CRV[CCV]= OUV
	set CIV[CCV]= BPV
	set CBV[CCV]= A0V
	set CCV = CCV + 1
	set COV[CCV]= OOV
	set CRV[CCV]= I_V
	set CIV[CCV]= BQV
	set CBV[CCV]= A2V
	set CCV = CCV + 1
	set COV[CCV]= OOV
	set CRV[CCV]= I0V
	set CIV[CCV]= BQV
	set CBV[CCV]= A2V
	set CCV = CCV + 1
	set COV[CCV]= OTV
	set CRV[CCV]= OTV
	set CIV[CCV]= OCV
	set CAV[CCV]= XKV
	set CBV[CCV]= A3V
	set CCV = CCV + 1
	set COV[CCV]= OTV
	set CRV[CCV]= OTV
	set CIV[CCV]= OCV
	set CAV[CCV]= XLV
	set CBV[CCV]= A3V
	set CCV = CCV + 1
	set COV[CCV]= XJV
	set CRV[CCV]= IOV
	set CIV[CCV]= Vanguard_melee
	set CBV[CCV]= XHV
	set CCV = CCV + 1
	set COV[CCV]= XJV
	set CRV[CCV]= IOV
	set CIV[CCV]= Vanguard_ranged
	set CBV[CCV]= XHV
	set CCV = CCV + 1
	set COV[CCV]= X1V
	set CRV[CCV]= ODV
	set CIV[CCV]= RXV
	set CBV[CCV]= A5V
	set CCV = CCV + 1
	set COV[CCV]= OMV
	set CRV[CCV]= XZV
	set CIV[CCV]= B7V
	set CBV[CCV]= N_V
	set CCV = CCV + 1
	set COV[CCV]= OCV
	set CRV[CCV]= OAV
	set CIV[CCV]= XUV
	set CAV[CCV]= OPV
	set CBV[CCV]= XFV
	set CCV = CCV + 1
	set COV[CCV]= IEV
	set CRV[CCV]= IEV
	set CIV[CCV]= BSV
	set CBV[CCV]= A6V
	set CCV = CCV + 1
	set COV[CCV]= OTV
	set CRV[CCV]= OIV
	set CIV[CCV]= OWV
	set CBV[CCV]= A7V
	set CCV = CCV + 1
	set COV[CCV]= OUV
	set CRV[CCV]= OFV
	set CIV[CCV]= StoutShield_melee
	set CBV[CCV]= Vanguard_melee
	set CCV = CCV + 1
	set COV[CCV]= OUV
	set CRV[CCV]= OFV
	set CIV[CCV]= StoutShield_ranged
	set CBV[CCV]= Vanguard_melee
	set CCV = CCV + 1
	set COV[CCV]= X2V
	set CRV[CCV]= OGV
	set CIV[CCV]= BTV
	set CBV[CCV]= NVV
	set CCV = CCV + 1
	set COV[CCV]= X7V
	set CRV[CCV]= ITV
	set CIV[CCV]= B3V
	set CBV[CCV]= NEV
	set CCV = CCV + 1
	set COV[CCV]= R5V
	set CIV[CCV]= BUV
	set CBV[CCV]= NXV
	set CCV = CCV + 1
	set COV[CCV]= IXV
	set CRV[CCV]= IRV
	set CIV[CCV]= OXV
	set CAV[CCV]= BWV
	set CBV[CCV]= NOV
	set CCV = CCV + 1
	set COV[CCV]= IXV
	set CRV[CCV]= IIV
	set CIV[CCV]= OXV
	set CAV[CCV]= BWV
	set CBV[CCV]= NOV
	set CCV = CCV + 1
	set COV[CCV]= X7V
	set CRV[CCV]= OBV
	set CIV[CCV]= XZV
	set CAV[CCV]= BYV
	set CBV[CCV]= NRV
	set CCV = CCV + 1
	set COV[CCV]= I3V
	set CRV[CCV]= NAV
	set CIV[CCV]= NYV
	set CBV[CCV]= NIV
	set CCV = CCV + 1
	set COV[CCV]= OHV
	set CRV[CCV]= OHV
	set CIV[CCV]= OFV
	set CAV[CCV]= Item_PlaneswalkerCloak
	set CBV[CCV]= Item_HoodOfDefiance
	set CCV = CCV + 1
	set COV[CCV]= XPV
	set CRV[CCV]= X6V
	set CIV[CCV]= XWV
	set CAV[CCV]= BZV
	set CBV[CCV]= NFV
	set CCV = CCV + 1
	set COV[CCV]= OIV
	set CRV[CCV]= OBV
	set CIV[CCV]= B_V
	set CBV[CCV]= NGV
	set CCV = CCV + 1
	set COV[CCV]= IHV
	set CRV[CCV]= IHV
	set CIV[CCV]= B9V
	set CBV[CCV]= NJV
	set CCV = CCV + 1
	set COV[CCV]= XMV
	set CRV[CCV]= XWV
	set CIV[CCV]= XWV
	set CBV[CCV]= NKV
	set CCV = CCV + 1
	set COV[CCV]= Item_MagicStick
	set CRV[CCV]= Item_IronwoodBranch
	set CIV[CCV]= Item_IronwoodBranch
	set CAV[CCV]= XSV
	set CBV[CCV]= Item_MagicWand
	set CCV = CCV + 1
	set COV[CCV]= OHV
	set CRV[CCV]= OPV
	set CIV[CCV]= B0V
	set CBV[CCV]= NMV
	set CCV = CCV + 1
	set COV[CCV]= Item_HoodOfDefiance
	set CRV[CCV]= IXV
	set CIV[CCV]= B1V
	set CBV[CCV]= Item_KhadgarPipeOfInsight
	set CCV = CCV + 1
	set COV[CCV]= StoutShield_melee
	set CRV[CCV]= OLV
	set CIV[CCV]= OLV
	set CBV[CCV]= NQV
	set CCV = CCV + 1
	set COV[CCV]= StoutShield_ranged
	set CRV[CCV]= OLV
	set CIV[CCV]= OLV
	set CBV[CCV]= NQV
	set CCV = CCV + 1
	set COV[CCV]= OMV
	set CRV[CCV]= X3V
	set CIV[CCV]= X3V
	set CAV[CCV]= B4V
	set CBV[CCV]= NUV
	set CCV = CCV + 1
	set COV[CCV]= OMV
	set CRV[CCV]= OHV
	set CIV[CCV]= B5V
	set CBV[CCV]= NYV
	set CCV = CCV + 1
	set COV[CCV]= X1V
	set CRV[CCV]= Item_GhostScepter
	set CBV[CCV]= ROV
	set CCV = CCV + 1
	set COV[CCV]= XMV
	set CRV[CCV]= X2V
	set CBV[CCV]= NZV
	set CCV = CCV + 1
	set COV[CCV]= OJV
	set CRV[CCV]= IJV
	set CIV[CCV]= B6V
	set CBV[CCV]= RRV
	set CCV = CCV + 1
	set COV[CCV]= RRV
	set CRV[CCV]= B6V
	set CBV[CCV]= RRV
	set CCV = CCV + 1
	set COV[CCV]= RIV
	set CRV[CCV]= B6V
	set CBV[CCV]= RRV
	set CCV = CCV + 1
	set COV[CCV]= X6V
	set CRV[CCV]= ILV
	set CIV[CCV]= B8V
	set CBV[CCV]= N0V
	set CCV = CCV + 1
	set COV[CCV]= XMV
	set CRV[CCV]= OGV
	set CIV[CCV]= OHV
	set CBV[CCV]= RNV
	set CCV = CCV + 1
	set COV[CCV]= OPV
	set CRV[CCV]= OPV
	set CIV[CCV]= OUV
	set CBV[CCV]= RCV
	set CCV = CCV + 1
	set COV[CCV]= Item_Sange
	set CRV[CCV]= RXV
	set CBV[CCV]= Item_HeavenHalberd
	set CCV = CCV + 1
	set COV[CCV]= IQV
	set CRV[CCV]= OKV
	set CBV[CCV]= N2V
	set CCV = CCV + 1
	set COV[CCV]= IKV
	set CRV[CCV]= IRV
	set CBV[CCV]= RUV
	set CCV = CCV + 1
	set COV[CCV]= IKV
	set CRV[CCV]= IIV
	set CBV[CCV]= RWV
	set CCV = CCV + 1
	set COV[CCV]= OAV
	set CRV[CCV]= XQV
	set CIV[CCV]= XQV
	set CBV[CCV]= Item_DragonLance
	set CCV = CCV + 1
	set COV[CCV]= NJV
	set CRV[CCV]= I8V
	set CIV[CCV]= jz_xj
	set CBV[CCV]= it_xj
	set CCV = CCV + 1
	set COV[CCV]= OAV
	set CRV[CCV]= IHV
	set CBV[CCV]= it_hyzr
	set CCV = CCV + 1
	set COV[CCV]= Item_DragonLance
	set CRV[CCV]= NMV
	set CIV[CCV]= Recipe_HurricanePike
	set CBV[CCV]= Item_HurricanePike
	set CCV = CCV + 1
	set COV[CCV]= X6V
	set CRV[CCV]= Item_StygianDesolator
	set CBV[CCV]= it_fj
endfunction
function E0N takes nothing returns nothing //储存切换型技能
	
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A1RJ','A20N') //凤凰冲击
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A1YX','A1Z2') //烈火精灵
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A1YY','A1Z3') //烈日炙烤
	
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'Z605','QFZZ') //幽灵漫步
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A27F','A27X') //隔空取物
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A085','A121') //启明
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A11N','A13D') //X标记
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A1PH','A1RA') //灵魂汲取
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A1A8','A21J') //先祖之魂
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A1NI','A1NH') //不稳定化合物
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A0SW','A0SX') //感染
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A04Y','A2O9') //噩梦
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A0R0','A2MB') //黑暗之门
	
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A0G8','A0GC') //水人复制
	
	call SaveBoolean(ExtraHT, HTKEY_SWITCHING_SKILLS,'A21F', true)
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A21F','A21H') //脉冲新星
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A21G','A21H') //脉冲新星A帐
	
	call SaveBoolean(ExtraHT, HTKEY_SWITCHING_SKILLS,'A1MI', true)
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A1MI','A1MN') //冰晶爆轰
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A2QE','A1MN') //冰晶爆轰A帐
	
	call SaveBoolean(ExtraHT, HTKEY_SWITCHING_SKILLS,'A2E5', true)
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A2E5','A2FX') //锯齿飞轮
	
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A43S','A43P') //锯齿飞轮A帐
	
	call SaveBoolean(ExtraHT, HTKEY_SWITCHING_SKILLS,'A07U', true)
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A07U','A24E') //海妖之歌
	call SaveInteger(ExtraHT, HTKEY_SWITCHING_SKILLS,'A38E','A24E') //海妖之歌A帐
	
endfunction

// 储存基础魔法抗性
function SaveBaseMagicResistance takes nothing returns nothing
	// 肉山
	call SaveUnitTypeMagicResistance('n00L', 0.55)

	// 谜团
	call SaveUnitTypeMagicResistance('hwat', 0.6)
	call SaveUnitTypeMagicResistance('hwt2', 0.6)
	call SaveUnitTypeMagicResistance('hwt3', 0.6)
	call SaveUnitTypeMagicResistance('h006', 0.6)

	// 精灵狼
	call SaveUnitTypeMagicResistance('o007', 0.5)
	call SaveUnitTypeMagicResistance('o005', 0.5)
	call SaveUnitTypeMagicResistance('o006', 0.5)
	call SaveUnitTypeMagicResistance('o00F', 0.5)

	// 攻城车
	call SaveUnitTypeMagicResistance('ebal', 0.8)
	call SaveUnitTypeMagicResistance('umtw', 0.8)
	call SaveUnitTypeMagicResistance('u00R', 0.8)
	call SaveUnitTypeMagicResistance('e026', 0.8)

	// 死灵书
	call SaveUnitTypeMagicResistance('n00H', 0.4)
	call SaveUnitTypeMagicResistance('n006', 0.4)
	call SaveUnitTypeMagicResistance('n00A', 0.4)
	call SaveUnitTypeMagicResistance('n00J', 0.4)
	call SaveUnitTypeMagicResistance('n00K', 0.4)
	call SaveUnitTypeMagicResistance('n00G', 0.4)

	// 活死人
	call SaveUnitTypeMagicResistance('n0F8', 0.25)

	// 石头人
	call SaveUnitTypeMagicResistance('n127', 0.5)
	call SaveUnitTypeMagicResistance('n128', 0.5)
	call SaveUnitTypeMagicResistance('n026', 0.5)

	// 地狱火
	call SaveUnitTypeMagicResistance('n00U', 0.33)
	call SaveUnitTypeMagicResistance('n00Y', 0.33)
	call SaveUnitTypeMagicResistance('n00Z', 0.33)
	call SaveUnitTypeMagicResistance('n0KU', 0.33)
	call SaveUnitTypeMagicResistance('n0KV', 0.33)
	call SaveUnitTypeMagicResistance('n0KW', 0.33)

	// 寄生蜘蛛
	call SaveUnitTypeMagicResistance('n01E', 0.25)
	call SaveUnitTypeMagicResistance('n019', 0.25)

endfunction

function SaveHerosData takes nothing returns nothing


	// 模型数据
	call SaveHeroModelData(1,'Hvwd','h03Z','n09U', "stand 4", 1.35)
	call SaveHeroModelData(2,'Hmbr','h040','n09A', "attack slam alternate", 1.30)
	call SaveHeroModelData(3,'Emoo','h041','n099', "stand 4", 1.)
	call SaveHeroModelData(4,'O00P','h042','n098', "stand 2", 1.)
	call SaveHeroModelData(5,'Hjai','h043','n09W', "stand victory", 1.)
	call SaveHeroModelData(6,'H001','h044','n096', "spell", 1.)
	call SaveHeroModelData(7,'HC49','h045','n09P', "spell", 1.)
	call SaveHeroModelData(8,'Otch','h046','n09D', "attack slam", 1.1)
	call SaveHeroModelData(9,'HC92','h047','n09X', "stand 4", 1.)
	call SaveHeroModelData(10,'N01O','h048','n09Y', "spell slam", 1.)
	call SaveHeroModelScale('N013', 1.0, 0)
	call SaveHeroModelScale('N014', 1.05, 0)
	call SaveHeroModelScale('N015', 1.1, 0)
	call SaveHeroModelScale('n004', 0.9, 0)
	call SaveHeroModelScale('n018', 0.95, 0)
	call SaveHeroModelScale('n01C', 1, 0)
	call SaveHeroModelScale('n01G', 1.050, 0)
	call SaveHeroModelData(11,'H004','h049','n09Z', "stand victory", 1.2)
	call SaveHeroModelData(12,'Nbbc','h04A','n0A5', "stand victory", 1.)
	call SaveHeroModelData(13,'N01A','h04B','n097', "stand ready", 1.)
	call SaveHeroModelData(14,'Hamg','h04C','n09F', "stand 3", .72)
	call SaveHeroModelData(15,'O015','h07P','n0GC', "stand victory", 1.1)
	call SaveHeroModelData(16,'Hblm','h04E','n09G', "stand victory", 1.2)
	call SaveHeroModelScale('H06X', 1.2, 0)
	call SaveHeroModelScale('H06Y', 1.2, 0)
	call SaveHeroModelScale('H06W', 1.2, 0)
	call SaveHeroModelData(17,'Huth','h04F','n09V', "stand spell", 1.2)
	call SaveHeroModelData(18,'Hmkg','h04G','n0A1', "sleep", 1.4)
	call SaveHeroModelData(19,'Ntin','h04H','n0AA', "stand 2", 1.)
	call SaveHeroModelData(20,'Emns','h04I','n0A4', "spell", 1.2)
	call SaveHeroModelData(21,'Ogrh','h04J','n0A3', "stand victory", 1.)
	call SaveHeroModelData(22,'Ucrl','h04K','n0A7', "spell", .5)
	call SaveHeroModelScale('U01X', .5, 0)
	call SaveHeroModelData(23,'H00K','h04L','n0A9', "stand 2", 1.)
	call SaveHeroModelData(24,'H00A','h04M','n0AB', "spell chain lightning", 1.)
	call SaveHeroModelData(25,'E005','h04N','n0BE', "spell", 1.)
	call SaveHeroModelData(26,'Usyl','h04O','n0BD', "spell", 1.1)
	call SaveHeroModelData(27,'N016','h04P','n0A8', "stand 3", 1.25)
	call SaveHeroModelScale('N02B', 1.25, 0)
	call SaveHeroModelScale('QTW2', 1.25, 0)
	call SaveHeroModelScale('QTW3', 1.25, 0)
	call SaveHeroModelScale('N017', 1.25, 0)
	call SaveHeroModelData(28,'Orkn','h057','n094', "stand victory", 1.)
	call SaveHeroModelData(29,'O01F','h0CI','n0KS', "stand 3", 1.3)
	call SaveHeroModelData(30,'Npbm','h053','n0AO', "stand ready", 1.)
	call SaveHeroModelData(31,'H000','h04X','n0AN', "stand 3", 1.75)
	call SaveHeroModelData(32,'Naka','h052','n0AM', "stand var4", 1.2)
	call SaveHeroModelData(33,'Hlgr','h04V','n0AQ', "stand victory", 1.35)
	call SaveHeroModelScale('H00F', 1, 0)
	call SaveHeroModelScale('H00G', 1, 0)
	call SaveHeroModelScale('H00E', 1, 0)
	call JDX('H00G', 255, 255, 200)
	call JDX('H00F', 255, 255, 200)
	call JDX('H00G', 255, 200, 200)
	call SaveHeroModelData(34,'Edem','h04T','n0AR', "stand channel", 1.)
	call SaveHeroModelData(35,'Nbrn','h055','n0AL', "spell", 1.)
	call SaveHeroModelData(36,'Harf','h04Z','n0AS', "stand victory", 1.1)
	call SaveHeroModelData(37,'H00D','h04S','n0AK', "spell slam", 1.)
	call SaveHeroModelData(38,'E00P','h04R','n0AJ', "stand 3", 1.)
	call SaveHeroModelData(39,'N01I','h054','n0AI', "stand 2", 1.)
	call SaveHeroModelScale('N01J', 1, 0)
	call SaveHeroModelScale('N01H', 1, 0)
	call SaveHeroModelScale('N01T', 1, 0)
	// 炼金变身
	call SaveHeroModelScale('H600', 1, 0)
	call SaveHeroModelScale('H601', 1, 0)
	call SaveHeroModelScale('H602', 1, 0)
	call SaveHeroModelData(40,'N01V','h04W','n0AH', "stand ready", 1.)
	call SaveHeroModelData(41,'H00S','h04Q','n0AT', "spell", 1.)
	call SaveHeroModelData(42,'H00Q','h04Y','n0AG', "stand alternate 3", 1.15)
	call SaveHeroModelData(43,'E01Y','h058','n0AF', "stand victory", 1.2)
	call SaveHeroModelData(44,'N00B','h050','n0AE', "attack spell", 1.1)
	call SaveHeroModelData(45,'H00T','h051','n0AU', "Birth", 1.5)
	call SaveHeroModelData(46,'H06S','h06T','n0EE', "stand victory", 1.1)
	call SaveHeroModelData(47,'N0EG','h07A','n0EH', "stand victory", 1.1)
	call SaveHeroModelData(48,'E02N','h0CC','n0KN', "stand 3", 1.1)
	call SaveHeroModelScale('E02O', 1.1, 0)
	call SaveHeroModelData(49,'E02J','h0CD','n0KR', "stand 3", 1.1)
	call SaveHeroModelData(50,'E02I','h0C9','n0KK', "stand 3", 1.)
	call SaveHeroModelData(51,'E02F','h0C8','n0KM', "stand 3", 1.05)
	call SaveHeroModelData(52,'H008','h04U','n0AC', "stand", 1.65)
	call SaveHeroModelData(53,'E02X','h0CT','n0LK', "stand 3", 1.15)
	call SaveHeroModelData(54,'N0M0','h0DG','n0M1', "stand 3", 1.)
	call SaveHeroModelScale('N0MH', 1., 0)
	call SaveHeroModelData(55,'E02K','h0CA','n0KJ', "stand 3", 1.3)
	call SaveHeroModelData(56,'H0DO','h0DH','n0M6', "stand 3", 1.1)
	call SaveHeroModelData(57,'E032','h0EB','n0ME', "stand 3", 1.)
	set VWV = 57
	set VYV = 58
	call SaveHeroModelData(58,'U008','h05H','n0B3', "spell", 1.2)
	call SaveHeroModelScale('E015', 1, 0)
	call JDX(VUV[58], 255, 75, 255)
	call SaveHeroModelData(59,'U006','h05I','n0B4', "walk", 1.36)
	call SaveHeroModelData(60,'Ewar','h05J','n0B5', "spell slam", 1.)
	call SaveHeroModelData(61,'H00V','h05K','n0B6', "stand ready", 1.)
	call SaveHeroModelScale('H08D', 1, 0)
	call SaveHeroModelScale('H08C', 1, 0)
	call SaveHeroModelScale('H084', 1, 0)
	call SaveHeroModelScale('H08B', 1, 0)
	call SaveHeroModelData(62,'Udre','h05L','n0B7', "spell slam", 1.)
	call SaveHeroModelData(63,'NC00','h05M','n0C0', "stand victory", 1.8)
	call JDX(VUV[63], 100, 125, 100)
	call SaveHeroModelData(64,'UC42','h05N','n0BV', "stand victory", 1.1)
	call SaveHeroModelData(65,'U000','h05O','n0BU', "spell throw", .8)
	call SaveHeroModelData(66,'UC91','h05P','n0C1', "spell", 1.)
	call JDX(VUV[66], 175, 75, 200)
	call SaveHeroModelData(67,'UC01','h05Q','n0C2', "spell slam", 1.3)
	call SaveHeroModelData(68,'E004','h05R','n0BW', "stand victory", 1.)
	call SaveHeroModelData(69,'EC45','h05S','n0BS', "spell slam", 1.3)
	call JDX(VUV[69], 0, 255, 150)
	call SaveHeroModelData(70,'EC77','h05T','n0BR', "spell slam", 1.2)
	call JDX(VUV[70], 75, 255, 25)
	call SaveHeroModelData(71,'E002','h05U','n0BY', "spell", 1.)
	call SaveHeroModelData(72,'U00C','h05V','n0BQ', "victory", 1.5)
	call JDX(VUV[72], 100, 100, 100)
	call SaveHeroModelData(73,'H00H','h05W','n0BT', "stand ready", 1.)
	call SaveHeroModelData(74,'Ofar','h05X','n0BP', "attack slam", 1.)
	call SaveHeroModelData(75,'Oshd','h05Y','n0BO', "spell", 1.5)
	call JDX(VUV[75], 150, 0, 150)
	call SaveHeroModelData(76,'U00E','h05Z','n0B8', "stand victory", 1.3)
	call SaveHeroModelData(77,'U00F','h060','n0C5', "stand 3", 1.)
	call SaveHeroModelData(78,'O00J','h061','n0C3', "stand ready", 1.2)
	call SaveHeroModelData(79,'Ubal','h062','n0BX', "attack", 1.)
	call JDX(VUV[79], 255, 200, 200)
	call SaveHeroModelData(80,'Nfir','h063','n0BN', "stand channel", 1.15)
	call JDX(VUV[80], 0, 0, 0)
	call SaveHeroModelData(81,'U00K','h064','n0C4', "attack 3", 1.)
	call SaveHeroModelData(82,'Opgh','h065','n0BM', "stand victory", 1.)
	call SaveHeroModelData(83,'Hvsh','h066','n0BZ', "stand victory", 1.25)
	call JDX(VUV[83],$FA, 150, 150)
	call SaveHeroModelData(84,'Udea','h067','n0BL', "stand ready", 1.)
	call SaveHeroModelData(85,'E01B','h068','n0B9', "stand ready", .8)
	call SaveHeroModelData(86,'E01A','h069','n0BK', "stand victory", 1.25)
	call SaveHeroModelData(87,'U00P','h06A','n0BA', "stand alternate 2", .85)
	call SaveHeroModelData(88,'E01C','h06C','n0BB', "spell", 1.5)
	call SaveHeroModelData(89,'H00I','h06D','n0BJ', "spell", 1.85)
	call SaveHeroModelScale('H00J', 1.4, 0)
	call SaveHeroModelData(90,'N01W','h06E','n0BI', "spell", 1.2)
	call SaveHeroModelData(91,'N00R','h06F','n0BC', "stand channel", .95)
	call SaveHeroModelData(92,'H00R','h06G','n0BH', "stand", 2.)
	call SaveHeroModelScale('H07I', 1.3, 0)
	call SaveHeroModelData(93,'H00N','h06H','n0BG', "spell", 1.15)
	call SaveHeroModelData(94,'KODO','ho0E', 0, "stand victory", 0.9)
	call SaveHeroModelData(95,'Uktl','h04D','n0A6', "stand", 1.5)
	call SaveHeroModelData(96,'O016','h07R','n0G9', "stand", 1.2)
	call SaveHeroModelScale('O017', 1.2, 0)
	call SaveHeroModelData(97,'N0HP','h0B0','n0HR', "stand", 1.2)
	// call SaveHeroModelScale('N0HP', 1.2, 0)
	call SaveHeroModelData(98,'H071','h072','n0EF', "stand 3", 1.25)
	call SaveHeroModelData(99,'Eevi','h056','n0AV', "spell channel", 1.)
	call SaveHeroModelScale('Eevm', 1.1, 0)
	call SaveHeroModelScale('E02V', 1.1, 0)
	call SaveHeroModelScale('E02W', 1.1, 0)
	call SaveHeroModelScale('E02U', 1.1, 0)
	call SaveHeroModelData( 100 ,'Ekee','h059','n0AW', "stand victory", 1.)
	call SaveHeroModelData('e','E02H','h0CB','n0KL', "stand 3", 1.25)
	call SaveHeroModelData('f','Ulic','h05A','n0AX', "stand channel", 1.3)
	call SaveHeroModelData('g','UC76','h05B','n0AY', "spell wail", 1.35)
	call SaveHeroModelData('h','UC18','h05C','n0AZ', "spell callstorm", 1.3)
	call JDX(VUV['h'], 50, 100, 255)
	call SaveHeroModelData('i','EC57','h05D','n0B0', "attack", 1.)
	call JDX(VUV['i'], 150, 200, 255)
	call SaveHeroModelData('j','UC11','h05E','n0A2', "stand channel", 1.)
	call JDX(VUV['j'], 150, 150, 100)
	call SaveHeroModelData('k','UC60','h05F','n0B1', "stand victory", 1.)
	call JDX(VUV['k'], 150, 150, 150)
	call SaveHeroModelData('l','U00A','h05G','n0B2', "stand victory", 1.05)
	call SaveHeroModelData(110,'N0MK','h0EF','n0ML', "stand victory", 1.5)
	call SaveHeroModelData('o','N0MU','ho04', 0, "stand 3", 1.)
	call SaveHeroModelData('p','N0MD','ho05', 0, "stand victory", 1.25)
	call SaveHeroModelData('q','H503','ho06', 0, "spell", 1.)
	call SaveHeroModelData(114,'H501','ho07', 0, "attack", 1.0)
	call SaveHeroModelData(115,'H502','ho08', 0, "spell channel", 1.)
	call SaveHeroModelData(116,'H00U','ho09', 0, "spell", 1.250)
	call SaveHeroModelData('u','H500','ho0A', 0, "attack", 1)
	call SaveHeroModelData('v','H504','ho0B', 0, "spell", 1.300)
	call SaveHeroModelData('w','H505','ho0C', 0, "sleep", 1.7)
	call SaveHeroModelData( 120,'H506','ho0D', 0, "spell", 1.200)
	call SaveHeroModelData( 121,'H507','ho0F', 0, "attack", 1.)

	// 冰龙变身
	call SaveHeroModelData('m','N0M7','h0DW','n0M8', "stand victory", .9)
	call SaveHeroModelScale('N0MB', 1.1, 0)
	call SaveHeroModelScale('N0MC', 1.2, 0)
	call SaveHeroModelScale('N0MO', 1.3, 0)
	call SaveHeroModelScale('N0MA', 1.4, 0)

	set VZV = 121
	set V_V[1]='Nbrn'
	set V_V[2]='Edem'
	set V_V[3]='N016'
	set V_V[4]='Nbbc'
	set V_V[5]='Naka'
	set V_V[6]='O00P'
	set V_V[7]='Usyl'
	set V_V[8]='E005'
	set V_V[9]='N01O'
	set V_V[10]='HC92'
	set V_V[11]='Hvwd'
	set V_V[12]='HC49'
	set V_V[$D]='Huth'
	set V_V[$E]='Ogrh'
	set V_V[$F]='U006'
	set V_V[16]='EC57'
	set V_V[17]='Eevi'
	set V_V[18]='Ubal'
	set V_V[19]='E004'
	set V_V[20]='EC77'
	set V_V[21]='Hvsh'
	set V_V[22]='Nfir'
	set V_V[23]='E002'
	set V_V[24]='EC45'
	set V_V[25]='Ewar'
	set V_V[26]='U000'
	set V_V[27]='H00V'
	set V_V[28]='E01B'
	set V_V[29]='N01V'
	set V_V[30]='H00I'
	set V_V[31]='E01Y'
	set V_V[32]='H071'
	set V_V[33]='E02N'
	set V_V[34]='N0M0'
	set V_V[35]= VUV[110]
	set V_V[36]= VUV['q']
	set V_V[37]= VUV[ 121]
	set V0V = 37
	set V1V[1]='Npbm'
	set V1V[2]='Hlgr'
	set V1V[3]='Harf'
	set V1V[4]='H000'
	set V1V[5]='H001'
	set V1V[6]='Hamg'
	set V1V[7]='H008'
	set V1V[8]='Ucrl'
	set V1V[9]='Otch'
	set V1V[10]='NC00'
	set V1V[11]='Udre'
	set V1V[12]='UC11'
	set V1V[$D]='Ofar'
	set V1V[$E]='U00F'
	set V1V[$F]='U00K'
	set V1V[16]='O00J'
	set V1V[17]='Udea'
	set V1V[18]='Opgh'
	set V1V[19]='U00A'
	set V1V[20]='U00C'
	set V1V[21]='UC91'
	set V1V[22]='UC42'
	set V1V[23]='U008'
	set V1V[24]='H00D'
	set V1V[25]='N01I'
	set V1V[26]='H00Q'
	set V1V[27]='N00R'
	set V1V[28]='H00T'
	set V1V[29]='H06S'
	set V1V[30]='H00R'
	set V1V[31]='O015'
	set V1V[32]='E02I'
	set V1V[33]='E02F'
	set V1V[34]='O01F'
	set V1V[35]='E032'
	set V1V[36]='E02K'
	set V1V[37]='N0MU'
	set V1V[38]='KODO'
	set V1V[39]='H501'
	set V1V[40]='H504'
	set V1V[41]='H505'
	set V1V[42]='H506'
	set V2V = 42
	set V3V[1]='Orkn'
	set V3V[2]='Emoo'
	set V3V[3]='Emns'
	set V3V[4]='H004'
	set V3V[5]='Hjai'
	set V3V[6]='Uktl'
	set V3V[7]='Hmbr'
	set V3V[8]='H00K'
	set V3V[9]='Ntin'
	set V3V[10]='Hmkg'
	set V3V[11]='Hblm'
	set V3V[12]='N01A'
	set V3V[$D]='H00A'
	set V3V[$E]='Ulic'
	set V3V[$F]='Ekee'
	set V3V[16]='UC76'
	set V3V[17]='UC18'
	set V3V[18]='UC01'
	set V3V[19]='UC60'
	set V3V[20]='H00H'
	set V3V[21]='Oshd'
	set V3V[22]='U00E'
	set V3V[23]='E01A'
	set V3V[24]='U00P'
	set V3V[25]='E00P'
	set V3V[26]='E01C'
	set V3V[27]='N01W'
	set V3V[28]='H00N'
	set V3V[29]='N0EG'
	set V3V[30]='H00S'
	set V3V[31]='N00B'
	set V3V[32]='H00U'
	set V3V[33]='O016'
	set V3V[34]='N0HP'
	set V3V[35]='E02H'
	set V3V[36]='E02J'
	set V3V[37]='E02X'
	set V3V[38]='H0DO'
	set V3V[39]='N0M7'
	set V3V[40]='N0MD'
	set V3V[41]='H500'
	set V3V[42]='H502'
	set V4V = 42
	call XRX('esen', "stand 4")
	call XRX('e00V', "stand 4")
	call XRX('edry', "spell")
	call XRX('e00W', "spell")
	call XRX('ugho', "stand victory")
	call XRX('u001', "stand victory")
	call XRX('unec', "stand channel")
	call XRX('u002', "stand channel")
	call SaveHeroModelScale('n00M', .45,'n00M')
	call SaveHeroModelScale('e02R', .5,'e02R')
	call SaveHeroModelScale('e02T', 1.200,'e02T')
	call SaveHeroModelScale('e02S', .5,'e02S')
	call SaveHeroModelScale('e030', .5,'e030')
	call SaveHeroModelScale('n0LS', 1,'n0LS')
	call SaveHeroModelScale('np01', 0.5,'np01')
endfunction

function AHC takes boolean b returns nothing
	local real a = 0.0
	local integer i = 0
	local integer i2 = 0
	local real size = 0.01
	set DownAlt = b
	if b then
		set a = 0.70
		set size = 1
	endif
	loop
		call SetLightningColor(NeutralsPosTipLightning[i * 4 + 0], 0.211, 0.87, 0, a)
		call SetLightningColor(NeutralsPosTipLightning[i * 4 + 1], 0.211, 0.87, 0, a)
		call SetLightningColor(NeutralsPosTipLightning[i * 4 + 2], 0.211, 0.87, 0, a)
		call SetLightningColor(NeutralsPosTipLightning[i * 4 + 3], 0.211, 0.87, 0, a)
		set i = i + 1
	exitwhen i > NeutralsPosTipNumber
	endloop
	loop
		if tower_rangeeff[i2] != null then
			call EXSetEffectSize(tower_rangeeff[i2], size)
		endif
		set i2 = i2 + 1
	exitwhen i2 > tower_rangeint
	endloop
endfunction

function CreateTowerRangeEffect takes unit u returns nothing
	local effect eff = AddSpecialEffect("tower_range.mdx", GetUnitX(u), GetUnitY(u))
	set tower_rangeeff[tower_rangeint] = eff
	call SaveInteger(ExtraHT, GetHandleId(u), HTKEY_TOWER_ATTACK_RANGE_EFFECT, tower_rangeint)
	call EXSetEffectSize(tower_rangeeff[tower_rangeint], 0.01)
	set tower_rangeint = tower_rangeint + 1
	set eff = null
endfunction

function CreateNeutralsUnitsRefreshRect takes rect r, boolean high returns nothing
	local integer h = 896
	if high then
		set h = 1024
	endif
	set NeutralsPosTipLightning[NeutralsPosTipNumber * 4 + 0]= AddLightningEx("BRDR", false, GetRectMinX(r), GetRectMinY(r), h, GetRectMaxX(r), GetRectMinY(r), h)
	set NeutralsPosTipLightning[NeutralsPosTipNumber * 4 + 1]= AddLightningEx("BRDR", false, GetRectMinX(r), GetRectMaxY(r), h, GetRectMaxX(r), GetRectMaxY(r), h)
	set NeutralsPosTipLightning[NeutralsPosTipNumber * 4 + 2]= AddLightningEx("BRDR", false, GetRectMinX(r), GetRectMinY(r), h, GetRectMinX(r), GetRectMaxY(r), h)
	set NeutralsPosTipLightning[NeutralsPosTipNumber * 4 + 3]= AddLightningEx("BRDR", false, GetRectMaxX(r), GetRectMinY(r), h, GetRectMaxX(r), GetRectMaxY(r), h)
	call SetLightningColor(NeutralsPosTipLightning[NeutralsPosTipNumber * 4 + 0], 0.211, 0.87, 0, 0.0)
	call SetLightningColor(NeutralsPosTipLightning[NeutralsPosTipNumber * 4 + 1], 0.211, 0.87, 0, 0.0)
	call SetLightningColor(NeutralsPosTipLightning[NeutralsPosTipNumber * 4 + 2], 0.211, 0.87, 0, 0.0)
	call SetLightningColor(NeutralsPosTipLightning[NeutralsPosTipNumber * 4 + 3], 0.211, 0.87, 0, 0.0)
	set NeutralsPosTipNumber = NeutralsPosTipNumber + 1
endfunction

function SXO takes nothing returns nothing
	call RemoveUnit(CreateUnit(BW,'u001', GetRectCenterX(AZ), GetRectCenterY(AZ), 0))
	call RemoveUnit(CreateUnit(BW,'u001', GetRectCenterX(AZ), GetRectCenterY(AZ), 0))
	call RemoveUnit(CreateUnit(BW,'u001', GetRectCenterX(NZ), GetRectCenterY(NZ), 0))
	call RemoveUnit(CreateUnit(BW,'u001', GetRectCenterX(BZ), GetRectCenterY(BZ), 0))
	call RemoveUnit(CreateUnit(BW,'u001', GetRectCenterX(CZ), GetRectCenterY(CZ), 0))
	call RemoveUnit(CreateUnit(BW,'u001', GetRectCenterX(DZ), GetRectCenterY(DZ), 0))
	call RemoveUnit(CreateUnit(BW,'u001', GetRectCenterX(FZ), GetRectCenterY(FZ), 0))
	call RemoveUnit(CreateUnit(BW,'u001', GetRectCenterX(GZ), GetRectCenterY(GZ), 0))
	call RemoveUnit(CreateUnit(BW,'u001', GetRectCenterX(HZ), GetRectCenterY(HZ), 0))
	call RemoveUnit(CreateUnit(BW,'u001', GetRectCenterX(JZ), GetRectCenterY(JZ), 0))
	call RemoveUnit(CreateUnit(BW,'u001', GetRectCenterX(KZ), GetRectCenterY(KZ), 0))
	call RemoveUnit(CreateUnit(BW,'u001', GetRectCenterX(A0), GetRectCenterY(A0), 0))
	call RemoveUnit(CreateUnit(BW,'u001', GetRectCenterX(B0), GetRectCenterY(B0), 0))
endfunction
function InitTaverns takes nothing returns nothing
	local player p = NeutralPassivePlayer
	set EVV = CreateUnit(p,'n008',-7360, 6464, 270)
	set EEV = CreateUnit(p,'n0GJ',-7168, 6464, 270)
	set EXV = CreateUnit(p,'n01D',-6848, 6464, 270)
	set EOV = CreateUnit(p,'n0LH',-6656, 6464, 270)
	set ERV = CreateUnit(p,'n01N',-7360, 6784, 270)
	set EIV = CreateUnit(p,'n007',-7168, 6784, 270)
	set EAV = CreateUnit(p,'n005',-6848, 6784, 270)
	set ENV = CreateUnit(p,'n0LI',-6656, 6784, 270)
	set EBV = CreateUnit(p,'n01B',-7360, 7104, 270)
	set ECV = CreateUnit(p,'n01P',-7168, 7104, 270)
	set EDV = CreateUnit(p,'n0GK',-6848, 7104, 270)
	set EFV = CreateUnit(p,'n0LJ',-6656, 7104, 270)
	call SetUnitColor(EVV, ConvertPlayerColor(1))
	call SetUnitColor(EEV, ConvertPlayerColor(1))
	call SetUnitColor(EXV, ConvertPlayerColor(9))
	call SetUnitColor(EOV, ConvertPlayerColor(9))
	call SetUnitColor(ERV, ConvertPlayerColor(6))
	call SetUnitColor(EIV, ConvertPlayerColor(6))
	call SetUnitColor(EAV, ConvertPlayerColor(10))
	call SetUnitColor(ENV, ConvertPlayerColor(10))
	call SetUnitColor(EBV, ConvertPlayerColor(0))
	call SetUnitColor(ECV, ConvertPlayerColor(0))
	call SetUnitColor(EDV, ConvertPlayerColor(11))
	call SetUnitColor(EFV, ConvertPlayerColor(11))
endfunction
// 创建近卫单位
/*
	constant playercolor O5 = ConvertPlayerColor(0)
	constant playercolor R5 = ConvertPlayerColor(6)
	constant playercolor NeutralPassiveColor = ConvertPlayerColor(12)
*/

function CreateSentinelsUnits takes nothing returns nothing
	local trigger t
	set SentinelsBuilding_FountainOfLife = CreateUnit(Sentinels[0],'nfoh',-7168,-7168, 270)
	call CreateUnit(Sentinels[0],'o00G',-7168,-7168, 270)

	// 商店
	// 黑市
	set SentinelsShop_BlackMarket1 = CreateUnit(NeutralPassivePlayer,'n12B',-6360,-6892, 45)
	set SentinelsShop_BlackMarket2 = CreateUnit(NeutralPassivePlayer,'n12B',-6837,-5824, 90)
	// 猪王
	set SentinelsShop_PigKing = CreateUnit(NeutralPassivePlayer,'n999',-6360,-7080, 90)
	call SetUnitColor(SentinelsShop_PigKing, PLAYER_COLOR_LIGHT_GRAY )
	// 奎尔瑟兰的密室 SentinelsShop_CacheOfTheQuelthelan
	set SentinelsShop_CacheOfTheQuelthelan = CreateUnit(NeutralPassivePlayer,'hC95',-6880,-7136, 270)
	call SetUnitColor(SentinelsShop_CacheOfTheQuelthelan, PLAYER_COLOR_RED)
	// 武器商人
	set SentinelsShop_WeaponsDealer = CreateUnit(NeutralPassivePlayer,'n01K',-7264,-6688, 270)
	call SetUnitColor(SentinelsShop_WeaponsDealer, NeutralPassiveColor)
	// 饰品商人希娜 
	set SentinelsShop_GrylaTheAccessorizer = CreateUnit(NeutralPassivePlayer,'nC38',-7264,-6880, 270)
	call SetUnitColor(SentinelsShop_GrylaTheAccessorizer, NeutralPassiveColor)
	// 奇迹古树 SentinelsShop_AncientOfWonders
	set SentinelsShop_AncientOfWonders = CreateUnit(NeutralPassivePlayer,'e025',-6624,-7136, 270)
	call SetUnitColor(SentinelsShop_AncientOfWonders, PLAYER_COLOR_RED)
	// 秘法圣所 SentinelsShop_ArcaneSanctum
	set SentinelsShop_ArcaneSanctum = CreateUnit(NeutralPassivePlayer,'n00V',-6940 + 64,-6368, 270)
	call SetUnitColor(SentinelsShop_ArcaneSanctum, NeutralPassiveColor)
	// 远古兵器 SentinelsShop_AncientWeaponry
	set SentinelsShop_AncientWeaponry = CreateUnit(NeutralPassivePlayer,'n00W',-7264 + 0,-6496 + 64, 270)
	call SetUnitColor(SentinelsShop_AncientWeaponry, NeutralPassiveColor)
 	// 支援法衣 SentinelsShop_SupportiveVestments
	set SentinelsShop_SupportiveVestments = CreateUnit(NeutralPassivePlayer,'n002',-6816 + 64,-6368, 270)
	call SetUnitColor(SentinelsShop_SupportiveVestments, NeutralPassiveColor)
	// 附魔古物 SentinelsShop_EnchantedArtifacts
	set SentinelsShop_EnchantedArtifacts = CreateUnit(NeutralPassivePlayer,'n00X',-7200 + 64,-6368, 270)
	call SetUnitColor(SentinelsShop_EnchantedArtifacts, NeutralPassiveColor)
	// 圣物关口 SentinelsShop_GatewayRelics
	set SentinelsShop_GatewayRelics = CreateUnit(NeutralPassivePlayer,'n009',-6678 + 64,-6432, 270)
	call SetUnitColor(SentinelsShop_GatewayRelics, NeutralPassiveColor)
	// 保护领地 SentinelsShop_Protectorate
	set SentinelsShop_Protectorate = CreateUnit(NeutralPassivePlayer,'n0HE',-7072 + 64,-6368, 270)


	set SentinelsBuilding_TheWorldTree = CreateUnit(Sentinels[0],'etol',-5568,-6016, 270)

	set SentinelsBuilding_AP_L1_TOP = CreateUnit(Sentinels[0],'e00R', -6112, 1568, 90)
	set SentinelsBuilding_AP_L1_MID = CreateUnit(Sentinels[0],'e00R', -1504, -1824, 45)
	set SentinelsBuilding_AP_L1_BOT = CreateUnit(Sentinels[0],'e00R', 4960,-6752, 0)




	set SentinelsBuilding_AP_L2_TOP = CreateUnit(Sentinels[0],'e011',-6112, -1184, 90)

	set X6 = CreateUnit(Sentinels[0],'e011',-3488, -3296, 45)

	set O6 = CreateUnit(Sentinels[0],'e011',-608,-6688, 0)


	call UnitRemoveAbility(SentinelsBuilding_AP_L1_BOT, 'Amov')
	call UnitRemoveAbility(SentinelsBuilding_AP_L1_TOP, 'Amov')
	call UnitRemoveAbility(SentinelsBuilding_AP_L1_MID, 'Amov')
	call UnitRemoveAbility(SentinelsBuilding_AP_L2_TOP, 'Amov')
	call UnitRemoveAbility(X6, 'Amov')
	call UnitRemoveAbility(O6, 'Amov')

	call CreateTowerRangeEffect(SentinelsBuilding_AP_L1_TOP)
	call CreateTowerRangeEffect(SentinelsBuilding_AP_L1_MID)
	call CreateTowerRangeEffect(SentinelsBuilding_AP_L1_BOT)
	call CreateTowerRangeEffect(SentinelsBuilding_AP_L2_TOP)
	call CreateTowerRangeEffect(X6)
	call CreateTowerRangeEffect(O6)

	set JK = CreateTrigger()
	call TriggerRegisterUnitEvent(JK, SentinelsBuilding_TheWorldTree, EVENT_UNIT_DEATH)
	call TriggerAddAction(JK, function MWO)
	call SaveRectHandle(P, GetHandleId(SentinelsBuilding_AP_L2_TOP),'ABDr', Rect(-6944.,-1792.,-5248.,-224.))
	call SaveRectHandle(P, GetHandleId(X6),'ABDr', Rect(-4128.,-3712.,-2496.,-2272.))
	call SaveRectHandle(P, GetHandleId(O6),'ABDr', Rect(-1536.,-7424., 640.,-6048.))
	call GroupAddUnit(UR, SentinelsBuilding_AP_L2_TOP)
	call GroupAddUnit(UR, X6)
	call GroupAddUnit(UR, O6)
	set R6 = CreateUnit(Sentinels[0],'e00S',-6368,-4256, 90)
	call CreateTowerRangeEffect(R6)
	set I6 = CreateUnit(Sentinels[0],'e00S',-4448,-4960, 45)
	call CreateTowerRangeEffect(I6)
	set N6 = CreateUnit(Sentinels[0],'e00S',-$EA0,-6816, 0)
	call CreateTowerRangeEffect(N6)
	set B6 = CreateUnit(Sentinels[0],'e019',-5536,-5664, 45)
	call CreateTowerRangeEffect(B6)
	set C6 = CreateUnit(Sentinels[0],'e019',-5216,-6048, 45)
	call CreateTowerRangeEffect(C6)
	set D6 = CreateUnit(Sentinels[0],'eaom',-6080,-4480, 90)
	set F6 = CreateUnit(Sentinels[0],'eaom',-4416,-5312, 45)
	set G6 = CreateUnit(Sentinels[0],'eaom',-$FC0,-7040, 0)
	set H6 = CreateUnit(Sentinels[0],'eaoe',-6656,-4480, 90)
	set J6 = CreateUnit(Sentinels[0],'eaoe',-4864,-4992, 45)
	set K6 = CreateUnit(Sentinels[0],'eaoe',-$FC0,-6528, 0)
	call L9O(R6)
	call L9O(I6)
	call L9O(N6)
	call L9O(B6)
	call L9O(C6)
	call L9O(D6)
	call L9O(F6)
	call L9O(G6)
	call L9O(H6)
	call L9O(J6)
	call L9O(K6)
	set L6 = CreateUnit(Sentinels[0],'emow',-5856,-5472, 270)
	set M6 = CreateUnit(Sentinels[0],'emow',-6624,-5088, 270)
	set P6 = CreateUnit(Sentinels[0],'emow',-5344,-$F60, 270)
	set Q6 = CreateUnit(Sentinels[0],'emow',-5088,-4576, 270)
	set T6 = CreateUnit(Sentinels[0],'emow',-$F60,-5344, 270)
	set U6 = CreateUnit(Sentinels[0],'emow',-5088,-5536, 270)
	set W6 = CreateUnit(Sentinels[0],'emow',-4896,-6240, 270)
	set Y6 = CreateUnit(Sentinels[0],'emow',-$EE0,-5856, 270)
	set Z6 = CreateUnit(Sentinels[0],'emow',-4512,-7072, 270)
	set V7 = CreateUnit(Sentinels[0],'emow',-5472,-4704, 270)
	set E7 = CreateUnit(Sentinels[0],'emow',-4512,-5856, 270)

	set X7 = CreateUnit(Sentinels[0],'eaow',-6080,-5120, 90.)
	set O7 = CreateUnit(Sentinels[0],'eaow',-4544,-6528, 0.)

	set R7 = CreateUnit(Sentinels[0],'edob',-6400,-5696, 90.)
	set I7 = CreateUnit(Sentinels[0],'edob',-5248,-6848, 0.)
	call S9E(NeutralPassivePlayer,'Aro1', false)


	call UnitAddAbility(SentinelsBuilding_AP_L2_TOP,'Avul')
	call UnitAddAbility(X6,'Avul')
	call UnitAddAbility(O6,'Avul')
	call UnitAddAbility(R6,'Avul')
	call UnitAddAbility(I6,'Avul')
	call UnitAddAbility(N6,'Avul')
	call UnitAddAbility(B6,'Avul')
	call UnitAddAbility(C6,'Avul')
	call UnitAddAbility(SentinelsBuilding_TheWorldTree,'Avul')
	call UnitAddAbility(D6,'Avul')
	call UnitAddAbility(F6,'Avul')
	call UnitAddAbility(G6,'Avul')
	call UnitAddAbility(H6,'Avul')
	call UnitAddAbility(J6,'Avul')
	call UnitAddAbility(K6,'Avul')
	call UnitAddAbility(X7,'Avul')
	call UnitAddAbility(O7,'Avul')
	call UnitAddAbility(R7,'Avul')
	call UnitAddAbility(I7,'Avul')
	call UnitAddAbility(L6,'Avul')
	call UnitAddAbility(M6,'Avul')
	call UnitAddAbility(P6,'Avul')
	call UnitAddAbility(Q6,'Avul')
	call UnitAddAbility(T6,'Avul')
	call UnitAddAbility(U6,'Avul')
	call UnitAddAbility(W6,'Avul')
	call UnitAddAbility(Y6,'Avul')
	call UnitAddAbility(Z6,'Avul')
	call UnitAddAbility(V7,'Avul')
	call UnitAddAbility(E7,'Avul')
	set F1 = CreateTrigger()
	call TriggerRegisterUnitEvent(F1, H6, EVENT_UNIT_DEATH)
	call TriggerAddAction(F1, function GQO)
	set G1 = CreateTrigger()
	call TriggerRegisterUnitEvent(G1, J6, EVENT_UNIT_DEATH)
	call TriggerAddAction(G1, function GSO)
	set H1 = CreateTrigger()
	call TriggerRegisterUnitEvent(H1, K6, EVENT_UNIT_DEATH)
	call TriggerAddAction(H1, function GTO)
	set J1 = CreateTrigger()
	call TriggerRegisterUnitEvent(J1, D6, EVENT_UNIT_DEATH)
	call TriggerAddAction(J1, function GUO)
	set K1 = CreateTrigger()
	call TriggerRegisterUnitEvent(K1, F6, EVENT_UNIT_DEATH)
	call TriggerAddAction(K1, function GWO)
	set L1 = CreateTrigger()
	call TriggerRegisterUnitEvent(L1, G6, EVENT_UNIT_DEATH)
	call TriggerAddAction(L1, function GYO)
	set VXV = CreateUnit(Player(1),'ncop',-7424,-7176, 270)
	call ZKA(VXV, 1)
	call CVO(VXV)
	set VOV = CreateUnit(Player(2),'ncop',-7424,-6998, 270)
	call ZKA(VOV, 2)
	call CVO(VOV)
	set VRV = CreateUnit(Player(3),'ncop',-7424,-6820, 270)
	call ZKA(VRV, 3)
	call CVO(VRV)
	set VIV = CreateUnit(Player(4),'ncop',-7424,-6592, 270)
	call ZKA(VIV, 4)
	call CVO(VIV)
	set VAV = CreateUnit(Player(5),'ncop',-7424,-6400, 270)
	call ZKA(VAV, 5)
	call CVO(VAV)
	set t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, SentinelsBuilding_TheWorldTree, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function G4O))
	set IH = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(IH, EVENT_PLAYER_UNIT_DEATH)
	call TriggerAddCondition(IH, Condition(function PRO))
	call TriggerAddAction(IH, function PCO)
endfunction
function CreateScourgesUnits takes nothing returns nothing
	local trigger t
	set B7 = CreateUnit(Scourges[0],'ndfl', 6784, 6368, 270)
	call CreateUnit(Scourges[0],'o00G', 6784, 6368, 270)
	set C7 = CreateUnit(NeutralPassivePlayer,'n12B', 5521, 6187,$B4)
	set D7 = CreateUnit(NeutralPassivePlayer,'n12B', 6500, 5600,-45)
	
	set shop_2 = CreateUnit(NeutralPassivePlayer,'n999', 6250, 5600,-45)
	call SetUnitColor(shop_2, ConvertPlayerColor(8) )
	
	set F7 = CreateUnit(NeutralPassivePlayer,'nC35', 6816, 5984, 270)
	set G7 = CreateUnit(NeutralPassivePlayer,'n01K', 6304, 6368, 270)
	set H7 = CreateUnit(NeutralPassivePlayer,'nC38', 6496, 6368, 270)
	set J7 = CreateUnit(NeutralPassivePlayer,'u00Q', 6760, 5664, 270)
	set K7 = CreateUnit(NeutralPassivePlayer,'n00V', 5920, 6048 +$80, 0)
	set L7 = CreateUnit(NeutralPassivePlayer,'n00W', 5984 +$80, 6432, 0)
	set M7 = CreateUnit(NeutralPassivePlayer,'n002', 5920, 5920 +$80, 0)
	set P7 = CreateUnit(NeutralPassivePlayer,'n00X', 5920 + 64, 6304 +$80, 0)
	set Q7 = CreateUnit(NeutralPassivePlayer,'n009', 5984, 5792 +$80, 0)
	set S7 = CreateUnit(NeutralPassivePlayer,'n0HE', 5920, 6176 +$80, 0)
	set T7 = CreateUnit(Scourges[0],'unpl', 5248, 4918, 225)
	set U7 = CreateUnit(Scourges[0],'u00M',-4704, 5920, 225.)
	call CreateTowerRangeEffect(U7)
	set W7 = CreateUnit(Scourges[0],'u00M', 1056,-96, 270.)
	call CreateTowerRangeEffect(W7)
	set Y7 = CreateUnit(Scourges[0],'u00M', 6048,-2080, 315.)
	call CreateTowerRangeEffect(Y7)
	set Z7 = CreateUnit(Scourges[0],'u00D',-32, 5920, 225.)
	call CreateTowerRangeEffect(Z7)
	set V8 = CreateUnit(Scourges[0],'u00D',$9E0,$720, 270.)
	call CreateTowerRangeEffect(V8)
	set E8 = CreateUnit(Scourges[0],'u00D', 6272,-$A0, 315.)
	call CreateTowerRangeEffect(E8)
	set YK = CreateTrigger()
	call TriggerRegisterUnitEvent(YK, T7, EVENT_UNIT_DEATH)
	call TriggerAddAction(YK, function MZO)
	call SaveRectHandle(P, GetHandleId(Z7),'ABDr', Rect(-1088., 5376., 768., 6624.))
	call SaveRectHandle(P, GetHandleId(V8),'ABDr', Rect(1600., 1024., 3456., 2432.))
	call SaveRectHandle(P, GetHandleId(E8),'ABDr', Rect(5504.,-1056., 7200., 512.))
	call GroupAddUnit(UR, Z7)
	call GroupAddUnit(UR, V8)
	call GroupAddUnit(UR, E8)
	set X8 = CreateUnit(Scourges[0],'u00N',$BA0, 5792, 225.)
	call CreateTowerRangeEffect(X8)
	set O8 = CreateUnit(Scourges[0],'u00N',$F60,$DA0, 270.)
	call CreateTowerRangeEffect(O8)
	set R8 = CreateUnit(Scourges[0],'u00N', 6368,$9E0, 315.)
	call CreateTowerRangeEffect(R8)
	set I8 = CreateUnit(Scourges[0],'u00T', 4832, 4832, 270.)
	call CreateTowerRangeEffect(I8)
	set A8 = CreateUnit(Scourges[0],'u00T', 5152, 4512, 270.)
	call CreateTowerRangeEffect(A8)
	set N8 = CreateUnit(Scourges[0],'usep',$D40, 5504, 355)
	set B8 = CreateUnit(Scourges[0],'usep', 4352,$E00, 30.)
	set C8 = CreateUnit(Scourges[0],'usep', 6656,$B40, 75)
	set D8 = CreateUnit(Scourges[0],'utod',$D40, 6080, 150.)
	set F8 = CreateUnit(Scourges[0],'utod',$F40,$F40, 195.)
	set G8 = CreateUnit(Scourges[0],'utod', 6080,$B80, 240.)
	set P1 = CreateTrigger()
	call TriggerRegisterUnitEvent(P1, D8, EVENT_UNIT_DEATH)
	call TriggerAddAction(P1, function GZO)
	set Q1 = CreateTrigger()
	call TriggerRegisterUnitEvent(Q1, F8, EVENT_UNIT_DEATH)
	call TriggerAddAction(Q1, function G_O)
	set S1 = CreateTrigger()
	call TriggerRegisterUnitEvent(S1, G8, EVENT_UNIT_DEATH)
	call TriggerAddAction(S1, function G0O)
	set T1 = CreateTrigger()
	call TriggerRegisterUnitEvent(T1, N8, EVENT_UNIT_DEATH)
	call TriggerAddAction(T1, function G1O)
	set U1 = CreateTrigger()
	call TriggerRegisterUnitEvent(U1, B8, EVENT_UNIT_DEATH)
	call TriggerAddAction(U1, function G2O)
	set W1 = CreateTrigger()
	call TriggerRegisterUnitEvent(W1, C8, EVENT_UNIT_DEATH)
	call TriggerAddAction(W1, function G3O)
	call L9O(X8)
	call L9O(O8)
	call L9O(R8)
	call L9O(I8)
	call L9O(A8)
	call L9O(N8)
	call L9O(B8)
	call L9O(C8)
	call L9O(D8)
	call L9O(F8)
	call L9O(G8)
	set H8 = CreateUnit(Scourges[0],'uzig',$A60, 4704, 270)
	set J8 = CreateUnit(Scourges[0],'uzig',$C60,$FE0, 270)
	set K8 = CreateUnit(Scourges[0],'uzig',$DA0, 4832, 270)
	set L8 = CreateUnit(Scourges[0],'uzig', 4128, 6240, 270)
	set M8 = CreateUnit(Scourges[0],'uzig',$FE0, 5280, 270)
	set P8 = CreateUnit(Scourges[0],'uzig', 4384, 4256, 270)
	set Q8 = CreateUnit(Scourges[0],'uzig', 5728,$FA0, 270)
	set S8 = CreateUnit(Scourges[0],'uzig', 5536,$9A0, 270)
	set T8 = CreateUnit(Scourges[0],'uzig', 5024,$EA0, 270)
	set U8 = CreateUnit(Scourges[0],'uzig', 6880,$F60, 270)
	set W8 = CreateUnit(Scourges[0],'uzig', 4640,$B20, 270)
	set Y8 = CreateUnit(Scourges[0],'usap',$F80, 5888, 170.)
	set Z8 = CreateUnit(Scourges[0],'usap', 6400,$E00, 260)
	set VVV = CreateUnit(Scourges[0],'ubon', 4992, 5952, 180.)
	set VEV = CreateUnit(Scourges[0],'ubon', 6464, 4608, 270.)
	call SetUnitColor(F7, R5)
	call SetUnitColor(H7, NeutralPassiveColor)
	call SetUnitColor(G7, NeutralPassiveColor) 
	call SetUnitColor(K7, NeutralPassiveColor)
	call SetUnitColor(L7, NeutralPassiveColor)
	call SetUnitColor(M7, NeutralPassiveColor)
	call SetUnitColor(P7, NeutralPassiveColor)
	call SetUnitColor(Q7, NeutralPassiveColor)
	call UnitAddAbility(Z7,'Avul')
	call UnitAddAbility(V8,'Avul')
	call UnitAddAbility(E8,'Avul')
	call UnitAddAbility(X8,'Avul')
	call UnitAddAbility(O8,'Avul')
	call UnitAddAbility(R8,'Avul')
	call UnitAddAbility(I8,'Avul')
	call UnitAddAbility(A8,'Avul')
	call UnitAddAbility(T7,'Avul')
	call UnitAddAbility(N8,'Avul')
	call UnitAddAbility(B8,'Avul')
	call UnitAddAbility(C8,'Avul')
	call UnitAddAbility(D8,'Avul')
	call UnitAddAbility(F8,'Avul')
	call UnitAddAbility(G8,'Avul')
	call UnitAddAbility(Y8,'Avul')
	call UnitAddAbility(Z8,'Avul')
	call UnitAddAbility(VVV,'Avul')
	call UnitAddAbility(VEV,'Avul')
	call UnitAddAbility(H8,'Avul')
	call UnitAddAbility(J8,'Avul')
	call UnitAddAbility(K8,'Avul')
	call UnitAddAbility(L8,'Avul')
	call UnitAddAbility(M8,'Avul')
	call UnitAddAbility(P8,'Avul')
	call UnitAddAbility(Q8,'Avul')
	call UnitAddAbility(S8,'Avul')
	call UnitAddAbility(T8,'Avul')
	call UnitAddAbility(U8,'Avul')
	call UnitAddAbility(W8,'Avul')
	set VNV = CreateUnit(Player(7),'ncop', 7040, 6400, 270)
	call ZKA(VNV, 7)
	call CVO(VNV)
	set VBV = CreateUnit(Player(8),'ncop', 7040, 6208, 270)
	call ZKA(VBV, 8)
	call CVO(VBV)
	set VCV = CreateUnit(Player(9),'ncop', 7040, 6016, 270)
	call ZKA(VCV, 9)
	call CVO(VCV)
	set VDV = CreateUnit(Player(10),'ncop', 7040, 5824, 270)
	call ZKA(VDV, 10)
	call CVO(VDV)
	set VFV = CreateUnit(Player(11),'ncop', 7040 -64, 5632, 270)
	call ZKA(VFV, 11)
	call CVO(VFV)
	set t = CreateTrigger()
	call TriggerRegisterUnitEvent(t, T7, EVENT_UNIT_DAMAGED)
	call TriggerAddCondition(t, Condition(function G6O))
	set OH = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(OH, EVENT_PLAYER_UNIT_DEATH)
	call TriggerAddCondition(OH, Condition(function PDO))
	call TriggerAddAction(OH, function PFO)
endfunction
function InitBonusSystem takes nothing returns nothing
	local integer i = 0
	set Q4[0]='A17F'
	set Q4[1]='A17G'
	set Q4[2]='A17H'
	set Q4[3]='A17C'
	set Q4[4]='A17D'
	set Q4[5]='A17E'
	set Q4[6]='A17J'
	set Q4[7]='A17I'
	set Q4[8]='A17L'
	set Q4[9]='A439'
	set Q4[10]='A43A'
	set Q4[11]='A43B'
	//
	// 二进制属性系统初始化 - 生命值
	//
	// 二进制属性系统初始化 - 生命值
	// 已优化 删除
	// 二进制属性系统初始化 - 力量
	set PB[0]='ARM0'
	set PB[1]='ARM1'
	set PB[2]='ARM2'
	set PB[3]='ARM3'
	set PB[4]='ARM4'
	//初始化禁用技能
	//call SetAllPlayerAbilityUnavailable(STATE_SYSTEM_PERCENT_MOVE)
	call SetAllPlayerAbilityUnavailable('A42L')
	call SetAllPlayerAbilityUnavailable('A344')
	call SetAllPlayerAbilityUnavailable('A27N')
	call SetAllPlayerAbilityUnavailable('A27O')
	call SetAllPlayerAbilityUnavailable('A1IE')
	call SetAllPlayerAbilityUnavailable('A1IF')
	call SetAllPlayerAbilityUnavailable('A1IG')
	call SetAllPlayerAbilityUnavailable('A2QA')
	call SetAllPlayerAbilityUnavailable('A27P')
	call SetAllPlayerAbilityUnavailable('A1CA')
	call SetAllPlayerAbilityUnavailable('A1C9')
	call SetAllPlayerAbilityUnavailable('A1CB')
	call SetAllPlayerAbilityUnavailable('A1CC')
	call SetAllPlayerAbilityUnavailable('QF9E')
	call SetAllPlayerAbilityUnavailable('A1UH')
	call SetAllPlayerAbilityUnavailable('A1HZ')
	call SetAllPlayerAbilityUnavailable('A1I4')
	call SetAllPlayerAbilityUnavailable('A1I6')
	call SetAllPlayerAbilityUnavailable('A29N')
	call SetAllPlayerAbilityUnavailable('A414')
	call SetAllPlayerAbilityUnavailable('A174')
	call SetAllPlayerAbilityUnavailable('A1VV')

	call SetAllPlayerAbilityUnavailable('A431')


endfunction
function InitPRDRandom takes nothing returns nothing
	call SaveReal(T,-1, 0, .0038)
	call SaveReal(T,-1, 1, .0147)
	call SaveReal(T,-1, 2, .0322)
	call SaveReal(T,-1, 3, .0557)
	call SaveReal(T,-1, 4, .0847)
	call SaveReal(T,-1, 5, .1189)
	call SaveReal(T,-1, 6, .1579)
	call SaveReal(T,-1, 7, .2015)
	call SaveReal(T,-1, 8, .2493)
	call SaveReal(T,-1, 9, .3021)
	call SaveReal(T,-1, 10, .3604)
	call SaveReal(T,-1, 11, .4226)
	call SaveReal(T,-1, 12, .4811)
	call SaveReal(T,-1, 13, .5714)
	call SaveReal(T,-1, 14, .6666)
	call SaveReal(T,-1, 15, .75)
	call SaveReal(T,-1, 16, .8235)
	call SaveReal(T,-1, 17, .8888)
	call SaveReal(T,-1, 18, .9473)
	call SaveReal(T,-1, 19, 1.)
endfunction
// 暗影冲刺循环播放的动画 以序号
function InitChargeOfDarknessAnimation takes nothing returns nothing
	call SaveInteger(P,'H06S','A1P8', 11)
	call SaveInteger(P,'H00D','A1P8', 0)
	call SaveInteger(P,'H503','A1P8', 5)
	call SaveInteger(P,'H000','A1P8', 0)
	call SaveInteger(P,'Otch','A1P8', 1)
	call SaveInteger(P,'Harf','A1P8', 12)
	call SaveInteger(P,'Npbm','A1P8', 0)
	call SaveInteger(P,'H001','A1P8', 0)
	//	call SaveInteger(P,'Ucrl','A1P8', 1)
	call SaveInteger(P,'Ucrl','A1P8', 8)
	call SaveInteger(P,'O015','A1P8', 1)
	call SaveInteger(P,'Hamg','A1P8', 8)
	call SaveInteger(P,'O01F','A1P8', 3)
	call SaveInteger(P,'N01I','A1P8', 4)
	call SaveInteger(P,'N01H','A1P8', 15)
	call SaveInteger(P,'N01T','A1P8', 15)
	call SaveInteger(P,'N01J','A1P8', 15)
	call SaveInteger(P,'H600','A1P8', 15)
	call SaveInteger(P,'H601','A1P8', 15)
	call SaveInteger(P,'H602','A1P8', 15)
	call SaveInteger(P,'H00T','A1P8', 0)
	call SaveInteger(P,'Hlgr','A1P8', 6)
	call SaveInteger(P,'H00E','A1P8', 4)
	call SaveInteger(P,'H00F','A1P8', 4)
	call SaveInteger(P,'H00G','A1P8', 4)
	call SaveInteger(P,'H00Q','A1P8', 17)
	call SaveInteger(P,'H008','A1P8', 1)
	call SaveInteger(P,'E02F','A1P8', 5)
	call SaveInteger(P,'E02I','A1P8', 12)
	call SaveInteger(P,'E02K','A1P8', 0)
	call SaveInteger(P,'E032','A1P8', 6)
	call SaveInteger(P,'N0MU','A1P8', 0)
	call SaveInteger(P,'Edem','A1P8', 8)
	call SaveInteger(P,'Usyl','A1P8', 4)
	call SaveInteger(P,'Nbbc','A1P8', 6)
	call SaveInteger(P,'N01O','A1P8', 8)
	call SaveInteger(P,'N013','A1P8', 13)
	call SaveInteger(P,'N014','A1P8', 13)
	call SaveInteger(P,'N015','A1P8', 13)
	call SaveInteger(P,'E005','A1P8', 1)
	call SaveInteger(P,'H0DL','A1P8', 1)
	call SaveInteger(P,'HC49','A1P8', 2)
	call SaveInteger(P,'Ogrh','A1P8', 0)
	call SaveInteger(P,'N01V','A1P8', 6)
	call SaveInteger(P,'HC92','A1P8', 10)
	call SaveInteger(P,'N016','A1P8', 8)
	call SaveInteger(P,'N017','A1P8', 8)
	call SaveInteger(P,'QTW2','A1P8', 8)
	call SaveInteger(P,'QTW3','A1P8', 8)
	call SaveInteger(P,'N02B','A1P8', 8)
	call SaveInteger(P,'E02N','A1P8', 2)
	call SaveInteger(P,'E02O','A1P8', 2)
	call SaveInteger(P,'Nbrn','A1P8', 8)
	call SaveInteger(P,'E01Y','A1P8', 2)
	call SaveInteger(P,'Huth','A1P8', 0)
	call SaveInteger(P,'Hvwd','A1P8', 5)
	call SaveInteger(P,'Naka','A1P8', 2)
	call SaveInteger(P,'N0M0','A1P8', 0)
	call SaveInteger(P,'H501','A1P8', 3)
	call SaveInteger(P,'H502','A1P8', 10)
	call SaveInteger(P,'H500','A1P8', 9)
	call SaveInteger(P,'Hjai','A1P8', 6)
	call SaveInteger(P,'Emoo','A1P8', 8)
	call SaveInteger(P,'N00B','A1P8', 3)
	call SaveInteger(P,'H00A','A1P8', 2)
	call SaveInteger(P,'Hblm','A1P8', 0)
	call SaveInteger(P,'Hmbr','A1P8', 20)
	call SaveInteger(P,'Emns','A1P8', 7)
	call SaveInteger(P,'N01A','A1P8', 1)
	call SaveInteger(P,'H004','A1P8', 2)
	call SaveInteger(P,'H00S','A1P8', 0)
	call SaveInteger(P,'N0MU','A1P8', 0)
	call SaveInteger(P,'N0EG','A1P8', 8)
	call SaveInteger(P,'E02J','A1P8', 2)
	call SaveInteger(P,'Hmkg','A1P8', 11)
	call SaveInteger(P,'H00K','A1P8', 0)
	call SaveInteger(P,'E00P','A1P8', 4)
	call SaveInteger(P,'Ntin','A1P8', 0)
	if GetRandomReal(0, 1)> .9 then
		call SaveInteger(P,'Ntin','A1P8', 13)
	endif
	call SaveInteger(P,'Orkn','A1P8', 0)
	call SaveInteger(P,'E02X','A1P8', 1)
	call SaveInteger(P,'H0DO','A1P8', 4)
	call SaveInteger(P,'NOMD','A1P8', 1)
	call SaveInteger(P,'Opgh','A1P8', 6)
	call SaveInteger(P,'U00A','A1P8', 7)
	call SaveInteger(P,'UC42','A1P8', 1)
	call SaveInteger(P,'U007','A1P8', 1)
	call SaveInteger(P,'Udea','A1P8', 0)
	call SaveInteger(P,'U008','A1P8', 2)
	call SaveInteger(P,'E015','A1P8', 2)
	call SaveInteger(P,'Udre','A1P8', 4)
	call SaveInteger(P,'N00R','A1P8', 3)
	call SaveInteger(P,'U00F','A1P8', 1)
	call SaveInteger(P,'NC00','A1P8', 2)
	call SaveInteger(P,'UC91','A1P8', 1)
	call SaveInteger(P,'H00R','A1P8', 1)
	call SaveInteger(P,'H07I','A1P8', 8)
	call SaveInteger(P,'Ofar','A1P8', 1)
	call SaveInteger(P,'UC11','A1P8', 3)
	call SaveInteger(P,'O00J','A1P8', 2)
	call SaveInteger(P,'U00K','A1P8', 1)
	call SaveInteger(P,'KODO','A1P8', 9)
	call SaveInteger(P,'Hvsh','A1P8', 3)
	call SaveInteger(P,'E004','A1P8', 4)
	call SaveInteger(P,'U006','A1P8', 1)
	call SaveInteger(P,'U000','A1P8', 13)
	call SaveInteger(P,'Ubal','A1P8', 2)
	call SaveInteger(P,'Ewar','A1P8', 2)
	call SaveInteger(P,'Nfir','A1P8', 2)
	call SaveInteger(P,'Eevi','A1P8', 7)
	call SaveInteger(P,'Eevm','A1P8', 14)
	call SaveInteger(P,'E02V','A1P8', 14)
	call SaveInteger(P,'E02W','A1P8', 14)
	call SaveInteger(P,'E02U','A1P8', 14)
	call SaveInteger(P,'E01B','A1P8', 1)
	call SaveInteger(P,'EC57','A1P8', 2)
	call SaveInteger(P,'EC77','A1P8', 5)
	call SaveInteger(P,'H00I','A1P8', 1)
	call SaveInteger(P,'E002','A1P8', 1)
	call SaveInteger(P,'H071','A1P8', 1)
	call SaveInteger(P,'EC45','A1P8', 0)
	call SaveInteger(P,'H00V','A1P8', 1)
	call SaveInteger(P,'N0MK','A1P8', 9)
	call SaveInteger(P,'Oshd','A1P8', 5)
	call SaveInteger(P,'H00N','A1P8', 2)
	call SaveInteger(P,'UC76','A1P8', 2)
	call SaveInteger(P,'UC18','A1P8', 0)
	call SaveInteger(P,'Uktl','A1P8', 2)
	call SaveInteger(P,'Ulic','A1P8', 4)
	call SaveInteger(P,'U00E','A1P8', 6)
	call SaveInteger(P,'H00H','A1P8', 3)
	call SaveInteger(P,'U00P','A1P8', 4)
	call SaveInteger(P,'UC01','A1P8', 7)
	call SaveInteger(P,'E01C','A1P8', 5)
	call SaveInteger(P,'E02H','A1P8', 2)
	call SaveInteger(P,'O016','A1P8', 3)
	call SaveInteger(P,'O017','A1P8', 3)
	call SaveInteger(P,'N01W','A1P8', 8)
	call SaveInteger(P,'H00U','A1P8', 2)
	call SaveInteger(P,'UC60','A1P8', 5)
	call SaveInteger(P,'Ekee','A1P8', 2)
	call SaveInteger(P,'E01A','A1P8', 8)
	call SaveInteger(P,'N0HP','A1P8', 9)
	call SaveInteger(P,'N0M7','A1P8', 3)
	call SaveInteger(P,'N0MB','A1P8', 3)
	call SaveInteger(P,'N0MC','A1P8', 3)
	call SaveInteger(P,'N0MO','A1P8', 3)
	call SaveInteger(P,'N0MA','A1P8', 3)
endfunction
function E7N takes integer WPV, integer T0V returns nothing
	call SaveInteger(L, WPV, 5, T0V)
endfunction
function E8N takes nothing returns nothing
	call E7N(VUV[1],'A1NR')
	call E7N(VUV[2],'A0PF')
	call E7N(VUV[3],'A1X2')
	call E7N(VUV[4], 0)
	call E7N(VUV[5],'A0Q9')
	call E7N(VUV[6], 0)
	call E7N(VUV[7], 0)
	call E7N(VUV[8],'A1OC')
	call E7N(VUV[9], 0)
	call E7N(VUV[CB], 0)
	call E7N(VUV[DB],'A0PC')
	call E7N(VUV[FB],'A1QL')
	call E7N(VUV[GB], 0)
	call E7N(VUV[HB], 0)
	call E7N(VUV[JB], 0)
	call E7N(VUV[16], 0)
	call E7N(VUV[17], 0)
	call E7N(VUV[18],'A0P9')
	call E7N(VUV[19], 0)
	call E7N(VUV[20],'A20M')
	call E7N(VUV[21], 0)
	call E7N(VUV[22], 0)
	call E7N(VUV[23],'A1R7')
	call E7N(VUV[24],'A20V')
	call E7N(VUV[25],'A1NQ')
	call E7N(VUV[26], 0)
	call E7N(VUV[27], 0)
	call E7N(VUV[28],'A0P8')
	call E7N(VUV[29], 0)
	call E7N(VUV[30], 0)
	call E7N(VUV[31], 0)
	call E7N(VUV[32], 0)
	call E7N(VUV[33], 0)
	call E7N(VUV[34], 0)
	call E7N(VUV[35], 0)
	call E7N(VUV[36], 0)
	call E7N(VUV[37],'A29E')
	call E7N(VUV[38],'A1VF')
	call E7N(VUV[39], 0)
	call E7N(VUV[40], 0)
	call E7N(VUV[41], 0)
	call E7N(VUV[42],'A1NS')
	call E7N(VUV[43], 0)
	call E7N(VUV[44],'A1RG')
	call E7N(VUV[45],'A220')
	call E7N(VUV[46], 0)
	call E7N(VUV[47], 0)
	call E7N(VUV[48],'A23E')
	call E7N(VUV[49], 0)
	call E7N(VUV[50], 0)
	call E7N(VUV[51], 0)
	call E7N(VUV[52], 0)
	call E7N(VUV[53], 0)
	call E7N(VUV[54], 0)
	call E7N(VUV[55], 0)
	call E7N(VUV[56], 0)
	call E7N(VUV[57], 0)
	call E7N(VUV[58], 0)
	call E7N(VUV[59], 0)
	call E7N(VUV[60], 0)
	call E7N(VUV[61], 0)
	call E7N(VUV[62], 0)
	call E7N(VUV[63], 0)
	call E7N(VUV[64], 0)
	call E7N(VUV[65], 0)
	call E7N(VUV[66], 0)
	call E7N(VUV[67],'A0P7')
	call E7N(VUV[68], 0)
	call E7N(VUV[69],'A1R3')
	call E7N(VUV[70], 0)
	call E7N(VUV[71], 0)
	call E7N(VUV[72], 0)
	call E7N(VUV[73],'A0PB')
	call E7N(VUV[74], 0)
	call E7N(VUV[75],'A1R8')
	call E7N(VUV[76],'A1R9')
	call E7N(VUV[77],'A1VB')
	call E7N(VUV[78],'A1VE')
	call E7N(VUV[79], 0)
	call E7N(VUV[80], 0)
	call E7N(VUV[81],'A1NX')
	call E7N(VUV[82],'A1V9')
	call E7N(VUV[83], 0)
	call E7N(VUV[84], 0)
	call E7N(VUV[85], 0)
	call E7N(VUV[86],'A1V5')
	call E7N(VUV[87],'A1VZ')
	call E7N(VUV[88],'A1UY')
	call E7N(VUV[89], 0)
	call E7N(VUV[90], 0)
	call E7N(VUV[91], 0)
	call E7N(VUV[92], 0)
	call E7N(VUV[93],'A21Z')
	call E7N(VUV[94], 0)
	call E7N(VUV[95], 0)
	call E7N(VUV[96], 0)
	call E7N(VUV[97], 0)
	call E7N(VUV[98], 0)
	call E7N(VUV[99], 0)
	call E7N(VUV[ 100 ], 0)
	call E7N(VUV['e'], 0)
	call E7N(VUV['f'],'A0PE')
	call E7N(VUV['g'], 0)
	call E7N(VUV['h'],'A0PA')
	call E7N(VUV['i'], 0)
	call E7N(VUV['j'], 0)
	call E7N(VUV['k'], 0)
	call E7N(VUV['l'], 0)
	call E7N(VUV['m'], 0)
	call E7N(VUV[110], 0)
	call E7N(VUV['o'], 0)
	call E7N(VUV['p'], 0)
	call E7N(VUV['q'], 0)
	call E7N(VUV[114], 0)
	call E7N(VUV[115], 0)
	call E7N(VUV[116], 0)
	call E7N(VUV['u'], 0)
	call E7N(VUV['v'], 0)
endfunction

function fj_Actions takes nothing returns boolean
	local trigger t = GetTriggeringTrigger()
	local unit u = GetTriggerUnit()
	if GetTriggerEventId()== EVENT_WIDGET_DEATH or GetTriggerEventId()== EVENT_GAME_TIMER_EXPIRED then
		call CleanCurrentTrigger(t)
	elseif GetTriggerEventId()== EVENT_UNIT_DAMAGED then
		if(EXGetEventDamageData(1) != 0) and GetUnitAbilityLevel(u,'A3W0')> 0 and GetEventDamage() > 1.00 then
			call AddAbilityToTimed(u,'A3W9', 1, 0.4,'B3W9')
		endif
	else
		if GetUnitAbilityLevel(u,'A3W0')> 0 then
			if GetIssuedOrderId()>= 852008 and GetIssuedOrderId()<= 852013 then
				call EXStopUnit(u)
				call InterfaceErrorForPlayer(GetOwningPlayer(u), "不能在锁闭状态下使用物品")
			endif
		endif
	endif
	set t = null
	set u = null
	return false
endfunction

function fj_exec takes nothing returns nothing
	local unit u = U2
	local unit u2 = W2
	local trigger t
	call RemoveUnitBuff(u2, true)
	if not IsUnitIllusion(u2) then
		set t = CreateTrigger()
		call AddAbilityToTimed(u2,'A3W0', 1, 6.0,'B3W0')
		call TriggerRegisterTimerEvent(t, 6.00, false)
		call TriggerRegisterDeathEvent(t, u2)
		call TriggerRegisterUnitEvent(t, u2, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(t, Condition(function fj_Actions))
		call TriggerRegisterUnitEvent(t, u2, EVENT_UNIT_ISSUED_ORDER)
		call TriggerRegisterUnitEvent(t, u2, EVENT_UNIT_ISSUED_TARGET_ORDER)
		call TriggerRegisterUnitEvent(t, u2, EVENT_UNIT_ISSUED_POINT_ORDER)
	endif
	set t = null
	set u = null
	set u2 = null
endfunction

function jys_calc takes integer team returns integer
	return 700 + jys_count[team]* 135
endfunction

function jys_changeDesc takes integer team returns nothing
	local string s = "使用后直接获得%d经验。再次使用将额外增加135点经验。|n|n|cFF99CCFF商店最大储量：|r 3|n|cFF99CCFF商店刷新时间：|r 10 分钟|n|n|cFF99CCFF开局后10分钟才可购买|r"
	if(team == 0 and IsSentinelsPlayer(LocalPlayer)) or(team == 1 and IsScourgesPlayer(LocalPlayer)) then
		set s = JUX(s, "%d", I2S(jys_calc(team)))
		call YDWESetItemDataString(RealItemTypeId[it_jys], 3, s)
		//set s = j5j(K1V[it_jys], 2)
		//set s = huh(s, jys_calc(team))
		//call ovk(K1V[it_jys], s)
		//set s = j5j(K2V[it_jys], 2)
		//set s = huh(s, jys_calc(team))
		//call ovk(K2V[it_jys], s)
	endif
endfunction

function jys_trigger takes nothing returns nothing
	local integer xp
	local unit u = GetTriggerUnit()
	local integer team
	local player p = GetOwningPlayer(u)
	if IsSentinelsPlayer(p) then
		set team = 0
	else
		set team = 1
	endif
	set xp = jys_calc(team)
	call RemoveUnitBEim(u)
	if IsUnitType(u, UNIT_TYPE_HERO) and not HeroIsDummyUnit(u) then
		call AddHeroXPSimple(u, xp, true)
	endif
	set jys_count[team]= jys_count[team]+ 1
	call jys_changeDesc(team)
	set u = null
endfunction

function fj_trigger takes nothing returns nothing
	local unit u = GetTriggerUnit()
	local unit u2 = GetSpellTargetUnit()
	call NHX(u, u2,'h0EO', "fj_exec", 5000, true)
	set u = null
	set u2 = null
endfunction


function PreloadKael_Ability takes nothing returns nothing
	local unit u = CreateUnit(Player(13), 'e00E', 0, 0, 0)
	//call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, GetObjectName('n06G'))
	call UnitAddAbility(u,'Z601') //阳炎冲击
	call UnitAddAbility(u,'Z602') //混沌陨石
	call UnitAddAbility(u,'Z603') //熔炉精灵
	call UnitAddAbility(u,'Z604') //急速冷却
	call UnitAddAbility(u,'Z605') //幽灵漫步
	call UnitAddAbility(u,'QFZZ') //幽灵漫步-退出
	call UnitAddAbility(u,'Z606') //寒冰之墙
	call UnitAddAbility(u,'Z607') //灵动迅捷
	call UnitAddAbility(u,'Z608') //强袭飓风
	call UnitAddAbility(u,'Z609') //电磁脉冲
	call UnitAddAbility(u,'Z610') //超震声波
	call RemoveUnit(u)
	set u = null
endfunction

function Preload_Ability takes nothing returns nothing
	
	local unit u = CreateUnit(Player(13), 'e00E', 0, 0, 0)
	//call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, "预读部分技能，会有略微卡顿。")
	call UnitAddAbility(u,'A0EY') //毁灭阴影Z
	call UnitAddAbility(u,'A0FH') //毁灭阴影X
	call UnitAddAbility(u,'A0F0') //毁灭阴影C
	
	call UnitAddAbility(u,'A08Q') //伤残恐惧夜晚
	call UnitAddAbility(u,'A08c') //伤残恐惧白天
	
	call UnitAddAbility(u,'A1C0') //分裂箭开启
	call UnitAddAbility(u,'A418') //分裂箭关闭
	
	call UnitAddAbility(u,'A10R') //吞噬
	call UnitAddAbility(u,'A10S') //吞噬-消化
	
	call UnitAddAbility(u,'A11N') //船长X标记
	call UnitAddAbility(u,'A13D') //返回X标记
	
	call UnitAddAbility(u,'A1A8') //先祖之魂
	call UnitAddAbility(u,'A21J') //先祖之魂 - 取消
	
	call UnitAddAbility(u,'A1NI') //不稳定化合物
	call UnitAddAbility(u,'A1NH') //不稳定化合物 - 取消
	
	call UnitAddAbility(u,'A1RJ') //凤凰冲击
	call UnitAddAbility(u,'A20N') //凤凰冲击 - 取消
	
	call UnitAddAbility(u,'A1YX') //烈火精灵
	call UnitAddAbility(u,'A1Z2') //烈火精灵 - 额外
	
	call UnitAddAbility(u,'A2E5') //锯齿飞轮
	call UnitAddAbility(u,'A43S') //锯齿飞轮 - A
	call UnitAddAbility(u,'A2FX') //锯齿飞轮 - 关闭
	call UnitAddAbility(u,'A2E6') //锯齿飞轮 - 关闭
	
	call UnitAddAbility(u,'A0R0') //黑暗之门
	call UnitAddAbility(u,'A2MB') //黑暗之门 - 取消
	
	call UnitAddAbility(u,'A0G8') //水人复制
	call UnitAddAbility(u,'A0GC') //水人复制 - 替换
	
	call UnitAddAbility(u,'A07U') //海妖之歌
	call UnitAddAbility(u,'A38E') //海妖之歌 - A
	call UnitAddAbility(u,'A24E') //海妖之歌 - 关闭
	
	call UnitAddAbility(u,'A1RA') //灵魂汲取 - 取消
	call UnitAddAbility(u,'A1PH') //灵魂汲取
	
	call UnitAddAbility(u,'A085') //启明
	call UnitAddAbility(u,'A121') //启明 - 发射
	
	call UnitAddAbility(u,'A04Y') //噩梦
	call UnitAddAbility(u,'A2O9') //噩梦 - 关闭
	
	call UnitAddAbility(u,'A21F') //脉冲新星
	call UnitAddAbility(u,'A21G') //脉冲新星 - A
	call UnitAddAbility(u,'A21H') //脉冲新星 - 关闭
	
	call UnitAddAbility(u,'A1MI') //冰晶爆轰
	call UnitAddAbility(u,'A2QE') //冰晶爆轰 - A
	call UnitAddAbility(u,'A1MN') //冰晶爆轰 - 发射
	
	
	call UnitAddAbility(u,'A2JO') //火之余烬 - 0-3
	call UnitAddAbility(u,'A2JQ') //火之余烬 - 1-3
	call UnitAddAbility(u,'A2JP') //火之余烬 - 2-3
	call UnitAddAbility(u,'A2JR') //火之余烬 - 3-3
	call UnitAddAbility(u,'A2JL') //火烬冲击 - 额外技能
	
	call RemoveUnit(u)
	set u = null
endfunction

function GetSeGlyphCd takes integer i returns real
	if i == 1 then
		return YDWEGetUnitAbilityState(Circle[GetPlayerId(Sentinels[1])], 'A141', 1)
	else
		return YDWEGetUnitAbilityState(Circle[GetPlayerId(Scourges[1])], 'A141', 1)
	endif
	return 0.
endfunction

function GetSeGlyphCdByUnit takes unit u returns real
	return YDWEGetUnitAbilityState(u, 'A141', 1)
endfunction

function Click_UI_Glyph_A takes nothing returns nothing
	local player p = DzGetTriggerKeyPlayer()
	if GetSeGlyphCdByUnit(Circle[GetPlayerId(p)]) == 0.00 then
		call DzSyncData("p", "1")
	endif
endfunction

function GetChat_times takes nothing returns boolean
	local integer i = 0
	local real time = GetGameTime()
	loop
		if Chat_times[i] == 0 then
			set Chat_times[i] = time
			return true
		elseif(time - Chat_times[i] ) > 10 then
			set Chat_times[i] = time
			return true
		endif
	exitwhen i == 5
		set i = i + 1
	endloop
	return false
endfunction

function Click_UI_Glyph takes nothing returns nothing
	local player p = DzGetTriggerKeyPlayer()
	if DzIsKeyDown(18) then
		if GetChat_times() then
			call DzSyncData("p", "0")
		endif
	else
		if GetSeGlyphCdByUnit(Circle[GetPlayerId(p)]) == 0.00 then
			call DzSyncData("p", "1")
		endif
	endif
endfunction

function Trig_SynsL takes player p, integer id returns nothing
	local unit u = Player__Hero[id]
	local integer i = GetHeroLevel(u)
	if IsPlayerAlly(LocalPlayer, p) or IsObserver then
		call EXDisplayChat(p, 1, "我还需要|c00FFFF00" + I2S(DzGetUnitNeededXP(u, i)-GetHeroXP(u))+ "|r点经验到达" + I2S(i + 1)+ "级")
	endif
	set u = null
endfunction

function Click_UI_HeroBarButton takes nothing returns nothing
	if DzIsKeyDown(18) and GetChat_times() then
		call DzSyncData("p", "2")
	endif
endfunction

function Trig_SynsO takes nothing returns nothing
	local player p = DzGetTriggerSyncPlayer()
	local integer id = GetPlayerId(p)
	if IsObserver then
		call EXDisplayChat(p, 2, "近卫军团防御符文冷却：" + R2S(GetSeGlyphCd(1)))
		call EXDisplayChat(p, 2, "天灾军团防御符文冷却：" + R2S(GetSeGlyphCd(2)))
	endif
endfunction


function Trig_SynsT takes nothing returns nothing
	local player p = DzGetTriggerSyncPlayer()
	if IsPlayerAlly(LocalPlayer, p) or IsObserver then
		call EXDisplayChat(p, 1, DzGetTriggerSyncData())
	endif
endfunction

function SetUp_SyncData takes nothing returns boolean
	local string s = DzGetTriggerSyncData()
    local integer data = S2I(s)
    local player p = DzGetTriggerSyncPlayer()
	local integer id = GetPlayerId(p)
	local boolean b
	if data == 1 then
		call Q_X(p, false)
	elseif data == 2 then
		call ShowAbilityCd_Actions(p, false)
	elseif data == 3 then
		call SetCharges(p)
	elseif data == 4 then //-si
		set GEV[id] = ( GXV[id] and SetUp_ItemInfo[id] ) //-ii
		set GXV[id] = not GXV[id] // -si
		set SetUp_SkillInfo[id] = GXV[id]
		if LocalPlayer == p then
			call GetSetUpText("多面板显示技能", GXV[id])
		endif
		//if SetUp_ItemInfo[id] then
		//	call GetSetUpText("多面板显示物品", false)
		//endif
	elseif data == 5 then //-ii
		set GXV[id] = ( GEV[id] and SetUp_SkillInfo[id] ) //-si
		set GEV[id] = not GEV[id] //-ii
		set SetUp_ItemInfo[id] = GEV[id]
		if LocalPlayer == p then
			call GetSetUpText("多面板显示物品", GEV[id])
		endif
		//if SetUp_SkillInfo[id] then
		//	call GetSetUpText("多面板显示技能", false)
		//endif
	elseif data == 7 then //自动选择召唤物
		if F_V[id] then
			set F_V[id]= false
			call DisplayTimedTextToPlayer(p, 0, 0, 5, GetObjectName('n0JZ'))
		else
			set F_V[id]= true
			call DisplayTimedTextToPlayer(p, 0, 0, 5, GetObjectName('n0K0'))
		endif
	elseif data == 8 then //自动装置神符
		if LocalPlayer == p then
			call GetSetUpText("自动装置神符", XI[id])
		endif
		set XI[id]= not XI[id]
	elseif data == 9 then //拒绝队友帮助技能
		set b = not LoadBoolean(HY, GetHandleId(p), $8B)
		call SaveBoolean(HY, GetHandleId(p), $8B, b)
		if LocalPlayer == p then
			call GetSetUpText(GetObjectName('n08O'), b)
		endif
	elseif data == 10 then
		call MUChangeMessengerShare(p) //共享信使 默认关闭
	elseif data == 11 then //特殊音效
		if T3[id] then
			if LocalPlayer == p then
				call GetSetUpText(GetObjectName('n08T'), T3[id])
			endif
		else
		set T3[id] = not T3[id]
		endif
	elseif data == 12 then
		if IsPlayerInForce(p, XY) then
			call ForceRemovePlayer(XY, p)
			if LocalPlayer == p then
				call GetSetUpText(GetObjectName('n08U'), true)
			endif
		else
			call ForceAddPlayer(XY, p)
			if LocalPlayer == p then
				call GetSetUpText(GetObjectName('n08U'), false)
			endif
		endif
	elseif data == 14 then
		set ZR[id]= not ZR[id]
		if LocalPlayer == p then
			call GetSetUpText("震动视角", ZR[id])
		endif
	elseif data == 15 then
		set EnableMapSetUp__ShowDamageTextTag[id] = not EnableMapSetUp__ShowDamageTextTag[id]
		if LocalPlayer == p then
			call GetSetUpText("显示伤害值", EnableMapSetUp__ShowDamageTextTag[id])
		endif
	elseif data == 17 then
		if LocalPlayer == p then
			call GetSetUpText("快速清理", CR[id]== 10.)
		endif
		if CR[id]== 1. then
			//call DisplayTimedTextToPlayer(p, 0, 0, 3, "|c00aeae00 快速清理关闭|r - 所有死亡信息持续显示10秒.")
			set CR[id]= 10.
		else
			//call DisplayTimedTextToPlayer(p, 0, 0, 3, "|c00fcfa00 快速清理开启|r - 所有死亡信息持续显示3秒.")
			set CR[id]= 1.
		endif
	elseif data == 18 then
		set b = LoadBoolean(K, GetHandleId(p),'UIds')
		//if b then
		//	call DisplayTimedTextToPlayer(p, 0, 0, 5, "|c00aeae00信使窗口开启|r")
		//else
		//	call DisplayTimedTextToPlayer(p, 0, 0, 5, "|c00fcfa00信使窗口关闭|r")
		//endif
		if LocalPlayer == p then
			call GetSetUpText("信使复活窗口", b)
		endif
		call SaveBoolean(K, GetHandleId(p),'UIds', not b)
	elseif data == 19 then
		set F4V[id] = not F4V[id]
		call GetSetUpText("复活计时器窗口", F4V[id])
	endif
    set p = null
    return false
endfunction


function UnitLP takes unit u, boolean b returns string
	local integer i = R2I(GetUnitLifePercent(u))
	local string s
	if b then
		set s = "|Cff00ff00"
	else
		set s = "|CFFFF0000"
	endif
	if i == 0 then
		set i = 1
	endif
	return s + I2S(i)+ "%生命|R和"
endfunction
function UnitMP takes unit u returns string
	local integer i = R2I(GetUnitManaPercent(u))
	if i == 0 then
		set i = 1
	endif
	return "|cff6495ed" + I2S(i)+ "%魔法|R"
endfunction


function ConvertHandleId2Unit takes integer i returns unit
	call SaveFogStateHandle(ConvertType, 0, 0, ConvertFogState(i))
	return LoadUnitHandle(ConvertType, 0, 0)
endfunction

function Trig_Synsp takes nothing returns nothing
	local player p = DzGetTriggerSyncPlayer()
	local integer id = GetPlayerId(p)
	local string s = DzGetTriggerSyncData()
	if s == "1" then
		call IssueImmediateOrderById(Circle[GetPlayerId(DzGetTriggerSyncPlayer())],$D0114)
	elseif s == "2" then
		call Trig_SynsL(p, id)
	elseif s == "0" then
		if IsSentinelsPlayer(p) then
			if IsPlayerAlly(LocalPlayer, p) or IsObserver then
				if GetSeGlyphCd(1) == 0.00 then
					call EXDisplayChat(p, 1, "防御符文 > 已准备就绪")
				else
					call EXDisplayChat(p, 1, "防御符文 > 冷却中 ( " + I2S(R2I(GetSeGlyphCd(1)))+ " )")
				endif
			endif
		elseif IsScourgesPlayer(p) then
			if IsPlayerAlly(LocalPlayer, p) or IsObserver then
				if GetSeGlyphCd(2) == 0.00 then
					call EXDisplayChat(p, 1, "防御符文 > 准备就绪。")
				else
					call EXDisplayChat(p, 1, "防御符文 > 冷却中 ( " + I2S(R2I(GetSeGlyphCd(2)))+ " )")
				endif
			endif
		endif
	endif
endfunction

function ChangeAbilityLearnHotKey takes player whichPlayer, integer abilityId, integer newKey returns nothing
    local ability hAbility = null
    local string sNewKey
    if abilityId == 0 then
        return
    endif

    call UnitAddAbility( PreloadeHero, abilityId )

    set hAbility = EXGetUnitAbility( PreloadeHero , abilityId )
    if hAbility == null then
        //call BJDebugMsg( "error,错误的技能 " + I2S(abilityId) )
        return
    endif
    if whichPlayer == LocalPlayer then
        // 设置快捷键
        if EXGetAbilityDataInteger( hAbility, 1, ABILITY_DATA_RESEARCH_HOTKEY ) != 0 then
            call EXSetAbilityDataInteger( hAbility, 1, ABILITY_DATA_RESEARCH_HOTKEY, newKey )

            // call BJDebugMsg( "改键成功" + GetObjectName(abilityId)+ " " + I2S(abilityId) + Key2Str(newKey) )

            call SaveInteger( LocalHashTable, abilityId, HotKeyStringHash, newKey )
            
            set sNewKey = Key2Str( newKey )

            // 修改文本
            if EXGetAbilityDataString( hAbility, 1, ABILITY_DATA_RESEARCH_TIP ) != "" then
                call EXSetAbilityDataString( hAbility, 1, ABILITY_DATA_RESEARCH_TIP, GetHeroSkillResearchTip(abilityId, sNewKey) )
            endif
        endif
    endif

    set hAbility = null
    call UnitRemoveAbility( PreloadeHero , abilityId )

endfunction

function SyncLeranSkillHotKeyActions takes nothing returns boolean
    local string syncData = DzGetTriggerSyncData()
    local player whichPlayer = Player(S2I(SubString(syncData, 0, 1)))
    local integer abilityId = YDWES2Id(SubString(syncData, 1, 5))
    local integer newKey = Str2Key(SubString(syncData, 5, 6))
    //call BJDebugMsg(syncData + GetObjectName(abilityId) + SubString(syncData, 1, 5) + " 为 " + SubString(syncData, 5, 6) )
    call ChangeAbilityLearnHotKey( whichPlayer, abilityId, newKey )
	set whichPlayer = null
    return false
endfunction

function SyncFogClickData takes nothing returns nothing
	local string data = DzGetTriggerSyncData()
	local integer pid1 = S2I(SubString(data, 0, 2))
	local integer pid2 = GetPlayerId(DzGetTriggerSyncPlayer())
	local boolean b = pid1 == pid2
	local unit u = ConvertHandleId2Unit(S2I( SubString(data, StringPos(data, "/")+1, StringLength(data)) ))
	local string time = SubString(data, StringPos(data, "*")+1, StringLength(data))

	if u != null and IsReplayMode then
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, "|c00ff0303可能的开图点击|r " + JS[pid1]+ VMV[pid1]+ "|r 点击了 " + GetUnitName(u) + "于 " + time )
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, "由于此信息可能误报或者被他人伪造，请自己根据主视野红圈和实际行动鉴别。")
		if pid2 != 0 and not b then
			call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, "可能是被伪造的信息。" + I2S(pid2))
		endif
		call PingMinimapEx(GetUnitX(u), GetUnitY(u), 6, 255, 0, 0, false)
	endif
	set u = null
endfunction

function InitSyncTrigger takes nothing returns nothing
	local trigger trig
	set trig = CreateTrigger()
	call DzTriggerRegisterSyncData(trig, "p", false)
	call TriggerAddAction(trig, function Trig_Synsp)
	set trig = CreateTrigger()
	call DzTriggerRegisterSyncData(trig, "t", false)
	call TriggerAddAction(trig, function Trig_SynsT)
	set trig = CreateTrigger()
	call DzTriggerRegisterSyncData(trig, "setup", false)
    call TriggerAddCondition(trig, Condition( function SetUp_SyncData))

	set trig = CreateTrigger()
	call DzTriggerRegisterSyncData(trig, "FogClick", false)
    call TriggerAddCondition(trig, Condition( function SyncFogClickData))

	
	// 同步学习技能快捷键
	set trig = CreateTrigger()
	call DzTriggerRegisterSyncData(trig, "SyncLeranSkillHotKey", false)
    call TriggerAddCondition(trig, Condition( function SyncLeranSkillHotKeyActions ))
	set trig = null
endfunction

function Click_LifeManaButton takes nothing returns nothing
	local unit u = GetPlayerSelectedUnit()
	local integer i = LocalId
	local player p
	if DzIsKeyDown(18) then
		if u != null and GetUnitAbilityLevel(u, 'AHer') > 0 then
			if IsUnitAlly(u, LocalPlayer) and IsUnitType(u, UNIT_TYPE_HERO) then
				if GetChat_times() then
					if u == Player__Hero[i] then 
						call DzSyncData("t", "我拥有" + UnitLP(u, true)+ UnitMP(u))
					else
						set p = GetOwningPlayer(u)
						call DzSyncData("t", "队友 " + JS[GetPlayerId(p)] + GetPlayerName(p) + "|r拥有" + UnitLP(u, true)+ UnitMP(u))
						set p = null
					endif
				endif
			else
				if GetChat_times() then
					call DzSyncData("p", "敌人" + JS[GetPlayerId(p)]+ GetPlayerName(p) + "|r拥有" + UnitLP(u, false)+ UnitMP(u))
				endif
			endif
		endif
	endif
	set u = null
endfunction


function tab0 takes nothing returns nothing
	if IsTabEnableMultiboard then
		call MultiboardMinimize(BJ_Multiboard, true)
	endif
endfunction
function tab1 takes nothing returns nothing
	if IsTabEnableMultiboard then
		if IsMultiboardMinimized(BJ_Multiboard) then
			call MultiboardMinimize(BJ_Multiboard, false)
		endif
	endif
endfunction

function ShowSetUpPanel takes boolean show returns nothing

	set IsSetUpUIEnable = show
	call DzFrameShow( UIFrame__SetUp, show )
	call DzFrameShow( UIFrame__MainPanel, not show)

endfunction

// 清除输入框的焦点 防止凯住
function ClearAllEditBoxFocus takes nothing returns nothing

endfunction

function ClickOrderSetUpSaveButton takes nothing returns nothing
    local string s = ""
    local integer i = 0
    local string dummy
	if DzFrameGetEnable(SetUpOKButton) then
		loop
			if UIFrame__IsCheckBoxEnable[i] then
				set dummy = "N"
			else
				set dummy = "O"
			endif
			set s = s + dummy
			exitwhen i == 23
			set i = i + 1
		endloop

		call ShowSetUpPanel(false)
		call DzClickFrame( DzFrameFindByName("PreviousButton", 0) )
		call DzFrameSetParent( UIFrame__ToolTip, GameUI )

		call DzAPI_Map_SaveServerValue(LocalPlayer, "setup", s)
		//call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, "|CFFFF8000[设置]|R |c006699CC复选框|r 已成功保存") 
		
		set i = 0
		set s = null
		loop
			if LocalCommandButtonHotKey[i] == 0 then
				set dummy = "0"
			else
				set dummy = Key2Str(LocalCommandButtonHotKey[i])
			endif
			set s = s + dummy
			exitwhen i == 23
			set i = i + 1
		endloop
		call DzAPI_Map_SaveServerValue(LocalPlayer, "hotkey", s)
		
		call DisplayTimedTextToPlayer(LocalPlayer, 0, 0, 10, "|CFFFF8000[设置]|R |c006699CC设置数据|r |cFF00FF00已上传|r") 
	endif
endfunction

// 点击 地图设置 按钮
function ClickMapSetUpButton__Script takes nothing returns nothing

	call DzClickFrame( DzFrameFindByName("EndGameButton", 0) )
	call DzFrameShow( UIFrame__MapSetUpBackdrop , true)
	call DzFrameShow( DzFrameFindByName("EndGamePanel", 0) , false)
	call ShowSetUpPanel(true)

	call DzFrameSetParent( UIFrame__ToolTip, DzFrameFindByName("MapOptionsPanel", 0) )
endfunction

// 点击地图选项返回按钮
function ClickMapSetUpReturnButton takes nothing returns nothing
	// 隐藏地图设置界面
	if DzFrameGetEnable(SetUpReturnButton) then
		call ClearAllEditBoxFocus()
		call ShowSetUpPanel(false)
		if DzGetTriggerKey() != 27 then
			call DzClickFrame( DzFrameFindByName("PreviousButton", 0) )
		endif

		call DzFrameSetParent( UIFrame__ToolTip, GameUI )
	endif
endfunction

function ClickMapSetUpResetButton takes nothing returns nothing
	local integer i = 0
	if DzFrameGetEnable(SetUpResetButton) then
		loop
		exitwhen i > MAX_HOTKEY_MENU_COUNT
			call DzFrameSetText(HotKeyMenuButtons[i], null)
			set LocalCommandButtonHotKey[i] = 0
			set i = i + 1
		endloop
	endif
endfunction

// 隐藏按钮的父级
function Click_OKButton_Script takes nothing returns nothing
	set UpdateLogIsShow = false
	call DzFrameShow( UIFrame__UpdateLog , false)
	if UIFrame__DebugLog != 0 then
		call DzFrameShow( UIFrame__DebugLog , false)
	endif
	//call DzFrameShow( DzFrameGetParent( DzGetTriggerUIEventFrame() ) , false)
endfunction

function Click_MenuMainButton_Script takes nothing returns nothing
    set bMenuMainPanelIsEnable = true
endfunction

function Click_MenuMainReturnButton_Script takes nothing returns nothing
    set bMenuMainPanelIsEnable = false
endfunction

function Click_Key_S takes nothing returns nothing
    if IsSetUpUIEnable then
        call DzClickFrame(UIFrame__Button[1])
    endif
endfunction

function Click_Key_R takes nothing returns nothing
    if IsSetUpUIEnable then
        call DzClickFrame(UIFrame__Button[2])
    endif
endfunction

function Click_SetUp_GlueCheckBox_Actions takes integer id returns nothing
	if id == 4 then//-ii 与si冲突
		call DzFrameSetEnable(UIFrame__CheckBox[5], not UIFrame__IsCheckBoxEnable[id])
		call DzSyncData("setup", "4")
	elseif id == 5 then//-si 与-ii冲突
		call DzFrameSetEnable(UIFrame__CheckBox[4], not UIFrame__IsCheckBoxEnable[id])
		call DzSyncData("setup", "5")
	elseif id == 16 then
		call SetUpDoubleClickSpellByCheckBox(UIFrame__IsCheckBoxEnable[id])
	elseif id == 20 then
        set IsTabEnableMultiboard = UIFrame__IsCheckBoxEnable[id]
		call GetSetUpText("Tab键开启多面板", UIFrame__IsCheckBoxEnable[id])
    elseif id == 21 then
        call DzEnableWideScreen(UIFrame__IsCheckBoxEnable[id])
		call GetSetUpText("宽屏模式", UIFrame__IsCheckBoxEnable[id])
	elseif id == 22 then
		call DzFrameSetEnable(UIFrame__CheckBox[23], UIFrame__IsCheckBoxEnable[id])
		set UseChangeHotKeySystem = UIFrame__IsCheckBoxEnable[id]
		call GetSetUpText("改键系统", UIFrame__IsCheckBoxEnable[id])
	elseif id == 23 then
		set ChangeHotkeyHeroOnly = UIFrame__IsCheckBoxEnable[id]
		call GetSetUpText("改键仅限英雄", UIFrame__IsCheckBoxEnable[id])
	elseif id == 24 then
		call UnitId("Config.showCoolDown = " + B2S(UIFrame__IsCheckBoxEnable[id]))
	elseif id == 25 then
		call UnitId("Config.showHotKey = " + B2S(UIFrame__IsCheckBoxEnable[id]))
	elseif id == 26 then
		call UnitId("Config.showManaCost = " + B2S(UIFrame__IsCheckBoxEnable[id]))
    else //这一类都是需要同步的
        call DzSyncData("setup", I2S(id))
    endif
endfunction

function GetLocalPlayerSetUp takes nothing returns nothing
    local string s
    local integer i = 0
    set ServerValue = DzAPI_Map_GetServerValue(LocalPlayer, "setup")
	set s = SubString(ServerValue, 0 , 1)
    if ServerValue == null or (s != "N" and s != "O") then
        return
    endif
	// call DisplayTimedTextToPlayer(LocalPlayer,0,0,60, ServerValue) 
    // call DisplayTimedTextToPlayer(LocalPlayer,0,0,60,"读取服务器数据")
    loop
        set s = SubString(ServerValue, i , i + 1)
        set UIFrame__IsCheckBoxEnable[i] = s == "N"
		if Default_SetUp[i] != UIFrame__IsCheckBoxEnable[i] then
			call Click_SetUp_GlueCheckBox_Actions(i)
			call DzFrameShow( UIFrame__HighLight[i], UIFrame__IsCheckBoxEnable[i] )
		endif
        exitwhen i == MAX_HOTKEY_MENU_COUNT
		set i = i + 1
    endloop
    set ServerValue = DzAPI_Map_GetServerValue(LocalPlayer, "hotkey")
	if ServerValue == null then
		return
    endif
	set i = 0
	loop
        set s = SubString(ServerValue, i , i + 1)
		if s != "0" then
			call DzFrameSetText(HotKeyMenuButtons[i], s )
			set LocalCommandButtonHotKey[i] = Str2Key(s)
		endif
        exitwhen i == 22
		set i = i + 1
    endloop
endfunction

//初始勾选的复选框回调
function Click_SetUp_GlueCheckBox_true takes nothing returns nothing
    //每次加载 连续创建的UI的间隔值不同,所以需要这样计算
    local integer id = R2I(((DzGetTriggerUIEventFrame() - FirstCheckBox) / Frame_X )) //得到UI的Id
    set UIFrame__IsCheckBoxEnable[id] = not UIFrame__IsCheckBoxEnable[id]
    call DzFrameShow( UIFrame__HighLight[id], UIFrame__IsCheckBoxEnable[id] )
	call Click_SetUp_GlueCheckBox_Actions(id)
endfunction

// 创建复选框 id为序号,xy的值是UI的绝对位置,b为是否初始勾选
function Create__CheckBox takes integer id, string tip, boolean b returns string
    local real x
    local real y
    //local string str = "QuestCheckBox" //默认的复选框模板,初始时不勾选
 
    if id > 10 then
        set x = CheckBox_WidthInitialValue + CheckBox_WidthSpacing
        set y = CheckBox_HeightInitialValue - CheckBox_HeightSpacing * (id - 11)
    else
        set x = CheckBox_WidthInitialValue
        set y = CheckBox_HeightInitialValue - CheckBox_HeightSpacing * id
    endif
    // 复选框,父UI为"地图设置"
    set UIFrame__CheckBox[id] = DzCreateFrameByTagName("GLUECHECKBOX", "name", UIFrame__OrderSetUp, "SetUp_CheckBox", id)
    call DzFrameSetAbsolutePoint( UIFrame__CheckBox[id], 4, x, y )
    //if ServerValue == "" then
    set UIFrame__IsCheckBoxEnable[id] = b
    //else
    //    set b = UIFrame__IsCheckBoxEnable[id]
    //endif
	set Default_SetUp[id] = b
    set UIFrame__HighLight[id] = DzCreateFrameByTagName("HIGHLIGHT", "name", UIFrame__CheckBox[id], "SetUp_CheckBox_Highlight", id)
    call DzFrameSetAllPoints( UIFrame__HighLight[id], UIFrame__CheckBox[id] )
    if not b then
        call DzFrameShow(UIFrame__HighLight[id], false)
    endif
    // 初始勾选的复选框回调与初始不勾选不同,需脚本来控制高亮模型隐藏/显示
    // 事件Id,  7是勾选复选框,8是取消勾选
    call DzFrameSetScriptByCode( UIFrame__CheckBox[id], 7, function Click_SetUp_GlueCheckBox_true, false)
    call DzFrameSetScriptByCode( UIFrame__CheckBox[id], 8, function Click_SetUp_GlueCheckBox_true, false)
    // 复选框注释
    set UIFrame__CheckBoxText[id] = DzCreateFrameByTagName("TEXT", "name", UIFrame__CheckBox[id], "CheckBox_Text", id)
    call DzFrameSetPoint( UIFrame__CheckBoxText[id], 3, UIFrame__CheckBox[id], 5, 0.005, 0.0 )
    call DzFrameSetText( UIFrame__CheckBoxText[id], tip)
	return tip
endfunction

function CreateTopMsgFrame takes nothing returns nothing
	local integer i = 1
	local integer TopMessage = DzFrameGetTopMessage()

	loop
		set UIFrame__Text[i] = DzCreateFrameByTagName("TEXT", "TopMsg"+I2S(i), GameUI, "TopMessageTextTemplate", 0)
    	call DzFrameSetPoint( UIFrame__Text[i], 1, TopMessage, 1, 0, -0.0053 + -0.0166 * i )
		//call DzFrameSetPriority( UIFrame__Text[i], -1 )
		//call DzFrameSetEnable( UIFrame__Text[i], false )
		call DzFrameShow(UIFrame__Text[i], false)
		exitwhen i == 6
		set i = i + 1
	endloop
	set UIFrame__TargetingError = DzCreateFrame("TargetingError", GameUI, 0)
    call DzFrameSetSize( UIFrame__TargetingError, 0.10, 0.10 )
	set UIText__TargetingError = DzFrameFindByName("TargetingErrorText", 0)
	
	call DzFrameSetText( UIText__TargetingError, null )
	call DzFrameSetAbsolutePoint( UIFrame__TargetingError, 4, 0.36, 0.175 )
	call DzFrameSetAbsolutePoint( UIText__TargetingError, 4, 0.36, 0.175 )
	call DzFrameShow( UIFrame__TargetingError , false )

endfunction

function ChangeUnitAbilityHotKey takes unit whichUnit, integer iabilityId, integer newKey returns nothing
    local ability hAbility = null
    local integer iHotKey
    local integer loop_Index
    local boolean isLearnSkill = false
    local string sNewKey
    if iabilityId == 0 then
        return
	elseif iabilityId == 'AHer' then
        set newKey = LocalCommandButtonHotKey[ChangeKeyLoopIndex + 12]
        if MessageAbilityOrder == 0 or MessageAbilityOrder == 852000 or newKey == 0 then
            //call BJDebugMsg("返回 " + GetObjectName(MessageAbilityOrder))
            return
        endif
        set isLearnSkill = true
        set iabilityId = MessageAbilityOrder
	elseif newKey == 0 then
		return
    endif
    set hAbility = EXGetUnitAbility(whichUnit, iabilityId)
    if hAbility == null then
        if isLearnSkill and LoadInteger(LocalHashTable, iabilityId, HotKeyStringHash) != newKey then
            //call BJDebugMsg("同步数据: " + GetObjectName(iabilityId) + " " + I2S(iabilityId) + Key2Str(newKey) + I2S(ChangeKeyLoopIndex))
            call DzSyncData("SyncLeranSkillHotKey", I2S(LocalId) + YDWEId2S(iabilityId) + Key2Str(newKey) )
        endif
        return
    endif
    if isLearnSkill then
        set iHotKey = EXGetAbilityDataInteger(hAbility, 1, ABILITY_DATA_RESEARCH_HOTKEY)
    else
        set iHotKey = EXGetAbilityDataInteger(hAbility, 1, ABILITY_DATA_HOTKEY)
    endif
    // 如果技能没快捷键 说明不必要改了
    if iHotKey == 0 or iHotKey == newKey then
        // ability属于handle 不知道有没有必要 保险起见
        set hAbility = null
        return
    endif

    // 使用快捷键
    if not isLearnSkill then

		// 修改快捷键 然后将哈希表内储存的改一下 否则双击快捷键施法就失效
        if EXSetAbilityDataInteger(hAbility, 1, ABILITY_DATA_HOTKEY, newKey) then
            if LoadBoolean(LocalHashTable, iabilityId, KEY_USE_DOUBLECLICK_SPELL) then
                set KeyCanDoubleClickSpell[iHotKey] = KeyCanDoubleClickSpell[iHotKey] - 1
                set KeyCanDoubleClickSpell[newKey] = KeyCanDoubleClickSpell[newKey] + 1
                call SaveInteger(LocalHashTable, iabilityId, HotKeyStringHash, newKey)
            endif
        endif
        // 关闭快捷键
        if EXGetAbilityDataInteger(hAbility, 1, ABILITY_DATA_UNHOTKEY) != 0 then
            call EXSetAbilityDataInteger(hAbility, 1, ABILITY_DATA_UNHOTKEY, newKey)
        endif

        set sNewKey = Key2Str(newKey)
        if EXGetAbilityDataString(hAbility, 2, ABILITY_DATA_TIP) != "" then
            call EXSetAbilityDataString(hAbility, 1, ABILITY_DATA_TIP, GetHeroSkillTip(iabilityId, sNewKey, 1) )
            call EXSetAbilityDataString(hAbility, 2, ABILITY_DATA_TIP, GetHeroSkillTip(iabilityId, sNewKey, 2) )
    
            set loop_Index = 3

            loop	
                exitwhen EXGetAbilityDataString(hAbility, loop_Index, ABILITY_DATA_TIP) == ""
				call EXSetAbilityDataString(hAbility, loop_Index, ABILITY_DATA_TIP, GetHeroSkillTip(iabilityId, sNewKey, loop_Index) )
                set loop_Index = loop_Index + 1
            endloop
        else
            call EXSetAbilityDataString(hAbility, 1, ABILITY_DATA_TIP, GetUnitAbilityTip(iabilityId, sNewKey) )
        endif

    endif
    
    if isLearnSkill and EXGetAbilityDataInteger(hAbility, 1, ABILITY_DATA_RESEARCH_HOTKEY) != 0 then
        // 学习快捷键
		call EXSetAbilityDataInteger(hAbility, 1, ABILITY_DATA_RESEARCH_HOTKEY, newKey)
		// 学习提示
        call EXSetAbilityDataString(hAbility, 1, ABILITY_DATA_RESEARCH_TIP, GetHeroSkillResearchTip(iabilityId, Key2Str(newKey)) )
    endif

    //call BJDebugMsg("改键成功" + GetObjectName(iabilityId)+ " " + I2S(iabilityId) + Key2Str(newKey))

    set hAbility = null
endfunction

// 刷新单位的快捷键
function RefreshUnitAbilityHotKey takes unit whichUnit returns nothing
    set ChangeKeyLoopIndex = 0
    loop
        if LocalCommandButtonHotKey[ChangeKeyLoopIndex] != 0 or LocalCommandButtonHotKey[ChangeKeyLoopIndex + 12] != 0 then
            call ChangeUnitAbilityHotKey(whichUnit, GetLocalAbilityId(LocalCommandX[ChangeKeyLoopIndex], LocalCommandY[ChangeKeyLoopIndex]), LocalCommandButtonHotKey[ChangeKeyLoopIndex])
        endif
        exitwhen ChangeKeyLoopIndex == 11
        set ChangeKeyLoopIndex = ChangeKeyLoopIndex + 1
    endloop
endfunction

//! import "Vjass\HotKeySystem.j"

function SetUnitStateTip takes unit whichUnit returns nothing
	local real attackSpeed			= GetUnitAttackSpeed(whichUnit)
	local real attackInterval 		= GetUnitState(whichUnit, UNIT_STATE_ATTACK1_INTERVAL)
	local real moveSpeed 			= GetUnitMoveSpeedEx(whichUnit)
	local real physicalResistance 	= 1. - GetUnitPhysicalResistance(whichUnit)
	local real mdagicResistance 	= GetUnitMagicResistance(whichUnit)
	local string tip		        = null

	if GetUnitAbilityLevel(whichUnit, 'Aatk') > 0 and attackInterval > 0. and attackSpeed > 0. then
		set attackInterval = attackInterval / attackSpeed
		set tip = "|cff999999攻击速度：|r" + I2S(R2I(attackSpeed * 100.)) + "(" + R2S(attackInterval) + "s)\n"
	endif

	if mdagicResistance != 0. and mdagicResistance != 1. then
		set mdagicResistance = 1. - mdagicResistance
	endif

	if moveSpeed > 0. then
		set tip = tip + "|cff999999移动速度：|r" + I2S(R2I(moveSpeed)) + "\n"
	endif
	// 护甲向上取整
	if physicalResistance - R2I(physicalResistance) > 0. then
		set tip = tip + "|cff999999物理抗性：|r" + I2S(R2I(physicalResistance * 100.) + 1) + "%"
	else
		set tip = tip + "|cff999999物理抗性：|r" + I2S(R2I(physicalResistance * 100.)) + "%"
	endif
	set tip = tip + "\n|cff999999魔法抗性：|r" + I2S(R2I(mdagicResistance * 100.)) + "%"

	call DzFrameSetText( UIText__ToolTip, "|cff999999单位属性：|r" )
	call DzFrameSetText( UIText__ToolUberTip, tip )
	call DzFrameShow( UIFrame__ToolTip, true )
endfunction

function ShowUnitStateTip takes nothing returns nothing
	local unit whichUnit = GetPlayerSelectedUnit()
	if whichUnit != null then
		call SetUnitStateTip(whichUnit)
	endif
	set whichUnit = null
	set IsShowUnitStateTip = true
	//call SingleDebug(tip)
endfunction

function HideUnitStateTip takes nothing returns nothing
	call DzFrameShow( UIFrame__ToolTip, false )
	set IsShowUnitStateTip = false
endfunction

function GetGameTimeStr takes nothing returns string
	local real r = GetGameTime()
	local integer m = R2I(r / 60 -1 / 2)
	local integer s = R2I(r - m * 60)
	local string data = I2S(m)+ ":" + I2S(s)
	return data 
endfunction

// 每帧回调函数
function cUpdateCallback takes nothing returns nothing
	local boolean b = DzIsKeyDown(18)
	local unit selectUnit = GetPlayerSelectedUnit()
	local integer h = GetHandleId(selectUnit)

	if LocalPlayerSelectUnitId != h then
		set LocalPlayerSelectUnitId = h
		
		// 玩家切换了当前选择的单位
		if IsShowUnitStateTip then
			if selectUnit == null then
				call DzFrameShow( UIFrame__ToolTip, false )
			else
				call SetUnitStateTip(selectUnit)
			endif
		endif
		if Mode__AntiHack then

			if selectUnit != null and GetUnitTypeId(selectUnit)!='hfoo' and IsUnitEnemy(selectUnit, LocalPlayer) and not IsUnitVisible(selectUnit, LocalPlayer) then
				call DzSyncData("FogClick", I2S(LocalId) + "/" +  I2S(h) + "*" + GetGameTimeStr() )
			endif
		endif
		// 改键
		if UseChangeHotKeySystem and ( not ChangeHotkeyHeroOnly or IsUnitType(selectUnit, UNIT_TYPE_HERO) ) then
			call RefreshUnitAbilityHotKey(selectUnit)
		endif
	elseif UseChangeHotKeySystem and UpdateCallbackCount > 60 and selectUnit != null then
		set UpdateCallbackCount = 0
		if ( not ChangeHotkeyHeroOnly or IsUnitType(selectUnit, UNIT_TYPE_HERO) ) then
			call RefreshUnitAbilityHotKey(selectUnit)
		endif
	else
		set UpdateCallbackCount = UpdateCallbackCount + 1
	endif
	set selectUnit = null
	
	if b != DownAlt then
		call AHC(b)
	endif
	if NewHotKey != 0 then
		call LocalChangeHotKeyActions(NewHotKey)
		set NewHotKey = 0
	endif
	// 模拟错误提示
	if InterfaceErrorHideTime > 0. and InterfaceErrorHideTime < GetGameTime( ) then
		set InterfaceErrorTextAlpha = R2I( 255 - 255 * ( ( GetGameTime( ) - InterfaceErrorHideTime ) / 3 ) )
		if InterfaceErrorTextAlpha <= 0 then
			call DzFrameSetAlpha( UIText__TargetingError, 255 )
			call DzFrameShow( UIFrame__TargetingError , false )
			set InterfaceErrorHideTime = 0
			set InterfaceErrorTextAlpha = 0
		else
			call DzFrameSetAlpha( UIText__TargetingError, InterfaceErrorTextAlpha )
		endif
	endif
endfunction

// 鼠标左键点击
function MouseLeftClick takes nothing returns nothing
	// call BJDebugMsg( "鼠标点击Frame:" + I2S( DzGetMouseFocus() ) + "  Name:" + DzFrameGetName( DzGetMouseFocus() ) )
	if DownAlt then
		if CommandBarButtonIndex == - 1 then
			return
		endif
		call SetStartLocPrioCount(CommandBarButtonIndex / 3 , ModuloInteger(CommandBarButtonIndex, 3))
		if DzIsKeyDown(18) and tip_string != null and tip_string != "" then
			if GetChat_times() then
				call DzSyncData("t", tip_string)
			endif
		endif
		set tip_string = null
	endif
endfunction

// 鼠标进入命令按钮
function Enter_UI_Ability_Button takes nothing returns nothing
	set CommandBarButtonIndex = (DzGetTriggerUIEventFrame() - FirstCommandBarButton)/ ButtonInterval
endfunction

// 鼠标离开命令按钮
function LeaveButton takes nothing returns nothing
	set CommandBarButtonIndex = - 1
endfunction

// 进行是否双击的判断 如果shift按住则强制ESC
function DoubleClickSkill takes nothing returns nothing
	local real CurrentTime = GetGameTime()
	if (CurrentTime - DoubleClickKeyTime) < 0.5 then
		set DoubleClickKey = 0
		set DoubleClickKeyTime = 0.
		call DzClickFrame(PortraitFrame)
		if DzIsKeyDown(16) then
			call ForceUICancel()
		endif
	else
		set DoubleClickKeyTime = GetGameTime()
	endif
endfunction

// https://www.hiveworkshop.com/threads/ui-originframes.316034/page-3
/*
call BlzFrameClick(BlzGetFrameByName("UpperButtonBarQuestsButton", 0))
call BlzFrameClick(BlzGetFrameByName("QuestAcceptButton", 0))

call BlzFrameSetSize(BlzGetFrameByName("QuestItemListContainer", 0), 0.01, 0.01)
call BlzFrameSetSize(BlzGetFrameByName("QuestItemListScrollBar", 0), 0.001, 0.001)
*/
function ClickQuestButton takes nothing returns nothing
	call DzFrameSetSize(DzFrameFindByName("QuestItemListContainer", 0), 0.01, 0.01)
	call DzFrameSetSize(DzFrameFindByName("QuestItemListScrollBar", 0), 0.001, 0.001)
	call DzFrameSetScriptByCode(DzSimpleFrameFindByName("UpperButtonBarQuestsButton", 0), FRAME_EVENT_PRESSED, null, false)
endfunction
// 按下ESC按键
function EnterKey___PushOther takes nothing returns nothing
	local integer key = DzGetTriggerKey()
	//call DzFrameShow( UIFrame__Text[1], false )
	// 回车
	if key == 13 then
		if UpdateLogIsShow then
			// 退出更新日志
			call DzClickFrame(UIButton__UpdateLogOK)
		elseif ChangingHotkey then
			// 退出选择热键
			call CancelChangeHotKey()
		endif
	elseif key == 27 then
		// 按下ESC
		if ChangingHotkey and IsSetUpUIEnable then
			// 退出选择热键
			call CancelChangeHotKey()
			call ClickMapSetUpReturnButton()
		elseif ChangingHotkey then
			call CancelChangeHotKey()
		elseif IsSetUpUIEnable then
			// 退出选择面板
			call ClickMapSetUpReturnButton()
		elseif bMenuMainPanelIsEnable then
			// 退出菜单
			set bMenuMainPanelIsEnable = false
		elseif UpdateLogIsShow then
			// 退出更新日志
			call DzClickFrame(UIButton__UpdateLogOK)
		endif
	elseif key == 115 then
		// 如果按下F4 的同时还按着Alt 说明玩家要直接退游戏 隐藏一下防止露馅
		if DzIsKeyDown(18) then
			call DzFrameShow( UIFrame__SetUp, false )
			call DzFrameShow( UIFrame__OrderSetUp, false )
			set IsSetUpUIEnable = false
			set bMenuGameplayPanelIsEnable = false
		endif
	elseif key == 120 then
		/*// F9
		if not IsClickF9QuestButton and not UpdateLogIsShow and not ChangingHotkey and not IsSetUpUIEnable then
			set NextFrameCallBack = "ClickQuestButton" 
		endif*/
	elseif key == 121 then
		// 按F10
		set bMenuMainPanelIsEnable = true
	endif
endfunction

// 按键按下
function EnterKey___PushKey takes nothing returns nothing
	local integer key = DzGetTriggerKey()
	local integer x = 0
	local integer abilityId
	if not KeyIsDown[key] then
		set KeyIsDown[key] = true
		// 如果在菜单界面
		if bMenuMainPanelIsEnable and key == 'C' and not IsSetUpUIEnable then
			call ClickMapSetUpButton__Script()
		elseif key == 'J' and DzIsKeyDown(18) then
			// 如果按下了J+Alt 可能是要开启防御符文
			call Click_UI_Glyph_A()
		elseif ChangingHotkey then
			// 更改热键 下一帧才会更新
			set NewHotKey = key
		elseif IsEnableDoubleClickSystem then
			if KeyCanDoubleClickSpell[key] > 0 then
				// 因为取消按键在右下角
				call GetLocalAbilityId(3, 2)
				if MessageAbilityOrder == 851979 then
					if DoubleClickKey == key then
						if (DoubleClickKeyTime != 0. ) then
							call DoubleClickSkill()
							return
						else
							set DoubleClickKeyTime = GetGameTime()
						endif
					else
						set DoubleClickKeyTime = 0.
					endif
				endif
				set abilityId = GetLocalAbilityId(0, 0)
				if LoadBoolean(LocalHashTable, abilityId, KEY_USE_DOUBLECLICK_SPELL) then
					if LoadInteger(LocalHashTable, abilityId, HotKeyStringHash) == key then
						set DoubleClickKey = key
						set DoubleClickKeyTime = GetGameTime()
						return
					endif
				else
					loop
						exitwhen x > 3
						set abilityId = GetLocalAbilityId(x, 2)
						if LoadBoolean(LocalHashTable, abilityId, KEY_USE_DOUBLECLICK_SPELL) then
							if LoadInteger(LocalHashTable, abilityId, HotKeyStringHash) == key then
								set DoubleClickKey = key
								set DoubleClickKeyTime = GetGameTime()
								return
							endif
						endif
						set abilityId = GetLocalAbilityId(x, 1)
						if LoadBoolean(LocalHashTable, abilityId, KEY_USE_DOUBLECLICK_SPELL) then
							if LoadInteger(LocalHashTable, abilityId, HotKeyStringHash) == key then
								set DoubleClickKey = key
								set DoubleClickKeyTime = GetGameTime()
								return
							endif
						endif
						set x = x + 1
					endloop
				endif
			endif
		endif
	endif
endfunction

// 按键弹起
function EnterKey___PoolKey takes nothing returns nothing
	local integer key = DzGetTriggerKey()
	if KeyIsDown[key] then
		set KeyIsDown[key] = false
	endif
endfunction

// 将技能设置为可双击施法
function AddDoubleClickSkillID takes integer iSkillId returns nothing
	local string sHotKey = LoadStr(Q, iSkillId, HotKeyStringHash)
	local integer iHotKey
	// 因为没有可靠的记录技能快捷键 所以还是从slk里面读
	if sHotKey == null then
		set sHotKey = GetObjectDataBySlk(iSkillId, "ability", "HotKey")
	endif
	set sHotKey = StringCase(sHotKey, true)
	set iHotKey = Str2Key(sHotKey)
	set KeyCanDoubleClickSpell[iHotKey] = KeyCanDoubleClickSpell[iHotKey] + 1
	call SaveBoolean(LocalHashTable, iSkillId, KEY_USE_DOUBLECLICK_SPELL, true)
	call SaveInteger(LocalHashTable, iSkillId, HotKeyStringHash, iHotKey)
endfunction

// 初始化技能双击施法
function DoubleClickSkill__Init takes nothing returns nothing
	// 这里直接复制高版本偷懒 - - 不自己找了
	// 模拟的应该差不多
	call AddDoubleClickSkillID('A11N')//X标记
	call AddDoubleClickSkillID('A08V')//全能魔免
	call AddDoubleClickSkillID('A08N')//全能加血
	call AddDoubleClickSkillID('A2ML')//大树护甲
	call AddDoubleClickSkillID('A0QP')//神灵活血术
	call AddDoubleClickSkillID('A2J2')//军团加血
	call AddDoubleClickSkillID('A0MF')//死骑套子
	call AddDoubleClickSkillID('A037')//猛犸授予力量
	call AddDoubleClickSkillID('A047')//剑圣棒子
	call AddDoubleClickSkillID('A44X')//血魔d
	call AddDoubleClickSkillID('A3DM')//A杖蚂蚁大
	call AddDoubleClickSkillID('A0N8')//地卜师忽悠
	call AddDoubleClickSkillID('A112')//光法加魔
	call AddDoubleClickSkillID('A21E')//先知发芽
	call AddDoubleClickSkillID('A0QG')//兔子套子
	call AddDoubleClickSkillID('A0R7')//兔子加速
	call AddDoubleClickSkillID('A08R')//巫妖冰甲
	call AddDoubleClickSkillID('A2TD')//骨法虚无
	call AddDoubleClickSkillID('A0OJ')//黑鸟t
	call AddDoubleClickSkillID('A0AS')//术士暗言术
	call AddDoubleClickSkillID('A1S8')//毒狗关人
	call AddDoubleClickSkillID('A10L')//薄葬
	call AddDoubleClickSkillID('A0OR')//暗牧加血
	call AddDoubleClickSkillID('Z607')//灵动迅捷
	call AddDoubleClickSkillID('A2LB')//冰龙加血
	call AddDoubleClickSkillID('A01Z')//大自然的掩护
	call AddDoubleClickSkillID('A0AS')//暗言术
	call AddDoubleClickSkillID('A2T5')//命运敕令
	call AddDoubleClickSkillID('A2SG')//涤罪之焰
	call AddDoubleClickSkillID('A2TF')//虚妄诺言
	call AddDoubleClickSkillID('A0G8')//复制
	call AddDoubleClickSkillID('A04Y')//噩梦
	call AddDoubleClickSkillID('A00U')//月蚀
	call AddDoubleClickSkillID('A43H')//超新星
	call AddDoubleClickSkillID('A083')//嗜血术
	call AddDoubleClickSkillID('A06B')//自爆
	call AddDoubleClickSkillID('A471')//A杖自爆
endfunction


function GetFrameToolTipStr takes integer frame, integer typeId returns string
	return LoadStr( LocalHashTable, frame, typeId )
endfunction

function FrameToolTip__MouseEnter takes nothing returns nothing
	local integer frame = DzGetTriggerUIEventFrame()
	call DzFrameShow( UIFrame__ToolTip, true )
	call DzFrameSetText( UIText__ToolTip, GetFrameToolTipStr( frame, HTKEY_UI_TOOLTIP_STR ) )
	call DzFrameSetText( UIText__ToolUberTip, GetFrameToolTipStr( frame, HTKEY_UI_TOOLTIP_UBERSTR ) )
endfunction

function FrameToolTip__MouseLeave takes nothing returns nothing
	call DzFrameShow( UIFrame__ToolTip, false )
endfunction

// 给Frame添加工具提示
function SetFrameToolTip takes integer frame, string tip, string uberTip returns nothing
	call SaveStr( LocalHashTable, frame, HTKEY_UI_TOOLTIP_STR, tip )
	call SaveStr( LocalHashTable, frame, HTKEY_UI_TOOLTIP_UBERSTR, uberTip )
	call DzFrameSetScriptByCode( frame, 2, function FrameToolTip__MouseEnter, false )
	call DzFrameSetScriptByCode( frame, 3, function FrameToolTip__MouseLeave, false )
endfunction

globals

	// 菜单设置的UI
	integer 					UIFrame__MapSetUpBackdrop
	integer 					UIFrame__MainPanel //主菜单
	integer 					UIFrame__ReturnButton //主菜单返回按钮
	// 地图设置框架
	integer 					UIFrame__SetUp
	integer						SetUpReturnButton
	integer						SetUpOKButton
	integer 					SetUpResetButton
	// 命令设置框架
	integer 					UIFrame__OrderSetUp
	integer 		array 		UIFrame__Button //按钮
	integer 		array 		UIFrame__HighLight //复选框高亮
	integer 		array 		UIFrame__CheckBox //复选框
	integer 		array 		UIFrame__Text // 文本
	integer 		array 		UIFrame__CheckBoxText //复选框文本
	boolean 		array 		UIFrame__IsCheckBoxEnable //复选框是否勾选
	integer 					FirstCheckBox
	integer 					GameUI // 等价于DzGetGameUI()
	integer 					Frame_X //连续创建Frame的间隔值
	boolean 					IsSetUpUIEnable = false
	// 复选框长宽初始值
	constant		real 		CheckBox_WidthInitialValue = 0.150
	constant		real 		CheckBox_HeightInitialValue = 0.490
	// 复选框长宽间值
	constant		real 		CheckBox_WidthSpacing = 0.115
	constant		real 		CheckBox_HeightSpacing = 0.024
	// 服务器值
	string 						ServerValue = ""
	// 各种选项的布尔值
	boolean 					IsTabEnableMultiboard = false //Tab键是否启用多面板,异步
	boolean 		array 		SetUp_SkillInfo
	boolean 		array 		SetUp_ItemInfo
	boolean 		array 		Default_SetUp

	boolean						IsShowUnitStateTip = false

endglobals

function InitMainUI takes nothing returns nothing
 	// 实际上应该为常量,但无法在全局变量中声明
	set GameUI = DzGetGameUI()
	set PortraitFrame = DzFrameGetPortrait()
	set IsReplayMode = DzSimpleFrameFindByName("SimpleReplayPanel", 0) != 0
	// 加载toc fdf模板
	call DzLoadToc("UI\\path.toc")
	//======================================================================
	// 防御符文按钮
	set GlyphFrame = DzCreateFrameByTagName("TEXTBUTTON", "name", GameUI, "Glyph_Button", 0)
	call DzFrameSetPoint(GlyphFrame, 4, DzFrameGetMinimap(), 4, 0.087, -0.061)
	// 按钮提示
	//set GlyphFrame_tip = DzCreateFrameByTagName("BACKDROP", "Tooltip", GameUI, "Demo_BorderBack", 0)
	//set GlyphFrame_tip_text = DzCreateFrameByTagName("TEXT", "text", GlyphFrame_tip, null, 0)
	//call DzFrameSetText(GlyphFrame_tip_text, "激活 防御符文(|cffffcc00Alt-J|r)\n在5秒内，使你方阵营所有的建筑物对物理攻击免疫。|n|n|cff99ccff团队冷却时间：|r5分钟")
	call SetFrameToolTip( GlyphFrame, "激活 防御符文(|cffffcc00Alt-J|r)", "在5秒内，使你方阵营所有的建筑物对物理攻击免疫。|n|n|cff99ccff团队冷却时间：|r5分钟" )
	//call DzFrameSetParent(GlyphFrame, DzFrameGetMinimap() )
	//======================================================================
	// 创建顶部消息栏 击杀信息
	call CreateTopMsgFrame() 
	//======================================================================
	// 创建底部信息提示栏 错误提示
	if GAY_BETA_VERSION then
		call CreateDebugLogUI()
	endif
	//======================================================================
	// 更新日志
	set UIFrame__UpdateLog = DzCreateFrame( "UpdateLogDialog" , GameUI, 0 )
	call DzFrameSetAbsolutePoint( UIFrame__UpdateLog, 4, 0.4, 0.35 )
	call DzFrameSetText(DzFrameFindByName("UpdateLogArea", 0), UpdateLogStr)
	set UIButton__UpdateLogOK = DzFrameFindByName("UpdateLogOkButton", 0)
	call DzFrameSetScriptByCode( UIButton__UpdateLogOK, 1, function Click_OKButton_Script, false)
	call DzFrameShow( UIFrame__UpdateLog, false )
	//======================================================================
	
	//======================================================================
	// 地图设置
	set UIFrame__MainPanel = DzFrameFindByName("MainPanel", 0) // 主菜单
    set UIFrame__ReturnButton = DzFrameFindByName("ReturnButton", 0) // 主菜单返回按钮
    // UIFrame__SetUp做为父级UI,初始隐藏,隐藏UIFrame__SetUp时,子级UI会一起被隐藏

    set UIFrame__SetUp = DzCreateFrame( "EscMenuMapOptionsPanel" , DzFrameFindByName("EscMenuMainPanel", 0), 0 )
	call DzFrameSetAbsolutePoint( UIFrame__SetUp, 4, 0.4, 0.3 )

	set UIFrame__Text[10] = DzCreateFrameByTagName("TEXT", null, UIFrame__SetUp, "SetUpPanelTitleText", 0)
    call DzFrameSetPoint( UIFrame__Text[10], 4, UIFrame__SetUp, 4, 0.14, 0.185 )
    call DzFrameSetText( UIFrame__Text[10], "使用技能按键")
	set UIFrame__Text[10] = DzCreateFrameByTagName("TEXT", null, UIFrame__SetUp, "SetUpPanelTitleText", 0)
    call DzFrameSetPoint( UIFrame__Text[10], 4, UIFrame__SetUp, 4, 0.14, 0.065 )
    call DzFrameSetText( UIFrame__Text[10], "学习技能按键")

	call DzFrameShow( UIFrame__SetUp, false )
	call DzFrameShow( UIFrame__SetUp, true )
	call DzFrameShow( UIFrame__SetUp, false )
	call DzFrameSetPriority( UIFrame__SetUp ,  50 )
	// 设置优先级 防止被背景挡住
	call DzFrameSetPriority( DzFrameFindByName("MapOptionsPanel", 0) ,  1 )

	set UIFrame__MapSetUpBackdrop = DzCreateFrame( "EscMenuMapSetUpBackdrop", UIFrame__SetUp, 0 )
	call DzFrameSetAbsolutePoint( UIFrame__MapSetUpBackdrop, 4, 0.4, 0.363 )
	call DzFrameShow( UIFrame__MapSetUpBackdrop, false )

	set UIFrame__OrderSetUp = DzCreateFrameByTagName("FRAME", null, UIFrame__SetUp, null, 0)
	// 初始化改键UI
	call InitHotKeyMenuFrame()
	// 点击命令设置按钮
	// 设置按钮,点击后会弹出UIFrame__SetUp
	set	SetUpReturnButton	= DzFrameFindByName("MapSetUpReturnButton", 0)
	set	SetUpOKButton		= DzFrameFindByName("MapSetUpOKButton", 0)
	set SetUpResetButton	= DzFrameFindByName("MapSetUpResetButton", 0)

	set UIFrame__Button[0] = DzCreateFrame("MapSetUpButton", DzFrameFindByName("InsideMainPanel", 0), 0)
	// 点击 地图设置(C)
    call DzFrameSetScriptByCode(PortraitFrame, FRAME_MOUSE_ENTER, function ShowUnitStateTip, false)
	call DzFrameSetScriptByCode(PortraitFrame, FRAME_MOUSE_LEAVE, function HideUnitStateTip, false)
	
	// 点击 地图设置(C)
    call DzFrameSetScriptByCode( UIFrame__Button[0], FRAME_EVENT_PRESSED, function ClickMapSetUpButton__Script, false)
	// 点击 菜单按钮
	call DzFrameSetScriptByCode( DzSimpleFrameFindByName("UpperButtonBarMenuButton", 0), FRAME_EVENT_PRESSED, function Click_MenuMainButton_Script, false)
	// 返回按钮
	call DzFrameSetScriptByCode( SetUpReturnButton, FRAME_EVENT_PRESSED, function ClickMapSetUpReturnButton, false)
	// 重置按钮
	call DzFrameSetScriptByCode( SetUpResetButton, FRAME_EVENT_PRESSED, function ClickMapSetUpResetButton, false)
	// 确定按钮
    call DzFrameSetScriptByCode( SetUpOKButton, FRAME_EVENT_PRESSED, function ClickOrderSetUpSaveButton, false)
	// 捕捉点击菜单的返回按钮
    call DzFrameSetScriptByCode( UIFrame__ReturnButton, FRAME_EVENT_PRESSED, function Click_MenuMainReturnButton_Script, false)


	//======================================================================
	// 工具提示
	set UIFrame__ToolTip = DzCreateFrameByTagName("FRAME", null, GameUI, null, 0)
	set UIBackDrop__ToolTip = DzCreateFrameByTagName("BACKDROP", null, UIFrame__ToolTip, "TooltipBackDrop", 0)
	set UIText__ToolTip = DzCreateFrameByTagName("TEXT", null, UIBackDrop__ToolTip, "TooltipText", 0)
	set UIText__ToolUberTip = DzCreateFrameByTagName("TEXT", null, UIBackDrop__ToolTip, "TooltipText", 0)
	//call DzFrameSetSize(UIBackDrop__ToolTip, 0.209, 0)
	call DzFrameSetSize(UIText__ToolTip, 0.209, 0)
	call DzFrameSetSize(UIText__ToolUberTip, 0.209, 0)
	// 设置"提示背景"的左上为"提示"的左上
	call DzFrameSetPoint(UIBackDrop__ToolTip, 0, UIText__ToolTip, 0, - 0.005, 0.005)
	// 设置"提示"的底部为"扩展提示"的顶部
	call DzFrameSetPoint(UIText__ToolTip, 6, UIText__ToolUberTip, 0, 0, 0.005)
	// 设置"提示背景"的右下为"扩展提示"的右下
	call DzFrameSetPoint(UIBackDrop__ToolTip, 8, UIText__ToolUberTip, 8, 0.005, - 0.005)
	call DzFrameSetAbsolutePoint(UIText__ToolUberTip, 8, 0.7935, 0.168)

	call DzFrameShow( UIFrame__ToolTip, false )
	call DzFrameSetPriority( UIFrame__ToolTip ,  100 )
	//======================================================================
	// 捕捉点击血条的按钮
	call DzCreateSimpleFrame("StateButtonFrame", DzSimpleFrameFindByName("ConsoleUI", 0), 0)
	set UIFrame__Button[3] = DzSimpleFrameFindByName("StateButton", 0)
	call DzFrameSetAbsolutePoint( UIFrame__Button[3], 0, 0.214, 0.03 )
    call DzFrameSetAbsolutePoint( UIFrame__Button[3], 8, 0.292, 0.002 )
	call DzFrameSetScriptByCode( UIFrame__Button[3], FRAME_EVENT_PRESSED, function Click_LifeManaButton, false)
	//======================================================================
	// 创建复选框
    call Create__CheckBox(0, "右键反补", false) //null
	call SetFrameToolTip( UIFrame__CheckBox[0], "右键反补", "?" )
    set FirstCheckBox = UIFrame__CheckBox[0]
    call Create__CheckBox(1, "隐藏被动", false)  //-sp
	call SetFrameToolTip( UIFrame__CheckBox[1], "隐藏被动", "隐藏大部分被动技能，不包括有冷却时间的技能。" )
    set Frame_X = UIFrame__CheckBox[1] - UIFrame__CheckBox[0]
    call Create__CheckBox(2, "隐藏有冷却被动", false) //-spcd
	call SetFrameToolTip( UIFrame__CheckBox[2], "隐藏有冷却被动", "隐藏有冷却的被动技能，不包括|CFFFF8000重生|r和|CFFFF8000连击|r。" )
    call Create__CheckBox(3, "多面板显示充能", true) //-charges
	call SetFrameToolTip( UIFrame__CheckBox[3], "多面板显示充能", "在右上角多面板显示一些技能的充能和冷却情况。" )
    call Create__CheckBox(4, "多面板显示技能", false) //-si
	call SetFrameToolTip( UIFrame__CheckBox[4], "多面板显示技能", "在右上角多面板显示选择的技能，与显示物品冲突。" )
    call Create__CheckBox(5, "多面板显示物品", false) //-ii
	call SetFrameToolTip( UIFrame__CheckBox[5], "多面板显示物品", "在右上角多面板显示选择的技能，与显示技能冲突。" )
    call Create__CheckBox(6, "自动攻击", false) //null
	call SetFrameToolTip( UIFrame__CheckBox[6], "自动攻击", "?" )
    call Create__CheckBox(7, "自动选择召唤物", true) //-disableselection/-ds 和 -enableselection/-es
	call SetFrameToolTip( UIFrame__CheckBox[7], "自动选择召唤物", "开启后使用召唤类技能(包括镜像)将会自动选取被召唤单位。" )
	call Create__CheckBox(8, "自动装置神符", true) //-orp
	call SetFrameToolTip( UIFrame__CheckBox[8], "自动装置神符", "右键点击|cffff0000神符|r时|c0000FF00会|r把神符装入瓶中" )
    call Create__CheckBox(9, "禁用帮助技能", false) //-disablehelp 和 -enablehelp
	call SetFrameToolTip( UIFrame__CheckBox[9], "禁用帮助技能", "禁止友军对你使用帮助技能，例如|CFFFF8000忠诚考验|r和|CFFFF8000X标记|r。" )
    call Create__CheckBox(10, "共享信使", false) // 无指令,能量圈中使用
	call SetFrameToolTip( UIFrame__CheckBox[10], "共享信使", "将你的信使更改为队伍公用，不必向友军开启共享单位。" )
    call Create__CheckBox(11, "关闭特殊音效", true) //-mute
	call SetFrameToolTip( UIFrame__CheckBox[11], "特殊音效", "关闭后不会播放大部分音效，例如击杀，连杀音效。" )
    call Create__CheckBox(12, "隐藏系统信息", false) //-showmsg 和 -hidemsg
	call SetFrameToolTip( UIFrame__CheckBox[12], "隐藏系统信息", "开启后不再显示系统信息，例如击杀消息，重要提示等。" )
    call Create__CheckBox(13, "镜头置中", false) //null
    call Create__CheckBox(14, "震动视角", false) //-shaking
	call SetFrameToolTip( UIFrame__CheckBox[14], "震动视角", "目前只有在单人模式下才可使用，挨打会让屏幕震动。" )
    call Create__CheckBox(15, "显示伤害值", false) //-sddon 和 -sddoff
	call SetFrameToolTip( UIFrame__CheckBox[15], "显示伤害值", "目前只有在单人模式下才可使用，一般用于测试。" )
    call Create__CheckBox(16, "双击对己施法", false) // -dch
	call SetFrameToolTip( UIFrame__CheckBox[16], "双击对己施法", "开启后双击技能快捷键将对自己释放技能。需要注意必须是游戏内的快捷键，平台修改的快捷键地图并不会知道。" )
    call Create__CheckBox(17, "快速清理阵亡消息", false) //-fc
	call SetFrameToolTip( UIFrame__CheckBox[17], "快速清理阵亡消息", "开启后，死亡信息持续显示1秒，关闭则10秒。" )
    call Create__CheckBox(18, "开启信使阵亡窗口", true) //-ui
	call SetFrameToolTip( UIFrame__CheckBox[18], "开启信使阵亡窗口", "开启将显示信使阵亡窗口，关闭则会显示信使当前活动情况。" )
    call Create__CheckBox(19, "等待复活计时窗口", true) //-deathon/-don 和 -doff/-deathoff
	call SetFrameToolTip( UIFrame__CheckBox[19], "等待复活计时窗口", "死后的复活计时窗口。" )
    call Create__CheckBox(20, "Tab键开启多面板", false) //无指令
	call SetFrameToolTip( UIFrame__CheckBox[20], "Tab键开启多面板", "开启后按住Tab键会显示多面板，松开则取消显示。" )
    call Create__CheckBox(21, "宽屏模式", false) //无指令
	call SetFrameToolTip( UIFrame__CheckBox[21], "宽屏模式", "顾名思义。" )
	call Create__CheckBox(22, "改键系统", false) //无指令
	call SetFrameToolTip( UIFrame__CheckBox[22], "改键系统", "如果你有同时使用平台改键的话，那么我建议你两边设置都相同。此系统有略微延迟，学习技能后重新选择单位可能有所改善。不建议喜欢使用原生按键的玩家开启此项。" )
	call Create__CheckBox(23, "改键仅限英雄", true) //无指令
	call SetFrameToolTip( UIFrame__CheckBox[23], "改键仅限英雄", "开启后仅会更改英雄单位的快捷键。" )
	call DzFrameSetAbsolutePoint( UIFrame__CheckBox[22], 4, 0.4, 0.424 )
	call DzFrameSetAbsolutePoint( UIFrame__CheckBox[23], 4, 0.4, 0.4 )

	call Create__CheckBox(24, "技能冷却显示", true) //无指令
	call SetFrameToolTip( UIFrame__CheckBox[24], "技能冷却显示", "在右下角命令面板中显示技能剩余冷却时间。" )
	call Create__CheckBox(25, "技能热键显示", false) //无指令
	call SetFrameToolTip( UIFrame__CheckBox[25], "技能热键显示", "在右下角命令面板中显示技能快捷键。" )
	call Create__CheckBox(26, "技能消耗显示", false) //无指令
	call SetFrameToolTip( UIFrame__CheckBox[26], "技能消耗显示", "在右下角命令面板中显示技能魔法消耗。" )
	// 一些不可用的
	call DzFrameSetEnable( UIFrame__CheckBox[0], false )
	call DzFrameSetEnable( UIFrame__CheckBox[6], false )
	call DzFrameSetEnable( UIFrame__CheckBox[13], false )
	call DzFrameSetEnable( UIFrame__CheckBox[23], false )
	//======================================================================

endfunction

function Init_ExtraTriggers takes nothing returns nothing
	local integer i
	local integer x
	local integer y
	local trigger t
	local integer hTempFrame

	// 设置不能被改变cd的技能
	call SetSkillDisableRefreshCoolDown('QP17') // 反击螺旋
	call SetSkillDisableRefreshCoolDown('A3TZ') // 碎颅锤
	call SetSkillDisableRefreshCoolDown('QP08') // 永久隐身
	// 初始化UI
	call InitMainUI()
	// 初始化同步触发器
	call InitSyncTrigger()

	// 和谐资源栏
	set i = 0
	loop
		exitwhen i > 11
		//call DzFrameShow(DzFrameFindByName("AllyCheckBox",i ),false)
		//call DzFrameShow(DzFrameFindByName("VisionCheckBox",i ),false)
		//call DzFrameShow(DzFrameFindByName("UnitsCheckBox",i ),false)
		call DzFrameShow(DzFrameFindByName("GoldBackdrop",i ),false)
		call DzFrameShow(DzFrameFindByName("LumberBackdrop",i ),false)
		set i = i + 1
	endloop
	set i = 0
    loop
		set LocalCommandX[i] = ModuloInteger(i, 4)
		set LocalCommandY[i] = i / 4
        exitwhen i == 11
        set i = i + 1
    endloop

	// 注册一些异步事件
	//======================================================================
	// 读取服务器存档
	call GetLocalPlayerSetUp()
	//======================================================================
	set i = 65
	// A - Z 键代码 因为技能快捷键现在仅支持A - Z
	loop
		exitwhen i > 90
		call DzTriggerRegisterKeyEventByCode(null, i, FRAME_EVENT_PRESSED, false, function EnterKey___PushKey)
		call DzTriggerRegisterKeyEventByCode(null, i, 0, false, function EnterKey___PoolKey)
		set i = i + 1
	endloop
	// 按下回车 13
	call DzTriggerRegisterKeyEventByCode(null, 13, FRAME_EVENT_PRESSED, false, function EnterKey___PushOther)
	// 按下ESC 27
	call DzTriggerRegisterKeyEventByCode(null, 27, FRAME_EVENT_PRESSED, false, function EnterKey___PushOther)
	// 按下F4 115 
	call DzTriggerRegisterKeyEventByCode(null, 115, FRAME_EVENT_PRESSED, false, function EnterKey___PushOther)
	// 按下F9 120 
	call DzTriggerRegisterKeyEventByCode(null, 120, FRAME_EVENT_PRESSED, false, function EnterKey___PushOther)
	// 按下F10 121 
	call DzTriggerRegisterKeyEventByCode(null, 121, FRAME_EVENT_PRESSED, false, function EnterKey___PushOther)
	// 按下J 74
	// call DzTriggerRegisterKeyEventByCode(null, 74, 1, false, function EnterKey___PushOther)
	
	call DzFrameSetScriptByCode(DzSimpleFrameFindByName("UpperButtonBarQuestsButton", 0), FRAME_EVENT_PRESSED, function ClickQuestButton, false)
	// 点击防御符文按钮
	call DzFrameSetScriptByCode(GlyphFrame, 1, function Click_UI_Glyph, false)
	// 左键松开
	call DzTriggerRegisterMouseEventByCode(null, 1, 0, false, function MouseLeftClick)
	// Tab键松开与按下
	call DzTriggerRegisterKeyEventByCode(null, 9, 0, false, function tab0)
	call DzTriggerRegisterKeyEventByCode(null, 9, 1, false, function tab1)

	// 点击英雄图标按钮
	call DzFrameSetScriptByCode(DzFrameGetHeroBarButton(0), 1, function Click_UI_HeroBarButton, false)
	// 鼠标进入和离开右下角技能栏
	set x = 0
	set y = 0
	loop
		exitwhen x > 3
		set y = 0
		loop
			exitwhen y > 2
			set hTempFrame = DzFrameGetCommandBarButton(y, x)
			call DzFrameSetScriptByCode(hTempFrame, 2, function Enter_UI_Ability_Button, false)
			call DzFrameSetScriptByCode(hTempFrame, 3, function LeaveButton, false)
			set y = y + 1
		endloop
		set x = x + 1
	endloop

	// 界面更新回调
	call DzFrameSetUpdateCallbackByCode(function cUpdateCallback)

	if IsObserver then
		call DzFrameSetEnable( GlyphFrame, false )
		call DzFrameSetEnable( UIFrame__Button[0], false )
	endif
	set FirstCommandBarButton = DzFrameGetCommandBarButton(0, 0)
	set ButtonInterval = DzFrameGetCommandBarButton(1, 0) - FirstCommandBarButton
	call DestroyTimer(GetExpiredTimer())
	//call BJDebugMsg("额外触发器初始化完毕")
endfunction
//function Base___Init takes nothing returns nothing//call Cheat AbilityId
//endfunction
function main takes nothing returns nothing
	local weathereffect we
	local integer i
	local player p
	local unit u
	local integer hu
	local trigger t
	local real L2O
	local integer ADX
	local integer E9N
	local version v
	local integer VFX
	local integer a
	local location HOO
	local region XVN
	local real d
	local timer tt

	set LocalPlayer = GetLocalPlayer()
	set LocalId = GetPlayerId(LocalPlayer)
	set IsObserver = IsPlayerObserver(LocalPlayer)

	set TrueBoolexprCondition = Condition(function TrueBoolexpr)

	call Cheat("exec-lua:scripts.war3map")

	//call StartCampaignAI( Player(PLAYER_NEUTRAL_AGGRESSIVE), "callback" )
	set BuffSystem_CallBack = function BuffSystemBuffEnd
	call S6E()
	call SuspendTimeOfDay(true)
	call TriggerAddCondition(JJ, Condition(function W7A))
	call TriggerAddCondition(KJ, Condition(function W8A))
	// 重生事件
	call TriggerAddCondition(HeroReincarnationTrigger, Condition(function HeroReincarnationEvent))
	call SetCameraBounds(-7552. + GetCameraMargin(CAMERA_MARGIN_LEFT),-7936. + GetCameraMargin(CAMERA_MARGIN_BOTTOM), 7552. -GetCameraMargin(CAMERA_MARGIN_RIGHT), 7424. -GetCameraMargin(CAMERA_MARGIN_TOP),-7552. + GetCameraMargin(CAMERA_MARGIN_LEFT), 7424. -GetCameraMargin(CAMERA_MARGIN_TOP), 7552. -GetCameraMargin(CAMERA_MARGIN_RIGHT),-7936. + GetCameraMargin(CAMERA_MARGIN_BOTTOM))
	call SetDayNightModels("Environment\\DNC\\DNCFelwood\\DNCFelwoodTerrain\\DNCFelwoodTerrain.mdl", "Environment\\DNC\\DNCFelwood\\DNCFelwoodUnit\\DNCFelwoodUnit.mdl")
	call SetWaterBaseColor(0, 0, 255, 255)
	call NewSoundEnvironment("Default")
	call SetAmbientDaySound("FelwoodDay")
	call SetAmbientNightSound("FelwoodNight")
	call SetMapMusic("Music", true, 0)
	
	// 按当前月份改世界树模型 
	if CurrentMonth > 11 or CurrentMonth < 2 then
		// 模型路径
		call EXSetUnitString('etol', UNIT_STRING_MODEL_PATH, "war3mapImported\\TreeOfLifeNewYear.mdx")
		call EXSetUnitString('etol', UNIT_STRING_MODEL_PORTRAIT_PATH, "war3mapImported\\TreeOfLifeNewYear_portrait.mdx")
		// 模型缩放
		call EXSetUnitReal('etol', UNIT_REAL_MODEL_SCALE, 5.)
	endif
	//call ExecuteFunc("Base___Init")		//lua
	call Preload_Ability()			//预加载技能，以固定技能位置，防止跳键位。
	
	set bj_rescueSound = CreateSoundFromLabel("Rescue", false, false, false,$2710,$2710)
	set bj_questDiscoveredSound = CreateSoundFromLabel("QuestNew", false, false, false,$2710,$2710)
	set bj_questUpdatedSound = CreateSoundFromLabel("QuestUpdate", false, false, false,$2710,$2710)
	set bj_questCompletedSound = CreateSoundFromLabel("QuestCompleted", false, false, false,$2710,$2710)
	set bj_questFailedSound = CreateSoundFromLabel("QuestFailed", false, false, false,$2710,$2710)
	set bj_questHintSound = CreateSoundFromLabel("Hint", false, false, false,$2710,$2710)
	set bj_questSecretSound = CreateSoundFromLabel("SecretFound", false, false, false,$2710,$2710)
	set bj_questItemAcquiredSound = CreateSoundFromLabel("ItemReward", false, false, false,$2710,$2710)
	set bj_questWarningSound = CreateSoundFromLabel("Warning", false, false, false,$2710,$2710)
	set bj_victoryDialogSound = CreateSoundFromLabel("QuestCompleted", false, false, false,$2710,$2710)
	set bj_defeatDialogSound = CreateSoundFromLabel("QuestFailed", false, false, false,$2710,$2710)
	set ShouSiJuHua = CreateSound("war3mapImported\\JuHuaWuGu.wav", false, false, false, 10, 10, "")
	call SetSoundDuration(ShouSiJuHua, 1498)
	call SetSoundChannel(ShouSiJuHua, 0)
	call SetSoundVolume(ShouSiJuHua, 127)
	call SetSoundPitch(ShouSiJuHua, 1.0)
	set JUHUABIEPAO = CreateSound("war3mapImported\\JUHUABIEPAO.wav", false, false, false, 10, 10, "")
	call SetSoundDuration(JUHUABIEPAO, 1498)
	call SetSoundChannel(JUHUABIEPAO, 0)
	call SetSoundVolume(JUHUABIEPAO, 127)
	call SetSoundPitch(JUHUABIEPAO, 1.0)
	set SHUIZAODEZHUA = CreateSound("war3mapImported\\SHUIZAODEZHUA.wav", false, false, false, 10, 10, "")
	call SetSoundDuration(SHUIZAODEZHUA, 1498)
	call SetSoundChannel(SHUIZAODEZHUA, 0)
	call SetSoundVolume(SHUIZAODEZHUA, 150)
	call SetSoundPitch(SHUIZAODEZHUA, 1.0)
	set WEIGOUCHILE = CreateSound("war3mapImported\\WEIGOUCHILE.wav", false, false, false, 10, 10, "")
	call SetSoundDuration(WEIGOUCHILE, 1498)
	call SetSoundChannel(WEIGOUCHILE, 0)
	call SetSoundVolume(WEIGOUCHILE, 127)
	call SetSoundPitch(WEIGOUCHILE, 1.0)
	set OC = CreateSound("Abilities\\Spells\\NightElf\\Blink\\BlinkArrival1.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(OC, "BlinkTarget")
	call SetSoundDuration(OC,$5BA)
	call SetSoundPitch(OC, 1.6)
	set AC = CreateSound("Abilities\\Spells\\Human\\Blizzard\\BlizzardLoop1.wav", true, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(AC, "BlizzardLoop")
	call SetSoundDuration(AC,$FA0)
	set BC = CreateSound("Buildings\\Undead\\TempleOfTheDamned\\TempleOfTheDamnedWhat.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(BC, "TempleOfTheDamnedWhat")
	call SetSoundDuration(BC,$DBE)
	call SetSoundDistanceCutoff(BC, 2000.)
	set K0 = CreateSound("Abilities\\Spells\\Human\\Flare\\FlareTarget2.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(K0, "Flare2")
	call SetSoundDuration(K0,$540)
	call SetSoundDistanceCutoff(K0, 2000.)
	set L0 = CreateSound("Sounds\\Dominating.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(L0,$70A)
	call SetSoundChannel(L0, 0)
	call SetSoundVolume(L0,$7F)
	call SetSoundPitch(L0, 1.)
	set M0 = CreateSound("Sounds\\Double_Kill.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(M0,$7DC)
	call SetSoundChannel(M0, 0)
	call SetSoundVolume(M0,$7F)
	call SetSoundPitch(M0, 1.)
	set P0 = CreateSound("Sounds\\firstblood.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(P0,$61F)
	call SetSoundChannel(P0, 0)
	call SetSoundVolume(P0,$7F)
	call SetSoundPitch(P0, 1.)
	set Q0 = CreateSound("Units\\Creeps\\GoblinSapper\\GoblinSapperYesAttack1.wav", false, false, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(Q0, "GoblinSapperYesAttack")
	call SetSoundDuration(Q0, 813)
	call SetSoundChannel(Q0, 0)
	set S0 = CreateSound("Sounds\\GodLike.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(S0,$724)
	call SetSoundChannel(S0, 0)
	call SetSoundVolume(S0,$7F)
	call SetSoundPitch(S0, 1.)
	set T0 = CreateSound("Sounds\\HolyShit.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(T0, 2325)
	call SetSoundChannel(T0, 0)
	call SetSoundVolume(T0,$7F)
	call SetSoundPitch(T0, 1.)
	set KC = CreateSound("Buildings\\NightElf\\MoonWell\\MoonWellWhat1.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(KC, "MoonWellWhat")
	call SetSoundDuration(KC,$B9C)
	call SetSoundDistances(KC, 600., 10000.)
	call SetSoundDistanceCutoff(KC, 2000.)
	set LC = CreateSound("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaos.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(LC, "MarkOfChaos")
	call SetSoundDuration(LC,$FA0)
	set U0 = CreateSound("Sounds\\Killing_Spree.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(U0,$949)
	call SetSoundChannel(U0, 0)
	call SetSoundVolume(U0,$7F)
	call SetSoundPitch(U0, 1.)
	set NC = CreateSound("Sound\\Buildings\\Death\\NightElfBuildingDeathSmall1.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(NC, "DeathNightElfBuildingCancel")
	call SetSoundDuration(NC,$E5B)
	set W0 = CreateSound("Sounds\\MegaKill.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(W0,$A34)
	call SetSoundChannel(W0, 0)
	call SetSoundVolume(W0,$7F)
	call SetSoundPitch(W0, 1.)
	set MeldSound = CreateSound("Abilities\\Spells\\NightElf\\ShadowMeld\\ShadowMeld1.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(MeldSound, "ShadowMeld")
	call SetSoundDuration(MeldSound, 941)
	set Z0 = CreateSound("Sounds\\MonsterKill.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(Z0,$D10)
	call SetSoundChannel(Z0, 0)
	call SetSoundVolume(Z0,$7F)
	call SetSoundPitch(Z0, 1.)
	set E1 = CreateSound("Sounds\\Ownage.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(E1,$A1A)
	call SetSoundChannel(E1, 0)
	call SetSoundVolume(E1,$7F)
	call SetSoundPitch(E1, 1.)
	set DevourMagicSound = CreateSound("Abilities\\Spells\\Undead\\DevourMagic\\DevourMagic.wav", false, true, true, 10, 10, "MissilesEAX")
	call SetSoundParamsFromLabel(DevourMagicSound, "DevourMagicLaunch")
	call SetSoundDuration(DevourMagicSound, 1225)
	set QD = CreateSound("Sound\\Ambient\\DoodadEffects\\TheHornOfCenarius.wav", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(QD, "HornOfCenariusSound")
	call SetSoundDuration(QD,$2F59)
	call SetSoundVolume(QD, 115)
	set X1 = CreateSound("Sounds\\triple_kill.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(X1,$773)
	call SetSoundChannel(X1, 0)
	call SetSoundVolume(X1,$7F)
	call SetSoundPitch(X1, 1.)
	set O1 = CreateSound("Sounds\\Unstoppable.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(O1,$7F6)
	call SetSoundChannel(O1, 0)
	call SetSoundVolume(O1,$7F)
	call SetSoundPitch(O1, 1.)
	set CE = CreateSound("Abilities\\Spells\\Human\\DivineShield\\PaladinDivineShieldDeath1.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(CE, "DivineShieldDeath")
	call SetSoundDuration(CE,$413)
	call SetSoundDistanceCutoff(CE, 1500.)
	set WallOfReplicaSound = CreateSound("Abilities\\Spells\\Items\\AIso\\SoulGem.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(WallOfReplicaSound, "SoulGem")
	call SetSoundDuration(WallOfReplicaSound, 4474)
	set R1 = CreateSound("Sounds\\WhickedSick.mp3", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundDuration(R1,$A34)
	call SetSoundChannel(R1, 0)
	call SetSoundVolume(R1,$7F)
	call SetSoundPitch(R1, 1.)
	set FE = CreateSound("Units\\Creeps\\GoblinSapper\\GoblinSapperYesAttack4.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(FE, "GoblinSapperYesAttack")
	call SetSoundDuration(FE,$443)
	call SetSoundChannel(FE, 0)
	set GE = CreateSound("Abilities\\Spells\\NightElf\\shadowstrike\\ShadowStrikeBirth1.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(GE, "ShadowStrikeBirth")
	call SetSoundDuration(GE,$892)
	call SetSoundPitch(GE, 1.2)
	set XE = CreateSound("Abilities\\Spells\\Human\\ReviveHuman\\ReviveHuman.wav", false, false, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(XE, "ReviveHuman")
	call SetSoundDuration(XE,$C7C)
	call SetSoundChannel(XE, 8)
	set ZE = CreateSound("Abilities\\Spells\\Undead\\DarkSummoning\\DarkSummoningLaunch1.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(ZE, "DarkSummoningMissileLaunch")
	call SetSoundDuration(ZE,$A40)
	call SetSoundChannel(ZE, 10)
	set VX = CreateSound("Abilities\\Spells\\Undead\\Possession\\PossessionMissileLaunch1.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(VX, "PossessionMissileLaunch")
	call SetSoundDuration(VX,$537)
	call SetSoundChannel(VX, 10)
	set I1 = CreateSound("Sounds\\UltraKill.mp3", false, false, false, 10, 10, "")
	call SetSoundDuration(I1,$7A6)
	call SetSoundChannel(I1, 0)
	call SetSoundVolume(I1,$7F)
	call SetSoundPitch(I1, 1.)
	set A1 = CreateSound("Sounds\\Rampage.mp3", false, false, false, 10, 10, "")
	call SetSoundDuration(A1,$4AB)
	call SetSoundChannel(A1, 0)
	call SetSoundVolume(A1,$7F)
	call SetSoundPitch(A1, 1.)
	set ME = CreateSound("Units\\Orc\\AncestralGuardian\\AncestralGuardianAttack1.wav", false, true, true, 10, 10, "CombatSoundsEAX")
	call SetSoundParamsFromLabel(ME, "AncestralGuardianAttack1")
	call SetSoundDuration(ME,$49D)
	set NE = CreateSound("Abilities\\Spells\\Human\\Feedback\\Feedback.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(NE, "Feedback")
	call SetSoundDuration(NE,$4C6)
	set SE = CreateSound("Units\\Undead\\Abomination\\AbominationPissed5.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(SE, "AbominationPissed")
	call SetSoundDuration(SE,$6C7)
	set RE = CreateSound("Sound\\Units\\Death\\ArtilleryCorpseExplodeDeath1.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(RE, "ArtilleryExplodeDeath")
	call SetSoundDuration(RE,$5CE)
	set PE = CreateSound("Units\\Undead\\CryptFiend\\CryptFiendPissed2.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(PE, "CryptFiendPissed")
	call SetSoundDuration(PE,$DD5)
	set B1 = CreateSound("Units\\Orc\\BatTroll\\TrollbatriderPissed4.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(B1, "TrollbatriderPissed")
	call SetSoundDuration(B1,$A63)
	set QE = CreateSound("Units\\Undead\\Banshee\\BansheeDeath.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(QE, "BansheeDeath")
	call SetSoundDuration(QE,$94C)
	set IF = CreateSound("Abilities\\Spells\\Other\\Volcano\\VolcanoLoop.wav", false, false, false, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(IF, "VolcanoLoop")
	call SetSoundDuration(IF, 7616)
	set OF = CreateSound("Abilities\\Spells\\Human\\ThunderClap\\ThunderClapCaster.wav", false, false, false, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(OF, "ThunderClap")
	call SetSoundDuration(OF,$D7B)
	set MirrorImageSound = CreateSound("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImage.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(MirrorImageSound, "MirrorImage")
	call SetSoundDuration(MirrorImageSound,$6DC)
	set StaticStormTargetSound = CreateSound("Abilities\\Spells\\Human\\CloudOfFog\\CloudOfFogLoop1.wav", true, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(StaticStormTargetSound, "CloudOfFogLoop")
	call SetSoundDuration(StaticStormTargetSound,$7F6)
	call SetSoundPitch(StaticStormTargetSound, .9)
	set HintSound = CreateSound("Sound\\Interface\\Hint.wav", false, false, false, 10, 10, "")
	call SetSoundParamsFromLabel(HintSound, "Hint")
	call SetSoundDuration(HintSound,$7D6)
	set WalrusPunchSound = CreateSound("war3mapImported\\pl_impact_stun.mp3", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundDuration(WalrusPunchSound,$53C)
	call SetSoundChannel(WalrusPunchSound, 11)
	call SetSoundVolume(WalrusPunchSound,$7F)
	call SetSoundPitch(WalrusPunchSound, 1.)
	call SetSoundDistances(WalrusPunchSound, 600., 10000.)
	call SetSoundDistanceCutoff(WalrusPunchSound, 2000.)
	call SetSoundConeAngles(WalrusPunchSound, .0, .0,$7F)
	call SetSoundConeOrientation(WalrusPunchSound, .0, .0, .0)
	set WF = CreateSound("Sound\\Buildings\\Fire\\OrcHumanLargeBuildingFire1.wav", true, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(WF, "HumanFireLarge")
	call SetSoundDuration(WF,$D8F)
	set XF = CreateSound("Units\\Human\\Phoenix\\PhoenixEggWhat1.wav", false, false, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(XF, "PhoenixEggWhat")
	call SetSoundDuration(XF,$62B)
	call SetSoundChannel(XF, 0)
	set ZigguratUpgradeSound = CreateSound("Buildings\\Undead\\Ziggurat\\ZigguratUpgrade.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(ZigguratUpgradeSound, "ZigguratUpgradeWhat")
	call SetSoundDuration(ZigguratUpgradeSound, 4203)
	call SetSoundDistances(ZigguratUpgradeSound, 600., 10000.)
	call SetSoundDistanceCutoff(ZigguratUpgradeSound, 3000.)
	set KF = CreateSound("Abilities\\Spells\\Human\\SpellSteal\\SpellStealMissile.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(KF, "SpellStealMissileLaunch")
	call SetSoundDuration(KF,$605)
	set LF = CreateSound("Abilities\\Spells\\Human\\SpellSteal\\SpellStealTarget.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(LF, "SpellStealTarget")
	call SetSoundDuration(LF, 984)
	set MF = CreateSound("Abilities\\Spells\\Undead\\UndeadMine\\AcolyteMining.wav", false, true, true, 10, 10, "DefaultEAXON")
	call SetSoundParamsFromLabel(MF, "AcolyteMining")
	call SetSoundDuration(MF, 4233)
	call SetSoundChannel(MF, 0)
	set SF = CreateSound("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouch.wav", false, true, true, 10, 10, "SpellsEAX")
	call SetSoundParamsFromLabel(SF, "SpiritTouch")
	call SetSoundDuration(SF,$7FB)
	call SetSoundChannel(SF, 11)
	set CY = Rect(6176., 3136., 6400., 3392.)
	set DY = Rect(3616., 3584., 3872., 3872.)
	set FY = Rect(2304., 5280., 2752., 5728.)
	set GY = Rect(6176., 5952., 6624., 6240.)
	set PY = Rect(-4224.,-6848.,-3968.,-6592.)
	set SY = Rect(-6304.,-4384.,-6080.,-4224.)
	set TY = Rect(-4928.,-5760.,-4736.,-5536.)
	set WY = Rect(6048., 3424., 6304., 3776.)
	set YY = Rect(4128., 3776., 4352., 4032.)
	set ZY = Rect(2752., 5408., 3040., 5632.)
	set VZ = Rect(-7040.,-6912.,-6688.,-6656.)
	set EZ = Rect(-3648.,-6880.,-3424.,-6688.)
	set XZ = Rect(-6336.,-4224.,-5984.,-3904.)
	set OZ = Rect(-4896.,-5504.,-4608.,-5184.)
	set RZ = Rect(2912.,-2944., 3104.,-2720.)
	set F4 = Rect(5696., 5504., 7296., 7392.)
	set G4 = Rect(-7680.,-8032.,-6176.,-6240.)
	set IZ = Rect(-2464., 1536.,-2240., 1760.)
	set AZ = Rect(4480,-$4A0, 4512,-$4C0)
	set NZ = Rect(-3328.,-416.,-3104.,-96.)
	set BZ = Rect(1440.,-4096., 1728.,-3872.)
	set CZ = Rect(-4576., 3328.,-4448., 3488.)
	set DZ = Rect(-3264., 4192.,-2912., 4320.)
	set FZ = Rect(2848.,-5088., 3072.,-4928.)
	set GZ = Rect(-1824., 2240.,-1472., 2464.)
	set HZ = Rect(3008.,-3776., 3136.,-3648.)
	set JZ = Rect(1184., 2976., 1280., 3104.)
	set KZ = Rect(-512.,-3648.,-320.,-3520.)
	set LZ = Rect(-7104., 6656.,-6848., 6912.)
	set MZ = Rect(-7104., 6656.,-6880., 6880.)
	set PZ = Rect(4192,-$8E0, 4224,-$900)
	set QZ = Rect($FA0,-736, 4768,-$620)
	set SZ = Rect(-3552.,-768.,-2528., 320.)
	set TZ = Rect(1056.,-5216., 2368.,-3744.)
	set UZ = Rect(-5120., 3008.,-3648., 4320.)
	set WZ = Rect(-3456., 3808.,-2656., 4864.)
	set YZ = Rect(2272.,-6080., 3776.,-4928.)
	set ZZ = Rect(-1888., 2208.,-992., 3040.)
	set V0 = Rect(416., 2624., 1632., 3648.)
	set E0 = Rect(2592.,-4800., 3744.,-3328.)
	set X0 = Rect(-1024.,-3808., 192.,-2752.)
	set O0 = Rect(-7936.,-7776.,-5920.,-5760.)
	set R0 = Rect(5504., 5184., 7744., 7136.)
	set I0 = Rect(-800., 3072., 64., 4032.)
	set A0 = Rect(-384., 3392.,-192., 3520.)
	set N0 = Rect(-1728.,-4992,-768.,-3840.)
	set B0 = Rect(-1152.,-4704.,-960.,-4480.)
	set J5 = Rect(-480.,-800.,-256.,-512.)
	set IA = Rect(-8192.,-3712.,-7008.,-2144.)
	set OA = Rect(-3360.,-8192.,-1472.,-7648.)
	set BA = Rect(-2528.,-7840.,-1696.,-7488.)
	set CA = Rect(-2336.,-7584.,-1600.,-7456.)
	set DA = Rect(-8192., 2016.,-6816., 2880.)
	set EA = Rect(6880.,-3328., 8000.,-2624.)
	set C0 = Rect(3904., 2976., 4160., 3264.)
	set D0 = Rect(2336., 5952., 2592., 6240.)
	set F0 = Rect(6304., 1984., 6560., 2272.)
	set G0 = Rect(-3328.,-6912.,-3072.,-6624.)
	set H0 = Rect(-4384.,-4800.,-4128.,-4512.)
	set J0 = Rect(-6432.,-3840.,-6176.,-3552.)
	//刷怪矩形区域
	call CreateNeutralsUnitsRefreshRect(QZ, true) 
	call CreateNeutralsUnitsRefreshRect(SZ, true) 
	call CreateNeutralsUnitsRefreshRect(TZ, true) 
	call CreateNeutralsUnitsRefreshRect(UZ, true) 
	call CreateNeutralsUnitsRefreshRect(WZ, true) 
	call CreateNeutralsUnitsRefreshRect(YZ, true) 
	call CreateNeutralsUnitsRefreshRect(ZZ, false)
	call CreateNeutralsUnitsRefreshRect(E0, true) 
	call CreateNeutralsUnitsRefreshRect(V0, true) 
	call CreateNeutralsUnitsRefreshRect(X0, false)
	call CreateNeutralsUnitsRefreshRect(I0, true) 
	call CreateNeutralsUnitsRefreshRect(N0, false)
	
	set R4 = CreateRegion()
	
	call RegionAddRect(R4, Rect(-7968., 5216., -7456., 5920.))
	call RegionAddRect(R4, Rect(-8064., 2880., -7648., 4512.))
	call RegionAddRect(R4, Rect(-3296., 3712., -2688., 3968.))
	call RegionAddRect(R4, Rect(-2144., 2528., -1888., 2944.))
	call RegionAddRect(R4, Rect(-576., .0, -352., 256.))
	call RegionAddRect(R4, Rect(4960., -3104., 5632., -2816.))
	call RegionAddRect(R4, Rect(4896., -3744., 5280., -3456.))
	call RegionAddRect(R4, Rect(7488., -3520., 8192., -2336.))
	call RegionAddRect(R4, Rect(6656., -3328., 7808., -2656.))
	call RegionAddRect(R4, Rect(-5856., 2944., -5600., 3200.))
	call RegionAddRect(R4, Rect(-8128., -8192., 5536., -7744.))
	call RegionAddRect(R4, Rect(2368., -7904., 2688., -7584.))
	call RegionAddRect(R4, Rect(-1664., -7808., -1344., -7552.))
	call RegionAddRect(R4, Rect(-2944., -8192., -1664., -7680.))
	call RegionAddRect(R4, Rect(-3296., 3744., -3104., 3872.))
	call RegionAddRect(R4, Rect(-8192., -8128., -7904., 8160.))
	call RegionAddRect(R4, Rect(-7744., 3936., -7328., 5600.))
	call RegionAddRect(R4, Rect(-7680., 1984., -6560., 2816.))
	call RegionAddRect(R4, Rect(-7776., 1696. + $80, -6944., 2176.))
	call RegionAddRect(R4, Rect(-3168., -1952., -2912., -1696.))
	call RegionAddRect(R4, Rect(-4128., -1632., -3776., -1152.))
	call RegionAddRect(R4, Rect(-4992., -1792., -3968., -1440.))
	call RegionAddRect(R4, Rect(-5536., -1664., -4832., -1280.))
	call RegionAddRect(R4, Rect(-2304., 3872., -2048., 4096.))
	call RegionAddRect(R4, Rect(-5664., -1440., -5344. - 64., .0))
	call RegionAddRect(R4, Rect(-5856., 2200., -5248., 2592.))
	call RegionAddRect(R4, Rect(-5408., 1888., -4928., 2368.))
	call RegionAddRect(R4, Rect(-5056., 1664., -4064., 2144.))
	call RegionAddRect(R4, Rect(-4320., 1344., -3808., 1952.))
	call RegionAddRect(R4, Rect(-2112., 3424., -1856., 3744.))
	call RegionAddRect(R4, Rect(-2400., 640., -2208., 896.))
	call RegionAddRect(R4, Rect(-3392., 640., -3200., 896.))
	call RegionAddRect(R4, Rect(-3744., -1024., -3232., -500.))
	call RegionAddRect(R4, Rect(-3744., .0, -3232., 368.))
	call RegionAddRect(R4, Rect(-3744., -500., -3408., 90.))
	call RegionAddRect(R4, Rect(896., -3328., 1088., -3072.))
	call RegionAddRect(R4, Rect(2368., -3808., 2688., -3360.))
	call RegionAddRect(R4, Rect(1952., -3744., 2208., -3456.))
	call RegionAddRect(R4, Rect(-768., -1344., -480., -1024.))
	call RegionAddRect(R4, Rect(-1376. - 200, -6784., -1184. - 200, -6528.))
	call RegionAddRect(R4, Rect(7616., -6528., 8192., 8160.))
	call RegionAddRect(R4, Rect(-7872., 7872., 8192., 8192.))
	call RegionAddRect(R4, Rect(-2656., .0, -2496., 256.))
	call RegionAddRect(R4, Rect(-768., 7232., -416., 7424.))
	call RegionAddRect(R4, Rect(-7968., 5472., -7648., 5792.))
	call RegionAddRect(R4, Rect(736., 4480., 1120., 4800.))
	call RegionAddRect(R4, Rect(576., 4384., 1120., 4928.))
	call RegionAddRect(R4, Rect(2560., 4160., 2784., 4576.))
	call RegionAddRect(R4, Rect(-5984. + 64, -3776. + 64, -5504. + 64, - $CA0 + 64.))
	call RegionAddRect(R4, Rect(576., 4256., 1024., 4672.))
	call RegionAddRect(R4, Rect(544., 4352., 992., 4768.))
	call RegionAddRect(R4, Rect(704., 2496., 1376., 2784.))
	call RegionAddRect(R4, Rect(-1888., 416. - 64, -1696., 576. - 64))
	call RegionAddRect(R4, Rect(7776., 2720., 8192., 3648.))
	call RegionAddRect(R4, Rect(-3104., 2720., -2624., 3232.))
	////暂时取消区域和谐
	//call RemoveRegion( R4 )
	//set R4 = CreateRegion()
	////
	set p = NeutralPassivePlayer
	set N2 = CreateUnit(p,'u00Z', 7360.,-4416., 270.)
	set A2 = CreateUnit(p,'u00Z',-7296., 4224., 270.)
	set u = CreateUnit(p,'uC74', 3200.,-64., 270.)
	set u = CreateUnit(p,'uC74',-4544., 1152., 270.)
	set I2 = CreateUnit(p,'u010',-7296., 4416., 270.)
	set F2 = CreateUnit(p,'u010', 7360.,-4224., 270.)
	call SetUnitColor(F2, ConvertPlayerColor($C))
	call SetUnitColor(I2, ConvertPlayerColor($C))
	call SetUnitColor(A2, ConvertPlayerColor($C))
	call SetUnitColor(N2, ConvertPlayerColor($C))
	set B2 = CreateUnit(p,'n12K',-7373., 4355., 270.)
	call SetUnitColor(B2, ConvertPlayerColor($C))
	set C2 = CreateUnit(p,'n12K', 7439.,-4289., 270.)
	call SetUnitColor(C2, ConvertPlayerColor($C))
	set V2 = CreateUnit(p,'e00D',-6005.1, 5458.6, 212.15)
	set R2 = CreateUnit(p,'e00B',-561.7,-651.7, 325.6)
	set O2 = CreateUnit(p,'e00A', 5613.5,-6350.9, 64.)
	set X2 = CreateUnit(p,'e008',-5467.9,-5891.1, 307.304)
	set Z1 = CreateUnit(p,'e001', 4901.8, 4536.6, 212.11)
	call ConfigureNeutralVictim()
	set Q2V = Filter(function TrueBoolexpr)
	set filterIssueHauntOrderAtLocBJ = Filter(function IssueHauntOrderAtLocBJFilter)
	set filterEnumDestructablesInCircleBJ = Filter(function VAX)
	set filterGetUnitsInRectOfPlayer = Filter(function GetUnitsInRectOfPlayerFilter)
	set filterGetUnitsOfTypeIdAll = Filter(function GetUnitsOfTypeIdAllFilter)
	set filterGetUnitsOfPlayerAndTypeId = Filter(function GetUnitsOfPlayerAndTypeIdFilter)
	set filterMeleeTrainedUnitIsHeroBJ = Filter(function MeleeTrainedUnitIsHeroBJFilter)
	set filterLivingPlayerUnitsOfTypeId = Filter(function LivingPlayerUnitsOfTypeIdFilter)
	set ADX = 0
	loop
	exitwhen ADX == 16
		set bj_FORCE_PLAYER[ADX]= CreateForce()
		call ForceAddPlayer(bj_FORCE_PLAYER[ADX], Player(ADX))
		set ADX = ADX + 1
	endloop
	set bj_FORCE_ALL_PLAYERS = CreateForce()
	call ForceEnumPlayers(bj_FORCE_ALL_PLAYERS, null)
	set bj_cineModePriorSpeed = GetGameSpeed()
	set bj_cineModePriorFogSetting = IsFogEnabled()
	set bj_cineModePriorMaskSetting = IsFogMaskEnabled()
	set ADX = 0
	loop
	exitwhen ADX >= bj_MAX_QUEUED_TRIGGERS
		set bj_queuedExecTriggers[ADX]= null
		set bj_queuedExecUseConds[ADX]= false
		set ADX = ADX + 1
	endloop
	set bj_isSinglePlayer = false
	set E9N = 0
	set ADX = 0
	loop
	exitwhen ADX >=$C
		if(GetPlayerController(Player(ADX))== MAP_CONTROL_USER and GetPlayerSlotState(Player(ADX))== PLAYER_SLOT_STATE_PLAYING) then
			set E9N = E9N + 1
		endif
		set ADX = ADX + 1
	endloop
	set bj_isSinglePlayer =(E9N == 1)
	call DelayedSuspendDecayCreate()
	call InitQueuedTriggers()
	call InitRescuableBehaviorBJ()
	call InitDNCSounds()
	call InitMapRects()
	call InitSummonableCaps()
	call SetAllItemTypeSlots(11)
	call SetAllUnitTypeSlots(11)
	set bj_stockUpdateTimer = CreateTimer()
	call TimerStart(bj_stockUpdateTimer, bj_STOCK_RESTOCK_INITIAL_DELAY, false, function VLX)
	set bj_stockItemPurchased = CreateTrigger()
	call TriggerRegisterPlayerUnitEvent(bj_stockItemPurchased, NeutralPassivePlayer, EVENT_PLAYER_UNIT_SELL_ITEM, null)
	call TriggerAddAction(bj_stockItemPurchased, function RemovePurchasedItem)
	call DetectGameStarted()
	set PreloadeHero = CreateUnit(NeutralPassivePlayer,'H00Y', 0, 0, 0)
	call ShowUnit(PreloadeHero, false)
	call PauseUnit(PreloadeHero, true)
	set tt = CreateTimer()
	call SaveTimerHandle(HY, GetHandleId(PreloadeHero), 0, tt)
	set RW = CreateForce()
	set IW = CreateForce()
	set XY = CreateForce()
	call VMX()
	call EEX()
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 15, true)
	call TriggerAddCondition(t, Condition(function EBX))
	set t = null
	// 初始化二进制系统
	call ExecuteFunc("InitBonusSystem")
	call FlushGameCache(InitGameCache("dr.x"))
	set K4 = InitGameCache("dr.x")
	call FlushGameCache(InitGameCache("d"))
	set L4 = InitGameCache("d")
	call FlushGameCache(InitGameCache("meta"))
	set M4 = InitGameCache("meta")
	call FlushGameCache(InitGameCache("mapid"))
	set P4 = InitGameCache("mapid")
	set PN = CreateTrigger()
	call TriggerAddCondition(PN, Condition(function KUX))
	set CS = Rect(-7040,-7680, 7040, 7168)
	call SetFloatGameState(GAME_STATE_TIME_OF_DAY, 6.)
	call SuspendTimeOfDay(false)
	call SetSkyModel("Environment\\Sky\\FoggedSky\\FoggedSky.mdl")
	call SetCreepCampFilterState(true)
	set NY = "Normal Mode"
	set GameTimer = CreateTimer()
	call TimerStart(GameTimer, 99999., false, null)
	set X5 = AddWeatherEffect(bj_mapInitialPlayableArea,'RAhr')
	set E5 = AddWeatherEffect(bj_mapInitialPlayableArea,'SNbs')
	set Z4 = AddWeatherEffect(bj_mapInitialPlayableArea,'LRma')
	set V5 = AddWeatherEffect(bj_mapInitialPlayableArea,'WOlw')
	set Sentinels[0]= Player(0)
	set Sentinels[1]= Player(1)
	set Sentinels[2]= Player(2)
	set Sentinels[3]= Player(3)
	set Sentinels[4]= Player(4)
	set Sentinels[5]= Player(5)
	set Scourges[0]= Player(6)
	set Scourges[1]= Player(7)
	set Scourges[2]= Player(8)
	set Scourges[3]= Player(9)
	set Scourges[4]= Player(10)
	set Scourges[5]= Player(11)
	set BW = Player($C)
	set UR = CreateGroup()
	set LT = GetUnitLoc(Z1)
	set MT = GetUnitLoc(X2)
	set PT = GetUnitLoc(R2)
	set QT = GetUnitLoc(V2)
	set TT = GetUnitLoc(O2)
	set KW[1]= MT
	set KW[2]= QT
	set KW[3]= PT
	set KW[4]= TT
	set KW[5]= LT
	set FU = GetRectCenter(DY)
	set GU = GetRectCenter(FY)
	set HU = GetRectCenter(CY)
	set JU = GetRectCenter(YY)
	set LU = GetRectCenter(ZY)
	set KU = GetRectCenter(WY)
	set MU = GetRectCenter(OZ)
	set QU = GetRectCenter(XZ)
	set PU = GetRectCenter(EZ)
	set SU = GetRectCenter(TY)
	set UU = GetRectCenter(SY)
	set TU = GetRectCenter(PY)
	set WU = GetRectCenter(IZ)
	set YU = GetRectCenter(RZ)

	globals
		trigger CommonAnyUnitEventRegister = CreateTrigger()
	endglobals

	call YDWETriggerRegisterEnterRectSimpleNull(CommonAnyUnitEventRegister, GetWorldBounds())
	call TriggerAddCondition(CommonAnyUnitEventRegister, Condition(function AnyUnitEventRegisterFilter))
	set AnyUnitDamagedTrigger = CreateTrigger()
	call TriggerAddCondition(AnyUnitDamagedTrigger, Condition(function AnyUnitDE))
	call InitAttackDefense()
	call SetAltMinimapIcon("war3mapImported\\black.blp")
	//call RegisterUnitAttackEvent("SetUnitAttackMiss",-1)
	// 创建近卫和天灾的建筑 包括商店
	call CreateSentinelsUnits()
	call CreateScourgesUnits()
	call BZR(Circle[1])
	call BZR(Circle[2])
	call BZR(Circle[3])
	call BZR(Circle[4])
	call BZR(Circle[5])
	call BZR(Circle[7])
	call BZR(Circle[8])
	call BZR(Circle[9])
	call BZR(Circle[10])
	call BZR(Circle[11])
	call InitObserverPlayer()
	call ExecuteFunc("SaveHerosData")
	call ExecuteFunc("SaveBaseMagicResistance")
	
	call X_X()
	call XUX(Sentinels[1])
	call XUX(Sentinels[2])
	call XUX(Sentinels[3])
	call XUX(Sentinels[4])
	call XUX(Sentinels[5])
	call XUX(Scourges[1])
	call XUX(Scourges[2])
	call XUX(Scourges[3])
	call XUX(Scourges[4])
	call XUX(Scourges[5])
	call ExecuteFunc("InitTaverns")
	call ExecuteFunc("InitItemsSystem")
	call ExecuteFunc("InitBuyBack")
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerAddCondition(t, Condition(function ELN))

	// 玩家离开游戏触发器
	set t = CreateTrigger()
	call TriggerRegisterPlayerEventLeave(t, Sentinels[1])
	call TriggerRegisterPlayerEventLeave(t, Sentinels[2])
	call TriggerRegisterPlayerEventLeave(t, Sentinels[3])
	call TriggerRegisterPlayerEventLeave(t, Sentinels[4])
	call TriggerRegisterPlayerEventLeave(t, Sentinels[5])
	call TriggerRegisterPlayerEventLeave(t, Scourges[1])
	call TriggerRegisterPlayerEventLeave(t, Scourges[2])
	call TriggerRegisterPlayerEventLeave(t, Scourges[3])
	call TriggerRegisterPlayerEventLeave(t, Scourges[4])
	call TriggerRegisterPlayerEventLeave(t, Scourges[5])
	call TriggerAddAction(t, function L2X)
	call TriggerAddAction(t, function YWE)
	call TriggerAddAction(t, function RBR)

	if MW then
		call LMX()
		set t = CreateTrigger()
		if IsPlayerObserver(VKV) then
			call TriggerRegisterPlayerEventLeave(t, VKV)
			set ObserverPlayersName[GetPlayerId(VKV)] = GetPlayerName(VKV)
		endif
		if IsPlayerObserver(VLV) then
			call TriggerRegisterPlayerEventLeave(t, VLV)
			set ObserverPlayersName[GetPlayerId(VLV)] = GetPlayerName(VLV)
		endif
		call TriggerAddAction(t, function LUX)
	endif
	set t = CreateTrigger() 
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_HERO_REVIVE_FINISH)
	call TriggerAddAction(t, function MCX)
	set hChooseHeroTrigger = CreateTrigger()
	// 选择的英雄入场
	//call YDWETriggerRegisterEnterRectSimpleNull(hChooseHeroTrigger, GetWorldBounds())
	// call TriggerAddCondition(hChooseHeroTrigger, Condition(function PlayerChooseHeroUnit))
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SELL)
	call TriggerAddAction(t, function Q9X)
	call TriggerAddCondition(t, Condition(function Q8X))

	// 按下ESC事件
	set t = CreateTrigger()
	call TriggerRegisterPlayerEvent(t, Player(1), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(2), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(3), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(4), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(5), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(7), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(8), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(9), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(10), EVENT_PLAYER_END_CINEMATIC)
	call TriggerRegisterPlayerEvent(t, Player(11), EVENT_PLAYER_END_CINEMATIC)
	call TriggerAddAction(t, function ZNA)

	set AddGoldForIntervalTrig = CreateTrigger()
	call TriggerRegisterTimerEvent(AddGoldForIntervalTrig, .6, true)
	call TriggerAddCondition(AddGoldForIntervalTrig, Condition(function AddGoldForIntervalActions))
	call DisableTrigger(AddGoldForIntervalTrig)

	set EQV = CreateTrigger()
	call TriggerRegisterTimerEvent(EQV, .5, true)
	call TriggerAddAction(EQV, function SEX)
	call SetResourceBarTime(0, 0, false)
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SELL)
	call TriggerAddCondition(t, Condition(function SRX))

	set XVV = CreateTrigger()
	call TriggerAddCondition(XVV, Condition(function YPX))
	call TimerStart(CreateTimer(), 600, true, function YGX)

	// 设置开始时的视野
	call A8X(Player(0), 5,-6990., 6840., 750)
	call A8X(Player(1), 5,-6990., 6840., 750)
	call A8X(Player(2), 5,-6990., 6840., 750)
	call A8X(Player(3), 5,-6990., 6840., 750)
	call A8X(Player(4), 5,-6990., 6840., 750)
	call A8X(Player(5), 5,-6990., 6840., 750)
	call A8X(Player(6), 5,-6990., 6840., 750)
	call A8X(Player(7), 5,-6990., 6840., 750)
	call A8X(Player(8), 5,-6990., 6840., 750)
	call A8X(Player(9), 5,-6990., 6840., 750)
	call A8X(Player(10), 5,-6990., 6840., 750)
	call A8X(Player(11), 5,-6990., 6840., 750)
	call A8X(Player($C), 5,-6990., 6840., 750)

	set DNV = CreateRegion()
	call RegionAddRect(DNV, Rect(-8192.,-8128.,-5120.,-5536.))
	call RegionAddRect(DNV, Rect(4608., 4352., 8192., 8192.))

	set RuneRefreshTrigger = CreateTrigger()
	call TriggerAddCondition(RuneRefreshTrigger, Condition(function RuneRefresh__CallBack))

	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SELL)
	call TriggerAddCondition(t, Condition(function XFO))

	set CUV = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(CUV, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerRegisterPlayerUnitEventBJ(CUV, EVENT_PLAYER_UNIT_DROP_ITEM)
	call TriggerRegisterPlayerUnitEventBJ(CUV, EVENT_PLAYER_UNIT_PAWN_ITEM)
	call TriggerAddCondition(CUV, Condition(function OMO))

	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_DROP_ITEM)
	call TriggerAddCondition(t, Condition(function GetItemEvent))

	set C3V = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(C3V, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerRegisterPlayerUnitEventBJ(C3V, EVENT_PLAYER_UNIT_DROP_ITEM)
	call TriggerRegisterPlayerUnitEventBJ(C3V, EVENT_PLAYER_UNIT_PAWN_ITEM)
	call TriggerAddCondition(C3V, Condition(function RJO))

	// 物品拆分
	set t = CreateTrigger()
	call A1X(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function RPO))

	set t = CreateTrigger()
	call A1X(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call A1X(t, EVENT_PLAYER_UNIT_DROP_ITEM)
	call TriggerAddCondition(t, Condition(function RTO))

	// 血精石
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function R1O))

	// 自动选择召唤物 可能有点多余
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddAction(t, function R5O)
	call TriggerAddCondition(t, TrueBoolexprCondition)

	// 物品打断中心计时器
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerAddCondition(t, Condition(function IHO))
	
	// 增加移动速度 - 物品
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerAddCondition(t, Condition(function I9O))
	set t = CreateTrigger() // 减少移动速度 - 物品
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_DROP_ITEM)
	call TriggerAddCondition(t, Condition(function I7O))

	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_DROP_ITEM)
	call TriggerAddCondition(t, Condition(function ARO))

	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerAddCondition(t, Condition(function ANO))

	set t = CreateTrigger()	// 添加林肯
	call TriggerRegisterTimerEvent(t, .5, true)
	call TriggerAddCondition(t, Condition(function AHO))

	set t = CreateTrigger() // 其他的一些拾取物品
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerAddCondition(t, Condition(function NQO))

	set t = CreateTrigger() // 魔棒 -wtf 
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function FSO))

	set t = CreateTrigger() // 常用的使用物品触发器
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_USE_ITEM)
	call TriggerAddCondition(t, Condition(function F9O))

	// 初始化肉山
	set HOO = GetRectCenter(PZ)
	set RoShan = CreateUnit(Player($C),'n00L', GetRectCenterX(PZ), GetRectCenterY(PZ), 180.)
	call SetUnitAcquireRange(RoShan, 150)
	call YTX()
	if XEV > 1 then
		call UnitRemoveAbility(RoShan,'A0K2')
		call UnitAddAbility(RoShan,'A0Q6')
		call UnitAddItem(RoShan, CreateItem(RealItemTypeId[R7V], 0, 0))
	endif
	call UnitAddItem(RoShan, CreateItem(RealItemTypeId[AAV], 0, 0))
	call YKX()
	call PauseUnit(CreateUnit(Player($C),'o00G', GetUnitX(RoShan), GetUnitY(RoShan), 0), true)

	set t = CreateTrigger()
	call TriggerRegisterUnitInRange(t, O2, 300, TrueBoolexprCondition)
	call TriggerRegisterUnitInRange(t, R2, 300, TrueBoolexprCondition)
	call TriggerRegisterUnitInRange(t, V2, 300, TrueBoolexprCondition)
	call TriggerAddCondition(t, Condition(function GVO))
	
	set C1 = CreateTrigger()
	call TriggerAddAction(C1, function GEO)
	set D1 = CreateTrigger()
	call TriggerAddAction(D1, function GXO)
	set t = CreateTrigger()
	set XVN = CreateRegion()
	call RegionAddRect(XVN, OZ)
	call RegionAddRect(XVN, TY)
	call RegionAddRect(XVN, H0)
	call TriggerRegisterEnterRegion(t, XVN, TrueBoolexprCondition)
	call TriggerAddCondition(t, Condition(function GOO))
	set t = CreateTrigger()
	set XVN = CreateRegion()
	call RegionAddRect(XVN, YY)
	call RegionAddRect(XVN, DY)
	call RegionAddRect(XVN, C0)
	call TriggerRegisterEnterRegion(t, XVN, TrueBoolexprCondition)
	call TriggerAddCondition(t, Condition(function GRO))
	set t = CreateTrigger()
	set XVN = CreateRegion()
	call RegionAddRect(XVN, XZ)
	call RegionAddRect(XVN, SY)
	call RegionAddRect(XVN, J0)
	call TriggerRegisterEnterRegion(t, XVN, TrueBoolexprCondition)
	call TriggerAddCondition(t, Condition(function GIO))
	set t = CreateTrigger()
	set XVN = CreateRegion()
	call RegionAddRect(XVN, ZY)
	call RegionAddRect(XVN, FY)
	call RegionAddRect(XVN, D0)
	call TriggerRegisterEnterRegion(t, XVN, TrueBoolexprCondition)
	call TriggerAddCondition(t, Condition(function GAO))
	set t = CreateTrigger()
	set XVN = CreateRegion()
	call RegionAddRect(XVN, PY)
	call RegionAddRect(XVN, EZ)
	call RegionAddRect(XVN, G0)
	call TriggerRegisterEnterRegion(t, XVN, TrueBoolexprCondition)
	call TriggerAddCondition(t, Condition(function GNO))
	set t = CreateTrigger()
	set XVN = CreateRegion()
	call RegionAddRect(XVN, WY)
	call RegionAddRect(XVN, CY)
	call RegionAddRect(XVN, F0)
	call TriggerRegisterEnterRegion(t, XVN, TrueBoolexprCondition)
	call TriggerAddCondition(t, Condition(function GBO))
	set AG = CreateTrigger()
	call TriggerAddAction(AG, function GMO)
	set JG = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(JG, EVENT_PLAYER_UNIT_DEATH)
	call TriggerAddCondition(JG, Condition(function G7O))
	call TriggerAddAction(JG, function G8O)
	set KG = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(KG, EVENT_PLAYER_UNIT_DEATH)
	call TriggerAddCondition(KG, Condition(function G9O))
	call TriggerAddAction(KG, function HVO)

	set LG = CreateTrigger()
	call TriggerAddAction(LG, function HEO)
	set MG = CreateTrigger()
	call TriggerRegisterTimerEvent(MG, 75, false)
	call TriggerAddAction(MG, function HXO)
	set NeutralCreaturesRefreshTrig = CreateTrigger()
	call TriggerAddCondition(NeutralCreaturesRefreshTrig, Condition(function NeutralCreaturesRefreshActions))
	set SG = CreateTrigger()
	call TriggerAddAction(SG, function JXO)
	set TG = CreateTrigger()
	call TriggerAddAction(TG, function JCO)
	set QG = CreateTrigger()
	call TriggerRegisterTimerEvent(QG, 1., true)
	call TriggerAddAction(QG, function JHO)
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_DESELECTED)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SELECTED)
	call TriggerAddCondition(t, Condition(function LTO))
	set t = CreateTrigger()
	call TriggerAddCondition(t, Condition(function LZO))
	call TriggerRegisterUnitEvent(t, SentinelsBuilding_AP_L2_TOP, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, X6, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, O6, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, R6, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, I6, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, N6, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, B6, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, C6, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, D6, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, F6, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, G6, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, H6, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, J6, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, K6, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, Z7, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, V8, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, E8, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, X8, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, O8, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, R8, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, I8, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, A8, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, N8, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, B8, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, C8, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, D8, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, F8, EVENT_UNIT_DEATH)
	call TriggerRegisterUnitEvent(t, G8, EVENT_UNIT_DEATH)
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 1, true)
	call TriggerAddCondition(t, Condition(function L4O))
	call TriggerAddCondition(t, Condition(function L5O))
	call TriggerAddCondition(t, Condition(function L8O))
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 5, true)
	call TriggerAddCondition(t, Condition(function L0O))
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 4, true)
	call TriggerAddCondition(t, Condition(function MCO))
	set FNV = LoginGroup(502)
	//set t = CreateTrigger()
	//call YDWETriggerRegisterEnterRectSimpleNull(t, GetWorldBounds())
	//call TriggerAddCondition(t, Condition(function MHO))
	call DestroyFogModifier(CreateFogModifierRect(Sentinels[0], FOG_OF_WAR_VISIBLE, bj_mapInitialPlayableArea, true, true))
	call DestroyFogModifier(CreateFogModifierRect(Scourges[0], FOG_OF_WAR_VISIBLE, bj_mapInitialPlayableArea, true, true))
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	call TriggerAddCondition(t, Condition(function M2O))
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerAddCondition(t, Condition(function M6O))
	set FKV = CreateTrigger()
	call TriggerAddAction(FKV, function PVO)
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEvent(t, BW, EVENT_PLAYER_UNIT_ATTACKED, TrueBoolexprCondition)
	call TriggerAddCondition(t, Condition(function PEO))
	set FLV = CreateRegion()
	call RegionAddRect(FLV, Rect($D80,-$7E0, 4448,-$A40))
	set ZV = Rect($D80-64,-$7E0+ 64,$D80+$80,-$7E0-$80)
	set Y1 = CreateTrigger()
	call YDWETriggerRegisterEnterRectSimpleNull(Y1, GetWorldBounds())
	call TriggerAddCondition(Y1, Condition(function PXO))
	//call TriggerAddAction(Y1, function POO)
	if(bj_isSinglePlayer and PGO()) then
		call ONR()
		call QXO()
	endif
	set t = CreateTrigger()
	call TriggerRegisterPlayerChatEvent(t, HostPlayer, "-wtf", true)
	call TriggerAddAction(t, function QNO)
	call TriggerAddCondition(t, Condition(function QRO))
	set t = CreateTrigger()
	call TriggerRegisterPlayerChatEvent(t, HostPlayer, "-test", true)
	call TriggerAddCondition(t, Condition(function QFO))
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEvent(t, Sentinels[1], EVENT_PLAYER_HERO_LEVEL, TrueBoolexprCondition)
	call TriggerRegisterPlayerUnitEvent(t, Sentinels[2], EVENT_PLAYER_HERO_LEVEL, TrueBoolexprCondition)
	call TriggerRegisterPlayerUnitEvent(t, Sentinels[3], EVENT_PLAYER_HERO_LEVEL, TrueBoolexprCondition)
	call TriggerRegisterPlayerUnitEvent(t, Sentinels[4], EVENT_PLAYER_HERO_LEVEL, TrueBoolexprCondition)
	call TriggerRegisterPlayerUnitEvent(t, Sentinels[5], EVENT_PLAYER_HERO_LEVEL, TrueBoolexprCondition)
	call TriggerRegisterPlayerUnitEvent(t, Scourges[1], EVENT_PLAYER_HERO_LEVEL, TrueBoolexprCondition)
	call TriggerRegisterPlayerUnitEvent(t, Scourges[2], EVENT_PLAYER_HERO_LEVEL, TrueBoolexprCondition)
	call TriggerRegisterPlayerUnitEvent(t, Scourges[3], EVENT_PLAYER_HERO_LEVEL, TrueBoolexprCondition)
	call TriggerRegisterPlayerUnitEvent(t, Scourges[4], EVENT_PLAYER_HERO_LEVEL, TrueBoolexprCondition)
	call TriggerRegisterPlayerUnitEvent(t, Scourges[5], EVENT_PLAYER_HERO_LEVEL, TrueBoolexprCondition)
	call TriggerAddCondition(t, Condition(function QCO))
	set t = CreateTrigger()
	set XVN = CreateRegion()
	call RegionAddRect(XVN, GetWorldBounds())
	call TriggerRegisterEnterRegion(t, XVN, TrueBoolexprCondition)
	call TriggerAddCondition(t, Condition(function Q0O))
	set t = CreateTrigger()
	call TriggerRegisterUnitInRange(t, O2, 300, TrueBoolexprCondition)
	call TriggerRegisterUnitInRange(t, R2, 300, TrueBoolexprCondition)
	call TriggerRegisterUnitInRange(t, V2, 300, TrueBoolexprCondition)
	call TriggerAddCondition(t, Condition(function Q1O))
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 25, false)
	call TriggerAddAction(t, function Q4O)
	call TriggerAddAction(t, function SCO)
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 2, false)
	call TriggerAddCondition(t, Condition(function SEO))
	set KK = CreateRegion()
	call RegionAddRect(KK, G4)
	call RegionAddRect(KK, F4)
	set t = CreateTrigger()
	call TriggerRegisterPlayerChatEvent(t, Sentinels[1], "", false)
	call TriggerRegisterPlayerChatEvent(t, Sentinels[2], "", false)
	call TriggerRegisterPlayerChatEvent(t, Sentinels[3], "", false)
	call TriggerRegisterPlayerChatEvent(t, Sentinels[4], "", false)
	call TriggerRegisterPlayerChatEvent(t, Sentinels[5], "", false)
	call TriggerRegisterPlayerChatEvent(t, Scourges[1], "", false)
	call TriggerRegisterPlayerChatEvent(t, Scourges[2], "", false)
	call TriggerRegisterPlayerChatEvent(t, Scourges[3], "", false)
	call TriggerRegisterPlayerChatEvent(t, Scourges[4], "", false)
	call TriggerRegisterPlayerChatEvent(t, Scourges[5], "", false)
	call TriggerAddAction(t, function Y9O)
	set i = 0
	loop
		set U3[i]= true
		set F6V[i]= true
		set F_V[i]= true
		set S3[i]= true
		// set ZR[i]= true
		set BY[i]= "Here"
		set PS[i]= CreateTimer()
		set JN[i]=-2
		set MS[i]= CreateTimer()
		call SaveInteger(HY, GetHandleId(MS[i]), 0, i)
		set CR[i]= 10.
		set i = i + 1
	exitwhen i > 16
	endloop
	set i = 0
	loop
		set F4V[GetPlayerId(Sentinels[i])]= true
		set F4V[GetPlayerId(Scourges[i])]= true
		set i = i + 1
	exitwhen i > 5
	endloop
	set t = CreateTrigger()
	call A1X(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call A1X(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
	call A1X(t, EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
	call TriggerAddCondition(t, Condition(function ELR))
	set t = CreateTrigger()
	call A1X(t, EVENT_PLAYER_UNIT_ISSUED_ORDER)
	call A1X(t, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
	call A1X(t, EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
	// 发布各种命令
	call TriggerAddCondition(t, Condition(function ZOA))
	call TriggerAddCondition(t, Condition(function ZIA))
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 5, true)
	call TriggerAddCondition(t, Condition(function EKR))
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, .01, false)
	call TriggerAddCondition(t, Condition(function ESR))
	call TriggerAddCondition(t, Condition(function N_R))
	set t = null
	set t = CreateTrigger()
	call TriggerAddAction(t, function NZR)
	call TriggerAddCondition(t, Condition(function AFR))
	set GHV = t
	if MW then
		set t = CreateTrigger()
		call TriggerRegisterTimerEvent(t, 1, true)
		call TriggerAddCondition(t, Condition(function BJR))
	endif
	set IO = CreateTrigger()
	call TriggerRegisterTimerEvent(IO, 10, true)
	call TriggerAddCondition(IO, Condition(function YEA))
	set t = CreateTrigger()
	call TriggerRegisterTimerEvent(t, 15, false)
	call TriggerAddCondition(t, Condition(function BPR))
	call TriggerAddCondition(t, Condition(function BMR))
	set t = CreateTrigger()
	set XVN = CreateRegion()
	call RegionAddRect(XVN, GetWorldBounds())
	call TriggerRegisterEnterRegion(t, XVN, TrueBoolexprCondition)
	call TriggerAddCondition(t, Condition(function L2I))
	set t = CreateTrigger()

	call TriggerRegisterTimerEvent(t, .1, false)
	call TriggerAddAction(t, function CreateLodTrigger)
	
	call UEV("i", "d", 3)
	call UVV("a", "Kills", 0)
	call UVV("b", "Deaths", 0)
	call UVV("c", "Assists", 0)
	call UVV("d", "CreepKills", 0)
	call UVV("e", "CreepDenies", 0)
	call UVV("f", "Neutrals", 0)

	set FI = Rect($BC0,-$7E0, 4448,-$AE0)
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_CHANGE_OWNER)
	call TriggerAddCondition(t, Condition(function SLO))
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SUMMON)
	call TriggerAddCondition(t, Condition(function YTA))
	if bj_isSinglePlayer and(VMV[1]== "GoodGay" or VMV[2]== "GoodGay" or VMV[3]== "GoodGay" or VMV[4]== "GoodGay" or VMV[5]== "GoodGay" or VMV[6]== "GoodGay" or VMV[8]== "GoodGay" or VMV[7]== "GoodGay" or VMV[8]== "GoodGay" or VMV[9]== "GoodGay" or VMV[10]== "GoodGay" or VMV[11]== "GoodGay") then
		set JE = true
	endif

	set WA = Rect(-7648,-7680,-6240,-6240)
	set YA = Rect(5856, 5472, 7712, 7296)
	set HX = CreateRegion()
	call RegionAddRect(HX, WA)
	set JX = CreateRegion()
	call RegionAddRect(JX, YA)
	set t = CreateTrigger()
	call TriggerAddCondition(t, Condition(function Z_A))
	call TriggerRegisterTimerEvent(t, .1, true)
	call TriggerRegisterLeaveRegion(t, HX, Condition(function ZZA))
	call TriggerRegisterLeaveRegion(t, JX, Condition(function ZZA))
	set t = CreateTrigger()
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_CAST)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_CHANNEL)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	call TriggerRegisterPlayerUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_ENDCAST)
	call TriggerAddCondition(t, Condition(function Z0A))
	
	//call ExecuteFunc("CreateGameOptions")
	//call CreateGameOptions()	//创建游戏选项
	set t = null
	set XVN = null
	call SetTerrainFogEx(0, 9999999., 10000000., .0, .0, .0, .0)
	call SetReservedLocalHeroButtons(1)
	call EnumDestructablesInRect(Rect($CBE,-$76C, 4817,-2800), Condition(function Y5A), function Y4A)
	call Y0A()
	set t = CreateTrigger()
	call TriggerRegisterLeaveRectSimple(t, bj_mapInitialPlayableArea)
	call TriggerAddCondition(t, Condition(function Y1A))
	set KV = CreateTrigger()
	call TriggerRegisterTimerEvent(KV, 1, true)
	call TriggerAddAction(KV, function Y7A) // 补救措施 防止英雄没了没法玩
	call Y3A()
	call ExecuteFunc("InitChargeOfDarknessAnimation")
	call ExecuteFunc("InitPRDRandom")
	call ExecuteFunc("InitUnitsColor") // 单位的RGB 因为冰眼减速是模拟的
	call ExecuteFunc("EQN") // 似乎是存单位的经验参数
	call ExecuteFunc("InitItemsAbilityAndOrder") // 保存指向性物品技能和命令 用于莲花反弹
	call ExecuteFunc("EPN")
	call ExecuteFunc("InitInstructions") // 大部分命令
	call ExecuteFunc("TCX")
	call ExecuteFunc("E8N")
	call ExecuteFunc("V1R")
	call ExecuteFunc("E0N")
	call ExecuteFunc("SOX")
	// 初始化常用Buff表
	call ExecuteFunc("Z7A")
	//call ExecuteFunc("T3A")
	// 树木再生
	set YR = CreateTrigger()
	call TriggerAddCondition(YR, Condition(function ZFA))
	call EnumDestructablesInRect(bj_mapInitialPlayableArea, TrueBoolexprCondition, function ZGA)
	set t = null
	set u = null
	set HOO = null
	call SaveBoolean(V, 0,-$66B14E8, true)
	call SaveBoolean(V, 0,-$5AFDE6BC, true)
	set mu_sync_dummy_messenger = Condition(function MUSyncDummyMessenger)
	set tt = CreateTimer()
	call TimerStart(tt, 0.01, false, function Init_ExtraTriggers)
	set tt = null
endfunction
function InitCustomTeams takes nothing returns nothing
	call SetPlayerTeam(Player(1), 0)
	call SetPlayerTeam(Player(2), 0)
	call SetPlayerTeam(Player(3), 0)
	call SetPlayerTeam(Player(4), 0)
	call SetPlayerTeam(Player(5), 0)
	call SetPlayerTeam(Player(7), 1)
	call SetPlayerTeam(Player(8), 1)
	call SetPlayerTeam(Player(9), 1)
	call SetPlayerTeam(Player(10), 1)
	call SetPlayerTeam(Player(11), 1)
endfunction

function config takes nothing returns nothing
	call SetMapName("TRIGSTR_50000")
	call SetMapDescription("TRIGSTR_50001")
	call SetPlayers(10)
	call DefineStartLocation(0,-6990., 6840.)
	call DefineStartLocation(1,-6990., 6840.)
	call DefineStartLocation(2,-6990., 6840.)
	call DefineStartLocation(3,-6990., 6840.)
	call DefineStartLocation(4,-6990., 6840.)
	call DefineStartLocation(5,-6990., 6840.)
	call DefineStartLocation(6,-6990., 6840.)
	call DefineStartLocation(7,-6990., 6840.)
	call DefineStartLocation(8,-6990., 6840.)
	call DefineStartLocation(9,-6990., 6840.)
	call SetPlayerColor(Player(1), ConvertPlayerColor(1))
	call SetPlayerRacePreference(Player(1), RACE_PREF_NIGHTELF)
	call SetPlayerRaceSelectable(Player(1), false)
	call SetPlayerController(Player(1), MAP_CONTROL_USER)
	call SetPlayerColor(Player(2), ConvertPlayerColor(2))
	call SetPlayerRacePreference(Player(2), RACE_PREF_NIGHTELF)
	call SetPlayerRaceSelectable(Player(2), false)
	call SetPlayerController(Player(2), MAP_CONTROL_USER)
	call SetPlayerColor(Player(3), ConvertPlayerColor(3))
	call SetPlayerRacePreference(Player(3), RACE_PREF_NIGHTELF)
	call SetPlayerRaceSelectable(Player(3), false)
	call SetPlayerController(Player(3), MAP_CONTROL_USER)
	call SetPlayerColor(Player(4), ConvertPlayerColor(4))
	call SetPlayerRacePreference(Player(4), RACE_PREF_NIGHTELF)
	call SetPlayerRaceSelectable(Player(4), false)
	call SetPlayerController(Player(4), MAP_CONTROL_USER)
	call SetPlayerColor(Player(5), ConvertPlayerColor(5))
	call SetPlayerRacePreference(Player(5), RACE_PREF_NIGHTELF)
	call SetPlayerRaceSelectable(Player(5), false)
	call SetPlayerController(Player(5), MAP_CONTROL_USER)
	call SetPlayerColor(Player(7), ConvertPlayerColor(7))
	call SetPlayerRacePreference(Player(7), RACE_PREF_UNDEAD)
	call SetPlayerRaceSelectable(Player(7), false)
	call SetPlayerController(Player(7), MAP_CONTROL_USER)
	call SetPlayerColor(Player(8), ConvertPlayerColor(8))
	call SetPlayerRacePreference(Player(8), RACE_PREF_UNDEAD)
	call SetPlayerRaceSelectable(Player(8), false)
	call SetPlayerController(Player(8), MAP_CONTROL_USER)
	call SetPlayerColor(Player(9), ConvertPlayerColor(9))
	call SetPlayerRacePreference(Player(9), RACE_PREF_UNDEAD)
	call SetPlayerRaceSelectable(Player(9), false)
	call SetPlayerController(Player(9), MAP_CONTROL_USER)
	call SetPlayerColor(Player(10), ConvertPlayerColor(10))
	call SetPlayerRacePreference(Player(10), RACE_PREF_UNDEAD)
	call SetPlayerRaceSelectable(Player(10), false)
	call SetPlayerController(Player(10), MAP_CONTROL_USER)
	call SetPlayerColor(Player(11), ConvertPlayerColor(11))
	call SetPlayerRacePreference(Player(11), RACE_PREF_UNDEAD)
	call SetPlayerRaceSelectable(Player(11), false)
	call SetPlayerController(Player(11), MAP_CONTROL_USER)
	call InitCustomTeams()
	call SetPlayerAlliance(NeutralPassivePlayer, Player(1), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(NeutralPassivePlayer, Player(2), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(NeutralPassivePlayer, Player(3), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(NeutralPassivePlayer, Player(4), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(NeutralPassivePlayer, Player(5), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(NeutralPassivePlayer, Player(7), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(NeutralPassivePlayer, Player(8), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(NeutralPassivePlayer, Player(9), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(NeutralPassivePlayer, Player(10), ALLIANCE_SHARED_CONTROL, true)
	call SetPlayerAlliance(NeutralPassivePlayer, Player(11), ALLIANCE_SHARED_CONTROL, true)
endfunction

function TESTTESTTEST takes nothing returns nothing
	local integer i = 0
endfunction
// 10000 loop
function TestEfficiencyActions takes nothing returns nothing
	local integer i = 0
	loop
	exitwhen i == 1000
		call DzExecuteFunc("TESTTESTTEST")
		set i = i + 1
	endloop

endfunction
	
function TestEfficiency takes nothing returns nothing
	local integer i = 0

	set Temp__ArrayReal[10] = S2R(EXExecuteScript( "os.clock()" ))
	loop
		exitwhen i == 100
		call ExecuteFunc("TestEfficiencyActions")
		set i = i + 1
	endloop
	call DisplayTextToPlayer(GetLocalPlayer(),0,0, "用时"+ R2S( S2R(EXExecuteScript( "os.clock()" )) - Temp__ArrayReal[10]  ) )

endfunction

